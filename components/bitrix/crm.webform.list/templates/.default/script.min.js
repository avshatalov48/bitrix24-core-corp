(function(t,e,r,i){"use strict";var a,n,o,c,s,l,d;function u(t,e){v(t,e);e.add(t)}function f(t,e,r){v(t,e);e.set(t,r)}function v(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function h(t,e,r){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return r}var m=new WeakMap;var p=new WeakSet;var g=new WeakSet;var w=new WeakSet;var T=new WeakSet;var b=new WeakSet;var L=new WeakSet;var B=function(){function t(){babelHelpers.classCallCheck(this,t);u(this,L);u(this,b);u(this,T);u(this,w);u(this,g);u(this,p);f(this,m,{writable:true,value:null})}babelHelpers.createClass(t,[{key:"init",value:function t(e){var r=this;this.reloadGridTimeoutId=0;this.gridId=e.gridId;this.gridNode=document.getElementById(this.gridId);var i=BX("CRM_LIST_DESC_BTN_HIDE");if(i){BX.bind(i,"click",(function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","webform_list_view","hide-desc","Y")}))}var a=BX("CRM_LIST_WEBFORM_NOTIFY_BTN_HIDE");if(a){BX.bind(a,"click",(function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","notify_webform","ru_fz_152","Y")}))}h(this,p,y).call(this);BX.addCustomEvent("Grid::updated",(function(){h(r,p,y).call(r)}));return this}},{key:"setGroupAction",value:function t(e){babelHelpers.classPrivateFieldSet(this,m,e)}},{key:"runGroupAction",value:function t(){switch(babelHelpers.classPrivateFieldGet(this,m)){case"activate":this.activateList(true);return;case"deactivate":this.activateList(false);return;case"delete":this.removeList();return}if(babelHelpers.classPrivateFieldGet(this,m)){throw new Error('Wrong group action "'.concat(babelHelpers.classPrivateFieldGet(this,m),'"'))}}},{key:"showConfirm",value:function t(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"delete";r=r.toUpperCase();return new Promise((function(t,a){i.MessageBox.show({message:e.Loc.getMessage("CRM_WEBFORM_LIST_"+r+"_CONFIRM"),modal:true,title:e.Loc.getMessage("CRM_WEBFORM_LIST_"+r+"_CONFIRM_TITLE"),buttons:i.MessageBoxButtons.OK_CANCEL,onOk:function e(r){r.close();t()},onCancel:function t(e){e.close();a()}})}))}},{key:"reloadGrid",value:function t(){var e=h(this,b,I).call(this);if(e){return e.reload()}}},{key:"showGridLoader",value:function t(){var e=h(this,b,I).call(this);if(e){e.getLoader().show()}}},{key:"hideGridLoader",value:function t(){var e=h(this,b,I).call(this);if(e){e.getLoader().hide()}}},{key:"showNotification",value:function t(e){BX.UI.Notification.Center.notify({content:e})}},{key:"remove",value:function t(r){var i=this;this.showConfirm("delete").then((function(){i.showGridLoader();e.ajax.runAction("crm.form.delete",{json:{id:r}}).then((function(t){if(t.data){i.reloadGrid()}else{i.hideGridLoader();i.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))}}))["catch"]((function(){i.hideGridLoader();i.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))}))}))}},{key:"removeList",value:function t(){var e=this;this.showConfirm("delete").then((function(){var t=h(e,b,I).call(e);if(t){h(e,b,I).call(e).removeSelected()}}))}},{key:"resetCounters",value:function t(r){var i=this;this.showGridLoader();return e.ajax.runAction("crm.form.resetCounters",{json:{id:r}}).then((function(){return i.reloadGrid()}))["catch"]((function(){i.checkOnWriteAccessError(result);i.hideGridLoader()}))}},{key:"copy",value:function t(r){var i=this;this.showGridLoader();return e.ajax.runAction("crm.form.copy",{json:{id:r}}).then((function(){return i.reloadGrid()}))["catch"]((function(){i.checkOnWriteAccessError(result);i.hideGridLoader()}))}},{key:"showSiteCode",value:function t(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};BX.Crm.Form.Embed.openSlider(e,r)}},{key:"activateList",value:function t(){var r=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.showGridLoader();var a=h(this,b,I).call(this);if(!a){return}var n=a.getRows().getSelectedIds();e.ajax.runAction("crm.form.activateList",{json:{list:n,mode:i}}).then((function(){return r.reloadGrid()}))["catch"]((function(){r.checkOnWriteAccessError(result);r.hideGridLoader()}))}},{key:"activate",value:function t(r,i){var a=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var c=BX.UI.Switcher.getById("crm-form-list-item-"+r);if(c){c.setLoading(true);c.check(i,false)}return e.ajax.runAction("crm.form.activate",{json:{id:parseInt(r),mode:i}}).then((function(){if(c){o.textContent=c.isChecked()?BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"))):e.Loc.getMessage("CRM_WEBFORM_LIST_NOT_ACTIVE");c.setLoading(false)}if(n){a.reloadGrid()}}))["catch"]((function(t){a.checkOnWriteAccessError(t);if(c){c.setLoading(false);c.check(!c.isChecked(),false)}}))}},{key:"checkOnWriteAccessError",value:function t(r){var i=this;var a=r.errors;a.forEach((function(t){if(parseInt(t.code)===2){i.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_ITEM_WRITE_ACCESS_DENIED"))}}))}}]);return t}();function y(){h(this,w,E).call(this);h(this,g,C).call(this);h(this,T,_).call(this)}function C(){var t=h(this,L,k).call(this);if(!t){return}var e="data-crm-form-qr";var r=t.querySelectorAll("["+e+"]");r=Array.prototype.slice.call(r);r.forEach((function(t){if(t.querySelector(".crm-webform-qr-btn")){return}var r=JSON.parse(t.getAttribute(e));new BX.Crm.Form.Qr({link:r.path}).renderTo(t)}))}function E(){var t=h(this,L,k).call(this);if(!t){return}var i="data-crm-form-entities";var s=t.querySelectorAll("["+i+"]");s=Array.prototype.slice.call(s);s.forEach((function(t){var s=JSON.parse(t.getAttribute(i));var l=function t(i){i.stopPropagation();i.preventDefault();var l="crm-form-grid-entities-"+s.id;var d=r.PopupManager.getPopupById(l);if(d){var u=d.getId()===l;d.destroy();d=null;if(u){return}}var f=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="crm-webform-list-entities"></div>'])));s.counters.forEach((function(t){var r=function e(r){r.stopPropagation();r.preventDefault();BX.SidePanel.Instance.open(t.LINK);return false};var i=e.Text.encode(t.ENTITY_CAPTION);var a=e.Text.encode(t.VALUE);var s=!t.LINK?e.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date" \n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</span>\n\t\t\t\t\t\t"])),i,i):e.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t\t"])),e.Text.encode(t.LINK),r,i,i);f.appendChild(e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<span class="crm-webform-list-entity-counter">',"</span>\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t"])),s,a))}));var v=160;d=r.PopupManager.create({id:l,className:"crm-webform-list-entities-popup",closeByEsc:true,autoHide:true,bindElement:i.target,content:f,angle:{offset:v/2-16},offsetLeft:-(v/2)+i.target.offsetWidth/2+40,animation:"fading-slide",width:v,padding:0});d.show()};t.addEventListener("click",l)}))}function _(){var t=this;var i=h(this,L,k).call(this);if(!i){return}var a="data-crm-form-switcher";var n=i.querySelectorAll("["+a+"]");n=Array.prototype.slice.call(n);n.forEach((function(i){i.innerHTML="";var n=JSON.parse(i.getAttribute(a));var o=e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="','"\n\t\t\t\t>',"</div>\n\t\t\t"])),n.active?"":"crm-webform-list-text-gray",e.Text.encode(n.dateActiveShort));var c=new BX.UI.Switcher({id:"crm-form-list-item-"+n.id,checked:n.active,color:"green",handlers:{toggled:function r(){t.activate(n.id,c.isChecked(),false,o);c.isChecked()?e.Dom.removeClass(o,"crm-webform-list-text-gray"):e.Dom.addClass(o,"crm-webform-list-text-gray")}}});c.renderTo(i);var u=function t(i){var a="crm-form-grid-active-"+n.id;var o=r.PopupManager.getPopupById(a);if(o){var c=o.getId()===a;o.destroy();o=null;if(c){return}}var s=250;o=r.PopupManager.create({id:a,className:"crm-webform-list-active-popup",closeByEsc:true,autoHide:true,angle:{offset:s/2-16},offsetLeft:-(s/2)+i.target.offsetWidth/2+40,animation:"fading-slide",bindElement:i.target,width:s,padding:0,content:e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t<div class="crm-webform-list-active-popup-item">\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-caption">','</div>\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t>','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="BX.SidePanel.Instance.open(\'','\')"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-common-user crm-webform-active-popup-item-avatar ','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i style="background-image: url(',');"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),e.Text.encode(n.activatedBy.text),e.Text.encode(n.dateActiveFull),e.Text.encode(n.dateActiveFull),e.Text.encode(n.activatedBy.path),e.Text.encode(n.activatedBy.path),e.Text.encode(n.activatedBy.name),e.Text.encode(n.activatedBy.iconClass),encodeURI(e.Text.encode(n.activatedBy.iconPath)))});o.show()};i.appendChild(e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-webform-list-active-desc">\n\t\t\t\t\t','\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tclass="crm-webform-list-active-more"\n\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),o,u,e.Loc.getMessage("CRM_WEBFORM_LIST_BTN_DETAILS")))}))}function I(){return BX.Main.gridManager.getInstanceById(this.gridId)}function k(){var t=h(this,b,I).call(this);if(t){return t.getContainer()}}BX.Crm.WebFormList=new B})(this.window=this.window||{},BX,BX.Main,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js