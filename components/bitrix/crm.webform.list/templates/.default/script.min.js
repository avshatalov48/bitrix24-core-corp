(function(t,e,i,r,n,a){"use strict";var o,s,c,l,d,u,f,h;function v(t,e){p(t,e);e.add(t)}function m(t,e,i){p(t,e);e.set(t,i)}function p(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function g(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _="crm_webform";var E=new WeakMap;var T=new WeakSet;var b=new WeakSet;var w=new WeakSet;var L=new WeakSet;var C=new WeakSet;var B=new WeakSet;var I=new WeakSet;var y=function(){function t(){babelHelpers.classCallCheck(this,t);v(this,I);v(this,B);v(this,C);v(this,L);v(this,w);v(this,b);v(this,T);m(this,E,{writable:true,value:null})}babelHelpers.createClass(t,[{key:"init",value:function t(e){var i=this;this.reloadGridTimeoutId=0;this.gridId=e.gridId;this.gridNode=document.getElementById(this.gridId);var r=BX("CRM_LIST_DESC_BTN_HIDE");if(r){BX.bind(r,"click",(function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","webform_list_view","hide-desc","Y")}))}var n=BX("CRM_LIST_WEBFORM_NOTIFY_BTN_HIDE");if(n){BX.bind(n,"click",(function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","notify_webform","ru_fz_152","Y")}))}g(this,T,M).call(this);BX.addCustomEvent("Grid::updated",(function(){g(i,T,M).call(i)}));return this}},{key:"setGroupAction",value:function t(e){babelHelpers.classPrivateFieldSet(this,E,e)}},{key:"runGroupAction",value:function t(){switch(babelHelpers.classPrivateFieldGet(this,E)){case"activate":this.activateList(true);return;case"deactivate":this.activateList(false);return;case"delete":this.removeList();return}if(babelHelpers.classPrivateFieldGet(this,E)){throw new Error('Wrong group action "'.concat(babelHelpers.classPrivateFieldGet(this,E),'"'))}}},{key:"showConfirm",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"delete";i=i.toUpperCase();return new Promise((function(t,n){r.MessageBox.show({message:e.Loc.getMessage("CRM_WEBFORM_LIST_"+i+"_CONFIRM"),modal:true,title:e.Loc.getMessage("CRM_WEBFORM_LIST_"+i+"_CONFIRM_TITLE"),buttons:r.MessageBoxButtons.OK_CANCEL,onOk:function e(i){i.close();t()},onCancel:function t(e){e.close();n()}})}))}},{key:"reloadGrid",value:function t(){var e=g(this,C,S).call(this);if(e){return e.reload()}}},{key:"showGridLoader",value:function t(){var e=g(this,C,S).call(this);if(e){e.getLoader().show()}}},{key:"hideGridLoader",value:function t(){var e=g(this,C,S).call(this);if(e){e.getLoader().hide()}}},{key:"showNotification",value:function t(e){BX.UI.Notification.Center.notify({content:e})}},{key:"remove",value:function t(i){var r=this;this.showConfirm("delete").then((function(){r.showGridLoader();e.ajax.runAction("crm.form.delete",{json:{id:i}}).then((function(t){if(t.data){r.reloadGrid()}else{r.hideGridLoader();r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))}}))["catch"]((function(){r.hideGridLoader();r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))}))}))}},{key:"removeList",value:function t(){var e=this;this.showConfirm("delete").then((function(){var t=g(e,C,S).call(e);if(t){g(e,C,S).call(e).removeSelected()}}))}},{key:"resetCounters",value:function t(i){var r=this;this.showGridLoader();return e.ajax.runAction("crm.form.resetCounters",{json:{id:i}}).then((function(){return r.reloadGrid()}))["catch"]((function(){r.checkOnWriteAccessError(result);r.hideGridLoader()}))}},{key:"copy",value:function t(i){var r=this;this.showGridLoader();return e.ajax.runAction("crm.form.copy",{json:{id:i}}).then((function(){return r.reloadGrid()}))["catch"]((function(){r.checkOnWriteAccessError(result);r.hideGridLoader()}))}},{key:"showSiteCode",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(r){g(this,I,F).call(this,_,e,(function(){BX.Crm.Form.Embed.openSlider(e,i)}))}else{BX.Crm.Form.Embed.openSlider(e,i)}}},{key:"activateList",value:function t(){var i=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.showGridLoader();var n=g(this,C,S).call(this);if(!n){return}var a=n.getRows().getSelectedIds();e.ajax.runAction("crm.form.activateList",{json:{list:a,mode:r}}).then((function(){return i.reloadGrid()}))["catch"]((function(){i.checkOnWriteAccessError(result);i.hideGridLoader()}))}},{key:"activate",value:function t(i,r){var n=this;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var s=BX.UI.Switcher.getById("crm-form-list-item-"+i);if(s){s.setLoading(true);s.check(r,false)}return e.ajax.runAction("crm.form.activate",{json:{id:parseInt(i),mode:r}}).then((function(){if(s){o.textContent=s.isChecked()?BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"))):e.Loc.getMessage("CRM_WEBFORM_LIST_NOT_ACTIVE");s.setLoading(false)}if(a){n.reloadGrid()}}))["catch"]((function(t){n.checkOnWriteAccessError(t);if(s){s.setLoading(false);s.check(!s.isChecked(),false)}}))}},{key:"checkOnWriteAccessError",value:function t(i){var r=this;var n=i.errors;n.forEach((function(t){if(parseInt(t.code)===2){r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_ITEM_WRITE_ACCESS_DENIED"))}if(t.code==="ERROR_CODE_PHONE_NOT_VERIFIED"){r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_ITEM_PHONE_NOT_VERIFIED"))}}))}}]);return t}();function M(){g(this,w,O).call(this);g(this,b,R).call(this);g(this,L,k).call(this)}function R(){var t=this;var i=g(this,B,N).call(this);if(!i){return}var r="data-crm-form-qr";var n=i.querySelectorAll("["+r+"]");n=Array.prototype.slice.call(n);n.forEach((function(i){if(i.querySelector(".crm-webform-qr-btn")){return}var n=JSON.parse(i.getAttribute(r));if(n.needVerify){var a=function e(){g(t,I,F).call(t,_,n.id,(function(){new BX.Crm.Form.Qr({link:n.path}).show()}))};i.appendChild(e.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="crm-webform-qr-btn ui-btn ui-btn-xs ui-btn-light-border ui-btn-round ui-btn-no-caps ui-btn-icon-share"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t"])),a,e.Loc.getMessage("CRM_WEBFORM_QR_OPEN")))}else{new BX.Crm.Form.Qr({link:n.path}).renderTo(i)}}))}function O(){var t=g(this,B,N).call(this);if(!t){return}var r="data-crm-form-entities";var n=t.querySelectorAll("["+r+"]");n=Array.prototype.slice.call(n);n.forEach((function(t){var n=JSON.parse(t.getAttribute(r));var a=function t(r){r.stopPropagation();r.preventDefault();var a="crm-form-grid-entities-"+n.id;var o=i.PopupManager.getPopupById(a);if(o){var u=o.getId()===a;o.destroy();o=null;if(u){return}}var f=e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="crm-webform-list-entities"></div>'])));n.counters.forEach((function(t){var i=function e(i){i.stopPropagation();i.preventDefault();BX.SidePanel.Instance.open(t.LINK);return false};var r=e.Text.encode(t.ENTITY_CAPTION);var n=e.Text.encode(t.VALUE);var a=!t.LINK?e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date" \n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</span>\n\t\t\t\t\t\t"])),r,r):e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t\t"])),e.Text.encode(t.LINK),i,r,r);f.appendChild(e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<span class="crm-webform-list-entity-counter">',"</span>\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t"])),a,n))}));var h=160;o=i.PopupManager.create({id:a,className:"crm-webform-list-entities-popup",closeByEsc:true,autoHide:true,bindElement:r.target,content:f,angle:{offset:h/2-16},offsetLeft:-(h/2)+r.target.offsetWidth/2+40,animation:"fading-slide",width:h,padding:0});o.show()};t.addEventListener("click",a)}))}function k(){var t=this;var r=g(this,B,N).call(this);if(!r){return}var n="data-crm-form-switcher";var a=r.querySelectorAll("["+n+"]");a=Array.prototype.slice.call(a);a.forEach((function(r){r.innerHTML="";var a=JSON.parse(r.getAttribute(n));var o=e.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="','"\n\t\t\t\t>',"</div>\n\t\t\t"])),a.active?"":"crm-webform-list-text-gray",e.Text.encode(a.dateActiveShort));var s=new BX.UI.Switcher({id:"crm-form-list-item-"+a.id,checked:a.active,color:"green",handlers:{toggled:function i(){t.activate(a.id,s.isChecked(),false,o);s.isChecked()?e.Dom.removeClass(o,"crm-webform-list-text-gray"):e.Dom.addClass(o,"crm-webform-list-text-gray")}}});s.renderTo(r);var c=function t(r){var n="crm-form-grid-active-"+a.id;var o=i.PopupManager.getPopupById(n);if(o){var s=o.getId()===n;o.destroy();o=null;if(s){return}}var c=250;o=i.PopupManager.create({id:n,className:"crm-webform-list-active-popup",closeByEsc:true,autoHide:true,angle:{offset:c/2-16},offsetLeft:-(c/2)+r.target.offsetWidth/2+40,animation:"fading-slide",bindElement:r.target,width:c,padding:0,content:e.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t<div class="crm-webform-list-active-popup-item">\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-caption">','</div>\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t>','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="BX.SidePanel.Instance.open(\'','\')"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-common-user crm-webform-active-popup-item-avatar ','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i style="background-image: url(',');"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),e.Text.encode(a.activatedBy.text),e.Text.encode(a.dateActiveFull),e.Text.encode(a.dateActiveFull),e.Text.encode(a.activatedBy.path),e.Text.encode(a.activatedBy.path),e.Text.encode(a.activatedBy.name),e.Text.encode(a.activatedBy.iconClass),encodeURI(e.Text.encode(a.activatedBy.iconPath)))});o.show()};r.appendChild(e.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-webform-list-active-desc">\n\t\t\t\t\t','\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tclass="crm-webform-list-active-more"\n\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),o,c,e.Loc.getMessage("CRM_WEBFORM_LIST_BTN_DETAILS")))}))}function S(){return BX.Main.gridManager.getInstanceById(this.gridId)}function N(){var t=g(this,C,S).call(this);if(t){return t.getContainer()}}function F(t,i,r){var n=this;var o=e.Loc.getMessage("CRM_WEBFORM_PHONE_VERIFY_CUSTOM_SLIDER_TITLE"),s=e.Loc.getMessage("CRM_WEBFORM_PHONE_VERIFY_CUSTOM_TITLE"),c=e.Loc.getMessage("CRM_WEBFORM_PHONE_VERIFY_CUSTOM_DESCRIPTION_V1");if(typeof a.PhoneVerify!=="undefined"){a.PhoneVerify.getInstance().setEntityType(t).setEntityId(i).startVerify({sliderTitle:o,title:s,description:c}).then((function(t){if(t){r();n.reloadGrid()}}))}else{r()}}BX.Crm.WebFormList=new y})(this.window=this.window||{},BX,BX.Main,BX.UI.Dialogs,BX,BX.Bitrix24);
//# sourceMappingURL=script.map.js