{"version":3,"file":"script.js","sources":["settings-widget-loader.js"],"sourcesContent":["import {PopupComponentsMaker} from 'ui.popupcomponentsmaker';\nimport {Dom, Tag, ajax, Runtime} from \"main.core\";\n\nexport class SettingsWidgetLoader\n{\n\tstatic #instance: SettingsWidgetLoader;\n\t#popup: PopupComponentsMaker;\n\t#isBitrix24: boolean = false;\n\t#isAdmin: boolean = false;\n\t#isRequisite: boolean = false;\n\t#isMainPageAvailable: boolean = false;\n\n\tconstructor(params)\n\t{\n\t\tthis.#isBitrix24 = params['isBitrix24'];\n\t\tthis.#isAdmin = params['isAdmin'];\n\t\tthis.#isRequisite = params['isRequisite'];\n\t\tthis.#isMainPageAvailable = params['isMainPageAvailable'];\n\t}\n\n\tshowOnce(node)\n\t{\n\t\tconst popup = this.#getWidgetPopup().getPopup();\n\n\t\tpopup.setBindElement(node);\n\t\tpopup.show();\n\n\t\tconst popupContainer = popup.getPopupContainer();\n\t\tif (popupContainer.getBoundingClientRect().left < 30)\n\t\t{\n\t\t\tpopupContainer.style.left = '30px';\n\t\t}\n\n\t\t(typeof BX.Intranet.SettingsWidget !== 'undefined' ? Promise.resolve(): this.#load())\n\t\t\t.then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tBX.Intranet.SettingsWidget.bindAndShow(node);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#getWidgetPopup(): PopupComponentsMaker\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\treturn this.#popup;\n\t\t}\n\n\t\tconst popup = new PopupComponentsMaker({\n\t\t\twidth: 374,\n\t\t});\n\n\t\tconst container = popup.getPopup().getPopupContainer();\n\n\t\tDom.clean(container);\n\t\tDom.addClass(container, 'intranet-widget-skeleton__wrap');\n\n\t\tDom.append(this.getHeaderSkeleton(), container);\n\n\t\tif (this.#isRequisite)\n\t\t{\n\t\t\tDom.append(this.getItemSkeleton(), container);\n\t\t}\n\n\t\tif (this.#isMainPageAvailable)\n\t\t{\n\t\t\tDom.append(this.getItemSkeleton(), container);\n\t\t}\n\n\t\tif (this.#isAdmin)\n\t\t{\n\t\t\tDom.append(this.getSplitItemSkeleton(), container);\n\t\t}\n\n\t\tif (this.#isBitrix24)\n\t\t{\n\t\t\tDom.append(this.getItemSkeleton(), container);\n\t\t}\n\n\t\tDom.append(this.getItemSkeleton(), container);\n\t\tDom.append(this.getFooterSkeleton(), container);\n\n\t\tthis.#popup = popup;\n\n\t\treturn popup;\n\t}\n\n\tgetHeaderSkeleton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-widget-skeleton__header\">\n\t\t\t\t<div style=\"max-width: 95px; height: 8px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetItemSkeleton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-widget-skeleton__row\">\n\t\t\t\t<div class=\"intranet-widget-skeleton__item\">\n\t\t\t\t\t<div style=\"width: 26px; height: 26px; margin-right: 8px;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t\t<div style=\"max-width: 130px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t\t\t<div style=\"width: 12px; height: 12px; margin-left: auto;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetSplitItemSkeleton(): HTMLElement\n\t{\n\t\treturn  Tag.render`\n\t\t\t<div class=\"intranet-widget-skeleton__row\">\n\t\t\t\t<div class=\"intranet-widget-skeleton__item\">\n\t\t\t\t\t<div style=\"width: 26px; height: 26px; margin-right: 8px;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t\t<div style=\"max-width: 75px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t\t\t<div style=\"width: 12px; height: 12px; margin-left: auto;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-widget-skeleton__item\">\n\t\t\t\t\t<div style=\"width: 26px; height: 26px; margin-right: 8px;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t\t<div style=\"max-width: 75px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t\t\t<div style=\"width: 12px; height: 12px; margin-left: auto;\" class=\"intranet-widget-skeleton__circle\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetFooterSkeleton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-widget-skeleton__footer\">\n\t\t\t\t<div style=\"max-width: 40px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t\t<div style=\"max-width: 40px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t\t<div style=\"max-width: 40px;\" class=\"intranet-widget-skeleton__line\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#load(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.settings.widget',\n\t\t\t\t'getWidgetComponent',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t},\n\t\t\t).then((response) => {\n\t\t\t\treturn (new Promise((resolve) => {\n\t\t\t\t\tconst loadCss = response.data.assets ? response.data.assets.css : [];\n\t\t\t\t\tconst loadJs = response.data.assets ? response.data.assets.js : [];\n\t\t\t\t\tBX.load(loadCss, () => {\n\t\t\t\t\t\tBX.loadScript(loadJs, () => {\n\t\t\t\t\t\t\tRuntime.html(null, response.data.html).then(resolve);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}).then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tBX.Intranet.SettingsWidget.bindWidget(this.#getWidgetPopup());\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t}\n\n\tstatic init(options): SettingsWidgetLoader\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this(options);\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n}"],"names":["SettingsWidgetLoader","constructor","params","showOnce","node","popup","getPopup","setBindElement","show","popupContainer","getPopupContainer","getBoundingClientRect","left","style","BX","Intranet","SettingsWidget","Promise","resolve","then","bindAndShow","getHeaderSkeleton","Tag","render","getItemSkeleton","getSplitItemSkeleton","getFooterSkeleton","init","options","PopupComponentsMaker","width","container","Dom","clean","addClass","append","ajax","runComponentAction","mode","response","loadCss","data","assets","css","loadJs","js","load","loadScript","Runtime","html","setTimeout","bindWidget"],"mappings":"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"}