{"version":3,"file":"script.js","sources":["settings-widget-loader.js"],"sourcesContent":["import {PopupComponentsMaker} from 'ui.popupcomponentsmaker';\nimport {Dom, Tag, ajax, Runtime} from \"main.core\";\n\nexport class SettingsWidgetLoader\n{\n\tstatic #instance: SettingsWidgetLoader;\n\t#popup: PopupComponentsMaker;\n\t#isBitrix24: boolean = false;\n\t#isAdmin: boolean = false;\n\t#isRequisite: boolean = false;\n\n\tconstructor(params)\n\t{\n\t\tthis.#isBitrix24 = params['isBitrix24'];\n\t\tthis.#isAdmin = params['isAdmin'];\n\t\tthis.#isRequisite = params['isRequisite'];\n\t}\n\n\tshowOnce(node)\n\t{\n\t\tconst popup = this.#getWidgetPopup().getPopup();\n\n\t\tpopup.setBindElement(node);\n\t\tpopup.show();\n\n\t\tconst popupContainer = popup.getPopupContainer();\n\t\tif (popupContainer.getBoundingClientRect().left < 30)\n\t\t{\n\t\t\tpopupContainer.style.left = '30px';\n\t\t}\n\n\t\t(typeof BX.Intranet.SettingsWidget !== 'undefined' ? Promise.resolve(): this.#load())\n\t\t\t.then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tBX.Intranet.SettingsWidget.bindAndShow(node);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#getWidgetPopup(): PopupComponentsMaker\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\treturn this.#popup;\n\t\t}\n\n\t\tconst popup = new PopupComponentsMaker({\n\t\t\twidth: 374,\n\t\t});\n\n\t\tconst container = popup.getPopup().getPopupContainer();\n\n\t\tDom.clean(container);\n\t\tDom.addClass(container, 'intranet-settings-widget__container');\n\n\t\tif (this.#isBitrix24 && !this.#isAdmin)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"intranet-settings-widget__skeleton-not-admin\"></div>`, container);\n\t\t}\n\t\telse if (this.#isBitrix24 && this.#isRequisite)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"intranet-settings-widget__skeleton\"></div>`, container);\n\t\t}\n\t\telse if (this.#isBitrix24 && !this.#isRequisite)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"intranet-settings-widget__skeleton-no-requisite\"></div>`, container);\n\t\t}\n\t\telse if (!this.#isBitrix24 && this.#isRequisite)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"intranet-settings-widget__skeleton-no-holding\"></div>`, container);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"intranet-settings-widget__skeleton-no-requisite-holding\"></div>`, container);\n\t\t}\n\n\t\tthis.#popup = popup;\n\n\t\treturn popup;\n\t}\n\n\t#load(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.settings.widget',\n\t\t\t\t'getWidgetComponent',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t},\n\t\t\t).then((response) => {\n\t\t\t\treturn (new Promise((resolve) => {\n\t\t\t\t\tconst loadCss = response.data.assets ? response.data.assets.css : [];\n\t\t\t\t\tconst loadJs = response.data.assets ? response.data.assets.js : [];\n\t\t\t\t\tBX.load(loadCss, () => {\n\t\t\t\t\t\tBX.loadScript(loadJs, () => {\n\t\t\t\t\t\t\tRuntime.html(null, response.data.html).then(resolve);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}).then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tBX.Intranet.SettingsWidget.bindWidget(this.#getWidgetPopup());\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t}\n\n\tstatic init(options): SettingsWidgetLoader\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this(options);\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n}"],"names":["SettingsWidgetLoader","constructor","params","showOnce","node","popup","getPopup","setBindElement","show","popupContainer","getPopupContainer","getBoundingClientRect","left","style","BX","Intranet","SettingsWidget","Promise","resolve","then","bindAndShow","init","options","PopupComponentsMaker","width","container","Dom","clean","addClass","append","Tag","render","ajax","runComponentAction","mode","response","loadCss","data","assets","css","loadJs","js","load","loadScript","Runtime","html","setTimeout","bindWidget"],"mappings":"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"}