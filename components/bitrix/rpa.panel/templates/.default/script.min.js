(function(t,e,i,n,a){"use strict";function s(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item-text">',"</div>\n\t\t\t\t"]);s=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span id="rpa-type-list-','-counter" class="rpa-tile-item-counter" ',">","</span>\n\t\t\t\t"]);r=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item-status"></div>\n\t\t\t\t']);o=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item-image-block">\n\t\t\t\t\t\t<div class="rpa-tile-item-image rpa-tile-item-icon-','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t']);l=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item-button" onclick="','">\n\t\t\t\t\t\t<div class="rpa-tile-item-button-inner">',"</div>\n\t\t\t\t\t</div>\n\t\t\t\t"]);c=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item" onclick="','">\n\t\t\t\t\t\t<div class="rpa-tile-item-content">\n\t\t\t\t\t\t\t<div class="rpa-tile-item-subject">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"]);u=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="rpa-tile-item rpa-tile-item-add-new" onclick="','">\n\t\t\t\t\t\t<div class="rpa-tile-item-content">\n\t\t\t\t\t\t\t<span class="rpa-tile-item-add-new-inner">\n\t\t\t\t\t\t\t\t<span class="rpa-tile-item-add-icon"></span>\n\t\t\t\t\t\t\t\t<span class="rpa-tile-item-add-text">',"</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"]);d=function e(){return t};return t}var g=e.Reflection.namespace("BX.Rpa");var p=function(t){babelHelpers.inherits(g,t);function g(t){var e;babelHelpers.classCallCheck(this,g);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(g).call(this,t));e.typeId=t.typeId;e.title=t.title;e.image=t.image;e.listUrl=t.listUrl;e.canDelete=t.canDelete===true;e.tasksCounter=t.tasksCounter;e.isSettingsRestricted=t.isSettingsRestricted===true;return e}babelHelpers.createClass(g,[{key:"isNew",value:function t(){return this.id==="rpa-type-new"}},{key:"getContent",value:function t(){if(!this.layout.container){if(this.isNew()){this.layout.container=e.Tag.render(d(),this.onClick.bind(this),e.Loc.getMessage("RPA_COMMON_NEW_PROCESS"))}else{this.layout.container=e.Tag.render(u(),this.onClick.bind(this),this.getTitle(),this.getButton(),this.getImage(),this.getStatus(),this.getCounter())}}return this.layout.container}},{key:"removeNode",value:function t(){if(this.layout.container&&this.layout.container.parentNode){this.layout.container.parentNode.removeChild(this.layout.container)}}},{key:"getButton",value:function t(){if(!this.layout.button){this.layout.button=e.Tag.render(c(),this.showActions.bind(this),e.Loc.getMessage("RPA_COMMON_BUTTON_ACTIONS"))}return this.layout.button}},{key:"getImage",value:function t(){if(!this.layout.image){this.layout.image=e.Tag.render(l(),e.Text.encode(this.image))}return this.layout.image}},{key:"getStatus",value:function t(){if(!this.layout.status){this.layout.status=e.Tag.render(o())}return this.layout.status}},{key:"getCounter",value:function t(){if(!this.layout.counter){this.layout.counter=e.Tag.render(r(),this.typeId,this.tasksCounter<=0?'style="display: none;"':"",this.tasksCounter)}return this.layout.counter}},{key:"getTitle",value:function t(){if(!this.layout.title){this.layout.title=e.Tag.render(s(),e.Text.encode(this.title))}return this.layout.title}},{key:"updateLayout",value:function t(){var i=this;this.getTitle().innerText=this.title;var n=this.getImage().querySelector(".rpa-tile-item-image");if(!n){return}n.classList.forEach(function(t){if(t.match("rpa-tile-item-icon-")){n.classList.remove(t)}n.classList.add("rpa-tile-item-icon-"+e.Text.encode(i.image))})}},{key:"onClick",value:function t(){if(this.isNew()){if(this.gridTile.options.isCreateTypeRestricted){i.Manager.Instance.showFeatureSlider();return}this.openSettings().then(function(t){var n=t.getData();var a=n.get("response");if(a&&a.status==="success"){i.Manager.Instance.openKanban(a.data.type.id)}else{var s=n.get("type");if(e.Type.isPlainObject(s)&&s.typeId&&s.typeId>0){e.ajax.runAction("rpa.type.delete",{data:{id:s.typeId}})}}})}else{this.goToList()}}},{key:"showActions",value:function t(e){e.preventDefault();e.stopPropagation();n.PopupMenu.show({id:this.id,bindElement:this.getButton(),items:this.getActions(),offsetLeft:0,offsetTop:0,closeByEsc:true,className:"rpa-item-actions",cacheable:false})}},{key:"closeActions",value:function t(){n.PopupMenu.destroy(this.id)}},{key:"getActions",value:function t(){var n=this;var s=this;var r=[{text:e.Loc.getMessage("RPA_COMMON_LIST"),onclick:function t(){s.goToList();n.closeActions()}},{text:e.Loc.getMessage("RPA_COMMON_ACTION_SETTINGS"),onclick:function t(){n.closeActions();if(n.isSettingsRestricted){i.Manager.Instance.showFeatureSlider();return}n.openSettings().then(function(t){if(!t){return}var i=t.getData().get("response");if(i&&i.data&&e.Type.isPlainObject(i.data.type)){n.image=i.data.type.image;n.title=i.data.type.title;n.updateLayout()}})}},{text:e.Loc.getMessage("RPA_COMMON_STAGES"),onclick:function t(){if(n.isSettingsRestricted){i.Manager.Instance.showFeatureSlider()}else{i.Manager.Instance.openStageList(n.typeId)}}},{text:e.Loc.getMessage("RPA_COMMON_FIELDS_SETTINGS"),onclick:function t(){if(n.isSettingsRestricted){i.Manager.Instance.showFeatureSlider()}else{i.Manager.Instance.openFieldsList(n.typeId)}}}];if(this.canDelete){r.push({text:e.Loc.getMessage("RPA_COMMON_ACTION_DELETE"),onclick:function t(){n.closeActions();if(n.gridTile.getLoader().isShown()){return}a.MessageBox.confirm(e.Loc.getMessage("RPA_PANEL_DELETE_CONFIRM_TEXT"),e.Loc.getMessage("RPA_PANEL_DELETE_CONFIRM_TITLE"),function(){return s.delete()})}})}return r}},{key:"openSettings",value:function t(){if(this.isNew()){return i.Manager.Instance.openTypeDetail(0,{allowChangeHistory:false})}return i.Manager.Instance.openTypeDetail(this.typeId)}},{key:"openStages",value:function t(){return i.Manager.Instance.openStageList(this.typeId)}},{key:"delete",value:function t(){var i=this;return new Promise(function(t){if(i.gridTile.getLoader().isShown()){t()}i.gridTile.getLoader().show();e.ajax.runAction("rpa.type.delete",{analyticsLabel:"rpaPanelDeleteType",data:{id:i.typeId}}).then(function(e){i.gridTile.getLoader().hide();i.gridTile.removeItem(i);t()}).catch(function(e){i.gridTile.getLoader().hide();var n="";e.errors.forEach(function(t){n+=t.message});g.showError(n);t()})})}},{key:"goToList",value:function t(){if(this.listUrl){location.href=this.listUrl}}}],[{key:"getErrorNode",value:function t(){return document.getElementById("rpa-panel-error-container")}},{key:"showError",value:function t(e){g.getErrorNode().innerText=e;if(e.length>0){g.getErrorNode().parentNode.style.display="block"}else{g.getErrorNode().parentNode.style.display="none"}}}]);return g}(BX.TileGrid.Item);g.PanelItem=p})(this.window=this.window||{},BX,BX.Rpa,BX.Main,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js