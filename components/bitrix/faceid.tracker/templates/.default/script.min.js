var jsDetectionInProgress=false;var Module,isModuleInitialized,isBxFaceIdInitialized;var faceTrackerSettings={socnet_enabled:true};if(typeof Module==="undefined"){Module={}}Module.onRuntimeInitialized=function(){isModuleInitialized=true;_BXFaceIdStart()};function BXFaceIdStart(t){for(var e in t){faceTrackerSettings[e]=t[e]}isBxFaceIdInitialized=true;_BXFaceIdStart()}function _BXFaceIdStart(){if(!isModuleInitialized||!isBxFaceIdInitialized){return}var t=false;var e=false;var a=null;var r=null;var s=null;var c=null;var n=BX.localStorage.get("faceid-default-camera");var d=null;var o={cameraRatio:0,screenRatio:window.screen.width/window.screen.height,cameraSmallWidth:340,cameraSmallHeight:0,cameraFullWidth:0,cameraFullHeight:0,snapshotWidth:640,snapshotHeight:0,trackingSmallRatio:0,trackingFullRatio:0,cameraWidth:0,cameraHeight:0,trackingRatio:0};var l=null;var f=null;var u=[];var m={};var h=new Module.WebPhotoMakerM;h.setStopAfterBestShot(true);h.setMovementThreshold(.03);h.setBestShotScoreThreshold(.05);h.setRotationThreshold(50);h.setMinFaceScaleFactor(.15);h.setMaxNumberOfFramesWithoutDetection(8);var v=o.snapshotWidth*o.snapshotWidth*4;var g=Module._malloc(v);var p=new Uint8ClampedArray(Module.HEAPU8.buffer,g,v);var k=[-1,-1,-1,-1,-1,-1];var B=["","","","","",""];function X(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){b(BX.message("FACEID_TRACKER_CMP_JS_CAMERA_ERROR"));return}navigator.mediaDevices.enumerateDevices().then(function(t){var e=document.getElementById("faceid-cameralist");var a="faceid-tracker-sidebar-photo-settings-checked";t.forEach(function(t){if(t.kind=="videoinput"){if(n==null){n=t.deviceId;BX.localStorage.set("faceid-default-camera",n,3600*24*360)}var i="faceid-tracker-sidebar-photo-settings-inner-list-item";var r=t.label.replace(/\(\w{4}:\w{4}\)/g,"");if(!r.length){r=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_DEFAULT")}if(t.deviceId==n){i+=" "+a}var s=BX.create("div",{text:r,attrs:{class:i,"data-camera-id":t.deviceId}});e.appendChild(s);BX.bind(s,"click",function(){if(BX.hasClass(BX(this),a)){return}var t,i=BX.findChildren(e);for(t in i){BX.removeClass(i[t],a)}BX.addClass(BX(this),a);n=this.getAttribute("data-camera-id");BX.localStorage.set("faceid-default-camera",n,3600*24*360);_();BX.toggle(BX("faceid-settings-container"))})}});C()}).catch(function(t){console.log(t.name+": "+t.message);b(BX.message("FACEID_TRACKER_CMP_JS_CAMERA_ERROR"))})}if(window.FACEID_AGREEMENT){X()}BX.bind(BX("faceid-settings-button"),"click",function(){BX.toggle(BX("faceid-settings-container"))});function _(){navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n}},audio:false}).then(function(t){try{a.srcObject=t}catch(i){var e=window.URL||window.webkitURL;a.src=e.createObjectURL(t)}a.play()}).catch(function(t){console.log("An error occured! "+t);BX.localStorage.remove("faceid-default-camera");var e;if(t.toString().indexOf("DevicesNotFound")>=0){e=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_NOT_FOUND")}else{e=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_NO_SUPPORT")}b(e)})}function C(){a=document.getElementById("faceid-video");r=document.getElementById("faceid-canvas");c=document.getElementById("faceid-startbutton");_();l=document.getElementById("faceid-overlay-face-border");f=l.getContext("2d");a.addEventListener("canplay",function(t){if(!e){o.cameraRatio=a.videoWidth/a.videoHeight;o.cameraSmallHeight=a.videoHeight/(a.videoWidth/o.cameraSmallWidth);if(o.screenRatio>=o.cameraRatio){o.cameraFullHeight=window.screen.height;o.cameraFullWidth=a.videoWidth/(a.videoHeight/o.cameraFullHeight)}else{o.cameraFullWidth=window.screen.width;o.cameraFullHeight=a.videoHeight/(a.videoWidth/o.cameraFullWidth)}o.snapshotHeight=a.videoHeight/(a.videoWidth/o.snapshotWidth);o.trackingSmallRatio=o.cameraSmallWidth/o.snapshotWidth;o.trackingFullRatio=o.cameraFullWidth/o.snapshotWidth;o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio;a.setAttribute("width",o.cameraWidth);a.setAttribute("height",o.cameraHeight);r.setAttribute("width",o.snapshotWidth);r.setAttribute("height",o.snapshotHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight);e=true;S()}},false);c.addEventListener("click",function(t){T();t.preventDefault()},false);if(window.FACEID_LAST_VISITORS){for(i in window.FACEID_LAST_VISITORS){y(window.FACEID_LAST_VISITORS[i],false)}}}function b(t){BX("faceid-camera-error").innerHTML=t;BX.show(BX("faceid-camera-error"))}function S(){requestAnimationFrame(S);if($("#faceid-auto-identify").prop("checked")==false){return}if(t){return}if(u.length){}t=true;var e=r.getContext("2d");e.drawImage(a,0,0,o.snapshotWidth,o.snapshotHeight);var i=r.toDataURL("image/jpeg",1);var s=new Image;s.onload=function(){var e=w(r,true);if(e.length>0){var a=[];for(var i in e){if(!m[e[i].frameId]&&h.getBestShotFrameNumber(e[i].frameId)>=0&&h.getCurrentFrameNumber()>=h.getBestShotFrameNumber(e[i].frameId)){a.push(e[i])}}if(a.length){E(a,s)}}t=false};s.onerror=function(){t=false};s.src=i;requestAnimationFrame(S)}function A(t){for(var e=0;e<k.length;e++){var a=0;for(var i=0;i<t.length;i++){if(t[i]!=k[e])a++;else break}if(a==t.length){k[e]=-1;B[e]=""}}for(var i=0;i<t.length;i++){var r=true;for(var e=0;e<k.length;e++){if(t[i]==k[e]){r=false;break}}if(r){for(var e=0;e<k.length;e++){if(k[e]==-1){k[e]=t[i];break}}}}}function R(t,e,a,i,r){t.save();t.strokeStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")";t.lineWidth=3;try{var s=e.x;var c=e.y;var n=e.x+e.width;var d=e.y+e.height;var o=a;var l=Math.PI/180;if(n-s-2*o<0){o=(n-s)/2}if(d-c-2*o<0){o=(d-c)/2}t.beginPath();t.moveTo(s+o,c);t.lineTo(n-o,c);t.arc(n-o,c+o,o,l*270,l*360,false);t.lineTo(n,d-o);t.arc(n-o,d-o,o,l*0,l*90,false);t.lineTo(s+o,d);t.arc(s+o,d-o,o,l*90,l*180,false);t.lineTo(s,c+o);t.arc(s+o,c+o,o,l*180,l*270,false);t.closePath();t.font="bold 11px opensans";t.fillStyle="#91ff4f";var f="";if(m[r]){f=m[r].name}t.fillText(f.toUpperCase(),s,c-5);t.stroke();t.restore()}catch(t){console.log("BAD VALUE OF DETECTION");console.log(t)}}function T(t){if(!t){var e=r.getContext("2d");e.drawImage(a,0,0,o.snapshotWidth,o.snapshotHeight);t=r.toDataURL("image/jpeg",1)}var i=new Image;i.onload=function(){var t=true;if(t){var e=w(r);E(e,i)}else{x(i.getAttribute("src"))}};i.src=t}function w(t,e){var i=[];var r=t.getContext("2d");r.drawImage(a,0,0,o.snapshotWidth,o.snapshotHeight);var s=t;var c=s.getContext("2d");var n=c.getImageData(0,0,o.snapshotWidth,o.snapshotHeight);p.set(n.data,0);h.submitRawImage(g,o.snapshotWidth,o.snapshotHeight);h.update();f.clearRect(0,0,l.width,l.height);var d=h.getIds();var m=JSON.parse(d);var v=m["ids"];A(v);if(v.length){for(var k=0;k<v.length;k++){var B=v[k];var X=h.getSmoothedFaceDetection(B);var _=h.faceDetectionIsPredicted(B);var C=[145,255,79,255];var b="";var S=h.isSlowMovement(B);if(!S)b="TOO FAST!!!";if(_)b="PREDICT";if(_||!S){C=[255,0,0,255]}var T=JSON.parse(JSON.stringify(X));T.x=X.x*o.trackingRatio;T.y=X.y*o.trackingRatio;T.width=X.width*o.trackingRatio;T.height=X.height*o.trackingRatio;R(f,T,10,C,B);if(u.indexOf(B)==-1){i.push({frameId:B,width:X.width,height:X.height,positionX:X.x,positionY:X.y})}}}if(!e){I()}return i}function I(){requestAnimationFrame(function(){requestAnimationFrame(function(){h.reset();f.clearRect(0,0,l.width,l.height)})})}function E(t,e){var a=false;if(t.length>0){for(i=0;i<t.length;i++){{var r=t[i];var s=document.createElement("canvas");s.setAttribute("width",100);s.setAttribute("height",100);var c=s.getContext("2d");var n=.6;var d=Math.max(0,r.positionX-r.width*n/2);var l=Math.max(0,r.positionY-r.height*n/2);var f=r.width+r.width*n;var u=r.height+r.height*n;if(d+f>o.snapshotWidth){d=o.snapshotWidth-f}if(l+u>o.snapshotHeight){l=o.snapshotHeight-u}var m=100;var h=100;var v=0;var g=0;c.drawImage(e,d,l,f,u,v,g,m,h);var p=s.toDataURL("image/jpeg");x(p,r.frameId);a=true}}}if(!a){x(e.src,false,true)}}function x(t,e,a){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var i=BX.create("div",{attrs:{class:"faceid-tracker-main-user-item faceid-tracker-first-item"}});i.innerHTML='<div class="faceid-tracker-main-user-photo"> \t\t\t\t\t<div class="faceid-tracker-main-user-photo-platform"> \t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> \t\t\t\t\t</div> \t\t\t\t\t<div class="faceid-tracker-main-user-photo-item"> \t\t\t\t\t\t<img width="100" height="100"> \t\t\t\t\t</div> \t\t\t\t\t<div class="faceid-tracker-main-user-photo-count"> \t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-count-item">58%</span> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count-info"> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count-info-desc"></div> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-item"></div> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t</div> \t\t\t\t<div class="faceid-tracker-main-user-info"> \t\t\t\t\t<div class="faceid-tracker-user-loader"> \t\t\t\t\t\t<div class="faceid-tracker-user-loader-item"> \t\t\t\t\t\t\t<div class="faceid-tracker-loader"> \t\t\t\t\t\t\t\t<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> \t\t\t\t\t\t\t\t\t<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> \t\t\t\t\t\t\t\t</svg> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t</div>';BX.prepend(i,BX("faceid-tracker-main-user-container"));var r=20;var s=BX.findChildren(BX("faceid-tracker-main-user-container"),{class:"faceid-tracker-main-user-item"});if(s.length>r){d=s[s.length-2].getAttribute("data-last-visit-ts");var c=s[s.length-1];c.remove()}var n=BX.findChild(i,{class:"faceid-tracker-main-user-photo-item"},true);var o=BX.findChild(n,{tag:"img"});o.setAttribute("src",t);if(a){BX.addClass(i,"faceid-tracker-user-warning");var l=BX.findChild(i,{class:"faceid-tracker-main-user-info"},true);l.innerHTML='<div class="faceid-tracker-main-user-info-name"> \t\t\t\t<div class="faceid-tracker-main-user-info-name-warning">'+BX.message("FACEID_TRACKER_CMP_JS_FACE_NOT_FOUND")+"</div> \t\t\t</div>"}else{var f=e>=0?e:"faceid-ajax-unique-"+Math.random();F(f);BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax.php",method:"POST",data:{action:"identify",image:t},dataType:"json",processData:false,start:true,onsuccess:function(a){M(f);var r=false;var s=BX.message("FACEID_TRACKER_CMP_JS_FACE_NOT_FOUND");if(a.length){var c=JSON.parse(a);if(c.visitor&&!N(c.visitor)){r=true;var n=c.visitor;n.image_src=n.shot_src;n.shot_src=t;var d=O(i,n);if(e>=0){m[e]={name:n.name}}if(d){H(n)}}else if(c.error&&c.error.msg){s=c.error.msg}if(c.status&&c.status.balance>=0){BX("faceid-credits-balance").innerText=c.status.balance}}if(!r){h.discardBestShot(e);BX.addClass(i,"faceid-tracker-user-warning");var o=BX.findChild(i,{class:"faceid-tracker-main-user-info"},true);o.innerHTML='<div class="faceid-tracker-main-user-info-name"> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-info-name-warning">'+s+"</div> \t\t\t\t\t\t</div>"}},onfailure:function(){M(f);h.discardBestShot(e)}})}}function F(t){u.push(t)}function M(t){var e=u.indexOf(t);if(e>-1){u.splice(e,1)}}function y(t,e){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var a=BX.create("div",{attrs:{class:"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=O(a,t);BX.prepend(a,BX("faceid-tracker-main-user-container"));if(t.last_visit_ts<d||d==null){d=t.last_visit_ts}if(i){H(t,e)}}function D(t,e){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var a=BX.create("div",{attrs:{class:"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=O(a,t);if(BX("faceid-tracker-main-user-more")){BX("faceid-tracker-main-user-container").insertBefore(a,BX("faceid-tracker-main-user-more"))}else{BX.append(a,BX("faceid-tracker-main-user-container"))}if(t.last_visit_ts<d||d==null){d=t.last_visit_ts}if(i){H(t,e)}}function H(t,e){e=typeof e!=="undefined"?e:true;BX("faceid-stats-current-count").innerText=parseInt(BX("faceid-stats-current-count").innerText)+1;if(e){if(t.visits_count<=1){BX("faceid-stats-new-count").innerText=parseInt(BX("faceid-stats-new-count").innerText)+1}else{BX("faceid-stats-old-count").innerText=parseInt(BX("faceid-stats-old-count").innerText)+1}BX("faceid-stats-total-count").innerText=parseInt(BX("faceid-stats-total-count").innerText)+1;if(t.crm_url.length){BX("faceid-stats-crm-count").innerText=parseInt(BX("faceid-stats-crm-count").innerText)+1}}}function O(t,e){var a=true;var i=typeof e=="string"?JSON.parse(e):e;t.setAttribute("data-visitor-id",i.visitor_id);var r=BX.findChildren(BX("faceid-tracker-main-user-container"),{attr:{"data-visitor-id":i.visitor_id}});if(r){var s;for(s in r){if(r[s]!=t){r[s].remove();a=false}}}if(i.confidence>0){BX.addClass(t,"faceid-tracker-photo")}if(i.crm_url.length>0){BX.addClass(t,"faceid-tracker-platform")}if(i.vk_id.length>0){BX.addClass(t,"faceid-tracker-social-state")}t.setAttribute("data-last-visit-ts",i.last_visit_ts);var c='<div class="faceid-tracker-main-user-photo"> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-platform"> \t\t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-item"> \t\t\t\t\t\t\t<img width="100" height="100"> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count"> \t\t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-count-item">'+i.confidence+'%</span> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count-info"> \t\t\t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count-info-desc">'+BX.message("FACEID_TRACKER_CMP_JS_FACE_ORIGINAL")+'</div> \t\t\t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+i.image_src+')"></div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t\t<div class="faceid-tracker-main-user-info"> \t\t\t\t\t\t<div class="faceid-tracker-main-user-info-description"> \t\t\t\t\t\t\t<span class="faceid-tracker-main-user-info-description-item">'+i.visit_info+'</span> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-info-name">';if(i.crm_url.length)c+='<a href="'+i.crm_url+'" class="faceid-tracker-main-user-info-name-item" target="_blank">'+i.name+"</a>";else c+='<div class="faceid-tracker-main-user-info-name-item">'+i.name+"</div>";c+='\t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-info-control">';if(!i.crm_url.length)c+='\t\t\t\t\t\t\t<div class="faceid-tracker-main-user-info-control-block'+(i.crm_url.length?" faceid-tracker-button-state":"")+'"> \t\t\t\t\t\t\t\t<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKER_CMP_JS_SAVE_CRM")+' \t\t\t\t\t\t\t\t\t<div class="faceid-tracker-user-loader"> \t\t\t\t\t\t\t\t\t\t<div class="faceid-tracker-user-loader-item"> \t\t\t\t\t\t\t\t\t\t\t<div class="faceid-tracker-loader"> \t\t\t\t\t\t\t\t\t\t\t\t<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> \t\t\t\t\t\t\t\t\t\t\t\t\t<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> \t\t\t\t\t\t\t\t\t\t\t\t</svg> \t\t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<div class="webform-small-button webform-small-button-transparent faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKER_CMP_JS_SAVE_CRM_DONE")+"</div> \t\t\t\t\t\t\t</div>";c+='\t\t\t\t\t\t\t<div class="faceid-tracker-main-user-info-control-social"> \t\t\t\t\t\t\t\t<span class="faceid-tracker-main-user-info-control-social-name">'+BX.message("FACEID_TRACKER_CMP_JS_VK_LINK")+"</span>";if(i.vk_id.length)c+='\t\t\t\t\t\t\t\t\t<a href="http://vk.com/'+BX.util.htmlspecialchars(i.vk_id)+'" class="faceid-tracker-main-user-info-control-social-item">'+"VK.com/"+BX.util.htmlspecialchars(i.vk_id)+"</a>";else if(faceTrackerSettings.socnet_enabled)c+='\t\t\t\t\t\t\t\t\t<span class="faceid-tracker-main-user-info-control-social-item"><span>'+BX.message("FACEID_TRACKER_CMP_JS_VK_LINK_ACTION")+"</span></span>";c+="\t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div> \t\t\t\t\t</div>";t.innerHTML=c;var n=BX.findChild(t,{class:"faceid-tracker-main-user-photo-item"},true);var d=BX.findChild(n,{tag:"img"});d.setAttribute("src",i.shot_src);if(!i.vk_id.length){var o=BX.clone(BX("faceid-tracker-profile-search-example"));o.id="";o.style.top=document.body.scrollTop+596+30+"px";var l=BX.findChild(t,{class:"faceid-tracker-main-user-info-control-social-item"},true);var f=BX.findChild(o,{class:"faceid-tracker-profile-search-header"},true);var u=0;var m=0;var h=function(t){var e=u-t.clientX;var a=m-t.clientY;o.style.left=parseInt(o.style.left)-e+"px";o.style.top=parseInt(o.style.top)-a+"px";u=t.clientX;m=t.clientY};var v=function(){BX.unbind(document,"mousemove",h);BX.unbind(document,"mouseup",v)};BX.bind(f,"mousedown",function(t){var e=BX.pos(o);o.style.left=e.left+"px";o.style.top=e.top+"px";u=t.clientX;m=t.clientY;o.style.transform="translate(0)";BX.bind(document,"mousemove",h);BX.bind(document,"mouseup",v)});document.body.appendChild(o);var g=BX.findChild(l,{tag:"span"});BX.bind(g,"click",function(){BX.show(o);if(o.getAttribute("data-in-progress")){return}o.setAttribute("data-in-progress","1");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"identify",image:i.shot_src,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(e){var a=JSON.parse(e);var r=a.items;if(a.status&&a.status.balance>=0){BX("faceid-credits-balance").innerText=a.status.balance}if(r.length){var s,c="";c=W(r[0],true);var n=BX.findChild(o,{class:"faceid-tracker-profile-search-main"},true);n.innerHTML=c+n.innerHTML;c="";r.splice(0,1);for(s in r){c+=W(r[s])}n=BX.findChild(o,{class:"faceid-tracker-profile-search-found-container"},true);n.innerHTML=c;var d=BX.findChild(o,{class:"faceid-tracker-profile-search-found-more-count"},true);d.innerHTML=r.length+" "+BX.message("FACEID_TRACKER_CMP_JS_VK_FOUND_PEOPLE");var f=BX.findChild(o,{class:"faceid-tracker-profile-search-loading"},true);BX.addClass(f,"faceid-tracker-animate-hidden");var u=BX.findChildren(o,{class:"faceid-tracker-main-user-info-control-button"},true);for(s in u){BX.bind(u[s],"click",function(){var e=BX(this).parentNode.parentNode;var a=BX.findChild(e,{class:"faceid-tracker-main-user-social-link-item"},true).innerText;var r=l.parentNode;l.remove();r.innerHTML+='<a href="http://'+a+'" class="faceid-tracker-main-user-info-control-social-item">'+a.replace("vk.com","VK.com")+"</a>";BX.addClass(t,"faceid-tracker-social-state");BX.hide(o);BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"save",vk_id:a.replace("vk.com/",""),visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(e){var a=JSON.parse(e);var r=BX.findChild(t,{class:"faceid-tracker-main-user-info-name"},true);r.innerHTML='<a href="'+a.url+'" class="faceid-tracker-main-user-info-name-item">'+i.name+"</a>"}})})}}else if(a.error&&a.error.msg){var f=BX.findChild(o,{class:"faceid-tracker-loader"},true);BX.hide(f);var m=BX.findChild(o,{class:"faceid-tracker-profile-search-loading-desc"},true);BX.hide(m);var h=BX.findChild(o,{class:"faceid-tracker-error"},true);h.innerHTML=a.error.msg;BX.show(h)}}})});var p=BX.findChild(o,{class:"faceid-tracker-header-description-close-item"},true);BX.bind(p,"click",function(){BX.hide(o)})}var k=BX.findChild(t,{class:"webform-small-button-blue"},true);BX.bind(k,"click",function(){var e=BX(this).parentNode;if(!BX.hasClass(e,"faceid-tracker-button-state")&&!BX.hasClass(e,"faceid-control-loader-state")){BX.addClass(e,"faceid-control-loader-state");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_crm.php",method:"POST",data:{action:"addLead",lead_title:i.name,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(a){var r=JSON.parse(a);var s=BX.findChild(t,{class:"faceid-tracker-main-user-info-name"},true);s.innerHTML='<a href="'+r.url+'" class="faceid-tracker-main-user-info-name-item" target="_blank">'+i.name+"</a>";BX.removeClass(e,".faceid-control-loader-state");BX.addClass(e,"faceid-tracker-button-state")}})}});return a}function W(t,e){var a='<div class="faceid-tracker-main-user-item faceid-tracker-profile-search-found faceid-tracker-photo'+(e?" faceid-tracker-found-user":"")+'"> \t\t\t\t\t<div class="faceid-tracker-main-user-photo"> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-platform"> \t\t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+BX.util.htmlspecialchars(t.photo)+')"></div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-photo-count"> \t\t\t\t\t\t\t<span class="faceid-tracker-main-user-photo-count-item">'+Math.round(t.confidence*100)+'%</span> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t\t<div class="faceid-tracker-main-user-info"> \t\t\t\t\t\t<div class="faceid-tracker-main-user-info-name"> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-info-name-item">'+BX.util.htmlspecialchars(t.name)+'</div> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-date"> \t\t\t\t\t\t\t\t<span class="faceid-tracker-main-user-date-item">'+BX.util.htmlspecialchars(t.personal)+'</span> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="faceid-tracker-main-user-social-link"> \t\t\t\t\t\t\t\t<a href="http://vk.com/'+BX.util.htmlspecialchars(t.id)+'" class="faceid-tracker-main-user-social-link-item">vk.com/'+BX.util.htmlspecialchars(t.id)+'</a> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="faceid-tracker-main-user-info-control"> \t\t\t\t\t\t\t<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button '+(e?"":"faceid-tracker-search-button")+'">'+BX.message("FACEID_TRACKER_CMP_JS_VK_SELECT")+"</div> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t</div>";return a}BX.ready(function(){BX.bind(BX("faceid-tracker-main-user-more"),"click",function(){if(!d){return}BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_more.php",method:"POST",data:{last:d},dataType:"json",processData:false,start:true,onsuccess:function(t){var e,a=JSON.parse(t);if(a.items.length){for(e in a.items){D(a.items[e],false)}}if(a.more==0){BX("faceid-tracker-main-user-more").remove()}}})});BX.bind(BX("faceid-tracker-header-description-close"),"click",function(){BX.localStorage.set("faceid-description-read","1",3600*24*360);BX(this).parentNode.remove()});if(!BX.localStorage.get("faceid-description-read")){BX.show(BX("faceid-tracker-header-description-close").parentNode)}BX.bind(BX("faceid-auto-identify"),"change",function(){if(!BX(this).checked){I()}})});function N(t){if(t.hasOwnProperty("length"))return t.length==0;for(var e in t){if(t.hasOwnProperty(e))return false}return JSON.stringify(t)===JSON.stringify({})}BX.bind(BX("faceid-fullscreen-button"),"click",function(){var t=a;var e=BX.findParent(t,{class:"faceid-tracker-wrapper"});var i=BX("faceid-video").parentNode;if(BX.getFullScreenElement()){BX.cancelFullScreen()}else{BX.requestFullScreen(i)}});BX.bind(document,"fullscreenchange",function(){var t=BX.findParent(a,{class:"faceid-tracker-wrapper"});var e=BX("faceid-fullscreen-button");BX.toggleClass(t,"faceid-tracker-full-mode");BX.toggleClass(e,"faceid-tracker-sidebar-photo-full-mode");BX.toggleClass(e,"faceid-tracker-sidebar-photo-fullback-mode");if(!BX.getFullScreenElement()){o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio}else{o.cameraWidth=o.cameraFullWidth;o.cameraHeight=o.cameraFullHeight;o.trackingRatio=o.trackingFullRatio}a.setAttribute("width",o.cameraWidth);a.setAttribute("height",o.cameraHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight)})}
//# sourceMappingURL=script.map.js