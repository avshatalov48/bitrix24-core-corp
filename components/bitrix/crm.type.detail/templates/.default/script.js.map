{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { Router } from 'crm.router';\nimport { ToolbarComponent } from 'crm.toolbar-component';\nimport { CustomSection, TypeModel, TypeModelData } from 'crm.type-model';\nimport { Dom, Event, Loc, Reflection, Tag, Text, Type, Uri } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { TagSelector } from 'ui.entity-selector';\n\ndeclare type Preset = {\n\tfields: {\n\t\tid: string,\n\t\ttitle: string,\n\t\tcategory: string,\n\t\tdescription: string,\n\t\ticon: string,\n\t},\n\tdata: TypeModelData\n}\n\ndeclare type Relation = {\n\ttitle: string,\n\tisChecked: boolean,\n\tentityTypeId: number,\n\tisChildrenListEnabled: boolean,\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nlet instance: TypeDetail = null;\n\n/**\n * @memberOf BX.Crm.Component\n */\nclass TypeDetail\n{\n\tform;\n\ttype: TypeModel;\n\tisProgress: boolean = false;\n\tcontainer: Element;\n\terrorsContainer: Element;\n\tisNew: boolean;\n\ttabs: Map<string, Element> = new Map();\n\tpresets: Array;\n\tselectedPresetId: ?string;\n\trelations: {\n\t\tparent: Relation[],\n\t\tchild: Relation[],\n\t};\n\n\tparentRelationsController: RelationsController;\n\tchildRelationsController: RelationsController;\n\tcustomSectionController: ?CustomSectionsController;\n\tisRestricted: boolean = false;\n\trestrictionErrorMessage: string;\n\trestrictionSliderCode: ?string;\n\tisExternal: boolean = false;\n\tisSaveFromTypeDetail: boolean = true;\n\tisCreateSectionsViaAutomatedSolutionDetails: boolean = false;\n\tcanEditAutomatedSolution: boolean = false;\n\n\t#isCancelEventRegistered: boolean = false;\n\n\tconstructor(params: {\n\t\tform: Element,\n\t\ttype: TypeModel,\n\t\tcontainer: Element,\n\t\terrorsContainer: Element,\n\t\tpresets?: Array,\n\t\trelations: {\n\t\t\tparent: Relation[],\n\t\t\tchild: Relation[],\n\t\t},\n\t\tisCreateSectionsViaAutomatedSolutionDetails: boolean,\n\t\tisExternal: boolean,\n\t\tisRestricted: boolean,\n\t\trestrictionErrorMessage: string,\n\t\trestrictionSliderCode: ?string,\n\t\tcanEditAutomatedSolution: boolean,\n    })\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.type = params.type;\n\t\t\tthis.isNew = !this.type.isSaved();\n\t\t\tthis.form = params.form;\n\t\t\tthis.container = params.container;\n\t\t\tthis.errorsContainer = params.errorsContainer;\n\t\t\tthis.presets = params.presets;\n\t\t\tthis.relations = params.relations;\n\t\t\tthis.isRestricted = Boolean(params.isRestricted);\n\t\t\tthis.restrictionErrorMessage = Type.isStringFilled(params.restrictionErrorMessage) ? params.restrictionErrorMessage : '';\n\t\t\tthis.restrictionSliderCode = Type.isStringFilled(params.restrictionSliderCode) && this.isRestricted\n\t\t\t\t? params.restrictionSliderCode\n\t\t\t\t: null\n\t\t\t;\n\t\t\tthis.isExternal = Boolean(params.isExternal);\n\t\t\tthis.isCreateSectionsViaAutomatedSolutionDetails = Boolean(params.isCreateSectionsViaAutomatedSolutionDetails);\n\t\t\tthis.canEditAutomatedSolution = Boolean(params.canEditAutomatedSolution);\n\t\t}\n\n\t\tthis.buttonsPanel = document.getElementById('ui-button-panel');\n\t\tthis.saveButton = document.getElementById('ui-button-panel-save');\n\t\tthis.cancelButton = document.getElementById('ui-button-panel-cancel');\n\t\tthis.deleteButton = document.getElementById('ui-button-panel-remove');\n\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tinstance = this;\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\n\t\tthis.fillTabs();\n\n\t\tif (this.type.getId())\n\t\t{\n\t\t\t// const customPreset = this.getPresetById('bitrix:empty');\n\t\t\t// const presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\t\t// if (customPreset && presetSelector)\n\t\t\t// {\n\t\t\t// \tpresetSelector.textContent = customPreset.fields.title;\n\t\t\t// }\n\t\t\tthis.disablePresetsView();\n\t\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\t\tif (presetSelectorContainer)\n\t\t\t{\n\t\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enablePresetsView();\n\t\t}\n\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-hidden');\n\n\t\tthis.initRelations();\n\n\t\tthis.initCustomSections();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEvent.bind(this.saveButton, 'click', (event) => {\n\t\t\tthis.save(event);\n\t\t}, {\n\t\t\tpassive: false,\n\t\t});\n\n\t\tif (this.deleteButton)\n\t\t{\n\t\t\tEvent.bind(this.deleteButton, 'click', (event) => {\n\t\t\t\tthis.delete(event);\n\t\t\t});\n\t\t}\n\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (userFieldOption)\n\t\t{\n\t\t\tEvent.bind(userFieldOption, 'click', this.disableLinkedUserFieldsIfNotAvailable.bind(this));\n\t\t}\n\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tEvent.bind(linkedUserFieldNode, 'click', this.enableUserFieldIfAnyLinkedChecked.bind(this));\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onCloseByEsc', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getData();\n\t\t\tconst slider: BX.SidePanel.Slider = sliderEvent.getSlider();\n\n\t\t\tif (slider === this.getSlider())\n\t\t\t{\n\t\t\t\tthis.#registerCancelEvent(Dictionary.ELEMENT_ESC_BUTTON);\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getData();\n\t\t\tconst slider: BX.SidePanel.Slider = sliderEvent.getSlider();\n\n\t\t\tif (slider === this.getSlider())\n\t\t\t{\n\t\t\t\tthis.#registerCancelEvent(null);\n\t\t\t}\n\t\t});\n\n\t\tthis.handleSliderDestroy = this.handleSliderDestroy.bind(this);\n\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t}\n\n\thandleSliderDestroy(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider: BX.SidePanel.Slider = sliderEvent.getSlider();\n\n\t\tif (slider.getFrameWindow() === window)\n\t\t{\n\t\t\t// if we add event handler from iframe to the main page, they will live forever, even after slider destroys\n\t\t\t// sometimes it causes errors, like in this case\n\t\t\tthis.destroy();\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\t#registerCancelEvent(element: ?string): void\n\t{\n\t\tif (this.#isCancelEventRegistered)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isCancelEventRegistered = true;\n\n\t\tsendAnalyticsData(\n\t\t\tthis.#getAnalyticsBuilder()\n\t\t\t\t.setElement(element)\n\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t.buildData()\n\t\t\t,\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.customSectionController?.destroy();\n\t}\n\n\tenablePresetsView()\n\t{\n\t\tDom.addClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst activeTab = this.container.querySelector('.crm-type-tab-current');\n\t\tif (activeTab)\n\t\t{\n\t\t\tDom.removeClass(activeTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetsTab = this.container.querySelector('[data-tab=\"presets\"]');\n\t\tif (presetsTab)\n\t\t{\n\t\t\tDom.addClass(presetsTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.removeClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.addClass(this.buttonsPanel, 'crm-type-hidden');\n\t\tthis.hideErrors();\n\t}\n\n\tdisablePresetsView()\n\t{\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-settings-presets');\n\n\t\t(this.#findActiveTabButton() ?? this.#findFirstTabButton()).click();\n\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.removeClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.addClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.removeClass(this.buttonsPanel, 'crm-type-hidden');\n\t}\n\n\t#findActiveTabButton(): ?HTMLElement\n\t{\n\t\treturn document.querySelector('.ui-sidepanel-menu-item.ui-sidepanel-menu-active > [data-role^=tab-]');\n\t}\n\n\t#findFirstTabButton(): HTMLElement\n\t{\n\t\treturn document.querySelector('.ui-sidepanel-menu-item > [data-role^=tab-]');\n\t}\n\n\tdisableLinkedUserFieldsIfNotAvailable()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tthis.setBooleanFieldCheckedState(linkedUserFieldNode, false);\n\t\t\t});\n\t\t}\n\t}\n\n\tenableUserFieldIfAnyLinkedChecked()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tif (this.isBooleanFieldChecked(linkedUserFieldNode))\n\t\t\t\t{\n\t\t\t\t\tthis.setBooleanFieldCheckedState(userFieldOption, true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({ size: 150 });\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress(): void\n\t{\n\t\tthis.isProgress = true;\n\t\tif (!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.form);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() => {\n\t\t\tDom.removeClass(this.saveButton, 'ui-btn-wait');\n\t\t\tDom.removeClass(this.cancelButton, 'ui-btn-wait');\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.deleteButton, 'ui-btn-wait');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tsave(event)\n\t{\n\t\tif (this.isRestricted)\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isStringFilled(this.restrictionSliderCode)\n\t\t\t\t&& Reflection.getClass('BX.UI.InfoHelper.show')\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(this.restrictionSliderCode);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showErrors([this.restrictionErrorMessage]);\n\t\t\t}\n\n\t\t\tthis.stopProgress();\n\n\t\t\treturn;\n\t\t}\n\t\tevent.preventDefault();\n\t\tif (!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\n\t\tthis.type.setTitle(this.form.querySelector('[name=\"title\"]').value);\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst fieldNode = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (fieldNode)\n\t\t\t{\n\t\t\t\tthis.type.data[fieldName] = this.isBooleanFieldChecked(fieldNode);\n\t\t\t}\n\t\t});\n\t\t// this.type.setConversionMap({\n\t\t// \tsourceTypes: this.collectEntityTypeIds('conversion-source'),\n\t\t// \tdestinationTypes: this.collectEntityTypeIds('conversion-destination'),\n\t\t// });\n\t\tconst linkedUserFields = {};\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tconst name = linkedUserFieldNode.dataset.name.slice('linkedUserFields['.length).replace(']', '');\n\t\t\tlinkedUserFields[name] = this.isBooleanFieldChecked(linkedUserFieldNode);\n\t\t});\n\t\tthis.type.setLinkedUserFields(linkedUserFields);\n\t\tthis.type.setRelations({\n\t\t\tparent: this.parentRelationsController.getData(),\n\t\t\tchild: this.childRelationsController.getData(),\n\t\t});\n\t\tif (this.customSectionController)\n\t\t{\n\t\t\tconst customSectionData = this.customSectionController.getData();\n\t\t\tthis.type.setCustomSectionId(customSectionData.customSectionId);\n\t\t\tthis.type.setCustomSections(customSectionData.customSections);\n\t\t\tthis.type.setIsExternalDynamicalType(this.isExternal);\n\t\t\tthis.type.setIsSaveFromTypeDetail(this.isSaveFromTypeDetail);\n\t\t}\n\n\t\tconst analyticsBuilder = this.#getAnalyticsBuilder()\n\t\t\t.setElement(Dictionary.ELEMENT_CREATE_BUTTON)\n\t\t;\n\n\t\tsendAnalyticsData(\n\t\t\tanalyticsBuilder\n\t\t\t\t.setStatus(Dictionary.STATUS_ATTEMPT)\n\t\t\t\t.buildData()\n\t\t\t,\n\t\t);\n\n\t\tthis.type.save().then((response) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tanalyticsBuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t.setId(this.type.getId())\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\tthis.#isCancelEventRegistered = true;\n\n\t\t\tthis.stopProgress();\n\t\t\tthis.afterSave(response);\n\t\t\tthis.isNew = false;\n\t\t}).catch((errors) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tanalyticsBuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_ERROR)\n\t\t\t\t\t.setId(this.type.getId())\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n\t}\n\n\t#getAnalyticsBuilder(): Builder.Automation.Type.CreateEvent | Builder.Automation.Type.EditEvent\n\t{\n\t\tconst builder = this.isNew\n\t\t\t? new Builder.Automation.Type.CreateEvent()\n\t\t\t: new Builder.Automation.Type.EditEvent()\n\t\t;\n\n\t\tbuilder.setIsExternal(this.isExternal);\n\n\t\tif (Type.isStringFilled(this.selectedPresetId))\n\t\t{\n\t\t\tbuilder.setPreset(this.selectedPresetId);\n\t\t}\n\n\t\tif (this.type.getId() > 0)\n\t\t{\n\t\t\tbuilder.setId(this.type.getId());\n\t\t}\n\n\t\tconst currentUrl = new Uri(decodeURI(window.location.href));\n\t\tif (currentUrl.getQueryParam('c_sub_section') && builder instanceof Builder.Automation.Type.EditEvent)\n\t\t{\n\t\t\tbuilder.setSubSection(currentUrl.getQueryParam('c_sub_section'));\n\t\t}\n\n\t\treturn builder;\n\t}\n\n\tcollectEntityTypeIds(role: string): []\n\t{\n\t\tconst entityTypeIds = [];\n\n\t\tconst checkboxes = this.container.querySelectorAll(`[data-role=\"${role}\"]`);\n\t\t[...checkboxes].forEach((checkbox: HTMLInputElement) => {\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tentityTypeIds.push(checkbox.dataset.entityTypeId);\n\t\t\t}\n\t\t});\n\n\t\treturn entityTypeIds;\n\t}\n\n\tafterSave(response: {data: {}})\n\t{\n\t\tthis.addDataToSlider('response', response);\n\n\t\tif (Object.hasOwn(response.data, 'urlTemplates'))\n\t\t{\n\t\t\tRouter.Instance.setUrlTemplates(response.data.urlTemplates);\n\t\t}\n\n\t\tthis.getSlider()?.close();\n\n\t\tthis.emitTypeUpdatedEvent({\n\t\t\tisUrlChanged: (response.data.isUrlChanged === true),\n\t\t});\n\t}\n\n\tgetSlider(): ?BX.SidePanel.Slider\n\t{\n\t\treturn BX.SidePanel?.Instance?.getSliderByWindow(window);\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tToolbarComponent.Instance.emitTypeUpdatedEvent(data);\n\t}\n\n\taddDataToSlider(key, data)\n\t{\n\t\tif (Type.isString(key) && Type.isPlainObject(data))\n\t\t{\n\t\t\tconst slider = this.getSlider();\n\t\t\tif (slider)\n\t\t\t{\n\t\t\t\tslider.data.set(key, data);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext += message;\n\t\t});\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tDom.style(this.errorsContainer.parentNode, 'display', 'block');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors()\n\t{\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tDom.style(this.errorsContainer.parentNode, 'display', 'none');\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t}\n\t}\n\n\tdelete(event)\n\t{\n\t\tevent.preventDefault();\n\t\tif (!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUrl = new Uri(decodeURI(window.location.href));\n\n\t\tconst analyticsBuilder = (new Builder.Automation.Type.DeleteEvent())\n\t\t\t.setElement(Dictionary.ELEMENT_DELETE_BUTTON)\n\t\t\t.setIsExternal(this.isExternal)\n\t\t\t.setSubSection(currentUrl.getQueryParam('c_sub_section'))\n\t\t\t.setId(this.type.getId())\n\t\t;\n\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('CRM_TYPE_DETAIL_DELETE_CONFIRM'),\n\t\t\t() => {\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\tsendAnalyticsData(\n\t\t\t\t\t\tanalyticsBuilder\n\t\t\t\t\t\t\t.setStatus(Dictionary.STATUS_ATTEMPT)\n\t\t\t\t\t\t\t.buildData()\n\t\t\t\t\t\t,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.startProgress();\n\t\t\t\t\tthis.type.delete().then((response) => {\n\t\t\t\t\t\tsendAnalyticsData(\n\t\t\t\t\t\t\tanalyticsBuilder\n\t\t\t\t\t\t\t\t.setStatus(Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t\t\t\t.buildData()\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.#isCancelEventRegistered = true;\n\n\t\t\t\t\t\tthis.stopProgress();\n\n\t\t\t\t\t\tconst isUrlChanged = (Type.isObject(response.data) && (response.data.isUrlChanged === true));\n\t\t\t\t\t\tthis.emitTypeUpdatedEvent({ isUrlChanged });\n\n\t\t\t\t\t\tRouter.Instance.closeSliderOrRedirect(Router.Instance.getTypeListUrl());\n\t\t\t\t\t}).catch((errors: string[]) => {\n\t\t\t\t\t\tsendAnalyticsData(\n\t\t\t\t\t\t\tanalyticsBuilder\n\t\t\t\t\t\t\t\t.setStatus(Dictionary.STATUS_ERROR)\n\t\t\t\t\t\t\t\t.buildData()\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.showErrors(errors);\n\t\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tnull,\n\t\t\t(box) => {\n\t\t\t\tsendAnalyticsData(\n\t\t\t\t\tanalyticsBuilder\n\t\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t\t.buildData()\n\t\t\t\t\t,\n\t\t\t\t);\n\n\t\t\t\tthis.stopProgress();\n\t\t\t\tbox.close();\n\t\t\t},\n\t\t);\n\t}\n\n\tfillTabs()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tthis.container.querySelectorAll('.crm-type-tab').forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif (tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\t[...this.tabs.keys()].forEach((tabName: string) => {\n\t\t\tif (tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tDom.addClass(this.tabs.get(tabName), 'crm-type-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.tabs.get(tabName), 'crm-type-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyPreset(presetId: string)\n\t{\n\t\tthis.disablePresetsView();\n\t\tconst presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\tconst currentPresetNode = this.container.querySelector('[data-role=\"preset\"].crm-type-preset-active');\n\t\tif (currentPresetNode)\n\t\t{\n\t\t\tconst currentPreset = this.getPresetById(currentPresetNode.dataset.presetId);\n\t\t\tif (\n\t\t\t\tcurrentPreset\n\t\t\t\t&& currentPreset.data.title\n\t\t\t\t&& this.form.querySelector('[name=\"title\"]').value === currentPreset.data.title)\n\t\t\t{\n\t\t\t\tthis.form.querySelector('[name=\"title\"]').value = '';\n\t\t\t}\n\t\t}\n\t\tconst presets = this.container.querySelectorAll('[data-role=\"preset\"]');\n\t\tpresets.forEach((presetNode: HTMLDivElement) => {\n\t\t\tDom.removeClass(presetNode, 'crm-type-preset-active');\n\t\t\tif (presetNode.dataset.presetId === presetId)\n\t\t\t{\n\t\t\t\tDom.addClass(presetNode, 'crm-type-preset-active');\n\t\t\t\tconst preset = this.getPresetById(presetId);\n\t\t\t\tif (preset)\n\t\t\t\t{\n\t\t\t\t\tthis.updateInputs(preset.data);\n\t\t\t\t\tif (presetSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tpresetSelector.textContent = Text.encode(preset.fields.title);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.selectedPresetId = presetId;\n\t}\n\n\tgetPresetById(presetId: string)\n\t{\n\t\tfor (const preset: Preset of this.presets)\n\t\t{\n\t\t\tif (preset.fields.id === presetId)\n\t\t\t{\n\t\t\t\treturn preset;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tupdateInputs(data: TypeModelData)\n\t{\n\t\tif (this.form.querySelector('[name=\"title\"]').value.length <= 0)\n\t\t{\n\t\t\tthis.form.querySelector('[name=\"title\"]').value = data.title || '';\n\t\t}\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tthis.setBooleanFieldCheckedState(node, data[fieldName]);\n\t\t\t}\n\t\t});\n\t\tthis.disableLinkedUserFieldsIfNotAvailable();\n\t}\n\n\ttoggleBooleanField(fieldName: string): void\n\t{\n\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = !node.checked;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tgetBooleanFieldNodeByName(fieldName: string): ?HTMLDivElement | HTMLInputElement\n\t{\n\t\treturn this.container.querySelector(`[data-name=\"${fieldName}\"]`);\n\t}\n\n\tisBooleanFieldChecked(node: HTMLDivElement | HTMLInputElement): boolean\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\treturn node.checked;\n\t\t}\n\n\t\treturn Dom.hasClass(node, 'crm-type-field-button-item-active');\n\t}\n\n\tsetBooleanFieldCheckedState(node: HTMLDivElement | HTMLInputElement, isChecked: boolean): void\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tnode.checked = isChecked;\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isChecked)\n\t\t{\n\t\t\tDom.addClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tinitRelations(): void\n\t{\n\t\tthis.parentRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-parent-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationParentShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.parent,\n\t\t});\n\n\t\tthis.childRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-child-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationChildShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.child,\n\t\t});\n\t}\n\n\tinitCustomSections()\n\t{\n\t\tthis.customSectionController = new CustomSectionsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-custom-section-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-custom-section-container\"]'),\n\t\t\tselectorContainer: this.container.querySelector('[data-role=\"crm-type-custom-section-selector\"]'),\n\t\t\tcustomSections: this.type.getCustomSections() || [],\n\t\t\tisCreateSectionsViaAutomatedSolutionDetails: this.isCreateSectionsViaAutomatedSolutionDetails,\n\t\t\tcanEditAutomatedSolution: this.canEditAutomatedSolution,\n\t\t});\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.showTab(tabName);\n\t\t}\n\t}\n\n\tstatic handlePresetClick(presetId: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.applyPreset(presetId);\n\t\t}\n\t}\n\n\tstatic handleHideDescriptionClick(target: HTMLDivElement)\n\t{\n\t\tDom.style(target.parentNode, 'display', 'none');\n\t}\n\n\tstatic handleBooleanFieldClick(fieldName: string)\n\t{\n\t\tinstance?.toggleBooleanField(fieldName);\n\t}\n\n\tstatic handlePresetSelectorClick()\n\t{\n\t\tinstance?.enablePresetsView();\n\t}\n\n\tstatic handleCancelButtonClick()\n\t{\n\t\t// if we just add click event handler to cancel button node, that handler will be called after slider close\n\t\t// to capture click before that, we need to add handler directly to markup\n\t\tinstance?.#registerCancelEvent(Dictionary.ELEMENT_CANCEL_BUTTON);\n\t}\n}\n\nnamespace.TypeDetail = TypeDetail;\n\nclass RelationsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\ttypeSelectorContainer: HTMLDivElement;\n\ttabsContainer: HTMLDivElement;\n\ttabsCheckbox: HTMLInputElement;\n\ttabsSelectorContainer: HTMLDivElement;\n\trelations: Relation[];\n\ttypeSelector: TagSelector;\n\ttabsSelector: TagSelector;\n\n\tconstructor(options)\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.typeSelectorContainer = options.typeSelectorContainer;\n\t\tthis.tabsContainer = options.tabsContainer;\n\t\tthis.tabsCheckbox = options.tabsCheckbox;\n\t\tthis.tabsSelectorContainer = options.tabsSelectorContainer;\n\t\tthis.relations = options.relations;\n\n\t\tthis.initSelectors();\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelectors()\n\t{\n\t\tconst unselectedTypes = [];\n\t\tconst selectedTypes = [];\n\t\tconst unselectedTabs = [];\n\t\tconst selectedTabs = [];\n\t\tthis.relations.forEach((relation: Relation) => {\n\t\t\tconst item = {\n\t\t\t\tid: relation.entityTypeId,\n\t\t\t\tentityId: 'crmType',\n\t\t\t\ttitle: relation.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tif (relation.isChecked)\n\t\t\t{\n\t\t\t\tselectedTypes.push(item);\n\n\t\t\t\tif (relation.isChildrenListEnabled)\n\t\t\t\t{\n\t\t\t\t\tselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tunselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectedTypes.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.typeSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTypes,\n\t\t\t\tselectedItems: selectedTypes,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: this.adjust.bind(this),\n\t\t\t\tonAfterTagRemove: this.adjust.bind(this),\n\t\t\t},\n\t\t});\n\t\tthis.typeSelector.renderTo(this.typeSelectorContainer);\n\n\t\tthis.tabsSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTabs,\n\t\t\t\tselectedItems: selectedTabs,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t});\n\t\tthis.tabsSelector.renderTo(this.tabsSelectorContainer);\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t\tthis.tabsCheckbox.checked = this.tabsSelector.getDialog().getSelectedItems().length > 0;\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t\tEvent.bind(this.tabsCheckbox, 'click', this.adjust.bind(this));\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tDom.removeClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tif (this.tabsCheckbox.checked)\n\t\t{\n\t\t\tDom.removeClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tthis.tabsSelector.getDialog().getItems().forEach((item) => {\n\t\t\tif (!this.isItemSelected(item, selectedTypes))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.tabsSelector.getDialog().removeItem(item);\n\t\t\t\tthis.tabsSelector.removeTag({\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tselectedTypes.forEach((item) => {\n\t\t\tconst itemData = {\n\t\t\t\tid: item.getId(),\n\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\ttitle: item.getTitle(),\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tconst tabItem = this.tabsSelector.getDialog().getItem(itemData);\n\t\t\tif (!tabItem)\n\t\t\t{\n\t\t\t\tconst newItem = this.tabsSelector.getDialog().addItem(itemData);\n\t\t\t\tnewItem.select();\n\t\t\t}\n\t\t});\n\t}\n\n\tisItemSelected(item, selectedItems: Array): boolean\n\t{\n\t\treturn selectedItems.some((selectedItem) => {\n\t\t\treturn item.id === selectedItem.id;\n\t\t});\n\t}\n\n\tgetData(): Array\n\t{\n\t\tconst data = [];\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tconst isTabsCheckboxChecked = this.tabsCheckbox.checked;\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tselectedTypes.forEach((selectedType) => {\n\t\t\tconst type = {\n\t\t\t\tentityTypeId: selectedType.getId(),\n\t\t\t\tisChildrenListEnabled: false,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tisTabsCheckboxChecked\n\t\t\t\t&& this.isItemSelected(selectedType, this.tabsSelector.getDialog().getSelectedItems())\n\t\t\t)\n\t\t\t{\n\t\t\t\ttype.isChildrenListEnabled = true;\n\t\t\t}\n\t\t\tdata.push(type);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\tselectorContainer: HTMLDivElement;\n\tcustomSections: CustomSection[];\n\tselector: TagSelector;\n\tsettingsContainer: HTMLDivElement;\n\tsectionsListContainer: HTMLDivElement;\n\tsaveButton: Element;\n\tcancelButton: Element;\n\taddSectionItemButton: Element;\n\tisCreateSectionsViaAutomatedSolutionDetails: false;\n\tcanEditAutomatedSolution: false;\n\n\tconstructor(options: {\n\t\tswitcher: {},\n\t\tcontainer: Element,\n\t\tselectorContainer: Element,\n\t\tcustomSections?: CustomSection[],\n\t\tisCreateSectionsViaAutomatedSolutionDetails: boolean,\n\t\tcanEditAutomatedSolution: boolean,\n\t})\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.selectorContainer = options.selectorContainer;\n\t\tif (Type.isArray(options.customSections))\n\t\t{\n\t\t\tthis.customSections = options.customSections;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections = [];\n\t\t}\n\n\t\tif (Type.isBoolean(options.isCreateSectionsViaAutomatedSolutionDetails))\n\t\t{\n\t\t\tthis.isCreateSectionsViaAutomatedSolutionDetails = options.isCreateSectionsViaAutomatedSolutionDetails;\n\t\t}\n\n\t\tif (Type.isBoolean(options.canEditAutomatedSolution))\n\t\t{\n\t\t\tthis.canEditAutomatedSolution = options.canEditAutomatedSolution;\n\t\t}\n\n\t\tthis.initSelector();\n\n\t\tthis.settingsContainer = Tag.render`\n\t\t\t<div class=\"crm-type-hidden crm-type-custom-sections-settings-container\">\n\t\t\t\t<div class=\"crm-type-relation-subtitle\">${Loc.getMessage('CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST_MSGVER_1')}</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.container.append(this.settingsContainer);\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unbindEvents();\n\t\tthis.selector?.unsubscribeAll();\n\t}\n\n\tinitSelector()\n\t{\n\t\tconst items = [];\n\t\tconst selectedItems = [];\n\n\t\tthis.customSections.forEach((section) => {\n\t\t\tconst item = {\n\t\t\t\tid: section.id,\n\t\t\t\tentityId: 'custom-section',\n\t\t\t\ttitle: section.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\n\t\t\titems.push(item);\n\n\t\t\tif (section.isSelected)\n\t\t\t{\n\t\t\t\tselectedItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\tconst tagSelectorOptions = {\n\t\t\tmultiple: false,\n\t\t\tdialogOptions: {\n\t\t\t\titems,\n\t\t\t\tselectedItems,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t};\n\n\t\tif (this.isCreateSectionsViaAutomatedSolutionDetails)\n\t\t{\n\t\t\ttagSelectorOptions.showCreateButton = false;\n\t\t\ttagSelectorOptions.dialogOptions.footer = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\tonclick=\"${this.onOpenAutomatedSolutionCreationSliderClick.bind(this)}\"\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t>${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}</a>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttagSelectorOptions.showCreateButton = true;\n\t\t\ttagSelectorOptions.createButtonCaption = Loc.getMessage('CRM_COMMON_ACTION_CONFIG');\n\t\t\ttagSelectorOptions.events = {\n\t\t\t\tonCreateButtonClick: this.onCreateButtonClick.bind(this),\n\t\t\t};\n\t\t}\n\n\t\tif (!this.canEditAutomatedSolution)\n\t\t{\n\t\t\ttagSelectorOptions.locked = true;\n\t\t}\n\n\t\tthis.selector = new TagSelector(tagSelectorOptions);\n\t\tthis.selector.renderTo(this.selectorContainer);\n\t}\n\n\treInitSelector()\n\t{\n\t\tthis.selector.getDialog().destroy();\n\t\tthis.selector.unsubscribeAll();\n\t\tthis.selector = null;\n\t\tDom.clean(this.selectorContainer);\n\t\tthis.initSelector();\n\t}\n\n\tshowSelector()\n\t{\n\t\tDom.removeClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\thideSelector()\n\t{\n\t\tDom.addClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedSection = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedSection.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.adjust = this.adjust.bind(this);\n\t\tthis.onAutomatedSolutionUpdate = this.onAutomatedSolutionUpdate.bind(this);\n\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust);\n\t\tif (this.isCreateSectionsViaAutomatedSolutionDetails)\n\t\t{\n\t\t\tToolbarComponent.Instance.subscribeAutomatedSolutionUpdatedEvent(\n\t\t\t\tthis.onAutomatedSolutionUpdate,\n\t\t\t);\n\t\t}\n\t}\n\n\tunbindEvents()\n\t{\n\t\tEventEmitter.unsubscribe(this.switcher, 'toggled', this.adjust);\n\t\tToolbarComponent.Instance.unsubscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate);\n\t}\n\n\tonAutomatedSolutionUpdate(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.getData().intranetCustomSectionId);\n\t\tconst title = String(event.getData().title);\n\n\t\tif (id <= 0 || !Type.isStringFilled(title))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentCustomSection = this.customSections.find(\n\t\t\t(section) => Text.toInteger(section.id) === id,\n\t\t);\n\n\t\tif (currentCustomSection)\n\t\t{\n\t\t\tcurrentCustomSection.title = title;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections.push({\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t});\n\t\t}\n\n\t\tthis.reInitSelector();\n\n\t\tthis.selectCustomSectionById(id);\n\t}\n\n\tselectCustomSectionById(id: number): void\n\t{\n\t\tconst dialog = this.selector.getDialog();\n\n\t\tdialog.deselectAll();\n\t\tdialog.getItem({\n\t\t\tentityId: 'custom-section',\n\t\t\tid,\n\t\t})?.select();\n\t}\n\n\tonOpenAutomatedSolutionCreationSliderClick(): void\n\t{\n\t\tvoid Router.Instance.openAutomatedSolutionDetail();\n\t}\n\n\tonCreateButtonClick()\n\t{\n\t\tthis.hideSelector();\n\t\tthis.showSectionsList();\n\t}\n\n\trenderSectionsConfig(): HTMLDivElement\n\t{\n\t\tif (!this.sectionsListContainer)\n\t\t{\n\t\t\tthis.sectionsListContainer = Tag.render`<div class=\"crm-type-custom-sections-list-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.sectionsListContainer);\n\t\t}\n\n\t\tthis.renderSectionsList(this.sectionsListContainer);\n\n\t\tif (!this.addSectionItemButton)\n\t\t{\n\t\t\tthis.addSectionItemButton = Tag.render`\n\t\t\t\t<div class=\"crm-type-custom-section-add-item-container\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"crm-type-custom-section-add-item-button\"\n\t\t\t\t\t\tonclick=\"${() => this.sectionsListContainer.append(this.renderSectionItem())}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.settingsContainer.append(this.addSectionItemButton);\n\t\t}\n\n\t\tif (!this.buttonsContainer)\n\t\t{\n\t\t\tthis.settingsContainer.append(Tag.render`<hr class=\"crm-type-custom-sections-line\">`);\n\t\t\tthis.buttonsContainer = Tag.render`<div class=\"crm-type-custom-sections-buttons-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.buttonsContainer);\n\t\t}\n\n\t\tif (!this.saveButton)\n\t\t{\n\t\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${this.onSaveConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_SAVE')}</span>`;\n\t\t\tthis.buttonsContainer.append(this.saveButton);\n\t\t}\n\n\t\tif (!this.cancelButton)\n\t\t{\n\t\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${this.onCancelConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_CANCEL')}</span>`;\n\t\t\tthis.buttonsContainer.append(this.cancelButton);\n\t\t}\n\t}\n\n\tonSaveConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst selectedSection = this.getSelectedSection();\n\t\tconst newCustomSections = [];\n\t\t[...this.sectionsListContainer.children].forEach((node) => {\n\t\t\tconst idInput = node.querySelector('[name=\"id\"]');\n\t\t\tconst valueInput = node.querySelector('[name=\"value\"]');\n\t\t\tif (!idInput || !valueInput)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = idInput.value;\n\t\t\tconst title = valueInput.value;\n\t\t\tlet isSelected = false;\n\t\t\tif (selectedSection && selectedSection.id === id)\n\t\t\t{\n\t\t\t\tisSelected = true;\n\t\t\t}\n\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tnewCustomSections.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.customSections = newCustomSections;\n\n\t\tthis.reInitSelector();\n\t\tthis.showSelector();\n\n\t\tthis.hideSectionsList();\n\t}\n\n\tonCancelConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.showSelector();\n\t\tthis.hideSectionsList();\n\t}\n\n\trenderSectionsList(listContainer: HTMLDivElement)\n\t{\n\t\tDom.clean(listContainer);\n\t\tthis.customSections.forEach((section) => {\n\t\t\tlistContainer.append(this.renderSectionItem(section));\n\t\t});\n\n\t\tlistContainer.append(this.renderSectionItem());\n\t}\n\n\trenderSectionItem(section: ?CustomSection): HTMLDivElement\n\t{\n\t\tconst item = new CustomSectionItem(section);\n\t\tconst node = Tag.render`\n\t\t\t<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"${item.getId()}\" />\n\t\t\t\t<input class=\"ui-ctl-element\" name=\"value\" type=\"text\" value=\"${Text.encode(item.getValue())}\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"crm-type-custom-section-remove-item\"\n\t\t\t\t\tonclick=\"${(event) => {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.sectionsListContainer.removeChild(item.getNode());\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\titem.setNode(node);\n\n\t\treturn node;\n\t}\n\n\tshowSectionsList()\n\t{\n\t\tthis.renderSectionsConfig();\n\t\tDom.removeClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\thideSectionsList()\n\t{\n\t\tDom.clean(this.sectionsListContainer);\n\t\tDom.addClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t}\n\n\tgetSelectedSection(): ?CustomSection\n\t{\n\t\tconst selectedItems = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedItems.length > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: selectedItems[0].getId(),\n\t\t\t\ttitle: selectedItems[0].getTitle(),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetData()\n\t{\n\t\tconst data = {\n\t\t\tcustomSectionId: 0,\n\t\t\tcustomSections: this.customSections,\n\t\t};\n\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tconst selectedSection = this.getSelectedSection();\n\t\t\tif (selectedSection)\n\t\t\t{\n\t\t\t\tdata.customSectionId = selectedSection.id;\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionItem\n{\n\tconstructor(customSection: CustomSection = null)\n\t{\n\t\tthis.id = customSection ? customSection.id : `new_${Text.getRandom()}`;\n\t\tthis.value = customSection ? customSection.title : '';\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif (!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif (input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}\n"],"names":["namespace","Reflection","instance","TypeDetail","params","Map","Type","isPlainObject","type","isNew","isSaved","form","container","errorsContainer","presets","relations","isRestricted","Boolean","restrictionErrorMessage","isStringFilled","restrictionSliderCode","isExternal","isCreateSectionsViaAutomatedSolutionDetails","canEditAutomatedSolution","buttonsPanel","document","getElementById","saveButton","cancelButton","deleteButton","bindEvents","fillTabs","getId","disablePresetsView","presetSelectorContainer","querySelector","Dom","addClass","enablePresetsView","removeClass","initRelations","initCustomSections","Event","bind","event","save","passive","userFieldOption","getBooleanFieldNodeByName","disableLinkedUserFieldsIfNotAvailable","querySelectorAll","forEach","linkedUserFieldNode","enableUserFieldIfAnyLinkedChecked","EventEmitter","subscribe","getData","sliderEvent","slider","getSlider","Dictionary","ELEMENT_ESC_BUTTON","handleSliderDestroy","top","BX","getFrameWindow","window","destroy","unsubscribe","customSectionController","activeTab","presetsTab","hideErrors","click","isBooleanFieldChecked","setBooleanFieldCheckedState","loader","Loader","size","isProgress","getLoader","isShown","show","hide","setTimeout","getClass","UI","InfoHelper","showErrors","stopProgress","preventDefault","startProgress","setTitle","value","TypeModel","getBooleanFieldNames","fieldName","fieldNode","data","linkedUserFields","name","dataset","slice","length","replace","setLinkedUserFields","setRelations","parent","parentRelationsController","child","childRelationsController","customSectionData","setCustomSectionId","customSectionId","setCustomSections","customSections","setIsExternalDynamicalType","setIsSaveFromTypeDetail","isSaveFromTypeDetail","analyticsBuilder","setElement","ELEMENT_CREATE_BUTTON","sendAnalyticsData","setStatus","STATUS_ATTEMPT","buildData","then","response","STATUS_SUCCESS","setId","afterSave","errors","STATUS_ERROR","role","entityTypeIds","checkboxes","checkbox","checked","push","entityTypeId","addDataToSlider","Object","hasOwn","Router","Instance","setUrlTemplates","urlTemplates","close","emitTypeUpdatedEvent","isUrlChanged","SidePanel","getSliderByWindow","ToolbarComponent","key","isString","set","text","message","isDomNode","innerText","style","parentNode","console","error","currentUrl","Uri","decodeURI","location","href","Builder","Automation","DeleteEvent","ELEMENT_DELETE_BUTTON","setIsExternal","setSubSection","getQueryParam","MessageBox","confirm","Loc","getMessage","Promise","resolve","isObject","closeSliderOrRedirect","getTypeListUrl","box","STATUS_CANCEL","tabNode","tab","tabs","tabNameToShow","keys","tabName","get","presetId","presetSelector","currentPresetNode","currentPreset","getPresetById","title","presetNode","preset","updateInputs","textContent","Text","encode","fields","selectedPresetId","id","node","nodeName","toggleClass","hasClass","isChecked","RelationsController","switcher","Switcher","getById","typeSelectorContainer","tabsContainer","tabsCheckbox","tabsSelectorContainer","CustomSectionsController","selectorContainer","getCustomSections","showTab","applyPreset","target","toggleBooleanField","ELEMENT_CANCEL_BUTTON","element","builder","CreateEvent","EditEvent","setPreset","options","initSelectors","adjustInitialState","adjust","unselectedTypes","selectedTypes","unselectedTabs","selectedTabs","relation","item","entityId","isChildrenListEnabled","typeSelector","TagSelector","dialogOptions","enableSearch","multiple","items","selectedItems","dropdownMode","height","showAvatars","events","onAfterTagAdd","onAfterTagRemove","renderTo","tabsSelector","getDialog","getSelectedItems","check","getItems","isItemSelected","deselect","removeItem","removeTag","getEntityId","itemData","getTitle","tabItem","getItem","newItem","addItem","select","some","selectedItem","isTabsCheckboxChecked","selectedType","isArray","isBoolean","initSelector","settingsContainer","Tag","render","append","unbindEvents","selector","unsubscribeAll","section","isSelected","tagSelectorOptions","showCreateButton","footer","onOpenAutomatedSolutionCreationSliderClick","createButtonCaption","onCreateButtonClick","locked","clean","selectedSection","onAutomatedSolutionUpdate","subscribeAutomatedSolutionUpdatedEvent","unsubscribeAutomatedSolutionUpdatedEvent","toInteger","intranetCustomSectionId","String","currentCustomSection","find","reInitSelector","selectCustomSectionById","dialog","deselectAll","openAutomatedSolutionDetail","hideSelector","showSectionsList","sectionsListContainer","renderSectionsList","addSectionItemButton","renderSectionItem","buttonsContainer","onSaveConfigHandler","onCancelConfigHandler","getSelectedSection","newCustomSections","children","idInput","valueInput","showSelector","hideSectionsList","listContainer","CustomSectionItem","getValue","removeChild","getNode","setNode","renderSectionsConfig","customSection","getRandom","HTMLInputElement","input","getInput"],"mappings":";;;;;;;;;;;;AAAA,CA6BA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAS,CAAC,kBAAkB,CAAC;CAE1D,IAAIE,QAAoB,GAAG,IAAI;;CAE/B;CACA;CACA;CAFA;CAAA;CAAA;CAAA;CAAA;CAAA,IAGMC,UAAU;GA6Bf,oBAAYC,MAgBR,EACJ;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA,gDA1CsB,KAAK;KAAA,0CAIE,IAAIC,GAAG,EAAE;KAAA,kDAWd,KAAK;KAAA,gDAGP,KAAK;KAAA,0DACK,IAAI;KAAA,iFACmB,KAAK;KAAA,8DACxB,KAAK;KAAA;OAAA;OAAA,OAEL;;KAoBnC,IAAIC,cAAI,CAACC,aAAa,CAACH,MAAM,CAAC,EAC9B;OACC,IAAI,CAACI,IAAI,GAAGJ,MAAM,CAACI,IAAI;OACvB,IAAI,CAACC,KAAK,GAAG,CAAC,IAAI,CAACD,IAAI,CAACE,OAAO,EAAE;OACjC,IAAI,CAACC,IAAI,GAAGP,MAAM,CAACO,IAAI;OACvB,IAAI,CAACC,SAAS,GAAGR,MAAM,CAACQ,SAAS;OACjC,IAAI,CAACC,eAAe,GAAGT,MAAM,CAACS,eAAe;OAC7C,IAAI,CAACC,OAAO,GAAGV,MAAM,CAACU,OAAO;OAC7B,IAAI,CAACC,SAAS,GAAGX,MAAM,CAACW,SAAS;OACjC,IAAI,CAACC,YAAY,GAAGC,OAAO,CAACb,MAAM,CAACY,YAAY,CAAC;OAChD,IAAI,CAACE,uBAAuB,GAAGZ,cAAI,CAACa,cAAc,CAACf,MAAM,CAACc,uBAAuB,CAAC,GAAGd,MAAM,CAACc,uBAAuB,GAAG,EAAE;OACxH,IAAI,CAACE,qBAAqB,GAAGd,cAAI,CAACa,cAAc,CAACf,MAAM,CAACgB,qBAAqB,CAAC,IAAI,IAAI,CAACJ,YAAY,GAChGZ,MAAM,CAACgB,qBAAqB,GAC5B,IAAI;OAEP,IAAI,CAACC,UAAU,GAAGJ,OAAO,CAACb,MAAM,CAACiB,UAAU,CAAC;OAC5C,IAAI,CAACC,2CAA2C,GAAGL,OAAO,CAACb,MAAM,CAACkB,2CAA2C,CAAC;OAC9G,IAAI,CAACC,wBAAwB,GAAGN,OAAO,CAACb,MAAM,CAACmB,wBAAwB,CAAC;;KAGzE,IAAI,CAACC,YAAY,GAAGC,QAAQ,CAACC,cAAc,CAAC,iBAAiB,CAAC;KAC9D,IAAI,CAACC,UAAU,GAAGF,QAAQ,CAACC,cAAc,CAAC,sBAAsB,CAAC;KACjE,IAAI,CAACE,YAAY,GAAGH,QAAQ,CAACC,cAAc,CAAC,wBAAwB,CAAC;KACrE,IAAI,CAACG,YAAY,GAAGJ,QAAQ,CAACC,cAAc,CAAC,wBAAwB,CAAC;;;KAGrExB,QAAQ,GAAG,IAAI;;GACf;KAAA;KAAA,uBAGD;OACC,IAAI,CAAC4B,UAAU,EAAE;OAEjB,IAAI,CAACC,QAAQ,EAAE;OAEf,IAAI,IAAI,CAACvB,IAAI,CAACwB,KAAK,EAAE,EACrB;;;;;;;SAOC,IAAI,CAACC,kBAAkB,EAAE;SACzB,IAAMC,uBAAuB,GAAGT,QAAQ,CAACU,aAAa,CAAC,yCAAyC,CAAC;SACjG,IAAID,uBAAuB,EAC3B;WACCE,aAAG,CAACC,QAAQ,CAACH,uBAAuB,EAAE,iBAAiB,CAAC;;QAEzD,MAED;SACC,IAAI,CAACI,iBAAiB,EAAE;;OAGzBF,aAAG,CAACG,WAAW,CAACd,QAAQ,CAACU,aAAa,CAAC,MAAM,CAAC,EAAE,iBAAiB,CAAC;OAElE,IAAI,CAACK,aAAa,EAAE;OAEpB,IAAI,CAACC,kBAAkB,EAAE;;;KACzB;KAAA,6BAGD;OAAA;OACCC,eAAK,CAACC,IAAI,CAAC,IAAI,CAAChB,UAAU,EAAE,OAAO,EAAE,UAACiB,KAAK,EAAK;SAC/C,KAAI,CAACC,IAAI,CAACD,KAAK,CAAC;QAChB,EAAE;SACFE,OAAO,EAAE;QACT,CAAC;OAEF,IAAI,IAAI,CAACjB,YAAY,EACrB;SACCa,eAAK,CAACC,IAAI,CAAC,IAAI,CAACd,YAAY,EAAE,OAAO,EAAE,UAACe,KAAK,EAAK;WACjD,KAAI,UAAO,CAACA,KAAK,CAAC;UAClB,CAAC;;OAGH,IAAMG,eAAe,GAAG,IAAI,CAACC,yBAAyB,CAAC,yBAAyB,CAAC;OACjF,IAAID,eAAe,EACnB;SACCL,eAAK,CAACC,IAAI,CAACI,eAAe,EAAE,OAAO,EAAE,IAAI,CAACE,qCAAqC,CAACN,IAAI,CAAC,IAAI,CAAC,CAAC;;OAG5F,IAAI,CAAChC,IAAI,CAACuC,gBAAgB,CAAC,iCAAiC,CAAC,CAACC,OAAO,CAAC,UAACC,mBAAmB,EAAK;SAC9FV,eAAK,CAACC,IAAI,CAACS,mBAAmB,EAAE,OAAO,EAAE,KAAI,CAACC,iCAAiC,CAACV,IAAI,CAAC,KAAI,CAAC,CAAC;QAC3F,CAAC;OAEFW,6BAAY,CAACC,SAAS,CAAC,+BAA+B,EAAE,UAACX,KAAgB,EAAK;SAC7E,qBAAsBA,KAAK,CAACY,OAAO,EAAE;WAAA;WAA9BC,WAAW;SAClB,IAAMC,MAA2B,GAAGD,WAAW,CAACE,SAAS,EAAE;SAE3D,IAAID,MAAM,KAAK,KAAI,CAACC,SAAS,EAAE,EAC/B;WACC,4BAAI,oDAAJ,KAAI,EAAsBC,oCAAU,CAACC,kBAAkB;;QAExD,CAAC;OACFP,6BAAY,CAACC,SAAS,CAAC,0BAA0B,EAAE,UAACX,KAAgB,EAAK;SACxE,sBAAsBA,KAAK,CAACY,OAAO,EAAE;WAAA;WAA9BC,WAAW;SAClB,IAAMC,MAA2B,GAAGD,WAAW,CAACE,SAAS,EAAE;SAE3D,IAAID,MAAM,KAAK,KAAI,CAACC,SAAS,EAAE,EAC/B;WACC,4BAAI,oDAAJ,KAAI,EAAsB,IAAI;;QAE/B,CAAC;OAEF,IAAI,CAACG,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CAACnB,IAAI,CAAC,IAAI,CAAC;OAC9DoB,GAAG,CAACC,EAAE,CAACtB,KAAK,CAACY,YAAY,CAACC,SAAS,CAAC,4BAA4B,EAAE,IAAI,CAACO,mBAAmB,CAAC;;;KAC3F;KAAA,oCAEmBlB,KAAgB,EACpC;OACC,sBAAsBA,KAAK,CAACY,OAAO,EAAE;SAAA;SAA9BC,WAAW;OAClB,IAAMC,MAA2B,GAAGD,WAAW,CAACE,SAAS,EAAE;OAE3D,IAAID,MAAM,CAACO,cAAc,EAAE,KAAKC,MAAM,EACtC;;;SAGC,IAAI,CAACC,OAAO,EAAE;SACdJ,GAAG,CAACC,EAAE,CAACtB,KAAK,CAACY,YAAY,CAACc,WAAW,CAAC,4BAA4B,EAAE,IAAI,CAACN,mBAAmB,CAAC;;;;KAE9F;KAAA,0BAqBD;OAAA;OACC,6BAAI,CAACO,uBAAuB,0DAA5B,sBAA8BF,OAAO,EAAE;;;KACvC;KAAA,oCAGD;OACC/B,aAAG,CAACC,QAAQ,CAACZ,QAAQ,CAACU,aAAa,CAAC,MAAM,CAAC,EAAE,2BAA2B,CAAC;OACzE,IAAMmC,SAAS,GAAG,IAAI,CAAC1D,SAAS,CAACuB,aAAa,CAAC,uBAAuB,CAAC;OACvE,IAAImC,SAAS,EACb;SACClC,aAAG,CAACG,WAAW,CAAC+B,SAAS,EAAE,sBAAsB,CAAC;;OAEnD,IAAMC,UAAU,GAAG,IAAI,CAAC3D,SAAS,CAACuB,aAAa,CAAC,sBAAsB,CAAC;OACvE,IAAIoC,UAAU,EACd;SACCnC,aAAG,CAACC,QAAQ,CAACkC,UAAU,EAAE,sBAAsB,CAAC;;OAEjD,IAAMrC,uBAAuB,GAAGT,QAAQ,CAACU,aAAa,CAAC,yCAAyC,CAAC;OACjG,IAAID,uBAAuB,EAC3B;SACCE,aAAG,CAACC,QAAQ,CAACH,uBAAuB,EAAE,iBAAiB,CAAC;;OAEzDE,aAAG,CAACG,WAAW,CAACd,QAAQ,CAACC,cAAc,CAAC,WAAW,CAAC,EAAE,iBAAiB,CAAC;OACxEU,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACb,YAAY,EAAE,iBAAiB,CAAC;OAClD,IAAI,CAACgD,UAAU,EAAE;;;KACjB;KAAA,qCAGD;OAAA;OACCpC,aAAG,CAACG,WAAW,CAACd,QAAQ,CAACU,aAAa,CAAC,MAAM,CAAC,EAAE,2BAA2B,CAAC;OAE5E,iDAAC,IAAI,oDAAJ,IAAI,iGAA2B,IAAI,kDAAJ,IAAI,GAAwBsC,KAAK,EAAE;OAEnE,IAAMvC,uBAAuB,GAAGT,QAAQ,CAACU,aAAa,CAAC,yCAAyC,CAAC;OACjG,IAAID,uBAAuB,EAC3B;SACCE,aAAG,CAACG,WAAW,CAACL,uBAAuB,EAAE,iBAAiB,CAAC;;OAE5DE,aAAG,CAACC,QAAQ,CAACZ,QAAQ,CAACC,cAAc,CAAC,WAAW,CAAC,EAAE,iBAAiB,CAAC;OACrEU,aAAG,CAACG,WAAW,CAAC,IAAI,CAACf,YAAY,EAAE,iBAAiB,CAAC;;;KACrD;KAAA,wDAaD;OAAA;OACC,IAAMuB,eAAe,GAAG,IAAI,CAACC,yBAAyB,CAAC,yBAAyB,CAAC;OACjF,IAAI,CAAC,IAAI,CAAC0B,qBAAqB,CAAC3B,eAAe,CAAC,EAChD;SACC,IAAI,CAACpC,IAAI,CAACuC,gBAAgB,CAAC,iCAAiC,CAAC,CAACC,OAAO,CAAC,UAACC,mBAAmB,EAAK;WAC9F,MAAI,CAACuB,2BAA2B,CAACvB,mBAAmB,EAAE,KAAK,CAAC;UAC5D,CAAC;;;;KAEH;KAAA,oDAGD;OAAA;OACC,IAAML,eAAe,GAAG,IAAI,CAACC,yBAAyB,CAAC,yBAAyB,CAAC;OACjF,IAAI,CAAC,IAAI,CAAC0B,qBAAqB,CAAC3B,eAAe,CAAC,EAChD;SACC,IAAI,CAACpC,IAAI,CAACuC,gBAAgB,CAAC,iCAAiC,CAAC,CAACC,OAAO,CAAC,UAACC,mBAAmB,EAAK;WAC9F,IAAI,MAAI,CAACsB,qBAAqB,CAACtB,mBAAmB,CAAC,EACnD;aACC,MAAI,CAACuB,2BAA2B,CAAC5B,eAAe,EAAE,IAAI,CAAC;;UAExD,CAAC;;;;KAEH;KAAA,4BAGD;OACC,IAAI,CAAC,IAAI,CAAC6B,MAAM,EAChB;SACC,IAAI,CAACA,MAAM,GAAG,IAAIC,kBAAM,CAAC;WAAEC,IAAI,EAAE;UAAK,CAAC;;OAGxC,OAAO,IAAI,CAACF,MAAM;;;KAClB;KAAA,gCAGD;OACC,IAAI,CAACG,UAAU,GAAG,IAAI;OACtB,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE,CAACC,OAAO,EAAE,EAC/B;SACC,IAAI,CAACD,SAAS,EAAE,CAACE,IAAI,CAAC,IAAI,CAACvE,IAAI,CAAC;;OAEjC,IAAI,CAAC6D,UAAU,EAAE;;;KACjB;KAAA,+BAGD;OAAA;OACC,IAAI,CAACO,UAAU,GAAG,KAAK;OACvB,IAAI,CAACC,SAAS,EAAE,CAACG,IAAI,EAAE;OACvBC,UAAU,CAAC,YAAM;SAChBhD,aAAG,CAACG,WAAW,CAAC,MAAI,CAACZ,UAAU,EAAE,aAAa,CAAC;SAC/CS,aAAG,CAACG,WAAW,CAAC,MAAI,CAACX,YAAY,EAAE,aAAa,CAAC;SACjD,IAAI,MAAI,CAACC,YAAY,EACrB;WACCO,aAAG,CAACG,WAAW,CAAC,MAAI,CAACV,YAAY,EAAE,aAAa,CAAC;;QAElD,EAAE,GAAG,CAAC;;;KACP;KAAA,qBAEIe,KAAK,EACV;OAAA;OACC,IAAI,IAAI,CAAC5B,YAAY,EACrB;SACC,IACCV,cAAI,CAACa,cAAc,CAAC,IAAI,CAACC,qBAAqB,CAAC,IAC5CnB,oBAAU,CAACoF,QAAQ,CAAC,uBAAuB,CAAC,EAEhD;WACCrB,EAAE,CAACsB,EAAE,CAACC,UAAU,CAACL,IAAI,CAAC,IAAI,CAAC9D,qBAAqB,CAAC;UACjD,MAED;WACC,IAAI,CAACoE,UAAU,CAAC,CAAC,IAAI,CAACtE,uBAAuB,CAAC,CAAC;;SAGhD,IAAI,CAACuE,YAAY,EAAE;SAEnB;;OAED7C,KAAK,CAAC8C,cAAc,EAAE;OACtB,IAAI,CAAC,IAAI,CAAC/E,IAAI,EACd;SACC;;OAGD,IAAI,IAAI,CAACoE,UAAU,EACnB;SACC;;OAGD,IAAI,CAAC,IAAI,CAACvE,IAAI,EACd;SACC;;OAED,IAAI,CAACmF,aAAa,EAAE;OAEpB,IAAI,CAACnF,IAAI,CAACoF,QAAQ,CAAC,IAAI,CAACjF,IAAI,CAACwB,aAAa,CAAC,gBAAgB,CAAC,CAAC0D,KAAK,CAAC;OACnEC,uBAAS,CAACC,oBAAoB,EAAE,CAAC5C,OAAO,CAAC,UAAC6C,SAAS,EAAK;SACvD,IAAMC,SAAS,GAAG,MAAI,CAACjD,yBAAyB,CAACgD,SAAS,CAAC;SAC3D,IAAIC,SAAS,EACb;WACC,MAAI,CAACzF,IAAI,CAAC0F,IAAI,CAACF,SAAS,CAAC,GAAG,MAAI,CAACtB,qBAAqB,CAACuB,SAAS,CAAC;;QAElE,CAAC;;;;;OAKF,IAAME,gBAAgB,GAAG,EAAE;OAC3B,IAAI,CAACxF,IAAI,CAACuC,gBAAgB,CAAC,iCAAiC,CAAC,CAACC,OAAO,CAAC,UAACC,mBAAmB,EAAK;SAC9F,IAAMgD,IAAI,GAAGhD,mBAAmB,CAACiD,OAAO,CAACD,IAAI,CAACE,KAAK,CAAC,mBAAmB,CAACC,MAAM,CAAC,CAACC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC;SAChGL,gBAAgB,CAACC,IAAI,CAAC,GAAG,MAAI,CAAC1B,qBAAqB,CAACtB,mBAAmB,CAAC;QACxE,CAAC;OACF,IAAI,CAAC5C,IAAI,CAACiG,mBAAmB,CAACN,gBAAgB,CAAC;OAC/C,IAAI,CAAC3F,IAAI,CAACkG,YAAY,CAAC;SACtBC,MAAM,EAAE,IAAI,CAACC,yBAAyB,CAACpD,OAAO,EAAE;SAChDqD,KAAK,EAAE,IAAI,CAACC,wBAAwB,CAACtD,OAAO;QAC5C,CAAC;OACF,IAAI,IAAI,CAACa,uBAAuB,EAChC;SACC,IAAM0C,iBAAiB,GAAG,IAAI,CAAC1C,uBAAuB,CAACb,OAAO,EAAE;SAChE,IAAI,CAAChD,IAAI,CAACwG,kBAAkB,CAACD,iBAAiB,CAACE,eAAe,CAAC;SAC/D,IAAI,CAACzG,IAAI,CAAC0G,iBAAiB,CAACH,iBAAiB,CAACI,cAAc,CAAC;SAC7D,IAAI,CAAC3G,IAAI,CAAC4G,0BAA0B,CAAC,IAAI,CAAC/F,UAAU,CAAC;SACrD,IAAI,CAACb,IAAI,CAAC6G,uBAAuB,CAAC,IAAI,CAACC,oBAAoB,CAAC;;OAG7D,IAAMC,gBAAgB,GAAG,2BAAI,oDAAJ,IAAI,EAC3BC,UAAU,CAAC5D,oCAAU,CAAC6D,qBAAqB,CAAC;OAG9CC,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACgE,cAAc,CAAC,CACpCC,SAAS,EAAE,CAEb;OAED,IAAI,CAACrH,IAAI,CAACqC,IAAI,EAAE,CAACiF,IAAI,CAAC,UAACC,QAAQ,EAAK;SACnCL,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACoE,cAAc,CAAC,CACpCC,KAAK,CAAC,MAAI,CAACzH,IAAI,CAACwB,KAAK,EAAE,CAAC,CACxB6F,SAAS,EAAE,CAEb;SAED,wCAAI,4BAA4B,IAAI;SAEpC,MAAI,CAACpC,YAAY,EAAE;SACnB,MAAI,CAACyC,SAAS,CAACH,QAAQ,CAAC;SACxB,MAAI,CAACtH,KAAK,GAAG,KAAK;QAClB,CAAC,SAAM,CAAC,UAAC0H,MAAM,EAAK;SACpBT,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACwE,YAAY,CAAC,CAClCH,KAAK,CAAC,MAAI,CAACzH,IAAI,CAACwB,KAAK,EAAE,CAAC,CACxB6F,SAAS,EAAE,CAEb;SAED,MAAI,CAACrC,UAAU,CAAC2C,MAAM,CAAC;SACvB,MAAI,CAAC1C,YAAY,EAAE;QACnB,CAAC;;;KACF;KAAA,qCA8BoB4C,IAAY,EACjC;OACC,IAAMC,aAAa,GAAG,EAAE;OAExB,IAAMC,UAAU,GAAG,IAAI,CAAC3H,SAAS,CAACsC,gBAAgB,wBAAgBmF,IAAI,SAAK;OAC3E,+BAAIE,UAAU,EAAEpF,OAAO,CAAC,UAACqF,QAA0B,EAAK;SACvD,IAAIA,QAAQ,CAACC,OAAO,EACpB;WACCH,aAAa,CAACI,IAAI,CAACF,QAAQ,CAACnC,OAAO,CAACsC,YAAY,CAAC;;QAElD,CAAC;OAEF,OAAOL,aAAa;;;KACpB;KAAA,0BAESP,QAAoB,EAC9B;OAAA;OACC,IAAI,CAACa,eAAe,CAAC,UAAU,EAAEb,QAAQ,CAAC;OAE1C,IAAIc,MAAM,CAACC,MAAM,CAACf,QAAQ,CAAC7B,IAAI,EAAE,cAAc,CAAC,EAChD;SACC6C,iBAAM,CAACC,QAAQ,CAACC,eAAe,CAAClB,QAAQ,CAAC7B,IAAI,CAACgD,YAAY,CAAC;;OAG5D,uBAAI,CAACvF,SAAS,EAAE,oDAAhB,gBAAkBwF,KAAK,EAAE;OAEzB,IAAI,CAACC,oBAAoB,CAAC;SACzBC,YAAY,EAAGtB,QAAQ,CAAC7B,IAAI,CAACmD,YAAY,KAAK;QAC9C,CAAC;;;KACF;KAAA,4BAGD;OAAA;OACC,wBAAOrF,EAAE,CAACsF,SAAS,2EAAZ,cAAcN,QAAQ,0DAAtB,sBAAwBO,iBAAiB,CAACrF,MAAM,CAAC;;;KACxD;KAAA,qCAEoBgC,IAAI,EACzB;OACCsD,qCAAgB,CAACR,QAAQ,CAACI,oBAAoB,CAAClD,IAAI,CAAC;;;KACpD;KAAA,gCAEeuD,GAAG,EAAEvD,IAAI,EACzB;OACC,IAAI5F,cAAI,CAACoJ,QAAQ,CAACD,GAAG,CAAC,IAAInJ,cAAI,CAACC,aAAa,CAAC2F,IAAI,CAAC,EAClD;SACC,IAAMxC,MAAM,GAAG,IAAI,CAACC,SAAS,EAAE;SAC/B,IAAID,MAAM,EACV;WACCA,MAAM,CAACwC,IAAI,CAACyD,GAAG,CAACF,GAAG,EAAEvD,IAAI,CAAC;;;;;KAG5B;KAAA,2BAEUiC,MAAgB,EAC3B;OACC,IAAIyB,IAAI,GAAG,EAAE;OACbzB,MAAM,CAAChF,OAAO,CAAC,UAAC0G,OAAO,EAAK;SAC3BD,IAAI,IAAIC,OAAO;QACf,CAAC;OACF,IAAIvJ,cAAI,CAACwJ,SAAS,CAAC,IAAI,CAACjJ,eAAe,CAAC,EACxC;SACC,IAAI,CAACA,eAAe,CAACkJ,SAAS,GAAGH,IAAI;SACrCxH,aAAG,CAAC4H,KAAK,CAAC,IAAI,CAACnJ,eAAe,CAACoJ,UAAU,EAAE,SAAS,EAAE,OAAO,CAAC;QAC9D,MAED;SACCC,OAAO,CAACC,KAAK,CAACP,IAAI,CAAC;;;;KAEpB;KAAA,6BAGD;OACC,IAAItJ,cAAI,CAACwJ,SAAS,CAAC,IAAI,CAACjJ,eAAe,CAAC,EACxC;SACCuB,aAAG,CAAC4H,KAAK,CAAC,IAAI,CAACnJ,eAAe,CAACoJ,UAAU,EAAE,SAAS,EAAE,MAAM,CAAC;SAC7D,IAAI,CAACpJ,eAAe,CAACkJ,SAAS,GAAG,EAAE;;;;KAEpC;KAAA,wBAEMnH,KAAK,EACZ;OAAA;OACCA,KAAK,CAAC8C,cAAc,EAAE;OACtB,IAAI,CAAC,IAAI,CAAC/E,IAAI,EACd;SACC;;OAGD,IAAI,IAAI,CAACoE,UAAU,EACnB;SACC;;OAGD,IAAI,CAAC,IAAI,CAACvE,IAAI,EACd;SACC;;OAGD,IAAM4J,UAAU,GAAG,IAAIC,aAAG,CAACC,SAAS,CAACpG,MAAM,CAACqG,QAAQ,CAACC,IAAI,CAAC,CAAC;OAE3D,IAAMjD,gBAAgB,GAAI,IAAIkD,iCAAO,CAACC,UAAU,CAACpK,IAAI,CAACqK,WAAW,EAAE,CACjEnD,UAAU,CAAC5D,oCAAU,CAACgH,qBAAqB,CAAC,CAC5CC,aAAa,CAAC,IAAI,CAACxJ,UAAU,CAAC,CAC9ByJ,aAAa,CAACV,UAAU,CAACW,aAAa,CAAC,eAAe,CAAC,CAAC,CACxD9C,KAAK,CAAC,IAAI,CAACzH,IAAI,CAACwB,KAAK,EAAE,CAAC;OAG1BgJ,gCAAU,CAACC,OAAO,CACjBC,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,EAChD,YAAM;SACL,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAK;WAC/B3D,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACgE,cAAc,CAAC,CACpCC,SAAS,EAAE,CAEb;WAED,MAAI,CAAClC,aAAa,EAAE;WACpB,MAAI,CAACnF,IAAI,UAAO,EAAE,CAACsH,IAAI,CAAC,UAACC,QAAQ,EAAK;aACrCL,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACoE,cAAc,CAAC,CACpCH,SAAS,EAAE,CAEb;aAED,wCAAI,4BAA4B,IAAI;aAEpC,MAAI,CAACpC,YAAY,EAAE;aAEnB,IAAM4D,YAAY,GAAI/I,cAAI,CAACgL,QAAQ,CAACvD,QAAQ,CAAC7B,IAAI,CAAC,IAAK6B,QAAQ,CAAC7B,IAAI,CAACmD,YAAY,KAAK,IAAM;aAC5F,MAAI,CAACD,oBAAoB,CAAC;eAAEC,YAAY,EAAZA;cAAc,CAAC;aAE3CN,iBAAM,CAACC,QAAQ,CAACuC,qBAAqB,CAACxC,iBAAM,CAACC,QAAQ,CAACwC,cAAc,EAAE,CAAC;YACvE,CAAC,SAAM,CAAC,UAACrD,MAAgB,EAAK;aAC9BT,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAACwE,YAAY,CAAC,CAClCP,SAAS,EAAE,CAEb;aAED,MAAI,CAACrC,UAAU,CAAC2C,MAAM,CAAC;aACvB,MAAI,CAAC1C,YAAY,EAAE;aACnB4F,OAAO,EAAE;YACT,CAAC;UACF,CAAC;QACF,EACD,IAAI,EACJ,UAACI,GAAG,EAAK;SACR/D,qBAAiB,CAChBH,gBAAgB,CACdI,SAAS,CAAC/D,oCAAU,CAAC8H,aAAa,CAAC,CACnC7D,SAAS,EAAE,CAEb;SAED,MAAI,CAACpC,YAAY,EAAE;SACnBgG,GAAG,CAACtC,KAAK,EAAE;QACX,CACD;;;KACD;KAAA,2BAGD;OAAA;OACC,IAAI,IAAI,CAACvI,SAAS,EAClB;SACC,IAAI,CAACA,SAAS,CAACsC,gBAAgB,CAAC,eAAe,CAAC,CAACC,OAAO,CAAC,UAACwI,OAAuB,EAAK;WACrF,IAAIA,OAAO,CAACtF,OAAO,CAACuF,GAAG,EACvB;aACC,MAAI,CAACC,IAAI,CAAClC,GAAG,CAACgC,OAAO,CAACtF,OAAO,CAACuF,GAAG,EAAED,OAAO,CAAC;;UAE5C,CAAC;;;;KAEH;KAAA,wBAEOG,aAAqB,EAC7B;OAAA;OACC,+BAAI,IAAI,CAACD,IAAI,CAACE,IAAI,EAAE,EAAE5I,OAAO,CAAC,UAAC6I,OAAe,EAAK;SAClD,IAAIA,OAAO,KAAKF,aAAa,EAC7B;WACC1J,aAAG,CAACC,QAAQ,CAAC,MAAI,CAACwJ,IAAI,CAACI,GAAG,CAACD,OAAO,CAAC,EAAE,sBAAsB,CAAC;UAC5D,MAED;WACC5J,aAAG,CAACG,WAAW,CAAC,MAAI,CAACsJ,IAAI,CAACI,GAAG,CAACD,OAAO,CAAC,EAAE,sBAAsB,CAAC;;QAEhE,CAAC;;;KACF;KAAA,4BAEWE,QAAgB,EAC5B;OAAA;OACC,IAAI,CAACjK,kBAAkB,EAAE;OACzB,IAAMkK,cAAc,GAAG1K,QAAQ,CAACU,aAAa,CAAC,wCAAwC,CAAC;OACvF,IAAMiK,iBAAiB,GAAG,IAAI,CAACxL,SAAS,CAACuB,aAAa,CAAC,6CAA6C,CAAC;OACrG,IAAIiK,iBAAiB,EACrB;SACC,IAAMC,aAAa,GAAG,IAAI,CAACC,aAAa,CAACF,iBAAiB,CAAC/F,OAAO,CAAC6F,QAAQ,CAAC;SAC5E,IACCG,aAAa,IACVA,aAAa,CAACnG,IAAI,CAACqG,KAAK,IACxB,IAAI,CAAC5L,IAAI,CAACwB,aAAa,CAAC,gBAAgB,CAAC,CAAC0D,KAAK,KAAKwG,aAAa,CAACnG,IAAI,CAACqG,KAAK,EAChF;WACC,IAAI,CAAC5L,IAAI,CAACwB,aAAa,CAAC,gBAAgB,CAAC,CAAC0D,KAAK,GAAG,EAAE;;;OAGtD,IAAM/E,OAAO,GAAG,IAAI,CAACF,SAAS,CAACsC,gBAAgB,CAAC,sBAAsB,CAAC;OACvEpC,OAAO,CAACqC,OAAO,CAAC,UAACqJ,UAA0B,EAAK;SAC/CpK,aAAG,CAACG,WAAW,CAACiK,UAAU,EAAE,wBAAwB,CAAC;SACrD,IAAIA,UAAU,CAACnG,OAAO,CAAC6F,QAAQ,KAAKA,QAAQ,EAC5C;WACC9J,aAAG,CAACC,QAAQ,CAACmK,UAAU,EAAE,wBAAwB,CAAC;WAClD,IAAMC,MAAM,GAAG,MAAI,CAACH,aAAa,CAACJ,QAAQ,CAAC;WAC3C,IAAIO,MAAM,EACV;aACC,MAAI,CAACC,YAAY,CAACD,MAAM,CAACvG,IAAI,CAAC;aAC9B,IAAIiG,cAAc,EAClB;eACCA,cAAc,CAACQ,WAAW,GAAGC,cAAI,CAACC,MAAM,CAACJ,MAAM,CAACK,MAAM,CAACP,KAAK,CAAC;;;;QAIhE,CAAC;OAEF,IAAI,CAACQ,gBAAgB,GAAGb,QAAQ;;;KAChC;KAAA,8BAEaA,QAAgB,EAC9B;OAAA,2CAC8B,IAAI,CAACpL,OAAO;SAAA;OAAA;SAAzC,oDACA;WAAA,IADW2L,MAAc;WAExB,IAAIA,MAAM,CAACK,MAAM,CAACE,EAAE,KAAKd,QAAQ,EACjC;aACC,OAAOO,MAAM;;;;SAEd;;SAAA;;OAED,OAAO,IAAI;;;KACX;KAAA,6BAEYvG,IAAmB,EAChC;OAAA;OACC,IAAI,IAAI,CAACvF,IAAI,CAACwB,aAAa,CAAC,gBAAgB,CAAC,CAAC0D,KAAK,CAACU,MAAM,IAAI,CAAC,EAC/D;SACC,IAAI,CAAC5F,IAAI,CAACwB,aAAa,CAAC,gBAAgB,CAAC,CAAC0D,KAAK,GAAGK,IAAI,CAACqG,KAAK,IAAI,EAAE;;OAEnEzG,uBAAS,CAACC,oBAAoB,EAAE,CAAC5C,OAAO,CAAC,UAAC6C,SAAS,EAAK;SACvD,IAAMiH,IAAI,GAAG,OAAI,CAACjK,yBAAyB,CAACgD,SAAS,CAAC;SACtD,IAAIiH,IAAI,EACR;WACC,OAAI,CAACtI,2BAA2B,CAACsI,IAAI,EAAE/G,IAAI,CAACF,SAAS,CAAC,CAAC;;QAExD,CAAC;OACF,IAAI,CAAC/C,qCAAqC,EAAE;;;KAC5C;KAAA,mCAEkB+C,SAAiB,EACpC;OACC,IAAMiH,IAAI,GAAG,IAAI,CAACjK,yBAAyB,CAACgD,SAAS,CAAC;OACtD,IAAI,CAACiH,IAAI,EACT;SACC;;OAGD,IAAIA,IAAI,CAACC,QAAQ,KAAK,OAAO,EAC7B;SACCD,IAAI,CAACxE,OAAO,GAAG,CAACwE,IAAI,CAACxE,OAAO;QAC5B,MAED;SACCrG,aAAG,CAAC+K,WAAW,CAACF,IAAI,EAAE,mCAAmC,CAAC;;;;KAE3D;KAAA,0CAEyBjH,SAAiB,EAC3C;OACC,OAAO,IAAI,CAACpF,SAAS,CAACuB,aAAa,wBAAgB6D,SAAS,SAAK;;;KACjE;KAAA,sCAEqBiH,IAAuC,EAC7D;OACC,IAAIA,IAAI,CAACC,QAAQ,KAAK,OAAO,EAC7B;SACC,OAAOD,IAAI,CAACxE,OAAO;;OAGpB,OAAOrG,aAAG,CAACgL,QAAQ,CAACH,IAAI,EAAE,mCAAmC,CAAC;;;KAC9D;KAAA,4CAE2BA,IAAuC,EAAEI,SAAkB,EACvF;OACC,IAAIJ,IAAI,CAACC,QAAQ,KAAK,OAAO,EAC7B;;SAECD,IAAI,CAACxE,OAAO,GAAG4E,SAAS;SAExB;;OAGD,IAAIA,SAAS,EACb;SACCjL,aAAG,CAACC,QAAQ,CAAC4K,IAAI,EAAE,mCAAmC,CAAC;QACvD,MAED;SACC7K,aAAG,CAACG,WAAW,CAAC0K,IAAI,EAAE,mCAAmC,CAAC;;;;KAE3D;KAAA,gCAGD;OACC,IAAI,CAACrG,yBAAyB,GAAG,IAAI0G,mBAAmB,CAAC;SACxDC,QAAQ,EAAEvJ,EAAE,CAACsB,EAAE,CAACkI,QAAQ,CAACC,OAAO,CAAC,mCAAmC,CAAC;SACrE7M,SAAS,EAAE,IAAI,CAACA,SAAS,CAACuB,aAAa,CAAC,8CAA8C,CAAC;SACvFuL,qBAAqB,EAAE,IAAI,CAAC9M,SAAS,CAACuB,aAAa,CAAC,uDAAuD,CAAC;SAC5GwL,aAAa,EAAE,IAAI,CAAC/M,SAAS,CAACuB,aAAa,CAAC,mDAAmD,CAAC;SAChGyL,YAAY,EAAE,IAAI,CAAChN,SAAS,CAACuB,aAAa,CAAC,mDAAmD,CAAC;SAC/F0L,qBAAqB,EAAE,IAAI,CAACjN,SAAS,CAACuB,aAAa,CAAC,4DAA4D,CAAC;SACjHpB,SAAS,EAAE,IAAI,CAACA,SAAS,CAAC4F;QAC1B,CAAC;OAEF,IAAI,CAACG,wBAAwB,GAAG,IAAIwG,mBAAmB,CAAC;SACvDC,QAAQ,EAAEvJ,EAAE,CAACsB,EAAE,CAACkI,QAAQ,CAACC,OAAO,CAAC,kCAAkC,CAAC;SACpE7M,SAAS,EAAE,IAAI,CAACA,SAAS,CAACuB,aAAa,CAAC,6CAA6C,CAAC;SACtFuL,qBAAqB,EAAE,IAAI,CAAC9M,SAAS,CAACuB,aAAa,CAAC,sDAAsD,CAAC;SAC3GwL,aAAa,EAAE,IAAI,CAAC/M,SAAS,CAACuB,aAAa,CAAC,kDAAkD,CAAC;SAC/FyL,YAAY,EAAE,IAAI,CAAChN,SAAS,CAACuB,aAAa,CAAC,kDAAkD,CAAC;SAC9F0L,qBAAqB,EAAE,IAAI,CAACjN,SAAS,CAACuB,aAAa,CAAC,2DAA2D,CAAC;SAChHpB,SAAS,EAAE,IAAI,CAACA,SAAS,CAAC8F;QAC1B,CAAC;;;KACF;KAAA,qCAGD;OACC,IAAI,CAACxC,uBAAuB,GAAG,IAAIyJ,wBAAwB,CAAC;SAC3DP,QAAQ,EAAEvJ,EAAE,CAACsB,EAAE,CAACkI,QAAQ,CAACC,OAAO,CAAC,kCAAkC,CAAC;SACpE7M,SAAS,EAAE,IAAI,CAACA,SAAS,CAACuB,aAAa,CAAC,iDAAiD,CAAC;SAC1F4L,iBAAiB,EAAE,IAAI,CAACnN,SAAS,CAACuB,aAAa,CAAC,gDAAgD,CAAC;SACjGgF,cAAc,EAAE,IAAI,CAAC3G,IAAI,CAACwN,iBAAiB,EAAE,IAAI,EAAE;SACnD1M,2CAA2C,EAAE,IAAI,CAACA,2CAA2C;SAC7FC,wBAAwB,EAAE,IAAI,CAACA;QAC/B,CAAC;;;KACF;KAAA,oCAE0ByK,OAAe,EAC1C;OACC,IAAI9L,QAAQ,EACZ;SACCA,QAAQ,CAAC+N,OAAO,CAACjC,OAAO,CAAC;;;;KAE1B;KAAA,kCAEwBE,QAAgB,EACzC;OACC,IAAIhM,QAAQ,EACZ;SACCA,QAAQ,CAACgO,WAAW,CAAChC,QAAQ,CAAC;;;;KAE/B;KAAA,2CAEiCiC,MAAsB,EACxD;OACC/L,aAAG,CAAC4H,KAAK,CAACmE,MAAM,CAAClE,UAAU,EAAE,SAAS,EAAE,MAAM,CAAC;;;KAC/C;KAAA,wCAE8BjE,SAAiB,EAChD;OAAA;OACC,cAAA9F,QAAQ,+CAAR,WAAUkO,kBAAkB,CAACpI,SAAS,CAAC;;;KACvC;KAAA,4CAGD;OAAA;OACC,cAAA9F,QAAQ,+CAAR,WAAUoC,iBAAiB,EAAE;;;KAC7B;KAAA,0CAGD;OAAA;;;OAGC,aAAApC,QAAQ,6IAAuB0D,oCAAU,CAACyK,qBAAqB;;;GAC/D;CAAA;CAAA,+BAroBoBC,OAAgB,EACrC;GACC,sCAAI,IAAI,6BACR;KACC;;GAGD,sCAAI,4BAA4B,IAAI;GAEpC5G,qBAAiB,CAChB,2BAAI,oDAAJ,IAAI,EACFF,UAAU,CAAC8G,OAAO,CAAC,CACnB3G,SAAS,CAAC/D,oCAAU,CAAC8H,aAAa,CAAC,CACnC7D,SAAS,EAAE,CAEb;CACF;CAAC,iCA8CD;GACC,OAAOpG,QAAQ,CAACU,aAAa,CAAC,sEAAsE,CAAC;CACtG;CAAC,gCAGD;GACC,OAAOV,QAAQ,CAACU,aAAa,CAAC,6CAA6C,CAAC;CAC7E;CAAC,iCAyKD;GACC,IAAMoM,OAAO,GAAG,IAAI,CAAC9N,KAAK,GACvB,IAAIgK,iCAAO,CAACC,UAAU,CAACpK,IAAI,CAACkO,WAAW,EAAE,GACzC,IAAI/D,iCAAO,CAACC,UAAU,CAACpK,IAAI,CAACmO,SAAS,EAAE;GAG1CF,OAAO,CAAC1D,aAAa,CAAC,IAAI,CAACxJ,UAAU,CAAC;GAEtC,IAAIf,cAAI,CAACa,cAAc,CAAC,IAAI,CAAC4L,gBAAgB,CAAC,EAC9C;KACCwB,OAAO,CAACG,SAAS,CAAC,IAAI,CAAC3B,gBAAgB,CAAC;;GAGzC,IAAI,IAAI,CAACvM,IAAI,CAACwB,KAAK,EAAE,GAAG,CAAC,EACzB;KACCuM,OAAO,CAACtG,KAAK,CAAC,IAAI,CAACzH,IAAI,CAACwB,KAAK,EAAE,CAAC;;GAGjC,IAAMoI,UAAU,GAAG,IAAIC,aAAG,CAACC,SAAS,CAACpG,MAAM,CAACqG,QAAQ,CAACC,IAAI,CAAC,CAAC;GAC3D,IAAIJ,UAAU,CAACW,aAAa,CAAC,eAAe,CAAC,IAAIwD,OAAO,YAAY9D,iCAAO,CAACC,UAAU,CAACpK,IAAI,CAACmO,SAAS,EACrG;KACCF,OAAO,CAACzD,aAAa,CAACV,UAAU,CAACW,aAAa,CAAC,eAAe,CAAC,CAAC;;GAGjE,OAAOwD,OAAO;CACf;CAiYDvO,SAAS,CAACG,UAAU,GAAGA,UAAU;CAAC,IAE5BmN,mBAAmB;GAYxB,6BAAYqB,OAAO,EACnB;KAAA;KACC,IAAI,CAACpB,QAAQ,GAAGoB,OAAO,CAACpB,QAAQ;KAChC,IAAI,CAAC3M,SAAS,GAAG+N,OAAO,CAAC/N,SAAS;KAClC,IAAI,CAAC8M,qBAAqB,GAAGiB,OAAO,CAACjB,qBAAqB;KAC1D,IAAI,CAACC,aAAa,GAAGgB,OAAO,CAAChB,aAAa;KAC1C,IAAI,CAACC,YAAY,GAAGe,OAAO,CAACf,YAAY;KACxC,IAAI,CAACC,qBAAqB,GAAGc,OAAO,CAACd,qBAAqB;KAC1D,IAAI,CAAC9M,SAAS,GAAG4N,OAAO,CAAC5N,SAAS;KAElC,IAAI,CAAC6N,aAAa,EAAE;KAEpB,IAAI,CAACC,kBAAkB,EAAE;KAEzB,IAAI,CAAC/M,UAAU,EAAE;KAEjB,IAAI,CAACgN,MAAM,EAAE;;GACb;KAAA;KAAA,gCAGD;OACC,IAAMC,eAAe,GAAG,EAAE;OAC1B,IAAMC,aAAa,GAAG,EAAE;OACxB,IAAMC,cAAc,GAAG,EAAE;OACzB,IAAMC,YAAY,GAAG,EAAE;OACvB,IAAI,CAACnO,SAAS,CAACoC,OAAO,CAAC,UAACgM,QAAkB,EAAK;SAC9C,IAAMC,IAAI,GAAG;WACZpC,EAAE,EAAEmC,QAAQ,CAACxG,YAAY;WACzB0G,QAAQ,EAAE,SAAS;WACnB9C,KAAK,EAAE4C,QAAQ,CAAC5C,KAAK;WACrBV,IAAI,EAAE;UACN;SACD,IAAIsD,QAAQ,CAAC9B,SAAS,EACtB;WACC2B,aAAa,CAACtG,IAAI,CAAC0G,IAAI,CAAC;WAExB,IAAID,QAAQ,CAACG,qBAAqB,EAClC;aACCJ,YAAY,CAACxG,IAAI,CAAC0G,IAAI,CAAC;YACvB,MAED;aACCH,cAAc,CAACvG,IAAI,CAAC0G,IAAI,CAAC;;UAE1B,MAED;WACCL,eAAe,CAACrG,IAAI,CAAC0G,IAAI,CAAC;;QAE3B,CAAC;OAEF,IAAI,CAACG,YAAY,GAAG,IAAIC,6BAAW,CAAC;SACnCC,aAAa,EAAE;WACdC,YAAY,EAAE,KAAK;WACnBC,QAAQ,EAAE,KAAK;WACfC,KAAK,EAAEb,eAAe;WACtBc,aAAa,EAAEb,aAAa;WAC5Bc,YAAY,EAAE,IAAI;WAClBC,MAAM,EAAE,GAAG;WACXC,WAAW,EAAE;UACb;SACDC,MAAM,EAAE;WACPC,aAAa,EAAE,IAAI,CAACpB,MAAM,CAACnM,IAAI,CAAC,IAAI,CAAC;WACrCwN,gBAAgB,EAAE,IAAI,CAACrB,MAAM,CAACnM,IAAI,CAAC,IAAI;;QAExC,CAAC;OACF,IAAI,CAAC4M,YAAY,CAACa,QAAQ,CAAC,IAAI,CAAC1C,qBAAqB,CAAC;OAEtD,IAAI,CAAC2C,YAAY,GAAG,IAAIb,6BAAW,CAAC;SACnCC,aAAa,EAAE;WACdC,YAAY,EAAE,KAAK;WACnBC,QAAQ,EAAE,KAAK;WACfC,KAAK,EAAEX,cAAc;WACrBY,aAAa,EAAEX,YAAY;WAC3BY,YAAY,EAAE,IAAI;WAClBC,MAAM,EAAE,GAAG;WACXC,WAAW,EAAE;;QAEd,CAAC;OACF,IAAI,CAACK,YAAY,CAACD,QAAQ,CAAC,IAAI,CAACvC,qBAAqB,CAAC;;;KACtD;KAAA,qCAGD;OACC,IAAMmB,aAAa,GAAG,IAAI,CAACO,YAAY,CAACe,SAAS,EAAE,CAACC,gBAAgB,EAAE;OACtE,IAAIvB,aAAa,CAACzI,MAAM,GAAG,CAAC,EAC5B;SACC,IAAI,CAACgH,QAAQ,CAACiD,KAAK,CAAC,IAAI,CAAC;;OAE1B,IAAI,CAAC5C,YAAY,CAACnF,OAAO,GAAG,IAAI,CAAC4H,YAAY,CAACC,SAAS,EAAE,CAACC,gBAAgB,EAAE,CAAChK,MAAM,GAAG,CAAC;;;KACvF;KAAA,6BAGD;OACCjD,6BAAY,CAACC,SAAS,CAAC,IAAI,CAACgK,QAAQ,EAAE,SAAS,EAAE,IAAI,CAACuB,MAAM,CAACnM,IAAI,CAAC,IAAI,CAAC,CAAC;OACxED,eAAK,CAACC,IAAI,CAAC,IAAI,CAACiL,YAAY,EAAE,OAAO,EAAE,IAAI,CAACkB,MAAM,CAACnM,IAAI,CAAC,IAAI,CAAC,CAAC;;;KAC9D;KAAA,yBAGD;OAAA;OACC,IAAI,IAAI,CAAC4K,QAAQ,CAACF,SAAS,EAAE,EAC7B;SACCjL,aAAG,CAACG,WAAW,CAAC,IAAI,CAAC3B,SAAS,EAAE,iBAAiB,CAAC;QAClD,MAED;SACCwB,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACzB,SAAS,EAAE,iBAAiB,CAAC;;OAEhD,IAAMoO,aAAa,GAAG,IAAI,CAACO,YAAY,CAACe,SAAS,EAAE,CAACC,gBAAgB,EAAE;OACtE,IAAIvB,aAAa,CAACzI,MAAM,GAAG,CAAC,EAC5B;SACCnE,aAAG,CAACG,WAAW,CAAC,IAAI,CAACoL,aAAa,EAAE,iBAAiB,CAAC;QACtD,MAED;SACCvL,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACsL,aAAa,EAAE,iBAAiB,CAAC;;OAGpD,IAAI,IAAI,CAACC,YAAY,CAACnF,OAAO,EAC7B;SACCrG,aAAG,CAACG,WAAW,CAAC,IAAI,CAACsL,qBAAqB,EAAE,iBAAiB,CAAC;QAC9D,MAED;SACCzL,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACwL,qBAAqB,EAAE,iBAAiB,CAAC;;OAG5D,IAAI,CAACwC,YAAY,CAACC,SAAS,EAAE,CAACG,QAAQ,EAAE,CAACtN,OAAO,CAAC,UAACiM,IAAI,EAAK;SAC1D,IAAI,CAAC,OAAI,CAACsB,cAAc,CAACtB,IAAI,EAAEJ,aAAa,CAAC,EAC7C;WACCI,IAAI,CAACuB,QAAQ,EAAE;WACf,OAAI,CAACN,YAAY,CAACC,SAAS,EAAE,CAACM,UAAU,CAACxB,IAAI,CAAC;WAC9C,OAAI,CAACiB,YAAY,CAACQ,SAAS,CAAC;aAC3B7D,EAAE,EAAEoC,IAAI,CAACpN,KAAK,EAAE;aAChBqN,QAAQ,EAAED,IAAI,CAAC0B,WAAW;YAC1B,CAAC;;QAEH,CAAC;OACF9B,aAAa,CAAC7L,OAAO,CAAC,UAACiM,IAAI,EAAK;SAC/B,IAAM2B,QAAQ,GAAG;WAChB/D,EAAE,EAAEoC,IAAI,CAACpN,KAAK,EAAE;WAChBqN,QAAQ,EAAED,IAAI,CAAC0B,WAAW,EAAE;WAC5BvE,KAAK,EAAE6C,IAAI,CAAC4B,QAAQ,EAAE;WACtBnF,IAAI,EAAE;UACN;SACD,IAAMoF,OAAO,GAAG,OAAI,CAACZ,YAAY,CAACC,SAAS,EAAE,CAACY,OAAO,CAACH,QAAQ,CAAC;SAC/D,IAAI,CAACE,OAAO,EACZ;WACC,IAAME,OAAO,GAAG,OAAI,CAACd,YAAY,CAACC,SAAS,EAAE,CAACc,OAAO,CAACL,QAAQ,CAAC;WAC/DI,OAAO,CAACE,MAAM,EAAE;;QAEjB,CAAC;;;KACF;KAAA,+BAEcjC,IAAI,EAAES,aAAoB,EACzC;OACC,OAAOA,aAAa,CAACyB,IAAI,CAAC,UAACC,YAAY,EAAK;SAC3C,OAAOnC,IAAI,CAACpC,EAAE,KAAKuE,YAAY,CAACvE,EAAE;QAClC,CAAC;;;KACF;KAAA,0BAGD;OAAA;OACC,IAAM9G,IAAI,GAAG,EAAE;OACf,IAAI,CAAC,IAAI,CAACqH,QAAQ,CAACF,SAAS,EAAE,EAC9B;SACC,OAAO,EAAE;;OAEV,IAAMmE,qBAAqB,GAAG,IAAI,CAAC5D,YAAY,CAACnF,OAAO;OACvD,IAAMuG,aAAa,GAAG,IAAI,CAACO,YAAY,CAACe,SAAS,EAAE,CAACC,gBAAgB,EAAE;OACtEvB,aAAa,CAAC7L,OAAO,CAAC,UAACsO,YAAY,EAAK;SACvC,IAAMjR,IAAI,GAAG;WACZmI,YAAY,EAAE8I,YAAY,CAACzP,KAAK,EAAE;WAClCsN,qBAAqB,EAAE;UACvB;SACD,IACCkC,qBAAqB,IAClB,OAAI,CAACd,cAAc,CAACe,YAAY,EAAE,OAAI,CAACpB,YAAY,CAACC,SAAS,EAAE,CAACC,gBAAgB,EAAE,CAAC,EAEvF;WACC/P,IAAI,CAAC8O,qBAAqB,GAAG,IAAI;;SAElCpJ,IAAI,CAACwC,IAAI,CAAClI,IAAI,CAAC;QACf,CAAC;OAEF,OAAO0F,IAAI;;;GACX;CAAA;CAAA,IAGI4H,wBAAwB;GAe7B,kCAAYa,OAOX,EACD;KAAA;KACC,IAAI,CAACpB,QAAQ,GAAGoB,OAAO,CAACpB,QAAQ;KAChC,IAAI,CAAC3M,SAAS,GAAG+N,OAAO,CAAC/N,SAAS;KAClC,IAAI,CAACmN,iBAAiB,GAAGY,OAAO,CAACZ,iBAAiB;KAClD,IAAIzN,cAAI,CAACoR,OAAO,CAAC/C,OAAO,CAACxH,cAAc,CAAC,EACxC;OACC,IAAI,CAACA,cAAc,GAAGwH,OAAO,CAACxH,cAAc;MAC5C,MAED;OACC,IAAI,CAACA,cAAc,GAAG,EAAE;;KAGzB,IAAI7G,cAAI,CAACqR,SAAS,CAAChD,OAAO,CAACrN,2CAA2C,CAAC,EACvE;OACC,IAAI,CAACA,2CAA2C,GAAGqN,OAAO,CAACrN,2CAA2C;;KAGvG,IAAIhB,cAAI,CAACqR,SAAS,CAAChD,OAAO,CAACpN,wBAAwB,CAAC,EACpD;OACC,IAAI,CAACA,wBAAwB,GAAGoN,OAAO,CAACpN,wBAAwB;;KAGjE,IAAI,CAACqQ,YAAY,EAAE;KAEnB,IAAI,CAACC,iBAAiB,GAAGC,aAAG,CAACC,MAAM,uPAES7G,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,CAEzG;KACD,IAAI,CAACvK,SAAS,CAACoR,MAAM,CAAC,IAAI,CAACH,iBAAiB,CAAC;KAE7C,IAAI,CAAChD,kBAAkB,EAAE;KAEzB,IAAI,CAAC/M,UAAU,EAAE;KAEjB,IAAI,CAACgN,MAAM,EAAE;;GACb;KAAA;KAAA,0BAGD;OAAA;OACC,IAAI,CAACmD,YAAY,EAAE;OACnB,sBAAI,CAACC,QAAQ,mDAAb,eAAeC,cAAc,EAAE;;;KAC/B;KAAA,+BAGD;OACC,IAAMvC,KAAK,GAAG,EAAE;OAChB,IAAMC,aAAa,GAAG,EAAE;OAExB,IAAI,CAAC1I,cAAc,CAAChE,OAAO,CAAC,UAACiP,OAAO,EAAK;SACxC,IAAMhD,IAAI,GAAG;WACZpC,EAAE,EAAEoF,OAAO,CAACpF,EAAE;WACdqC,QAAQ,EAAE,gBAAgB;WAC1B9C,KAAK,EAAE6F,OAAO,CAAC7F,KAAK;WACpBV,IAAI,EAAE;UACN;SAED+D,KAAK,CAAClH,IAAI,CAAC0G,IAAI,CAAC;SAEhB,IAAIgD,OAAO,CAACC,UAAU,EACtB;WACCxC,aAAa,CAACnH,IAAI,CAAC0G,IAAI,CAAC;;QAEzB,CAAC;OAEF,IAAMkD,kBAAkB,GAAG;SAC1B3C,QAAQ,EAAE,KAAK;SACfF,aAAa,EAAE;WACdG,KAAK,EAALA,KAAK;WACLC,aAAa,EAAbA,aAAa;WACbC,YAAY,EAAE,IAAI;WAClBC,MAAM,EAAE,GAAG;WACXC,WAAW,EAAE;;QAEd;OAED,IAAI,IAAI,CAAC1O,2CAA2C,EACpD;SACCgR,kBAAkB,CAACC,gBAAgB,GAAG,KAAK;SAC3CD,kBAAkB,CAAC7C,aAAa,CAAC+C,MAAM,GAAGV,aAAG,CAACC,MAAM,gOAEvC,IAAI,CAACU,0CAA0C,CAAC9P,IAAI,CAAC,IAAI,CAAC,EAEnEuI,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAC7C;QACD,MAED;SACCmH,kBAAkB,CAACC,gBAAgB,GAAG,IAAI;SAC1CD,kBAAkB,CAACI,mBAAmB,GAAGxH,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;SACnFmH,kBAAkB,CAACrC,MAAM,GAAG;WAC3B0C,mBAAmB,EAAE,IAAI,CAACA,mBAAmB,CAAChQ,IAAI,CAAC,IAAI;UACvD;;OAGF,IAAI,CAAC,IAAI,CAACpB,wBAAwB,EAClC;SACC+Q,kBAAkB,CAACM,MAAM,GAAG,IAAI;;OAGjC,IAAI,CAACV,QAAQ,GAAG,IAAI1C,6BAAW,CAAC8C,kBAAkB,CAAC;OACnD,IAAI,CAACJ,QAAQ,CAAC9B,QAAQ,CAAC,IAAI,CAACrC,iBAAiB,CAAC;;;KAC9C;KAAA,iCAGD;OACC,IAAI,CAACmE,QAAQ,CAAC5B,SAAS,EAAE,CAACnM,OAAO,EAAE;OACnC,IAAI,CAAC+N,QAAQ,CAACC,cAAc,EAAE;OAC9B,IAAI,CAACD,QAAQ,GAAG,IAAI;OACpB9P,aAAG,CAACyQ,KAAK,CAAC,IAAI,CAAC9E,iBAAiB,CAAC;OACjC,IAAI,CAAC6D,YAAY,EAAE;;;KACnB;KAAA,+BAGD;OACCxP,aAAG,CAACG,WAAW,CAAC,IAAI,CAACwL,iBAAiB,EAAE,iBAAiB,CAAC;;;KAC1D;KAAA,+BAGD;OACC3L,aAAG,CAACC,QAAQ,CAAC,IAAI,CAAC0L,iBAAiB,EAAE,iBAAiB,CAAC;;;KACvD;KAAA,qCAGD;OACC,IAAM+E,eAAe,GAAG,IAAI,CAACZ,QAAQ,CAAC5B,SAAS,EAAE,CAACC,gBAAgB,EAAE;OACpE,IAAIuC,eAAe,CAACvM,MAAM,GAAG,CAAC,EAC9B;SACC,IAAI,CAACgH,QAAQ,CAACiD,KAAK,CAAC,IAAI,CAAC;;;;KAE1B;KAAA,6BAGD;OACC,IAAI,CAAC1B,MAAM,GAAG,IAAI,CAACA,MAAM,CAACnM,IAAI,CAAC,IAAI,CAAC;OACpC,IAAI,CAACoQ,yBAAyB,GAAG,IAAI,CAACA,yBAAyB,CAACpQ,IAAI,CAAC,IAAI,CAAC;OAE1EW,6BAAY,CAACC,SAAS,CAAC,IAAI,CAACgK,QAAQ,EAAE,SAAS,EAAE,IAAI,CAACuB,MAAM,CAAC;OAC7D,IAAI,IAAI,CAACxN,2CAA2C,EACpD;SACCkI,qCAAgB,CAACR,QAAQ,CAACgK,sCAAsC,CAC/D,IAAI,CAACD,yBAAyB,CAC9B;;;;KAEF;KAAA,+BAGD;OACCzP,6BAAY,CAACc,WAAW,CAAC,IAAI,CAACmJ,QAAQ,EAAE,SAAS,EAAE,IAAI,CAACuB,MAAM,CAAC;OAC/DtF,qCAAgB,CAACR,QAAQ,CAACiK,wCAAwC,CAAC,IAAI,CAACF,yBAAyB,CAAC;;;KAClG;KAAA,0CAEyBnQ,KAAgB,EAC1C;OACC,IAAMoK,EAAE,GAAGJ,cAAI,CAACsG,SAAS,CAACtQ,KAAK,CAACY,OAAO,EAAE,CAAC2P,uBAAuB,CAAC;OAClE,IAAM5G,KAAK,GAAG6G,MAAM,CAACxQ,KAAK,CAACY,OAAO,EAAE,CAAC+I,KAAK,CAAC;OAE3C,IAAIS,EAAE,IAAI,CAAC,IAAI,CAAC1M,cAAI,CAACa,cAAc,CAACoL,KAAK,CAAC,EAC1C;SACC;;OAGD,IAAM8G,oBAAoB,GAAG,IAAI,CAAClM,cAAc,CAACmM,IAAI,CACpD,UAAClB,OAAO;SAAA,OAAKxF,cAAI,CAACsG,SAAS,CAACd,OAAO,CAACpF,EAAE,CAAC,KAAKA,EAAE;SAC9C;OAED,IAAIqG,oBAAoB,EACxB;SACCA,oBAAoB,CAAC9G,KAAK,GAAGA,KAAK;QAClC,MAED;SACC,IAAI,CAACpF,cAAc,CAACuB,IAAI,CAAC;WACxBsE,EAAE,EAAFA,EAAE;WACFT,KAAK,EAALA;UACA,CAAC;;OAGH,IAAI,CAACgH,cAAc,EAAE;OAErB,IAAI,CAACC,uBAAuB,CAACxG,EAAE,CAAC;;;KAChC;KAAA,wCAEuBA,EAAU,EAClC;OAAA;OACC,IAAMyG,MAAM,GAAG,IAAI,CAACvB,QAAQ,CAAC5B,SAAS,EAAE;OAExCmD,MAAM,CAACC,WAAW,EAAE;OACpB,mBAAAD,MAAM,CAACvC,OAAO,CAAC;SACd7B,QAAQ,EAAE,gBAAgB;SAC1BrC,EAAE,EAAFA;QACA,CAAC,oDAHF,gBAGIqE,MAAM,EAAE;;;KACZ;KAAA,6DAGD;OACC,KAAKtI,iBAAM,CAACC,QAAQ,CAAC2K,2BAA2B,EAAE;;;KAClD;KAAA,sCAGD;OACC,IAAI,CAACC,YAAY,EAAE;OACnB,IAAI,CAACC,gBAAgB,EAAE;;;KACvB;KAAA,uCAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAACC,qBAAqB,EAC/B;SACC,IAAI,CAACA,qBAAqB,GAAGhC,aAAG,CAACC,MAAM,gJAA6D;SACpG,IAAI,CAACF,iBAAiB,CAACG,MAAM,CAAC,IAAI,CAAC8B,qBAAqB,CAAC;;OAG1D,IAAI,CAACC,kBAAkB,CAAC,IAAI,CAACD,qBAAqB,CAAC;OAEnD,IAAI,CAAC,IAAI,CAACE,oBAAoB,EAC9B;SACC,IAAI,CAACA,oBAAoB,GAAGlC,aAAG,CAACC,MAAM,gVAIxB;WAAA,OAAM,OAAI,CAAC+B,qBAAqB,CAAC9B,MAAM,CAAC,OAAI,CAACiC,iBAAiB,EAAE,CAAC;YAE1E/I,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAG9C;SACD,IAAI,CAAC0G,iBAAiB,CAACG,MAAM,CAAC,IAAI,CAACgC,oBAAoB,CAAC;;OAGzD,IAAI,CAAC,IAAI,CAACE,gBAAgB,EAC1B;SACC,IAAI,CAACrC,iBAAiB,CAACG,MAAM,CAACF,aAAG,CAACC,MAAM,gIAA6C;SACrF,IAAI,CAACmC,gBAAgB,GAAGpC,aAAG,CAACC,MAAM,mJAAgE;SAClG,IAAI,CAACF,iBAAiB,CAACG,MAAM,CAAC,IAAI,CAACkC,gBAAgB,CAAC;;OAGrD,IAAI,CAAC,IAAI,CAACvS,UAAU,EACpB;SACC,IAAI,CAACA,UAAU,GAAGmQ,aAAG,CAACC,MAAM,sJAAgD,IAAI,CAACoC,mBAAmB,CAACxR,IAAI,CAAC,IAAI,CAAC,EAAKuI,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAAS;SACrK,IAAI,CAAC+I,gBAAgB,CAAClC,MAAM,CAAC,IAAI,CAACrQ,UAAU,CAAC;;OAG9C,IAAI,CAAC,IAAI,CAACC,YAAY,EACtB;SACC,IAAI,CAACA,YAAY,GAAGkQ,aAAG,CAACC,MAAM,2JAAqD,IAAI,CAACqC,qBAAqB,CAACzR,IAAI,CAAC,IAAI,CAAC,EAAKuI,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAAS;SAChL,IAAI,CAAC+I,gBAAgB,CAAClC,MAAM,CAAC,IAAI,CAACpQ,YAAY,CAAC;;;;KAEhD;KAAA,oCAEmBgB,KAAiB,EACrC;OACCA,KAAK,CAAC8C,cAAc,EAAE;OAEtB,IAAMoN,eAAe,GAAG,IAAI,CAACuB,kBAAkB,EAAE;OACjD,IAAMC,iBAAiB,GAAG,EAAE;OAC5B,+BAAI,IAAI,CAACR,qBAAqB,CAACS,QAAQ,EAAEpR,OAAO,CAAC,UAAC8J,IAAI,EAAK;SAC1D,IAAMuH,OAAO,GAAGvH,IAAI,CAAC9K,aAAa,CAAC,aAAa,CAAC;SACjD,IAAMsS,UAAU,GAAGxH,IAAI,CAAC9K,aAAa,CAAC,gBAAgB,CAAC;SACvD,IAAI,CAACqS,OAAO,IAAI,CAACC,UAAU,EAC3B;WACC;;SAED,IAAMzH,EAAE,GAAGwH,OAAO,CAAC3O,KAAK;SACxB,IAAM0G,KAAK,GAAGkI,UAAU,CAAC5O,KAAK;SAC9B,IAAIwM,UAAU,GAAG,KAAK;SACtB,IAAIS,eAAe,IAAIA,eAAe,CAAC9F,EAAE,KAAKA,EAAE,EAChD;WACCqF,UAAU,GAAG,IAAI;;SAGlB,IAAI9F,KAAK,EACT;WACC+H,iBAAiB,CAAC5L,IAAI,CAAC;aACtBsE,EAAE,EAAFA,EAAE;aACFT,KAAK,EAALA,KAAK;aACL8F,UAAU,EAAVA;YACA,CAAC;;QAEH,CAAC;OAEF,IAAI,CAAClL,cAAc,GAAGmN,iBAAiB;OAEvC,IAAI,CAACf,cAAc,EAAE;OACrB,IAAI,CAACmB,YAAY,EAAE;OAEnB,IAAI,CAACC,gBAAgB,EAAE;;;KACvB;KAAA,sCAEqB/R,KAAiB,EACvC;OACCA,KAAK,CAAC8C,cAAc,EAAE;OACtB,IAAI,CAACgP,YAAY,EAAE;OACnB,IAAI,CAACC,gBAAgB,EAAE;;;KACvB;KAAA,mCAEkBC,aAA6B,EAChD;OAAA;OACCxS,aAAG,CAACyQ,KAAK,CAAC+B,aAAa,CAAC;OACxB,IAAI,CAACzN,cAAc,CAAChE,OAAO,CAAC,UAACiP,OAAO,EAAK;SACxCwC,aAAa,CAAC5C,MAAM,CAAC,OAAI,CAACiC,iBAAiB,CAAC7B,OAAO,CAAC,CAAC;QACrD,CAAC;OAEFwC,aAAa,CAAC5C,MAAM,CAAC,IAAI,CAACiC,iBAAiB,EAAE,CAAC;;;KAC9C;KAAA,kCAEiB7B,OAAuB,EACzC;OAAA;OACC,IAAMhD,IAAI,GAAG,IAAIyF,iBAAiB,CAACzC,OAAO,CAAC;OAC3C,IAAMnF,IAAI,GAAG6E,aAAG,CAACC,MAAM,mdAEmB3C,IAAI,CAACpN,KAAK,EAAE,EACY4K,cAAI,CAACC,MAAM,CAACuC,IAAI,CAAC0F,QAAQ,EAAE,CAAC,EAGhF,UAAClS,KAAK,EAAK;SACrBA,KAAK,CAAC8C,cAAc,EAAE;SACtB,OAAI,CAACoO,qBAAqB,CAACiB,WAAW,CAAC3F,IAAI,CAAC4F,OAAO,EAAE,CAAC;QACtD,CAGH;OAED5F,IAAI,CAAC6F,OAAO,CAAChI,IAAI,CAAC;OAElB,OAAOA,IAAI;;;KACX;KAAA,mCAGD;OACC,IAAI,CAACiI,oBAAoB,EAAE;OAC3B9S,aAAG,CAACG,WAAW,CAAC,IAAI,CAACsP,iBAAiB,EAAE,iBAAiB,CAAC;;;KAC1D;KAAA,mCAGD;OACCzP,aAAG,CAACyQ,KAAK,CAAC,IAAI,CAACiB,qBAAqB,CAAC;OACrC1R,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACwP,iBAAiB,EAAE,iBAAiB,CAAC;;;KACvD;KAAA,yBAGD;OACC,IAAI,IAAI,CAACtE,QAAQ,CAACF,SAAS,EAAE,EAC7B;SACCjL,aAAG,CAACG,WAAW,CAAC,IAAI,CAAC3B,SAAS,EAAE,iBAAiB,CAAC;QAClD,MAED;SACCwB,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACzB,SAAS,EAAE,iBAAiB,CAAC;;;;KAEhD;KAAA,qCAGD;OACC,IAAMiP,aAAa,GAAG,IAAI,CAACqC,QAAQ,CAAC5B,SAAS,EAAE,CAACC,gBAAgB,EAAE;OAClE,IAAIV,aAAa,CAACtJ,MAAM,GAAG,CAAC,EAC5B;SACC,OAAO;WACNyG,EAAE,EAAE6C,aAAa,CAAC,CAAC,CAAC,CAAC7N,KAAK,EAAE;WAC5BuK,KAAK,EAAEsD,aAAa,CAAC,CAAC,CAAC,CAACmB,QAAQ;UAChC;;OAGF,OAAO,IAAI;;;KACX;KAAA,0BAGD;OACC,IAAM9K,IAAI,GAAG;SACZe,eAAe,EAAE,CAAC;SAClBE,cAAc,EAAE,IAAI,CAACA;QACrB;OAED,IAAI,IAAI,CAACoG,QAAQ,CAACF,SAAS,EAAE,EAC7B;SACC,IAAMyF,eAAe,GAAG,IAAI,CAACuB,kBAAkB,EAAE;SACjD,IAAIvB,eAAe,EACnB;WACC5M,IAAI,CAACe,eAAe,GAAG6L,eAAe,CAAC9F,EAAE;;;OAI3C,OAAO9G,IAAI;;;GACX;CAAA;CAAA,IAGI2O,iBAAiB;GAEtB,6BACA;KAAA,IADYM,aAA4B,uEAAG,IAAI;KAAA;KAE9C,IAAI,CAACnI,EAAE,GAAGmI,aAAa,GAAGA,aAAa,CAACnI,EAAE,iBAAUJ,cAAI,CAACwI,SAAS,EAAE,CAAE;KACtE,IAAI,CAACvP,KAAK,GAAGsP,aAAa,GAAGA,aAAa,CAAC5I,KAAK,GAAG,EAAE;;GACrD;KAAA;KAAA,wBAEOU,IAAa,EACrB;OACC,IAAI,CAACA,IAAI,GAAGA,IAAI;;;KAChB;KAAA,wBAGD;OACC,OAAO,IAAI,CAACD,EAAE;;;KACd;KAAA,0BAGD;OACC,OAAO,IAAI,CAACC,IAAI;;;KAChB;KAAA,2BAGD;OACC,IAAMA,IAAI,GAAG,IAAI,CAAC+H,OAAO,EAAE;OAC3B,IAAI,CAAC/H,IAAI,EACT;SACC,OAAO,IAAI;;OAGZ,IAAIA,IAAI,YAAYoI,gBAAgB,EACpC;SACC,OAAOpI,IAAI;;OAGZ,OAAOA,IAAI,CAAC9K,aAAa,CAAC,OAAO,CAAC;;;KAClC;KAAA,2BAGD;OACC,IAAMmT,KAAK,GAAG,IAAI,CAACC,QAAQ,EAAE;OAC7B,IAAID,KAAK,IAAIA,KAAK,CAACzP,KAAK,EACxB;SACC,OAAOyP,KAAK,CAACzP,KAAK;;OAGnB,OAAO,IAAI,CAACA,KAAK,IAAI,EAAE;;;GACvB;CAAA;;;;"}