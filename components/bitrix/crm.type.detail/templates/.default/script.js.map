{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Dom, Event, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { CustomSection, TypeModel, TypeModelData } from 'crm.type-model';\nimport { Router } from 'crm.router';\nimport { TagSelector } from 'ui.entity-selector';\n\ndeclare type Preset = {\n\tfields: {\n\t\tid: string,\n\t\ttitle: string,\n\t\tcategory: string,\n\t\tdescription: string,\n\t\ticon: string,\n\t},\n\tdata: TypeModelData\n}\n\ndeclare type Relation = {\n\ttitle: string,\n\tisChecked: boolean,\n\tentityTypeId: number,\n\tisChildrenListEnabled: boolean,\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nlet instance: TypeDetail = null;\n\n/**\n * @memberOf BX.Crm.Component\n */\nclass TypeDetail\n{\n    form;\n    type: TypeModel;\n    isProgress: boolean = false;\n\tcontainer: Element;\n\terrorsContainer: Element;\n    isNew: boolean;\n\ttabs: Map<string, Element> = new Map();\n\tpresets: Array;\n\trelations: {\n\t\tparent: Relation[],\n\t\tchild: Relation[],\n\t};\n\tparentRelationsController: RelationsController;\n\tchildRelationsController: RelationsController;\n\tcustomSectionController: ?CustomSectionsController;\n\tisRestricted: boolean = false;\n\n    constructor(params: {\n        form: Element,\n        type: TypeModel,\n        container: Element,\n        errorsContainer: Element,\n\t\tpresets?: Array,\n\t\trelations: {\n        \tparent: Relation[],\n\t\t\tchild: Relation[],\n\t\t},\n    })\n    {\n        if(Type.isPlainObject(params))\n        {\n            this.type = params.type;\n            this.isNew = !this.type.isSaved();\n            this.form = params.form;\n            this.container = params.container;\n            this.errorsContainer = params.errorsContainer;\n            this.presets = params.presets;\n            this.relations = params.relations;\n            this.isRestricted = Boolean(params.isRestricted);\n        }\n\n        this.saveButton = document.getElementById('ui-button-panel-save');\n        this.cancelButton = document.getElementById('ui-button-panel-cancel');\n        this.deleteButton = document.getElementById('ui-button-panel-remove');\n\n        instance = this;\n    }\n\n    init()\n    {\n        this.bindEvents();\n\n        this.fillTabs();\n\n        if (!this.type.getId())\n\t\t{\n\t\t\tthis.enablePresetsView()\n\t\t}\n        else\n\t\t{\n\t\t\t// const customPreset = this.getPresetById('bitrix:empty');\n\t\t\t// const presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\t\t// if (customPreset && presetSelector)\n\t\t\t// {\n\t\t\t// \tpresetSelector.textContent = customPreset.fields.title;\n\t\t\t// }\n\t\t\tthis.disablePresetsView();\n\t\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\t\tif (presetSelectorContainer)\n\t\t\t{\n\t\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-hidden');\n\n        this.initRelations();\n\n        this.initCustomSections();\n    }\n\n    bindEvents()\n    {\n        Event.bind(this.saveButton, 'click', (event) => {\n                this.save(event);\n            }, {\n                passive: false\n            }\n        );\n\n        if(this.deleteButton)\n        {\n            Event.bind(this.deleteButton, 'click', (event) => {\n                this.delete(event);\n            });\n        }\n\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (userFieldOption)\n\t\t{\n\t\t\tEvent.bind(userFieldOption, 'click', this.disableLinkedUserFieldsIfNotAvailable.bind(this));\n\t\t}\n\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tEvent.bind(linkedUserFieldNode, 'click', this.enableUserFieldIfAnyLinkedChecked.bind(this));\n\t\t});\n    }\n\n\tenablePresetsView()\n\t{\n\t\tDom.addClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst activeTab = this.container.querySelector('.crm-type-tab-current');\n\t\tif (activeTab)\n\t\t{\n\t\t\tDom.removeClass(activeTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetsTab = this.container.querySelector('[data-tab=\"presets\"]');\n\t\tif (presetsTab)\n\t\t{\n\t\t\tDom.addClass(presetsTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.removeClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t}\n\n\tdisablePresetsView()\n\t{\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst commonTab = document.querySelector('[data-role=\"tab-common\"]');\n\t\tif (commonTab)\n\t\t{\n\t\t\tcommonTab.click();\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.removeClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.addClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t}\n\n    disableLinkedUserFieldsIfNotAvailable()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tthis.setBooleanFieldCheckedState(linkedUserFieldNode, false);\n\t\t\t});\n\t\t}\n\t}\n\n\tenableUserFieldIfAnyLinkedChecked()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tif (this.isBooleanFieldChecked(linkedUserFieldNode))\n\t\t\t\t{\n\t\t\t\t\tthis.setBooleanFieldCheckedState(userFieldOption, true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n    getLoader()\n    {\n        if(!this.loader)\n        {\n            this.loader = new Loader({size: 150});\n        }\n\n        return this.loader;\n    }\n\n    startProgress()\n    {\n        this.isProgress = true;\n        if(!this.getLoader().isShown())\n        {\n            this.getLoader().show(this.form);\n        }\n        this.hideErrors();\n    }\n\n    stopProgress()\n    {\n        this.isProgress = false;\n        this.getLoader().hide();\n        setTimeout(() =>\n        {\n            Dom.removeClass(this.saveButton, 'ui-btn-wait');\n            Dom.removeClass(this.cancelButton, 'ui-btn-wait');\n            if(this.deleteButton)\n            {\n                Dom.removeClass(this.deleteButton, 'ui-btn-wait');\n            }\n        }, 200);\n    }\n\n    save(event)\n    {\n    \tif (this.isRestricted)\n\t\t{\n\t\t\tRouter.Instance.showFeatureSlider();\n\t\t\tthis.stopProgress();\n\t\t\treturn;\n\t\t}\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        this.startProgress();\n\n        this.type.setTitle(this.form.querySelector('[name=\"title\"]').value);\n        TypeModel.getBooleanFieldNames().forEach((fieldName) => {\n        \tconst fieldNode = this.getBooleanFieldNodeByName(fieldName);\n        \tif (fieldNode)\n\t\t\t{\n\t\t\t\tthis.type.data[fieldName] = this.isBooleanFieldChecked(fieldNode);\n\t\t\t}\n\t\t});\n\t\t// this.type.setConversionMap({\n\t\t// \tsourceTypes: this.collectEntityTypeIds('conversion-source'),\n\t\t// \tdestinationTypes: this.collectEntityTypeIds('conversion-destination'),\n\t\t// });\n\t\tconst linkedUserFields = {};\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tconst name = linkedUserFieldNode.dataset.name.substr('linkedUserFields['.length).replace(']', '')\n\t\t\tlinkedUserFields[name] = this.isBooleanFieldChecked(linkedUserFieldNode);\n\t\t});\n\t\tthis.type.setLinkedUserFields(linkedUserFields);\n\t\tthis.type.setRelations({\n\t\t\tparent: this.parentRelationsController.getData(),\n\t\t\tchild: this.childRelationsController.getData(),\n\t\t});\n\t\tif (this.customSectionController)\n\t\t{\n\t\t\tconst customSectionData = this.customSectionController.getData();\n\t\t\tthis.type.setCustomSectionId(customSectionData.customSectionId);\n\t\t\tthis.type.setCustomSections(customSectionData.customSecions);\n\t\t}\n\n\t\tthis.type.save().then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.afterSave(response);\n\t\t\tthis.isNew = false;\n\t\t}).catch( (errors) => {\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n    }\n\n\tcollectEntityTypeIds(role: string): []\n\t{\n\t\tconst entityTypeIds = [];\n\n\t\tconst checkboxes = this.container.querySelectorAll(`[data-role=\"${role}\"]`);\n\t\tArray.from(checkboxes).forEach( (checkbox: HTMLInputElement) =>\n\t\t{\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tentityTypeIds.push(checkbox.dataset.entityTypeId);\n\t\t\t}\n\t\t});\n\n\t\treturn entityTypeIds;\n\t}\n\n    afterSave(response: {data: {}})\n    {\n        this.addDataToSlider('response', response);\n\n\t\tif (response.data.hasOwnProperty('urlTemplates'))\n\t\t{\n\t\t\tRouter.Instance.setUrlTemplates(response.data.urlTemplates);\n\t\t}\n\n        const slider = this.getSlider();\n        if(slider)\n        {\n            slider.close();\n        }\n        else if(this.isNew)\n        {\n            location.href = Router.Instance.getTypeDetailUrl(this.type.getEntityTypeId());\n        }\n\n        this.emitTypeUpdatedEvent({\n\t\t\tisUrlChanged: (response.data.isUrlChanged === true),\n\t\t});\n    }\n\n    getSlider()\n    {\n        if(Reflection.getClass('BX.SidePanel'))\n        {\n            return BX.SidePanel.Instance.getSliderByWindow(window);\n        }\n\n        return null;\n    }\n\n    getToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif(Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tconst toolbar = this.getToolbarComponent();\n\t\tif (toolbar)\n\t\t{\n\t\t\ttoolbar.emitTypeUpdatedEvent(data);\n\t\t}\n\t}\n\n    addDataToSlider(key, data)\n    {\n        if(Type.isString(key) && Type.isPlainObject(data))\n        {\n            let slider = this.getSlider();\n            if(slider)\n            {\n                slider.data.set(key, data);\n            }\n        }\n    }\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) =>\n\t\t{\n\t\t\ttext += message;\n\t\t});\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tthis.errorsContainer.parentNode.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n    hideErrors()\n    {\n        if(Type.isDomNode(this.errorsContainer))\n        {\n            this.errorsContainer.parentNode.style.display = 'none';\n            this.errorsContainer.innerText = '';\n        }\n    }\n\n    delete(event)\n    {\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        MessageBox.confirm(\n            Loc.getMessage('CRM_TYPE_DETAIL_DELETE_CONFIRM'),\n            () => {\n                return new Promise((resolve) => {\n                    this.startProgress();\n                    this.type.delete().then((response) => {\n                        this.stopProgress();\n\n                        const isUrlChanged = (Type.isObject(response.data) && (response.data.isUrlChanged === true));\n\t\t\t\t\t\tthis.emitTypeUpdatedEvent({isUrlChanged});\n\n\t\t\t\t\t\tconst slider = this.getSlider();\n                        if(slider)\n                        {\n                            slider.close();\n                        }\n                        else\n                        {\n                            const listUrl = Router.Instance.getTypeListUrl();\n                            if(listUrl)\n                            {\n                                location.href = listUrl.toString();\n                            }\n                        }\n                    }).catch((errors: string[]) => {\n                        this.showErrors(errors);\n                        this.stopProgress();\n                        resolve();\n                    });\n                });\n            },\n            null,\n            (box) => {\n                this.stopProgress();\n                box.close();\n            }\n        );\n    }\n\n\tfillTabs()\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tthis.container.querySelectorAll('.crm-type-tab').forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif(tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\tArray.from(this.tabs.keys()).forEach((tabName: string) => {\n\t\t\tif(tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.add('crm-type-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.remove('crm-type-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyPreset(presetId: string)\n\t{\n\t\tthis.disablePresetsView();\n\t\tconst presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\tconst currentPresetNode = this.container.querySelector('[data-role=\"preset\"].crm-type-preset-active');\n\t\tif (currentPresetNode)\n\t\t{\n\t\t\tconst currentPreset = this.getPresetById(currentPresetNode.dataset.presetId);\n\t\t\tif (\n\t\t\t\tcurrentPreset\n\t\t\t\t&& currentPreset.data.title\n\t\t\t\t&& this.form.querySelector('[name=\"title\"]').value === currentPreset.data.title)\n\t\t\t{\n\t\t\t\tthis.form.querySelector('[name=\"title\"]').value = '';\n\t\t\t}\n\t\t}\n\t\tconst presets = this.container.querySelectorAll('[data-role=\"preset\"]');\n\t\tpresets.forEach((presetNode: HTMLDivElement) => {\n\t\t\tDom.removeClass(presetNode, 'crm-type-preset-active');\n\t\t\tif (presetNode.dataset.presetId === presetId)\n\t\t\t{\n\t\t\t\tDom.addClass(presetNode, 'crm-type-preset-active');\n\t\t\t\tconst preset = this.getPresetById(presetId);\n\t\t\t\tif (preset)\n\t\t\t\t{\n\t\t\t\t\tthis.updateInputs(preset.data);\n\t\t\t\t\tif (presetSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tpresetSelector.textContent = Text.encode(preset.fields.title);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPresetById(presetId: string)\n\t{\n\t\tfor (const preset: Preset of this.presets)\n\t\t{\n\t\t\tif (preset.fields.id === presetId)\n\t\t\t{\n\t\t\t\treturn preset;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateInputs(data: TypeModelData)\n\t{\n\t\tif (this.form.querySelector('[name=\"title\"]').value.length <= 0)\n\t\t{\n\t\t\tthis.form.querySelector('[name=\"title\"]').value = data.title || '';\n\t\t}\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tthis.setBooleanFieldCheckedState(node, data[fieldName]);\n\t\t\t}\n\t\t});\n\t\tthis.disableLinkedUserFieldsIfNotAvailable();\n\t}\n\n\ttoggleBooleanField(fieldName: string): void\n\t{\n\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = !node.checked;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tgetBooleanFieldNodeByName(fieldName: string): ?HTMLDivElement|HTMLInputElement\n\t{\n\t\treturn this.container.querySelector('[data-name=\"' + fieldName + '\"]');\n\t}\n\n\tisBooleanFieldChecked(node: HTMLDivElement|HTMLInputElement): boolean\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\treturn node.checked;\n\t\t}\n\n\t\treturn Dom.hasClass(node, 'crm-type-field-button-item-active');\n\t}\n\n\tsetBooleanFieldCheckedState(node: HTMLDivElement|HTMLInputElement, isChecked: boolean): void\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = isChecked;\n\t\t\treturn;\n\t\t}\n\t\tif (isChecked)\n\t\t{\n\t\t\tDom.addClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tinitRelations(): void\n\t{\n\t\tthis.parentRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-parent-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationParentShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.parent,\n\t\t});\n\n\t\tthis.childRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-child-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationChildShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.child,\n\t\t});\n\t}\n\n\tinitCustomSections()\n\t{\n\t\tthis.customSectionController = new CustomSectionsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-custom-section-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-custom-section-container\"]'),\n\t\t\tselectorContainer: this.container.querySelector('[data-role=\"crm-type-custom-section-selector\"]'),\n\t\t\tcustomSections: this.type.getCustomSections() || [],\n\t\t});\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.showTab(tabName);\n\t\t}\n\t}\n\n\tstatic handlePresetClick(presetId: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.applyPreset(presetId);\n\t\t}\n\t}\n\n\tstatic handleHideDescriptionClick(target: HTMLDivElement)\n\t{\n\t\ttarget.parentNode.style.display = 'none';\n\t}\n\n\tstatic handleBooleanFieldClick(fieldName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.toggleBooleanField(fieldName);\n\t\t}\n\t}\n\n\tstatic handlePresetSelectorClick()\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.enablePresetsView();\n\t\t}\n\t}\n}\n\nnamespace.TypeDetail = TypeDetail;\n\nclass RelationsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\ttypeSelectorContainer: HTMLDivElement;\n\ttabsContainer: HTMLDivElement;\n\ttabsCheckbox: HTMLInputElement;\n\ttabsSelectorContainer: HTMLDivElement;\n\trelations: Relation[];\n\ttypeSelector: TagSelector;\n\ttabsSelector: TagSelector;\n\n\tconstructor(options)\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.typeSelectorContainer = options.typeSelectorContainer;\n\t\tthis.tabsContainer = options.tabsContainer;\n\t\tthis.tabsCheckbox = options.tabsCheckbox;\n\t\tthis.tabsSelectorContainer = options.tabsSelectorContainer;\n\t\tthis.relations = options.relations;\n\n\t\tthis.initSelectors();\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelectors()\n\t{\n\t\tconst unselectedTypes = [];\n\t\tconst selectedTypes = [];\n\t\tconst unselectedTabs = [];\n\t\tconst selectedTabs = [];\n\t\tthis.relations.forEach((relation: Relation) => {\n\t\t\tconst item = {\n\t\t\t\tid: relation.entityTypeId,\n\t\t\t\tentityId: 'crmType',\n\t\t\t\ttitle: relation.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tif (relation.isChecked)\n\t\t\t{\n\t\t\t\tselectedTypes.push(item);\n\n\t\t\t\tif (relation.isChildrenListEnabled)\n\t\t\t\t{\n\t\t\t\t\tselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tunselectedTabs.push(item)\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectedTypes.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.typeSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTypes,\n\t\t\t\tselectedItems: selectedTypes,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: this.adjust.bind(this),\n\t\t\t\tonAfterTagRemove: this.adjust.bind(this),\n\t\t\t}\n\t\t});\n\t\tthis.typeSelector.renderTo(this.typeSelectorContainer);\n\n\t\tthis.tabsSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTabs,\n\t\t\t\tselectedItems: selectedTabs,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t});\n\t\tthis.tabsSelector.renderTo(this.tabsSelectorContainer);\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t\tthis.tabsCheckbox.checked = this.tabsSelector.getDialog().getSelectedItems().length > 0;\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t\tEvent.bind(this.tabsCheckbox, 'click', this.adjust.bind(this));\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tDom.removeClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\tif (this.tabsCheckbox.checked)\n\t\t{\n\t\t\tDom.removeClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tthis.tabsSelector.getDialog().getItems().forEach((item) => {\n\t\t\tif (!this.isItemSelected(item, selectedTypes))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.tabsSelector.getDialog().removeItem(item);\n\t\t\t\tthis.tabsSelector.removeTag({\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tentityId: item.getEntityId()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tselectedTypes.forEach((item) => {\n\t\t\tconst itemData = {\n\t\t\t\tid: item.getId(),\n\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\ttitle: item.getTitle(),\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tconst tabItem = this.tabsSelector.getDialog().getItem(itemData);\n\t\t\tif (!tabItem)\n\t\t\t{\n\t\t\t\tconst newItem = this.tabsSelector.getDialog().addItem(itemData);\n\t\t\t\tnewItem.select();\n\t\t\t}\n\t\t});\n\t}\n\n\tisItemSelected(item, selectedItems: Array): boolean\n\t{\n\t\treturn selectedItems.filter((selectedItem) => {\n\t\t\treturn item.id === selectedItem.id;\n\t\t}).length > 0;\n\t}\n\n\tgetData()\n\t{\n\t\tconst data = [];\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tconst isTabsCheckboxChecked = this.tabsCheckbox.checked;\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tselectedTypes.forEach((selectedType) => {\n\t\t\tconst type = {\n\t\t\t\tentityTypeId: selectedType.getId(),\n\t\t\t\tisChildrenListEnabled: false,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tisTabsCheckboxChecked\n\t\t\t\t&& this.isItemSelected(selectedType, this.tabsSelector.getDialog().getSelectedItems())\n\t\t\t)\n\t\t\t{\n\t\t\t\ttype.isChildrenListEnabled = true;\n\t\t\t}\n\t\t\tdata.push(type);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\tselectorContainer: HTMLDivElement;\n\tcustomSections: CustomSection[];\n\tselector: TagSelector;\n\tsettingsContainer: HTMLDivElement;\n\tsectionsListContainer: HTMLDivElement;\n\tsaveButton: Element;\n\tcancelButton: Element;\n\taddSectionItemButton: Element;\n\n\tconstructor(options: {\n\t\tswitcher: {},\n\t\tcontainer: Element,\n\t\tselectorContainer: Element,\n\t\tcustomSections?: CustomSection[]\n\t})\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.selectorContainer = options.selectorContainer;\n\t\tif (Type.isArray(options.customSections))\n\t\t{\n\t\t\tthis.customSections = options.customSections;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections = [];\n\t\t}\n\n\t\tthis.initSelector();\n\n\t\tthis.settingsContainer = Tag.render`<div class=\"crm-type-hidden crm-type-custom-sections-settings-container\">\n\t\t\t<div class=\"crm-type-relation-subtitle\">${Loc.getMessage('CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST')}</div>\n\t\t</div>`;\n\t\tthis.container.append(this.settingsContainer);\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelector()\n\t{\n\t\tconst items = [];\n\t\tconst selectedItems = [];\n\n\t\tthis.customSections.forEach((section) => {\n\t\t\tconst item = {\n\t\t\t\tid: section.id,\n\t\t\t\tentityId: 'custom-section',\n\t\t\t\ttitle: section.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\n\t\t\titems.push(item);\n\n\t\t\tif (section.isSelected)\n\t\t\t{\n\t\t\t\tselectedItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.selector = new TagSelector({\n\t\t\tshowCreateButton: true,\n\t\t\tcreateButtonCaption: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tmultiple: false,\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems,\n\t\t\t\tselectedItems,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tstub: false,\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.selector.subscribe('onCreateButtonClick', this.onCreateButtonClick.bind(this));\n\n\t\tthis.selector.renderTo(this.selectorContainer);\n\t}\n\n\tshowSelector()\n\t{\n\t\tDom.removeClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\thideSelector()\n\t{\n\t\tDom.addClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedSection = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedSection.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t}\n\n\tonCreateButtonClick()\n\t{\n\t\tthis.hideSelector();\n\t\tthis.showSectionsList();\n\t}\n\n\trenderSectionsConfig(): HTMLDivElement\n\t{\n\t\tif (!this.sectionsListContainer)\n\t\t{\n\t\t\tthis.sectionsListContainer = Tag.render`<div class=\"crm-type-custom-sections-list-container\"></div>\"`;\n\t\t\tthis.settingsContainer.append(this.sectionsListContainer);\n\t\t}\n\n\t\tthis.renderSectionsList(this.sectionsListContainer);\n\n\t\tif (!this.addSectionItemButton)\n\t\t{\n\t\t\tthis.addSectionItemButton = Tag.render`<div class=\"crm-type-custom-section-add-item-container\">\n\t\t\t\t<span class=\"crm-type-custom-section-add-item-button\" onclick=\"${() => {\n\t\t\t\tthis.sectionsListContainer.append(this.renderSectionItem());\n\t\t\t}}\">${Loc.getMessage('CRM_COMMON_ACTION_ADD')}</span>\n\t\t\t</div>`;\n\t\t\tthis.settingsContainer.append(this.addSectionItemButton);\n\t\t}\n\n\t\tif (!this.buttonsContainer)\n\t\t{\n\t\t\tthis.settingsContainer.append(Tag.render`<hr class=\"crm-type-custom-sections-line\">`);\n\t\t\tthis.buttonsContainer = Tag.render`<div class=\"crm-type-custom-sections-buttons-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.buttonsContainer);\n\t\t}\n\t\tif (!this.saveButton)\n\t\t{\n\t\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${this.onSaveConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_SAVE')}</span>`\n\t\t\tthis.buttonsContainer.append(this.saveButton);\n\t\t}\n\t\tif (!this.cancelButton)\n\t\t{\n\t\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${this.onCancelConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_CANCEL')}</span>`\n\t\t\tthis.buttonsContainer.append(this.cancelButton);\n\t\t}\n\t}\n\n\tonSaveConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst selectedSection = this.getSelectedSection();\n\t\tconst newCustomSections = [];\n\t\tArray.from(this.sectionsListContainer.children).forEach((node) => {\n\t\t\tconst idInput = node.querySelector('[name=\"id\"]');\n\t\t\tconst valueInput = node.querySelector('[name=\"value\"]');\n\t\t\tif (!idInput || !valueInput)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = idInput.value;\n\t\t\tconst title = valueInput.value;\n\t\t\tlet isSelected = false;\n\t\t\tif (selectedSection && selectedSection.id === id)\n\t\t\t{\n\t\t\t\tisSelected = true;\n\t\t\t}\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tnewCustomSections.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.customSections = newCustomSections;\n\n\t\tDom.clean(this.selectorContainer);\n\t\tthis.initSelector();\n\t\tthis.showSelector();\n\n\t\tthis.hideSectionsList();\n\t}\n\n\tonCancelConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.showSelector();\n\t\tthis.hideSectionsList();\n\t}\n\n\trenderSectionsList(listContainer: HTMLDivElement)\n\t{\n\t\tDom.clean(listContainer);\n\t\tthis.customSections.forEach((section) => {\n\t\t\tlistContainer.append(this.renderSectionItem(section));\n\t\t});\n\n\t\tlistContainer.append(this.renderSectionItem());\n\t}\n\n\trenderSectionItem(section: ?CustomSection): HTMLDivElement\n\t{\n\t\tconst item = new CustomSectionItem(section);\n\t\tconst node = Tag.render`<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t<input type=\"hidden\" name=\"id\" value=\"${item.getId()}\" />\n\t\t\t<input class=\"ui-ctl-element\" name=\"value\" type=\"text\" value=\"${Text.encode(item.getValue())}\">\n\t\t\t<div class=\"crm-type-custom-section-remove-item\" onclick=\"${(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.sectionsListContainer.removeChild(item.getNode());\n\t\t\t}}\"></div>\n\t\t</div>`;\n\n\t\titem.setNode(node);\n\n\t\treturn node;\n\t}\n\n\tshowSectionsList()\n\t{\n\t\tthis.renderSectionsConfig();\n\t\tDom.removeClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\thideSectionsList()\n\t{\n\t\tDom.clean(this.sectionsListContainer);\n\t\tDom.addClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t}\n\n\tgetSelectedSection(): ?CustomSection\n\t{\n\t\tconst selectedItems = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedItems.length > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: selectedItems[0].getId(),\n\t\t\t\ttitle: selectedItems[0].getTitle(),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetData()\n\t{\n\t\tlet data = {};\n\t\tdata.customSectionId = 0;\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tconst selectedSection = this.getSelectedSection();\n\t\t\tif (selectedSection)\n\t\t\t{\n\t\t\t\tdata.customSectionId = selectedSection.id;\n\t\t\t}\n\t\t}\n\n\t\tdata.customSecions = this.customSections;\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionItem\n{\n\tconstructor(customSection: CustomSection = null)\n\t{\n\t\tthis.id = customSection ? customSection.id : 'new_' + Text.getRandom();\n\t\tthis.value = customSection ? customSection.title : '';\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif(!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif(node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif(input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}\n"],"names":["namespace","Reflection","instance","TypeDetail","params","Map","Type","isPlainObject","type","isNew","isSaved","form","container","errorsContainer","presets","relations","isRestricted","Boolean","saveButton","document","getElementById","cancelButton","deleteButton","bindEvents","fillTabs","getId","enablePresetsView","disablePresetsView","presetSelectorContainer","querySelector","Dom","addClass","removeClass","initRelations","initCustomSections","Event","bind","event","save","passive","delete","userFieldOption","getBooleanFieldNodeByName","disableLinkedUserFieldsIfNotAvailable","querySelectorAll","forEach","linkedUserFieldNode","enableUserFieldIfAnyLinkedChecked","activeTab","presetsTab","commonTab","click","isBooleanFieldChecked","setBooleanFieldCheckedState","loader","Loader","size","isProgress","getLoader","isShown","show","hideErrors","hide","setTimeout","Router","Instance","showFeatureSlider","stopProgress","preventDefault","startProgress","setTitle","value","TypeModel","getBooleanFieldNames","fieldName","fieldNode","data","linkedUserFields","name","dataset","substr","length","replace","setLinkedUserFields","setRelations","parent","parentRelationsController","getData","child","childRelationsController","customSectionController","customSectionData","setCustomSectionId","customSectionId","setCustomSections","customSecions","then","response","afterSave","catch","errors","showErrors","role","entityTypeIds","checkboxes","Array","from","checkbox","checked","push","entityTypeId","addDataToSlider","hasOwnProperty","setUrlTemplates","urlTemplates","slider","getSlider","close","location","href","getTypeDetailUrl","getEntityTypeId","emitTypeUpdatedEvent","isUrlChanged","getClass","BX","SidePanel","getSliderByWindow","window","Crm","ToolbarComponent","toolbar","getToolbarComponent","key","isString","set","text","message","isDomNode","innerText","parentNode","style","display","console","error","MessageBox","confirm","Loc","getMessage","Promise","resolve","isObject","listUrl","getTypeListUrl","toString","box","tabNode","tab","tabs","tabNameToShow","keys","tabName","get","classList","add","remove","presetId","presetSelector","currentPresetNode","currentPreset","getPresetById","title","presetNode","preset","updateInputs","textContent","Text","encode","fields","id","node","nodeName","toggleClass","hasClass","isChecked","RelationsController","switcher","UI","Switcher","getById","typeSelectorContainer","tabsContainer","tabsCheckbox","tabsSelectorContainer","CustomSectionsController","selectorContainer","customSections","getCustomSections","showTab","applyPreset","target","toggleBooleanField","options","initSelectors","adjustInitialState","adjust","unselectedTypes","selectedTypes","unselectedTabs","selectedTabs","relation","item","entityId","isChildrenListEnabled","typeSelector","TagSelector","dialogOptions","enableSearch","multiple","items","selectedItems","dropdownMode","height","showAvatars","events","onAfterTagAdd","onAfterTagRemove","renderTo","tabsSelector","getDialog","getSelectedItems","check","EventEmitter","subscribe","getItems","isItemSelected","deselect","removeItem","removeTag","getEntityId","itemData","getTitle","tabItem","getItem","newItem","addItem","select","filter","selectedItem","isTabsCheckboxChecked","selectedType","isArray","initSelector","settingsContainer","Tag","render","append","section","isSelected","selector","showCreateButton","createButtonCaption","recentTabOptions","stub","onCreateButtonClick","selectedSection","hideSelector","showSectionsList","sectionsListContainer","renderSectionsList","addSectionItemButton","renderSectionItem","buttonsContainer","onSaveConfigHandler","onCancelConfigHandler","getSelectedSection","newCustomSections","children","idInput","valueInput","clean","showSelector","hideSectionsList","listContainer","CustomSectionItem","getValue","removeChild","getNode","setNode","renderSectionsConfig","customSection","getRandom","HTMLInputElement","input","getInput"],"mappings":"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"}