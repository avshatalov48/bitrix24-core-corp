var DragManager=new function(){var t={};var e=this;function n(t){if(t==null)return null;if(!t.closest){t.closest=function(t){var e=this;while(e){if(!e.matches){e.matches=e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector}if(e.matches(t))return e;else e=e.parentElement}return null}}return t}function a(e){if(e.which!=1)return;var a=n(e.target);if(!a)return;var r=a.closest(".draggable");if(!r)return;if(!r.parentNode.className.match(/\bdraghandle\b/))return;t.elem=r;t.downX=e.pageX;t.downY=e.pageY;return false}function r(n){if(!t.elem)return;if(!t.avatar){var a=n.pageX-t.downX;var r=n.pageY-t.downY;if(Math.abs(a)<3&&Math.abs(r)<3){return}t.avatar=l(n);if(!t.avatar){t={};return}var o=getCoords(t.avatar);t.shiftX=t.downX-o.left;t.shiftY=t.downY-o.top;s(n)}t.avatar.style.left=n.pageX-t.shiftX+"px";t.avatar.style.top=n.pageY-t.shiftY+"px";var i=u(n);if(!i)return false;e.onDragMove(t,i,n);return false}function o(e){if(t.avatar){i(e)}t={}}function i(n){var a=f(n),r=u(n);if(!a){e.onDragCancel(t)}else{e.onDragEnd(t,a,r)}}function l(e){var n=t.elem.parentNode;var a={parent:n.parentNode,nextSibling:n.nextSibling,position:n.position||"",left:n.left||"",top:n.top||"",zIndex:n.zIndex||""};n.rollback=function(){a.parent.insertBefore(n,a.nextSibling);n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};n.styleback=function(){n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};return n}function s(n){e.onDragStart(t);var a=t.avatar;document.body.appendChild(a);a.style.zIndex=9999;a.style.position="absolute"}function f(e){t.avatar.hidden=true;var a=document.elementFromPoint(e.clientX,e.clientY);t.avatar.hidden=false;a=n(a);if(a==null){return null}return a.closest(".droppable")}function u(e){t.avatar.hidden=true;var a=document.elementFromPoint(e.clientX,e.clientY);t.avatar.hidden=false;a=n(a);if(a==null)return null;return a.closest(".draghandle")}document.onmousemove=r;document.onmouseup=o;document.onmousedown=a;this.onDragStart=function(t,e,n){};this.onDragEnd=function(t,e,n){};this.onDragCancel=function(t){};this.onDragMove=function(t,e,n){}};function getCoords(t){var e=t.getBoundingClientRect();return{top:e.top+pageYOffset,left:e.left+pageXOffset}}