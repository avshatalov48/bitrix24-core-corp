{"version":3,"file":"script.js","sources":["src/js/preview.js","src/js/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { Document } from 'sign.document';\nimport { Master } from\t'./index';\n\ntype PositionType = {\n\ttop: number|string,\n\tleft: number|string,\n\twidth: number|string,\n\theight: number|string\n};\n\ntype BlockItem = {\n\tid?: number,\n\tcode: string,\n\tpart: number,\n\tdata?: any,\n\tposition?: PositionType,\n\tstyle?: {[key: string]: string},\n\tdocument: Document,\n\tonClick?: () => {},\n\tonRemove?: () => {},\n};\n\nexport type PreviewItem = {\n\tpage: number,\n\tname: string,\n\twidth: number,\n\theight: number,\n\thash: string,\n\tpath: string\n};\n\nexport type PreviewOptions = {\n\tdocumentHash?: string,\n\treadonly?: boolean,\n\titems?: Array<PreviewItem>,\n\tblocks?: Array<BlockItem>\n};\n\nexport class Preview\n{\n\treadonly: boolean = true;\n\timageIndex: number = 0;\n\timageTotal: number = 0;\n\timageTag: HTMLImageElement;\n\timageCollection: Array<PreviewItem>;\n\tblockCollection: Array<BlockItem>;\n\tblockTagCollection: Array<HTMLElement> = [];\n\tnavigationTag: HTMLElement;\n\tcontainerTag: HTMLElement;\n\tcurrentZoomValue: number = 100;\n\tdefaultZoomValue: number;\n\tzoomValue: number;\n\tfirstRender: boolean = false;\n\n\tconstructor(options: PreviewOptions)\n\t{\n\t\tthis.containerTag = document.querySelector('[data-role=\"sign-master__preview\"]');\n\n\t\tif (!this.containerTag)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.imageCollection = options.items;\n\t\tthis.blockCollection = options.blocks;\n\t\tthis.imageTotal = this.imageCollection.length;\n\n\t\tif (Type.isBoolean(options.readonly))\n\t\t{\n\t\t\tthis.readonly = options.readonly;\n\t\t}\n\n\t\tif (this.imageCollection.length > 0)\n\t\t{\n\t\t\tthis.buildPreview();\n\t\t}\n\t\telse if (options.documentHash)\n\t\t{\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tBX.Sign.Backend.controller({\n\t\t\t\t\t\tcommand: 'document.getLayout',\n\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\tdocumentHash: options.documentHash\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tconst layout = result?.layout;\n\t\t\t\t\t\tif (Type.isArray(layout) && layout.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.imageCollection = layout;\n\t\t\t\t\t\t\tthis.imageTotal = this.imageCollection.length;\n\t\t\t\t\t\t\tthis.buildPreview();\n\n\t\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}, 2000);\n\t\t}\n\t}\n\n\tgetBottomContainer()\n\t{\n\t\tif (!this.bottomContainer)\n\t\t{\n\t\t\tthis.bottomContainer = Tag.render`\n\t\t\t\t<div class=\"sign-master__preview-container_bottom\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.bottomContainer;\n\t}\n\n\t/**\n\t * Builds preview area.\n\t */\n\tbuildPreview()\n\t{\n\t\tDom.clean(this.containerTag);\n\n\t\tDom.append(\n\t\t\tthis.buildImage(this.imageCollection[0]),\n\t\t\tthis.containerTag\n\t\t);\n\t\tDom.append(\n\t\t\tthis.buildNavigation(),\n\t\t\tthis.getBottomContainer()\n\t\t);\n\t\tDom.append(\n\t\t\tthis.buildZoom(),\n\t\t\tthis.getBottomContainer()\n\t\t);\n\t\tDom.append(\n\t\t\tthis.getBottomContainer(),\n\t\t\tthis.containerTag\n\t\t);\n\t\t/*Dom.append(\n\t\t\tthis.buildRemoveButton(),\n\t\t\tthis.containerTag\n\t\t);*/\n\t}\n\n\t/**\n\t * Draws block element.\n\t * @return {HTMLElement}\n\t */\n\tdrawBlock(blockData: {text?: string, base64?: string}): HTMLElement\n\t{\n\t\tif (blockData.text)\n\t\t{\n\t\t\tconst content = blockData.text;\n\t\t\treturn Tag.render`<div class=\"sign-master__block\">${TextFormat.encode(content)}</div>`;\n\t\t}\n\t\telse if (blockData.base64)\n\t\t{\n\t\t\tconst src = 'data:image;base64,' + blockData.base64;\n\t\t\tconst style = `background: url(${src}) no-repeat top; background-size: cover;`;\n\t\t\treturn Tag.render`<div class=\"sign-master__block\" style=\"${style}\"></div>`;\n\t\t}\n\n\t\treturn Tag.render`<div class=\"sign-master__block\"></div>`;\n\t}\n\n\t/**\n\t * Draws blocks on preview by page number.\n\t * @param {number} pageNumber\n\t */\n\tdrawBlocks(pageNumber: number)\n\t{\n\t\tconst blocks = [];\n\n\t\tthis.blockCollection.map(block => {\n\t\t\tif (pageNumber === parseInt(block.position.page))\n\t\t\t{\n\t\t\t\tconst tag = this.drawBlock(block.data);\n\t\t\t\tconst style = Type.isArray(block.style) || Type.isPlainObject(block.style)\n\t\t\t\t\t? {...block.style}\n\t\t\t\t\t: {}\n\t\t\t\t;\n\n\t\t\t\tstyle.top = block.position.top + '%';\n\t\t\t\tstyle.left = block.position.left + '%';\n\t\t\t\tstyle.width = block.position.width + 14 + '%';\n\t\t\t\tstyle.height = block.position.height + 14 + '%';\n\n\t\t\t\tDom.style(tag, style);\n\n\t\t\t\tblocks.push(tag);\n\t\t\t}\n\t\t});\n\n\t\tsetTimeout(() => {\n\t\t\t[...document.querySelectorAll('.sign-master__block')].map(tag => Dom.remove(tag));\n\t\t\tblocks.map(tag => {\n\t\t\t\tthis.imageTagContainer.appendChild(tag);\n\t\t\t});\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Builds preview image.\n\t */\n\tbuildImageTag()\n\t{\n\t\tconst preview = this.imageCollection[this.imageIndex];\n\t\t\n\t\tif (!preview)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.imageTag = Tag.render`<img src=\"${preview.path}\" alt=\"${preview.name}\" class=\"sign-master__preview-image\">`;\n\t\tthis.imageTagContainer = Tag.render`<div class=\"sign-master__preview-container_image\"></div>`;\n\n\t\tthis.imageTag.onload = () => {\n\t\t\tMaster.unLockContent();\n\t\t\tDom.clean(this.imageTagContainer);\n\t\t\tDom.append(this.imageTag, this.imageTagContainer)\n\t\t\tthis.drawBlocks(this.imageIndex + 1);\n\t\t};\n\n\t}\n\n\t/**\n\t * Build preview image container.\n\t * @return {HTMLElement}\n\t */\n\tbuildImage(): HTMLElement\n\t{\n\t\tif (!this.imageTagWrapper)\n\t\t{\n\t\t\tthis.buildImageTag();\n\n\t\t\tthis.imageTagWrapper = Tag.render`\n\t\t\t\t<div class=\"sign-master__preview-container\">\n\t\t\t\t\t${this.imageTagContainer}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.imageTagWrapper;\n\t}\n\n\t/**\n\t * Fires on prev navigation click.\n\t */\n\tonPrevClick()\n\t{\n\t\tif (this.imageIndex > 0)\n\t\t{\n\t\t\tthis.imageIndex--;\n\t\t\tthis.btnNextTag.classList.remove('--disabled');\n\t\t}\n\n\t\tif (this.imageIndex === 0)\n\t\t{\n\t\t\tthis.btnPrevTag.classList.add('--disabled');\n\t\t}\n\n\t\tthis.navigationTag.classList.add('--lock');\n\n\t\tthis.buildImageTag();\n\t\tthis.buildNavigation();\n\t}\n\n\t/**\n\t * Fires on next navigation click.\n\t */\n\tonNextClick()\n\t{\n\t\tif (this.imageIndex < this.imageTotal - 1)\n\t\t{\n\t\t\tthis.imageIndex++;\n\t\t\tthis.btnPrevTag.classList.remove('--disabled');\n\t\t}\n\n\t\tif (this.imageIndex === this.imageTotal - 1)\n\t\t{\n\t\t\tthis.btnNextTag.classList.add('--disabled');\n\t\t}\n\n\t\tthis.navigationTag.classList.add('--lock');\n\n\t\tthis.buildImageTag();\n\t\tthis.buildNavigation();\n\t}\n\n\t/**\n\t * Builds page navigation between images.\n\t * @return {HTMLElement}\n\t */\n\tbuildNavigation(): HTMLElement\n\t{\n\t\tif (!this.navigationTag)\n\t\t{\n\t\t\tthis.btnPrevTag = Tag.render`\n\t\t\t\t<span class=\"sign-master__preview-nav--btn --prev --disabled\" onclick=\"${this.onPrevClick.bind(this)}\"></span>\n\t\t\t`;\n\n\t\t\tthis.btnNextTag = Tag.render`\n\t\t\t\t<span class=\"sign-master__preview-nav--btn --next\" onclick=\"${this.onNextClick.bind(this)}\"></span>\n\t\t\t`;\n\n\t\t\tthis.navigationTag = Tag.render`\n\t\t\t\t<div class=\"sign-master__preview-nav\">\n\t\t\t\t\t${this.btnPrevTag}\n\t\t\t\t\t<div class=\"sign-master__preview-nav--info\">\n\t\t\t\t\t\t<div class=\"sign-master__preview-nav--info-dark\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_PAGE')} \n\t\t\t\t\t\t\t<span class=\"sign-master__preview-nav--current\">0</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span>/</span>\n\t\t\t\t\t\t<span class=\"sign-master__preview-nav--total\">0</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.btnNextTag}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tthis.navigationTag.querySelector('.sign-master__preview-nav--current').innerHTML = this.imageIndex + 1;\n\t\tthis.navigationTag.querySelector('.sign-master__preview-nav--total').innerHTML = this.imageTotal;\n\n\t\tDom.removeClass(this.navigationTag.querySelector('.sign-master__preview-nav--prev'), 'sign-master__preview-nav--active');\n\t\tDom.removeClass(this.navigationTag.querySelector('.sign-master__preview-nav--next'), 'sign-master__preview-nav--active');\n\n\t\tif (this.imageIndex > 0)\n\t\t{\n\t\t\tDom.addClass(this.navigationTag.querySelector('.sign-master__preview-nav--prev'), 'sign-master__preview-nav--active');\n\t\t}\n\t\tif (this.imageIndex < this.imageTotal - 1)\n\t\t{\n\t\t\tDom.addClass(this.navigationTag.querySelector('.sign-master__preview-nav--next'), 'sign-master__preview-nav--active');\n\t\t}\n\n\t\treturn this.navigationTag;\n\t}\n\n\t/**\n\t * Fires on zoom page click.\n\t */\n\tonZoomClick()\n\t{\n\t\tconst preview = this.imageCollection[this.imageIndex];\n\t\tif (!preview)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('image path to show: ', preview.path);\n\t}\n\n\tadjustZoomStatus()\n\t{\n\t\tthis.zoomValue = this.defaultZoomValue / 100 * this.currentZoomValue;\n\t\tthis.imageTagContainer.style.setProperty('zoom', this.zoomValue + '%');\n\n\t\tthis.zoomLayout.value.innerText = this.currentZoomValue;\n\n\t\tswitch (true)\n\t\t{\n\t\t\tcase this.currentZoomValue > 100 :\n\t\t\t\tthis.imageTagWrapper.classList.add('--scroll');\n\t\t\t\tbreak;\n\n\t\t\tdefault :\n\t\t\t\tthis.imageTagWrapper.classList.remove('--scroll');\n\t\t}\n\n\t\tswitch (true)\n\t\t{\n\t\t\tcase this.currentZoomValue === 100 :\n\t\t\t\tthis.imageTagContainer.style.setProperty('left', 0);\n\t\t\t\tthis.imageTagContainer.style.setProperty('top', 0);\n\t\t\t\tthis.zoomLayout.minus.classList.add('--hold');\n\t\t\t\tbreak;\n\n\t\t\tcase this.currentZoomValue === 200 :\n\t\t\t\tthis.zoomLayout.plus.classList.add('--hold');\n\t\t\t\tbreak;\n\n\t\t\tcase this.currentZoomValue === 25 :\n\t\t\t\tthis.zoomLayout.minus.classList.add('--hold');\n\t\t\t\tbreak;\n\n\t\t\tdefault :\n\t\t\t\tthis.zoomLayout.plus.classList.remove('--hold');\n\t\t\t\tthis.zoomLayout.minus.classList.remove('--hold');\n\t\t}\n\t}\n\n\tzoomPlus()\n\t{\n\t\tif (this.imageTag)\n\t\t{\n\t\t\tthis.currentZoomValue += 25;\n\t\t\tthis.adjustZoomStatus();\n\t\t}\n\t}\n\n\tzoomMinus()\n\t{\n\t\tif (this.imageTag)\n\t\t{\n\t\t\tthis.currentZoomValue -= 25;\n\t\t\tthis.adjustZoomStatus();\n\t\t}\n\t}\n\n\t/**\n\t * Builds zoom button.\n\t * @return {HTMLElement}\n\t */\n\tbuildZoom(): HTMLElement\n\t{\n\t\tthis.zoomLayout = {\n\t\t\tvalue: Tag.render`<span class=\"sign-master__preview-zoom-value\">${this.currentZoomValue}</span>`,\n\t\t\tminus: Tag.render`<span class=\"sign-master__preview-zoom_control --minus\" onclick=\"${this.zoomMinus.bind(this)}\"></span>`,\n\t\t\tplus: Tag.render`<span class=\"sign-master__preview-zoom_control --plus\" onclick=\"${this.zoomPlus.bind(this)}\"></span>`\n\t\t};\n\n\t\treturn this.zoomLayout.container = Tag.render`\n\t\t\t<span class=\"sign-master__preview-zoom\">\n\t\t\t\t${this.zoomLayout.minus}\n\t\t\t\t${this.zoomLayout.value}\n\t\t\t\t${this.zoomLayout.plus}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t/**\n\t * Fires on remove page click.\n\t */\n\tonRemoveClick()\n\t{\n\t\tconst preview = this.imageCollection[this.imageIndex];\n\t\tif (!preview)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Builds remove button.\n\t * @return {HTMLElement}\n\t */\n\tbuildRemoveButton(): HTMLElement\n\t{\n\t\tif (this.readonly)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"sign-master__preview-remove --readonly\" title=\"${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_REMOVE_ALERT')}\" >\n\t\t\t\t\t${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_REMOVE')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"sign-master__preview-remove\" onclick=\"${this.onRemoveClick.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_REMOVE')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Event, Runtime, Reflection, Dom, Loc } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport {UI} from 'ui.notification';\nimport { Guide } from \"sign.tour\";\n\nimport { Preview, PreviewOptions } from './preview';\n\nimport '../sign.css';\nimport 'ui.info-helper';\n\ntype loadCrmEntityEditorData = {\n\tid: number,\n\tdocumentId: number,\n\tcategoryId: number,\n\tconfigId: string,\n\tguid: string,\n\tentityTypeId: string,\n\tstageId: string,\n\tdocumentEditorUrl: string,\n\tcontainer: HTMLElement,\n\tcontactsCount: number,\n}\n\ntype MemberCommunicationItem = {\n\ttype: string,\n\tvalue: string\n};\n\ntype MemberCommunication = {\n\t[memberId: number]: Array<MemberCommunicationItem>\n};\n\ntype InitCommunicationsSelectorType = {\n\tcontainers: NodeList,\n\tattrMemberIdName: string,\n\tattrMemberUrlName: string,\n\tcommunications: MemberCommunication,\n\tsmsAllowed: boolean,\n\tsmsNotAllowedCallback: () => {}\n};\n\nconst EntityEditor = Reflection.namespace('BX.Crm.EntityEditor');\n\nexport class Master\n{\n\tstatic #loadedElementsInPartnerStep = {\n\t\tpreview: false,\n\t\tcrmItemEditor: false,\n\t};\n\n\tstatic nextStepHandler(\n\t\tattrInputFileSingle: string,\n\t\tattrInputFileMulti: string,\n\t\tattrItemsFileElements: string\n\t)\n\t{\n\t\tif (!attrInputFileSingle || !attrInputFileMulti || !attrItemsFileElements)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputFileSingleNode = document.querySelector(attrInputFileSingle);\n\t\tconst inputFileMultiNode = document.querySelector(attrInputFileMulti);\n\t\tconst itemFileElements = document.querySelectorAll(attrItemsFileElements);\n\t\tlet checkedInput = null;\n\t\tlet activeElementItem = null;\n\n\t\t// load file controller\n\t\tconst onChangeFileInput = (inputNode: HTMLInputElement) => {\n\t\t\tif (inputNode)\n\t\t\t{\n\t\t\t\tinputNode.onchange = () => {\n\t\t\t\t\tif (inputNode.value !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (activeElementItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactiveElementItem.classList.add('--active');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMaster.unLockNavigation();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (inputNode.value === '')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (activeElementItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactiveElementItem.classList.remove('--active');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMaster.lockNavigation();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tonChangeFileInput(inputFileSingleNode);\n\t\tonChangeFileInput(inputFileMultiNode);\n\n\t\tfor (let i = 0; i < itemFileElements.length; i++)\n\t\t{\n\t\t\titemFileElements[i].addEventListener('click', () => {\n\t\t\t\tinputFileSingleNode.value = null;\n\t\t\t\tinputFileMultiNode.value = null;\n\t\t\t\tMaster.lockNavigation();\n\n\t\t\t\tif (checkedInput)\n\t\t\t\t{\n\t\t\t\t\tcheckedInput.checked = false;\n\t\t\t\t}\n\n\t\t\t\tif (activeElementItem)\n\t\t\t\t{\n\t\t\t\t\tactiveElementItem.classList.remove('--active');\n\t\t\t\t}\n\n\t\t\t\tactiveElementItem = itemFileElements[i];\n\n\t\t\t\tcheckedInput = itemFileElements[i].querySelector('[type=\"radio\"]');\n\t\t\t\tif (checkedInput)\n\t\t\t\t{\n\t\t\t\t\tcheckedInput.checked = true;\n\t\t\t\t\tactiveElementItem.classList.add('--active');\n\t\t\t\t\tMaster.unLockNavigation();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Handler for file selectors.\n\t * @param {string} attrSelector Attribute name for file elector.\n\t */\n\tstatic loadFileHandler(attrSelector: string)\n\t{\n\t\tconst actionButton = document.querySelectorAll(attrSelector);\n\t\tlet inputFile = document.querySelector('[data-action=\"inputFile\"]');\n\t\tlet inputFileMulti = document.querySelector('[data-action=\"inputFileMulti\"]');\n\t\tconst form = inputFile ? inputFile.closest('form') : null;\n\n\t\tif (!actionButton || !inputFile || !form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t[...actionButton].map(node => {\n\t\t\tnode.addEventListener('click', e => {\n\t\t\t\tif (node.getAttribute('data-multiple') === 'Y' && inputFileMulti)\n\t\t\t\t{\n\t\t\t\t\tinputFile = inputFileMulti;\n\t\t\t\t}\n\n\t\t\t\tinputFile.addEventListener('change', (e) => {\n\n\t\t\t\t\tif (e.target.files.length > 10)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst errorBlock = document.getElementById('sign-master__too_many_pics');\n\t\t\t\t\t\tif (errorBlock)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorBlock.style.display = 'block';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twindow.scrollTo({\n\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst nextStepButton = document.querySelector('[data-master-next-step-button]')\n\t\t\t\t\t\t\t? document.querySelector('[data-master-next-step-button]')\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\tMaster.lockNavigation(nextStepButton);\n\t\t\t\t\tMaster.lockContent();\n\t\t\t\t\tform.submit();\n\t\t\t\t});\n\t\t\t\tinputFile.click();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Handler for blank select.\n\t * @param {NodeList} radios List of radio elements to blank select.\n\t */\n\tstatic selectBlankHandler(radios: NodeList)\n\t{\n\t\t[...radios].map((radio: HTMLElement) => {\n\t\t\tradio.addEventListener('click', () => {\n\t\t\t\tradio.closest('form').submit();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Creates entity editor for company selector.\n\t * @param userData\n\t */\n\tstatic loadCrmEntityEditor(userData: loadCrmEntityEditorData)\n\t{\n\t\tMaster.#getNextStepBtn().addEventListener('click', Master.onNextBtnClickAtPartnerStep);\n\n\t\tMaster.adjustLockNavigation(\n\t\t\tMaster.#getNextStepBtn(),\n\t\t\tMaster.#getPreviousStepBtn(),\n\t\t);\n\n\t\tBX.addCustomEvent('BX.Sign.Preview:firstImageIsLoaded', Master.onPreviewFirstImageIsLoadedInPartnerStep)\n\n\t\tMaster.reloadCrmElementsList();\n\n\t\tconst actionButton = document.querySelector('[data-action=\"changePartner\"]');\n\t\tconst initiatorName = document.querySelector('[name=\"initiatorName\"]');\n\n\t\tMaster.lockNavigation();\n\n\t\tlet loader = new BX.Loader({\n\t\t\ttarget: userData.container\n\t\t});\n\n\t\tloader.show();\n\n\t\tBX.ajax.runAction('crm.api.item.getEditor', {\n\t\t\tdata: {\n\t\t\t\tid: userData.id,\n\t\t\t\tentityTypeId: userData.entityTypeId,\n\t\t\t\tguid: userData.guid,\n\t\t\t\tstageId: userData.stageId,\n\t\t\t\tcategoryId: userData.categoryId,\n\t\t\t\tparams: {\n\t\t\t\t\t'ENABLE_PAGE_TITLE_CONTROLS': false,\n\t\t\t\t\t'ENABLE_MODE_TOGGLE': true,\n\t\t\t\t\t'IS_EMBEDDED': 'N',\n\t\t\t\t\t'forceDefaultConfig': 'Y',\n\t\t\t\t\t'enableSingleSectionCombining': 'N',\n\t\t\t\t}\n\t\t\t}\n\t\t}).then(function (response){\n\t\t\tloader.destroy();\n\t\t\tMaster.#loadedElementsInPartnerStep.crmItemEditor = true;\n\t\t\tif (Master.#loadedElementsInPartnerStep.preview)\n\t\t\t{\n\t\t\t\tMaster.unLockNavigation();\n\t\t\t\tconst btn = Master.#getNextStepBtn();\n\t\t\t\tif (btn)\n\t\t\t\t{\n\t\t\t\t\tbtn.title = '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!response?.data?.html)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tRuntime.html(userData.container, response.data.html).then(() => {\n\t\t\t\tconst editor = Master.getEditor(userData.guid);\n\t\t\t\tif (!editor)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst myCompanyField = editor.getControlById('MYCOMPANY_ID');\n\t\t\t\tif (myCompanyField)\n\t\t\t\t{\n\t\t\t\t\tconst myCompanySection = editor.getControlById('myCompany');\n\n\t\t\t\t\tif (myCompanyField.hasCompanies())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (myCompanySection)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\teditor.switchControlMode(myCompanySection, BX.UI.EntityEditorMode.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (myCompanySection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmyCompanySection.enableToggling(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tmyCompanyField.isRequired = () => true;\n\t\t\t\t\tmyCompanyField.switchToSingleEditMode_prev = myCompanyField.switchToSingleEditMode;\n\t\t\t\t\tmyCompanyField.switchToSingleEditMode = (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (myCompanySection && myCompanySection.getMode() === BX.UI.EntityEditorMode.view)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\teditor.switchControlMode(myCompanySection, BX.UI.EntityEditorMode.edit);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmyCompanyField.switchToSingleEditMode_prev(params);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst clientSection = editor.getControlById('client');\n\t\t\t\tconst contactsField = editor.getControlById('CLIENT');\n\t\t\t\tif (contactsField)\n\t\t\t\t{\n\t\t\t\t\tif (contactsField.hasContacts())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (clientSection)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\teditor.switchControlMode(clientSection, BX.UI.EntityEditorMode.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (clientSection)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclientSection.enableToggling(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDom.remove(contactsField._addContactButton);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontactsField.isRequired = () => true;\n\t\t\t\t\tif (contactsField._contactSearchBoxes[0])\n\t\t\t\t\t{\n\t\t\t\t\t\tcontactsField._contactSearchBoxes[0]._isRequired = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontactsField.switchToSingleEditMode_prev = contactsField.switchToSingleEditMode;\n\t\t\t\t\tcontactsField.switchToSingleEditMode = (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (clientSection && clientSection.getMode() === BX.UI.EntityEditorMode.view)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\teditor.switchControlMode(clientSection, BX.UI.EntityEditorMode.edit);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontactsField.switchToSingleEditMode_prev(params);\n\t\t\t\t\t};\n\t\t\t\t\tcontactsField.layout_prev = contactsField.layout;\n\n\t\t\t\t\tcontactsField.layout = (options) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tcontactsField.layout_prev(options);\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tDom.remove(contactsField._addContactButton);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.log('error', error);\n\t\t});\n\n\t\tconst form = actionButton ? actionButton.closest('form') : null;\n\n\t\tif (!actionButton || !form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tactionButton.addEventListener('click', e => {\n\t\t\te.preventDefault();\n\t\t\tMaster.hideErrors();\n\n\t\t\tconst showError = message => {\n\t\t\t\tif (loader)\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\t\t\t\t}\n\t\t\t\tMaster.unLockNavigation();\n\t\t\t\tMaster.unLockContent();\n\t\t\t\tMaster.showError(message);\n\t\t\t}\n\n\t\t\tif (initiatorName && initiatorName.value.trim() === '')\n\t\t\t{\n\t\t\t\tshowError(Loc.getMessage('SIGN_CMP_MASTER_TPL_ERROR_WRONG_INITIATOR'));\n\t\t\t}\n\t\t\telse if (Master.checkFilledContacts(userData))\n\t\t\t{\n\t\t\t\tBX.Crm.EntityEditor.getDefault().save();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tshowError(Loc.getMessage('SIGN_CMP_MASTER_TPL_ERROR_WRONG_CONTACTS_NUMBER'));\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(window, 'BX.Crm.EntityEditor:onFailedValidation', (data) => {\n\t\t\tMaster.unLockNavigation();\n\t\t\tMaster.unLockContent();\n\t\t});\n\t\tBX.addCustomEvent(window, 'onCrmEntityUpdateError', (data) => {\n\t\t\tMaster.unLockNavigation();\n\t\t\tMaster.unLockContent();\n\t\t});\n\t\tBX.addCustomEvent(window, 'BX.Crm.EntityEditor:onEntitySaveFailure', (data) => {\n\t\t\tMaster.unLockNavigation();\n\t\t\tMaster.unLockContent();\n\t\t\tif (data.errors)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: data.errors.join(', ')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tBX.addCustomEvent(window, 'onCrmEntityUpdate', data => {\n\t\t\tMaster.reloadCrmElementsList();\n\t\t\tconst entityData = data.entityData;\n\n\t\t\tif (!entityData?.CONTACT_ID)\n\t\t\t{\n\t\t\t\tMaster.unLockNavigation();\n\t\t\t\tMaster.unLockContent();\n\t\t\t}\n\n\t\t\tif (entityData?.CONTACT_ID)\n\t\t\t{\n\t\t\t\tBX.Sign.Backend.controller({\n\t\t\t\t\tcommand: 'internal.document.assignMembers',\n\t\t\t\t\tpostData: {\n\t\t\t\t\t\tdocumentId: userData.documentId\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\t\tMaster.openEditor(userData.documentEditorUrl, form);\n\t\t\t\t}).catch((response) =>\n\t\t\t\t{\n\t\t\t\t\tMaster.unLockNavigation();\n\t\t\t\t\tMaster.unLockContent();\n\t\t\t\t\tthis.showError(response.errors[0].message, response.errors[0].customData);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic showInfoHelperSlider(code: string)\n\t{\n\t\tMaster.lockContent();\n\t\tMaster.lockNavigation();\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\tconst infoHelper = top.BX.UI.InfoHelper;\n\n\t\tinfoHelper.show(code);\n\n\t\ttop.BX.addCustomEvent(\n\t\t\tinfoHelper.getSlider(),\n\t\t\t'SidePanel.Slider:onCloseComplete',\n\t\t\t() => currentSlider?.close()\n\t\t);\n\t}\n\n\t/**\n\t * Saves new document title.\n\t * @param {number} documentId\n\t */\n\tstatic saveTitle(documentId: number)\n\t{\n\t\tconst actionButton = document.querySelector('[data-action=\"saveTitle\"]');\n\t\tconst cancelButton = document.querySelector('[data-action=\"cancel\"]');\n\t\tconst newTitleContainer = document.querySelector('[data-param=\"saveTitleValue\"]');\n\t\tconst newTitleWrapper = document.querySelector('[data-wrapper=\"title\"]');\n\t\tconst inputWrapper = document.querySelector('[data-wrapper=\"inputWrapper\"]');\n\t\tconst editButton = document.querySelector('[data-wrapper=\"edit\"]');\n\t\tconst editorWrapper = document.querySelector('[data-wrapper=\"titleEditor\"]');\n\n\t\tif (editButton && editorWrapper)\n\t\t{\n\t\t\teditButton.addEventListener('click', () => {\n\t\t\t\tDom.addClass(editorWrapper, '--edit');\n\t\t\t});\n\t\t}\n\n\t\tif (actionButton && newTitleContainer)\n\t\t{\n\t\t\tnewTitleContainer.addEventListener('keydown', (ev) => {\n\t\t\t\tif (ev.code.toLowerCase() === 'escape')\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(editorWrapper, '--edit');\n\t\t\t\t\tnewTitleContainer.value = newTitleWrapper.innerText;\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tif (ev.code.toLowerCase() === 'enter')\n\t\t\t\t{\n\t\t\t\t\tsaveTitle();\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcancelButton.addEventListener('click', () => {\n\t\t\t\tDom.removeClass(editorWrapper, '--edit');\n\t\t\t\tnewTitleContainer.value = newTitleWrapper.innerText;\n\t\t\t});\n\n\t\t\tactionButton.addEventListener('click', () => saveTitle());\n\n\t\t\tlet saveTitle = () => {\n\t\t\t\tDom.addClass(actionButton, 'ui-btn-wait');\n\t\t\t\tDom.addClass(inputWrapper, 'ui-ctl-disabled');\n\n\t\t\t\tconst newTitle = newTitleContainer.value;\n\n\t\t\t\tBX.Sign.Backend.controller({\n\t\t\t\t\t\tcommand: 'document.setTitle',\n\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\tdocumentId: documentId,\n\t\t\t\t\t\t\ttitle: newTitle\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result && newTitleWrapper)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewTitleWrapper.innerHTML = BX.Text.encode(newTitle);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tDom.removeClass(actionButton, 'ui-btn-wait');\n\t\t\t\t\t\tDom.removeClass(inputWrapper, 'ui-ctl-disabled');\n\t\t\t\t\t\tDom.removeClass(editorWrapper, '--edit');\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {})\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic adjustLockNavigation(buttonNext: HTMLElement, buttonPrev: HTMLElement): void\n\t{\n\t\tbuttonNext = buttonNext || null;\n\t\tbuttonPrev = buttonPrev || null;\n\n\t\tif (buttonNext)\n\t\t{\n\t\t\tbuttonNext.addEventListener('click', () => {\n\t\t\t\tMaster.lockContent();\n\t\t\t\tMaster.lockNavigation(buttonNext, buttonPrev);\n\t\t\t})\n\t\t}\n\n\t\tif (buttonPrev)\n\t\t{\n\t\t\tbuttonPrev.addEventListener('click', () => {\n\t\t\t\tMaster.lockContent();\n\t\t\t\tMaster.lockNavigation(buttonPrev, buttonNext);\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic lockNavigation(buttonClick: HTMLElement, button: HTMLElement): void\n\t{\n\t\tif (buttonClick)\n\t\t{\n\t\t\tbuttonClick.classList.add('ui-btn-wait');\n\t\t\tbuttonClick.classList.add('ui-btn-disabled');\n\t\t}\n\n\t\tif (button)\n\t\t{\n\t\t\tbutton.classList.add('ui-btn-disabled');\n\t\t}\n\n\t\tlet disabled = (node) => { node.classList.add('ui-btn-disabled') };\n\n\t\tif (!buttonClick)\n\t\t{\n\t\t\tconst buttonNext = document.querySelector('[data-master-next-step-button]');\n\t\t\tbuttonNext\n\t\t\t\t? disabled(buttonNext)\n\t\t\t\t: null;\n\t\t}\n\n\t\tif (!button)\n\t\t{\n\t\t\tconst buttonPrev = document.querySelector('[data-master-prev-step-button]');\n\t\t\tbuttonPrev\n\t\t\t\t? disabled(buttonPrev)\n\t\t\t\t: null;\n\t\t}\n\t}\n\n\tstatic unLockNavigation(): void\n\t{\n\t\tconst buttonNext = document.querySelector('[data-master-next-step-button]');\n\t\tconst buttonPrev = document.querySelector('[data-master-prev-step-button]');\n\n\t\tif (buttonNext)\n\t\t{\n\t\t\tbuttonNext.classList.remove('ui-btn-wait');\n\t\t\tbuttonNext.classList.remove('ui-btn-disabled');\n\t\t}\n\n\t\tif (buttonPrev)\n\t\t{\n\t\t\tbuttonPrev.classList.remove('ui-btn-wait');\n\t\t\tbuttonPrev.classList.remove('ui-btn-disabled');\n\t\t}\n\t}\n\n\tstatic lockContent(): void\n\t{\n\t\tconst contentNode = document.querySelector('[data-role=\"sign-master__content\"]');\n\n\t\tif (contentNode)\n\t\t{\n\t\t\tcontentNode.classList.add('--lock');\n\t\t}\n\t}\n\n\tstatic unLockContent(): void\n\t{\n\t\tconst contentNode = document.querySelector('[data-role=\"sign-master__content\"]');\n\n\t\tif (contentNode)\n\t\t{\n\t\t\tcontentNode.classList.remove('--lock');\n\t\t}\n\t}\n\n\t/**\n\t * Checks contacts fields.\n\t * @param {loadCrmEntityEditorData} userData\n\t * @return {boolean}\n\t */\n\tstatic checkFilledContacts(userData: loadCrmEntityEditorData): boolean\n\t{\n\t\tlet isSaveAllowed = true;\n\t\tif (Number(userData.contactsCount) <= 0)\n\t\t{\n\t\t\treturn isSaveAllowed;\n\t\t}\n\t\tconst editor = Master.getEditor(userData.guid);\n\t\tif (!editor)\n\t\t{\n\t\t\treturn isSaveAllowed;\n\t\t}\n\t\tconst contactsField = editor.getControlById('CLIENT');\n\t\tif (!contactsField)\n\t\t{\n\t\t\treturn isSaveAllowed;\n\t\t}\n\n\t\tconst myCompanyField = editor.getControlById('MYCOMPANY_ID');\n\t\tif (!myCompanyField)\n\t\t{\n\t\t\treturn isSaveAllowed;\n\t\t}\n\n\t\tconst filledContactsCount = contactsField._contactInfos.length() + (myCompanyField.hasCompanies() ? 1 : 0);\n\t\tif (filledContactsCount < userData.contactsCount)\n\t\t{\n\t\t\tisSaveAllowed = false;\n\t\t}\n\n\t\treturn isSaveAllowed;\n\t}\n\n\t/**\n\t * Returns editor instance by GUID.\n\t * @param {string }guid\n\t * @return {EntityEditor|null}\n\t */\n\tstatic getEditor(guid: string): ?EntityEditor\n\t{\n\t\tif (EntityEditor)\n\t\t{\n\t\t\treturn EntityEditor.get(guid);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Opens editor in slider.\n\t * @param {string} editorUrl\n\t * @param {HTMLElement} formElement\n\t */\n\tstatic openEditor(editorUrl: string, formElement: HTMLElement)\n\t{\n\t\tif (\n\t\t\ttypeof BX.SidePanel !== 'undefined' &&\n\t\t\ttypeof BX.SidePanel.Instance !== 'undefined'\n\t\t)\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\teditorUrl,\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tbxSignEditorAllSaved: true,\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: (event) => {\n\t\t\t\t\t\t\tif (event.getSlider().getData().get('bxSignEditorAllSaved') === true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (formElement)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tformElement.submit();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.denyAction();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twidth: 1200,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tallowChangeHistory: false\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Toggles some areas when mute-checkbox was checked.\n\t * @param {NodeList} checkboxes List of checkboxes to mute.\n\t * @param {string} closestSelector Closest selector of checkbox which contain member.\n\t * @param {string} attrName Attribute name which toggle on click.\n\t */\n\tstatic initMuteCheckbox(checkboxes: NodeList, closestSelector: string, attrName: string)\n\t{\n\t\tif (!attrName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t[...checkboxes].map((checkbox: HTMLElement) => {\n\t\t\tEvent.bind(checkbox, 'click', () => {\n\t\t\t\tconst toToggle = checkbox.closest(closestSelector).querySelectorAll('[' + attrName + '=\"1\"]');\n\n\t\t\t\t[...toToggle].map((element: HTMLElement) => {\n\t\t\t\t\telement.hidden = checkbox.checked;\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Shows popup menu to select communication type with member.\n\t * @param {InitCommunicationsSelectorType} data\n\t */\n\tstatic initCommunicationsSelector(data: InitCommunicationsSelectorType)\n\t{\n\t\tconst {\n\t\t\tcontainers,\n\t\t\tattrMemberIdName,\n\t\t\tattrMemberUrlName,\n\t\t\tcommunications,\n\t\t\tsmsAllowed,\n\t\t\tsmsNotAllowedCallback,\n\t\t} = data;\n\n\t\tArray.from(containers).map((container: HTMLElement) => {\n\n\t\t\tconst memberId = parseInt(container.getAttribute(attrMemberIdName));\n\t\t\tconst memberUrl = container.getAttribute(attrMemberUrlName);\n\t\t\tconst communicationsLocal = communications[memberId].length ? communications[memberId] : [];\n\n\t\t\tlet menuManager;\n\t\t\tconst menuId = 'sign-member-communications-' + memberId;\n\t\t\tconst input = container.querySelector('input');\n\t\t\tconst span = container.querySelector('.sign-master__send-member--communications-arrow span');\n\n\t\t\tconst menuItems = [];\n\t\t\tconst openItemFunc = () => BX.SidePanel.Instance.open(memberUrl, {\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: function onClose() {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\tif (menuManager)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenuManager.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tcommunicationsLocal.map((communication: MemberCommunicationItem) => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: communication.value,\n\t\t\t\t\tonclick: () => {\n\n\t\t\t\t\t\tif (communication.type === 'PHONE' && !smsAllowed)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsmsNotAllowedCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinput.setAttribute('value', communication.type + '|' + communication.value);\n\t\t\t\t\t\t\tspan.innerText = communication.value;\n\t\t\t\t\t\t\tspan.parentNode.setAttribute('title', communication.value)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tMenuManager.getMenuById(menuId).close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (menuItems.length <= 0)\n\t\t\t{\n\t\t\t\tEvent.bind(container, 'click', () => {\n\t\t\t\t\topenItemFunc();\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// add new communication item\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('SIGN_CMP_MASTER_TPL_MEMBER_NEW_COMMUNICATION'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\topenItemFunc();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmenuManager = MenuManager.create({\n\t\t\t\tid: menuId,\n\t\t\t\tbindElement: container,\n\t\t\t\titems: menuItems\n\t\t\t});\n\n\t\t\tEvent.bind(container, 'click', () => {\n\t\t\t\tmenuManager.show();\n\t\t\t});\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.querySelector('.sign-master__send-member--communications'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_CMP_MASTER_TPL_TOUR_STEP_SEND_MEMBER_COMMUNICATION_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_CMP_MASTER_TPL_TOUR_STEP_SEND_MEMBER_COMMUNICATION_TEXT'),\n\t\t\t\t\tposition: 'right',\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-member-communication',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t/**\n\t * Shows document preview.\n\t * @param options\n\t */\n\tstatic showPreview(options: PreviewOptions)\n\t{\n\t\tnew Preview(options);\n\t}\n\n\t/**\n\t * Shows error block with message.\n\t * @param {string} error\n\t * @param link\n\t */\n\tstatic showError(error: string, link): void\n\t{\n\t\tconst errorsContainer = document.querySelector('[data-role=\"sign-error-container\"]');\n\t\tif (errorsContainer)\n\t\t{\n\t\t\tDom.style(errorsContainer.parentNode, 'display', 'block');\n\t\t\terrorsContainer.innerHTML = BX.util.htmlspecialchars(error);\n\t\t\tif (link?.href)\n\t\t\t{\n\t\t\t\tconst href = BX.util.htmlspecialchars(link.href);\n\t\t\t\tconst linkStart = '<a href=\"'+href+'\" target=\"_blank\">';\n\t\t\t\tconst linkEnd = '</a>';\n\t\t\t\tconst button = BX.util.htmlspecialchars(link.button);\n\t\t\t\terrorsContainer.innerHTML += ' ' + button.replace('#LINK_START#', linkStart).replace('#LINK_END#', linkEnd);\n\t\t\t}\n\t\t\twindow.scrollTo({ top: 0, left: 0, behavior: 'smooth' });\n\t\t}\n\t}\n\n\t/**\n\t * Hides error block.\n\t */\n\tstatic hideErrors(): void\n\t{\n\t\tconst errorsContainer = document.querySelector('[data-role=\"sign-error-container\"]');\n\t\tif (errorsContainer)\n\t\t{\n\t\t\terrorsContainer.parentNode.style.display = 'none';\n\t\t\terrorsContainer.innerText = '';\n\t\t}\n\t}\n\n\tstatic reloadCrmElementsList()\n\t{\n\t\ttop.BX?.CRM?.Kanban?.Grid?.getInstance()?.reload();\n\t\ttop.BX?.Main?.gridManager?.data[0]?.instance?.reload();\n\t}\n\n\tstatic #getNextStepBtn(): Element\n\t{\n\t\treturn document.querySelector('[data-master-next-step-button]');\n\t}\n\n\tstatic #getPreviousStepBtn(): Element\n\t{\n\t\treturn document.querySelector('[data-master-prev-step-button]');\n\t}\n\n\tstatic onPreviewFirstImageIsLoadedInPartnerStep()\n\t{\n\t\tMaster.#loadedElementsInPartnerStep.preview = true;\n\t\tif (Master.#loadedElementsInPartnerStep.crmItemEditor)\n\t\t{\n\t\t\tMaster.unLockNavigation();\n\t\t\tconst btn = Master.#getNextStepBtn();\n\t\t\tif (btn)\n\t\t\t{\n\t\t\t\tbtn.title = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic onNextBtnClickAtPartnerStep(event: PointerEvent)\n\t{\n\t\tif (!Master.#loadedElementsInPartnerStep.preview || !Master.#loadedElementsInPartnerStep.crmItemEditor)\n\t\t{\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t}\n}\n"],"names":["Preview","options","containerTag","document","querySelector","imageCollection","items","blockCollection","blocks","imageTotal","length","Type","isBoolean","readonly","buildPreview","documentHash","interval","setInterval","BX","Sign","Backend","controller","command","postData","then","result","layout","isArray","clearInterval","bottomContainer","Tag","render","Dom","clean","append","buildImage","buildNavigation","getBottomContainer","buildZoom","blockData","text","content","TextFormat","encode","base64","src","style","pageNumber","map","block","parseInt","position","page","tag","drawBlock","data","isPlainObject","top","left","width","height","push","setTimeout","querySelectorAll","remove","imageTagContainer","appendChild","preview","imageIndex","imageTag","path","name","onload","Master","unLockContent","drawBlocks","imageTagWrapper","buildImageTag","btnNextTag","classList","btnPrevTag","add","navigationTag","onPrevClick","bind","onNextClick","Loc","getMessage","innerHTML","removeClass","addClass","console","log","zoomValue","defaultZoomValue","currentZoomValue","setProperty","zoomLayout","value","innerText","minus","plus","adjustZoomStatus","zoomMinus","zoomPlus","container","onRemoveClick","EntityEditor","Reflection","namespace","attrInputFileSingle","attrInputFileMulti","attrItemsFileElements","inputFileSingleNode","inputFileMultiNode","itemFileElements","checkedInput","activeElementItem","onChangeFileInput","inputNode","onchange","unLockNavigation","lockNavigation","i","addEventListener","checked","attrSelector","actionButton","inputFile","inputFileMulti","form","closest","node","e","getAttribute","target","files","errorBlock","getElementById","display","window","scrollTo","behavior","nextStepButton","lockContent","submit","click","preventDefault","radios","radio","userData","onNextBtnClickAtPartnerStep","adjustLockNavigation","addCustomEvent","onPreviewFirstImageIsLoadedInPartnerStep","reloadCrmElementsList","initiatorName","loader","Loader","show","ajax","runAction","id","entityTypeId","guid","stageId","categoryId","params","response","destroy","crmItemEditor","btn","title","html","Runtime","editor","getEditor","myCompanyField","getControlById","myCompanySection","hasCompanies","switchControlMode","UI","EntityEditorMode","view","enableToggling","isRequired","switchToSingleEditMode_prev","switchToSingleEditMode","getMode","edit","clientSection","contactsField","hasContacts","_addContactButton","_contactSearchBoxes","_isRequired","layout_prev","error","hideErrors","showError","message","trim","checkFilledContacts","Crm","getDefault","save","errors","Notification","Center","notify","join","entityData","CONTACT_ID","documentId","openEditor","documentEditorUrl","customData","code","currentSlider","SidePanel","Instance","getTopSlider","infoHelper","InfoHelper","getSlider","close","cancelButton","newTitleContainer","newTitleWrapper","inputWrapper","editButton","editorWrapper","ev","toLowerCase","stopPropagation","saveTitle","newTitle","Text","buttonNext","buttonPrev","buttonClick","button","disabled","contentNode","isSaveAllowed","Number","contactsCount","filledContactsCount","_contactInfos","get","editorUrl","formElement","open","bxSignEditorAllSaved","events","onClose","event","getData","location","reload","denyAction","cacheable","allowChangeHistory","checkboxes","closestSelector","attrName","checkbox","Event","toToggle","element","hidden","containers","attrMemberIdName","attrMemberUrlName","communications","smsAllowed","smsNotAllowedCallback","Array","from","memberId","memberUrl","communicationsLocal","menuManager","menuId","input","span","menuItems","openItemFunc","communication","onclick","type","setAttribute","parentNode","MenuManager","getMenuById","create","bindElement","guide","Guide","steps","autoSave","simpleMode","startOnce","link","errorsContainer","util","htmlspecialchars","href","linkStart","linkEnd","replace","CRM","Kanban","Grid","getInstance","Main","gridManager","instance","stopImmediatePropagation"],"mappings":"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"}