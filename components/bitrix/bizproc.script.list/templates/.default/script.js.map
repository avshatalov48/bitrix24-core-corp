{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Tag, Dom, Loc} from 'main.core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Script} from 'bizproc.script';\nimport 'sidepanel';\n\nconst namespace = Reflection.namespace('BX.Bizproc');\n\nclass ScriptListComponent\n{\n\tgridId;\n\tcreateScriptButton;\n\texportScriptButton;\n\tdocumentType;\n\n\tconstructor(options)\n\t{\n\t\tif(Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.gridId = options.gridId;\n\t\t\tthis.createScriptButton = options.createScriptButton\n\t\t\tthis.exportScriptButton = options.exportScriptButton\n\t\t\tthis.documentType = options.documentType\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.createScriptButton)\n\t\t{\n\t\t\tEvent.bind(this.createScriptButton, 'click', () => {\n\t\t\t\tScript.Manager.Instance.createScript(this.documentType).then(() => this.reloadGrid())\n\t\t\t});\n\t\t}\n\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tEvent.bind(this.exportScriptButton, 'click', (event) => {\n\n\t\t\t\tif (!Dom.hasClass(this.exportScriptButton, 'ui-btn-disabled'))\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.open(this.exportScriptButton.getAttribute('data-url'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.hasRows())\n\t\t\t{\n\t\t\t\tthis.#disableExport();\n\t\t\t}\n\t\t}\n\n\t\tBX.addCustomEvent('Grid::updated', () => {\n\t\t\tif (!this.hasRows())\n\t\t\t{\n\t\t\t\tthis.#disableExport();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#enableExport();\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteScript(scriptId: number)\n\t{\n\t\tconst messageBox = new MessageBox({\n\t\t\tmessage: Loc.getMessage('BIZPROC_SCRIPT_LIST_CONFIRM_DELETE'),\n\t\t\tokCaption: Loc.getMessage('BIZPROC_SCRIPT_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tScript.Manager.Instance.deleteScript(scriptId).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\t\t\t\t\t\tif (okBtn)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\tactivateScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.activateScript(scriptId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response.data.error)\n\t\t\t\t{\n\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.reloadGrid()\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tdeactivateScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.deactivateScript(scriptId).then((response) => {\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadGrid()\n\t\t\t}\n\t\t});\n\t}\n\n\teditScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.editScript(scriptId).then(() => this.reloadGrid());\n\t}\n\n\t#getGrid()\n\t{\n\t\tif (this.gridId)\n\t\t{\n\t\t\treturn BX.Main.gridManager && BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\t\treturn null;\n\t}\n\n\treloadGrid()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.reload();\n\t\t}\n\t}\n\n\thasRows()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\treturn grid.getRows().getCountDisplayed() > 0;\n\t\t}\n\t\treturn false;\n\t}\n\n\t#disableExport()\n\t{\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tDom.addClass(this.exportScriptButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\t#enableExport()\n\t{\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tDom.removeClass(this.exportScriptButton, 'ui-btn-disabled');\n\t\t}\n\t}\n}\n\nnamespace.ScriptListComponent = ScriptListComponent;"],"names":["namespace","Reflection","ScriptListComponent","options","Type","isPlainObject","gridId","createScriptButton","exportScriptButton","documentType","Event","bind","Script","Manager","Instance","createScript","then","reloadGrid","event","Dom","hasClass","BX","SidePanel","open","getAttribute","hasRows","addCustomEvent","scriptId","messageBox","MessageBox","message","Loc","getMessage","okCaption","onOk","deleteScript","response","data","error","alert","buttons","MessageBoxButtons","OK_CANCEL","popupOptions","events","onAfterShow","okBtn","getTarget","getButton","getContainer","focus","show","activateScript","deactivateScript","editScript","grid","reload","getRows","getCountDisplayed","Main","gridManager","getInstanceById","addClass","removeClass"],"mappings":"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"}