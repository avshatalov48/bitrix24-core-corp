{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Tag, Dom, Loc} from 'main.core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Script} from 'bizproc.script';\nimport 'sidepanel';\n\nconst namespace = Reflection.namespace('BX.Bizproc');\n\nclass ScriptListComponent\n{\n\tgridId;\n\tcreateScriptButton;\n\texportScriptButton;\n\tdocumentType;\n\n\tconstructor(options)\n\t{\n\t\tif(Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.gridId = options.gridId;\n\t\t\tthis.createScriptButton = options.createScriptButton\n\t\t\tthis.exportScriptButton = options.exportScriptButton\n\t\t\tthis.documentType = options.documentType\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.createScriptButton)\n\t\t{\n\t\t\tEvent.bind(this.createScriptButton, 'click', () => {\n\t\t\t\tScript.Manager.Instance.createScript(this.documentType).then(() => this.reloadGrid())\n\t\t\t});\n\t\t}\n\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tEvent.bind(this.exportScriptButton, 'click', (event) => {\n\n\t\t\t\tif (!Dom.hasClass(this.exportScriptButton, 'ui-btn-disabled'))\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.open(this.exportScriptButton.getAttribute('data-url'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.hasRows())\n\t\t\t{\n\t\t\t\tthis.#disableExport();\n\t\t\t}\n\t\t}\n\n\t\tBX.addCustomEvent('Grid::updated', () => {\n\t\t\tif (!this.hasRows())\n\t\t\t{\n\t\t\t\tthis.#disableExport();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#enableExport();\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteScript(scriptId: number)\n\t{\n\t\tconst messageBox = new MessageBox({\n\t\t\tmessage: Loc.getMessage('BIZPROC_SCRIPT_LIST_CONFIRM_DELETE'),\n\t\t\tokCaption: Loc.getMessage('BIZPROC_SCRIPT_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tScript.Manager.Instance.deleteScript(scriptId).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\t\t\t\t\t\tif (okBtn)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\tactivateScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.activateScript(scriptId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response.data.error)\n\t\t\t\t{\n\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.reloadGrid()\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tdeactivateScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.deactivateScript(scriptId).then((response) => {\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadGrid()\n\t\t\t}\n\t\t});\n\t}\n\n\teditScript(scriptId: number)\n\t{\n\t\tScript.Manager.Instance.editScript(scriptId).then(() => this.reloadGrid());\n\t}\n\n\t#getGrid()\n\t{\n\t\tif (this.gridId)\n\t\t{\n\t\t\treturn BX.Main.gridManager && BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\t\treturn null;\n\t}\n\n\treloadGrid()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.reload();\n\t\t}\n\t}\n\n\thasRows()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\treturn grid.getRows().getCountDisplayed() > 0;\n\t\t}\n\t\treturn false;\n\t}\n\n\t#disableExport()\n\t{\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tDom.addClass(this.exportScriptButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\t#enableExport()\n\t{\n\t\tif (this.exportScriptButton)\n\t\t{\n\t\t\tDom.removeClass(this.exportScriptButton, 'ui-btn-disabled');\n\t\t}\n\t}\n}\n\nnamespace.ScriptListComponent = ScriptListComponent;"],"names":["namespace","Reflection","ScriptListComponent","options","Type","isPlainObject","gridId","createScriptButton","exportScriptButton","documentType","Event","bind","Script","Manager","Instance","createScript","then","reloadGrid","event","Dom","hasClass","BX","SidePanel","open","getAttribute","hasRows","addCustomEvent","scriptId","messageBox","MessageBox","message","Loc","getMessage","okCaption","onOk","deleteScript","response","data","error","alert","buttons","MessageBoxButtons","OK_CANCEL","popupOptions","events","onAfterShow","okBtn","getTarget","getButton","getContainer","focus","show","activateScript","deactivateScript","editScript","grid","reload","getRows","getCountDisplayed","Main","gridManager","getInstanceById","addClass","removeClass"],"mappings":"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"}