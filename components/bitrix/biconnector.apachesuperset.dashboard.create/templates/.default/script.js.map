{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Tag, Dom, Reflection, ajax } from 'main.core';\nimport { DashboardParametersSelector } from 'biconnector.dashboard-parameters-selector';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport { ButtonManager } from 'ui.buttons';\n\ntype Props = {\n\tnodeId: string,\n\tcomponentName: string,\n\tsignedParameters: string,\n\tdefaultValues: Object,\n\tscopeParamsMap: Object,\n};\n\n/**\n * @namespace BX.BIConnector\n */\nclass SupersetDashboardCreateManager\n{\n\t#props: Props;\n\t#node: HTMLElement;\n\t#paramsSelector: DashboardParametersSelector;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#node = document.querySelector(`#${this.#props.nodeId}`);\n\t\tthis.#render();\n\t}\n\n\t#render(): void\n\t{\n\t\tDom.append(this.#getTopBlock(), this.#node);\n\n\t\tDom.append(this.#getMainContent(), this.#node);\n\n\t\tthis.#paramsSelector = new DashboardParametersSelector({\n\t\t\tscopes: new Set(),\n\t\t\tparams: new Set(),\n\t\t\tscopeParamsMap: this.#props.scopeParamsMap,\n\t\t});\n\t\tDom.append(this.#paramsSelector.getLayout(), this.#node);\n\t}\n\n\t#getMainContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"dashboard-params-title-container\">\n\t\t\t\t\t<div class=\"dashboard-params-title\">\n\t\t\t\t\t\t${Loc.getMessage('DASHBOARD_CREATE_NAME')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 dashboard-title-wrapper\">\n\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element\" id=\"dashboard-title-field\" value=\"${this.#props.defaultValues.title}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTopBlock(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"dashboard-create-top-block\">\n\t\t\t\t<div class=\"dashboard-create-top-block-image\"></div>\n\t\t\t\t<div class=\"dashboard-create-top-block-text\">\n\t\t\t\t\t${Loc.getMessage('DASHBOARD_CREATE_TOP_BLOCK')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t// noinspection JSUnusedGlobalSymbols\n\tonClickSave(): void\n\t{\n\t\tconst selectorData = this.#paramsSelector.getValues();\n\t\tconst titleField = document.querySelector('#dashboard-title-field');\n\t\tconst saveData = {\n\t\t\tscopes: [...selectorData.scopes],\n\t\t\tparams: [...selectorData.params],\n\t\t\ttitle: titleField.value,\n\t\t};\n\t\tconst saveButton = ButtonManager.createFromNode(document.querySelector('#dashboard-button-save'));\n\t\tsaveButton.setWaiting(true);\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#props.componentName,\n\t\t\t'save',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.#props.signedParameters,\n\t\t\t\tdata: {\n\t\t\t\t\tdata: saveData,\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then((response) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('new', 'report_new', {\n\t\t\t\t\ttype: 'custom',\n\t\t\t\t\tc_element: 'new_button',\n\t\t\t\t});\n\t\t\t\tparent.BX.Event.EventEmitter.emit('BIConnector.CreateForm:onDashboardCreated', {\n\t\t\t\t\tdashboard: response.data.dashboard,\n\t\t\t\t});\n\t\t\t\tBX.SidePanel.Instance.getTopSlider().close();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t});\n\t\t\t\tsaveButton.setWaiting(false);\n\t\t\t});\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardCreateManager = SupersetDashboardCreateManager;\n"],"names":["SupersetDashboardCreateManager","props","document","querySelector","nodeId","selectorData","getValues","titleField","saveData","scopes","params","title","value","saveButton","ButtonManager","createFromNode","setWaiting","ajax","runComponentAction","componentName","mode","signedParameters","data","then","response","ApacheSupersetAnalytics","sendAnalytics","type","c_element","parent","BX","Event","EventEmitter","emit","dashboard","SidePanel","Instance","getTopSlider","close","UI","Notification","Center","notify","content","errors","message","Dom","append","DashboardParametersSelector","Set","scopeParamsMap","getLayout","Tag","render","Loc","getMessage","defaultValues","Reflection","namespace"],"mappings":"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"}