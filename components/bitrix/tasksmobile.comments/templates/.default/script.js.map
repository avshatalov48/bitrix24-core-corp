{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Dom, Event, GetWindowInnerSize, GetWindowScrollPos, Reflection } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { ResultManager } from 'tasks.result';\n\nconst namespace = Reflection.namespace('BX.TasksMobile');\n\nexport default class Comments\n{\n\tstatic get block(): Object\n\t{\n\t\treturn {\n\t\t\tcomments: 'comments',\n\t\t\tstub: 'stub',\n\t\t};\n\t}\n\n\tconstructor(options): void\n\t{\n\t\tthis.userId = options.userId;\n\t\tthis.taskId = options.taskId;\n\t\tthis.guid = options.guid;\n\t\tthis.isTabsMode = options.isTabsMode;\n\n\t\tthis.canReadCommentsOnInit = true;\n\n\t\tthis.timeout = 0;\n\t\tthis.timeoutSec = 2000;\n\t\tthis.commentsList = null;\n\t\tthis.unreadComments = new Map();\n\t\tthis.commentsToRead = new Map();\n\n\t\tthis.initTextField();\n\t\tthis.initCommentsBlock();\n\t\tthis.initTaskResultManager(options);\n\n\t\tthis.sendEvents(options);\n\t\tthis.bindEvents();\n\t}\n\n\tinitTextField(): void\n\t{\n\t\tif (BX.MobileUI.TextField.defaultParams)\n\t\t{\n\t\t\twindow.BX.MobileUI.TextField.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tBX.MobileUI.events.MOBILE_UI_TEXT_FIELD_SET_PARAMS,\n\t\t\t\t() => window.BX.MobileUI.TextField.show(),\n\t\t\t);\n\t\t}\n\t}\n\n\tinitCommentsBlock(): void\n\t{\n\t\tthis.stub = BX('commentsStub');\n\t\tthis.commentsBlock = BX('task-comments-block');\n\n\t\tconst firstComment = BX('post-comments-wrap').querySelector('.post-comment-block');\n\t\tthis.resolveVisibility(firstComment ? Comments.block.comments : Comments.block.stub);\n\t}\n\n\tresolveVisibility(visibleBlock = Comments.block.stub): void\n\t{\n\t\tconst hiddenClass = '--hidden';\n\n\t\tif (visibleBlock === Comments.block.stub)\n\t\t{\n\t\t\tif (Dom.hasClass(this.stub, hiddenClass))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.stub, hiddenClass);\n\t\t\t}\n\n\t\t\tif (!Dom.hasClass(this.commentsBlock, hiddenClass))\n\t\t\t{\n\t\t\t\tDom.addClass(this.commentsBlock, hiddenClass);\n\t\t\t}\n\t\t}\n\t\telse if (visibleBlock === Comments.block.comments)\n\t\t{\n\t\t\tif (Dom.hasClass(this.commentsBlock, hiddenClass))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.commentsBlock, hiddenClass);\n\t\t\t}\n\n\t\t\tif (!Dom.hasClass(this.stub, hiddenClass))\n\t\t\t{\n\t\t\t\tDom.addClass(this.stub, hiddenClass);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitTaskResultManager({ resultComments, isClosed })\n\t{\n\t\tResultManager.getInstance().initResult({\n\t\t\tcontext: 'task',\n\t\t\ttaskId: this.taskId,\n\t\t\tcomments: resultComments,\n\t\t\tisClosed,\n\t\t});\n\t}\n\n\tsendEvents(options): void\n\t{\n\t\tif (options.logId)\n\t\t{\n\t\t\tconst params = {\n\t\t\t\tlog_id: options.logId,\n\t\t\t\tts: options.currentTs,\n\t\t\t\tbPull: false,\n\t\t\t};\n\t\t\tBXMobileApp.onCustomEvent('onLogEntryRead', params, true);\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('OnUCHasBeenInitialized', (event) => {\n\t\t\tconst [xmlId, list] = event.getData();\n\t\t\tif (xmlId === `TASK_${this.taskId}`)\n\t\t\t{\n\t\t\t\tthis.commentsList = list;\n\t\t\t\tthis.commentsList.canCheckVisibleComments = !this.isTabsMode;\n\t\t\t\tthis.unreadComments = new Map(this.commentsList.unreadComments);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('onUCFormSubmit', (event) => {\n\t\t\tconst [data] = event.getData();\n\t\t\tif (data === `TASK_${this.taskId}`)\n\t\t\t{\n\t\t\t\tthis.sendOnCommentWrittenEvent();\n\t\t\t}\n\t\t\tthis.resolveVisibility(Comments.block.comments);\n\t\t});\n\n\t\tEventEmitter.subscribe('OnUCCommentWasPulled', (event) => {\n\t\t\tconst [id, data] = event.getData();\n\t\t\tif (id[0] === `TASK_${this.taskId}`)\n\t\t\t{\n\t\t\t\tconst author = data.messageFields.AUTHOR;\n\t\t\t\tif (Number(author.ID) !== Number(this.userId))\n\t\t\t\t{\n\t\t\t\t\tthis.unreadComments.set(id[1], new Date());\n\t\t\t\t}\n\t\t\t\tthis.resolveVisibility(Comments.block.comments);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('OnUCommentWasDeleted', (event) => {\n\t\t\tconst [xmlId, id] = event.getData();\n\t\t\tconst commentId = id[1];\n\t\t\tif (xmlId === `TASK_${this.taskId}`)\n\t\t\t{\n\t\t\t\tif (this.commentsList.getCommentsCount() <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.resolveVisibility(Comments.block.stub);\n\t\t\t\t}\n\t\t\t\tthis.unreadComments.delete(commentId);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('OnUCCommentWasRead', (event) => {\n\t\t\tconst [xmlId, id] = event.getData();\n\t\t\tconst commentId = id[1];\n\t\t\tif (xmlId === `TASK_${this.taskId}` && this.unreadComments.has(commentId))\n\t\t\t{\n\t\t\t\tthis.commentsToRead.set(commentId, this.unreadComments.get(commentId));\n\t\t\t\tthis.unreadComments.delete(commentId);\n\n\t\t\t\tthis.sendOnCommentsReadEvent(this.unreadComments.size);\n\n\t\t\t\tif (this.timeout <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.timeout = setTimeout(() => this.readComments(), this.timeoutSec);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent('onPull-tasks', () => {});\n\n\t\tif (this.isTabsMode)\n\t\t{\n\t\t\tBXMobileApp.addCustomEvent('tasks.task.tabs:onTabSelected', (event) => {\n\t\t\t\tif (event.guid === this.guid && this.commentsList)\n\t\t\t\t{\n\t\t\t\t\tthis.setCanCheckVisibleComments(event.tab === 'tasks.task.comments');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(document, 'visibilitychange', () => this.setCanCheckVisibleComments(!document.hidden));\n\t\t\tEvent.bind(window, 'pagehide', () => this.setCanCheckVisibleComments(false));\n\t\t\tEvent.bind(window, 'pageshow', () => this.setCanCheckVisibleComments(true));\n\t\t}\n\n\t\tBX.MobileUI.addLivefeedLongTapHandler(this.commentsBlock, { likeNodeClass: 'post-comment-control-item-like' });\n\t}\n\n\tsetCanCheckVisibleComments(canCheck: boolean): void\n\t{\n\t\tif (!this.isTabsMode && canCheck && this.canReadCommentsOnInit)\n\t\t{\n\t\t\tthis.canReadCommentsOnInit = false;\n\t\t\tthis.readComments();\n\t\t}\n\n\t\tif (!this.commentsList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.commentsList.canCheckVisibleComments = canCheck;\n\n\t\tif (canCheck)\n\t\t{\n\t\t\tconst scroll = GetWindowScrollPos();\n\t\t\tconst position = {\n\t\t\t\ttop: scroll.scrollTop,\n\t\t\t\tbottom: scroll.scrollTop + GetWindowInnerSize().innerHeight,\n\t\t\t};\n\t\t\tthis.commentsList.checkVisibleComments(position);\n\n\t\t\tif (this.canReadCommentsOnInit)\n\t\t\t{\n\t\t\t\tthis.canReadCommentsOnInit = false;\n\t\t\t\tthis.readComments();\n\t\t\t}\n\t\t}\n\t}\n\n\tsendOnCommentWrittenEvent(): void\n\t{\n\t\tconst params = {\n\t\t\ttaskId: this.taskId,\n\t\t};\n\t\tBXMobileApp.Events.postToComponent('tasks.task.comments:onCommentWritten', params);\n\t}\n\n\tsendOnCommentsReadEvent(newCommentsCount: number = 0): void\n\t{\n\t\tconst params = {\n\t\t\tnewCommentsCount,\n\t\t\ttaskId: this.taskId,\n\t\t};\n\t\tBXMobileApp.Events.postToComponent('tasks.task.comments:onCommentsRead', params);\n\t\tBXMobileApp.Events.postToComponent('task.view.onCommentsRead', params, 'tasks.list');\n\t}\n\n\treadComments(): void\n\t{\n\t\tthis.timeout = 0;\n\t\tthis.commentsToRead.clear();\n\n\t\tvoid BX.ajax.runAction('tasks.task.view.update', {\n\t\t\tdata: {\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tparameters: {\n\t\t\t\t\tIS_REAL_VIEW: 'Y',\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n\nnamespace.Comments = Comments;\n"],"names":["namespace","Reflection","Comments","comments","stub","options","userId","taskId","guid","isTabsMode","canReadCommentsOnInit","timeout","timeoutSec","commentsList","unreadComments","Map","commentsToRead","initTextField","initCommentsBlock","initTaskResultManager","sendEvents","bindEvents","BX","MobileUI","TextField","defaultParams","window","show","EventEmitter","subscribe","events","MOBILE_UI_TEXT_FIELD_SET_PARAMS","commentsBlock","firstComment","querySelector","resolveVisibility","block","visibleBlock","hiddenClass","Dom","hasClass","removeClass","addClass","resultComments","isClosed","ResultManager","getInstance","initResult","context","logId","params","log_id","ts","currentTs","bPull","BXMobileApp","onCustomEvent","event","getData","xmlId","list","canCheckVisibleComments","data","sendOnCommentWrittenEvent","id","author","messageFields","AUTHOR","Number","ID","set","Date","commentId","getCommentsCount","has","get","sendOnCommentsReadEvent","size","setTimeout","readComments","addCustomEvent","setCanCheckVisibleComments","tab","Event","bind","document","hidden","addLivefeedLongTapHandler","likeNodeClass","canCheck","scroll","GetWindowScrollPos","position","top","scrollTop","bottom","GetWindowInnerSize","innerHeight","checkVisibleComments","Events","postToComponent","newCommentsCount","clear","ajax","runAction","parameters","IS_REAL_VIEW"],"mappings":"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"}