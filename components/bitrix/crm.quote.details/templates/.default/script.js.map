{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Event, Reflection, Tag, Text, Type, Uri } from \"main.core\";\nimport { Popup } from \"main.popup\";\nimport { Button } from 'ui.buttons';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { ItemDetailsComponentParams } from \"crm.item-details-component\";\nimport { ItemDetailsComponent } from \"crm.item-details-component\";\nimport { Conversion } from \"crm.conversion\";\n\nconst printWindowWidth = 900;\nconst printWindowHeight = 600;\n\ndeclare type QuoteDetailsComponentParams = ItemDetailsComponentParams & {\n\tactivityEditorId: string,\n\temailSettings: ?EmailSettings,\n\tprintTemplates: PrintTemplate[],\n\tconversion: ?ConversionSettings,\n};\n\ndeclare type ConversionSettings = {\n\tlockScript?: Function,\n\tbuttonId?: string,\n\tmenuButtonId?: string,\n\tconverter?: Object,\n\tschemeSelector?: Object,\n};\n\ndeclare type PrintTemplate = {\n\tid: number,\n\tname: string,\n};\n\ndeclare type EmailSettings = {\n\tcommunications: Communication[],\n\townerType: string,\n\townerId: number,\n\townerPSID: number,\n\tsubject: string|number,\n\tstorageTypeID?: number,\n\twebdavelements?: FileInfo[],\n\tdiskfiles?: number[],\n\tfiles?: FileInfo[],\n};\n\ndeclare type Communication = {\n\tentityId: number,\n\tentityTitle: string,\n\ttype: string,\n\tvalue: any,\n};\n\ndeclare type FileInfo = {\n\tID: number,\n\tNAME: string|number,\n\tSIZE: number,\n\tVIEW_URL: string,\n\tFILE_ID?: number,\n\tBYTES?: number,\n\tCAN_READ?: boolean,\n\tPREVIEW_URL?: string,\n\tEDIT_URL?: string,\n\tDELETE_URL?: string,\n\tSHOW_URL?: string\n};\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass QuoteDetailsComponent extends ItemDetailsComponent\n{\n\tactivityEditorId: string;\n\temailSettings: EmailSettings;\n\tprintTemplates: PrintTemplate[];\n\tisMultipleTemplates: boolean;\n\tconversionSettings: ?ConversionSettings;\n\n\tconstructor(params: QuoteDetailsComponentParams)\n\t{\n\t\tsuper(params);\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.activityEditorId = params.activityEditorId;\n\n\t\t\tif (Type.isPlainObject(params.emailSettings))\n\t\t\t{\n\t\t\t\tthis.emailSettings = params.emailSettings;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.printTemplates))\n\t\t\t{\n\t\t\t\tthis.printTemplates = params.printTemplates;\n\t\t\t\tthis.isMultipleTemplates = Boolean(this.printTemplates.length > 1);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(params.conversion))\n\t\t\t{\n\t\t\t\tthis.conversionSettings = params.conversion;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tsuper.init();\n\n\t\tif (this.conversionSettings)\n\t\t{\n\t\t\tthis.initConversionApi();\n\t\t}\n\t}\n\n\tinitConversionApi(): void\n\t{\n\t\tconst converter = Conversion.Manager.Instance.initializeConverter(this.entityTypeId, this.conversionSettings.converter);\n\t\tconst schemeSelector = new Conversion.SchemeSelector(converter, this.conversionSettings.schemeSelector);\n\n\t\tif (this.conversionSettings.lockScript)\n\t\t{\n\t\t\tschemeSelector.subscribe('SchemeSelector:onSchemeSelected', this.conversionSettings.lockScript);\n\t\t\tschemeSelector.subscribe('SchemeSelector:onContainerClick', this.conversionSettings.lockScript);\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', this.conversionSettings.lockScript);\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', this.conversionSettings.lockScript);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tschemeSelector.enableAutoConversion();\n\n\t\t\tconst convertByEvent = (dstEntityTypeId: number) => {\n\t\t\t\tconst schemeItem = converter.getConfig().getScheme().getItemForSingleEntityTypeId(dstEntityTypeId);\n\t\t\t\tif (!schemeItem)\n\t\t\t\t{\n\t\t\t\t\tconsole.error('SchemeItem with single entityTypeId ' + dstEntityTypeId  + ' is not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconverter.getConfig().updateFromSchemeItem(schemeItem);\n\n\t\t\t\tconverter.convert(this.id);\n\t\t\t};\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.deal);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.invoice);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onAddNewItemButtonClick', ((event: BaseEvent) => {\n\t\t\t\tconst dstEntityTypeId = Number(event.getData().entityTypeId);\n\t\t\t\tif (dstEntityTypeId > 0)\n\t\t\t\t{\n\t\t\t\t\tconvertByEvent(dstEntityTypeId);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tsuper.bindEvents();\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPrint', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPdf', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickEmail', this.handleEmail.bind(this));\n\t}\n\n\thandlePrintOrPdf(event: BaseEvent): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst link = this.normalizeUrl(new Uri(event.getData().link));\n\t\tconst openInNewWindow = Boolean(event.getData().openInNewWindow);\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId) =>\n\t\t\t{\n\t\t\t\tthis.openPrintWindow(link, templateId, openInNewWindow);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.openPrintWindow(link, selectedPrintTemplate.id, openInNewWindow);\n\t\t}\n\t}\n\n\tvalidatePrintTemplates(): boolean\n\t{\n\t\tif (!Type.isArray(this.printTemplates) || (this.printTemplates.length <= 0))\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoPrintTemplates);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetSinglePrintTemplate(): PrintTemplate\n\t{\n\t\treturn this.printTemplates[this.printTemplates.length - 1];\n\t}\n\n\topenTemplateSelectDialog(): Promise<number>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst templateSelectDialogContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.messages.template}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\">\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = templateSelectDialogContent.querySelector('select');\n\n\t\t\tthis.printTemplates.forEach( ({id, name}) =>\n\t\t\t{\n\t\t\t\tselect.appendChild(Tag.render` <option value=\"${Text.encode(id)}\">${Text.encode(name)}</option> `);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: this.messages.selectTemplate,\n\t\t\t\tcontent: templateSelectDialogContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: this.messages.print,\n\t\t\t\t\t\tonclick: (button: Button, event: MouseEvent) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst selectedTemplateId = select.value;\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\tresolve(Number(selectedTemplateId));\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\treject('Template select dialog was closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\topenPrintWindow(link: Uri, templateId: number, openInNewWindow: boolean): void\n\t{\n\t\tlink.setQueryParam('PAY_SYSTEM_ID', templateId);\n\n\t\tif (openInNewWindow)\n\t\t{\n\t\t\tjsUtils.OpenWindow(link.toString(), printWindowWidth, printWindowHeight);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tjsUtils.Redirect([], link.toString());\n\t\t}\n\t}\n\n\thandleEmail(): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.emailSettings)\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoEmailSettings);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId: number) =>\n\t\t\t{\n\t\t\t\tthis.sendViaEmail(templateId);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.sendViaEmail(selectedPrintTemplate.id);\n\t\t}\n\t}\n\n\tsendViaEmail(templateId: number): void\n\t{\n\t\tthis.emailSettings.ownerPSID = templateId;\n\n\t\tif (!(top.BX.SidePanel.Instance))\n\t\t{\n\t\t\tthis.modifyEmailSettings(this.emailSettings).then((emailSettings) =>\n\t\t\t{\n\t\t\t\tthis.getActivityEditor().addEmail(emailSettings);\n\t\t\t}\n\t\t\t).catch(this.showErrorsFromResponse.bind(this));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getActivityEditor().addEmail(this.emailSettings);\n\t}\n\n\tmodifyEmailSettings(emailSettings: EmailSettings): Promise<EmailSettings>\n\t{\n\t\treturn Ajax.runComponentAction(\n\t\t\t'bitrix:crm.quote.details',\n\t\t\t'createEmailAttachment',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tanalyticsLabel: 'crmQuoteDetailsSendViaEmail',\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tpaymentSystemId: emailSettings.ownerPSID,\n\t\t\t\t}\n\t\t\t}).then( (response) =>\n\t\t\t{\n\t\t\t\tconst data: FileInfo = response.data;\n\n\t\t\t\temailSettings.storageTypeID = data['STORAGE_TYPE_ID'];\n\n\t\t\t\tif (emailSettings.storageTypeID === BX.CrmActivityStorageType.webdav)\n\t\t\t\t{\n\t\t\t\t\temailSettings.webdavelements = [ data ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.disk)\n\t\t\t\t{\n\t\t\t\t\temailSettings.diskfiles = [ Number(data.ID) ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.file)\n\t\t\t\t{\n\t\t\t\t\temailSettings.files = [ data ];\n\t\t\t\t}\n\n\t\t\t\treturn emailSettings;\n\t\t\t});\n\t}\n\n\tgetActivityEditor(): BX.CrmActivityEditor\n\t{\n\t\treturn BX.CrmActivityEditor.items[this.activityEditorId];\n\t}\n}\n\nnamespace.QuoteDetailsComponent = QuoteDetailsComponent;\n"],"names":["printWindowWidth","printWindowHeight","namespace","Reflection","QuoteDetailsComponent","params","Type","isPlainObject","activityEditorId","emailSettings","isArray","printTemplates","isMultipleTemplates","Boolean","length","conversion","conversionSettings","initConversionApi","converter","Conversion","Manager","Instance","initializeConverter","entityTypeId","schemeSelector","SchemeSelector","lockScript","subscribe","EventEmitter","enableAutoConversion","convertByEvent","dstEntityTypeId","schemeItem","getConfig","getScheme","getItemForSingleEntityTypeId","console","error","updateFromSchemeItem","convert","id","BX","CrmEntityType","enumeration","deal","invoice","event","Number","getData","handlePrintOrPdf","bind","handleEmail","validatePrintTemplates","link","normalizeUrl","Uri","openInNewWindow","openTemplateSelectDialog","then","templateId","openPrintWindow","selectedPrintTemplate","getSinglePrintTemplate","showError","messages","errorNoPrintTemplates","Promise","resolve","reject","templateSelectDialogContent","Tag","render","template","select","querySelector","forEach","name","appendChild","Text","encode","popup","Popup","titleBar","selectTemplate","content","closeByEsc","closeIcon","buttons","Button","text","print","onclick","button","selectedTemplateId","value","destroy","events","onClose","show","setQueryParam","jsUtils","OpenWindow","toString","Redirect","errorNoEmailSettings","sendViaEmail","ownerPSID","top","SidePanel","modifyEmailSettings","getActivityEditor","addEmail","showErrorsFromResponse","Ajax","runComponentAction","mode","signedParameters","analyticsLabel","data","paymentSystemId","response","storageTypeID","CrmActivityStorageType","webdav","webdavelements","disk","diskfiles","ID","file","files","CrmActivityEditor","items","ItemDetailsComponent"],"mappings":"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"}