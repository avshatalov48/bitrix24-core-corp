{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Event, Reflection, Tag, Text, Type, Uri } from \"main.core\";\nimport { Popup } from \"main.popup\";\nimport { Button } from 'ui.buttons';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { ItemDetailsComponentParams } from \"crm.item-details-component\";\nimport { ItemDetailsComponent } from \"crm.item-details-component\";\n\nconst printWindowWidth = 900;\nconst printWindowHeight = 600;\n\ndeclare type QuoteDetailsComponentParams = ItemDetailsComponentParams & {\n\tactivityEditorId: string,\n\temailSettings: ?EmailSettings,\n\tprintTemplates: PrintTemplate[],\n\tconversion: ?ConversionSettings,\n};\n\ndeclare type ConversionSettings = {\n\tlockScript?: Function,\n\tbuttonId?: string,\n\tmenuButtonId?: string,\n\tscheme?: {messages: Object},\n\tschemeSelector?: Object,\n\tconverter?: {messages: Object, permissions: Object, settings: Object},\n};\n\ndeclare type PrintTemplate = {\n\tid: number,\n\tname: string,\n};\n\ndeclare type EmailSettings = {\n\tcommunications: Communication[],\n\townerType: string,\n\townerId: number,\n\townerPSID: number,\n\tsubject: string|number,\n\tstorageTypeID?: number,\n\twebdavelements?: FileInfo[],\n\tdiskfiles?: number[],\n\tfiles?: FileInfo[],\n};\n\ndeclare type Communication = {\n\tentityId: number,\n\tentityTitle: string,\n\ttype: string,\n\tvalue: any,\n};\n\ndeclare type FileInfo = {\n\tID: number,\n\tNAME: string|number,\n\tSIZE: number,\n\tVIEW_URL: string,\n\tFILE_ID?: number,\n\tBYTES?: number,\n\tCAN_READ?: boolean,\n\tPREVIEW_URL?: string,\n\tEDIT_URL?: string,\n\tDELETE_URL?: string,\n\tSHOW_URL?: string\n};\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass QuoteDetailsComponent extends ItemDetailsComponent\n{\n\tactivityEditorId: string;\n\temailSettings: EmailSettings;\n\tprintTemplates: PrintTemplate[];\n\tisMultipleTemplates: boolean;\n\tconversionSettings: ?ConversionSettings;\n\n\tconstructor(params: QuoteDetailsComponentParams)\n\t{\n\t\tsuper(params);\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.activityEditorId = params.activityEditorId;\n\n\t\t\tif (Type.isPlainObject(params.emailSettings))\n\t\t\t{\n\t\t\t\tthis.emailSettings = params.emailSettings;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.printTemplates))\n\t\t\t{\n\t\t\t\tthis.printTemplates = params.printTemplates;\n\t\t\t\tthis.isMultipleTemplates = Boolean(this.printTemplates.length > 1);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(params.conversion))\n\t\t\t{\n\t\t\t\tthis.conversionSettings = params.conversion;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tsuper.init();\n\n\t\tif (this.conversionSettings)\n\t\t{\n\t\t\tthis.initConversionApi();\n\t\t}\n\t}\n\n\tinitConversionApi(): void\n\t{\n\t\tif (this.conversionSettings.lockScript)\n\t\t{\n\t\t\tconst button = document.getElementById(this.conversionSettings.buttonId);\n\t\t\tif (button)\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', this.conversionSettings.lockScript);\n\t\t\t}\n\t\t\tconst menuButton = document.getElementById(this.conversionSettings.menuButtonId);\n\t\t\tif (menuButton)\n\t\t\t{\n\t\t\t\tEvent.bind(menuButton, 'click', this.conversionSettings.lockScript);\n\t\t\t}\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', this.conversionSettings.lockScript);\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', this.conversionSettings.lockScript);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.CrmQuoteConversionScheme.messages = this.conversionSettings.scheme.messages;\n\n\t\tBX.CrmQuoteConversionSchemeSelector.create(\n\t\t\t\"quote_converter\",\n\t\t\tthis.conversionSettings.schemeSelector\n\t\t);\n\n\t\tBX.CrmQuoteConverter.messages = this.conversionSettings.converter.messages;\n\t\tBX.CrmQuoteConverter.permissions = this.conversionSettings.converter.permissions;\n\t\tBX.CrmQuoteConverter.settings = this.conversionSettings.converter.settings;\n\n\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', () =>\n\t\t{\n\t\t\tBX.CrmQuoteConverter.getCurrent().convert(\n\t\t\t\tthis.id,\n\t\t\t\tBX.CrmQuoteConversionScheme.createConfig(BX.CrmQuoteConversionScheme.deal),\n\t\t\t\twindow.location.href,\n\t\t\t);\n\t\t});\n\n\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', () =>\n\t\t{\n\t\t\tBX.CrmQuoteConverter.getCurrent().convert(\n\t\t\t\tthis.id,\n\t\t\t\tBX.CrmQuoteConversionScheme.createConfig(BX.CrmQuoteConversionScheme.invoice),\n\t\t\t\twindow.location.href,\n\t\t\t);\n\t\t});\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tsuper.bindEvents();\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPrint', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPdf', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickEmail', this.handleEmail.bind(this));\n\t}\n\n\thandlePrintOrPdf(event: BaseEvent): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst link = this.normalizeUrl(new Uri(event.getData().link));\n\t\tconst openInNewWindow = Boolean(event.getData().openInNewWindow);\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId) =>\n\t\t\t{\n\t\t\t\tthis.openPrintWindow(link, templateId, openInNewWindow);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.openPrintWindow(link, selectedPrintTemplate.id, openInNewWindow);\n\t\t}\n\t}\n\n\tvalidatePrintTemplates(): boolean\n\t{\n\t\tif (!Type.isArray(this.printTemplates) || (this.printTemplates.length <= 0))\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoPrintTemplates);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetSinglePrintTemplate(): PrintTemplate\n\t{\n\t\treturn this.printTemplates[this.printTemplates.length - 1];\n\t}\n\n\topenTemplateSelectDialog(): Promise<number>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst templateSelectDialogContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.messages.template}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\">\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = templateSelectDialogContent.querySelector('select');\n\n\t\t\tthis.printTemplates.forEach( ({id, name}) =>\n\t\t\t{\n\t\t\t\tselect.appendChild(Tag.render` <option value=\"${Text.encode(id)}\">${Text.encode(name)}</option> `);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: this.messages.selectTemplate,\n\t\t\t\tcontent: templateSelectDialogContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: this.messages.print,\n\t\t\t\t\t\tonclick: (button: Button, event: MouseEvent) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst selectedTemplateId = select.value;\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\tresolve(Number(selectedTemplateId));\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\treject('Template select dialog was closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\topenPrintWindow(link: Uri, templateId: number, openInNewWindow: boolean): void\n\t{\n\t\tlink.setQueryParam('PAY_SYSTEM_ID', templateId);\n\n\t\tif (openInNewWindow)\n\t\t{\n\t\t\tjsUtils.OpenWindow(link.toString(), printWindowWidth, printWindowHeight);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tjsUtils.Redirect([], link.toString());\n\t\t}\n\t}\n\n\thandleEmail(): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.emailSettings)\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoEmailSettings);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId: number) =>\n\t\t\t{\n\t\t\t\tthis.sendViaEmail(templateId);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.sendViaEmail(selectedPrintTemplate.id);\n\t\t}\n\t}\n\n\tsendViaEmail(templateId: number): void\n\t{\n\t\tthis.emailSettings.ownerPSID = templateId;\n\n\t\tif (!(top.BX.SidePanel.Instance))\n\t\t{\n\t\t\tthis.modifyEmailSettings(this.emailSettings).then((emailSettings) =>\n\t\t\t{\n\t\t\t\tthis.getActivityEditor().addEmail(emailSettings);\n\t\t\t}\n\t\t\t).catch(this.showErrorsFromResponse.bind(this));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getActivityEditor().addEmail(this.emailSettings);\n\t}\n\n\tmodifyEmailSettings(emailSettings: EmailSettings): Promise<EmailSettings>\n\t{\n\t\treturn Ajax.runComponentAction(\n\t\t\t'bitrix:crm.quote.details',\n\t\t\t'createEmailAttachment',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tanalyticsLabel: 'crmQuoteDetailsSendViaEmail',\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tpaymentSystemId: emailSettings.ownerPSID,\n\t\t\t\t}\n\t\t\t}).then( (response) =>\n\t\t\t{\n\t\t\t\tconst data: FileInfo = response.data;\n\n\t\t\t\temailSettings.storageTypeID = data['STORAGE_TYPE_ID'];\n\n\t\t\t\tif (emailSettings.storageTypeID === BX.CrmActivityStorageType.webdav)\n\t\t\t\t{\n\t\t\t\t\temailSettings.webdavelements = [ data ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.disk)\n\t\t\t\t{\n\t\t\t\t\temailSettings.diskfiles = [ Number(data.ID) ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.file)\n\t\t\t\t{\n\t\t\t\t\temailSettings.files = [ data ];\n\t\t\t\t}\n\n\t\t\t\treturn emailSettings;\n\t\t\t});\n\t}\n\n\tgetActivityEditor(): BX.CrmActivityEditor\n\t{\n\t\treturn BX.CrmActivityEditor.items[this.activityEditorId];\n\t}\n}\n\nnamespace.QuoteDetailsComponent = QuoteDetailsComponent;\n"],"names":["printWindowWidth","printWindowHeight","namespace","Reflection","QuoteDetailsComponent","params","Type","isPlainObject","activityEditorId","emailSettings","isArray","printTemplates","isMultipleTemplates","Boolean","length","conversion","conversionSettings","initConversionApi","lockScript","button","document","getElementById","buttonId","Event","bind","menuButton","menuButtonId","EventEmitter","subscribe","BX","CrmQuoteConversionScheme","messages","scheme","CrmQuoteConversionSchemeSelector","create","schemeSelector","CrmQuoteConverter","converter","permissions","settings","getCurrent","convert","id","createConfig","deal","window","location","href","invoice","handlePrintOrPdf","handleEmail","event","validatePrintTemplates","link","normalizeUrl","Uri","getData","openInNewWindow","openTemplateSelectDialog","then","templateId","openPrintWindow","catch","selectedPrintTemplate","getSinglePrintTemplate","showError","errorNoPrintTemplates","Promise","resolve","reject","templateSelectDialogContent","Tag","render","template","select","querySelector","forEach","name","appendChild","Text","encode","popup","Popup","titleBar","selectTemplate","content","closeByEsc","closeIcon","buttons","Button","text","print","onclick","selectedTemplateId","value","destroy","Number","events","onClose","show","setQueryParam","jsUtils","OpenWindow","toString","Redirect","errorNoEmailSettings","sendViaEmail","ownerPSID","top","SidePanel","Instance","modifyEmailSettings","getActivityEditor","addEmail","showErrorsFromResponse","Ajax","runComponentAction","mode","signedParameters","analyticsLabel","data","entityTypeId","paymentSystemId","response","storageTypeID","CrmActivityStorageType","webdav","webdavelements","disk","diskfiles","ID","file","files","CrmActivityEditor","items","ItemDetailsComponent"],"mappings":"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"}