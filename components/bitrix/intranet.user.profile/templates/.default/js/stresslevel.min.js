(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.StressLevel){return}e.StressLevel=function(e){this.init(e)};e.StressLevel.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.loader=null;this.stressLevel={value:null,type:null,typeDescription:null,comment:null,hash:null};this.noResultNode=BX("intranet-user-profile-stresslevel-noresult");this.resultNode=BX("intranet-user-profile-stresslevel-result");if(!this.resultNode||!this.noResultNode){return}this.resultStatusInfoNode=BX("intranet-user-profile-stresslevel-status-info");this.permsOpenNode=BX("intranet-user-profile-stresslevel-result-perms-open");this.permsCloseNode=BX("intranet-user-profile-stresslevel-result-perms-close");this.checkNode=BX("intranet-user-profile-stresslevel-check");this.widgetNode=BX("intranet-user-profile-stresslevel-widget");this.widgetNoResultNode=BX("intranet-user-profile-stresslevel-noresult-widget");this.resultCommentNode=BX("intranet-user-profile-stresslevel-comment");this.resultCopyLinkNode=BX("intranet-user-profile-stresslevel-status-copy");this.widgetLayout={container:null,arrow:null,level:null,content:null,title:null,progress:null};this.url={};this.measurementId=null;this.classes={widget:"intranet-stress-level-widget",widgetArrow:"intranet-stress-level-widget-arrow",widgetContent:"intranet-stress-level-widget-content",widgetContentTitle:"intranet-stress-level-widget-content-title",widgetContentProgress:"intranet-stress-level-widget-content-progress",widgetContentProgressEmpty:"intranet-stress-level-widget-content-progress-empty"};BX.UI.Hint.init(this.noResultNode);BX.UI.Hint.init(this.resultNode);this.getData();if(this.managerInstance.canEditProfile){this.getOpenPerms()}BX.bind(this.permsOpenNode,"click",function(){this.setOpenPerms({value:true})}.bind(this));BX.bind(this.permsCloseNode,"click",function(){this.setOpenPerms({value:false})}.bind(this));BX.bind(this.checkNode,"click",function(){this.openSlider({page:""})}.bind(this));BX.bind(this.resultStatusInfoNode,"click",function(){this.openSlider({page:"result"})}.bind(this));if(this.resultCopyLinkNode){var t=navigator.userAgent.match(/chrome\/(\d+)/i);if(t&&parseInt(t[1])>=76){BX.bind(this.resultCopyLinkNode,"click",function(){if(this.measurementId){this.copyToBuffer()}}.bind(this))}else{this.resultCopyLinkNode.style.display="none"}}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runAction("socialnetwork.api.user.stresslevel.get",{signedParameters:this.managerInstance.signedParameters,data:{c:"bitrix:intranet.user.profile",fields:{userId:this.managerInstance.userId}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});if(BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyObject(e.data.url)){this.url=e.data.url}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.id!="undefined"){this.measurementId=parseInt(e.data.id)}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.value!="undefined"){this.showData(e.data)}else if(BX.message("USER_ID")==this.managerInstance.userId){this.showEmpty()}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader})}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)&&typeof e.value!="undefined"){if(this.noResultNode){this.resultNode.style.display="none"}if(!this.resultNode){return}this.stressLevel.value=parseInt(e.value)>0?parseInt(e.value):0;this.stressLevel.comment=BX.type.isNotEmptyString(e.comment)?e.comment:"";this.stressLevel.type=BX.type.isNotEmptyString(e.type)?e.type:"";this.stressLevel.typeDescription=BX.type.isNotEmptyString(e.typeDescription)?e.typeDescription:"";this.stressLevel.hash=BX.type.isNotEmptyString(e.hash)?e.hash:"";this.resultNode.style.display="block";this.renderData()}},showEmpty:function(){if(this.noResultNode){this.noResultNode.style.display="block"}if(this.resultNode){this.resultNode.style.display="none"}this.renderEmptyData()},getOpenPerms:function(){BX.ajax.runAction("socialnetwork.api.user.stresslevel.getaccess",{data:{fields:{userId:this.managerInstance.userId}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},setOpenPerms:function(e){if(!BX.type.isNotEmptyObject(e)){e={}}if(!BX.type.isBoolean(e.value)){e.value=false}BX.ajax.runAction("socialnetwork.api.user.stresslevel.setaccess",{data:{fields:{userId:this.managerInstance.userId,value:e.value?"Y":"N"}}}).then(function(e){if(BX.type.isNotEmptyString(e.data.value)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},showOpenPerms:function(e){if(e=="Y"){this.permsCloseNode.style.display="block";this.permsOpenNode.style.display="none"}else{this.permsCloseNode.style.display="none";this.permsOpenNode.style.display="block"}},openSlider:function(e){var t=BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyString(e.page)?e.page:"";var s="";if(t=="result"&&BX.type.isNotEmptyString(this.url.result)){s=this.url.result}else if(BX.type.isNotEmptyString(this.url.check)){s=this.url.check}if(BX.type.isNotEmptyString(s)){BX.SidePanel.Instance.open(s,{cacheable:false,data:{},width:500})}},renderData:function(){if(!this.widgetNode){return}this.widgetNode.appendChild(this.getRenderContainer());this.afterRender();if(this.resultCommentNode&&BX.type.isNotEmptyString(this.stressLevel.comment)){this.resultCommentNode.innerHTML=BX.util.htmlspecialchars(this.stressLevel.comment)}if(BX.type.isNotEmptyString(this.stressLevel.type)&&BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type)){BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).style.display="inline-block";BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).innerHTML=BX.util.htmlspecialchars(this.stressLevel.typeDescription)}},renderEmptyData:function(){if(!this.widgetNoResultNode){return}this.widgetNoResultNode.appendChild(this.getRenderContainer());this.afterRender()},getRenderContainer:function(){if(!this.widgetLayout.container){this.widgetLayout.container=BX.create("DIV",{props:{className:this.classes.widget},children:[this.getRenderArrowContainer(),this.getRenderContentContainer()]})}return this.widgetLayout.container},getRenderArrowContainer:function(){if(!this.widgetLayout.arrow){this.widgetLayout.arrow=BX.create("DIV",{props:{className:this.classes.widgetArrow}})}return this.widgetLayout.arrow},getRenderContentContainer:function(){if(!this.widgetLayout.content){this.widgetLayout.content=BX.create("DIV",{props:{className:this.classes.widgetContent},children:[this.widgetLayout.title=BX.create("DIV",{props:{className:this.classes.widgetContentTitle},text:BX.message("INTRANET_USER_PROFILE_STRESSLEVEL_NORESULT_INDICATOR_TEXT")}),this.widgetLayout.progress=BX.create("DIV",{props:{className:this.classes.widgetContentProgress},text:"?"})]})}return this.widgetLayout.content},afterRender:function(){if(!this.stressLevel.value){this.widgetLayout.progress.classList.add(this.classes.widgetContentProgressEmpty);this.getRenderArrowContainer().style.transform="rotate(90deg)";return}setTimeout(function(){this.animateRenderNumber();this.getRenderArrowContainer().style.transform="rotate("+this.getRenderProgressScale()+"deg)"}.bind(this),1e3)},animateRenderNumber:function(){var e=0;var t=600/this.stressLevel.value;var s=setInterval(function(){e++;this.widgetLayout.progress.innerHTML=e;e===this.stressLevel.value?clearInterval(s):null}.bind(this),t)},getRenderProgressScale:function(){return 1.8*this.stressLevel.value},copyToBuffer:function(){if(!this.measurementId){return}var e="/bitrix/components/bitrix/intranet.user.profile/stresslevel_img.php";fetch(e).then(function(e){return e.blob()}).then(function(e){navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:true}))])}).catch(function(e){})}}})();
//# sourceMappingURL=stresslevel.map.js