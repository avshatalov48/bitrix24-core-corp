BX.namespace("BX.Mobile.Tasks.View.Bitrix");BX.Mobile.Tasks.roles=function(e,t){this.parentConstruct(BX.Mobile.Tasks.roles,e);BX.merge(this,{sys:{classCode:"roles"},vars:{userId:false},opts:{}});BX.merge(e,{siteId:BX.message("SITE_ID"),usePull:true});this.handleInitStack(t,BX.Mobile.Tasks.roles,e)};BX.extend(BX.Mobile.Tasks.roles,BX.Mobile.Tasks.page);BX.merge(BX.Mobile.Tasks.roles.prototype,{init:function(){},dynamicActionsCustom:function(e){var t=this.instance("taskgroups");if(typeof t!="undefined"){t.setCounters(e.counters);t.setUserId(e.userId);this.resetMenu(this.getMenu())}},pullHandler:function(e){try{if(e.command=="user_counter"&&e.module_id=="main"&&BX.type.isPlainObject(e.params[this.option("siteId")])){var t=e.params[this.option("siteId")];if(BX.type.isPlainObject(this.option("counterToRole"))){var s={};var i=0;for(var o in this.option("counterToRole")){if(typeof t[o]!="undefined"){s[this.option("counterToRole")[o]]=parseInt(t[o]);i++}}if(i>0)this.instance("taskgroups").setCounters(s,true)}}}catch(a){BX.debug("Counters has not been updated");BX.debug(a)}},getMenu:function(){return[{name:BX.message("MB_TASKS_ROLES_TASK_ADD"),arrowFlag:false,icon:"add",action:BX.delegate(function(){BX.Mobile.Tasks.createWindow(this.getUser())},this)}]}});BX.Mobile.Tasks.View.Bitrix.taskgroups=function(e,t){this.parentConstruct(BX.Mobile.Tasks.View.Bitrix.taskgroups,e);BX.merge(this,{sys:{classCode:"taskgroups"},vars:{userId:0}});this.handleInitStack(t,BX.Mobile.Tasks.View.Bitrix.taskgroups,e)};BX.extend(BX.Mobile.Tasks.View.Bitrix.taskgroups,BX.Mobile.Tasks.widget);BX.merge(BX.Mobile.Tasks.View.Bitrix.taskgroups.prototype,{init:function(){if(typeof window.BXMobileApp!="undefined"){BX.bindDelegate(this.getScope(),"click",{attribute:{"data-bx-id":this.classCode()+"-group-url"}},this.passCtx(this.follow,this));BX.bindDelegate(this.getScope(),"click",{attribute:{"data-bx-id":this.classCode()+"-subgroup"}},this.passCtx(this.follow,this));BX.bindDelegate(this.getScope(),"touchstart",{attribute:{"data-bx-id":this.classCode()+"-group-url"}},this.passCtx(this.touch,this));BX.bindDelegate(this.getScope(),"touchstart",{attribute:{"data-bx-id":this.classCode()+"-subgroup"}},this.passCtx(this.touch,this))}},touch:function(){BX.addClass(this,"hover");var e=this;setTimeout(function(){BX.removeClass(e,"hover")},1e3)},follow:function(e,t){BX.eventCancelBubble(t);var s=BX.data(this,"url");if(e.vars.userId>0){s=s.replace("%USER_ID%",e.vars.userId).replace("%user_id%",e.vars.userId);if(BX.type.isNotEmptyString(s)){window.BXMobileApp.PageManager.loadPageUnique({url:s,bx24ModernStyle:true})}}return BX.PreventDefault(t)},setUserId:function(e){this.vars.userId=parseInt(e)},setCounters:function(e,t){if(BX.type.isPlainObject(e)){var s=this.controlR("group",{all:true}),i,o,a,r,n,u;for(n=0;n<s.length;n++){i=BX.data(s[n],"group-id");if(BX.type.isElementNode(s[n])){a=this.control("counter",false,{all:true,scope:s[n],noCache:true});for(u=0;u<a.length;u++){o=a[u];if(BX.type.isElementNode(o)){r=BX.data(o,"counter-id");if(BX.type.isNotEmptyString(i)&&typeof e[i]!="undefined"&&e[i]&&e[i][r]&&parseInt(e[i][r]["VALUE"])>0){o.innerHTML=parseInt(e[i][r]["VALUE"]);if(r=="TOTAL")BX.removeClass(o,"hidden");else BX.removeClass(o.parentNode,"hidden")}else if(!t){if(r=="TOTAL")BX.addClass(o,"hidden");else BX.addClass(o.parentNode,"hidden")}}}}}}}});
//# sourceMappingURL=script.map.js