{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Loc} from \"main.core\";\nimport {typeof BaseEvent, EventEmitter} from \"main.core.events\";\nimport { AccessDeniedInput } from \"catalog.access-denied-input\";\n\nclass StoreAmountDetails\n{\n\tconstructor(settings)\n\t{\n\t\tthis.gridId = settings.gridId;\n\t\tthis.productId = settings.productId;\n\t\tthis.allowPurchasingPrice = settings.allowPurchasingPrice;\n\n\t\tthis.onFilterApplyHandler = this.onFilterApply.bind(this);\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApplyHandler);\n\n\t\tif (!this.allowPurchasingPrice)\n\t\t{\n\t\t\tthis.#initPurchasingPrice();\n\t\t\tEventEmitter.subscribe('Grid::updated', this.#initPurchasingPrice.bind(this));\n\t\t}\n\t}\n\n\tgetGridId()\n\t{\n\t\treturn this.gridId;\n\t}\n\n\tgetProductId()\n\t{\n\t\treturn this.productId;\n\t}\n\n\tonFilterApply(event: BaseEvent)\n\t{\n\t\tconst [gridId] = event.getCompatData();\n\n\t\tif (gridId !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.store.amount.details',\n\t\t\t'updateTotalData',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tproductId: this.getProductId(),\n\t\t\t\t}\n\t\t\t}\n\t\t).then(response => {\n\t\t\tconst totalData = response?.data?.TOTAL_DATA;\n\t\t\tif (!totalData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst quantityAvailableNode = document.getElementById(this.getGridId() + '_total_quantity_available');\n\t\t\tif (quantityAvailableNode)\n\t\t\t{\n\t\t\t\tquantityAvailableNode.innerHTML = totalData.QUANTITY_AVAILABLE;\n\t\t\t}\n\n\t\t\tconst quantityReservedNode = document.getElementById(this.getGridId() + '_total_quantity_reserved');\n\t\t\tif (quantityReservedNode)\n\t\t\t{\n\t\t\t\tquantityReservedNode.innerHTML = totalData.QUANTITY_RESERVED;\n\t\t\t}\n\n\t\t\tconst quantityCommonNode = document.getElementById(this.getGridId() + '_total_quantity_common');\n\t\t\tif (quantityCommonNode)\n\t\t\t{\n\t\t\t\tquantityCommonNode.innerHTML = totalData.QUANTITY_COMMON;\n\t\t\t}\n\n\t\t\tconst totalPriceNode = document.getElementById(this.getGridId() + '_total_price');\n\t\t\tif (totalPriceNode)\n\t\t\t{\n\t\t\t\ttotalPriceNode.innerHTML = totalData.PRICE;\n\t\t\t}\n\t\t});\n\t}\n\n\t#getGrid()\n\t{\n\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t{\n\t\t\tthrow Error(`Cannot find grid`)\n\t\t}\n\n\t\treturn BX.Main.gridManager.getInstanceById(this.getGridId());\n\t}\n\n\t#initPurchasingPrice(): void\n\t{\n\t\tthis.#getGrid().getContainer().querySelectorAll('purchasing-price').forEach((element) => {\n\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\thint: Loc.getMessage('CATALOG_PRODUCTCARD_STORE_AMOUNT_DETAILS_PURCHASING_PRICE_HINT'),\n\t\t\t\tisReadOnly: true,\n\t\t\t});\n\t\t\tinput.renderTo(element);\n\t\t});\n\t}\n}\n\nReflection.namespace('BX.Catalog').StoreAmountDetails = StoreAmountDetails;\n"],"names":["StoreAmountDetails","settings","gridId","productId","allowPurchasingPrice","onFilterApplyHandler","onFilterApply","bind","EventEmitter","subscribe","event","getCompatData","getGridId","BX","ajax","runComponentAction","mode","data","getProductId","then","response","totalData","TOTAL_DATA","quantityAvailableNode","document","getElementById","innerHTML","QUANTITY_AVAILABLE","quantityReservedNode","QUANTITY_RESERVED","quantityCommonNode","QUANTITY_COMMON","totalPriceNode","PRICE","Reflection","getClass","Error","Main","gridManager","getInstanceById","getContainer","querySelectorAll","forEach","element","input","AccessDeniedInput","hint","Loc","getMessage","isReadOnly","renderTo","namespace"],"mappings":"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"}