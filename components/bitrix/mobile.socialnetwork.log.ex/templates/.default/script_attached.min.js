(function(){if(window["oMSL"])return;var e={},t={},o=function(o,n){var i=oMSL.getLogId();if(t[n.join("-")]!=="hidden"){t[n.join("-")]="hidden";if(e[i]){e[i]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:i,num:e[i]["POST_NUM_COMMENTS"]},true)}}};BX.addCustomEvent(window,"OnUCommentWasDeleted",o);BX.addCustomEvent(window,"OnUCommentWasHidden",o);BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(o,n){var i=oMSL.getLogId();t[o]=t[o]||{};if(t[n.join("-")]!=="drawn"){t[n.join("-")]="drawn";var a;if(e[i]&&(a=BX("record-"+n.join("-")+"-cover"))&&a&&a.parentNode==BX("record-"+o+"-new")){e[i]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:i,num:e[i]["POST_NUM_COMMENTS"]},true)}}});BX.addCustomEvent(window,"OnUCFormSubmit",function(e,t,o,n){if(n&&n["mobile_action"]&&n["mobile_action"]=="add_comment"&&t>0){n["mobile_action"]=n["action"]="edit_comment";n["edit_id"]=t}});window.__MSLRepositLog=function(t,o){e[t]=o}})();function __MSLOnPostRead(e,t){if(!BX.type.isDomNode(e)||e.hasAttribute("done")){return false}return BX.MobileLivefeed.ImportantManagerInstance.setPostRead(e)}function __MSLOnFeedPreInit(e){if(typeof e.arAvailableGroup!="undefined"){window.arAvailableGroup=e.arAvailableGroup}BX.addCustomEvent("onFrameDataReceivedBefore",function(e){BitrixMobile.LazyLoad.clearImages()});BX.addCustomEvent("BX.LazyLoad:ImageLoaded",function(){var e=BX.GetWindowSize();window.maxScroll=e.scrollHeight-e.innerHeight-190});BX.addCustomEvent("onFrameDataReceived",function(e){window.isPullDownEnabled=false;window.isPullDownLocked=false;window.isFrameDataReceived=true;app.exec("pullDownLoadingStop");BitrixMobile.LazyLoad.showImages(true)});BX.addCustomEvent("onFrameDataProcessed",function(e,t){if(typeof e!="undefined"&&typeof e[0]!="undefined"&&typeof t!="undefined"&&t){if(typeof e[0]["PROPS"]!="undefined"&&typeof e[0]["PROPS"]["TS"]!="undefined"&&parseInt(e[0]["PROPS"]["TS"])>0){BX.MobileLivefeed.Instance.setOptions({frameCacheTs:parseInt(e[0]["PROPS"]["TS"])})}}BitrixMobile.LazyLoad.showImages(true);if(!!t){BX.MobileLivefeed.Instance.setPreventNextPage(true)}});BX.addCustomEvent("onCacheDataRequestStart",function(){setTimeout(function(){if(typeof window.isFrameDataReceived=="undefined"||!window.isFrameDataReceived){window.isPullDownLocked=true;app.exec("pullDownLoadingStart")}},1e3)});BX.addCustomEvent("onFrameDataReceivedError",function(){app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.exec("pullDownLoadingStop");__MSLRefreshError(true)})})});BX.addCustomEvent("onFrameDataRequestFail",function(e){if(typeof e!="undefined"&&typeof e.reason!="undefined"&&e.reason=="bad_eval"){window.isPullDownLocked=false;app.exec("pullDownLoadingStop");__MSLRefreshError(true)}else{app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.exec("pullDownLoadingStop");__MSLRefreshError(true)})})}});BX.addCustomEvent("onCacheInvokeAfter",function(e,t){var o=t.items;if(o.length<=0){BX.frameCache.update(true,true)}});BXMobileApp.addCustomEvent("onAfterEdit",function(e){oMSL.afterEdit(e.postResponseData,e.postData.data.log_id)});BX.addCustomEvent("onPullDownDisable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)});BX.addCustomEvent("onPullDownEnable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)});BXMobileApp.UI.Page.Refresh.setParams({callback:function(){if(!window.isPullDownLocked){__MSLRefresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}function __MSLOnFeedInit(e){logID=parseInt(e.logID);bAjaxCall=!!e.bAjaxCall;bReload=!!e.bReload;bEmptyPage=!!e.bEmptyPage;bFiltered=!!e.bFiltered;bEmptyGetComments=!!e.bEmptyGetComments;groupID=parseInt(e.groupID);tmstmp=parseInt(e.tmstmp);strCounterType=e.strCounterType;oMSL.bFollowDefault=!!e.bFollowDefault;oMSL.groupID=parseInt(e.groupID);oMSL.ftMinTokenSize=parseInt(e.ftMinTokenSize);oMSL.bShowExpertMode=!!e.bShowExpertMode;oMSL.bExpertMode=!!e.bExpertMode;oMSL.bDetailEmptyPage=bEmptyPage;oMSL.curUrl=e.curUrl;oMSL.appCacheDebug=!!e.appCacheDebug;oMSL.pageType=logID<=0&&!bEmptyPage?"list":"detail";if(logID<=0&&!bEmptyPage&&!bAjaxCall){if(!bReload){oMSL.initSearchBar()}oMSL.listPageMenuItems=[];if(groupID>0){BX.ready(function(){oMSL.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),groupId:groupID,postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",oMSL.showNewPostForm({groupId:groupID}))}})}},arrowFlag:false});oMSL.listPageMenuItems.push({id:"groupTasks",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_TASKS"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",icon:"checkbox",arrowFlag:true,action:function(){if(Application.getApiVersion()>=31){BXMobileApp.Events.postToComponent("taskbackground::task::action",[{groupId:groupID,groupName:BX.message("MSLLogTitle")}],"background")}else{var e=BX.message("MSLPathToTasksRouter");e=e.replace("__ROUTE_PAGE__","list").replace("#USER_ID#",BX.message("USER_ID"));window.BXMobileApp.PageManager.loadPageUnique({url:e,bx24ModernStyle:true})}}});oMSL.listPageMenuItems.push({id:"groupFiles",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_FILES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/files.png",action:function(){app.openBXTable({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=disk_folder_list&type=group&path=/&entityId="+groupID,TABLE_SETTINGS:{type:"files",useTagsInSearch:false}})},arrowFlag:true,icon:"file"});if(BX.message("MSLPathToKnowledgeGroup")){oMSL.listPageMenuItems.push({id:"knowledge",name:BX.message("MSLTitleKnowledgeGroup"),image:"/bitrix/templates/mobile_app/images/lenta/menu/knowledge_base.png",action:function(){window.BXMobileApp.PageManager.loadPageUnique({url:BX.message("MSLPathToKnowledgeGroup").replace(/ /g,"%20"),bx24ModernStyle:true,cache:false})}})}oMSL.initPageMenu("list")});setTimeout(function(){BX.MobileLivefeed.Instance.setPageId("list_group_"+groupID);BX.MobileLivefeed.Instance.setOptions({groupId:groupID})},0)}else{BX.ready(function(){setTimeout(function(){if(!bFiltered){oMSL.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",oMSL.showNewPostForm())}})}},arrowFlag:false});if(BX.message("MOBILE_EXT_LIVEFEED_TASKS_INSTALLED")=="Y"||BX.message("MOBILE_EXT_LIVEFEED_TIMEMAN_INSTALLED")=="Y"){oMSL.listPageMenuItems.push({id:"presetWork",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_WORK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/work.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?work=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}oMSL.listPageMenuItems.push({id:"presetFavorites",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_FAVORITES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?favorites=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});oMSL.listPageMenuItems.push({id:"presetMy",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_MY"),image:"/bitrix/templates/mobile_app/images/lenta/menu/mine.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?my=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});oMSL.listPageMenuItems.push({id:"presetImportant",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_IMPORTANT"),image:"/bitrix/templates/mobile_app/images/lenta/menu/important.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?important=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});if(BX.message("MOBILE_EXT_LIVEFEED_LISTS_INSTALLED")=="Y"){oMSL.listPageMenuItems.push({id:"presetBizproc",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_BIZPROC"),image:"/bitrix/templates/mobile_app/images/lenta/menu/workflow.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?bizproc=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}oMSL.listPageMenuItems.push({id:"refresh",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_REFRESH"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",arrowFlag:false,action:function(){oMSL.pullDownAndRefresh()}});if(oMSL.bUseFollow){oMSL.listPageMenuItems.push({id:"followDefault",name:oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/glasses.png",arrowFlag:false,feature:"follow",action:function(){oMSL.setFollowDefault({value:!oMSL.getFollowDefaultValue()})}})}if(oMSL.bShowExpertMode){oMSL.listPageMenuItems.push({id:"expertMode",name:oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/expert.png",arrowFlag:false,feature:"expert",action:function(){oMSL.setExpertMode({value:!oMSL.bExpertMode})}})}oMSL.initPageMenu("list")}},1e3);BX.MobileLivefeed.Instance.setPageId("list")})}setTimeout(function(){BX.MobileLivefeed.Instance.setOptions({signedParameters:BX.type.isNotEmptyString(e.signedParameters)?e.signedParameters:{},pathToEmptyPage:BX.type.isNotEmptyString(e.pathToEmptyPage)?e.pathToEmptyPage:"",pathToCalendarEvent:"/mobile/calendar/view_event.php?event_id=#EVENT_ID#",pathToTasksRouter:BX.type.isNotEmptyString(e.pathToTasksRouter)?e.pathToTasksRouter:"",destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}})},0);if(!bReload){setTimeout(function(){BX.MobileLivefeed.PublicationQueueInstance.emit("onFeedReady")},0);oMSL.registerBlocksToCheck();if(typeof window.bFeedInitialized!="undefined"&&window.bFeedInitialized){BX.ready(function(){BX.MobileLivefeed.Instance.recalcMaxScroll();setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3)});return}else{BX.ready(function(){BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}])});window.bFeedInitialized=true}window.arLikeRandomID={};window.LiveFeedID=parseInt(Math.random()*1e5);if(groupID<=0){BX.ready(function(){setTimeout(function(){if(!bFiltered){}else{BXMobileApp.UI.Page.TopBar.title.setText(BX.message("MSLLogTitle"));BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}},1e3)})}oMSL.initPostForm({groupId:groupID});BXMobileApp.addCustomEvent("onBlogPostDelete",function(e){oMSL.pullDownAndRefresh()});BX.ready(function(){if(bFiltered&&window.platform=="android"){BX.addCustomEvent("onOpenPageBefore",function(){oMSL.pullDownAndRefresh()})}});BXMobileApp.addCustomEvent("onLogEntryRead",function(e){__MSLLogEntryRead(e.log_id,e.ts,e.bPull===true||e.bPull==="YES")});BXMobileApp.addCustomEvent("onCommentsGet",function(e){if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){arLogTs["entry_"+e.log_id]=e.ts}});BXMobileApp.addCustomEvent("onLogEntryCommentAdd",function(e){oMSL.onLogEntryCommentAdd(e.log_id)});BXMobileApp.addCustomEvent("onLogEntryRatingLike",function(e){oMSL.onLogEntryRatingLike({ratingId:e.rating_id,voteAction:e.voteAction,logId:e.logId})});BXMobileApp.addCustomEvent("onLogEntryImpPostRead",function(e){BX.MobileLivefeed.ImportantManagerInstance.renderRead({node:BX("important_post_"+e.postId),value:true})});BXMobileApp.addCustomEvent("onLogEntryFollow",function(e){oMSL.setFollow({logId:e.logId,pageId:e.pageId,bOnlyOn:typeof e.bOnlyOn!="undefined"&&e.bOnlyOn=="Y",bRunEvent:false})});BXMobileApp.addCustomEvent("onLogEntryFavorites",function(e){oMSL.onLogEntryFavorites(e.log_id,e.page_id)});BXMobileApp.addCustomEvent("onLogEntryCommentsNumRefresh",function(e){oMSL.onLogEntryCommentAdd(e.log_id,e.num)});BXMobileApp.addCustomEvent("onLogEntryPostUpdated",function(e){oMSL.onLogEntryPostUpdated(e)});BX.MobileUI.addLivefeedLongTapHandler(BX("lenta_wrapper_global"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}BX.MobileLivefeed.RatingInstance.emit("onFeedInit")}else if(bEmptyPage){window.isDetailPullDownEnabled=false;oMSL.registerEmptyBlockToCheck();BX.ready(function(){__MSLDrawDetailPage();BX.addCustomEvent("onOpenPageBefore",function(){__MSLDrawDetailPage()});BXMobileApp.addCustomEvent("onEditedPostFailed",function(){app.hidePopupLoader()});BX.MobileImageViewer.viewImageBind("post_item_top_wrap","img[data-bx-image]")});BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"});if(BX("post-comments-wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}}else if(logID>0&&!bEmptyGetComments){window.isDetailPullDownEnabled=false;window.arCanUserComment={};BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:logID,ts:tmstmp,bPull:false},true);BX.ready(function(){BX.MobileLivefeed.Instance.setPageId("detail_"+logID);BX.MobileLivefeed.Instance.setOptions({logId:logID});oMSL.registerBlocksToCheck();setTimeout(function(){oMSL.checkNodesHeight()},100)});if(BX("post_item_top_wrap_"+logID)){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap_"+logID),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(BX("post_item_top_wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}if(BX("post-comments-wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}}if(bEmptyPage||logID>0){BX.ready(function(){BX.MobileLivefeed.Instance.setOptions({destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}})})}if(!bAjaxCall&&!bReload){BX.ready(function(){BXMobileApp.addCustomEvent("onEditedPostInserted",function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)})})}if(!bAjaxCall){BX.ready(function(){if(logID<=0&&!bEmptyPage){setTimeout(function(){BX.MobileLivefeed.Instance.recalcMaxScroll()},0);oMSL.initScroll(true);if(!bReload){BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.exec("pullDownLoadingStop");oMSL.initScroll(false,true)}else{__MSLPullDownInit(true,false);oMSL.initScroll(true,true)}})}if(!bFiltered&&!bReload){BXMobileApp.addCustomEvent("onUpdateSocnetCounters",oMSL.onUpdateSocnetCountersHandler);BXMobileApp.addCustomEvent("onImUpdateCounter",oMSL.onImUpdateCounterHandler);BXMobileApp.addCustomEvent("onUpdateUserCounters",oMSL.onUpdateCounterHandler);BX.MobileTools.requestUserCounters()}}if(bEmptyPage||logID>0){if(window.platform!="ios"){BX.bind(window,"scroll",oMSL.onScrollDetail)}setTimeout(function(){BX.MobileLivefeed.Instance.setOptions({importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{}})},0);BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.exec("pullDownLoadingStop")}else{if(oMSL.iLastActivityDate>0){var o=Math.round((new Date).getTime()/1e3);if(o-oMSL.iLastActivityDate>1740){if(bEmptyPage){BXMobileApp.UI.Page.isVisible({callback:function(e){if(e.status=="visible"){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){oMSL.setLogId(parseInt(e.log_id))}oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:false,obFocus:{form:"NO",comments:"NO"}})}})}else{oMSL.emptyRefreshCommentsFlag=true}}})}else{document.location.reload(true)}}}}});__MSLDetailPullDownInit(true)}else{setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3);if(logID<=0){__MSLPullDownInit(true)}}})}BXMobileApp.addCustomEvent("onHidePageBefore",function(){var e=document.getElementsByTagName("video"),t=null;for(t=0;t<e.length;t++){if(!e[t].paused){e[t].pause()}}var o=document.querySelectorAll("iframe.bx-mobile-video-frame");for(t=0;t<o.length;t++){var n=o[t].getAttribute("src");if(n){o[t].src=o[t].src}}})}function __MSLOnFeedScroll(){var e=BX.GetWindowScrollPos();var t=BX.MobileLivefeed.Instance.getMaxScroll();if(!((e.scrollTop>=t||document.documentElement.scrollHeight<=window.innerHeight)&&(e.scrollTop>0||t>0)&&!window.bRefreshing&&!window.bGettingNextPage)){return}if(BX.MobileLivefeed.Instance.getOption("preventNextPage",false)===true){return}BX.unbind(window,"scroll",__MSLOnFeedScroll);window.bGettingNextPage=true;nextPageXHR=BX.Mobile.Ajax.wrap({type:"json",method:"GET",url:url_next,data:"",callback:function(e){nextPageXHR=null;if(typeof e!="undefined"&&typeof e.PROPS!="undefined"&&typeof e.PROPS.CONTENT!="undefined"&&e.PROPS.CONTENT.length>0&&(typeof e.LAST_TS=="undefined"||parseInt(e.LAST_TS)<=0||parseInt(BX.message("MSLFirstPageLastTS"))<=0||parseInt(e.LAST_TS)<parseInt(BX.message("MSLFirstPageLastTS")))){oMSL.processAjaxBlock(e.PROPS,{type:"next",callback:function(){BX.MobileLivefeed.Instance.recalcMaxScroll();oMSL.registerBlocksToCheck();setTimeout(BX.delegate(oMSL.checkNodesHeight,oMSL),100);BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}});if(parseInt(BX.message("MSLPageNavNum"))>0&&parseInt(window.iPageNumber)>0){iPageNumber++;url_next=BX.util.remove_url_param(url_next,["PAGEN_"+BX.message("MSLPageNavNum")]);url_next+=(url_next.indexOf("?")>=0?"&":"?")+"PAGEN_"+parseInt(BX.message("MSLPageNavNum"))+"="+(iPageNumber+1)}}BX.bind(window,"scroll",__MSLOnFeedScroll);window.bGettingNextPage=false},callback_failure:function(){nextPageXHR=null;window.bGettingNextPage=false}})}function __MSLOpenLogEntryNew(e,t){var o=typeof e.show_full!="undefined"?!!e.show_full:false;if(typeof e.path=="undefined"||e.path==null||e.path.length<=0){return false}else{var n=e.path}if(typeof e.log_id=="undefined"||e.log_id==null||parseInt(e.log_id)<=0){return false}e.follow=BX("log_entry_follow_"+e.log_id)?BX("log_entry_follow_"+e.log_id).getAttribute("data-follow"):"Y";e.fav=BX("log_entry_favorites_"+e.log_id)&&BX("log_entry_favorites_"+e.log_id).classList.contains("lenta-item-fav-active")?"Y":"N";e.feed_id=typeof window.LiveFeedID!="undefined"?window.LiveFeedID:"";e.can_user_comment=typeof arCanUserComment!="undefined"&&typeof arCanUserComment[e.log_id]!="undefined"&&arCanUserComment[e.log_id];if(typeof t!="undefined"&&t!=null&&t&&typeof t.target!="undefined"&&t.target!=null){if(typeof t.target.tagName!="undefined"&&t.target.tagName.toLowerCase()=="a"&&!BX.hasClass(t.target,"post-item-more")){return false}var i=BX.findParent(t.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(i){return false}}e.RandomID=typeof arLikeRandomID["entry_"+e.log_id]!="undefined"&&arLikeRandomID["entry_"+e.log_id]!=null?arLikeRandomID["entry_"+e.log_id]:false;var a=document.getElementById("post_block_check_cont_"+e.log_id);if(BX.type.isDomNode(a)){var s=null;var r=null;e.detailText=a.innerHTML;e.hasTitle=a.getAttribute("bx-data-has-title")==="Y";e.bIsPhoto=a.classList.contains("post-item-post-img-block");e.bIsImportant=a.classList.contains("info-block-important");e.medal=false;if(a.classList.contains("info-block-gratitude")){s=null;for(r=0;r<a.classList.length;r++){s=a.classList[r].match(/info-block-gratitude-(.+)/i);if(s){e.medal=s[1];break}}}e.backgroundCode=false;if(a.classList.contains("ui-livefeed-background")){s=null;for(r=0;r<a.classList.length;r++){s=a.classList[r].match(/ui-livefeed-background-(.+)/i);if(s){e.backgroundCode=s[1];break}}}}var l=document.getElementById("lenta_item_"+e.log_id);if(l){var d=l.parentNode.querySelector("span[data-type='inline-script']");if(d){e.inlineScript=d.innerHTML}}if(BX("post_block_files_"+e.log_id)){e.filesBlockText=BX("post_block_files_"+e.log_id).innerHTML}if(BX("post_more_limiter_"+e.log_id)){e.showMoreButton=BX("post_more_limiter_"+e.log_id).style.visibility!="hidden"}if(BX("post_item_top_"+e.log_id)){e.topText=BX("post_item_top_"+e.log_id).innerHTML}if(BX("informer_comments_all_"+e.log_id)){e.commentsNumAll=BX("informer_comments_all_"+e.log_id).innerHTML;if(BX("informer_comments_new_"+e.log_id)){e.commentsNumNew=BX.findChild(BX("informer_comments_new_"+e.log_id),{className:"post-item-inform-right-new-value"},true,false).innerHTML}}else if(BX("informer_comments_"+e.log_id)){e.commentsNum=BX("informer_comments_"+e.log_id).innerHTML}if(BX("comments_control_"+e.log_id)){e.commentsControl=!!BX("comments_control_"+e.log_id)}if(BX("rating_block_"+e.log_id)){e.ratingText=BX("rating_block_"+e.log_id).innerHTML;e.ratingCounter=parseInt(BX("rating_block_"+e.log_id).getAttribute("data-counter"))}if(BX("rating-footer-wrap_"+e.log_id)){e.ratingFooter=BX("rating-footer-wrap_"+e.log_id).innerHTML}e.bShowFull=o;if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){e.TS=arLogTs["entry_"+e.log_id]}e.bSetFocusOnCommentForm=typeof e.focus_form!="undefined"?!!e.focus_form:false;e.bSetFocusOnCommentsList=typeof e.focus_comments!="undefined"?!!e.focus_comments:false;app.loadPageBlank({url:n,bx24ModernStyle:true,data:e});return typeof t!="undefined"&&t!=null&&t?t.preventDefault():false}function __MSLDrawDetailPage(){app.getPageParams({callback:function(e){BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:e.log_id,ts:BX.message("MSLCurrentTime"),bPull:false},true);oMSL.drawDetailPage(e)}})}function __MSLDetailMoveBottom(){window.scrollTo(0,document.body.scrollHeight)}function __MSLDetailMoveTop(){window.scrollTo(0,0)}function __MSLLogEntryRead(e,t,o){o=!!o;if(typeof window.arLogTs["entry_"+e]!="undefined"&&window.arLogTs["entry_"+e]!=null){arLogTs["entry_"+e]=t;if(BX("informer_comments_"+e)&&BX("informer_comments_new_"+e)&&!o){var n=BX("informer_comments_all_"+e).innerHTML.length>0?parseInt(BX("informer_comments_all_"+e).innerHTML):0;var i=n+parseInt(BX.findChild(BX("informer_comments_new_"+e),{className:"post-item-inform-right-new-value"},true,false).innerHTML);BX.remove(BX("informer_comments_new_"+e));BX.remove(BX("informer_comments_all_"+e));BX("informer_comments_"+e).innerHTML=i;var a=BX("informer_comments_"+e).closest(".post-item-informers");if(a){a.classList.remove("post-item-inform-likes-active")}BX.MobileLivefeed.PinnedPanelInstance.adjustCollapsedPostsPanel()}}if(BX("lenta_item_"+e)){BX.removeClass(BX("lenta_item_"+e),"lenta-item-new")}}function __MSLGetHiddenDestinations(e,t,o){var n={sessid:BX.message("MSLSessid"),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),dlim:BX.message("MSLDestinationLimit"),log_id:parseInt(e),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_group:BX.message("MSLPathToGroup"),p_crmlead:BX.message("MSLPathToCrmLead"),p_crmdeal:BX.message("MSLPathToCrmDeal"),p_crmcontact:BX.message("MSLPathToCrmContact"),p_crmcompany:BX.message("MSLPathToCrmCompany"),action:"get_more_destination",mobile_action:"get_more_destination",author_id:parseInt(t)};BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:n,callback:function(e){if(typeof e["arDestinations"]!="undefined"){var t=e["arDestinations"];if(typeof t=="object"){if(BX(o)){var n=o.parentNode;n.removeChild(o);for(var i=0;i<t.length;i++){if(typeof t[i]["TITLE"]!="undefined"&&t[i]["TITLE"].length>0){n.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[i]["CRM_PREFIX"]!="undefined"&&t[i]["CRM_PREFIX"].length>0){n.appendChild(BX.create("SPAN",{props:{className:"post-item-dest-crm-prefix"},html:t[i]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[i]["URL"]!="undefined"&&t[i]["URL"].length>0){n.appendChild(BX.create("A",{props:{className:"post-item-destination"+(typeof t[i]["STYLE"]!="undefined"&&t[i]["STYLE"].length>0?" post-item-dest-"+t[i]["STYLE"]:""),href:t[i]["URL"]},html:t[i]["TITLE"]}))}else{n.appendChild(BX.create("SPAN",{props:{className:"post-item-destination"+(typeof t[i]["STYLE"]!="undefined"&&t[i]["STYLE"].length>0?" post-item-dest-"+t[i]["STYLE"]:"")},html:t[i]["TITLE"]}))}}}if(typeof e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var a=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;n.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("MSLDestinationHidden"+a).replace("#COUNT#",e["iDestinationsHidden"])}))}oMSL.checkNodesHeight()}}}},callback_failure:function(){}})}function __MSLGetNewPosts(){}function __MSLRefresh(e,t){e=!!e;if(window.bGettingNextPage&&window.nextPageXHR!=null){nextPageXHR.abort()}BX.addClass(BX("lenta_notifier"),"lenta-notifier-waiter");BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.MobileLivefeed.Instance.setRefreshStarted(true);BX.MobileLivefeed.BalloonNotifierInstance.hideRefreshNeededNotifier();BX.MobileLivefeed.NotificationBarInstance.hideAll();bRefreshing=true;var o=document.location.href;o=BX.util.remove_url_param(o,["RELOAD","RELOAD_JSON","FIND"]);o=BX.util.add_url_param(o,{RELOAD:"Y",RELOAD_JSON:"Y"});if(BX.type.isPlainObject(t)&&BX.type.isNotEmptyString(t.find)){o=BX.util.add_url_param(o,{FIND:t.find})}var n=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:typeof BX.frameCache!="undefined"&&typeof BX.frameCache.vars!="undefined"&&typeof BX.frameCache.vars.PAGE_URL!="undefined"?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];oMSL.xhr.refresh=BX.Mobile.Ajax.wrap({type:"json",method:"GET",url:o,data:"",headers:n,callback:function(t){oMSL.xhr.refresh=null;BX.MobileLivefeed.Instance.setRefreshStarted(false);BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");if(typeof t!="undefined"&&typeof t.PROPS!="undefined"&&typeof t.PROPS.CONTENT!="undefined"&&t.PROPS.CONTENT.length>0){BX.MobileLivefeed.Instance.setPreventNextPage(false);BitrixMobile.LazyLoad.clearImages();BX.clearNodeCache();app.hidePopupLoader();BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier();BX.MobileLivefeed.BalloonNotifierInstance.hideRefreshNeededNotifier();if(typeof t.COUNTER_TO_CLEAR!="undefined"){BXMobileApp.onCustomEvent("onClearLFCounter",[t.COUNTER_TO_CLEAR],true);var o={counterCode:t.COUNTER_TO_CLEAR,serverTime:t.COUNTER_SERVER_TIME,serverTimeUnix:t.COUNTER_SERVER_TIME_UNIX};BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",o,"communication")}oMSL.processAjaxBlock(t.PROPS,{type:"refresh",callback:function(){BX.MobileLivefeed.PinnedPanelInstance.resetFlags();BX.MobileLivefeed.PinnedPanelInstance.init();if(typeof BX.frameCache!="undefined"&&BX("bxdynamic_feed_refresh")&&(typeof t.REWRITE_FRAMECACHE=="undefined"||t.REWRITE_FRAMECACHE!="N")){var e=typeof t.TS!="undefined"&&parseInt(t.TS)>0?parseInt(t.TS):0;if(e>0){BX.MobileLivefeed.Instance.setOptions({frameCacheTs:e})}BX.MobileLivefeed.Instance.updateFrameCache({timestamp:e})}oMSL.registerBlocksToCheck();setTimeout(function(){BitrixMobile.LazyLoad.showImages()},1e3)}});if(e){BitrixAnimation.animate({duration:1e3,start:{scroll:document.body.scrollTop},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}})}if(window.applicationCache&&t.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{__MSLRefreshError(true)}bRefreshing=false},callback_failure:function(){oMSL.xhr.refresh=null;BX.MobileLivefeed.Instance.setRefreshStarted(false);BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");__MSLRefreshError(true);bRefreshing=false}})}function __MSLPullDownInit(e,t){if(typeof t=="undefined"){t=true}e=!!e;if(e){if(!window.isPullDownEnabled&&t){BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_LOADING"),callback:function(){if(!window.isPullDownLocked){app.exec("hideSearchBar");__MSLRefresh(true)}}});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isPullDownEnabled=false}}function __MSLDetailPullDownInit(e){e=!!e;if(e){if(!isDetailPullDownEnabled){var t=function(){var e=true;if(e){var t=null;var o=null;if(BX("post_log_id")){t=parseInt(BX("post_log_id").getAttribute("data-log-id"));o=parseInt(BX("post_log_id").getAttribute("data-ts"))}else if(BX("lenta_wrapper")){var n=BX.findChild(BX("lenta_wrapper"),{className:"post-wrap"},true,false);if(n&&n.id.length>0){var i=n.id.match(/^lenta_item_([\d]+)$/i);if(i!=null){document.location.replace(document.location.href);isDetailPullDownEnabled=true;return}}}if(BX("post-comments-wrap")&&typeof t!=="undefined"&&t!=null){oMSL.getComments({ts:o,bPullDown:true,obFocus:{form:false}});oMSL.refreshPostDetail()}}};BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_DETAIL_NEW_PULL_LOADING"),callback:t});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isDetailPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isDetailPullDownEnabled=false}}function __MSLRefreshError(e){e=!!e;var t=BX("lenta_refresh_error");if(parseInt(window.refreshErrorTimeout)>0){clearTimeout(window.refreshErrorTimeout)}if(t){if(e){BX.addClass(t,"lenta-notifier-shown");BX.bind(window,"scroll",__MSLRefreshErrorScroll)}else{BX.unbind(window,"scroll",__MSLRefreshErrorScroll);BX.removeClass(t,"lenta-notifier-shown")}}else{window.refreshErrorTimeout=setTimeout(function(){__MSLRefreshError(e)},500)}}function __MSLRefreshErrorScroll(){__MSLRefreshError(false)}function __MSLSetFavorites(e,t,o){var n=BX.MobileLivefeed.Instance.getPostFromLogId(e);if(!n){return}return n.setFavorites({node:t,event:o})}function showHiddenDestination(e,t){BX.hide(t);BX("blog-destination-hidden-"+e).style.display="inline"}function commonNativeInputCallback(e,t){if(window.entryType=="blog"){blogCommentsNativeInputCallback({text:e,oPreviewComment:null,commentId:t})}else if(window.entryType=="non-blog"&&typeof t=="undefined"){commentsNativeInputCallback({text:e})}}function blogCommentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var n=typeof e.commentId!="undefined"?e.commentId:0;var i=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),comment_post_id:commentVarBlogPostID,act:"add",post:"Y",comment:oMSL.parseMentions(t),decode:"Y"};if(commentVarAction){l.ACTION=commentVarAction}if(commentVarEntityTypeID){l.ENTITY_TYPE_ID=commentVarEntityTypeID}if(commentVarEntityID){l.ENTITY_ID=commentVarEntityID}if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof n!="undefined"&&parseInt(n)>0){l.act="edit";l.edit_id=parseInt(n);i=typeof i!="undefined"?i:""}if(l.act=="add"&&(typeof o=="undefined"||o===null)){o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.act=="edit"&&BX(i)){oMSL.showCommentWait({nodeId:i,status:true});var d=BX.findChild(BX(i),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:commentVarURL,data:l,processData:true,callback:function(e){if(typeof e=="object"&&typeof e.TEXT!="undefined"){response=e.TEXT}if(typeof response!="undefined"&&response!="*"&&response.length>0){if(l.act=="add"){oMSL.showNewComment({commentId:typeof e.COMMENT_ID!="undefined"?parseInt(e.COMMENT_ID):0,text:response,bClearForm:false,oPreviewComment:o,bShowImages:false});oMSL.parseAndExecCode(response);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showNewComment({text:response,bClearForm:false,oPreviewComment:BX(i),bReplace:true,bIncrementCounters:false,bShowImages:false});oMSL.parseAndExecCode(response)}}else{oMSL.showCommentAlert({nodeId:l.act=="add"?o:i,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:i,commentId:l.act=="add"?false:n})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:l.act=="add"?o:i,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:i,commentId:l.act=="add"?false:n})}})}})}function commentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var n=typeof e.commentId!="undefined"?e.commentId:0;var i=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:commentVarLogID,message:oMSL.parseMentions(t),as:commentVarAvatarSize,nt:commentVarNameTemplate,sl:commentVarShowLogin,dtf:commentVarDateTimeFormat,p_user:commentVarPathToUser,rt:commentVarRatingType,action:"add_comment",mobile_action:"add_comment",sr:BX.message("MSLShowRating")};if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof n!="undefined"&&parseInt(n)>0){l.action="edit_comment";l.mobile_action="edit_comment";l.edit_id=parseInt(n);i=typeof i!="undefined"?i:""}if(l.action=="add_comment"&&(typeof o=="undefined"||o===null)){o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.action=="edit_comment"&&BX(i)){oMSL.showCommentWait({nodeId:i,status:true});var d=BX.findChild(BX(i),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:l,callback:function(e){if(typeof e["arCommentFormatted"]!="undefined"){if(l.action=="add_comment"){oMSL.showNewComment({commentId:parseInt(e["commentID"]),arComment:e["arCommentFormatted"],oPreviewComment:o,bClearForm:true});__MSLDetailMoveBottom();oMSL.setFollow({logId:l.log_id,bOnlyOn:true})}else{oMSL.showNewComment({arComment:e["arCommentFormatted"],oPreviewComment:BX(i),bIncrementCounters:false,bReplace:true})}}else{oMSL.alertPreviewComment({nodeId:o?o:i,text:t,commentType:"log",commentId:n,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:n,nodeId:i})}})}},callback_failure:function(){oMSL.alertPreviewComment({nodeId:o?o:i,text:t,commentType:"log",commentId:n,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:n,nodeId:i})}})}})}BitrixMSL=function(){this.scriptsAttached=[];this.counterTimeout=null;this.detailPageId="";this.logId=false;this.commentsType=false;this.entityXMLId="";this.commentTextCurrent="";this.arMention=[];this.bUseFollow=true;this.bFollow=true;this.bFollowDefault=true;this.bShowExpertMode=true;this.bExpertMode=false;this.detailPageMenuItems=[];this.listPageMenuItems=[];this.bKeyboardCaptureEnabled=false;this.keyboardShown=null;this.arBlockToCheck={};this.iLastActivityDate=null;this.iDetailTs=0;this.newPostFormParams={};this.newPostFormExtraData={};this.arRatingLikeProcess={};this.bDetailEmptyPage=null;this.bCounterReceived=false;this.counterValue=0;this.blocksToCheckRegisteredList=[];this.menuData={};this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.canCheckScrollButton=true;this.windowSize=null;this.emptyRefreshCommentsFlag=false;this.detailPageFocus=null;this.emptyCommentsXhr=null;this.classes={postItemBlockFull:"post-item-post-block-full"};this.findTextMode=false;this.xhr={refresh:null}};BitrixMSL.prototype.setLogId=function(e){this.logId=parseInt(data.log_id)};BitrixMSL.prototype.getLogId=function(){return parseInt(this.logId)};BitrixMSL.prototype.setFollowValue=function(e){this.bFollow=!!e};BitrixMSL.prototype.getFollowValue=function(){return this.bFollow};BitrixMSL.prototype.setFollowDefaultValue=function(e){this.bFollowDefault=!!e};BitrixMSL.prototype.getFollowDefaultValue=function(){return this.bFollowDefault};BitrixMSL.prototype.loadScripts=function(){for(var e=0;e<this.scriptsAttached.length;e++){BX.loadScript(this.scriptsAttached[e]+"?"+parseInt(Math.random()*1e5))}};BitrixMSL.prototype.pullDownAndRefresh=function(e){app.exec("pullDownLoadingStart");window.isPullDownLocked=true;__MSLRefresh(true,e)};BitrixMSL.prototype.shareBlogPost=function(e){};BitrixMSL.prototype.deleteBlogPost=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_OK"),BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_CANCEL")],callback:function(t){if(t==1){app.showPopupLoader({text:""});var o=BX.message("MSLSiteDir")+"mobile/ajax.php";o=BX.util.add_url_param(o,{b24statAction:"deleteBlogPost",b24statContext:"mobile"});BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e.post_id},processData:true,callback:function(e){app.hidePopupLoader();if(BX.type.isNotEmptyString(e.SUCCESS)&&e.SUCCESS=="Y"){BXMobileApp.onCustomEvent("onBlogPostDelete",{},true,true);app.closeController({drop:true})}},callback_failure:function(){app.hidePopupLoader()}});return false}}})};BitrixMSL.prototype.getBlogPostData=function(e,t){e=parseInt(e);var o={};if(e>0){app.showPopupLoader();BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e,nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin")},callback:function(n){app.hidePopupLoader();o.id=e;if(typeof n.log_id!="undefined"&&parseInt(n.log_id)>0){o.log_id=n.log_id}if(typeof n.post_user_id!="undefined"&&parseInt(n.post_user_id)>0){o.post_user_id=n.post_user_id}if(typeof n.PostPerm!="undefined"){o.PostPerm=n.PostPerm}if(typeof n.PostDestination!="undefined"){o.PostDestination=n.PostDestination}if(typeof n.PostDestinationHidden!="undefined"){o.PostDestinationHidden=n.PostDestinationHidden}if(typeof n.PostDetailText!="undefined"){o.PostDetailText=n.PostDetailText}if(typeof n.PostFiles!="undefined"){o.PostFiles=n.PostFiles}if(typeof n.PostBackgroundCode!="undefined"){o.PostBackgroundCode=n.PostBackgroundCode}if(typeof n.PostUFCode!="undefined"){o.PostUFCode=n.PostUFCode}t(o)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.getCommentData=function(e,t){var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var n=typeof e.commentId!="undefined"?parseInt(e.commentId):0;var i={};if(n>0&&typeof e.postId!="undefined"&&parseInt(e.postId)>0){app.showPopupLoader();var a={action:"get_comment_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID")};if(o=="blog"){a.mobile_action="get_blog_comment_data";a.comment_id=n;a.post_id=parseInt(e.postId)}else{a.mobile_action="get_log_comment_data";a.cid=n;a.log_id=parseInt(e.postId)}BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:a,callback:function(e){app.hidePopupLoader();i.id=n;if(typeof e.CommentCanEdit!="undefined"){i.CommentCanEdit=e.CommentCanEdit}if(typeof e.CommentDetailText!="undefined"){i.CommentDetailText=e.CommentDetailText}if(typeof e.CommentFiles!="undefined"){i.CommentFiles=e.CommentFiles}if(typeof e.CommentUFCode!="undefined"){i.CommentUFCode=e.CommentUFCode}t(i)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.editBlogPost=function(e){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),postId:e.post_id})}else{this.getBlogPostData(e.post_id,function(t){oMSL.newPostFormParams={};if(typeof t.PostPerm!="undefined"&&t.PostPerm>="W"){var o={a_users:[],b_groups:[]};oMSL.setPostFormExtraDataArray({postId:e.post_id,postAuthorId:t.post_user_id,logId:t.log_id,pinnedContext:!!e.pinnedContext});if(typeof t.PostDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.PostDetailText})}if(typeof t.PostDestination!="undefined"){for(var n in t.PostDestination){if(!t.PostDestination.hasOwnProperty(n)){continue}if(t.PostDestination[n]["STYLE"]!="undefined"&&t.PostDestination[n]["STYLE"]=="all-users"){oMSL.addPostFormDestination(o,{type:"UA"})}else if(t.PostDestination[n]["TYPE"]!="undefined"&&t.PostDestination[n]["TYPE"]=="U"){oMSL.addPostFormDestination(o,{type:"U",id:t.PostDestination[n]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[n]["TITLE"])})}else if(t.PostDestination[n]["TYPE"]!="undefined"&&t.PostDestination[n]["TYPE"]=="SG"){oMSL.addPostFormDestination(o,{type:"SG",id:t.PostDestination[n]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[n]["TITLE"])})}}}if(typeof t.PostDestinationHidden!="undefined"){oMSL.setPostFormExtraData({hiddenRecipients:t.PostDestinationHidden})}oMSL.setPostFormParams({selectedRecipients:o});if(typeof t.PostFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.PostFiles})}if(typeof t.PostUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.PostUFCode})}app.exec("showPostForm",oMSL.showNewPostForm())}})}};BitrixMSL.prototype.drawDetailPage=function(e){var t=false;BX.MobileLivefeed.Instance.setPageId("detail_"+e.log_id);BX.MobileLivefeed.Instance.setOptions({logId:e.log_id});if(BX("post_log_id")){var o=parseInt(BX("post_log_id").getAttribute("data-log-id"))}if(typeof o==="undefined"||o!=e.log_id){app.clearInput()}if(BX("post_log_id")){if(typeof o!=="undefined"&&o==e.log_id){t=true}else{BX("post_log_id").setAttribute("data-log-id",e.log_id);BX("post_log_id").setAttribute("data-ts",e.TS);BX.message({MSLLogId:e.log_id})}}var n=false;window.entryType=e.entry_type;oMSL.InitDetail({commentsType:e.entry_type=="blog"?"blog":"log",detailPageId:(e.entry_type=="blog"?"blog":"log")+"_"+(e.entry_type=="blog"?e.post_id:e.log_id),logId:e.log_id,entityXMLId:e.entity_xml_id,bUseFollow:typeof e.use_follow=="undefined"||e.use_follow!="NO",bFollow:typeof e.follow=="undefined"||e.follow!="N",feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,entryParams:{destinations:typeof e.destinations!="undefined"?e.destinations:null,post_perm:typeof e.post_perm!="undefined"?e.post_perm:null,post_id:typeof e.post_id!="undefined"?e.post_id:null,post_content_type_id:BX.type.isNotEmptyString(e.post_content_type_id)?e.post_content_type_id:null,post_content_id:BX.type.isNotEmptyString(e.post_content_id)?e.post_content_id:null},TS:typeof e.TS!="undefined"?e.TS:null,readOnly:e.read_only!="undefined"?e.read_only:"N"});if(oMSL.emptyCommentsXhr){oMSL.emptyCommentsXhr.abort()}if(typeof e.commentsNumAll!="undefined"||typeof e.commentsNum!="undefined"){n=true}if(BX("comments_control")){BX("comments_control").style.display=typeof e.commentsControl!="undefined"&&e.commentsControl=="YES"?"inline-block":"none"}if(!t){var i=document.getElementById("rating_text");if(typeof e.ratingText!="undefined"){if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="block"}if(i){if(typeof e.ratingCounter!="undefined"){i.setAttribute("data-counter",parseInt(e.ratingCounter))}if(BX.type.isNotEmptyString(e.ratingText)&&typeof RatingLike!=="undefined"){i.innerHTML=e.ratingText;i.style.display="inline-block";var a=i.querySelector("[data-rating-vote-id]");if(a){var s=a.getAttribute("data-rating-vote-id");var r=a.getAttribute("data-rating-entity-type-id");var l=parseInt(a.getAttribute("data-rating-entity-id"));if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyString(r)&&l>0){RatingLike.Set(s,r,l,"Y",BX.message("USER_ID"),{LIKE_Y:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_N:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_D:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_D")},"like_react",BX.message("MSLPathToUser"),false,true)}}}else{i.style.display="none"}}n=true;oMSL.parseAndExecCode(e.ratingText,0);BX.message({RVRunEvent:"Y"})}else{if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="none"}if(BX("rating_button_cont")){BX("rating_button_cont").style.display="none"}if(i){i.style.display="none"}}}if(BX("log_entry_follow")){if(typeof e.use_follow!="undefined"&&e.use_follow=="N"||typeof e.follow=="undefined"){BX.unbindAll(BX("log_entry_follow"));BX("log_entry_follow").style.display="none"}else{n=true;BX.removeClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow-active":"post-item-follow");BX.addClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow":"post-item-follow-active");BX("log_entry_follow").setAttribute("data-follow",e.follow=="N"?"N":"Y");BX.unbindAll(BX("log_entry_follow"));BX.bind(BX("log_entry_follow"),"click",function(){oMSL.setFollow({logId:e.log_id,bAjax:true,bRunEvent:false})})}}if(n){BX.removeClass(BX("lenta_item"),"post-without-informers")}else{BX.addClass(BX("lenta_item"),"post-without-informers")}if(BX("post_item_top_wrap")&&!this.getFollowDefaultValue()){if(typeof e.follow!="undefined"&&e.follow=="Y"){BX.addClass(BX("post_item_top_wrap"),"post-item-follow")}else{BX.removeClass(BX("post_item_top_wrap"),"post-item-follow")}}if(t&&BX.type.isNotEmptyString(e.fav)&&BX("log_entry_favorites_"+e.log_id)){if(e.fav=="Y"){BX("log_entry_favorites_"+e.log_id).classList.add("lenta-item-fav-active")}else{BX("log_entry_favorites_"+e.log_id).classList.remove("lenta-item-fav-active")}}var d=BX("post_block_check_cont");if(!t){if(BX("post-comments-wrap")){BX.cleanNode(BX("post-comments-wrap"))}this.drawDetailPageText(e);var p=BX.findChild(d,{className:"post-more-block"},true,false);if(p&&BX("post_more_limiter")){if(typeof e.showMoreButton!="undefined"&&e.showMoreButton=="YES"){BX("post_more_limiter").style.visibility="visible";BX.bind(BX("post_more_limiter"),"click",function(){oMSL.expandText(e.log_id)})}else{BX("post_more_limiter").style.visibility="hidden"}}if(e.bShowFull==="YES"){d.className=oMSL.classes.postItemBlockFull;if(BX("post_more_block_"+e.log_id)){BX("post_more_block_"+e.log_id).style.display="none"}if(BX("post_block_check_more_"+e.log_id)){BX("post_block_check_more_"+e.log_id).style.display="none"}BX("post_more_limiter").style.visibility="hidden";BitrixMobile.LazyLoad.showImages(false)}else{d.className=e.bIsPhoto=="YES"?"post-item-post-img-block":"post-item-post-block"}if(e.bIsImportant==="YES"||BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-background");if(e.hasTitle==="YES"){d.classList.add("info-block-background-with-title")}else{d.classList.remove("info-block-background-with-title")}if(e.bIsImportant==="YES"){d.classList.add("info-block-important")}else{d.classList.remove("info-block-important")}if(BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-gratitude");d.classList.add("info-block-gratitude-"+e.medal)}else{d.classList.remove("info-block-gratitude")}}else{d.classList.remove("info-block-background")}Array.from(d.classList).forEach(function(e){if(e.indexOf("ui-livefeed-background")>-1){d.classList.remove(e)}});if(BX.type.isNotEmptyString(e.backgroundCode)&&e.backgroundCode!=="NO"){d.classList.add("ui-livefeed-background");d.classList.add("ui-livefeed-background-"+e.backgroundCode)}if(e.bSetFocusOnCommentForm!="YES"&&e.bSetFocusOnCommentsList!="YES"){__MSLDetailMoveTop()}if(BX("post-comments-form-wrap")){if(e.can_user_comment!=="YES"){if(BX("empty_page_bottom_margin")){BX("empty_page_bottom_margin").style.display="none"}app.hideInput()}}}else{var m=BX("post_item_top");if(m){if(typeof e.topText!=="undefined"){m.innerHTML=e.topText;var f=oMSL.parseAndExecCode(e.topText,0,false,true);setTimeout(function(){BX.MobileLivefeed.Instance.sendErrorEval(f)},0)}}}if(e.bSetFocusOnCommentForm=="YES"){oMSL.detailPageFocus="form"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus="list"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus=null}if(BX("post-comments-wrap")&&(!t||oMSL.emptyRefreshCommentsFlag)){oMSL.getComments({ts:e.TS,bPullDown:false,bPullDownTop:false,obFocus:{form:e.bSetFocusOnCommentForm,comments:e.bSetFocusOnCommentsList}});oMSL.emptyRefreshCommentsFlag=false}oMSL.adjustDetailPageFocus();BX.removeAllCustomEvents("main.post.form/mobile_simple");BX.addCustomEvent("main.post.form/mobile_simple",function(){setTimeout(oMSL.adjustDetailPageFocus,150)})};BitrixMSL.prototype.adjustDetailPageFocus=function(){if(oMSL.detailPageFocus){oMSL.setFocusOnComments(oMSL.detailPageFocus)}};BitrixMSL.prototype.drawDetailPageText=function(e){var t="";var o=typeof e.logID!="undefined"?parseInt(e.logID):0;var n=o&&BX("post_block_check_cont_"+o)?BX("post_block_check_cont_"+o):BX("post_block_check_cont");var i=o&&BX("post_item_top_"+o)?BX("post_item_top_"+o):BX("post_item_top");var a=o&&BX("post_block_files_"+o)?BX("post_block_files_"+o):BX("post_block_files");if(n||a){BitrixMobile.LazyLoad.clearImages()}if(n){n.innerHTML="";if(BX.type.isNotEmptyString(e.detailText)){n.innerHTML=e.detailText;if(BX.type.isNotEmptyString(e.inlineScript)){n.innerHTML+=e.inlineScript}t+=oMSL.parseAndExecCode(n.innerHTML,0,false,true)}}if(a){a.innerHTML="";if(BX.type.isNotEmptyString(e.filesBlockText)){a.innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}}if(i){i.innerHTML="";if(typeof e.topText!=="undefined"){i.innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}}setTimeout(function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)};BitrixMSL.prototype.onLogEntryPostUpdated=function(e){var t="";if(typeof e.logID!=="undefined"){if(typeof e.detailText!=="undefined"&&BX("post_block_check_cont_"+parseInt(e.logID))){BX("post_block_check_cont_"+parseInt(e.logID)).innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}if(typeof e.filesBlockText!=="undefined"&&BX("post_block_files_"+parseInt(e.logID))){BX("post_block_files_"+parseInt(e.logID)).innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}if(typeof e.topText!=="undefined"&&BX("post_item_top_"+parseInt(e.logID))){BX("post_item_top_"+parseInt(e.logID)).innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}setTimeout(function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)}};BitrixMSL.prototype.changeCounter=function(e,t,o){if(this.counterTimeout!==null){clearTimeout(this.counterTimeout);this.counterTimeout=null}t=typeof t!="undefined"?parseInt(t):0;o=typeof o!="undefined"?parseInt(o):0;var n=t>0?t:o>0?o:0;this.counterValue=e;if(parseInt(oMSL.counterValue)>0){BX.MobileLivefeed.BalloonNotifierInstance.showNotifier({counterValue:oMSL.counterValue})}else{this.counterTimeout=setTimeout(function(){if(n>BX.MobileLivefeed.Instance.getOption("frameCacheTs",0)){BX.MobileLivefeed.Instance.setRefreshNeeded(true)}if(BX.MobileLivefeed.Instance.getRefreshNeeded()&&!BX.MobileLivefeed.Instance.getRefreshStarted()){BX.MobileLivefeed.BalloonNotifierInstance.showRefreshNeededNotifier()}else{BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier()}clearTimeout(oMSL.counterTimeout)},2e3)}};BitrixMSL.prototype.editComment=function(e){commentType=typeof e.commentType=="undefined"?"log":e.commentType;postId=typeof e.postId=="undefined"?0:parseInt(e.postId);nodeId=typeof e.nodeId=="undefined"?"":e.nodeId;if(typeof e.commentText!="string"&&typeof e.commentText!="number"||e.commentText.length<=0||parseInt(e.commentId)<=0){return}this.getCommentData({commentType:commentType,commentId:e.commentId,postId:postId},function(t){oMSL.newPostFormParams={};if(typeof t.CommentCanEdit!="undefined"&&t.CommentCanEdit=="Y"){oMSL.setPostFormExtraDataArray({commentId:e.commentId,commentType:commentType,postId:postId,nodeId:nodeId});if(typeof t.CommentDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.CommentDetailText})}if(typeof t.CommentFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.CommentFiles})}if(typeof t.CommentUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.CommentUFCode})}app.exec("showPostForm",oMSL.showNewPostForm({entityType:"comment"}))}})};BitrixMSL.prototype.deleteComment=function(e){if(parseInt(e.commentId)<=0){return}var t=typeof e.commentType=="undefined"?"log":e.commentType,o=typeof e.nodeId=="undefined"?"":e.nodeId;oMSL.showCommentWait({nodeId:o,status:true});BXMobileApp.UI.Page.TextPanel.clear();if(t=="blog"){BX.Mobile.Ajax.wrap({type:"html",method:"GET",url:commentVarURL+"&sessid="+BX.bitrix_sessid()+"&delete_comment_id="+e.commentId,data:"",callback:function(n){if(n!="*"&&n.length>0){oMSL.hideComment(BX(o),t)}else{oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}})}else{var n={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:oMSL.getLogId(),delete_id:e.commentId,action:"delete_comment",mobile_action:"delete_comment"};BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:n,callback:function(n){if(n["commentID"]!="undefined"&&parseInt(n["commentID"])>0&&parseInt(n["commentID"])==e.commentId){oMSL.hideComment(BX(o),t)}else{oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}})}};BitrixMSL.prototype.hideComment=function(e,t){t=typeof t=="undefined"?"log":t;BX.cleanNode(e,true);var o=t=="blog"?BX.message("SBPClogID"):0;var n=0;var i=false;if(BX("informer_comments_"+o)){n=BX("informer_comments_"+o).innerHTML.length>0?parseInt(BX("informer_comments_"+o).innerHTML):0;if(n>0){i=n-1;BX("informer_comments_"+o).innerHTML=i>0?i:""}}else if(BX("informer_comments_common")){n=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;if(n>0){i=n-1;BX("informer_comments_common").innerHTML=i>0?i:""}}else if(BX("informer_comments")){n=BX("informer_comments").innerHTML.length>0?parseInt(BX("informer_comments").innerHTML):0;if(n>0){i=n-1;BX("informer_comments").innerHTML=i>0?i:""}}if(BX("comcntleave-all")){n=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;if(n>0){i=n-1;if(i>0){BX("comcntleave-all").innerHTML=i}else{BX("comcntleave-all").style.dusplay="none"}}}if(BX("comcntleave-old")){n=BX("comcntleave-old").innerHTML.length>0?parseInt(BX("comcntleave-old").innerHTML):0;if(n>0){i=n-1;if(i>0){BX("comcntleave-old").innerHTML=i}else{BX("comcntleave-old").style.dusplay="none"}}}if(i!==false){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:i},true)}};BitrixMSL.prototype.createCommentInputForm=function(e){BXMobileApp.UI.Page.TextPanel.setParams(e);BXMobileApp.UI.Page.TextPanel.clear();BXMobileApp.UI.Page.TextPanel.show()};BitrixMSL.prototype.parseAndExecCode=function(e,t,o,n){if(typeof e!="string"||e.length<=0){return}t=typeof t=="undefined"?500:parseInt(t);o=typeof o=="undefined"?true:!!o;n=!!n;var i=BX.processHTML(e);var a="";if(i!=null&&i.SCRIPT!=null&&typeof i.SCRIPT!="undefined"){for(var s=0;s<i.SCRIPT.length;s++){if(i.SCRIPT[s].isInternal){a+=";"+i.SCRIPT[s].JS}}if(o&&a.length>0){setTimeout(function(){BX.MobileLivefeed.Instance.sendErrorEval(a)},t)}}return n?a:false};BitrixMSL.prototype.replaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return}if(BX("MSLIsExtranetSite")=="Y"){e=e.replace("/mobile/users/?user_id=",BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=")}else{e=e.replace(BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=","/mobile/users/?user_id=")}e=e.replace(new RegExp('[\\w/]+/personal/user/(\\d+)/"',"igm"),BX("MSLIsExtranetSite")=="Y"?BX.message("MSLExtranetSiteDir")+'mobile/users/?user_id=$1"':'/mobile/users/?user_id=$1"');return e};BitrixMSL.prototype.createCommentMenu=function(e,t,o){BX.bind(e,"click",function(n){n=n||window.event;if(n.target.tagName.toUpperCase()=="A"){return false}var i=BX.findParent(n.target,{tag:"A"},{tag:"DIV",className:"post-comment-text"});if(i){return false}var a=[];a.push({title:BX.message("MSLReply"),callback:function(){oMSL.replyToComment(t["EVENT"]["USER_ID"],BX.util.htmlspecialcharsback(t["CREATED_BY"]["FORMATTED"]))}});if(typeof t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"]!="undefined"&&parseInt(t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>0&&typeof o!="undefined"&&o){a.push({title:BX.message("MSLLikesList"),callback:function(){RatingLikeComments.List(o)}})}if(BX.type.isNotEmptyObject(t["EVENT_FORMATTED"])&&BX.type.isNotEmptyString(t["EVENT_FORMATTED"]["CAN_EDIT"])&&t["EVENT_FORMATTED"]["CAN_EDIT"]=="Y"){a.push({title:BX.message("MSLCommentMenuEdit"),callback:function(){oMSL.editComment({commentId:t["EVENT"]["ID"],commentText:t["EVENT"]["MESSAGE"],commentType:"log",postId:t["EVENT"]["LOG_ID"],nodeId:e.id})}})}if(typeof t["EVENT_FORMATTED"]!="undefined"&&typeof t["EVENT_FORMATTED"]["CAN_DELETE"]!="undefined"&&t["EVENT_FORMATTED"]["CAN_DELETE"]=="Y"){a.push({title:BX.message("MSLCommentMenuDelete"),callback:function(){oMSL.deleteComment({commentId:t["EVENT"]["ID"],commentType:"log",nodeId:e.id})}})}oMSL.showCommentMenu(a)})};BitrixMSL.prototype.showCommentMenu=function(e){var t=new BXMobileApp.UI.ActionSheet({buttons:e},"commentSheet");t.show()};BitrixMSL.prototype.InitDetail=function(e){this.commentsType=typeof e.commentsType!="undefined"&&e.commentsType=="blog"?"blog":"log";this.entityXMLId=typeof e.entityXMLId!="undefined"?e.entityXMLId:"";this.bFollow=!(typeof e.bFollow!="undefined"&&!e.bFollow);this.commentTextCurrent="";this.arMention=[];this.iDetailTs=typeof e.TS!="undefined"?e.TS:0;if(!this.bKeyboardCaptureEnabled){app.enableCaptureKeyboard(true);this.bKeyboardCaptureEnabled=true;BX.addCustomEvent("onKeyboardWillShow",BX.delegate(function(){this.keyboardShown=true},this));BX.addCustomEvent("onKeyboardDidHide",BX.delegate(function(){this.keyboardShown=false},this))}if(BX.type.isNotEmptyString(e.detailPageId)&&this.detailPageId!=e.detailPageId){this.detailPageId=e.detailPageId;if(typeof e.logId!="undefined"&&parseInt(e.logId)>0){this.logId=parseInt(e.logId)}BXMobileApp.addCustomEvent("onMPFCommentSent",BX.proxy(function(e){if(e.detailPageId==this.detailPageId&&e.data.action=="EDIT_COMMENT"&&e.data.text.length>0&&parseInt(e.data.commentId)>0){if(this.commentsType=="blog"){blogCommentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}else{commentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}}},this))}this.menuData={entry_type:this.commentsType,destinations:typeof e.entryParams!="undefined"&&e.entryParams.destinations!="undefined"?e.entryParams.destinations:{},post_perm:typeof e.entryParams!="undefined"&&e.entryParams.post_perm!="undefined"?e.entryParams.post_perm:null,post_id:typeof e.entryParams!="undefined"&&e.entryParams.post_id!="undefined"?e.entryParams.post_id:null,feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,read_only:typeof e.readOnly!="undefined"&&e.readOnly=="Y"?"Y":"N",post_content_type_id:typeof e.entryParams!="undefined"&&BX.type.isNotEmptyString(e.entryParams.post_content_type_id)?e.entryParams.post_content_type_id:null,post_content_id:typeof e.entryParams!="undefined"&&typeof e.entryParams.post_content_id!="undefined"?parseInt(e.entryParams.post_content_id):null};this.detailPageMenuItems=this.buildDetailPageMenu(this.menuData);this.initPageMenu("detail");if(Application.getApiVersion()>=34){setTimeout(function(){var e=BX.MobileLivefeed.Instance.getPostFromLogId(this.getLogId());if(e){e.initDetailPin()}}.bind(this),0)}};BitrixMSL.prototype.showNewComment=function(e){var t=typeof e.text!="undefined"?e.text:"";var o=typeof e.arComment!="undefined"?e.arComment:false;var n=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:false;var i=typeof e.bClearForm!="undefined"?!!e.bClearForm:false;var a=typeof e.bReplace!="undefined"?!!e.bReplace:false;var s=typeof e.bIncrementCounters!="undefined"?!!e.bIncrementCounters:true;var r=typeof e.bShowImages!="undefined"?!!e.bShowImages:true;if(!!n&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}var l=null;if(o){if(!a&&BX("entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"])){return}var d=o["AVATAR_SRC"]&&typeof o["AVATAR_SRC"]!="undefined"?BX.create("DIV",{props:{className:"avatar"},style:{backgroundImage:"url('"+o["AVATAR_SRC"]+"')",backgroundRepeat:"no-repeat"}}):BX.create("DIV",{props:{className:"avatar"}});var p=Math.floor(Math.random()*1e5)+1;var m=typeof o["EVENT"]!="undefined"&&typeof o["EVENT"]["RATING_TYPE_ID"]!="undefined"&&o["EVENT"]["RATING_TYPE_ID"].length>0&&typeof o["EVENT"]["RATING_ENTITY_ID"]!="undefined"&&parseInt(o["EVENT"]["RATING_ENTITY_ID"])>0&&typeof o["EVENT"]["RATING_USER_VOTE_VALUE"]!="undefined"?oMSL.buildCommentRatingNode(o,p):null;var f=oMSL.buildCommentReplyNode({EVENT:{USER_ID:o.USER_ID},CREATED_BY:{FORMATTED:BX.util.htmlspecialcharsback(o.CREATED_BY.FORMATTED)}});UFNode=typeof o["UF_FORMATTED"]!="undefined"&&o["UF_FORMATTED"].length>0?BX.create("div",{props:{className:"post-item-attached-file-wrap",id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]+"-files"},html:o["UF_FORMATTED"]}):null;l=BX.create("DIV",{attrs:{id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]},props:{className:"post-comment-block"},children:[BX.create("DIV",{props:{className:"post-user-wrap"},children:[d,BX.create("DIV",{props:{className:"post-comment-cont"},children:[BX.create("A",{props:{className:"post-comment-author"},attrs:{href:o["CREATED_BY"]["URL"]},html:o["CREATED_BY"]["FORMATTED"]}),BX.create("DIV",{props:{className:"post-comment-time"},html:o["LOG_TIME_FORMAT"]})]})]}),BX.create("DIV",{props:{className:"post-comment-text"},html:typeof o["MESSAGE_FORMAT_MOBILE"]!="undefined"&&o["MESSAGE_FORMAT_MOBILE"].length>0?o["MESSAGE_FORMAT_MOBILE"]:o["MESSAGE_FORMAT"]}),UFNode,m,f]})}else{l=BX.create("DIV",{html:t})}if(!!n){if(a){n.parentNode.insertBefore(l,n)}BX.cleanNode(BX(n),true)}if(!a){BX("post-comment-last-after").parentNode.insertBefore(l,BX("post-comment-last-after"))}var c=false;if(o&&m){if(!window.RatingLikeComments&&top.RatingLikeComments){RatingLikeComments=top.RatingLikeComments}c=o["EVENT"]["RATING_TYPE_ID"]+"-"+o["EVENT"]["RATING_ENTITY_ID"]+"-"+p;RatingLikeComments.Set(c,o["EVENT"]["RATING_TYPE_ID"],o["EVENT"]["RATING_ENTITY_ID"],"Y")}if(o){var u={EVENT:{ID:o.EVENT.ID,LOG_ID:o.EVENT.LOG_ID,USER_ID:o.USER_ID,MESSAGE:o.MESSAGE,RATING_TOTAL_POSITIVE_VOTES:o.EVENT.RATING_TOTAL_POSITIVE_VOTES},EVENT_FORMATTED:{CAN_EDIT:o.CAN_EDIT,CAN_DELETE:o.CAN_DELETE},CREATED_BY:o.CREATED_BY};oMSL.createCommentMenu(l,u,c)}if(i&&BX("comment_send_form_comment")){BX("comment_send_form_comment").value=""}if(s){oMSL.incrementCounters(oMSL.getLogId())}if(typeof o["UF_FORMATTED"]!="undefined"){oMSL.parseAndExecCode(o["UF_FORMATTED"],0)}if(r){setTimeout(function(){BitrixMobile.LazyLoad.showImages()},500)}};BitrixMSL.prototype.showPreviewComment=function(e){if(!e)return false;var t=BX("empty_comment",true);var o=Math.floor(Math.random()*1e5)+1;var n=BX("post-comment-last-after");if(t&&n){var i=BX.clone(t,true);BX.adjust(BX(i),{attrs:{id:"new_comment_"+o}});var a=BX.findChild(i,{className:"post-comment-text"},true,false);a.innerHTML=e.replace(/\n/g,"<br />");n.parentNode.insertBefore(i,n);BX(i).style.display="block";var s=document.body;var r=s.scrollHeight-s.offsetHeight;var l=window.platform=="android"?600:120;if(s&&s.scrollTop>=r-l){BitrixAnimation.animate({duration:1e3,start:{scroll:s.scrollTop},finish:{scroll:s.scrollTop+l+20},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}})}}return!!i?BX(i):false};BitrixMSL.prototype.showCommentWait=function(e){if(typeof e.nodeId!="undefined"){var t=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);var o=false;var n=false;if(t){o=BX.findChild(t,{className:"post-comment-preview-wait"},true,false);n=BX.findChild(t,{className:"post-comment-preview-undelivered"},true,false)}if(e.status){if(!o){t.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-wait"}}))}if(!n){t.appendChild(BX.create("DIV",{props:{className:"post-comment-preview-undelivered"}}))}}}};BitrixMSL.prototype.showCommentAlert=function(e){var t=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var o=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var n=typeof e.text!="undefined"&&e.text?e.text:"";var i=typeof e.callback!="undefined"?e.callback:false;var a=typeof e.action!="undefined"?e.action:false;if(typeof e.nodeId!="undefined"){if(a=="add"){this.alertPreviewComment({nodeId:e.nodeId,text:n,commentType:t,commentId:o,action:a,callback:i})}else{var s=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);if(s){var r=BX.findChild(s,{className:"post-comment-preview-undelivered"},true,false);if(!r){s.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-undelivered"},style:{display:"block"}}))}this.alertPreviewComment({nodeId:e.nodeId,text:n,commentType:t,commentId:o,action:a,callback:i})}}}};BitrixMSL.prototype.alertPreviewComment=function(e){var t=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var n=typeof e.text!="undefined"&&e.text?e.text:"";var i=typeof e.callback!="undefined"?e.callback:false;if(typeof e.nodeId!="undefined"){var a=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-wait"},true,false);var s=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-undelivered"},true,false);if(!!a&&!!s){BX(a).style.display="none";BX(s).style.display="block";BX.bind(BX(s),"click",function(){BX.unbindAll(BX(s));BX(a).style.display="block";BX(s).style.display="none";if(i){i()}})}}};BitrixMSL.prototype.setFollow=function(e){var t=typeof e.logId!="undefined"?parseInt(e.logId):0,o=typeof e.pageId!="undefined"?e.pageId:false,n=typeof e.bOnlyOn!="undefined"?e.bOnlyOn:false,i=typeof e.bRunEvent!="undefined"?e.bRunEvent:true,a=typeof e.bAjax!="undefined"?e.bAjax:false,s=typeof e.menuNode!="undefined"&&BX(e.menuNode)?BX(e.menuNode):null;if(!s){s=BX("log-entry-menu-"+t)}if(n=="NO"){n=false}var r=BX("log_entry_follow_"+t);if(!r){r=BX("log_entry_follow")}var l=BX("post_item_top_wrap_"+t);if(!l){l=BX("post_item_top_wrap")}var d=null;if(s){d=s.getAttribute("data-follow")=="Y"?"Y":"N"}else if(r){d=r.getAttribute("data-follow")=="Y"?"Y":"N"}if(!d){return false}var p=d=="Y"?"N":"Y";if((!BX.type.isNotEmptyString(this.detailPageId)||this.detailPageId!=o)&&(!n||d=="N")){if(r){BX.removeClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");BX.addClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");r.setAttribute("data-follow",p)}if(s){s.setAttribute("data-follow",p)}if(i){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(oMSL.detailPageId)?oMSL.detailPageId:"",bOnlyOn:n?"Y":"N"},true)}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.removeClass(l,"post-item-follow")}else{BX.addClass(l,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(p=="Y");this.setFollowMenuItemName()}}if(a){BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:t,value:p},analyticsLabel:{b24statAction:p=="Y"?"setFollow":"setUnfollow"}}).then(function(e){if(!e.data.success){if(r){BX.removeClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");r.setAttribute("data-follow",d)}if(s){s.setAttribute("data-follow",d)}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(d=="Y");this.setFollowMenuItemName()}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.addClass(l,"post-item-follow")}else{BX.removeClass(l,"post-item-follow")}}if(this.getLogId()>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(this.detailPageId)?this.detailPageId:"",bOnlyOn:n?"Y":"N"},true)}}}.bind(this),function(e){if(r){BX.removeClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");r.setAttribute("data-follow",d)}if(s){s.setAttribute("data-follow",d)}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.addClass(l,"post-item-follow")}else{BX.removeClass(l,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(d=="Y");this.setFollowMenuItemName()}}.bind(this))}return false};BitrixMSL.prototype.setFollowDefault=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){this.setFollowDefaultValue(t);this.setDefaultFollowMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.setFollowDefaultValue(e.value!="Y");oMSL.setDefaultFollowMenuItemName()})};BitrixMSL.prototype.setExpertMode=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){oMSL.bExpertMode=t;this.setExpertModeMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_expert_mode",mobile_action:"change_expert_mode"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.bExpertMode=!(e.value=="Y");oMSL.setExpertModeMenuItemName()})};BitrixMSL.prototype.changeListMode=function(e,t,o){app.showPopupLoader({text:""});var n=false,i="";if(e.action=="change_follow_default"){n="socialnetwork.api.livefeed.changeFollowDefault";i=e.value=="Y"?"setFollowType":"unsetFollowType"}else if(e.action=="change_expert_mode"){n="socialnetwork.api.livefeed.changeExpertMode";i=e.value=="Y"?"setExpertMode":"unsetExpertMode"}if(!n){return}BX.Mobile.Ajax.runAction(n,{data:{value:e.value},analyticsLabel:{b24statAction:i,b24statContext:"mobile"}}).then(function(n){app.hidePopupLoader();if(n.data.success){t(e)}else{if(!BX.type.isNotEmptyString(this.detailPageId)){o(e)}}}.bind(this),function(t){app.hidePopupLoader();if(!BX.type.isNotEmptyString(this.detailPageId)){o(e)}}.bind(this))};BitrixMSL.prototype.incrementCounters=function(e){e=parseInt(e);if(e>0){var t=0;var o=0;if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){t=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=t+1;BX("informer_comments_"+e).innerHTML=o}else if(BX("informer_comments_common")){t=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;o=t+1;BX("informer_comments_common").innerHTML=o}if(BX("comcntleave-all")){t=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=t+1;BX("comcntleave-all").innerHTML=o}BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{log_id:e},true)}};BitrixMSL.prototype.getComment=function(e){var t="";if(e.commentType=="blog"){if(!!e.oPreviewComment&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}t=BX.message("SBPCurlToNew").replace(/#post_id#/,e.entryId).replace(/#comment_id#/,e.commentId)}if(t.length>0){BX.Mobile.Ajax.wrap({type:"json",method:"GET",url:t,data:"",processData:true,callback:function(t){if(typeof t.TEXT!="undefined"){oMSL.showNewComment({commentType:e.commentType,commentId:e.commentId,text:t.TEXT,bClearForm:false,oPreviewComment:e.oPreviewComment,bReplace:false,bIncrementCounters:true,bShowImages:false});oMSL.parseAndExecCode(t.TEXT);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}})}};BitrixMSL.prototype.setFocusOnComments=function(e){e=e=="list"?"list":"form";if(e=="form"){this.setFocusOnCommentForm();__MSLDetailMoveBottom()}else if(e=="list"){if(BX("post-comments-wrap")){var t=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block-new"},true);if(t){window.scrollTo(0,t.offsetTop)}else{var o=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block"},true);window.scrollTo(0,o?o.offsetTop:0)}}}return false};BitrixMSL.prototype.setFocusOnCommentForm=function(){BXMobileApp.UI.Page.TextPanel.focus();return false};BitrixMSL.prototype.buildDetailPageMenu=function(e){var t=null;if(Application.getApiVersion()>=34){t=document.getElementById("log-entry-menu-"+this.getLogId())}BX.MobileLivefeed.PostMenuInstance.init({logId:parseInt(this.getLogId()),postId:parseInt(e.post_id),postPerms:e.post_perm,useShare:e.entry_type==="blog",useFavorites:t&&t.getAttribute("data-use-favorites")==="Y",useFollow:oMSL.bUseFollow&&e.read_only!=="Y",usePinned:parseInt(this.getLogId())>0,useRefreshComments:true,favoritesValue:t&&t.getAttribute("data-favorites")==="Y",followValue:oMSL.getFollowValue(),pinnedValue:t&&t.getAttribute("data-pinned")==="Y",contentTypeId:e.post_content_type_id,contentId:parseInt(e.post_content_id),target:t,context:"detail"});return BX.MobileLivefeed.PostMenuInstance.getMenuItems().map(function(e){e.name=e.title;e.image=e.iconUrl;delete e.title;delete e.iconUrl;return e})};BitrixMSL.prototype.getPageMenuItems=function(e){e=e=="detail"?"detail":"list";return e=="detail"?this.detailPageMenuItems:this.listPageMenuItems};BitrixMSL.prototype.showPageMenu=function(){if(this.pageType=="detail"){this.detailPageMenuItems=this.buildDetailPageMenu(this.menuData)}var e=this.getPageMenuItems(this.pageType);if(e.length>0){var t=[],o={};for(var n=0;n<e.length;n++){t.push({id:e[n].id,title:e[n].name,iconUrl:BX.type.isNotEmptyString(e[n].image)?e[n].image:"",iconName:BX.type.isNotEmptyString(e[n].iconName)?e[n].iconName:"",sectionCode:"defaultSection"});o[e[n].id]=e[n].action}app.exec("setPopupMenuData",{items:t,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof o[e.item.id]!="undefined"){o[e.item.id]()}}})}};BitrixMSL.prototype.initPageMenu=function(e){e=e=="detail"?"detail":"list";var t=this.getPageMenuItems(e),o=e=="detail"?BX.message("MSLLogEntryTitle")!=null?BX.message("MSLLogEntryTitle"):"":BX.message("MSLLogTitle")!=null?BX.message("MSLLogTitle"):"";if(t.length>0){if(Application.getApiVersion()>=34){BXMobileApp.UI.Page.TopBar.title.params.largeMode=true;BXMobileApp.UI.Page.TopBar.title._applyParams();oMSL.initPagePopupMenu()}else{app.menuCreate({items:t});BXMobileApp.UI.Page.TopBar.title.setCallback(function(){app.menuShow()})}}else{if(Application.getApiVersion()>=34){}else{BXMobileApp.UI.Page.TopBar.title.setCallback("")}}BXMobileApp.UI.Page.TopBar.title.setText(o);BXMobileApp.UI.Page.TopBar.title.show()};BitrixMSL.prototype.showPostMenu=function(e){var t=null;if(BX.type.isString(e.target.getAttribute("data-menu-type"))&&e.target.getAttribute("data-menu-type")=="post"){t=e.target}else{t=BX.findParent(e.target,{className:"lenta-menu"},{className:"post-item-top"})}if(!BX(t)){return e.preventDefault()}BX.MobileLivefeed.PostMenuInstance.init({logId:parseInt(t.getAttribute("data-log-id")),postId:parseInt(t.getAttribute("data-post-id")),postPerms:t.getAttribute("data-post-perm"),useFavorites:t.getAttribute("data-use-favorites")==="Y",useFollow:t.getAttribute("data-use-follow")==="Y",usePinned:t.getAttribute("data-use-pinned")==="Y",favoritesValue:t.getAttribute("data-favorites")==="Y",followValue:t.getAttribute("data-follow")==="Y",pinnedValue:t.getAttribute("data-pinned")==="Y",contentTypeId:t.getAttribute("data-content-type-id"),contentId:parseInt(t.getAttribute("data-content-id")),target:t,context:"list"});var o=BX.MobileLivefeed.PostMenuInstance.getMenuItems();if(o.length<=0){return e.preventDefault()}var n={};for(var i=0;i<o.length;i++){n[o[i].id]=o[i].action}app.exec("setPopupMenuData",{position:"center",items:o,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof n[e.item.id]!="undefined"){n[e.item.id]()}}});return e.preventDefault()};BitrixMSL.prototype.copyPostLink=function(e){var t=BX.type.isNotEmptyString(e.contentTypeId)?e.contentTypeId:"";var o=BX.type.isNumber(e.contentId)&&e.contentId>0?e.contentId:0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,logId:this.getLogId(),additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),function(e){})};BitrixMSL.prototype.setFollowMenuItemName=function(){var e=false;for(var t=0;t<this.detailPageMenuItems.length;t++){e=this.detailPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowValue()?BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N");this.detailPageMenuItems[t]=e;this.initPageMenu("detail");break}}};BitrixMSL.prototype.setDefaultFollowMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN");this.listPageMenuItems[t]=e;this.initPageMenu("list");break}}};BitrixMSL.prototype.setExpertModeMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="expert"){e.name=oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN");this.listPageMenuItems[t]=e;this.initPageMenu("list");break}}};BitrixMSL.prototype.replyToComment=function(e,t,o){e=parseInt(e);var n=typeof this.commentTextCurrent!="undefined"?this.commentTextCurrent:"";this.arMention[t]="[USER="+e+"]"+t+"[/USER]";n=n+" "+t+", ";if(typeof this.commentTextCurrent!="undefined"){this.commentTextCurrent=n}BXMobileApp.UI.Page.TextPanel.setText(n);BXMobileApp.UI.Page.TextPanel.focus();return typeof o!="undefined"?o.preventDefault():false};BitrixMSL.prototype.buildCommentRatingNode=function(e,t){var o=e["EVENT"]["RATING_USER_VOTE_VALUE"]>0?"post-comment-likes-liked":"post-comment-likes";var n=parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>1||parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])==1&&e["EVENT"]["RATING_USER_VOTE_VALUE"]<=0;return BX.create("DIV",{props:{id:"bx-ilike-button-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:o},children:[BX.create("DIV",{props:{className:"post-comment-likes-text"},html:n?BX.message("MSLLike2"):BX.message("MSLLike")}),BX.create("DIV",{props:{id:"bx-ilike-count-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:"post-comment-likes-counter"},style:{display:n?"inner-block":"none"},events:{click:function(o){RatingLikeComments.List(e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t);o.preventDefault()}},html:""+parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])+""})]})};BitrixMSL.prototype.buildCommentReplyNode=function(e){return BX.create("DIV",{props:{className:"post-comment-reply"},children:[BX.create("DIV",{props:{className:"post-comment-reply-text"},events:{click:function(t){oMSL.replyToComment(e["EVENT"]["USER_ID"],e["CREATED_BY"]["FORMATTED"],t||window.event)}},html:BX.message("MSLReply")})]})};BitrixMSL.prototype.drawRatingFooter=function(e){if(BX("rating-footer-wrap")){BX("rating-footer-wrap").innerHTML=e;this.parseAndExecCode(e,0)}};BitrixMSL.prototype.parseMentions=function(e){var t=e;if(typeof this.arMention!="undefined"){for(var o in this.arMention){t=t.replace(new RegExp(o,"g"),this.arMention[o])}this.arMention=[];this.commentTextCurrent=""}return t};BitrixMSL.prototype.unParseMentions=function(e){var t=e;t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){oMSL.arMention[o]=e;return o});return t};BitrixMSL.prototype.expandText=function(e){if(!document.body.classList.contains("post-card")){return}var t=typeof e=="undefined"||e==null||!BX("post_block_check_cont_"+e)?BX("post_block_check_cont"):BX("post_block_check_cont_"+e);if(!t){return}if(BX.hasClass(t,"post-item-post-block")){BX.addClass(t,this.classes.postItemBlockFull);BX.removeClass(t,"post-item-post-block")}else if(BX.hasClass(t,"lenta-info-block-wrapp")){BX.addClass(t,"lenta-info-block-wrapp-full");BX.removeClass(t,"lenta-info-block-wrapp")}var o=t.querySelector(".post-more-block");if(o){o.style.display="none"}if(BX("post_more_limiter_"+e)){BX("post_more_limiter_"+e).style.visibility="hidden"}else if(BX("post_more_limiter")){BX("post_more_limiter").style.visibility="hidden"}var n=BX.findChildren(t,{tagName:"img"},true);if(BX.type.isArray(n)){for(var i=0;i<n.length;i++){if(BX.type.isString(n[i].getAttribute("data-src"))&&n[i].getAttribute("data-src").length>0&&!!n[i].id){BitrixMobile.LazyLoad.registerImage(n[i].id)}}BitrixMobile.LazyLoad.showImages(false)}};BitrixMSL.prototype.showEmptyCommentsBlockWaiter=function(e,t){t=!!t;if(!BX(e)){return}var o=BX.findChild(BX(e),{className:"post-comments-load-btn-wrap"},true,false);if(o){BX.cleanNode(o,true)}if(t){BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-loader"}}),BX.create("DIV",{props:{className:"post-comments-load-text"},text:BX.message("MSLDetailCommentsLoading")})]}))}};BitrixMSL.prototype.showEmptyCommentsBlockFailed=function(e,t,o,n,i){if(!BX(e)){return}var a=typeof i!="undefined"&&typeof i.ERROR_MESSAGE!="undefined"&&i.ERROR_MESSAGE.length>0?i.ERROR_MESSAGE:BX.message("MSLDetailCommentsFailed");BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-load-text"},text:a}),BX.create("A",{props:{className:"post-comments-load-btn"},events:{click:function(){BX.cleanNode(this.parentNode,true);oMSL.getComments({ts:t,bPullDown:o,obFocus:{form:false}})},touchstart:function(){this.classList.add("post-comments-load-btn-active")},touchend:function(){this.classList.remove("post-comments-load-btn-active")}},text:BX.message("MSLDetailCommentsReload")})]}))};BitrixMSL.prototype.afterEdit=function(e,t){t=typeof t!="undefined"?parseInt(t):0;var o=BX.create("DIV",{html:e.text});BX("blog-post-first-after").parentNode.insertBefore(o,BX("blog-post-first-after").nextSibling);var n=BX.findChild(o,{className:"post-item-post-block"},true),i=BX.findChild(o,{className:"post-item-top"},true),a=BX.findChild(o,{className:"post-item-attached-file-wrap"},true);if(t>0&&n&&i){var s={detailText:n.innerHTML,topText:i.innerHTML,logID:t};if(a){s.filesBlockText=a.innerHTML}BXMobileApp.onCustomEvent("onEditedPostInserted",s,true,true)}BitrixMobile.LazyLoad.showImages()};BitrixMSL.prototype.onLogEntryFavorites=function(e,t){var o=BX("log_entry_favorites_"+e);if(o&&(BX.message("MSLPageId")==undefined||BX.message("MSLPageId")!=t)){var n=o.getAttribute("data-favorites")=="Y"?"Y":"N";var i=n=="Y"?"N":"Y";if(n=="Y"){BX.removeClass(o,"lenta-item-fav-active")}else{BX.addClass(o,"lenta-item-fav-active")}o.setAttribute("data-favorites",i)}};BitrixMSL.prototype.onLogEntryCommentAdd=function(e,t){var o,n;var i=typeof t!="undefined";if(typeof t=="undefined"){t=0}if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){if(parseInt(t)>0){o=parseInt(t)}else if(!i){n=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=n+1}if(parseInt(o)>0){BX("informer_comments_"+e).innerHTML=o;BX("informer_comments_"+e).style.display="inline-block";BX("informer_comments_text2_"+e).style.display="inline-block";BX("informer_comments_text_"+e).style.display="none"}}if(BX("comcntleave-all")){if(parseInt(t)>0){o=parseInt(t)}else if(!i){n=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=n+1}BX("comcntleave-all").innerHTML=o}};BitrixMSL.prototype.onLogEntryRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogEntryRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var n=parseInt(e.logId);var i=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");if(n<=0&&this.isUserCurrent(i)){delete this.arRatingLikeProcess[t];return}var a=BX("bx-ilike-box-"+t);if(!a){delete this.arRatingLikeProcess[t];return}var s=BX("bx-ilike-button-"+t);if(!s){s=BX("rating_button")}if(!s||!BX.hasClass(s,"post-item-inform-likes")&&!BX.hasClass(s,"post-item-inform-likes-active")){delete this.arRatingLikeProcess[t];return}var r=null;var l=0;var d=0;var p=null;var m=n>0&&BX("rating_block_"+n)?BX("rating_block_"+n):BX("rating_button_cont");if(!m&&a){m=BX.findParent(a,{tag:"SPAN",className:"bx-ilike-block"})}if(a){r=BX.findChild(a,{className:"post-item-inform-right-text"},true,false);if(r&&m){l=parseInt(m.getAttribute("data-counter"));d=o=="plus"?l+1:l-1;r.innerHTML=d}if(this.isUserCurrent(i)){BX.removeClass(s,o=="plus"?"post-item-inform-likes":"post-item-inform-likes-active");BX.addClass(s,o=="plus"?"post-item-inform-likes-active":"post-item-inform-likes")}var f=BX.hasClass(s,"post-item-inform-likes-active")&&d>1||!BX.hasClass(s,"post-item-inform-likes-active")&&d>0;r=BX.findChild(s,{className:"post-item-inform-right"},true,false);if(r){r.innerHTML=d;r.style.display=f?"inline-block":"none";r=BX.findChild(s,{className:"post-item-inform-left"},true,false);r.innerHTML=f?BX.message("MSLLike2"):BX.message("MSLLike")}}if(m){m.setAttribute("data-counter",parseInt(d))}if(n>0&&BX("rating-footer_"+n)){p=BX("rating-footer-wrap_"+n)}else if(m){p=BX("rating-footer-wrap")}if(!p&&m&&typeof m.id!="undefined"){var c=m.id.match(/^rating_block_([\d]+)$/i);if(c!=null){p=BX("rating-footer-wrap_"+c[1])}}if(this.isUserCurrent(i)&&typeof BXRL!="undefined"&&typeof BXRL[t]!="undefined"){BXRL[t].lastVote=o=="plus"?"plus":"cancel"}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.onLogCommentRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogCommentRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var n=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");var i=BX("bx-ilike-count-"+t);if(!i){delete this.arRatingLikeProcess[t];return}var a=parseInt(i.innerHTML);var s=o=="plus"?a+1:a-1;if(this.isUserCurrent(n)){delete this.arRatingLikeProcess[t];return}var r=BX("bx-ilike-button-"+t);if(!r||!BX.hasClass(r,"post-comment-likes")&&!BX.hasClass(r,"post-comment-likes-liked")){delete this.arRatingLikeProcess[t];return}if(i){var l=BX.hasClass(r,"post-comment-likes-liked")&&s>1||!BX.hasClass(r,"post-comment-likes-liked")&&s>0;i.innerHTML=s;i.style.display=l?"inline-block":"none";var d=BX.findChild(r,{className:"post-comment-likes-text"},true,false);d.innerHTML=l?BX.message("MSLLike2"):BX.message("MSLLike")}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.checkVisibility=function(e){var t=e.node;if(BX.hasClass(document.body,"lenta-page")){var o=oMSL.checkImageOffset(t);if(o===false){e.status=BitrixMobile.LazyLoad.status.hidden}return o}else if(!oMSL.isPostFull()&&oMSL.isImageFromPost(e)){return oMSL.checkImageOffset(t)}return true};BitrixMSL.prototype.checkImageOffset=function(e){if(!BX.hasClass(e.parentNode,"post-item-attached-img-block")){return e.offsetTop<315}return true};BitrixMSL.prototype.isPostFull=function(){var e=BX("post_block_check_cont_"+this.logId)?BX("post_block_check_cont_"+this.logId):BX("post_block_check_cont",true);return BX.hasClass(e,this.classes.postItemBlockFull)||BX.hasClass(e,"lenta-info-block-wrapp-full")};BitrixMSL.prototype.isImageFromPost=function(e){if(typeof e.fromPost!="undefined"){return e.fromPost}var t=5;var o=e.node;while(o=o.parentNode){if(BX.hasClass(o,"post-item-post-block")){e.fromPost=true;return true}if(t<=0){e.fromPost=false;return false}t--}};BitrixMSL.prototype.isUserCurrent=function(e){return e==BX.message("USER_ID")};BitrixMSL.prototype.checkNodesHeight=function(){var e=false;var t=null;var o=null;for(var n in this.arBlockToCheck){if(!this.arBlockToCheck.hasOwnProperty(n)){continue}t=this.arBlockToCheck[n];o=BX(t.lenta_item_id)?BX(t.lenta_item_id).querySelector(".post-more-block"):false;if(o&&BX(t.text_block_id)){e=BX(t.text_block_id).offsetHeight;if(BX(t.title_block_id)){e+=BX(t.title_block_id).offsetHeight}if(BX(t.files_block_id)){e+=BX(t.files_block_id).offsetHeight}var i=BX(t.text_block_id).parentNode.querySelector(".post-item-important");if(i){e+=i.offsetHeight}if(BX(t.more_button_id)&&BX(t.more_button_id).closest("[data-livefeed-pinned-panel]")){BX(t.more_button_id).style.visibility="visible"}else if(e>=320&&!BX.hasClass(t.text_block_id,this.classes.postItemBlockFull)){o.style.display="block";if(BX(t.lenta_item_id)){BX.removeClass(BX(t.lenta_item_id),"post-without-informers")}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="visible"}}else{if(o){o.style.display="none"}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="hidden"}}}}};BitrixMSL.prototype.initScroll=function(e,t){e=!!e;t=!!t;if(e){BX.unbind(window,"scroll",__MSLOnFeedScroll);BX.bind(window,"scroll",__MSLOnFeedScroll)}else{BX.unbind(window,"scroll",__MSLOnFeedScroll)}if(t&&BX("next_post_more")){BX("next_post_more").style.display=e?"block":"none"}};BitrixMSL.prototype.onScrollDetail=function(){if(!oMSL.canCheckScrollButton){return}clearTimeout(oMSL.showScrollButtonTimeout);oMSL.showScrollButtonTimeout=setTimeout(function(){oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton()},200)};BitrixMSL.prototype.checkScrollButton=function(){oMSL.windowSize=BX.GetWindowSize();var e=window.scrollY,t=oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight-100;oMSL.showScrollButtonBottom=!(oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight<=0||e>=t&&(e>0||t>0));oMSL.showScrollButtonTop=e>200;oMSL.showHideScrollButton()};BitrixMSL.prototype.showHideScrollButton=function(){var e=BX("post-scroll-button-bottom");if(e){if(oMSL.showScrollButtonBottom){if(!e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.add("post-comment-block-scroll-bottom-active")}}else{if(e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.remove("post-comment-block-scroll-bottom-active")}}}var t=BX("post-scroll-button-top");if(t){if(oMSL.showScrollButtonTop){if(!t.classList.contains("post-comment-block-scroll-top-active")){t.classList.add("post-comment-block-scroll-top-active")}}else{if(t.classList.contains("post-comment-block-scroll-top-active")){t.classList.remove("post-comment-block-scroll-top-active")}}}};BitrixMSL.prototype.scrollTo=function(e){if(e!="top"){e="bottom"}oMSL.canCheckScrollButton=false;oMSL.showScrollButtonBottom=false;oMSL.showScrollButtonTop=false;oMSL.showHideScrollButton();var t=window.scrollY,o=null;if(e=="bottom"){o=oMSL.windowSize.scrollHeight}else{o=0}BitrixAnimation.animate({duration:500,start:{scroll:t},finish:{scroll:o},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){oMSL.canCheckScrollButton=true;oMSL.checkScrollButton()}})};BitrixMSL.prototype.getComments=function(e){var t=e.ts;var o=!!e.bPullDown;var n=typeof e.obFocus.form=="undefined"||e.obFocus.form=="NO"?"NO":"YES";var i=typeof e.obFocus.comments=="undefined"||e.obFocus.comments=="NO"?"NO":"YES";var a=this.logId;if(!o){if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.start()}BX.cleanNode(BX("post-comments-wrap"));BX("post-comments-wrap").appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}))}oMSL.showEmptyCommentsBlockWaiter(BX("post-comments-wrap"),true);var s=document.querySelector(".feed-post-emoji-popup-container");if(s){s.style.top=0;s.style.left=0;s.classList.remove("feed-post-emoji-popup-active");s.classList.remove("feed-post-emoji-popup-active-final");s.classList.remove("feed-post-emoji-popup-active-final-item");s.classList.add("feed-post-emoji-popup-invisible-final");s.classList.add("feed-post-emoji-popup-invisible-final-mobile")}oMSL.emptyCommentsXhr=BX.Mobile.Ajax.wrap({type:"json",method:"GET",url:BX.message("MSLPathToLogEntry").replace("#log_id#",a)+"&empty_get_comments=Y"+(typeof t!="undefined"&&t!=null?"&LAST_LOG_TS="+t:""),data:"",processData:true,callback:function(t){var s=BX("post-comments-form-wrap");var r=BX("post-comments-wrap");if(o){app.exec("pullDownLoadingStop")}else if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(r,false);if(BX.type.isNotEmptyString(t.POST_PERM)){oMSL.menuData.post_perm=t.POST_PERM;oMSL.detailPageMenuItems=oMSL.buildDetailPageMenu(oMSL.menuData);oMSL.initPageMenu("detail")}if(BX.type.isNotEmptyString(t.TEXT)){if(o){BX.cleanNode(r);if(typeof t.POST_NUM_COMMENTS!="undefined"){if(BX("informer_comments_common")){BX("informer_comments_common").style.display="inline";BX("informer_comments_common").innerHTML=parseInt(t.POST_NUM_COMMENTS);if(BX("informer_comments_all")){BX("informer_comments_all").style.display="none"}if(BX("informer_comments_new")){BX("informer_comments_new").style.display="none"}}BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:a,num:parseInt(t.POST_NUM_COMMENTS)},true)}}BX.clearNodeCache();__MSLRepositLog(a,{POST_NUM_COMMENTS:t.POST_NUM_COMMENTS});var l=BX.processHTML(t.TEXT,true);r.innerHTML=l.HTML;r.appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}));var d=0,p=function(){d++;if(d<100){if(BX("post-comments-wrap").childNodes.length>0){BX.ajax.processScripts(l.SCRIPT)}else{BX.defer(p,this)()}}};BX.defer(p,this)();BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]);BX.onCustomEvent(window,"BX.UserContentView.onClearCall",[]);if(!o){if(s){s.innerHTML=""}__MSLDetailPullDownInit(true);if(n=="YES"){oMSL.setFocusOnComments("form")}else if(i=="YES"){oMSL.setFocusOnComments("list")}}oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton();if(typeof t.TS!=="undefined"&&BX("post_log_id")){BX("post_log_id").setAttribute("data-ts",t.TS)}}else{if(!o){oMSL.showEmptyCommentsBlockWaiter(r,false)}app.alert({title:BX.message("MOBILE_EXT_LIVEFEED_ALERT_ERROR_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_ALERT_ERROR_POST_NOT_FOUND_TEXT"),button:BX.message("MOBILE_EXT_LIVEFEED_ALERT_ERROR_BUTTON"),callback:function(){BXMobileApp.onCustomEvent("Livefeed::onLogEntryDetailNotFound",{logId:a},true);BXMPage.close()}})}},callback_failure:function(){var e=BX("post-comments-wrap");if(o){app.exec("pullDownLoadingStop");bReload=false}else{BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(e,false);oMSL.showEmptyCommentsBlockFailed(e,t,o,n)}})};BitrixMSL.prototype.refreshPostDetail=function(){BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.mobileGetDetail",{data:{logId:this.getLogId()}}).then(function(e){if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)&&BX("post_block_check_cont")){BX.html(BX("post_block_check_cont"),e.data.html);this.registerEmptyBlockToCheck();setTimeout(function(){this.checkNodesHeight();BitrixMobile.LazyLoad.showImages()}.bind(this),500)}}.bind(this),function(e){})};BitrixMSL.prototype.formatTaskDescription=function(e,t,o,n){var i=e;n=BX.type.isNotEmptyString(n)?"_"+n:"";if(!!t&&!!o&&t.length>0){i+="<br><br>"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+o+n).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return i};BitrixMSL.prototype.createTask=function(e){app.showPopupLoader();BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:e.entityType,entityId:e.entityId,logId:BX.type.isNumber(e.logId)?e.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then(function(t){var o=t.data;if(typeof o.TITLE!="undefined"&&typeof o.DESCRIPTION!="undefined"&&typeof o.DISK_OBJECTS!="undefined"&&(BX.type.isNotEmptyString(o.TITLE)||BX.type.isNotEmptyString(o.DESCRIPTION))&&BX.type.isNotEmptyString(o.LIVEFEED_URL)){var n=this.formatTaskDescription(o.DESCRIPTION,o.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(o.SUFFIX)?o.SUFFIX:"");var i={TITLE:o.TITLE,DESCRIPTION:n,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:o.DISK_OBJECTS};var a=[];if(typeof o.GROUPS_AVAILABLE!="undefined"){for(var s in o.GROUPS_AVAILABLE){if(o.GROUPS_AVAILABLE.hasOwnProperty(s)){a.push(o.GROUPS_AVAILABLE[s])}}}if(a.length==1){i.GROUP_ID=parseInt(a[0])}new BX.Tasks.Util.Query({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir")+"mobile/":"/mobile/")+"?mobile_action=task_ajax"}).add("task.add",{data:i},{},{onExecuted:BX.proxy(function(t,o){app.hidePopupLoader();if(typeof o!="undefined"&&typeof o.RESULT!="undefined"&&typeof o.RESULT.DATA!="undefined"&&typeof o.RESULT.DATA.ID!="undefined"&&parseInt(o.RESULT.DATA.ID)>0){this.createTaskSetContentSuccess(o.RESULT.DATA.ID);BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.createTaskComment",{data:{params:{postEntityType:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,entityType:e.entityType,entityId:e.entityId,taskId:o.RESULT.DATA.ID,logId:BX.type.isNumber(e.logId)?e.logId:null}}}).then(function(e){},function(e){})}else{this.createTaskSetContentFailure(t.getMessages())}},this)}).execute()}else{app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}}.bind(this),function(e){app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}.bind(this))};BitrixMSL.prototype.createTaskSetContentSuccess=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_CANCEL"),BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_OK")],callback:function(t){if(t==2){app.loadPageBlank({url:BX.message("MOBILE_EXT_LIVEFEED_TASK_PATH").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e),bx24ModernStyle:true})}}})};BitrixMSL.prototype.createTaskSetContentFailure=function(e){app.alert({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_FAILURE_TITLE"),text:e.join(". ")})};BitrixMSL.prototype.copyLink=function(e){var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"",o=parseInt(e.entityId)>0?parseInt(e.entityId):0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),function(e){})};BitrixMSL.prototype.copyLinkSuccess=function(e){if(!BX.type.isNotEmptyString(e.LIVEFEED_URL)){return}app.exec("copyToClipboard",{text:e.LIVEFEED_URL});BX.MobileLivefeed.NotificationBarInstance.showInfo({id:"copy",text:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK_SUCCESS"),groupId:"clipboard",maxLines:1})};BitrixMSL.prototype.setPostFormParams=function(e){if(typeof e=="object"){for(var t in e){if(["selectedRecipients","messageText","messageFiles"].indexOf(t)!==-1&&e.hasOwnProperty(t)){oMSL.newPostFormParams[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraData=function(e){if(typeof e=="object"){for(var t in e){if((t=="hiddenRecipients"||t=="logId"||t=="postId"||t=="postAuthorId"||t=="messageUFCode"||t=="commentId"||t=="commentType"||t=="nodeId"||t=="pinnedContext")&&e.hasOwnProperty(t)){oMSL.newPostFormExtraData[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraDataArray=function(e){var t=null;for(var o in e){if(e.hasOwnProperty(o)){t={};t[o]=e[o];this.setPostFormExtraData(t)}}};BitrixMSL.prototype.getPostFormExtraData=function(){return oMSL.newPostFormExtraData};BitrixMSL.prototype.showNewPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"post";var o=this.getPostFormExtraData();var n={attachButton:this.getPostFormAttachButton(),mentionButton:this.getPostFormMentionButton(),attachFileSettings:this.getPostFormAttachFileSettings(),extraData:o?o:{},smileButton:{},supportLocalFilesInText:t=="post",okButton:{callback:function(o){if(o.text.length>0){var n=oMSL.buildPostFormRequestStub({type:t,extraData:o.extraData,text:oMSL.parseMentions(o.text),pinnedContext:typeof o.extraData.pinnedContext!=="undefined"&&o.extraData.pinnedContext==="YES"});var i=o.extraData.messageUFCode;oMSL.buildPostFormFiles(n,o.attachedFiles,{ufCode:i}).then(function(){if(t=="post"){oMSL.buildPostFormDestinations(n,o.selectedRecipients,typeof o.extraData!="undefined"&&typeof o.extraData.hiddenRecipients!="undefined"?o.extraData.hiddenRecipients:[],{});if(n.postVirtualId){n.ufCode=i;n.contentType="post";oMSL.initPostForm({groupId:e.groupId?e.groupId:null});BXMobileApp.onCustomEvent("Livefeed.PublicationQueue::setItem",{key:n.postVirtualId,pinnedContext:!!n.pinnedContext,item:n,pageId:BX.MobileLivefeed.Instance.getPageId(),groupId:e.groupId?e.groupId:null},true)}}},function(){})}},name:BX.message("MSLPostFormSend")},cancelButton:{callback:function(){oMSL.initPostForm({groupId:e.groupId?e.groupId:null})},name:BX.message("MSLPostFormCancel")}};if(typeof oMSL.newPostFormParams.messageText!="undefined"){n.message={text:oMSL.newPostFormParams.messageText}}if(typeof oMSL.newPostFormParams.messageFiles!="undefined"){n.attachedFiles=oMSL.newPostFormParams.messageFiles}if(t=="post"){n.recipients={dataSource:oMSL.getPostFormRecipientsDataSource()};if(typeof oMSL.newPostFormParams.selectedRecipients!="undefined"){n.recipients.selectedRecipients=oMSL.newPostFormParams.selectedRecipients}if(typeof oMSL.newPostFormParams.backgroundCode!="undefined"){n.backgroundCode=oMSL.newPostFormParams.backgroundCode}}return n};BitrixMSL.prototype.findDestinationCallBack=function(e,t,o){return e.id==this.value};BitrixMSL.prototype.addPostFormDestination=function(e,t){if(typeof t=="undefined"||typeof t.type=="undefined"){return}var o=null;if(t.type=="UA"){o=e.a_users.some(this.findDestinationCallBack,{value:0});if(!o){e.a_users.push({id:0,name:BX.message("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(t.type=="U"){o=e.a_users.some(this.findDestinationCallBack,{value:t.id});if(!o){e.a_users.push({id:t.id,name:t.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(t.type=="SG"){o=e.b_groups.some(this.findDestinationCallBack,{value:t.id});if(!o){e.b_groups.push({id:t.id,name:t.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}};BitrixMSL.prototype.getPostFormAttachButton=function(){var e=[];if(BX.message("MSLbDiskInstalled")=="Y"||BX.message("MSLbWebDavInstalled")=="Y"){var t={id:"disk",name:BX.message("MSLPostFormDisk"),dataSource:{multiple:"NO",url:BX.message("MSLbDiskInstalled")=="Y"?BX.message("MSLSiteDir")+"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId="+BX.message("USER_ID"):BX.message("MSLSiteDir")+"mobile/webdav/user/"+BX.message("USER_ID")+"/"}};var o={searchField:"YES",showtitle:"YES",modal:"YES",name:BX.message("MSLPostFormDiskTitle")};if(platform=="ios"){t.dataSource.table_settings=o}else{t.dataSource.TABLE_SETTINGS=o}e.push(t)}e.push({id:"mediateka",name:BX.message("MSLPostFormPhotoGallery")});e.push({id:"camera",name:BX.message("MSLPostFormPhotoCamera")});return{items:e}};BitrixMSL.prototype.getPostFormMentionButton=function(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action=get_user_list&use_name_format=Y"}}};BitrixMSL.prototype.getPostFormAttachFileSettings=function(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}};BitrixMSL.prototype.getPostFormRecipientsDataSource=function(){return{return_full_mode:"YES",outsection:BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"?"YES":"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action="+(BX.message("MSLIsExtranetSite")=="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog"}};BitrixMSL.prototype.getDiskUploadFolder=function(){};BitrixMSL.prototype.buildPostFormFiles=function(e,t,o){var n=new Promise(function(n,i){var a=o.ufCode;e.postVirtualId=parseInt(Math.random()*1e5);e.tasksList=[];if(typeof t!="undefined"&&t.length>0){var s=0;var r=t.length;var l=function(){s++;if(s>=r){this.postProgressingFiles(e,t,o);n()}}.bind(this);var d=[],p=null,m=null,f=null,c=null;t.forEach(function(t){f=typeof t.VALUE!="undefined"||typeof t.id!="undefined"&&parseInt(t.id)>0||BX.type.isNotEmptyObject(t.dataAttributes)&&typeof t.dataAttributes.VALUE!="undefined"||BX.type.isNotEmptyString(t.ufCode)&&t.ufCode==a;m=typeof t.url=="undefined"||typeof t.id!="number";if(t.url&&m&&!f){p="postTask_"+parseInt(Math.random()*1e5);c=BX.MobileUtils.getFileMimeType(t.type);d.push({taskId:p,type:t.type,mimeType:c,folderId:parseInt(BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),params:{postVirtualId:e.postVirtualId,pinnedContext:!!e.pinnedContext},name:typeof BX.MobileUtils.getUploadFilename==="function"?BX.MobileUtils.getUploadFilename(t.name,t.type):t.name,url:t.url,previewUrl:t.previewUrl?t.previewUrl:null,resize:BX.MobileUtils.getResizeOptions(t.type)});e.tasksList.push(p)}else{if(f){if(typeof e[a]=="undefined"){e[a]=[]}if(typeof t.VALUE!="undefined"){e[a].push(t.VALUE)}else if(parseInt(t.id)>0){e[a].push(parseInt(t.id))}else{e[a].push(t.dataAttributes.VALUE)}}l()}}.bind(this));if(d.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:d},true)}n()}else{this.postProgressingFiles(e,t,o);n()}}.bind(this));n.catch(function(e){console.error(e)});return n};BitrixMSL.prototype.postProgressingFiles=function(e,t,o){var n=o.ufCode;if(typeof e[n]=="undefined"){e[n]=[]}if(typeof t=="undefined"){t=[]}for(var i in oMSL.newPostFormParams.messageFiles){if(!oMSL.newPostFormParams.messageFiles.hasOwnProperty(i)){continue}for(var a in t){if(!t.hasOwnProperty(a)){continue}if(oMSL.newPostFormParams.messageFiles[i]["id"]==t[a]["id"]||oMSL.newPostFormParams.messageFiles[i]["id"]==t[a]["ID"]){e[n].push(oMSL.newPostFormParams.messageFiles[i]["id"]);break}}}if(e[n].length<=0){e[n].push("empty")}};BitrixMSL.prototype.buildPostFormDestinations=function(e,t,o,n){var i=null,a=null,s=null,r=null,l=null;e["DEST"]=[];if(typeof t.a_users!="undefined"){for(r in t.a_users){if(t.a_users.hasOwnProperty(r)){i="U";if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}if(typeof e.SPERM_NAME[i]=="undefined"){e.SPERM_NAME[i]=[]}a=typeof t.a_users[r].ID!="undefined"?t.a_users[r].ID:t.a_users[r].id;s=typeof t.a_users[r].NAME!="undefined"?t.a_users[r].NAME:t.a_users[r].name;l=a==0?"UA":"U"+a;e.SPERM[i].push(l);e.DEST.push(l);e.SPERM_NAME[i].push(s)}}}if(typeof t.b_groups!="undefined"){for(r in t.b_groups){if(!t.b_groups.hasOwnProperty(r)){continue}i="SG";if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}if(typeof e.SPERM_NAME[i]=="undefined"){e.SPERM_NAME[i]=[]}a=typeof t.b_groups[r].ID!="undefined"?t.b_groups[r].ID:t.b_groups[r].id;s=typeof t.b_groups[r].NAME!="undefined"?t.b_groups[r].NAME:t.b_groups[r].name;l="SG"+a;e.SPERM[i].push(l);e.DEST.push(l);e.SPERM_NAME[i].push(s)}}for(r in o){if(!o.hasOwnProperty(r)){continue}i=o[r]["TYPE"];if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}l=o[r]["TYPE"]+o[r]["ID"];e.SPERM[i].push(l);e.DEST.push(l)}};BitrixMSL.prototype.buildSelectedDestinations=function(e,t){if(typeof e.SPERM=="undefined"||typeof e.SPERM_NAME=="undefined"){return}var o=key=null;if(typeof e.SPERM.U!="undefined"){for(key in e.SPERM.U){if(!e.SPERM.U.hasOwnProperty(key)){continue}if(e.SPERM.U[key]=="UA"){this.addPostFormDestination(t,{type:"UA"})}else{o=e.SPERM.U[key].match(/^U([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"U",id:o[1],name:e.SPERM_NAME.U[key]})}}}}if(typeof e.SPERM.SG!="undefined"){for(key in e.SPERM.SG){if(!e.SPERM.SG.hasOwnProperty(key)){continue}o=e.SPERM.SG[key].match(/^SG([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"SG",id:o[1],name:e.SPERM_NAME.SG[key]})}}}};BitrixMSL.prototype.buildPostFormRequestStub=function(e){var t=null;if(e.type=="post"){t={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:BX.bitrix_sessid(),POST_MESSAGE:e.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y",PARSE_PREVIEW:"Y"};if(typeof e.extraData.postId!="undefined"&&parseInt(e.extraData.postId)>0){t.post_id=parseInt(e.extraData.postId);t.post_user_id=parseInt(e.extraData.postAuthorId);t.pinnedContext=!!e.pinnedContext;t.ACTION="EDIT_POST";if(typeof e.extraData.logId!="undefined"&&parseInt(e.extraData.logId)>0){t.log_id=parseInt(e.extraData.logId)}}}else if(e.type=="comment"&&typeof e.extraData.commentId!="undefined"&&parseInt(e.extraData.commentId)>0&&typeof e.extraData.commentType!="undefined"&&e.extraData.commentType.length>0){t={action:"EDIT_COMMENT",text:oMSL.parseMentions(e.text),commentId:parseInt(e.extraData.commentId),nodeId:e.extraData.nodeId,sessid:BX.bitrix_sessid()};if(e.extraData.commentType=="blog"){t.comment_post_id=commentVarBlogPostID}else{}}return t};BitrixMSL.prototype.initPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=e.groupId?e.groupId:false,o=e.callback?e.callback:function(){},n={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(n,t);oMSL.setPostFormExtraDataArray({postId:false,postAuthorId:false,logId:false,messageUFCode:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE")});oMSL.setPostFormParams({selectedRecipients:n,messageText:"",messageFiles:[]});setTimeout(function(){BX.MobileLivefeed.DatabaseUnsentPostInstance.load({onLoad:function(e){var t=null;n={a_users:[],b_groups:[]};if(typeof e.SPERM!="undefined"&&typeof e.SPERM.U!="undefined"&&e.SPERM.U!=null){for(t=0;t<e.SPERM.U.length;t++){if(e.SPERM.U[t]=="UA"){if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"){oMSL.addPostFormDestination(n,{type:"UA"})}}else{oMSL.addPostFormDestination(n,{type:"U",id:e.SPERM.U[t].replace("U",""),name:typeof e.SPERM_NAME!="undefined"&&typeof e.SPERM_NAME.U!="undefined"&&typeof e.SPERM_NAME.U[t]!="undefined"&&e.SPERM_NAME.U[t]!=null?e.SPERM_NAME.U[t]:""})}}}if(typeof e.SPERM!="undefined"&&typeof e.SPERM.SG!="undefined"&&e.SPERM.SG!=null){for(t=0;t<e.SPERM.SG.length;t++){oMSL.addPostFormDestination(n,{type:"SG",id:e.SPERM.SG[t].replace("SG",""),name:typeof e.SPERM_NAME.SG[t]!="undefined"&&typeof e.SPERM_NAME.SG!="undefined"&&typeof e.SPERM_NAME.SG[t]!="undefined"&&e.SPERM_NAME.SG[t]!=null?e.SPERM_NAME.SG[t]:""})}}oMSL.setPostFormParams({selectedRecipients:n});if(typeof e.POST_MESSAGE!="undefined"&&e.POST_MESSAGE!=null){oMSL.setPostFormParams({messageText:oMSL.unParseMentions(e.POST_MESSAGE)})}o()},onEmpty:function(e){n={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(n,t);o()}},t)},0)};BitrixMSL.prototype.clearPostFormDestination=function(e,t){if(typeof t!="undefined"&&parseInt(t)>0){oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(t),name:BX.message("MSLGroupName")})}else if(window.arAvailableGroup!==false){for(key in window.arAvailableGroup){if(!window.arAvailableGroup.hasOwnProperty(key)){continue}oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(window.arAvailableGroup[key]["entityId"]),name:window.arAvailableGroup[key]["name"]})}}else if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DEFAULT")=="Y"){oMSL.addPostFormDestination(e,{type:"UA"})}};BitrixMSL.prototype.processAjaxBlock=function(e,t){if(!t||typeof t.type=="undefined"||!BX.util.in_array(t.type,["refresh","next"])){return}var o=false;var n=false;i(a);s(r);function i(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function a(){if(t.type=="refresh"){BX("lenta_wrapper_global").innerHTML=e.CONTENT}else{BX("lenta_wrapper").insertBefore(BX.create("DIV",{html:e.CONTENT}),BX("next_post_more"))}o=true;if(n){r()}}function s(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function r(){n=true;if(o){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function(){if(typeof t.callback=="function"){t.callback()}}})}}};BitrixMSL.prototype.onUpdateSocnetCountersHandler=function(e){oMSL.bCounterReceived=true;oMSL.changeCounter(parseInt(e[strCounterType]))};BitrixMSL.prototype.onUpdateCounterHandler=function(e){if(typeof e[BX.message("SITE_ID")]!="undefined"){oMSL.onImUpdateCounterHandler(e[BX.message("SITE_ID")])}};BitrixMSL.prototype.onImUpdateCounterHandler=function(e){oMSL.bCounterReceived=true;if(typeof e.obZeroDate!="undefined"){var t=e.obZeroDate;delete e.obZeroDate}oMSL.changeCounter(parseInt(e[strCounterType]),typeof t!="undefined"&&t[strCounterType]!="undefined"?parseInt(t[strCounterType]):null)};BitrixMSL.prototype.registerBlocksToCheck=function(){var e=null;var t=null;var o=null;e=document.querySelectorAll(".post-wrap");if(e.length<=0){e=document.querySelectorAll(".lenta-item")}if(e!=null){for(var n=0;n<e.length;n++){if(BX.type.isNotEmptyString(e[n].id)){o=e[n].id.match(/^lenta_item_([\d]+)$/i);if(o!=null){t=o[1];if(!BX.util.in_array(t,this.blocksToCheckRegisteredList)){this.arBlockToCheck[t]={lenta_item_id:"lenta_item_"+t,text_block_id:"post_block_check_"+t,title_block_id:"post_block_check_title_"+t,files_block_id:"post_block_check_files_"+t,more_button_id:"post_more_limiter_"+t};this.blocksToCheckRegisteredList.push(t)}}}}}};BitrixMSL.prototype.registerEmptyBlockToCheck=function(){oMSL.arBlockToCheck={0:{lenta_item_id:"lenta_item",text_block_id:"post_block_check_cont",title_block_id:"post_block_check_title",more_button_id:"post_more_limiter"}}};BitrixMSL.prototype.getCopyText=function(e){function t(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value}var o=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");o=o.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,function(e,t,o){if(o.match(/^http/gi)){return'<a href="'+t+'">'+t+"</a>"}else{return e}});return t(BX.util.strip_tags(o))};BitrixMSL.prototype.initPagePopupMenu=function(){if(Application.getApiVersion()>=34){var e=[];if(!oMSL.logId){e.push({type:"search",callback:function(){app.exec("showSearchBar")}})}var t=this.getPageMenuItems(this.pageType);if(BX.type.isArray(t)&&t.length>0){e.push({type:"more",callback:function(){this.showPageMenu(this.pageType)}.bind(this)})}app.exec("setRightButtons",{items:e})}};BitrixMSL.prototype.initSearchBar=function(){if(Application.getApiVersion()>=34){BX.addCustomEvent(window,"BX.MobileLF:onSearchBarTextChanged",BX.debounce(this.searchBarEventCallback,1500,this));BX.addCustomEvent(window,"BX.MobileLF:onSearchBarCancelButtonClicked",this.searchBarEventCallback.bind(this));BX.addCustomEvent(window,"BX.MobileLF:onSearchBarSearchButtonClicked",this.searchBarEventCallback.bind(this));BXMobileApp.UI.Page.params.set({useSearchBar:true});app.exec("setParamsSearchBar",{params:{callback:function(e){if(BX.util.in_array(e.eventName,["onSearchButtonClicked"])&&BX.type.isPlainObject(e.data)&&BX.type.isString(e.data.text)){if(e.data.text.length>=this.ftMinTokenSize){this.findTextMode=true}var t=null;switch(e.eventName){case"onSearchButtonClicked":t="BX.MobileLF:onSearchBarSearchButtonClicked";break;default:}if(t){BX.onCustomEvent(window,t,[{text:e.data.text}])}}else if(BX.util.in_array(e.eventName,["onCancelButtonClicked","onSearchHide"])){BX.onCustomEvent(window,"BX.MobileLF:onSearchBarCancelButtonClicked",[])}}.bind(this)}})}};BitrixMSL.prototype.searchBarEventCallback=function(e){var t=BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(e.text)?e.text:"";if(t.length>=this.ftMinTokenSize){app.exec("showSearchBarProgress");__MSLRefresh(true,{find:t})}else if(this.findTextMode){if(this.xhr.refresh!=null){this.xhr.refresh.abort()}app.exec("hideSearchBarProgress");BX.frameCache.readCacheWithID("framecache-block-feed",function(e){if(!BX.type.isArray(e.items)||!BX("bxdynamic_feed_refresh")){return}for(var t=0;t<e.items.length;t++){if(BX.type.isNotEmptyString(e.items[t].ID)&&e.items[t].ID=="framecache-block-feed"){BX.html(BX("bxdynamic_feed_refresh"),e.items[t].CONTENT).then(function(){BX.processHTML(this.content,true)}.bind({content:e.items[t].CONTENT}));__MSLDetailMoveTop();setTimeout(function(){BitrixMobile.LazyLoad.showImages()},1e3);break}}}.bind(this))}if(t.length<this.ftMinTokenSize){this.findTextMode=false}};if(!window.oMSL){oMSL=new BitrixMSL;window.oMSL=oMSL}function openTaskComponentByTaskId(e,t,o){o=o||{};o.selectedTab=o.selectedTab||"taskTab";BXMobileApp.Events.postToComponent("taskbackground::task::action",[{taskId:t,data:o}],"background");e.preventDefault();e.stopPropagation();return false}
//# sourceMappingURL=script_attached.map.js