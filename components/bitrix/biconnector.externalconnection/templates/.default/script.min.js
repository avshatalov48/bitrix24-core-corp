(function(t,e,a,i){"use strict";var n,l,s,r,c,o,d,v,u;function p(t,e){h(t,e);e.add(t)}function b(t,e,a){h(t,e);e.set(t,a)}function h(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(t,e,a){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return a}var g=new WeakMap;var m=new WeakMap;var w=new WeakMap;var H=new WeakMap;var E=new WeakSet;var C=new WeakSet;var T=new WeakSet;var F=new WeakSet;var P=new WeakSet;var S=new WeakSet;var N=new WeakSet;var L=new WeakSet;var _=new WeakSet;var k=new WeakSet;var G=function(){function t(e){babelHelpers.classCallCheck(this,t);p(this,k);p(this,_);p(this,L);p(this,N);p(this,S);p(this,P);p(this,F);p(this,T);p(this,C);p(this,E);b(this,g,{writable:true,value:void 0});b(this,m,{writable:true,value:void 0});b(this,w,{writable:true,value:void 0});b(this,H,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,m,e);f(this,E,y).call(this)}babelHelpers.createClass(t,[{key:"onClickSave",value:function t(){var a=i.ButtonManager.createFromNode(document.querySelector("#connection-button-save"));a.setWaiting(true);var n=f(this,_,X).call(this);if(babelHelpers.classPrivateFieldGet(this,m).sourceFields.id){n.id=babelHelpers.classPrivateFieldGet(this,m).sourceFields.id}f(this,k,O).call(this).then((function(){return e.ajax.runAction("biconnector.externalsource.source.save",{data:{data:n}})})).then((function(t){BX.SidePanel.Instance.postMessage(window,"BIConnector:ExternalConnection:onConnectionCreated",{connection:t.data.connection});BX.SidePanel.Instance.getTopSlider().close()}))["catch"]((function(t){var e;a.setWaiting(false);if(((e=t.errors)===null||e===void 0?void 0:e.length)>0){BX.UI.Notification.Center.notify({content:t.errors[0].message})}else{console.error(t)}BX.SidePanel.Instance.postMessage(window,"BIConnector:ExternalConnection:onConnectionCreationError")}))}}]);return t}();function y(){babelHelpers.classPrivateFieldSet(this,g,document.querySelector("#connection-form"));f(this,C,I).call(this);var t=e.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="fields-wrapper"></div>\n\t\t'])));e.Dom.append(t,babelHelpers.classPrivateFieldGet(this,g));f(this,T,x).call(this);var a=e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="db-connection-button-block">\n\t\t\t\t<div class="db-connection-button"></div>\n\t\t\t\t<div class="db-connection-status"></div>\n\t\t\t</div>\n\t\t'])));e.Dom.append(a,babelHelpers.classPrivateFieldGet(this,g));f(this,P,B).call(this);f(this,S,W).call(this)}function I(){var t=e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="db-connection-hint">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),e.Loc.getMessage("EXTERNAL_CONNECTION_HINT",{"[link]":'<a class="ui-link" onclick="top.BX.Helper.show(`redirect=detail&code=23508958`)">',"[/link]":"</a>"}));e.Dom.append(t,babelHelpers.classPrivateFieldGet(this,g))}function x(){var t,a,i,n=this;var l=babelHelpers.classPrivateFieldGet(this,g).querySelector(".fields-wrapper");var s=(t=babelHelpers.classPrivateFieldGet(this,m).sourceFields)!==null&&t!==void 0?t:{};var v=e.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="form-fields">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" data-code="type"></select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\tplaceholder="','" \n\t\t\t\t\t\t\t\tdata-code="title"\n\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e.Loc.getMessage("EXTERNAL_CONNECTION_FIELD_TYPE"),e.Loc.getMessage("EXTERNAL_CONNECTION_FIELD_NAME"),e.Loc.getMessage("EXTERNAL_CONNECTION_FIELD_NAME_PLACEHOLDER"),(a=s.title)!==null&&a!==void 0?a:"");e.Dom.append(v,l);var u=l.querySelector('[data-code="type"]');babelHelpers.classPrivateFieldGet(this,m).supportedDatabases.forEach((function(t){e.Dom.append(e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option \n\t\t\t\t\t\tvalue="','" \n\t\t\t\t\t\t',"\n\t\t\t\t\t>\n\t\t\t\t\t\t","\n\t\t\t\t\t</option>\n\t\t\t\t"])),t.code,s.type===t.code?"selected":"",t.name),u)}));e.Event.bind(u,"input",f(this,F,D).bind(this));if(s.id){var p=e.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input hidden value="','" data-code="id">\n\t\t\t'])),s.id);e.Dom.append(p,v);e.Dom.attr(u,"disabled",true)}var b=babelHelpers.classPrivateFieldGet(this,m).fieldsConfig;var h=(i=s.type)!==null&&i!==void 0?i:babelHelpers.classPrivateFieldGet(this,m).supportedDatabases[0].code;b[h].forEach((function(t){var a;var i=t.type;if(t.code==="password"){i="password"}var l=e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype="','" \n\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\tdata-code="','"\n\t\t\t\t\t\t\t\tplaceholder="','" \n\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),t.name,i,t.code,t.placeholder,(a=s[t.code])!==null&&a!==void 0?a:"");e.Dom.append(l,v);e.Event.bind(l,"input",(function(){return f(n,N,A).call(n)}))}))}function D(t){babelHelpers.classPrivateFieldGet(this,m).sourceFields.type=t.target.value;e.Dom.clean(babelHelpers.classPrivateFieldGet(this,g).querySelector(".fields-wrapper"));f(this,T,x).call(this);f(this,N,A).call(this)}function B(){var t=this;var a=new i.Button({text:e.Loc.getMessage("EXTERNAL_CONNECTION_CHECK_BUTTON"),color:i.ButtonColor.PRIMARY,onclick:function e(a,i){i.preventDefault();f(t,k,O).call(t)["catch"]((function(){}))},noCaps:true});a.renderTo(babelHelpers.classPrivateFieldGet(this,g).querySelector(".db-connection-button"));babelHelpers.classPrivateFieldSet(this,w,a)}function W(){babelHelpers.classPrivateFieldSet(this,H,babelHelpers.classPrivateFieldGet(this,g).querySelector(".db-connection-status"))}function A(){e.Dom.clean(babelHelpers.classPrivateFieldGet(this,H))}function M(t,a){e.Dom.clean(babelHelpers.classPrivateFieldGet(this,H));var i=null;if(t){i=e.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="db-connection-success">\n\t\t\t\t\t<div class="ui-icon-set --check" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: var(--ui-color-palette-green-50);"></div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),e.Loc.getMessage("EXTERNAL_CONNECTION_CHECK_SUCCESS"))}else{i=e.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="db-connection-error">\n\t\t\t\t\t<div class="ui-icon-set --warning" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: var(--ui-color-palette-red-60);"></div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),a.replaceAll(/\s+/g," "))}e.Dom.append(i,babelHelpers.classPrivateFieldGet(this,H))}function X(){var t={};babelHelpers.classPrivateFieldGet(this,g).querySelectorAll("[data-code]").forEach((function(e){t[e.getAttribute("data-code")]=e.value}));return t}function O(){var t=this;babelHelpers.classPrivateFieldGet(this,w).setState(i.ButtonState.WAITING);return new Promise((function(a,i){e.ajax.runComponentAction("bitrix:biconnector.externalconnection","checkConnection",{mode:"class",signedParameters:babelHelpers.classPrivateFieldGet(t,m).signedParameters,data:{data:f(t,_,X).call(t)}}).then((function(e){f(t,L,M).call(t,true);babelHelpers.classPrivateFieldGet(t,w).setState(null);a(e)}))["catch"]((function(e){f(t,L,M).call(t,false,e.errors[0].message);babelHelpers.classPrivateFieldGet(t,w).setState(null);i()}))}))}e.Reflection.namespace("BX.BIConnector").ExternalConnectionForm=G})(this.window=this.window||{},BX,BX.Event,BX.UI);
//# sourceMappingURL=script.map.js