(function(){BX.namespace("BX.Timeman.Component.Worktime");BX.Timeman.Component.Worktime.Grid=function(t){this.isSlider=t.isSlider;BX.ajax.UpdatePageData=function(){};this.flexibleScheduleTypeName=t.flexibleScheduleTypeName;this.gridId=t.gridId;this.todayPositionedLeft=t.todayPositionedLeft===true;this.filterId=t.filterId;this.useIndividualViolationRulesName="useIndividualViolationRules";this.showStatsColumnsName="showStatsColumns";this.showStartEndTimeName="showStartEndTime";this.useEmployeesTimezoneName="useEmployeesTimezone";t.container=this.container=document.querySelector(this.isSlider?"body":"#content-table");BX.Timeman.Component.BaseComponent.apply(this,arguments);this.todayWord=t.todayWord;this.shiftedScheduleType=t.shiftedScheduleType;this.gridConfigOptions=t.gridConfigOptions;this.gridConfigBtn=this.selectOneByRole("worktime-grid-config-btn");this.shiftPlansBtn=this.selectOneByRole("shift-plans-btn");this.canManageSettings=t.canManageSettings;this.isShiftplan=t.isShiftplan;this.baseDepartmentId=t.baseDepartmentId!==undefined?parseInt(t.baseDepartmentId):-1;this.todayLink=this.selectOneByRole("tm-navigation-today");this.canReadSchedules=t.canReadSchedules;this.canUpdateSchedules=t.canUpdateSchedules;this.canDeleteSchedules=t.canDeleteSchedules;this.highlightDepartmentRows();this.schedules={};this.settingsData=undefined;if(!this.isViolationsToggleEnabled()&&(t.defaultViolationShowIndividual===true||t.defaultViolationShowIndividual===false)){this.setCookie(this.useIndividualViolationRulesName,t.defaultViolationShowIndividual?"Y":"N")}this.scrollToToday();this.addEventHandlers();this.applyGridConfigOptions()};BX.Timeman.Component.Worktime.Grid.prototype={__proto__:BX.Timeman.Component.BaseComponent.prototype,constructor:BX.Timeman.Component.Worktime.Grid,addEventHandlersInsideGrid:function(){var t=this.selectAllByRole("navigation-period");for(var e=0;e<t.length;e++){BX.bind(t[e],"click",BX.delegate(this.onNavigationArrowClick,this))}var i=this.selectAllByRole("timeman-settings-toggle");for(var e=0;e<i.length;e++){BX.bind(i[e],"click",BX.delegate(this.onTimemanSettingsToggleClick,this))}BX.bind(this.selectOneByRole("dates-calendar-toggle"),"click",BX.delegate(this.onNavigationCalendarToggleClick,this));var n=this.selectAllByRole("worktime-record-cell");for(var e=0;e<n.length;e++){BX.bind(n[e],"click",BX.delegate(this.onRecordCellClick,this))}},addEventHandlers:function(){BX.bind(this.todayLink,"click",BX.delegate(this.onTodayLinkClick,this));BX.bind(this.gridConfigBtn,"click",BX.delegate(this.onGridConfigBtnClick,this));BX.bind(this.shiftPlansBtn,"click",BX.delegate(this.onShiftPlansClick,this));this.onGridUpdated();BX.addCustomEvent("BX.Main.Filter:apply",this.onApplyFilter.bind(this));BX.addCustomEvent("Grid::updated",this.onGridUpdated.bind(this));if(this.getEventContainer()){BX.bind(this.getEventContainer(),"TimemanWorktimeGridCellHtmlRedraw",BX.delegate(this.onCellHtmlRedraw,this));BX.bind(this.getEventContainer(),"TimemanWorktimeGridCellHtmlUpdated",BX.delegate(this.onCellHtmlUpdated,this))}BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(t){if(t.getEventId()==="BX.Timeman.Record.Approve::Success"){var e=t.getData()["record"];var i=new CustomEvent("TimemanWorktimeGridCellHtmlRedraw",{detail:{html:e.dayCellsHtml}});this.getEventContainer().dispatchEvent(i)}else if(t.getEventId()==="BX.Timeman.Schedule.Update::Success"){var n=t.getData()["schedule"];if(n){for(var s=0;s<this.gridConfigOptions.schedules.length;s++){if(parseInt(this.gridConfigOptions.schedules[s].id)===parseInt(n.id)){this.gridConfigOptions.schedules[s]=this.buildScheduleItem(n)}}this.updateShiftPlansBtnVisibility()}}else if(t.getEventId()==="BX.Timeman.Schedule.Add::Success"){var n=t.getData()["schedule"];if(n){var a=this.buildScheduleItem(n);this.gridConfigOptions.schedules.push(a);this.updateShiftPlansBtnVisibility()}}}.bind(this)))},buildScheduleItem:function(t){return{id:t.id,name:t.name,link:t.links.update,canReadShiftPlan:t.canReadShiftPlan,shiftplanLink:t.links.shiftPlan,scheduleType:t.scheduleType}},updateShiftPlansBtnVisibility:function(){if(this.countShiftedSchedulesWithAccessToShiftPlan()){this.showElement(this.shiftPlansBtn)}else{this.hideElement(this.shiftPlansBtn)}},getEventContainer:function(){return document.querySelector('[data-role="shift-records-container"]')},onCellHtmlRedraw:function(t){if(t.detail.html===undefined||t.detail.html.length===undefined||t.detail.html.length<=0){return}var e=[];for(var i=0;i<t.detail.html.length;i++){var n=t.detail.html[i];if(!n){continue}var s=document.createElement("div");s.innerHTML=n;var a=false;if(s.dataset&&s.dataset.dayCellKey){a=s.dataset.dayCellKey}else{var o=s.querySelector('[data-shift-block="true"]');if(o&&o.dataset&&o.dataset.dayCellKey){a=o.dataset.dayCellKey}}if(!a){continue}var l=document.querySelectorAll(".js-"+a);for(var r=0;r<l.length;r++){var d=l[r].querySelector(".main-grid-cell-content");if(!d){continue}var h=d.querySelectorAll('[data-shift-block="true"]');for(var u=0;u<h.length;u++){h[u].remove()}var c=document.createElement("div");c.innerHTML=n;d.appendChild(c);e.push(c)}}var g=new CustomEvent("TimemanWorktimeGridCellHtmlUpdated",{detail:{dayCellNodes:e}});document.querySelector('[data-role="shift-records-container"]').dispatchEvent(g)},onCellHtmlUpdated:function(t){this.initHints();this.applyGridConfigOptions();this.addEventHandlersInsideGrid()},countShiftedSchedulesWithAccessToShiftPlan:function(){var t=0;for(var e=0;e<this.gridConfigOptions.schedules.length;e++){var i=this.gridConfigOptions.schedules[e];if(this.isShiftedSchedule(i)&&i.canReadShiftPlan===true){t++}}return t},countShiftedSchedules:function(){var t=0;for(var e=0;e<this.gridConfigOptions.schedules.length;e++){var i=this.gridConfigOptions.schedules[e];if(this.isShiftedSchedule(i)){t++}}return t},onShiftPlansClick:function(t){var e=this.countShiftedSchedules();if(e===0){return}var i="tmWorktimeShiftedSchedulesPopup"+e;if(!this.shiftPlansPopup||this.shiftPlansPopup.id!==i){var n=[];for(var s=0;s<this.gridConfigOptions.schedules.length;s++){var a=this.gridConfigOptions.schedules[s];if(!this.isShiftedSchedule(a)||a.canReadShiftPlan===false){continue}n.push({text:BX.util.htmlspecialchars(a.name),id:BX.util.htmlspecialchars(a.id),href:a.shiftplanLink,onclick:function(){if(this.shiftPlansPopup){this.shiftPlansPopup.close()}}.bind(this)})}this.shiftPlansPopup=new BX.PopupMenuWindow({id:i,bindElement:t.currentTarget,items:n})}this.shiftPlansPopup.show()},isShiftedSchedule:function(t){return t.scheduleType===this.shiftedScheduleType},onGridConfigBtnClick:function(t){this.gridConfigPopup=this.buildGridConfigPopup(t);this.gridConfigPopup.show()},buildGridConfigPopup:function(t){var e=this.buildGridConfigPopupItems();if(e.length>0){return BX.PopupMenu.create({items:e,id:"tmWorktimeGridOptionsSettings"+BX.util.getRandomString(20),bindElement:t.currentTarget,offsetLeft:-60,angle:false,closeByEsc:true,autoHide:true})}return null},buildGridConfigPopupItems:function(){var t=[];if(this.gridConfigOptions.showStatsItem){t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_TITLE_STATS")),id:"showStats",className:(this.showStatsColumns()?"menu-popup-item-take":"menu-popup-no-icon")+" js-id-showStats",onclick:function(){this.setCookie(this.showStatsColumnsName,this.showStatsColumns()?"N":"Y");this.closeGridConfigPopup();this.reloadGrid()}.bind(this)})}if(this.gridConfigOptions.showStartEndItem){t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_TITLE_START_END")),id:"showStartEnd",className:(this.showStartEndTime()?"menu-popup-item-take":"menu-popup-no-icon")+" js-id-showStartEnd",onclick:function(){this.setCookie(this.showStartEndTimeName,this.showStartEndTime()?"N":"Y");this.closeGridConfigPopup();this.applyGridConfigOptions()}.bind(this)})}if(this.isViolationsToggleEnabled()){var e=this.useIndividualViolationRules()?"menu-popup-item-take":"menu-popup-no-icon";var i=this.useIndividualViolationRules()?"menu-popup-no-icon":"menu-popup-item-take";t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_VIOLATIONS_MENU_TITLE")),id:"violations",items:[{text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_VIOLATIONS_MENU_TITLE_PERSONAL")),id:"violationsIndividual",className:e+" js-id-violationsIndividual",onclick:function(){this.setCookie(this.useIndividualViolationRulesName,"Y");this.closeGridConfigPopup();this.applyGridConfigOptions()}.bind(this)},{text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_VIOLATIONS_MENU_TITLE_COMMON")),id:"violationsCommon",className:i+" js-id-violationsCommon",onclick:function(){this.setCookie(this.useIndividualViolationRulesName,"N");this.closeGridConfigPopup();this.applyGridConfigOptions()}.bind(this)}]})}if(this.isTimezoneToggleEnabled()){var n=this.useEmployeesTimezone()?"menu-popup-no-icon":"menu-popup-item-take";var s=this.useEmployeesTimezone()?"menu-popup-item-take":"menu-popup-no-icon";t.push({id:"timezoneToggle",text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_TIMEZONE_TOGGLE_TITLE")),items:[{id:"timezoneUseMine",className:n+" js-id-timezoneUseMine",text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_TIMEZONE_MINE")),onclick:function(){this.closeGridConfigPopup();this.setCookie(this.useEmployeesTimezoneName,"N");this.reloadGrid()}.bind(this)},{id:"timezoneUseEmployees",className:s+" js-id-timezoneUseEmployees",text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_TIMEZONE_EMPLOYEES")),onclick:function(){this.closeGridConfigPopup();this.setCookie(this.useEmployeesTimezoneName,"Y");this.reloadGrid()}.bind(this)}]})}if(this.gridConfigOptions.showSchedulesItem&&this.gridConfigOptions.schedules.length>0){if(this.gridConfigOptions.schedules.length===1&&this.canUpdateSchedules&&this.isShiftplan){t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_TITLE_SCHEDULE_EDIT")),id:"editSchedule",className:"menu-popup-no-icon js-id-editSchedule",onclick:this.closeGridConfigPopup.bind(this),href:this.gridConfigOptions.schedules[0].link})}else if(this.canReadSchedules){var a=[];for(var o=0;o<this.gridConfigOptions.schedules.length;o++){a.push(this.createScheduleMenuItem(this.gridConfigOptions.schedules[o]))}t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_TITLE_SCHEDULES")),id:"editSchedules",className:"menu-popup-no-icon js-id-editSchedules",items:a})}}if(this.exportManager){t.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_TITLE_EXPORT_EXCEL")),id:"showExportExcel",className:"menu-popup-no-icon js-id-editSchedules",onclick:function(){this.exportManager.startExport(this.exportManager.getExcelExportType());this.closeGridConfigPopup()}.bind(this)})}return t},closeGridConfigPopup:function(){if(this.gridConfigPopup){this.gridConfigPopup.close()}},onRecordCellClick:function(t){if(t.currentTarget.dataset&&t.currentTarget.dataset.href){var e=t.currentTarget.dataset.href;BX.SidePanel.Instance.open(e,{width:800,cacheable:false,allowChangeHistory:false,requestMethod:"post",requestParams:{extraInfo:JSON.stringify({useEmployeesTimezone:this.useEmployeesTimezone(),isShiftplan:this.isShiftplan})}})}},useEmployeesTimezone:function(){return this.getCookie(this.useEmployeesTimezoneName)==="Y"},isTimezoneToggleEnabled:function(){var t=this.selectOneByRole("timezone-toggle-enabled",document);return t&&t.value==="Y"},isViolationsToggleEnabled:function(){var t=this.selectOneByRole("violations-toggle-enabled",document);return t&&t.value==="Y"},createScheduleMenuItem:function(t){var e=[];var i=t.id.toString();if(this.canUpdateSchedules){e.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_ACTION_EDIT")),onclick:this.closeGridConfigPopup.bind(this),href:t.link})}if(this.canDeleteSchedules){e.push({text:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_CONFIG_MENU_ACTION_DELETE")),onclick:function(t){this.closeGridConfigPopup();this.onDeleteScheduleClick(t)}.bind(this,t)})}var n={text:BX.util.htmlspecialchars(t.name),id:BX.util.htmlspecialchars(i),onclick:this.closeGridConfigPopup.bind(this),href:t.link};if(e.length>0){n.items=e}return n},onDeleteScheduleClick:function(t){this.deleteSchedulePopup=new BX.PopupWindow({id:"tm-menu-confirm-delete-schedule-"+BX.util.htmlspecialchars(t.id),autoHide:true,draggable:true,closeByEsc:true,titleBar:BX.message("TM_WORKTIME_GRID_SCHEDULE_DELETE_CONFIRM_TITLE"),content:BX.util.htmlspecialchars(BX.message("TM_WORKTIME_GRID_SCHEDULE_DELETE_CONFIRM").replace("#SCHEDULE_NAME#",t.name)),buttons:[new BX.UI.Button({text:BX.message("TM_WORKTIME_GRID_SCHEDULE_DELETE_CONFIRM_NO"),className:"ui-btn ui-btn-danger",events:{click:function(){this.deleteSchedulePopup.close()}.bind(this)}}),new BX.UI.Button({text:BX.message("TM_WORKTIME_GRID_SCHEDULE_DELETE_CONFIRM_YES"),className:"ui-btn ui-btn-success",events:{click:function(t){this.deleteSchedulePopup.close();BX.ajax.runAction("timeman.schedule.delete",{data:{id:t.id}}).then(function(t){for(var e=0;e<this.gridConfigOptions.schedules.length;e++){if(this.gridConfigOptions.schedules[e].id.toString()===t.id.toString()){this.gridConfigOptions.schedules.splice(e,1);break}}this.updateShiftPlansBtnVisibility()}.bind(this,t),function(t){}.bind(this))}.bind(this,t)}})]});this.deleteSchedulePopup.show()},showStatsColumns:function(){return this.getCookie(this.showStatsColumnsName)==="Y"},showStartEndTime:function(){return this.getCookie(this.showStartEndTimeName)==="Y"},applyGridConfigOptions:function(){var t=this.buildGridConfigPopupItems();this.hideElement(this.gridConfigBtn);if(t.length>0){this.showElement(this.gridConfigBtn)}this.updateShiftPlansBtnVisibility();if(this.gridConfigOptions.showStartEndItem){var e=this.selectAllByRole("start-end");for(var i=0;i<e.length;i++){if(this.showStartEndTime()){this.showElement(e[i])}else{this.hideElement(e[i])}}}var n=this.selectAllByRole("violation-icon");for(var i=0;i<n.length;i++){if(n[i].dataset.type==="common"&&!this.useIndividualViolationRules()||n[i].dataset.type==="individual"&&this.useIndividualViolationRules()){this.showElement(n[i])}else{this.hideElement(n[i])}}var s=this.selectAllByRole("violation-percentage-stat");for(var a=0;a<s.length;a++){if(this.useIndividualViolationRules()&&s[a].dataset.type==="individual"||!this.useIndividualViolationRules()&&s[a].dataset.type==="common"){this.showElement(s[a])}else{this.hideElement(s[a])}}},useIndividualViolationRules:function(){return this.getCookie(this.useIndividualViolationRulesName)==="Y"},onNavigationCalendarToggleClick:function(t){BX.calendar({node:t.currentTarget,field:this.selectOneByRole("month-navigation"),bTime:false,bHideTime:true,callback:function(t){var e=new Date(t.getFullYear(),t.getMonth(),1);var i=new Date(t.getFullYear(),t.getMonth()+1,0);e=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),e);i=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),i);var n=this.selectOneByRole("navigation-period").href.replace(new RegExp("REPORT_PERIOD_from"+"=[^&]*(&*)","gi"),"REPORT_PERIOD_from="+e+"$1");n=n.replace(new RegExp("REPORT_PERIOD_to"+"=[^&]*(&*)","gi"),"REPORT_PERIOD_to="+i+"$1");this.applyFilterFromUrlData({href:n,dataset:{startTo:i,startFrom:e,startDatesel:"RANGE"}})}.bind(this)})},onApplyFilter:function(t,e,i,n,s){if(t!==this.filterId){return}this.initHints();this.highlightDepartmentRows()},onNavigationArrowClick:function(t){t.preventDefault();t.stopPropagation();this.applyFilterFromUrlData(t.currentTarget)},setCurrentSettingsData:function(t){this.settingsData=t},getCurrentSettingsData:function(){return this.settingsData},getCurrentUsersIds:function(){var t={};var e=this.selectAllByRole("timeman-settings-toggle");for(var i=0;i<e.length;i++){var n=e[i].dataset;if(n.type==="user"){t[n.id]=true}}return Object.keys(t)},getCurrentDepartmentsIds:function(){var t={};var e=this.selectAllByRole("timeman-settings-toggle");for(var i=0;i<e.length;i++){var n=e[i].dataset;if(n.type==="department"){t[n.id]=true}}return Object.keys(t)},onTimemanSettingsToggleClick:function(t){if(this.settingsLoading===true){return}if(this.getCurrentSettingsData()===undefined){this.settingsLoading=true;var e={DEPARTMENTS:this.getCurrentDepartmentsIds(),USERS:this.getCurrentUsersIds()};BX.timeman_query("admin_data_settings",e,function(t,e){this.setCurrentSettingsData(e);this.settingsLoading=false;this.onTimemanSettingsToggleClick(t)}.bind(this,t));return}var i=this.buildEntityCode(t.target.dataset);if(this.schedules[i]===undefined){this.settingsLoading=true;BX.ajax.runAction("timeman.schedule.getSchedulesForEntity",{data:{entityCode:i}}).then(function(t,e){this.schedules[e.data.entityCode]=e.data.schedules;this.settingsLoading=false;this.onTimemanSettingsToggleClick(t)}.bind(this,t),function(t,e){this.settingsLoading=false}.bind(this,t));return}if(this.timemanSettingsMenu){this.timemanSettingsMenu.close();this.timemanSettingsMenu.destroy()}var n=[];if(this.canManageSettings){n=[new BX.PopupWindowCustomButton({text:BX.message("JS_CORE_WINDOW_SAVE"),className:"ui-btn ui-btn-primary",events:{click:function(t){var e=this.getSettingsOption(t.type,t.id,"UF_TIMEMAN");var i=this.timemanSettingsMenu.getContentContainer().querySelector('[name="UF_TIMEMAN"]').value;var n=this.getSettingsOption(t.type,t.id,"UF_TM_REPORT_REQ");var s=this.timemanSettingsMenu.getContentContainer().querySelector('[name="UF_TM_REPORT_REQ"]').value;if(e===i&&n===s){this.timemanSettingsMenu.close();return}var a={ID:t.id,source:t.type,UF_TIMEMAN:i,UF_TM_REPORT_REQ:s};BX.timeman_query("admin_data_settings",a,function(t,e){if(t.type==="user"){for(var i=0;i<this.getCurrentSettingsData().USERS.length;i++){if(this.getCurrentSettingsData().USERS[i].ID===e.ID){var n=this.getCurrentSettingsData();n.USERS[i]=e;this.setCurrentSettingsData(n);break}}}else if(t.type==="department"){for(var i=0;i<this.getCurrentSettingsData().DEPARTMENTS.length;i++){if(this.getCurrentSettingsData().DEPARTMENTS[i].ID===e.ID){var n=this.getCurrentSettingsData();n.DEPARTMENTS[i]=e;this.setCurrentSettingsData(n);break}}}this.timemanSettingsMenu.close()}.bind(this,t))}.bind(this,t.target.dataset)}}),new BX.PopupWindowCustomButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"ui-btn ui-btn-link",events:{click:function(){if(this.timemanSettingsMenu){this.timemanSettingsMenu.close()}}.bind(this)}})]}this.timemanSettingsMenu=new BX.PopupWindow("tm-setting_form_"+t.target.dataset.id+t.target.dataset.type,t.target,{width:320,closeIcon:{right:"12px",top:"10px"},autoHide:true,content:BX("tm-settings-popup-menu").innerHTML,events:{onPopupShow:function(t){var e=this.timemanSettingsMenu.getContentContainer().querySelector('[name="UF_TM_REPORT_REQ"]');var i=this.timemanSettingsMenu.getContentContainer().querySelector('[name="UF_TIMEMAN"]');this.showElement(i.querySelector('option[value=""]'));this.showElement(e.querySelector('option[value=""]'));var n=t.type==="department"&&this.baseDepartmentId&&this.baseDepartmentId===parseInt(t.id);this.selectOptionBySettings("UF_TIMEMAN",t,n);this.selectOptionBySettings("UF_TM_REPORT_REQ",t,n);BX.bind(i,"change",BX.proxy(this.onSettingOptionChange,this));BX.bind(this.selectOneByRole("schedules-list-toggle",this.timemanSettingsMenu.getContentContainer()),"click",this.showSchedulesListMenu.bind(this,t));if(n){this.hideElement(i.querySelector('option[value=""]'));this.hideElement(e.querySelector('option[value=""]'))}var s=this.schedules[this.buildEntityCode(t)];var a=this.selectOneByRole("schedule-personal-violations",this.timemanSettingsMenu.getContentContainer());var o=this.selectOneByRole("tm-settings-day-report",this.timemanSettingsMenu.getContentContainer());this.hideElement(a);this.showElement(o);if(s.length>0){for(var l=0;l<s.length;l++){if(!this.isFlexibleSchedule(s[l].SCHEDULE_TYPE)){this.showElement(a);break}}}}.bind(this,t.target.dataset)},buttons:n});this.timemanSettingsMenu.show()},selectOptionBySettings:function(t,e,i){var n=this.getSettingsOption(e.type,e.id,t,i);var s=this.timemanSettingsMenu.getContentContainer().querySelector('[name="'+t+'"]');var a=s.querySelector('option[value="'+n+'"]');if(a){a.selected=true;if(t==="UF_TIMEMAN"){this.showViolationMenuBlock(n)}}},onSettingOptionChange:function(t){this.showViolationMenuBlock(t.currentTarget.value)},showSchedulesListMenu:function(t,e){var i=[];var n=this.schedules[this.buildEntityCode(t)];if(n===undefined||this.settingsLoading===true){return}for(var s=0;s<n.length;s++){if(this.isFlexibleSchedule(n[s].SCHEDULE_TYPE)){continue}var a={text:BX.message("TIMEMAN_GRID_MENU_SCHEDULE_PERSONAL_VIOLATIONS_PREFIX")+' "'+BX.util.htmlspecialchars(n[s].NAME)+'"',dataset:{url:n[s].LINKS.DETAIL,entityCode:this.buildEntityCode(t)}};a.onclick=function(t,e){if(this.canReadSchedules){var i=BX.util.add_url_param(e.dataset.url,{IFRAME:"Y",VIOLATIONS_ONLY:"Y",ENTITY_CODE:e.dataset.entityCode});BX.SidePanel.Instance.open(i,{width:1400,cacheable:false})}e.menuWindow.close()}.bind(this);i.push(a)}var o=BX.PopupMenu.create({items:i,maxHeight:450,id:"tmSettingsScheduleViolations"+this.buildEntityCode(t)+BX.util.getRandomString(20),bindElement:e?e.currentTarget?e.currentTarget:e.target:null,angle:{position:"top"},closeByEsc:true,autoHide:true});o.show()},showViolationMenuBlock:function(t){var e=this.selectOneByRole("schedule-personal-violations",this.timemanSettingsMenu.getContentContainer());if(t==="N"){this.hideElement(e)}else{this.showElement(e)}},isFlexibleSchedule:function(t){return t===this.flexibleScheduleTypeName},getSettingsOption:function(t,e,i,n){var s=[];if(t==="user"){s=this.getCurrentSettingsData().USERS}else if(t==="department"){s=this.getCurrentSettingsData().DEPARTMENTS}for(var a=0;a<s.length;a++){if(s[a].ID==e){var o=[];o.push(s[a].SETTINGS[i]);if(n){o.push(this.getCurrentSettingsData().DEFAULTS[i])}for(var l=0;l<o.length;l++){if(o[l]===true||o[l]==="Y"){return"Y"}if(o[l]===false||o[l]==="N"){return"N"}if(o[l]!==""){return o[l]}}return""}}},buildEntityCode:function(t){return t.entityCode},applyFilterFromUrlData:function(t){if(!this.filterId){window.location.href=t.href;return}var e=t.dataset;var i=BX.Main.filterManager.getById(this.filterId);var n={};if(e.startFrom){n.REPORT_PERIOD_from=e.startFrom}if(e.startTo){n.REPORT_PERIOD_to=e.startTo}if(e.startDatesel){n.REPORT_PERIOD_datesel=e.startDatesel}i.getApi().extendFilter(n,true)},onTodayLinkClick:function(t){t.preventDefault();t.stopPropagation();if(this.getTodayColumnHeader()){this.scrollToToday();return}if(!this.filterId){window.location.href=t.target.href;return}this.applyFilterFromUrlData(t.currentTarget)},getTodayColumnHeader:function(){return document.querySelector(".js-tm-header-today")},highlightDepartmentRows:function(){var t=document.querySelectorAll(".tm-department-name");for(var e=0;e<t.length;e++){if(t[e].closest("tr")){t[e].closest("tr").classList.add("tm-department-name-row")}}},reloadGrid:function(){BX.Main.gridManager.reload(this.gridId)},scrollToToday:function(){if(!this.getTodayColumnHeader()){return}if(!BX.Main.gridManager.getById(this.gridId)&&BX.Main.gridManager.getById(this.gridId).instance){return}if(!BX.Main.gridManager.getById(this.gridId).instance.getScrollContainer().scrollTo||typeof BX.Main.gridManager.getById(this.gridId).instance.getScrollContainer().scrollTo!=="function"){return}var t=BX.Main.gridManager.getById(this.gridId).instance.getScrollContainer().clientWidth;var e=document.querySelectorAll(".main-grid-cell-head");var i=0;var n=null;var s=0;var a=0;for(var o=0;o<e.length;o++){var l=e[o];if(l.classList.contains("js-tm-fixed-columns")&&l.classList.contains("main-grid-fixed-column")){s++;a+=l.offsetWidth}if(!l.classList.contains("js-tm-fixed-columns")&&i===0){i=l.offsetWidth}if(l===this.getTodayColumnHeader()&&n===null){n=o}}if(i<=0||n===null){return}t=t-a;var r=parseInt(t/i);var d=i*(n-s-r+3)-a;if(this.todayPositionedLeft){d=(n-2)*i-a}if(d>0){BX.Main.gridManager.getById(this.gridId).instance.getScrollContainer().scrollTo(d,0)}},onGridUpdated:function(){this.addEventHandlersInsideGrid();this.applyGridConfigOptions();this.initHints();this.highlightDepartmentRows();this.settingsData=undefined},initHints:function(){BX.UI.Hint.init(this.container)}}})();
//# sourceMappingURL=script.map.js