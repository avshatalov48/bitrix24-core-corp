{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {ajax, Loc, Reflection} from 'main.core';\nimport {EventEmitter} from 'main.core.events'\n\nclass SectionSelector\n{\n\tconstructor(settings = {})\n\t{\n\t\tthis.selectorId = settings.selectorId;\n\t\tthis.selectorHiddenId = settings.selectorHiddenId;\n\t\tthis.selectedItems = settings.selectedItems;\n\t\tthis.iblockId = settings.iblockId;\n\n\t\tthis.initSelector();\n\t}\n\n\tinitSelector()\n\t{\n\t\tif (!this.selector)\n\t\t{\n\t\t\tthis.selector = new BX.UI.EntitySelector.TagSelector({\n\t\t\t\tid: this.selectorId,\n\t\t\t\tmultiple: true,\n\t\t\t\tplaceholder: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_PLACEHOLDER'),\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 300,\n\t\t\t\t\tid: this.selectorId,\n\t\t\t\t\tcontext: 'catalog-sections',\n\t\t\t\t\tenableSearch: false,\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tselectedItems: this.selectedItems,\n\t\t\t\t\tsearchTabOptions: {\n\t\t\t\t\t\tstub: true,\n\t\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_IS_EMPTY_TITLE'),\n\t\t\t\t\t\t\tsubtitle: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_IS_EMPTY_SUBTITLE'),\n\t\t\t\t\t\t\tarrow: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: true\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.setSelectedInputs.bind(this, 'Item:onSelect'),\n\t\t\t\t\t\t'Item:onDeselect': this.setSelectedInputs.bind(this, 'Item:onDeselect'),\n\t\t\t\t\t\t'Search:onItemCreateAsync': this.addNewSection.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'section',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t'iblockId': this.iblockId\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t\tdynamicLoad: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.selector.renderTo(document.getElementById(this.selectorId));\n\t}\n\n\tsetSelectedInputs(eventName, event)\n\t{\n\t\tevent.target.hide();\n\n\t\tconst selectedSections = event.getData().item.getDialog().getSelectedItems();\n\t\tif (Array.isArray(selectedSections))\n\t\t{\n\t\t\tlet htmlInputs = '';\n\t\t\tconst selectedItemsId = [];\n\n\t\t\tselectedSections.forEach((section) => {\n\t\t\t\thtmlInputs += '<input type=\"hidden\" name=\"IBLOCK_SECTION[]\" value=\"' + section['id'] + '\" />';\n\t\t\t\tselectedItemsId.push(section['id']);\n\t\t\t});\n\n\t\t\tdocument.getElementById(this.selectorHiddenId).innerHTML = htmlInputs;\n\t\t\tEventEmitter.emit(eventName, selectedItemsId);\n\t\t}\n\t}\n\n\taddNewSection(event)\n\t{\n\t\treturn new Promise(function(resolve, reject) {\n\n\t\t\t/** @type  {BX.UI.EntitySelector.Item} */\n\t\t\tconst {searchQuery} = event.getData();\n\n\t\t\t/** @type  {BX.UI.EntitySelector.Dialog} */\n\t\t\tconst dialog = event.getTarget();\n\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t\t'addSection',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tiblockId: this.iblockId,\n\t\t\t\t\t\tname: searchQuery.getQuery()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(response => {\n\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\tid: response.data.id,\n\t\t\t\t\tentityId: 'tag',\n\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\ttabs: dialog.getRecentTab().getId()\n\t\t\t\t});\n\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\titem.select();\n\t\t\t\t}\n\t\t\t}).bind(this);\n\n\t\t\tresolve();\n\t\t}.bind(this));\n\t}\n}\n\nReflection.namespace('BX.Catalog').SectionSelector = SectionSelector;"],"names":["SectionSelector","settings","selectorId","selectorHiddenId","selectedItems","iblockId","initSelector","selector","BX","UI","EntitySelector","TagSelector","id","multiple","placeholder","Loc","getMessage","textBoxWidth","dialogOptions","height","context","enableSearch","dropdownMode","searchTabOptions","stub","stubOptions","title","subtitle","arrow","searchOptions","allowCreateItem","events","setSelectedInputs","bind","addNewSection","entities","options","dynamicSearch","dynamicLoad","renderTo","document","getElementById","eventName","event","target","hide","selectedSections","getData","item","getDialog","getSelectedItems","Array","isArray","htmlInputs","selectedItemsId","forEach","section","push","innerHTML","EventEmitter","emit","Promise","resolve","reject","searchQuery","dialog","getTarget","ajax","runComponentAction","mode","data","name","getQuery","then","response","addItem","entityId","tabs","getRecentTab","getId","select","Reflection","namespace"],"mappings":"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"}