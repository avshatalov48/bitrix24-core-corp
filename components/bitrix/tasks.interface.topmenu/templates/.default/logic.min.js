"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.sliderInit()},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",function(t){t.preventDefault();var e=t.target.className;var n=this.dataset.id=="view_all"?"":this.dataset.id;var s=this.dataset.url;if(e==="main-buttons-item-sublink "&&n===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[n,s]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")})}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){if(t==="user_counter"){this.onUserCounter(e)}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,n){this.onFilterApply(t,e,n)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var n=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this));var n=BX("tasks_panel_menu_view_scrum");if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.scrum_total_comments)}},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,n){try{var s=n.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var a=0;a<o.length;a++){BX.removeClass(o[a],"main-buttons-item-active")}if(typeof s!=="undefined"){if(!s){s="view_all"}BX.addClass(BX("tasks_panel_menu_"+s),"main-buttons-item-active");var r=BX.Tasks.Component.TasksToolbar.getInstance();if(r){r.rerender(s)}}}catch(t){}},sliderInit:function(){if(window===window.top){top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:["/tasks/config/permissions/"],loader:"default-loader",options:{cacheable:false,events:{onClose:function(){},onOpen:function(){var t=BX.Main.interfaceButtonsManager;for(var e in t.data){t.data[e].closeSubmenu()}}}}}]})}}}})}).call(this);
//# sourceMappingURL=logic.map.js