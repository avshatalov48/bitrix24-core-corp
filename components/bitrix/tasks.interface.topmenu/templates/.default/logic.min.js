"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.isScrumLimitExceeded=Boolean(this.option("isScrumLimitExceeded"));this.isTaskAccessPermissionsLimit=Boolean(this.option("isTaskAccessPermissionsLimit"))},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",(function(t){t.preventDefault();var e=t.target.className;var s=this.dataset.id=="view_all"?"":this.dataset.id;var n=this.dataset.url;if(e==="main-buttons-item-sublink "&&s===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[s,n]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")}))}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){switch(t){case"user_counter":this.onUserCounter(e);break;case"project_add":this.onProjectAdd(e);break;case"project_remove":this.onProjectRemove(e);break}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,s){this.onFilterApply(t,e,s)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var s=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this));var s=BX("tasks_panel_menu_view_scrum");if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.scrum_total_comments)}},createScrum:function(t,e){if(this.isScrumLimitExceeded){BX.UI.InfoHelper.show(e,{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"scrumList"}})}else{BX.SidePanel.Instance.open(t)}},showConfigPermissions:function(){if(this.isTaskAccessPermissionsLimit){BX.UI.InfoHelper.show("limit_task_access_permissions",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"topMenu"}})}else{BX.SidePanel.Instance.open("/tasks/config/permissions/",{cacheable:false,events:{onOpen:function(){var t=BX.Main.interfaceButtonsManager;for(var e in t.data){t.data[e].closeSubmenu()}}}})}},onProjectAdd:function(t){this.updateScrumLimit()},onProjectRemove:function(t){this.updateScrumLimit()},updateScrumLimit(){var t=BX("tasks_panel_menu_view_scrum");if(!t){return}this.checkScrumLimit().then(function(t){this.isScrumLimitExceeded=Boolean(t)}.bind(this))},checkScrumLimit:function(){return BX.ajax.runAction("bitrix:tasks.scrum.info.checkScrumLimit",{data:{},signedParameters:this.signedParameters}).then((function(t){return t.data}))},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,s){try{var n=s.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var a=0;a<o.length;a++){BX.removeClass(o[a],"main-buttons-item-active")}if(typeof n!=="undefined"){if(!n){n="view_all"}BX.addClass(BX("tasks_panel_menu_"+n),"main-buttons-item-active");var r=BX.Tasks.Component.TasksToolbar.getInstance();if(r){r.rerender(n)}}}catch(t){}}}})}).call(this);
//# sourceMappingURL=logic.map.js