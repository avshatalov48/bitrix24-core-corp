(function(){"use strict";BX.namespace("BX.Timeman.Component.Schedule.ShiftEdit");BX.Timeman.Component.Schedule.ShiftEdit.Multiple=function(e){this.observersData=[];BX.Timeman.Component.Schedule.ShiftEdit.apply(this,arguments);this.workdaysOptions=e.shiftWorkdaysOptions;this.customWorkdaysText=e.customWorkdaysText;this.shiftedScheduleTypeName=e.shiftedScheduleTypeName;this.uniqueIndex=e.uniqueIndex;this.options=e;this.isScheduleFixed=e.isScheduleFixed;if(e.visible){var t=this.container.querySelectorAll('[name*="ShiftFormTemplate"]');for(var i=0;i<t.length;i++){t[i].name=t[i].name.replace(/ShiftFormTemplate/i,"ShiftForm")}this.showElement(this.container)}if(this.uniqueIndex!==undefined){var t=this.container.querySelectorAll('[name*="ShiftForm"]');for(var i=0;i<t.length;i++){t[i].name=t[i].name.replace(/\[[0-9]+\]/i,"["+this.uniqueIndex+"]")}var s=this.selectOneByRole("shift-id");if(s){s.value=""}}this.workdaysToggle=this.selectOneByRole("timeman-schedule-workdays-toggle");this.workdaysInput=this.selectOneByRole("timeman-schedule-shift-workdays-input");this.workDaysSelector=this.selectOneByRole("timeman-schedule-shift-workdays-selector");this.pencil=this.selectOneByRole("timeman-schedule-shift-pencil-name");this.nameInput=this.selectOneByRole("timeman-schedule-shift-name-input");this.workdaysBlocks=this.selectAllByRole("timeman-schedule-shift-work-days");this.nameBlock=this.selectOneByRole("timeman-schedule-shift-name-input-block");this.workDaysBlock=this.selectOneByRole("timeman-schedule-shift-workdays-block");this.nameSpan=this.selectOneByRole("timeman-schedule-shift-name-span");this.deleteSelfBtn=this.selectOneByRole("timeman-schedule-form-worktime-delete-btn");if(this.uniqueIndex!==undefined&&this.uniqueIndex>0){this.showElement(this.deleteSelfBtn);this.nameInput.value=e.defaultName;this.nameSpan.textContent=this.nameInput.value;if(e.prevShiftEnd){this.workTimeStartLink.textContent=e.prevShiftEnd;this.workTimeStartInput.value=this.workTimeStartLink.textContent}if(e.prevShiftStart){var n=this.calculateDurationSeconds(e.prevShiftEnd,e.prevShiftStart);this.workTimeEndLink.textContent=this.beautifyTime((this.convertFormattedTimeToSecs(e.prevShiftEnd)+n)%86400);this.workTimeEndInput.value=this.workTimeEndLink.textContent}for(var i=0;i<this.workdaysBlocks.length;i++){var h=this.workdaysBlocks[i].querySelector("input").id.replace(/-[0-9]-/,"-"+this.uniqueIndex+"-");this.workdaysBlocks[i].querySelector("input").id=h;this.workdaysBlocks[i].querySelector("label").htmlFor=h}if(e.isScheduleShifted){this.setBreakSeconds(0)}}this.initDurationWithoutBreak();this.addSelfEventHandlers()};BX.Timeman.Component.Schedule.ShiftEdit.Multiple.prototype={__proto__:BX.Timeman.Component.Schedule.ShiftEdit.prototype,constructor:BX.Timeman.Component.Schedule.ShiftEdit.Multiple,addSelfEventHandlers:function(){BX.bind(this.workdaysToggle,"click",BX.delegate(this.showWorkdaysOptionsPopup,this));BX.bind(this.pencil,"click",BX.delegate(this.startNameEdit,this));BX.bind(this.nameInput,"blur",this.endNameEdit.bind(this));BX.bind(this.deleteSelfBtn,"click",BX.delegate(this.onDeleteSelfBtnClick,this))},processBeforeCollectFormData:function(){if(this.workdaysToggle.innerText!==this.customWorkdaysText){return}var e=this.selectAllByRole("timeman-schedule-shift-work-day-item");var t=[];for(var i=0;i<e.length;i++){if(e[i].checked){t.push(e[i].value)}}t=t.sort();this.workdaysInput.value=t.join("")},getFormattedDeltaTime:function(e,t){return this.beautifyTimeLocal(this.calculateDurationSeconds(e,t))},onScheduleTypeSelected:function(e){this.isScheduleFixed=e===this.options.fixedScheduleTypeName;this.hideElement(this.workDaysSelector);if(this.isScheduleFixed){this.showWorkdaysBySelectedValue(this.workdaysToggle.textContent)}if(e===this.shiftedScheduleTypeName){this.showElement(this.nameBlock);this.endNameEdit();this.hideElement(this.workDaysBlock)}else{this.hideElement(this.nameBlock);this.showElement(this.workDaysBlock)}},endNameEdit:function(e){this.nameSpan.textContent=this.nameInput.value;this.hideElement(this.nameInput);this.showElement(this.nameSpan);this.showElement(this.pencil)},startNameEdit:function(e){this.showElement(this.nameInput);this.hideElement(this.nameSpan);this.hideElement(this.pencil);this.nameInput.focus()},attachOnDeleteEvent:function(e){this.observersData.push({eventType:"onDelete",observer:e})},onDeleteSelfBtnClick:function(e){if(document.querySelectorAll('[data-role^="timeman-schedule-shift-form-container"]').length>1){for(var t=0;t<this.observersData.length;t++){if(this.observersData[t].eventType==="onDelete"){this.observersData[t].observer.updateOnShiftEvent({eventType:"onDelete",shift:this})}}this.container.remove()}},buildWorkdaysPopup:function(){var e=[];for(var t=0;t<this.workdaysOptions.length;t++){var i=this.workdaysOptions[t];e.push({text:BX.util.htmlspecialchars(i.title),dataset:{title:i.title,value:i.id},onclick:function(e,t){this.showWorkdaysBySelectedValue(t.dataset.title);this.workdaysInput.value=BX.util.htmlspecialchars(t.dataset.value);this.workdaysToggle.textContent=t.dataset.title;this.workdaysPopup.close()}.bind(this)})}return BX.PopupMenu.create("timeman-shift-workdays-"+Math.random(),this.workdaysToggle,e,{autoHide:true})},showWorkdaysBySelectedValue:function(e){this.hideElement(this.workDaysSelector);if(e===this.options.customWorkdaysText&&this.isScheduleFixed){this.showElement(this.workDaysSelector)}},showWorkdaysOptionsPopup:function(e){if(!this.workdaysPopup){this.workdaysPopup=this.buildWorkdaysPopup()}this.workdaysPopup.show()}}})();
//# sourceMappingURL=shift-multiple.map.js