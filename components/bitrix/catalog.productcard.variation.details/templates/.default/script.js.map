{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Event, Loc, Reflection} from 'main.core';\nimport {EntityCard} from 'catalog.entity-card';\nimport {type BaseEvent, EventEmitter} from 'main.core.events';\nimport {Popup} from \"main.popup\";\nimport {Button} from \"ui.buttons\";\n\nclass VariationCard extends EntityCard\n{\n\t#isQuantityTraceNoticeShown = false;\n\n\tconstructor(id, settings = {})\n\t{\n\t\tsuper(id, settings);\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', () => this.postSliderMessage('onUpdate', {}));\n\t}\n\n\tgetEntityType()\n\t{\n\t\treturn 'Variation';\n\t}\n\n\tonSectionLayout(event: BaseEvent)\n\t{\n\t\tconst [section, eventData] = event.getCompatData();\n\n\t\tif (eventData.id === 'catalog_parameters')\n\t\t{\n\t\t\teventData.visible = this.isCardSettingEnabled('CATALOG_PARAMETERS');\n\t\t}\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorList:onItemSelect', (event) => {\n\t\t\tconst isQuantityTraceRestricted = !(this.isWithOrdersMode && !this.isInventoryManagementUsed);\n\t\t\tif (this.#isQuantityTraceNoticeShown || !isQuantityTraceRestricted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst field = event.getData()[1]?.field;\n\t\t\tif (!field)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (field.getId() !== 'QUANTITY_TRACE' || field._selectedValue !== 'N')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst popup = new Popup({\n\t\t\t\tcontent: Loc.getMessage('CPVD_QUANTITY_TRACE_NOTICE'),\n\t\t\t\toverlay: true,\n\t\t\t\ttitleBar: Loc.getMessage('CPVD_QUANTITY_TRACE_NOTICE_TITLE'),\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage('CPVD_QUANTITY_TRACE_ACCEPT'),\n\t\t\t\t\t\tclassName: 'ui-btn ui-btn-md ui-btn-primary',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: (function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#isQuantityTraceNoticeShown = false;\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t}).bind(this),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterClose: (function () {\n\t\t\t\t\t\tthis.#isQuantityTraceNoticeShown = false;\n\t\t\t\t\t}).bind(this),\n\t\t\t\t}\n\t\t\t});\n\t\t\tpopup.show();\n\n\t\t\tthis.#isQuantityTraceNoticeShown = true;\n\t\t});\n\n\t\tEventEmitter.subscribe('onEntityUpdate', (event) => {\n\t\t\tconst editor = event.getData()[0]?.sender;\n\t\t\tif (!editor)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst quantityTraceValue = editor._model.getField('QUANTITY_TRACE', 'D');\n\t\t\tconst isQuantityTraceRestricted = !(this.isWithOrdersMode && !this.isInventoryManagementUsed);\n\t\t\tif (quantityTraceValue !== 'N' && isQuantityTraceRestricted)\n\t\t\t{\n\t\t\t\teditor.getControlById('QUANTITY_TRACE')?.setVisible(false);\n\t\t\t}\n\t\t});\n\n\t\tsection?.getChildren().forEach((field) => {\n\t\t\tif (this.hiddenFields.includes(field?.getId()))\n\t\t\t{\n\t\t\t\tfield.setVisible(false);\n\t\t\t}\n\t\t});\n\t}\n}\n\nReflection.namespace('BX.Catalog').VariationCard = VariationCard;"],"names":["VariationCard","id","settings","EventEmitter","subscribe","postSliderMessage","event","getCompatData","section","eventData","visible","isCardSettingEnabled","isQuantityTraceRestricted","isWithOrdersMode","isInventoryManagementUsed","field","getData","getId","_selectedValue","popup","Popup","content","Loc","getMessage","overlay","titleBar","closeByEsc","closeIcon","buttons","Button","text","className","events","click","destroy","bind","onAfterClose","show","editor","sender","quantityTraceValue","_model","getField","getControlById","setVisible","getChildren","forEach","hiddenFields","includes","EntityCard","Reflection","namespace"],"mappings":"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"}