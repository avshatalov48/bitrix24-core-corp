{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Tag, Reflection, Dom, Text, Type, Event, ajax as Ajax } from 'main.core';\nimport { UI } from 'ui.notification';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { SidePanel } from 'main.sidepanel';\nimport 'ui.alerts';\n\ntype Props = {\n\tgridId: ?string,\n};\n\nclass SupersetDashboardTagGridManager\n{\n\t#grid: BX.Main.grid;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n\n\t#buildTitleEditor(\n\t\tid: number,\n\t\ttitle: string,\n\t\tonCancel: () => void,\n\t\tonSave: (innerTitle: string) => Promise,\n\t): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input class=\"main-grid-editor main-grid-editor-text\" type=\"text\">\n\t\t`;\n\t\tinput.value = title;\n\n\t\tconst saveInputValue = () => {\n\t\t\tconst value = input.value;\n\n\t\t\tDom.removeClass(input, 'tag-title-input-danger');\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_TITLE_ERROR_EMPTY'),\n\t\t\t\t});\n\n\t\t\t\tDom.addClass(input, 'tag-title-input-danger');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonSave(input.value)\n\t\t\t\t.then(() => {\n\t\t\t\t\tDom.style(buttons, 'display', 'none');\n\t\t\t\t\tDom.attr(input, 'disabled', true);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tDom.addClass(input, 'tag-title-input-danger');\n\t\t\t\t})\n\t\t\t;\n\t\t};\n\n\t\tEvent.bind(input, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tsaveInputValue();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (event.keyCode === 27)\n\t\t\t{\n\t\t\t\tonCancel();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst applyButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --check\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst cancelButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --cross-60\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst buttons = Tag.render`\n\t\t\t<div class=\"tag-title-wrapper__buttons\">\n\t\t\t\t${applyButton}\n\t\t\t\t${cancelButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(cancelButton, 'click', () => {\n\t\t\tonCancel();\n\t\t});\n\n\t\tEvent.bind(applyButton, 'click', saveInputValue);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"tag-title-wrapper__item tag-title-edit\">\n\t\t\t\t${input}\n\t\t\t\t<div class=\"tag-title-wrapper__buttons-wrapper\">\n\t\t\t\t\t${buttons}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTitlePreview(tagId: number): ?HTMLElement\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(tagId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.tag-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst previewSection = wrapper.querySelector('.tag-title-preview');\n\t\tif (previewSection)\n\t\t{\n\t\t\treturn previewSection;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenameTag(tagId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(tagId);\n\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst rowNode = row.getNode();\n\t\tDom.removeClass(rowNode, 'tag-title-edited');\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.tag-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.#buildTitleEditor(\n\t\t\ttagId,\n\t\t\trow.getEditData().TITLE,\n\t\t\t() => {\n\t\t\t\tthis.#cancelRename(tagId);\n\t\t\t},\n\t\t\t(innerTitle) => {\n\t\t\t\tconst oldTitle = this.#getTitlePreview(tagId).querySelector('span').innerText;\n\t\t\t\tthis.#getTitlePreview(tagId).querySelector('span').innerText = innerTitle;\n\n\t\t\t\tconst rowEditData = row.getEditData();\n\t\t\t\trowEditData.TITLE = innerTitle;\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (Type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[row.getId()] = rowEditData;\n\t\t\t\t}\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.#saveTitle(tagId, innerTitle)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tDom.addClass(rowNode, 'tag-title-edited');\n\t\t\t\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_RENAME_TITLE_SUCCESS', {\n\t\t\t\t\t\t\t\t'#NEW_TITLE#': Text.encode(innerTitle),\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: msg,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.#cancelRename(tagId);\n\n\t\t\t\t\t\t\tthis.#sendChangeEventMessage(tagId, innerTitle);\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#getTitlePreview(tagId).querySelector('span').innerText = oldTitle;\n\t\t\t\t\t\t\trowEditData.TITLE = oldTitle;\n\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\tconst preview = wrapper.querySelector('.tag-title-preview');\n\t\tif (preview)\n\t\t{\n\t\t\tDom.style(preview, 'display', 'none');\n\t\t}\n\t\tDom.append(editor, wrapper);\n\n\t\tconst editBtn = row.getCellById('EDIT_URL')?.querySelector('a');\n\n\t\tconst actionsClickHandler = () => {\n\t\t\tEvent.unbind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\t\tif (editBtn)\n\t\t\t{\n\t\t\t\tEvent.unbind(editBtn, 'click', actionsClickHandler);\n\t\t\t}\n\n\t\t\tthis.#cancelRename(tagId);\n\t\t};\n\n\t\tEvent.bind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\tif (editBtn)\n\t\t{\n\t\t\tEvent.bind(editBtn, 'click', actionsClickHandler);\n\t\t}\n\t}\n\n\tdeleteTag(tagId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(tagId);\n\t\tconst count = row.getEditData().DASHBOARD_COUNT;\n\t\tif (!count)\n\t\t{\n\t\t\tthis.#delete(tagId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst messageBox = MessageBox.confirm(\n\t\t\tLoc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_POPUP'),\n\t\t\t() => {\n\t\t\t\tthis.#delete(tagId);\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t\tLoc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_POPUP_YES'),\n\t\t);\n\t}\n\n\t#delete(tagId: number): Promise\n\t{\n\t\treturn Ajax.runAction('biconnector.dashboardTag.delete', {\n\t\t\tdata: {\n\t\t\t\tid: tagId,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getGrid().removeRow(tagId, null, null, () => {\n\t\t\t\t\tthis.#sendDeleteEventMessage(tagId);\n\t\t\t\t});\n\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_SUCCESS');\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: msg,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#sendChangeEventMessage(tagId: number, title: number): void\n\t{\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.postMessage(window, 'BIConnector.Superset.DashboardTagGrid:onTagChange', { tagId, title });\n\t\t}\n\t}\n\n\t#sendDeleteEventMessage(tagId: number): void\n\t{\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.postMessage(window, 'BIConnector.Superset.DashboardTagGrid:onTagDelete', { tagId });\n\t\t}\n\t}\n\n\t#cancelRename(tagId: number): void\n\t{\n\t\tconst row = this.getGrid().getRows().getById(tagId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editSection = row.getCellById('TITLE')?.querySelector('.tag-title-edit');\n\t\tconst previewSection = row.getCellById('TITLE')?.querySelector('.tag-title-preview');\n\n\t\tif (editSection)\n\t\t{\n\t\t\tDom.remove(editSection);\n\t\t}\n\n\t\tif (previewSection)\n\t\t{\n\t\t\tDom.style(previewSection, 'display', 'flex');\n\t\t}\n\t}\n\n\t#saveTitle(tagId: number, title: string): Promise\n\t{\n\t\treturn Ajax.runAction('biconnector.dashboardTag.rename', {\n\t\t\tdata: {\n\t\t\t\tid: tagId,\n\t\t\t\ttitle,\n\t\t\t},\n\t\t});\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardTagGridManager = SupersetDashboardTagGridManager;\n"],"names":["SupersetDashboardTagGridManager","props","BX","Main","gridManager","getById","gridId","instance","tagId","grid","getGrid","row","getRows","rowNode","getNode","Dom","removeClass","wrapper","getCellById","querySelector","editor","getEditData","TITLE","innerTitle","oldTitle","innerText","rowEditData","editableData","getParam","Type","isPlainObject","getId","Promise","resolve","reject","then","addClass","msg","Loc","getMessage","Text","encode","UI","Notification","Center","notify","content","response","errors","preview","style","append","editBtn","actionsClickHandler","Event","unbind","getActionsButton","bind","count","DASHBOARD_COUNT","messageBox","MessageBox","confirm","close","message","id","title","onCancel","onSave","input","Tag","render","value","saveInputValue","trim","buttons","attr","event","keyCode","preventDefault","applyButton","cancelButton","previewSection","Ajax","runAction","data","removeRow","SidePanel","Instance","postMessage","window","editSection","remove","Reflection","namespace"],"mappings":"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"}