BX.crmInvoicePaymentClient=function(){var e=function(e){this.nameValue=e.nameValue||"buyMoney";this.ajaxUrl=e.url+"?hash="+e.hash;this.hash=e.hash||{};this.returnUrl=e.returnUrl||"";this.wrapperId=e.wrapperId||"";this.templateBill=e.templateBill||"";this.templateFolder=e.templateFolder;this.accountNumber=e.accountNumber;this.pdfButton=document.getElementsByClassName("crm-invoice-payment-button-download")[0];this.wrapper=document.getElementById("crm-invoice-payment-client-wrapper");this.templateBlock=this.wrapper.getElementsByClassName("crm-invoice-payment-client-template")[0];this.paySystemsContainer=this.wrapper.getElementsByClassName("crm-invoice-payment-system-array")[0];this.paySystemsTemplate=this.wrapper.getElementsByClassName("crm-invoice-payment-system-template")[0];this.switcher=this.wrapper.getElementsByClassName("crm-invoice-payment-system-return-list")[0];this.frame=document.getElementById("crm-invoice-payment-template-frame");this.useFrame=e.useFrame==="Y";if(this.useFrame){var t=document.createElement("base");t.href=window.location.href;this.frame.contentDocument.open();this.frame.contentDocument.close();this.frame.contentDocument.head.appendChild(t);this.frame.contentDocument.body.innerHTML=this.templateBill;BX.html(this.frame.contentDocument.body,this.templateBill).then(BX.delegate(this.resizeForm,this));this.frame.contentDocument.body.style.overflow="hidden"}BX.ready(BX.proxy(this.init,this))};e.prototype.init=function(){var e=this.wrapper.getElementsByClassName("crm-invoice-payment-system-name");if(e[0]!==undefined){Array.prototype.forEach.call(e,function(e){if(e.innerText.length>28){e.innerHTML=e.innerText.substr(0,25)+"..."}})}BX.bindDelegate(this.paySystemsContainer,"click",{className:"crm-invoice-payment-system-image-block"},BX.proxy(function(e){var t=e.target.getElementsByTagName("input")[0];if(t===undefined){t=e.target.parentNode.getElementsByTagName("input")[0]}BX.ajax({method:"POST",dataType:"html",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),paySystemId:t.value,accountNumber:this.accountNumber,hash:this.hash,returnUrl:this.returnUrl},onsuccess:BX.proxy(function(e){this.paySystemsTemplate.innerHTML=e;this.paySystemsTemplate.style.display="block";this.switcher.style.display="block";this.paySystemsContainer.style.display="none"},this),onfailure:BX.proxy(function(){return this},this)},this);return this},this));if(this.useFrame){window.parent.setTimeout(BX.delegate(function(){this.resizeForm()},this),1e3)}BX.bind(this.pdfButton,"click",BX.proxy(function(e){var t=this.pdfButton.href;BX.ajax({method:"GET",url:t,onsuccess:function(e){if(e){jsUtils.Redirect(null,t)}else{window.location.href=""}}});e.preventDefault()},this));BX.bind(this.switcher,"click",BX.proxy(function(){this.paySystemsContainer.style.display="block";this.switcher.style.display="none";this.paySystemsTemplate.style.display="none";this.paySystemsTemplate.innerHTML=null},this));return this};e.prototype.resizeForm=function(){this.frame.height=this.frame.contentDocument.documentElement.scrollHeight;this.frame.width=this.frame.contentDocument.documentElement.scrollWidth;this.frame.contentDocument.body.style.margin=0;this.frame.contentDocument.body.style.padding=0};return e}();
//# sourceMappingURL=script.map.js