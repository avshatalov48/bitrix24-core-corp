{"version":3,"file":"script.js","sources":["src/helpers/analytics.js","src/components/card.js","src/components/tabs/common-tab.js","src/components/tabs/types-tab.js","src/components/main.js","src/store/validation.js","src/store/actions.js","src/store/mutations.js","src/store/index.js","src/app.js"],"sourcesContent":["import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\n\nexport function createSaveAnalyticsBuilder(store): Builder.Automation.AutomatedSolution.CreateEvent\n\t| Builder.Automation.AutomatedSolution.EditEvent\n{\n\tconst builder = store.getters.isNew\n\t\t? new Builder.Automation.AutomatedSolution.CreateEvent()\n\t\t: new Builder.Automation.AutomatedSolution.EditEvent()\n\t;\n\n\treturn builder\n\t\t.setId(store.state.automatedSolution.id)\n\t\t.setTypeIds(store.state.automatedSolution.typeIds)\n\t;\n}\n\nexport function wrapPromiseInAnalytics(promise: Promise, builder): Promise\n{\n\tsendAnalyticsData(\n\t\tbuilder\n\t\t\t.setStatus(Dictionary.STATUS_ATTEMPT)\n\t\t\t.buildData()\n\t\t,\n\t);\n\n\treturn promise\n\t\t.then((thenResult) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tbuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\treturn thenResult;\n\t\t})\n\t\t.catch((error) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tbuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_ERROR)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\tthrow error;\n\t\t})\n\t;\n}\n","import '../css/card.css';\n\nexport const Card = {\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisShown: true,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isShown\" class=\"crm-type-ui-card crm-type-ui-card-message\">\n\t\t\t<div class=\"crm-type-ui-card-header\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-icon crm-type-ui-card-message-icon--custom-fields\"></div>\n\t\t\t\t<div class=\"crm-type-ui-card-message-title\">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-type-ui-card-body\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-description\">{{ description }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"crm-type-ui-card-message-close-button\" \n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_CLOSE_TITLE')\"\n\t\t\t\t@click=\"isShown = false\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { Card } from '../card';\nimport '../../css/tabs/common-tab.css';\n\nexport const CommonTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\tcomputed: {\n\t\ttitle: {\n\t\t\tget(): ?string\n\t\t\t{\n\t\t\t\treturn this.$store.state.automatedSolution.title;\n\t\t\t},\n\t\t\tset(title: string): void\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('setTitle', title);\n\t\t\t},\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div data-tab=\"common\">\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_COMMON') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row crm-automated-solution-details-form-label-xs\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_TITLE') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_PLACEHOLDER_TITLE')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dictionary } from 'crm.integration.analytics';\nimport { Router } from 'crm.router';\nimport { type BaseEvent } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { TagSelector } from 'ui.entity-selector';\nimport { createSaveAnalyticsBuilder, wrapPromiseInAnalytics } from '../../helpers/analytics';\nimport { Card } from '../card';\n\nexport const TypesTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\t// tag selector should not be reactive (recreated on store mutations)\n\tboundTypesTagSelector: null,\n\texternalTypesTagSelector: null,\n\tcrmTypesTagSelector: null,\n\n\tcomputed: {\n\t\tisShowPermissionsResetAlert(): boolean\n\t\t{\n\t\t\tif (!this.$store.state.isPermissionsLayoutV2Enabled)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst currentTypeIds: number[] = [...this.$store.state.automatedSolution.typeIds];\n\t\t\tconst originallyTypeIds: number[] = [...this.$store.state.automatedSolutionOrigTypeIds];\n\n\t\t\treturn currentTypeIds.some((id) => !originallyTypeIds.includes(id))\n\t\t\t\t|| originallyTypeIds.some((id) => !currentTypeIds.includes(id))\n\t\t\t;\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.boundTypesTagSelector = new TagSelector({\n\t\t\tmultiple: true,\n\t\t\tshowAddButton: false,\n\t\t\tshowCreateButton: true,\n\t\t\t// all preselected items go to this selector\n\t\t\titems: this.$store.state.automatedSolution.typeIds.map(\n\t\t\t\t(typeId: number) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: typeId,\n\t\t\t\t\t\tentityId: 'dynamic_type',\n\t\t\t\t\t\ttitle: this.$store.state.dynamicTypesTitles[typeId],\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t),\n\t\t\tevents: {\n\t\t\t\tonCreateButtonClick: this.handleCreateTypeClick,\n\t\t\t\tonTagRemove: this.removeTypeIdByTagRemoveEvent,\n\t\t\t},\n\t\t});\n\t\tthis.boundTypesTagSelector.renderTo(this.$refs.boundTypesTagSelectorContainer);\n\n\t\t// these selectors contain types only if there were added here in the app lifetime by user interaction\n\t\t// selector states are not synced reactively in the app lifetime\n\t\tthis.crmTypesTagSelector = this.initFilteredTagSelector(true, false, !this.$store.state.permissions.canMoveSmartProcessFromCrm);\n\t\tthis.crmTypesTagSelector.renderTo(this.$refs.crmTypesTagSelectorContainer);\n\n\t\tthis.externalTypesTagSelector = this.initFilteredTagSelector(false, true, !this.$store.state.permissions.canMoveSmartProcessFromAnotherAutomatedSolution);\n\t\tthis.externalTypesTagSelector.renderTo(this.$refs.externalTypesTagSelectorContainer);\n\t},\n\n\tmethods: {\n\t\tinitFilteredTagSelector(\n\t\t\tisOnlyCrmTypes,\n\t\t\tisOnlyExternalTypes,\n\t\t\tlocked,\n\t\t): TagSelector\n\t\t{\n\t\t\tconst tagSlector = new TagSelector({\n\t\t\t\tmultiple: true,\n\t\t\t\taddButtonCaption: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\taddButtonCaptionMore: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 200,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tcontext: 'crm.automated_solutions.details',\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'dynamic_type',\n\t\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tshowAutomatedSolutionBadge: true,\n\t\t\t\t\t\t\t\tisOnlyExternalTypes,\n\t\t\t\t\t\t\t\tisOnlyCrmTypes,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: this.addTypeIdByTagAddEvent,\n\t\t\t\t\tonTagRemove: this.removeTypeIdIfNotContainsInBoundTypes,\n\t\t\t\t},\n\n\t\t\t});\n\t\t\tif (locked)\n\t\t\t{\n\t\t\t\ttagSlector.setLocked(true);\n\t\t\t}\n\n\t\t\treturn tagSlector;\n\t\t},\n\n\t\taddTypeIdByTagAddEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('addTypeId', tag.getId());\n\t\t},\n\n\t\tremoveTypeIdByTagRemoveEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('removeTypeId', tag.getId());\n\t\t},\n\n\t\tremoveTypeIdIfNotContainsInBoundTypes(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\t\t\tconst boundSelectedTags = this.boundTypesTagSelector.getTags();\n\t\t\tconst isTagContainsInBoundTags = boundSelectedTags.some((boundTag) => boundTag.getId() === tag.getId());\n\t\t\tif (!isTagContainsInBoundTags)\n\t\t\t{\n\t\t\t\tthis.removeTypeIdByTagRemoveEvent(event);\n\t\t\t}\n\t\t},\n\n\t\thandleCreateTypeClick(): void\n\t\t{\n\t\t\tif (this.$store.getters.isSaved)\n\t\t\t{\n\t\t\t\tthis.openTypeCreationSlider();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessageBox.confirm(\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_MESSAGE'),\n\t\t\t\t(messageBox) => {\n\t\t\t\t\treturn this.save()\n\t\t\t\t\t\t.then(() => this.openTypeCreationSlider())\n\t\t\t\t\t\t.finally(() => messageBox.close())\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_YES_CAPTION'),\n\t\t\t);\n\t\t},\n\n\t\topenTypeCreationSlider(): void\n\t\t{\n\t\t\tvoid Router.Instance.openTypeDetail(\n\t\t\t\t0,\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tautomatedSolutionId: this.$store.state.automatedSolution.id,\n\t\t\t\t\tactiveTabId: 'common',\n\t\t\t\t\tisExternal: 'Y',\n\t\t\t\t},\n\t\t\t).then(() => {\n\t\t\t\tthis.$Bitrix.Application.get().reloadWithNewUri(this.$store.state.automatedSolution.id, {\n\t\t\t\t\tactiveTabId: 'types',\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tsave(): Promise\n\t\t{\n\t\t\tconst builder = createSaveAnalyticsBuilder(this.$store)\n\t\t\t\t.setElement(Dictionary.ELEMENT_SAVE_IS_REQUIRED_TO_PROCEED_POPUP)\n\t\t\t;\n\n\t\t\treturn wrapPromiseInAnalytics(this.$store.dispatch('save'), builder);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_TYPES') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CREATE_TYPE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"boundTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CRM_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"crmTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_EXTERNAL_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"externalTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"isShowPermissionsResetAlert\" class=\"ui-alert ui-alert-warning\">\n\t\t\t\t<span class=\"ui-alert-message\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_PERMISSIONS_WILL_BE_RESET_ALERT') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { Dom, Type } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\nimport { createSaveAnalyticsBuilder, wrapPromiseInAnalytics } from '../helpers/analytics';\nimport type { Error } from '../store';\nimport { CommonTab } from './tabs/common-tab';\nimport { TypesTab } from './tabs/types-tab';\n\nimport '../css/main.css';\n\nexport const Main = {\n\tcomponents: {\n\t\tCommonTab,\n\t\tTypesTab,\n\t},\n\tprops: {\n\t\tinitialActiveTabId: String,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttabs: {\n\t\t\t\t// tab show flags\n\t\t\t\tcommon: this.initialActiveTabId === 'common',\n\t\t\t\ttypes: this.initialActiveTabId === 'types',\n\t\t\t},\n\n\t\t\tisCancelEventAlreadyRegistered: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tallTabIds(): string[]\n\t\t{\n\t\t\treturn Object.keys(this.tabs);\n\t\t},\n\t\tsaveButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-save');\n\t\t},\n\t\tcancelButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-cancel');\n\t\t},\n\t\tdeleteButton(): ?HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-remove');\n\t\t},\n\t\tallButtons(): HTMLElement[]\n\t\t{\n\t\t\tconst buttons = [this.saveButton, this.cancelButton];\n\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tbuttons.push(this.deleteButton);\n\t\t\t}\n\n\t\t\treturn buttons;\n\t\t},\n\t\tslider(): BX.SidePanel.Slider\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t},\n\n\t\terrors(): Error[]\n\t\t{\n\t\t\treturn this.$store.state.errors;\n\t\t},\n\n\t\thasErrors(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.errors);\n\t\t},\n\n\t\t// eslint-disable-next-line max-len\n\t\tanalyticsBuilder(): Builder.Automation.AutomatedSolution.CreateEvent | Builder.Automation.AutomatedSolution.EditEvent\n\t\t{\n\t\t\treturn createSaveAnalyticsBuilder(this.$store);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:close', this.onCloseByCancelButton);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onCloseByEsc', this.onCloseByEsc);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', this.onClose);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:close', this.onCloseByCancelButton);\n\t\tEventEmitter.unsubscribe('SidePanel.Slider:onCloseByEsc', this.onCloseByEsc);\n\t\tEventEmitter.unsubscribe('SidePanel.Slider:onClose', this.onClose);\n\t},\n\n\tmethods: {\n\t\tshowTabFromEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tabId } = event.getData();\n\n\t\t\tthis.showTab(tabId);\n\t\t},\n\n\t\tshowTab(tabId: string): void\n\t\t{\n\t\t\tif (!this.allTabIds.includes(tabId))\n\t\t\t{\n\t\t\t\tthrow new Error('invalid tab id');\n\t\t\t}\n\n\t\t\tfor (const id of this.allTabIds)\n\t\t\t{\n\t\t\t\tthis.tabs[id] = false;\n\t\t\t}\n\t\t\tthis.tabs[tabId] = true;\n\t\t},\n\n\t\tsave(): void\n\t\t{\n\t\t\tconst builder = this.analyticsBuilder\n\t\t\t\t.setElement(Dictionary.ELEMENT_CREATE_BUTTON)\n\t\t\t;\n\n\t\t\twrapPromiseInAnalytics(this.$store.dispatch('save'), builder)\n\t\t\t\t.then(() => {\n\t\t\t\t\t// don't register cancel event when this slider closes\n\t\t\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {}) // errors will be displayed reactively\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tdelete(): void\n\t\t{\n\t\t\tconst builder = (new Builder.Automation.AutomatedSolution.DeleteEvent())\n\t\t\t\t.setId(this.$store.state.automatedSolution.id)\n\t\t\t\t.setElement(Dictionary.ELEMENT_DELETE_BUTTON)\n\t\t\t;\n\n\t\t\t// don't register cancel event when this slider closes.\n\t\t\t// we set this flag here because for some reason slider starts to close before the promise is resolved\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\twrapPromiseInAnalytics(this.$store.dispatch('delete'), builder)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\t// errors will be displayed reactively\n\n\t\t\t\t\t// okay, may be the slider won't be closed after all since we've failed\n\t\t\t\t\tthis.isCancelEventAlreadyRegistered = false;\n\t\t\t\t})\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tonCloseByCancelButton(): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_CANCEL_BUTTON)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tonCloseByEsc(event: BaseEvent<BX.SidePanel.Event[]>): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sliderEvent] = event.getData();\n\n\t\t\tif (sliderEvent.getSlider() !== this.slider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_ESC_BUTTON)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tonClose(event: BaseEvent<BX.SidePanel.Event[]>): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sliderEvent] = event.getData();\n\n\t\t\tif (sliderEvent.getSlider() !== this.slider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(null)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tunlockButtons(): void\n\t\t{\n\t\t\tthis.allButtons.forEach((button: HTMLElement) => {\n\t\t\t\tDom.removeClass(button, 'ui-btn-wait');\n\t\t\t});\n\t\t},\n\n\t\thideError(error: Error): void\n\t\t{\n\t\t\tthis.$store.dispatch('removeError', error);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-automated-solution-details\">\n\t\t\t<form class=\"ui-form\">\n\t\t\t\t<div v-if=\"hasErrors\" class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t<template\n\t\t\t\t\t\tv-for=\"error in errors\"\n\t\t\t\t\t\t:key=\"error.message\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"ui-alert-message\">{{error.message}}</span>\n\t\t\t\t\t\t<span class=\"ui-alert-close-btn\" @click=\"hideError(error)\"></span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<CommonTab v-show=\"tabs.common\"/>\n\t\t\t\t<TypesTab v-show=\"tabs.types\"/>\n\t\t\t</form>\n\t\t</div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport type { Error } from './index';\n\nexport function normalizeId(id: any): ?number\n{\n\tif (Type.isNil(id))\n\t{\n\t\treturn null;\n\t}\n\n\treturn Text.toInteger(id);\n}\n\nexport function normalizeDynamicTypesTitles(titles: any): Object\n{\n\tif (!Type.isPlainObject(titles))\n\t{\n\t\treturn {};\n\t}\n\n\tconst result = {};\n\tfor (const [key, value] of Object.entries(titles))\n\t{\n\t\tif (Text.toInteger(key) > 0 && Type.isStringFilled(value))\n\t\t{\n\t\t\tresult[key] = value;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function normalizeTitle(title: any): ?string\n{\n\tif (Type.isNil(title))\n\t{\n\t\treturn null;\n\t}\n\n\treturn String(title);\n}\n\nexport function normalizeTypesIds(typeIds: any): number[]\n{\n\tif (!Type.isArrayFilled(typeIds))\n\t{\n\t\treturn [];\n\t}\n\n\treturn typeIds.map((x) => normalizeTypeId(x)).filter((x) => x > 0);\n}\n\nexport function normalizeTypeId(typeId: any): number\n{\n\treturn Text.toInteger(typeId);\n}\n\nexport function normalizeErrors(errors: any): Error[]\n{\n\tif (!Type.isArrayFilled(errors))\n\t{\n\t\treturn [];\n\t}\n\n\treturn errors.filter((x) => isValidError(x));\n}\n\nexport function isValidError(error: any): boolean\n{\n\treturn (\n\t\tType.isStringFilled(error.message)\n\t\t&& (\n\t\t\tType.isNil(error.code)\n\t\t\t|| Type.isStringFilled(error.code)\n\t\t\t|| Type.isInteger(error.code)\n\t\t)\n\t\t&& (\n\t\t\tType.isNil(error.customData)\n\t\t\t|| Type.isPlainObject(error.customData)\n\t\t)\n\t);\n}\n","import { ToolbarComponent } from 'crm.toolbar-component';\nimport { ajax as Ajax, Runtime, Type } from 'main.core';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { Error } from './index';\nimport { normalizeId, normalizeTitle } from './validation';\n\nexport default {\n\tsetState: (store, stateToSet: StateShape): void => {\n\t\tstore.commit('setState', stateToSet);\n\t},\n\n\tsetErrors: (store, errors: Error[]): void => {\n\t\tstore.commit('setErrors', errors);\n\t},\n\tremoveError: (store, error: Error): void => {\n\t\tstore.commit('removeError', error);\n\t},\n\n\tsetTitle: (store, title: string): void => {\n\t\tstore.commit('setTitle', title);\n\t},\n\n\taddTypeId: (store, typeId: number): void => {\n\t\tstore.commit('addTypeId', typeId);\n\t},\n\tremoveTypeId: (store, typeId: number): void => {\n\t\tstore.commit('removeTypeId', typeId);\n\t},\n\n\tsave: (store): Promise<void, string[]> => {\n\t\tlet savePromise: ?Promise = null;\n\n\t\tconst fields = Runtime.clone(store.state.automatedSolution);\n\t\tif (fields.typeIds.length <= 0)\n\t\t{\n\t\t\t// we cant send an empty array in form data\n\t\t\tfields.typeIds = false;\n\t\t}\n\n\t\tif (store.getters.isNew)\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.add', {\n\t\t\t\tdata: {\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.update', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn savePromise\n\t\t\t.then(({ data }) => {\n\t\t\t\tstore.dispatch('setState', {\n\t\t\t\t\tautomatedSolution: data.automatedSolution,\n\t\t\t\t});\n\t\t\t\temitUpdateEventToOutsideWorld(data.automatedSolution);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not save automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tconst { errors } = response;\n\n\t\t\t\tlet wasErrorHandled = false;\n\t\t\t\tfor (const error of errors)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(error.customData?.sliderCode))\n\t\t\t\t\t{\n\t\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ code: error.customData.sliderCode }).show();\n\t\t\t\t\t\twasErrorHandled = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!wasErrorHandled)\n\t\t\t\t{\n\t\t\t\t\t// to show errors in ui\n\t\t\t\t\tstore.dispatch('setErrors', errors);\n\t\t\t\t}\n\n\t\t\t\tthrow errors;\n\t\t\t})\n\t\t;\n\t},\n\n\tdelete: (store): Promise<void, string[]> => {\n\t\treturn runAjaxAction('crm.automatedsolution.delete', {\n\t\t\tdata: {\n\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tstore.dispatch('setState', {});\n\t\t\t\temitUpdateEventToOutsideWorld({ id: store.state.automatedSolution.id });\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not delete automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tstore.dispatch('setErrors', response.errors);\n\n\t\t\t\tthrow response.errors;\n\t\t\t})\n\t\t;\n\t},\n};\n\nfunction runAjaxAction(...ajaxRunActionArgs): Promise\n{\n\t// vuex don't understand BX.Promise. 'this.$store.dispatch.then' and 'subscribeAction({after})' won't work\n\t// wrap it in native Promise to fix it\n\n\treturn new Promise((resolve, reject) => {\n\t\tAjax.runAction(...ajaxRunActionArgs)\n\t\t\t.then(resolve)\n\t\t\t.catch(reject)\n\t\t;\n\t});\n}\n\nfunction emitUpdateEventToOutsideWorld({ id, title, intranetCustomSectionId }): void\n{\n\tconst data = {\n\t\tid: normalizeId(id),\n\t\ttitle: normalizeTitle(title),\n\t\tintranetCustomSectionId: normalizeId(intranetCustomSectionId),\n\t};\n\n\tToolbarComponent.Instance.emitAutomatedSolutionUpdatedEvent(data);\n}\n","/* eslint-disable no-param-reassign */\nimport { Text } from 'main.core';\nimport { Error } from './index';\nimport {\n\tisValidError,\n\tnormalizeDynamicTypesTitles,\n\tnormalizeErrors,\n\tnormalizeId,\n\tnormalizeTitle,\n\tnormalizeTypeId,\n\tnormalizeTypesIds,\n} from './validation';\nimport type { StateShape } from './index';\n\nexport default {\n\t/**\n\t * Sets new initial state for the store. Modification flag is reset\n\t */\n\tsetState: (state: StateShape, stateToSet: StateShape): void => {\n\t\tstate.automatedSolution.id = normalizeId(stateToSet.automatedSolution?.id);\n\n\t\tstate.automatedSolution.title = normalizeTitle(stateToSet.automatedSolution?.title);\n\n\t\tconst typeIds = normalizeTypesIds(stateToSet.automatedSolution?.typeIds);\n\t\tstate.automatedSolution.typeIds = [...typeIds];\n\t\tstate.automatedSolutionOrigTypeIds = [...typeIds];\n\n\t\tstate.permissions.canMoveSmartProcessFromCrm = Text.toBoolean(\n\t\t\tstateToSet.permissions?.canMoveSmartProcessFromCrm ?? false,\n\t\t);\n\t\tstate.permissions.canMoveSmartProcessFromAnotherAutomatedSolution = Text.toBoolean(\n\t\t\tstateToSet.permissions?.canMoveSmartProcessFromAnotherAutomatedSolution ?? false,\n\t\t);\n\n\t\tstate.dynamicTypesTitles = normalizeDynamicTypesTitles(stateToSet.dynamicTypesTitles);\n\n\t\tstate.errors = normalizeErrors(stateToSet.errors);\n\n\t\tstate.isModified = false;\n\t\tstate.isPermissionsLayoutV2Enabled = Text.toBoolean(\n\t\t\tstateToSet.isPermissionsLayoutV2Enabled ?? false,\n\t\t);\n\t},\n\n\tsetErrors: (state: StateShape, errors: Error[]): void => {\n\t\tstate.errors = normalizeErrors(errors);\n\t},\n\tremoveError: (state: StateShape, error: Error): void => {\n\t\tif (!isValidError(error))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.errors = state.errors.filter((x) => x !== error);\n\t},\n\n\tsetTitle: (state: StateShape, title: string): void => {\n\t\tconst newTitle = normalizeTitle(title);\n\n\t\tif (newTitle !== state.automatedSolution.title)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.title = newTitle;\n\t},\n\n\taddTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (state.automatedSolution.typeIds.includes(normalizedTypeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds.push(normalizedTypeId);\n\t\tstate.isModified = true;\n\t},\n\n\tremoveTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newTypeIds = state.automatedSolution.typeIds.filter((id) => id !== normalizedTypeId);\n\n\t\tif (newTypeIds.length !== state.automatedSolution.typeIds.length)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds = newTypeIds;\n\t},\n};\n","import actions from './actions';\nimport mutations from './mutations';\n\nexport type StateShape = {\n\tautomatedSolutionOrigTypeIds: number[],\n\tautomatedSolution: {\n\t\tid?: ?number,\n\t\ttitle?: ?string,\n\t\ttypeIds?: number[],\n\t},\n\n\tpermissions: {\n\t\tcanMoveSmartProcessFromCrm: boolean,\n\t\tcanMoveSmartProcessFromAnotherAutomatedSolution: boolean,\n\t},\n\n\tdynamicTypesTitles: {[key: number]: string},\n\n\terrors: Error[],\n\tisModified: boolean,\n\tisPermissionsLayoutV2Enabled: boolean,\n};\n\nexport type Error = {\n\tmessage: string,\n\tcode: string | number,\n\tcustomData: ?Object,\n};\n\nexport const store = {\n\tstrict: true,\n\tstate(): StateShape\n\t{\n\t\treturn {\n\t\t\tautomatedSolutionOrigTypeIds: [],\n\t\t\tautomatedSolution: {\n\t\t\t\tid: null,\n\t\t\t\ttitle: null,\n\t\t\t\ttypeIds: [],\n\t\t\t},\n\n\t\t\tpermissions: {\n\t\t\t\tcanMoveSmartProcessFromCrm: false,\n\t\t\t\tcanMoveSmartProcessFromAnotherAutomatedSolution: false,\n\t\t\t},\n\n\t\t\tdynamicTypesTitles: {},\n\n\t\t\terrors: [],\n\n\t\t\tisModified: false,\n\t\t\tisPermissionsLayoutV2Enabled: false,\n\t\t};\n\t},\n\tgetters: {\n\t\tisNew: (state: StateShape) => {\n\t\t\treturn state.automatedSolution.id <= 0;\n\t\t},\n\t\tisSaved: (state: StateShape, getters) => {\n\t\t\treturn !state.isModified && !getters.isNew;\n\t\t},\n\t},\n\tactions,\n\tmutations,\n};\n","import { Router } from 'crm.router';\nimport { Type } from 'main.core';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { createStore } from 'ui.vue3.vuex';\nimport { Main } from './components/main';\nimport { store } from './store/index';\n\nexport class App\n{\n\t#container: HTMLElement;\n\t#initialActiveTabId: string;\n\t#initialState: ?Object;\n\n\t#app: ?VueCreateAppResult = null;\n\n\tconstructor({ containerId, activeTabId, state })\n\t{\n\t\tthis.#container = document.getElementById(containerId);\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error('container not found');\n\t\t}\n\n\t\tthis.#initialActiveTabId = String(activeTabId);\n\n\t\tif (Type.isPlainObject(state))\n\t\t{\n\t\t\tthis.#initialState = state;\n\t\t}\n\t}\n\n\tstart(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst appWrapperRef = this;\n\n\t\tthis.#app = BitrixVue.createApp(\n\t\t\t{\n\t\t\t\t...Main,\n\t\t\t\tbeforeCreate(): void\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.Application.set(appWrapperRef);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tinitialActiveTabId: this.#initialActiveTabId,\n\t\t\t},\n\t\t);\n\n\t\tconst vuexStore = createStore(store);\n\t\tif (this.#initialState)\n\t\t{\n\t\t\tvuexStore.dispatch('setState', this.#initialState);\n\t\t}\n\n\t\tthis.#app.use(vuexStore);\n\n\t\tthis.#app.mount(this.#container);\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#app.unmount();\n\n\t\tthis.#app = null;\n\t}\n\n\treloadWithNewUri(automatedSolutionId: number, queryParams: Object = {}): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tconst uri = Router.Instance.getAutomatedSolutionDetailUrl(automatedSolutionId);\n\n\t\t\turi.setQueryParams({\n\t\t\t\t...queryParams,\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tIFRAME_TYPE: 'SIDE_SLIDER',\n\t\t\t});\n\n\t\t\twindow.location.href = uri.toString();\n\t\t});\n\t}\n\n\tcloseSliderOrRedirect(): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tRouter.Instance.closeSliderOrRedirect(\n\t\t\t\tRouter.Instance.getAutomatedSolutionListUrl(),\n\t\t\t\twindow,\n\t\t\t);\n\t\t});\n\t}\n}\n"],"names":["createSaveAnalyticsBuilder","store","builder","getters","isNew","Builder","Automation","AutomatedSolution","CreateEvent","EditEvent","setId","state","automatedSolution","id","setTypeIds","typeIds","wrapPromiseInAnalytics","promise","sendAnalyticsData","setStatus","Dictionary","STATUS_ATTEMPT","buildData","then","thenResult","STATUS_SUCCESS","error","STATUS_ERROR","Card","props","title","type","String","required","description","data","isShown","template","CommonTab","components","computed","get","$store","set","dispatch","TypesTab","boundTypesTagSelector","externalTypesTagSelector","crmTypesTagSelector","isShowPermissionsResetAlert","isPermissionsLayoutV2Enabled","currentTypeIds","originallyTypeIds","automatedSolutionOrigTypeIds","some","includes","mounted","TagSelector","multiple","showAddButton","showCreateButton","items","map","typeId","entityId","dynamicTypesTitles","events","onCreateButtonClick","handleCreateTypeClick","onTagRemove","removeTypeIdByTagRemoveEvent","renderTo","$refs","boundTypesTagSelectorContainer","initFilteredTagSelector","permissions","canMoveSmartProcessFromCrm","crmTypesTagSelectorContainer","canMoveSmartProcessFromAnotherAutomatedSolution","externalTypesTagSelectorContainer","methods","isOnlyCrmTypes","isOnlyExternalTypes","locked","tagSlector","addButtonCaption","$Bitrix","Loc","getMessage","addButtonCaptionMore","dialogOptions","height","enableSearch","context","dropdownMode","showAvatars","entities","dynamicLoad","dynamicSearch","options","showAutomatedSolutionBadge","onTagAdd","addTypeIdByTagAddEvent","removeTypeIdIfNotContainsInBoundTypes","setLocked","event","getData","tag","getId","boundSelectedTags","getTags","isTagContainsInBoundTags","boundTag","isSaved","openTypeCreationSlider","MessageBox","confirm","messageBox","save","close","Router","Instance","openTypeDetail","automatedSolutionId","activeTabId","isExternal","Application","reloadWithNewUri","setElement","ELEMENT_SAVE_IS_REQUIRED_TO_PROCEED_POPUP","Main","initialActiveTabId","tabs","common","types","isCancelEventAlreadyRegistered","allTabIds","Object","keys","saveButton","document","getElementById","cancelButton","deleteButton","allButtons","buttons","push","slider","BX","SidePanel","getSliderByWindow","window","errors","hasErrors","Type","isArrayFilled","analyticsBuilder","EventEmitter","subscribe","showTabFromEvent","onCloseByCancelButton","onCloseByEsc","onClose","beforeUnmount","unsubscribe","tabId","showTab","Error","ELEMENT_CREATE_BUTTON","closeSliderOrRedirect","unlockButtons","DeleteEvent","ELEMENT_DELETE_BUTTON","ELEMENT_CANCEL_BUTTON","STATUS_CANCEL","sliderEvent","getSlider","ELEMENT_ESC_BUTTON","forEach","button","Dom","removeClass","hideError","normalizeId","isNil","Text","toInteger","normalizeDynamicTypesTitles","titles","isPlainObject","result","entries","key","value","isStringFilled","normalizeTitle","normalizeTypesIds","x","normalizeTypeId","filter","normalizeErrors","isValidError","message","code","isInteger","customData","setState","stateToSet","commit","setErrors","removeError","setTitle","addTypeId","removeTypeId","savePromise","fields","Runtime","clone","length","runAjaxAction","emitUpdateEventToOutsideWorld","response","console","warn","wasErrorHandled","sliderCode","FeaturePromotersRegistry","getPromoter","show","ajaxRunActionArgs","Promise","resolve","reject","Ajax","runAction","intranetCustomSectionId","ToolbarComponent","emitAutomatedSolutionUpdatedEvent","toBoolean","isModified","newTitle","normalizedTypeId","newTypeIds","strict","actions","mutations","App","containerId","isDomNode","appWrapperRef","BitrixVue","createApp","beforeCreate","$bitrix","vuexStore","createStore","use","mount","unmount","queryParams","setTimeout","uri","getAutomatedSolutionDetailUrl","setQueryParams","IFRAME","IFRAME_TYPE","location","href","toString","getAutomatedSolutionListUrl"],"mappings":"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"}