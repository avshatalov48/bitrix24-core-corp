{"version":3,"file":"script.js","sources":["src/helpers/analytics.js","src/components/card.js","src/components/tabs/common-tab.js","src/components/tabs/types-tab.js","src/components/main.js","src/store/validation.js","src/store/actions.js","src/store/mutations.js","src/store/index.js","src/app.js"],"sourcesContent":["import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\n\nexport function createSaveAnalyticsBuilder(store): Builder.Automation.AutomatedSolution.CreateEvent\n\t| Builder.Automation.AutomatedSolution.EditEvent\n{\n\tconst builder = store.getters.isNew\n\t\t? new Builder.Automation.AutomatedSolution.CreateEvent()\n\t\t: new Builder.Automation.AutomatedSolution.EditEvent()\n\t;\n\n\treturn builder\n\t\t.setId(store.state.automatedSolution.id)\n\t\t.setTypeIds(store.state.automatedSolution.typeIds)\n\t;\n}\n\nexport function wrapPromiseInAnalytics(promise: Promise, builder): Promise\n{\n\tsendAnalyticsData(\n\t\tbuilder\n\t\t\t.setStatus(Dictionary.STATUS_ATTEMPT)\n\t\t\t.buildData()\n\t\t,\n\t);\n\n\treturn promise\n\t\t.then((thenResult) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tbuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\treturn thenResult;\n\t\t})\n\t\t.catch((error) => {\n\t\t\tsendAnalyticsData(\n\t\t\t\tbuilder\n\t\t\t\t\t.setStatus(Dictionary.STATUS_ERROR)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\n\t\t\tthrow error;\n\t\t})\n\t;\n}\n","import '../css/card.css';\n\nexport const Card = {\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisShown: true,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isShown\" class=\"crm-type-ui-card crm-type-ui-card-message\">\n\t\t\t<div class=\"crm-type-ui-card-header\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-icon crm-type-ui-card-message-icon--custom-fields\"></div>\n\t\t\t\t<div class=\"crm-type-ui-card-message-title\">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-type-ui-card-body\">\n\t\t\t\t<div class=\"crm-type-ui-card-message-description\">{{ description }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"crm-type-ui-card-message-close-button\" \n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_CLOSE_TITLE')\"\n\t\t\t\t@click=\"isShown = false\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { Card } from '../card';\nimport '../../css/tabs/common-tab.css';\n\nexport const CommonTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\tcomputed: {\n\t\ttitle: {\n\t\t\tget(): ?string\n\t\t\t{\n\t\t\t\treturn this.$store.state.automatedSolution.title;\n\t\t\t},\n\t\t\tset(title: string): void\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('setTitle', title);\n\t\t\t},\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div data-tab=\"common\">\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_COMMON') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_COMMON_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row crm-automated-solution-details-form-label-xs\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_TITLE') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_PLACEHOLDER_TITLE')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dictionary } from 'crm.integration.analytics';\nimport { Router } from 'crm.router';\nimport { type BaseEvent } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { TagSelector } from 'ui.entity-selector';\nimport { createSaveAnalyticsBuilder, wrapPromiseInAnalytics } from '../../helpers/analytics';\nimport { Card } from '../card';\n\nexport const TypesTab = {\n\tcomponents: {\n\t\tCard,\n\t},\n\t// tag selector should not be reactive (recreated on store mutations)\n\tboundTypesTagSelector: null,\n\texternalTypesTagSelector: null,\n\tcrmTypesTagSelector: null,\n\n\tmounted()\n\t{\n\t\tthis.boundTypesTagSelector = new TagSelector({\n\t\t\tmultiple: true,\n\t\t\tshowAddButton: false,\n\t\t\tshowCreateButton: true,\n\t\t\t// all preselected items go to this selector\n\t\t\titems: this.$store.state.automatedSolution.typeIds.map(\n\t\t\t\t(typeId: number) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: typeId,\n\t\t\t\t\t\tentityId: 'dynamic_type',\n\t\t\t\t\t\ttitle: this.$store.state.dynamicTypesTitles[typeId],\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t),\n\t\t\tevents: {\n\t\t\t\tonCreateButtonClick: this.handleCreateTypeClick,\n\t\t\t\tonTagRemove: this.removeTypeIdByTagRemoveEvent,\n\t\t\t},\n\t\t});\n\t\tthis.boundTypesTagSelector.renderTo(this.$refs.boundTypesTagSelectorContainer);\n\n\t\t// these selectors contain types only if there were added here in the app lifetime by user interaction\n\t\t// selector states are not synced reactively in the app lifetime\n\t\tthis.crmTypesTagSelector = this.initFilteredTagSelector(true, false);\n\t\tthis.crmTypesTagSelector.renderTo(this.$refs.crmTypesTagSelectorContainer);\n\n\t\tthis.externalTypesTagSelector = this.initFilteredTagSelector(false, true);\n\t\tthis.externalTypesTagSelector.renderTo(this.$refs.externalTypesTagSelectorContainer);\n\t},\n\n\tmethods: {\n\t\tinitFilteredTagSelector(\n\t\t\tisOnlyCrmTypes,\n\t\t\tisOnlyExternalTypes,\n\t\t): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tmultiple: true,\n\t\t\t\taddButtonCaption: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\taddButtonCaptionMore: this.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAG_SELECTOR_ADD_BUTTON_CAPTION'),\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 200,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tcontext: 'crm.automated_solutions.details',\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'dynamic_type',\n\t\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tshowAutomatedSolutionBadge: true,\n\t\t\t\t\t\t\t\tisOnlyExternalTypes,\n\t\t\t\t\t\t\t\tisOnlyCrmTypes,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: this.addTypeIdByTagAddEvent,\n\t\t\t\t\tonTagRemove: this.removeTypeIdByTagRemoveEvent,\n\t\t\t\t},\n\n\t\t\t});\n\t\t},\n\n\t\taddTypeIdByTagAddEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('addTypeId', tag.getId());\n\t\t},\n\n\t\tremoveTypeIdByTagRemoveEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tag } = event.getData();\n\n\t\t\tthis.$store.dispatch('removeTypeId', tag.getId());\n\t\t},\n\n\t\thandleCreateTypeClick(): void\n\t\t{\n\t\t\tif (this.$store.getters.isSaved)\n\t\t\t{\n\t\t\t\tthis.openTypeCreationSlider();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessageBox.confirm(\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_MESSAGE'),\n\t\t\t\t(messageBox) => {\n\t\t\t\t\treturn this.save()\n\t\t\t\t\t\t.then(() => this.openTypeCreationSlider())\n\t\t\t\t\t\t.finally(() => messageBox.close())\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_NEED_SAVE_POPUP_YES_CAPTION'),\n\t\t\t);\n\t\t},\n\n\t\topenTypeCreationSlider(): void\n\t\t{\n\t\t\tvoid Router.Instance.openTypeDetail(\n\t\t\t\t0,\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tautomatedSolutionId: this.$store.state.automatedSolution.id,\n\t\t\t\t\tactiveTabId: 'common',\n\t\t\t\t\tisExternal: 'Y',\n\t\t\t\t},\n\t\t\t).then(() => {\n\t\t\t\tthis.$Bitrix.Application.get().reloadWithNewUri(this.$store.state.automatedSolution.id, {\n\t\t\t\t\tactiveTabId: 'types',\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tsave(): Promise\n\t\t{\n\t\t\tconst builder = createSaveAnalyticsBuilder(this.$store)\n\t\t\t\t.setElement(Dictionary.ELEMENT_SAVE_IS_REQUIRED_TO_PROCEED_POPUP)\n\t\t\t;\n\n\t\t\treturn wrapPromiseInAnalytics(this.$store.dispatch('save'), builder);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"ui-title-3\">{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_TAB_TITLE_TYPES') }}</div>\n\t\t\t<Card\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_TITLE')\"\n\t\t\t\t:description=\"$Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_CARD_TYPES_DESCRIPTION')\"\n\t\t\t/>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CREATE_TYPE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"boundTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_CRM_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"crmTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_AUTOMATED_SOLUTION_DETAILS_FIELD_LABEL_EXTERNAL_TYPES') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div ref=\"externalTypesTagSelectorContainer\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { Dom, Type } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\nimport { createSaveAnalyticsBuilder, wrapPromiseInAnalytics } from '../helpers/analytics';\nimport type { Error } from '../store';\nimport { CommonTab } from './tabs/common-tab';\nimport { TypesTab } from './tabs/types-tab';\n\nimport '../css/main.css';\n\nexport const Main = {\n\tcomponents: {\n\t\tCommonTab,\n\t\tTypesTab,\n\t},\n\tprops: {\n\t\tinitialActiveTabId: String,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttabs: {\n\t\t\t\t// tab show flags\n\t\t\t\tcommon: this.initialActiveTabId === 'common',\n\t\t\t\ttypes: this.initialActiveTabId === 'types',\n\t\t\t},\n\n\t\t\tisCancelEventAlreadyRegistered: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tallTabIds(): string[]\n\t\t{\n\t\t\treturn Object.keys(this.tabs);\n\t\t},\n\t\tsaveButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-save');\n\t\t},\n\t\tcancelButton(): HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-cancel');\n\t\t},\n\t\tdeleteButton(): ?HTMLElement\n\t\t{\n\t\t\treturn document.getElementById('ui-button-panel-remove');\n\t\t},\n\t\tallButtons(): HTMLElement[]\n\t\t{\n\t\t\tconst buttons = [this.saveButton, this.cancelButton];\n\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tbuttons.push(this.deleteButton);\n\t\t\t}\n\n\t\t\treturn buttons;\n\t\t},\n\t\tslider(): BX.SidePanel.Slider\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t},\n\n\t\terrors(): Error[]\n\t\t{\n\t\t\treturn this.$store.state.errors;\n\t\t},\n\n\t\thasErrors(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.errors);\n\t\t},\n\n\t\t// eslint-disable-next-line max-len\n\t\tanalyticsBuilder(): Builder.Automation.AutomatedSolution.CreateEvent | Builder.Automation.AutomatedSolution.EditEvent\n\t\t{\n\t\t\treturn createSaveAnalyticsBuilder(this.$store);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t\tEventEmitter.subscribe('BX.Crm.AutomatedSolution.Details:close', this.onCloseByCancelButton);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onCloseByEsc', this.onCloseByEsc);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', this.onClose);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:showTab', this.showTabFromEvent);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:save', this.save);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:delete', this.delete);\n\t\tEventEmitter.unsubscribe('BX.Crm.AutomatedSolution.Details:close', this.onCloseByCancelButton);\n\t\tEventEmitter.unsubscribe('SidePanel.Slider:onCloseByEsc', this.onCloseByEsc);\n\t\tEventEmitter.unsubscribe('SidePanel.Slider:onClose', this.onClose);\n\t},\n\n\tmethods: {\n\t\tshowTabFromEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { tabId } = event.getData();\n\n\t\t\tthis.showTab(tabId);\n\t\t},\n\n\t\tshowTab(tabId: string): void\n\t\t{\n\t\t\tif (!this.allTabIds.includes(tabId))\n\t\t\t{\n\t\t\t\tthrow new Error('invalid tab id');\n\t\t\t}\n\n\t\t\tfor (const id of this.allTabIds)\n\t\t\t{\n\t\t\t\tthis.tabs[id] = false;\n\t\t\t}\n\t\t\tthis.tabs[tabId] = true;\n\t\t},\n\n\t\tsave(): void\n\t\t{\n\t\t\tconst builder = this.analyticsBuilder\n\t\t\t\t.setElement(Dictionary.ELEMENT_CREATE_BUTTON)\n\t\t\t;\n\n\t\t\twrapPromiseInAnalytics(this.$store.dispatch('save'), builder)\n\t\t\t\t.then(() => {\n\t\t\t\t\t// don't register cancel event when this slider closes\n\t\t\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {}) // errors will be displayed reactively\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tdelete(): void\n\t\t{\n\t\t\tconst builder = (new Builder.Automation.AutomatedSolution.DeleteEvent())\n\t\t\t\t.setId(this.$store.state.automatedSolution.id)\n\t\t\t\t.setElement(Dictionary.ELEMENT_DELETE_BUTTON)\n\t\t\t;\n\n\t\t\t// don't register cancel event when this slider closes.\n\t\t\t// we set this flag here because for some reason slider starts to close before the promise is resolved\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\twrapPromiseInAnalytics(this.$store.dispatch('delete'), builder)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$Bitrix.Application.get().closeSliderOrRedirect();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\t// errors will be displayed reactively\n\n\t\t\t\t\t// okay, may be the slider won't be closed after all since we've failed\n\t\t\t\t\tthis.isCancelEventAlreadyRegistered = false;\n\t\t\t\t})\n\t\t\t\t.finally(() => this.unlockButtons())\n\t\t\t;\n\t\t},\n\n\t\tonCloseByCancelButton(): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_CANCEL_BUTTON)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tonCloseByEsc(event: BaseEvent<BX.SidePanel.Event[]>): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sliderEvent] = event.getData();\n\n\t\t\tif (sliderEvent.getSlider() !== this.slider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_ESC_BUTTON)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tonClose(event: BaseEvent<BX.SidePanel.Event[]>): void\n\t\t{\n\t\t\tif (this.isCancelEventAlreadyRegistered)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sliderEvent] = event.getData();\n\n\t\t\tif (sliderEvent.getSlider() !== this.slider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCancelEventAlreadyRegistered = true;\n\n\t\t\tsendAnalyticsData(\n\t\t\t\tthis.analyticsBuilder\n\t\t\t\t\t.setElement(null)\n\t\t\t\t\t.setStatus(Dictionary.STATUS_CANCEL)\n\t\t\t\t\t.buildData()\n\t\t\t\t,\n\t\t\t);\n\t\t},\n\n\t\tunlockButtons(): void\n\t\t{\n\t\t\tthis.allButtons.forEach((button: HTMLElement) => {\n\t\t\t\tDom.removeClass(button, 'ui-btn-wait');\n\t\t\t});\n\t\t},\n\n\t\thideError(error: Error): void\n\t\t{\n\t\t\tthis.$store.dispatch('removeError', error);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-automated-solution-details\">\n\t\t\t<form class=\"ui-form\">\n\t\t\t\t<div v-if=\"hasErrors\" class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t<template\n\t\t\t\t\t\tv-for=\"error in errors\"\n\t\t\t\t\t\t:key=\"error.message\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"ui-alert-message\">{{error.message}}</span>\n\t\t\t\t\t\t<span class=\"ui-alert-close-btn\" @click=\"hideError(error)\"></span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<CommonTab v-show=\"tabs.common\"/>\n\t\t\t\t<TypesTab v-show=\"tabs.types\"/>\n\t\t\t</form>\n\t\t</div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport type { Error } from './index';\n\nexport function normalizeId(id: any): ?number\n{\n\tif (Type.isNil(id))\n\t{\n\t\treturn null;\n\t}\n\n\treturn Text.toInteger(id);\n}\n\nexport function normalizeDynamicTypesTitles(titles: any): Object\n{\n\tif (!Type.isPlainObject(titles))\n\t{\n\t\treturn {};\n\t}\n\n\tconst result = {};\n\tfor (const [key, value] of Object.entries(titles))\n\t{\n\t\tif (Text.toInteger(key) > 0 && Type.isStringFilled(value))\n\t\t{\n\t\t\tresult[key] = value;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function normalizeTitle(title: any): ?string\n{\n\tif (Type.isNil(title))\n\t{\n\t\treturn null;\n\t}\n\n\treturn String(title);\n}\n\nexport function normalizeTypesIds(typeIds: any): number[]\n{\n\tif (!Type.isArrayFilled(typeIds))\n\t{\n\t\treturn [];\n\t}\n\n\treturn typeIds.map((x) => normalizeTypeId(x)).filter((x) => x > 0);\n}\n\nexport function normalizeTypeId(typeId: any): number\n{\n\treturn Text.toInteger(typeId);\n}\n\nexport function normalizeErrors(errors: any): Error[]\n{\n\tif (!Type.isArrayFilled(errors))\n\t{\n\t\treturn [];\n\t}\n\n\treturn errors.filter((x) => isValidError(x));\n}\n\nexport function isValidError(error: any): boolean\n{\n\treturn (\n\t\tType.isStringFilled(error.message)\n\t\t&& (\n\t\t\tType.isNil(error.code)\n\t\t\t|| Type.isStringFilled(error.code)\n\t\t\t|| Type.isInteger(error.code)\n\t\t)\n\t\t&& (\n\t\t\tType.isNil(error.customData)\n\t\t\t|| Type.isPlainObject(error.customData)\n\t\t)\n\t);\n}\n","import { ToolbarComponent } from 'crm.toolbar-component';\nimport { ajax as Ajax, Runtime, Type } from 'main.core';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { Error } from './index';\nimport { normalizeId, normalizeTitle } from './validation';\n\nexport default {\n\tsetState: (store, stateToSet: StateShape): void => {\n\t\tstore.commit('setState', stateToSet);\n\t},\n\n\tsetErrors: (store, errors: Error[]): void => {\n\t\tstore.commit('setErrors', errors);\n\t},\n\tremoveError: (store, error: Error): void => {\n\t\tstore.commit('removeError', error);\n\t},\n\n\tsetTitle: (store, title: string): void => {\n\t\tstore.commit('setTitle', title);\n\t},\n\n\taddTypeId: (store, typeId: number): void => {\n\t\tstore.commit('addTypeId', typeId);\n\t},\n\tremoveTypeId: (store, typeId: number): void => {\n\t\tstore.commit('removeTypeId', typeId);\n\t},\n\n\tsave: (store): Promise<void, string[]> => {\n\t\tlet savePromise: ?Promise = null;\n\n\t\tconst fields = Runtime.clone(store.state.automatedSolution);\n\t\tif (fields.typeIds.length <= 0)\n\t\t{\n\t\t\t// we cant send an empty array in form data\n\t\t\tfields.typeIds = false;\n\t\t}\n\n\t\tif (store.getters.isNew)\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.add', {\n\t\t\t\tdata: {\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavePromise = runAjaxAction('crm.automatedsolution.update', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t\t\tfields,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn savePromise\n\t\t\t.then(({ data }) => {\n\t\t\t\tstore.dispatch('setState', {\n\t\t\t\t\tautomatedSolution: data.automatedSolution,\n\t\t\t\t});\n\t\t\t\temitUpdateEventToOutsideWorld(data.automatedSolution);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not save automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tconst { errors } = response;\n\n\t\t\t\tlet wasErrorHandled = false;\n\t\t\t\tfor (const error of errors)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(error.customData?.sliderCode))\n\t\t\t\t\t{\n\t\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ code: error.customData.sliderCode }).show();\n\t\t\t\t\t\twasErrorHandled = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!wasErrorHandled)\n\t\t\t\t{\n\t\t\t\t\t// to show errors in ui\n\t\t\t\t\tstore.dispatch('setErrors', errors);\n\t\t\t\t}\n\n\t\t\t\tthrow errors;\n\t\t\t})\n\t\t;\n\t},\n\n\tdelete: (store): Promise<void, string[]> => {\n\t\treturn runAjaxAction('crm.automatedsolution.delete', {\n\t\t\tdata: {\n\t\t\t\tid: store.state.automatedSolution.id,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tstore.dispatch('setState', {});\n\t\t\t\temitUpdateEventToOutsideWorld({ id: store.state.automatedSolution.id });\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn('could not delete automated solution', { response, state: Runtime.clone(store.state) });\n\n\t\t\t\tstore.dispatch('setErrors', response.errors);\n\n\t\t\t\tthrow response.errors;\n\t\t\t})\n\t\t;\n\t},\n};\n\nfunction runAjaxAction(...ajaxRunActionArgs): Promise\n{\n\t// vuex don't understand BX.Promise. 'this.$store.dispatch.then' and 'subscribeAction({after})' won't work\n\t// wrap it in native Promise to fix it\n\n\treturn new Promise((resolve, reject) => {\n\t\tAjax.runAction(...ajaxRunActionArgs)\n\t\t\t.then(resolve)\n\t\t\t.catch(reject)\n\t\t;\n\t});\n}\n\nfunction emitUpdateEventToOutsideWorld({ id, title, intranetCustomSectionId }): void\n{\n\tconst data = {\n\t\tid: normalizeId(id),\n\t\ttitle: normalizeTitle(title),\n\t\tintranetCustomSectionId: normalizeId(intranetCustomSectionId),\n\t};\n\n\tToolbarComponent.Instance.emitAutomatedSolutionUpdatedEvent(data);\n}\n","/* eslint-disable no-param-reassign */\nimport { Error } from './index';\nimport {\n\tisValidError,\n\tnormalizeDynamicTypesTitles,\n\tnormalizeErrors,\n\tnormalizeId,\n\tnormalizeTitle,\n\tnormalizeTypeId,\n\tnormalizeTypesIds,\n} from './validation';\n\nexport default {\n\t/**\n\t * Sets new initial state for the store. Modification flag is reset\n\t */\n\tsetState: (state: StateShape, stateToSet: StateShape): void => {\n\t\tstate.automatedSolution.id = normalizeId(stateToSet.automatedSolution?.id);\n\n\t\tstate.automatedSolution.title = normalizeTitle(stateToSet.automatedSolution?.title);\n\n\t\tstate.automatedSolution.typeIds = normalizeTypesIds(stateToSet.automatedSolution?.typeIds);\n\n\t\tstate.dynamicTypesTitles = normalizeDynamicTypesTitles(stateToSet.dynamicTypesTitles);\n\n\t\tstate.errors = normalizeErrors(stateToSet.errors);\n\n\t\tstate.isModified = false;\n\t},\n\n\tsetErrors: (state: StateShape, errors: Error[]): void => {\n\t\tstate.errors = normalizeErrors(errors);\n\t},\n\tremoveError: (state: StateShape, error: Error): void => {\n\t\tif (!isValidError(error))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.errors = state.errors.filter((x) => x !== error);\n\t},\n\n\tsetTitle: (state: StateShape, title: string): void => {\n\t\tconst newTitle = normalizeTitle(title);\n\n\t\tif (newTitle !== state.automatedSolution.title)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.title = newTitle;\n\t},\n\n\taddTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (state.automatedSolution.typeIds.includes(normalizedTypeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds.push(normalizedTypeId);\n\t\tstate.isModified = true;\n\t},\n\n\tremoveTypeId: (state: StateShape, typeId: number): void => {\n\t\tconst normalizedTypeId = normalizeTypeId(typeId);\n\t\tif (normalizedTypeId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newTypeIds = state.automatedSolution.typeIds.filter((id) => id !== normalizedTypeId);\n\n\t\tif (newTypeIds.length !== state.automatedSolution.typeIds.length)\n\t\t{\n\t\t\tstate.isModified = true;\n\t\t}\n\n\t\tstate.automatedSolution.typeIds = newTypeIds;\n\t},\n};\n","import actions from './actions';\nimport mutations from './mutations';\n\ntype StateShape = {\n\tautomatedSolution: {\n\t\tid?: ?number,\n\t\ttitle?: ?string,\n\t\ttypeIds?: number[],\n\t},\n\n\tdynamicTypesTitles: {[key: number]: string},\n\n\terrors: Error[],\n\tisModified: boolean,\n};\n\nexport type Error = {\n\tmessage: string,\n\tcode: string | number,\n\tcustomData: ?Object,\n};\n\nexport const store = {\n\tstrict: true,\n\tstate(): StateShape\n\t{\n\t\treturn {\n\t\t\tautomatedSolution: {\n\t\t\t\tid: null,\n\t\t\t\ttitle: null,\n\t\t\t\ttypeIds: [],\n\t\t\t},\n\n\t\t\tdynamicTypesTitles: {},\n\n\t\t\terrors: [],\n\n\t\t\tisModified: false,\n\t\t};\n\t},\n\tgetters: {\n\t\tisNew: (state: StateShape) => {\n\t\t\treturn state.automatedSolution.id <= 0;\n\t\t},\n\t\tisSaved: (state: StateShape, getters) => {\n\t\t\treturn !state.isModified && !getters.isNew;\n\t\t},\n\t},\n\tactions,\n\tmutations,\n};\n","import { Router } from 'crm.router';\nimport { Type } from 'main.core';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { createStore } from 'ui.vue3.vuex';\nimport { Main } from './components/main';\nimport { store } from './store/index';\n\nexport class App\n{\n\t#container: HTMLElement;\n\t#initialActiveTabId: string;\n\t#initialState: ?Object;\n\n\t#app: ?VueCreateAppResult = null;\n\n\tconstructor({ containerId, activeTabId, state })\n\t{\n\t\tthis.#container = document.getElementById(containerId);\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error('container not found');\n\t\t}\n\n\t\tthis.#initialActiveTabId = String(activeTabId);\n\n\t\tif (Type.isPlainObject(state))\n\t\t{\n\t\t\tthis.#initialState = state;\n\t\t}\n\t}\n\n\tstart(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst appWrapperRef = this;\n\n\t\tthis.#app = BitrixVue.createApp(\n\t\t\t{\n\t\t\t\t...Main,\n\t\t\t\tbeforeCreate(): void\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.Application.set(appWrapperRef);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tinitialActiveTabId: this.#initialActiveTabId,\n\t\t\t},\n\t\t);\n\n\t\tconst vuexStore = createStore(store);\n\t\tif (this.#initialState)\n\t\t{\n\t\t\tvuexStore.dispatch('setState', this.#initialState);\n\t\t}\n\n\t\tthis.#app.use(vuexStore);\n\n\t\tthis.#app.mount(this.#container);\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#app.unmount();\n\n\t\tthis.#app = null;\n\t}\n\n\treloadWithNewUri(automatedSolutionId: number, queryParams: Object = {}): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tconst uri = Router.Instance.getAutomatedSolutionDetailUrl(automatedSolutionId);\n\n\t\t\turi.setQueryParams({\n\t\t\t\t...queryParams,\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tIFRAME_TYPE: 'SIDE_SLIDER',\n\t\t\t});\n\n\t\t\twindow.location.href = uri.toString();\n\t\t});\n\t}\n\n\tcloseSliderOrRedirect(): never\n\t{\n\t\tsetTimeout(() => {\n\t\t\tRouter.Instance.closeSliderOrRedirect(\n\t\t\t\tRouter.Instance.getAutomatedSolutionListUrl(),\n\t\t\t\twindow,\n\t\t\t);\n\t\t});\n\t}\n}\n"],"names":["createSaveAnalyticsBuilder","store","builder","getters","isNew","Builder","Automation","AutomatedSolution","CreateEvent","EditEvent","setId","state","automatedSolution","id","setTypeIds","typeIds","wrapPromiseInAnalytics","promise","sendAnalyticsData","setStatus","Dictionary","STATUS_ATTEMPT","buildData","then","thenResult","STATUS_SUCCESS","error","STATUS_ERROR","Card","props","title","type","String","required","description","data","isShown","template","CommonTab","components","computed","get","$store","set","dispatch","TypesTab","boundTypesTagSelector","externalTypesTagSelector","crmTypesTagSelector","mounted","TagSelector","multiple","showAddButton","showCreateButton","items","map","typeId","entityId","dynamicTypesTitles","events","onCreateButtonClick","handleCreateTypeClick","onTagRemove","removeTypeIdByTagRemoveEvent","renderTo","$refs","boundTypesTagSelectorContainer","initFilteredTagSelector","crmTypesTagSelectorContainer","externalTypesTagSelectorContainer","methods","isOnlyCrmTypes","isOnlyExternalTypes","addButtonCaption","$Bitrix","Loc","getMessage","addButtonCaptionMore","dialogOptions","height","enableSearch","context","dropdownMode","showAvatars","entities","dynamicLoad","dynamicSearch","options","showAutomatedSolutionBadge","onTagAdd","addTypeIdByTagAddEvent","event","getData","tag","getId","isSaved","openTypeCreationSlider","MessageBox","confirm","messageBox","save","close","Router","Instance","openTypeDetail","automatedSolutionId","activeTabId","isExternal","Application","reloadWithNewUri","setElement","ELEMENT_SAVE_IS_REQUIRED_TO_PROCEED_POPUP","Main","initialActiveTabId","tabs","common","types","isCancelEventAlreadyRegistered","allTabIds","Object","keys","saveButton","document","getElementById","cancelButton","deleteButton","allButtons","buttons","push","slider","BX","SidePanel","getSliderByWindow","window","errors","hasErrors","Type","isArrayFilled","analyticsBuilder","EventEmitter","subscribe","showTabFromEvent","onCloseByCancelButton","onCloseByEsc","onClose","beforeUnmount","unsubscribe","tabId","showTab","includes","Error","ELEMENT_CREATE_BUTTON","closeSliderOrRedirect","unlockButtons","DeleteEvent","ELEMENT_DELETE_BUTTON","ELEMENT_CANCEL_BUTTON","STATUS_CANCEL","sliderEvent","getSlider","ELEMENT_ESC_BUTTON","forEach","button","Dom","removeClass","hideError","normalizeId","isNil","Text","toInteger","normalizeDynamicTypesTitles","titles","isPlainObject","result","entries","key","value","isStringFilled","normalizeTitle","normalizeTypesIds","x","normalizeTypeId","filter","normalizeErrors","isValidError","message","code","isInteger","customData","setState","stateToSet","commit","setErrors","removeError","setTitle","addTypeId","removeTypeId","savePromise","fields","Runtime","clone","length","runAjaxAction","emitUpdateEventToOutsideWorld","response","console","warn","wasErrorHandled","sliderCode","FeaturePromotersRegistry","getPromoter","show","ajaxRunActionArgs","Promise","resolve","reject","Ajax","runAction","intranetCustomSectionId","ToolbarComponent","emitAutomatedSolutionUpdatedEvent","isModified","newTitle","normalizedTypeId","newTypeIds","strict","actions","mutations","App","containerId","isDomNode","appWrapperRef","BitrixVue","createApp","beforeCreate","$bitrix","vuexStore","createStore","use","mount","unmount","queryParams","setTimeout","uri","getAutomatedSolutionDetailUrl","setQueryParams","IFRAME","IFRAME_TYPE","location","href","toString","getAutomatedSolutionListUrl"],"mappings":"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"}