{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Event, Loc, Reflection, Runtime, Text, Type, Uri } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\nimport { Router } from \"crm.router\";\nimport 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass ItemListComponent\n{\n\tentityTypeId: number;\n\tcategoryId: number;\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\tentityTypeName: string;\n\treloadGridTimeoutId: number;\n\texportPopups: Object;\n\t#isUniversalActivityScenarioEnabled: boolean = false;\n\n\tconstructor(params): void\n\t{\n\t\tthis.exportPopups = {};\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\t\t\tif(this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t\tif (this.grid && params.backendUrl)\n\t\t\t\t{\n\t\t\t\t\tBX.addCustomEvent(window, \"Grid::beforeRequest\", (gridData, requestParams) => {\n\t\t\t\t\t\tif (!gridData.parent || gridData.parent !== this.grid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentUrl = new Uri(requestParams.url);\n\t\t\t\t\t\tconst backendUrl = new Uri(params.backendUrl);\n\n\t\t\t\t\t\tif (currentUrl.getPath() !== backendUrl.getPath())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrentUrl.setPath(backendUrl.getPath());\n\t\t\t\t\t\t\tcurrentUrl.setQueryParams({...currentUrl.getQueryParams(), ...backendUrl.getQueryParams()});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trequestParams.url = currentUrl.toString();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif (Type.isBoolean(params.isUniversalActivityScenarioEnabled))\n\t\t\t{\n\t\t\t\tthis.#isUniversalActivityScenarioEnabled = params.isUniversalActivityScenarioEnabled;\n\t\t\t}\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = 0;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\n\t\tthis.#initPushCrmSettings();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onClickDelete', this.handleItemDelete.bind(this));\n\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportCsv', (event) => {\n\t\t\tthis.handleStartExport(event, 'csv');\n\t\t});\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportExcel', (event) => {\n\t\t\tthis.handleStartExport(event, 'excel');\n\t\t});\n\n\t\tconst toolbarComponent = this.#getToolbarComponent();\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent(() => {\n\n\t\t\t\tconst newUrl = Router.Instance.getItemListUrl(this.entityTypeId, this.categoryId);\n\t\t\t\tif (newUrl)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = newUrl;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t\tif (this.grid)\n\t\t\t{\n\t\t\t\ttoolbarComponent.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe('Crm.EntityConverter.Converted', (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[1])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = parameters[1];\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tEventEmitter.subscribe(\"onLocalStorageSet\", (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[0])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst params = parameters[0];\n\t\t\tconst key = params.key || '';\n\t\t\tif (key !== \"onCrmEntityCreate\" && key !== \"onCrmEntityUpdate\" && key !== \"onCrmEntityDelete\" && key !== \"onCrmEntityConvert\")\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = params.value;\n\t\t\tif (!Type.isPlainObject(eventData))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tconst addItemButton = document.querySelector('[data-role=\"add-new-item-button-' + this.gridId + '\"]');\n\t\tif (addItemButton)\n\t\t{\n\t\t\tconst detailUrl = addItemButton.href;\n\t\t\taddItemButton.href = \"javascript: void(0);\";\n\t\t\tEvent.bind(addItemButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tEventEmitter.emit(\"BX.Crm.ItemListComponent:onAddNewItemButtonClick\", {\n\t\t\t\t\tdetailUrl,\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#getToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tconst component = Reflection.getClass('BX.Crm.ToolbarComponent');\n\n\t\treturn component ? component.Instance : null;\n\t}\n\n\t#initPushCrmSettings(): void\n\t{\n\t\tif (!this.#isUniversalActivityScenarioEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst toolbar = this.#getToolbarComponent();\n\t\tif (!toolbar)\n\t\t{\n\t\t\tconsole.error('BX.Crm.ToolbarComponent not found');\n\t\t\treturn;\n\t\t}\n\n\t\tRuntime.loadExtension('crm.push-crm-settings').then(({PushCrmSettings}) => {\n\t\t\t/** @see BX.Crm.PushCrmSettings */\n\t\t\tnew PushCrmSettings({\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\trootMenu: toolbar.getSettingsButton()?.getMenuWindow(),\n\t\t\t\tgrid: this.grid,\n\t\t\t});\n\t\t});\n\t}\n\n\treloadGridAfterTimeout()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.reloadGridTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.reloadGridTimeoutId);\n\t\t\tthis.reloadGridTimeoutId = 0;\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = setTimeout(() => {\n\t\t\tthis.grid.reload();\n\t\t}, 1000);\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = text + message + ' ';\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(event: BaseEvent): void\n\t{\n\t\tconst entityTypeId = Text.toInteger(event.data.entityTypeId);\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!entityTypeId)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_ITEM_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemListDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_TYPE_ITEM_DELETE_NOTIFICATION')\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleStartExport(event: BaseEvent, exportType: string): void\n\t{\n\t\tthis.getExportPopup(exportType).then((process) => process.showDialog());\n\t}\n\t//endregion\n\n\tgetExportPopup(exportType: string): Promise\n\t{\n\t\tif (this.exportPopups[exportType])\n\t\t{\n\t\t\treturn Promise.resolve(this.exportPopups[exportType]);\n\t\t}\n\n\t\treturn Runtime.loadExtension('ui.stepprocessing').then((exports) => {\n\t\t\tthis.exportPopups[exportType] = exports.ProcessManager.create({\n\t\t\t\tid: 'crm.item.list.export.' + exportType,\n\t\t\t\tcontroller: 'bitrix:crm.api.itemExport',\n\t\t\t\tqueue: [{action: 'dispatcher'}],\n\t\t\t\tparams: {\n\t\t\t\t\tSITE_ID: Loc.getMessage('SITE_ID'),\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tcategoryId: this.categoryId,\n\t\t\t\t\tEXPORT_TYPE: exportType,\n\t\t\t\t\tCOMPONENT_NAME: 'bitrix:crm.item.list',\n\t\t\t\t},\n\t\t\t\tmessages: {\n\t\t\t\t\tDialogTitle: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_TITLE'),\n\t\t\t\t\tDialogSummary: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_SUMMARY'),\n\t\t\t\t},\n\t\t\t\tdialogMaxWidth: '650',\n\t\t\t});\n\t\t\tthis.exportPopups[exportType].setHandler(BX.UI.StepProcessing.ProcessCallback.StepCompleted, ((formatInner) => {\n\t\t\t\treturn () => {\n\t\t\t\t\tdelete this.exportPopups[formatInner];\n\t\t\t\t}\n\t\t\t})(exportType));\n\n\t\t\treturn this.exportPopups[exportType];\n\t\t});\n\n\t}\n}\n\nnamespace.ItemListComponent = ItemListComponent;\n"],"names":["namespace","Reflection","ItemListComponent","params","exportPopups","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","categoryId","isString","gridId","BX","Main","grid","gridManager","getInstanceById","backendUrl","addCustomEvent","window","gridData","requestParams","parent","currentUrl","Uri","url","getPath","setPath","setQueryParams","getQueryParams","toString","isElementNode","errorTextContainer","isBoolean","isUniversalActivityScenarioEnabled","reloadGridTimeoutId","bindEvents","EventEmitter","subscribe","handleItemDelete","bind","event","handleStartExport","toolbarComponent","subscribeTypeUpdatedEvent","newUrl","Router","Instance","getItemListUrl","location","href","reload","subscribeCategoriesUpdatedEvent","reloadGridAfterTimeout","parameters","data","isArray","eventData","key","value","addItemButton","document","querySelector","detailUrl","Event","preventDefault","stopPropagation","emit","clearTimeout","setTimeout","errors","text","forEach","message","innerText","parentElement","style","display","console","error","messages","push","showErrors","id","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","UI","Notification","Center","notify","content","showErrorsFromResponse","close","exportType","getExportPopup","process","showDialog","Promise","resolve","Runtime","loadExtension","exports","ProcessManager","create","controller","queue","action","SITE_ID","EXPORT_TYPE","COMPONENT_NAME","DialogTitle","toUpperCase","DialogSummary","dialogMaxWidth","setHandler","StepProcessing","ProcessCallback","StepCompleted","formatInner","component","getClass","toolbar","PushCrmSettings","rootMenu","getSettingsButton","getMenuWindow"],"mappings":"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"}