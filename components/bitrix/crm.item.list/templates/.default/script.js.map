{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Event, Loc, Reflection, Runtime, Text, Type, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { Router } from 'crm.router';\nimport 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass ItemListComponent\n{\n\tentityTypeId: number;\n\tcategoryId: number;\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\tentityTypeName: string;\n\treloadGridTimeoutId: number;\n\texportPopups: Object;\n\t#isUniversalActivityScenarioEnabled: boolean = false;\n\t#isIframe: boolean = false;\n\t#smartActivityNotificationSupported: boolean = false;\n\t// is the list is embedded in another entity detail tab\n\t#isEmbedded: boolean = false;\n\n\tconstructor(params): void\n\t{\n\t\tthis.exportPopups = {};\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\t\t\tthis.#smartActivityNotificationSupported = Text.toBoolean(params.smartActivityNotificationSupported);\n\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\t\t\tif(this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t\tif (this.grid && params.backendUrl)\n\t\t\t\t{\n\t\t\t\t\tBX.addCustomEvent(window, \"Grid::beforeRequest\", (gridData, requestParams) => {\n\t\t\t\t\t\tif (!gridData.parent || gridData.parent !== this.grid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentUrl = new Uri(requestParams.url);\n\t\t\t\t\t\tconst backendUrl = new Uri(params.backendUrl);\n\n\t\t\t\t\t\tif (currentUrl.getPath() !== backendUrl.getPath())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrentUrl.setPath(backendUrl.getPath());\n\t\t\t\t\t\t\tcurrentUrl.setQueryParams({...currentUrl.getQueryParams(), ...backendUrl.getQueryParams()});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trequestParams.url = currentUrl.toString();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif (Type.isBoolean(params.isUniversalActivityScenarioEnabled))\n\t\t\t{\n\t\t\t\tthis.#isUniversalActivityScenarioEnabled = params.isUniversalActivityScenarioEnabled;\n\t\t\t}\n\t\t\tif (Type.isBoolean(params.isIframe))\n\t\t\t{\n\t\t\t\tthis.#isIframe = params.isIframe;\n\t\t\t}\n\t\t\tif (Type.isBoolean(params.isEmbedded))\n\t\t\t{\n\t\t\t\tthis.#isEmbedded = params.isEmbedded;\n\t\t\t}\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = 0;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\n\t\tthis.#initPushCrmSettings();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onClickDelete', this.handleItemDelete.bind(this));\n\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportCsv', (event) => {\n\t\t\tthis.handleStartExport(event, 'csv');\n\t\t});\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportExcel', (event) => {\n\t\t\tthis.handleStartExport(event, 'excel');\n\t\t});\n\n\t\tconst toolbarComponent = this.#getToolbarComponent();\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent(() => {\n\n\t\t\t\tconst newUrl = Router.Instance.getItemListUrl(this.entityTypeId, this.categoryId);\n\t\t\t\tif (newUrl)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = newUrl;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t\tif (this.grid)\n\t\t\t{\n\t\t\t\ttoolbarComponent.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe('Crm.EntityConverter.Converted', (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[1])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = parameters[1];\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tEventEmitter.subscribe(\"onLocalStorageSet\", (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[0])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst params = parameters[0];\n\t\t\tconst key = params.key || '';\n\t\t\tif (key !== \"onCrmEntityCreate\" && key !== \"onCrmEntityUpdate\" && key !== \"onCrmEntityDelete\" && key !== \"onCrmEntityConvert\")\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = params.value;\n\t\t\tif (!Type.isPlainObject(eventData))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tconst addItemButton = document.querySelector('[data-role=\"add-new-item-button-' + this.gridId + '\"]');\n\t\tif (addItemButton)\n\t\t{\n\t\t\tconst detailUrl = addItemButton.href;\n\t\t\taddItemButton.href = \"javascript: void(0);\";\n\t\t\tEvent.bind(addItemButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tEventEmitter.emit(\"BX.Crm.ItemListComponent:onAddNewItemButtonClick\", {\n\t\t\t\t\tdetailUrl,\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#getToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tconst component = Reflection.getClass('BX.Crm.ToolbarComponent');\n\n\t\treturn component ? component.Instance : null;\n\t}\n\n\t#initPushCrmSettings(): void\n\t{\n\t\tif (!this.#isUniversalActivityScenarioEnabled || this.#isIframe || this.#isEmbedded)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst toolbar = this.#getToolbarComponent();\n\t\tif (!toolbar)\n\t\t{\n\t\t\tconsole.error('BX.Crm.ToolbarComponent not found');\n\t\t\treturn;\n\t\t}\n\n\t\tRuntime.loadExtension('crm.push-crm-settings').then(({PushCrmSettings}) => {\n\t\t\t/** @see BX.Crm.PushCrmSettings */\n\t\t\tnew PushCrmSettings({\n\t\t\t\tsmartActivityNotificationSupported: this.#smartActivityNotificationSupported,\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\trootMenu: toolbar.getSettingsButton()?.getMenuWindow(),\n\t\t\t\tgrid: this.grid,\n\t\t\t});\n\t\t});\n\t}\n\n\treloadGridAfterTimeout()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.reloadGridTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.reloadGridTimeoutId);\n\t\t\tthis.reloadGridTimeoutId = 0;\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = setTimeout(() => {\n\t\t\tthis.grid.reload();\n\t\t}, 1000);\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = text + message + ' ';\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(event: BaseEvent): void\n\t{\n\t\tconst entityTypeId = Text.toInteger(event.data.entityTypeId);\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!entityTypeId)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_ITEM_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemListDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_TYPE_ITEM_DELETE_NOTIFICATION')\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleStartExport(event: BaseEvent, exportType: string): void\n\t{\n\t\tthis.getExportPopup(exportType).then((process) => process.showDialog());\n\t}\n\t//endregion\n\n\tgetExportPopup(exportType: string): Promise\n\t{\n\t\tif (this.exportPopups[exportType])\n\t\t{\n\t\t\treturn Promise.resolve(this.exportPopups[exportType]);\n\t\t}\n\n\t\treturn Runtime.loadExtension('ui.stepprocessing').then((exports) => {\n\t\t\tthis.exportPopups[exportType] = exports.ProcessManager.create({\n\t\t\t\tid: 'crm.item.list.export.' + exportType,\n\t\t\t\tcontroller: 'bitrix:crm.api.itemExport',\n\t\t\t\tqueue: [{action: 'dispatcher'}],\n\t\t\t\tparams: {\n\t\t\t\t\tSITE_ID: Loc.getMessage('SITE_ID'),\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tcategoryId: this.categoryId,\n\t\t\t\t\tEXPORT_TYPE: exportType,\n\t\t\t\t\tCOMPONENT_NAME: 'bitrix:crm.item.list',\n\t\t\t\t},\n\t\t\t\tmessages: {\n\t\t\t\t\tDialogTitle: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_TITLE'),\n\t\t\t\t\tDialogSummary: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_SUMMARY'),\n\t\t\t\t},\n\t\t\t\tdialogMaxWidth: '650',\n\t\t\t});\n\t\t\tthis.exportPopups[exportType].setHandler(BX.UI.StepProcessing.ProcessCallback.StepCompleted, ((formatInner) => {\n\t\t\t\treturn () => {\n\t\t\t\t\tdelete this.exportPopups[formatInner];\n\t\t\t\t}\n\t\t\t})(exportType));\n\n\t\t\treturn this.exportPopups[exportType];\n\t\t});\n\n\t}\n}\n\nnamespace.ItemListComponent = ItemListComponent;\n"],"names":["namespace","Reflection","ItemListComponent","params","exportPopups","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","categoryId","toBoolean","smartActivityNotificationSupported","isString","gridId","BX","Main","grid","gridManager","getInstanceById","backendUrl","addCustomEvent","window","gridData","requestParams","parent","currentUrl","Uri","url","getPath","setPath","setQueryParams","getQueryParams","toString","isElementNode","errorTextContainer","isBoolean","isUniversalActivityScenarioEnabled","isIframe","isEmbedded","reloadGridTimeoutId","bindEvents","EventEmitter","subscribe","handleItemDelete","bind","event","handleStartExport","toolbarComponent","subscribeTypeUpdatedEvent","newUrl","Router","Instance","getItemListUrl","location","href","reload","subscribeCategoriesUpdatedEvent","reloadGridAfterTimeout","parameters","data","isArray","eventData","key","value","addItemButton","document","querySelector","detailUrl","Event","preventDefault","stopPropagation","emit","clearTimeout","setTimeout","errors","text","forEach","message","innerText","parentElement","style","display","console","error","messages","push","showErrors","id","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","UI","Notification","Center","notify","content","showErrorsFromResponse","close","exportType","getExportPopup","process","showDialog","Promise","resolve","Runtime","loadExtension","exports","ProcessManager","create","controller","queue","action","SITE_ID","EXPORT_TYPE","COMPONENT_NAME","DialogTitle","toUpperCase","DialogSummary","dialogMaxWidth","setHandler","StepProcessing","ProcessCallback","StepCompleted","formatInner","component","getClass","toolbar","PushCrmSettings","rootMenu","getSettingsButton","getMenuWindow"],"mappings":"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"}