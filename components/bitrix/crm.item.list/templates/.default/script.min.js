(function(e,t,r,i,n){"use strict";var o=t.Reflection.namespace("BX.Crm");var a=function(){function e(r){var i=this;babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(r)){this.entityTypeId=t.Text.toInteger(r.entityTypeId);this.entityTypeName=r.entityTypeName;this.categoryId=t.Text.toInteger(r.categoryId);if(t.Type.isString(r.gridId)){this.gridId=r.gridId}if(this.gridId&&BX.Main.grid&&BX.Main.gridManager){this.grid=BX.Main.gridManager.getInstanceById(this.gridId);if(this.grid&&r.backendUrl){BX.addCustomEvent(window,"Grid::beforeRequest",function(e,t){if(!e.parent||e.parent!==i.grid){return}t.url=r.backendUrl})}}if(t.Type.isElementNode(r.errorTextContainer)){this.errorTextContainer=r.errorTextContainer}}this.reloadGridTimeoutId=0}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents()}},{key:"bindEvents",value:function e(){var i=this;r.EventEmitter.subscribe("BX.Crm.ItemListComponent:onClickDelete",this.handleItemDelete.bind(this));var o=t.Reflection.getClass("BX.Crm.ToolbarComponent")?t.Reflection.getClass("BX.Crm.ToolbarComponent").Instance:null;if(o){o.subscribeTypeUpdatedEvent(function(){var e=n.Router.Instance.getItemListUrl(i.entityTypeId,i.categoryId);if(e){window.location.href=e;return}window.location.reload()});if(this.grid){o.subscribeCategoriesUpdatedEvent(function(){i.reloadGridAfterTimeout()})}}r.EventEmitter.subscribe("onLocalStorageSet",function(e){var r=e.data;if(!t.Type.isArray(r)||!r[0]){return}var n=r[0];var o=n.key||"";if(o!=="onCrmEntityCreate"&&o!=="onCrmEntityUpdate"&&o!=="onCrmEntityDelete"&&o!=="onCrmEntityConvert"){return}var a=n.value;if(!t.Type.isPlainObject(a)){return}if(!i.entityTypeName||!a.entityTypeName||i.entityTypeName!==a.entityTypeName){return}i.reloadGridAfterTimeout()})}},{key:"reloadGridAfterTimeout",value:function e(){var t=this;if(!this.grid){return}if(this.reloadGridTimeoutId>0){clearTimeout(this.reloadGridTimeoutId);this.reloadGridTimeoutId=0}this.reloadGridTimeoutId=setTimeout(function(){t.grid.reload()},1e3)}},{key:"showErrors",value:function e(r){var i="";r.forEach(function(e){i=i+e+" "});if(t.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText=i;this.errorTextContainer.parentElement.style.display="block"}else{console.error(i)}}},{key:"hideErrors",value:function e(){if(t.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText="";this.errorTextContainer.parentElement.style.display="none"}}},{key:"showErrorsFromResponse",value:function e(t){var r=t.errors;var i=[];r.forEach(function(e){var t=e.message;return i.push(t)});this.showErrors(i)}},{key:"handleItemDelete",value:function e(r){var n=this;var o=t.Text.toInteger(r.data.entityTypeId);var a=t.Text.toInteger(r.data.id);if(!o){this.showErrors([t.Loc.getMessage("CRM_TYPE_TYPE_NOT_FOUND")]);return}if(!a){this.showErrors([t.Loc.getMessage("CRM_TYPE_ITEM_NOT_FOUND")]);return}i.MessageBox.show({title:t.Loc.getMessage("CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE"),message:t.Loc.getMessage("CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE"),modal:true,buttons:i.MessageBoxButtons.YES_CANCEL,onYes:function e(r){t.ajax.runAction("crm.controller.item.delete",{analyticsLabel:"crmItemListDeleteItem",data:{entityTypeId:o,id:a}}).then(function(){n.reloadGridAfterTimeout()}).catch(n.showErrorsFromResponse.bind(n));r.close()}})}}]);return e}();o.ItemListComponent=a})(this.window=this.window||{},BX,BX.Event,BX.UI.Dialogs,BX.Crm);
//# sourceMappingURL=script.map.js