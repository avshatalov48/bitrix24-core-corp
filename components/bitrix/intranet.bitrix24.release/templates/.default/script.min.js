this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,s,t){"use strict";let i=e=>e,a,r;var l=babelHelpers.classPrivateFieldLooseKey("id");var n=babelHelpers.classPrivateFieldLooseKey("windowMessageHandler");var o=babelHelpers.classPrivateFieldLooseKey("getContent");var d=babelHelpers.classPrivateFieldLooseKey("handleFrameLoad");var c=babelHelpers.classPrivateFieldLooseKey("handleWindowMessage");class h extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,c,{value:p});Object.defineProperty(this,d,{value:v});Object.defineProperty(this,o,{value:b});Object.defineProperty(this,l,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:null});this.setEventNamespace("BX.Intranet.Bitrix24.ReleaseSlider");e=t.Type.isPlainObject(e)?e:{};this.subscribeFromOptions(e.events);this.url=t.Type.isStringFilled(e.url)?e.url:"about:blank";babelHelpers.classPrivateFieldLooseBase(this,l)[l]=`release-slider-${t.Text.getRandom()}`;this.sliderOptions=t.Type.isPlainObject(e.sliderOptions)?e.sliderOptions:{};babelHelpers.classPrivateFieldLooseBase(this,n)[n]=babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this);this.html=new t.Cache.MemoryCache}show(){if(this.isOpen()){return}const e={width:1100,customLeftBoundary:0};const i=Object.assign({},e,this.sliderOptions);const a=t.Type.isPlainObject(i.events)?i.events:{};i.events={onCloseComplete:()=>{t.Event.unbind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,n)[n]);this.emit("onCloseComplete")},onOpenComplete:()=>{t.Event.bind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,n)[n])}};i.contentCallback=e=>{for(const i in a){if(t.Type.isFunction(a[i])){s.EventEmitter.subscribe(e,BX.SidePanel.Slider.getEventFullName(i),a[i])}}return new Promise(((e,s)=>{if(this.getFrame().src!==this.url){this.getFrame().src=this.url}t.Event.bind(this.getFrame(),"load",babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this));e(babelHelpers.classPrivateFieldLooseBase(this,o)[o]())}))};BX.SidePanel.Instance.open(this.getId(),i)}hide(){const e=this.getSlider();if(e){e.close()}}isOpen(){return this.getSlider()&&this.getSlider().isOpen()}getId(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}getSlider(){return BX.SidePanel.Instance.getSlider(this.getId())}getFrame(){return this.html.remember("frame",(()=>t.Tag.render(a||(a=i`<iframe src="about:blank" class="intranet-release-iframe"></iframe>`))))}}function b(){return this.html.remember("content",(()=>t.Tag.render(r||(r=i`<div class="intranet-release-iframe-container">${0}</div>`),this.getFrame())))}function v(){this.emit("onLoad")}function p(e){const s=new URL(this.url);if(e.origin!==s.origin){return}this.emit("onMessage",{message:e.data,event:e})}let u=e=>e,m;class P extends s.EventEmitter{constructor(e){super();this.container=null;this.setEventNamespace("BX.Intranet.Bitrix24.ReleaseEar");e=t.Type.isPlainObject(e)?e:{};this.zone=t.Type.isStringFilled(e.zone)?e.zone:"en";this.subscribeFromOptions(e.events)}show(e=false){if(e){t.Dom.removeClass(this.getContainer(),"--hidden");requestAnimationFrame((()=>{requestAnimationFrame((()=>{t.Dom.removeClass(this.getContainer(),"--hidden")}))}))}else{t.Dom.removeClass(this.getContainer(),"--hidden")}}hide(){t.Dom.addClass(this.getContainer(),"--hidden")}getContainer(){if(this.container===null){this.container=t.Tag.render(m||(m=u`
				<div class="intranet-release-ear" onclick="${0}">
					<div class="intranet-release-button"><i></i></div>
					<div class="intranet-release-logo --${0}"></div>
				</div>
			`),this.handleClick.bind(this),this.zone);t.Dom.append(this.container,document.body)}return this.container}handleClick(){this.emit("onClick")}}var g=babelHelpers.classPrivateFieldLooseKey("deactivated");var F=babelHelpers.classPrivateFieldLooseKey("id");var f=babelHelpers.classPrivateFieldLooseKey("runAction");var B=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var y=babelHelpers.classPrivateFieldLooseKey("handleEarClick");var L=babelHelpers.classPrivateFieldLooseKey("handleFrameMessage");class H{constructor(e){Object.defineProperty(this,L,{value:E});Object.defineProperty(this,y,{value:C});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,f,{value:O});Object.defineProperty(this,g,{writable:true,value:false});Object.defineProperty(this,F,{writable:true,value:""});e=t.Type.isPlainObject(e)?e:{};if(!t.Type.isStringFilled(e.url)){throw new Error('Release: the "url" parameter is required.')}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=t.Type.isStringFilled(e.id)?e.id:"";this.slider=new h({url:e.url,sliderOptions:e.sliderOptions,events:{onCloseComplete:babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this),onMessage:babelHelpers.classPrivateFieldLooseBase(this,L)[L].bind(this)}});this.ear=new P({zone:e.zone,events:{onClick:babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this)}})}show(e="ear"){if(e==="slider"){this.getSlider().show();void babelHelpers.classPrivateFieldLooseBase(this,f)[f]("show",{context:"auto"})}else{this.getEar().show()}}getSlider(){return this.slider}getEar(){return this.ear}}function O(e,s={},i={}){return t.ajax.runComponentAction("bitrix:intranet.bitrix24.release",e,{mode:"class",data:i,analyticsLabel:Object.assign({module:"intranet",service:babelHelpers.classPrivateFieldLooseBase(this,F)[F],action:e},s)})}function w(){this.getEar().show(true);babelHelpers.classPrivateFieldLooseBase(this,f)[f]("close")}function C(){this.getEar().hide();this.getSlider().show();babelHelpers.classPrivateFieldLooseBase(this,f)[f]("show",{context:"ear-click"})}function E(e){const{message:s}=e.getData();if(!t.Type.isPlainObject(s)){return}if(s.command==="endOfScroll"&&babelHelpers.classPrivateFieldLooseBase(this,g)[g]===false){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=true;babelHelpers.classPrivateFieldLooseBase(this,f)[f]("deactivate").catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g]=false}))}if(s.command==="openHelper"){if(BX.Helper){BX.Helper.show(s.options)}}}e.Release=H;e.ReleaseSlider=h;e.ReleaseEar=P})(this.BX.Intranet.Bitrix24=this.BX.Intranet.Bitrix24||{},BX.Event,BX);
//# sourceMappingURL=script.map.js