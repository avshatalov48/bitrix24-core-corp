this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,s,t){"use strict";let i=e=>e,a,r;var l=babelHelpers.classPrivateFieldLooseKey("id");var n=babelHelpers.classPrivateFieldLooseKey("windowMessageHandler");var o=babelHelpers.classPrivateFieldLooseKey("getContent");var d=babelHelpers.classPrivateFieldLooseKey("handleFrameLoad");var c=babelHelpers.classPrivateFieldLooseKey("handleWindowMessage");class h extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,c,{value:p});Object.defineProperty(this,d,{value:v});Object.defineProperty(this,o,{value:b});Object.defineProperty(this,l,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:null});this.setEventNamespace("BX.Intranet.Bitrix24.ReleaseSlider");e=s.Type.isPlainObject(e)?e:{};this.subscribeFromOptions(e.events);this.url=s.Type.isStringFilled(e.url)?e.url:"about:blank";babelHelpers.classPrivateFieldLooseBase(this,l)[l]=`release-slider-${s.Text.getRandom()}`;this.sliderOptions=s.Type.isPlainObject(e.sliderOptions)?e.sliderOptions:{};babelHelpers.classPrivateFieldLooseBase(this,n)[n]=babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this);this.html=new s.Cache.MemoryCache}show(){if(this.isOpen()){return}const e={width:1100,customLeftBoundary:0};const i=Object.assign({},e,this.sliderOptions);const a=s.Type.isPlainObject(i.events)?i.events:{};i.events={onCloseComplete:()=>{s.Event.unbind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,n)[n]);this.emit("onCloseComplete")},onOpenComplete:()=>{s.Event.bind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,n)[n])}};i.contentCallback=e=>{for(const i in a){if(s.Type.isFunction(a[i])){t.EventEmitter.subscribe(e,BX.SidePanel.Slider.getEventFullName(i),a[i])}}return new Promise(((e,t)=>{if(this.getFrame().src!==this.url){this.getFrame().src=this.url}s.Event.bind(this.getFrame(),"load",babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this));e(babelHelpers.classPrivateFieldLooseBase(this,o)[o]())}))};BX.SidePanel.Instance.open(this.getId(),i)}hide(){const e=this.getSlider();if(e){e.close()}}isOpen(){return this.getSlider()&&this.getSlider().isOpen()}getId(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}getSlider(){return BX.SidePanel.Instance.getSlider(this.getId())}getFrame(){return this.html.remember("frame",(()=>s.Tag.render(a||(a=i`<iframe src="about:blank" class="intranet-release-iframe"></iframe>`))))}}function b(){return this.html.remember("content",(()=>s.Tag.render(r||(r=i`<div class="intranet-release-iframe-container">${0}</div>`),this.getFrame())))}function v(){this.emit("onLoad")}function p(e){const s=new URL(this.url);if(e.origin!==s.origin){return}this.emit("onMessage",{message:e.data,event:e})}let u=e=>e,m;class P extends t.EventEmitter{constructor(e){super();this.container=null;this.setEventNamespace("BX.Intranet.Bitrix24.ReleaseEar");e=s.Type.isPlainObject(e)?e:{};this.zone=s.Type.isStringFilled(e.zone)?e.zone:"en";this.subscribeFromOptions(e.events)}show(e=false){if(e){s.Dom.removeClass(this.getContainer(),"--hidden");requestAnimationFrame((()=>{requestAnimationFrame((()=>{s.Dom.removeClass(this.getContainer(),"--hidden")}))}))}else{s.Dom.removeClass(this.getContainer(),"--hidden")}}hide(){s.Dom.addClass(this.getContainer(),"--hidden")}getContainer(){if(this.container===null){this.container=s.Tag.render(m||(m=u`
				<div class="intranet-release-ear" onclick="${0}">
					<div class="intranet-release-button"><i></i></div>
					<div class="intranet-release-logo --${0}"></div>
				</div>
			`),this.handleClick.bind(this),this.zone);s.Dom.append(this.container,document.body)}return this.container}handleClick(){this.emit("onClick")}}var g=babelHelpers.classPrivateFieldLooseKey("deactivated");var F=babelHelpers.classPrivateFieldLooseKey("id");var f=babelHelpers.classPrivateFieldLooseKey("runAction");var B=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var y=babelHelpers.classPrivateFieldLooseKey("handleEarClick");var L=babelHelpers.classPrivateFieldLooseKey("handleFrameMessage");class H{constructor(e){Object.defineProperty(this,L,{value:w});Object.defineProperty(this,y,{value:S});Object.defineProperty(this,B,{value:C});Object.defineProperty(this,f,{value:O});Object.defineProperty(this,g,{writable:true,value:false});Object.defineProperty(this,F,{writable:true,value:""});const i=s.Type.isPlainObject(e)?e:{};if(!s.Type.isStringFilled(i.url)){throw new Error('Release: the "url" parameter is required.')}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.Type.isStringFilled(i.id)?i.id:"";this.slider=new h({url:i.url,sliderOptions:i.sliderOptions,events:{onCloseComplete:babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this),onMessage:babelHelpers.classPrivateFieldLooseBase(this,L)[L].bind(this)}});this.ear=new P({zone:i.zone,events:{onClick:babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this)}});t.EventEmitter.subscribe("SidePanel.Slider:onOpen",(()=>{this.getEar().hide()}));const a=()=>{if(BX.SidePanel.Instance.getOpenSlidersCount()===0){this.getEar().show(true)}};t.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",a);t.EventEmitter.subscribe("SidePanel.Slider:onDestroy",a)}show(e="ear"){if(e==="slider"){this.getSlider().show();void babelHelpers.classPrivateFieldLooseBase(this,f)[f]("show",{context:"auto"})}else{if(BX.SidePanel.Instance.getOpenSlidersCount()===0){this.getEar().show()}}}getSlider(){return this.slider}getEar(){return this.ear}}function O(e,t={},i={}){return s.ajax.runComponentAction("bitrix:intranet.bitrix24.release",e,{mode:"class",data:i,analyticsLabel:{module:"intranet",service:babelHelpers.classPrivateFieldLooseBase(this,F)[F],action:e,...t}})}function C(){if(BX.SidePanel.Instance.getOpenSlidersCount()===0){this.getEar().show(true)}void babelHelpers.classPrivateFieldLooseBase(this,f)[f]("close")}function S(){this.getEar().hide();this.getSlider().show();void babelHelpers.classPrivateFieldLooseBase(this,f)[f]("show",{context:"ear-click"})}function w(e){const{message:t}=e.getData();if(!s.Type.isPlainObject(t)){return}if(t.command==="endOfScroll"&&babelHelpers.classPrivateFieldLooseBase(this,g)[g]===false){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=true;babelHelpers.classPrivateFieldLooseBase(this,f)[f]("deactivate").catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g]=false}))}if(t.command==="openHelper"&&BX.Helper){BX.Helper.show(t.options)}}e.Release=H;e.ReleaseSlider=h;e.ReleaseEar=P})(this.BX.Intranet.Bitrix24=this.BX.Intranet.Bitrix24||{},BX,BX.Event);
//# sourceMappingURL=script.map.js