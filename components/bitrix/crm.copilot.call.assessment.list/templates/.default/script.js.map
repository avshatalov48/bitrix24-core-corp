{"version":3,"file":"script.js","sources":["active-field.js","grid.js"],"sourcesContent":["import { ajax as Ajax, Reflection, Runtime, Text } from 'main.core';\nimport { UI } from 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm.Copilot.CallAssessmentList');\n\nexport class ActiveField\n{\n\t#id: string;\n\t#targetNode: string;\n\t#checked: boolean;\n\t#readOnly: boolean;\n\n\tconstructor({ id, targetNodeId, checked, readOnly })\n\t{\n\t\tthis.#id = id;\n\t\tthis.#targetNode = document.getElementById(targetNodeId);\n\t\tthis.#checked = checked;\n\t\tthis.#readOnly = readOnly;\n\t}\n\n\tinit(): void\n\t{\n\t\tvoid Runtime.loadExtension('ui.switcher').then((exports) => {\n\t\t\tconst { Switcher } = exports;\n\n\t\t\tconst switcher = new Switcher({\n\t\t\t\tchecked: this.#checked,\n\t\t\t\tdisabled: this.#readOnly,\n\t\t\t\thandlers: {\n\t\t\t\t\tchecked: (event) => {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tthis.#changeCallAssessmentActive(false);\n\t\t\t\t\t},\n\t\t\t\t\tunchecked: (event) => {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tthis.#changeCallAssessmentActive(true);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tswitcher.renderTo(this.#targetNode);\n\t\t});\n\t}\n\n\t#changeCallAssessmentActive(isEnabled: boolean): void\n\t{\n\t\tRuntime.throttle(() => {\n\t\t\tAjax\n\t\t\t\t.runAction('crm.copilot.callassessment.active', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: this.#id,\n\t\t\t\t\t\tisEnabled: isEnabled ? 'Y' : 'N',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Text.encode(response.errors[0].message),\n\t\t\t\t\t\tautoHideDelay: 6000,\n\t\t\t\t\t});\n\n\t\t\t\t\tthrow response;\n\t\t\t\t})\n\t\t\t;\n\t\t}, 100)();\n\t}\n}\n\nnamespace.ActiveField = ActiveField;\n","import { ajax as Ajax, Loc, Reflection, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm.Copilot.CallAssessmentList');\n\nexport class Grid {\n\t#grid = null;\n\t#reloadGridTimeoutId: number = null;\n\n\tconstructor(gridId: string)\n\t{\n\t\tthis.#grid = BX.Main.gridManager.getInstanceById(gridId);\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.Copilot.CallAssessment:onClickDelete', this.#handleItemDelete.bind(this));\n\t}\n\n\t#handleItemDelete(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!id)\n\t\t{\n\t\t\tthis.#showError(Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_LIST_NOT_FOUND'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.copilot.callassessment.delete', {\n\t\t\t\t\t\tdata: { id },\n\t\t\t\t\t}).then((response) => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_TYPE_ITEM_DELETE_NOTIFICATION')\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#reloadGridAfterTimeout();\n\t\t\t\t\t}).catch(({ errors }) => {\n\t\t\t\t\t\tthis.#showError(errors[0]?.message ?? Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_LIST_ITEM_DELETE_ERROR'));\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\t#showError(message: string): void\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(message),\n\t\t\tautoHideDelay: 6000,\n\t\t});\n\t}\n\n\t#reloadGridAfterTimeout(): void\n\t{\n\t\tif (!this.#grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#reloadGridTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.#reloadGridTimeoutId);\n\t\t\tthis.#reloadGridTimeoutId = 0;\n\t\t}\n\n\t\tthis.#reloadGridTimeoutId = setTimeout(() => {\n\t\t\tthis.#grid.reload();\n\t\t}, 1000);\n\t}\n}\n\nnamespace.Grid = Grid;"],"names":["namespace","Reflection","ActiveField","id","targetNodeId","checked","readOnly","document","getElementById","Runtime","loadExtension","then","exports","Switcher","switcher","disabled","handlers","event","stopPropagation","unchecked","renderTo","isEnabled","throttle","Ajax","runAction","data","response","UI","Notification","Center","notify","content","Text","encode","errors","message","autoHideDelay","Grid","gridId","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","BX","Main","gridManager","getInstanceById","_classPrivateMethodGet","EventEmitter","subscribe","bind","toInteger","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","close","clearTimeout","setTimeout","reload"],"mappings":"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"}