{"version":3,"file":"script.js","sources":["src/row.js","src/form.js"],"sourcesContent":["import { Cache, Tag, Loc, Type, Dom } from 'main.core';\nimport type { RowOptions } from './row-options';\n\nexport default class Row\n{\n\temail: string = null;\n\tname: ?string = null;\n\tlastName: ?string = null;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(rowOptions: RowOptions)\n\t{\n\t\tconst options = Type.isPlainObject(rowOptions) ? rowOptions : {};\n\n\t\tif (Type.isStringFilled(options.email))\n\t\t{\n\t\t\tthis.getEmailTextBox().value = options.email;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.name))\n\t\t{\n\t\t\tthis.getNameTextBox().value = options.name;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.lastName))\n\t\t{\n\t\t\tthis.getLastNameTextBox().value = options.lastName;\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\tconst email = this.getEmailTextBox().value.trim();\n\n\t\treturn !Type.isStringFilled(email);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tconst email = this.getEmail();\n\t\tconst name = this.getName();\n\t\tconst lastName = this.getLastName();\n\n\t\tif (Type.isStringFilled(email))\n\t\t{\n\t\t\tconst atom = '=_0-9a-z+~\\'!\\$&*^`|\\\\#%/?{}-';\n\t\t\tconst regExp = new RegExp('^[' + atom + ']+(\\\\.[' + atom + ']+)*@(([-0-9a-z]+\\\\.)+)([a-z0-9-]{2,20})$', 'i');\n\t\t\tif (!email.match(regExp))\n\t\t\t{\n\t\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t\telse if (Type.isStringFilled(name) || Type.isStringFilled(lastName))\n\t\t{\n\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\treturn false;\n\t\t}\n\n\t\tDom.removeClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\n\t\treturn true;\n\t}\n\n\tfocus()\n\t{\n\t\tthis.getEmailTextBox().focus();\n\t}\n\n\tgetEmail()\n\t{\n\t\treturn this.getEmailTextBox().value.trim();\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.getNameTextBox().value.trim();\n\t}\n\n\tgetLastName()\n\t{\n\t\treturn this.getLastNameTextBox().value.trim();\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-row\">\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_EMAIL')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getEmailTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_LAST_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getLastNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetEmailTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('email', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"email\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\tplaceholder=\"${Loc.getMessage('INTRANET_INVITATION_GUEST_ENTER_EMAIL')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLastNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('last-name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n}","import { Type, Tag, Cache, Dom, ajax as Ajax, Loc, BaseError, Text, Runtime } from 'main.core';\nimport { ButtonManager } from 'ui.buttons';\nimport Row from './row';\nimport type { Button } from 'ui.buttons';\nimport type { FormOptions } from './form-options';\n\n\nexport default class Form\n{\n\ttargetNode: HTMLElement = null;\n\tcache = new Cache.MemoryCache();\n\tsaveButton: Button = null;\n\tcancelButton: Button = null;\n\trows: Row[] = [];\n\terror: typeof(BX.UI.Alert) = null;\n\tuserOptions: { [key: string]: any } = {};\n\n\tconstructor(formOptions: FormOptions)\n\t{\n\t\tconst options = Type.isPlainObject(formOptions) ? formOptions : {};\n\n\t\tthis.targetNode = options.targetNode;\n\t\tthis.userOptions = Type.isPlainObject(options.userOptions) ? options.userOptions : {};\n\t\tDom.append(this.getContainer(), this.targetNode);\n\n\t\tif (Type.isElementNode(options.saveButtonNode))\n\t\t{\n\t\t\tthis.saveButton = ButtonManager.createFromNode(options.saveButtonNode);\n\t\t\tthis.saveButton.bindEvent('click', this.handleSaveButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isElementNode(options.cancelButtonNode))\n\t\t{\n\t\t\tthis.cancelButton = ButtonManager.createFromNode(options.cancelButtonNode);\n\t\t\tthis.cancelButton.bindEvent('click', this.handleCancelButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.rows))\n\t\t{\n\t\t\toptions.rows.forEach(row => {\n\t\t\t\tthis.addRow(row);\n\t\t\t});\n\n\t\t\tthis.addRows(Math.max(2, 5 - options.rows.length));\n\t\t\tthis.getRows()[0].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRows();\n\t\t}\n\n\t\tRuntime.loadExtension('ui.hint').then(() => {\n\t\t\tconst hint = BX.UI.Hint.createInstance();\n\t\t\tconst node = hint.createNode(Loc.getMessage('INTRANET_INVITATION_GUEST_HINT'));\n\n\t\t\tconst title = document.querySelector('#pagetitle') || this.getTitleContainer();\n\t\t\tDom.append(node, title);\n\t\t});\n\t}\n\n\tgetRows(): Row[]\n\t{\n\t\treturn this.rows;\n\t}\n\n\tlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tunlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tsubmit(): Promise\n\t{\n\t\tlet valid = true;\n\t\tconst guests = [];\n\t\tlet invalidRow = null;\n\t\tthis.getRows().forEach((row: Row) => {\n\n\t\t\tif (!row.validate())\n\t\t\t{\n\t\t\t\tinvalidRow = invalidRow || row;\n\t\t\t\tvalid = false;\n\t\t\t}\n\n\t\t\tif (valid && !row.isEmpty())\n\t\t\t{\n\t\t\t\tguests.push({\n\t\t\t\t\temail: row.getEmail(),\n\t\t\t\t\tname: row.getName(),\n\t\t\t\t\tlastName: row.getLastName()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (!valid)\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_WRONG_DATA'),\n\t\t\t\t'wrong_data',\n\t\t\t\t{ invalidRow }\n\t\t\t));\n\t\t}\n\t\telse if (!Type.isArrayFilled(guests))\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_EMPTY_DATA'),\n\t\t\t\t'empty_data',\n\t\t\t\t{ invalidRow: this.getRows()[0] }\n\t\t\t));\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treturn Ajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.invitation.guest',\n\t\t\t\t'addGuests',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tguests,\n\t\t\t\t\t\tuserOptions: this.userOptions\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\tresponse => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\treason => {\n\t\t\t\t\tconst error =\n\t\t\t\t\t\treason && Type.isArrayFilled(reason.errors)\n\t\t\t\t\t\t\t? reason.errors.map(error => Text.encode(error.message)).join('<br><br>')\n\t\t\t\t\t\t\t: 'Server Response Error'\n\t\t\t\t\t;\n\n\t\t\t\t\treject(new BaseError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\t'wrong_response'\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSaveButton(): ?Button\n\t{\n\t\treturn this.saveButton;\n\t}\n\n\tgetCancelButton(): ?Button\n\t{\n\t\treturn this.cancelButton;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-wrap\">\n\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t<div class=\"invite-content-container\">\n\t\t\t\t\t\t${this.getRowsContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-buttons\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-sm ui-btn-light-border ui-btn-icon-add ui-btn-round\"\n\t\t\t\t\t\t\tonclick=\"${this.handleAddMoreClick.bind(this)}\">${\n\t\t\t\t\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_ADD_MORE')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRowsContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('rows-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-container\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('title-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-title-container\">\n\t\t\t\t\t<div class=\"invite-title-icon invite-title-icon-message\"></div>\n\t\t\t\t\t<div class=\"invite-title-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\taddRow(rowOptions): Row\n\t{\n\t\tconst row = new Row(rowOptions);\n\t\tthis.rows.push(row);\n\t\tDom.append(row.getContainer(), this.getRowsContainer());\n\n\t\treturn row;\n\t}\n\n\taddRows(numberOfRows: number = 5): void\n\t{\n\t\tArray(numberOfRows).fill().forEach((el, index) => {\n\t\t\tconst row = this.addRow();\n\t\t\tif (index === 0)\n\t\t\t{\n\t\t\t\trow.focus();\n\t\t\t}\n\t\t});\n\t}\n\n\tremoveRows(): void\n\t{\n\t\tthis.getRows().forEach((row: Row) => {\n\t\t\tDom.remove(row.getContainer());\n\t\t});\n\n\t\tthis.rows = [];\n\t}\n\n\tshowError(reason: string): void\n\t{\n\t\tconst animate = this.error === null;\n\n\t\tthis.hideError();\n\n\t\tthis.error = new BX.UI.Alert({\n\t\t\tcolor: BX.UI.Alert.Color.DANGER,\n\t\t\tanimated: animate,\n\t\t\ttext: reason\n\t\t});\n\n\t\tDom.prepend(this.error.getContainer(), this.getContainer());\n\t}\n\n\thideError(): void\n\t{\n\t\tif (this.error !== null)\n\t\t{\n\t\t\tDom.remove(this.error.getContainer());\n\t\t\tthis.error = null;\n\t\t}\n\t}\n\n\thandleSaveButtonClick(): void\n\t{\n\t\tif (this.getSaveButton().isWaiting())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSaveButton().setWaiting();\n\n\t\tthis.submit().then(response => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\n\t\t\tthis.hideError();\n\t\t\tthis.removeRows();\n\t\t\tthis.addRows();\n\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'BX.Intranet.Invitation.Guest:onAdd', response.data);\n\t\t\tBX.SidePanel.Instance.close();\n\t\t}).catch((error: BaseError) => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\t\t\tthis.showError(error.getMessage());\n\n\t\t\tif (error.getCustomData() && error.getCustomData()['invalidRow'])\n\t\t\t{\n\t\t\t\terror.getCustomData()['invalidRow'].focus();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleCancelButtonClick(): void\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\thandleAddMoreClick(): void\n\t{\n\t\tconst row = this.addRow();\n\t\trow.focus();\n\t}\n}"],"names":["Row","rowOptions","Cache","MemoryCache","options","Type","isPlainObject","isStringFilled","email","getEmailTextBox","value","name","getNameTextBox","lastName","getLastNameTextBox","trim","getEmail","getName","getLastName","atom","regExp","RegExp","match","Dom","addClass","parentNode","removeClass","focus","cache","remember","Tag","render","Loc","getMessage","Form","formOptions","targetNode","userOptions","append","getContainer","isElementNode","saveButtonNode","saveButton","ButtonManager","createFromNode","bindEvent","handleSaveButtonClick","bind","cancelButtonNode","cancelButton","handleCancelButtonClick","isArrayFilled","rows","forEach","row","addRow","addRows","Math","max","length","getRows","Runtime","loadExtension","then","hint","BX","UI","Hint","createInstance","node","createNode","title","document","querySelector","getTitleContainer","style","valid","guests","invalidRow","validate","isEmpty","push","Promise","reject","BaseError","resolve","Ajax","runComponentAction","mode","json","response","reason","error","errors","map","Text","encode","message","join","getRowsContainer","handleAddMoreClick","numberOfRows","Array","fill","el","index","remove","animate","hideError","Alert","color","Color","DANGER","animated","text","prepend","getSaveButton","isWaiting","setWaiting","submit","removeRows","SidePanel","Instance","postMessageAll","window","data","close","showError","getCustomData"],"mappings":"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"}