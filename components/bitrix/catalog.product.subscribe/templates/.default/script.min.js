(function(e){if(!!e.JCCatalogProductSubscribe){return}var t=function(e){t.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{id:this.id},style:typeof e.style==="object"?e.style:{},text:e.text});this.buttonNode=BX.create("span",{attrs:{className:e.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(t,BX.PopupWindowButton);e.JCCatalogProductSubscribe=function(e){this.buttonId=e.buttonId;this.buttonClass=e.buttonClass;this.jsObject=e.jsObject;this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe/ajax.php";this.alreadySubscribed=e.alreadySubscribed;this.listIdAlreadySubscribed=e.listIdAlreadySubscribed;this.urlListSubscriptions=e.urlListSubscriptions;this.listOldItemId={};this.landingId=e.landingId;this.elemButtonSubscribe=null;this.elemPopupWin=null;this.defaultButtonClass="bx-catalog-subscribe-button";this._elemButtonSubscribeClickHandler=BX.delegate(this.subscribe,this);this._elemHiddenClickHandler=BX.delegate(this.checkSubscribe,this);BX.ready(BX.delegate(this.init,this))};e.JCCatalogProductSubscribe.prototype.init=function(){if(!!this.buttonId){this.elemButtonSubscribe=BX(this.buttonId);this.elemHiddenSubscribe=BX(this.buttonId+"_hidden")}if(!!this.elemButtonSubscribe){BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}if(!!this.elemHiddenSubscribe){BX.bind(this.elemHiddenSubscribe,"click",this._elemHiddenClickHandler)}this.setButton(this.alreadySubscribed);this.setIdAlreadySubscribed(this.listIdAlreadySubscribed)};e.JCCatalogProductSubscribe.prototype.checkSubscribe=function(){if(!this.elemHiddenSubscribe||!this.elemButtonSubscribe)return;if(this.listOldItemId.hasOwnProperty(this.elemButtonSubscribe.dataset.item)){this.setButton(true)}else{BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),checkSubscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item},onsuccess:BX.delegate(function(e){if(e.subscribe){this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else{this.setButton(false)}},this)})}};e.JCCatalogProductSubscribe.prototype.subscribe=function(){this.elemButtonSubscribe=BX.proxy_context;if(!this.elemButtonSubscribe)return false;BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),subscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item,siteId:BX.message("SITE_ID"),landingId:this.landingId},onsuccess:BX.delegate(function(e){if(e.success){this.createSuccessPopup(e);this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else if(e.contactFormSubmit){this.initPopupWindow();this.elemPopupWin.setTitleBar(BX.message("CPST_SUBSCRIBE_POPUP_TITLE"));var s=this.createContentForPopup(e);this.elemPopupWin.setContent(s);this.elemPopupWin.setButtons([new t({text:BX.message("CPST_SUBSCRIBE_BUTTON_NAME"),className:"btn btn-primary",events:{click:BX.delegate(function(){if(!this.validateContactField(e.contactTypeData)){return false}BX.ajax.submitAjax(s,{method:"POST",url:this.ajaxUrl,processData:true,onsuccess:BX.delegate(function(e){e=BX.parseJSON(e,{});if(e.success){this.createSuccessPopup(e);this.setButton(true);this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true}else if(e.error){if(e.hasOwnProperty("setButton")){this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true;this.setButton(true)}var t=e.message;if(e.hasOwnProperty("typeName")){t=e.message.replace("USER_CONTACT",e.typeName)}BX("bx-catalog-subscribe-form-notify").style.color="red";BX("bx-catalog-subscribe-form-notify").innerHTML=t}},this)})},this)}}),new t({text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),className:"btn",events:{click:BX.delegate(function(){this.elemPopupWin.destroy()},this)}})]);this.elemPopupWin.show()}else if(e.error){if(e.hasOwnProperty("setButton")){this.listOldItemId[this.elemButtonSubscribe.dataset.item]=true;this.setButton(true)}this.showWindowWithAnswer({status:"error",message:e.message})}},this)})};e.JCCatalogProductSubscribe.prototype.validateContactField=function(e){var t=BX.findChildren(BX("bx-catalog-subscribe-form"),{tag:"input",attribute:{id:"userContact"}},true);if(!t.length||typeof e!=="object"){BX("bx-catalog-subscribe-form-notify").style.color="red";BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_UNKNOW_ERROR");return false}var s,a,i,r=[],o=[];for(var c=0;c<t.length;c++){s=t[c].getAttribute("data-id");a=t[c].value;i=BX("bx-contact-use-"+s);if(i&&i.value=="N"){o.push(true);continue}if(!a.length){r.push(BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR_EMPTY_FIELD").replace("#FIELD#",e[s].contactLable))}}if(t.length==o.length){BX("bx-catalog-subscribe-form-notify").style.color="red";BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR");return false}if(r.length){BX("bx-catalog-subscribe-form-notify").style.color="red";for(var n=0;n<r.length;n++){BX("bx-catalog-subscribe-form-notify").innerHTML=r[n]}return false}return true};e.JCCatalogProductSubscribe.prototype.reloadCaptcha=function(){BX.ajax.get(this.ajaxUrl+"?reloadCaptcha=Y","",function(e){BX("captcha_sid").value=e;BX("captcha_img").src="/bitrix/tools/captcha.php?captcha_sid="+e+""})};e.JCCatalogProductSubscribe.prototype.createContentForPopup=function(e){if(!e.hasOwnProperty("contactTypeData")){return null}var t=e.contactTypeData,s=Object.keys(t).length,a="",i="N",r=document.createDocumentFragment();if(s>1){i="Y";a="display:none;";r.appendChild(BX.create("p",{text:BX.message("CPST_SUBSCRIBE_MANY_CONTACT_NOTIFY")}))}r.appendChild(BX.create("p",{props:{id:"bx-catalog-subscribe-form-notify"}}));for(var o in t){if(s>1){r.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("div",{props:{className:"checkbox"},children:[BX.create("lable",{props:{className:"bx-filter-param-label"},attrs:{onclick:this.jsObject+".selectContactType("+o+", event);"},children:[BX.create("input",{props:{type:"hidden",id:"bx-contact-use-"+o,name:"contact["+o+"][use]",value:"N"}}),BX.create("input",{props:{id:"bx-contact-checkbox-"+o,type:"checkbox"}}),BX.create("span",{props:{className:"bx-filter-param-text"},text:t[o].contactLable})]})]})]}))}r.appendChild(BX.create("div",{props:{id:"bx-catalog-subscribe-form-container-"+o,className:"bx-catalog-subscribe-form-container",style:a},children:[BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-label"},text:BX.message("CPST_SUBSCRIBE_LABLE_CONTACT_INPUT").replace("#CONTACT#",t[o].contactLable)}),BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-input"},children:[BX.create("input",{props:{id:"userContact",className:"",type:"text",name:"contact["+o+"][user]"},attrs:{"data-id":o}})]})]}))}if(e.hasOwnProperty("captchaCode")){r.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-form-star-required"},text:"*"}),BX.message("CPST_ENTER_WORD_PICTURE"),BX.create("div",{props:{className:"bx-captcha"},children:[BX.create("input",{props:{type:"hidden",id:"captcha_sid",name:"captcha_sid",value:e.captchaCode}}),BX.create("img",{props:{id:"captcha_img",src:"/bitrix/tools/captcha.php?captcha_sid="+e.captchaCode+""},attrs:{width:"180",height:"40",alt:"captcha",onclick:this.jsObject+".reloadCaptcha();"}})]}),BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-input"},children:[BX.create("input",{props:{id:"captcha_word",className:"",type:"text",name:"captcha_word"},attrs:{maxlength:"50"}})]})]}))}var c=BX.create("form",{props:{id:"bx-catalog-subscribe-form"},children:[BX.create("input",{props:{type:"hidden",name:"manyContact",value:i}}),BX.create("input",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("input",{props:{type:"hidden",name:"itemId",value:this.elemButtonSubscribe.dataset.item}}),BX.create("input",{props:{type:"hidden",name:"landingId",value:this.landingId}}),BX.create("input",{props:{type:"hidden",name:"siteId",value:BX.message("SITE_ID")}}),BX.create("input",{props:{type:"hidden",name:"contactFormSubmit",value:"Y"}})]});c.appendChild(r);return c};e.JCCatalogProductSubscribe.prototype.selectContactType=function(t,s){var a=BX("bx-catalog-subscribe-form-container-"+t),i="",r=BX("bx-contact-checkbox-"+t);if(!a){return false}if(r!=s.target){if(r.checked){r.checked=false}else{r.checked=true}}if(a.currentStyle){i=a.currentStyle.display}else if(e.getComputedStyle){var o=e.getComputedStyle(a,null);i=o.getPropertyValue("display")}if(i==="none"){BX("bx-contact-use-"+t).value="Y";BX.style(a,"display","")}else{BX("bx-contact-use-"+t).value="N";BX.style(a,"display","none")}};e.JCCatalogProductSubscribe.prototype.createSuccessPopup=function(e){this.initPopupWindow();this.elemPopupWin.setTitleBar(BX.message("CPST_SUBSCRIBE_POPUP_TITLE"));var s=BX.create("div",{props:{className:"bx-catalog-popup-content"},children:[BX.create("p",{props:{className:"bx-catalog-popup-message"},text:e.message})]});this.elemPopupWin.setContent(s);this.elemPopupWin.setButtons([new t({text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),className:"btn btn-primary",events:{click:BX.delegate(function(){this.elemPopupWin.destroy()},this)}})]);this.elemPopupWin.show()};e.JCCatalogProductSubscribe.prototype.initPopupWindow=function(){this.elemPopupWin=BX.PopupWindowManager.create("CatalogSubscribe_"+this.buttonId,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:true,contentColor:"white"})};e.JCCatalogProductSubscribe.prototype.setButton=function(e){this.alreadySubscribed=Boolean(e);if(this.alreadySubscribed){this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass+" disabled";this.elemButtonSubscribe.innerHTML="<span>"+BX.message("CPST_TITLE_ALREADY_SUBSCRIBED")+"</span>";BX.unbind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}else{this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass;this.elemButtonSubscribe.innerHTML="<span>"+BX.message("CPST_SUBSCRIBE_BUTTON_NAME")+"</span>";BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)}};e.JCCatalogProductSubscribe.prototype.setIdAlreadySubscribed=function(e){if(BX.type.isPlainObject(e)){this.listOldItemId=e}};e.JCCatalogProductSubscribe.prototype.showWindowWithAnswer=function(e){e=e||{};if(!e.message){if(e.status=="success"){e.message=BX.message("CPST_STATUS_SUCCESS")}else{e.message=BX.message("CPST_STATUS_ERROR")}}var t=BX.create("div",{props:{className:"bx-catalog-subscribe-alert"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:e.message}),BX.create("div",{props:{className:"bx-catalog-subscribe-alert-footer"}})]});var s=BX.PopupWindowManager.getCurrentPopup();if(s){s.destroy()}var a=setTimeout(function(){var e=BX.PopupWindowManager.getCurrentPopup();if(!e||e.uniquePopupId!="bx-catalog-subscribe-status-action"){return}e.close();e.destroy()},3500);var i=BX.PopupWindowManager.create("bx-catalog-subscribe-status-action",null,{content:t,onPopupClose:function(){this.destroy();clearTimeout(a)},autoHide:true,zIndex:2e3,className:"bx-catalog-subscribe-alert-popup"});i.show();BX("bx-catalog-subscribe-status-action").onmouseover=function(e){clearTimeout(a)};BX("bx-catalog-subscribe-status-action").onmouseout=function(e){a=setTimeout(function(){var e=BX.PopupWindowManager.getCurrentPopup();if(!e||e.uniquePopupId!="bx-catalog-subscribe-status-action"){return}e.close();e.destroy()},3500)}}})(window);
//# sourceMappingURL=script.map.js