(function(e,t,i,l,a){"use strict";var r;var s=t.Reflection.namespace("BX.Bizproc.Component");var n=function(){function e(i){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(i)){this.oldProperty=i.property;this.documentType=i.documentType;this.signedDocumentType=i.signedDocumentType;this.mode=i.mode;this.availableTypes=i.types;this.inputValueId=i.inputValueId;this.multipleNode=i.multipleNode;this.saveButtonNode=i.saveButtonNode;this.form=i.form;this.slider=i.slider}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.sliderDict=this.slider?this.slider.getData():null;this.correspondenceModeToIdName={constant:"Constant",variable:"Variable"};this.editInputValue(this.oldProperty["Type"],this.oldProperty);t.Event.bind(this.saveButtonNode,"click",this.saveHandler.bind(this))}},{key:"editInputValue",value:function e(i,l){var a=BX.clone(l);var s={Type:i!==null&&i!==void 0?i:"string",Multiple:false,Default:""};if(this.availableTypes[s.Type]===undefined){s.Type=Object.keys(this.availableTypes)[0]}if(!t.Type.isPlainObject(l)){a=s}else{if(t.Type.isString(l["Multiple"])){a["Multiple"]=l["Multiple"]==="Y"}a=babelHelpers.objectSpread({},s,a)}this.multipleNode.value=a["Multiple"]?"Y":"N";if(a.Type==="select"&&l.Options===undefined){var n;a.Options=(n=this.oldProperty.Options)!==null&&n!==void 0?n:{}}var o=BX.Bizproc.FieldType.renderControl(this.documentType,a,"VALUE",a["Default"],"public");o.className="ui-ctl ui-ctl-textbox ui-ctl-w100 global-fields-max-width";o.id=this.inputValueId;var u=document.getElementById(this.inputValueId);if(u){u.replaceWith(o)}if(a.Type!=="select"&&document.getElementById("bizproc_globEditComponent")){document.getElementById("bizproc_globEditComponent").remove();this.oldProperty.Options={}}else if(a.Type==="select"&&!document.getElementById("bizproc_globEditComponent")){var d=t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100" id="bizproc_globEditComponent"></div>'])));var p=BX.Bizproc.FieldType.createControlOptions(a,this.setSelectOptionFromForm.bind(this));p.className="ui-form-label";d.appendChild(p);d.getElementsByTagName("textarea")[0].className="ui-ctl-element ui-ctl-textarea ui-ctl-resize-y ui-ctl-w100";d.getElementsByTagName("textarea")[0].style.paddingTop="6px";d.getElementsByTagName("button")[0].className="ui-btn ui-btn-xs ui-btn-light-border";o.before(d)}if(!a["Multiple"]){document.getElementsByName("VALUE")[0].placeholder=t.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY");return}if(a["Type"]==="user"){return}var c=document.getElementsByName("VALUE[]");for(var m in c){if(c.hasOwnProperty(m)){c[m].placeholder=t.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY")}}if(o.getElementsByTagName("a").length>0){var y=o.getElementsByTagName("a")[0];BX.bind(y,"click",function(){var e=document.getElementsByName("VALUE[]");var i=BX.clone(e[e.length-1]);if(a["Type"]!=="date"&&a["Type"]!=="datetime"){var l=e[e.length-1].parentNode;if(l){l.remove()}o.insertBefore(i,y.parentNode)}e[e.length-1].placeholder=t.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY")})}}},{key:"setSelectOptionFromForm",value:function e(t){this.oldProperty.Options=t;this.editInputValue("select",{Options:t,Type:"select",Multiple:this.multipleNode.value})}},{key:"saveHandler",value:function e(){var t=this.form.elements;var l=t["ID"].value;var r={Name:t["NAME"].value,Description:t["DESCRIPTION"].value,Type:t["TYPE"].value,Options:"",Default:this.getValues(t),Visibility:t["VISIBILITY"].value,Multiple:t["MULTIPLE"].value,Required:"N",CreatedBy:this.oldProperty["CreatedBy"]?this.oldProperty["CreatedBy"]:null,CreatedDate:this.oldProperty["CreatedDate"]?this.oldProperty["CreatedDate"]:null};if(!this.validateName(r.Name)){return true}if(!l){var s=new Date;l=this.correspondenceModeToIdName[this.mode]+s.getTime().toString()}if(this.oldProperty.Options){r.Options=this.oldProperty.Options}var n=this;a.Globals.Manager.Instance.upsertGlobalsAction(l,r,this.signedDocumentType,this.mode).then(function(e){if(e.data&&e.data.error){i.MessageBox.alert(e.data.error,function(){BX.removeClass(n.saveButtonNode,"ui-btn-wait");return true})}else{n.sliderDict.set(l,r);n.slider.close()}});return true}},{key:"getValues",value:function e(i){if(i["VALUE"]){return i["VALUE"].value}if(i["VALUE[]"]){var l=i["VALUE[]"];var a=[];if(t.Type.isElementNode(l)){if(l.tagName!=="SELECT"){return l.value}for(var r in Object.keys(l.selectedOptions)){a.push(l.selectedOptions[r].value)}return a}for(var s in l){if(l.hasOwnProperty(s)){a.push(l[s].value)}}return a}}},{key:"validateName",value:function e(t){var l=this;if(!t){i.MessageBox.alert(BX.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY_NAME"),function(){BX.removeClass(l.saveButtonNode,"ui-btn-wait");return true});return false}return true}}]);return e}();s.GlobalFieldEditComponent=n})(this.window=this.window||{},BX,BX.UI.Dialogs,BX,BX.Bizproc);
//# sourceMappingURL=script.map.js