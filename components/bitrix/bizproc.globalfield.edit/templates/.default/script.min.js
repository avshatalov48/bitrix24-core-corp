(function(e,t,i,r,l){"use strict";var n;function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var s=t.Reflection.namespace("BX.Bizproc.Component");var u=function(){function e(i){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(i)){this.oldProperty=i.property;this.documentType=i.documentType;this.signedDocumentType=i.signedDocumentType;this.mode=i.mode;this.availableTypes=i.types;this.inputValueId=i.inputValueId;this.multipleNode=i.multipleNode;this.saveButtonNode=i.saveButtonNode;this.form=i.form;this.slider=i.slider}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.sliderDict=this.slider?this.slider.getData():null;this.correspondenceModeToIdName={constant:"Constant",variable:"Variable"};this.editInputValue(this.oldProperty["Type"],this.oldProperty);t.Event.bind(this.saveButtonNode,"click",this.saveHandler.bind(this))}},{key:"editInputValue",value:function e(i,r){var l=t.Runtime.clone(r);var o={Type:i!==null&&i!==void 0?i:"string",Multiple:false,Default:"",Placeholder:t.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY")};if(this.availableTypes[o.Type]===undefined){o.Type=Object.keys(this.availableTypes)[0]}if(!t.Type.isPlainObject(r)){l=o}else{if(t.Type.isString(r["Multiple"])){l["Multiple"]=r["Multiple"]==="Y"}l=a(a({},o),l)}this.multipleNode.value=l["Multiple"]?"Y":"N";if(l.Type==="select"&&r.Options===undefined){var s;l.Options=(s=this.oldProperty.Options)!==null&&s!==void 0?s:{}}var u=BX.Bizproc.FieldType.renderControl(this.documentType,l,"VALUE",l["Default"],"public");u.className="ui-ctl ui-ctl-textbox ui-ctl-w100";u.id=this.inputValueId;var p=document.getElementById(this.inputValueId);if(p){p.replaceWith(u)}if(l.Type!=="select"&&document.getElementById("bizproc_globEditComponent")){document.getElementById("bizproc_globEditComponent").remove();this.oldProperty.Options={}}else if(l.Type==="select"&&!document.getElementById("bizproc_globEditComponent")){var d=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100" id="bizproc_globEditComponent"></div>'])));var c=BX.Bizproc.FieldType.createControlOptions(l,this.setSelectOptionFromForm.bind(this));c.className="ui-form-label";t.Dom.append(c,d);d.getElementsByTagName("textarea")[0].className="ui-ctl-element ui-ctl-textarea ui-ctl-resize-y ui-ctl-w100";t.Dom.style(d.getElementsByTagName("textarea")[0],"paddingTop","6px");d.getElementsByTagName("button")[0].className="ui-btn ui-btn-xs ui-btn-light-border";u.before(d)}if(l["Type"]==="user"){return}if(u.getElementsByTagName("a").length>0){var m=u.getElementsByTagName("a")[0];t.Event.bind(m,"click",(function(){var e=document.getElementsByName("VALUE[]");var i=t.Runtime.clone(e[e.length-1]);if(l["Type"]!=="date"&&l["Type"]!=="datetime"){var r=e[e.length-1].parentNode;if(r){r.remove()}t.Dom.insertBefore(i,m.parentNode)}}))}}},{key:"setSelectOptionFromForm",value:function e(t){this.oldProperty.Options=t;this.editInputValue("select",{Options:t,Type:"select",Multiple:this.multipleNode.value})}},{key:"saveHandler",value:function e(){var r=this.form.elements;var n=r["ID"].value;var o={Name:r["NAME"].value,Description:r["DESCRIPTION"].value,Type:r["TYPE"].value,Options:"",Default:this.getValues(r),Visibility:r["VISIBILITY"].value,Multiple:r["MULTIPLE"].value,Required:"N",CreatedBy:this.oldProperty["CreatedBy"]?this.oldProperty["CreatedBy"]:null,CreatedDate:this.oldProperty["CreatedDate"]?this.oldProperty["CreatedDate"]:null};if(!this.validateName(o.Name)){return true}if(!n){var a=new Date;n=this.correspondenceModeToIdName[this.mode]+a.getTime().toString()}if(this.oldProperty.Options){o.Options=this.oldProperty.Options}var s=this;l.Globals.Manager.Instance.upsertGlobalsAction(n,o,this.signedDocumentType,this.mode).then((function(e){if(e.data&&e.data.error){i.MessageBox.alert(e.data.error,(function(){t.Dom.removeClass(s.saveButtonNode,"ui-btn-wait");return true}))}else{s.sliderDict.set(n,o);s.slider.close()}}));return true}},{key:"getValues",value:function e(i){if(i["VALUE"]){return i["VALUE"].value}if(i["VALUE[]"]){var r=i["VALUE[]"];var l=[];if(t.Type.isElementNode(r)){if(r.tagName!=="SELECT"){return r.value}for(var n in Object.keys(r.selectedOptions)){l.push(r.selectedOptions[n].value)}return l}for(var o in r){if(r.hasOwnProperty(o)){l.push(r[o].value)}}return l}}},{key:"validateName",value:function e(r){var l=this;if(!r){i.MessageBox.alert(BX.Loc.getMessage("BIZPROC_GLOBALFIELD_EDIT_TMP_EMPTY_NAME"),(function(){t.Dom.removeClass(l.saveButtonNode,"ui-btn-wait");return true}));return false}return true}}]);return e}();s.GlobalFieldEditComponent=u})(this.window=this.window||{},BX,BX.UI.Dialogs,BX,BX.Bizproc);
//# sourceMappingURL=script.map.js