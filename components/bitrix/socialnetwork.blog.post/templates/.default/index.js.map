{"version":3,"file":"index.js","sources":["src/blog-copilot-readonly.js"],"sourcesContent":["import { Dom, Event, Loc, Runtime, Tag } from 'main.core';\n\ntype Params = {\n\tcontainer: HTMLElement,\n\tblogText: string,\n\tenabledBySettings: string,\n\tcopilotParams: {\n\t\tmoduleId: string,\n\t\tcontextId: string,\n\t\tcategory: string,\n\t},\n};\n\nexport class BlogCopilotReadonly\n{\n\t#params: Params;\n\n\t#layout: {\n\t\tbutton: HTMLElement,\n\t};\n\n\t#copilotLoaded: boolean;\n\t#copilotReadonly: any;\n\t#copilotShown: boolean;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\n\t\tif (this.#enabledBySettings())\n\t\t{\n\t\t\tthis.#createCopilot();\n\t\t}\n\n\t\tDom.append(this.#render(), this.#params.container);\n\t}\n\n\t#render()\n\t{\n\t\tthis.#layout.button = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"feed-inform-item feed-inform-comments feed-copilot-readonly\"\n\t\t\t\tdata-id=\"blog-post-button-copilot\"\n\t\t\t>\n\t\t\t\t<a>${Loc.getMessage('BLOG_POST_BUTTON_COPILOT')}</a>\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(this.#layout.button, 'mousedown', this.#onButtonMouseDown.bind(this));\n\t\tEvent.bind(this.#layout.button, 'click', this.#onButtonClick.bind(this));\n\n\t\treturn this.#layout.button;\n\t}\n\n\tasync #createCopilot(): void\n\t{\n\t\tconst { Copilot } = await Runtime.loadExtension('ai.copilot');\n\n\t\tthis.#copilotReadonly = new Copilot({\n\t\t\tmoduleId: this.#params.copilotParams.moduleId,\n\t\t\tcontextId: this.#params.copilotParams.contextId,\n\t\t\tcategory: this.#params.copilotParams.category,\n\t\t\treadonly: true,\n\t\t\tautoHide: true,\n\t\t});\n\n\t\tthis.#copilotReadonly.subscribe('finish-init', () => {\n\t\t\tthis.#copilotLoaded = true;\n\t\t});\n\n\t\tthis.#copilotReadonly.init();\n\t}\n\n\t#onButtonMouseDown()\n\t{\n\t\tif (!this.#enabledBySettings())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#copilotShown = this.#copilotReadonly?.isShown();\n\t}\n\n\t#onButtonClick()\n\t{\n\t\tif (!this.#enabledBySettings())\n\t\t{\n\t\t\tBX.UI.InfoHelper.show('limit_copilot_off');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#copilotShown)\n\t\t{\n\t\t\tthis.#hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#show();\n\t\t}\n\t}\n\n\t#show()\n\t{\n\t\tif (this.#copilotLoaded)\n\t\t{\n\t\t\tthis.#copilotReadonly.setContext(this.#params.blogText);\n\n\t\t\tconst buttonRect = this.#layout.button.getBoundingClientRect();\n\t\t\tthis.#copilotReadonly.show({\n\t\t\t\tbindElement: {\n\t\t\t\t\tleft: buttonRect.left + window.scrollX,\n\t\t\t\t\ttop: buttonRect.bottom + window.scrollY + 10,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t#hide()\n\t{\n\t\tthis.#copilotReadonly.hide();\n\t}\n\n\t#enabledBySettings()\n\t{\n\t\treturn this.#params.enabledBySettings === 'Y';\n\t}\n}"],"names":["BlogCopilotReadonly","constructor","params","Dom","append","container","button","Tag","render","Loc","getMessage","Event","bind","Copilot","Runtime","loadExtension","moduleId","copilotParams","contextId","category","readonly","autoHide","subscribe","init","isShown","BX","UI","InfoHelper","show","setContext","blogText","buttonRect","getBoundingClientRect","bindElement","left","window","scrollX","top","bottom","scrollY","hide","enabledBySettings"],"mappings":";;;;;;;;AAAA,CAA0D;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAa1D,CAAO,MAAMA,mBAAmB,CAChC;GAWCC,WAAW,CAACC,MAAc,EAC1B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,sBAAWA,MAAM;KACrB,4CAAI,sBAAW,EAAE;KAEjB,4CAAI,IAAI,6CACR;OACC,4CAAI;;KAGLC,aAAG,CAACC,MAAM,yCAAC,IAAI,uBAAY,4CAAI,oBAASC,SAAS,CAAC;;CA6FpD;CAAC,oBAzFA;GACC,4CAAI,oBAASC,MAAM,GAAGC,aAAG,CAACC,MAAM,cAAC;;;;;SAK5B,CAA6C;;GAElD,GAFOC,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAEhD;GAEDC,eAAK,CAACC,IAAI,CAAC,4CAAI,oBAASN,MAAM,EAAE,WAAW,EAAE,4CAAI,0CAAoBM,IAAI,CAAC,IAAI,CAAC,CAAC;GAChFD,eAAK,CAACC,IAAI,CAAC,4CAAI,oBAASN,MAAM,EAAE,OAAO,EAAE,4CAAI,kCAAgBM,IAAI,CAAC,IAAI,CAAC,CAAC;GAExE,OAAO,4CAAI,oBAASN,MAAM;CAC3B;CAAC,iCAGD;GACC,MAAM;KAAEO;IAAS,GAAG,MAAMC,iBAAO,CAACC,aAAa,CAAC,YAAY,CAAC;GAE7D,4CAAI,wCAAoB,IAAIF,OAAO,CAAC;KACnCG,QAAQ,EAAE,4CAAI,oBAASC,aAAa,CAACD,QAAQ;KAC7CE,SAAS,EAAE,4CAAI,oBAASD,aAAa,CAACC,SAAS;KAC/CC,QAAQ,EAAE,4CAAI,oBAASF,aAAa,CAACE,QAAQ;KAC7CC,QAAQ,EAAE,IAAI;KACdC,QAAQ,EAAE;IACV,CAAC;GAEF,4CAAI,sCAAkBC,SAAS,CAAC,aAAa,EAAE,MAAM;KACpD,4CAAI,oCAAkB,IAAI;IAC1B,CAAC;GAEF,4CAAI,sCAAkBC,IAAI,EAAE;CAC7B;CAAC,+BAGD;GAAA;GACC,IAAI,yCAAC,IAAI,2CAAqB,EAC9B;KACC;;GAGD,4CAAI,mGAAiB,IAAI,0DAAJ,sBAAuBC,OAAO,EAAE;CACtD;CAAC,2BAGD;GACC,IAAI,yCAAC,IAAI,2CAAqB,EAC9B;KACCC,EAAE,CAACC,EAAE,CAACC,UAAU,CAACC,IAAI,CAAC,mBAAmB,CAAC;KAE1C;;GAGD,4CAAI,IAAI,iCACR;KACC,4CAAI;IACJ,MAED;KACC,4CAAI;;CAEN;CAAC,kBAGD;GACC,4CAAI,IAAI,mCACR;KACC,4CAAI,sCAAkBC,UAAU,CAAC,4CAAI,oBAASC,QAAQ,CAAC;KAEvD,MAAMC,UAAU,GAAG,4CAAI,oBAASzB,MAAM,CAAC0B,qBAAqB,EAAE;KAC9D,4CAAI,sCAAkBJ,IAAI,CAAC;OAC1BK,WAAW,EAAE;SACZC,IAAI,EAAEH,UAAU,CAACG,IAAI,GAAGC,MAAM,CAACC,OAAO;SACtCC,GAAG,EAAEN,UAAU,CAACO,MAAM,GAAGH,MAAM,CAACI,OAAO,GAAG;;MAE3C,CAAC;;CAEJ;CAAC,kBAGD;GACC,4CAAI,sCAAkBC,IAAI,EAAE;CAC7B;CAAC,+BAGD;GACC,OAAO,4CAAI,oBAASC,iBAAiB,KAAK,GAAG;CAC9C;;;;;;;;"}