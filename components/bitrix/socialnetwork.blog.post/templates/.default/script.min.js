function showHiddenDestination(t,e){BX.hide(e);BX("blog-destination-hidden-"+t).style.display="inline"}function showMenuLinkInput(t,e){var i="post-menu-"+t+"-link",o=BX(i+"-text"),s=BX(i+"-icon-done");if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e);if(o&&s){s.style.display="inline-block";BX.removeClass(BX(i+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(o,{attrs:{"data-block-click":"Y"}});setTimeout((function(){BX.addClass(BX(i+"-icon-animate"),"post-menu-link-icon-animate")}),1);setTimeout((function(){BX.adjust(o,{attrs:{"data-block-click":"N"}})}),500)}return}var n=BX.proxy_context,a=parseInt(!!n.getAttribute("bx-height")?n.getAttribute("bx-height"):n.offsetHeight);if(n.getAttribute("bx-status")!="shown"){n.setAttribute("bx-status","shown");if(!BX(i)&&!!BX(i+"-text")){var r=BX(i+"-text"),p=BX.pos(r),l=BX.pos(r.parentNode);pos3=BX.pos(BX.findParent(r,{className:"menu-popup-item"},true));p["height"]=l["height"]-1;BX.adjust(n,{attrs:{"bx-height":n.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:i},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:i+"-input",type:"text",value:e},style:{height:p["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(t){this.select();BX.PreventDefault(t)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate((function(t){this.style.height=t+"px"}),n)}).start();BX.fx.show(BX(i),.2);BX(i+"-input").select()}else{n.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:n.offsetHeight,finish:a,callback:BX.delegate((function(t){this.style.height=t+"px"}),n)}).start();BX.fx.hide(BX(i),.2)}}function deleteBlogPost(t){var e=BX("blg-post-"+t);if(BX.findChild(e,{attr:{id:"form_c_del"}},true,false)){BX.hide(BX("form_c_del"));BX(e.parentNode.parentNode).appendChild(BX("form_c_del"))}BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.delete",{data:{id:t}}).then(function(){BX.Livefeed.FeedInstance.deleteSuccess(document.getElementById("blg-post-"+t))}.bind(this),function(t){BX.findChild(e,{className:"feed-post-cont-wrap"},true,false).insertBefore(BX.create("span",{children:[BX.create("div",{props:{className:"feed-add-error"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{props:{className:"feed-add-info-text"},html:t.errors[0].message})]})]}),BX.findChild(e,{className:"feed-user-avatar"},true,false))}.bind(this));return false}var waitPopupBlogImage=null;function blogShowImagePopup(t){if(!waitPopupBlogImage){waitPopupBlogImage=new BX.PopupWindow("blogwaitPopupBlogImage",window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("IMG",{props:{src:t,id:"blgimgppp"}}),closeByEsc:true,closeIcon:true})}else{BX("blgimgppp").src="/bitrix/images/1.gif";BX("blgimgppp").src=t}waitPopupBlogImage.setOffset({offsetTop:0,offsetLeft:0});setTimeout((function(){waitPopupBlogImage.adjustPosition()}),100);waitPopupBlogImage.show()}function __blogPostSetFollow(t){return BX.Livefeed.FeedInstance.changeFollow({logId:t})}(function(){if(!!BX.SBPostMenu)return false;BX.SBPostMenu=function(t){};BX.SBPostMenu.showMenu=function(params){if(typeof params=="undefined"||typeof params.event==="undefined"){return false}var bindNode=params.event.currentTarget;if(!BX.type.isDomNode(bindNode)){return false}var menuNode=params.menuNode;if(!BX.type.isDomNode(menuNode)){return false}var postId=parseInt(menuNode.getAttribute("data-bx-post-id"));if(postId<=0){return false}BX.PopupMenu.destroy("blog-post-"+postId);var isPublicPage=menuNode.getAttribute("data-bx-public-page");isPublicPage=isPublicPage==="Y";var isTasksAvailable=menuNode.getAttribute("data-bx-tasks-available");isTasksAvailable=isTasksAvailable==="Y";var isGroupReadOnly=menuNode.getAttribute("data-bx-group-read-only");isGroupReadOnly=isGroupReadOnly==="Y";var items=menuNode.getAttribute("data-bx-items");try{items=JSON.parse(items);if(!BX.type.isPlainObject(items)){items={}}}catch(t){items={}}var pathToPost=menuNode.getAttribute("data-bx-path-to-post");var urlToEdit=menuNode.getAttribute("data-bx-path-to-edit");var urlToHide=menuNode.getAttribute("data-bx-path-to-hide");var urlToDelete=menuNode.getAttribute("data-bx-path-to-delete");var urlToPub=menuNode.getAttribute("data-bx-path-to-pub");var voteId=parseInt(menuNode.getAttribute("data-bx-vote-id"));var postType=menuNode.getAttribute("data-bx-post-type");var serverName=menuNode.getAttribute("data-bx-server-name");if(BX.type.isNotEmptyString(urlToHide)){urlToHide=BX.util.remove_url_param(urlToHide,["b24statAction"]);urlToHide=BX.util.add_url_param(urlToHide,{b24statAction:"hidePost"})}if(isPublicPage){return false}var menuWaiterPopup=new BX.PopupWindow("blog-post-"+postId+"-waiter",bindNode,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});setTimeout((function(){if(menuWaiterPopup){menuWaiterPopup.show()}}),300);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.getData",{data:{params:{postId:postId,public:isPublicPage?"Y":"N",mobile:"N",groupReadOnly:isGroupReadOnly?"Y":"N",pathToPost:pathToPost,voteId:voteId,checkModeration:"Y"}}}).then((function(response){var postData=response.data;if(postData.perms<="D"&&items.length<=0){menuWaiterPopup.destroy();return false}var menuItems=[];if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isPinned=parseInt(postData.logPinnedUserId)>0;menuItems.push({text:BX.message(isPinned?"SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_Y":"SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_N"),onclick:function(t){BX.Livefeed.PinnedPanelInstance.changePinned({logId:parseInt(postData.logId),newState:isPinned?"N":"Y",event:t,node:bindNode});this.popupWindow.close();return t.preventDefault()}})}if(postData.isGroupReadOnly!="Y"&&parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isFavorites=parseInt(postData.logFavoritesUserId)>0;menuItems.push({text:BX.message(isFavorites?"SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y":"SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N"),onclick:function(t){__logChangeFavorites(parseInt(postData.logId),"log_entry_favorites_"+parseInt(postData.logId),isFavorites?"N":"Y",true,t);return false}})}menuItems.push({text:BX.message("BLOG_HREF"),href:postData.urlToPost,class:"feed-entry-popup-menu-link",target:"_top"});menuItems.push({html:'<span id="post-menu-'+postData.logId+'-link-text">'+BX.message("BLOG_LINK")+"</span>"+'<span id="post-menu-'+postData.logId+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+postData.logId+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(t){showMenuLinkInput(parseInt(postData.logId),serverName+postData.urlToPost);return false},class:"feed-entry-popup-menu-link"});if(parseInt(BX.message("USER_ID"))>0&&postData.isGroupReadOnly!="Y"&&postData.isShareForbidden!="Y"){menuItems.push({text:BX.message("BLOG_SHARE"),onclick:function(){showSharing(postId,parseInt(postData.authorId));this.popupWindow.close()}})}}if(postData.perms>="W"||postData.perms>="P"&&postData.authorId==BX.message("USER_ID")){var editParams={text:BX.message("BLOG_BLOG_BLOG_EDIT")};if(BX.type.isNotEmptyString(postData.backgroundCode)){editParams.onclick=function(){BX.Livefeed.Post.showBackgroundWarning({urlToEdit:urlToEdit,menuPopupWindow:this.popupWindow})}}else{editParams.href=urlToEdit;editParams.target="_top"}menuItems.push(editParams)}if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(postData.perms>="T"){menuItems.push({text:BX.message("BLOG_MES_HIDE"),onclick:function(){if(confirm(BX.message("BLOG_MES_HIDE_POST_CONFIRM"))){window.location=urlToHide;this.popupWindow.close()}}})}if(isTasksAvailable&&postData.perms>"D"){menuItems.push({text:BX.message("BLOG_POST_CREATE_TASK"),onclick:function(t){BX.Livefeed.TaskCreator.create({entityType:"BLOG_POST",entityId:postId});this.popupWindow.close();return t.preventDefault()}})}if(typeof BX.Landing!=="undefined"){if(typeof BX.Landing.UI.Note.Menu.getMenuItem!=="undefined"){menuItems.push(BX.Landing.UI.Note.Menu.getMenuItem("blog",postId))}}if(postData.urlToVoteExport.length>0){menuItems.push({text:BX.message("BLOG_POST_VOTE_EXPORT"),href:postData.urlToVoteExport,target:"_top"})}}if(postType=="DRAFT"&&postData.allowModerate=="Y"&&BX.type.isNotEmptyString(urlToPub)){menuItems.push({text:BX.message("BLOG_POST_MOD_PUB"),href:urlToPub,target:"_top"})}if(postData.perms>="W"){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_DELETE"),onclick:function(){if(confirm(BX.message("BLOG_MES_DELETE_POST_CONFIRM"))){if(urlToDelete.length>0){window.location=urlToDelete.replace("#del_post_id#",postId)}else{window.deleteBlogPost(postId)}this.popupWindow.close()}}})}var onclickHandler=null,menuItem=null,item=null;for(var key in items){if(items.hasOwnProperty(key)){item=items[key];menuItem={};if(typeof item.text_php!="undefined"){menuItem.text=item.text_php}if(typeof item.onclick!="undefined"){eval("onclickHandler = "+item.onclick);menuItem.onclick=onclickHandler}else if(typeof item.href!="undefined"){menuItem.href=item.href}menuItems.push(menuItem)}}menuWaiterPopup.destroy();BX.PopupMenu.show("blog-post-"+postId,bindNode,menuItems,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{}});return false}),(function(t){menuWaiterPopup.destroy();return false}))}})();(function(){if(!!window.SBPImpPost)return false;window.SBPImpPost=function(t){if(t.getAttribute("sbpimppost")=="Y")return false;this.CID="sbpimppost"+(new Date).getTime();this.busy=false;this.node=t;this.btn=t.parentNode;this.block=t.parentNode.parentNode;this.postId=t.getAttribute("bx-blog-post-id");t.setAttribute("sbpimppost","Y");BX.onCustomEvent(this.node,"onInit",[this]);if(this.postId>0)this.onclick();return false};window.SBPImpPost.prototype.onclick=function(){this.sendData()};window.SBPImpPost.prototype.showClick=function(){var t=this.btn.offsetWidth,e=BX.message("BLOG_ALREADY_READ"),i=BX.create("span",{props:{className:"have-read-text-block"},html:"<i></i>"+e+'<span class="feed-imp-post-footer-comma">,</span>'});this.block.style.minWidth=this.btn.offsetWidth-27+"px";var o=new BX.easing({duration:250,start:{width:t},finish:{width:1},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(t){this.btn.style.width=t.width+"px"}),this),complete:BX.delegate((function(){this.btn.innerHTML="";this.btn.appendChild(i);var t=i.scrollWidth+31;var e=new BX.easing({duration:300,start:{width_2:0},finish:{width_2:t},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(t){this.btn.style.width=t.width_2+"px"}),this)});e.animate()}),this)});o.animate()};window.SBPImpPost.prototype.wait=function(t){t=t=="show"?"show":"hide";if(t=="show"){this.node.disabled=true;BX.addClass(this.node,"ui-btn-clock")}else{BX.removeClass(this.node,"ui-btn-clock")}};window.SBPImpPost.prototype.sendData=function(){if(this.busy)return false;this.busy=true;window["node"]=this.node;window["obj"]=this;this.wait("show");var t={options:[{post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()};BX.onCustomEvent(this.node,"onSend",[t]);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.vote",{data:{params:{POST_ID:this.postId}}}).then(function(e){if(!BX.type.isNotEmptyString(e.data.success)||e.data.success!="Y"){return false}this.busy=false;this.wait("hide");this.showClick();BX.onCustomEvent("onImportantPostRead",[this.postId,this.CID]);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.getUsers",{data:{params:{POST_ID:this.postId,NAME:"BLOG_POST_IMPRTNT",VALUE:"Y",PAGE_NUMBER:t.iNumPage,PATH_TO_USER:t.PATH_TO_USER,NAME_TEMPLATE:t.NAME_TEMPLATE}}}).then(function(t){var e=t.data;BX.onCustomEvent(this.node,"onUserVote",[e])}.bind(this),function(t){}.bind(this))}.bind(this),function(t){this.busy=false;this.wait("hide")}.bind(this))};top.SBPImpPostCounter=function(t,e,i){this.parentNode=t;this.node=BX.findChild(t,{tagName:"A"});if(!this.node)return false;BX.addCustomEvent(this.node,"onUserVote",BX.delegate((function(t){this.change(t)}),this));this.parentNode.SBPImpPostCounter=this;this.node.setAttribute("status","ready");this.node.setAttribute("inumpage",0);this.postId=e;this.popup=null;this.data=[];BX.bind(t,"click",BX.proxy((function(){this.get()}),this));BX.bind(t,"mouseover",BX.proxy((function(t){this.init(t)}),this));BX.bind(t,"mouseout",BX.proxy((function(t){this.init(t)}),this));this.pathToUser=i["pathToUser"];this.nameTemplate=i["nameTemplate"];this.onPullEvent=BX.delegate((function(t,e){if(t=="read"&&!!e&&e["POST_ID"]==this.postId){if(!!e["data"]){this.change(e["data"]);if(this.popup!=null){this.popup.isNew=true}}}}),this);BX.addCustomEvent("onPullEvent-socialnetwork",this.onPullEvent)};top.SBPImpPostCounter.prototype.click=function(t){t.uController=this;BX.addCustomEvent(t.node,"onUserVote",BX.proxy(this.change,this));BX.addCustomEvent(t.node,"onSend",BX.proxy((function(t){t["PATH_TO_USER"]=this.pathToUser;t["NAME_TEMPLATE"]=this.nameTemplate;t["iNumPage"]=0;t["ID"]=this.postId;t["post_id"]=this.postId;t["name"]="BLOG_POST_IMPRTNT";t["value"]="Y";t["return"]="users"}),this));this.btnObj=t};top.SBPImpPostCounter.prototype.change=function(t){if(!!t&&!!t.items){var e=false;this.data=[];for(var i in t.items){if(t.items.hasOwnProperty(i)){this.data.push(t.items[i])}}if(t["StatusPage"]=="done"){this.node.setAttribute("inumpage","done")}else this.node.setAttribute("inumpage",1);BX.adjust(this.parentNode,{style:{display:"flex"}})}else{this.node.setAttribute("inumpage","done");BX.hide(this.parentNode)}this.node.firstChild.innerHTML=t["RecordCount"]};top.SBPImpPostCounter.prototype.init=function(t){if(!!this.node.timeoutOver){clearTimeout(this.node.timeoutOver);this.node.timeoutOver=false}if(t.type=="mouseover"){if(!this.node.mouseoverFunc){this.node.mouseoverFunc=BX.delegate((function(){this.get();if(this.popup){BX.bind(this.popup.popupContainer,"mouseout",BX.proxy((function(){this.popup.timeoutOut=setTimeout(BX.proxy((function(){if(!!this.popup){this.popup.close()}}),this),400)}),this));BX.bind(this.popup.popupContainer,"mouseover",BX.proxy((function(){if(this.popup.timeoutOut)clearTimeout(this.popup.timeoutOut)}),this))}}),this)}this.node.timeoutOver=setTimeout(this.node.mouseoverFunc,400)}};top.SBPImpPostCounter.prototype.get=function(){if(this.node.getAttribute("inumpage")!="done")this.node.setAttribute("inumpage",parseInt(this.node.getAttribute("inumpage"))+1);this.show();if(this.data.length>0){this.make(this.node.getAttribute("inumpage")!="done")}if(this.node.getAttribute("inumpage")!="done"){this.node.setAttribute("status","busy");BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.getUsers",{data:{params:{POST_ID:this.postId,NAME:"BLOG_POST_IMPRTNT",VALUE:"Y",PAGE_NUMBER:this.node.getAttribute("inumpage"),PATH_TO_USER:this.pathToUser,NAME_TEMPLATE:this.nameTemplate}}}).then(function(t){var e=t.data;if(BX.type.isNotEmptyObject(e.items)){for(var i in e.items){if(e.items.hasOwnProperty(i)){this.data.push(e.items[i])}}if(e.StatusPage=="done"){this.node.setAttribute("inumpage","done")}this.make(this.node.getAttribute("inumpage")!="done")}else{this.node.setAttribute("inumpage","done")}this.node.firstChild.innerHTML=e["RecordCount"];this.node.setAttribute("status","ready")}.bind(this),function(t){if(!!this.popup){this.popup.close()}this.node.setAttribute("status","ready")}.bind(this))}};top.SBPImpPostCounter.prototype.show=function(){if(this.popup==null){this.popup=new BX.PopupWindow("bx-vote-popup-cont-"+this.postId,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy((function(){this.popup=null}),this)},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});this.popup.isNew=true;this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false};top.SBPImpPostCounter.prototype.make=function(t){if(!this.popup)return true;t=t!==false;var e=this.popup&&this.popup.contentContainer?this.popup.contentContainer:BX("popup-window-content-bx-vote-popup-cont-"+this.postId),i=false,o=false,s=this.data;if(this.popup.isNew){i=BX.create("SPAN",{props:{className:"bx-ilike-popup"},children:[BX.create("SPAN",{props:{className:"bx-ilike-bottom_scroll"}})]});o=BX.create("SPAN",{props:{className:"bx-ilike-wrap-block"},children:[i]})}else{i=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true)}if(!!i){var n=null;for(var a in s){if(s.hasOwnProperty(a)){if(!BX.findChild(i,{tag:"A",attr:{id:"u"+s[a]["ID"]}},true)){if(s[a]["PHOTO_SRC"].length>0){n=BX.create("IMG",{attrs:{src:encodeURI(s[a]["PHOTO_SRC"])},props:{className:"bx-ilike-popup-avatar-img"}})}else{n=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}i.appendChild(BX.create("A",{attrs:{id:"u"+s[a]["ID"]},props:{href:s[a]["URL"].length>0?s[a]["URL"]:"#",target:"_blank",className:"bx-ilike-popup-img"+(!!s[a]["TYPE"]?" bx-ilike-popup-img-"+s[a]["TYPE"]:"")},text:"",children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-new"},children:[n,BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name-new"},html:s[a]["FULL_NAME"]})],events:{click:s[a]["URL"].length>0?function(t){return true}:function(t){BX.PreventDefault(t)}}}))}}}if(t){BX.bind(i,"scroll",BX.proxy(this.popupScrollCheck,this))}}if(this.popup.isNew){this.popup.isNew=false;if(!!e){try{e.removeChild(e.firstChild)}catch(t){}e.appendChild(o)}}if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}};top.SBPImpPostCounter.prototype.popupScrollCheck=function(){var t=BX.proxy_context;if(t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){this.get();BX.unbindAll(t)}};window.entitySelectorRepo={}})(window);window.showSharing=function(t,e){BX("sharePostId").value=t;BX("shareUserId").value=e;var i=BX("blogShare").getAttribute("bx-selector-id");if(!BX.type.isNotEmptyString(i)){return}if(!window["postDest"+t]){return}var o="entity-selector-"+i;var s="entity-selector-data-"+i;BX.clean(o);window.entitySelectorRepo[t]=new SBPEntitySelector({id:i+t,context:"BLOG_POST",tagNodeId:o,inputNodeId:s,preselectedItems:window["postDest"+t],allowSearchEmailUsers:window.oSBPostManager&&!!window.oSBPostManager.allowSearchEmailUsers,allowToAll:window.oSBPostManager&&!!window.oSBPostManager.allowToAll});if(document.getElementById(s)){document.getElementById(s).value=JSON.stringify(window["postDest"+t])}var n=BX("destination-sharing");if(BX("blg-post-destcont-"+t)){BX("blg-post-destcont-"+t).appendChild(n)}n.style.height=0;n.style.opacity=0;n.style.overflow="hidden";n.style.display="inline-block";new BX.easing({duration:500,start:{opacity:0,height:0},finish:{opacity:100,height:n.scrollHeight-40},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){n.style.height=t.height+"px";n.style.opacity=t.opacity/100},complete:function(){n.style.cssText=""}}).animate()};window.closeSharing=function(){var t=BX("destination-sharing");if(BX("sharePostSubmitButton")){BX.removeClass(BX("sharePostSubmitButton"),"ui-btn-clock")}new BX.easing({duration:500,start:{opacity:100,height:t.scrollHeight-40},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:function(){BX.hide(t)}}).animate()};window.sharingPost=function(){var t=BX("sharePostId").value;var e=BX("blogShare");if(BX("sharePostSubmitButton")){BX.addClass(BX("sharePostSubmitButton"),"ui-btn-clock")}var i=0,o="",s=null,n=null,a=null,r={postId:t,pathToUser:oSBPostManager.pathToUser,pathToPost:oSBPostManager.pathToPost,readOnly:oSBPostManager.readOnly};for(i=0;i<e.elements.length;i++){var p=e.elements[i];if(p.disabled){continue}o=p.name;n=false;s=/^(.*)\[(.*)\]$/.exec(o);if(s){o=s[1];n=true;a=BX.type.isNotEmptyString(s[2])?s[2]:false}switch(p.type.toLowerCase()){case"text":case"hidden":if(n){if(typeof r[o]==="undefined"){r[o]=a?{}:[]}if(BX.type.isArray(r[o])){r[o].push(p.value)}else if(a){r[o][a]=p.value}}else{r[o]=p.value}break;default:break}}var l=renderSharingPost(t,r.DEST_DATA);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.share",{data:{params:r,MODE:"RECORD",ENTITY_XML_ID:"BLOG_"+t,AJAX_POST:"Y"},analyticsLabel:{b24statAction:"sharePost"}}).then((function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isNotEmptyString(e.status)||e.status!="success"){hideRenderedSharingNodes(l);if(!BX.type.isNotEmptyString(e.status)&&e.status=="error"&&!!BX.type.isNotEmptyString(e.errorMessage)){sharingPostError({postId:t,errorMessage:e.errorMessage})}}else{var i=e;BX.onCustomEvent(window,"OnUCAfterRecordAdd",["BLOG_"+t,e,i])}}),(function(e){sharingPostError({postId:t,errorMessage:e.errors[0].message});hideRenderedSharingNodes(l)}));closeSharing()};window.sharingPostError=function(t){var e=new BX.PopupWindow("error_popup",BX("blg-post-inform-"+t.postId),{lightShadow:true,offsetTop:-10,offsetLeft:100,autoHide:true,closeByEsc:true,closeIcon:{right:"5px",top:"5px"},draggable:{restrict:true},contentColor:"white",contentNoPaddings:true,bindOptions:{position:"bottom"},content:BX.create("DIV",{props:{className:"feed-create-task-popup-content"},children:[BX.create("DIV",{props:{className:"feed-create-task-popup-description"},text:t.errorMessage})]})});e.show()};window.renderSharingPost=function(t,e){if(!BX.type.isNotEmptyString(e)){return}var i=[];try{e=JSON.parse(e);if(!BX.type.isArray(e)){e=[]}}catch(t){e=[]}if(e.length<=0||!window.entitySelectorRepo[t]||!window.entitySelectorRepo[t].selector){return}var o=window.entitySelectorRepo[t].selector;var s=null;var n=document.getElementById("blog-destination-hidden-"+t);if(!n){var a=document.getElementById("blg-post-img-"+t).querySelectorAll(".feed-add-post-destination-new");if(a){s=a[a.length-1]}}e.forEach((function(e){var a=false;window["postDest"+t].forEach((function(t){if(a){return}a=t[0]==e[0]&&t[1]==e[1]}));if(a){return}var r=o.getTag({id:e[1],entityId:e[0]});var p="feed-add-post-destination-new";if(r.getEntityType()==="email"){p+=" feed-add-post-destination-new-email"}else if(r.getEntityType()==="extranet"){p+=" feed-add-post-destination-new-extranet"}var l=r.getLink();var d="post_"+t+"_dest_"+r.getEntityId()+"_"+r.getId();i.push(d);var u=null;if(BX.type.isNotEmptyString(l)){u=BX.create("a",{props:{className:p},attrs:{href:l,"bx-tooltip-user-id":r.getEntityId()==="user"?r.getId():""},text:r.getTitle()})}else{u=BX.create("span",{props:{className:p},text:r.getTitle()})}u=BX.create("span",{attrs:{id:d},children:[BX.create("span",{html:", "}),u]});if(n){n.appendChild(u)}else if(s){s.parentNode.insertBefore(u,s.nextSibling)}}));window["postDest"+t]=BX.clone(e);return i};window.hideRenderedSharingNodes=function(t){var e=false;for(i=0;i<t.length;i++){e=t[i];if(BX(e)){BX.cleanNode(BX(e),true)}}};(function(){if(!!BX.SBPostManager)return false;BX.SBPostManager=function(){this.inited=false;this.tagLinkPattern="";this.readOnly="N";this.pathToUser="";this.pathToPost="";this.allowToAll=false};BX.SBPostManager.prototype.init=function(t){this.tagLinkPattern=BX.type.isNotEmptyString(t.tagLinkPattern)?t.tagLinkPattern:"";this.inited=true;this.readOnly=BX.type.isNotEmptyString(t.readOnly)&&t.readOnly=="Y"?"Y":"N";this.pathToUser=BX.type.isNotEmptyString(t.pathToUser)?t.pathToUser:"";this.pathToPost=BX.type.isNotEmptyString(t.pathToPost)?t.pathToPost:"";this.allowToAll=BX.type.isBoolean(t.allowToAll)?t.allowToAll:false};BX.SBPostManager.prototype.clickTag=function(t){var e=false;if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyString(this.tagLinkPattern)){top.location.href=this.tagLinkPattern.replace("#tag#",BX.util.urlencode(t));e=true}return e}})();if(typeof oSBPostManager=="undefined"){oSBPostManager=new BX.SBPostManager;window.oSBPostManager=oSBPostManager}(function(){SBPEntitySelector=function(t){this.selector=null;this.inputNode=null;if(!BX.type.isNotEmptyString(t.id)){return null}this.init(t)};SBPEntitySelector.prototype.init=function(t){if(!BX.type.isPlainObject(t)){t={}}if(!BX.type.isNotEmptyString(t.id)||!BX.type.isNotEmptyString(t.tagNodeId)||!BX(t.tagNodeId)){return null}if(BX.type.isNotEmptyString(t.inputNodeId)&&BX(t.inputNodeId)){this.inputNode=BX(t.inputNodeId)}var e=BX.type.isArray(t.preselectedItems)?t.preselectedItems:[];this.selector=new BX.UI.EntitySelector.TagSelector({id:t.id,dialogOptions:{id:t.id,context:BX.type.isNotEmptyString(t.context)?t.context:null,preselectedItems:e,undeselectedItems:e,events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{allowView:BX.type.isBoolean(t.allowToAll)&&t.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(t.allowSearchEmailUsers)?t.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_SHARE_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_SHARE_LINK_2")});this.selector.renderTo(document.getElementById(t.tagNodeId));return this.selector};SBPEntitySelector.prototype.recalcValue=function(t){if(!BX.type.isArray(t)||!this.inputNode){return}var e=[];t.forEach((function(t){e.push([t.entityId,t.id])}));this.inputNode.value=JSON.stringify(e)};window.SBPEntitySelector=SBPEntitySelector})();
//# sourceMappingURL=script.map.js