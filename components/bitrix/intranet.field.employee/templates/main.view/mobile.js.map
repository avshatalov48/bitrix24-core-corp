{"version":3,"file":"mobile.js","sources":["src/mobile.js"],"sourcesContent":["const\n\tBX = window.BX,\n\tBXMobileApp = window.BXMobileApp;\n\nconst nodeSelectUser = (function ()\n{\n\tconst nodeSelectUser = function (select, eventNode, useOnChangeEvent)\n\t{\n\t\tthis.click = BX.delegate(this.click, this);\n\t\tthis.callback = BX.delegate(this.callback, this);\n\t\tthis.drop = BX.delegate(this.drop, this);\n\t\tthis.select = BX(select);\n\t\tthis.container = this.select.nextElementSibling;\n\t\tthis.eventNode = BX(eventNode);\n\t\tthis.useOnChangeEvent = useOnChangeEvent || false;\n\t\tBX.bind(this.eventNode, \"click\", this.click);\n\t\tthis.multiple = select.hasAttribute(\"multiple\");\n\t\tthis.showDrop = (!(\n\t\t\tselect.hasAttribute(\"bx-can-drop\")\n\t\t\t&&\n\t\t\tselect.getAttribute(\"bx-can-drop\").toString() == \"false\"\n\t\t));\n\t\tthis.urls = {\n\t\t\t\"list\": BX.message('SITE_DIR') + 'mobile/index.php?mobile_action=get_user_list',\n\t\t\t\"profile\": BX.message(\"interface_form_user_url\")\n\t\t};\n\t\tthis.actualizeNodes();\n\t};\n\tnodeSelectUser.prototype = {\n\t\tclick: function (e)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshow: function ()\n\t\t{\n\t\t\t(new BXMobileApp.UI.Table({\n\t\t\t\turl: this.urls.list,\n\t\t\t\ttable_settings: {\n\t\t\t\t\tcallback: this.callback,\n\t\t\t\t\tmarkmode: true,\n\t\t\t\t\tmultiple: this.multiple,\n\t\t\t\t\treturn_full_mode: true,\n\t\t\t\t\tskipSpecialChars: true,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\talphabet_index: true,\n\t\t\t\t\toutsection: false,\n\t\t\t\t\tokname: BX.message(\"interface_form_select\"),\n\t\t\t\t\tcancelname: BX.message(\"interface_form_cancel\")\n\t\t\t\t}\n\t\t\t}, \"users\")).show();\n\t\t},\n\t\tdrop: function ()\n\t\t{\n\t\t\tconst node = BX.proxy_context,\n\t\t\t\tid = node.id.replace(this.select.id + '_del_', '');\n\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (this.select.options[ii].value === id)\n\t\t\t\t{\n\t\t\t\t\tBX.remove(BX.findParent(node, {\n\t\t\t\t\t\t\"tagName\": \"DIV\",\n\t\t\t\t\t\t\"className\": \"mobile-grid-field-select-user-item-outer\"\n\t\t\t\t\t}));\n\t\t\t\t\tBX.remove(this.select.options[ii]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.select.options.length <= 0 && !this.multiple)\n\t\t\t{\n\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_select');\n\t\t\t}\n\n\t\t\tif (this.useOnChangeEvent)\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\t\t\t}\n\t\t},\n\t\tactualizeNodes: function ()\n\t\t{\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (BX(this.select.id + '_del_' + this.select.options[ii].value))\n\t\t\t\t{\n\t\t\t\t\tBX.bind(BX(this.select.id + '_del_' + this.select.options[ii].value), \"click\", this.drop);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbuildNodes: function (items)\n\t\t{\n\t\t\tlet options = '',\n\t\t\t\thtml = '',\n\t\t\t\tii, c = 0,\n\t\t\t\tuser, existedUsers = [];\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\texistedUsers.push(this.select.options[ii].value.toString());\n\t\t\t\tc++;\n\t\t\t}\n\t\t\tfor (let ii = 0; ii < Math.min((this.multiple ? items.length : 1), items.length); ii++)\n\t\t\t{\n\t\t\t\tuser = items[ii];\n\t\t\t\tif (existedUsers.includes(user['ID']))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\toptions += '<option value=\"' + user['ID'] + '\" selected>' + user[\"NAME\"] + '</option>';\n\t\t\t\thtml += ([\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item-outer\">',\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item\">',\n\t\t\t\t\t(this.showDrop ? '<del id=\"' + this.select.id + '_del_' + user[\"ID\"] + '\"></del>' : ''),\n\t\t\t\t\t'<div class=\"avatar\"', (user[\"IMAGE\"] ? ' style=\"background-image:url(\\'' + user[\"IMAGE\"] + '\\')\"' : ''), '></div>',\n\t\t\t\t\t'<span onclick=\"BXMobileApp.Events.postToComponent(\\'onUserProfileOpen\\', '+[user['ID']]+', \\'communication\\');\">' + user[\"NAME\"] + '</span>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join('').replace(' style=\"background-image:url(\\'\\')\"', ''));\n\t\t\t\tc++;\n\t\t\t}\n\n\t\t\tif (html !== '')\n\t\t\t{\n\t\t\t\tthis.select.innerHTML = (this.multiple ? this.select.innerHTML : '') + options;\n\t\t\t\tthis.container.innerHTML = (this.multiple ? this.container.innerHTML : '') + html;\n\t\t\t\tif (this.select.innerHTML !== '' && !this.multiple)\n\t\t\t\t{\n\t\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_change');\n\t\t\t\t}\n\n\t\t\t\tif (this.useOnChangeEvent)\n\t\t\t\t{\n\t\t\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\t\t\t\t}\n\n\t\t\t\tlet ij = 0,\n\t\t\t\t\tf = BX.proxy(function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (ij < 100)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.container.childNodes.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.actualizeNodes();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (ij++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout(f, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\tsetTimeout(f, 50);\n\t\t\t}\n\t\t},\n\t\tcallback: function (data)\n\t\t{\n\t\t\tif (data && data.a_users)\n\t\t\t{\n\t\t\t\tthis.buildNodes(data.a_users);\n\t\t\t}\n\t\t}\n\t};\n\treturn nodeSelectUser;\n})();\n\nwindow.app.exec('enableCaptureKeyboard', true);\n\nBX.Mobile.Field.SelectUser = function (params)\n{\n\tthis.useOnChangeEvent = params['useOnChangeEvent'] || false;\n\tthis.init(params);\n};\n\nBX.Mobile.Field.SelectUser.prototype = {\n\t__proto__: BX.Mobile.Field.prototype,\n\tbindElement: function (node)\n\t{\n\t\tlet result = null;\n\t\tif (BX(node))\n\t\t{\n\t\t\tresult = new nodeSelectUser(node, BX(`${node.id}_select`), this.useOnChangeEvent);\n\t\t}\n\t\treturn result;\n\t}\n};\n"],"names":["BX","window","BXMobileApp","nodeSelectUser","select","eventNode","useOnChangeEvent","click","delegate","callback","drop","container","nextElementSibling","bind","multiple","hasAttribute","showDrop","getAttribute","toString","urls","message","actualizeNodes","prototype","e","show","PreventDefault","UI","Table","url","list","table_settings","markmode","return_full_mode","skipSpecialChars","modal","alphabet_index","outsection","okname","cancelname","node","proxy_context","id","replace","ii","options","length","value","remove","findParent","innerHTML","onCustomEvent","buildNodes","items","html","user","existedUsers","push","c","Math","min","includes","join","ij","f","proxy","childNodes","setTimeout","data","a_users","app","exec","Mobile","Field","SelectUser","params","init","__proto__","bindElement","result"],"mappings":"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"}