{"version":3,"file":"mobile.js","sources":["src/mobile.js"],"sourcesContent":["import {Loc} from 'main.core';\n\nlet\n\tBX = window.BX,\n\tBXMobileApp = window.BXMobileApp;\n\nlet nodeSelectUser = (function ()\n{\n\tlet nodeSelectUser = function (select, eventNode)\n\t{\n\t\tthis.click = BX.delegate(this.click, this);\n\t\tthis.callback = BX.delegate(this.callback, this);\n\t\tthis.drop = BX.delegate(this.drop, this);\n\t\tthis.select = BX(select);\n\t\tthis.container = this.select.nextElementSibling;\n\t\tthis.eventNode = BX(eventNode);\n\t\tBX.bind(this.eventNode, \"click\", this.click);\n\t\tthis.multiple = select.hasAttribute(\"multiple\");\n\t\tthis.showDrop = (!(\n\t\t\tselect.hasAttribute(\"bx-can-drop\")\n\t\t\t&&\n\t\t\tselect.getAttribute(\"bx-can-drop\").toString() == \"false\"\n\t\t));\n\t\tthis.urls = {\n\t\t\t\"list\": BX.message('SITE_DIR') + 'mobile/index.php?mobile_action=get_user_list',\n\t\t\t\"profile\": BX.message(\"interface_form_user_url\")\n\t\t};\n\t\tthis.actualizeNodes();\n\t\t// this.expand = BX(\"expand_\" + this.select.getAttribute(\"id\"));\n\t\t// this.visCount = BX(\"count_\" + this.select.getAttribute(\"id\"));\n\n\t\t// if (!this.container.parentNode.hasAttribute(\"bx-fastclick-bound\"))\n\t\t// {\n\t\t// \tthis.container.parentNode.setAttribute(\"bx-fastclick-bound\", \"Y\");\n\t\t// \tFastClick.attach(this.container.parentNode.parentNode);\n\t\t// }\n\t};\n\tnodeSelectUser.prototype = {\n\t\tclick: function (e)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshow: function ()\n\t\t{\n\t\t\t(new BXMobileApp.UI.Table({\n\t\t\t\turl: this.urls.list,\n\t\t\t\ttable_settings: {\n\t\t\t\t\tcallback: this.callback,\n\t\t\t\t\tmarkmode: true,\n\t\t\t\t\tmultiple: this.multiple,\n\t\t\t\t\treturn_full_mode: true,\n\t\t\t\t\tskipSpecialChars: true,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\talphabet_index: true,\n\t\t\t\t\toutsection: false,\n\t\t\t\t\tokname: BX.message(\"interface_form_select\"),\n\t\t\t\t\tcancelname: BX.message(\"interface_form_cancel\")\n\t\t\t\t}\n\t\t\t}, \"users\")).show();\n\t\t},\n\t\tdrop: function ()\n\t\t{\n\t\t\tlet node = BX.proxy_context,\n\t\t\t\tid = node.id.replace(this.select.id + '_del_', '');\n\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (this.select.options[ii].value === id)\n\t\t\t\t{\n\t\t\t\t\tBX.remove(BX.findParent(node, {\n\t\t\t\t\t\t\"tagName\": \"DIV\",\n\t\t\t\t\t\t\"className\": \"mobile-grid-field-select-user-item-outer\"\n\t\t\t\t\t}));\n\t\t\t\t\tBX.remove(this.select.options[ii]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.select.options.length <= 0 && !this.multiple)\n\t\t\t{\n\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_select');\n\t\t\t}\n\t\t\t// if (this.expand)\n\t\t\t// \tthis.expand.value = this.select.options.length;\n\t\t\t// if (this.visCount)\n\t\t\t// \tthis.visCount.innerHTML = this.select.options.length - 3;\n\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\t\t},\n\t\tactualizeNodes: function ()\n\t\t{\n\t\t\t// if (this.expand)\n\t\t\t// {\n\t\t\t// \tthis.expand.value = this.select.options.length;\n\t\t\t// }\n\t\t\t// if (this.visCount)\n\t\t\t// {\n\t\t\t// \tthis.visCount.innerHTML = this.select.options.length - 3;\n\t\t\t// }\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (BX(this.select.id + '_del_' + this.select.options[ii].value))\n\t\t\t\t{\n\t\t\t\t\tBX.bind(BX(this.select.id + '_del_' + this.select.options[ii].value), \"click\", this.drop);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbuildNodes: function (items)\n\t\t{\n\t\t\tlet options = '',\n\t\t\t\thtml = '',\n\t\t\t\tii, c = 0,\n\t\t\t\tuser, existedUsers = [];\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\texistedUsers.push(this.select.options[ii].value.toString());\n\t\t\t\tc++;\n\t\t\t}\n\t\t\tfor (let ii = 0; ii < Math.min((this.multiple ? items.length : 1), items.length); ii++)\n\t\t\t{\n\t\t\t\tuser = items[ii];\n\t\t\t\tif (existedUsers.includes(user['ID']))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\toptions += '<option value=\"' + user['ID'] + '\" selected>' + user[\"NAME\"] + '</option>';\n\t\t\t\thtml += ([\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item-outer\">',\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item\">',\n\t\t\t\t\t(this.showDrop ? '<del id=\"' + this.select.id + '_del_' + user[\"ID\"] + '\"></del>' : ''),\n\t\t\t\t\t'<div class=\"avatar\"', (user[\"IMAGE\"] ? ' style=\"background-image:url(\\'' + user[\"IMAGE\"] + '\\')\"' : ''), '></div>',\n\t\t\t\t\t'<span onclick=\"BXMobileApp.Events.postToComponent(\\'onUserProfileOpen\\', '+[user['ID']]+', \\'communication\\');\">' + user[\"NAME\"] + '</span>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join('').replace(' style=\"background-image:url(\\'\\')\"', ''));\n\t\t\t\tc++;\n\t\t\t}\n\t\t\t// if (this.expand)\n\t\t\t// {\n\t\t\t// \tthis.expand.value = c;\n\t\t\t// }\n\t\t\t// if (this.visCount)\n\t\t\t// {\n\t\t\t// \tthis.visCount.innerHTML = c - 3;\n\t\t\t// }\n\t\t\tif (html !== '')\n\t\t\t{\n\t\t\t\tthis.select.innerHTML = (this.multiple ? this.select.innerHTML : '') + options;\n\t\t\t\tthis.container.innerHTML = (this.multiple ? this.container.innerHTML : '') + html;\n\t\t\t\tif (this.select.innerHTML !== '' && !this.multiple)\n\t\t\t\t{\n\t\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_change');\n\t\t\t\t}\n\n\t\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\n\t\t\t\tlet ij = 0,\n\t\t\t\t\tf = BX.proxy(function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (ij < 100)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.container.childNodes.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.actualizeNodes();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (ij++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout(f, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\tsetTimeout(f, 50);\n\t\t\t}\n\t\t},\n\t\tcallback: function (data)\n\t\t{\n\t\t\tif (data && data.a_users)\n\t\t\t{\n\t\t\t\tthis.buildNodes(data.a_users);\n\t\t\t}\n\t\t}\n\t};\n\treturn nodeSelectUser;\n})();\n\nwindow.app.exec('enableCaptureKeyboard', true);\n\nBX.Mobile.Field.SelectUser = function (params)\n{\n\tthis.init(params);\n};\n\nBX.Mobile.Field.SelectUser.prototype = {\n\t__proto__: BX.Mobile.Field.prototype,\n\tbindElement: function (node)\n\t{\n\t\tlet result = null;\n\t\tif (BX(node))\n\t\t{\n\t\t\tresult = new nodeSelectUser(node, BX(`${node.id}_select`));\n\t\t}\n\t\treturn result;\n\t}\n};"],"names":["BX","window","BXMobileApp","nodeSelectUser","select","eventNode","click","delegate","callback","drop","container","nextElementSibling","bind","multiple","hasAttribute","showDrop","getAttribute","toString","urls","message","actualizeNodes","prototype","e","show","PreventDefault","UI","Table","url","list","table_settings","markmode","return_full_mode","skipSpecialChars","modal","alphabet_index","outsection","okname","cancelname","node","proxy_context","id","replace","ii","options","length","value","remove","findParent","innerHTML","onCustomEvent","buildNodes","items","html","user","existedUsers","push","c","Math","min","includes","join","ij","f","proxy","childNodes","setTimeout","data","a_users","app","exec","Mobile","Field","SelectUser","params","init","__proto__","bindElement","result"],"mappings":"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"}