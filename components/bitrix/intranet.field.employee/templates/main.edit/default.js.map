{"version":3,"file":"default.js","sources":["src/default.js"],"sourcesContent":["BX.Default.Field.Employee = function (params)\n{\n\tthis.init(params);\n};\n\nBX.Default.Field.Employee.prototype = {\n\tinit: function (params)\n\t{\n\t\tthis.selectorName = (params['selectorName'] || '');\n\t\tthis.isMultiple = (params['isMultiple'] || '');\n\t\tthis.fieldNameJs = (params['fieldNameJs'] || '');\n\t\tthis.selectControl = this.createSelectControl();\n\t\tthis.entity = this.createEntity();\n\n\t\tBX.addCustomEvent(\n\t\t\tthis.selectControl,\n\t\t\t'onUpdateValue',\n\t\t\tBX.delegate(this.updateHandler, this)\n\t\t);\n\n\t\tBX.addCustomEvent(\n\t\t\tthis.entity,\n\t\t\t'BX.Intranet.UserFieldEmployeeEntity:remove',\n\t\t\tBX.delegate(this.removeHandler, this)\n\t\t);\n\t},\n\n\tcreateSelectControl: function ()\n\t{\n\t\treturn new BX.Intranet.UserFieldEmployee(this.selectorName, {\n\t\t\tmultiple: this.isMultiple\n\t\t});\n\t},\n\n\tcreateEntity: function ()\n\t{\n\t\treturn new BX.Intranet.UserFieldEmployeeEntity({\n\t\t\tfield: `field_${this.selectorName}`,\n\t\t\tmultiple: this.isMultiple\n\t\t});\n\t},\n\n\tupdateHandler: function (value, userStack)\n\t{\n\t\tif (this.isMultiple)\n\t\t{\n\t\t\tlet result = [];\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tresult.push({\n\t\t\t\t\tname: userStack[value[i]].name,\n\t\t\t\t\tvalue: value[i]\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.setData(result);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (value === null)\n\t\t\t{\n\t\t\t\tthis.setData(null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setData({\n\t\t\t\t\tname: userStack[value].name,\n\t\t\t\t\tvalue: value\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tremoveHandler: function (value)\n\t{\n\t\tlet result = (this.isMultiple ? [] : null);\n\t\tlet\tselectControlValue = (this.isMultiple ? [] : null);\n\n\t\tfor (let i = 0; i < value.length; i++)\n\t\t{\n\t\t\tlet item = {\n\t\t\t\tname: value[i].label,\n\t\t\t\tvalue: value[i].value\n\t\t\t};\n\n\t\t\tif (!this.isMultiple)\n\t\t\t{\n\t\t\t\tselectControlValue = item.value;\n\t\t\t\tresult = item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tselectControlValue.push(item.value);\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t}\n\t\tthis.selectControl.setValue(selectControlValue);\n\t\tthis.setData(result);\n\t},\n\n\tsetData: function (value)\n\t{\n\t\tlet valueContainer = BX(`value_${this.selectorName}`);\n\t\tlet html = '';\n\n\t\tif (this.isMultiple)\n\t\t{\n\t\t\tif (value.length > 0)\n\t\t\t{\n\t\t\t\tlet entityValue = [];\n\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t{\n\t\t\t\t\tentityValue.push({\n\t\t\t\t\t\tvalue: value[i].value,\n\t\t\t\t\t\tlabel: value[i].name\n\t\t\t\t\t});\n\n\t\t\t\t\thtml += `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"${BX.util.htmlspecialchars(value[i].value)}\">`;\n\t\t\t\t}\n\n\t\t\t\tthis.entity.setData(entityValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.entity.removeSquares();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (value !== null)\n\t\t\t{\n\t\t\t\tthis.entity.setData(value.name, value.value);\n\t\t\t\thtml += `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"${BX.util.htmlspecialchars(value.value)}\">`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.entity.removeSquares();\n\t\t\t}\n\t\t}\n\n\t\tif (html.length <= 0)\n\t\t{\n\t\t\thtml = `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"\">`\n\t\t}\n\n\t\tvalueContainer.innerHTML = html;\n\n\t\tBX.defer(function ()\n\t\t{\n\t\t\tBX.fireEvent(valueContainer.firstChild, 'change');\n\t\t})();\n\t}\n};"],"names":["BX","Default","Field","Employee","params","init","prototype","selectorName","isMultiple","fieldNameJs","selectControl","createSelectControl","entity","createEntity","addCustomEvent","delegate","updateHandler","removeHandler","Intranet","UserFieldEmployee","multiple","UserFieldEmployeeEntity","field","value","userStack","result","i","length","push","name","setData","selectControlValue","item","label","setValue","valueContainer","html","entityValue","util","htmlspecialchars","removeSquares","innerHTML","defer","fireEvent","firstChild"],"mappings":"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"}