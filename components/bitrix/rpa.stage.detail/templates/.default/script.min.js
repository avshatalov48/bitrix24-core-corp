(function(e,t,a,i){"use strict";var s=t.Reflection.namespace("BX.Rpa");var r=function(e){babelHelpers.inherits(a,e);babelHelpers.createClass(a,[{key:"getPermissionSelectors",value:function e(){return[{action:"VIEW",selector:'[data-role="permission-setting-view"]'},{action:"MODIFY",selector:'[data-role="permission-setting-create"]'},{action:"MODIFY",selector:'[data-role="permission-setting-modify"]'},{action:"MOVE",selector:'[data-role="permission-setting-move"]'}]}}]);function a(){var e;var s;babelHelpers.classCallCheck(this,a);for(var r=arguments.length,l=new Array(r),o=0;o<r;o++){l[o]=arguments[o]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(a)).call.apply(e,[this].concat(l)));s.popups={};if(l[1].fields&&t.Type.isPlainObject(l[1].fields)){for(var n=0,c=Object.entries(l[1].fields);n<c.length;n++){var p=babelHelpers.slicedToArray(c[n],2),u=p[0],d=p[1];s.popups[u]=new i.FieldsPopup("stage-"+u+"-fields",d.fields,d.title);s.bindFieldButton(document.getElementById(d.id),s.popups[u])}}return s}babelHelpers.createClass(a,[{key:"init",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"init",this).call(this);this.adjustDeleteButtonVisibility()}},{key:"adjustDeleteButtonVisibility",value:function e(){var t=this.prepareData();if(t.id&&t.id>0){this.deleteButton.style.display="block"}else{this.deleteButton.style.display="none"}}},{key:"bindFieldButton",value:function e(a,i){t.Event.bind(a,"click",function(e){e.preventDefault();i.show()})}},{key:"prepareData",value:function e(){var t={};var a={};a.typeId=this.form.querySelector('[name="typeId"]').value;var i=this.form.querySelector('[name="id"]').value;if(i>0){t.id=i}a.name=this.form.querySelector('[name="name"]').value;a.code=this.form.querySelector('[name="code"]').value;a.permissions=this.getPermissions();a.fields={};for(var s=0,r=Object.entries(this.popups);s<r.length;s++){var l=babelHelpers.slicedToArray(r[s],2),o=l[0],n=l[1];a.fields[o]=Array.from(n.getSelectedFields())}a.possibleNextStages=this.getPossibleNextStages();t.fields=a;return t}},{key:"getPossibleNextStages",value:function e(){var t=[];var a=this.form.querySelector('[name="possibleNextStages[]"]');var i=a.querySelectorAll("option");i.forEach(function(e){if(e.selected){t.push(e.value)}});return t}},{key:"afterSave",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"afterSave",this).call(this,i);var s=this.getSlider();if(s){s.close();return}var r=t.Loc.getMessage("RPA_STAGE_DETAIL_TITLE").replace("#TITLE#",i.data.stage.name);if(this.method==="rpa.stage.add"){var l=i.data.stage.id;var o=new t.Uri(location.href);o.setQueryParam("id",i.data.stage.id);window.history.pushState({},r,o.toString());this.form.querySelector('[name="id"]').value=l;this.method="rpa.stage.update";this.analyticsLabel="rpaStageUpdate"}this.adjustDeleteButtonVisibility();document.getElementById("pagetitle").innerText=r}},{key:"delete",value:function e(a){var i=this;a.preventDefault();if(this.isProgress){return}var s=this.prepareData();if(s.id>0){s={id:s.id}}else{return}if(confirm(t.Loc.getMessage("RPA_STAGE_DELETE_CONFIRM"))){this.startProgress();t.ajax.runAction("rpa.stage.delete",{analyticsLabel:"rpaStageDelete",data:s}).then(function(e){i.afterDelete(e);i.stopProgress()}).catch(function(e){i.showErrors(e.errors);i.stopProgress()})}}},{key:"afterDelete",value:function e(){this.cancelButton.click()}}]);return a}(a.Component);s.StageComponent=r})(this.window=this.window||{},BX,BX.Rpa,BX.Rpa);
//# sourceMappingURL=script.map.js