(function(){BX.namespace("BX.Sender.Message");if(BX.Sender.Message.Editor){return}var e=BX.Sender.Page;var t=BX.Sender.Helper;function i(){this.context=null;this.editor=null}i.prototype.init=function(t){this.isFrame=t.isFrame||false;this.isSaved=t.isSaved||false;this.prettyDateFormat=t.prettyDateFormat;this.mess=t.mess||{};this.context=BX(t.containerId);this.selectorNode=this.context.querySelector("[data-bx-selector]");this.editorNode=this.context.querySelector("[data-bx-editor]");this.currTemplateNode=this.editorNode.querySelector("[data-bx-curr-templ]");this.changeTemplateBtnNode=this.editorNode.querySelector("[data-bx-change-btn]");this.initUi();this.bindNodes();e.initButtons()};i.prototype.initUi=function(){this.ui={title:t.getNode("templates-title",this.context)}};i.prototype.setAdaptedInstance=function(e){this.editor=e};i.prototype.bindNodes=function(){if(BX.Sender.Template&&BX.Sender.Template.Selector){var i=BX.Sender.Template.Selector;BX.addCustomEvent(i,i.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(i,i.events.selectorClose,this.closeTemplateSelector.bind(this))}BX.bind(this.changeTemplateBtnNode,"click",this.showTemplateSelector.bind(this));if(!this.ui.title.value.trim()){this.ui.title.value=t.replace(this.mess.patternTitle,{name:this.mess.newTitle,date:BX.date.format(this.prettyDateFormat)})}if(this.isFrame){t.titleEditor.init({dataNode:this.ui.title})}if(this.isFrame&&this.isSaved){e.slider.close()}};i.prototype.onTemplateSelect=function(e){this.closeTemplateSelector();if(this.currTemplateNode){this.currTemplateNode.innerText=e.name}};i.prototype.closeTemplateSelector=function(){t.changeDisplay(this.selectorNode,false);t.changeDisplay(this.editorNode,true)};i.prototype.showTemplateSelector=function(){t.changeDisplay(this.selectorNode,true);t.changeDisplay(this.editorNode,false)};i.prototype.setTemplate=function(e){if(!this.editor){return}if(this.editor.isSupportedTemplateUri&&this.editor.isSupportedTemplateUri()){var t=BX.Sender.Template.Selector.getTemplateRequestingUri(e);this.editor.setTemplateUri(t)}else{BX.Sender.Template.Selector.getTemplate(e,this.editor.setContent.bind(this.editor))}};BX.Sender.Message.Editor=new i})(window);