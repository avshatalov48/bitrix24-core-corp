BX.namespace("BX.Crm");if(typeof BX.Crm.DedupeWizardConfigurationDialog==="undefined"){BX.Crm.DedupeWizardConfigurationDialog=function(){this._id="";this._settings={};this._config={};this._scope="";this._selectedTypeNames=[];this._typeInfos={};this._scopeInfos={};this._componentName="";this._container=null;this._wrapper=null;this._scopeSelector=null;this._criterionList=null;this._criterionCheckBoxes=null;this._saveButtonClickHandler=this.onSaveButtonClick.bind(this)};BX.Crm.DedupeWizardConfigurationDialog.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._componentName=BX.prop.getString(this._settings,"componentName","");this._config=BX.prop.getObject(this._settings,"config");this._scope=BX.prop.getString(this._config,"scope","");this._selectedTypeNames=BX.prop.getArray(this._config,"typeNames",[]);this._typeInfos=BX.prop.getObject(this._settings,"typeInfos");this._scopeInfos=BX.prop.getObject(this._settings,"scopeInfos");var i=BX.prop.getString(this._settings,"container","");if(i){this._container=BX(i);this.layout()}},getMessage:function(e){return BX.prop.getString(BX.Crm.DedupeWizardConfigurationDialog.messages,e,e)},selectAll:function(e){if(!this._criterionCheckBoxes){return}var t=!!e;for(var i=0,s=this._criterionCheckBoxes.length;i<s;i++){this._criterionCheckBoxes[i].checked=t}},layout:function(){var e=this._scopeInfos;this._wrapper=BX.create("div");this._content=BX.create("div",{attrs:{className:"crm-dedupe-wizard-search-settings-content"}});this._wrapper.appendChild(this._content);var t=Object.keys(e);if(t.length>1||t[0]!==""){this._content.appendChild(BX.create("h4",{attrs:{className:"crm-dedupe-wizard-search-settings-subtitle"},text:this.getMessage("scopeCaption")}));var i=[];for(var s in e){if(!e.hasOwnProperty(s)){continue}i.push(BX.create("option",{attrs:{value:s!==""?s:"-",selected:this._scope===s},text:e[s]}))}this._scopeSelector=BX.create("select",{attrs:{className:"ui-ctl-element"},children:i,events:{click:BX.delegate(this.onScopeChange,this)}});this._content.appendChild(BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown crm-dedupe-wizard-search-settings-input"},children:[BX.create("div",{props:{className:"ui-ctl-after ui-ctl-icon-angle"}}),this._scopeSelector]}))}this._content.appendChild(BX.create("h4",{attrs:{className:"crm-dedupe-wizard-search-settings-subtitle"},text:this.getMessage("criterionCaption")}));this._content.appendChild(BX.create("div",{props:{className:"crm-dedupe-wizard-search-settings-control-box"},children:[BX.create("button",{props:{className:"crm-dedupe-wizard-search-settings-control"},text:this.getMessage("selectAll"),events:{click:BX.delegate(this.onSelectAllButtonClick,this)}}),BX.create("button",{props:{className:"crm-dedupe-wizard-search-settings-control"},text:this.getMessage("unselectAll"),events:{click:BX.delegate(this.onUnselectAllButtonClick,this)}})]}));this._criterionList=BX.create("ul",{attrs:{className:"crm-dedupe-wizard-search-settings-list"}});this._content.appendChild(this._criterionList);this._criterionCheckBoxes=[];this.adjustCriterionList();BX.bind(BX("ui-button-panel-save"),"click",this._saveButtonClickHandler);this._container.appendChild(this._wrapper)},adjustCriterionList:function(){while(this._criterionList.firstChild){this._criterionList.removeChild(this._criterionList.firstChild)}this._criterionCheckBoxes=[];var e=this._typeInfos;for(var t in e){if(!e.hasOwnProperty(t)){continue}var i=e[t];if(BX.prop.getString(i,"SCOPE","")!==this._scope){continue}var s=BX.prop.getString(i,"NAME","");var n=BX.create("input",{attrs:{type:"checkbox"},props:{id:t,name:s,className:"crm-dedupe-wizard-search-settings-checkbox"}});if(this._selectedTypeNames.indexOf(s)>=0){n.checked=true}this._criterionCheckBoxes.push(n);var r="crm-dedupe-wizard-search-settings-list-item";if(s.substr(0,9)==="VOLATILE_"){r+=" volatile"}this._criterionList.appendChild(BX.create("li",{props:{className:"crm-dedupe-wizard-search-settings-list-item"},children:[BX.create("label",{attrs:{for:t},props:{className:r},children:[n,document.createTextNode(BX.prop.getString(i,"DESCRIPTION","["+s+"]"))]})]}))}},saveConfig:function(){return BX.ajax.runComponentAction(this._componentName,"saveConfiguration",{data:{guid:this._id,config:this._config}})},close:function(){var e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){e.close()}},onScopeChange:function(){var e=this._scopeSelector.value==="-"?"":this._scopeSelector.value;if(this._scope!==e){this._scope=e;this.adjustCriterionList()}},onSelectAllButtonClick:function(e){this.selectAll(true)},onUnselectAllButtonClick:function(e){this.selectAll(false)},onSaveButtonClick:function(e){this._selectedTypeNames=[];for(var t=0,i=this._criterionCheckBoxes.length;t<i;t++){var s=this._criterionCheckBoxes[t];if(s.checked){this._selectedTypeNames.push(s.name)}}var n=this._config;n["typeNames"]=this._selectedTypeNames;n["scope"]=this._scope;this.saveConfig().then(function(){BX.SidePanel.Instance.postMessage(window,"crm::onMergerSettingsChange",{config:n});this.close()}.bind(this))}};if(typeof BX.Crm.DedupeWizardConfigurationDialog.messages==="undefined"){BX.Crm.DedupeWizardConfigurationDialog.messages={}}BX.Crm.DedupeWizardConfigurationDialog.create=function(e,t){var i=new BX.Crm.DedupeWizardConfigurationDialog;i.initialize(e,t);return i}}
//# sourceMappingURL=script.map.js