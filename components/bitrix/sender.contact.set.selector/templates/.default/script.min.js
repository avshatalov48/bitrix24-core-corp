(function(){BX.namespace("BX.Sender.ContactSet");if(BX.Sender.ContactSet.Selector){return}var t=BX.Sender.Helper;function e(t){this.init(t)}e.prototype.init=function(e){this.manager=e.manager;this.id=e.id;this.pathToAdd=e.pathToAdd;this.pathToEdit=e.pathToEdit;this.context=BX(e.containerId);this.actionUri=e.actionUri;this.mess=e.mess||{searchTitle:""};this.isAdding=false;this.popupContent=t.getNode("popup-content",this.context);this.siteName=t.getNode("site-name",this.context);this.counter=t.getNode("counter",this.context);this.ajaxAction=new BX.AjaxAction(this.actionUri);this.initSelector();t.hint.init(this.context);top.BX.addCustomEvent(top,"sender-contact-edit-change",this.onContactChange.bind(this))};e.prototype.initSelector=function(){this.selector=BX.Sender.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.onButtonSelect.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonSelectFirst,this.onButtonSelectFirst.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonAdd,this.onButtonAdd.bind(this));BX.addCustomEvent(this.selector,this.selector.events.input,this.onInput.bind(this));BX.addCustomEvent(this.selector,this.selector.events.search,this.onSearch.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileRemove,this.onTileChange.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileAdd,this.onTileChange.bind(this))};e.prototype.onTileChange=function(t){};e.prototype.onButtonSelect=function(){this.selector.showSearcher(this.mess.searchTitle)};e.prototype.onButtonSelectFirst=function(){var t=this.selector;this.ajaxAction.request({action:"getSets",onsuccess:function(e){t.setSearcherData(e.list||[])},onfailure:t.hideSearcher.bind(t),data:{}})};e.prototype.onButtonAdd=function(){this.isAdding=true;BX.Sender.Page.open(this.pathToAdd)};e.prototype.onTileClick=function(t){BX.Sender.Page.open(this.pathToEdit.replace("#id#",t.id))};e.prototype.onInput=function(t){};e.prototype.onSearch=function(t){};e.prototype.fire=function(t,e){e=e||{};BX.onCustomEvent(this,t,e)};e.prototype.actualizeTiles=function(t,e){var i=this.selector.getTile(t.id);if(i){this.selector.updateTile(i,t.name,t.data,t.bgcolor,t.color)}else if(e){this.selector.addTile(t.name,t.data,t.id,t.bgcolor,t.color)}};e.prototype.actualize=function(t,e){this.selector.clearSearcher();this.actualizeTiles(t,e)};e.prototype.onContactChange=function(t){this.actualize(t,this.isAdding);this.isAdding=false};function i(){}i.prototype.create=function(t){return new e(t)};BX.Sender.ContactSet.Selector=e;BX.Sender.ContactSet.SelectorManager=new i})(window);