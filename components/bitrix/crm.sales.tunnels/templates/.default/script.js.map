{"version":3,"file":"script.js","sources":["src/kanban/internal/create-stub.js","src/marker/internal/is-line.js","src/marker/internal/is-overlap.js","src/marker/internal/make-relative-rect.js","src/marker/internal/is-rect.js","src/marker/internal/get-middle-point.js","src/marker/marker.js","src/internal/is-link-in-same-category.js","src/internal/is-cycle-link.js","src/kanban/column.js","src/kanban/grid.js","src/category/category.js","src/backend.js","src/category/category-stub.js","src/manager/internal/create-stage-stubs.js","src/manager/internal/make-error-message.js","src/manager/manager.js","src/sales.tunnels.js"],"sourcesContent":["import {Tag} from 'main.core';\n\nexport default function createStub()\n{\n\treturn Tag.render`<div class=\"crm-st-kanban-stub\"></div>`;\n}","import {Type} from 'main.core';\n\nexport default function isLine(value)\n{\n\treturn (\n\t\tType.isArray(value)\n\t\t&& value.length === 2\n\t\t&& value.every(Type.isNumber)\n\t);\n}","import isLine from './is-line';\n\nexport default function isOverlap(line1, line2)\n{\n\tif (!isLine(line1) || !isLine(line2))\n\t{\n\t\tthrow new Error('Invalid lines. Line should be Array<number>');\n\t}\n\n\tconst a1 = Math.min(...line1);\n\tconst a2 = Math.max(...line1);\n\n\tconst b1 = Math.min(...line2);\n\tconst b2 = Math.max(...line2);\n\n\treturn a1 >= b1 && a1 <= b2\n\t\t|| a2 >= b1 && a2 <= b2\n\t\t|| b1 >= a1 && b1 <= a2\n\t\t|| b2 >= a1 && b2 <= a2;\n}","import {Type} from 'main.core';\n\nconst isValidRect = rect => (\n\tType.isNumber(rect.left)\n\t&& Type.isNumber(rect.top)\n\t&& Type.isNumber(rect.width)\n\t&& Type.isNumber(rect.height)\n);\n\nexport default function makeRelativeRect(rect1: DOMRect, rect2: DOMRect): DOMRect\n{\n\tif (!isValidRect(rect1) || !isValidRect(rect2))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tleft: rect2.left - rect1.left,\n\t\ttop: rect2.top - rect1.top,\n\t\tright: (rect2.left - rect1.left) + rect2.width,\n\t\tbottom: (rect2.top - rect1.top) + rect2.height,\n\t\twidth: rect2.width,\n\t\theight: rect2.height,\n\t};\n}","import {Type} from 'main.core';\n\nexport default function isRect(value)\n{\n\treturn (\n\t\tType.isNumber(value.left)\n\t\t&& Type.isNumber(value.top)\n\t\t&& Type.isNumber(value.width)\n\t\t&& Type.isNumber(value.height)\n\t);\n}","import isRect from './is-rect';\n\nexport default function getMiddlePoint(rect: DOMRect): {middleX: number, middleY: number}\n{\n\tif (!isRect(rect))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tmiddleX: rect.left + (rect.width / 2),\n\t\tmiddleY: rect.top + (rect.height / 2),\n\t}\n}","import {Dom, Event, Loc, Tag, Type, Cache, Runtime, Text} from 'main.core';\nimport {PopupMenuWindow} from 'main.popup';\nimport * as d3 from 'main.d3js';\nimport isOverlap from './internal/is-overlap';\nimport makeRelativeRect from './internal/make-relative-rect';\nimport getMiddlePoint from './internal/get-middle-point';\nimport type Link from '../type/link';\n\n/**\n * Implements interface for works with marker\n */\nexport default class Marker extends Event.EventEmitter\n{\n\tstatic instances: Array<Marker> = [];\n\tstatic paths: Array<Array<{x: number, y: number}>> = [];\n\n\tstatic getMarkerFromPoint(point)\n\t{\n\t\treturn Marker.instances.find(marker => (\n\t\t\tmarker.isReceiverIntersecting(point)\n\t\t));\n\t}\n\n\tstatic emitReceiverDragOutForAll(exclude: ?Marker = null)\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tif (marker !== exclude)\n\t\t\t{\n\t\t\t\tmarker.onReceiverDragOut();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getAllLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.links].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic getAllStubLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.stubLinks].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic highlightLink(...targets: Link)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (!targets.includes(link))\n\t\t\t{\n\t\t\t\tif ([...targets].every(item => item.from !== link.from))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.receiver, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.to.receiver, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-fade');\n\t\t\t\tDom.addClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst node = link.node.node();\n\t\t\t\tnode.parentNode.appendChild(node);\n\n\t\t\t\tconst arrowMarker = link.arrow.node();\n\t\t\t\tconst defs = arrowMarker.closest('defs');\n\n\t\t\t\tDom.insertAfter(arrowMarker, defs.firstChild);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unhighlightLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t});\n\t}\n\n\tstatic blurLinks(marker: Marker)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (link.from === marker || link.to === marker)\n\t\t\t{\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-blur-link');\n\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unblurLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.to.getTunnelButton(), 'crm-st-blur-link');\n\t\t});\n\t}\n\n\tstatic removeAllLinks()\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tconst preventSave = true;\n\t\t\tmarker.removeAllLinks(preventSave);\n\t\t});\n\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tmarker.removeAllStubLinks();\n\t\t});\n\t}\n\n\tstatic restoreAllLinks()\n\t{\n\t\tconst preventSave = true;\n\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tlink.from.links.delete(link);\n\t\t\tlink.from.addLinkTo(link.to, link.robotAction, preventSave);\n\t\t});\n\t}\n\n\tstatic adjustLinks()\n\t{\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link, index) => {\n\t\t\t\tconst path = link.from.getLinkPath(link.to);\n\n\t\t\t\tlink.node\n\t\t\t\t\t.style('transition', 'none');\n\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t.style('transition', 'none');\n\n\t\t\t\tlink.from.showTunnelButton(path);\n\t\t\t\tlink.node.attr('d', d3.line()(path));\n\t\t\t\tlink.path = path;\n\n\t\t\t\tclearTimeout(Marker.adjustLinksTimeoutIds[index]);\n\t\t\t\tMarker.adjustLinksTimeoutIds[index] = setTimeout(() => {\n\t\t\t\t\tlink.node\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t}\n\n\tstatic adjustLinksTimeoutIds = {};\n\n\t// Links from this marker\n\tlinks: Set<Link> = new Set();\n\tstubLinks: Set<Link> = new Set();\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: {\n\t\tdispatcher: HTMLElement,\n\t\treceiver: HTMLElement,\n\t\tpoint: HTMLElement,\n\t\tcontainer: HTMLElement,\n\t\tintermediateXPoints: Array<number>,\n\t\tname: string,\n\t\tdata?: {[key: string]: any},\n\t})\n\t{\n\t\tsuper();\n\n\t\tthis.dispatcher = options.dispatcher;\n\t\tthis.receiver = options.receiver;\n\t\tthis.point = options.point;\n\t\tthis.container = options.container;\n\t\tthis.intermediateXPoints = options.intermediateXPoints;\n\t\tthis.name = options.name;\n\t\tthis.data = options.data;\n\n\t\tconst linksRoot = this.getLinksRoot();\n\n\t\t// Add arrow marker\n\t\tif (!linksRoot.select('defs').node())\n\t\t{\n\t\t\tlinksRoot\n\t\t\t\t.append('svg:defs')\n\t\t\t\t.append('filter')\n\t\t\t\t.attr('id', 'crm-st-blur')\n\t\t\t\t.append('feGaussianBlur')\n\t\t\t\t.attr('stdDeviation', '2');\n\n\t\t\tlinksRoot\n\t\t\t\t.select('#crm-st-blur')\n\t\t\t\t.append('feColorMatrix')\n\t\t\t\t.attr('type', 'saturate')\n\t\t\t\t.attr('values', '0');\n\t\t}\n\n\t\tthis.onDispatcherMouseDown = this.onDispatcherMouseDown.bind(this);\n\t\tthis.onMarkerRootMouseUp = this.onMarkerRootMouseUp.bind(this);\n\t\tthis.onMarkerRootMouseMove = this.onMarkerRootMouseMove.bind(this);\n\n\t\td3.select(this.dispatcher).on('mousedown', this.onDispatcherMouseDown);\n\n\t\tMarker.instances.push(this);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tenable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tisEnabled(): boolean\n\t{\n\t\treturn !this.disabled;\n\t}\n\n\tgetMarkerRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerRoot', () => {\n\t\t\tconst markerRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-root');\n\n\t\t\tif (markerRoot.node())\n\t\t\t{\n\t\t\t\treturn markerRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-root');\n\t\t});\n\t}\n\n\tgetMarkerRootRect(): ClientRect | DOMRect\n\t{\n\t\treturn this.getMarkerRoot().node().getBoundingClientRect();\n\t}\n\n\tgetLinksRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('linksRoot', () => {\n\t\t\tconst linksRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-links-root');\n\n\t\t\tif (linksRoot.node())\n\t\t\t{\n\t\t\t\treturn linksRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-links-root');\n\t\t});\n\t}\n\n\tgetMarkerLine(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerLine', (\n\t\t\tthis.getMarkerRoot()\n\t\t\t\t.append('line')\n\t\t\t\t.attr('class', 'crm-st-svg-marker')\n\t\t));\n\t}\n\n\tremoveMarkerLine()\n\t{\n\t\tthis.getMarkerLine().remove();\n\t\tthis.cache.delete('markerLine');\n\t}\n\n\tgetDispatcherRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.dispatcher.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetReceiverRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.receiver.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetPointRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.point.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetMarkerRootMousePosition(): {x: number, y: number}\n\t{\n\t\tconst [x, y] = d3.mouse(this.getMarkerRoot().node());\n\t\treturn {x, y};\n\t}\n\n\t/** @private */\n\tonReceiverDragOver(from, to)\n\t{\n\t\tif (!this.hovered)\n\t\t{\n\t\t\tthis.hovered = true;\n\t\t\tthis.emit('Marker:receiver:dragOver', {from, to});\n\t\t}\n\t}\n\n\t/** @private */\n\tonReceiverDragOut()\n\t{\n\t\tif (this.hovered)\n\t\t{\n\t\t\tthis.hovered = false;\n\t\t\tthis.emit('Marker:receiver:dragOut');\n\t\t}\n\t}\n\n\t/** @private */\n\tonDispatcherMouseDown()\n\t{\n\t\tconst {middleX, middleY} = this.getDispatcherRect();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x1', middleX)\n\t\t\t.attr('y1', middleY)\n\t\t\t.attr('x2', middleX)\n\t\t\t.attr('y2', middleY);\n\n\t\tthis.getMarkerRoot()\n\t\t\t.style('z-index', '222')\n\t\t\t.on('mousemove', this.onMarkerRootMouseMove)\n\t\t\t.on('mouseup', this.onMarkerRootMouseUp);\n\n\t\tthis.emit('Marker:dragStart');\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseMove()\n\t{\n\t\tconst {x, y} = this.getMarkerRootMousePosition();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x2', x)\n\t\t\t.attr('y2', y);\n\n\t\tthis.emit('Marker:drag');\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker !== this)\n\t\t\t{\n\t\t\t\tdestinationMarker.onReceiverDragOver(this, destinationMarker);\n\t\t\t}\n\t\t}\n\n\t\tMarker.emitReceiverDragOutForAll(destinationMarker);\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseUp()\n\t{\n\t\tthis.getMarkerRoot()\n\t\t\t.on('mousemove', null)\n\t\t\t.on('mouseup', null)\n\t\t\t.style('z-index', null);\n\n\t\tthis.removeMarkerLine();\n\n\t\t// @todo refactoring\n\t\tMarker.instances.forEach(marker => marker.onReceiverDragOut());\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {from: this, to: destinationMarker},\n\t\t});\n\t\tthis.emit('Marker:dragEnd', event);\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker && !event.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tif (!this.data.column.data.canEditTunnels)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Marker:error', {\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ST_TUNNEL_EDIT_ACCESS_DENIED'),\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.addLinkTo(destinationMarker, 'copy');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTunnelMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelMenu', () => (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: this.getTunnelMenuItems([...this.links][0]),\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tgetTunnelMenuItems(link): Array<{text: string, onclick: () => void}>\n\t{\n\t\tconst self = this;\n\t\tconst onRobotActionChange = function(robotAction: string) {\n\t\t\tif (!Type.isNil(link) && link.robotAction !== robotAction)\n\t\t\t{\n\t\t\t\tself.changeRobotAction(link, robotAction)\n\t\t\t\tlink.robotAction = robotAction;\n\t\t\t}\n\n\t\t\tthis.getParentMenuWindow().close();\n\t\t\tthis.getParentMenuWindow().getMenuItems()[0].setText(\n\t\t\t\tLoc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction.toUpperCase()}`)\n\t\t\t);\n\t\t}\n\t\tconst robotAction = Type.isNil(link) ? 'COPY' : link.robotAction.toUpperCase();\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction}`),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_COPY'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'copy');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_MOVE'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'move');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_SETTINGS'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.editLink(link);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.removeLink(link);\n\t\t\t\t\tconst parentMenu = this.getParentMenuWindow();\n\n\t\t\t\t\tif (parentMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tparentMenu\n\t\t\t\t\t\t\t.removeMenuItem(this.getParentMenuItem().id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\tchangeRobotAction(link: Link, action: string)\n\t{\n\t\tthis.emit('Marker:changeRobotAction', {\n\t\t\tlink,\n\t\t\taction,\n\t\t\tonChangeRobotEnd: () => this.emit('Marker:editLink', { link }),\n\t\t});\n\t}\n\n\teditLink(link: Link)\n\t{\n\t\tthis.emit('Marker:editLink', {link});\n\t}\n\n\taddLinkTo(destination: Marker, robotAction: string, preventSave = false)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.links].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\trobotAction,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\t\t\tdestination.emit('Marker:linkTo', {link, preventSave});\n\n\t\t\t\tthis.links.add(link);\n\n\t\t\t\tconst menu = this.getTunnelsListMenu();\n\t\t\t\tconst id = menu.getMenuItems().length;\n\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: `#${id}`,\n\t\t\t\t\ttext: Text.encode(destination.name),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonMouseEnter() {\n\t\t\t\t\t\t\tMarker.highlightLink(link);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseLeave() {\n\t\t\t\t\t\t\tMarker.unhighlightLinks();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\titems: this.getTunnelMenuItems(link),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.links.size > 1)\n\t\t\t{\n\t\t\t\tthis.setTunnelsCounterValue(this.links.size);\n\t\t\t}\n\t\t});\n\t}\n\n\taddStubLinkTo(destination: Marker)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.stubLinks].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow crm-st-svg-link-arrow-stub')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link crm-st-svg-link-stub')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelStubButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:stubLinkFrom', {link, preventSave: true});\n\t\t\t\tdestination.emit('Marker:stubLinkTo', {link, preventSave: true});\n\n\t\t\t\tthis.stubLinks.add(link);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateLink(link: Link, newTo: Marker, preventSave = false)\n\t{\n\t\tconst path = this.getLinkPath(newTo);\n\t\tconst line = d3.line();\n\t\tconst oldTo = link.to;\n\n\t\tlink.node\n\t\t\t.attr('d', line(path));\n\n\t\tlink.path = path;\n\t\tlink.to = newTo;\n\n\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\tnewTo.emit('Marker:linkTo', {link, preventSave});\n\n\t\tif (!oldTo.isLinked())\n\t\t{\n\t\t\toldTo.emit('Marker:unlink');\n\t\t}\n\t}\n\n\tremoveLink(link: Link, preventSave = false)\n\t{\n\t\t// @todo refactoring\n\n\t\tlink.hidden = true;\n\n\t\tif (!preventSave)\n\t\t{\n\t\t\tthis.links.delete(link);\n\t\t}\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedFrom())\n\t\t{\n\t\t\tDom.remove(link.from.getTunnelButton());\n\t\t\tthis.getTunnelMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelMenu');\n\t\t}\n\n\t\tthis.setTunnelsCounterValue(this.links.size);\n\n\t\tconst visibleLinks = [...this.links].filter(item => !item.hidden);\n\n\t\tif (visibleLinks.length <= 1)\n\t\t{\n\t\t\tif (this.getTunnelsListMenu().getPopupWindow().isShown())\n\t\t\t{\n\t\t\t\tthis.getTunnelMenu().destroy();\n\t\t\t\tthis.cache.delete('tunnelMenu');\n\n\t\t\t\tthis.getTunnelMenu().show();\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelsListMenu');\n\t\t}\n\n\t\tlink.from.emit('Marker:removeLinkFrom', {link, preventSave});\n\n\t\tif (!link.from.isLinked())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlink', {preventSave});\n\t\t}\n\n\t\tlink.to.emit('Marker:removeTo', {link, preventSave});\n\n\t\tif (!link.to.isLinked())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlink', {preventSave});\n\t\t}\n\t}\n\n\tremoveAllLinks(preventSave = false)\n\t{\n\t\tthis.links.forEach(link => this.removeLink(link, preventSave));\n\t}\n\n\tremoveStubLink(link: Link)\n\t{\n\t\tthis.stubLinks.delete(link);\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedStub())\n\t\t{\n\t\t\tDom.remove(link.from.getStubTunnelButton());\n\t\t}\n\n\t\tlink.from.emit('Marker:removeStubLink', {link});\n\t\tlink.from.emit('Marker:removeStubLinkFrom', {link});\n\n\t\tif (!link.from.isLinkedStub())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlinkStub');\n\t\t}\n\n\t\tlink.to.emit('Marker:removeStubTo', {link});\n\n\t\tif (!link.to.isLinkedStub())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlinkStub');\n\t\t}\n\t}\n\n\tremoveAllStubLinks()\n\t{\n\t\tthis.stubLinks.forEach(link => this.removeStubLink(link));\n\t}\n\n\tisLinked(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tisLinkedFrom(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.from === this);\n\t}\n\n\tisLinkedTo(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.to === this);\n\t}\n\n\tisLinkedStub(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tshowTunnelButton(path)\n\t{\n\t\tconst button = this.getTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetStubTunnelButton()\n\t{\n\t\treturn this.cache.remember('tunnelStubButton', () => {\n\t\t\tconst button = Runtime.clone(this.getTunnelButton());\n\t\t\tDom.addClass(button, 'crm-st-tunnel-button-stub');\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tshowTunnelStubButton(path)\n\t{\n\t\tconst button = this.getStubTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetTunnelButton()\n\t{\n\t\tconst canEdit = this.data.column.data.canEditTunnels;\n\t\treturn this.cache.remember('tunnelButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-tunnel-button\" \n\t\t\t\t\t onmouseenter=\"${this.onTunnelButtonMouseEnter.bind(this)}\"\n\t\t\t\t\t onmouseleave=\"${Marker.onTunnelButtonMouseLeave}\"\n\t\t\t\t\t onclick=\"${this.onTunnelButtonClick.bind(this)}\"\n\t\t\t\t\t title=\"${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_TITLE')}\"\n\t\t\t\t\t style=\"${!canEdit ? 'pointer-events: none;' : ''}\"\n\t\t\t\t>${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_LABEL')}</div>\n\t\t\t`\n\t\t));\n\t}\n\n\t/** @private */\n\tonTunnelButtonMouseEnter()\n\t{\n\t\tMarker.highlightLink(...this.links);\n\t}\n\n\t/** @private */\n\tstatic onTunnelButtonMouseLeave()\n\t{\n\t\tMarker.unhighlightLinks();\n\t}\n\n\t/** @private */\n\tonTunnelButtonClick()\n\t{\n\t\tif (this.links.size > 1)\n\t\t{\n\t\t\tif (this.isTunnelButtonActive())\n\t\t\t{\n\t\t\t\tthis.getTunnelsListMenu().close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getTunnelMenu().show();\n\t\t}\n\t}\n\n\tgetTunnelsListMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelsListMenu', (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: [],\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tmenuShowDelay: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tactivateTunnelButton()\n\t{\n\t\tDom.addClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tdeactivateTunnelButton()\n\t{\n\t\tDom.removeClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tisTunnelButtonActive(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tgetTunnelsCounter(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('tunnelsCounter', (\n\t\t\tTag.render`<span class=\"crm-st-tunnel-button-counter\">0</span>`\n\t\t));\n\t}\n\n\tsetTunnelsCounterValue(value: number)\n\t{\n\t\tconst tunnelButton = this.getTunnelButton();\n\t\tconst tunnelsCounter = this.getTunnelsCounter();\n\n\t\tif (value > 1)\n\t\t{\n\t\t\tif (!tunnelButton.contains(tunnelsCounter))\n\t\t\t{\n\t\t\t\tDom.append(tunnelsCounter, tunnelButton);\n\t\t\t}\n\n\t\t\ttunnelsCounter.innerText = value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttunnelsCounter.innerText = 0;\n\t\t\tDom.remove(tunnelsCounter);\n\t\t}\n\t}\n\n\tgetCategory(): HTMLDivElement\n\t{\n\t\treturn this.receiver.closest('.crm-st-category');\n\t}\n\n\tgetIntermediateXPoints(): Array<number>\n\t{\n\t\tif (Type.isArray(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\tif (Type.isFunction(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints()\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetNearestIntermediateXPoint(x: number): number\n\t{\n\t\treturn this.getIntermediateXPoints().reduce((prev, curr) => (\n\t\t\tMath.abs(curr - x) < Math.abs(prev - x) ? curr : prev\n\t\t));\n\t}\n\n\tgetLinkPath(target: Marker): Array<[number, number]>\n\t{\n\t\tconst targetPosition = target.getPointRect();\n\t\tconst currentPosition = this.getDispatcherRect();\n\n\t\tconst baseOffset = 80;\n\t\tconst markerMargin = 10;\n\t\tconst path = [];\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY,\n\t\t]);\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t]);\n\n\t\tif (currentPosition.middleY !== targetPosition.middleY)\n\t\t{\n\t\t\tconst intermediateX = this.getNearestIntermediateXPoint(targetPosition.middleX);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + baseOffset,\n\t\t\t]);\n\t\t}\n\n\t\tpath.push([\n\t\t\ttargetPosition.middleX,\n\t\t\ttargetPosition.middleY + markerMargin,\n\t\t]);\n\n\t\tconst lineOffset = 4;\n\n\t\treturn [...Marker.getAllLinks()].reduce((acc, link) => {\n\t\t\tconst {from, path: currentPath} = link;\n\n\t\t\tif (from !== this)\n\t\t\t{\n\t\t\t\t/**\n\t\t\t\t * Horizon lines\n\t\t\t\t * 1x -> 2x\n\t\t\t\t * 3x -> 4x\n\t\t\t\t */\n\n\t\t\t\tif (acc[1][1] === currentPath[1][1])\n\t\t\t\t{\n\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[1][1] === currentPath[3][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[3][1] === currentPath[1][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (acc[3][1] === currentPath[3][1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Vertical line\n\t\t\t\t * 2y -> 3y\n\t\t\t\t */\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[2][0] === currentPath[2][0])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[2][1], acc[3][1]], [currentPath[2][1], currentPath[3][1]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[2][0] += lineOffset;\n\t\t\t\t\t\t\tacc[3][0] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [...path]);\n\t}\n\n\tgetDestinationMarker(): ?Marker\n\t{\n\t\tconst mousePosition = this.getMarkerRootMousePosition();\n\t\tconst destinationMarker = Marker.getMarkerFromPoint(mousePosition);\n\n\t\tif (destinationMarker && destinationMarker !== this)\n\t\t{\n\t\t\treturn destinationMarker;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisReceiverIntersecting(point): boolean\n\t{\n\t\tconst receiverRect = this.getReceiverRect();\n\t\tconst heightOffset = 10;\n\n\t\treturn (\n\t\t\t(point.x > receiverRect.left && point.x < receiverRect.right)\n\t\t\t&& (point.y > receiverRect.top && point.y < (receiverRect.bottom + heightOffset))\n\t\t);\n\t}\n\n\tblurLinks()\n\t{\n\t\tMarker.blurLinks(this);\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.data;\n\t}\n}","import {Event} from 'main.core';\n\nexport default function isLinkInSameCategory(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\tconst dataFrom = columnFrom.getData();\n\tconst dataTo = columnTo.getData();\n\n\treturn String(dataFrom.category.id) === String(dataTo.category.id);\n}","import {Event} from 'main.core';\nimport Marker from '../marker/marker';\n\nexport default function isCycleLink(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\n\treturn [...Marker.getAllLinks()].some((item) => {\n\t\treturn item.from === columnTo.marker && item.to === columnFrom.marker;\n\t});\n}","import {Dom, Type, Tag, Event, Loc} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\nimport isLinkInSameCategory from '../internal/is-link-in-same-category';\nimport isCycleLink from '../internal/is-cycle-link';\n\nexport default class Column extends Kanban.Column\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.currentName = this.getName();\n\n\t\tthis.marker = new Marker({\n\t\t\tdispatcher: this.getDot(),\n\t\t\treceiver: this.getHeader(),\n\t\t\tpoint: this.getDot(),\n\t\t\tcontainer: this.getData().appContainer,\n\t\t\tintermediateXPoints: () => this.getIntermediateXPoints(),\n\t\t\tname: `${this.getData().categoryName} (${this.getName()})`,\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t}\n\t\t});\n\n\t\tthis.marker\n\t\t\t.subscribe('Marker:dragStart', this.onMarkerDragStart.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOver', this.onMarkerDragOver.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOut', this.onMarkerDragOut.bind(this))\n\t\t\t.subscribe('Marker:dragEnd', this.onMarkerDragEnd.bind(this))\n\t\t\t.subscribe('Marker:linkFrom', this.onMarkerLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:stubLinkFrom', this.onMarkerStubLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:linkTo', this.onMarkerLinkTo.bind(this))\n\t\t\t.subscribe('Marker:stubLinkTo', this.onMarkerStubLinkTo.bind(this))\n\t\t\t.subscribe('Marker:removeLinkFrom', this.onRemoveLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:changeRobotAction', this.onChangeRobotAction.bind(this))\n\t\t\t.subscribe('Marker:editLink', this.onEditLink.bind(this))\n\t\t\t.subscribe('Marker:unlink', this.onMarkerUnlink.bind(this))\n\t\t\t.subscribe('Marker:unlinkStub', this.onMarkerUnlinkStub.bind(this))\n\t\t\t.subscribe('Marker:error', this.onMarkerError.bind(this));\n\n\n\t\tthis.onTransitionStart = this.onTransitionStart.bind(this);\n\t\tthis.onTransitionEnd = this.onTransitionEnd.bind(this);\n\t}\n\n\tisAllowedTransitionProperty(propertyName)\n\t{\n\t\treturn [\n\t\t\t'width',\n\t\t\t'min-width',\n\t\t\t'max-width',\n\t\t\t'transform',\n\t\t].includes(propertyName);\n\t}\n\n\tonTransitionStart(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = setInterval(Marker.adjustLinks, 16);\n\t\t}\n\t}\n\n\tonTransitionEnd(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = null;\n\t\t}\n\t}\n\n\tsetOptions(options: {name?: string; color?: string; data?: {[p: string]: any}; total?: number})\n\t{\n\t\tsuper.setOptions(options);\n\n\t\tif (Type.isFunction(options.data.onLink))\n\t\t{\n\t\t\tthis.onLinkHandler = options.data.onLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemoveLinkFrom))\n\t\t{\n\t\t\tthis.onRemoveLinkFromHandler = options.data.onRemoveLinkFrom;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChangeRobotAction))\n\t\t{\n\t\t\tthis.onChangeRobotAction = options.data.onChangeRobotAction;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onEditLink))\n\t\t{\n\t\t\tthis.onEditLinkhandler = options.data.onEditLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onNameChange))\n\t\t{\n\t\t\tthis.onNameChangeHandler = options.data.onNameChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onColorChange))\n\t\t{\n\t\t\tthis.onColorChangeHandler = options.data.onColorChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onAddColumn))\n\t\t{\n\t\t\tthis.onAddColumnHandler = options.data.onAddColumn;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemove))\n\t\t{\n\t\t\tthis.onRemoveHandler = options.data.onRemove;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChange))\n\t\t{\n\t\t\tthis.onChangeHandler = options.data.onChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onError))\n\t\t{\n\t\t\tthis.onErrorHandler = options.data.onError;\n\t\t}\n\n\t\tif (this.marker)\n\t\t{\n\t\t\tthis.marker.container = this.getData().appContainer;\n\t\t\tif (Type.isFunction(this.marker.cache.clear))\n\t\t\t{\n\t\t\t\tthis.marker.cache.clear();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerError(event)\n\t{\n\t\tthis.onErrorHandler(event.data);\n\t}\n\n\tonEditLink(event)\n\t{\n\t\tthis.onEditLinkhandler(event.data);\n\t}\n\n\tonMarkerLinkFrom(event)\n\t{\n\t\tthis.onLinkHandler(event.data);\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerStubLinkFrom()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonMarkerStubLinkTo()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonRemoveLinkFrom(event)\n\t{\n\t\tthis.onRemoveLinkFromHandler(event.data);\n\t}\n\n\tonMarkerLinkTo()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tgetIntermediateXPoints()\n\t{\n\t\tconst {\n\t\t\tprogressStagesGroup,\n\t\t\tsuccessStagesGroup,\n\t\t\tfailStagesGroup,\n\t\t} = this.getData().stagesGroups;\n\n\t\tconst progressRect = progressStagesGroup.getBoundingClientRect();\n\t\tconst successRect = successStagesGroup.getBoundingClientRect();\n\t\tconst failRect = failStagesGroup.getBoundingClientRect();\n\n\t\tconst offset = 15;\n\n\t\treturn [\n\t\t\tprogressRect.left + offset,\n\t\t\tsuccessRect.left - offset,\n\t\t\tsuccessRect.left + offset,\n\t\t\tsuccessRect.right - offset,\n\t\t\tsuccessRect.right + offset,\n\t\t\tfailRect.right - (offset / 2),\n\t\t];\n\t}\n\n\tonMarkerDragStart()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerDragOver(event: Event.BaseEvent)\n\t{\n\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.disallowDot();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.allowDot();\n\t\tthis.highlightDot();\n\t}\n\n\tonMarkerDragOut()\n\t{\n\t\tthis.allowDot();\n\t\tthis.unhighlightDot();\n\t}\n\n\tonMarkerDragEnd(event: Event.BaseEvent)\n\t{\n\t\tif (!this.marker.isLinked())\n\t\t{\n\t\t\tthis.deactivateDot();\n\t\t}\n\n\t\tif (event.data.from && event.data.to)\n\t\t{\n\t\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerUnlink()\n\t{\n\t\tthis.deactivateDot();\n\t\tthis.deactivateStubDot();\n\t}\n\n\tonMarkerUnlinkStub()\n\t{\n\t\tthis.deactivateStubDot();\n\t}\n\n\tactivateDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tdeactivateDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tactivateStubDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\tdeactivateStubDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\thighlightDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tunhighlightDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tallowDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tdisallowDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tgetBody()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDot()\n\t{\n\t\tif (!Type.isDomNode(this.dot))\n\t\t{\n\t\t\tconst title = Loc.getMessage('CRM_ST_DOT_TITLE');\n\t\t\tthis.dot = Tag.render`<div class=\"crm-st-kanban-column-dot\" title=\"${title}\">\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-disallow-icon\"> </span>\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-pulse\"> </span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.dot;\n\t}\n\n\tgetHeader()\n\t{\n\t\tconst header = super.getHeader();\n\n\t\tif (!this.headerDotted)\n\t\t{\n\t\t\tthis.headerDotted = true;\n\n\t\t\tconst dot = this.getDot();\n\n\t\t\tEvent.bind(dot, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mouseup', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mousemove', (event) => event.stopPropagation());\n\n\t\t\tDom.append(dot, header);\n\t\t}\n\n\t\tTag.attrs(header)`\n\t\t\ttitle: ${this.getName()};\n\t\t`;\n\n\t\treturn header;\n\t}\n\n\tgetSubTitle()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetContainer()\n\t{\n\t\tconst container = super.getContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-column');\n\n\t\tEvent.bind(container, 'transitionstart', this.onTransitionStart);\n\t\tEvent.bind(container, 'transitionend', this.onTransitionEnd);\n\t\treturn container;\n\t}\n\n\tgetTotalItem()\n\t{\n\t\tthis.layout.total = createStub();\n\t\treturn this.layout.total;\n\t}\n\n\thandleTextBoxBlur(event)\n\t{\n\t\tsuper.handleTextBoxBlur(event);\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.currentName !== this.getName())\n\t\t\t{\n\t\t\t\tthis.onNameChangeHandler(this);\n\t\t\t\tthis.currentName = this.getName();\n\n\t\t\t\tTag.attrs(this.getHeader())`\n\t\t\t\t\ttitle: ${this.getName()};\n\t\t\t\t`;\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\tonColorSelected(color)\n\t{\n\t\tsuper.onColorSelected(color);\n\t\tthis.onColorChangeHandler(this);\n\t}\n\n\thandleAddColumnButtonClick(event)\n\t{\n\t\tthis.onAddColumnHandler(this);\n\t}\n\n\thandleRemoveButtonClick(event: any)\n\t{\n\t\tthis.getConfirmDialog().setContent(Loc.getMessage('CRM_ST_CONFIRM_STAGE_REMOVE_TEXT'));\n\t\tsuper.handleRemoveButtonClick(event);\n\t}\n\n\thandleConfirmButtonClick() {\n\t\t// @todo refactoring\n\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tMarker.getAllLinks()\n\t\t\t\t\t\t.forEach((link) => {\n\t\t\t\t\t\t\tif (String(link.to.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (String(link.from.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\tsuper.handleConfirmButtonClick();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tMarker.removeAllLinks();\n\t\t\t\t\t\tMarker.restoreAllLinks();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.getConfirmDialog().close();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.onRemoveHandler(event);\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tsuper.switchToEditMode();\n\t}\n\n\tapplyEditMode()\n\t{\n\t\tconst title = BX.util.trim(this.getTitleTextBox().value);\n\t\tconst colorChanged = this.colorChanged;\n\t\tlet titleChanged = false;\n\t\tif (title.length > 0 && this.getName() !== title)\n\t\t{\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tsuper.applyEditMode();\n\n\t\tif (titleChanged || colorChanged)\n\t\t{\n\t\t\tthis.onChangeHandler(this);\n\t\t}\n\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDrag(x, y)\n\t{\n\t\tsuper.onColumnDrag(x, y);\n\t\tMarker.adjustLinks();\n\t}\n\n\tresetRectArea()\n\t{\n\t\tsuper.resetRectArea();\n\n\t\tclearTimeout(this.resetRectAreaTimeoutId);\n\t\tthis.resetRectAreaTimeoutId = setTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t}, 200);\n\t}\n}","import {Dom, Event} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\n\nexport default class Grid extends Kanban.Grid\n{\n\temitter = new Event.EventEmitter();\n\n\tadjustLayout() {}\n\tadjustHeight() {}\n\n\tgetEmptyStub()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDropZoneArea()\n\t{\n\t\tconst area = super.getDropZoneArea();\n\t\tDom.addClass(area.getContainer(), 'crm-st-kanban-stub');\n\t\treturn area;\n\t}\n\n\tgetGridContainer()\n\t{\n\t\tconst container = super.getGridContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-grid');\n\t\treturn container;\n\t}\n\n\tgetInnerContainer(): HTMLElement\n\t{\n\t\tconst container = super.getInnerContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-inner');\n\t\treturn container;\n\t}\n\n\tgetOuterContainer(): HTMLElement\n\t{\n\t\tconst container = super.getOuterContainer();\n\t\tDom.addClass(container, 'crm-st-kanban');\n\t\treturn container;\n\t}\n\n\tgetLeftEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetRightEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tonColumnDragStart(column)\n\t{\n\t\tsuper.onColumnDragStart(column);\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDragStop(column)\n\t{\n\t\tsuper.onColumnDragStop(column);\n\t\tthis.emitter.emit('Kanban.Grid:columns:sort');\n\n\t\tsetTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t});\n\n\t\tthis.getColumns().forEach((column) => {\n\t\t\tclearInterval(column.intervalId);\n\t\t});\n\t}\n\n\tgetColumns(): Array<Column> {\n\t\tthis.columnsOrder.sort((a, b) => {\n\t\t\tif (a.getContainer().parentNode)\n\t\t\t{\n\t\t\t\tconst aIndex = [...a.getContainer().parentNode.children].indexOf(a.getContainer());\n\t\t\t\tconst bIndex = [...b.getContainer().parentNode.children].indexOf(b.getContainer());\n\n\t\t\t\treturn aIndex > bIndex ? 1 : -1;\n\t\t\t}\n\t\t});\n\n\t\treturn this.columnsOrder;\n\t}\n}","import {Event, Loc, Tag, Dom, Text, Type, Cache, pos} from 'main.core';\nimport {PopupWindow, PopupWindowButton, PopupWindowButtonLink, Menu} from 'main.popup';\nimport Column from '../kanban/column';\nimport Grid from '../kanban/grid';\nimport Marker from '../marker/marker';\nimport type CategoryOptions from '../type/category-options';\nimport type jsDDObject from '../type/jsdd-object';\n\nexport class Category extends Event.EventEmitter\n{\n\tstatic instances: Array<Category> = [];\n\n\tstatic createGrid(options: {\n\t\trenderTo: HTMLElement,\n\t\tcolumns: Array<Column>,\n\t\teditable?: boolean,\n\t\tcolumnType?: string,\n\t})\n\t{\n\t\treturn new Grid({\n\t\t\trenderTo: options.renderTo,\n\t\t\tcanEditColumn: options.editable === true,\n\t\t\tcanRemoveColumn: options.editable === true,\n\t\t\tcanAddColumn: options.editable === true,\n\t\t\tcanSortColumn: options.editable === true,\n\t\t\tcolumnType: options.columnType || 'BX.Crm.SalesTunnels.Kanban.Column',\n\t\t\tdropzoneType: 'BX.Crm.SalesTunnels.Kanban.DropZone',\n\t\t\tcolumns: options.columns,\n\t\t});\n\t}\n\n\tconstructor(options: CategoryOptions)\n\t{\n\t\tsuper();\n\n\t\tCategory.instances.push(this);\n\t\tthis.renderTo = options.renderTo;\n\t\tthis.appContainer = options.appContainer;\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.access = options.access;\n\t\tthis.sort = Number.parseInt(options.sort);\n\t\tthis.default = Boolean(options.default);\n\t\tthis.generatorsCount = Number(options.generatorsCount);\n\t\tthis.generatorsListUrl = options.generatorsListUrl;\n\t\tthis.stages = options.stages;\n\t\tthis.robotsSettingsLink = options.robotsSettingsLink.replace('{category}', this.id);\n\t\tthis.generatorSettingsLink = options.generatorSettingsLink;\n\t\tthis.permissionEditLink = options.permissionEditLink.replace('{category}', this.id);\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.drawed = false;\n\t\tthis.allowWrite = Boolean(options.allowWrite);\n\t\tthis.canEditTunnels = Boolean(options.canEditTunnels);\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.showGeneratorRestrictionPopup = options.showGeneratorRestrictionPopup;\n\t\tthis.isAvailableRobots = options.isAvailableRobots;\n\t\tthis.showRobotsRestrictionPopup = options.showRobotsRestrictionPopup;\n\t\tthis.isSenderSupported = options.isSenderSupported;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\n\t\tif (!options.lazy)\n\t\t{\n\t\t\tthis.draw();\n\t\t}\n\n\t\tif (this.generatorsCount > 0)\n\t\t{\n\t\t\tthis.showGeneratorLinkIcon();\n\t\t}\n\n\t\tconst dragButton = this.getDragButton();\n\t\tdragButton.onbxdragstart = this.onDragStart.bind(this);\n\t\tdragButton.onbxdrag = this.onDrag.bind(this);\n\t\tdragButton.onbxdragstop = this.onDragStop.bind(this);\n\n\t\t// eslint-disable-next-line\n\t\tjsDD.registerObject(dragButton, 40);\n\t\tthis.adjustRobotsLinkIcon();\n\n\t\tthis.getProgressKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getSuccessKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getFailKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\t\t\tthis.getAllColumns()\n\t\t\t\t.forEach((column) => {\n\t\t\t\t\tcolumn.marker.disable();\n\t\t\t\t});\n\t\t}\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-stages-stub');\n\t\t}\n\t\tif (!this.isSenderSupported)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-generator-disabled');\n\t\t}\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\treturn this.getAllColumns()\n\t\t\t.some(column => column.marker.links.size > 0);\n\t}\n\n\tgetRectArea(): DOMRect | {middle: number}\n\t{\n\t\treturn this.cache.remember('rectArea', () => {\n\t\t\tconst rectArea = pos(this.getContainer());\n\t\t\trectArea.middle = rectArea.top + rectArea.height / 2;\n\n\t\t\treturn rectArea;\n\t\t});\n\t}\n\n\tgetIndex(): number | void\n\t{\n\t\treturn [...this.getContainer().parentNode.querySelectorAll('.crm-st-category')]\n\t\t\t.findIndex(item => item === this.getContainer());\n\t}\n\n\tgetNextCategorySibling(): ?Category\n\t{\n\t\treturn Category.instances.find((category, index) => index > this.getIndex()) || null;\n\t}\n\n\t/** @private */\n\tonDragStart()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-drag');\n\t\tMarker.removeAllLinks();\n\n\t\t// eslint-disable-next-line\n\t\tthis.dragOffset = jsDD.start_y - this.getRectArea().top;\n\t\tthis.dragIndex = this.getIndex();\n\t\tthis.dragTargetCategory = this.dragTargetCategory || this;\n\t}\n\n\t/** @private */\n\tonDrag(x, y)\n\t{\n\t\tTag.style(this.getContainer())`\n\t\t\ttransform: translate3d(0px, ${y - this.dragOffset - this.getRectArea().top}px, 0px);\n\t\t`;\n\n\t\tconst categoryHeight = this.getRectArea().height;\n\n\t\tCategory.instances.forEach((category, curIndex) => {\n\t\t\tif (\n\t\t\t\tcategory === this\n\t\t\t\t|| Dom.hasClass(category.getContainer(), 'crm-st-category-stub')\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst categoryContainer = category.getContainer();\n\t\t\tconst categoryRectArea = category.getRectArea();\n\t\t\tconst categoryMiddle = categoryRectArea.middle;\n\n\t\t\tif (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${(-categoryHeight)}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(-categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${categoryHeight}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tconst moveBackTop = (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tconst moveBackBottom = (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tif (moveBackBottom || moveBackTop)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, 0px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tif (\n\t\t\t\t\t!moveBackTop\n\t\t\t\t\t&& Dom.hasClass(category.getNextCategorySibling(), 'crm-st-category-stub')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\t\t\t\t}\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @private */\n\tonDragStop()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-drag');\n\n\t\trequestAnimationFrame(() => {\n\t\t\tMarker.restoreAllLinks();\n\t\t});\n\n\t\tCategory.instances.forEach((category) => {\n\t\t\tTag.style(category.getContainer())`\n\t\t\t\ttransform: null;\n\t\t\t\ttransition: null;\n\t\t\t`;\n\n\t\t\tcategory.cache.delete('rectArea');\n\t\t});\n\n\t\tif (this.dragTargetCategory)\n\t\t{\n\t\t\tDom.insertBefore(this.getContainer(), this.dragTargetCategory.getContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getContainer(), this.getContainer().parentElement);\n\t\t}\n\n\t\tconst before = Category.instances.map(item => item.getIndex());\n\t\tCategory.instances.sort((a, b) => (\n\t\t\ta.getIndex() > b.getIndex() ? 1 : -1\n\t\t));\n\t\tconst after = Category.instances.map(item => item.getIndex());\n\n\t\tif (JSON.stringify(before) !== JSON.stringify(after))\n\t\t{\n\t\t\tthis.emit('Category:sort');\n\t\t}\n\t}\n\n\tgetContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('container', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category\" data-id=\"${this.id}\">\n\t\t\t\t\t<div class=\"crm-st-category-action\">\n\t\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-info\">\n\t\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t\t<div class=\"crm-st-category-info-links\">\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getRobotsLink()}\n\t\t\t\t\t\t\t\t${this.getRobotsHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getGeneratorLink()}\n\t\t\t\t\t\t\t\t${this.getGeneratorHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-stages\">\n\t\t\t\t\t\t${this.getProgressContainer()}\n\t\t\t\t\t\t${this.getSuccessContainer()}\n\t\t\t\t\t\t${this.getFailContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetRobotsHelpLink()\n\t{\n\t\treturn this.cache.remember('robotsHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=6908975');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-automation\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_ROBOTS_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetGeneratorHelpLink()\n\t{\n\t\treturn this.cache.remember('generatorHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=7530721');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-generator\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_GENERATOR_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-in-progress\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${Loc.getMessage(\n\t\t\t\t\t\t\t\tthis.isStagesEnabled\n\t\t\t\t\t\t\t\t\t? 'CRM_ST_STAGES_GROUP_IN_PROGRESS'\n\t\t\t\t\t\t\t\t\t: 'CRM_ST_STAGES_DISABLED'\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getProgressStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressKanban(): Grid\n\t{\n\t\treturn this.cache.remember('progressKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getProgressStagesContainer(),\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcolumns: this.stages.P.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetSuccessContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-success\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-success\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_SUCCESS') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getSuccessStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessKanban(): Grid\n\t{\n\t\treturn this.cache.remember('successKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getSuccessStagesContainer(),\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcolumns: this.stages.S.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t\tcanRemove: false,\n\t\t\t\t\t\tcanSort: false,\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetFailContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-fail\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-fail\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_FAIL') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getFailStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailKanban(): Grid\n\t{\n\t\treturn this.cache.remember('failKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getFailStagesContainer(),\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcolumns: this.stages.F.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetColumnData(stage)\n\t{\n\t\treturn {\n\t\t\tstageId: stage.ID,\n\t\t\tentityId: stage.ENTITY_ID,\n\t\t\tstage,\n\t\t\tonLink: (link) => {\n\t\t\t\tthis.emit('Column:link', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonRemoveLinkFrom: (link) => {\n\t\t\t\tthis.emit('Column:removeLinkFrom', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonChangeRobotAction: (event) => {\n\t\t\t\tthis.emit('Column:changeRobotAction', event);\n\t\t\t},\n\t\t\tonEditLink: (link) => {\n\t\t\t\tthis.emit('Column:editLink', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonNameChange: (column) => {\n\t\t\t\tthis.emit('Column:nameChange', {column});\n\t\t\t},\n\t\t\tonColorChange: (column) => {\n\t\t\t\tthis.emit('Column:colorChange', {column});\n\t\t\t},\n\t\t\tonAddColumn: (column) => {\n\t\t\t\tthis.emit('Column:addColumn', {column});\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tthis.emit('Column:remove', event);\n\t\t\t},\n\t\t\tonChange: (column) => {\n\t\t\t\tthis.emit('Column:change', {column});\n\t\t\t},\n\t\t\tonSort: () => {\n\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tonError: (event) => {\n\t\t\t\tthis.emit('Column:error', event);\n\t\t\t},\n\t\t\tcategory: this,\n\t\t\tappContainer: this.appContainer,\n\t\t\tcategoryContainer: this.getFailContainer(),\n\t\t\tstagesGroups: {\n\t\t\t\tprogressStagesGroup: this.getProgressContainer(),\n\t\t\t\tsuccessStagesGroup: this.getSuccessContainer(),\n\t\t\t\tfailStagesGroup: this.getFailContainer(),\n\t\t\t},\n\t\t\tcurrentStageGroup: this.getFailContainer(),\n\t\t\tcategoryName: this.getTitle().innerText,\n\t\t\tcanEditTunnels: this.canEditTunnels,\n\t\t};\n\t}\n\n\t/** @private */\n\tonRightsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetRobotsLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLink', () => {\n\t\t\tconst onClick = this.onRobotsLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${!this.isAvailableRobots ? ' <span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-robots-link crm-st-automation\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_ROBOT_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonRobotsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isAvailableRobots)\n\t\t{\n\t\t\tthis.showRobotsRestrictionPopup();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tthis.robotsSettingsLink,\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tgetGeneratorLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLink', () => {\n\t\t\tconst onClick = this.onGeneratorLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${!this.isAvailableGenerator ? ' <span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-generator-link crm-st-generator\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_GENERATOR_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonGeneratorLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isAvailableGenerator)\n\t\t{\n\t\t\tthis.showGeneratorRestrictionPopup();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tthis.generatorSettingsLink,\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\t\tthis.emit('Category:slider:generator:close', {category: this});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tgetEditButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('editButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-edit-button\" \n\t\t\t\t\tonmousedown=\"${this.onEditButtonClick.bind(this)}\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_CATEGORY_TITLE')}\"\n\t\t\t\t\t> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tactivateEditButton()\n\t{\n\t\tDom.addClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tdeactivateEditButton()\n\t{\n\t\tDom.removeClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tonEditButtonClick(event?: MouseEvent)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.disableTitleEdit();\n\t\t\tthis.saveTitle();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableTitleEdit();\n\t}\n\n\tshowTitleEditor(value: ?string = null)\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {innerText} = this.getTitle();\n\n\t\ttitleEditor.value = Type.isString(value) ? value : Text.decode(innerText);\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: block;\n\t\t`;\n\t}\n\n\thideTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\tfocusOnTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\ttitleEditor.focus();\n\n\t\tconst title = this.getTitle();\n\t\ttitleEditor.setSelectionRange(titleLength, titleLength);\n\t\tconst titleLength = title.innerText.length;\n\t}\n\n\tshowTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\thideTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: none;\n\t\t`;\n\t}\n\n\tsaveTitle()\n\t{\n\t\tconst title = this.getTitle();\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {value} = titleEditor;\n\t\tconst newTitle = value.trim() || Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER');\n\n\t\tif (title.innerText !== newTitle)\n\t\t{\n\t\t\ttitle.innerText = newTitle;\n\t\t\tDom.attr(title, 'title', newTitle);\n\n\t\t\tthis.name = newTitle;\n\t\t\tthis.emit('Category:title:save', {categoryId: this.id, value: newTitle});\n\t\t}\n\t}\n\n\tenableTitleEdit(value = null)\n\t{\n\t\tthis.hideTitle();\n\t\tthis.showTitleEditor(value);\n\t\tthis.activateEditButton();\n\t\tthis.focusOnTitleEditor();\n\t}\n\n\tdisableTitleEdit()\n\t{\n\t\tthis.showTitle();\n\t\tthis.hideTitleEditor();\n\t\tthis.deactivateEditButton();\n\t}\n\n\tisTitleEditEnabled(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tgetOptionButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('optionButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-option-button\" \n\t\t\t\t\tonclick=\"${this.onOptionButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_RIGHTS_CATEGORY')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonOptionButtonClick()\n\t{\n\t\tconst onMenuItemClick = (event, item : MenuItem) => {\n\t\t\tthis.emit('Category:access', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\taccess : item.dataset[\"access\"],\n\t\t\t\tonConfirm: () => {\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t},\n\t\t\t});\n\t\t\tDom.addClass(item.getContainer(), \"menu-popup-item-accept\");\n\t\t\tDom.removeClass(item.getContainer(), \"menu-popup-no-icon\");\n\t\t\tthis.access = item.dataset[\"access\"];\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther === item)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\t\tconst onSubMenuItemClick = (event, item : MenuItem) => {\n\t\t\tthis.emit('Category:access:copy', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\tdonorCategoryId : item.dataset[\"categoryId\"],\n\t\t\t\tonConfirm: () => {\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.access = item.dataset[\"access\"];\n\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther.dataset === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.access === itemOther.dataset[\"access\"])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\n\t\tlet items = Category.instances.\n\t\tfilter((category) => {\n\t\t\treturn this.id !== category.id && category.id !== 'stub';\n\t\t}).\n\t\tmap((category) => {\n\t\t\treturn {\n\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\tdataset : {\n\t\t\t\t\tcategoryId : category.id,\n\t\t\t\t\taccess : category.access\n\t\t\t\t},\n\t\t\t\tonclick : onSubMenuItemClick\n\t\t\t};\n\t\t});\n\n\t\tthis.menuWindow = new Menu({\n\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\tbindElement: this.getOptionButton(),\n\t\t\titems: ([\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_ALL_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"X\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_NONE_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_OWN_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"A\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(items.length > 0 ? {\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_COPY_FROM_TUNNELS'),\n\t\t\t\t\titems: items\n\t\t\t\t} : null),\n\t\t\t\t{ delimiter : true },\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_CUSTOM'),\n\t\t\t\t\tdataset: { access: false },\n\t\t\t\t\tclassName: this.access !== \"A\" &&  this.access !== \"X\" && this.access !== \"\"? \"menu-popup-item-accept\" : \"\",\n\t\t\t\t\thref : this.permissionEditLink,\n\t\t\t\t\ttarget: \"_blank\",\n\t\t\t\t\tonclick : (event, item) => {\n\t\t\t\t\t\titem.getMenuWindow().close()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t].\n\t\t\tfilter(preItem => preItem !== null).\n\t\t\tmap((preItem) => {\n\t\t\t\tif (preItem.dataset)\n\t\t\t\t{\n\t\t\t\t\tif (this.access === preItem.dataset.access)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreItem.className = \"menu-popup-item-accept\";\n\t\t\t\t\t}\n\t\t\t\t\tif (!preItem.onclick)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreItem.onclick = onMenuItemClick;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn preItem;\n\t\t\t})),\n\t\t\tevents: {\n\t\t\t\tonClose : function() {\n\t\t\t\t\tDom.removeClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\t\t\t\tDom.removeClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\t\t\t\tsetTimeout(this.removeBlur.bind(this), 200);\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toffsetLeft: 9\n\t\t});\n\n\t\tDom.addClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\tDom.addClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\tthis.menuWindow.show();\n\n\t\tthis.addBlur();\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-remove-button\" \n\t\t\t\t\tonclick=\"${this.onRemoveButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_REMOVE_CATEGORY')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\n\t\t\tif (this.default)\n\t\t\t{\n\t\t\t\tTag.style(button)`\n\t\t\t\t\tdisplay: none;\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.showConfirmRemovePopup()\n\t\t\t.then(({confirm}) => {\n\t\t\t\tif (confirm)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Category:remove', {\n\t\t\t\t\t\tcategoryId: this.id,\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tthis.remove();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.removeBlur();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.removeBlur();\n\t\t\t});\n\n\t\tthis.addBlur();\n\t}\n\n\tgetAllColumns()\n\t{\n\t\tconst progressColumns = this.getProgressKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst successColumn = this.getSuccessKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst failColumns = this.getFailKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\n\t\treturn [\n\t\t\t...progressColumns,\n\t\t\t...successColumn,\n\t\t\t...failColumns,\n\t\t];\n\t}\n\n\taddBlur()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-blur');\n\n\t\tthis.getAllColumns().forEach((column) => {\n\t\t\tcolumn.marker.blurLinks();\n\t\t});\n\t}\n\n\tremoveBlur()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-blur');\n\t\tMarker.unblurLinks();\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.getContainer());\n\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tMarker.getAllStubLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeStubLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeStubLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tCategory.instances = Category.instances.filter(item => item !== this);\n\t}\n\n\tgetTitle(): HTMLHeadingElement\n\t{\n\t\tconst safeTitle = Text.encode(this.name);\n\t\treturn this.cache.remember('title', () => (\n\t\t\tTag.render`\n\t\t\t\t<h3 class=\"crm-st-category-info-title\" title=\"${safeTitle}\">${safeTitle}</h3>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleEditor(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('titleEditor', () => {\n\t\t\tconst onKeyDown = this.onTitleEditorKeyDown.bind(this);\n\t\t\tconst onBlur = this.onTitleEditorBlur.bind(this);\n\t\t\treturn Tag.render`\n\t\t\t\t<input class=\"crm-st-category-info-title-editor\" \n\t\t\t\t\t onkeydown=\"${onKeyDown}\"\n\t\t\t\t\t onblur=\"${onBlur}\"\n\t\t\t\t\t value=\"${Text.encode(this.name)}\"\n\t\t\t\t\t placeholder=\"${Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER')}\"\n\t\t\t\t >\n\t\t\t`;\n\t\t});\n\t}\n\n\tonTitleEditorKeyDown(event: KeyboardEvent | UIEvent)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tif (event.key.startsWith('Enter'))\n\t\t\t{\n\t\t\t\tthis.onEditButtonClick();\n\t\t\t}\n\n\t\t\tif (event.key.startsWith('Esc'))\n\t\t\t{\n\t\t\t\tthis.disableTitleEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonTitleEditorBlur()\n\t{\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.onEditButtonClick();\n\t\t}\n\t}\n\n\tgetActionsButtons(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('getActionsButtons', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-action-buttons\">\n\t\t\t\t\t${this.canEditTunnels ? this.getEditButton() : ''}\n\t\t\t\t\t${this.canEditTunnels ? this.getOptionButton() : ''}\n\t\t\t\t\t${this.canEditTunnels ? this.getRemoveButton() : ''}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-info-title-container\">\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t${this.getTitleEditor()}\n\t\t\t\t\t${this.getActionsButtons()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetDragButton(): HTMLSpanElement | jsDDObject\n\t{\n\t\treturn this.cache.remember('dragButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-action-drag\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_CATEGORY_DRAG_BUTTON')}\"\n\t\t\t\t\t>&nbsp;</span>\n\t\t\t`\n\t\t));\n\t}\n\n\tisDrawed()\n\t{\n\t\treturn this.drawed;\n\t}\n\n\tdraw()\n\t{\n\t\tif (!this.isDrawed())\n\t\t{\n\t\t\tthis.drawed = true;\n\t\t\tDom.append(this.getContainer(), this.renderTo);\n\n\t\t\tthis.getProgressKanban().draw();\n\t\t\tthis.getSuccessKanban().draw();\n\t\t\tthis.getFailKanban().draw();\n\t\t}\n\t}\n\n\tgetKanbanColumn(columnId)\n\t{\n\t\tconst columns = [\n\t\t\t...this.getProgressKanban().getColumns(),\n\t\t\t...this.getSuccessKanban().getColumns(),\n\t\t\t...this.getFailKanban().getColumns(),\n\t\t];\n\n\t\treturn columns.find(column => (\n\t\t\tcolumnId === column.getId() || columnId === column.getData().statusId\n\t\t));\n\t}\n\n\tshowConfirmRemovePopup(): Promise<{confirm: boolean}>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid (new PopupWindow({\n\t\t\t\twidth: 400,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 30,\n\t\t\t\t},\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_TITLE')\n\t\t\t\t\t.replace('#name#', this.getTitle().innerText),\n\t\t\t\tcontent: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_DESCRIPTION'),\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButton({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_REMOVE_BUTTON_LABEL'),\n\t\t\t\t\t\tclassName: 'popup-window-button-decline',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: true});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_CANCEL_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: false});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t})).show();\n\t\t});\n\t}\n\n\tgetRobotsLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLinkIcon', () => (\n\t\t\tTag.render`\n\t\t\t\t<span class=\"crm-st-robots-link-icon\"> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tshowRobotsLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getRobotsLinkIcon(), this.getRobotsLink());\n\t}\n\n\thideRobotsLinkIcon()\n\t{\n\t\tDom.remove(this.getRobotsLinkIcon());\n\t}\n\n\tadjustRobotsLinkIcon()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showRobotsLinkIcon();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.hideRobotsLinkIcon();\n\t\t});\n\t}\n\n\tgetGeneratorLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLinkIcon', () => {\n\t\t\tconst onClick = () => BX.SidePanel.Instance.open(this.generatorsListUrl);\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-generator-link-icon\" onclick=\"${onClick}\">${this.generatorsCount}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tshowGeneratorLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getGeneratorLinkIcon(), this.getGeneratorLink());\n\t}\n}\n","import {ajax} from 'main.core';\nimport type RequestResponse from './type/request-response';\nimport type CreateCategoryOptions from './type/create-category-options';\nimport type GetCategoryOptions from './type/get-category-options';\nimport type UpdateCategoryOptions from './type/update-category-options';\nimport type UpdateCategoryAccessOptions from \"./type/update-category-access-options\";\nimport type RemoveCategoryOptions from './type/remove-category-options';\nimport type CreateRobotOptions from './type/create-robot-options';\nimport type RemoveRobotOptions from './type/remove-robot-options';\nimport type RemoveStageOptions from './type/remove-stage-options';\nimport type UpdateStageOptions from './type/update-stage-options';\nimport type AddStageOptions from './type/add-stage-options';\nimport type CopyCategoryAccessOptions from \"./type/copy-category-access-options\";\n\nexport default class Backend\n{\n\tstatic component: string = 'bitrix:crm.sales.tunnels';\n\tstatic entityTypeId: number = 2;\n\n\tstatic request({action, data, analyticsLabel}: RequestOptions): Promise<RequestResponse>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runComponentAction(\n\t\t\t\t\tBackend.component,\n\t\t\t\t\taction,\n\t\t\t\t\t{\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\tentityTypeId: Backend.entityTypeId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tanalyticsLabel,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n\n\tstatic createCategory(data: CreateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.new.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategory(data: GetCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateCategory(data: UpdateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeCategory(data: RemoveCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic accessCategory(data: UpdateCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'accessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic copyAccessCategory(data: CopyCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'copyAccessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic createRobot(data: CreateRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeRobot(data: RemoveRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getRobotSettingsDialog(data: {[key: string]: any})\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getRobotSettingsDialog',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'settings.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic addStage(data: AddStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'addStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'add.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeStage(data: RemoveStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStage(data: UpdateStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStages(data: Array<UpdateStageOptions>)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStages',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stages',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategories()\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategories',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.categories',\n\t\t\t},\n\t\t});\n\t}\n}\n","import {Dom} from 'main.core';\nimport {Category} from './category';\n\nexport default class CategoryStub extends Category\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-stub');\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\n\t\tthis.getAllColumns()\n\t\t\t.forEach((column) => {\n\t\t\t\tcolumn.marker.disable();\n\t\t\t});\n\t}\n}","export default function createStageStubs(count: 0)\n{\n\treturn Array.from({length: count}).map((item, index) => {\n\t\treturn {\n\t\t\tSTATUS_ID: `stub_${index}`,\n\t\t\tCOLOR: 'F1F5F7',\n\t\t\tNAME: 'category stub',\n\t\t};\n\t});\n}","import {Type, Loc, Text} from 'main.core';\n\nexport default function makeErrorMessageFromResponse(response)\n{\n\tif (response.data && response.data.errors && Type.isArray(response.data.errors) && response.data.errors.length > 0)\n\t{\n\t\treturn response.data.errors.reduce((acc, errorText) => {\n\t\t\treturn `${acc}${Text.encode(errorText)}<br>`;\n\t\t}, '');\n\t}\n\tif(response.errors && Type.isArray(response.errors) && response.errors.length > 0)\n\t{\n\t\treturn response.errors.reduce((result, error) => {\n\t\t\treturn `${result}${Text.encode(error.message ? error.message : error)}<br>`;\n\t\t}, '');\n\t}\n\n\treturn Loc.getMessage('CRM_ST_SAVE_ERROR');\n}\n","import { Reflection, Event, Loc, Cache, Type, Dom } from 'main.core';\nimport {PopupWindow, PopupWindowButtonLink} from 'main.popup';\nimport {UI} from 'ui.notification';\nimport {Category} from '../category/category';\nimport Backend from '../backend';\nimport type CategorySourceOptions from '../type/category-source-options';\nimport type TunnelScheme from '../type/tunnel-scheme';\nimport type Link from '../type/link';\nimport CategoryStub from '../category/category-stub';\nimport createStageStubs from './internal/create-stage-stubs';\nimport type Stage, {Tunnel} from '../type/stage';\nimport makeErrorMessageFromResponse from './internal/make-error-message';\nimport Marker from '../marker/marker';\n\nexport default class Manager\n{\n\tcategories: Map<number, Category>;\n\n\tconstructor(options: {\n\t\tentityTypeId: number,\n\t\tdocumentType: Array<string>,\n\t\tcontainer: HTMLDivElement,\n\t\taddCategoryButtonTop: HTMLButtonElement,\n\t\thelpButton: HTMLButtonElement,\n\t\tcategories: Array<{[key: string]: number}>,\n\t\ttunnelScheme: TunnelScheme,\n\t\trobotsUrl: string,\n\t\tgeneratorUrl: string,\n\t\tpermissionEditUrl: string,\n\t\tcanEditTunnels: boolean,\n\t\tcanAddCategory: boolean,\n\t\tcategoriesQuantityLimit: number,\n\t\trestrictionPopupCode: string,\n\t\tisAvailableGenerator: boolean,\n\t\tshowGeneratorRestrictionPopup: () => void,\n\t\tisAvailableRobots: boolean,\n\t\tshowRobotsRestrictionPopup: () => void,\n\t\tisSenderSupported: boolean,\n\t\tisAutomationEnabled: boolean,\n\t\tisStagesEnabled: boolean,\n\t\tisChanged: boolean;\n\t})\n\t{\n\t\tthis.container = options.container;\n\t\tthis.entityTypeId = options.entityTypeId;\n\t\tthis.documentType = options.documentType;\n\t\tthis.addCategoryButtonTop = options.addCategoryButtonTop;\n\t\tthis.helpButton = options.helpButton;\n\t\tthis.categoriesOptions = options.categories;\n\t\tthis.robotsUrl = options.robotsUrl;\n\t\tthis.generatorUrl = options.generatorUrl;\n\t\tthis.permissionEditUrl = options.permissionEditUrl;\n\t\tthis.tunnelScheme = options.tunnelScheme;\n\t\tthis.canEditTunnels = Boolean(options.canEditTunnels);\n\t\tthis.canAddCategory = Boolean(options.canAddCategory);\n\t\tthis.categoriesQuantityLimit = Number(options.categoriesQuantityLimit);\n\t\tthis.restrictionPopupCode = options.restrictionPopupCode;\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.showGeneratorRestrictionPopup = options.showGeneratorRestrictionPopup;\n\t\tthis.isAvailableRobots = options.isAvailableRobots;\n\t\tthis.showRobotsRestrictionPopup = options.showRobotsRestrictionPopup;\n\t\tthis.isSenderSupported = options.isSenderSupported;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled && this.isStagesEnabled;\n\t\tthis.categories = new Map();\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.isChanged = false;\n\n\t\tthis.initCategories();\n\t\tthis.initTunnels();\n\n\t\tBackend.entityTypeId = this.entityTypeId;\n\n\t\tsetTimeout(() => {\n\t\t\tif (!this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showCategoryStub();\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(this.getAddCategoryButton(), 'click', this.onAddCategoryClick.bind(this));\n\t\tEvent.bind(this.addCategoryButtonTop, 'click', this.onAddCategoryTopClick.bind(this));\n\t\tEvent.bind(this.helpButton, 'click', this.onHelpButtonClick.bind(this));\n\n\t\tconst toolbarComponent = Reflection.getClass('top.BX.Crm.ToolbarComponent')\n\t\t\t? Reflection.getClass('top.BX.Crm.ToolbarComponent').Instance\n\t\t\t: null;\n\t\tconst slider = this.getSlider();\n\t\tif (slider && toolbarComponent)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe('SidePanel.Slider:onClose', () => {\n\t\t\t\tif (this.isChanged)\n\t\t\t\t{\n\t\t\t\t\ttoolbarComponent.emitCategoriesUpdatedEvent();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\treturn this.getTunnels().length > 0;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.querySelector('.crm-st');\n\t\t});\n\t}\n\n\tgetAppContainer()\n\t{\n\t\treturn this.cache.remember('appContainer', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-container');\n\t\t});\n\t}\n\n\tgetCategoriesContainer()\n\t{\n\t\treturn this.cache.remember('categoriesContainer', () => {\n\t\t\treturn this.getAppContainer().querySelector('.crm-st-categories');\n\t\t});\n\t}\n\n\tgetAddCategoryButton()\n\t{\n\t\treturn this.cache.remember('addCategoryButton', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-add-category-btn');\n\t\t});\n\t}\n\n\tgetMaxSort()\n\t{\n\t\treturn [...this.categories.values()].reduce((acc, curr) => {\n\t\t\treturn acc > curr.sort ? acc : curr.sort;\n\t\t}, 0);\n\t}\n\n\tonAddCategoryClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (\n\t\t\tthis.canAddCategory\n\t\t\t|| this.categoriesQuantityLimit <= 0\n\t\t\t|| this.categoriesQuantityLimit > this.categories.size\n\t\t)\n\t\t{\n\t\t\treturn Backend\n\t\t\t\t.createCategory({\n\t\t\t\t\tname: Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER'),\n\t\t\t\t\tsort: this.getMaxSort() + 10\n\t\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.addCategoryFromOptions(response.data);\n\n\t\t\t\t\tconst allStages = this.getStages();\n\t\t\t\t\tconst newStages = [\n\t\t\t\t\t\t...response.data.STAGES.P,\n\t\t\t\t\t\t...response.data.STAGES.S,\n\t\t\t\t\t\t...response.data.STAGES.F,\n\t\t\t\t\t];\n\n\t\t\t\t\tnewStages.forEach(item => allStages.push(item));\n\n\t\t\t\t\tconst category = this.getCategory(response.data.ID);\n\n\t\t\t\t\tcategory.enableTitleEdit('');\n\t\t\t\t\tcategory.getAllColumns()\n\t\t\t\t\t\t.forEach((column) => {\n\t\t\t\t\t\t\tthis.tunnelScheme.stages.push({\n\t\t\t\t\t\t\t\tcategoryId: column.getData().category.id,\n\t\t\t\t\t\t\t\tstageId: column.getId(),\n\t\t\t\t\t\t\t\tlocked: false,\n\t\t\t\t\t\t\t\ttunnels: [],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\teval(this.restrictionPopupCode);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t}\n\n\tonAddCategoryTopClick(event)\n\t{\n\t\tthis.onAddCategoryClick(event)\n\t\t\t.then((success) => {\n\t\t\t\tif (success)\n\t\t\t\t{\n\t\t\t\t\twindow.scrollTo(0, document.body.scrollHeight);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonHelpButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=9474707');\n\t\t}\n\t}\n\n\tgetCategoryStub(): CategoryStub\n\t{\n\t\treturn this.cache.remember('categoryStub', () => {\n\t\t\treturn new CategoryStub({\n\t\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\t\tappContainer: this.getAppContainer(),\n\t\t\t\tid: 'stub',\n\t\t\t\tname: 'stub',\n\t\t\t\t'default': false,\n\t\t\t\tstages: {\n\t\t\t\t\tP: createStageStubs(5),\n\t\t\t\t\tS: createStageStubs(1),\n\t\t\t\t\tF: createStageStubs(2),\n\t\t\t\t},\n\t\t\t\tsort: 0,\n\t\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\t\tlazy: true,\n\t\t\t\tisAvailableGenerator: true,\n\t\t\t\tshowGeneratorRestrictionPopup: () => {},\n\t\t\t\tisAvailableRobots: true,\n\t\t\t\tshowRobotsRestrictionPopup: () => {},\n\t\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = true;\n\t\tconst categoryStub = this.getCategoryStub();\n\t\tcategoryStub.draw();\n\n\t\tconst firstCategory = [...this.categories.values()][0];\n\n\t\tconst [columnFrom] = firstCategory.getSuccessKanban().getColumns();\n\t\tconst [columnTo] = categoryStub.getProgressKanban().getColumns();\n\n\t\tif (this.isAutomationEnabled)\n\t\t{\n\t\t\tcolumnFrom.marker.addStubLinkTo(columnTo.marker, true);\n\t\t}\n\t}\n\n\thideCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = false;\n\t\tthis.getCategoryStub()\n\t\t\t.remove();\n\t\tthis.cache.delete('categoryStub');\n\t}\n\n\tisShownCategoryStub(): boolean\n\t{\n\t\treturn this.shownCategoryStub;\n\t}\n\n\tadjustCategoryStub()\n\t{\n\t\tif (!this.hasTunnels())\n\t\t{\n\t\t\tthis.showCategoryStub();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideCategoryStub();\n\t}\n\n\taddCategoryFromOptions(options: CategorySourceOptions)\n\t{\n\t\tlet stages = options.STAGES;\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tstages = {\n\t\t\t\tP: createStageStubs(5),\n\t\t\t\tS: createStageStubs(1),\n\t\t\t\tF: createStageStubs(2),\n\t\t\t};\n\t\t}\n\t\tconst category = new Category({\n\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\tappContainer: this.getAppContainer(),\n\t\t\tid: options.ID,\n\t\t\tname: options.NAME,\n\t\t\t'default': (options.IS_DEFAULT === 'Y'),\n\t\t\tstages: stages,\n\t\t\tsort: options.SORT,\n\t\t\taccess: options.ACCESS,\n\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\tgeneratorsCount: options.RC_COUNT,\n\t\t\tgeneratorsListUrl: options.RC_LIST_URL,\n\t\t\tcanEditTunnels: this.canEditTunnels,\n\t\t\tisAvailableGenerator: this.isAvailableGenerator,\n\t\t\tshowGeneratorRestrictionPopup: this.showGeneratorRestrictionPopup,\n\t\t\tisAvailableRobots: this.isAvailableRobots,\n\t\t\tshowRobotsRestrictionPopup: this.showRobotsRestrictionPopup,\n\t\t\tisAutomationEnabled: this.isAutomationEnabled,\n\t\t\tisSenderSupported: this.isSenderSupported,\n\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t});\n\n\t\tcategory\n\t\t\t.subscribe('Category:title:save', (event) => {\n\t\t\t\tconst {categoryId, value} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tNAME: value,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access', (event) => {\n\t\t\t\tconst {categoryId, access} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.accessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\taccess : access,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access:copy', (event) => {\n\t\t\t\tconst {categoryId, donorCategoryId} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.copyAccessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tdonorId : donorCategoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:remove', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.removeCategory({\n\t\t\t\t\t\tid: event.data.categoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tevent.data.onConfirm();\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t\t\t\tthis.showCategoryStub();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:link', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: event.data.link.from.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.from.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: event.data.link.to.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.to.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\t\t\t\t\tconst robotAction = event.data.link.robotAction;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.createRobot({from, to, robotAction})\n\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst stage = this.getStages().find((item) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tString(item.CATEGORY_ID) === String(response.data.tunnel.srcCategory)\n\t\t\t\t\t\t\t\t\t&& String(item.STATUS_ID) === String(response.data.tunnel.srcStage)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tstage.TUNNELS.push(response.data.tunnel);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tconst link = event.data.link;\n\t\t\t\t\t\t\tlink.from.removeLink(link, true);\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.hideCategoryStub();\n\t\t\t})\n\t\t\t.subscribe('Column:removeLinkFrom', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t\tif (tunnel)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst requestOptions = {\n\t\t\t\t\t\t\tsrcCategory,\n\t\t\t\t\t\t\tsrcStage,\n\t\t\t\t\t\t\tdstCategory,\n\t\t\t\t\t\t\tdstStage,\n\t\t\t\t\t\t\trobot: tunnel.robot,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.removeRobot(requestOptions)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\tstage.TUNNELS = stage.TUNNELS.filter((item) => {\n\t\t\t\t\t\t\treturn !(\n\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:changeRobotAction', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled || event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\tif (tunnel)\n\t\t\t\t{\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: srcCategory,\n\t\t\t\t\t\tstage: srcStage,\n\t\t\t\t\t};\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: dstCategory,\n\t\t\t\t\t\tstage: dstStage,\n\t\t\t\t\t};\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeRobot(tunnel)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t\t.createRobot({from, to, robotAction: event.data.link.robotAction})\n\t\t\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\t\t\t\tconst index = stage.TUNNELS.findIndex((item) => {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tstage.TUNNELS[index] = response.data.tunnel;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tevent.data.onChangeRobotEnd();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:editLink', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Bizproc.Automation.API.showRobotSettings(\n\t\t\t\t\ttunnel.robot,\n\t\t\t\t\tthis.documentType,\n\t\t\t\t\ttunnel.srcStage,\n\t\t\t\t\t(robot) => {\n\t\t\t\t\t\ttunnel.robot = robot.serialize();\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.request({\n\t\t\t\t\t\t\t\taction: 'updateRobot',\n\t\t\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\t\t\tcomponent: Backend.component,\n\t\t\t\t\t\t\t\t\taction: 'update.robot',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata: tunnel\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\ttunnel.dstCategory = robot.getProperty('CategoryId');\n\t\t\t\t\t\t\t\ttunnel.dstStage = robot.getProperty('StageId');\n\n\t\t\t\t\t\t\t\tconst category = this.getCategory(tunnel.dstCategory);\n\t\t\t\t\t\t\t\tconst column = category.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\t\t\tevent.data.link.from.updateLink(event.data.link, column.marker, true);\n\n\t\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t})\n\t\t\t.subscribe('Category:sort', () => {\n\t\t\t\tconst results = Category.instances\n\t\t\t\t\t.filter(category => category.id !== 'stub')\n\t\t\t\t\t.map((category, index) => {\n\t\t\t\t\t\treturn Backend\n\t\t\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\t\t\tid: category.id,\n\t\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\t\tSORT: (index+1) * 100,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tPromise.all(results)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:remove', (event) => {\n\t\t\t\tif (!Type.isNil(event.data.column.data.stageId))\n\t\t\t\t{\n\t\t\t\t\tconst hasTunnels = this.isAutomationEnabled ? [...Marker.getAllLinks()].some((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tevent.data.column.marker === item.from\n\t\t\t\t\t\t\t|| event.data.column.marker === item.to\n\t\t\t\t\t\t);\n\t\t\t\t\t}) : false;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeStage({\n\t\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tevent.data.onConfirm();\n\n\t\t\t\t\t\t\tif (!hasTunnels)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:change', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.updateStage({\n\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\tname: event.data.column.getName(),\n\t\t\t\t\t\tsort: event.data.column.data.stage.SORT,\n\t\t\t\t\t\tcolor: event.data.column.getColor(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:addColumn', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.addStage({\n\t\t\t\t\t\tname: event.data.column.getGrid().getMessage('COLUMN_TITLE_PLACEHOLDER'),\n\t\t\t\t\t\tsort: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn Number(column.data.stage.SORT) + 1;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tentityId: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.ENTITY_ID;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcolor: BX.Kanban.Column.DEFAULT_COLOR,\n\t\t\t\t\t\tsemantics: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.SEMANTICS;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcategoryId: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.category.id;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\n\t\t\t\t\t\tconst {stage} = data;\n\t\t\t\t\t\tconst prevColumn = event.data.column;\n\t\t\t\t\t\tconst grid = prevColumn.getGrid();\n\t\t\t\t\t\tconst category = this.getCategory(prevColumn.data.category.id);\n\n\t\t\t\t\t\tstage.TUNNELS = [];\n\n\t\t\t\t\t\tthis.getStages().push(stage);\n\n\t\t\t\t\t\tconst targetId = grid.getNextColumnSibling(prevColumn);\n\t\t\t\t\t\t// column.getGrid().removeColumn(column);\n\t\t\t\t\t\tconst column = grid.addColumn({\n\t\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\t\tdata: category.getColumnData(stage),\n\t\t\t\t\t\t\ttargetId,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcolumn.switchToEditMode();\n\t\t\t\t\t\tMarker.adjustLinks();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:sort', (event) => {\n\t\t\t\tconst sortData = event.data.columns.map((column, index) => {\n\t\t\t\t\tconst newSorting = (index + 1) * 100;\n\t\t\t\t\tconst columnData = {\n\t\t\t\t\t\tstatusId: column.getId(),\n\t\t\t\t\t\tstageId: column.data.stageId,\n\t\t\t\t\t\tentityId: column.data.entityId,\n\t\t\t\t\t\tname: column.getName(),\n\t\t\t\t\t\tsort: newSorting,\n\t\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t\t};\n\n\t\t\t\t\tcolumn.data.stage.SORT = newSorting;\n\n\t\t\t\t\treturn columnData;\n\t\t\t\t});\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateStages(sortData)\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tconst success = data.every((item) => {\n\t\t\t\t\t\t\treturn item.success;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:slider:close', () => {\n\t\t\t\tthis.reload();\n\t\t\t})\n\t\t\t.subscribe('Column:error', (event) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\terrors: [event.data.message],\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t});\n\n\t\tthis.categories.set(String(options.ID), category);\n\t}\n\n\tshowErrorPopup(message)\n\t{\n\t\tif (!this.errorPopup)\n\t\t{\n\t\t\tthis.errorPopup = new PopupWindow({\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_ERROR_POPUP_TITLE'),\n\t\t\t\twidth: 350,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\tid: 'close',\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ERROR_POPUP_CLOSE_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tthis.errorPopup.setContent(message);\n\t\tthis.errorPopup.show();\n\t}\n\n\tgetSlider()\n\t{\n\t\t// eslint-disable-next-line\n\t\treturn BX.SidePanel.Instance.getSlider(\n\t\t\twindow.location.pathname\n\t\t);\n\t}\n\n\treload()\n\t{\n\t\tconst slider = this.getSlider();\n\n\t\tif (slider)\n\t\t{\n\t\t\tslider.reload();\n\t\t}\n\t}\n\n\tgetStageDataById(id: string): Stage\n\t{\n\t\treturn this.getStages().find(stage => String(stage.STATUS_ID) === String(id));\n\t}\n\n\tgetTunnelByLink(link: Link)\n\t{\n\t\tconst columnFrom = link.from.getData().column;\n\t\tconst columnTo = link.to.getData().column;\n\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\tconst srcStage = columnFrom.getId();\n\t\tconst dstCategory = columnTo.getData().category.id;\n\t\tconst dstStage = columnTo.getId();\n\n\t\tconst stageFrom = this.getStageDataById(srcStage);\n\n\t\tif (stageFrom)\n\t\t{\n\t\t\treturn stageFrom.TUNNELS.find((item) => {\n\t\t\t\treturn (\n\t\t\t\t\tString(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t&& String(item.srcStage) === String(srcStage)\n\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCategory(id: number | string): Category\n\t{\n\t\treturn this.categories.get(String(id));\n\t}\n\n\tgetStages(): Array<Stage>\n\t{\n\t\treturn this.cache.remember('allStages', () => {\n\t\t\treturn this.categoriesOptions.reduce((acc, category) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...category.STAGES.P,\n\t\t\t\t\t...category.STAGES.S,\n\t\t\t\t\t...category.STAGES.F,\n\t\t\t\t];\n\t\t\t}, []);\n\t\t});\n\t}\n\n\tgetTunnels(): Array<Tunnel>\n\t{\n\t\treturn this.getStages().reduce((acc, stage) => {\n\t\t\treturn [...acc, ...(stage.TUNNELS || [])];\n\t\t}, []);\n\t}\n\n\tinitCategories()\n\t{\n\t\tthis.categoriesOptions.map((categoryOptions) => {\n\t\t\tthis.addCategoryFromOptions(categoryOptions);\n\t\t});\n\t}\n\n\tinitTunnels()\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getStages()\n\t\t\t.filter((stage) => {\n\t\t\t\treturn Type.isArray(stage.TUNNELS) && stage.TUNNELS.length;\n\t\t\t})\n\t\t\t.forEach((stage) => {\n\t\t\t\tstage.TUNNELS.forEach((tunnel) => {\n\t\t\t\t\tconst categoryFrom = this.getCategory(tunnel.srcCategory);\n\t\t\t\t\tconst categoryTo = this.getCategory(tunnel.dstCategory);\n\n\t\t\t\t\tif (categoryFrom && categoryTo)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst columnFrom = categoryFrom.getKanbanColumn(tunnel.srcStage);\n\t\t\t\t\t\tconst columnTo = categoryTo.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\tif (columnFrom && columnTo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst preventEvent = true;\n\t\t\t\t\t\t\tcolumnFrom.marker.addLinkTo(columnTo.marker, tunnel.robotAction, preventEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n}\n","import Column from './kanban/column';\nimport Grid from './kanban/grid';\nimport Manager from './manager/manager';\n\nexport const Kanban = {\n\tColumn,\n\tGrid,\n};\n\nexport {\n\tManager,\n};"],"names":["createStub","Tag","render","isLine","value","Type","isArray","length","every","isNumber","isOverlap","line1","line2","Error","a1","Math","min","a2","max","b1","b2","isValidRect","rect","left","top","width","height","makeRelativeRect","rect1","rect2","right","bottom","isRect","getMiddlePoint","middleX","middleY","Marker","point","instances","find","marker","isReceiverIntersecting","exclude","forEach","onReceiverDragOut","reduce","acc","links","subAcc","link","add","Set","stubLinks","targets","getAllLinks","includes","item","from","Dom","addClass","dispatcher","receiver","getTunnelButton","to","node","arrow","select","parentNode","appendChild","arrowMarker","defs","closest","insertAfter","firstChild","removeClass","preventSave","removeAllLinks","removeAllStubLinks","delete","addLinkTo","robotAction","index","path","getLinkPath","style","d3","showTunnelButton","attr","clearTimeout","adjustLinksTimeoutIds","setTimeout","options","Cache","MemoryCache","container","intermediateXPoints","name","data","linksRoot","getLinksRoot","append","onDispatcherMouseDown","bind","onMarkerRootMouseUp","onMarkerRootMouseMove","on","push","disabled","cache","remember","markerRoot","getMarkerRoot","getBoundingClientRect","getMarkerLine","remove","relativeRect","getMarkerRootRect","x","y","hovered","emit","getDispatcherRect","getMarkerRootMousePosition","destinationMarker","getDestinationMarker","isEnabled","onReceiverDragOver","emitReceiverDragOutForAll","removeMarkerLine","event","Event","BaseEvent","isDefaultPrevented","column","canEditTunnels","message","Loc","getMessage","PopupMenuWindow","bindElement","items","getTunnelMenuItems","events","onPopupClose","deactivateTunnelButton","onPopupShow","activateTunnelButton","self","onRobotActionChange","isNil","changeRobotAction","getParentMenuWindow","close","getMenuItems","setText","toUpperCase","text","onclick","call","editLink","removeLink","parentMenu","removeMenuItem","getParentMenuItem","id","action","onChangeRobotEnd","destination","some","line","fromId","getId","replace","toId","arrowId","selectCallback","linkNode","menu","getTunnelsListMenu","addMenuItem","Text","encode","onMouseEnter","highlightLink","onMouseLeave","unhighlightLinks","size","setTunnelsCounterValue","showTunnelStubButton","newTo","oldTo","isLinked","hidden","isLinkedFrom","getTunnelMenu","destroy","visibleLinks","filter","getPopupWindow","isShown","show","isLinkedStub","getStubTunnelButton","removeStubLink","button","category","getCategory","contains","Runtime","clone","canEdit","onTunnelButtonMouseEnter","onTunnelButtonMouseLeave","onTunnelButtonClick","isTunnelButtonActive","closeByEsc","menuShowDelay","hasClass","tunnelButton","tunnelsCounter","getTunnelsCounter","innerText","markerRootRect","map","isFunction","getIntermediateXPoints","prev","curr","abs","target","targetPosition","getPointRect","currentPosition","baseOffset","markerMargin","intermediateX","getNearestIntermediateXPoint","lineOffset","currentPath","mousePosition","getMarkerFromPoint","receiverRect","getReceiverRect","heightOffset","blurLinks","EventEmitter","isLinkInSameCategory","columnFrom","columnTo","dataFrom","getData","dataTo","String","isCycleLink","Column","currentName","getName","getDot","getHeader","appContainer","categoryName","subscribe","onMarkerDragStart","onMarkerDragOver","onMarkerDragOut","onMarkerDragEnd","onMarkerLinkFrom","onMarkerStubLinkFrom","onMarkerLinkTo","onMarkerStubLinkTo","onRemoveLinkFrom","onChangeRobotAction","onEditLink","onMarkerUnlink","onMarkerUnlinkStub","onMarkerError","onTransitionStart","onTransitionEnd","propertyName","srcElement","getContainer","isAllowedTransitionProperty","clearInterval","intervalId","setInterval","adjustLinks","onLink","onLinkHandler","onRemoveLinkFromHandler","onEditLinkhandler","onNameChange","onNameChangeHandler","onColorChange","onColorChangeHandler","onAddColumn","onAddColumnHandler","onRemove","onRemoveHandler","onChange","onChangeHandler","onError","onErrorHandler","clear","activateDot","activateStubDot","stagesGroups","progressStagesGroup","successStagesGroup","failStagesGroup","progressRect","successRect","failRect","offset","preventDefault","disallowDot","allowDot","highlightDot","unhighlightDot","deactivateDot","deactivateStubDot","isDomNode","dot","title","header","headerDotted","stopPropagation","attrs","layout","total","color","getConfirmDialog","setContent","onConfirm","restoreAllLinks","onCancel","BX","util","trim","getTitleTextBox","colorChanged","titleChanged","resetRectAreaTimeoutId","Kanban","Grid","area","emitter","getColumns","columnsOrder","sort","a","b","aIndex","children","indexOf","bIndex","Category","renderTo","canEditColumn","editable","canRemoveColumn","canAddColumn","canSortColumn","columnType","dropzoneType","columns","access","Number","parseInt","default","Boolean","generatorsCount","generatorsListUrl","stages","robotsSettingsLink","generatorSettingsLink","permissionEditLink","drawed","allowWrite","isAvailableGenerator","showGeneratorRestrictionPopup","isAvailableRobots","showRobotsRestrictionPopup","isSenderSupported","isAutomationEnabled","isStagesEnabled","lazy","draw","showGeneratorLinkIcon","dragButton","getDragButton","onbxdragstart","onDragStart","onbxdrag","onDrag","onbxdragstop","onDragStop","jsDD","registerObject","adjustRobotsLinkIcon","getProgressKanban","getAllColumns","getSuccessKanban","getFailKanban","disable","rectArea","pos","middle","querySelectorAll","findIndex","getIndex","dragOffset","start_y","getRectArea","dragIndex","dragTargetCategory","categoryHeight","curIndex","categoryContainer","categoryRectArea","categoryMiddle","transform","getNextCategorySibling","moveBackTop","moveBackBottom","requestAnimationFrame","insertBefore","parentElement","before","after","JSON","stringify","getTitleContainer","getRobotsLink","getRobotsHelpLink","getGeneratorLink","getGeneratorHelpLink","getProgressContainer","getSuccessContainer","getFailContainer","onClick","window","Helper","getProgressStagesContainer","createGrid","P","stage","STATUS_ID","NAME","COLOR","getColumnData","getSuccessStagesContainer","S","canRemove","canSort","getFailStagesContainer","F","stageId","ID","entityId","ENTITY_ID","onSort","currentStageGroup","getTitle","SidePanel","Instance","open","cacheable","onClose","onRobotsLinkClick","onGeneratorLinkClick","onEditButtonClick","getEditButton","isTitleEditEnabled","disableTitleEdit","saveTitle","enableTitleEdit","titleEditor","getTitleEditor","isString","decode","focus","setSelectionRange","titleLength","newTitle","categoryId","hideTitle","showTitleEditor","activateEditButton","focusOnTitleEditor","showTitle","hideTitleEditor","deactivateEditButton","onOptionButtonClick","onMenuItemClick","dataset","menuWindow","itemOther","onSubMenuItemClick","donorCategoryId","Menu","getRandom","toLowerCase","getOptionButton","delimiter","className","href","getMenuWindow","preItem","getActionsButtons","removeBlur","angle","offsetLeft","addBlur","onRemoveButtonClick","showConfirmRemovePopup","then","confirm","progressColumns","successColumn","failColumns","unblurLinks","categoryFrom","categoryTo","getAllStubLinks","safeTitle","onKeyDown","onTitleEditorKeyDown","onBlur","onTitleEditorBlur","key","startsWith","getRemoveButton","isDrawed","columnId","statusId","Promise","resolve","PopupWindow","overlay","opacity","titleBar","content","buttons","PopupWindowButton","click","popupWindow","PopupWindowButtonLink","getRobotsLinkIcon","hasTunnels","showRobotsLinkIcon","hideRobotsLinkIcon","getGeneratorLinkIcon","Backend","analyticsLabel","reject","ajax","runComponentAction","component","mode","entityTypeId","request","CategoryStub","createStageStubs","count","Array","makeErrorMessageFromResponse","response","errors","errorText","result","error","Manager","documentType","addCategoryButtonTop","helpButton","categoriesOptions","categories","robotsUrl","generatorUrl","permissionEditUrl","tunnelScheme","canAddCategory","categoriesQuantityLimit","restrictionPopupCode","Map","isChanged","initCategories","initTunnels","showCategoryStub","getAddCategoryButton","onAddCategoryClick","onAddCategoryTopClick","onHelpButtonClick","toolbarComponent","Reflection","getClass","slider","getSlider","emitCategoriesUpdatedEvent","getTunnels","document","querySelector","getAppContainer","values","createCategory","getMaxSort","addCategoryFromOptions","allStages","getStages","newStages","STAGES","locked","tunnels","isShownCategoryStub","hideCategoryStub","catch","showErrorPopup","eval","e","console","success","scrollTo","body","scrollHeight","getCategoriesContainer","shownCategoryStub","categoryStub","getCategoryStub","firstCategory","addStubLinkTo","IS_DEFAULT","SORT","ACCESS","RC_COUNT","RC_LIST_URL","updateCategory","fields","UI","Notification","Center","notify","autoHideDelay","accessCategory","copyAccessCategory","donorId","removeCategory","adjustCategoryStub","createRobot","CATEGORY_ID","tunnel","srcCategory","srcStage","TUNNELS","dstCategory","dstStage","getTunnelByLink","requestOptions","robot","removeRobot","getStageDataById","Bizproc","Automation","API","showRobotSettings","serialize","getProperty","getKanbanColumn","updateLink","results","all","removeStage","updateStage","getColor","addStage","getGrid","DEFAULT_COLOR","semantics","SEMANTICS","prevColumn","grid","targetId","getNextColumnSibling","addColumn","switchToEditMode","sortData","newSorting","columnData","updateStages","reload","set","errorPopup","closeIcon","location","pathname","stageFrom","get","categoryOptions","preventEvent"],"mappings":";;;;;;CAEe,SAASA,UAAT,GACf;CACC,SAAOC,aAAG,CAACC,MAAX;CACA;;CCHc,SAASC,MAAT,CAAgBC,KAAhB,EACf;CACC,SACCC,cAAI,CAACC,OAAL,CAAaF,KAAb,KACGA,KAAK,CAACG,MAAN,KAAiB,CADpB,IAEGH,KAAK,CAACI,KAAN,CAAYH,cAAI,CAACI,QAAjB,CAHJ;CAKA;;CCPc,SAASC,SAAT,CAAmBC,KAAnB,EAA0BC,KAA1B,EACf;CACC,MAAI,CAACT,MAAM,CAACQ,KAAD,CAAP,IAAkB,CAACR,MAAM,CAACS,KAAD,CAA7B,EACA;CACC,UAAM,IAAIC,KAAJ,CAAU,6CAAV,CAAN;CACA;;CAED,MAAMC,EAAE,GAAGC,IAAI,CAACC,GAAL,OAAAD,IAAI,iCAAQJ,KAAR,EAAf;CACA,MAAMM,EAAE,GAAGF,IAAI,CAACG,GAAL,OAAAH,IAAI,iCAAQJ,KAAR,EAAf;CAEA,MAAMQ,EAAE,GAAGJ,IAAI,CAACC,GAAL,OAAAD,IAAI,iCAAQH,KAAR,EAAf;CACA,MAAMQ,EAAE,GAAGL,IAAI,CAACG,GAAL,OAAAH,IAAI,iCAAQH,KAAR,EAAf;CAEA,SAAOE,EAAE,IAAIK,EAAN,IAAYL,EAAE,IAAIM,EAAlB,IACHH,EAAE,IAAIE,EAAN,IAAYF,EAAE,IAAIG,EADf,IAEHD,EAAE,IAAIL,EAAN,IAAYK,EAAE,IAAIF,EAFf,IAGHG,EAAE,IAAIN,EAAN,IAAYM,EAAE,IAAIH,EAHtB;CAIA;;CCjBD,IAAMI,WAAW,GAAG,SAAdA,WAAc,CAAAC,IAAI;CAAA,SACvBjB,cAAI,CAACI,QAAL,CAAca,IAAI,CAACC,IAAnB,KACGlB,cAAI,CAACI,QAAL,CAAca,IAAI,CAACE,GAAnB,CADH,IAEGnB,cAAI,CAACI,QAAL,CAAca,IAAI,CAACG,KAAnB,CAFH,IAGGpB,cAAI,CAACI,QAAL,CAAca,IAAI,CAACI,MAAnB,CAJoB;CAAA,CAAxB;;AAOA,CAAe,SAASC,gBAAT,CAA0BC,KAA1B,EAA0CC,KAA1C,EACf;CACC,MAAI,CAACR,WAAW,CAACO,KAAD,CAAZ,IAAuB,CAACP,WAAW,CAACQ,KAAD,CAAvC,EACA;CACC,UAAM,IAAIhB,KAAJ,CAAU,qFAAV,CAAN;CACA;;CAED,SAAO;CACNU,IAAAA,IAAI,EAAEM,KAAK,CAACN,IAAN,GAAaK,KAAK,CAACL,IADnB;CAENC,IAAAA,GAAG,EAAEK,KAAK,CAACL,GAAN,GAAYI,KAAK,CAACJ,GAFjB;CAGNM,IAAAA,KAAK,EAAGD,KAAK,CAACN,IAAN,GAAaK,KAAK,CAACL,IAApB,GAA4BM,KAAK,CAACJ,KAHnC;CAINM,IAAAA,MAAM,EAAGF,KAAK,CAACL,GAAN,GAAYI,KAAK,CAACJ,GAAnB,GAA0BK,KAAK,CAACH,MAJlC;CAKND,IAAAA,KAAK,EAAEI,KAAK,CAACJ,KALP;CAMNC,IAAAA,MAAM,EAAEG,KAAK,CAACH;CANR,GAAP;CAQA;;CCtBc,SAASM,MAAT,CAAgB5B,KAAhB,EACf;CACC,SACCC,cAAI,CAACI,QAAL,CAAcL,KAAK,CAACmB,IAApB,KACGlB,cAAI,CAACI,QAAL,CAAcL,KAAK,CAACoB,GAApB,CADH,IAEGnB,cAAI,CAACI,QAAL,CAAcL,KAAK,CAACqB,KAApB,CAFH,IAGGpB,cAAI,CAACI,QAAL,CAAcL,KAAK,CAACsB,MAApB,CAJJ;CAMA;;CCRc,SAASO,cAAT,CAAwBX,IAAxB,EACf;CACC,MAAI,CAACU,MAAM,CAACV,IAAD,CAAX,EACA;CACC,UAAM,IAAIT,KAAJ,CAAU,qFAAV,CAAN;CACA;;CAED,SAAO;CACNqB,IAAAA,OAAO,EAAEZ,IAAI,CAACC,IAAL,GAAaD,IAAI,CAACG,KAAL,GAAa,CAD7B;CAENU,IAAAA,OAAO,EAAEb,IAAI,CAACE,GAAL,GAAYF,IAAI,CAACI,MAAL,GAAc;CAF7B,GAAP;CAIA;;;;CCLD;CACA;CACA;KACqBU;;;;wCAKMC,OAC1B;CACC,aAAOD,MAAM,CAACE,SAAP,CAAiBC,IAAjB,CAAsB,UAAAC,MAAM;CAAA,eAClCA,MAAM,CAACC,sBAAP,CAA8BJ,KAA9B,CADkC;CAAA,OAA5B,CAAP;CAGA;;;iDAGD;CAAA,UADiCK,OACjC,uEADoD,IACpD;CACCN,MAAAA,MAAM,CAACE,SAAP,CAAiBK,OAAjB,CAAyB,UAACH,MAAD,EAAY;CACpC,YAAIA,MAAM,KAAKE,OAAf,EACA;CACCF,UAAAA,MAAM,CAACI,iBAAP;CACA;CACD,OALD;CAMA;;;mCAGD;CACC,aAAOR,MAAM,CAACE,SAAP,CAAiBO,MAAjB,CAAwB;CAAC;CAASC,MAAAA,GAAV,EAAeN,MAAf;CAAA,eAC9B,+BAAIA,MAAM,CAACO,KAAX,EAAkBF,MAAlB,CAAyB,UAACG,MAAD,EAASC,IAAT;CAAA,iBAAkBD,MAAM,CAACE,GAAP,CAAWD,IAAX,CAAlB;CAAA,SAAzB,EAA6DH,GAA7D,CAD8B;CAAA,OAAxB,EAEJ,IAAIK,GAAJ,EAFI,CAAP;CAGA;;;uCAGD;CACC,aAAOf,MAAM,CAACE,SAAP,CAAiBO,MAAjB,CAAwB;CAAC;CAASC,MAAAA,GAAV,EAAeN,MAAf;CAAA,eAC9B,+BAAIA,MAAM,CAACY,SAAX,EAAsBP,MAAtB,CAA6B,UAACG,MAAD,EAASC,IAAT;CAAA,iBAAkBD,MAAM,CAACE,GAAP,CAAWD,IAAX,CAAlB;CAAA,SAA7B,EAAiEH,GAAjE,CAD8B;CAAA,OAAxB,EAEJ,IAAIK,GAAJ,EAFI,CAAP;CAGA;;;qCAGD;CAAA,wCADwBE,OACxB;CADwBA,QAAAA,OACxB;CAAA;;CACCjB,MAAAA,MAAM,CAACkB,WAAP,GAAqBX,OAArB,CAA6B,UAACM,IAAD,EAAU;CACtC,YAAI,CAACI,OAAO,CAACE,QAAR,CAAiBN,IAAjB,CAAL,EACA;CACC,cAAI,UAAII,OAAJ,EAAa7C,KAAb,CAAmB,UAAAgD,IAAI;CAAA,mBAAIA,IAAI,CAACC,IAAL,KAAcR,IAAI,CAACQ,IAAvB;CAAA,WAAvB,CAAJ,EACA;CACCC,YAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACQ,IAAL,CAAUG,UAAvB,EAAmC,aAAnC;CACAF,YAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACQ,IAAL,CAAUI,QAAvB,EAAiC,aAAjC;CACAH,YAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAb,EAA0C,aAA1C;CACA;;CAEDJ,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACc,EAAL,CAAQH,UAArB,EAAiC,aAAjC;CACAF,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACc,EAAL,CAAQF,QAArB,EAA+B,aAA/B;CACAH,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACe,IAAL,CAAUA,IAAV,EAAb,EAA+B,aAA/B;CACAN,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACgB,KAAL,CAAWC,MAAX,CAAkB,MAAlB,EAA0BF,IAA1B,EAAb,EAA+C,aAA/C;CACA,SAbD,MAeA;CACC,cAAMA,IAAI,GAAGf,IAAI,CAACe,IAAL,CAAUA,IAAV,EAAb;CACAA,UAAAA,IAAI,CAACG,UAAL,CAAgBC,WAAhB,CAA4BJ,IAA5B;CAEA,cAAMK,WAAW,GAAGpB,IAAI,CAACgB,KAAL,CAAWD,IAAX,EAApB;CACA,cAAMM,IAAI,GAAGD,WAAW,CAACE,OAAZ,CAAoB,MAApB,CAAb;CAEAb,UAAAA,aAAG,CAACc,WAAJ,CAAgBH,WAAhB,EAA6BC,IAAI,CAACG,UAAlC;CACA;CACD,OAzBD;CA0BA;;;wCAGD;CACCrC,MAAAA,MAAM,CAACkB,WAAP,GAAqBX,OAArB,CAA6B,UAACM,IAAD,EAAU;CACtCS,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACQ,IAAL,CAAUG,UAA1B,EAAsC,aAAtC;CACAF,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACQ,IAAL,CAAUI,QAA1B,EAAoC,aAApC;CACAH,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAhB,EAA6C,aAA7C;CACAJ,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACc,EAAL,CAAQH,UAAxB,EAAoC,aAApC;CACAF,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACc,EAAL,CAAQF,QAAxB,EAAkC,aAAlC;CACAH,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACe,IAAL,CAAUA,IAAV,EAAhB,EAAkC,aAAlC;CACAN,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACgB,KAAL,CAAWC,MAAX,CAAkB,MAAlB,EAA0BF,IAA1B,EAAhB,EAAkD,aAAlD;CACA,OARD;CASA;;;+BAEgBxB,QACjB;CACCJ,MAAAA,MAAM,CAACkB,WAAP,GAAqBX,OAArB,CAA6B,UAACM,IAAD,EAAU;CACtC,YAAIA,IAAI,CAACQ,IAAL,KAAcjB,MAAd,IAAwBS,IAAI,CAACc,EAAL,KAAYvB,MAAxC,EACA;CACCkB,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACe,IAAL,CAAUA,IAAV,EAAb,EAA+B,kBAA/B;CACAN,UAAAA,aAAG,CAACC,QAAJ,CAAaV,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAb,EAA0C,kBAA1C;CACA;CACD,OAND;CAOA;;;mCAGD;CACC1B,MAAAA,MAAM,CAACkB,WAAP,GAAqBX,OAArB,CAA6B,UAACM,IAAD,EAAU;CACtCS,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACe,IAAL,CAAUA,IAAV,EAAhB,EAAkC,kBAAlC;CACAN,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAhB,EAA6C,kBAA7C;CACAJ,QAAAA,aAAG,CAACgB,WAAJ,CAAgBzB,IAAI,CAACc,EAAL,CAAQD,eAAR,EAAhB,EAA2C,kBAA3C;CACA,OAJD;CAKA;;;sCAGD;CACC1B,MAAAA,MAAM,CAACE,SAAP,CAAiBK,OAAjB,CAAyB,UAACH,MAAD,EAAY;CACpC,YAAMmC,WAAW,GAAG,IAApB;CACAnC,QAAAA,MAAM,CAACoC,cAAP,CAAsBD,WAAtB;CACA,OAHD;CAKAvC,MAAAA,MAAM,CAACE,SAAP,CAAiBK,OAAjB,CAAyB,UAACH,MAAD,EAAY;CACpCA,QAAAA,MAAM,CAACqC,kBAAP;CACA,OAFD;CAGA;;;uCAGD;CACC,UAAMF,WAAW,GAAG,IAApB;CAEAvC,MAAAA,MAAM,CAACkB,WAAP,GAAqBX,OAArB,CAA6B,UAACM,IAAD,EAAU;CACtCA,QAAAA,IAAI,CAACQ,IAAL,CAAUV,KAAV,CAAgB+B,MAAhB,CAAuB7B,IAAvB;CACAA,QAAAA,IAAI,CAACQ,IAAL,CAAUsB,SAAV,CAAoB9B,IAAI,CAACc,EAAzB,EAA6Bd,IAAI,CAAC+B,WAAlC,EAA+CL,WAA/C;CACA,OAHD;CAIA;;;mCAGD;CACCvC,MAAAA,MAAM,CAACkB,WAAP,GACEX,OADF,CACU,UAACM,IAAD,EAAOgC,KAAP,EAAiB;CACzB,YAAMC,IAAI,GAAGjC,IAAI,CAACQ,IAAL,CAAU0B,WAAV,CAAsBlC,IAAI,CAACc,EAA3B,CAAb;CAEAd,QAAAA,IAAI,CAACe,IAAL,CACEoB,KADF,CACQ,YADR,EACsB,MADtB;CAEAC,QAAAA,SAAA,CAAUpC,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAV,EACEsB,KADF,CACQ,YADR,EACsB,MADtB;CAGAnC,QAAAA,IAAI,CAACQ,IAAL,CAAU6B,gBAAV,CAA2BJ,IAA3B;CACAjC,QAAAA,IAAI,CAACe,IAAL,CAAUuB,IAAV,CAAe,GAAf,EAAoBF,OAAA,GAAUH,IAAV,CAApB;CACAjC,QAAAA,IAAI,CAACiC,IAAL,GAAYA,IAAZ;CAEAM,QAAAA,YAAY,CAACpD,MAAM,CAACqD,qBAAP,CAA6BR,KAA7B,CAAD,CAAZ;CACA7C,QAAAA,MAAM,CAACqD,qBAAP,CAA6BR,KAA7B,IAAsCS,UAAU,CAAC,YAAM;CACtDzC,UAAAA,IAAI,CAACe,IAAL,CACEoB,KADF,CACQ,YADR,EACsB,IADtB;CAEAC,UAAAA,SAAA,CAAUpC,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAV,EACEsB,KADF,CACQ,YADR,EACsB,IADtB;CAEA,SAL+C,EAK7C,IAL6C,CAAhD;CAMA,OApBF;CAqBA;;;CASD,kBAAYO,OAAZ,EASA;CAAA;;CAAA;CACC;CADD,oFAbmB,IAAIxC,GAAJ,EAanB;CAAA,wFAZuB,IAAIA,GAAJ,EAYvB;CAAA,oFAXQ,IAAIyC,eAAK,CAACC,WAAV,EAWR;CAGC,UAAKjC,UAAL,GAAkB+B,OAAO,CAAC/B,UAA1B;CACA,UAAKC,QAAL,GAAgB8B,OAAO,CAAC9B,QAAxB;CACA,UAAKxB,KAAL,GAAasD,OAAO,CAACtD,KAArB;CACA,UAAKyD,SAAL,GAAiBH,OAAO,CAACG,SAAzB;CACA,UAAKC,mBAAL,GAA2BJ,OAAO,CAACI,mBAAnC;CACA,UAAKC,IAAL,GAAYL,OAAO,CAACK,IAApB;CACA,UAAKC,IAAL,GAAYN,OAAO,CAACM,IAApB;;CAEA,QAAMC,SAAS,GAAG,MAAKC,YAAL,EAAlB,CAXD;;;CAcC,QAAI,CAACD,SAAS,CAAChC,MAAV,CAAiB,MAAjB,EAAyBF,IAAzB,EAAL,EACA;CACCkC,MAAAA,SAAS,CACPE,MADF,CACS,UADT,EAEEA,MAFF,CAES,QAFT,EAGEb,IAHF,CAGO,IAHP,EAGa,aAHb,EAIEa,MAJF,CAIS,gBAJT,EAKEb,IALF,CAKO,cALP,EAKuB,GALvB;CAOAW,MAAAA,SAAS,CACPhC,MADF,CACS,cADT,EAEEkC,MAFF,CAES,eAFT,EAGEb,IAHF,CAGO,MAHP,EAGe,UAHf,EAIEA,IAJF,CAIO,QAJP,EAIiB,GAJjB;CAKA;;CAED,UAAKc,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BC,IAA3B,2CAA7B;CACA,UAAKC,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBD,IAAzB,2CAA3B;CACA,UAAKE,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BF,IAA3B,2CAA7B;CAEAjB,IAAAA,SAAA,CAAU,MAAKzB,UAAf,EAA2B6C,EAA3B,CAA8B,WAA9B,EAA2C,MAAKJ,qBAAhD;CAEAjE,IAAAA,MAAM,CAACE,SAAP,CAAiBoE,IAAjB;CApCD;CAqCC;;;;+BAGD;CACC,WAAKC,QAAL,GAAgB,IAAhB;CACA;;;8BAGD;CACC,WAAKA,QAAL,GAAgB,KAAhB;CACA;;;iCAGD;CACC,aAAO,CAAC,KAAKA,QAAb;CACA;;;qCAGD;CAAA;;CACC,aAAO,KAAKC,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC,YAAM;CAC9C,YAAMC,UAAU,GAAGzB,SAAA,CACV,MAAI,CAACS,SADK,EAEjB5B,MAFiB,CAEV,kBAFU,CAAnB;;CAIA,YAAI4C,UAAU,CAAC9C,IAAX,EAAJ,EACA;CACC,iBAAO8C,UAAP;CACA;;CAED,eAAOzB,SAAA,CACE,MAAI,CAACS,SADP,EAELM,MAFK,CAEE,KAFF,EAGLb,IAHK,CAGA,OAHA,EAGS,iBAHT,CAAP;CAIA,OAdM,CAAP;CAeA;;;yCAGD;CACC,aAAO,KAAKwB,aAAL,GAAqB/C,IAArB,GAA4BgD,qBAA5B,EAAP;CACA;;;oCAGD;CAAA;;CACC,aAAO,KAAKJ,KAAL,CAAWC,QAAX,CAAoB,WAApB,EAAiC,YAAM;CAC7C,YAAMX,SAAS,GAAGb,SAAA,CACT,MAAI,CAACS,SADI,EAEhB5B,MAFgB,CAET,wBAFS,CAAlB;;CAIA,YAAIgC,SAAS,CAAClC,IAAV,EAAJ,EACA;CACC,iBAAOkC,SAAP;CACA;;CAED,eAAOb,SAAA,CACE,MAAI,CAACS,SADP,EAELM,MAFK,CAEE,KAFF,EAGLb,IAHK,CAGA,OAHA,EAGS,uBAHT,CAAP;CAIA,OAdM,CAAP;CAeA;;;qCAGD;CACC,aAAO,KAAKqB,KAAL,CAAWC,QAAX,CAAoB,YAApB,EACN,KAAKE,aAAL,GACEX,MADF,CACS,MADT,EAEEb,IAFF,CAEO,OAFP,EAEgB,mBAFhB,CADM,CAAP;CAKA;;;wCAGD;CACC,WAAK0B,aAAL,GAAqBC,MAArB;CACA,WAAKN,KAAL,CAAW9B,MAAX,CAAkB,YAAlB;CACA;;;yCAGD;CACC,UAAMqC,YAAY,GAAGxF,gBAAgB,CACpC,KAAKyF,iBAAL,EADoC,EAEpC,KAAKxD,UAAL,CAAgBoD,qBAAhB,EAFoC,CAArC;CAKA,2CACIG,YADJ,EAEIlF,cAAc,CAACkF,YAAD,CAFlB;CAIA;;;uCAGD;CACC,UAAMA,YAAY,GAAGxF,gBAAgB,CACpC,KAAKyF,iBAAL,EADoC,EAEpC,KAAKvD,QAAL,CAAcmD,qBAAd,EAFoC,CAArC;CAKA,2CACIG,YADJ,EAEIlF,cAAc,CAACkF,YAAD,CAFlB;CAIA;;;oCAGD;CACC,UAAMA,YAAY,GAAGxF,gBAAgB,CACpC,KAAKyF,iBAAL,EADoC,EAEpC,KAAK/E,KAAL,CAAW2E,qBAAX,EAFoC,CAArC;CAKA,2CACIG,YADJ,EAEIlF,cAAc,CAACkF,YAAD,CAFlB;CAIA;;;kDAGD;CAAA,sBACgB9B,QAAA,CAAS,KAAK0B,aAAL,GAAqB/C,IAArB,EAAT,CADhB;CAAA;CAAA,UACQqD,CADR;CAAA,UACWC,CADX;;CAEC,aAAO;CAACD,QAAAA,CAAC,EAADA,CAAD;CAAIC,QAAAA,CAAC,EAADA;CAAJ,OAAP;CACA;CAED;;;;wCACmB7D,MAAMM,IACzB;CACC,UAAI,CAAC,KAAKwD,OAAV,EACA;CACC,aAAKA,OAAL,GAAe,IAAf;CACA,aAAKC,IAAL,CAAU,0BAAV,EAAsC;CAAC/D,UAAAA,IAAI,EAAJA,IAAD;CAAOM,UAAAA,EAAE,EAAFA;CAAP,SAAtC;CACA;CACD;CAED;;;;yCAEA;CACC,UAAI,KAAKwD,OAAT,EACA;CACC,aAAKA,OAAL,GAAe,KAAf;CACA,aAAKC,IAAL,CAAU,yBAAV;CACA;CACD;CAED;;;;6CAEA;CAAA,kCAC4B,KAAKC,iBAAL,EAD5B;CAAA,UACQvF,OADR,yBACQA,OADR;CAAA,UACiBC,OADjB,yBACiBA,OADjB;;CAGC,WAAK8E,aAAL,GACE1B,IADF,CACO,IADP,EACarD,OADb,EAEEqD,IAFF,CAEO,IAFP,EAEapD,OAFb,EAGEoD,IAHF,CAGO,IAHP,EAGarD,OAHb,EAIEqD,IAJF,CAIO,IAJP,EAIapD,OAJb;CAMA,WAAK4E,aAAL,GACE3B,KADF,CACQ,SADR,EACmB,KADnB,EAEEqB,EAFF,CAEK,WAFL,EAEkB,KAAKD,qBAFvB,EAGEC,EAHF,CAGK,SAHL,EAGgB,KAAKF,mBAHrB;CAKA,WAAKiB,IAAL,CAAU,kBAAV;CACA;CAED;;;;6CAEA;CAAA,kCACgB,KAAKE,0BAAL,EADhB;CAAA,UACQL,CADR,yBACQA,CADR;CAAA,UACWC,CADX,yBACWA,CADX;;CAGC,WAAKL,aAAL,GACE1B,IADF,CACO,IADP,EACa8B,CADb,EAEE9B,IAFF,CAEO,IAFP,EAEa+B,CAFb;CAIA,WAAKE,IAAL,CAAU,aAAV;CAEA,UAAMG,iBAAiB,GAAG,KAAKC,oBAAL,EAA1B;;CAEA,UAAID,iBAAiB,IAAIA,iBAAiB,CAACE,SAAlB,EAAzB,EACA;CACC,YAAIF,iBAAiB,KAAK,IAA1B,EACA;CACCA,UAAAA,iBAAiB,CAACG,kBAAlB,CAAqC,IAArC,EAA2CH,iBAA3C;CACA;CACD;;CAEDvF,MAAAA,MAAM,CAAC2F,yBAAP,CAAiCJ,iBAAjC;CACA;CAED;;;;2CAEA;CACC,WAAKZ,aAAL,GACEN,EADF,CACK,WADL,EACkB,IADlB,EAEEA,EAFF,CAEK,SAFL,EAEgB,IAFhB,EAGErB,KAHF,CAGQ,SAHR,EAGmB,IAHnB;CAKA,WAAK4C,gBAAL,GAND;;CASC5F,MAAAA,MAAM,CAACE,SAAP,CAAiBK,OAAjB,CAAyB,UAAAH,MAAM;CAAA,eAAIA,MAAM,CAACI,iBAAP,EAAJ;CAAA,OAA/B;CAEA,UAAM+E,iBAAiB,GAAG,KAAKC,oBAAL,EAA1B;CACA,UAAMK,KAAK,GAAG,IAAIC,eAAK,CAACC,SAAV,CAAoB;CACjClC,QAAAA,IAAI,EAAE;CAACxC,UAAAA,IAAI,EAAE,IAAP;CAAaM,UAAAA,EAAE,EAAE4D;CAAjB;CAD2B,OAApB,CAAd;CAGA,WAAKH,IAAL,CAAU,gBAAV,EAA4BS,KAA5B;;CAEA,UAAIN,iBAAiB,IAAIA,iBAAiB,CAACE,SAAlB,EAAzB,EACA;CACC,YAAIF,iBAAiB,IAAI,CAACM,KAAK,CAACG,kBAAN,EAA1B,EACA;CACC,cAAI,CAAC,KAAKnC,IAAL,CAAUoC,MAAV,CAAiBpC,IAAjB,CAAsBqC,cAA3B,EACA;CACC,iBAAKd,IAAL,CAAU,cAAV,EAA0B;CACzBe,cAAAA,OAAO,EAAEC,aAAG,CAACC,UAAJ,CAAe,kCAAf;CADgB,aAA1B;CAIA;CACA;;CAED,eAAK1D,SAAL,CAAe4C,iBAAf,EAAkC,MAAlC;CACA;CACD;CACD;;;qCAGD;CAAA;;CACC,aAAO,KAAKf,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC;CAAA,eACxC,IAAI6B,0BAAJ,CAAoB;CACnBC,UAAAA,WAAW,EAAE,MAAI,CAAC7E,eAAL,EADM;CAEnB8E,UAAAA,KAAK,EAAE,MAAI,CAACC,kBAAL,CAAwB,+BAAI,MAAI,CAAC9F,KAAT,EAAgB,CAAhB,CAAxB,CAFY;CAGnB+F,UAAAA,MAAM,EAAE;CACPC,YAAAA,YAAY,EAAE;CAAA,qBAAM,MAAI,CAACC,sBAAL,EAAN;CAAA,aADP;CAEPC,YAAAA,WAAW,EAAE;CAAA,qBAAM,MAAI,CAACC,oBAAL,EAAN;CAAA;CAFN;CAHW,SAApB,CADwC;CAAA,OAAlC,CAAP;CAUA;;;wCAEkBjG,MACnB;CACC,UAAMkG,IAAI,GAAG,IAAb;;CACA,UAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAASpE,WAAT,EAA8B;CACzD,YAAI,CAAC3E,cAAI,CAACgJ,KAAL,CAAWpG,IAAX,CAAD,IAAqBA,IAAI,CAAC+B,WAAL,KAAqBA,WAA9C,EACA;CACCmE,UAAAA,IAAI,CAACG,iBAAL,CAAuBrG,IAAvB,EAA6B+B,WAA7B;CACA/B,UAAAA,IAAI,CAAC+B,WAAL,GAAmBA,WAAnB;CACA;;CAED,aAAKuE,mBAAL,GAA2BC,KAA3B;CACA,aAAKD,mBAAL,GAA2BE,YAA3B,GAA0C,CAA1C,EAA6CC,OAA7C,CACClB,aAAG,CAACC,UAAJ,+BAAsCzD,WAAW,CAAC2E,WAAZ,EAAtC,EADD;CAGA,OAXD;;CAYA,UAAM3E,WAAW,GAAG3E,cAAI,CAACgJ,KAAL,CAAWpG,IAAX,IAAmB,MAAnB,GAA4BA,IAAI,CAAC+B,WAAL,CAAiB2E,WAAjB,EAAhD;CAEA,aAAO,CACN;CACCC,QAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,+BAAsCzD,WAAtC,EADP;CAEC4D,QAAAA,KAAK,EAAE,CACN;CACCgB,UAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,oBAAf,CADP;CAECoB,UAAAA,OAFD,qBAEW;CACTT,YAAAA,mBAAmB,CAACU,IAApB,CAAyB,IAAzB,EAA+B,MAA/B;CACA;CAJF,SADM,EAON;CACCF,UAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,oBAAf,CADP;CAECoB,UAAAA,OAFD,qBAEW;CACTT,YAAAA,mBAAmB,CAACU,IAApB,CAAyB,IAAzB,EAA+B,MAA/B;CACA;CAJF,SAPM;CAFR,OADM,EAkBN;CACCF,QAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,iBAAf,CADP;CAECoB,QAAAA,OAFD,qBAEW;CACTV,UAAAA,IAAI,CAACY,QAAL,CAAc9G,IAAd;CACA,eAAKuG,KAAL;CACA;CALF,OAlBM,EAyBN;CACCI,QAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,eAAf,CADP;CAECoB,QAAAA,OAFD,qBAEW;CACTV,UAAAA,IAAI,CAACa,UAAL,CAAgB/G,IAAhB;CACA,cAAMgH,UAAU,GAAG,KAAKV,mBAAL,EAAnB;;CAEA,cAAIU,UAAJ,EACA;CACCA,YAAAA,UAAU,CACRC,cADF,CACiB,KAAKC,iBAAL,GAAyBC,EAD1C;CAEA;CACD;CAXF,OAzBM,CAAP;CAuCA;;;uCAEiBnH,MAAYoH,QAC9B;CAAA;;CACC,WAAK7C,IAAL,CAAU,0BAAV,EAAsC;CACrCvE,QAAAA,IAAI,EAAJA,IADqC;CAErCoH,QAAAA,MAAM,EAANA,MAFqC;CAGrCC,QAAAA,gBAAgB,EAAE;CAAA,iBAAM,MAAI,CAAC9C,IAAL,CAAU,iBAAV,EAA6B;CAAEvE,YAAAA,IAAI,EAAJA;CAAF,WAA7B,CAAN;CAAA;CAHmB,OAAtC;CAKA;;;8BAEQA,MACT;CACC,WAAKuE,IAAL,CAAU,iBAAV,EAA6B;CAACvE,QAAAA,IAAI,EAAJA;CAAD,OAA7B;CACA;;;+BAESsH,aAAqBvF,aAC/B;CAAA;;CAAA,UADoDL,WACpD,uEADkE,KAClE;CACCe,MAAAA,UAAU,CAAC,YAAM;CAChB,YAAI,CAAC,+BAAI,MAAI,CAAC3C,KAAT,EAAgByH,IAAhB,CAAqB,UAAAvH,IAAI;CAAA,iBAAIA,IAAI,CAACc,EAAL,KAAYwG,WAAhB;CAAA,SAAzB,CAAL,EACA;CACC,cAAMrE,SAAS,GAAG,MAAI,CAACC,YAAL,EAAlB;;CACA,cAAMjB,IAAI,GAAG,MAAI,CAACC,WAAL,CAAiBoF,WAAjB,CAAb;;CAEA,cAAME,IAAI,GAAGpF,OAAA,EAAb;;CAEA,cAAMqF,MAAM,GAAG,MAAI,CAACzE,IAAL,CAAUoC,MAAV,CAAiBsC,KAAjB,GAAyBC,OAAzB,CAAiC,GAAjC,EAAsC,GAAtC,CAAf;;CACA,cAAMC,IAAI,GAAGN,WAAW,CAACtE,IAAZ,CAAiBoC,MAAjB,CAAwBsC,KAAxB,GAAgCC,OAAhC,CAAwC,GAAxC,EAA6C,GAA7C,CAAb;CAEA,cAAME,OAAO,aAAMJ,MAAN,cAAgBG,IAAhB,CAAb;CAEA,cAAM5G,KAAK,GAAGiC,SAAS,CACrBhC,MADY,CACL,MADK,EAEZkC,MAFY,CAEL,YAFK,EAGZb,IAHY,CAGP,IAHO,EAGDuF,OAHC,EAIZvF,IAJY,CAIP,MAJO,EAIC,CAJD,EAKZA,IALY,CAKP,MALO,EAKC,CALD,EAMZA,IANY,CAMP,aANO,EAMQ,EANR,EAOZA,IAPY,CAOP,cAPO,EAOS,EAPT,EAQZA,IARY,CAQP,aARO,EAQQ,gBARR,EASZA,IATY,CASP,QATO,EASG,MATH,EAUZa,MAVY,CAUL,MAVK,EAWZb,IAXY,CAWP,GAXO,EAWF,qBAXE,EAYZA,IAZY,CAYP,OAZO,EAYE,uBAZF,EAaZrB,MAbY,CAaL,SAAS6G,cAAT,GAA0B;CACjC,mBAAO,KAAK5G,UAAZ;CACA,WAfY,CAAd;CAiBA,cAAM6G,QAAQ,GAAG9E,SAAS,CACxBE,MADe,CACR,MADQ,EAEfb,IAFe,CAEV,OAFU,EAED,iBAFC,EAGfA,IAHe,CAGV,YAHU,iBAGYuF,OAHZ,QAIfvF,IAJe,CAIV,GAJU,EAILkF,IAAI,CAACvF,IAAD,CAJC,CAAjB;;CAMA,UAAA,MAAI,CAACI,gBAAL,CAAsBJ,IAAtB;;CAEA,cAAMjC,IAAI,GAAG;CACZQ,YAAAA,IAAI,EAAE,MADM;CAEZM,YAAAA,EAAE,EAAEwG,WAFQ;CAGZvG,YAAAA,IAAI,EAAEgH,QAHM;CAIZhG,YAAAA,WAAW,EAAXA,WAJY;CAKZf,YAAAA,KAAK,EAALA,KALY;CAMZiB,YAAAA,IAAI,EAAJA;CANY,WAAb;;CASA,UAAA,MAAI,CAACsC,IAAL,CAAU,iBAAV,EAA6B;CAACvE,YAAAA,IAAI,EAAJA,IAAD;CAAO0B,YAAAA,WAAW,EAAXA;CAAP,WAA7B;;CACA4F,UAAAA,WAAW,CAAC/C,IAAZ,CAAiB,eAAjB,EAAkC;CAACvE,YAAAA,IAAI,EAAJA,IAAD;CAAO0B,YAAAA,WAAW,EAAXA;CAAP,WAAlC;;CAEA,UAAA,MAAI,CAAC5B,KAAL,CAAWG,GAAX,CAAeD,IAAf;;CAEA,cAAMgI,IAAI,GAAG,MAAI,CAACC,kBAAL,EAAb;;CACA,cAAMd,EAAE,GAAGa,IAAI,CAACxB,YAAL,GAAoBlJ,MAA/B;CAEA0K,UAAAA,IAAI,CAACE,WAAL,CAAiB;CAChBf,YAAAA,EAAE,aAAMA,EAAN,CADc;CAEhBR,YAAAA,IAAI,EAAEwB,cAAI,CAACC,MAAL,CAAYd,WAAW,CAACvE,IAAxB,CAFU;CAGhB8C,YAAAA,MAAM,EAAE;CACPwC,cAAAA,YADO,0BACQ;CACdlJ,gBAAAA,MAAM,CAACmJ,aAAP,CAAqBtI,IAArB;CACA,eAHM;CAIPuI,cAAAA,YAJO,0BAIQ;CACdpJ,gBAAAA,MAAM,CAACqJ,gBAAP;CACA;CANM,aAHQ;CAWhB7C,YAAAA,KAAK,EAAE,MAAI,CAACC,kBAAL,CAAwB5F,IAAxB;CAXS,WAAjB;CAaA;;CAED,YAAI,MAAI,CAACF,KAAL,CAAW2I,IAAX,GAAkB,CAAtB,EACA;CACC,UAAA,MAAI,CAACC,sBAAL,CAA4B,MAAI,CAAC5I,KAAL,CAAW2I,IAAvC;CACA;CACD,OA1ES,CAAV;CA2EA;;;mCAEanB,aACd;CAAA;;CACC7E,MAAAA,UAAU,CAAC,YAAM;CAChB,YAAI,CAAC,+BAAI,MAAI,CAACtC,SAAT,EAAoBoH,IAApB,CAAyB,UAAAvH,IAAI;CAAA,iBAAIA,IAAI,CAACc,EAAL,KAAYwG,WAAhB;CAAA,SAA7B,CAAL,EACA;CACC,cAAMrE,SAAS,GAAG,MAAI,CAACC,YAAL,EAAlB;;CACA,cAAMjB,IAAI,GAAG,MAAI,CAACC,WAAL,CAAiBoF,WAAjB,CAAb;;CAEA,cAAME,IAAI,GAAGpF,OAAA,EAAb;;CAEA,cAAMqF,MAAM,GAAG,MAAI,CAACzE,IAAL,CAAUoC,MAAV,CAAiBsC,KAAjB,GAAyBC,OAAzB,CAAiC,GAAjC,EAAsC,GAAtC,CAAf;;CACA,cAAMC,IAAI,GAAGN,WAAW,CAACtE,IAAZ,CAAiBoC,MAAjB,CAAwBsC,KAAxB,GAAgCC,OAAhC,CAAwC,GAAxC,EAA6C,GAA7C,CAAb;CAEA,cAAME,OAAO,aAAMJ,MAAN,cAAgBG,IAAhB,CAAb;CAEA,cAAM5G,KAAK,GAAGiC,SAAS,CACrBhC,MADY,CACL,MADK,EAEZkC,MAFY,CAEL,YAFK,EAGZb,IAHY,CAGP,IAHO,EAGDuF,OAHC,EAIZvF,IAJY,CAIP,MAJO,EAIC,CAJD,EAKZA,IALY,CAKP,MALO,EAKC,CALD,EAMZA,IANY,CAMP,aANO,EAMQ,EANR,EAOZA,IAPY,CAOP,cAPO,EAOS,EAPT,EAQZA,IARY,CAQP,aARO,EAQQ,gBARR,EASZA,IATY,CASP,QATO,EASG,MATH,EAUZa,MAVY,CAUL,MAVK,EAWZb,IAXY,CAWP,GAXO,EAWF,qBAXE,EAYZA,IAZY,CAYP,OAZO,EAYE,kDAZF,EAaZrB,MAbY,CAaL,SAAS6G,cAAT,GAA0B;CACjC,mBAAO,KAAK5G,UAAZ;CACA,WAfY,CAAd;CAiBA,cAAM6G,QAAQ,GAAG9E,SAAS,CACxBE,MADe,CACR,MADQ,EAEfb,IAFe,CAEV,OAFU,EAED,sCAFC,EAGfA,IAHe,CAGV,YAHU,iBAGYuF,OAHZ,QAIfvF,IAJe,CAIV,GAJU,EAILkF,IAAI,CAACvF,IAAD,CAJC,CAAjB;;CAMA,UAAA,MAAI,CAAC0G,oBAAL,CAA0B1G,IAA1B;;CAEA,cAAMjC,IAAI,GAAG;CACZQ,YAAAA,IAAI,EAAE,MADM;CAEZM,YAAAA,EAAE,EAAEwG,WAFQ;CAGZvG,YAAAA,IAAI,EAAEgH,QAHM;CAIZ/G,YAAAA,KAAK,EAALA,KAJY;CAKZiB,YAAAA,IAAI,EAAJA;CALY,WAAb;;CAQA,UAAA,MAAI,CAACsC,IAAL,CAAU,qBAAV,EAAiC;CAACvE,YAAAA,IAAI,EAAJA,IAAD;CAAO0B,YAAAA,WAAW,EAAE;CAApB,WAAjC;;CACA4F,UAAAA,WAAW,CAAC/C,IAAZ,CAAiB,mBAAjB,EAAsC;CAACvE,YAAAA,IAAI,EAAJA,IAAD;CAAO0B,YAAAA,WAAW,EAAE;CAApB,WAAtC;;CAEA,UAAA,MAAI,CAACvB,SAAL,CAAeF,GAAf,CAAmBD,IAAnB;CACA;CACD,OAnDS,CAAV;CAoDA;;;gCAEUA,MAAY4I,OACvB;CAAA,UADsClH,WACtC,uEADoD,KACpD;CACC,UAAMO,IAAI,GAAG,KAAKC,WAAL,CAAiB0G,KAAjB,CAAb;CACA,UAAMpB,IAAI,GAAGpF,OAAA,EAAb;CACA,UAAMyG,KAAK,GAAG7I,IAAI,CAACc,EAAnB;CAEAd,MAAAA,IAAI,CAACe,IAAL,CACEuB,IADF,CACO,GADP,EACYkF,IAAI,CAACvF,IAAD,CADhB;CAGAjC,MAAAA,IAAI,CAACiC,IAAL,GAAYA,IAAZ;CACAjC,MAAAA,IAAI,CAACc,EAAL,GAAU8H,KAAV;CAEA,WAAKrE,IAAL,CAAU,iBAAV,EAA6B;CAACvE,QAAAA,IAAI,EAAJA,IAAD;CAAO0B,QAAAA,WAAW,EAAXA;CAAP,OAA7B;CACAkH,MAAAA,KAAK,CAACrE,IAAN,CAAW,eAAX,EAA4B;CAACvE,QAAAA,IAAI,EAAJA,IAAD;CAAO0B,QAAAA,WAAW,EAAXA;CAAP,OAA5B;;CAEA,UAAI,CAACmH,KAAK,CAACC,QAAN,EAAL,EACA;CACCD,QAAAA,KAAK,CAACtE,IAAN,CAAW,eAAX;CACA;CACD;;;gCAEUvE,MACX;CAAA,UADuB0B,WACvB,uEADqC,KACrC;CACC;CAEA1B,MAAAA,IAAI,CAAC+I,MAAL,GAAc,IAAd;;CAEA,UAAI,CAACrH,WAAL,EACA;CACC,aAAK5B,KAAL,CAAW+B,MAAX,CAAkB7B,IAAlB;CACA;;CAEDA,MAAAA,IAAI,CAACe,IAAL,CAAUkD,MAAV;CACAjE,MAAAA,IAAI,CAACgB,KAAL,CAAWiD,MAAX;;CAEA,UAAI,CAAC,KAAK+E,YAAL,EAAL,EACA;CACCvI,QAAAA,aAAG,CAACwD,MAAJ,CAAWjE,IAAI,CAACQ,IAAL,CAAUK,eAAV,EAAX;CACA,aAAKoI,aAAL,GAAqBC,OAArB;CACA,aAAKnD,sBAAL;CACA,aAAKpC,KAAL,CAAW9B,MAAX,CAAkB,YAAlB;CACA;;CAED,WAAK6G,sBAAL,CAA4B,KAAK5I,KAAL,CAAW2I,IAAvC;CAEA,UAAMU,YAAY,GAAG,+BAAI,KAAKrJ,KAAT,EAAgBsJ,MAAhB,CAAuB,UAAA7I,IAAI;CAAA,eAAI,CAACA,IAAI,CAACwI,MAAV;CAAA,OAA3B,CAArB;;CAEA,UAAII,YAAY,CAAC7L,MAAb,IAAuB,CAA3B,EACA;CACC,YAAI,KAAK2K,kBAAL,GAA0BoB,cAA1B,GAA2CC,OAA3C,EAAJ,EACA;CACC,eAAKL,aAAL,GAAqBC,OAArB;CACA,eAAKvF,KAAL,CAAW9B,MAAX,CAAkB,YAAlB;CAEA,eAAKoH,aAAL,GAAqBM,IAArB;CACA;;CAED,aAAKtB,kBAAL,GAA0BiB,OAA1B;CACA,aAAKnD,sBAAL;CACA,aAAKpC,KAAL,CAAW9B,MAAX,CAAkB,iBAAlB;CACA;;CAED7B,MAAAA,IAAI,CAACQ,IAAL,CAAU+D,IAAV,CAAe,uBAAf,EAAwC;CAACvE,QAAAA,IAAI,EAAJA,IAAD;CAAO0B,QAAAA,WAAW,EAAXA;CAAP,OAAxC;;CAEA,UAAI,CAAC1B,IAAI,CAACQ,IAAL,CAAUsI,QAAV,EAAL,EACA;CACC9I,QAAAA,IAAI,CAACQ,IAAL,CAAU+D,IAAV,CAAe,eAAf,EAAgC;CAAC7C,UAAAA,WAAW,EAAXA;CAAD,SAAhC;CACA;;CAED1B,MAAAA,IAAI,CAACc,EAAL,CAAQyD,IAAR,CAAa,iBAAb,EAAgC;CAACvE,QAAAA,IAAI,EAAJA,IAAD;CAAO0B,QAAAA,WAAW,EAAXA;CAAP,OAAhC;;CAEA,UAAI,CAAC1B,IAAI,CAACc,EAAL,CAAQgI,QAAR,EAAL,EACA;CACC9I,QAAAA,IAAI,CAACc,EAAL,CAAQyD,IAAR,CAAa,eAAb,EAA8B;CAAC7C,UAAAA,WAAW,EAAXA;CAAD,SAA9B;CACA;CACD;;;sCAGD;CAAA;;CAAA,UADeA,WACf,uEAD6B,KAC7B;CACC,WAAK5B,KAAL,CAAWJ,OAAX,CAAmB,UAAAM,IAAI;CAAA,eAAI,MAAI,CAAC+G,UAAL,CAAgB/G,IAAhB,EAAsB0B,WAAtB,CAAJ;CAAA,OAAvB;CACA;;;oCAEc1B,MACf;CACC,WAAKG,SAAL,CAAe0B,MAAf,CAAsB7B,IAAtB;CAEAA,MAAAA,IAAI,CAACe,IAAL,CAAUkD,MAAV;CACAjE,MAAAA,IAAI,CAACgB,KAAL,CAAWiD,MAAX;;CAEA,UAAI,CAAC,KAAKuF,YAAL,EAAL,EACA;CACC/I,QAAAA,aAAG,CAACwD,MAAJ,CAAWjE,IAAI,CAACQ,IAAL,CAAUiJ,mBAAV,EAAX;CACA;;CAEDzJ,MAAAA,IAAI,CAACQ,IAAL,CAAU+D,IAAV,CAAe,uBAAf,EAAwC;CAACvE,QAAAA,IAAI,EAAJA;CAAD,OAAxC;CACAA,MAAAA,IAAI,CAACQ,IAAL,CAAU+D,IAAV,CAAe,2BAAf,EAA4C;CAACvE,QAAAA,IAAI,EAAJA;CAAD,OAA5C;;CAEA,UAAI,CAACA,IAAI,CAACQ,IAAL,CAAUgJ,YAAV,EAAL,EACA;CACCxJ,QAAAA,IAAI,CAACQ,IAAL,CAAU+D,IAAV,CAAe,mBAAf;CACA;;CAEDvE,MAAAA,IAAI,CAACc,EAAL,CAAQyD,IAAR,CAAa,qBAAb,EAAoC;CAACvE,QAAAA,IAAI,EAAJA;CAAD,OAApC;;CAEA,UAAI,CAACA,IAAI,CAACc,EAAL,CAAQ0I,YAAR,EAAL,EACA;CACCxJ,QAAAA,IAAI,CAACc,EAAL,CAAQyD,IAAR,CAAa,mBAAb;CACA;CACD;;;0CAGD;CAAA;;CACC,WAAKpE,SAAL,CAAeT,OAAf,CAAuB,UAAAM,IAAI;CAAA,eAAI,MAAI,CAAC0J,cAAL,CAAoB1J,IAApB,CAAJ;CAAA,OAA3B;CACA;;;gCAGD;CAAA;;CACC,aAAO,+BAAIb,MAAM,CAACkB,WAAP,EAAJ,EACLkH,IADK,CACA,UAAAhH,IAAI;CAAA,eAAI,CAACA,IAAI,CAACwI,MAAN,KAAiBxI,IAAI,CAACC,IAAL,KAAc,OAAd,IAAsBD,IAAI,CAACO,EAAL,KAAY,OAAnD,CAAJ;CAAA,OADJ,CAAP;CAEA;;;oCAGD;CAAA;;CACC,aAAO,+BAAI3B,MAAM,CAACkB,WAAP,EAAJ,EACLkH,IADK,CACA,UAAAhH,IAAI;CAAA,eAAI,CAACA,IAAI,CAACwI,MAAN,IAAgBxI,IAAI,CAACC,IAAL,KAAc,OAAlC;CAAA,OADJ,CAAP;CAEA;;;kCAGD;CAAA;;CACC,aAAO,+BAAIrB,MAAM,CAACkB,WAAP,EAAJ,EACLkH,IADK,CACA,UAAAhH,IAAI;CAAA,eAAI,CAACA,IAAI,CAACwI,MAAN,IAAgBxI,IAAI,CAACO,EAAL,KAAY,OAAhC;CAAA,OADJ,CAAP;CAEA;;;oCAGD;CAAA;;CACC,aAAO,+BAAI3B,MAAM,CAACkB,WAAP,EAAJ,EACLkH,IADK,CACA,UAAAhH,IAAI;CAAA,eAAI,CAACA,IAAI,CAACwI,MAAN,KAAiBxI,IAAI,CAACC,IAAL,KAAc,OAAd,IAAsBD,IAAI,CAACO,EAAL,KAAY,OAAnD,CAAJ;CAAA,OADJ,CAAP;CAEA;;;sCAEgBmB,MACjB;CACC,UAAM0H,MAAM,GAAG,KAAK9I,eAAL,EAAf;CACA,UAAM+I,QAAQ,GAAG,KAAKC,WAAL,EAAjB;CACA,UAAMvL,IAAI,GAAG2D,IAAI,CAAC,CAAD,CAAJ,CAAQ,CAAR,CAAb;CAEAjF,MAAAA,aAAG,CAACmF,KAAJ,CAAUwH,MAAV,mLAESrL,IAFT;;CAMA,UAAI,CAACsL,QAAQ,CAACE,QAAT,CAAkBH,MAAlB,CAAL,EACA;CACClJ,QAAAA,aAAG,CAAC0C,MAAJ,CAAWwG,MAAX,EAAmBC,QAAnB;CACA;CACD;;;2CAGD;CAAA;;CACC,aAAO,KAAKjG,KAAL,CAAWC,QAAX,CAAoB,kBAApB,EAAwC,YAAM;CACpD,YAAM+F,MAAM,GAAGI,iBAAO,CAACC,KAAR,CAAc,OAAI,CAACnJ,eAAL,EAAd,CAAf;CACAJ,QAAAA,aAAG,CAACC,QAAJ,CAAaiJ,MAAb,EAAqB,2BAArB;CACA,eAAOA,MAAP;CACA,OAJM,CAAP;CAKA;;;0CAEoB1H,MACrB;CACC,UAAM0H,MAAM,GAAG,KAAKF,mBAAL,EAAf;CACA,UAAMG,QAAQ,GAAG,KAAKC,WAAL,EAAjB;CACA,UAAMvL,IAAI,GAAG2D,IAAI,CAAC,CAAD,CAAJ,CAAQ,CAAR,CAAb;CAEAjF,MAAAA,aAAG,CAACmF,KAAJ,CAAUwH,MAAV,iLAESrL,IAFT;;CAMA,UAAI,CAACsL,QAAQ,CAACE,QAAT,CAAkBH,MAAlB,CAAL,EACA;CACClJ,QAAAA,aAAG,CAAC0C,MAAJ,CAAWwG,MAAX,EAAmBC,QAAnB;CACA;CACD;;;uCAGD;CAAA;;CACC,UAAMK,OAAO,GAAG,KAAKjH,IAAL,CAAUoC,MAAV,CAAiBpC,IAAjB,CAAsBqC,cAAtC;CACA,aAAO,KAAK1B,KAAL,CAAWC,QAAX,CAAoB,cAApB,EAAoC;CAAA,eAC1C5G,aAAG,CAACC,MADsC,sTAGvB,OAAI,CAACiN,wBAAL,CAA8B7G,IAA9B,CAAmC,OAAnC,CAHuB,EAIvBlE,MAAM,CAACgL,wBAJgB,EAK5B,OAAI,CAACC,mBAAL,CAAyB/G,IAAzB,CAA8B,OAA9B,CAL4B,EAM9BkC,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAN8B,EAO9B,CAACyE,OAAD,GAAW,uBAAX,GAAqC,EAPP,EAQtC1E,aAAG,CAACC,UAAJ,CAAe,4BAAf,CARsC;CAAA,OAApC,CAAP;CAWA;CAED;;;;gDAEA;CACCrG,MAAAA,MAAM,CAACmJ,aAAP,OAAAnJ,MAAM,iCAAkB,KAAKW,KAAvB,EAAN;CACA;CAED;;;;;CAMA;2CAEA;CACC,UAAI,KAAKA,KAAL,CAAW2I,IAAX,GAAkB,CAAtB,EACA;CACC,YAAI,KAAK4B,oBAAL,EAAJ,EACA;CACC,eAAKpC,kBAAL,GAA0B1B,KAA1B;CACA;CACA;;CAED,aAAK0B,kBAAL,GAA0BsB,IAA1B;CACA,OATD,MAWA;CACC,aAAKN,aAAL,GAAqBM,IAArB;CACA;CACD;;;0CAGD;CAAA;;CACC,aAAO,KAAK5F,KAAL,CAAWC,QAAX,CAAoB,iBAApB,EACN,IAAI6B,0BAAJ,CAAoB;CACnBC,QAAAA,WAAW,EAAE,KAAK7E,eAAL,EADM;CAEnB8E,QAAAA,KAAK,EAAE,EAFY;CAGnB2E,QAAAA,UAAU,EAAE,IAHO;CAInBC,QAAAA,aAAa,EAAE,CAJI;CAKnB1E,QAAAA,MAAM,EAAE;CACPC,UAAAA,YAAY,EAAE;CAAA,mBAAM,OAAI,CAACC,sBAAL,EAAN;CAAA,WADP;CAEPC,UAAAA,WAAW,EAAE;CAAA,mBAAM,OAAI,CAACC,oBAAL,EAAN;CAAA;CAFN;CALW,OAApB,CADM,CAAP;CAYA;;;4CAGD;CACCxF,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKG,eAAL,EAAb,EAAqC,6BAArC;CACA;;;8CAGD;CACCJ,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKZ,eAAL,EAAhB,EAAwC,6BAAxC;CACA;;;4CAGD;CACC,aAAOJ,aAAG,CAAC+J,QAAJ,CAAa,KAAK3J,eAAL,EAAb,EAAqC,6BAArC,CAAP;CACA;;;yCAGD;CACC,aAAO,KAAK8C,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EACN5G,aAAG,CAACC,MADE,yIAAP;CAGA;;;4CAEsBE,OACvB;CACC,UAAMsN,YAAY,GAAG,KAAK5J,eAAL,EAArB;CACA,UAAM6J,cAAc,GAAG,KAAKC,iBAAL,EAAvB;;CAEA,UAAIxN,KAAK,GAAG,CAAZ,EACA;CACC,YAAI,CAACsN,YAAY,CAACX,QAAb,CAAsBY,cAAtB,CAAL,EACA;CACCjK,UAAAA,aAAG,CAAC0C,MAAJ,CAAWuH,cAAX,EAA2BD,YAA3B;CACA;;CAEDC,QAAAA,cAAc,CAACE,SAAf,GAA2BzN,KAA3B;CACA,OARD,MAUA;CACCuN,QAAAA,cAAc,CAACE,SAAf,GAA2B,CAA3B;CACAnK,QAAAA,aAAG,CAACwD,MAAJ,CAAWyG,cAAX;CACA;CACD;;;mCAGD;CACC,aAAO,KAAK9J,QAAL,CAAcU,OAAd,CAAsB,kBAAtB,CAAP;CACA;;;8CAGD;CACC,UAAIlE,cAAI,CAACC,OAAL,CAAa,KAAKyF,mBAAlB,CAAJ,EACA;CACC,YAAM+H,cAAc,GAAG,KAAK1G,iBAAL,EAAvB;CACA,eAAO,KAAKrB,mBAAL,CACLgI,GADK,CACD,UAAA3N,KAAK;CAAA,iBAAIA,KAAK,GAAG0N,cAAc,CAACvM,IAA3B;CAAA,SADJ,CAAP;CAEA;;CAED,UAAIlB,cAAI,CAAC2N,UAAL,CAAgB,KAAKjI,mBAArB,CAAJ,EACA;CACC,YAAM+H,eAAc,GAAG,KAAK1G,iBAAL,EAAvB;;CACA,eAAO,KAAKrB,mBAAL,GACLgI,GADK,CACD,UAAA3N,KAAK;CAAA,iBAAIA,KAAK,GAAG0N,eAAc,CAACvM,IAA3B;CAAA,SADJ,CAAP;CAEA;;CAED,aAAO,EAAP;CACA;;;kDAE4B8F,GAC7B;CACC,aAAO,KAAK4G,sBAAL,GAA8BpL,MAA9B,CAAqC,UAACqL,IAAD,EAAOC,IAAP;CAAA,eAC3CpN,IAAI,CAACqN,GAAL,CAASD,IAAI,GAAG9G,CAAhB,IAAqBtG,IAAI,CAACqN,GAAL,CAASF,IAAI,GAAG7G,CAAhB,CAArB,GAA0C8G,IAA1C,GAAiDD,IADN;CAAA,OAArC,CAAP;CAGA;;;iCAEWG,QACZ;CAAA;;CACC,UAAMC,cAAc,GAAGD,MAAM,CAACE,YAAP,EAAvB;CACA,UAAMC,eAAe,GAAG,KAAK/G,iBAAL,EAAxB;CAEA,UAAMgH,UAAU,GAAG,EAAnB;CACA,UAAMC,YAAY,GAAG,EAArB;CACA,UAAMxJ,IAAI,GAAG,EAAb;CAEAA,MAAAA,IAAI,CAACwB,IAAL,CAAU,CACT8H,eAAe,CAACtM,OADP,EAETsM,eAAe,CAACrM,OAFP,CAAV;CAKA+C,MAAAA,IAAI,CAACwB,IAAL,CAAU,CACT8H,eAAe,CAACtM,OADP,EAETsM,eAAe,CAACrM,OAAhB,GAA0BsM,UAFjB,CAAV;;CAKA,UAAID,eAAe,CAACrM,OAAhB,KAA4BmM,cAAc,CAACnM,OAA/C,EACA;CACC,YAAMwM,aAAa,GAAG,KAAKC,4BAAL,CAAkCN,cAAc,CAACpM,OAAjD,CAAtB;CAEAgD,QAAAA,IAAI,CAACwB,IAAL,CAAU,CACTiI,aADS,EAETH,eAAe,CAACrM,OAAhB,GAA0BsM,UAFjB,CAAV;CAKAvJ,QAAAA,IAAI,CAACwB,IAAL,CAAU,CACTiI,aADS,EAETL,cAAc,CAACnM,OAAf,GAA0BsM,UAAU,GAAG,CAAvC,GAA6CC,YAAY,GAAG,CAFnD,CAAV;CAKAxJ,QAAAA,IAAI,CAACwB,IAAL,CAAU,CACT4H,cAAc,CAACpM,OADN,EAEToM,cAAc,CAACnM,OAAf,GAA0BsM,UAAU,GAAG,CAAvC,GAA6CC,YAAY,GAAG,CAFnD,CAAV;CAIA,OAlBD,MAoBA;CACCxJ,QAAAA,IAAI,CAACwB,IAAL,CAAU,CACT4H,cAAc,CAACpM,OADN,EAEToM,cAAc,CAACnM,OAAf,GAAyBsM,UAFhB,CAAV;CAIA;;CAEDvJ,MAAAA,IAAI,CAACwB,IAAL,CAAU,CACT4H,cAAc,CAACpM,OADN,EAEToM,cAAc,CAACnM,OAAf,GAAyBuM,YAFhB,CAAV;CAKA,UAAMG,UAAU,GAAG,CAAnB;CAEA,aAAO,+BAAIzM,MAAM,CAACkB,WAAP,EAAJ,EAA0BT,MAA1B,CAAiC,UAACC,GAAD,EAAMG,IAAN,EAAe;CAAA,YAC/CQ,IAD+C,GACpBR,IADoB,CAC/CQ,IAD+C;CAAA,YACnCqL,WADmC,GACpB7L,IADoB,CACzCiC,IADyC;;CAGtD,YAAIzB,IAAI,KAAK,OAAb,EACA;CACC;CACJ;CACA;CACA;CACA;CAEI,cAAIX,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,MAAcgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAlB,EACA;CACC,gBAAIpO,SAAS,CAAC,CAACoC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAD,EAAYA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAZ,CAAD,EAAyB,CAACgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAD,EAAoBA,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAApB,CAAzB,CAAb,EACA;CACChM,cAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA/L,cAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA;CACD;;CAED,cAAIC,WAAW,CAACvO,MAAZ,KAAuB,CAA3B,EACA;CACC,gBAAIuC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,MAAcgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAlB,EACA;CACC,kBAAIpO,SAAS,CAAC,CAACoC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAD,EAAYA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAZ,CAAD,EAAyB,CAACgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAD,EAAoBA,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAApB,CAAzB,CAAb,EACA;CACChM,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA/L,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA;CACD;CACD;;CAED,cAAI/L,GAAG,CAACvC,MAAJ,KAAe,CAAnB,EACA;CACC,gBAAIuC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,MAAcgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAlB,EACA;CACC,kBAAIpO,SAAS,CAAC,CAACoC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAD,EAAYA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAZ,CAAD,EAAyB,CAACgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAD,EAAoBA,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAApB,CAAzB,CAAb,EACA;CACChM,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA/L,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA;CACD;;CAED,gBAAIC,WAAW,CAACvO,MAAZ,KAAuB,CAA3B,EACA;CACC,kBAAIuC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,MAAcgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAlB,EACA;CACC,oBAAIpO,SAAS,CAAC,CAACoC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAD,EAAYA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAZ,CAAD,EAAyB,CAACgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAD,EAAoBA,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAApB,CAAzB,CAAb,EACA;CACChM,kBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA/L,kBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA;CACD;CACD;CACD;CAED;CACJ;CACA;CACA;;;CAEI,cAAI/L,GAAG,CAACvC,MAAJ,KAAe,CAAnB,EACA;CACC,gBAAIuC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,MAAcgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAlB,EACA;CACC,kBAAIpO,SAAS,CAAC,CAACoC,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAD,EAAYA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,CAAZ,CAAD,EAAyB,CAACgM,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAAD,EAAoBA,WAAW,CAAC,CAAD,CAAX,CAAe,CAAf,CAApB,CAAzB,CAAb,EACA;CACChM,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA/L,gBAAAA,GAAG,CAAC,CAAD,CAAH,CAAO,CAAP,KAAa+L,UAAb;CACA;CACD;CACD;CACD;;CAED,eAAO/L,GAAP;CACA,OA3EM,YA2EAoC,IA3EA,EAAP;CA4EA;;;4CAGD;CACC,UAAM6J,aAAa,GAAG,KAAKrH,0BAAL,EAAtB;CACA,UAAMC,iBAAiB,GAAGvF,MAAM,CAAC4M,kBAAP,CAA0BD,aAA1B,CAA1B;;CAEA,UAAIpH,iBAAiB,IAAIA,iBAAiB,KAAK,IAA/C,EACA;CACC,eAAOA,iBAAP;CACA;;CAED,aAAO,IAAP;CACA;;;4CAEsBtF,OACvB;CACC,UAAM4M,YAAY,GAAG,KAAKC,eAAL,EAArB;CACA,UAAMC,YAAY,GAAG,EAArB;CAEA,aACE9M,KAAK,CAACgF,CAAN,GAAU4H,YAAY,CAAC1N,IAAvB,IAA+Bc,KAAK,CAACgF,CAAN,GAAU4H,YAAY,CAACnN,KAAvD,IACIO,KAAK,CAACiF,CAAN,GAAU2H,YAAY,CAACzN,GAAvB,IAA8Ba,KAAK,CAACiF,CAAN,GAAW2H,YAAY,CAAClN,MAAb,GAAsBoN,YAFpE;CAIA;;;iCAGD;CACC/M,MAAAA,MAAM,CAACgN,SAAP,CAAiB,IAAjB;CACA;;;+BAGD;CACC,aAAO,KAAKnJ,IAAZ;CACA;;;gDApRD;CACC7D,MAAAA,MAAM,CAACqJ,gBAAP;CACA;;;GAl1BkCvD,eAAK,CAACmH;;6BAArBjN,qBAEc;6BAFdA,iBAGiC;6BAHjCA,iCAkJW;;CC3JjB,SAASkN,oBAAT,CAA8BrH,KAA9B,EACf;CACC,MAAMsH,UAAU,GAAGtH,KAAK,CAAChC,IAAN,CAAWxC,IAAX,CAAgBwC,IAAhB,CAAqBoC,MAAxC;CACA,MAAMmH,QAAQ,GAAGvH,KAAK,CAAChC,IAAN,CAAWlC,EAAX,CAAckC,IAAd,CAAmBoC,MAApC;CACA,MAAMoH,QAAQ,GAAGF,UAAU,CAACG,OAAX,EAAjB;CACA,MAAMC,MAAM,GAAGH,QAAQ,CAACE,OAAT,EAAf;CAEA,SAAOE,MAAM,CAACH,QAAQ,CAAC5C,QAAT,CAAkBzC,EAAnB,CAAN,KAAiCwF,MAAM,CAACD,MAAM,CAAC9C,QAAP,CAAgBzC,EAAjB,CAA9C;CACA;;CCPc,SAASyF,WAAT,CAAqB5H,KAArB,EACf;CACC,MAAMsH,UAAU,GAAGtH,KAAK,CAAChC,IAAN,CAAWxC,IAAX,CAAgBwC,IAAhB,CAAqBoC,MAAxC;CACA,MAAMmH,QAAQ,GAAGvH,KAAK,CAAChC,IAAN,CAAWlC,EAAX,CAAckC,IAAd,CAAmBoC,MAApC;CAEA,SAAO,+BAAIjG,MAAM,CAACkB,WAAP,EAAJ,EAA0BkH,IAA1B,CAA+B,UAAChH,IAAD,EAAU;CAC/C,WAAOA,IAAI,CAACC,IAAL,KAAc+L,QAAQ,CAAChN,MAAvB,IAAiCgB,IAAI,CAACO,EAAL,KAAYwL,UAAU,CAAC/M,MAA/D;CACA,GAFM,CAAP;CAGA;;;;KCJoBsN;;;CAEpB,kBAAYnK,OAAZ,EACA;CAAA;;CAAA;CACC,wGAAMA,OAAN;CAEA,UAAKoK,WAAL,GAAmB,MAAKC,OAAL,EAAnB;CAEA,UAAKxN,MAAL,GAAc,IAAIJ,MAAJ,CAAW;CACxBwB,MAAAA,UAAU,EAAE,MAAKqM,MAAL,EADY;CAExBpM,MAAAA,QAAQ,EAAE,MAAKqM,SAAL,EAFc;CAGxB7N,MAAAA,KAAK,EAAE,MAAK4N,MAAL,EAHiB;CAIxBnK,MAAAA,SAAS,EAAE,MAAK4J,OAAL,GAAeS,YAJF;CAKxBpK,MAAAA,mBAAmB,EAAE;CAAA,eAAM,MAAKkI,sBAAL,EAAN;CAAA,OALG;CAMxBjI,MAAAA,IAAI,YAAK,MAAK0J,OAAL,GAAeU,YAApB,eAAqC,MAAKJ,OAAL,EAArC,MANoB;CAOxB/J,MAAAA,IAAI,EAAE;CACLoC,QAAAA,MAAM;CADD;CAPkB,KAAX,CAAd;;CAYA,UAAK7F,MAAL,CACE6N,SADF,CACY,kBADZ,EACgC,MAAKC,iBAAL,CAAuBhK,IAAvB,2CADhC,EAEE+J,SAFF,CAEY,0BAFZ,EAEwC,MAAKE,gBAAL,CAAsBjK,IAAtB,2CAFxC,EAGE+J,SAHF,CAGY,yBAHZ,EAGuC,MAAKG,eAAL,CAAqBlK,IAArB,2CAHvC,EAIE+J,SAJF,CAIY,gBAJZ,EAI8B,MAAKI,eAAL,CAAqBnK,IAArB,2CAJ9B,EAKE+J,SALF,CAKY,iBALZ,EAK+B,MAAKK,gBAAL,CAAsBpK,IAAtB,2CAL/B,EAME+J,SANF,CAMY,qBANZ,EAMmC,MAAKM,oBAAL,CAA0BrK,IAA1B,2CANnC,EAOE+J,SAPF,CAOY,eAPZ,EAO6B,MAAKO,cAAL,CAAoBtK,IAApB,2CAP7B,EAQE+J,SARF,CAQY,mBARZ,EAQiC,MAAKQ,kBAAL,CAAwBvK,IAAxB,2CARjC,EASE+J,SATF,CASY,uBATZ,EASqC,MAAKS,gBAAL,CAAsBxK,IAAtB,2CATrC,EAUE+J,SAVF,CAUY,0BAVZ,EAUwC,MAAKU,mBAAL,CAAyBzK,IAAzB,2CAVxC,EAWE+J,SAXF,CAWY,iBAXZ,EAW+B,MAAKW,UAAL,CAAgB1K,IAAhB,2CAX/B,EAYE+J,SAZF,CAYY,eAZZ,EAY6B,MAAKY,cAAL,CAAoB3K,IAApB,2CAZ7B,EAaE+J,SAbF,CAaY,mBAbZ,EAaiC,MAAKa,kBAAL,CAAwB5K,IAAxB,2CAbjC,EAcE+J,SAdF,CAcY,cAdZ,EAc4B,MAAKc,aAAL,CAAmB7K,IAAnB,2CAd5B;;CAiBA,UAAK8K,iBAAL,GAAyB,MAAKA,iBAAL,CAAuB9K,IAAvB,2CAAzB;CACA,UAAK+K,eAAL,GAAuB,MAAKA,eAAL,CAAqB/K,IAArB,2CAAvB;CAnCD;CAoCC;;;;iDAE2BgL,cAC5B;CACC,aAAO,CACN,OADM,EAEN,WAFM,EAGN,WAHM,EAIN,WAJM,EAKL/N,QALK,CAKI+N,YALJ,CAAP;CAMA;;;uCAEiBrJ,OAClB;CACC,UACCA,KAAK,CAACsJ,UAAN,KAAqB,KAAKC,YAAL,EAArB,IACG,KAAKC,2BAAL,CAAiCxJ,KAAK,CAACqJ,YAAvC,CAFJ,EAIA;CACCI,QAAAA,aAAa,CAAC,KAAKC,UAAN,CAAb;CACA,aAAKA,UAAL,GAAkBC,WAAW,CAACxP,MAAM,CAACyP,WAAR,EAAqB,EAArB,CAA7B;CACA;CACD;;;qCAEe5J,OAChB;CACC,UACCA,KAAK,CAACsJ,UAAN,KAAqB,KAAKC,YAAL,EAArB,IACG,KAAKC,2BAAL,CAAiCxJ,KAAK,CAACqJ,YAAvC,CAFJ,EAIA;CACCI,QAAAA,aAAa,CAAC,KAAKC,UAAN,CAAb;CACA,aAAKA,UAAL,GAAkB,IAAlB;CACA;CACD;;;gCAEUhM,SACX;CACC,qGAAiBA,OAAjB;;CAEA,UAAItF,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAa6L,MAA7B,CAAJ,EACA;CACC,aAAKC,aAAL,GAAqBpM,OAAO,CAACM,IAAR,CAAa6L,MAAlC;CACA;;CAED,UAAIzR,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAa6K,gBAA7B,CAAJ,EACA;CACC,aAAKkB,uBAAL,GAA+BrM,OAAO,CAACM,IAAR,CAAa6K,gBAA5C;CACA;;CAED,UAAIzQ,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAa8K,mBAA7B,CAAJ,EACA;CACC,aAAKA,mBAAL,GAA2BpL,OAAO,CAACM,IAAR,CAAa8K,mBAAxC;CACA;;CAED,UAAI1Q,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAa+K,UAA7B,CAAJ,EACA;CACC,aAAKiB,iBAAL,GAAyBtM,OAAO,CAACM,IAAR,CAAa+K,UAAtC;CACA;;CAED,UAAI3Q,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAaiM,YAA7B,CAAJ,EACA;CACC,aAAKC,mBAAL,GAA2BxM,OAAO,CAACM,IAAR,CAAaiM,YAAxC;CACA;;CAED,UAAI7R,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAamM,aAA7B,CAAJ,EACA;CACC,aAAKC,oBAAL,GAA4B1M,OAAO,CAACM,IAAR,CAAamM,aAAzC;CACA;;CAED,UAAI/R,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAaqM,WAA7B,CAAJ,EACA;CACC,aAAKC,kBAAL,GAA0B5M,OAAO,CAACM,IAAR,CAAaqM,WAAvC;CACA;;CAED,UAAIjS,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAauM,QAA7B,CAAJ,EACA;CACC,aAAKC,eAAL,GAAuB9M,OAAO,CAACM,IAAR,CAAauM,QAApC;CACA;;CAED,UAAInS,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAayM,QAA7B,CAAJ,EACA;CACC,aAAKC,eAAL,GAAuBhN,OAAO,CAACM,IAAR,CAAayM,QAApC;CACA;;CAED,UAAIrS,cAAI,CAAC2N,UAAL,CAAgBrI,OAAO,CAACM,IAAR,CAAa2M,OAA7B,CAAJ,EACA;CACC,aAAKC,cAAL,GAAsBlN,OAAO,CAACM,IAAR,CAAa2M,OAAnC;CACA;;CAED,UAAI,KAAKpQ,MAAT,EACA;CACC,aAAKA,MAAL,CAAYsD,SAAZ,GAAwB,KAAK4J,OAAL,GAAeS,YAAvC;;CACA,YAAI9P,cAAI,CAAC2N,UAAL,CAAgB,KAAKxL,MAAL,CAAYoE,KAAZ,CAAkBkM,KAAlC,CAAJ,EACA;CACC,eAAKtQ,MAAL,CAAYoE,KAAZ,CAAkBkM,KAAlB;CACA;CACD;CACD;;;mCAEa7K,OACd;CACC,WAAK4K,cAAL,CAAoB5K,KAAK,CAAChC,IAA1B;CACA;;;gCAEUgC,OACX;CACC,WAAKgK,iBAAL,CAAuBhK,KAAK,CAAChC,IAA7B;CACA;;;sCAEgBgC,OACjB;CACC,WAAK8J,aAAL,CAAmB9J,KAAK,CAAChC,IAAzB;CACA,WAAK8M,WAAL;CACA;;;4CAGD;CACC,WAAKC,eAAL;CACA;;;0CAGD;CACC,WAAKA,eAAL;CACA;;;sCAEgB/K,OACjB;CACC,WAAK+J,uBAAL,CAA6B/J,KAAK,CAAChC,IAAnC;CACA;;;sCAGD;CACC,WAAK8M,WAAL;CACA;;;8CAGD;CAAA,kCAKK,KAAKrD,OAAL,GAAeuD,YALpB;CAAA,UAEEC,mBAFF,yBAEEA,mBAFF;CAAA,UAGEC,kBAHF,yBAGEA,kBAHF;CAAA,UAIEC,eAJF,yBAIEA,eAJF;CAOC,UAAMC,YAAY,GAAGH,mBAAmB,CAAClM,qBAApB,EAArB;CACA,UAAMsM,WAAW,GAAGH,kBAAkB,CAACnM,qBAAnB,EAApB;CACA,UAAMuM,QAAQ,GAAGH,eAAe,CAACpM,qBAAhB,EAAjB;CAEA,UAAMwM,MAAM,GAAG,EAAf;CAEA,aAAO,CACNH,YAAY,CAAC9R,IAAb,GAAoBiS,MADd,EAENF,WAAW,CAAC/R,IAAZ,GAAmBiS,MAFb,EAGNF,WAAW,CAAC/R,IAAZ,GAAmBiS,MAHb,EAINF,WAAW,CAACxR,KAAZ,GAAoB0R,MAJd,EAKNF,WAAW,CAACxR,KAAZ,GAAoB0R,MALd,EAMND,QAAQ,CAACzR,KAAT,GAAkB0R,MAAM,GAAG,CANrB,CAAP;CAQA;;;yCAGD;CACC,WAAKT,WAAL;CACA;;;sCAEgB9K,OACjB;CACC,UAAIqH,oBAAoB,CAACrH,KAAD,CAApB,IAA+B4H,WAAW,CAAC5H,KAAD,CAA9C,EACA;CACCA,QAAAA,KAAK,CAACwL,cAAN;CACA,aAAKC,WAAL;CACA;CACA;;CAED,WAAKC,QAAL;CACA,WAAKC,YAAL;CACA;;;uCAGD;CACC,WAAKD,QAAL;CACA,WAAKE,cAAL;CACA;;;qCAEe5L,OAChB;CACC,UAAI,CAAC,KAAKzF,MAAL,CAAYuJ,QAAZ,EAAL,EACA;CACC,aAAK+H,aAAL;CACA;;CAED,UAAI7L,KAAK,CAAChC,IAAN,CAAWxC,IAAX,IAAmBwE,KAAK,CAAChC,IAAN,CAAWlC,EAAlC,EACA;CACC,YAAIuL,oBAAoB,CAACrH,KAAD,CAApB,IAA+B4H,WAAW,CAAC5H,KAAD,CAA9C,EACA;CACCA,UAAAA,KAAK,CAACwL,cAAN;CACA;CACD;CACD;;;sCAGD;CACC,WAAKK,aAAL;CACA,WAAKC,iBAAL;CACA;;;0CAGD;CACC,WAAKA,iBAAL;CACA;;;mCAGD;CACCrQ,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKsM,MAAL,EAAb,EAA4B,iCAA5B;CACA;;;qCAGD;CACCvM,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKuL,MAAL,EAAhB,EAA+B,iCAA/B;CACA;;;uCAGD;CACCvM,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKsM,MAAL,EAAb,EAA4B,sCAA5B;CACA;;;yCAGD;CACCvM,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKuL,MAAL,EAAhB,EAA+B,sCAA/B;CACA;;;oCAGD;CACCvM,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKsM,MAAL,EAAb,EAA4B,oCAA5B;CACA;;;sCAGD;CACCvM,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKuL,MAAL,EAAhB,EAA+B,oCAA/B;CACA;;;gCAGD;CACCvM,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKuL,MAAL,EAAhB,EAA+B,mCAA/B;CACA;;;mCAGD;CACCvM,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKsM,MAAL,EAAb,EAA4B,mCAA5B;CACA;;;+BAGD;CACC,aAAOjQ,UAAU,EAAjB;CACA;;;8BAGD;CACC,UAAI,CAACK,cAAI,CAAC2T,SAAL,CAAe,KAAKC,GAApB,CAAL,EACA;CACC,YAAMC,KAAK,GAAG1L,aAAG,CAACC,UAAJ,CAAe,kBAAf,CAAd;CACA,aAAKwL,GAAL,GAAWhU,aAAG,CAACC,MAAf,qSAAqEgU,KAArE;CAIA;;CAED,aAAO,KAAKD,GAAZ;CACA;;;iCAGD;CACC,UAAME,MAAM,gGAAZ;;CAEA,UAAI,CAAC,KAAKC,YAAV,EACA;CACC,aAAKA,YAAL,GAAoB,IAApB;CAEA,YAAMH,GAAG,GAAG,KAAKhE,MAAL,EAAZ;CAEA/H,QAAAA,eAAK,CAAC5B,IAAN,CAAW2N,GAAX,EAAgB,WAAhB,EAA6B,UAAChM,KAAD;CAAA,iBAAWA,KAAK,CAACoM,eAAN,EAAX;CAAA,SAA7B;CACAnM,QAAAA,eAAK,CAAC5B,IAAN,CAAW2N,GAAX,EAAgB,SAAhB,EAA2B,UAAChM,KAAD;CAAA,iBAAWA,KAAK,CAACoM,eAAN,EAAX;CAAA,SAA3B;CACAnM,QAAAA,eAAK,CAAC5B,IAAN,CAAW2N,GAAX,EAAgB,WAAhB,EAA6B,UAAChM,KAAD;CAAA,iBAAWA,KAAK,CAACoM,eAAN,EAAX;CAAA,SAA7B;CAEA3Q,QAAAA,aAAG,CAAC0C,MAAJ,CAAW6N,GAAX,EAAgBE,MAAhB;CACA;;CAEDlU,MAAAA,aAAG,CAACqU,KAAJ,CAAUH,MAAV,mHACU,KAAKnE,OAAL,EADV;CAIA,aAAOmE,MAAP;CACA;;;mCAGD;CACC,aAAOnU,UAAU,EAAjB;CACA;;;oCAGD;CACC,UAAM8F,SAAS,mGAAf;CACApC,MAAAA,aAAG,CAACC,QAAJ,CAAamC,SAAb,EAAwB,sBAAxB;CAEAoC,MAAAA,eAAK,CAAC5B,IAAN,CAAWR,SAAX,EAAsB,iBAAtB,EAAyC,KAAKsL,iBAA9C;CACAlJ,MAAAA,eAAK,CAAC5B,IAAN,CAAWR,SAAX,EAAsB,eAAtB,EAAuC,KAAKuL,eAA5C;CACA,aAAOvL,SAAP;CACA;;;oCAGD;CACC,WAAKyO,MAAL,CAAYC,KAAZ,GAAoBxU,UAAU,EAA9B;CACA,aAAO,KAAKuU,MAAL,CAAYC,KAAnB;CACA;;;uCAEiBvM,OAClB;CAAA;;CACC,4GAAwBA,KAAxB;CAEAvC,MAAAA,UAAU,CAAC,YAAM;CAChB,YAAI,MAAI,CAACqK,WAAL,KAAqB,MAAI,CAACC,OAAL,EAAzB,EACA;CACC,UAAA,MAAI,CAACmC,mBAAL,CAAyB,MAAzB;;CACA,UAAA,MAAI,CAACpC,WAAL,GAAmB,MAAI,CAACC,OAAL,EAAnB;CAEA/P,UAAAA,aAAG,CAACqU,KAAJ,CAAU,MAAI,CAACpE,SAAL,EAAV,2HACU,MAAI,CAACF,OAAL,EADV;CAGA;CACD,OAVS,EAUP,GAVO,CAAV;CAWA;;;qCAEeyE,OAChB;CACC,0GAAsBA,KAAtB;CACA,WAAKpC,oBAAL,CAA0B,IAA1B;CACA;;;gDAE0BpK,OAC3B;CACC,WAAKsK,kBAAL,CAAwB,IAAxB;CACA;;;6CAEuBtK,OACxB;CACC,WAAKyM,gBAAL,GAAwBC,UAAxB,CAAmCnM,aAAG,CAACC,UAAJ,CAAe,kCAAf,CAAnC;CACA,kHAA8BR,KAA9B;CACA;;;gDAE0B;CAAA;;CAC1B;CAEA,UAAMA,KAAK,GAAG,IAAIC,eAAK,CAACC,SAAV,CAAoB;CACjClC,QAAAA,IAAI,EAAE;CACLoC,UAAAA,MAAM,EAAE,IADH;CAELuM,UAAAA,SAAS,EAAE,qBAAM;CAChBxS,YAAAA,MAAM,CAACkB,WAAP,GACEX,OADF,CACU,UAACM,IAAD,EAAU;CAClB,kBAAI2M,MAAM,CAAC3M,IAAI,CAACc,EAAL,CAAQkC,IAAR,CAAaoC,MAAb,CAAoB+B,EAArB,CAAN,KAAmCwF,MAAM,CAAC,MAAI,CAACxF,EAAN,CAA7C,EACA;CACCnH,gBAAAA,IAAI,CAACQ,IAAL,CAAUuG,UAAV,CAAqB/G,IAArB;CACA;;CAED,kBAAI2M,MAAM,CAAC3M,IAAI,CAACQ,IAAL,CAAUwC,IAAV,CAAeoC,MAAf,CAAsB+B,EAAvB,CAAN,KAAqCwF,MAAM,CAAC,MAAI,CAACxF,EAAN,CAA/C,EACA;CACCnH,gBAAAA,IAAI,CAACQ,IAAL,CAAUuG,UAAV,CAAqB/G,IAArB;CACA;CACD,aAXF;CAaA;CACAyC,YAAAA,UAAU,CAAC,YAAM;CAChBtD,cAAAA,MAAM,CAACwC,cAAP;CACAxC,cAAAA,MAAM,CAACyS,eAAP;CACA,aAHS,CAAV;CAIA,WArBI;CAsBLC,UAAAA,QAAQ,EAAE,oBAAM;CACf,YAAA,MAAI,CAACJ,gBAAL,GAAwBlL,KAAxB;CACA;CAxBI;CAD2B,OAApB,CAAd;CA6BA,WAAKiJ,eAAL,CAAqBxK,KAArB;CACA;;;wCAGD;CACC;CACA;;;qCAGD;CACC,UAAMiM,KAAK,GAAGa,EAAE,CAACC,IAAH,CAAQC,IAAR,CAAa,KAAKC,eAAL,GAAuB9U,KAApC,CAAd;CACA,UAAM+U,YAAY,GAAG,KAAKA,YAA1B;CACA,UAAIC,YAAY,GAAG,KAAnB;;CACA,UAAIlB,KAAK,CAAC3T,MAAN,GAAe,CAAf,IAAoB,KAAKyP,OAAL,OAAmBkE,KAA3C,EACA;CACCkB,QAAAA,YAAY,GAAG,IAAf;CACA;;CAED;;CAEA,UAAIA,YAAY,IAAID,YAApB,EACA;CACC,aAAKxC,eAAL,CAAqB,IAArB;CACA;;CAEDvQ,MAAAA,MAAM,CAACyP,WAAP;CACA;;;kCAEYxK,GAAGC,GAChB;CACC,uGAAmBD,CAAnB,EAAsBC,CAAtB;CACAlF,MAAAA,MAAM,CAACyP,WAAP;CACA;;;qCAGD;CACC;CAEArM,MAAAA,YAAY,CAAC,KAAK6P,sBAAN,CAAZ;CACA,WAAKA,sBAAL,GAA8B3P,UAAU,CAAC,YAAM;CAC9CtD,QAAAA,MAAM,CAACyP,WAAP;CACA,OAFuC,EAErC,GAFqC,CAAxC;CAGA;;;GA9ckCyD,kBAAM,CAACxF;;KCFtByF;;;;;;;;;;;;;;;uFAEV,IAAIrN,eAAK,CAACmH,YAAV;;;;;;oCAEK;;;oCACA;;;oCAGf;CACC,aAAOrP,UAAU,EAAjB;CACA;;;uCAGD;CACC,UAAMwV,IAAI,oGAAV;CACA9R,MAAAA,aAAG,CAACC,QAAJ,CAAa6R,IAAI,CAAChE,YAAL,EAAb,EAAkC,oBAAlC;CACA,aAAOgE,IAAP;CACA;;;wCAGD;CACC,UAAM1P,SAAS,qGAAf;CACApC,MAAAA,aAAG,CAACC,QAAJ,CAAamC,SAAb,EAAwB,oBAAxB;CACA,aAAOA,SAAP;CACA;;;yCAGD;CACC,UAAMA,SAAS,sGAAf;CACApC,MAAAA,aAAG,CAACC,QAAJ,CAAamC,SAAb,EAAwB,qBAAxB;CACA,aAAOA,SAAP;CACA;;;yCAGD;CACC,UAAMA,SAAS,sGAAf;CACApC,MAAAA,aAAG,CAACC,QAAJ,CAAamC,SAAb,EAAwB,eAAxB;CACA,aAAOA,SAAP;CACA;;;kCAGD;CACC,aAAO9F,UAAU,EAAjB;CACA;;;mCAGD;CACC,aAAOA,UAAU,EAAjB;CACA;;;uCAEiBqI,QAClB;CACC,0GAAwBA,MAAxB;CACAjG,MAAAA,MAAM,CAACyP,WAAP;CACA;;;sCAEgBxJ,QACjB;CACC,yGAAuBA,MAAvB;CACA,WAAKoN,OAAL,CAAajO,IAAb,CAAkB,0BAAlB;CAEA9B,MAAAA,UAAU,CAAC,YAAM;CAChBtD,QAAAA,MAAM,CAACyP,WAAP;CACA,OAFS,CAAV;CAIA,WAAK6D,UAAL,GAAkB/S,OAAlB,CAA0B,UAAC0F,MAAD,EAAY;CACrCqJ,QAAAA,aAAa,CAACrJ,MAAM,CAACsJ,UAAR,CAAb;CACA,OAFD;CAGA;;;kCAE2B;CAC3B,WAAKgE,YAAL,CAAkBC,IAAlB,CAAuB,UAACC,CAAD,EAAIC,CAAJ,EAAU;CAChC,YAAID,CAAC,CAACrE,YAAF,GAAiBrN,UAArB,EACA;CACC,cAAM4R,MAAM,GAAG,+BAAIF,CAAC,CAACrE,YAAF,GAAiBrN,UAAjB,CAA4B6R,QAAhC,EAA0CC,OAA1C,CAAkDJ,CAAC,CAACrE,YAAF,EAAlD,CAAf;CACA,cAAM0E,MAAM,GAAG,+BAAIJ,CAAC,CAACtE,YAAF,GAAiBrN,UAAjB,CAA4B6R,QAAhC,EAA0CC,OAA1C,CAAkDH,CAAC,CAACtE,YAAF,EAAlD,CAAf;CAEA,iBAAOuE,MAAM,GAAGG,MAAT,GAAkB,CAAlB,GAAsB,CAAC,CAA9B;CACA;CACD,OARD;CAUA,aAAO,KAAKP,YAAZ;CACA;;;GAlFgCL,kBAAM,CAACC;;;KCG5BY,QAAb;CAAA;CAAA;CAAA;CAAA,+BAImBxQ,OAJnB,EAUC;CACC,aAAO,IAAI4P,IAAJ,CAAS;CACfa,QAAAA,QAAQ,EAAEzQ,OAAO,CAACyQ,QADH;CAEfC,QAAAA,aAAa,EAAE1Q,OAAO,CAAC2Q,QAAR,KAAqB,IAFrB;CAGfC,QAAAA,eAAe,EAAE5Q,OAAO,CAAC2Q,QAAR,KAAqB,IAHvB;CAIfE,QAAAA,YAAY,EAAE7Q,OAAO,CAAC2Q,QAAR,KAAqB,IAJpB;CAKfG,QAAAA,aAAa,EAAE9Q,OAAO,CAAC2Q,QAAR,KAAqB,IALrB;CAMfI,QAAAA,UAAU,EAAE/Q,OAAO,CAAC+Q,UAAR,IAAsB,mCANnB;CAOfC,QAAAA,YAAY,EAAE,qCAPC;CAQfC,QAAAA,OAAO,EAAEjR,OAAO,CAACiR;CARF,OAAT,CAAP;CAUA;CArBF;;CAuBC,oBAAYjR,OAAZ,EACA;CAAA;;CAAA;CACC;CAEAwQ,IAAAA,QAAQ,CAAC7T,SAAT,CAAmBoE,IAAnB;CACA,UAAK0P,QAAL,GAAgBzQ,OAAO,CAACyQ,QAAxB;CACA,UAAKjG,YAAL,GAAoBxK,OAAO,CAACwK,YAA5B;CACA,UAAK/F,EAAL,GAAUzE,OAAO,CAACyE,EAAlB;CACA,UAAKpE,IAAL,GAAYL,OAAO,CAACK,IAApB;CACA,UAAK6Q,MAAL,GAAclR,OAAO,CAACkR,MAAtB;CACA,UAAKjB,IAAL,GAAYkB,MAAM,CAACC,QAAP,CAAgBpR,OAAO,CAACiQ,IAAxB,CAAZ;CACA,UAAKoB,OAAL,GAAeC,OAAO,CAACtR,OAAO,CAACqR,OAAT,CAAtB;CACA,UAAKE,eAAL,GAAuBJ,MAAM,CAACnR,OAAO,CAACuR,eAAT,CAA7B;CACA,UAAKC,iBAAL,GAAyBxR,OAAO,CAACwR,iBAAjC;CACA,UAAKC,MAAL,GAAczR,OAAO,CAACyR,MAAtB;CACA,UAAKC,kBAAL,GAA0B1R,OAAO,CAAC0R,kBAAR,CAA2BzM,OAA3B,CAAmC,YAAnC,EAAiD,MAAKR,EAAtD,CAA1B;CACA,UAAKkN,qBAAL,GAA6B3R,OAAO,CAAC2R,qBAArC;CACA,UAAKC,kBAAL,GAA0B5R,OAAO,CAAC4R,kBAAR,CAA2B3M,OAA3B,CAAmC,YAAnC,EAAiD,MAAKR,EAAtD,CAA1B;CACA,UAAKxD,KAAL,GAAa,IAAIhB,eAAK,CAACC,WAAV,EAAb;CACA,UAAK2R,MAAL,GAAc,KAAd;CACA,UAAKC,UAAL,GAAkBR,OAAO,CAACtR,OAAO,CAAC8R,UAAT,CAAzB;CACA,UAAKnP,cAAL,GAAsB2O,OAAO,CAACtR,OAAO,CAAC2C,cAAT,CAA7B;CACA,UAAKoP,oBAAL,GAA4B/R,OAAO,CAAC+R,oBAApC;CACA,UAAKC,6BAAL,GAAqChS,OAAO,CAACgS,6BAA7C;CACA,UAAKC,iBAAL,GAAyBjS,OAAO,CAACiS,iBAAjC;CACA,UAAKC,0BAAL,GAAkClS,OAAO,CAACkS,0BAA1C;CACA,UAAKC,iBAAL,GAAyBnS,OAAO,CAACmS,iBAAjC;CACA,UAAKC,mBAAL,GAA2BpS,OAAO,CAACoS,mBAAnC;CACA,UAAKC,eAAL,GAAuBrS,OAAO,CAACqS,eAA/B;;CAEA,QAAI,CAACrS,OAAO,CAACsS,IAAb,EACA;CACC,YAAKC,IAAL;CACA;;CAED,QAAI,MAAKhB,eAAL,GAAuB,CAA3B,EACA;CACC,YAAKiB,qBAAL;CACA;;CAED,QAAMC,UAAU,GAAG,MAAKC,aAAL,EAAnB;;CACAD,IAAAA,UAAU,CAACE,aAAX,GAA2B,MAAKC,WAAL,CAAiBjS,IAAjB,2CAA3B;CACA8R,IAAAA,UAAU,CAACI,QAAX,GAAsB,MAAKC,MAAL,CAAYnS,IAAZ,2CAAtB;CACA8R,IAAAA,UAAU,CAACM,YAAX,GAA0B,MAAKC,UAAL,CAAgBrS,IAAhB,2CAA1B,CA1CD;;CA6CCsS,IAAAA,IAAI,CAACC,cAAL,CAAoBT,UAApB,EAAgC,EAAhC;;CACA,UAAKU,oBAAL;;CAEA,UAAKC,iBAAL,GACEtD,OADF,CAEEpF,SAFF,CAEY,0BAFZ,EAEwC,UAACpI,KAAD,EAAW;CACjD,YAAKT,IAAL,CAAU,sBAAV,EAAkCS,KAAlC;CACA,KAJF,EAKEoI,SALF,CAKY,0BALZ,EAKwC,YAAM;CAC5C3K,MAAAA,UAAU,CAAC,YAAM;CAChB,cAAK8B,IAAL,CAAU,aAAV,EAAyB;CACxBoP,UAAAA,OAAO,EAAE,MAAKoC,aAAL;CADe,SAAzB;CAGA,OAJS,EAIP,GAJO,CAAV;CAKA,KAXF;;CAaA,UAAKC,gBAAL,GACExD,OADF,CAEEpF,SAFF,CAEY,0BAFZ,EAEwC,UAACpI,KAAD,EAAW;CACjD,YAAKT,IAAL,CAAU,sBAAV,EAAkCS,KAAlC;CACA,KAJF,EAKEoI,SALF,CAKY,0BALZ,EAKwC,YAAM;CAC5C3K,MAAAA,UAAU,CAAC,YAAM;CAChB,cAAK8B,IAAL,CAAU,aAAV,EAAyB;CACxBoP,UAAAA,OAAO,EAAE,MAAKoC,aAAL;CADe,SAAzB;CAGA,OAJS,EAIP,GAJO,CAAV;CAKA,KAXF;;CAaA,UAAKE,aAAL,GACEzD,OADF,CAEEpF,SAFF,CAEY,0BAFZ,EAEwC,UAACpI,KAAD,EAAW;CACjD,YAAKT,IAAL,CAAU,sBAAV,EAAkCS,KAAlC;CACA,KAJF,EAKEoI,SALF,CAKY,0BALZ,EAKwC,YAAM;CAC5C3K,MAAAA,UAAU,CAAC,YAAM;CAChB,cAAK8B,IAAL,CAAU,aAAV,EAAyB;CACxBoP,UAAAA,OAAO,EAAE,MAAKoC,aAAL;CADe,SAAzB;CAGA,OAJS,EAIP,GAJO,CAAV;CAKA,KAXF;;CAaA,QAAI,CAAC,MAAKjB,mBAAV,EACA;CACCrU,MAAAA,aAAG,CAACC,QAAJ,CAAa,MAAK6N,YAAL,EAAb,EAAkC,qCAAlC;;CACA,YAAKwH,aAAL,GACErW,OADF,CACU,UAAC0F,MAAD,EAAY;CACpBA,QAAAA,MAAM,CAAC7F,MAAP,CAAc2W,OAAd;CACA,OAHF;CAIA;;CACD,QAAI,CAAC,MAAKnB,eAAV,EACA;CACCtU,MAAAA,aAAG,CAACC,QAAJ,CAAa,MAAK6N,YAAL,EAAb,EAAkC,6BAAlC;CACA;;CACD,QAAI,CAAC,MAAKsG,iBAAV,EACA;CACCpU,MAAAA,aAAG,CAACC,QAAJ,CAAa,MAAK6N,YAAL,EAAb,EAAkC,oCAAlC;CACA;;CAtGF;CAuGC;;CA/HF;CAAA;CAAA,iCAkIC;CACC,UAAI,CAAC,KAAKuG,mBAAV,EACA;CACC,eAAO,KAAP;CACA;;CACD,aAAO,KAAKiB,aAAL,GACLxO,IADK,CACA,UAAAnC,MAAM;CAAA,eAAIA,MAAM,CAAC7F,MAAP,CAAcO,KAAd,CAAoB2I,IAApB,GAA2B,CAA/B;CAAA,OADN,CAAP;CAEA;CAzIF;CAAA;CAAA,kCA4IC;CAAA;;CACC,aAAO,KAAK9E,KAAL,CAAWC,QAAX,CAAoB,UAApB,EAAgC,YAAM;CAC5C,YAAMuS,QAAQ,GAAGC,aAAG,CAAC,MAAI,CAAC7H,YAAL,EAAD,CAApB;CACA4H,QAAAA,QAAQ,CAACE,MAAT,GAAkBF,QAAQ,CAAC5X,GAAT,GAAe4X,QAAQ,CAAC1X,MAAT,GAAkB,CAAnD;CAEA,eAAO0X,QAAP;CACA,OALM,CAAP;CAMA;CAnJF;CAAA;CAAA,+BAsJC;CAAA;;CACC,aAAO,+BAAI,KAAK5H,YAAL,GAAoBrN,UAApB,CAA+BoV,gBAA/B,CAAgD,kBAAhD,CAAJ,EACLC,SADK,CACK,UAAAhW,IAAI;CAAA,eAAIA,IAAI,KAAK,MAAI,CAACgO,YAAL,EAAb;CAAA,OADT,CAAP;CAEA;CAzJF;CAAA;CAAA,6CA4JC;CAAA;;CACC,aAAO2E,QAAQ,CAAC7T,SAAT,CAAmBC,IAAnB,CAAwB,UAACsK,QAAD,EAAW5H,KAAX;CAAA,eAAqBA,KAAK,GAAG,MAAI,CAACwU,QAAL,EAA7B;CAAA,OAAxB,KAAyE,IAAhF;CACA;CAED;;CAhKD;CAAA;CAAA,kCAkKC;CACC/V,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAK6N,YAAL,EAAb,EAAkC,sBAAlC;CACApP,MAAAA,MAAM,CAACwC,cAAP,GAFD;;CAKC,WAAK8U,UAAL,GAAkBd,IAAI,CAACe,OAAL,GAAe,KAAKC,WAAL,GAAmBpY,GAApD;CACA,WAAKqY,SAAL,GAAiB,KAAKJ,QAAL,EAAjB;CACA,WAAKK,kBAAL,GAA0B,KAAKA,kBAAL,IAA2B,IAArD;CACA;CAED;;CA5KD;CAAA;CAAA,2BA6KQzS,CA7KR,EA6KWC,CA7KX,EA8KC;CAAA;;CACCrH,MAAAA,aAAG,CAACmF,KAAJ,CAAU,KAAKoM,YAAL,EAAV,8IAC+BlK,CAAC,GAAG,KAAKoS,UAAT,GAAsB,KAAKE,WAAL,GAAmBpY,GADxE;CAIA,UAAMuY,cAAc,GAAG,KAAKH,WAAL,GAAmBlY,MAA1C;CAEAyU,MAAAA,QAAQ,CAAC7T,SAAT,CAAmBK,OAAnB,CAA2B,UAACkK,QAAD,EAAWmN,QAAX,EAAwB;CAClD,YACCnN,QAAQ,KAAK,MAAb,IACGnJ,aAAG,CAAC+J,QAAJ,CAAaZ,QAAQ,CAAC2E,YAAT,EAAb,EAAsC,sBAAtC,CAFJ,EAIA;CACC;CACA;;CAED,YAAMyI,iBAAiB,GAAGpN,QAAQ,CAAC2E,YAAT,EAA1B;CACA,YAAM0I,gBAAgB,GAAGrN,QAAQ,CAAC+M,WAAT,EAAzB;CACA,YAAMO,cAAc,GAAGD,gBAAgB,CAACZ,MAAxC;;CAEA,YACChS,CAAC,GAAG6S,cAAJ,IACGH,QAAQ,GAAG,MAAI,CAACH,SADnB,IAEGI,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,gCAA2D,CAACL,cAA5D,aAHJ,EAKA;CACC9Z,UAAAA,aAAG,CAACmF,KAAJ,CAAU6U,iBAAV,sLAEgC,CAACF,cAFjC;CAKA,UAAA,MAAI,CAACD,kBAAL,GAA0BjN,QAAQ,CAACwN,sBAAT,EAA1B;CAEAxN,UAAAA,QAAQ,CAACjG,KAAT,CAAe9B,MAAf,CAAsB,UAAtB;CACA;;CAED,YACCwC,CAAC,GAAG6S,cAAJ,IACGH,QAAQ,GAAG,MAAI,CAACH,SADnB,IAEGI,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,gCAA0DL,cAA1D,aAHJ,EAKA;CACC9Z,UAAAA,aAAG,CAACmF,KAAJ,CAAU6U,iBAAV,sLAEgCF,cAFhC;CAKA,UAAA,MAAI,CAACD,kBAAL,GAA0BjN,QAA1B;CAEAA,UAAAA,QAAQ,CAACjG,KAAT,CAAe9B,MAAf,CAAsB,UAAtB;CACA;;CAED,YAAMwV,WAAW,GAChBhT,CAAC,GAAG6S,cAAJ,IACGH,QAAQ,GAAG,MAAI,CAACH,SADnB,IAEGI,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,KAAsC,EAFzC,IAGGH,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,KAAsC,sBAJ1C;CAOA,YAAMG,cAAc,GACnBjT,CAAC,GAAG6S,cAAJ,IACGH,QAAQ,GAAG,MAAI,CAACH,SADnB,IAEGI,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,KAAsC,EAFzC,IAGGH,iBAAiB,CAAC7U,KAAlB,CAAwBgV,SAAxB,KAAsC,sBAJ1C;;CAOA,YAAIG,cAAc,IAAID,WAAtB,EACA;CACCra,UAAAA,aAAG,CAACmF,KAAJ,CAAU6U,iBAAV;CAKA,UAAA,MAAI,CAACH,kBAAL,GAA0BjN,QAA1B;;CAEA,cACC,CAACyN,WAAD,IACG5W,aAAG,CAAC+J,QAAJ,CAAaZ,QAAQ,CAACwN,sBAAT,EAAb,EAAgD,sBAAhD,CAFJ,EAIA;CACC,YAAA,MAAI,CAACP,kBAAL,GAA0BjN,QAAQ,CAACwN,sBAAT,EAA1B;CACA;;CAEDxN,UAAAA,QAAQ,CAACjG,KAAT,CAAe9B,MAAf,CAAsB,UAAtB;CACA;CACD,OA9ED;CA+EA;CAED;;CAtQD;CAAA;CAAA,iCAwQC;CACCpB,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAK8M,YAAL,EAAhB,EAAqC,sBAArC;CAEAgJ,MAAAA,qBAAqB,CAAC,YAAM;CAC3BpY,QAAAA,MAAM,CAACyS,eAAP;CACA,OAFoB,CAArB;CAIAsB,MAAAA,QAAQ,CAAC7T,SAAT,CAAmBK,OAAnB,CAA2B,UAACkK,QAAD,EAAc;CACxC5M,QAAAA,aAAG,CAACmF,KAAJ,CAAUyH,QAAQ,CAAC2E,YAAT,EAAV;CAKA3E,QAAAA,QAAQ,CAACjG,KAAT,CAAe9B,MAAf,CAAsB,UAAtB;CACA,OAPD;;CASA,UAAI,KAAKgV,kBAAT,EACA;CACCpW,QAAAA,aAAG,CAAC+W,YAAJ,CAAiB,KAAKjJ,YAAL,EAAjB,EAAsC,KAAKsI,kBAAL,CAAwBtI,YAAxB,EAAtC;CACA,OAHD,MAKA;CACC9N,QAAAA,aAAG,CAAC0C,MAAJ,CAAW,KAAKoL,YAAL,EAAX,EAAgC,KAAKA,YAAL,GAAoBkJ,aAApD;CACA;;CAED,UAAMC,MAAM,GAAGxE,QAAQ,CAAC7T,SAAT,CAAmByL,GAAnB,CAAuB,UAAAvK,IAAI;CAAA,eAAIA,IAAI,CAACiW,QAAL,EAAJ;CAAA,OAA3B,CAAf;CACAtD,MAAAA,QAAQ,CAAC7T,SAAT,CAAmBsT,IAAnB,CAAwB,UAACC,CAAD,EAAIC,CAAJ;CAAA,eACvBD,CAAC,CAAC4D,QAAF,KAAe3D,CAAC,CAAC2D,QAAF,EAAf,GAA8B,CAA9B,GAAkC,CAAC,CADZ;CAAA,OAAxB;CAGA,UAAMmB,KAAK,GAAGzE,QAAQ,CAAC7T,SAAT,CAAmByL,GAAnB,CAAuB,UAAAvK,IAAI;CAAA,eAAIA,IAAI,CAACiW,QAAL,EAAJ;CAAA,OAA3B,CAAd;;CAEA,UAAIoB,IAAI,CAACC,SAAL,CAAeH,MAAf,MAA2BE,IAAI,CAACC,SAAL,CAAeF,KAAf,CAA/B,EACA;CACC,aAAKpT,IAAL,CAAU,eAAV;CACA;CACD;CA3SF;CAAA;CAAA,mCA8SC;CAAA;;CACC,aAAO,KAAKZ,KAAL,CAAWC,QAAX,CAAoB,WAApB,EAAiC;CAAA,eACvC5G,aAAG,CAACC,MADmC,wxBAEE,MAAI,CAACkK,EAFP,EAIlC,MAAI,CAACiO,aAAL,EAJkC,EAOlC,MAAI,CAAC0C,iBAAL,EAPkC,EAUhC,MAAI,CAACC,aAAL,EAVgC,EAWhC,MAAI,CAACC,iBAAL,EAXgC,EAchC,MAAI,CAACC,gBAAL,EAdgC,EAehC,MAAI,CAACC,oBAAL,EAfgC,EAoBlC,MAAI,CAACC,oBAAL,EApBkC,EAqBlC,MAAI,CAACC,mBAAL,EArBkC,EAsBlC,MAAI,CAACC,gBAAL,EAtBkC;CAAA,OAAjC,CAAP;CA2BA;CA1UF;CAAA;CAAA,wCA6UC;CACC,aAAO,KAAK1U,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC,YAAM;CAClD,YAAM0U,OAAO,GAAG,SAAVA,OAAU,GAAM;CACrB,cAAIC,MAAM,CAACha,GAAP,CAAWuT,EAAX,CAAc0G,MAAlB,EACA;CACCD,YAAAA,MAAM,CAACha,GAAP,CAAWuT,EAAX,CAAc0G,MAAd,CAAqBjP,IAArB,CAA0B,8BAA1B;CACA;CACD,SALD;;CAOA,eAAOvM,aAAG,CAACC,MAAX,+PAGaqb,OAHb,EAIWnQ,cAAI,CAACC,MAAL,CAAY7C,aAAG,CAACC,UAAJ,CAAe,2BAAf,CAAZ,CAJX;CAOA,OAfM,CAAP;CAgBA;CA9VF;CAAA;CAAA,2CAiWC;CACC,aAAO,KAAK7B,KAAL,CAAWC,QAAX,CAAoB,mBAApB,EAAyC,YAAM;CACrD,YAAM0U,OAAO,GAAG,SAAVA,OAAU,GAAM;CACrB,cAAIC,MAAM,CAACha,GAAP,CAAWuT,EAAX,CAAc0G,MAAlB,EACA;CACCD,YAAAA,MAAM,CAACha,GAAP,CAAWuT,EAAX,CAAc0G,MAAd,CAAqBjP,IAArB,CAA0B,8BAA1B;CACA;CACD,SALD;;CAOA,eAAOvM,aAAG,CAACC,MAAX,8PAGaqb,OAHb,EAIWnQ,cAAI,CAACC,MAAL,CAAY7C,aAAG,CAACC,UAAJ,CAAe,8BAAf,CAAZ,CAJX;CAOA,OAfM,CAAP;CAgBA;CAlXF;CAAA;CAAA,2CAqXC;CAAA;;CACC,aAAO,KAAK7B,KAAL,CAAWC,QAAX,CAAoB,mBAApB,EAAyC;CAAA,eAC/C5G,aAAG,CAACC,MAD2C,4ZAKzCsI,aAAG,CAACC,UAAJ,CACD,MAAI,CAACuP,eAAL,GACG,iCADH,GAEG,wBAHF,CALyC,EAY3C,MAAI,CAAC0D,0BAAL,EAZ2C;CAAA,OAAzC,CAAP;CAgBA;CAtYF;CAAA;CAAA,iDAyYC;CACC,aAAO,KAAK9U,KAAL,CAAWC,QAAX,CAAoB,yBAApB,EAA+C;CAAA,eACrD5G,aAAG,CAACC,MADiD;CAAA,OAA/C,CAAP;CAKA;CA/YF;CAAA;CAAA,wCAkZC;CAAA;;CACC,aAAO,KAAK0G,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC;CAAA,eAC5CsP,QAAQ,CAACwF,UAAT,CAAoB;CACnBvF,UAAAA,QAAQ,EAAE,MAAI,CAACsF,0BAAL,EADS;CAEnBpF,UAAAA,QAAQ,EAAE,MAAI,CAAChO,cAFI;CAGnBsO,UAAAA,OAAO,EAAE,MAAI,CAACQ,MAAL,CAAYwE,CAAZ,CAAc7N,GAAd,CAAkB,UAAA8N,KAAK;CAAA,mBAC/B,IAAI/L,MAAJ,CAAW;CACV1F,cAAAA,EAAE,EAAEyR,KAAK,CAACC,SADA;CAEV9V,cAAAA,IAAI,EAAE6V,KAAK,CAACE,IAFF;CAGVtH,cAAAA,KAAK,EAAEoH,KAAK,CAACG,KAAN,CAAYpR,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CAHG;CAIV3E,cAAAA,IAAI,EAAE,MAAI,CAACgW,aAAL,CAAmBJ,KAAnB;CAJI,aAAX,CAD+B;CAAA,WAAvB;CAHU,SAApB,CAD4C;CAAA,OAAtC,CAAP;CAcA;CAjaF;CAAA;CAAA,0CAoaC;CAAA;;CACC,aAAO,KAAKjV,KAAL,CAAWC,QAAX,CAAoB,kBAApB,EAAwC;CAAA,eAC9C5G,aAAG,CAACC,MAD0C,yeAMxC,MAAI,CAAC8X,eAAL,GAAuBxP,aAAG,CAACC,UAAJ,CAAe,6BAAf,CAAvB,GAAuE,EAN/B,EAS1C,MAAI,CAACyT,yBAAL,EAT0C;CAAA,OAAxC,CAAP;CAaA;CAlbF;CAAA;CAAA,gDAqbC;CACC,aAAO,KAAKtV,KAAL,CAAWC,QAAX,CAAoB,wBAApB,EAA8C;CAAA,eACpD5G,aAAG,CAACC,MADgD;CAAA,OAA9C,CAAP;CAKA;CA3bF;CAAA;CAAA,uCA8bC;CAAA;;CACC,aAAO,KAAK0G,KAAL,CAAWC,QAAX,CAAoB,eAApB,EAAqC;CAAA,eAC3CsP,QAAQ,CAACwF,UAAT,CAAoB;CACnBvF,UAAAA,QAAQ,EAAE,OAAI,CAAC8F,yBAAL,EADS;CAEnB5F,UAAAA,QAAQ,EAAE,OAAI,CAAChO,cAFI;CAGnBsO,UAAAA,OAAO,EAAE,OAAI,CAACQ,MAAL,CAAY+E,CAAZ,CAAcpO,GAAd,CAAkB,UAAA8N,KAAK;CAAA,mBAC/B,IAAI/L,MAAJ,CAAW;CACV1F,cAAAA,EAAE,EAAEyR,KAAK,CAACC,SADA;CAEV9V,cAAAA,IAAI,EAAE6V,KAAK,CAACE,IAFF;CAGVtH,cAAAA,KAAK,EAAEoH,KAAK,CAACG,KAAN,CAAYpR,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CAHG;CAIV3E,cAAAA,IAAI,EAAE,OAAI,CAACgW,aAAL,CAAmBJ,KAAnB,CAJI;CAKVO,cAAAA,SAAS,EAAE,KALD;CAMVC,cAAAA,OAAO,EAAE;CANC,aAAX,CAD+B;CAAA,WAAvB;CAHU,SAApB,CAD2C;CAAA,OAArC,CAAP;CAgBA;CA/cF;CAAA;CAAA,uCAkdC;CAAA;;CACC,aAAO,KAAKzV,KAAL,CAAWC,QAAX,CAAoB,eAApB,EAAqC;CAAA,eAC3C5G,aAAG,CAACC,MADuC,meAMrC,OAAI,CAAC8X,eAAL,GAAuBxP,aAAG,CAACC,UAAJ,CAAe,0BAAf,CAAvB,GAAoE,EAN/B,EASvC,OAAI,CAAC6T,sBAAL,EATuC;CAAA,OAArC,CAAP;CAaA;CAheF;CAAA;CAAA,6CAmeC;CACC,aAAO,KAAK1V,KAAL,CAAWC,QAAX,CAAoB,qBAApB,EAA2C;CAAA,eACjD5G,aAAG,CAACC,MAD6C;CAAA,OAA3C,CAAP;CAKA;CAzeF;CAAA;CAAA,oCA4eC;CAAA;;CACC,aAAO,KAAK0G,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC;CAAA,eACxCsP,QAAQ,CAACwF,UAAT,CAAoB;CACnBvF,UAAAA,QAAQ,EAAE,OAAI,CAACkG,sBAAL,EADS;CAEnBhG,UAAAA,QAAQ,EAAE,OAAI,CAAChO,cAFI;CAGnBsO,UAAAA,OAAO,EAAE,OAAI,CAACQ,MAAL,CAAYmF,CAAZ,CAAcxO,GAAd,CAAkB,UAAA8N,KAAK;CAAA,mBAC/B,IAAI/L,MAAJ,CAAW;CACV1F,cAAAA,EAAE,EAAEyR,KAAK,CAACC,SADA;CAEV9V,cAAAA,IAAI,EAAE6V,KAAK,CAACE,IAFF;CAGVtH,cAAAA,KAAK,EAAEoH,KAAK,CAACG,KAAN,CAAYpR,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CAHG;CAIV3E,cAAAA,IAAI,EAAE,OAAI,CAACgW,aAAL,CAAmBJ,KAAnB;CAJI,aAAX,CAD+B;CAAA,WAAvB;CAHU,SAApB,CADwC;CAAA,OAAlC,CAAP;CAcA;CA3fF;CAAA;CAAA,kCA6feA,KA7ff,EA8fC;CAAA;;CACC,aAAO;CACNW,QAAAA,OAAO,EAAEX,KAAK,CAACY,EADT;CAENC,QAAAA,QAAQ,EAAEb,KAAK,CAACc,SAFV;CAGNd,QAAAA,KAAK,EAALA,KAHM;CAIN/J,QAAAA,MAAM,EAAE,gBAAC7O,IAAD,EAAU;CACjB,UAAA,OAAI,CAACuE,IAAL,CAAU,aAAV,EAAyBvE,IAAzB;;CACA,UAAA,OAAI,CAAC6V,oBAAL;CACA,SAPK;CAQNhI,QAAAA,gBAAgB,EAAE,0BAAC7N,IAAD,EAAU;CAC3B,UAAA,OAAI,CAACuE,IAAL,CAAU,uBAAV,EAAmCvE,IAAnC;;CACA,UAAA,OAAI,CAAC6V,oBAAL;CACA,SAXK;CAYN/H,QAAAA,mBAAmB,EAAE,6BAAC9I,KAAD,EAAW;CAC/B,UAAA,OAAI,CAACT,IAAL,CAAU,0BAAV,EAAsCS,KAAtC;CACA,SAdK;CAeN+I,QAAAA,UAAU,EAAE,oBAAC/N,IAAD,EAAU;CACrB,UAAA,OAAI,CAACuE,IAAL,CAAU,iBAAV,EAA6BvE,IAA7B;;CACA,UAAA,OAAI,CAAC6V,oBAAL;CACA,SAlBK;CAmBN5G,QAAAA,YAAY,EAAE,sBAAC7J,MAAD,EAAY;CACzB,UAAA,OAAI,CAACb,IAAL,CAAU,mBAAV,EAA+B;CAACa,YAAAA,MAAM,EAANA;CAAD,WAA/B;CACA,SArBK;CAsBN+J,QAAAA,aAAa,EAAE,uBAAC/J,MAAD,EAAY;CAC1B,UAAA,OAAI,CAACb,IAAL,CAAU,oBAAV,EAAgC;CAACa,YAAAA,MAAM,EAANA;CAAD,WAAhC;CACA,SAxBK;CAyBNiK,QAAAA,WAAW,EAAE,qBAACjK,MAAD,EAAY;CACxB,UAAA,OAAI,CAACb,IAAL,CAAU,kBAAV,EAA8B;CAACa,YAAAA,MAAM,EAANA;CAAD,WAA9B;CACA,SA3BK;CA4BNmK,QAAAA,QAAQ,EAAE,kBAACvK,KAAD,EAAW;CACpB,UAAA,OAAI,CAACT,IAAL,CAAU,eAAV,EAA2BS,KAA3B;CACA,SA9BK;CA+BNyK,QAAAA,QAAQ,EAAE,kBAACrK,MAAD,EAAY;CACrB,UAAA,OAAI,CAACb,IAAL,CAAU,eAAV,EAA2B;CAACa,YAAAA,MAAM,EAANA;CAAD,WAA3B;CACA,SAjCK;CAkCNuU,QAAAA,MAAM,EAAE,kBAAM;CACb,UAAA,OAAI,CAACpV,IAAL,CAAU,aAAV,EAAyB;CACxBoP,YAAAA,OAAO,EAAE,OAAI,CAACoC,aAAL;CADe,WAAzB;CAGA,SAtCK;CAuCNpG,QAAAA,OAAO,EAAE,iBAAC3K,KAAD,EAAW;CACnB,UAAA,OAAI,CAACT,IAAL,CAAU,cAAV,EAA0BS,KAA1B;CACA,SAzCK;CA0CN4E,QAAAA,QAAQ,EAAE,IA1CJ;CA2CNsD,QAAAA,YAAY,EAAE,KAAKA,YA3Cb;CA4CN8J,QAAAA,iBAAiB,EAAE,KAAKqB,gBAAL,EA5Cb;CA6CNrI,QAAAA,YAAY,EAAE;CACbC,UAAAA,mBAAmB,EAAE,KAAKkI,oBAAL,EADR;CAEbjI,UAAAA,kBAAkB,EAAE,KAAKkI,mBAAL,EAFP;CAGbjI,UAAAA,eAAe,EAAE,KAAKkI,gBAAL;CAHJ,SA7CR;CAkDNuB,QAAAA,iBAAiB,EAAE,KAAKvB,gBAAL,EAlDb;CAmDNlL,QAAAA,YAAY,EAAE,KAAK0M,QAAL,GAAgBjP,SAnDxB;CAoDNvF,QAAAA,cAAc,EAAE,KAAKA;CApDf,OAAP;CAsDA;CAED;;CAvjBD;CAAA;CAAA,sCAwjBmBL,KAxjBnB,EAyjBC;CAAA;;CACCA,MAAAA,KAAK,CAACwL,cAAN,GADD;;CAICsB,MAAAA,EAAE,CAACgI,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CACC,KAAK5F,kBADN,EAEC;CACC6F,QAAAA,SAAS,EAAE,KADZ;CAECpU,QAAAA,MAAM,EAAE;CACPqU,UAAAA,OAAO,EAAE,mBAAM;CACd,YAAA,OAAI,CAAC3V,IAAL,CAAU,uBAAV;;CACA,YAAA,OAAI,CAACA,IAAL,CAAU,8BAAV;CACA;CAJM;CAFT,OAFD;CAYA;CAzkBF;CAAA;CAAA,oCA4kBC;CAAA;;CACC,aAAO,KAAKZ,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC,YAAM;CAC9C,YAAM0U,OAAO,GAAG,OAAI,CAAC6B,iBAAL,CAAuB9W,IAAvB,CAA4B,OAA5B,CAAhB;;CAEA,eAAOrG,aAAG,CAACC,MAAX,6PACG,CAAC,OAAI,CAAC0X,iBAAN,GAA0B,oCAA1B,GAAiE,EADpE,EAE+F2D,OAF/F,EAGI/S,aAAG,CAACC,UAAJ,CAAe,kCAAf,CAHJ;CAMA,OATM,CAAP;CAUA;CAED;;CAzlBD;CAAA;CAAA,sCA0lBmBR,KA1lBnB,EA2lBC;CAAA;;CACCA,MAAAA,KAAK,CAACwL,cAAN;;CAEA,UAAI,CAAC,KAAKmE,iBAAV,EACA;CACC,aAAKC,0BAAL;CACA,OAHD,MAKA;CACC;CACA9C,QAAAA,EAAE,CAACgI,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CACC,KAAK5F,kBADN,EAEC;CACC6F,UAAAA,SAAS,EAAE,KADZ;CAECpU,UAAAA,MAAM,EAAE;CACPqU,YAAAA,OAAO,EAAE,mBAAM;CACd,cAAA,OAAI,CAAC3V,IAAL,CAAU,uBAAV;;CACA,cAAA,OAAI,CAACA,IAAL,CAAU,8BAAV;CACA;CAJM;CAFT,SAFD;CAYA;CACD;CAlnBF;CAAA;CAAA,uCAqnBC;CAAA;;CACC,aAAO,KAAKZ,KAAL,CAAWC,QAAX,CAAoB,eAApB,EAAqC,YAAM;CACjD,YAAM0U,OAAO,GAAG,OAAI,CAAC8B,oBAAL,CAA0B/W,IAA1B,CAA+B,OAA/B,CAAhB;;CAEA,eAAOrG,aAAG,CAACC,MAAX,+PACG,CAAC,OAAI,CAACwX,oBAAN,GAA6B,oCAA7B,GAAoE,EADvE,EAEiG6D,OAFjG,EAGI/S,aAAG,CAACC,UAAJ,CAAe,sCAAf,CAHJ;CAMA,OATM,CAAP;CAUA;CAED;;CAloBD;CAAA;CAAA,yCAmoBsBR,KAnoBtB,EAooBC;CAAA;;CACCA,MAAAA,KAAK,CAACwL,cAAN;;CAEA,UAAI,CAAC,KAAKiE,oBAAV,EACA;CACC,aAAKC,6BAAL;CACA,OAHD,MAKA;CACC;CACA5C,QAAAA,EAAE,CAACgI,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CACC,KAAK3F,qBADN,EAEC;CACC4F,UAAAA,SAAS,EAAE,KADZ;CAECpU,UAAAA,MAAM,EAAE;CACPqU,YAAAA,OAAO,EAAE,mBAAM;CACd,cAAA,OAAI,CAAC3V,IAAL,CAAU,uBAAV;;CACA,cAAA,OAAI,CAACA,IAAL,CAAU,iCAAV,EAA6C;CAACqF,gBAAAA,QAAQ,EAAE;CAAX,eAA7C;CACA;CAJM;CAFT,SAFD;CAYA;CACD;CA3pBF;CAAA;CAAA,oCA8pBC;CAAA;;CACC,aAAO,KAAKjG,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC;CAAA,eACxC5G,aAAG,CAACC,MADoC,sOAIvB,OAAI,CAACod,iBAAL,CAAuBhX,IAAvB,CAA4B,OAA5B,CAJuB,EAK7BkC,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAL6B;CAAA,OAAlC,CAAP;CASA;CAxqBF;CAAA;CAAA,yCA2qBC;CACC/E,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAK4Z,aAAL,EAAb,EAAmC,2BAAnC;CACA;CA7qBF;CAAA;CAAA,2CAgrBC;CACC7Z,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAK6Y,aAAL,EAAhB,EAAsC,2BAAtC;CACA;CAlrBF;CAAA;CAAA,sCAorBmBtV,KAprBnB,EAqrBC;CACC,UAAIA,KAAJ,EACA;CACCA,QAAAA,KAAK,CAACwL,cAAN;CACA;;CAED,UAAI,KAAK+J,kBAAL,EAAJ,EACA;CACC,aAAKC,gBAAL;CACA,aAAKC,SAAL;CACA;CACA;;CAED,WAAKC,eAAL;CACA;CAnsBF;CAAA;CAAA,sCAssBC;CAAA,UADgBvd,KAChB,uEADiC,IACjC;CACC,UAAMwd,WAAW,GAAG,KAAKC,cAAL,EAApB;;CADD,2BAEqB,KAAKf,QAAL,EAFrB;CAAA,UAEQjP,SAFR,kBAEQA,SAFR;;CAIC+P,MAAAA,WAAW,CAACxd,KAAZ,GAAoBC,cAAI,CAACyd,QAAL,CAAc1d,KAAd,IAAuBA,KAAvB,GAA+BgL,cAAI,CAAC2S,MAAL,CAAYlQ,SAAZ,CAAnD;CAEA5N,MAAAA,aAAG,CAACmF,KAAJ,CAAUwY,WAAV;CAGA;CA/sBF;CAAA;CAAA,sCAktBC;CACC,UAAMA,WAAW,GAAG,KAAKC,cAAL,EAApB;CAEA5d,MAAAA,aAAG,CAACmF,KAAJ,CAAUwY,WAAV;CAGA;CAxtBF;CAAA;CAAA,yCA2tBC;CACC,UAAMA,WAAW,GAAG,KAAKC,cAAL,EAApB;CACAD,MAAAA,WAAW,CAACI,KAAZ;CAEA,UAAM9J,KAAK,GAAG,KAAK4I,QAAL,EAAd;CACAc,MAAAA,WAAW,CAACK,iBAAZ,CAA8BC,WAA9B,EAA2CA,WAA3C;CACA,UAAMA,WAAW,GAAGhK,KAAK,CAACrG,SAAN,CAAgBtN,MAApC;CACA;CAluBF;CAAA;CAAA,gCAquBC;CACCN,MAAAA,aAAG,CAACmF,KAAJ,CAAU,KAAK0X,QAAL,EAAV;CAGA;CAzuBF;CAAA;CAAA,gCA4uBC;CACC7c,MAAAA,aAAG,CAACmF,KAAJ,CAAU,KAAK0X,QAAL,EAAV;CAGA;CAhvBF;CAAA;CAAA,gCAmvBC;CACC,UAAM5I,KAAK,GAAG,KAAK4I,QAAL,EAAd;CACA,UAAMc,WAAW,GAAG,KAAKC,cAAL,EAApB;CAFD,UAGQzd,KAHR,GAGiBwd,WAHjB,CAGQxd,KAHR;CAIC,UAAM+d,QAAQ,GAAG/d,KAAK,CAAC6U,IAAN,MAAgBzM,aAAG,CAACC,UAAJ,CAAe,iCAAf,CAAjC;;CAEA,UAAIyL,KAAK,CAACrG,SAAN,KAAoBsQ,QAAxB,EACA;CACCjK,QAAAA,KAAK,CAACrG,SAAN,GAAkBsQ,QAAlB;CACAza,QAAAA,aAAG,CAAC6B,IAAJ,CAAS2O,KAAT,EAAgB,OAAhB,EAAyBiK,QAAzB;CAEA,aAAKnY,IAAL,GAAYmY,QAAZ;CACA,aAAK3W,IAAL,CAAU,qBAAV,EAAiC;CAAC4W,UAAAA,UAAU,EAAE,KAAKhU,EAAlB;CAAsBhK,UAAAA,KAAK,EAAE+d;CAA7B,SAAjC;CACA;CACD;CAjwBF;CAAA;CAAA,sCAowBC;CAAA,UADgB/d,KAChB,uEADwB,IACxB;CACC,WAAKie,SAAL;CACA,WAAKC,eAAL,CAAqBle,KAArB;CACA,WAAKme,kBAAL;CACA,WAAKC,kBAAL;CACA;CAzwBF;CAAA;CAAA,uCA4wBC;CACC,WAAKC,SAAL;CACA,WAAKC,eAAL;CACA,WAAKC,oBAAL;CACA;CAhxBF;CAAA;CAAA,yCAmxBC;CACC,aAAOjb,aAAG,CAAC+J,QAAJ,CAAa,KAAK8P,aAAL,EAAb,EAAmC,2BAAnC,CAAP;CACA;CArxBF;CAAA;CAAA,sCAwxBC;CAAA;;CACC,aAAO,KAAK3W,KAAL,CAAWC,QAAX,CAAoB,cAApB,EAAoC,YAAM;CAChD,YAAM+F,MAAM,GAAG3M,aAAG,CAACC,MAAP,qOAGC,OAAI,CAAC0e,mBAAL,CAAyBtY,IAAzB,CAA8B,OAA9B,CAHD,EAIDkC,aAAG,CAACC,UAAJ,CAAe,6BAAf,CAJC,CAAZ;CAOA,eAAOmE,MAAP;CACA,OATM,CAAP;CAUA;CAnyBF;CAAA;CAAA,0CAsyBC;CAAA;;CACC,UAAMiS,eAAe,GAAG,SAAlBA,eAAkB,CAAC5W,KAAD,EAAQzE,IAAR,EAA4B;CACnD,QAAA,OAAI,CAACgE,IAAL,CAAU,iBAAV,EAA6B;CAC5B4W,UAAAA,UAAU,EAAE,OAAI,CAAChU,EADW;CAE5ByM,UAAAA,MAAM,EAAGrT,IAAI,CAACsb,OAAL,CAAa,QAAb,CAFmB;CAG5BlK,UAAAA,SAAS,EAAE,qBAAM,EAHW;CAK5BE,UAAAA,QAAQ,EAAE,oBAAM;CALY,SAA7B;;CAQApR,QAAAA,aAAG,CAACC,QAAJ,CAAaH,IAAI,CAACgO,YAAL,EAAb,EAAkC,wBAAlC;CACA9N,QAAAA,aAAG,CAACgB,WAAJ,CAAgBlB,IAAI,CAACgO,YAAL,EAAhB,EAAqC,oBAArC;CACA,QAAA,OAAI,CAACqF,MAAL,GAAcrT,IAAI,CAACsb,OAAL,CAAa,QAAb,CAAd;;CACA,QAAA,OAAI,CAACC,UAAL,CAAgBtV,YAAhB,GAA+B9G,OAA/B,CAAuC,UAACqc,SAAD,EAAe;CACrD,cAAIA,SAAS,KAAKxb,IAAlB,EACA;CACC;CACA;;CACDE,UAAAA,aAAG,CAACgB,WAAJ,CAAgBsa,SAAS,CAACxN,YAAV,EAAhB,EAA0C,wBAA1C;CACA9N,UAAAA,aAAG,CAACC,QAAJ,CAAaqb,SAAS,CAACxN,YAAV,EAAb,EAAuC,oBAAvC;CACA,SAPD;;CAQA,QAAA,OAAI,CAACuN,UAAL,CAAgBvV,KAAhB;CACA,OArBD;;CAsBA,UAAMyV,kBAAkB,GAAG,SAArBA,kBAAqB,CAAChX,KAAD,EAAQzE,IAAR,EAA4B;CACtD,QAAA,OAAI,CAACgE,IAAL,CAAU,sBAAV,EAAkC;CACjC4W,UAAAA,UAAU,EAAE,OAAI,CAAChU,EADgB;CAEjC8U,UAAAA,eAAe,EAAG1b,IAAI,CAACsb,OAAL,CAAa,YAAb,CAFe;CAGjClK,UAAAA,SAAS,EAAE,qBAAM,EAHgB;CAKjCE,UAAAA,QAAQ,EAAE,oBAAM;CALiB,SAAlC;;CAQA,QAAA,OAAI,CAAC+B,MAAL,GAAcrT,IAAI,CAACsb,OAAL,CAAa,QAAb,CAAd;;CAEA,QAAA,OAAI,CAACC,UAAL,CAAgBtV,YAAhB,GAA+B9G,OAA/B,CAAuC,UAACqc,SAAD,EAAe;CACrD,cAAIA,SAAS,CAACF,OAAV,KAAsB,IAA1B,EACA;CACC;CACA;;CACD,cAAI,OAAI,CAACjI,MAAL,KAAgBmI,SAAS,CAACF,OAAV,CAAkB,QAAlB,CAApB,EACA;CACCpb,YAAAA,aAAG,CAACC,QAAJ,CAAaqb,SAAS,CAACxN,YAAV,EAAb,EAAuC,wBAAvC;CACA9N,YAAAA,aAAG,CAACgB,WAAJ,CAAgBsa,SAAS,CAACxN,YAAV,EAAhB,EAA0C,oBAA1C;CACA,WAJD,MAMA;CACC9N,YAAAA,aAAG,CAACgB,WAAJ,CAAgBsa,SAAS,CAACxN,YAAV,EAAhB,EAA0C,wBAA1C;CACA9N,YAAAA,aAAG,CAACC,QAAJ,CAAaqb,SAAS,CAACxN,YAAV,EAAb,EAAuC,oBAAvC;CACA;CACD,SAfD;;CAgBA,QAAA,OAAI,CAACuN,UAAL,CAAgBvV,KAAhB;CACA,OA5BD;;CA8BA,UAAIZ,KAAK,GAAGuN,QAAQ,CAAC7T,SAAT,CACZ+J,MADY,CACL,UAACQ,QAAD,EAAc;CACpB,eAAO,OAAI,CAACzC,EAAL,KAAYyC,QAAQ,CAACzC,EAArB,IAA2ByC,QAAQ,CAACzC,EAAT,KAAgB,MAAlD;CACA,OAHW,EAIZ2D,GAJY,CAIR,UAAClB,QAAD,EAAc;CACjB,eAAO;CACNjD,UAAAA,IAAI,EAAEwB,cAAI,CAACC,MAAL,CAAYwB,QAAQ,CAAC7G,IAArB,CADA;CAEN8Y,UAAAA,OAAO,EAAG;CACTV,YAAAA,UAAU,EAAGvR,QAAQ,CAACzC,EADb;CAETyM,YAAAA,MAAM,EAAGhK,QAAQ,CAACgK;CAFT,WAFJ;CAMNhN,UAAAA,OAAO,EAAGoV;CANJ,SAAP;CAQA,OAbW,CAAZ;CAeA,WAAKF,UAAL,GAAkB,IAAII,eAAJ,CAAS;CAC1B/U,QAAAA,EAAE,6BAAsBgB,cAAI,CAACgU,SAAL,GAAiBC,WAAjB,EAAtB,CADwB;CAE1B1W,QAAAA,WAAW,EAAE,KAAK2W,eAAL,EAFa;CAG1B1W,QAAAA,KAAK,EAAG,CACP;CACCgB,UAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,sCAAf,CADP;CAECqW,UAAAA,OAAO,EAAE;CACRjI,YAAAA,MAAM,EAAE;CADA;CAFV,SADO,EAOP;CACCjN,UAAAA,IAAI,EAAGpB,aAAG,CAACC,UAAJ,CAAe,uCAAf,CADR;CAECqW,UAAAA,OAAO,EAAE;CACRjI,YAAAA,MAAM,EAAE;CADA;CAFV,SAPO,EAaP;CACCjN,UAAAA,IAAI,EAAGpB,aAAG,CAACC,UAAJ,CAAe,sCAAf,CADR;CAECqW,UAAAA,OAAO,EAAE;CACRjI,YAAAA,MAAM,EAAE;CADA;CAFV,SAbO,EAmBNjO,KAAK,CAACrI,MAAN,GAAe,CAAf,GAAmB;CACnBqJ,UAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,4CAAf,CADa;CAEnBG,UAAAA,KAAK,EAAEA;CAFY,SAAnB,GAGG,IAtBG,EAuBP;CAAE2W,UAAAA,SAAS,EAAG;CAAd,SAvBO,EAwBP;CACC3V,UAAAA,IAAI,EAAGpB,aAAG,CAACC,UAAJ,CAAe,iCAAf,CADR;CAECqW,UAAAA,OAAO,EAAE;CAAEjI,YAAAA,MAAM,EAAE;CAAV,WAFV;CAGC2I,UAAAA,SAAS,EAAE,KAAK3I,MAAL,KAAgB,GAAhB,IAAwB,KAAKA,MAAL,KAAgB,GAAxC,IAA+C,KAAKA,MAAL,KAAgB,EAA/D,GAAmE,wBAAnE,GAA8F,EAH1G;CAIC4I,UAAAA,IAAI,EAAG,KAAKlI,kBAJb;CAKClJ,UAAAA,MAAM,EAAE,QALT;CAMCxE,UAAAA,OAAO,EAAG,iBAAC5B,KAAD,EAAQzE,IAAR,EAAiB;CAC1BA,YAAAA,IAAI,CAACkc,aAAL,GAAqBlW,KAArB;CACA;CARF,SAxBO,EAmCR6C,MAnCQ,CAmCD,UAAAsT,OAAO;CAAA,iBAAIA,OAAO,KAAK,IAAhB;CAAA,SAnCN,EAoCR5R,GApCQ,CAoCJ,UAAC4R,OAAD,EAAa;CAChB,cAAIA,OAAO,CAACb,OAAZ,EACA;CACC,gBAAI,OAAI,CAACjI,MAAL,KAAgB8I,OAAO,CAACb,OAAR,CAAgBjI,MAApC,EACA;CACC8I,cAAAA,OAAO,CAACH,SAAR,GAAoB,wBAApB;CACA;;CACD,gBAAI,CAACG,OAAO,CAAC9V,OAAb,EACA;CACC8V,cAAAA,OAAO,CAAC9V,OAAR,GAAkBgV,eAAlB;CACA;CACD;;CACD,iBAAOc,OAAP;CACA,SAjDO,CAHkB;CAqD1B7W,QAAAA,MAAM,EAAE;CACPqU,UAAAA,OAAO,EAAG,YAAW;CACpBzZ,YAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAK4a,eAAL,EAAhB,EAAwC,6BAAxC;CACA5b,YAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAKkb,iBAAL,EAAhB,EAA0C,uCAA1C;CACAla,YAAAA,UAAU,CAAC,KAAKma,UAAL,CAAgBvZ,IAAhB,CAAqB,IAArB,CAAD,EAA6B,GAA7B,CAAV;CACA,WAJS,CAIRA,IAJQ,CAIH,IAJG;CADH,SArDkB;CA4D1BwZ,QAAAA,KAAK,EAAE,IA5DmB;CA6D1BC,QAAAA,UAAU,EAAE;CA7Dc,OAAT,CAAlB;CAgEArc,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKic,iBAAL,EAAb,EAAuC,uCAAvC;CACAlc,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAK2b,eAAL,EAAb,EAAqC,6BAArC;CACA,WAAKP,UAAL,CAAgBvS,IAAhB;CAEA,WAAKwT,OAAL;CACA;CA/6BF;CAAA;CAAA,sCAk7BC;CAAA;;CACC,aAAO,KAAKpZ,KAAL,CAAWC,QAAX,CAAoB,cAApB,EAAoC,YAAM;CAChD,YAAM+F,MAAM,GAAG3M,aAAG,CAACC,MAAP,qOAGC,OAAI,CAAC+f,mBAAL,CAAyB3Z,IAAzB,CAA8B,OAA9B,CAHD,EAIDkC,aAAG,CAACC,UAAJ,CAAe,wBAAf,CAJC,CAAZ;;CAQA,YAAI,OAAI,CAACuO,OAAT,EACA;CACC/W,UAAAA,aAAG,CAACmF,KAAJ,CAAUwH,MAAV;CAGA;;CAED,eAAOA,MAAP;CACA,OAjBM,CAAP;CAkBA;CAr8BF;CAAA;CAAA,0CAw8BC;CAAA;;CACC,WAAKsT,sBAAL,GACEC,IADF,CACO,gBAAe;CAAA,YAAbC,OAAa,QAAbA,OAAa;;CACpB,YAAIA,OAAJ,EACA;CACC,UAAA,OAAI,CAAC5Y,IAAL,CAAU,iBAAV,EAA6B;CAC5B4W,YAAAA,UAAU,EAAE,OAAI,CAAChU,EADW;CAE5BwK,YAAAA,SAAS,EAAE,qBAAM;CAChB,cAAA,OAAI,CAAC1N,MAAL;CACA,aAJ2B;CAK5B4N,YAAAA,QAAQ,EAAE,oBAAM;CACf,cAAA,OAAI,CAAC+K,UAAL;CACA;CAP2B,WAA7B;;CAUA;CACA;;CAED,QAAA,OAAI,CAACA,UAAL;CACA,OAlBF;CAoBA,WAAKG,OAAL;CACA;CA99BF;CAAA;CAAA,oCAi+BC;CACC,UAAMK,eAAe,GAAG,KAAKtH,iBAAL,GACtBrD,UADsB,GAEtBE,IAFsB,CAEjB,UAACC,CAAD,EAAIC,CAAJ;CAAA,eAAWD,CAAC,CAAC4D,QAAF,KAAe3D,CAAC,CAAC2D,QAAF,EAAf,GAA8B,CAA9B,GAAkC,CAAC,CAA9C;CAAA,OAFiB,CAAxB;CAGA,UAAM6G,aAAa,GAAG,KAAKrH,gBAAL,GACpBvD,UADoB,GAEpBE,IAFoB,CAEf,UAACC,CAAD,EAAIC,CAAJ;CAAA,eAAWD,CAAC,CAAC4D,QAAF,KAAe3D,CAAC,CAAC2D,QAAF,EAAf,GAA8B,CAA9B,GAAkC,CAAC,CAA9C;CAAA,OAFe,CAAtB;CAGA,UAAM8G,WAAW,GAAG,KAAKrH,aAAL,GAClBxD,UADkB,GAElBE,IAFkB,CAEb,UAACC,CAAD,EAAIC,CAAJ;CAAA,eAAWD,CAAC,CAAC4D,QAAF,KAAe3D,CAAC,CAAC2D,QAAF,EAAf,GAA8B,CAA9B,GAAkC,CAAC,CAA9C;CAAA,OAFa,CAApB;CAIA,sDACI4G,eADJ,kCAEIC,aAFJ,kCAGIC,WAHJ;CAKA;CAj/BF;CAAA;CAAA,8BAo/BC;CACC7c,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAK6N,YAAL,EAAb,EAAkC,aAAlC;CAEA,WAAKwH,aAAL,GAAqBrW,OAArB,CAA6B,UAAC0F,MAAD,EAAY;CACxCA,QAAAA,MAAM,CAAC7F,MAAP,CAAc4M,SAAd;CACA,OAFD;CAGA;CA1/BF;CAAA;CAAA,iCA6/BC;CACC1L,MAAAA,aAAG,CAACgB,WAAJ,CAAgB,KAAK8M,YAAL,EAAhB,EAAqC,aAArC;CACApP,MAAAA,MAAM,CAACoe,WAAP;CACA;CAhgCF;CAAA;CAAA,6BAmgCC;CAAA;;CACC9c,MAAAA,aAAG,CAACwD,MAAJ,CAAW,KAAKsK,YAAL,EAAX;CAEApP,MAAAA,MAAM,CAACkB,WAAP,GACEX,OADF,CACU,UAACM,IAAD,EAAU;CAClB,YAAMsM,UAAU,GAAGtM,IAAI,CAACQ,IAAL,CAAUwC,IAAV,CAAeoC,MAAlC;CACA,YAAMoY,YAAY,GAAGlR,UAAU,CAACG,OAAX,GAAqB7C,QAA1C;CACA,YAAM2C,QAAQ,GAAGvM,IAAI,CAACc,EAAL,CAAQkC,IAAR,CAAaoC,MAA9B;CACA,YAAMqY,UAAU,GAAGlR,QAAQ,CAACE,OAAT,GAAmB7C,QAAtC;;CAEA,YAAI+C,MAAM,CAAC6Q,YAAY,CAACrW,EAAd,CAAN,KAA4BwF,MAAM,CAAC,OAAI,CAACxF,EAAN,CAAtC,EACA;CACCnH,UAAAA,IAAI,CAACQ,IAAL,CAAUuG,UAAV,CAAqB/G,IAArB;CACA;;CAED,YAAI2M,MAAM,CAAC8Q,UAAU,CAACtW,EAAZ,CAAN,KAA0BwF,MAAM,CAAC,OAAI,CAACxF,EAAN,CAApC,EACA;CACCnH,UAAAA,IAAI,CAACc,EAAL,CAAQiG,UAAR,CAAmB/G,IAAnB;CACA;CACD,OAhBF;CAkBAb,MAAAA,MAAM,CAACue,eAAP,GACEhe,OADF,CACU,UAACM,IAAD,EAAU;CAClB,YAAMsM,UAAU,GAAGtM,IAAI,CAACQ,IAAL,CAAUwC,IAAV,CAAeoC,MAAlC;CACA,YAAMoY,YAAY,GAAGlR,UAAU,CAACG,OAAX,GAAqB7C,QAA1C;CACA,YAAM2C,QAAQ,GAAGvM,IAAI,CAACc,EAAL,CAAQkC,IAAR,CAAaoC,MAA9B;CACA,YAAMqY,UAAU,GAAGlR,QAAQ,CAACE,OAAT,GAAmB7C,QAAtC;;CAEA,YAAI+C,MAAM,CAAC6Q,YAAY,CAACrW,EAAd,CAAN,KAA4BwF,MAAM,CAAC,OAAI,CAACxF,EAAN,CAAtC,EACA;CACCnH,UAAAA,IAAI,CAACQ,IAAL,CAAUkJ,cAAV,CAAyB1J,IAAzB;CACA;;CAED,YAAI2M,MAAM,CAAC8Q,UAAU,CAACtW,EAAZ,CAAN,KAA0BwF,MAAM,CAAC,OAAI,CAACxF,EAAN,CAApC,EACA;CACCnH,UAAAA,IAAI,CAACc,EAAL,CAAQ4I,cAAR,CAAuB1J,IAAvB;CACA;CACD,OAhBF;CAkBAkT,MAAAA,QAAQ,CAAC7T,SAAT,GAAqB6T,QAAQ,CAAC7T,SAAT,CAAmB+J,MAAnB,CAA0B,UAAA7I,IAAI;CAAA,eAAIA,IAAI,KAAK,OAAb;CAAA,OAA9B,CAArB;CACA;CA3iCF;CAAA;CAAA,+BA8iCC;CACC,UAAMod,SAAS,GAAGxV,cAAI,CAACC,MAAL,CAAY,KAAKrF,IAAjB,CAAlB;CACA,aAAO,KAAKY,KAAL,CAAWC,QAAX,CAAoB,OAApB,EAA6B;CAAA,eACnC5G,aAAG,CAACC,MAD+B,yKAEc0gB,SAFd,EAE4BA,SAF5B;CAAA,OAA7B,CAAP;CAKA;CArjCF;CAAA;CAAA,qCAwjCC;CAAA;;CACC,aAAO,KAAKha,KAAL,CAAWC,QAAX,CAAoB,aAApB,EAAmC,YAAM;CAC/C,YAAMga,SAAS,GAAG,OAAI,CAACC,oBAAL,CAA0Bxa,IAA1B,CAA+B,OAA/B,CAAlB;;CACA,YAAMya,MAAM,GAAG,OAAI,CAACC,iBAAL,CAAuB1a,IAAvB,CAA4B,OAA5B,CAAf;;CACA,eAAOrG,aAAG,CAACC,MAAX,8RAEgB2gB,SAFhB,EAGaE,MAHb,EAIY3V,cAAI,CAACC,MAAL,CAAY,OAAI,CAACrF,IAAjB,CAJZ,EAKkBwC,aAAG,CAACC,UAAJ,CAAe,iCAAf,CALlB;CAQA,OAXM,CAAP;CAYA;CArkCF;CAAA;CAAA,yCAukCsBR,KAvkCtB,EAwkCC;CACCA,MAAAA,KAAK,CAACoM,eAAN;;CAEA,UAAI,KAAKmJ,kBAAL,EAAJ,EACA;CACC,YAAIvV,KAAK,CAACgZ,GAAN,CAAUC,UAAV,CAAqB,OAArB,CAAJ,EACA;CACC,eAAK5D,iBAAL;CACA;;CAED,YAAIrV,KAAK,CAACgZ,GAAN,CAAUC,UAAV,CAAqB,KAArB,CAAJ,EACA;CACC,eAAKzD,gBAAL;CACA;CACD;CACD;CAvlCF;CAAA;CAAA,wCA0lCC;CACC,UAAI,KAAKD,kBAAL,EAAJ,EACA;CACC,aAAKF,iBAAL;CACA;CACD;CA/lCF;CAAA;CAAA,wCAkmCC;CAAA;;CACC,aAAO,KAAK1W,KAAL,CAAWC,QAAX,CAAoB,mBAApB,EAAyC;CAAA,eAC/C5G,aAAG,CAACC,MAD2C,sNAG3C,OAAI,CAACoI,cAAL,GAAsB,OAAI,CAACiV,aAAL,EAAtB,GAA6C,EAHF,EAI3C,OAAI,CAACjV,cAAL,GAAsB,OAAI,CAACgX,eAAL,EAAtB,GAA+C,EAJJ,EAK3C,OAAI,CAAChX,cAAL,GAAsB,OAAI,CAAC6Y,eAAL,EAAtB,GAA+C,EALJ;CAAA,OAAzC,CAAP;CASA;CA5mCF;CAAA;CAAA,wCA+mCC;CAAA;;CACC,aAAO,KAAKva,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC;CAAA,eAC5C5G,aAAG,CAACC,MADwC,4NAGxC,OAAI,CAAC4c,QAAL,EAHwC,EAIxC,OAAI,CAACe,cAAL,EAJwC,EAKxC,OAAI,CAAC+B,iBAAL,EALwC;CAAA,OAAtC,CAAP;CASA;CAznCF;CAAA;CAAA,oCA4nCC;CACC,aAAO,KAAKhZ,KAAL,CAAWC,QAAX,CAAoB,YAApB,EAAkC;CAAA,eACxC5G,aAAG,CAACC,MADoC,mNAI7BsI,aAAG,CAACC,UAAJ,CAAe,6BAAf,CAJ6B;CAAA,OAAlC,CAAP;CAQA;CAroCF;CAAA;CAAA,+BAwoCC;CACC,aAAO,KAAK+O,MAAZ;CACA;CA1oCF;CAAA;CAAA,2BA6oCC;CACC,UAAI,CAAC,KAAK4J,QAAL,EAAL,EACA;CACC,aAAK5J,MAAL,GAAc,IAAd;CACA9T,QAAAA,aAAG,CAAC0C,MAAJ,CAAW,KAAKoL,YAAL,EAAX,EAAgC,KAAK4E,QAArC;CAEA,aAAK2C,iBAAL,GAAyBb,IAAzB;CACA,aAAKe,gBAAL,GAAwBf,IAAxB;CACA,aAAKgB,aAAL,GAAqBhB,IAArB;CACA;CACD;CAvpCF;CAAA;CAAA,oCAypCiBmJ,QAzpCjB,EA0pCC;CACC,UAAMzK,OAAO,4CACT,KAAKmC,iBAAL,GAAyBrD,UAAzB,EADS,kCAET,KAAKuD,gBAAL,GAAwBvD,UAAxB,EAFS,kCAGT,KAAKwD,aAAL,GAAqBxD,UAArB,EAHS,EAAb;CAMA,aAAOkB,OAAO,CAACrU,IAAR,CAAa,UAAA8F,MAAM;CAAA,eACzBgZ,QAAQ,KAAKhZ,MAAM,CAACsC,KAAP,EAAb,IAA+B0W,QAAQ,KAAKhZ,MAAM,CAACqH,OAAP,GAAiB4R,QADpC;CAAA,OAAnB,CAAP;CAGA;CApqCF;CAAA;CAAA,6CAuqCC;CAAA;;CACC,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;CAC/B,aAAM,IAAIC,sBAAJ,CAAgB;CACrBhgB,UAAAA,KAAK,EAAE,GADc;CAErBigB,UAAAA,OAAO,EAAE;CACRC,YAAAA,OAAO,EAAE;CADD,WAFY;CAKrBC,UAAAA,QAAQ,EAAEpZ,aAAG,CAACC,UAAJ,CAAe,4CAAf,EACRmC,OADQ,CACA,QADA,EACU,OAAI,CAACkS,QAAL,GAAgBjP,SAD1B,CALW;CAOrBgU,UAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,kDAAf,CAPY;CAQrBqZ,UAAAA,OAAO,EAAE,CACR,IAAIC,4BAAJ,CAAsB;CACrBnY,YAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,oDAAf,CADe;CAErB+W,YAAAA,SAAS,EAAE,6BAFU;CAGrB1W,YAAAA,MAAM,EAAE;CACPkZ,cAAAA,KADO,mBACC;CACPR,gBAAAA,OAAO,CAAC;CAACpB,kBAAAA,OAAO,EAAE;CAAV,iBAAD,CAAP;CACA,qBAAK6B,WAAL,CAAiB9V,OAAjB;CACA;CAJM;CAHa,WAAtB,CADQ,EAWR,IAAI+V,gCAAJ,CAA0B;CACzBtY,YAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,oDAAf,CADmB;CAEzBK,YAAAA,MAAM,EAAE;CACPkZ,cAAAA,KADO,mBACC;CACPR,gBAAAA,OAAO,CAAC;CAACpB,kBAAAA,OAAO,EAAE;CAAV,iBAAD,CAAP;CACA,qBAAK6B,WAAL,CAAiB9V,OAAjB;CACA;CAJM;CAFiB,WAA1B,CAXQ;CARY,SAAhB,CAAD,CA6BDK,IA7BC,EAAL;CA8BA,OA/BM,CAAP;CAgCA;CAxsCF;CAAA;CAAA,wCA2sCC;CACC,aAAO,KAAK5F,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC;CAAA,eAC5C5G,aAAG,CAACC,MADwC;CAAA,OAAtC,CAAP;CAKA;CAjtCF;CAAA;CAAA,yCAotCC;CACCwD,MAAAA,aAAG,CAACc,WAAJ,CAAgB,KAAK2d,iBAAL,EAAhB,EAA0C,KAAKnH,aAAL,EAA1C;CACA;CAttCF;CAAA;CAAA,yCAytCC;CACCtX,MAAAA,aAAG,CAACwD,MAAJ,CAAW,KAAKib,iBAAL,EAAX;CACA;CA3tCF;CAAA;CAAA,2CA8tCC;CAAA;;CACCzc,MAAAA,UAAU,CAAC,YAAM;CAChB,YAAI,OAAI,CAAC0c,UAAL,EAAJ,EACA;CACC,UAAA,OAAI,CAACC,kBAAL;;CACA;CACA;;CAED,QAAA,OAAI,CAACC,kBAAL;CACA,OARS,CAAV;CASA;CAxuCF;CAAA;CAAA,2CA2uCC;CAAA;;CACC,aAAO,KAAK1b,KAAL,CAAWC,QAAX,CAAoB,mBAApB,EAAyC,YAAM;CACrD,YAAM0U,OAAO,GAAG,SAAVA,OAAU;CAAA,iBAAMxG,EAAE,CAACgI,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B,OAAI,CAAC9F,iBAAhC,CAAN;CAAA,SAAhB;;CACA,eAAOlX,aAAG,CAACC,MAAX,+KACqDqb,OADrD,EACiE,OAAI,CAACrE,eADtE;CAGA,OALM,CAAP;CAMA;CAlvCF;CAAA;CAAA,4CAqvCC;CACCxT,MAAAA,aAAG,CAACc,WAAJ,CAAgB,KAAK+d,oBAAL,EAAhB,EAA6C,KAAKrH,gBAAL,EAA7C;CACA;CAvvCF;CAAA;CAAA,EAA8BhT,eAAK,CAACmH,YAApC;6BAAa8G,uBAEwB;;KCIhBqM;;;;;;;mCAMpB;CAAA,UADgBnY,MAChB,QADgBA,MAChB;CAAA,UADwBpE,IACxB,QADwBA,IACxB;CAAA,UAD8Bwc,cAC9B,QAD8BA,cAC9B;CACC,aAAO,IAAIlB,OAAJ,CAAY,UAACC,OAAD,EAAUkB,MAAV,EAAqB;CACvCC,QAAAA,cAAI,CACFC,kBADF,CAEEJ,OAAO,CAACK,SAFV,EAGExY,MAHF,EAIE;CACCyY,UAAAA,IAAI,EAAE,OADP;CAEC7c,UAAAA,IAAI,EAAE;CACLA,YAAAA,IAAI,EAAJA,IADK;CAEL8c,YAAAA,YAAY,EAAEP,OAAO,CAACO;CAFjB,WAFP;CAMCN,UAAAA,cAAc,EAAdA;CAND,SAJF,EAaEtC,IAbF,CAaOqB,OAbP,EAagBkB,MAbhB;CAcA,OAfM,CAAP;CAgBA;;;oCAEqBzc,MACtB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,gBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;iCAEkBA,MACnB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,aADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;oCAEqBA,MACtB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,gBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;oCAEqBA,MACtB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,gBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;oCAEqBA,MACtB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,gBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;wCAEyBA,MAC1B;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,oBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;iCAEkBA,MACnB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,aADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;iCAEkBA,MACnB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,aADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;4CAE6BA,MAC9B;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,wBADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;8BAEeA,MAChB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,UADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;iCAEkBA,MACnB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,aADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;iCAEkBA,MACnB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,aADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;kCAEmBA,MACpB;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,cADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO,SAFM;CAMtBpE,QAAAA,IAAI,EAAJA;CANsB,OAAhB,CAAP;CAQA;;;qCAGD;CACC,aAAOuc,OAAO,CAACQ,OAAR,CAAgB;CACtB3Y,QAAAA,MAAM,EAAE,eADc;CAEtBoY,QAAAA,cAAc,EAAE;CACfI,UAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,UAAAA,MAAM,EAAE;CAFO;CAFM,OAAhB,CAAP;CAOA;;;;;6BA9LmBmY,sBAEO;6BAFPA,yBAGU;;KCdVS;;;CAEpB,wBAAYtd,OAAZ,EACA;CAAA;;CAAA;CACC,8GAAMA,OAAN;CACAjC,IAAAA,aAAG,CAACC,QAAJ,CAAa,MAAK6N,YAAL,EAAb,EAAkC,sBAAlC;CACA9N,IAAAA,aAAG,CAACgB,WAAJ,CAAgB,MAAK8M,YAAL,EAAhB,EAAqC,qCAArC;;CAEA,UAAKwH,aAAL,GACErW,OADF,CACU,UAAC0F,MAAD,EAAY;CACpBA,MAAAA,MAAM,CAAC7F,MAAP,CAAc2W,OAAd;CACA,KAHF;;CALD;CASC;;;GAZwChD;;CCH3B,SAAS+M,gBAAT,CAA0BC,KAA1B,EACf;CACC,SAAOC,KAAK,CAAC3f,IAAN,CAAW;CAAClD,IAAAA,MAAM,EAAE4iB;CAAT,GAAX,EAA4BpV,GAA5B,CAAgC,UAACvK,IAAD,EAAOyB,KAAP,EAAiB;CACvD,WAAO;CACN6W,MAAAA,SAAS,iBAAU7W,KAAV,CADH;CAEN+W,MAAAA,KAAK,EAAE,QAFD;CAGND,MAAAA,IAAI,EAAE;CAHA,KAAP;CAKA,GANM,CAAP;CAOA;;CCPc,SAASsH,4BAAT,CAAsCC,QAAtC,EACf;CACC,MAAIA,QAAQ,CAACrd,IAAT,IAAiBqd,QAAQ,CAACrd,IAAT,CAAcsd,MAA/B,IAAyCljB,cAAI,CAACC,OAAL,CAAagjB,QAAQ,CAACrd,IAAT,CAAcsd,MAA3B,CAAzC,IAA+ED,QAAQ,CAACrd,IAAT,CAAcsd,MAAd,CAAqBhjB,MAArB,GAA8B,CAAjH,EACA;CACC,WAAO+iB,QAAQ,CAACrd,IAAT,CAAcsd,MAAd,CAAqB1gB,MAArB,CAA4B,UAACC,GAAD,EAAM0gB,SAAN,EAAoB;CACtD,uBAAU1gB,GAAV,SAAgBsI,cAAI,CAACC,MAAL,CAAYmY,SAAZ,CAAhB;CACA,KAFM,EAEJ,EAFI,CAAP;CAGA;;CACD,MAAGF,QAAQ,CAACC,MAAT,IAAmBljB,cAAI,CAACC,OAAL,CAAagjB,QAAQ,CAACC,MAAtB,CAAnB,IAAoDD,QAAQ,CAACC,MAAT,CAAgBhjB,MAAhB,GAAyB,CAAhF,EACA;CACC,WAAO+iB,QAAQ,CAACC,MAAT,CAAgB1gB,MAAhB,CAAuB,UAAC4gB,MAAD,EAASC,KAAT,EAAmB;CAChD,uBAAUD,MAAV,SAAmBrY,cAAI,CAACC,MAAL,CAAYqY,KAAK,CAACnb,OAAN,GAAgBmb,KAAK,CAACnb,OAAtB,GAAgCmb,KAA5C,CAAnB;CACA,KAFM,EAEJ,EAFI,CAAP;CAGA;;CAED,SAAOlb,aAAG,CAACC,UAAJ,CAAe,mBAAf,CAAP;CACA;;KCJoBkb;CAIpB,mBAAYhe,OAAZ,EAwBA;CAAA;;CAAA;CACC,SAAKG,SAAL,GAAiBH,OAAO,CAACG,SAAzB;CACA,SAAKid,YAAL,GAAoBpd,OAAO,CAACod,YAA5B;CACA,SAAKa,YAAL,GAAoBje,OAAO,CAACie,YAA5B;CACA,SAAKC,oBAAL,GAA4Ble,OAAO,CAACke,oBAApC;CACA,SAAKC,UAAL,GAAkBne,OAAO,CAACme,UAA1B;CACA,SAAKC,iBAAL,GAAyBpe,OAAO,CAACqe,UAAjC;CACA,SAAKC,SAAL,GAAiBte,OAAO,CAACse,SAAzB;CACA,SAAKC,YAAL,GAAoBve,OAAO,CAACue,YAA5B;CACA,SAAKC,iBAAL,GAAyBxe,OAAO,CAACwe,iBAAjC;CACA,SAAKC,YAAL,GAAoBze,OAAO,CAACye,YAA5B;CACA,SAAK9b,cAAL,GAAsB2O,OAAO,CAACtR,OAAO,CAAC2C,cAAT,CAA7B;CACA,SAAK+b,cAAL,GAAsBpN,OAAO,CAACtR,OAAO,CAAC0e,cAAT,CAA7B;CACA,SAAKC,uBAAL,GAA+BxN,MAAM,CAACnR,OAAO,CAAC2e,uBAAT,CAArC;CACA,SAAKC,oBAAL,GAA4B5e,OAAO,CAAC4e,oBAApC;CACA,SAAK7M,oBAAL,GAA4B/R,OAAO,CAAC+R,oBAApC;CACA,SAAKC,6BAAL,GAAqChS,OAAO,CAACgS,6BAA7C;CACA,SAAKC,iBAAL,GAAyBjS,OAAO,CAACiS,iBAAjC;CACA,SAAKC,0BAAL,GAAkClS,OAAO,CAACkS,0BAA1C;CACA,SAAKC,iBAAL,GAAyBnS,OAAO,CAACmS,iBAAjC;CACA,SAAKE,eAAL,GAAuBrS,OAAO,CAACqS,eAA/B;CACA,SAAKD,mBAAL,GAA2BpS,OAAO,CAACoS,mBAAR,IAA+B,KAAKC,eAA/D;CACA,SAAKgM,UAAL,GAAkB,IAAIQ,GAAJ,EAAlB;CACA,SAAK5d,KAAL,GAAa,IAAIhB,eAAK,CAACC,WAAV,EAAb;CACA,SAAK4e,SAAL,GAAiB,KAAjB;CAEA,SAAKC,cAAL;CACA,SAAKC,WAAL;CAEAnC,IAAAA,OAAO,CAACO,YAAR,GAAuB,KAAKA,YAA5B;CAEArd,IAAAA,UAAU,CAAC,YAAM;CAChB,UAAI,CAAC,KAAI,CAAC0c,UAAL,EAAL,EACA;CACC,QAAA,KAAI,CAACwC,gBAAL;CACA;CACD,KALS,CAAV;CAOA1c,IAAAA,eAAK,CAAC5B,IAAN,CAAW,KAAKue,oBAAL,EAAX,EAAwC,OAAxC,EAAiD,KAAKC,kBAAL,CAAwBxe,IAAxB,CAA6B,IAA7B,CAAjD;CACA4B,IAAAA,eAAK,CAAC5B,IAAN,CAAW,KAAKud,oBAAhB,EAAsC,OAAtC,EAA+C,KAAKkB,qBAAL,CAA2Bze,IAA3B,CAAgC,IAAhC,CAA/C;CACA4B,IAAAA,eAAK,CAAC5B,IAAN,CAAW,KAAKwd,UAAhB,EAA4B,OAA5B,EAAqC,KAAKkB,iBAAL,CAAuB1e,IAAvB,CAA4B,IAA5B,CAArC;CAEA,QAAM2e,gBAAgB,GAAGC,oBAAU,CAACC,QAAX,CAAoB,6BAApB,IACtBD,oBAAU,CAACC,QAAX,CAAoB,6BAApB,EAAmDnI,QAD7B,GAEtB,IAFH;CAGA,QAAMoI,MAAM,GAAG,KAAKC,SAAL,EAAf;;CACA,QAAID,MAAM,IAAIH,gBAAd,EACA;CACC/c,MAAAA,eAAK,CAACmH,YAAN,CAAmBgB,SAAnB,CAA6B,0BAA7B,EAAyD,YAAM;CAC9D,YAAI,KAAI,CAACoU,SAAT,EACA;CACCQ,UAAAA,gBAAgB,CAACK,0BAAjB;CACA;CACD,OALD;CAMA;CACD;;;;kCAGD;CACC,aAAO,KAAKC,UAAL,GAAkBhlB,MAAlB,GAA2B,CAAlC;CACA;;;oCAGD;CACC,aAAO,KAAKqG,KAAL,CAAWC,QAAX,CAAoB,WAApB,EAAiC,YAAM;CAC7C,eAAO2e,QAAQ,CAACC,aAAT,CAAuB,SAAvB,CAAP;CACA,OAFM,CAAP;CAGA;;;uCAGD;CAAA;;CACC,aAAO,KAAK7e,KAAL,CAAWC,QAAX,CAAoB,cAApB,EAAoC,YAAM;CAChD,eAAO,MAAI,CAAC2K,YAAL,GAAoBiU,aAApB,CAAkC,mBAAlC,CAAP;CACA,OAFM,CAAP;CAGA;;;8CAGD;CAAA;;CACC,aAAO,KAAK7e,KAAL,CAAWC,QAAX,CAAoB,qBAApB,EAA2C,YAAM;CACvD,eAAO,MAAI,CAAC6e,eAAL,GAAuBD,aAAvB,CAAqC,oBAArC,CAAP;CACA,OAFM,CAAP;CAGA;;;4CAGD;CAAA;;CACC,aAAO,KAAK7e,KAAL,CAAWC,QAAX,CAAoB,mBAApB,EAAyC,YAAM;CACrD,eAAO,MAAI,CAAC2K,YAAL,GAAoBiU,aAApB,CAAkC,0BAAlC,CAAP;CACA,OAFM,CAAP;CAGA;;;kCAGD;CACC,aAAO,+BAAI,KAAKzB,UAAL,CAAgB2B,MAAhB,EAAJ,EAA8B9iB,MAA9B,CAAqC,UAACC,GAAD,EAAMqL,IAAN,EAAe;CAC1D,eAAOrL,GAAG,GAAGqL,IAAI,CAACyH,IAAX,GAAkB9S,GAAlB,GAAwBqL,IAAI,CAACyH,IAApC;CACA,OAFM,EAEJ,CAFI,CAAP;CAGA;;;wCAEkB3N,OACnB;CAAA;;CACCA,MAAAA,KAAK,CAACwL,cAAN;;CAEA,UACC,KAAK4Q,cAAL,IACG,KAAKC,uBAAL,IAAgC,CADnC,IAEG,KAAKA,uBAAL,GAA+B,KAAKN,UAAL,CAAgBtY,IAHnD,EAKA;CACC,eAAO8W,OAAO,CACZoD,cADK,CACU;CACf5f,UAAAA,IAAI,EAAEwC,aAAG,CAACC,UAAJ,CAAe,iCAAf,CADS;CAEfmN,UAAAA,IAAI,EAAE,KAAKiQ,UAAL,KAAoB;CAFX,SADV,EAKL1F,IALK,CAKA,UAACmD,QAAD,EAAc;CACnB,UAAA,MAAI,CAACwC,sBAAL,CAA4BxC,QAAQ,CAACrd,IAArC;;CAEA,cAAM8f,SAAS,GAAG,MAAI,CAACC,SAAL,EAAlB;;CACA,cAAMC,SAAS,4CACX3C,QAAQ,CAACrd,IAAT,CAAcigB,MAAd,CAAqBtK,CADV,kCAEX0H,QAAQ,CAACrd,IAAT,CAAcigB,MAAd,CAAqB/J,CAFV,kCAGXmH,QAAQ,CAACrd,IAAT,CAAcigB,MAAd,CAAqB3J,CAHV,EAAf;CAMA0J,UAAAA,SAAS,CAACtjB,OAAV,CAAkB,UAAAa,IAAI;CAAA,mBAAIuiB,SAAS,CAACrf,IAAV,CAAelD,IAAf,CAAJ;CAAA,WAAtB;;CAEA,cAAMqJ,QAAQ,GAAG,MAAI,CAACC,WAAL,CAAiBwW,QAAQ,CAACrd,IAAT,CAAcwW,EAA/B,CAAjB;;CAEA5P,UAAAA,QAAQ,CAAC8Q,eAAT,CAAyB,EAAzB;CACA9Q,UAAAA,QAAQ,CAACmM,aAAT,GACErW,OADF,CACU,UAAC0F,MAAD,EAAY;CACpB,YAAA,MAAI,CAAC+b,YAAL,CAAkBhN,MAAlB,CAAyB1Q,IAAzB,CAA8B;CAC7B0X,cAAAA,UAAU,EAAE/V,MAAM,CAACqH,OAAP,GAAiB7C,QAAjB,CAA0BzC,EADT;CAE7BoS,cAAAA,OAAO,EAAEnU,MAAM,CAACsC,KAAP,EAFoB;CAG7Bwb,cAAAA,MAAM,EAAE,KAHqB;CAI7BC,cAAAA,OAAO,EAAE;CAJoB,aAA9B;CAMA,WARF;;CAUA,cAAI,MAAI,CAACC,mBAAL,EAAJ,EACA;CACC,YAAA,MAAI,CAACC,gBAAL;CACA;CACD,SAlCK,EAmCLC,KAnCK,CAmCC,UAACjD,QAAD,EAAc;CACpB,UAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SArCK,CAAP;CAsCA,OA5CD,MA8CA;CACC,YACA;CACCmD,UAAAA,IAAI,CAAC,KAAKlC,oBAAN,CAAJ;CACA,SAHD,CAIA,OAAOmC,CAAP,EAAU;CACTC,UAAAA,OAAO,CAACjD,KAAR,CAAcgD,CAAd;CACA;;CAED,eAAOnF,OAAO,CAACC,OAAR,CAAgB,KAAhB,CAAP;CACA;CACD;;;2CAEqBvZ,OACtB;CACC,WAAK6c,kBAAL,CAAwB7c,KAAxB,EACEkY,IADF,CACO,UAACyG,OAAD,EAAa;CAClB,YAAIA,OAAJ,EACA;CACCpL,UAAAA,MAAM,CAACqL,QAAP,CAAgB,CAAhB,EAAmBrB,QAAQ,CAACsB,IAAT,CAAcC,YAAjC;CACA;CACD,OANF;CAOA;;;uCAEiB9e,OAClB;CACCA,MAAAA,KAAK,CAACwL,cAAN;;CAEA,UAAIjS,GAAG,CAACuT,EAAJ,CAAO0G,MAAX,EACA;CACCja,QAAAA,GAAG,CAACuT,EAAJ,CAAO0G,MAAP,CAAcjP,IAAd,CAAmB,8BAAnB;CACA;CACD;;;uCAGD;CAAA;;CACC,aAAO,KAAK5F,KAAL,CAAWC,QAAX,CAAoB,cAApB,EAAoC,YAAM;CAChD,eAAO,IAAIoc,YAAJ,CAAiB;CACvB7M,UAAAA,QAAQ,EAAE,MAAI,CAAC4Q,sBAAL,EADa;CAEvB7W,UAAAA,YAAY,EAAE,MAAI,CAACuV,eAAL,EAFS;CAGvBtb,UAAAA,EAAE,EAAE,MAHmB;CAIvBpE,UAAAA,IAAI,EAAE,MAJiB;CAKvB,qBAAW,KALY;CAMvBoR,UAAAA,MAAM,EAAE;CACPwE,YAAAA,CAAC,EAAEsH,gBAAgB,CAAC,CAAD,CADZ;CAEP/G,YAAAA,CAAC,EAAE+G,gBAAgB,CAAC,CAAD,CAFZ;CAGP3G,YAAAA,CAAC,EAAE2G,gBAAgB,CAAC,CAAD;CAHZ,WANe;CAWvBtN,UAAAA,IAAI,EAAE,CAXiB;CAYvByB,UAAAA,kBAAkB,EAAE,MAAI,CAAC4M,SAZF;CAavB3M,UAAAA,qBAAqB,EAAE,MAAI,CAAC4M,YAbL;CAcvB3M,UAAAA,kBAAkB,EAAE,MAAI,CAAC4M,iBAdF;CAevBlM,UAAAA,IAAI,EAAE,IAfiB;CAgBvBP,UAAAA,oBAAoB,EAAE,IAhBC;CAiBvBC,UAAAA,6BAA6B,EAAE,yCAAM,EAjBd;CAkBvBC,UAAAA,iBAAiB,EAAE,IAlBI;CAmBvBC,UAAAA,0BAA0B,EAAE,sCAAM,EAnBX;CAoBvBG,UAAAA,eAAe,EAAE,MAAI,CAACA;CApBC,SAAjB,CAAP;CAsBA,OAvBM,CAAP;CAwBA;;;wCAGD;CACC,WAAKiP,iBAAL,GAAyB,IAAzB;CACA,UAAMC,YAAY,GAAG,KAAKC,eAAL,EAArB;CACAD,MAAAA,YAAY,CAAChP,IAAb;CAEA,UAAMkP,aAAa,GAAG,+BAAI,KAAKpD,UAAL,CAAgB2B,MAAhB,EAAJ,EAA8B,CAA9B,CAAtB;;CALD,kCAOsByB,aAAa,CAACnO,gBAAd,GAAiCvD,UAAjC,EAPtB;CAAA;CAAA,UAOQnG,UAPR;;CAAA,kCAQoB2X,YAAY,CAACnO,iBAAb,GAAiCrD,UAAjC,EARpB;CAAA;CAAA,UAQQlG,QARR;;CAUC,UAAI,KAAKuI,mBAAT,EACA;CACCxI,QAAAA,UAAU,CAAC/M,MAAX,CAAkB6kB,aAAlB,CAAgC7X,QAAQ,CAAChN,MAAzC,EAAiD,IAAjD;CACA;CACD;;;wCAGD;CACC,WAAKykB,iBAAL,GAAyB,KAAzB;CACA,WAAKE,eAAL,GACEjgB,MADF;CAEA,WAAKN,KAAL,CAAW9B,MAAX,CAAkB,cAAlB;CACA;;;2CAGD;CACC,aAAO,KAAKmiB,iBAAZ;CACA;;;0CAGD;CACC,UAAI,CAAC,KAAK7E,UAAL,EAAL,EACA;CACC,aAAKwC,gBAAL;CACA;CACA;;CAED,WAAK0B,gBAAL;CACA;;;4CAEsB3gB,SACvB;CAAA;;CACC,UAAIyR,MAAM,GAAGzR,OAAO,CAACugB,MAArB;;CACA,UAAI,CAAC,KAAKlO,eAAV,EACA;CACCZ,QAAAA,MAAM,GAAG;CACRwE,UAAAA,CAAC,EAAEsH,gBAAgB,CAAC,CAAD,CADX;CAER/G,UAAAA,CAAC,EAAE+G,gBAAgB,CAAC,CAAD,CAFX;CAGR3G,UAAAA,CAAC,EAAE2G,gBAAgB,CAAC,CAAD;CAHX,SAAT;CAKA;;CACD,UAAMrW,QAAQ,GAAG,IAAIsJ,QAAJ,CAAa;CAC7BC,QAAAA,QAAQ,EAAE,KAAK4Q,sBAAL,EADmB;CAE7B7W,QAAAA,YAAY,EAAE,KAAKuV,eAAL,EAFe;CAG7Btb,QAAAA,EAAE,EAAEzE,OAAO,CAAC8W,EAHiB;CAI7BzW,QAAAA,IAAI,EAAEL,OAAO,CAACoW,IAJe;CAK7B,mBAAYpW,OAAO,CAAC2hB,UAAR,KAAuB,GALN;CAM7BlQ,QAAAA,MAAM,EAAEA,MANqB;CAO7BxB,QAAAA,IAAI,EAAEjQ,OAAO,CAAC4hB,IAPe;CAQ7B1Q,QAAAA,MAAM,EAAElR,OAAO,CAAC6hB,MARa;CAS7BnQ,QAAAA,kBAAkB,EAAE,KAAK4M,SATI;CAU7B3M,QAAAA,qBAAqB,EAAE,KAAK4M,YAVC;CAW7B3M,QAAAA,kBAAkB,EAAE,KAAK4M,iBAXI;CAY7BjN,QAAAA,eAAe,EAAEvR,OAAO,CAAC8hB,QAZI;CAa7BtQ,QAAAA,iBAAiB,EAAExR,OAAO,CAAC+hB,WAbE;CAc7Bpf,QAAAA,cAAc,EAAE,KAAKA,cAdQ;CAe7BoP,QAAAA,oBAAoB,EAAE,KAAKA,oBAfE;CAgB7BC,QAAAA,6BAA6B,EAAE,KAAKA,6BAhBP;CAiB7BC,QAAAA,iBAAiB,EAAE,KAAKA,iBAjBK;CAkB7BC,QAAAA,0BAA0B,EAAE,KAAKA,0BAlBJ;CAmB7BE,QAAAA,mBAAmB,EAAE,KAAKA,mBAnBG;CAoB7BD,QAAAA,iBAAiB,EAAE,KAAKA,iBApBK;CAqB7BE,QAAAA,eAAe,EAAE,KAAKA;CArBO,OAAb,CAAjB;CAwBAnL,MAAAA,QAAQ,CACNwD,SADF,CACY,qBADZ,EACmC,UAACpI,KAAD,EAAW;CAAA,0BAChBA,KAAK,CAAChC,IADU;CAAA,YACrCmY,UADqC,eACrCA,UADqC;CAAA,YACzBhe,KADyB,eACzBA,KADyB;CAG5CoiB,QAAAA,OAAO,CACLmF,cADF,CACiB;CACfvd,UAAAA,EAAE,EAAEgU,UADW;CAEfwJ,UAAAA,MAAM,EAAE;CACP7L,YAAAA,IAAI,EAAE3b;CADC;CAFO,SADjB,EAOE+f,IAPF,CAOO,YAAM;CACX0H,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAKA,UAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CACA,SAdF,EAeE8B,KAfF,CAeQ,UAACjD,QAAD,EAAc;CACpB,UAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SAjBF;CAkBA,OAtBF,EAuBEjT,SAvBF,CAuBY,iBAvBZ,EAuB+B,UAACpI,KAAD,EAAW;CAAA,2BACXA,KAAK,CAAChC,IADK;CAAA,YACjCmY,UADiC,gBACjCA,UADiC;CAAA,YACrBvH,MADqB,gBACrBA,MADqB;CAGxC2L,QAAAA,OAAO,CACL0F,cADF,CACiB;CACf9d,UAAAA,EAAE,EAAEgU,UADW;CAEfvH,UAAAA,MAAM,EAAGA;CAFM,SADjB,EAKEsJ,IALF,CAKO,YAAM;CACX0H,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAKA,SAXF,EAYE0Z,KAZF,CAYQ,UAACjD,QAAD,EAAc;CACpB,UAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SAdF;CAeA,OAzCF,EA0CEjT,SA1CF,CA0CY,sBA1CZ,EA0CoC,UAACpI,KAAD,EAAW;CAAA,2BACPA,KAAK,CAAChC,IADC;CAAA,YACtCmY,UADsC,gBACtCA,UADsC;CAAA,YAC1Bc,eAD0B,gBAC1BA,eAD0B;CAG7CsD,QAAAA,OAAO,CACL2F,kBADF,CACqB;CACnB/d,UAAAA,EAAE,EAAEgU,UADe;CAEnBgK,UAAAA,OAAO,EAAGlJ;CAFS,SADrB,EAKEiB,IALF,CAKO,YAAM;CACX0H,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAKA,SAXF,EAYE0Z,KAZF,CAYQ,UAACjD,QAAD,EAAc;CACpB,UAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SAdF;CAeA,OA5DF,EA6DEjT,SA7DF,CA6DY,iBA7DZ,EA6D+B,UAACpI,KAAD,EAAW;CACxCua,QAAAA,OAAO,CACL6F,cADF,CACiB;CACfje,UAAAA,EAAE,EAAEnC,KAAK,CAAChC,IAAN,CAAWmY;CADA,SADjB,EAIE+B,IAJF,CAIO,YAAM;CACXlY,UAAAA,KAAK,CAAChC,IAAN,CAAW2O,SAAX;CACAiT,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAMAnH,UAAAA,UAAU,CAAC,YAAM;CAChB,gBAAI,MAAI,CAAC2gB,mBAAL,EAAJ,EACA;CACC,cAAA,MAAI,CAACC,gBAAL;;CACA,cAAA,MAAI,CAAC1B,gBAAL;;CACA;CACA;;CAED,YAAA,MAAI,CAAC0D,kBAAL;CACA,WATS,CAAV;CAUA,UAAA,MAAI,CAAC7D,SAAL,GAAiB,IAAjB;CACA,SAvBF,EAwBE8B,KAxBF,CAwBQ,UAACjD,QAAD,EAAc;CACpBrb,UAAAA,KAAK,CAAChC,IAAN,CAAW6O,QAAX;;CACA,UAAA,MAAI,CAAC0R,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SA3BF;CA4BA,OA1FF,EA2FEjT,SA3FF,CA2FY,aA3FZ,EA2F2B,UAACpI,KAAD,EAAW;CACpC,YAAI,CAAC,MAAI,CAAC8P,mBAAV,EACA;CACC;CACA;;CACD,YAAI,CAAC9P,KAAK,CAAChC,IAAN,CAAWtB,WAAhB,EACA;CACC,cAAMlB,IAAI,GAAG;CACZoJ,YAAAA,QAAQ,EAAE5E,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBQ,IAAhB,CAAqBiM,OAArB,GAA+BrH,MAA/B,CAAsCqH,OAAtC,GAAgD7C,QAAhD,CAAyDzC,EADvD;CAEZyR,YAAAA,KAAK,EAAE5T,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBQ,IAAhB,CAAqBiM,OAArB,GAA+BrH,MAA/B,CAAsCpC,IAAtC,CAA2C4V,KAA3C,CAAiDC;CAF5C,WAAb;CAKA,cAAM/X,EAAE,GAAG;CACV8I,YAAAA,QAAQ,EAAE5E,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBc,EAAhB,CAAmB2L,OAAnB,GAA6BrH,MAA7B,CAAoCqH,OAApC,GAA8C7C,QAA9C,CAAuDzC,EADvD;CAEVyR,YAAAA,KAAK,EAAE5T,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBc,EAAhB,CAAmB2L,OAAnB,GAA6BrH,MAA7B,CAAoCpC,IAApC,CAAyC4V,KAAzC,CAA+CC;CAF5C,WAAX;CAIA,cAAM9W,WAAW,GAAGiD,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgB+B,WAApC;CAEAwd,UAAAA,OAAO,CACL+F,WADF,CACc;CAAC9kB,YAAAA,IAAI,EAAJA,IAAD;CAAOM,YAAAA,EAAE,EAAFA,EAAP;CAAWiB,YAAAA,WAAW,EAAXA;CAAX,WADd,EAEEmb,IAFF,CAEO,UAACmD,QAAD,EAA0D;CAC/DuE,YAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,cAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,cAAAA,aAAa,EAAE,IAFc;CAG7Bpb,cAAAA,QAAQ,EAAE;CAHmB,aAA9B;;CAMA,gBAAMgP,KAAK,GAAG,MAAI,CAACmK,SAAL,GAAiBzjB,IAAjB,CAAsB,UAACiB,IAAD,EAAU;CAC7C,qBACCoM,MAAM,CAACpM,IAAI,CAACglB,WAAN,CAAN,KAA6B5Y,MAAM,CAAC0T,QAAQ,CAACrd,IAAT,CAAcwiB,MAAd,CAAqBC,WAAtB,CAAnC,IACG9Y,MAAM,CAACpM,IAAI,CAACsY,SAAN,CAAN,KAA2BlM,MAAM,CAAC0T,QAAQ,CAACrd,IAAT,CAAcwiB,MAAd,CAAqBE,QAAtB,CAFrC;CAIA,aALa,CAAd;;CAOA9M,YAAAA,KAAK,CAAC+M,OAAN,CAAcliB,IAAd,CAAmB4c,QAAQ,CAACrd,IAAT,CAAcwiB,MAAjC;CACA,WAjBF,EAkBElC,KAlBF,CAkBQ,UAACjD,QAAD,EAAc;CACpB,gBAAMrgB,IAAI,GAAGgF,KAAK,CAAChC,IAAN,CAAWhD,IAAxB;CACAA,YAAAA,IAAI,CAACQ,IAAL,CAAUuG,UAAV,CAAqB/G,IAArB,EAA2B,IAA3B;;CACA,YAAA,MAAI,CAACujB,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,WAtBF;CAuBA;;CAED,QAAA,MAAI,CAACgD,gBAAL;CACA,OAvIF,EAwIEjW,SAxIF,CAwIY,uBAxIZ,EAwIqC,UAACpI,KAAD,EAAW;CAC9C,YAAI,CAAC,MAAI,CAAC8P,mBAAV,EACA;CACC;CACA;;CACD,YAAI,CAAC9P,KAAK,CAAChC,IAAN,CAAWtB,WAAhB,EACA;CACC,cAAM4K,UAAU,GAAGtH,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBQ,IAAhB,CAAqBiM,OAArB,GAA+BrH,MAAlD;CACA,cAAMmH,QAAQ,GAAGvH,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBc,EAAhB,CAAmB2L,OAAnB,GAA6BrH,MAA9C;CACA,cAAMqgB,WAAW,GAAGnZ,UAAU,CAACG,OAAX,GAAqB7C,QAArB,CAA8BzC,EAAlD;CACA,cAAMue,QAAQ,GAAGpZ,UAAU,CAAC5E,KAAX,EAAjB;CACA,cAAMke,WAAW,GAAGrZ,QAAQ,CAACE,OAAT,GAAmB7C,QAAnB,CAA4BzC,EAAhD;CACA,cAAM0e,QAAQ,GAAGtZ,QAAQ,CAAC7E,KAAT,EAAjB;;CACA,cAAM8d,MAAM,GAAG,MAAI,CAACM,eAAL,CAAqB9gB,KAAK,CAAChC,IAAN,CAAWhD,IAAhC,CAAf;;CAEA,cAAIwlB,MAAJ,EACA;CACC,gBAAMO,cAAc,GAAG;CACtBN,cAAAA,WAAW,EAAXA,WADsB;CAEtBC,cAAAA,QAAQ,EAARA,QAFsB;CAGtBE,cAAAA,WAAW,EAAXA,WAHsB;CAItBC,cAAAA,QAAQ,EAARA,QAJsB;CAKtBG,cAAAA,KAAK,EAAER,MAAM,CAACQ;CALQ,aAAvB;CAQAzG,YAAAA,OAAO,CACL0G,WADF,CACcF,cADd,EAEE7I,IAFF,CAEO,YAAM;CACX0H,cAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,gBAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,gBAAAA,aAAa,EAAE,IAFc;CAG7Bpb,gBAAAA,QAAQ,EAAE;CAHmB,eAA9B;CAKA,aARF,EASE0Z,KATF,CASQ,UAACjD,QAAD,EAAc;CACpB,cAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,aAXF;;CAaA,gBAAMzH,KAAK,GAAG,MAAI,CAACsN,gBAAL,CAAsBR,QAAtB,CAAd;;CAEA9M,YAAAA,KAAK,CAAC+M,OAAN,GAAgB/M,KAAK,CAAC+M,OAAN,CAAcvc,MAAd,CAAqB,UAAC7I,IAAD,EAAU;CAC9C,qBAAO,EACNoM,MAAM,CAACpM,IAAI,CAACmlB,QAAN,CAAN,KAA0B/Y,MAAM,CAAC+Y,QAAD,CAAhC,IACG/Y,MAAM,CAACpM,IAAI,CAACklB,WAAN,CAAN,KAA6B9Y,MAAM,CAAC8Y,WAAD,CADtC,IAEG9Y,MAAM,CAACpM,IAAI,CAACslB,QAAN,CAAN,KAA0BlZ,MAAM,CAACkZ,QAAD,CAFnC,IAGGlZ,MAAM,CAACpM,IAAI,CAACqlB,WAAN,CAAN,KAA6BjZ,MAAM,CAACiZ,WAAD,CAJhC,CAAP;CAMA,aAPe,CAAhB;;CASA,YAAA,MAAI,CAACP,kBAAL;CACA;CACD;CACD,OA5LF,EA6LEjY,SA7LF,CA6LY,0BA7LZ,EA6LwC,UAACpI,KAAD,EAAW;CACjD,YAAI,CAAC,MAAI,CAAC8P,mBAAN,IAA6B9P,KAAK,CAAChC,IAAN,CAAWtB,WAA5C,EACA;CACC;CACA;;CACD,YAAM4K,UAAU,GAAGtH,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBQ,IAAhB,CAAqBiM,OAArB,GAA+BrH,MAAlD;CACA,YAAMmH,QAAQ,GAAGvH,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBc,EAAhB,CAAmB2L,OAAnB,GAA6BrH,MAA9C;CACA,YAAMqgB,WAAW,GAAGnZ,UAAU,CAACG,OAAX,GAAqB7C,QAArB,CAA8BzC,EAAlD;CACA,YAAMue,QAAQ,GAAGpZ,UAAU,CAAC5E,KAAX,EAAjB;CACA,YAAMke,WAAW,GAAGrZ,QAAQ,CAACE,OAAT,GAAmB7C,QAAnB,CAA4BzC,EAAhD;CACA,YAAM0e,QAAQ,GAAGtZ,QAAQ,CAAC7E,KAAT,EAAjB;;CACA,YAAM8d,MAAM,GAAG,MAAI,CAACM,eAAL,CAAqB9gB,KAAK,CAAChC,IAAN,CAAWhD,IAAhC,CAAf;;CAEA,YAAIwlB,MAAJ,EACA;CACC,cAAMhlB,IAAI,GAAG;CACZoJ,YAAAA,QAAQ,EAAE6b,WADE;CAEZ7M,YAAAA,KAAK,EAAE8M;CAFK,WAAb;CAIA,cAAM5kB,EAAE,GAAG;CACV8I,YAAAA,QAAQ,EAAEgc,WADA;CAEVhN,YAAAA,KAAK,EAAEiN;CAFG,WAAX;CAKAtG,UAAAA,OAAO,CACL0G,WADF,CACcT,MADd,EAEEtI,IAFF,CAEO,YAAM;CACXqC,YAAAA,OAAO,CACL+F,WADF,CACc;CAAC9kB,cAAAA,IAAI,EAAJA,IAAD;CAAOM,cAAAA,EAAE,EAAFA,EAAP;CAAWiB,cAAAA,WAAW,EAAEiD,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgB+B;CAAxC,aADd,EAEEmb,IAFF,CAEO,UAACmD,QAAD,EAA0D;CAC/DuE,cAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,gBAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,gBAAAA,aAAa,EAAE,IAFc;CAG7Bpb,gBAAAA,QAAQ,EAAE;CAHmB,eAA9B;;CAMA,kBAAMgP,KAAK,GAAG,MAAI,CAACsN,gBAAL,CAAsBR,QAAtB,CAAd;;CAEA,kBAAM1jB,KAAK,GAAG4W,KAAK,CAAC+M,OAAN,CAAcpP,SAAd,CAAwB,UAAChW,IAAD,EAAU;CAC/C,uBACCoM,MAAM,CAACpM,IAAI,CAACmlB,QAAN,CAAN,KAA0B/Y,MAAM,CAAC+Y,QAAD,CAAhC,IACG/Y,MAAM,CAACpM,IAAI,CAACklB,WAAN,CAAN,KAA6B9Y,MAAM,CAAC8Y,WAAD,CADtC,IAEG9Y,MAAM,CAACpM,IAAI,CAACslB,QAAN,CAAN,KAA0BlZ,MAAM,CAACkZ,QAAD,CAFnC,IAGGlZ,MAAM,CAACpM,IAAI,CAACqlB,WAAN,CAAN,KAA6BjZ,MAAM,CAACiZ,WAAD,CAJvC;CAMA,eAPa,CAAd;;CASA,kBAAI5jB,KAAK,IAAI,CAAb,EACA;CACC4W,gBAAAA,KAAK,CAAC+M,OAAN,CAAc3jB,KAAd,IAAuBqe,QAAQ,CAACrd,IAAT,CAAcwiB,MAArC;CACA;;CAEDxgB,cAAAA,KAAK,CAAChC,IAAN,CAAWqE,gBAAX;CACA,aA1BF,EA2BEic,KA3BF,CA2BQ,UAACjD,QAAD;CAAA,qBAAc,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD,CAAd;CAAA,aA3BR;CA4BA,WA/BF,EAgCEiD,KAhCF,CAgCQ,UAACjD,QAAD;CAAA,mBAAc,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD,CAAd;CAAA,WAhCR;CAiCA;CACD,OAvPF,EAwPEjT,SAxPF,CAwPY,iBAxPZ,EAwP+B,UAACpI,KAAD,EAAW;CACxC,YAAI,CAAC,MAAI,CAAC8P,mBAAV,EACA;CACC;CACA;;CACD,YAAM0Q,MAAM,GAAG,MAAI,CAACM,eAAL,CAAqB9gB,KAAK,CAAChC,IAAN,CAAWhD,IAAhC,CAAf,CALwC;;;CAQxC8R,QAAAA,EAAE,CAACqU,OAAH,CAAWC,UAAX,CAAsBC,GAAtB,CAA0BC,iBAA1B,CACCd,MAAM,CAACQ,KADR,EAEC,MAAI,CAACrF,YAFN,EAGC6E,MAAM,CAACE,QAHR,EAIC,UAACM,KAAD,EAAW;CACVR,UAAAA,MAAM,CAACQ,KAAP,GAAeA,KAAK,CAACO,SAAN,EAAf;CAEAhH,UAAAA,OAAO,CACLQ,OADF,CACU;CACR3Y,YAAAA,MAAM,EAAE,aADA;CAERoY,YAAAA,cAAc,EAAE;CACfI,cAAAA,SAAS,EAAEL,OAAO,CAACK,SADJ;CAEfxY,cAAAA,MAAM,EAAE;CAFO,aAFR;CAMRpE,YAAAA,IAAI,EAAEwiB;CANE,WADV,EASEtI,IATF,CASO,YAAM;CACX0H,YAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,cAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,cAAAA,aAAa,EAAE,IAFc;CAG7Bpb,cAAAA,QAAQ,EAAE;CAHmB,aAA9B;CAMA4b,YAAAA,MAAM,CAACI,WAAP,GAAqBI,KAAK,CAACQ,WAAN,CAAkB,YAAlB,CAArB;CACAhB,YAAAA,MAAM,CAACK,QAAP,GAAkBG,KAAK,CAACQ,WAAN,CAAkB,SAAlB,CAAlB;;CAEA,gBAAM5c,QAAQ,GAAG,MAAI,CAACC,WAAL,CAAiB2b,MAAM,CAACI,WAAxB,CAAjB;;CACA,gBAAMxgB,MAAM,GAAGwE,QAAQ,CAAC6c,eAAT,CAAyBjB,MAAM,CAACK,QAAhC,CAAf;CAEA7gB,YAAAA,KAAK,CAAChC,IAAN,CAAWhD,IAAX,CAAgBQ,IAAhB,CAAqBkmB,UAArB,CAAgC1hB,KAAK,CAAChC,IAAN,CAAWhD,IAA3C,EAAiDoF,MAAM,CAAC7F,MAAxD,EAAgE,IAAhE;;CAEA,YAAA,MAAI,CAAC8lB,kBAAL;CACA,WAzBF,EAyBI/B,KAzBJ,CAyBU,UAACjD,QAAD,EAAc;CACtB,YAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,WA3BF;CA4BA,SAnCF;CAqCA,OArSF,EAsSEjT,SAtSF,CAsSY,eAtSZ,EAsS6B,YAAM;CACjC,YAAMuZ,OAAO,GAAGzT,QAAQ,CAAC7T,SAAT,CACd+J,MADc,CACP,UAAAQ,QAAQ;CAAA,iBAAIA,QAAQ,CAACzC,EAAT,KAAgB,MAApB;CAAA,SADD,EAEd2D,GAFc,CAEV,UAAClB,QAAD,EAAW5H,KAAX,EAAqB;CACzB,iBAAOud,OAAO,CACZmF,cADK,CACU;CACfvd,YAAAA,EAAE,EAAEyC,QAAQ,CAACzC,EADE;CAEfwd,YAAAA,MAAM,EAAE;CACPL,cAAAA,IAAI,EAAE,CAACtiB,KAAK,GAAC,CAAP,IAAY;CADX;CAFO,WADV,CAAP;CAOA,SAVc,CAAhB;CAYAsc,QAAAA,OAAO,CAACsI,GAAR,CAAYD,OAAZ,EACEzJ,IADF,CACO,YAAM;CACX0H,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAKA,UAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CACA,SARF;CASA,OA5TF,EA6TEpU,SA7TF,CA6TY,eA7TZ,EA6T6B,UAACpI,KAAD,EAAW;CACtC,YAAI,CAAC5H,cAAI,CAACgJ,KAAL,CAAWpB,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuBuW,OAAlC,CAAL,EACA;CACC,cAAM4F,UAAU,GAAG,MAAI,CAACrK,mBAAL,GAA2B,+BAAI3V,MAAM,CAACkB,WAAP,EAAJ,EAA0BkH,IAA1B,CAA+B,UAAChH,IAAD,EAAU;CACtF,mBACCyE,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkB7F,MAAlB,KAA6BgB,IAAI,CAACC,IAAlC,IACGwE,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkB7F,MAAlB,KAA6BgB,IAAI,CAACO,EAFtC;CAIA,WAL6C,CAA3B,GAKd,KALL;CAOAye,UAAAA,OAAO,CACLsH,WADF,CACc;CACZxI,YAAAA,QAAQ,EAAErZ,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBsC,KAAlB,EADE;CAEZ6R,YAAAA,OAAO,EAAEvU,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuBuW,OAFpB;CAGZE,YAAAA,QAAQ,EAAEzU,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuByW;CAHrB,WADd,EAMEyD,IANF,CAMO,YAAM;CACXlY,YAAAA,KAAK,CAAChC,IAAN,CAAW2O,SAAX;;CAEA,gBAAI,CAACwN,UAAL,EACA;CACCyF,cAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,gBAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,gBAAAA,aAAa,EAAE,IAFc;CAG7Bpb,gBAAAA,QAAQ,EAAE;CAHmB,eAA9B;CAKA,cAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CACA;CACD,WAlBF,EAmBE8B,KAnBF,CAmBQ,UAACjD,QAAD,EAAc;CACpBrb,YAAAA,KAAK,CAAChC,IAAN,CAAW6O,QAAX;;CACA,YAAA,MAAI,CAAC0R,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,WAtBF;CAuBA;CACD,OA/VF,EAgWEjT,SAhWF,CAgWY,eAhWZ,EAgW6B,UAACpI,KAAD,EAAW;CACtCua,QAAAA,OAAO,CACLuH,WADF,CACc;CACZzI,UAAAA,QAAQ,EAAErZ,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBsC,KAAlB,EADE;CAEZ6R,UAAAA,OAAO,EAAEvU,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuBuW,OAFpB;CAGZE,UAAAA,QAAQ,EAAEzU,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuByW,QAHrB;CAIZ1W,UAAAA,IAAI,EAAEiC,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkB2H,OAAlB,EAJM;CAKZ4F,UAAAA,IAAI,EAAE3N,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkBpC,IAAlB,CAAuB4V,KAAvB,CAA6B0L,IALvB;CAMZ9S,UAAAA,KAAK,EAAExM,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkB2hB,QAAlB;CANK,SADd,EASE7J,IATF,CASO,gBAAY;CAAA,cAAVla,IAAU,QAAVA,IAAU;;CACjB,cAAIA,IAAI,CAAC2gB,OAAT,EACA;CACCiB,YAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,cAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,cAAAA,aAAa,EAAE,IAFc;CAG7Bpb,cAAAA,QAAQ,EAAE;CAHmB,aAA9B;CAKA,YAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CACA,WARD,MAUA;CACC,YAAA,MAAI,CAAC+B,cAAL,CAAoBnD,4BAA4B,CAAC;CAACpd,cAAAA,IAAI,EAAJA;CAAD,aAAD,CAAhD;CACA;CACD,SAvBF;CAwBA,OAzXF,EA0XEoK,SA1XF,CA0XY,kBA1XZ,EA0XgC,UAACpI,KAAD,EAAW;CACzCua,QAAAA,OAAO,CACLyH,QADF,CACW;CACTjkB,UAAAA,IAAI,EAAEiC,KAAK,CAAChC,IAAN,CAAWoC,MAAX,CAAkB6hB,OAAlB,GAA4BzhB,UAA5B,CAAuC,0BAAvC,CADG;CAETmN,UAAAA,IAAI,EAAG,YAAM;CAAA,gBACLvN,MADK,GACKJ,KAAK,CAAChC,IADX,CACLoC,MADK;CAGZ,mBAAOyO,MAAM,CAACzO,MAAM,CAACpC,IAAP,CAAY4V,KAAZ,CAAkB0L,IAAnB,CAAN,GAAiC,CAAxC;CACA,WAJK,EAFG;CAOT7K,UAAAA,QAAQ,EAAG,YAAM;CAAA,gBACTrU,MADS,GACCJ,KAAK,CAAChC,IADP,CACToC,MADS;CAGhB,mBAAOA,MAAM,CAACpC,IAAP,CAAY4V,KAAZ,CAAkBc,SAAzB;CACA,WAJS,EAPD;CAYTlI,UAAAA,KAAK,EAAEM,EAAE,CAACO,MAAH,CAAUxF,MAAV,CAAiBqa,aAZf;CAaTC,UAAAA,SAAS,EAAG,YAAM;CAAA,gBACV/hB,MADU,GACAJ,KAAK,CAAChC,IADN,CACVoC,MADU;CAGjB,mBAAOA,MAAM,CAACpC,IAAP,CAAY4V,KAAZ,CAAkBwO,SAAzB;CACA,WAJU,EAbF;CAkBTjM,UAAAA,UAAU,EAAG,YAAM;CAAA,gBACX/V,MADW,GACDJ,KAAK,CAAChC,IADL,CACXoC,MADW;CAGlB,mBAAOA,MAAM,CAACpC,IAAP,CAAY4G,QAAZ,CAAqBzC,EAA5B;CACA,WAJW;CAlBH,SADX,EAyBE+V,IAzBF,CAyBO,iBAAY;CAAA,cAAVla,IAAU,SAAVA,IAAU;CACjB4hB,UAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,YAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,YAAAA,aAAa,EAAE,IAFc;CAG7Bpb,YAAAA,QAAQ,EAAE;CAHmB,WAA9B;CAKA,UAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CANiB,cAQV5I,KARU,GAQD5V,IARC,CAQV4V,KARU;CASjB,cAAMyO,UAAU,GAAGriB,KAAK,CAAChC,IAAN,CAAWoC,MAA9B;CACA,cAAMkiB,IAAI,GAAGD,UAAU,CAACJ,OAAX,EAAb;;CACA,cAAMrd,QAAQ,GAAG,MAAI,CAACC,WAAL,CAAiBwd,UAAU,CAACrkB,IAAX,CAAgB4G,QAAhB,CAAyBzC,EAA1C,CAAjB;;CAEAyR,UAAAA,KAAK,CAAC+M,OAAN,GAAgB,EAAhB;;CAEA,UAAA,MAAI,CAAC5C,SAAL,GAAiBtf,IAAjB,CAAsBmV,KAAtB;;CAEA,cAAM2O,QAAQ,GAAGD,IAAI,CAACE,oBAAL,CAA0BH,UAA1B,CAAjB,CAjBiB;;CAmBjB,cAAMjiB,MAAM,GAAGkiB,IAAI,CAACG,SAAL,CAAe;CAC7BtgB,YAAAA,EAAE,EAAEyR,KAAK,CAACC,SADmB;CAE7B9V,YAAAA,IAAI,EAAE6V,KAAK,CAACE,IAFiB;CAG7BtH,YAAAA,KAAK,EAAEoH,KAAK,CAACG,KAAN,CAAYpR,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CAHsB;CAI7B3E,YAAAA,IAAI,EAAE4G,QAAQ,CAACoP,aAAT,CAAuBJ,KAAvB,CAJuB;CAK7B2O,YAAAA,QAAQ,EAARA;CAL6B,WAAf,CAAf;CAOAniB,UAAAA,MAAM,CAACsiB,gBAAP;CACAvoB,UAAAA,MAAM,CAACyP,WAAP;CACA,SArDF,EAsDE0U,KAtDF,CAsDQ,UAACjD,QAAD,EAAc;CACpB,UAAA,MAAI,CAACkD,cAAL,CAAoBnD,4BAA4B,CAACC,QAAD,CAAhD;CACA,SAxDF;CAyDA,OApbF,EAqbEjT,SArbF,CAqbY,aArbZ,EAqb2B,UAACpI,KAAD,EAAW;CACpC,YAAM2iB,QAAQ,GAAG3iB,KAAK,CAAChC,IAAN,CAAW2Q,OAAX,CAAmB7I,GAAnB,CAAuB,UAAC1F,MAAD,EAASpD,KAAT,EAAmB;CAC1D,cAAM4lB,UAAU,GAAG,CAAC5lB,KAAK,GAAG,CAAT,IAAc,GAAjC;CACA,cAAM6lB,UAAU,GAAG;CAClBxJ,YAAAA,QAAQ,EAAEjZ,MAAM,CAACsC,KAAP,EADQ;CAElB6R,YAAAA,OAAO,EAAEnU,MAAM,CAACpC,IAAP,CAAYuW,OAFH;CAGlBE,YAAAA,QAAQ,EAAErU,MAAM,CAACpC,IAAP,CAAYyW,QAHJ;CAIlB1W,YAAAA,IAAI,EAAEqC,MAAM,CAAC2H,OAAP,EAJY;CAKlB4F,YAAAA,IAAI,EAAEiV,UALY;CAMlBpW,YAAAA,KAAK,EAAEpM,MAAM,CAAC2hB,QAAP;CANW,WAAnB;CASA3hB,UAAAA,MAAM,CAACpC,IAAP,CAAY4V,KAAZ,CAAkB0L,IAAlB,GAAyBsD,UAAzB;CAEA,iBAAOC,UAAP;CACA,SAdgB,CAAjB;CAgBAtI,QAAAA,OAAO,CACLuI,YADF,CACeH,QADf,EAEEzK,IAFF,CAEO,iBAAY;CAAA,cAAVla,IAAU,SAAVA,IAAU;CACjB,cAAM2gB,OAAO,GAAG3gB,IAAI,CAACzF,KAAL,CAAW,UAACgD,IAAD,EAAU;CACpC,mBAAOA,IAAI,CAACojB,OAAZ;CACA,WAFe,CAAhB;;CAIA,cAAIA,OAAJ,EACA;CACCiB,YAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BnG,cAAAA,OAAO,EAAErZ,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADoB;CAE7Bwf,cAAAA,aAAa,EAAE,IAFc;CAG7Bpb,cAAAA,QAAQ,EAAE;CAHmB,aAA9B;CAKA,YAAA,MAAI,CAAC4X,SAAL,GAAiB,IAAjB;CACA,WARD,MAUA;CACC,YAAA,MAAI,CAAC+B,cAAL,CAAoBnD,4BAA4B,CAAC;CAACpd,cAAAA,IAAI,EAAJA;CAAD,aAAD,CAAhD;CACA;CACD,SApBF;CAqBA,OA3dF,EA4dEoK,SA5dF,CA4dY,uBA5dZ,EA4dqC,YAAM;CACzC,QAAA,MAAI,CAAC2a,MAAL;CACA,OA9dF,EA+dE3a,SA/dF,CA+dY,cA/dZ,EA+d4B,UAACpI,KAAD,EAAW;CACrC,QAAA,MAAI,CAACue,cAAL,CAAoBnD,4BAA4B,CAAC;CAChDpd,UAAAA,IAAI,EAAE;CACLsd,YAAAA,MAAM,EAAE,CAACtb,KAAK,CAAChC,IAAN,CAAWsC,OAAZ;CADH;CAD0C,SAAD,CAAhD;CAKA,OAreF;CAueA,WAAKyb,UAAL,CAAgBiH,GAAhB,CAAoBrb,MAAM,CAACjK,OAAO,CAAC8W,EAAT,CAA1B,EAAwC5P,QAAxC;CACA;;;oCAEctE,SACf;CACC,UAAI,CAAC,KAAK2iB,UAAV,EACA;CACC,aAAKA,UAAL,GAAkB,IAAIzJ,sBAAJ,CAAgB;CACjCG,UAAAA,QAAQ,EAAEpZ,aAAG,CAACC,UAAJ,CAAe,0BAAf,CADuB;CAEjChH,UAAAA,KAAK,EAAE,GAF0B;CAGjC0pB,UAAAA,SAAS,EAAE,IAHsB;CAIjCrJ,UAAAA,OAAO,EAAE,CACR,IAAII,gCAAJ,CAA0B;CACzB9X,YAAAA,EAAE,EAAE,OADqB;CAEzBR,YAAAA,IAAI,EAAEpB,aAAG,CAACC,UAAJ,CAAe,uCAAf,CAFmB;CAGzBK,YAAAA,MAAM,EAAE;CACPkZ,cAAAA,KADO,mBACC;CACP,qBAAKC,WAAL,CAAiBzY,KAAjB;CACA;CAHM;CAHiB,WAA1B,CADQ;CAJwB,SAAhB,CAAlB;CAgBA;;CAED,WAAK0hB,UAAL,CAAgBvW,UAAhB,CAA2BpM,OAA3B;CACA,WAAK2iB,UAAL,CAAgB1e,IAAhB;CACA;;;iCAGD;CACC;CACA,aAAOuI,EAAE,CAACgI,SAAH,CAAaC,QAAb,CAAsBqI,SAAtB,CACN7J,MAAM,CAAC4P,QAAP,CAAgBC,QADV,CAAP;CAGA;;;8BAGD;CACC,UAAMjG,MAAM,GAAG,KAAKC,SAAL,EAAf;;CAEA,UAAID,MAAJ,EACA;CACCA,QAAAA,MAAM,CAAC4F,MAAP;CACA;CACD;;;sCAEgB5gB,IACjB;CACC,aAAO,KAAK4b,SAAL,GAAiBzjB,IAAjB,CAAsB,UAAAsZ,KAAK;CAAA,eAAIjM,MAAM,CAACiM,KAAK,CAACC,SAAP,CAAN,KAA4BlM,MAAM,CAACxF,EAAD,CAAtC;CAAA,OAA3B,CAAP;CACA;;;qCAEenH,MAChB;CACC,UAAMsM,UAAU,GAAGtM,IAAI,CAACQ,IAAL,CAAUiM,OAAV,GAAoBrH,MAAvC;CACA,UAAMmH,QAAQ,GAAGvM,IAAI,CAACc,EAAL,CAAQ2L,OAAR,GAAkBrH,MAAnC;CACA,UAAMqgB,WAAW,GAAGnZ,UAAU,CAACG,OAAX,GAAqB7C,QAArB,CAA8BzC,EAAlD;CACA,UAAMue,QAAQ,GAAGpZ,UAAU,CAAC5E,KAAX,EAAjB;CACA,UAAMke,WAAW,GAAGrZ,QAAQ,CAACE,OAAT,GAAmB7C,QAAnB,CAA4BzC,EAAhD;CACA,UAAM0e,QAAQ,GAAGtZ,QAAQ,CAAC7E,KAAT,EAAjB;CAEA,UAAM2gB,SAAS,GAAG,KAAKnC,gBAAL,CAAsBR,QAAtB,CAAlB;;CAEA,UAAI2C,SAAJ,EACA;CACC,eAAOA,SAAS,CAAC1C,OAAV,CAAkBrmB,IAAlB,CAAuB,UAACiB,IAAD,EAAU;CACvC,iBACCoM,MAAM,CAACpM,IAAI,CAACklB,WAAN,CAAN,KAA6B9Y,MAAM,CAAC8Y,WAAD,CAAnC,IACG9Y,MAAM,CAACpM,IAAI,CAACmlB,QAAN,CAAN,KAA0B/Y,MAAM,CAAC+Y,QAAD,CADnC,IAEG/Y,MAAM,CAACpM,IAAI,CAACqlB,WAAN,CAAN,KAA6BjZ,MAAM,CAACiZ,WAAD,CAFtC,IAGGjZ,MAAM,CAACpM,IAAI,CAACslB,QAAN,CAAN,KAA0BlZ,MAAM,CAACkZ,QAAD,CAJpC;CAMA,SAPM,CAAP;CAQA;;CAED,aAAO,IAAP;CACA;;;iCAEW1e,IACZ;CACC,aAAO,KAAK4Z,UAAL,CAAgBuH,GAAhB,CAAoB3b,MAAM,CAACxF,EAAD,CAA1B,CAAP;CACA;;;iCAGD;CAAA;;CACC,aAAO,KAAKxD,KAAL,CAAWC,QAAX,CAAoB,WAApB,EAAiC,YAAM;CAC7C,eAAO,MAAI,CAACkd,iBAAL,CAAuBlhB,MAAvB,CAA8B,UAACC,GAAD,EAAM+J,QAAN,EAAmB;CACvD,0DACI/J,GADJ,kCAEI+J,QAAQ,CAACqZ,MAAT,CAAgBtK,CAFpB,kCAGI/O,QAAQ,CAACqZ,MAAT,CAAgB/J,CAHpB,kCAIItP,QAAQ,CAACqZ,MAAT,CAAgB3J,CAJpB;CAMA,SAPM,EAOJ,EAPI,CAAP;CAQA,OATM,CAAP;CAUA;;;kCAGD;CACC,aAAO,KAAKyJ,SAAL,GAAiBnjB,MAAjB,CAAwB,UAACC,GAAD,EAAM+Y,KAAN,EAAgB;CAC9C,wDAAW/Y,GAAX,kCAAoB+Y,KAAK,CAAC+M,OAAN,IAAiB,EAArC;CACA,OAFM,EAEJ,EAFI,CAAP;CAGA;;;sCAGD;CAAA;;CACC,WAAK7E,iBAAL,CAAuBhW,GAAvB,CAA2B,UAACyd,eAAD,EAAqB;CAC/C,QAAA,MAAI,CAAC1F,sBAAL,CAA4B0F,eAA5B;CACA,OAFD;CAGA;;;mCAGD;CAAA;;CACC,UAAI,CAAC,KAAKzT,mBAAV,EACA;CACC;CACA;;CACD,WAAKiO,SAAL,GACE3Z,MADF,CACS,UAACwP,KAAD,EAAW;CAClB,eAAOxb,cAAI,CAACC,OAAL,CAAaub,KAAK,CAAC+M,OAAnB,KAA+B/M,KAAK,CAAC+M,OAAN,CAAcroB,MAApD;CACA,OAHF,EAIEoC,OAJF,CAIU,UAACkZ,KAAD,EAAW;CACnBA,QAAAA,KAAK,CAAC+M,OAAN,CAAcjmB,OAAd,CAAsB,UAAC8lB,MAAD,EAAY;CACjC,cAAMhI,YAAY,GAAG,OAAI,CAAC3T,WAAL,CAAiB2b,MAAM,CAACC,WAAxB,CAArB;;CACA,cAAMhI,UAAU,GAAG,OAAI,CAAC5T,WAAL,CAAiB2b,MAAM,CAACI,WAAxB,CAAnB;;CAEA,cAAIpI,YAAY,IAAIC,UAApB,EACA;CACC,gBAAMnR,UAAU,GAAGkR,YAAY,CAACiJ,eAAb,CAA6BjB,MAAM,CAACE,QAApC,CAAnB;CACA,gBAAMnZ,QAAQ,GAAGkR,UAAU,CAACgJ,eAAX,CAA2BjB,MAAM,CAACK,QAAlC,CAAjB;;CAEA,gBAAIvZ,UAAU,IAAIC,QAAlB,EACA;CACC,kBAAMic,YAAY,GAAG,IAArB;CACAlc,cAAAA,UAAU,CAAC/M,MAAX,CAAkBuC,SAAlB,CAA4ByK,QAAQ,CAAChN,MAArC,EAA6CimB,MAAM,CAACzjB,WAApD,EAAiEymB,YAAjE;CACA;CACD;CACD,SAfD;CAgBA,OArBF;CAsBA;;;;;KCr7BWnW,MAAM,GAAG;CACrBxF,EAAAA,MAAM,EAANA,MADqB;CAErByF,EAAAA,IAAI,EAAJA;CAFqB,CAAf;;;;;;;;;"}