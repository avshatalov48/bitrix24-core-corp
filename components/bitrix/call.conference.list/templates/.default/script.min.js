(function(e,t,n,r,o,i){"use strict";function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function e(t,n,r){return t[n]=r}}function l(e,t,n,o){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),c=new S(o||[]);return r(a,"_invoke",{value:L(e,n,c)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function d(){}function p(){}function v(){}var y={};s(y,i,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(T([])));m&&m!==t&&n.call(m,i)&&(y=m);var E=v.prototype=d.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(r,i,a,c){var u=f(e[r],e,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==babelHelpers["typeof"](l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){o("next",e,a,c)}),(function(e){o("throw",e,a,c)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return o("throw",e,a,c)}))}c(u.arg)}var i;r(this,"_invoke",{value:function e(n,r){function a(){return new t((function(e,t){o(n,r,e,t)}))}return i=i?i.then(a,a):a()}})}function L(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return _()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=C(a,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function C(e,t){var n=t.method,r=e.iterator[n];if(undefined===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=f(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return o.next=o}}return{next:_}}function _(){return{value:undefined,done:!0}}return p.prototype=v,r(E,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=s(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},b(w.prototype),s(w.prototype,c,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new w(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(E),s(E,u,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=T,S.prototype={constructor:S,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var r=this;function o(e,n){return c.type="throw",c.arg=t,r.next=e,n&&(r.method="next",r.arg=undefined),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function e(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=t,c.arg=r,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(c)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),h},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var o=r.completion;if("throw"===o.type){var i=o.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,r){return this.delegate={iterator:T(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=undefined),h}},e}var c=t.Reflection.namespace("BX.Messenger.PhpComponent");var u=t.Reflection.getClass("BX.Messenger.v2.Lib.Utils");var s=function(){function e(n){babelHelpers.classCallCheck(this,e);this.pathToAdd=n.pathToAdd;this.pathToEdit=n.pathToEdit;this.pathToList=n.pathToList;this.sliderWidth=n.sliderWidth||800;this.gridId=n.gridId;this.gridManager=t.Reflection.getClass("top.BX.Main.gridManager");this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents()}},{key:"bindEvents",value:function e(){var t=this;n.EventEmitter.subscribe("Grid::updated",(function(){t.bindGridEvents()}));this.bindCreateButtonEvents();this.bindGridEvents()}},{key:"bindCreateButtonEvents",value:function e(){var n=this;var r=document.querySelector(".im-conference-list-empty-button");if(r){t.Event.bind(r,"click",(function(){n.openCreateSlider()}))}var o=document.querySelector(".im-conference-list-panel-button-create");t.Event.bind(o,"click",(function(){n.openCreateSlider()}))}},{key:"bindGridEvents",value:function e(){var n=this;this.rows=document.querySelectorAll(".main-grid-row");this.rows.forEach((function(e){var r=e.getAttribute("data-conference-id");var o=e.getAttribute("data-chat-id");var i=e.getAttribute("data-public-link");var c=!!e.getAttribute("data-conference-finished");var s=e.querySelector(".im-conference-list-controls-button-start");t.Event.bind(s,"click",function(){var e=babelHelpers.asyncToGenerator(a().mark((function e(t){var n;return a().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:t.preventDefault();n=u.conference.getCodeByOptions({link:s.dataset.conferenceLink});window.BX.Messenger.Public.openConference({code:n});case 3:case"end":return r.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var l=e.querySelector(".im-conference-list-controls-button-more");t.Event.bind(l,"click",(function(e){e.preventDefault();n.openContextMenu({buttonNode:l,conferenceId:r,chatId:o})}));var f=e.querySelector(".im-conference-list-controls-button-copy");t.Event.bind(f,"click",(function(e){e.preventDefault();n.copyLink(i)}));var h=e.querySelector(".im-conference-list-chat-name-link");t.Event.bind(h,"click",(function(e){e.preventDefault();n.openEditSlider(r)}))}))}},{key:"openCreateSlider",value:function e(){this.openSlider(this.pathToAdd)}},{key:"openEditSlider",value:function e(t){var n=this.pathToEdit.replace("#id#",t);this.openSlider(n)}},{key:"openSlider",value:function e(n){this.closeContextMenu();if(t.Reflection.getClass("BX.SidePanel")){BX.SidePanel.Instance.open(n,{width:this.sliderWidth,cacheable:false})}}},{key:"copyLink",value:function e(n){i.Clipboard.copy(n);if(t.Reflection.getClass("BX.UI.Notification.Center")){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("CONFERENCE_LIST_NOTIFICATION_LINK_COPIED")})}}},{key:"openContextMenu",value:function e(n){var o=this;var i=n.buttonNode,a=n.conferenceId,c=n.chatId;t.ajax.runComponentAction("bitrix:call.conference.list","getAllowedOperations",{mode:"ajax",data:{conferenceId:a}}).then((function(e){var n=e.data,u=n["delete"],s=n.edit;if(t.Type.isDomNode(i)){var l=[{text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_CHAT"),onclick:function e(){o.openChat(c)}}];if(s){l.push({text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_EDIT"),onclick:function e(){o.openEditSlider(a)}})}if(u){l.push({text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_DELETE"),className:"im-conference-list-context-menu-item-delete menu-popup-no-icon",onclick:function e(){o.deleteAction(a)}})}o.menu=new r.Menu({bindElement:i,items:l,events:{onPopupClose:function e(){this.destroy()}}});o.menu.show()}}))["catch"]((function(e){console.error(e)}))}},{key:"closeContextMenu",value:function e(){if(this.menu){this.menu.close()}}},{key:"openChat",value:function e(n){this.closeContextMenu();if(t.Reflection.getClass("BXIM.openMessenger")){BXIM.openMessenger("chat"+n)}}},{key:"deleteAction",value:function e(n){var r=this;this.closeContextMenu();t.ajax.runComponentAction("bitrix:call.conference.list","deleteConference",{mode:"ajax",data:{conferenceId:n}}).then((function(e){r.onSuccessfulDelete(e)}))["catch"]((function(e){r.onFailedDelete(e)}))}},{key:"onSuccessfulDelete",value:function e(t){if(t.data["LAST_ROW"]===true){top.window.location=this.pathToList;return true}if(this.gridManager){this.gridManager.reload(this.gridId)}}},{key:"onFailedDelete",value:function e(t){o.MessageBox.alert(t["errors"][0].message)}}]);return e}();c.ConferenceList=s})(this.window=this.window||{},BX,BX.Event,BX.Main,BX.UI.Dialogs,BX.Messenger.Lib);
//# sourceMappingURL=script.map.js