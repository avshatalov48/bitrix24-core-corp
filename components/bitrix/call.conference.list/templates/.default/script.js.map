{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Event, Loc, Type, Tag, Dom, ajax as Ajax} from 'main.core';\nimport {EventEmitter} from 'main.core.events'\nimport {Menu} from 'main.popup';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Clipboard} from \"im.lib.clipboard\";\n\nconst namespace = Reflection.namespace('BX.Messenger.PhpComponent');\n\nconst Utils = Reflection.getClass('BX.Messenger.v2.Lib.Utils');\n\nclass ConferenceList\n{\n\tconstructor(params)\n\t{\n\t\tthis.pathToAdd = params.pathToAdd;\n\t\tthis.pathToEdit = params.pathToEdit;\n\t\tthis.pathToList = params.pathToList;\n\t\tthis.sliderWidth = params.sliderWidth || 800;\n\t\tthis.gridId = params.gridId;\n\n\t\tthis.gridManager = Reflection.getClass('top.BX.Main.gridManager');\n\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.bindGridEvents();\n\t\t});\n\n\t\tthis.bindCreateButtonEvents();\n\t\tthis.bindGridEvents();\n\t}\n\n\tbindCreateButtonEvents()\n\t{\n\t\tconst emptyListCreateButton = document.querySelector('.im-conference-list-empty-button');\n\t\tif (emptyListCreateButton)\n\t\t{\n\t\t\tEvent.bind(emptyListCreateButton, 'click', () => {\n\t\t\t\tthis.openCreateSlider();\n\t\t\t});\n\t\t}\n\n\t\tconst panelCreateButton = document.querySelector('.im-conference-list-panel-button-create');\n\t\tEvent.bind(panelCreateButton, 'click', () => {\n\t\t\tthis.openCreateSlider();\n\t\t});\n\t}\n\n\tbindGridEvents()\n\t{\n\t\t//grid rows\n\t\tthis.rows = document.querySelectorAll('.main-grid-row');\n\t\tthis.rows.forEach((row) => {\n\t\t\tconst conferenceId = row.getAttribute('data-conference-id');\n\t\t\tconst chatId = row.getAttribute('data-chat-id');\n\t\t\tconst publicLink = row.getAttribute('data-public-link');\n\t\t\tconst conferenceIsFinished = !!row.getAttribute('data-conference-finished');\n\n\t\t\t//start button\n\t\t\tconst startButton = row.querySelector('.im-conference-list-controls-button-start');\n\t\t\tEvent.bind(startButton, 'click', async (event) => {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tconst code = Utils.conference.getCodeByOptions({ link: startButton.dataset.conferenceLink });\n\t\t\t\twindow.BX.Messenger.Public.openConference({ code });\n\t\t\t});\n\n\t\t\t//more button\n\t\t\tconst moreButton = row.querySelector('.im-conference-list-controls-button-more');\n\t\t\tEvent.bind(moreButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openContextMenu({\n\t\t\t\t\tbuttonNode: moreButton, conferenceId, chatId\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t//copy link button\n\t\t\tconst copyButton = row.querySelector('.im-conference-list-controls-button-copy');\n\t\t\tEvent.bind(copyButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.copyLink(publicLink);\n\t\t\t});\n\n\t\t\t//chat name link\n\t\t\tconst chatNameLink = row.querySelector('.im-conference-list-chat-name-link');\n\t\t\tEvent.bind(chatNameLink, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openEditSlider(conferenceId);\n\t\t\t});\n\t\t});\n\t}\n\n\topenCreateSlider()\n\t{\n\t\tthis.openSlider(this.pathToAdd);\n\t}\n\n\topenEditSlider(conferenceId)\n\t{\n\t\tconst pathToEdit = this.pathToEdit.replace('#id#', conferenceId);\n\t\tthis.openSlider(pathToEdit);\n\t}\n\n\topenSlider(path)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tif (Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(path, {width: this.sliderWidth, cacheable: false});\n\t\t}\n\t}\n\n\tcopyLink(link)\n\t{\n\t\tClipboard.copy(link);\n\n\t\tif (Reflection.getClass('BX.UI.Notification.Center'))\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CONFERENCE_LIST_NOTIFICATION_LINK_COPIED')\n\t\t\t})\n\t\t}\n\t}\n\n\topenContextMenu({buttonNode, conferenceId, chatId})\n\t{\n\t\tAjax.runComponentAction('bitrix:call.conference.list', \"getAllowedOperations\", {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { conferenceId }\n\t\t\t})\n\t\t\t.then(({data: {delete: canDelete, edit: canEdit}}) => {\n\t\t\t\tif (Type.isDomNode(buttonNode))\n\t\t\t\t{\n\t\t\t\t\tconst menuItems = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_CHAT'),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat(chatId)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\tif (canEdit)\n\t\t\t\t\t{\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_EDIT'),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openEditSlider(conferenceId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (canDelete)\n\t\t\t\t\t{\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_DELETE'),\n\t\t\t\t\t\t\tclassName: 'im-conference-list-context-menu-item-delete menu-popup-no-icon',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.deleteAction(conferenceId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.menu = new Menu({\n\t\t\t\t\t\tbindElement: buttonNode,\n\t\t\t\t\t\titems: menuItems,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.menu.show();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tconsole.error(response);\n\t\t\t});\n\t}\n\n\tcloseContextMenu()\n\t{\n\t\tif (this.menu)\n\t\t{\n\t\t\tthis.menu.close();\n\t\t}\n\t}\n\n\topenChat(chatId)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tif (Reflection.getClass('BXIM.openMessenger'))\n\t\t{\n\t\t\tBXIM.openMessenger('chat' + chatId);\n\t\t}\n\t}\n\n\tdeleteAction(conferenceId)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tAjax.runComponentAction('bitrix:call.conference.list', \"deleteConference\", {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { conferenceId }\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.onSuccessfulDelete(response);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.onFailedDelete(response);\n\t\t\t});\n\t}\n\n\tonSuccessfulDelete(response)\n\t{\n\t\tif (response.data['LAST_ROW'] === true)\n\t\t{\n\t\t\ttop.window.location = this.pathToList;\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.gridManager)\n\t\t{\n\t\t\tthis.gridManager.reload(this.gridId);\n\t\t}\n\t}\n\n\tonFailedDelete(response)\n\t{\n\t\tMessageBox.alert(response[\"errors\"][0].message);\n\t}\n}\n\nnamespace.ConferenceList = ConferenceList;"],"names":["namespace","Reflection","Utils","getClass","ConferenceList","params","pathToAdd","pathToEdit","pathToList","sliderWidth","gridId","gridManager","init","bindEvents","EventEmitter","subscribe","bindGridEvents","bindCreateButtonEvents","emptyListCreateButton","document","querySelector","Event","bind","openCreateSlider","panelCreateButton","rows","querySelectorAll","forEach","row","conferenceId","getAttribute","chatId","publicLink","conferenceIsFinished","startButton","event","preventDefault","code","conference","getCodeByOptions","link","dataset","conferenceLink","window","BX","Messenger","Public","openConference","moreButton","openContextMenu","buttonNode","copyButton","copyLink","chatNameLink","openEditSlider","openSlider","replace","path","closeContextMenu","SidePanel","Instance","open","width","cacheable","Clipboard","copy","UI","Notification","Center","notify","content","Loc","getMessage","Ajax","runComponentAction","mode","data","then","canDelete","canEdit","edit","Type","isDomNode","menuItems","text","onclick","openChat","push","className","deleteAction","menu","Menu","bindElement","items","events","onPopupClose","destroy","show","response","console","error","close","BXIM","openMessenger","onSuccessfulDelete","onFailedDelete","top","location","reload","MessageBox","alert","message"],"mappings":"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"}