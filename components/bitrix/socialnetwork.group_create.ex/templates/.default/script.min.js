this.BX=this.BX||{};(function(e,t,r,n,i,s,a){"use strict";var o;var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"initExpandSwitches",value:function e(){var t=document.querySelectorAll('[data-role="socialnetwork-group-create-ex__expandable"]');t.forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget.getAttribute("for");var r=document.getElementById(t);var n=r.firstElementChild;if(r.offsetHeight===0){r.style.height=n.offsetHeight+"px";r.classList.add("--open");var i=function e(){var t=r.getBoundingClientRect().top/100;var n=400;var i=0;var s=function e(){window.scrollBy(0,t)};while(i<=n){window.setTimeout(s,i,t);i+=n/100}r.removeEventListener("transitionend",e)};var s=function e(){r.style.height="auto";r.removeEventListener("transitionend",e)};r.addEventListener("transitionend",s);r.addEventListener("transitionend",i)}if(r.offsetHeight>0){r.style.height=r.offsetHeight+"px";setTimeout((function(){r.style.removeProperty("height");r.classList.remove("--open")}))}}))}))}},{key:"initDropdowns",value:function e(){var t=this;var r=document.querySelectorAll('[data-role="soc-net-dropdown"]');r.forEach((function(e){e.addEventListener("click",(function(e){var r=e.currentTarget;var n=t.getDropdownItems(r);var i=[];Object.entries(n).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),o=n[0],c=n[1];i.push({text:c,onclick:function e(){s.close();t.setDropdownValue(r.querySelector(".ui-ctl-element"),c,r);t.setInputValue(r.querySelector("input"),o,r);var n=null;if(r.classList.contains("--nonproject")){n=r.parentNode.querySelector(".--project")}else if(r.classList.contains("--project")){n=r.parentNode.querySelector(".--nonproject")}if(a.Type.isDomNode(n)){t.setDropdownValue(n.querySelector(".ui-ctl-element"),c,n);t.setInputValue(n.querySelector("input"),o,n)}}})}));var s=new BX.PopupMenuWindow({autoHide:true,cacheable:false,bindElement:r,width:r.offsetWidth,closeByEsc:true,animation:"fading-slide",items:i});s.params.width=r.offsetWidth;s.show()}))}))}},{key:"setDropdownValue",value:function e(t,r,n){var i=this.getDropdownItems(n);Object.entries(i).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),i=n[1];if(r===i){t.innerText=r}}))}},{key:"setInputValue",value:function e(t,r,n){var i=this.getDropdownItems(n);Object.entries(i).forEach((function(e){var n=babelHelpers.slicedToArray(e,1),i=n[0];if(r===i){t.value=r}}))}},{key:"getDropdownItems",value:function e(t){var r={};try{r=JSON.parse(t.getAttribute("data-items"))}catch(e){return{}}if(!a.Type.isPlainObject(r)){return{}}return r}},{key:"recalcFormPartProject",value:function e(t){t=!!t;var r=document.getElementById("GROUP_PROJECT");if(r){this.setCheckedValue(r,t)}document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-project, .socialnetwork-group-create-ex__create--switch-nonproject").forEach((function(e){if(t){e.classList.add("--project")}else{e.classList.remove("--project")}}));this.recalcNameInput()}},{key:"recalcNameInput",value:function e(){var t=document.getElementById("GROUP_NAME_input");if(!t){return}var r=a.Loc.getMessage("SONET_GCE_T_NAME3");var n=b.getInstance();if(a.Type.isPlainObject(n.projectTypes[n.selectedProjectType])){if(a.Type.isStringFilled(n.projectTypes[n.selectedProjectType].SCRUM_PROJECT)&&n.projectTypes[n.selectedProjectType].SCRUM_PROJECT==="Y"){r=a.Loc.getMessage("SONET_GCE_T_NAME3_SCRUM")}else if(a.Type.isStringFilled(n.projectTypes[n.selectedProjectType].PROJECT)&&n.projectTypes[n.selectedProjectType].PROJECT==="Y"){r=a.Loc.getMessage("SONET_GCE_T_NAME3_PROJECT")}}t.placeholder=r}},{key:"setCheckedValue",value:function e(t,r){if(!a.Type.isDomNode(t)){return}r=!!r;if(t.type==="checkbox"){t.checked=r}else{t.value=r?"Y":"N"}}},{key:"getCheckedValue",value:function e(t){var r=false;if(!a.Type.isDomNode(t)){return r}if(t.type=="hidden"){r=t.value==="Y"}else if(t.type=="checkbox"){r=t.checked}return r}},{key:"unselectAllSelectorItems",value:function e(t,r){var n=this;if(!a.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.remove(n.cssClass.selectorActive)}))}},{key:"selectSelectorItem",value:function e(t){t.classList.add(this.cssClass.selectorActive)}},{key:"disableAllSelectorItems",value:function e(t,r){var n=this;if(!a.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.add(n.cssClass.selectorDisabled)}))}},{key:"enableAllSelectorItems",value:function e(t,r){var n=this;if(!a.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.remove(n.cssClass.selectorDisabled)}))}},{key:"enableSelectorItem",value:function e(t){t.classList.remove(this.cssClass.selectorDisabled)}},{key:"recalcInputValue",value:function e(t){var r=t.selectedItems||[];var n=a.Type.isBoolean(t.multiple)?t.multiple:true;var i=t.inputContainerNodeId||"";var s=t.inputNodeName||"";if(!a.Type.isArray(r)||!a.Type.isStringFilled(s)||!a.Type.isStringFilled(i)){return}var c=document.getElementById(i);if(!c){return}if(n){s="".concat(s,"[]")}c.querySelectorAll('input[name="'.concat(s,'"]')).forEach((function(e){a.Dom.remove(e)}));r.forEach((function(e){var t=null;switch(e.entityId){case"department":t="DR";break;case"user":t="U";break;default:}if(t){c.appendChild(a.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="',"",'" >'],['<input type="hidden" name="','" value="',"",'" \\>'])),s,t,e.id))}}))}}]);return e}();babelHelpers.defineProperty(c,"cssClass",{selectorActive:"--active",selectorDisabled:"--disabled"});var l=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);var r=false;e.getItems().forEach((function(n){n.addEventListener("click",(function(t){var r=t.currentTarget;if(r.classList.contains(c.cssClass.selectorDisabled)){return}c.unselectAllSelectorItems(e.getContainer(),e.cssClass.selector);c.selectSelectorItem(r);b.getInstance().recalcForm({selectedConfidentialityType:r.getAttribute("data-bx-confidentiality-type")})}));var i=n.getAttribute("data-bx-confidentiality-type");if(a.Type.isStringFilled(b.getInstance().selectedConfidentialityType)){if(b.getInstance().selectedConfidentialityType===i){t.selectItem(n)}}else if(!r){t.selectItem(n);r=true}}));this.bindEvents()}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){b.getInstance().subscribe("onSwitchExtranet",e.onSwitchExtranet)}},{key:"selectItem",value:function e(t){c.selectSelectorItem(t);b.getInstance().recalcForm({selectedConfidentialityType:t.getAttribute("data-bx-confidentiality-type")})}}],[{key:"onSwitchExtranet",value:function t(r){var n=r.getData();if(!a.Type.isBoolean(n.isChecked)){return}if(n.isChecked){e.unselectAll();e.select("secret");e.disableAll();e.enable("secret")}else{e.enableAll()}}},{key:"getContainer",value:function e(){return document.querySelector(".".concat(this.cssClass.container))}},{key:"getItems",value:function e(){var t=this.getContainer();if(!t){return[]}return t.querySelectorAll(".".concat(this.cssClass.selector))}},{key:"unselectAll",value:function e(){c.unselectAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"select",value:function e(t){this.getItems().forEach((function(e){if(e.getAttribute("data-bx-confidentiality-type")!==t){return}c.selectSelectorItem(e)}))}},{key:"disableAll",value:function e(){c.disableAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"enableAll",value:function e(){c.enableAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"enable",value:function e(t){this.getItems().forEach((function(e){if(e.getAttribute("data-bx-confidentiality-type")!==t){return}c.enableSelectorItem(e)}))}}]);return e}();babelHelpers.defineProperty(l,"cssClass",{container:"socialnetwork-group-create-ex__type-confidentiality-wrapper",selector:"socialnetwork-group-create-ex__group-selector"});var d=function(){function e(t){babelHelpers.classCallCheck(this,e);this.isScrumProject=t.isScrumProject}babelHelpers.createClass(e,[{key:"makeAdditionalCustomizationForm",value:function e(){if(this.isScrumProject){this.createHiddenInputs();this.showScrumBlocks();if(!a.Type.isStringFilled(b.getInstance().selectedConfidentialityType)){l.unselectAll();l.select("open");b.getInstance().recalcForm({selectedConfidentialityType:"open"})}var t=document.getElementById("GROUP_LANDING");if(t){t.disabled=true;t.checked=false}this.toggleFeatures(true)}else{this.removeHiddenInputs();this.hideScrumBlocks();var r=document.getElementById("GROUP_LANDING");if(r){r.disabled=false}this.toggleFeatures(false)}c.recalcNameInput()}},{key:"hideScrumBlocks",value:function e(){document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-scrum, .socialnetwork-group-create-ex__create--switch-nonscrum").forEach((function(e){e.classList.remove("--scrum")}));var t=document.getElementById("expandable-moderator-block");if(t){t.classList.add("socialnetwork-group-create-ex__content-expandable")}var r=document.getElementById("GROUP_MODERATORS_PROJECT_switch");if(r){r.classList.add("ui-ctl-file-link")}var n=document.getElementById("GROUP_OWNER_block");if(n){n.classList.remove("--space-bottom")}}},{key:"showScrumBlocks",value:function e(){document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-scrum, .socialnetwork-group-create-ex__create--switch-nonscrum").forEach((function(e){e.classList.add("--scrum")}));var t=document.getElementById("expandable-moderator-block");if(t){t.classList.remove("socialnetwork-group-create-ex__content-expandable")}var r=document.getElementById("GROUP_MODERATORS_PROJECT_switch");if(r){r.classList.remove("ui-ctl-file-link")}var n=document.getElementById("GROUP_OWNER_block");if(n){n.classList.add("--space-bottom")}}},{key:"createHiddenInputs",value:function e(){document.forms["sonet_group_create_popup_form"].appendChild(a.Dom.create("input",{attrs:{type:"hidden",name:"SCRUM_PROJECT",value:"Y"}}))}},{key:"removeHiddenInputs",value:function e(){document.forms["sonet_group_create_popup_form"].querySelectorAll('input[name="SCRUM_PROJECT"]').forEach((function(e){a.Dom.remove(e)}))}},{key:"toggleFeatures",value:function e(t){var r=document.querySelector(".socialnetwork-group-create-ex__project-instruments");if(r){r.querySelectorAll('input[type="checkbox"][name="tasks_active"], input[type="checkbox"][name="calendar_active"]').forEach((function(e){if(t){e.disabled=true;e.checked=true;e.parentNode.insertBefore(a.Dom.create("input",{attrs:{type:"hidden",name:e.name,value:"Y"}}),e)}else{e.disabled=false;document.forms["sonet_group_create_popup_form"].querySelectorAll('input[type="hidden"][name="'.concat(e.name,'"]')).forEach((function(e){a.Dom.remove(e)}))}}))}}}]);return e}();var u=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);this.confirmPopup=null;if(!a.Type.isStringFilled(t.componentName)||a.Type.isUndefined(t.signedParameters)){return}this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.groupId=!a.Type.isUndefined(t.groupId)?parseInt(t.groupId):0;var n=document.querySelector('[data-role="group-avatar-cont"]');if(!n){return}this.selectorNode=n.querySelector('[data-role="group-avatar-selector"]');this.imageNode=n.querySelector('[data-role="group-avatar-image"]');this.inputNode=n.querySelector('[data-role="group-avatar-input"]');this.typeInputNode=n.querySelector('[data-role="group-avatar-type-input"]');this.removeNode=n.querySelector('[data-role="group-avatar-remove"]');if(!a.Type.isDomNode(this.imageNode)||!a.Type.isDomNode(this.inputNode)||!a.Type.isDomNode(this.typeInputNode)||!a.Type.isDomNode(this.removeNode)){return}this.recalc();var s=new BX.AvatarEditor({enableCamera:false});this.selectorNode.addEventListener("click",(function(e){if(e.target.getAttribute("data-role")==="group-avatar-remove"&&r.imageNode.style.backgroundImage!==""){r.showConfirmPopup(a.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM"),r.deletePhoto.bind(r))}else if(e.target.getAttribute("data-role")==="group-avatar-type"){r.clearType();r.setType(e.target.getAttribute("data-avatar-type"))}else if(e.target.getAttribute("data-role")==="group-avatar-image"){s.show("file")}}));i.EventEmitter.subscribe("onApply",(function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),i=n[0];var s=new FormData;if(!i.name){i.name="tmp.png"}s.append("newPhoto",i,i.name);r.changePhoto(s)}))}babelHelpers.createClass(e,[{key:"recalc",value:function t(){if(this.getFileId()<=0){this.removeNode.classList.add(e.classList.hidden);this.imageNode.classList.remove(e.classList.selected)}else{this.removeNode.classList.remove(e.classList.hidden);this.imageNode.classList.add(e.classList.selected)}}},{key:"changePhoto",value:function e(t){var r=this;var n=this.showLoader({node:this.imageNode,loader:null,size:78});a.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:t}).then((function(e){if(a.Type.isPlainObject(e.data)&&parseInt(e.data.fileId)>0&&a.Type.isStringFilled(e.data.fileUri)){r.clearType();r.inputNode.value=parseInt(e.data.fileId);r.typeInputNode.value="";r.imageNode.style="background-image: url('".concat(e.data.fileUri,"'); background-size: cover;");r.recalc()}r.hideLoader({loader:n})}),(function(e){r.hideLoader({loader:n});r.showErrorPopup(e["errors"][0].message)}))}},{key:"deletePhoto",value:function e(){var t=this;var r=this.getFileId();if(r<0){return}var n=this.showLoader({node:this.imageNode,loader:null,size:78});a.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{fileId:r,groupId:this.groupId}}).then((function(e){t.imageNode.style="";t.inputNode.value="";t.recalc();t.hideLoader({loader:n})}),(function(e){t.hideLoader({loader:n});t.showErrorPopup(e.errors[0].message)}))}},{key:"clearType",value:function t(){this.selectorNode.querySelectorAll('[data-role="group-avatar-type"]').forEach((function(t){t.classList.remove(e.classList.selected)}))}},{key:"setType",value:function t(r){this.inputNode.value="";this.imageNode.style="";this.typeInputNode.value=r;this.imageNode.classList.remove(e.classList.selected);this.selectorNode.querySelectorAll('[data-role="group-avatar-type"]').forEach((function(t){if(t.getAttribute("data-avatar-type")!==r){return}t.classList.add(e.classList.selected)}));this.recalc()}},{key:"getFileId",value:function e(){return a.Type.isStringFilled(this.inputNode.value)?parseInt(this.inputNode.value):0}},{key:"showLoader",value:function e(t){var r=null;if(a.Type.isDomNode(t.node)){if(a.Type.isNull(t.loader)){r=new BX.Loader({target:t.node,size:t.hasOwnProperty("size")?t.size:40})}else{r=t.loader}r.show()}return r}},{key:"hideLoader",value:function e(t){if(!a.Type.isNull(t.loader)){t.loader.hide();t.loader=null}if(a.Type.isDomNode(t.node)){a.Dom.clean(t.node)}}},{key:"showErrorPopup",value:function e(r){if(!r){return}new t.Popup("gce-image-upload-error",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,closeIcon:true,content:r,events:{},cacheable:false}).show()}},{key:"showConfirmPopup",value:function e(n,i){var s=this;this.confirmPopup=new t.Popup("gce-image-delete-confirm",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,closeIcon:true,content:n,events:{onPopupClose:function e(){s.confirmPopup.destroy()}},cacheable:false,buttons:[new r.Button({text:a.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM_YES"),events:{click:function e(t){t.setWaiting(true);s.confirmPopup.close();i()}}}),new r.Button({text:a.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM_NO"),events:{click:function e(){s.confirmPopup.close()}}})]});this.confirmPopup.show()}}]);return e}();babelHelpers.defineProperty(u,"classList",{hidden:"--hidden",selected:"--selected"});var p=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);this.container=t.container;this.theme=t.theme;this.draw(this.theme);var n=this.getNode("image");if(n){n.addEventListener("click",this.open)}var s=this.getNode("title");if(s){s.addEventListener("click",this.open)}var a=this.getNode("delete");if(a){a.addEventListener("click",(function(){r.select({})}))}i.EventEmitter.subscribe("Intranet.ThemePicker:onSave",(function(e){var t=e.getData(),n=babelHelpers.slicedToArray(t,1),i=n[0];r.select(i)}))}babelHelpers.createClass(e,[{key:"select",value:function e(t){var r=a.Type.isPlainObject(t.theme)?t.theme:{};this.draw(r)}},{key:"draw",value:function e(t){var r=this.getNode("image");if(r){r.style.backgroundImage=a.Type.isStringFilled(t.previewImage)?"url('".concat(t.previewImage,"')"):"";r.style.backgroundColor=a.Type.isStringFilled(t.previewColor)?t.previewColor:"transparent"}var n=this.getNode("title");if(n){n.innerHTML=a.Type.isStringFilled(t.title)?t.title:""}var i=this.getNode("id");if(i){i.value=a.Type.isStringFilled(t.id)?t.id:""}}},{key:"open",value:function e(t){BX.Intranet.Bitrix24.ThemePicker.Singleton.showDialog(true);t.preventDefault()}},{key:"getNode",value:function e(t){var r=null;if(!a.Type.isStringFilled(t)){return r}return this.container.querySelector('[bx-group-edit-theme-node="'.concat(t,'"]'))}},{key:"getContainer",value:function e(){return this.container}}]);return e}();var m=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);var n=document.getElementById(t.containerNodeId);if(!n){return}this.hiddenFieldNode=document.getElementById(t.hiddenFieldId);var i=new s.TagSelector({addButtonCaption:a.Loc.getMessage("SONET_GCE_T_TAG_ADD"),addButtonCaptionMore:a.Loc.getMessage("SONET_GCE_T_KEYWORDS_ADD_TAG"),dialogOptions:{width:350,height:300,offsetLeft:50,compactView:true,preload:true,context:"PROJECT_TAG",searchTabOptions:{stubOptions:{title:a.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_FAILED"),subtitle:a.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_ADD_HINT"),arrow:true}},entities:[{id:"project-tag",options:{groupId:t.groupId}}],searchOptions:{allowCreateItem:true,footerOptions:{label:a.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_ADD_FOOTER_LABEL")}},events:{"Item:onSelect":function e(t){r.recalcinputValue(t.getTarget().getSelectedItems())},"Item:onDeselect":function e(t){r.recalcinputValue(t.getTarget().getSelectedItems())},"Search:onItemCreateAsync":function e(t){return new Promise((function(e){var r=t.getData(),n=r.searchQuery;var i=n.getQuery().toLowerCase();var s=t.getTarget();setTimeout((function(){var t=i.split(",");t.forEach((function(e){var t=s.addItem({id:e,entityId:"project-tag",title:e,tabs:["all","recents"]});if(t){t.select()}}));e()}),1e3)}))}}}});i.renderTo(n)}babelHelpers.createClass(e,[{key:"recalcinputValue",value:function e(t){if(!a.Type.isArray(t)||!a.Type.isDomNode(this.hiddenFieldNode)){return}var r=[];t.forEach((function(e){r.push(e.id)}));this.hiddenFieldNode.value=r.join(",")}}]);return e}();var f=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.cssClass={container:"socialnetwork-group-create-ex__type-preset-wrapper",selector:"socialnetwork-group-create-ex__type-preset-selector"};this.container=document.querySelector(".".concat(this.cssClass.container));if(!this.container){return}var r=false;var n=this.container.querySelectorAll(".".concat(this.cssClass.selector));n.forEach((function(e){e.addEventListener("click",(function(e){var r=e.currentTarget;if(r.classList.contains(c.cssClass.selectorDisabled)){return}c.unselectAllSelectorItems(t.container,t.cssClass.selector);c.selectSelectorItem(r);var n=r.getAttribute("data-bx-project-type");b.getInstance().recalcForm({selectedProjectType:n});b.getInstance().wizardManager.setProjectType(n)}));var n=e.getAttribute("data-bx-project-type");if(a.Type.isStringFilled(b.getInstance().selectedProjectType)){if(b.getInstance().selectedProjectType===n){t.selectItem(e)}}else if(!r){t.selectItem(e);r=true}}))}babelHelpers.createClass(e,[{key:"selectItem",value:function e(t){var r=t.getAttribute("data-bx-project-type");c.selectSelectorItem(t);b.getInstance().recalcForm({selectedProjectType:r});b.getInstance().wizardManager.setProjectType(r)}}]);return e}();var h=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"check",value:function e(){if(b.getInstance().wizardManager.stepsCount===1){return this.checkAll()}else{return this.checkStep(b.getInstance().wizardManager.currentStep)}}},{key:"checkStep",value:function e(t){var r=this;t=parseInt(t);var n=[];if(a.Type.isArray(this.mandatoryFieldsByStep[t])){this.mandatoryFieldsByStep[t].forEach((function(e){var t=document.getElementById(e.id);if(!a.Type.isDomNode(t)){return}if(t.tagName.toLowerCase()!=="input"){if(e.type==="string"){t=t.querySelector('input[type="text"]');if(!a.Type.isDomNode(t)){return}}}e.fieldNode=t;var i=r.checkField(e);if(a.Type.isStringFilled(i)){var s=document.getElementById(e.bindNodeId);n.push({bindNode:a.Type.isDomNode(s)?s:t,message:i})}}))}return n}},{key:"checkAll",value:function e(){var t=this;var r=[];Object.entries(this.mandatoryFieldsByStep).forEach((function(e){r=r.concat(t.checkStep(parseInt(e[0])))}));return r}},{key:"checkField",value:function e(t){var r="";if(!a.Type.isPlainObject(t)&&!a.Type.isDomNode(t.fieldNode)){return r}if(a.Type.isFunction(t.condition)){if(!t.condition()){return r}}var n=t.fieldNode;var i=a.Type.isStringFilled(t.type)?t.type:"string";switch(i){case"string":r=n.value.trim()===""?a.Loc.getMessage("SONET_GCE_T_STRING_FIELD_ERROR"):"";break;case"input_hidden_container":var s=true;n.querySelectorAll('input[type="hidden"]').forEach((function(e){if(!s){return}if(a.Type.isStringFilled(e.value)){s=false}}));r=s?a.Loc.getMessage("SONET_GCE_T_STRING_FIELD_ERROR"):"";break;default:r=""}return r}},{key:"showError",value:function e(t){if(!a.Type.isPlainObject(t)||!a.Type.isStringFilled(t.message)||!a.Type.isDomNode(t.bindNode)){return}b.getInstance().alertManager.showAlert(t.message,t.bindNode.parentNode)}}]);return e}();babelHelpers.defineProperty(h,"mandatoryFieldsByStep",{2:[{id:"GROUP_NAME_input",type:"string",bindNodeId:"GROUP_NAME_input"}],4:[{id:"SCRUM_MASTER_CODE_container",type:"input_hidden_container",bindNodeId:"SCRUM_MASTER_selector",condition:function e(){return!!b.getInstance().scrumManager.isScrumProject}}]});var y=function(){function e(){babelHelpers.classCallCheck(this,e);this.submitButton=document.getElementById("sonet_group_create_popup_form_button_submit");if(!this.submitButton){return}this.submitButtonClickHandler=this.submitButtonClickHandler.bind(this);this.submitButton.addEventListener("click",this.submitButtonClickHandler);this.backButton=document.getElementById("sonet_group_create_popup_form_button_step_2_back");if(this.backButton){this.backButton.addEventListener("click",(function(e){var t=r.ButtonManager.createFromNode(e.currentTarget);if(t&&t.isDisabled()){return}if(b.getInstance().wizardManager.currentStep>1){b.getInstance().wizardManager.currentStep--;if(b.getInstance().wizardManager.currentStep===3&&Object.entries(b.getInstance().confidentialityTypes)<=1){b.getInstance().wizardManager.currentStep--}b.getInstance().wizardManager.showCurrentStep()}return e.preventDefault()}))}this.cancelButton=document.getElementById("sonet_group_create_popup_form_button_step_2_cancel");if(this.cancelButton){this.cancelButton.addEventListener("click",(function(e){var t=r.ButtonManager.createFromNode(e.currentTarget);if(t&&t.isDisabled()){return}var n=BX.SidePanel.Instance.getSliderByWindow(window);if(n){var s=new i.BaseEvent({compatData:[n.getEvent("onClose")],data:n.getEvent("onClose")});i.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",s)}else{var o=e.currentTarget.getAttribute("bx-url");if(a.Type.isStringFilled(o)){window.location=o}}var c=new i.BaseEvent({compatData:[false],data:false});i.EventEmitter.emit(window.top,"BX.Bitrix24.PageSlider:close",c);i.EventEmitter.emit(window.top,"onSonetIframeCancelClick");return e.preventDefault()}))}}babelHelpers.createClass(e,[{key:"submitButtonClickHandler",value:function e(t){var n=r.ButtonManager.createFromNode(t.currentTarget);if(n&&n.isDisabled()){return}b.getInstance().alertManager.hideAllAlerts();var i=h.check().filter((function(e){return a.Type.isPlainObject(e)&&a.Type.isStringFilled(e.message)&&a.Type.isDomNode(e.bindNode)}));if(i.length>0){i.forEach((function(e){h.showError(e)}))}else if(b.getInstance().wizardManager.currentStep<b.getInstance().wizardManager.stepsCount){b.getInstance().wizardManager.currentStep++;if(b.getInstance().wizardManager.currentStep===3&&Object.entries(b.getInstance().confidentialityTypes)<=1){b.getInstance().wizardManager.currentStep++}b.getInstance().wizardManager.showCurrentStep()}else{var s=function(e){b.getInstance().submitForm(e)}.bind(b.getInstance());s(t)}return t.preventDefault()}}],[{key:"showWaitSubmitButton",value:function e(t){t=!!t;var n=document.getElementById("sonet_group_create_popup_form_button_submit");if(!n){return}var i=r.ButtonManager.createFromNode(n);if(t){if(i){i.setWaiting(true)}n.removeEventListener("click",b.getInstance().submitButtonClickHandler)}else{if(i){i.setWaiting(false)}n.addEventListener("click",b.getInstance().submitButtonClickHandler)}}},{key:"disableButton",value:function e(t,n){if(!a.Type.isDomNode(t)){return}var i=r.ButtonManager.createFromNode(t);if(!i){return}i.setDisabled(n)}},{key:"showButton",value:function e(t){if(!a.Type.isDomNode(t)){return}t.classList.remove(this.cssClass.hidden)}},{key:"hideButton",value:function e(t){if(!a.Type.isDomNode(t)){return}t.classList.add(this.cssClass.hidden)}}]);return e}();babelHelpers.defineProperty(y,"cssClass",{hidden:"socialnetwork-group-create-ex__button-invisible"});var g=function(){babelHelpers.createClass(e,null,[{key:"getFirstStepNumber",value:function e(){return Object.entries(b.getInstance().projectTypes).length>1?1:2}}]);function e(t){babelHelpers.classCallCheck(this,e);this.processedStep=0;this.currentStep=t.currentStep;this.stepsCount=t.stepsCount;this.step1BackgroudNode=document.querySelector(".".concat(e.cssClass.step1Backgroud));this.bodyContainer=document.querySelector(".".concat(e.cssClass.bodyContainer));this.breadcrumbsContainer=document.querySelector(".".concat(e.cssClass.breadcrumbsContainer))}babelHelpers.createClass(e,[{key:"showCurrentStep",value:function t(){var r=this;if(a.Type.isDomNode(this.bodyContainer)){this.bodyContainer.querySelectorAll(".".concat(e.cssClass.bodyItem)).forEach((function(t){if(t.classList.contains("--step-".concat(r.currentStep))){t.classList.add(e.cssClass.activeBodyItem)}else{t.classList.remove(e.cssClass.activeBodyItem)}}))}if(a.Type.isDomNode(this.breadcrumbsContainer)){this.breadcrumbsContainer.querySelectorAll(".".concat(e.cssClass.breadcrumbsItem)).forEach((function(t){if(t.classList.contains("--step-".concat(r.currentStep))){t.classList.add(e.cssClass.activeBreadcrumbsItem)}else{t.classList.remove(e.cssClass.activeBreadcrumbsItem)}}))}if(this.currentStep===e.getFirstStepNumber()||this.currentStep<=this.processedStep+1){y.hideButton(b.getInstance().buttonsInstance.backButton)}else{if(a.Type.isDomNode(this.step1BackgroudNode)){this.step1BackgroudNode.classList.add("--stop")}y.showButton(b.getInstance().buttonsInstance.backButton)}}},{key:"setProjectType",value:function e(t){var r=this;if(a.Type.isDomNode(this.step1BackgroudNode)){["project","scrum","group"].forEach((function(e){r.step1BackgroudNode.classList.remove("--".concat(e))}));this.step1BackgroudNode.classList.remove("--stop");this.step1BackgroudNode.classList.add("--".concat(t))}}},{key:"recalcAfterSubmit",value:function e(t){var r=a.Type.isStringFilled(t.processedStep)?t.processedStep:"";var n=parseInt(!a.Type.isUndefined(t.createdGroupId)?t.createdGroupId:0);var i=document.getElementById("TAB");var s=document.getElementById("SONET_GROUP_ID");if(!i||!a.Type.isStringFilled(r)||n<=0){return}s.value=n;if(r==="create"){this.processedStep=1;i.value="edit"}else if(r==="edit"){this.processedStep=3;i.value="invite";this.bodyContainer.querySelectorAll(".socialnetwork-group-create-ex__create--switch-notinviteonly").forEach((function(e){e.classList.add("--inviteonly")}))}this.showCurrentStep()}}]);return e}();babelHelpers.defineProperty(g,"cssClass",{step1Backgroud:"socialnetwork-group-create-ex__background-gif",breadcrumbsContainer:"socialnetwork-group-create-ex__breadcrumbs",breadcrumbsItem:"socialnetwork-group-create-ex__breadcrumbs-item",bodyContainer:"socialnetwork-group-create-ex__content",bodyItem:"socialnetwork-group-create-ex__content-body",activeBodyItem:"--active",activeBreadcrumbsItem:"--active"});var v=function(){function e(t){babelHelpers.classCallCheck(this,e);if(!a.Type.isStringFilled(t.errorContainerId)){return}this.globalErrorContainer=document.getElementById(t.errorContainerId);this.nodeAlerts=new Map}babelHelpers.createClass(e,[{key:"showAlert",value:function e(t,r){if(a.Type.isDomNode(r)){r.classList.add("ui-ctl-danger")}else{r=this.globalErrorContainer}var i=new n.Alert({color:n.Alert.Color.DANGER,animate:true});this.nodeAlerts.set(r,i);setTimeout((function(){r.parentNode.insertBefore(i.getContainer(),r.nextSibling);i.setText(t);window.scrollTo({top:a.Dom.getPosition(r).top,behavior:"smooth"})}),500)}},{key:"hideAllAlerts",value:function e(){this.nodeAlerts.forEach((function(e,t){e.hide();if(a.Type.isDomNode(t)){t.classList.remove("ui-ctl-danger")}}));this.nodeAlerts.clear()}}]);return e}();var S=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function e(){return b.instance}}]);function e(t){babelHelpers.classCallCheck(this,e);this.ownerSelector=null;this.scrumMasterSelector=null;this.moderatorsSelector=null;this.usersSelector=null;this.ownerOptions=t.ownerOptions||{};this.scrumMasterOptions=t.scrumMasterOptions||{};this.moderatorsOptions=t.moderatorsOptions||{};this.usersOptions=t.usersOptions||{};this.ownerContainerNode=document.getElementById("GROUP_OWNER_selector");this.scrumMasterContainerNode=document.getElementById("SCRUM_MASTER_selector");this.moderatorsContainerNode=document.getElementById("GROUP_MODERATORS_selector");this.usersContainerNode=document.getElementById("GROUP_USERS_selector");this.isCurrentUserAdmin=a.Type.isBoolean(t.isCurrentUserAdmin)?t.isCurrentUserAdmin:false;this.extranetInstalled=a.Type.isBoolean(t.extranetInstalled)?t.extranetInstalled:false;this.allowExtranet=a.Type.isBoolean(t.allowExtranet)?t.allowExtranet:false;this.buildOwnerSelector();this.buildScrumMasterSelector();this.buildModeratorsSelector();this.buildUsersSelector();this.bindEvents()}babelHelpers.createClass(e,[{key:"buildOwnerSelector",value:function t(){if(!a.Type.isDomNode(this.ownerContainerNode)){return}a.Dom.clean(this.ownerContainerNode);var r=this.ownerOptions;this.ownerSelector=new s.TagSelector({id:r.selectorId||"group_create_owner",dialogOptions:{id:r.selectorId||"group_create_owner",context:e.contextList.owner,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onOwnerSelect,"Item:onDeselect":e.onOwnerSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true,inviteExtranetLink:true,checkWorkgroupWhenInvite:false}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:false,addButtonCaption:a.Loc.getMessage("SONET_GCE_T_ADD_OWNER")});this.ownerSelector.renderTo(this.ownerContainerNode)}},{key:"buildScrumMasterSelector",value:function t(){if(!a.Type.isDomNode(this.scrumMasterContainerNode)){return}a.Dom.clean(this.scrumMasterContainerNode);var r=this.scrumMasterOptions;this.scrumMasterSelector=new s.TagSelector({id:r.selectorId||"group_create_scrum_master",dialogOptions:{id:r.selectorId||"group_create_scrum_master",context:e.contextList.scrumMaster,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onScrumMasterSelect,"Item:onDeselect":e.onScrumMasterSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:false,addButtonCaption:a.Loc.getMessage("SONET_GCE_T_CHANGE_SCRUM_MASTER"),addButtonCaptionMore:a.Loc.getMessage("SONET_GCE_T_CHANGE_SCRUM_MASTER_MORE")});this.scrumMasterSelector.renderTo(this.scrumMasterContainerNode)}},{key:"buildModeratorsSelector",value:function t(){if(!a.Type.isDomNode(this.moderatorsContainerNode)){return}a.Dom.clean(this.moderatorsContainerNode);var r=this.moderatorsOptions;this.moderatorsSelector=new s.TagSelector({id:r.selectorId||"group_create_moderators",dialogOptions:{id:r.selectorId||"group_create_moderators",context:e.contextList.moderators,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onModeratorsSelect,"Item:onDeselect":e.onModeratorsSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true,checkWorkgroupWhenInvite:false}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:true,addButtonCaption:a.Loc.getMessage("SONET_GCE_T_ADD_USER"),addButtonCaptionMore:a.Loc.getMessage("SONET_GCE_T_ADD_USER_MORE")});this.moderatorsSelector.renderTo(this.moderatorsContainerNode)}},{key:"buildUsersSelector",value:function t(){if(!a.Type.isDomNode(this.usersContainerNode)){return}a.Dom.clean(this.usersContainerNode);var r=this.usersOptions;this.usersSelector=new s.TagSelector({id:r.selectorId||"group_create_users",dialogOptions:{id:r.selectorId||"group_create_users",context:e.contextList.users,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onUsersSelect,"Item:onDeselect":e.onUsersSelect},entities:[{id:"user",options:{inviteEmployeeLink:true,"!userId":this.isCurrentUserAdmin?[parseInt(a.Loc.getMessage("USER_ID"))]:[],intranetUsersOnly:!this.allowExtranet,checkWorkgroupWhenInvite:false}},{id:"department",options:{selectMode:r.enableSelectDepartment?"usersAndDepartments":"usersOnly"}}]},multiple:true,addButtonCaption:a.Loc.getMessage("SONET_GCE_T_ADD_USER"),addButtonCaptionMore:a.Loc.getMessage("SONET_GCE_T_ADD_USER_MORE")});this.usersSelector.renderTo(this.usersContainerNode)}},{key:"bindEvents",value:function e(){b.getInstance().subscribe("onSwitchExtranet",this.onSwitchExtranet.bind(this));i.EventEmitter.emit("BX.Socialnetwork.WorkgroupFormTeamManager::onEventsBinded")}},{key:"onSwitchExtranet",value:function e(t){var r=t.getData();if(!a.Type.isBoolean(r.isChecked)){return}this.allowExtranet=this.extranetInstalled&&r.isChecked;if(this.ownerSelector&&["DONE","UNSENT"].includes(this.ownerSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.ownerSelector,isChecked:r.isChecked,options:this.ownerOptions});this.buildOwnerSelector()}if(this.scrumMasterSelector&&["DONE","UNSENT"].includes(this.scrumMasterSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.scrumMasterSelector,isChecked:r.isChecked,options:this.scrumMasterOptions});this.buildScrumMasterSelector()}if(this.moderatorsSelector&&["DONE","UNSENT"].includes(this.moderatorsSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.moderatorsSelector,isChecked:r.isChecked,options:this.moderatorsOptions});this.buildModeratorsSelector()}if(this.usersSelector&&["DONE","UNSENT"].includes(this.usersSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.usersSelector,isChecked:r.isChecked,options:this.usersOptions});this.buildUsersSelector()}}},{key:"recalcSelectorByExtranetSwitched",value:function t(r){var n=r.selector;var i=r.isChecked;var s=n.getDialog().getContext();var o=n.getDialog().getSelectedItems();if(this.extranetInstalled&&!i&&a.Type.isArray(o)){o=o.filter((function(e){return!(e.getEntityId()==="user"&&e.getEntityType()==="extranet")}));switch(s){case e.contextList.owner:c.recalcInputValue({selectedItems:o,inputNodeName:"OWNER_CODE",inputContainerNodeId:"OWNER_CODE_container",multiple:false});break;case e.contextList.scrumMaster:c.recalcInputValue({selectedItems:o,inputNodeName:"SCRUM_MASTER_CODE",inputContainerNodeId:"SCRUM_MASTER_CODE_container",multiple:false});break;case e.contextList.moderators:c.recalcInputValue({selectedItems:o,inputNodeName:"MODERATOR_CODES",inputContainerNodeId:"MODERATOR_CODES_container",multiple:true});break;case e.contextList.users:c.recalcInputValue({selectedItems:o,inputNodeName:"USER_CODES",inputContainerNodeId:"USER_CODES_container",multiple:true});break;default:}}r.options.value=o.map((function(e){return[e.getEntityId(),e.getId()]}))}},{key:"onLoad",value:function t(r){switch(r.getTarget().context){case e.contextList.owner:this.recalcSelectorByExtranetSwitched({selector:this.ownerSelector,isChecked:this.allowExtranet,options:this.ownerOptions});break;case e.contextList.scrumMaster:this.recalcSelectorByExtranetSwitched({selector:this.scrumMasterSelector,isChecked:this.allowExtranet,options:this.scrumMasterOptions});break;case e.contextList.moderators:this.recalcSelectorByExtranetSwitched({selector:this.moderatorsSelector,isChecked:this.allowExtranet,options:this.moderatorsOptions});break;case e.contextList.users:this.recalcSelectorByExtranetSwitched({selector:this.usersSelector,isChecked:this.allowExtranet,options:this.usersOptions});break;default:}}}],[{key:"onOwnerSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"OWNER_CODE",inputContainerNodeId:"OWNER_CODE_container",multiple:false})}},{key:"onScrumMasterSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"SCRUM_MASTER_CODE",inputContainerNodeId:"SCRUM_MASTER_CODE_container",multiple:false})}},{key:"onModeratorsSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"MODERATOR_CODES",inputContainerNodeId:"MODERATOR_CODES_container",multiple:true})}},{key:"onUsersSelect",value:function t(r){c.recalcInputValue({selectedItems:r.getTarget().getSelectedItems(),inputNodeName:"USER_CODES",inputContainerNodeId:"USER_CODES_container",multiple:true});var n=document.getElementById("GROUP_ADD_DEPT_HINT_block");if(n){e.showDepartmentHint({selectedItems:r.getTarget().getSelectedItems(),hintNode:n})}}},{key:"showDepartmentHint",value:function e(t){var r=t.selectedItems||{};var n=t.hintNode||null;if(!a.Type.isDomNode(n)){return}if(!a.Type.isArray(r)){n.classList.remove("visible");return}var i=!a.Type.isUndefined(r.find((function(e){return e.entityId==="department"})));if(i){n.classList.add("visible")}else{n.classList.remove("visible")}}}]);return e}();babelHelpers.defineProperty(S,"instance",null);babelHelpers.defineProperty(S,"contextList",{owner:"GROUP_INVITE_OWNER",scrumMaster:"GROUP_INVITE_SCRUM_MASTER",moderators:"GROUP_INVITE_MODERATORS",users:"GROUP_INVITE"});var E=function e(){babelHelpers.classCallCheck(this,e);var t=document.getElementById("additional-block-features");if(!t){return}t.querySelectorAll(".socialnetwork-group-create-ex__project-instruments--icon-action.--edit").forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget;var r=t.closest(".socialnetwork-group-create-ex__project-instruments--item");if(r){r.classList.add("--custom-value");var n=r.querySelector('[data-role="feature-input-text"]');var i=r.querySelector('[data-role="feature-label"]');if(n&&i){n.value=i.innerText}}e.preventDefault()}))}));t.querySelectorAll(".socialnetwork-group-create-ex__project-instruments--icon-action.--revert").forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget;var r=t.closest(".socialnetwork-group-create-ex__project-instruments--item");if(r){r.classList.remove("--custom-value");var n=r.querySelector('[data-role="feature-input-text"]');if(n){n.value=""}}e.preventDefault()}))}))};var T=function e(t){babelHelpers.classCallCheck(this,e);if(a.Type.isPlainObject(h.mandatoryFieldsByStep)&&a.Type.isArray(h.mandatoryFieldsByStep[2])&&a.Type.isArray(t.mandatoryUFList)){t.mandatoryUFList.forEach((function(e){if(!a.Type.isStringFilled(e.id)||!a.Type.isStringFilled(e.type)){return}h.mandatoryFieldsByStep[2].push(e)}))}};var b=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getInstance",value:function e(){return t.instance}}]);function t(e){var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));r.setEventNamespace("BX.Socialnetwork.WorkgroupForm");r.componentName=e.componentName;r.signedParameters=e.signedParameters;r.userSelector="";r.lastAction="invite";r.arUserSelector=[];r.animationList={};r.selectedTypeCode=false;r.groupId=parseInt(e.groupId);r.isScrumProject=e.isScrumProject;r.config=e.config;r.avatarUploaderId=e.avatarUploaderId;r.themePickerData=e.themePickerData;r.projectOptions=e.projectOptions;r.projectTypes=e.projectTypes;r.confidentialityTypes=e.confidentialityTypes;r.selectedProjectType=e.selectedProjectType;r.selectedConfidentialityType=e.selectedConfidentialityType;r.scrumManager=new d({isScrumProject:r.isScrumProject});r.wizardManager=new g({currentStep:Object.entries(r.projectTypes).length>1?1:2,stepsCount:e.stepsCount>1?e.stepsCount:1});r.alertManager=new v({errorContainerId:"sonet_group_create_error_block"});t.instance=babelHelpers.assertThisInitialized(r);r.init(e);r.buttonsInstance=new y;return r}babelHelpers.createClass(t,[{key:"init",value:function e(t){this.scrumManager.makeAdditionalCustomizationForm();if(this.groupId<=0){this.recalcForm()}new u({componentName:this.componentName,signedParameters:this.signedParameters,groupId:this.groupId});if(a.Type.isPlainObject(t.themePickerData)&&document.getElementById("GROUP_THEME_container")){new p({container:document.getElementById("GROUP_THEME_container"),theme:t.themePickerData})}if(document.getElementById("group-tags-bind-node")){new m({groupId:this.groupId,containerNodeId:"group-tags-bind-node",hiddenFieldId:"GROUP_KEYWORDS"})}new f;new l;new E;var r=document.getElementById("GROUP_NAME_input");if(r){r.focus()}this.bindEvents();c.initExpandSwitches();c.initDropdowns();if(a.Type.isStringFilled(t.expandableSettingsNodeId)){BX.UI.Hint.init(document.getElementById(t.expandableSettingsNodeId))}if(this.groupId<=0&&this.selectedProjectType==="scrum"){this.saveScrumAnalyticData()}}},{key:"bindEvents",value:function e(){var t=this;if(BX.SidePanel.Instance.getTopSlider()){i.EventEmitter.subscribe(BX.SidePanel.Instance.getTopSlider().getWindow(),"SidePanel.Slider:onClose",(function(e){setTimeout((function(){var t=e.getTarget();if(!t){return}BX.SidePanel.Instance.destroy(t.getUrl())}),500)}))}var r=document.getElementById("IS_EXTRANET_GROUP");if(r&&r.type==="checkbox"){r.addEventListener("click",(function(){t.switchExtranet(r.checked)}))}var n=document.getElementById("GROUP_VISIBLE");if(n&&n.type==="checkbox"){n.addEventListener("click",(function(){t.switchNotVisible(n.checked)}))}var s=document.getElementById("GROUP_PROJECT");if(s&&s.type==="checkbox"){s.addEventListener("click",(function(){c.recalcFormPartProject(s.checked)}))}i.EventEmitter.subscribe("BX.Socialnetwork.WorkgroupFormTeamManager::onEventsBinded",this.recalcFormDependencies.bind(this))}},{key:"recalcForm",value:function e(t){if(a.Type.isPlainObject(t)){if(!a.Type.isUndefined(t.selectedProjectType)){this.selectedProjectType=a.Type.isStringFilled(t.selectedProjectType)?t.selectedProjectType:""}if(!a.Type.isUndefined(t.selectedConfidentialityType)){this.selectedConfidentialityType=a.Type.isStringFilled(t.selectedConfidentialityType)?t.selectedConfidentialityType:""}}if(this.groupId<=0){this.scrumManager.isScrumProject=a.Type.isPlainObject(this.projectTypes[this.selectedProjectType])&&a.Type.isStringFilled(this.projectTypes[this.selectedProjectType]["SCRUM_PROJECT"])&&this.projectTypes[this.selectedProjectType]["SCRUM_PROJECT"]==="Y";c.recalcFormPartProject(a.Type.isPlainObject(this.projectTypes[this.selectedProjectType])&&a.Type.isStringFilled(this.projectTypes[this.selectedProjectType].PROJECT)&&this.projectTypes[this.selectedProjectType].PROJECT==="Y")}this.scrumManager.makeAdditionalCustomizationForm();if(this.groupId<=0){var r=document.getElementById("GROUP_OPENED");if(r){c.setCheckedValue(r,a.Type.isPlainObject(this.confidentialityTypes[this.selectedConfidentialityType])&&a.Type.isStringFilled(this.confidentialityTypes[this.selectedConfidentialityType].OPENED)&&this.confidentialityTypes[this.selectedConfidentialityType].OPENED==="Y")}var n=document.getElementById("GROUP_VISIBLE");if(n){c.setCheckedValue(n,a.Type.isPlainObject(this.confidentialityTypes[this.selectedConfidentialityType])&&a.Type.isStringFilled(this.confidentialityTypes[this.selectedConfidentialityType].VISIBLE)&&this.confidentialityTypes[this.selectedConfidentialityType].VISIBLE==="Y")}}this.recalcFormDependencies()}},{key:"recalcFormDependencies",value:function e(){var t=document.getElementById("IS_EXTRANET_GROUP");if(t){this.switchExtranet(c.getCheckedValue(t))}var r=document.getElementById("GROUP_VISIBLE");var n=document.getElementById("GROUP_OPENED");if(r&&n&&!c.getCheckedValue(r)){c.setCheckedValue(n,false)}}},{key:"switchExtranet",value:function e(t){this.emit("onSwitchExtranet",new i.BaseEvent({data:{isChecked:t}}));var r=document.getElementById("GROUP_OPENED");if(r){if(!t){if(r.type==="checkbox"){r.disabled=false}}else{if(r.type==="checkbox"){r.disabled=true;r.checked=false}else{r.value="N"}}}var n=document.getElementById("GROUP_VISIBLE");if(n){if(!t){if(n.type=="checkbox"){n.disabled=false}}else{if(n.type=="checkbox"){n.disabled=true;n.checked=false}else{n.value="N"}}}}},{key:"switchNotVisible",value:function e(t){var r=document.getElementById("GROUP_OPENED");if(r&&r.type=="checkbox"){if(t){r.disabled=false}else{r.disabled=true;r.checked=false}}}},{key:"submitForm",value:function e(t){var r=this;var n=document.getElementById("sonet_group_create_popup_form").action;if(n){var s=document.getElementById("SONET_GROUP_ID");var o="addSonetGroup";if(s){if(parseInt(s.value)<=0){n=a.Uri.addParam(n,{action:"createGroup",groupType:this.selectedTypeCode})}else{o="editSonetGroup"}}n=a.Uri.addParam(n,{b24statAction:o});var c=document.forms["sonet_group_create_popup_form"].elements;if(c.GROUP_PROJECT&&(c.IS_EXTRANET_GROUP||c.GROUP_OPENED)){var l=c.GROUP_PROJECT.checked?"project-":"group-";if(c.IS_EXTRANET_GROUP&&c.IS_EXTRANET_GROUP.checked){l+="external"}else{l+=c.GROUP_OPENED.checked?"open":"closed"}n=a.Uri.addParam(n,{b24statType:l})}if(c.SCRUM_PROJECT&&o==="addSonetGroup"){n=a.Uri.addParam(n,{analyticsLabel:{scrum:"Y",action:"scrum_create"}})}y.showWaitSubmitButton(true);a.ajax.submitAjax(document.forms["sonet_group_create_popup_form"],{url:n,method:"POST",dataType:"json",data:{PROJECT_OPTIONS:this.projectOptions},onsuccess:function e(t){if(a.Type.isStringFilled(t.ERROR)){var n=a.Type.isStringFilled(t.WARNING)?"".concat(t.WARNING,"<br>"):"";r.alertManager.showAlert("".concat(n).concat(t.ERROR));if(a.Type.isStringFilled(t.WIZARD_STEP_PROCESSED)){r.wizardManager.recalcAfterSubmit({processedStep:t.WIZARD_STEP_PROCESSED.toLowerCase(),createdGroupId:parseInt(!a.Type.isUndefined(t.CREATED_GROUP_ID)?t.CREATED_GROUP_ID:0)})}if(a.Type.isArray(t.USERS_ID)){var s=[];t.USERS_ID.forEach((function(e){s["U".concat(e)]="users"}));r.arUserSelector.forEach((function(e){var t=BX.UI.SelectorManager.instances[e];if(a.Type.isUndefined(t)){return}var r=document.getElementById("ui-tile-selector-".concat(e));r.querySelectorAll(".ui-tile-selector-item").forEach((function(e){var r=e.getAttribute("data-bx-id");if(!a.Type.isStringFilled(r)){return}t.getRenderInstance().deleteItem({entityType:"USERS",itemId:r})}));t.itemsSelected=s;t.reinit()}))}if(a.Type.isArray(t.SUCCESSFULL_USERS_ID)&&t.SUCCESSFULL_USERS_ID.length>0){window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:"afterInvite",data:{}})}y.showWaitSubmitButton(false)}else if(t.MESSAGE==="SUCCESS"){var o=BX.SidePanel.Instance.getSliderByWindow(window);if(o){var c=new i.BaseEvent({compatData:[o.getEvent("onClose")],data:o.getEvent("onClose")});i.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",c)}if(window===top.window){if(a.Type.isStringFilled(t.URL)){top.location.href=t.URL}}else if(a.Type.isStringFilled(t.ACTION)){var l=null;if(["create","edit"].includes(t.ACTION)&&!a.Type.isUndefined(t.GROUP)){l={code:t.ACTION=="create"?"afterCreate":"afterEdit",data:{group:t.GROUP,projectOptions:r.projectOptions}}}else if(t.ACTION==="invite"){l={code:"afterInvite",data:{}}}if(l){window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",l);if(t.ACTION==="create"){var d=JSON.parse(t.SELECTOR_GROUPS);if(a.Type.isArray(d)){window.top.BX.SidePanel.Instance.postMessageAll(window,"BX.Socialnetwork.Workgroup:onAdd",{projects:d})}}if(o){BX.SidePanel.Instance.close(false,(function(){BX.SidePanel.Instance.destroy(o.getUrl())}))}if(t.ACTION=="create"&&a.Type.isStringFilled(t.URL)&&(!a.Type.isStringFilled(r.config.refresh)||r.config.refresh==="Y")){var u=false;BX.SidePanel.Instance.anchorRules.find((function(e){if(u||!a.Type.isArray(e.condition)){return}e.condition.forEach((function(e){if(u){return}if(t.URL.match(e)){u=true}}))}));if(u){BX.SidePanel.Instance.open(t.URL)}else{top.window.location.href=t.URL}}}}}},onfailure:function e(t){y.showWaitSubmitButton(false);r.alertManager.showAlert(a.Loc.getMessage("SONET_GCE_T_AJAX_ERROR"))}})}t.preventDefault()}},{key:"saveScrumAnalyticData",value:function e(){var t=document.getElementById("sonet_group_create_popup_form").action;var r=new a.Uri(t).getQueryParam("source");var n=new Set(["guide_adv","guide_direct","guide_portal"]);if(n.has(r)){a.ajax.runAction("bitrix:tasks.scrum.info.saveScrumStart",{data:{},analyticsLabel:{scrum:"Y",action:"scrum_start",source:r}})}}},{key:"showHideBlock",value:function e(t){var r=this;if(!a.Type.isPlainObject(t)){return false}var n=t.container;var i=t.block;var s=!!t.show;if(!a.Type.isDomNode(n)||!a.Type.isDomNode(i)){return false}if(!a.Type.isUndefined(this.animationList[i.id])&&!a.Type.isNull(this.animationList[i.id])){return false}this.animationList[i.id]=null;var o=parseInt(i.offsetHeight);var c=!a.Type.isUndefined(t.duration)&&parseInt(t.duration)>0?parseInt(t.duration):0;if(s){n.style.display="block"}if(c>0){if(a.Type.isStringFilled(i.id)){this.animationList[i.id]=true}BX.delegate(new BX.easing({duration:c,start:{height:s?0:o,opacity:s?0:100},finish:{height:s?o:0,opacity:s?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){n.style.maxHeight="".concat(t.height,"px");n.style.opacity=t.opacity/100},complete:function e(){if(a.Type.isStringFilled(i.id)){r.animationList[i.id]=null}if(!a.Type.isUndefined(t.callback)&&a.Type.isFunction(t.callback.complete)){n.style.maxHeight="";n.style.opacity="";t.callback.complete()}}}).animate(),this)}else{t.callback.complete()}return true}}]);return t}(i.EventEmitter);babelHelpers.defineProperty(b,"instance",null);e.WorkgroupForm=b;e.WorkgroupFormTeamManager=S;e.WorkgroupFormUFManager=T})(this.BX.Socialnetwork=this.BX.Socialnetwork||{},BX.Main,BX.UI,BX.UI,BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=script.map.js