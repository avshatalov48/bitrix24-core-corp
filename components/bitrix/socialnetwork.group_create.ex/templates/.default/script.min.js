this.BX=this.BX||{};(function(e,t,r,i,n,s,o){"use strict";var a;var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"initExpandSwitches",value:function e(){var t=document.querySelectorAll('[data-role="socialnetwork-group-create-ex__expandable"]');t.forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget.getAttribute("for");var r=document.getElementById(t);var i=r.firstElementChild;if(r.offsetHeight===0){r.style.height=i.offsetHeight+"px";r.classList.add("--open");var n=function e(){var t=r.getBoundingClientRect().top/100;var i=400;var n=0;var s=function e(){window.scrollBy(0,t)};while(n<=i){window.setTimeout(s,n,t);n+=i/100}r.removeEventListener("transitionend",e)};var s=function e(){r.style.height="auto";r.removeEventListener("transitionend",e)};r.addEventListener("transitionend",s);r.addEventListener("transitionend",n)}if(r.offsetHeight>0){r.style.height=r.offsetHeight+"px";setTimeout((function(){r.style.removeProperty("height");r.classList.remove("--open")}))}}))}))}},{key:"initDropdowns",value:function e(){var t=this;var r=document.querySelectorAll('[data-role="soc-net-dropdown"]');r.forEach((function(e){e.addEventListener("click",(function(e){var r=e.currentTarget;var i=t.getDropdownItems(r);var n=[];Object.entries(i).forEach((function(e){var i=babelHelpers.slicedToArray(e,2),a=i[0],c=i[1];n.push({text:c,onclick:function e(){s.close();t.setDropdownValue(r.querySelector(".ui-ctl-element"),c,r);t.setInputValue(r.querySelector("input"),a,r);var i=null;if(r.classList.contains("--nonproject")){i=r.parentNode.querySelector(".--project")}else if(r.classList.contains("--project")){i=r.parentNode.querySelector(".--nonproject")}if(o.Type.isDomNode(i)){t.setDropdownValue(i.querySelector(".ui-ctl-element"),c,i);t.setInputValue(i.querySelector("input"),a,i)}}})}));var s=new BX.PopupMenuWindow({autoHide:true,cacheable:false,bindElement:r,width:r.offsetWidth,closeByEsc:true,animation:"fading-slide",items:n});s.params.width=r.offsetWidth;s.show()}))}))}},{key:"setDropdownValue",value:function e(t,r,i){var n=this.getDropdownItems(i);Object.entries(n).forEach((function(e){var i=babelHelpers.slicedToArray(e,2),n=i[1];if(r===n){t.innerText=r}}))}},{key:"setInputValue",value:function e(t,r,i){var n=this.getDropdownItems(i);Object.entries(n).forEach((function(e){var i=babelHelpers.slicedToArray(e,1),n=i[0];if(r===n){t.value=r}}))}},{key:"getDropdownItems",value:function e(t){var r={};try{r=JSON.parse(t.getAttribute("data-items"))}catch(e){return{}}if(!o.Type.isPlainObject(r)){return{}}return r}},{key:"recalcFormPartProject",value:function e(t){t=!!t;var r=document.getElementById("GROUP_PROJECT");if(r){this.setCheckedValue(r,t)}document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-project, .socialnetwork-group-create-ex__create--switch-nonproject").forEach((function(e){if(t){e.classList.add("--project")}else{e.classList.remove("--project")}}));this.recalcNameInput()}},{key:"recalcNameInput",value:function e(){var t=document.getElementById("GROUP_NAME_input");if(!t){return}var r=o.Loc.getMessage("SONET_GCE_T_NAME3");var i=b.getInstance();if(o.Type.isPlainObject(i.projectTypes[i.selectedProjectType])){if(o.Type.isStringFilled(i.projectTypes[i.selectedProjectType].SCRUM_PROJECT)&&i.projectTypes[i.selectedProjectType].SCRUM_PROJECT==="Y"){r=o.Loc.getMessage("SONET_GCE_T_NAME3_SCRUM")}else if(o.Type.isStringFilled(i.projectTypes[i.selectedProjectType].PROJECT)&&i.projectTypes[i.selectedProjectType].PROJECT==="Y"){r=o.Loc.getMessage("SONET_GCE_T_NAME3_PROJECT")}}t.placeholder=r}},{key:"setCheckedValue",value:function e(t,r){if(!o.Type.isDomNode(t)){return}r=!!r;if(t.type==="checkbox"){t.checked=r}else{t.value=r?"Y":"N"}}},{key:"getCheckedValue",value:function e(t){var r=false;if(!o.Type.isDomNode(t)){return r}if(t.type=="hidden"){r=t.value==="Y"}else if(t.type=="checkbox"){r=t.checked}return r}},{key:"unselectAllSelectorItems",value:function e(t,r){var i=this;if(!o.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.remove(i.cssClass.selectorActive)}))}},{key:"selectSelectorItem",value:function e(t){t.classList.add(this.cssClass.selectorActive)}},{key:"disableAllSelectorItems",value:function e(t,r){var i=this;if(!o.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.add(i.cssClass.selectorDisabled)}))}},{key:"enableAllSelectorItems",value:function e(t,r){var i=this;if(!o.Type.isDomNode(t)){return}t.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.remove(i.cssClass.selectorDisabled)}))}},{key:"enableSelectorItem",value:function e(t){t.classList.remove(this.cssClass.selectorDisabled)}},{key:"recalcInputValue",value:function e(t){var r=t.selectedItems||[];var i=o.Type.isBoolean(t.multiple)?t.multiple:true;var n=t.inputContainerNodeId||"";var s=t.inputNodeName||"";if(!o.Type.isArray(r)||!o.Type.isStringFilled(s)||!o.Type.isStringFilled(n)){return}var c=document.getElementById(n);if(!c){return}if(i){s="".concat(s,"[]")}c.querySelectorAll('input[name="'.concat(s,'"]')).forEach((function(e){o.Dom.remove(e)}));r.forEach((function(e){var t=null;switch(e.entityId){case"department":t="DR";break;case"user":t="U";break;default:}if(t){c.appendChild(o.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="',"",'" >'],['<input type="hidden" name="','" value="',"",'" \\>'])),s,t,e.id))}}))}}]);return e}();babelHelpers.defineProperty(c,"cssClass",{selectorActive:"--active",selectorDisabled:"--disabled"});var l=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);var r=false;e.getItems().forEach((function(i){i.addEventListener("click",(function(t){var r=t.currentTarget;if(r.classList.contains(c.cssClass.selectorDisabled)){return}c.unselectAllSelectorItems(e.getContainer(),e.cssClass.selector);c.selectSelectorItem(r);b.getInstance().recalcForm({selectedConfidentialityType:r.getAttribute("data-bx-confidentiality-type")})}));var n=i.getAttribute("data-bx-confidentiality-type");if(o.Type.isStringFilled(b.getInstance().selectedConfidentialityType)){if(b.getInstance().selectedConfidentialityType===n){t.selectItem(i)}}else if(!r){t.selectItem(i);r=true}}));this.bindEvents()}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){b.getInstance().subscribe("onSwitchExtranet",e.onSwitchExtranet)}},{key:"selectItem",value:function e(t){c.selectSelectorItem(t);b.getInstance().recalcForm({selectedConfidentialityType:t.getAttribute("data-bx-confidentiality-type")})}}],[{key:"onSwitchExtranet",value:function t(r){var i=r.getData();if(!o.Type.isBoolean(i.isChecked)){return}if(i.isChecked){e.unselectAll();e.select("secret");e.disableAll();e.enable("secret")}else{e.enableAll()}}},{key:"getContainer",value:function e(){return document.querySelector(".".concat(this.cssClass.container))}},{key:"getItems",value:function e(){var t=this.getContainer();if(!t){return[]}return t.querySelectorAll(".".concat(this.cssClass.selector))}},{key:"unselectAll",value:function e(){c.unselectAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"select",value:function e(t){this.getItems().forEach((function(e){if(e.getAttribute("data-bx-confidentiality-type")!==t){return}c.selectSelectorItem(e)}))}},{key:"disableAll",value:function e(){c.disableAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"enableAll",value:function e(){c.enableAllSelectorItems(this.getContainer(),this.cssClass.selector)}},{key:"enable",value:function e(t){this.getItems().forEach((function(e){if(e.getAttribute("data-bx-confidentiality-type")!==t){return}c.enableSelectorItem(e)}))}}]);return e}();babelHelpers.defineProperty(l,"cssClass",{container:"socialnetwork-group-create-ex__type-confidentiality-wrapper",selector:"socialnetwork-group-create-ex__group-selector"});var d=function(){function e(t){babelHelpers.classCallCheck(this,e);this.isScrumProject=t.isScrumProject}babelHelpers.createClass(e,[{key:"makeAdditionalCustomizationForm",value:function e(){if(this.isScrumProject){this.createHiddenInputs();this.showScrumBlocks();if(!o.Type.isStringFilled(b.getInstance().selectedConfidentialityType)){l.unselectAll();l.select("open");b.getInstance().recalcForm({selectedConfidentialityType:"open"})}var t=document.getElementById("GROUP_LANDING");if(t){t.disabled=true;t.checked=false}this.toggleFeatures(true)}else{this.removeHiddenInputs();this.hideScrumBlocks();var r=document.getElementById("GROUP_LANDING");if(r){r.disabled=false}this.toggleFeatures(false)}c.recalcNameInput()}},{key:"hideScrumBlocks",value:function e(){document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-scrum, .socialnetwork-group-create-ex__create--switch-nonscrum").forEach((function(e){e.classList.remove("--scrum")}));var t=document.getElementById("expandable-moderator-block");if(t){t.classList.add("socialnetwork-group-create-ex__content-expandable")}var r=document.getElementById("GROUP_MODERATORS_PROJECT_switch");if(r){r.classList.add("ui-ctl-file-link")}var i=document.getElementById("GROUP_OWNER_block");if(i){i.classList.remove("--space-bottom")}}},{key:"showScrumBlocks",value:function e(){document.querySelectorAll(".socialnetwork-group-create-ex__create--switch-scrum, .socialnetwork-group-create-ex__create--switch-nonscrum").forEach((function(e){e.classList.add("--scrum")}));var t=document.getElementById("expandable-moderator-block");if(t){t.classList.remove("socialnetwork-group-create-ex__content-expandable")}var r=document.getElementById("GROUP_MODERATORS_PROJECT_switch");if(r){r.classList.remove("ui-ctl-file-link")}var i=document.getElementById("GROUP_OWNER_block");if(i){i.classList.add("--space-bottom")}}},{key:"createHiddenInputs",value:function e(){document.forms["sonet_group_create_popup_form"].appendChild(o.Dom.create("input",{attrs:{type:"hidden",name:"SCRUM_PROJECT",value:"Y"}}))}},{key:"removeHiddenInputs",value:function e(){document.forms["sonet_group_create_popup_form"].querySelectorAll('input[name="SCRUM_PROJECT"]').forEach((function(e){o.Dom.remove(e)}))}},{key:"toggleFeatures",value:function e(t){var r=document.querySelector(".socialnetwork-group-create-ex__project-instruments");if(r){r.querySelectorAll('input[type="checkbox"][name="tasks_active"], input[type="checkbox"][name="calendar_active"]').forEach((function(e){if(t){e.disabled=true;e.checked=true;e.parentNode.insertBefore(o.Dom.create("input",{attrs:{type:"hidden",name:e.name,value:"Y"}}),e)}else{e.disabled=false;document.forms["sonet_group_create_popup_form"].querySelectorAll('input[type="hidden"][name="'.concat(e.name,'"]')).forEach((function(e){o.Dom.remove(e)}))}}))}}}]);return e}();var u=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);this.confirmPopup=null;if(!o.Type.isStringFilled(t.componentName)||o.Type.isUndefined(t.signedParameters)){return}this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.groupId=!o.Type.isUndefined(t.groupId)?parseInt(t.groupId):0;var i=document.querySelector('[data-role="group-avatar-cont"]');if(!i){return}this.selectorNode=i.querySelector('[data-role="group-avatar-selector"]');this.imageNode=i.querySelector('[data-role="group-avatar-image"]');this.inputNode=i.querySelector('[data-role="group-avatar-input"]');this.typeInputNode=i.querySelector('[data-role="group-avatar-type-input"]');this.removeNode=i.querySelector('[data-role="group-avatar-remove"]');if(!o.Type.isDomNode(this.imageNode)||!o.Type.isDomNode(this.inputNode)||!o.Type.isDomNode(this.typeInputNode)||!o.Type.isDomNode(this.removeNode)){return}this.recalc();var s=new BX.AvatarEditor({enableCamera:false});this.selectorNode.addEventListener("click",(function(e){if(e.target.getAttribute("data-role")==="group-avatar-remove"&&r.imageNode.style.backgroundImage!==""){r.showConfirmPopup(o.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM"),r.deletePhoto.bind(r))}else if(e.target.getAttribute("data-role")==="group-avatar-type"){r.clearType();r.setType(e.target.getAttribute("data-avatar-type"))}else if(e.target.getAttribute("data-role")==="group-avatar-image"){s.show("file")}}));n.EventEmitter.subscribe("onApply",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,1),n=i[0];var s=new FormData;if(!n.name){n.name="tmp.png"}s.append("newPhoto",n,n.name);r.changePhoto(s)}))}babelHelpers.createClass(e,[{key:"recalc",value:function t(){if(this.getFileId()<=0){this.removeNode.classList.add(e.classList.hidden);this.imageNode.classList.remove(e.classList.selected)}else{this.removeNode.classList.remove(e.classList.hidden);this.imageNode.classList.add(e.classList.selected)}}},{key:"changePhoto",value:function e(t){var r=this;var i=this.showLoader({node:this.imageNode,loader:null,size:78});o.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:t}).then((function(e){if(o.Type.isPlainObject(e.data)&&parseInt(e.data.fileId)>0&&o.Type.isStringFilled(e.data.fileUri)){r.clearType();r.inputNode.value=parseInt(e.data.fileId);r.typeInputNode.value="";r.imageNode.style="background-image: url('".concat(encodeURI(e.data.fileUri),"'); background-size: cover;");r.recalc()}r.hideLoader({loader:i})}),(function(e){r.hideLoader({loader:i});r.showErrorPopup(e["errors"][0].message)}))}},{key:"deletePhoto",value:function e(){var t=this;var r=this.getFileId();if(r<0){return}var i=this.showLoader({node:this.imageNode,loader:null,size:78});o.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{fileId:r,groupId:this.groupId}}).then((function(e){t.imageNode.style="";t.inputNode.value="";t.recalc();t.hideLoader({loader:i})}),(function(e){t.hideLoader({loader:i});t.showErrorPopup(e.errors[0].message)}))}},{key:"clearType",value:function t(){this.selectorNode.querySelectorAll('[data-role="group-avatar-type"]').forEach((function(t){t.classList.remove(e.classList.selected)}))}},{key:"setType",value:function t(r){this.inputNode.value="";this.imageNode.style="";this.typeInputNode.value=r;this.imageNode.classList.remove(e.classList.selected);this.selectorNode.querySelectorAll('[data-role="group-avatar-type"]').forEach((function(t){if(t.getAttribute("data-avatar-type")!==r){return}t.classList.add(e.classList.selected)}));this.recalc()}},{key:"getFileId",value:function e(){return o.Type.isStringFilled(this.inputNode.value)?parseInt(this.inputNode.value):0}},{key:"showLoader",value:function e(t){var r=null;if(o.Type.isDomNode(t.node)){if(o.Type.isNull(t.loader)){r=new BX.Loader({target:t.node,size:t.hasOwnProperty("size")?t.size:40})}else{r=t.loader}r.show()}return r}},{key:"hideLoader",value:function e(t){if(!o.Type.isNull(t.loader)){t.loader.hide();t.loader=null}if(o.Type.isDomNode(t.node)){o.Dom.clean(t.node)}}},{key:"showErrorPopup",value:function e(r){if(!r){return}new t.Popup("gce-image-upload-error",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,closeIcon:true,content:r,events:{},cacheable:false}).show()}},{key:"showConfirmPopup",value:function e(i,n){var s=this;this.confirmPopup=new t.Popup("gce-image-delete-confirm",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,closeIcon:true,content:i,events:{onPopupClose:function e(){s.confirmPopup.destroy()}},cacheable:false,buttons:[new r.Button({text:o.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM_YES"),events:{click:function e(t){t.setWaiting(true);s.confirmPopup.close();n()}}}),new r.Button({text:o.Loc.getMessage("SONET_GCE_T_IMAGE_DELETE_CONFIRM_NO"),events:{click:function e(){s.confirmPopup.close()}}})]});this.confirmPopup.show()}}]);return e}();babelHelpers.defineProperty(u,"classList",{hidden:"--hidden",selected:"--selected"});var p=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);this.container=t.container;this.theme=t.theme;this.draw(this.theme);var i=this.getNode("image");if(i){i.addEventListener("click",this.open)}var s=this.getNode("title");if(s){s.addEventListener("click",this.open)}var o=this.getNode("delete");if(o){o.addEventListener("click",(function(){r.select({})}))}n.EventEmitter.subscribe("Intranet.ThemePicker:onSave",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),n=i[0];r.select(n)}))}babelHelpers.createClass(e,[{key:"select",value:function e(t){var r=o.Type.isPlainObject(t.theme)?t.theme:{};this.draw(r)}},{key:"draw",value:function e(t){var r=this.getNode("image");if(r){r.style.backgroundImage=o.Type.isStringFilled(t.previewImage)?"url('".concat(t.previewImage,"')"):"";r.style.backgroundColor=o.Type.isStringFilled(t.previewColor)?t.previewColor:"transparent"}var i=this.getNode("title");if(i){i.innerHTML=o.Type.isStringFilled(t.title)?t.title:""}var n=this.getNode("id");if(n){n.value=o.Type.isStringFilled(t.id)?t.id:""}}},{key:"open",value:function e(t){BX.Intranet.Bitrix24.ThemePicker.Singleton.showDialog(true);t.preventDefault()}},{key:"getNode",value:function e(t){var r=null;if(!o.Type.isStringFilled(t)){return r}return this.container.querySelector('[bx-group-edit-theme-node="'.concat(t,'"]'))}},{key:"getContainer",value:function e(){return this.container}}]);return e}();var m=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);var i=document.getElementById(t.containerNodeId);if(!i){return}this.hiddenFieldNode=document.getElementById(t.hiddenFieldId);var n=new s.TagSelector({addButtonCaption:o.Loc.getMessage("SONET_GCE_T_TAG_ADD"),addButtonCaptionMore:o.Loc.getMessage("SONET_GCE_T_KEYWORDS_ADD_TAG"),dialogOptions:{width:350,height:300,offsetLeft:50,compactView:true,preload:true,context:"PROJECT_TAG",searchTabOptions:{stubOptions:{title:o.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_FAILED"),subtitle:o.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_ADD_HINT"),arrow:true}},entities:[{id:"project-tag",options:{groupId:t.groupId}}],searchOptions:{allowCreateItem:true,footerOptions:{label:o.Loc.getMessage("SONET_GCE_T_TAG_SEARCH_ADD_FOOTER_LABEL")}},events:{"Item:onSelect":function e(t){r.recalcinputValue(t.getTarget().getSelectedItems())},"Item:onDeselect":function e(t){r.recalcinputValue(t.getTarget().getSelectedItems())},"Search:onItemCreateAsync":function e(t){return new Promise((function(e){var r=t.getData(),i=r.searchQuery;var n=i.getQuery().toLowerCase();var s=t.getTarget();setTimeout((function(){var t=n.split(",");t.forEach((function(e){var t=s.addItem({id:e,entityId:"project-tag",title:e,tabs:["all","recents"]});if(t){t.select()}}));e()}),1e3)}))}}}});n.renderTo(i)}babelHelpers.createClass(e,[{key:"recalcinputValue",value:function e(t){if(!o.Type.isArray(t)||!o.Type.isDomNode(this.hiddenFieldNode)){return}var r=[];t.forEach((function(e){r.push(e.id)}));this.hiddenFieldNode.value=r.join(",")}}]);return e}();var f=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.cssClass={container:"socialnetwork-group-create-ex__type-preset-wrapper",selector:"socialnetwork-group-create-ex__type-preset-selector"};this.container=document.querySelector(".".concat(this.cssClass.container));if(!this.container){return}var r=false;var i=this.container.querySelectorAll(".".concat(this.cssClass.selector));i.forEach((function(e){e.addEventListener("click",(function(e){var r=e.currentTarget;if(r.classList.contains(c.cssClass.selectorDisabled)){return}c.unselectAllSelectorItems(t.container,t.cssClass.selector);c.selectSelectorItem(r);var i=r.getAttribute("data-bx-project-type");b.getInstance().recalcForm({selectedProjectType:i});b.getInstance().wizardManager.setProjectType(i)}));var i=e.getAttribute("data-bx-project-type");if(o.Type.isStringFilled(b.getInstance().selectedProjectType)){if(b.getInstance().selectedProjectType===i){t.selectItem(e)}}else if(!r){t.selectItem(e);r=true}}))}babelHelpers.createClass(e,[{key:"selectItem",value:function e(t){var r=t.getAttribute("data-bx-project-type");c.selectSelectorItem(t);b.getInstance().recalcForm({selectedProjectType:r});b.getInstance().wizardManager.setProjectType(r)}}]);return e}();var h=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"check",value:function e(){if(b.getInstance().wizardManager.stepsCount===1){return this.checkAll()}else{return this.checkStep(b.getInstance().wizardManager.currentStep)}}},{key:"checkStep",value:function e(t){var r=this;t=parseInt(t);var i=[];if(o.Type.isArray(this.mandatoryFieldsByStep[t])){this.mandatoryFieldsByStep[t].forEach((function(e){var t=document.getElementById(e.id);if(!o.Type.isDomNode(t)){return}if(t.tagName.toLowerCase()!=="input"){if(e.type==="string"){t=t.querySelector('input[type="text"]');if(!o.Type.isDomNode(t)){return}}}e.fieldNode=t;var n=r.checkField(e);if(o.Type.isStringFilled(n)){var s=document.getElementById(e.bindNodeId);i.push({bindNode:o.Type.isDomNode(s)?s:t,message:n})}}))}return i}},{key:"checkAll",value:function e(){var t=this;var r=[];Object.entries(this.mandatoryFieldsByStep).forEach((function(e){r=r.concat(t.checkStep(parseInt(e[0])))}));return r}},{key:"checkField",value:function e(t){var r="";if(!o.Type.isPlainObject(t)&&!o.Type.isDomNode(t.fieldNode)){return r}if(o.Type.isFunction(t.condition)){if(!t.condition()){return r}}var i=t.fieldNode;var n=o.Type.isStringFilled(t.type)?t.type:"string";switch(n){case"string":r=i.value.trim()===""?o.Loc.getMessage("SONET_GCE_T_STRING_FIELD_ERROR"):"";break;case"input_hidden_container":var s=true;i.querySelectorAll('input[type="hidden"]').forEach((function(e){if(!s){return}if(o.Type.isStringFilled(e.value)){s=false}}));r=s?o.Loc.getMessage("SONET_GCE_T_STRING_FIELD_ERROR"):"";break;default:r=""}return r}},{key:"showError",value:function e(t){if(!o.Type.isPlainObject(t)||!o.Type.isStringFilled(t.message)||!o.Type.isDomNode(t.bindNode)){return}b.getInstance().alertManager.showAlert(t.message,t.bindNode.parentNode)}}]);return e}();babelHelpers.defineProperty(h,"mandatoryFieldsByStep",{2:[{id:"GROUP_NAME_input",type:"string",bindNodeId:"GROUP_NAME_input"}],4:[{id:"SCRUM_MASTER_CODE_container",type:"input_hidden_container",bindNodeId:"SCRUM_MASTER_selector",condition:function e(){return!!b.getInstance().scrumManager.isScrumProject}}]});var y=function(){function e(){babelHelpers.classCallCheck(this,e);this.submitButton=document.getElementById("sonet_group_create_popup_form_button_submit");if(!this.submitButton){return}this.submitButtonClickHandler=this.submitButtonClickHandler.bind(this);this.submitButton.addEventListener("click",this.submitButtonClickHandler);this.backButton=document.getElementById("sonet_group_create_popup_form_button_step_2_back");if(this.backButton){this.backButton.addEventListener("click",(function(e){var t=r.ButtonManager.createFromNode(e.currentTarget);if(t&&t.isDisabled()){return}if(b.getInstance().wizardManager.currentStep>1){b.getInstance().wizardManager.currentStep--;if(b.getInstance().wizardManager.currentStep===3&&Object.entries(b.getInstance().confidentialityTypes)<=1){b.getInstance().wizardManager.currentStep--}b.getInstance().wizardManager.showCurrentStep()}return e.preventDefault()}))}this.cancelButton=document.getElementById("sonet_group_create_popup_form_button_step_2_cancel");if(this.cancelButton){this.cancelButton.addEventListener("click",(function(e){var t=r.ButtonManager.createFromNode(e.currentTarget);if(t&&t.isDisabled()){return}var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){var s=new n.BaseEvent({compatData:[i.getEvent("onClose")],data:i.getEvent("onClose")});n.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",s)}else{var a=e.currentTarget.getAttribute("bx-url");if(o.Type.isStringFilled(a)){window.location=a}}var c=new n.BaseEvent({compatData:[false],data:false});n.EventEmitter.emit(window.top,"BX.Bitrix24.PageSlider:close",c);n.EventEmitter.emit(window.top,"onSonetIframeCancelClick");return e.preventDefault()}))}}babelHelpers.createClass(e,[{key:"submitButtonClickHandler",value:function e(t){var i=r.ButtonManager.createFromNode(t.currentTarget);if(i&&i.isDisabled()){return}b.getInstance().alertManager.hideAllAlerts();var n=h.check().filter((function(e){return o.Type.isPlainObject(e)&&o.Type.isStringFilled(e.message)&&o.Type.isDomNode(e.bindNode)}));if(n.length>0){n.forEach((function(e){h.showError(e)}))}else if(b.getInstance().wizardManager.currentStep<b.getInstance().wizardManager.stepsCount){b.getInstance().wizardManager.currentStep++;if(b.getInstance().wizardManager.currentStep===3&&Object.entries(b.getInstance().confidentialityTypes)<=1){b.getInstance().wizardManager.currentStep++}b.getInstance().wizardManager.showCurrentStep()}else{var s=function(e){b.getInstance().submitForm(e)}.bind(b.getInstance());s(t)}return t.preventDefault()}}],[{key:"showWaitSubmitButton",value:function e(t){t=!!t;var i=document.getElementById("sonet_group_create_popup_form_button_submit");if(!i){return}var n=r.ButtonManager.createFromNode(i);if(t){if(n){n.setWaiting(true)}i.removeEventListener("click",b.getInstance().submitButtonClickHandler)}else{if(n){n.setWaiting(false)}i.addEventListener("click",b.getInstance().submitButtonClickHandler)}}},{key:"disableButton",value:function e(t,i){if(!o.Type.isDomNode(t)){return}var n=r.ButtonManager.createFromNode(t);if(!n){return}n.setDisabled(i)}},{key:"showButton",value:function e(t){if(!o.Type.isDomNode(t)){return}t.classList.remove(this.cssClass.hidden)}},{key:"hideButton",value:function e(t){if(!o.Type.isDomNode(t)){return}t.classList.add(this.cssClass.hidden)}}]);return e}();babelHelpers.defineProperty(y,"cssClass",{hidden:"socialnetwork-group-create-ex__button-invisible"});var g=function(){babelHelpers.createClass(e,null,[{key:"getFirstStepNumber",value:function e(){return Object.entries(b.getInstance().projectTypes).length>1?1:2}}]);function e(t){babelHelpers.classCallCheck(this,e);this.processedStep=0;this.currentStep=t.currentStep;this.stepsCount=t.stepsCount;this.step1BackgroudNode=document.querySelector(".".concat(e.cssClass.step1Backgroud));this.bodyContainer=document.querySelector(".".concat(e.cssClass.bodyContainer));this.breadcrumbsContainer=document.querySelector(".".concat(e.cssClass.breadcrumbsContainer))}babelHelpers.createClass(e,[{key:"showCurrentStep",value:function t(){var r=this;if(o.Type.isDomNode(this.bodyContainer)){this.bodyContainer.querySelectorAll(".".concat(e.cssClass.bodyItem)).forEach((function(t){if(t.classList.contains("--step-".concat(r.currentStep))){t.classList.add(e.cssClass.activeBodyItem)}else{t.classList.remove(e.cssClass.activeBodyItem)}}))}if(o.Type.isDomNode(this.breadcrumbsContainer)){this.breadcrumbsContainer.querySelectorAll(".".concat(e.cssClass.breadcrumbsItem)).forEach((function(t){if(t.classList.contains("--step-".concat(r.currentStep))){t.classList.add(e.cssClass.activeBreadcrumbsItem)}else{t.classList.remove(e.cssClass.activeBreadcrumbsItem)}}))}if(this.currentStep===e.getFirstStepNumber()||this.currentStep<=this.processedStep+1){y.hideButton(b.getInstance().buttonsInstance.backButton)}else{if(o.Type.isDomNode(this.step1BackgroudNode)){this.step1BackgroudNode.classList.add("--stop")}y.showButton(b.getInstance().buttonsInstance.backButton)}}},{key:"setProjectType",value:function e(t){var r=this;if(o.Type.isDomNode(this.step1BackgroudNode)){["project","scrum","group"].forEach((function(e){r.step1BackgroudNode.classList.remove("--".concat(e))}));this.step1BackgroudNode.classList.remove("--stop");this.step1BackgroudNode.classList.add("--".concat(t))}}},{key:"recalcAfterSubmit",value:function e(t){var r=o.Type.isStringFilled(t.processedStep)?t.processedStep:"";var i=parseInt(!o.Type.isUndefined(t.createdGroupId)?t.createdGroupId:0);var n=document.getElementById("TAB");var s=document.getElementById("SONET_GROUP_ID");if(!n||!o.Type.isStringFilled(r)||i<=0){return}s.value=i;if(r==="create"){this.processedStep=1;n.value="edit"}else if(r==="edit"){this.processedStep=3;n.value="invite";this.bodyContainer.querySelectorAll(".socialnetwork-group-create-ex__create--switch-notinviteonly").forEach((function(e){e.classList.add("--inviteonly")}))}this.showCurrentStep()}}]);return e}();babelHelpers.defineProperty(g,"cssClass",{step1Backgroud:"socialnetwork-group-create-ex__background-gif",breadcrumbsContainer:"socialnetwork-group-create-ex__breadcrumbs",breadcrumbsItem:"socialnetwork-group-create-ex__breadcrumbs-item",bodyContainer:"socialnetwork-group-create-ex__content",bodyItem:"socialnetwork-group-create-ex__content-body",activeBodyItem:"--active",activeBreadcrumbsItem:"--active"});var v=function(){function e(t){babelHelpers.classCallCheck(this,e);if(!o.Type.isStringFilled(t.errorContainerId)){return}this.globalErrorContainer=document.getElementById(t.errorContainerId);this.nodeAlerts=new Map}babelHelpers.createClass(e,[{key:"showAlert",value:function e(t,r){if(o.Type.isDomNode(r)){r.classList.add("ui-ctl-danger")}else{r=this.globalErrorContainer}var n=new i.Alert({color:i.Alert.Color.DANGER,animate:true});this.nodeAlerts.set(r,n);setTimeout((function(){r.parentNode.insertBefore(n.getContainer(),r.nextSibling);n.setText(t);window.scrollTo({top:o.Dom.getPosition(r).top,behavior:"smooth"})}),500)}},{key:"hideAllAlerts",value:function e(){this.nodeAlerts.forEach((function(e,t){e.hide();if(o.Type.isDomNode(t)){t.classList.remove("ui-ctl-danger")}}));this.nodeAlerts.clear()}}]);return e}();var S=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){return e.instance}}]);function e(t){babelHelpers.classCallCheck(this,e);this.groupId=parseInt(t.groupId,10);this.ownerSelector=null;this.scrumMasterSelector=null;this.moderatorsSelector=null;this.usersSelector=null;this.ownerOptions=t.ownerOptions||{};this.scrumMasterOptions=t.scrumMasterOptions||{};this.moderatorsOptions=t.moderatorsOptions||{};this.usersOptions=t.usersOptions||{};this.ownerContainerNode=document.getElementById("GROUP_OWNER_selector");this.scrumMasterContainerNode=document.getElementById("SCRUM_MASTER_selector");this.moderatorsContainerNode=document.getElementById("GROUP_MODERATORS_selector");this.usersContainerNode=document.getElementById("GROUP_USERS_selector");this.isCurrentUserAdmin=o.Type.isBoolean(t.isCurrentUserAdmin)?t.isCurrentUserAdmin:false;this.extranetInstalled=o.Type.isBoolean(t.extranetInstalled)?t.extranetInstalled:false;this.allowExtranet=o.Type.isBoolean(t.allowExtranet)?t.allowExtranet:false;e.instance=this;this.buildOwnerSelector();this.buildScrumMasterSelector();this.buildModeratorsSelector();this.buildUsersSelector();this.bindEvents()}babelHelpers.createClass(e,[{key:"buildOwnerSelector",value:function t(){if(!o.Type.isDomNode(this.ownerContainerNode)){return}o.Dom.clean(this.ownerContainerNode);var r=this.ownerOptions;this.ownerSelector=new s.TagSelector({id:r.selectorId||"group_create_owner",dialogOptions:{id:r.selectorId||"group_create_owner",context:e.contextList.owner,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onOwnerSelect,"Item:onDeselect":e.onOwnerSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true,inviteExtranetLink:true,groupId:this.groupId,checkWorkgroupWhenInvite:true}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:false,addButtonCaption:o.Loc.getMessage("SONET_GCE_T_ADD_OWNER")});this.ownerSelector.renderTo(this.ownerContainerNode)}},{key:"buildScrumMasterSelector",value:function t(){if(!o.Type.isDomNode(this.scrumMasterContainerNode)){return}o.Dom.clean(this.scrumMasterContainerNode);var r=this.scrumMasterOptions;this.scrumMasterSelector=new s.TagSelector({id:r.selectorId||"group_create_scrum_master",dialogOptions:{id:r.selectorId||"group_create_scrum_master",context:e.contextList.scrumMaster,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onScrumMasterSelect,"Item:onDeselect":e.onScrumMasterSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:false,addButtonCaption:o.Loc.getMessage("SONET_GCE_T_CHANGE_SCRUM_MASTER"),addButtonCaptionMore:o.Loc.getMessage("SONET_GCE_T_CHANGE_SCRUM_MASTER_MORE")});this.scrumMasterSelector.renderTo(this.scrumMasterContainerNode)}},{key:"buildModeratorsSelector",value:function t(){if(!o.Type.isDomNode(this.moderatorsContainerNode)){return}o.Dom.clean(this.moderatorsContainerNode);var r=this.moderatorsOptions;this.moderatorsSelector=new s.TagSelector({id:r.selectorId||"group_create_moderators",dialogOptions:{id:r.selectorId||"group_create_moderators",context:e.contextList.moderators,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onModeratorsSelect,"Item:onDeselect":e.onModeratorsSelect},entities:[{id:"user",options:{intranetUsersOnly:!this.allowExtranet,inviteEmployeeLink:true,groupId:this.groupId,checkWorkgroupWhenInvite:true}},{id:"department",options:{selectMode:"usersOnly"}}]},multiple:true,addButtonCaption:o.Loc.getMessage("SONET_GCE_T_ADD_USER"),addButtonCaptionMore:o.Loc.getMessage("SONET_GCE_T_ADD_USER_MORE")});this.moderatorsSelector.renderTo(this.moderatorsContainerNode)}},{key:"buildUsersSelector",value:function t(){if(!o.Type.isDomNode(this.usersContainerNode)){return}o.Dom.clean(this.usersContainerNode);var r=this.usersOptions;this.usersSelector=new s.TagSelector({id:r.selectorId||"group_create_users",dialogOptions:{id:r.selectorId||"group_create_users",context:e.contextList.users,preselectedItems:r.value,events:{onLoad:this.onLoad.bind(this),"Item:onSelect":e.onUsersSelect,"Item:onDeselect":e.onUsersSelect},entities:[{id:"user",options:{inviteEmployeeLink:true,"!userId":this.isCurrentUserAdmin?[parseInt(o.Loc.getMessage("USER_ID"))]:[],intranetUsersOnly:!this.allowExtranet,groupId:this.groupId,checkWorkgroupWhenInvite:true}},{id:"department",options:{selectMode:r.enableSelectDepartment?"usersAndDepartments":"usersOnly"}}]},multiple:true,addButtonCaption:o.Loc.getMessage("SONET_GCE_T_ADD_USER"),addButtonCaptionMore:o.Loc.getMessage("SONET_GCE_T_ADD_USER_MORE")});this.usersSelector.renderTo(this.usersContainerNode)}},{key:"bindEvents",value:function e(){b.getInstance().subscribe("onSwitchExtranet",this.onSwitchExtranet.bind(this));n.EventEmitter.emit("BX.Socialnetwork.WorkgroupFormTeamManager::onEventsBinded")}},{key:"onSwitchExtranet",value:function e(t){var r=t.getData();if(!o.Type.isBoolean(r.isChecked)){return}this.allowExtranet=this.extranetInstalled&&r.isChecked;if(this.ownerSelector&&["DONE","UNSENT"].includes(this.ownerSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.ownerSelector,isChecked:r.isChecked,options:this.ownerOptions});this.buildOwnerSelector()}if(this.scrumMasterSelector&&["DONE","UNSENT"].includes(this.scrumMasterSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.scrumMasterSelector,isChecked:r.isChecked,options:this.scrumMasterOptions});this.buildScrumMasterSelector()}if(this.moderatorsSelector&&["DONE","UNSENT"].includes(this.moderatorsSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.moderatorsSelector,isChecked:r.isChecked,options:this.moderatorsOptions});this.buildModeratorsSelector()}if(this.usersSelector&&["DONE","UNSENT"].includes(this.usersSelector.getDialog().loadState)){this.recalcSelectorByExtranetSwitched({selector:this.usersSelector,isChecked:r.isChecked,options:this.usersOptions});this.buildUsersSelector()}}},{key:"recalcSelectorByExtranetSwitched",value:function t(r){var i=r.selector;var n=r.isChecked;var s=i.getDialog().getContext();var a=i.getDialog().getSelectedItems();if(this.extranetInstalled&&!n&&o.Type.isArray(a)){a=a.filter((function(e){return!(e.getEntityId()==="user"&&e.getEntityType()==="extranet")}));switch(s){case e.contextList.owner:c.recalcInputValue({selectedItems:a,inputNodeName:"OWNER_CODE",inputContainerNodeId:"OWNER_CODE_container",multiple:false});break;case e.contextList.scrumMaster:c.recalcInputValue({selectedItems:a,inputNodeName:"SCRUM_MASTER_CODE",inputContainerNodeId:"SCRUM_MASTER_CODE_container",multiple:false});break;case e.contextList.moderators:c.recalcInputValue({selectedItems:a,inputNodeName:"MODERATOR_CODES",inputContainerNodeId:"MODERATOR_CODES_container",multiple:true});break;case e.contextList.users:c.recalcInputValue({selectedItems:a,inputNodeName:"USER_CODES",inputContainerNodeId:"USER_CODES_container",multiple:true});break;default:}}r.options.value=a.map((function(e){return[e.getEntityId(),e.getId()]}))}},{key:"onLoad",value:function t(r){switch(r.getTarget().context){case e.contextList.owner:this.recalcSelectorByExtranetSwitched({selector:this.ownerSelector,isChecked:this.allowExtranet,options:this.ownerOptions});break;case e.contextList.scrumMaster:this.recalcSelectorByExtranetSwitched({selector:this.scrumMasterSelector,isChecked:this.allowExtranet,options:this.scrumMasterOptions});break;case e.contextList.moderators:this.recalcSelectorByExtranetSwitched({selector:this.moderatorsSelector,isChecked:this.allowExtranet,options:this.moderatorsOptions});if(b.getInstance().initialFocus==="addModerator"){this.moderatorsSelector.getAddButtonLink().click()}break;case e.contextList.users:this.recalcSelectorByExtranetSwitched({selector:this.usersSelector,isChecked:this.allowExtranet,options:this.usersOptions});break;default:}}}],[{key:"onOwnerSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"OWNER_CODE",inputContainerNodeId:"OWNER_CODE_container",multiple:false})}},{key:"onScrumMasterSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"SCRUM_MASTER_CODE",inputContainerNodeId:"SCRUM_MASTER_CODE_container",multiple:false})}},{key:"onModeratorsSelect",value:function e(t){c.recalcInputValue({selectedItems:t.getTarget().getSelectedItems(),inputNodeName:"MODERATOR_CODES",inputContainerNodeId:"MODERATOR_CODES_container",multiple:true})}},{key:"onUsersSelect",value:function t(r){c.recalcInputValue({selectedItems:r.getTarget().getSelectedItems(),inputNodeName:"USER_CODES",inputContainerNodeId:"USER_CODES_container",multiple:true});var i=document.getElementById("GROUP_ADD_DEPT_HINT_block");if(i){e.showDepartmentHint({selectedItems:r.getTarget().getSelectedItems(),hintNode:i})}}},{key:"showDepartmentHint",value:function e(t){var r=t.selectedItems||{};var i=t.hintNode||null;if(!o.Type.isDomNode(i)){return}if(!o.Type.isArray(r)){i.classList.remove("visible");return}var n=!o.Type.isUndefined(r.find((function(e){return e.entityId==="department"})));if(n){i.classList.add("visible")}else{i.classList.remove("visible")}}}]);return e}();babelHelpers.defineProperty(S,"instance",null);babelHelpers.defineProperty(S,"contextList",{owner:"GROUP_INVITE_OWNER",scrumMaster:"GROUP_INVITE_SCRUM_MASTER",moderators:"GROUP_INVITE_MODERATORS",users:"GROUP_INVITE"});var E=function e(){babelHelpers.classCallCheck(this,e);var t=document.getElementById("additional-block-features");if(!t){return}t.querySelectorAll(".socialnetwork-group-create-ex__project-instruments--icon-action.--edit").forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget;var r=t.closest(".socialnetwork-group-create-ex__project-instruments--item");if(r){r.classList.add("--custom-value");var i=r.querySelector('[data-role="feature-input-text"]');var n=r.querySelector('[data-role="feature-label"]');if(i&&n){i.value=n.innerText}}e.preventDefault()}))}));t.querySelectorAll(".socialnetwork-group-create-ex__project-instruments--icon-action.--revert").forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget;var r=t.closest(".socialnetwork-group-create-ex__project-instruments--item");if(r){r.classList.remove("--custom-value");var i=r.querySelector('[data-role="feature-input-text"]');if(i){i.value=""}}e.preventDefault()}))}))};var T=function e(t){babelHelpers.classCallCheck(this,e);if(o.Type.isPlainObject(h.mandatoryFieldsByStep)&&o.Type.isArray(h.mandatoryFieldsByStep[2])&&o.Type.isArray(t.mandatoryUFList)){t.mandatoryUFList.forEach((function(e){if(!o.Type.isStringFilled(e.id)||!o.Type.isStringFilled(e.type)){return}h.mandatoryFieldsByStep[2].push(e)}))}};var b=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getInstance",value:function e(){return t.instance}}]);function t(e){var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));r.setEventNamespace("BX.Socialnetwork.WorkgroupForm");r.componentName=e.componentName;r.signedParameters=e.signedParameters;r.userSelector="";r.lastAction="invite";r.animationList={};r.selectedTypeCode=false;r.groupId=parseInt(e.groupId);r.isScrumProject=e.isScrumProject;r.config=e.config;r.avatarUploaderId=e.avatarUploaderId;r.themePickerData=e.themePickerData;r.projectOptions=e.projectOptions;r.projectTypes=e.projectTypes;r.confidentialityTypes=e.confidentialityTypes;r.selectedProjectType=e.selectedProjectType;r.selectedConfidentialityType=e.selectedConfidentialityType;r.initialFocus=o.Type.isStringFilled(e.focus)?e.focus:"";r.scrumManager=new d({isScrumProject:r.isScrumProject});r.wizardManager=new g({currentStep:Object.entries(r.projectTypes).length>1?1:2,stepsCount:e.stepsCount>1?e.stepsCount:1});r.alertManager=new v({errorContainerId:"sonet_group_create_error_block"});t.instance=babelHelpers.assertThisInitialized(r);r.init(e);r.buttonsInstance=new y;return r}babelHelpers.createClass(t,[{key:"init",value:function e(t){this.scrumManager.makeAdditionalCustomizationForm();if(this.groupId<=0){this.recalcForm()}new u({componentName:this.componentName,signedParameters:this.signedParameters,groupId:this.groupId});if(o.Type.isPlainObject(t.themePickerData)&&document.getElementById("GROUP_THEME_container")){new p({container:document.getElementById("GROUP_THEME_container"),theme:t.themePickerData})}if(document.getElementById("group-tags-bind-node")){new m({groupId:this.groupId,containerNodeId:"group-tags-bind-node",hiddenFieldId:"GROUP_KEYWORDS"})}new f;new l;new E;if(o.Type.isStringFilled(this.initialFocus)){if(this.initialFocus==="description"){var r=document.getElementById("GROUP_DESCRIPTION_input");if(r){r.focus()}}}else{var i=document.getElementById("GROUP_NAME_input");if(i){i.focus()}}this.bindEvents();c.initExpandSwitches();c.initDropdowns();if(o.Type.isStringFilled(t.expandableSettingsNodeId)){BX.UI.Hint.init(document.getElementById(t.expandableSettingsNodeId))}if(this.groupId<=0&&this.selectedProjectType==="scrum"){this.saveScrumAnalyticData()}}},{key:"bindEvents",value:function e(){var t=this;if(BX.SidePanel.Instance.getTopSlider()){n.EventEmitter.subscribe(BX.SidePanel.Instance.getTopSlider().getWindow(),"SidePanel.Slider:onClose",(function(e){setTimeout((function(){var t=e.getTarget();if(!t){return}BX.SidePanel.Instance.destroy(t.getUrl())}),500)}))}var r=document.getElementById("IS_EXTRANET_GROUP");if(r&&r.type==="checkbox"){r.addEventListener("click",(function(){t.switchExtranet(r.checked)}))}var i=document.getElementById("GROUP_VISIBLE");if(i&&i.type==="checkbox"){i.addEventListener("click",(function(){t.switchNotVisible(i.checked)}))}var s=document.getElementById("GROUP_PROJECT");if(s&&s.type==="checkbox"){s.addEventListener("click",(function(){c.recalcFormPartProject(s.checked)}))}n.EventEmitter.subscribe("BX.Socialnetwork.WorkgroupFormTeamManager::onEventsBinded",this.recalcFormDependencies.bind(this))}},{key:"recalcForm",value:function e(t){if(o.Type.isPlainObject(t)){if(!o.Type.isUndefined(t.selectedProjectType)){this.selectedProjectType=o.Type.isStringFilled(t.selectedProjectType)?t.selectedProjectType:""}if(!o.Type.isUndefined(t.selectedConfidentialityType)){this.selectedConfidentialityType=o.Type.isStringFilled(t.selectedConfidentialityType)?t.selectedConfidentialityType:""}}if(this.groupId<=0){this.scrumManager.isScrumProject=o.Type.isPlainObject(this.projectTypes[this.selectedProjectType])&&o.Type.isStringFilled(this.projectTypes[this.selectedProjectType]["SCRUM_PROJECT"])&&this.projectTypes[this.selectedProjectType]["SCRUM_PROJECT"]==="Y";c.recalcFormPartProject(o.Type.isPlainObject(this.projectTypes[this.selectedProjectType])&&o.Type.isStringFilled(this.projectTypes[this.selectedProjectType].PROJECT)&&this.projectTypes[this.selectedProjectType].PROJECT==="Y")}this.scrumManager.makeAdditionalCustomizationForm();if(this.groupId<=0){var r=document.getElementById("GROUP_OPENED");if(r){c.setCheckedValue(r,o.Type.isPlainObject(this.confidentialityTypes[this.selectedConfidentialityType])&&o.Type.isStringFilled(this.confidentialityTypes[this.selectedConfidentialityType].OPENED)&&this.confidentialityTypes[this.selectedConfidentialityType].OPENED==="Y")}var i=document.getElementById("GROUP_VISIBLE");if(i){c.setCheckedValue(i,o.Type.isPlainObject(this.confidentialityTypes[this.selectedConfidentialityType])&&o.Type.isStringFilled(this.confidentialityTypes[this.selectedConfidentialityType].VISIBLE)&&this.confidentialityTypes[this.selectedConfidentialityType].VISIBLE==="Y")}}this.recalcFormDependencies()}},{key:"recalcFormDependencies",value:function e(){var t=document.getElementById("IS_EXTRANET_GROUP");if(t){this.switchExtranet(c.getCheckedValue(t))}var r=document.getElementById("GROUP_VISIBLE");if(r){this.switchNotVisible(r.checked)}}},{key:"switchExtranet",value:function e(t){this.emit("onSwitchExtranet",new n.BaseEvent({data:{isChecked:t}}));var r=document.getElementById("GROUP_OPENED");if(r){if(!t){if(r.type==="checkbox"){r.disabled=false}}else{if(r.type==="checkbox"){r.disabled=true;r.checked=false}else{r.value="N"}}}var i=document.getElementById("GROUP_VISIBLE");if(i){if(!t){if(i.type=="checkbox"){i.disabled=false}}else{if(i.type=="checkbox"){i.disabled=true;i.checked=false}else{i.value="N"}}this.switchNotVisible(i.checked)}}},{key:"switchNotVisible",value:function e(t){var r=document.getElementById("GROUP_OPENED");if(r&&r.type=="checkbox"){if(t){r.disabled=false}else{r.disabled=true;r.checked=false}}}},{key:"submitForm",value:function e(t){var r=this;var i=document.getElementById("sonet_group_create_popup_form").action;if(i){var s=document.getElementById("SONET_GROUP_ID");var a="addSonetGroup";if(s){if(parseInt(s.value)<=0){i=o.Uri.addParam(i,{action:"createGroup",groupType:this.selectedTypeCode})}else{a="editSonetGroup"}}i=o.Uri.addParam(i,{b24statAction:a});var c=document.forms["sonet_group_create_popup_form"].elements;if(c.GROUP_PROJECT&&(c.IS_EXTRANET_GROUP||c.GROUP_OPENED)){var l=c.GROUP_PROJECT.checked?"project-":"group-";if(c.IS_EXTRANET_GROUP&&c.IS_EXTRANET_GROUP.checked){l+="external"}else{l+=c.GROUP_OPENED.checked?"open":"closed"}i=o.Uri.addParam(i,{b24statType:l})}if(c.SCRUM_PROJECT&&a==="addSonetGroup"){i=o.Uri.addParam(i,{analyticsLabel:{scrum:"Y",action:"scrum_create"}})}y.showWaitSubmitButton(true);o.ajax.submitAjax(document.forms["sonet_group_create_popup_form"],{url:i,method:"POST",dataType:"json",data:{PROJECT_OPTIONS:this.projectOptions},onsuccess:function e(t){if(o.Type.isStringFilled(t.ERROR)){var i=o.Type.isStringFilled(t.WARNING)?"".concat(t.WARNING,"<br>"):"";r.alertManager.showAlert("".concat(i).concat(t.ERROR));if(o.Type.isStringFilled(t.WIZARD_STEP_PROCESSED)){r.wizardManager.recalcAfterSubmit({processedStep:t.WIZARD_STEP_PROCESSED.toLowerCase(),createdGroupId:parseInt(!o.Type.isUndefined(t.CREATED_GROUP_ID)?t.CREATED_GROUP_ID:0)})}if(o.Type.isArray(t.SUCCESSFULL_USERS_ID)&&t.SUCCESSFULL_USERS_ID.length>0){t.SUCCESSFULL_USERS_ID=t.SUCCESSFULL_USERS_ID.map((function(e){return Number(e)}));var s=S.getInstance().usersSelector;var a=s?s.getDialog():null;if(a){a.getSelectedItems().forEach((function(e){if(e.entityId==="user"&&t.SUCCESSFULL_USERS_ID.includes(e.id)){e.deselect()}}))}window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:"afterInvite",data:{}})}y.showWaitSubmitButton(false)}else if(t.MESSAGE==="SUCCESS"){var c=BX.SidePanel.Instance.getSliderByWindow(window);if(c){var l=new n.BaseEvent({compatData:[c.getEvent("onClose")],data:c.getEvent("onClose")});n.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",l)}if(window===top.window){if(o.Type.isStringFilled(t.URL)){top.location.href=t.URL}}else if(o.Type.isStringFilled(t.ACTION)){var d=null;if(["create","edit"].includes(t.ACTION)&&!o.Type.isUndefined(t.GROUP)){d={code:t.ACTION=="create"?"afterCreate":"afterEdit",data:{group:t.GROUP,projectOptions:r.projectOptions}}}else if(t.ACTION==="invite"){d={code:"afterInvite",data:{}}}if(d){window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",d);if(t.ACTION==="create"){var u=JSON.parse(t.SELECTOR_GROUPS);if(o.Type.isArray(u)){window.top.BX.SidePanel.Instance.postMessageAll(window,"BX.Socialnetwork.Workgroup:onAdd",{projects:u})}}if(c){BX.SidePanel.Instance.close(false,(function(){BX.SidePanel.Instance.destroy(c.getUrl())}))}if(t.ACTION=="create"&&o.Type.isStringFilled(t.URL)&&(!o.Type.isStringFilled(r.config.refresh)||r.config.refresh==="Y")){var p=false;BX.SidePanel.Instance.anchorRules.find((function(e){if(p||!o.Type.isArray(e.condition)){return}e.condition.forEach((function(e){if(p){return}if(t.URL.match(e)){p=true}}))}));if(p){BX.SidePanel.Instance.open(t.URL)}else{top.window.location.href=t.URL}}}}}},onfailure:function e(t){y.showWaitSubmitButton(false);r.alertManager.showAlert(o.Loc.getMessage("SONET_GCE_T_AJAX_ERROR"))}})}t.preventDefault()}},{key:"saveScrumAnalyticData",value:function e(){var t=document.getElementById("sonet_group_create_popup_form").action;var r=new o.Uri(t).getQueryParam("source");var i=new Set(["guide_adv","guide_direct","guide_portal"]);if(i.has(r)){o.ajax.runAction("bitrix:tasks.scrum.info.saveScrumStart",{data:{},analyticsLabel:{scrum:"Y",action:"scrum_start",source:r}})}}},{key:"showHideBlock",value:function e(t){var r=this;if(!o.Type.isPlainObject(t)){return false}var i=t.container;var n=t.block;var s=!!t.show;if(!o.Type.isDomNode(i)||!o.Type.isDomNode(n)){return false}if(!o.Type.isUndefined(this.animationList[n.id])&&!o.Type.isNull(this.animationList[n.id])){return false}this.animationList[n.id]=null;var a=parseInt(n.offsetHeight);var c=!o.Type.isUndefined(t.duration)&&parseInt(t.duration)>0?parseInt(t.duration):0;if(s){i.style.display="block"}if(c>0){if(o.Type.isStringFilled(n.id)){this.animationList[n.id]=true}BX.delegate(new BX.easing({duration:c,start:{height:s?0:a,opacity:s?0:100},finish:{height:s?a:0,opacity:s?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){i.style.maxHeight="".concat(t.height,"px");i.style.opacity=t.opacity/100},complete:function e(){if(o.Type.isStringFilled(n.id)){r.animationList[n.id]=null}if(!o.Type.isUndefined(t.callback)&&o.Type.isFunction(t.callback.complete)){i.style.maxHeight="";i.style.opacity="";t.callback.complete()}}}).animate(),this)}else{t.callback.complete()}return true}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(b,"instance",null);e.WorkgroupForm=b;e.WorkgroupFormTeamManager=S;e.WorkgroupFormUFManager=T})(this.BX.Socialnetwork=this.BX.Socialnetwork||{},BX.Main,BX.UI,BX.UI,BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=script.map.js