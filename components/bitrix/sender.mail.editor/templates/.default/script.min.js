(function(e){BX.namespace("BX.Sender.Mail");if(BX.Sender.Mail.Editor){return}var t={changeDisplay:function(e,t){if(!e){return}e.style.display=t?"":"none"}};function o(){}o.prototype.init=function(e){this.id=e.id;this.input=BX(e.inputId);this.placeHolders=e.placeHolders;this.mess=e.mess;this.context=BX(e.containerId);this.blockNode=this.context.querySelector("[data-bx-editor-block]");this.plainNode=this.context.querySelector("[data-bx-editor-plain]");this.inputNode=this.plainNode.querySelector("[data-bx-input]");BX.addCustomEvent("OnEditorInitedBefore",this.onEditorInitedBefore.bind(this));BX.addCustomEvent("OnEditorInitedAfter",this.onEditorInitedAfter.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var t=BX.Sender.Template.Selector;BX.addCustomEvent(t,t.events.templateSelect,this.onTemplateSelect.bind(this))}};o.prototype.onTemplateSelect=function(e){var t=e.messageFields.some(function(e){return e.code==="MESSAGE"&&e.onDemand});if(t){var o=BX.Sender.Template.Selector.getTemplateRequestingUri(e);this.setTemplateUri(o)}else{e.messageFields.forEach(function(e){if(e.code!=="MESSAGE"){return}this.setContent(e.value)},this)}};o.prototype.isTargetEditor=function(e){if(!e){return false}return e.id.indexOf("BX_BLOCK_EDITOR_CONTENT")===0};o.prototype.onEditorInitedAfter=function(e){if(!this.isTargetEditor(e)){return}e.components.SetComponentIcludeMethod("EventMessageThemeCompiler::includeComponent")};o.prototype.onEditorInitedBefore=function(t){if(!this.isTargetEditor(t)){return}BX.extend(PlaceHolderSelectorButton,e.BXHtmlEditor.Button);e.BXHtmlEditor.Controls["placeholder_selector"]=PlaceHolderSelectorButton;buildPrototypes();BX.addCustomEvent(t,"PlaceHolderSelectorButtonCreate",this.onPlaceHolderSelectorButtonCreate.bind(this));BX.addCustomEvent(t,"GetControlsMap",this.onGetControlsMap.bind(this))};o.prototype.onGetControlsMap=function(e){e.push({id:"placeholder_selector",compact:true,hidden:false,sort:1,checkWidth:false,offsetWidth:32})};o.prototype.onPlaceHolderSelectorButtonCreate=function(e){e.placeHolders=this.placeHolders};o.prototype.isSupportedTemplateUri=function(){return true};o.prototype.setTemplateUri=function(e){if(this.input.value&&!this.isShowedBlock()&&!this.confirmTemplateChange()){return}BX.BlockEditorManager.get(this.id).load(e);this.switchView(true)};o.prototype.isShowedBlock=function(){return this.blockNode.style.display!=="none"};o.prototype.confirmTemplateChange=function(){return confirm(this.mess.changeTemplate)};o.prototype.switchView=function(e){t.changeDisplay(this.blockNode,e);t.changeDisplay(this.plainNode,!e);BX.BlockEditorManager.get(this.id).resultNode=e?this.inputNode:null};o.prototype.setContent=function(e){if(this.isShowedBlock()&&!this.confirmTemplateChange()){return}this.inputNode.value=e;this.switchView(false)};PlaceHolderSelectorButton=function(e,t){PlaceHolderSelectorButton.superclass.constructor.apply(this,arguments);this.id="placeholder_selector";this.title="#";this.placeHolders=[];this.className="bxhtmled-top-bar-btn";this.activeClassName="bxhtmled-top-bar-btn-active";this.disabledClassName="bxhtmled-top-bar-btn-disabled";e.On("PlaceHolderSelectorButtonCreate",[this]);this.disabledForTextarea=false;this.arValues=[];for(var o in this.placeHolders){var i=this.placeHolders[o];this.arValues.push(this.buildPlaceHolders(i))}this.Create();this.pCont.innerHTML=this.title;this.menu=new BX.Main.Menu({id:this.id,bindElement:this.GetCont(),items:this.arValues,maxHeight:300});this.menuItem=new BX.Main.MenuItem;BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));if(t){t.appendChild(this.GetCont())}};buildPrototypes=function(){PlaceHolderSelectorButton.prototype.buildPlaceHolders=function(e,t){var o=this;var i={text:e.NAME,topName:t,title:e.DESC,className:"",style:"",action:"insertHTML"};if(typeof e.ITEMS!=="undefined"){i["items"]=[];i["className"]="bxhtmled-style-heading-more";for(var n in e.ITEMS){i["items"].push(this.buildPlaceHolders(e.ITEMS[n]))}}if(typeof i["items"]==="undefined"){i["dataset"]={value:"#"+e.CODE+"#"};i["onclick"]=function(e,t){if(typeof t.dataset.value!=="undefined"&&o.editor.action.IsSupported("insertHTML")){o.editor.action.Exec("insertHTML",t.dataset.value);o.menu.close()}}}else{i["id"]=e.CODE}return i};PlaceHolderSelectorButton.prototype.Check=BX.DoNothing;PlaceHolderSelectorButton.prototype.GetValue=BX.DoNothing;PlaceHolderSelectorButton.prototype.SetValue=BX.DoNothing;PlaceHolderSelectorButton.prototype.OnMouseUp=BX.DoNothing;PlaceHolderSelectorButton.prototype.OnMouseDown=BX.DoNothing;PlaceHolderSelectorButton.prototype.OnClick=function(){this.menu.show()}};setTimeout(function(){if(e.BXHtmlEditor){BX.extend(PlaceHolderSelectorButton,e.BXHtmlEditor.Button);e.BXHtmlEditor.Controls["placeholder_selector"]=PlaceHolderSelectorButton}},300);BX.Sender.Mail.Editor=new o;if(BX.Sender.Message.Editor.setAdaptedInstance){BX.Sender.Message.Editor.setAdaptedInstance(BX.Sender.Mail.Editor)}})(window);
//# sourceMappingURL=script.map.js