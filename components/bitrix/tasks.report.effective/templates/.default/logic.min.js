if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},keypress:function(t){},open:function(t,e){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:t,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(t){this._control.setData(BX.util.htmlspecialcharsback(t.nameFormatted),t.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(t){this._control=t;if(this._fieldId!==t.getId()){this._selector=null;this.close()}else{this._selector=t;this.open(t.field)}},onCustomEntitySelectorClose:function(t){if(this._fieldId!==t.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(t,e){var i=new BX.FilterEntitySelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}(function(){"use strict";BX.namespace("Tasks.Component");if(typeof BX.Tasks.Component.TasksReportEffective!="undefined"){return}BX.Tasks.Component.TasksReportEffective=BX.Tasks.Component.extend({sys:{code:"effective"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksReportEffective.instance},addInstance:function(t){BX.Tasks.Component.TasksReportEffective.instance=t}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksReportEffective.addInstance(this);if(this.option("show_sl_effective_more")){this.spotLightInit()}var t=this.option("efficiencyData");this.render({efficiency:t.EFFICIENCY,completed:t.COMPLETED,violations:t.VIOLATIONS,inProgress:t.IN_PROGRESS,graphData:t.GRAPH_DATA,minPeriod:t.GRAPH_MIN_PERIOD})},bindEvents:function(){BX.addCustomEvent("BX.Main.Filter:apply",this.onFilterApply.bind(this));BX.addCustomEvent("SidePanel.Slider:onClose",this.onSliderClose.bind(this));BX.SidePanel.Instance.bindAnchors({rules:[{condition:["/company/personal/user/"+this.option("userId")+"/tasks/effective/show/","/company/personal/user/"+this.option("userId")+"/tasks/effective/inprogress/"],options:{cacheable:false},stopParameters:["PAGEN_(\\d+)","grid_action=pagination","nav-effective","MID"]}]})},onFilterApply:function(t,e,i,o,s){if(this.option("taskLimitExceeded")||this.option("kpiLimitExceeded")){BX.UI.InfoHelper.show("limit_tasks_efficiency",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"filter"}});return}s.autoResolve=false;var n=BX.Tasks.Component.TasksReportEffective.getInstance();var r=i.getFilterFieldsValues();r.userId=n.option("userId");BX.ajax.runComponentAction("bitrix:tasks.report.effective","getEfficiencyData",{mode:"class",data:{userId:n.option("userId")}}).then(function(t){if(!t.status||t.status!=="success"){return}var e=t.data;n.render({efficiency:e.EFFICIENCY,completed:e.COMPLETED,violations:e.VIOLATIONS,inProgress:e.IN_PROGRESS,graphData:e.GRAPH_DATA,minPeriod:e.GRAPH_MIN_PERIOD})}.bind(this),function(t){}.bind(this))},onSliderClose:function(t){if(t.getSlider().getUrl()==="ui:info_helper"){window.location.href=this.option("pathToTasks")}},render:function(t){try{this.graphCircleInit(t.efficiency);BX(this.control("completed")).innerHTML=t.completed;BX(this.control("violations")).innerHTML=t.violations;BX(this.control("in-progress")).innerHTML=t.inProgress;this.amchartInit(t.graphData,t.minPeriod)}catch(t){document.location.href=document.location.href}},graphCircleInit:function(t){var e=this.option("circle");if(!e){e=new BX.UI.Graph.Circle(this.control("circle"),187,t,null);e.show();this.option("circle",e)}else{e.updateCounter(t)}},amchartInit:function(t,e){var i=this.option("messages");var o=this.option("amChart");if(!o){var s=[];var n=[];for(var r=1;r<=12;r++){s.push(BX.message["MONTH_"+r.toString()]);n.push(BX.message["MON_"+r.toString()])}AmCharts.monthNames=s;AmCharts.shortMonthNames=n;o=AmCharts.makeChart(BX(this.control("amchart")),{type:"serial",marginLeft:20,language:"ru",dataProvider:t,graphs:[{id:"g1",title:i.graph_title_kpi,valueField:"EFFECTIVE",balloonText:"[[title]]: [[value]]%",lineColor:"#4fc3f7",bullet:"round",bulletBorderAlpha:1,bulletSize:5}],dataDateFormat:"YYYY-MM-DD HH:mm",categoryField:"DATE",categoryAxis:{axisAlpha:.5,axisColor:"#808992",parseDates:true,minPeriod:e,dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"DD MMM"},{period:"WW",format:"DD MMM"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]},color:"#808992",chartCursor:{enabled:true,oneBalloonOnly:true,categoryBalloonEnabled:true,categoryBalloonColor:"#000000",categoryBalloonDateFormat:"DD MMM"},numberFormatter:{decimalSeparator:".",thousandsSeparator:" "},valueAxes:[{id:"v1",axisAlpha:.3,gridAlpha:0,axisColor:"#808992",maximum:100,minimum:0}]});if(!t.length){o.addLabel("50%","50%",i.no_data_text,"middle",15)}this.option("amchart",o)}else{o.dataProvider=t;o.validateData()}},spotLightInit:function(){var t=this;var e=BX("tasks-effective-more");var i=new BX.SpotLight({id:"tasks_sl_effective_more",targetElement:e,content:t.option("text_sl_effective_more"),targetVertex:"middle-center",autoSave:true});i.show()}}})})();
//# sourceMappingURL=logic.map.js