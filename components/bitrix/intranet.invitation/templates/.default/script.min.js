this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,n,i,s,o,r,a){"use strict";var l;var c=function(t){babelHelpers.inherits(i,t);function i(t){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));e.parent=t;e.setEventNamespace("BX.Intranet.Invitation.Submit");e.parent.subscribe("onButtonClick",(function(t){}));return e}babelHelpers.createClass(i,[{key:"parseEmailAndPhone",value:function t(e){var n=this;if(!r.Type.isDomNode(e)){return}var i=[];var s=[];var o=/^[\d+][\d\(\)\ -]{4,22}\d$/;var a=Array.prototype.slice.call(e.querySelectorAll(".js-form-row"));(a||[]).forEach((function(t){var e=t.querySelector("input[name='EMAIL[]']");var a=t.querySelector("input[name='PHONE[]']");var l=t.querySelector("input[name='NAME[]']");var c=t.querySelector("input[name='LAST_NAME[]']");var u=e.value.trim();if(n.parent.isInvitationBySmsAvailable&&r.Type.isDomNode(a)){var d=a.value.trim();if(d){if(!o.test(String(d).toLowerCase())){i.push(d)}else{var h=t.querySelector("input[name='PHONE_COUNTRY[]']");s.push({PHONE:d,PHONE_COUNTRY:h.value.trim(),NAME:l.value,LAST_NAME:c.value})}}}else if(u){if(r.Validation.isEmail(u)){s.push({EMAIL:u,NAME:l.value,LAST_NAME:c.value})}else{i.push(u)}}}));return[s,i]}},{key:"getGroupAndDepartmentData",value:function t(e){var n=this.parent.selector;var i=n.getItems();if(i["departments"].length>0){e["UF_DEPARTMENT"]=i["departments"]}if(i["projects"].length>0){e["SONET_GROUPS_CODE"]=i["projects"]}}},{key:"submitInvite",value:function t(){var e=this.parent.contentBlocks["invite"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],s=n[1];if(s.length>0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", ")}});this.emit("onInputError",o);return}if(i.length<=0){var a=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",a);return}var l={ITEMS:i};var c={INVITATION_TYPE:"invite",INVITATION_COUNT:i.length};this.sendAction("invite",l,c)}},{key:"submitInviteWithGroupDp",value:function t(){var e=this.parent.contentBlocks["invite-with-group-dp"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],s=n[1];if(s.length>0){this.parent.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", "));return}if(i.length<=0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",o);return}var a={ITEMS:i};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"withGroupOrDepartment",INVITATION_COUNT:i.length};this.sendAction("inviteWithGroupDp",a,l)}},{key:"submitSelf",value:function t(){var e=this.parent.contentBlocks["self"].querySelector("form");var n={allow_register:e["allow_register"].value,allow_register_confirm:e["allow_register_confirm"].checked?"Y":"N",allow_register_secret:e["allow_register_secret"].value,allow_register_whitelist:e["allow_register_whitelist"].value};this.sendAction("self",n)}},{key:"submitExtranet",value:function t(){var e=this.parent.contentBlocks["extranet"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],s=n[1];if(s.length>0){this.parent.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", "));return}if(i.length<=0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",o);return}var a={ITEMS:i};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"extranet",INVITATION_COUNT:i.length};this.sendAction("extranet",a,l)}},{key:"submitIntegrator",value:function t(){this.getIntegratorConfirmPopup().show()}},{key:"getIntegratorConfirmPopup",value:function t(){var i=this;var s=this.parent.contentBlocks.integrator.querySelector("form");var o={integrator_email:s.integrator_email.value};var a={INVITATION_TYPE:"integrator"};var c=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-integrator-confirm-message">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_DESCRIPTION"));var u=c.querySelector("span");r.Event.bind(u,"click",(function(){top.BX.Helper.show("redirect=detail&code=20682986")}));var d=new e.Popup({id:"integrator-confirm-invitation-popup",maxWidth:500,closeIcon:false,overlay:true,contentPadding:10,titleBar:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_TITLE"),content:c,offsetLeft:100,buttons:[new n.CreateButton({text:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_BUTTON_YES"),onclick:function t(){d.close();i.sendAction("inviteIntegrator",o,a)}}),new n.CancelButton({text:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_BUTTON_NO"),onclick:function t(){d.close()}})],events:{onClose:function t(){d.destroy()}}});return d}},{key:"submitMassInvite",value:function t(){var e=this.parent.contentBlocks["mass-invite"].querySelector("form");var n={ITEMS:e["mass_invite_emails"].value};var i={INVITATION_TYPE:"mass"};this.sendAction("massInvite",n,i)}},{key:"submitAdd",value:function t(){var e=this.parent.contentBlocks["add"].querySelector("form");var n={ADD_EMAIL:e["ADD_EMAIL"].value,ADD_NAME:e["ADD_NAME"].value,ADD_LAST_NAME:e["ADD_LAST_NAME"].value,ADD_POSITION:e["ADD_POSITION"].value,ADD_SEND_PASSWORD:e["ADD_SEND_PASSWORD"]&&!!e["ADD_SEND_PASSWORD"].checked?e["ADD_SEND_PASSWORD"].value:"N"};this.getGroupAndDepartmentData(n);var i={INVITATION_TYPE:"add"};this.sendAction("add",n,i)}},{key:"sendAction",value:function t(e,n,i){var s=this;this.disableSubmitButton(true);n["userOptions"]=this.parent.userOptions;n["analyticsData"]=this.parent.analyticsLabel;BX.ajax.runComponentAction(this.parent.componentName,e,{signedParameters:this.parent.signedParameters,mode:"ajax",data:n,analyticsLabel:i}).then((function(t){s.disableSubmitButton(false);if(t.data){if(e==="self"){s.parent.showSuccessMessage(t.data)}else{s.parent.changeContent("success");s.sendSuccessEvent(t.data)}}}),(function(t){s.disableSubmitButton(false);if(t.data=="user_limit"){B24.licenseInfoPopup.show("featureID",BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TITLE"),BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TEXT"))}else{s.parent.showErrorMessage(t.errors[0].message)}}))}},{key:"disableSubmitButton",value:function t(e){var n=this.parent.button;if(!r.Type.isDomNode(n)||!r.Type.isBoolean(e)){return}if(e){r.Dom.addClass(n,["ui-btn-wait","invite-cursor-auto"])}else{r.Dom.removeClass(n,["ui-btn-wait","invite-cursor-auto"])}}},{key:"sendSuccessEvent",value:function t(e){BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation:onAdd",{users:e})}}]);return i}(o.EventEmitter);var u=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;if(r.Type.isDomNode(this.parent.contentBlocks["self"])){this.selfBlock=this.parent.contentBlocks["self"];this.bindActions();var n=this.selfBlock.querySelector(".invite-dialog-fast-reg-control-switcher");this.switcher=new i.Switcher({inputName:"allow_register",id:"allow_register",checked:e.isSelfRegisterEnabled,node:n,handlers:{toggled:this.toggleSettings.bind(this)}})}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var n=this.selfBlock.querySelector("[data-role='selfRegenerateSecretButton']");if(r.Type.isDomNode(n)){r.Event.bind(n,"click",(function(){e.parent.activateButton();e.regenerateSecret(e.parent.regenerateUrlBase)}))}var i=this.selfBlock.querySelector("[data-role='copyRegisterUrlButton']");if(r.Type.isDomNode(i)){r.Event.bind(i,"click",(function(){e.copyRegisterUrl()}))}var s=this.selfBlock.querySelector("[data-role='allowRegisterConfirm']");if(r.Type.isDomNode(s)){r.Event.bind(s,"change",(function(){e.parent.activateButton();e.toggleWhiteList(s)}))}var o=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(r.Type.isDomNode(o)){r.Event.bind(o,"input",(function(){e.parent.activateButton()}))}}},{key:"regenerateSecret",value:function t(e){var n=r.Text.getRandom(8);var i=this.selfBlock.querySelector("[data-role='allowRegisterSecret']");if(r.Type.isDomNode(i)){i.value=n||""}var s=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(r.Type.isDomNode(s)&&e){s.value=e+(n||"yes")}}},{key:"copyRegisterUrl",value:function t(){var e=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(r.Type.isDomNode(e)){BX.clipboard.copy(e.value);this.showHintPopup(r.Loc.getMessage("BX24_INVITE_DIALOG_COPY_URL"),e);BX.ajax.runAction("intranet.controller.invite.copyregisterurl",{data:{}}).then((function(t){}),(function(t){}));this.parent.analytics.send()}}},{key:"showHintPopup",value:function t(e,n){if(!r.Type.isDomNode(n)||!e){return}new BX.PopupWindow("inviteHint"+r.Text.getRandom(8),n,{content:e,zIndex:15e3,angle:true,offsetTop:0,offsetLeft:50,closeIcon:false,autoHide:true,darkMode:true,overlay:false,maxWidth:400,events:{onAfterPopupShow:function t(){setTimeout(function(){this.close()}.bind(this),4e3)}}}).show()}},{key:"toggleSettings",value:function t(){this.parent.activateButton();var e=this.selfBlock.querySelector(".js-invite-dialog-fast-reg-control-container");if(r.Type.isDomNode(e)){if(!r.Dom.hasClass(e,"disallow-registration")){var n=e.querySelector("[data-role='self-switcher']");this.showHintPopup(r.Loc.getMessage("INTRANET_INVITE_DIALOG_SELF_OFF_HINT"),n)}r.Dom.toggleClass(e,"disallow-registration")}var i=this.selfBlock.querySelector("[data-role='selfSettingsBlock']");if(r.Type.isDomNode(i)){r.Dom.style(i,"display",this.switcher.checked?"block":"none")}}},{key:"toggleWhiteList",value:function t(e){var n=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(r.Type.isDomNode(n)){r.Dom.style(n,"display",e.checked?"block":"none")}}}]);return t}();var d;var h=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;this.count=0;this.index=0;this.maxCount=5;this.inputStack=[]}babelHelpers.createClass(t,[{key:"renderPhoneRow",value:function t(e){var n=this;if(this.count>=this.maxCount){return}if(!r.Type.isDomNode(e)){return}var i=e.getAttribute("data-num");if(e.parentNode.querySelector("#phone_number_"+i)){return}var s=r.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span style="z-index: 3;" class="ui-ctl-before" data-role="phone-block">\n\t\t\t\t<input type="hidden" name="PHONE_COUNTRY[]" id="phone_country_','" value="">\n\t\t\t\t<input type="hidden" name="PHONE[]" id="phone_number_','" value="">\n\t\t\t\t<div class="invite-dialog-phone-flag-block" data-role="flag">\n\t\t\t\t\t<span data-role="phone_flag_','" style="pointer-events: none;"></span>\n\t\t\t\t</div>\n\t\t\t\t<input class="invite-dialog-phone-input" type="hidden" id="phone_input_','" value="">&nbsp;\n\t\t\t</span>\n\t\t'])),i,i,i,i);e.style.paddingLeft="57px";r.Dom.append(s,e.parentNode);var o=e.parentNode.querySelector("[data-role='flag']");if(r.Type.isDomNode(o)){r.Event.bind(e.parentNode.querySelector("[data-role='flag']"),"click",(function(){n.showCountrySelector(i)}))}var a=function t(e,n){return function(t){n.parentNode.querySelector("#phone_number_"+e).value=t.value;n.parentNode.querySelector("#phone_country_"+e).value=t.country}};this.inputStack[i]=new BX.PhoneNumber.Input({node:e,flagNode:e.parentNode.querySelector("[data-role='phone_flag_"+i+"']"),flagSize:16,onChange:a(i,e)});var l=setInterval((function(){var t,s;if(!((t=e.parentNode)!==null&&t!==void 0&&t.querySelector("#phone_number_"+i).value)||!((s=e.parentNode)!==null&&s!==void 0&&s.querySelector("#phone_country_"+i).value)){a(i,e)({value:n.inputStack[i].getValue(),country:n.inputStack[i].formatter?n.inputStack[i].getCountry():null})}else{clearInterval(l)}}),1e3)}},{key:"showCountrySelector",value:function t(e){this.inputStack[e]._onFlagClick()}}]);return t}();var p,v,I,f;var b=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=n.contentBlock;this.inputNum=0;if(r.Type.isDomNode(this.contentBlock)){this.rowsContainer=this.contentBlock.querySelector("[data-role='rows-container']");this.bindActions()}if(this.parent.isInvitationBySmsAvailable){this.phoneObj=new h(this)}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var n=this.contentBlock.querySelector("[data-role='invite-more']");if(r.Type.isDomNode(n)){r.Event.unbindAll(n);r.Event.bind(n,"click",(function(){e.renderInputRow()}))}var i=this.contentBlock.querySelector("[data-role='invite-mass']");if(r.Type.isDomNode(i)){r.Event.unbindAll(i);r.Event.bind(i,"click",(function(){var t=document.querySelector("[data-role='menu-mass-invite']");if(r.Type.isDomNode(t)){BX.fireEvent(t,"click")}}))}}},{key:"checkPhoneInput",value:function t(e){var n=/^[\d+][\d\(\)\ -]{2,14}\d$/;if(e.value&&n.test(String(e.value).toLowerCase())){this.phoneObj.renderPhoneRow(e)}}},{key:"bindPhoneChecker",value:function t(e){var n=this;if(this.parent.isInvitationBySmsAvailable&&r.Type.isDomNode(e)){var i=Array.prototype.slice.call(e.querySelectorAll(".js-email-phone-input"));if(i){i.forEach((function(t){r.Event.bind(t,"input",(function(){n.checkPhoneInput(t)}))}))}}}},{key:"bindCloseIcons",value:function t(e){var n=this;var i=Array.prototype.slice.call(e.querySelectorAll("input"));(i||[]).forEach((function(t){var e=t.nextElementSibling;r.Event.bind(t,"input",(function(){r.Dom.style(e,"display",t.value!==""?"block":"none")}));r.Event.bind(e,"click",(function(i){i.preventDefault();if(r.Type.isDomNode(t.parentNode)){var s=t.parentNode.querySelector("[data-role='phone-block']");if(r.Type.isDomNode(s)){var o=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tname="EMAIL[]"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\tdata-num="','"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input"\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t/>'])),t.getAttribute("data-num"),r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"));r.Dom.replace(t,o);n.bindCloseIcons(o.parentNode);n.bindPhoneChecker(o.parentNode);r.Dom.remove(s)}}r.Dom.style(e,"display","none")}))}))}},{key:"renderInviteInputs",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;r.Dom.clean(this.rowsContainer);for(var n=0;n<e;n++){this.renderInputRow(n===0)}}},{key:"renderInputRow",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n,i,s;if(e){n='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),"\n\t\t\t\t</div>");i='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),"\n\t\t\t\t</div>");s='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),"\n\t\t\t\t</div>")}var o=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row js-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tname="EMAIL[]" \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tdata-num="','" \n\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="LAST_NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e?n:"",this.inputNum++,r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),e?i:"",r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),e?s:"",r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"));r.Dom.append(o,this.rowsContainer);this.bindCloseIcons(o);this.bindPhoneChecker(o)}},{key:"renderRegisterInputs",value:function t(){r.Dom.clean(this.rowsContainer);var e=r.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_NAME" id="ADD_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_LAST_NAME" id="ADD_LAST_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_EMAIL" id="ADD_EMAIL" class="ui-ctl-element" maxlength="50">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_POSITION" id="ADD_POSITION" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_EMAIL_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_POSITION_TITLE"));r.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}},{key:"renderIntegratorInput",value:function t(){r.Dom.clean(this.rowsContainer);var e=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tvalue="" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tname="integrator_email" \n\t\t\t\t\t\t\tid="integrator_email" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),r.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"),r.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"));r.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}}]);return t}();var g=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=n.contentBlock;this.options=n.options;this.entities=[];this.prepareOptions()}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){for(var e in this.options){if(!this.options.hasOwnProperty(e)){continue}if(e==="department"&&!!this.options[e]){this.entities.push({id:"department",options:{selectMode:"departmentsOnly",allowOnlyUserDepartments:!(!!this.options["isAdmin"]&&this.options["isAdmin"]===true),allowSelectRootDepartment:true}})}if(e==="project"&&!!this.options[e]){var n={id:"project",options:{fillRecentTab:true}};if(this.options[e]==="extranet"){n["options"]["extranet"]=true}this.entities.push(n)}}}},{key:"render",value:function t(){var e=[];if(this.options.hasOwnProperty("projectId")&&this.options.projectId>0){e.push(["project",this.options.projectId])}this.tagSelector=new s.TagSelector({dialogOptions:{preselectedItems:e,entities:this.entities,context:"INTRANET_INVITATION"}});if(r.Type.isDomNode(this.contentBlock)){r.Dom.clean(this.contentBlock);this.tagSelector.renderTo(this.contentBlock)}}},{key:"getItems",value:function t(){var e=[];var n=[];var i=this.tagSelector.getDialog().getSelectedItems();i.forEach((function(t){var i=parseInt(t.getId());var s=t.getEntityId();if(s==="department"){e.push(i)}else if(s==="project"){n.push(i)}}));return{departments:e,projects:n}}}]);return t}();var m=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e}babelHelpers.createClass(t,[{key:"showForm",value:function t(){BX.UI.Feedback.Form.open({id:"intranet-active-directory",defaultForm:{id:309,sec:"fbc0n3"}})}}]);return t}();function _(t,e){T(t,e);e.add(t)}function y(t,e,n){T(t,e);e.set(t,n)}function T(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function A(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var E=new WeakMap;var N=new WeakMap;var D=new WeakSet;var k=new WeakSet;var S=new WeakSet;var B=function(){function t(e,n){babelHelpers.classCallCheck(this,t);_(this,S);_(this,k);_(this,D);y(this,E,{writable:true,value:void 0});y(this,N,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,E,e);babelHelpers.classPrivateFieldSet(this,N,n)}babelHelpers.createClass(t,[{key:"send",value:function e(){a.sendData({tool:t.TOOLS,category:t.CATEGORY_INVITATION,event:t.EVENT_COPY,c_section:A(this,S,L).call(this),p1:A(this,k,w).call(this),p2:A(this,D,O).call(this)})}}]);return t}();function O(){return document.querySelector("#allow_register_confirm").checked?B.ADMIN_ALLOW_MODE_Y:B.ADMIN_ALLOW_MODE_N}function w(){return babelHelpers.classPrivateFieldGet(this,N)?B.IS_ADMIN_Y:B.IS_ADMIN_N}function L(){return babelHelpers.classPrivateFieldGet(this,E).source}babelHelpers.defineProperty(B,"TOOLS","Invitation");babelHelpers.defineProperty(B,"CATEGORY_INVITATION","invitation");babelHelpers.defineProperty(B,"EVENT_COPY","copy_invitation_link");babelHelpers.defineProperty(B,"ADMIN_ALLOW_MODE_Y","askAdminToAllow_Y");babelHelpers.defineProperty(B,"ADMIN_ALLOW_MODE_N","askAdminToAllow_N");babelHelpers.defineProperty(B,"IS_ADMIN_Y","isAdmin_Y");babelHelpers.defineProperty(B,"IS_ADMIN_N","isAdmin_N");var M=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));var i=r.Type.isPlainObject(t)?t:{};n.signedParameters=i.signedParameters;n.componentName=i.componentName;n.menuContainer=i.menuContainerNode;n.contentContainer=i.contentContainerNode;n.contentBlocks={};n.userOptions=i.userOptions;n.isExtranetInstalled=i.isExtranetInstalled==="Y";n.isCloud=i.isCloud==="Y";n.isAdmin=i.isAdmin==="Y";n.isInvitationBySmsAvailable=i.isInvitationBySmsAvailable==="Y";n.isCreatorEmailConfirmed=i.isCreatorEmailConfirmed==="Y";n.regenerateUrlBase=i.regenerateUrlBase;n.firstInvitationBlock=i.firstInvitationBlock;n.isSelfRegisterEnabled=i.isSelfRegisterEnabled;n.analyticsLabel=i.analyticsLabel;if(r.Type.isDomNode(n.contentContainer)){var s=Array.prototype.slice.call(n.contentContainer.querySelectorAll(".js-intranet-invitation-block"));(s||[]).forEach((function(t){var e=t.getAttribute("data-role");e=e.replace("-block","");n.contentBlocks[e]=t}));n.errorMessageBlock=n.contentContainer.querySelector("[data-role='error-message']");n.successMessageBlock=n.contentContainer.querySelector("[data-role='success-message']");BX.UI.Hint.init(n.contentContainer)}n.button=document.querySelector("#intranet-invitation-btn");if(r.Type.isDomNode(n.menuContainer)){n.menuItems=Array.prototype.slice.call(n.menuContainer.querySelectorAll("a"));(n.menuItems||[]).forEach((function(t){r.Event.bind(t,"click",(function(){n.changeContent(t.getAttribute("data-action"))}));if(t.getAttribute("data-action")===n.firstInvitationBlock){BX.fireEvent(t,"click")}}))}n.submit=new c(babelHelpers.assertThisInitialized(n));n.submit.subscribe("onInputError",(function(t){n.showErrorMessage(t.data.error)}));n.analytics=new B(n.analyticsLabel,n.isAdmin);if(n.isCloud){n.selfRegister=new u(babelHelpers.assertThisInitialized(n))}n.arrowBox=document.querySelector(".invite-wrap-decal-arrow");if(r.Type.isDomNode(n.arrowBox)){n.arrowRect=n.arrowBox.getBoundingClientRect();n.arrowHeight=n.arrowRect.height;n.setSetupArrow()}return n}babelHelpers.createClass(e,[{key:"renderSelector",value:function t(e){this.selector=new g(this,e);this.selector.render()}},{key:"changeContent",value:function t(e){this.hideErrorMessage();this.hideSuccessMessage();if(e.length>0){if(e==="active-directory"){if(!this.activeDirectory){this.activeDirectory=new m(this)}this.activeDirectory.showForm();return}var n=this.userOptions.hasOwnProperty("groupId")?parseInt(this.userOptions.groupId,10):0;for(var i in this.contentBlocks){var s=this.contentBlocks[i];if(i===e){r.Dom.removeClass(s,"invite-block-hidden");r.Dom.addClass(s,"invite-block-shown");var o={contentBlock:this.contentBlocks[e]};var a=new b(this,o);if(e==="invite"){a.renderInviteInputs(5)}else if(e==="invite-with-group-dp"){a.renderInviteInputs(3);var l={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:n,isAdmin:this.isAdmin}};this.renderSelector(l)}else if(e==="extranet"){a.renderInviteInputs(3);var c={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:false,project:"extranet",projectId:n,isAdmin:this.isAdmin}};this.renderSelector(c)}else if(e==="add"){a.renderRegisterInputs();var u={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:n,isAdmin:this.isAdmin}};this.renderSelector(u)}else if(e==="integrator"){a.renderIntegratorInput()}}else{r.Dom.removeClass(s,"invite-block-shown");r.Dom.addClass(s,"invite-block-hidden")}}this.changeButton(e)}}},{key:"changeButton",value:function t(e){var n=this;r.Event.unbindAll(this.button,"click");if(!this.isCreatorEmailConfirmed){r.Event.bind(this.button,"click",(function(){n.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_CREATOR_EMAIL_ERROR"))}));return}this.activateButton();if(e==="invite"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){n.submit.submitInvite()}))}else if(e==="mass-invite"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){n.submit.submitMassInvite()}))}else if(e==="invite-with-group-dp"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){n.submit.submitInviteWithGroupDp()}))}else if(e==="add"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_ADD");r.Event.bind(this.button,"click",(function(){n.submit.submitAdd()}))}else if(e==="self"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_SAVE");this.disableButton();r.Event.bind(this.button,"click",(function(){if(n.isButtonActive()){n.submit.submitSelf()}}))}else if(e==="integrator"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){n.submit.submitIntegrator()}))}else if(e==="extranet"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){n.submit.submitExtranet()}))}else if(e==="success"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE_MORE");r.Event.bind(this.button,"click",(function(){BX.fireEvent(n.menuItems[0],"click")}))}}},{key:"disableButton",value:function t(){r.Dom.addClass(this.button,"ui-btn-disabled")}},{key:"activateButton",value:function t(){r.Dom.removeClass(this.button,"ui-btn-disabled")}},{key:"isButtonActive",value:function t(){return!r.Dom.hasClass(this.button,"ui-btn-disabled")}},{key:"showSuccessMessage",value:function t(e){this.hideErrorMessage();if(r.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="block";var n=this.successMessageBlock.querySelector(".ui-alert-message");if(r.Type.isDomNode(n)){n.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideSuccessMessage",value:function t(){if(r.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="none"}}},{key:"showErrorMessage",value:function t(e){this.hideSuccessMessage();if(r.Type.isDomNode(this.errorMessageBlock)&&e){this.errorMessageBlock.style.display="block";var n=this.errorMessageBlock.querySelector(".ui-alert-message");if(r.Type.isDomNode(n)){n.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideErrorMessage",value:function t(){if(r.Type.isDomNode(this.errorMessageBlock)){this.errorMessageBlock.style.display="none"}}},{key:"getSetupArrow",value:function t(){this.body=document.querySelector(".invite-body");this.panelConfirmBtn=document.getElementById("intranet-invitation-btn");this.sliderContent=document.querySelector(".ui-page-slider-workarea");this.sliderHeader=document.querySelector(".ui-side-panel-wrap-title-wrap");this.buttonPanel=document.querySelector(".ui-button-panel");this.inviteButton=document.querySelector(".invite-form-buttons");this.sliderHeaderHeight=this.sliderHeader.getBoundingClientRect().height;this.buttonPanelRect=this.buttonPanel.getBoundingClientRect();this.panelRect=this.panelConfirmBtn.getBoundingClientRect();this.btnWidth=Math.ceil(this.panelRect.width);this.arrowWidth=Math.ceil(this.arrowRect.width);this.sliderContentRect=this.sliderContent.getBoundingClientRect();this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65}},{key:"updateArrow",value:function t(){this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65;this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide")}},{key:"setSetupArrow",value:function t(){this.getSetupArrow();var e=40;this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px";this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide");window.addEventListener("resize",function(){if(window.innerWidth<=1100){this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px"}this.getSetupArrow();this.updateArrow()}.bind(this));this.inviteButton.addEventListener("click",function(){this.getSetupArrow();this.updateArrow()}.bind(this))}}]);return e}(o.EventEmitter);t.Form=M})(this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{},BX.Main,BX.UI,BX.UI,BX.UI.EntitySelector,BX.Event,BX,BX.UI.Analytics);
//# sourceMappingURL=script.map.js