this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,i,n,s,o,r,a){"use strict";var l;var c=function(t){babelHelpers.inherits(n,t);function n(t){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));e.waitingResponse=false;e.parent=t;e.setEventNamespace("BX.Intranet.Invitation.Submit");e.parent.subscribe("onButtonClick",(function(t){}));return e}babelHelpers.createClass(n,[{key:"parseEmailAndPhone",value:function t(e){var i=this;if(!r.Type.isDomNode(e)){return}var n=[];var s=[];var o=/^[\d+][\d\(\)\ -]{4,22}\d$/;var a=Array.prototype.slice.call(e.querySelectorAll(".js-form-row"));(a||[]).forEach((function(t){var e=t.querySelector("input[name='EMAIL[]']");var a=t.querySelector("input[name='PHONE[]']");var l=t.querySelector("input[name='NAME[]']");var c=t.querySelector("input[name='LAST_NAME[]']");var u=e.value.trim();if(i.parent.isInvitationBySmsAvailable&&r.Type.isDomNode(a)){var d=a.value.trim();if(d){if(!o.test(String(d).toLowerCase())){n.push(d)}else{var p=t.querySelector("input[name='PHONE_COUNTRY[]']");s.push({PHONE:d,PHONE_COUNTRY:p.value.trim(),NAME:l.value,LAST_NAME:c.value})}}}else if(u){if(r.Validation.isEmail(u)){s.push({EMAIL:u,NAME:l.value,LAST_NAME:c.value})}else{n.push(u)}}}));return[s,n]}},{key:"getGroupAndDepartmentData",value:function t(e){var i=this.parent.selector;var n=i.getItems();if(n["departments"].length>0){e["UF_DEPARTMENT"]=n["departments"]}if(n["projects"].length>0){e["SONET_GROUPS_CODE"]=n["projects"]}}},{key:"submitInvite",value:function t(){var e=this.parent.contentBlocks["invite"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),n=i[0],s=i[1];if(s.length>0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", ")}});this.emit("onInputError",o);return}if(n.length<=0){var a=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",a);return}var l={ITEMS:n};var c={INVITATION_TYPE:"invite",INVITATION_COUNT:n.length};this.sendAction("invite",l,c)}},{key:"submitInviteWithGroupDp",value:function t(){var e=this.parent.contentBlocks["invite-with-group-dp"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),n=i[0],s=i[1];if(s.length>0){this.parent.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", "));return}if(n.length<=0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",o);return}var a={ITEMS:n};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"withGroupOrDepartment",INVITATION_COUNT:n.length};this.sendAction("inviteWithGroupDp",a,l)}},{key:"submitSelf",value:function t(){var e=this.parent.contentBlocks["self"].querySelector("form");var i={allow_register:e["allow_register"].value,allow_register_confirm:e["allow_register_confirm"].checked?"Y":"N",allow_register_secret:e["allow_register_secret"].value,allow_register_whitelist:e["allow_register_whitelist"].value};this.sendAction("self",i)}},{key:"submitExtranet",value:function t(){var e=this.parent.contentBlocks["extranet"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),n=i[0],s=i[1];if(s.length>0){this.parent.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+s.join(", "));return}if(n.length<=0){var o=new r.Event.BaseEvent({data:{error:r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",o);return}var a={ITEMS:n};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"extranet",INVITATION_COUNT:n.length};this.sendAction("extranet",a,l)}},{key:"submitIntegrator",value:function t(){this.getIntegratorConfirmPopup().show()}},{key:"getIntegratorConfirmPopup",value:function t(){var n=this;var s=this.parent.contentBlocks.integrator.querySelector("form");var o={integrator_email:s.integrator_email.value};var a={INVITATION_TYPE:"integrator"};var c=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-integrator-confirm-message">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_DESCRIPTION"));var u=c.querySelector("span");r.Event.bind(u,"click",(function(){top.BX.Helper.show("redirect=detail&code=20682986")}));var d=new e.Popup({id:"integrator-confirm-invitation-popup",maxWidth:500,closeIcon:false,overlay:true,contentPadding:10,titleBar:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_TITLE"),content:c,offsetLeft:100,buttons:[new i.CreateButton({text:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_BUTTON_YES"),onclick:function t(){d.close();n.sendAction("inviteIntegrator",o,a)}}),new i.CancelButton({text:r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_INTEGRATOR_BUTTON_NO"),onclick:function t(){d.close()}})],events:{onClose:function t(){d.destroy()}}});return d}},{key:"submitMassInvite",value:function t(){var e=this.parent.contentBlocks["mass-invite"].querySelector("form");var i={ITEMS:e["mass_invite_emails"].value};var n={INVITATION_TYPE:"mass"};this.sendAction("massInvite",i,n)}},{key:"submitAdd",value:function t(){var e=this.parent.contentBlocks["add"].querySelector("form");var i={ADD_EMAIL:e["ADD_EMAIL"].value,ADD_NAME:e["ADD_NAME"].value,ADD_LAST_NAME:e["ADD_LAST_NAME"].value,ADD_POSITION:e["ADD_POSITION"].value,ADD_SEND_PASSWORD:e["ADD_SEND_PASSWORD"]&&!!e["ADD_SEND_PASSWORD"].checked?e["ADD_SEND_PASSWORD"].value:"N"};this.getGroupAndDepartmentData(i);var n={INVITATION_TYPE:"add"};this.sendAction("add",i,n)}},{key:"sendAction",value:function t(e,i,n){var s=this;this.disableSubmitButton(true);i["userOptions"]=this.parent.userOptions;i["analyticsData"]=this.parent.analyticsLabel;BX.ajax.runComponentAction(this.parent.componentName,e,{signedParameters:this.parent.signedParameters,mode:"ajax",data:i,analyticsLabel:n}).then((function(t){s.disableSubmitButton(false);if(t.data){if(e==="self"){s.parent.showSuccessMessage(t.data)}else{s.parent.changeContent("success");s.sendSuccessEvent(t.data)}}o.EventEmitter.subscribe(o.EventEmitter.GLOBAL_TARGET,"SidePanel.Slider:onClose",(function(){BX.SidePanel.Instance.postMessageTop(window,"BX.Bitrix24.EmailConfirmation:showPopup")}))}),(function(t){s.disableSubmitButton(false);if(t.data=="user_limit"){B24.licenseInfoPopup.show("featureID",BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TITLE"),BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TEXT"))}else{s.parent.showErrorMessage(t.errors[0].message)}}))}},{key:"disableSubmitButton",value:function t(e){var i=this.parent.button;if(!r.Type.isDomNode(i)||!r.Type.isBoolean(e)){return}if(e){this.waitingResponse=true;r.Dom.addClass(i,["ui-btn-wait","invite-cursor-auto"])}else{this.waitingResponse=false;r.Dom.removeClass(i,["ui-btn-wait","invite-cursor-auto"])}}},{key:"sendSuccessEvent",value:function t(e){BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation:onAdd",{users:e})}}]);return n}(o.EventEmitter);var u=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;if(r.Type.isDomNode(this.parent.contentBlocks["self"])){this.selfBlock=this.parent.contentBlocks["self"];this.bindActions();var i=this.selfBlock.querySelector(".invite-dialog-fast-reg-control-switcher");this.switcher=new n.Switcher({inputName:"allow_register",id:"allow_register",checked:e.isSelfRegisterEnabled,node:i,handlers:{toggled:this.toggleSettings.bind(this)}})}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var i=this.selfBlock.querySelector("[data-role='selfRegenerateSecretButton']");if(r.Type.isDomNode(i)){r.Event.bind(i,"click",(function(){e.parent.activateButton();e.regenerateSecret(e.parent.regenerateUrlBase)}))}var n=this.selfBlock.querySelector("[data-role='copyRegisterUrlButton']");if(r.Type.isDomNode(n)){r.Event.bind(n,"click",(function(){e.copyRegisterUrl()}))}var s=this.selfBlock.querySelector("[data-role='allowRegisterConfirm']");if(r.Type.isDomNode(s)){r.Event.bind(s,"change",(function(){e.parent.activateButton();e.toggleWhiteList(s)}))}var o=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(r.Type.isDomNode(o)){r.Event.bind(o,"input",(function(){e.parent.activateButton()}))}}},{key:"regenerateSecret",value:function t(e){var i=r.Text.getRandom(8);var n=this.selfBlock.querySelector("[data-role='allowRegisterSecret']");if(r.Type.isDomNode(n)){n.value=i||""}var s=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(r.Type.isDomNode(s)&&e){s.value=e+(i||"yes")}}},{key:"copyRegisterUrl",value:function t(){var e=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(r.Type.isDomNode(e)){BX.clipboard.copy(e.value);this.showHintPopup(r.Loc.getMessage("BX24_INVITE_DIALOG_COPY_URL"),e);BX.ajax.runAction("intranet.controller.invite.copyregisterurl",{data:{}}).then((function(t){}),(function(t){}));this.parent.analytics.send()}}},{key:"showHintPopup",value:function t(e,i){if(!r.Type.isDomNode(i)||!e){return}new BX.PopupWindow("inviteHint"+r.Text.getRandom(8),i,{content:e,zIndex:15e3,angle:true,offsetTop:0,offsetLeft:50,closeIcon:false,autoHide:true,darkMode:true,overlay:false,maxWidth:400,events:{onAfterPopupShow:function t(){setTimeout(function(){this.close()}.bind(this),4e3)}}}).show()}},{key:"toggleSettings",value:function t(){this.parent.activateButton();var e=this.selfBlock.querySelector(".js-invite-dialog-fast-reg-control-container");if(r.Type.isDomNode(e)){if(!r.Dom.hasClass(e,"disallow-registration")){var i=e.querySelector("[data-role='self-switcher']");this.showHintPopup(r.Loc.getMessage("INTRANET_INVITE_DIALOG_SELF_OFF_HINT"),i)}r.Dom.toggleClass(e,"disallow-registration")}var n=this.selfBlock.querySelector("[data-role='selfSettingsBlock']");if(r.Type.isDomNode(n)){r.Dom.style(n,"display",this.switcher.checked?"block":"none")}}},{key:"toggleWhiteList",value:function t(e){var i=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(r.Type.isDomNode(i)){r.Dom.style(i,"display",e.checked?"block":"none")}}}]);return t}();var d;var p=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;this.count=0;this.index=0;this.maxCount=5;this.inputStack=[]}babelHelpers.createClass(t,[{key:"renderPhoneRow",value:function t(e){var i=this;if(this.count>=this.maxCount){return}if(!r.Type.isDomNode(e)){return}var n=e.getAttribute("data-num");if(e.parentNode.querySelector("#phone_number_"+n)){return}var s=r.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span style="z-index: 3;" class="ui-ctl-before" data-role="phone-block">\n\t\t\t\t<input type="hidden" name="PHONE_COUNTRY[]" id="phone_country_','" value="">\n\t\t\t\t<input type="hidden" name="PHONE[]" id="phone_number_','" value="">\n\t\t\t\t<div class="invite-dialog-phone-flag-block" data-role="flag">\n\t\t\t\t\t<span data-role="phone_flag_','" style="pointer-events: none;"></span>\n\t\t\t\t</div>\n\t\t\t\t<input class="invite-dialog-phone-input" type="hidden" id="phone_input_','" value="">&nbsp;\n\t\t\t</span>\n\t\t'])),n,n,n,n);e.style.paddingLeft="57px";r.Dom.append(s,e.parentNode);var o=e.parentNode.querySelector("[data-role='flag']");if(r.Type.isDomNode(o)){r.Event.bind(e.parentNode.querySelector("[data-role='flag']"),"click",(function(){i.showCountrySelector(n)}))}var a=function t(e,i){return function(t){if(r.Type.isDomNode(i.parentNode)){i.parentNode.querySelector("#phone_number_"+e).value=t.value;i.parentNode.querySelector("#phone_country_"+e).value=t.country}}};this.inputStack[n]=new BX.PhoneNumber.Input({node:e,flagNode:e.parentNode.querySelector("[data-role='phone_flag_"+n+"']"),flagSize:16,onChange:a(n,e)});var l=setInterval((function(){var t,s;if(!((t=e.parentNode)!==null&&t!==void 0&&t.querySelector("#phone_number_"+n).value)||!((s=e.parentNode)!==null&&s!==void 0&&s.querySelector("#phone_country_"+n).value)){a(n,e)({value:i.inputStack[n].getValue(),country:i.inputStack[n].formatter?i.inputStack[n].getCountry():null})}else{clearInterval(l)}}),1e3)}},{key:"showCountrySelector",value:function t(e){this.inputStack[e]._onFlagClick()}}]);return t}();var h,v,I,f;var b=function(){function t(e,i){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=i.contentBlock;this.inputNum=0;if(r.Type.isDomNode(this.contentBlock)){this.rowsContainer=this.contentBlock.querySelector("[data-role='rows-container']");this.bindActions()}if(this.parent.isInvitationBySmsAvailable){this.phoneObj=new p(this)}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var i=this.contentBlock.querySelector("[data-role='invite-more']");if(r.Type.isDomNode(i)){r.Event.unbindAll(i);r.Event.bind(i,"click",(function(){e.renderInputRow()}))}var n=this.contentBlock.querySelector("[data-role='invite-mass']");if(r.Type.isDomNode(n)){r.Event.unbindAll(n);r.Event.bind(n,"click",(function(){var t=document.querySelector("[data-role='menu-mass-invite']");if(r.Type.isDomNode(t)){BX.fireEvent(t,"click")}}))}}},{key:"checkPhoneInput",value:function t(e){var i=/^[\d+][\d\(\)\ -]{2,14}\d$/;if(e.value&&i.test(String(e.value).toLowerCase())){this.phoneObj.renderPhoneRow(e)}else if(e.value.length===0){var n;(n=this.renderDefaultRow(e))===null||n===void 0?void 0:n.focus()}}},{key:"bindPhoneChecker",value:function t(e){var i=this;if(this.parent.isInvitationBySmsAvailable&&r.Type.isDomNode(e)){var n=Array.prototype.slice.call(e.querySelectorAll(".js-email-phone-input"));if(n){n.forEach((function(t){r.Event.bind(t,"input",(function(){i.checkPhoneInput(t)}))}))}}}},{key:"renderDefaultRow",value:function t(e){var i=e.parentNode.querySelector('[data-role="phone-block"]');if(r.Type.isDomNode(i)){r.Dom.remove(i)}var n=e.parentNode.querySelector("input.ui-ctl-element");if(r.Type.isDomNode(n)){var s=r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tname="','"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\tdata-num="','"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input"\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t/>'])),n.name,e.getAttribute("data-num"),n.placeholder);r.Dom.replace(n,s);this.bindCloseIcons(s.parentNode);this.bindPhoneChecker(s.parentNode);r.Dom.remove(n);return s}return n}},{key:"bindCloseIcons",value:function t(e){var i=this;var n=Array.prototype.slice.call(e.querySelectorAll("input"));(n||[]).forEach((function(t){var e=t.nextElementSibling;r.Event.bind(t,"input",(function(){r.Dom.style(e,"display",t.value!==""?"block":"none")}));r.Event.bind(e,"click",(function(n){n.preventDefault();if(r.Type.isDomNode(t.parentNode)){i.renderDefaultRow(t)}r.Dom.style(e,"display","none")}))}))}},{key:"renderInviteInputs",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;r.Dom.clean(this.rowsContainer);for(var i=0;i<e;i++){this.renderInputRow(i===0)}}},{key:"renderInputRow",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i,n,s;if(e){i='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),"\n\t\t\t\t</div>");n='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),"\n\t\t\t\t</div>");s='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),"\n\t\t\t\t</div>")}var o=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row js-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tname="EMAIL[]" \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tdata-num="','" \n\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="NAME[]" type="text" class="ui-ctl-element js-email-name-input" placeholder="','">\n\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="LAST_NAME[]" type="text" class="ui-ctl-element js-email-last-name-input" placeholder="','">\n\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e?i:"",this.inputNum++,r.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),e?n:"",r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),e?s:"",r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"));r.Dom.append(o,this.rowsContainer);this.bindCloseIcons(o);this.bindPhoneChecker(o)}},{key:"renderRegisterInputs",value:function t(){r.Dom.clean(this.rowsContainer);var e=r.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_NAME" id="ADD_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_LAST_NAME" id="ADD_LAST_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_EMAIL" id="ADD_EMAIL" class="ui-ctl-element" maxlength="50">\n\t\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_POSITION" id="ADD_POSITION" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_EMAIL_TITLE"),r.Loc.getMessage("BX24_INVITE_DIALOG_ADD_POSITION_TITLE"));r.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}},{key:"renderIntegratorInput",value:function t(){r.Dom.clean(this.rowsContainer);var e=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tvalue="" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tname="integrator_email" \n\t\t\t\t\t\t\tid="integrator_email" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button type="button" class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),r.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"),r.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"));r.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}}]);return t}();var m=function(){function t(e,i){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=i.contentBlock;this.options=i.options;this.entities=[];this.prepareOptions()}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){for(var e in this.options){if(!this.options.hasOwnProperty(e)){continue}if(e==="department"&&!!this.options[e]){this.entities.push({id:"department",options:{selectMode:"departmentsOnly",allowOnlyUserDepartments:!(!!this.options["isAdmin"]&&this.options["isAdmin"]===true),allowSelectRootDepartment:true}})}if(e==="project"&&!!this.options[e]){var i;var n={fillRecentTab:true,"!type":["collab"],createProjectLink:(i=this.options.showCreateButton)!==null&&i!==void 0?i:true};if(Object.prototype.hasOwnProperty.call(this.options,"projectLimitExceeded")&&Object.prototype.hasOwnProperty.call(this.options,"projectLimitFeatureId")){n.lockProjectLink=this.options.projectLimitExceeded;n.lockProjectLinkFeatureId=this.options.projectLimitFeatureId}var s={id:"project",options:n};if(this.options[e]==="extranet"){s["options"]["extranet"]=true}this.entities.push(s)}}}},{key:"render",value:function t(){var e=[];if(this.options.hasOwnProperty("projectId")&&this.options.projectId>0){e.push(["project",this.options.projectId])}if(this.options.hasOwnProperty("departmentsId")&&Array.isArray(this.options.departmentsId)){this.options.departmentsId.forEach((function(t){e.push(["department",t])}))}this.tagSelector=new s.TagSelector({dialogOptions:{preselectedItems:e,entities:this.entities,context:"INTRANET_INVITATION"}});if(r.Type.isDomNode(this.contentBlock)){r.Dom.clean(this.contentBlock);this.tagSelector.renderTo(this.contentBlock)}}},{key:"getItems",value:function t(){var e=[];var i=[];var n=this.tagSelector.getDialog().getSelectedItems();n.forEach((function(t){var n=parseInt(t.getId());var s=t.getEntityId();if(s==="department"){e.push(n)}else if(s==="project"){i.push(n)}}));return{departments:e,projects:i}}}]);return t}();var _=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e}babelHelpers.createClass(t,[{key:"showForm",value:function t(){BX.UI.Feedback.Form.open({id:"intranet-active-directory",defaultForm:{id:309,sec:"fbc0n3"}})}}]);return t}();function g(t,e){y(t,e);e.add(t)}function T(t,e,i){y(t,e);e.set(t,i)}function y(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function E(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var A=new WeakMap;var N=new WeakMap;var D=new WeakSet;var k=new WeakSet;var S=new WeakSet;var O=function(){function t(e,i){babelHelpers.classCallCheck(this,t);g(this,S);g(this,k);g(this,D);T(this,A,{writable:true,value:void 0});T(this,N,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,A,e);babelHelpers.classPrivateFieldSet(this,N,i)}babelHelpers.createClass(t,[{key:"send",value:function e(){a.sendData({tool:t.TOOLS,category:t.CATEGORY_INVITATION,event:t.EVENT_COPY,c_section:E(this,S,w).call(this),p1:E(this,k,B).call(this),p2:E(this,D,L).call(this)})}},{key:"sendTabData",value:function e(i,n){if(!i){return}a.sendData({tool:t.TOOLS,category:t.CATEGORY_INVITATION,event:t.EVENT_TAB_VIEW,c_section:i,c_sub_section:n})}},{key:"sendOpenSliderData",value:function e(i){a.sendData({tool:t.TOOLS,category:t.CATEGORY_INVITATION,event:t.EVENT_OPEN_SLIDER_INVITATION,c_section:i})}}]);return t}();function L(){return document.querySelector("#allow_register_confirm").checked?O.ADMIN_ALLOW_MODE_Y:O.ADMIN_ALLOW_MODE_N}function B(){return babelHelpers.classPrivateFieldGet(this,N)?O.IS_ADMIN_Y:O.IS_ADMIN_N}function w(){return babelHelpers.classPrivateFieldGet(this,A).source}babelHelpers.defineProperty(O,"TOOLS","Invitation");babelHelpers.defineProperty(O,"TOOLS_HEADER","headerPopup");babelHelpers.defineProperty(O,"EVENT_OPEN_SLIDER_INVITATION","drawer_open");babelHelpers.defineProperty(O,"CATEGORY_INVITATION","invitation");babelHelpers.defineProperty(O,"EVENT_COPY","copy_invitation_link");babelHelpers.defineProperty(O,"ADMIN_ALLOW_MODE_Y","askAdminToAllow_Y");babelHelpers.defineProperty(O,"ADMIN_ALLOW_MODE_N","askAdminToAllow_N");babelHelpers.defineProperty(O,"IS_ADMIN_Y","isAdmin_Y");babelHelpers.defineProperty(O,"IS_ADMIN_N","isAdmin_N");babelHelpers.defineProperty(O,"EVENT_TAB_VIEW","tab_view");babelHelpers.defineProperty(O,"TAB_EMAIL","tab_by_email");babelHelpers.defineProperty(O,"TAB_MASS","tab_mass");babelHelpers.defineProperty(O,"TAB_DEPARTMENT","tab_department");babelHelpers.defineProperty(O,"TAB_INTEGRATOR","tab_integrator");babelHelpers.defineProperty(O,"TAB_LINK","by_link");babelHelpers.defineProperty(O,"TAB_REGISTRATION","registration");babelHelpers.defineProperty(O,"TAB_EXTRANET","extranet");babelHelpers.defineProperty(O,"TAB_AD","AD");var R=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));var n=r.Type.isPlainObject(t)?t:{};i.signedParameters=n.signedParameters;i.componentName=n.componentName;i.menuContainer=n.menuContainerNode;i.contentContainer=n.contentContainerNode;i.contentBlocks={};i.userOptions=n.userOptions;i.isExtranetInstalled=n.isExtranetInstalled==="Y";i.isCloud=n.isCloud==="Y";i.isAdmin=n.isAdmin==="Y";i.isInvitationBySmsAvailable=n.isInvitationBySmsAvailable==="Y";i.isCreatorEmailConfirmed=n.isCreatorEmailConfirmed==="Y";i.regenerateUrlBase=n.regenerateUrlBase;i.firstInvitationBlock=n.firstInvitationBlock;i.isSelfRegisterEnabled=n.isSelfRegisterEnabled;i.analyticsLabel=n.analyticsLabel;i.projectLimitExceeded=r.Type.isBoolean(n.projectLimitExceeded)?n.projectLimitExceeded:true;i.projectLimitFeatureId=r.Type.isString(n.projectLimitFeatureId)?n.projectLimitFeatureId:"";i.isCollabEnabled=n.isCollabEnabled==="Y";if(r.Type.isDomNode(i.contentContainer)){var s=Array.prototype.slice.call(i.contentContainer.querySelectorAll(".js-intranet-invitation-block"));(s||[]).forEach((function(t){var e=t.getAttribute("data-role");e=e.replace("-block","");i.contentBlocks[e]=t}));i.errorMessageBlock=i.contentContainer.querySelector("[data-role='error-message']");i.successMessageBlock=i.contentContainer.querySelector("[data-role='success-message']");BX.UI.Hint.init(i.contentContainer)}i.button=document.querySelector("#intranet-invitation-btn");if(r.Type.isDomNode(i.menuContainer)){i.menuItems=Array.prototype.slice.call(i.menuContainer.querySelectorAll("a"));(i.menuItems||[]).forEach((function(t){r.Event.bind(t,"click",(function(){i.changeContent(t.getAttribute("data-action"))}));if(t.getAttribute("data-action")===i.firstInvitationBlock){BX.fireEvent(t,"click")}}))}i.submit=new c(babelHelpers.assertThisInitialized(i));i.submit.subscribe("onInputError",(function(t){i.showErrorMessage(t.data.error)}));i.analytics=new O(i.analyticsLabel,i.isAdmin);i.analytics.sendOpenSliderData(i.analyticsLabel.source);if(i.isCloud){i.selfRegister=new u(babelHelpers.assertThisInitialized(i))}i.arrowBox=document.querySelector(".invite-wrap-decal-arrow");if(r.Type.isDomNode(i.arrowBox)){i.arrowRect=i.arrowBox.getBoundingClientRect();i.arrowHeight=i.arrowRect.height;i.setSetupArrow()}return i}babelHelpers.createClass(e,[{key:"renderSelector",value:function t(e){this.selector=new m(this,e);this.selector.render()}},{key:"getSubSection",value:function t(){var e=/analyticsLabel\[source]=(\w*)&/gm;var i=e.exec(decodeURI(window.location));if((i===null||i===void 0?void 0:i.length)>1){return i[1]}return null}},{key:"changeContent",value:function t(e){this.hideErrorMessage();this.hideSuccessMessage();var i=this.getSubSection();var n="";if(e.length>0){if(e==="active-directory"){if(!this.activeDirectory){this.activeDirectory=new _(this)}this.activeDirectory.showForm();this.analytics.sendTabData(i,O.TAB_AD);return}var s=this.userOptions.hasOwnProperty("groupId")?parseInt(this.userOptions.groupId,10):0;var o=this.userOptions.hasOwnProperty("departmentsId")&&Array.isArray(this.userOptions.departmentsId)?this.userOptions.departmentsId.map((function(t){return parseInt(t,10)})):[];for(var a in this.contentBlocks){var l=this.contentBlocks[a];if(a===e){r.Dom.removeClass(l,"invite-block-hidden");r.Dom.addClass(l,"invite-block-shown");var c={contentBlock:this.contentBlocks[e]};var u=new b(this,c);if(e==="invite"){n=O.TAB_EMAIL;u.renderInviteInputs(5)}else if(e==="invite-with-group-dp"){n=O.TAB_DEPARTMENT;u.renderInviteInputs(3);var d={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:s,departmentsId:o,isAdmin:this.isAdmin,projectLimitExceeded:this.projectLimitExceeded,projectLimitFeatureId:this.projectLimitFeatureId}};this.renderSelector(d)}else if(e==="extranet"){n=O.TAB_EXTRANET;u.renderInviteInputs(3);var p={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:false,project:"extranet",projectId:s,isAdmin:this.isAdmin,projectLimitExceeded:this.projectLimitExceeded,projectLimitFeatureId:this.projectLimitFeatureId,showCreateButton:!this.isCollabEnabled}};this.renderSelector(p)}else if(e==="add"){n=O.TAB_REGISTRATION;u.renderRegisterInputs();var h={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:s,isAdmin:this.isAdmin,projectLimitExceeded:this.projectLimitExceeded,projectLimitFeatureId:this.projectLimitFeatureId}};this.renderSelector(h)}else if(e==="integrator"){n=O.TAB_INTEGRATOR;u.renderIntegratorInput()}else if(e==="self"){n=O.TAB_LINK}else if(e==="mass-invite"){n=O.TAB_MASS}}else{r.Dom.removeClass(l,"invite-block-shown");r.Dom.addClass(l,"invite-block-hidden")}}if(this.analytics&&i&&n){this.analytics.sendTabData(i,n)}this.changeButton(e)}}},{key:"changeButton",value:function t(e){var i=this;r.Event.unbindAll(this.button,"click");if(!this.isCreatorEmailConfirmed){r.Event.bind(this.button,"click",(function(){i.showErrorMessage(r.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_CREATOR_EMAIL_ERROR"))}));return}this.activateButton();if(e==="invite"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitInvite()}}))}else if(e==="mass-invite"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitMassInvite()}}))}else if(e==="invite-with-group-dp"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitInviteWithGroupDp()}}))}else if(e==="add"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_ADD");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitAdd()}}))}else if(e==="self"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_SAVE");this.disableButton();r.Event.bind(this.button,"click",(function(){if(i.isButtonActive()){i.submit.submitSelf()}}))}else if(e==="integrator"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitIntegrator()}}))}else if(e==="extranet"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");r.Event.bind(this.button,"click",(function(){if(!i.submit.waitingResponse){i.submit.submitExtranet()}}))}else if(e==="success"){this.button.innerText=r.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE_MORE");r.Event.bind(this.button,"click",(function(){BX.fireEvent(i.menuItems[0],"click")}))}}},{key:"disableButton",value:function t(){r.Dom.addClass(this.button,"ui-btn-disabled")}},{key:"activateButton",value:function t(){r.Dom.removeClass(this.button,"ui-btn-disabled")}},{key:"isButtonActive",value:function t(){return!r.Dom.hasClass(this.button,"ui-btn-disabled")}},{key:"showSuccessMessage",value:function t(e){this.hideErrorMessage();if(r.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="block";var i=this.successMessageBlock.querySelector(".ui-alert-message");if(r.Type.isDomNode(i)){i.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideSuccessMessage",value:function t(){if(r.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="none"}}},{key:"showErrorMessage",value:function t(e){this.hideSuccessMessage();if(r.Type.isDomNode(this.errorMessageBlock)&&e){this.errorMessageBlock.style.display="block";var i=this.errorMessageBlock.querySelector(".ui-alert-message");if(r.Type.isDomNode(i)){i.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideErrorMessage",value:function t(){if(r.Type.isDomNode(this.errorMessageBlock)){this.errorMessageBlock.style.display="none"}}},{key:"getSetupArrow",value:function t(){this.body=document.querySelector(".invite-body");this.panelConfirmBtn=document.getElementById("intranet-invitation-btn");this.sliderContent=document.querySelector(".ui-page-slider-workarea");this.sliderHeader=document.querySelector(".ui-side-panel-wrap-title-wrap");this.buttonPanel=document.querySelector(".ui-button-panel");this.inviteButton=document.querySelector(".invite-form-buttons");this.sliderHeaderHeight=this.sliderHeader.getBoundingClientRect().height;this.buttonPanelRect=this.buttonPanel.getBoundingClientRect();this.panelRect=this.panelConfirmBtn.getBoundingClientRect();this.btnWidth=Math.ceil(this.panelRect.width);this.arrowWidth=Math.ceil(this.arrowRect.width);this.sliderContentRect=this.sliderContent.getBoundingClientRect();this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65}},{key:"updateArrow",value:function t(){this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65;this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide")}},{key:"setSetupArrow",value:function t(){this.getSetupArrow();var e=40;this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px";this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide");window.addEventListener("resize",function(){if(window.innerWidth<=1100){this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px"}this.getSetupArrow();this.updateArrow()}.bind(this));this.inviteButton.addEventListener("click",function(){this.getSetupArrow();this.updateArrow()}.bind(this))}}]);return e}(o.EventEmitter);t.Form=R})(this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{},BX.Main,BX.UI,BX.UI,BX.UI.EntitySelector,BX.Event,BX,BX.UI.Analytics);
//# sourceMappingURL=script.map.js