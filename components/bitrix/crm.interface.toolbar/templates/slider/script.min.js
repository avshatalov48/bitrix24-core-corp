if(typeof BX.InterfaceToolBar==="undefined"){BX.InterfaceToolBar=function(){this._id="";this._settings=null;this._container=null;this._menuButton=null;this._menuPopup=null;this._isMenuOpened=false};BX.InterfaceToolBar.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);var n=this._container=BX(this.getSetting("containerId",""));if(n){var o=this.getSetting("menuButtonClassName");if(!BX.type.isNotEmptyString(o)){o=this.getSetting("moreButtonClassName","crm-setting-btn")}if(BX.type.isNotEmptyString(o)){this._menuButton=BX.findChild(n,{className:o},true,false);if(this._menuButton){BX.bind(this._menuButton,"click",BX.delegate(this.onMenuButtonClick,this))}}}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.getParam(t,e)},prepareMenuItem:function(t){var e=/return\s+false(\s*;)?\s*$/;var n=/;\s*$/;var o=typeof t["SEPARATOR"]!=="undefined"?t["SEPARATOR"]:false;if(o){return{delimiter:true}}var i=typeof t["LINK"]!=="undefined"?t["LINK"]:"";var s=typeof t["ONCLICK"]!=="undefined"?t["ONCLICK"]:"";if(i!==""){var r='window.top.location.href = "'+i+'";';s=s!==""?r+" "+s:r}if(s!==""){if(!e.test(s)){if(!n.test(s)){s+=";"}s+=" return false;"}}var a={text:typeof t["TEXT"]!=="undefined"?t["TEXT"]:"",className:"menu-popup-item-none"};if(s!==""){a["onclick"]=s}if(BX.type.isArray(t["MENU"])){var u=[];for(var p=0,l=t["MENU"].length;p<l;p++){u.push(this.prepareMenuItem(t["MENU"][p]))}a["items"]=u}return a},openMenu:function(t){if(this._isMenuOpened){this.closeMenu();return}var e=this.getSetting("items",null);if(!BX.type.isArray(e)){return}var n=[];for(var o=0;o<e.length;o++){n.push(this.prepareMenuItem(e[o]))}BX.onCustomEvent(window,"Crm.InterfaceToolbar.MenuBuild",[this,{items:n}]);this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._menuButton,n,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onMenuButtonClick:function(t){this.openMenu()},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}},onEditorConfigReset:function(){var t=BX.Crm.EntityEditor.getDefault();if(t){t.resetConfig()}}};BX.InterfaceToolBar.create=function(t,e){var n=new BX.InterfaceToolBar;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarCommunicationButton==="undefined"){BX.InterfaceToolBarCommunicationButton=function(){this._id="";this._settings=[];this._button=null;this._ownerInfo=null;this._isMenuOpened=false;this._menuPopup=null;this._menuId="";this._data=null;this._isEnabled=false};BX.InterfaceToolBarCommunicationButton.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._button=BX.prop.getElementNode(this._settings,"button");BX.bind(this._button,"click",BX.delegate(this.onButtonClick,this));this._ownerInfo=BX.prop.getObject(this._settings,"ownerInfo",{});this._data=BX.prop.getObject(this._settings,"data",{});this._isEnabled=this.hasData();BX.addCustomEvent(window,"onCrmEntityUpdate",BX.delegate(this.onCrmEntityUpdate,this))},getOwnerInfo:function(){return{ownerID:this._ownerInfo["ENTITY_ID"],ownerType:this._ownerInfo["ENTITY_TYPE_NAME"],ownerUrl:this._ownerInfo["SHOW_URL"],ownerTitle:this._ownerInfo["TITLE"]}},getOwnerTypeName:function(){return BX.prop.getString(this._ownerInfo,"ENTITY_TYPE_NAME","")},getOwnerId:function(){return BX.prop.getInteger(this._ownerInfo,"ENTITY_ID",0)},getMultifieldTypeName:function(){return""},hasData:function(){return BX.type.isPlainObject(this._data)&&Object.keys(this._data).length>0},isEnabled:function(){return this._isEnabled},enable:function(t){t=!!t;if(this._isEnabled===t){return}this._isEnabled=t;this.doEnable(this._isEnabled)},doEnable:function(t){},onButtonClick:function(t){},prepareMenuItem:function(t){},openMenu:function(){if(this._isMenuOpened){this.closeMenu();return}var t=[];for(var e in this._data){if(!this._data.hasOwnProperty(e)){continue}var n=this._data[e];for(var o=0;o<n.length;o++){t.push(this.prepareMenuItem(e,n[o]))}}this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._button,t,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}},onCrmEntityUpdate:function(t){var e=BX.prop.getObject(t,"entityInfo",{});if(this.getOwnerTypeName()!==BX.prop.getString(e,"typeName","")||this.getOwnerId()!==BX.prop.getInteger(e,"id",0)){return}var n=BX.prop.getObject(t,"entityData",{});this._data=BX.prop.getObject(BX.prop.getObject(n,"MULTIFIELD_DATA",{}),this.getMultifieldTypeName(),{});this.enable(this.hasData());this.processDataChange()},processDataChange:function(){}}}if(typeof BX.InterfaceToolBarPhoneButton==="undefined"){BX.InterfaceToolBarPhoneButton=function(){BX.InterfaceToolBarPhoneButton.superclass.constructor.apply(this);this._menuItems=null};BX.extend(BX.InterfaceToolBarPhoneButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarPhoneButton.prototype.getMessage=function(t){var e=BX.InterfaceToolBarPhoneButton.messages;return e.hasOwnProperty(t)?e[t]:t};BX.InterfaceToolBarPhoneButton.prototype.onButtonClick=function(t){if(!this.isEnabled()){return}var e=Object.keys(this._data);if(e.length===1){var n=e[0];var o=this._data[n];if(o.length===1){var i=n.split("_");if(i.length>=2){this.addCall(n,o[0]);return}}}this._menuItems=[];this.openMenu()};BX.InterfaceToolBarPhoneButton.prototype.prepareMenuItem=function(t,e){var n;var o;if(BX.type.isPlainObject(e)){n=BX.prop.getString(e,"COMPLEX_NAME","")+": "+BX.prop.getString(e,"VALUE_FORMATTED","");o=BX.prop.getString(e,"VALUE","")}else{n=e;o=e}var i=BX.InterfaceToolBarPhoneMenuItem.create({owner:this,entityKey:t,value:o,text:n});this._menuItems.push(i);return i.createMenuItem()};BX.InterfaceToolBarPhoneButton.prototype.addCall=function(t,e){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("telephonyNotSupported"));return}var n=t.split("_");if(n.length<2){return}var o=BX.type.stringToInt(n[0]);var i=BX.type.stringToInt(n[1]);var s=BX.prop.getInteger(this._ownerInfo,"ENTITY_TYPE_ID",0);var r=BX.prop.getInteger(this._ownerInfo,"ENTITY_ID",0);var a=BX.type.isPlainObject(e)?e["VALUE"]:e;var u={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(o),ENTITY_ID:i,AUTO_FOLD:true};if(s!==o||r!==i){u["BINDINGS"]=[{OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(s),OWNER_ID:r}]}window.top["BXIM"].phoneTo(a,u)};BX.InterfaceToolBarPhoneButton.prototype.getMultifieldTypeName=function(){return"PHONE"};BX.InterfaceToolBarPhoneButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-call-icon-not-available");BX.addClass(this._button,"crm-contact-menu-call-icon")}else{BX.removeClass(this._button,"crm-contact-menu-call-icon");BX.addClass(this._button,"crm-contact-menu-call-icon-not-available")}};if(typeof BX.InterfaceToolBarPhoneButton.messages==="undefined"){BX.InterfaceToolBarPhoneButton.messages={}}BX.InterfaceToolBarPhoneButton.create=function(t,e){var n=new BX.InterfaceToolBarPhoneButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarPhoneMenuItem==="undefined"){BX.InterfaceToolBarPhoneMenuItem=function(){this._settings={};this._entityKey="";this._value="";this._text=""};BX.InterfaceToolBarPhoneMenuItem.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner");this._entityKey=BX.prop.getString(this._settings,"entityKey","");this._value=BX.prop.getString(this._settings,"value","");this._text=BX.prop.getString(this._settings,"text","")},onSelect:function(){this._owner.addCall(this._entityKey,this._value)},createMenuItem:function(){return{text:this._text,onclick:BX.delegate(this.onSelect,this)}}};BX.InterfaceToolBarPhoneMenuItem.create=function(t){var e=new BX.InterfaceToolBarPhoneMenuItem;e.initialize(t);return e}}if(typeof BX.InterfaceToolBarMessengerButton==="undefined"){BX.InterfaceToolBarMessengerButton=function(){BX.InterfaceToolBarMessengerButton.superclass.constructor.apply(this);this._menuItems=null};BX.extend(BX.InterfaceToolBarMessengerButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarMessengerButton.prototype.getMessage=function(t){var e=BX.InterfaceToolBarMessengerButton.messages;return e.hasOwnProperty(t)?e[t]:t};BX.InterfaceToolBarMessengerButton.prototype.onButtonClick=function(t){var e=Object.keys(this._data);if(e.length===1){var n=e[0];var o=this._data[n];if(o.length===1){var i=n.split("_");if(i.length>=2){this.openChat(n,o[0]);return}}}this._menuItems=[];this.openMenu()};BX.InterfaceToolBarMessengerButton.prototype.prepareMenuItem=function(t,e){var n;var o;if(BX.type.isPlainObject(e)){o=BX.prop.getString(e,"VALUE","");var i=BX.prop.getString(e,"VALUE_TYPE","");if(i==="OPENLINE"){n=BX.prop.getString(e,"COMPLEX_NAME","")}else{n=BX.prop.getString(e,"COMPLEX_NAME","")+": "+BX.prop.getString(e,"VALUE_FORMATTED","")}}else{n=e;o=e}var s=BX.InterfaceToolBarMessengerMenuItem.create({owner:this,entityKey:t,value:o,text:n});this._menuItems.push(s);return s.createMenuItem()};BX.InterfaceToolBarMessengerButton.prototype.openChat=function(t,e){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("messagingNotSupported"));return}var n=BX.type.isPlainObject(e)?e["VALUE"]:e;window.top["BXIM"].openMessengerSlider(n,{RECENT:"N",MENU:"N"})};BX.InterfaceToolBarMessengerButton.prototype.getMultifieldTypeName=function(){return"IM"};BX.InterfaceToolBarMessengerButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-im-icon-not-available");BX.addClass(this._button,"crm-contact-menu-im-icon")}else{BX.removeClass(this._button,"crm-contact-menu-im-icon");BX.addClass(this._button,"crm-contact-menu-im-icon-not-available")}};if(typeof BX.InterfaceToolBarMessengerButton.messages==="undefined"){BX.InterfaceToolBarMessengerButton.messages={}}BX.InterfaceToolBarMessengerButton.create=function(t,e){var n=new BX.InterfaceToolBarMessengerButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarMessengerMenuItem==="undefined"){BX.InterfaceToolBarMessengerMenuItem=function(){this._settings={};this._entityKey="";this._value="";this._text=""};BX.InterfaceToolBarMessengerMenuItem.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner");this._entityKey=BX.prop.getString(this._settings,"entityKey","");this._value=BX.prop.getString(this._settings,"value","");this._text=BX.prop.getString(this._settings,"text","")},onSelect:function(){this._owner.openChat(this._entityKey,this._value)},createMenuItem:function(){return{text:this._text,onclick:BX.delegate(this.onSelect,this)}}};BX.InterfaceToolBarMessengerMenuItem.create=function(t){var e=new BX.InterfaceToolBarMessengerMenuItem;e.initialize(t);return e}}if(typeof BX.InterfaceToolBarEmailButton==="undefined"){BX.InterfaceToolBarEmailButton=function(){BX.InterfaceToolBarEmailButton.superclass.constructor.apply(this)};BX.extend(BX.InterfaceToolBarEmailButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarEmailButton.prototype.onButtonClick=function(t){if(this.isEnabled()){BX.CrmActivityEditor.addEmail(this.getOwnerInfo())}};BX.InterfaceToolBarEmailButton.prototype.getMultifieldTypeName=function(){return"EMAIL"};BX.InterfaceToolBarEmailButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-mail-icon-not-available");BX.addClass(this._button,"crm-contact-menu-mail-icon")}else{BX.removeClass(this._button,"crm-contact-menu-mail-icon");BX.addClass(this._button,"crm-contact-menu-mail-icon-not-available")}};BX.InterfaceToolBarEmailButton.create=function(t,e){var n=new BX.InterfaceToolBarEmailButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarRestAppButton==="undefined"){BX.InterfaceToolBarRestAppButton=function(){this._id="";this._settings=[];this._button=null;this._ownerInfo=null;this._isMenuOpened=false;this._menuPopup=null;this._menuId="";this._items=null};BX.InterfaceToolBarRestAppButton.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._button=BX.prop.getElementNode(this._settings,"button");BX.bind(this._button,"click",BX.delegate(this.onButtonClick,this));this._ownerInfo=BX.prop.getObject(this._settings,"ownerInfo",{});var n=BX.prop.getObject(this._settings,"data",{});this._items=[];var o=BX.prop.getString(n,"PLACEMENT","");var i=BX.prop.getArray(n,"APP_INFOS",[]);for(var s=0,r=i.length;s<r;s++){var a=BX.InterfaceToolBarRestAppMenuItem.create({owner:this,placementCode:o,info:i[s]});this._items.push(a)}},getOwnerInfo:function(){return this._ownerInfo},onButtonClick:function(t){this.openMenu()},openMenu:function(){if(this._isMenuOpened){this.closeMenu();return}var t=[];for(var e=0,n=this._items.length;e<n;e++){t.push(this._items[e].createMenuItem())}this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._button,t,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}}};BX.InterfaceToolBarRestAppButton.create=function(t,e){var n=new BX.InterfaceToolBarRestAppButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarRestAppMenuItem==="undefined"){BX.InterfaceToolBarRestAppMenuItem=function(){this._settings={};this._placementCode="";this._appInfo={}};BX.InterfaceToolBarRestAppMenuItem.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner");this._placementCode=BX.prop.getString(this._settings,"placementCode","");this._appInfo=BX.prop.getObject(this._settings,"info",{})},onSelect:function(){BX.rest.AppLayout.openApplication(BX.prop.getInteger(this._appInfo,"APP_ID"),{ID:BX.prop.getInteger(this._owner.getOwnerInfo(),"ENTITY_ID")},{PLACEMENT:this._placementCode,PLACEMENT_ID:BX.prop.getInteger(this._appInfo,"ID")})},createMenuItem:function(){return{text:BX.prop.getString(this._appInfo,"TITLE"),onclick:BX.delegate(this.onSelect,this)}}};BX.InterfaceToolBarRestAppMenuItem.create=function(t){var e=new BX.InterfaceToolBarRestAppMenuItem;e.initialize(t);return e}}
//# sourceMappingURL=script.map.js