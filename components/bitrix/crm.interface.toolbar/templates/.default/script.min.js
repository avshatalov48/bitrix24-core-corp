if(typeof BX.InterfaceToolBar==="undefined"){BX.InterfaceToolBar=function(){this._id="";this._settings=null;this._container=null;this._moreBtn=null};BX.InterfaceToolBar.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:BX.CrmParamBag.create(null);var i=this._container=BX(this.getSetting("containerId",""));if(i){var s=this.getSetting("moreButtonClassName","crm-setting-btn");if(BX.type.isNotEmptyString(s)){var r=this._moreBtn=BX.findChild(i,{className:s},true,false);if(r){BX.bind(r,"click",BX.delegate(this._onMoreButtonClick,this))}}}},getId:function(){return this._id},getSetting:function(e,t){return this._settings.getParam(e,t)},_onMenuClose:function(){var e={menu:this._menu};BX.onCustomEvent(window,"CrmInterfaceToolbarMenuClose",[this,e])},_onMoreButtonClick:function(e){var t=this.getSetting("items",null);if(!BX.type.isArray(t)){return}var i=/return\s+false(\s*;)?\s*$/;var s=/;\s*$/;var r=[];for(var n=0;n<t.length;n++){var o=t[n];var a=typeof o["SEPARATOR"]!=="undefined"?o["SEPARATOR"]:false;if(a){r.push({SEPARATOR:true});continue}var u=typeof o["LINK"]!=="undefined"?o["LINK"]:"";var l=typeof o["ONCLICK"]!=="undefined"?o["ONCLICK"]:"";if(u!==""){var d='window.location.href = "'+u+'";';l=l!==""?d+" "+l:d}if(l!==""){if(!i.test(l)){if(!s.test(l)){l+=";"}l+=" return false;"}}r.push({TEXT:typeof o["TEXT"]!=="undefined"?o["TEXT"]:"",TITLE:typeof o["TITLE"]!=="undefined"?o["TITLE"]:"",ONCLICK:l,ICONCLASS:typeof o["MENU_ICON"]!=="undefined"?o["MENU_ICON"]:""})}this._menuId=this._id.toLowerCase()+"_menu";this._menu=new PopupMenu(this._menuId,1010);var h={menu:this._menu,items:[]};BX.onCustomEvent(window,"CrmInterfaceToolbarMenuShow",[this,h]);if(h.items.length>0){r.push({SEPARATOR:true});for(var p=0;p<h.items.length;p++){r.push(h.items[p])}}this._menu.ShowMenu(this._moreBtn,r,false,false,BX.delegate(this._onMenuClose,this))}};BX.InterfaceToolBar.create=function(e,t){var i=new BX.InterfaceToolBar;i.initialize(e,t);return i}}BX.namespace("BX.Crm");BX.Crm.RequisiteToolbarEditorClass=function(){var e=function(e){this.containerId=e.containerId;this.gridId=e.gridId;this.container=BX(this.containerId);this.requisiteEntityTypeId=e.requisiteEntityTypeId;this.requisiteEntityId=e.requisiteEntityId;this.presetList=e.presetList;this.presetLastSelectedId=e.presetLastSelectedId;this.requisiteDataList=e.requisiteDataList;this.visible=!!e.visible;this.messages=e.messages||{};this.presetSelector=null;this.requisitePopupManager=null;this.requisiteAjaxUrl=e.requisiteAjaxUrl;this.requisitePopupAjaxUrl=e.requisitePopupAjaxUrl;this.requisiteFormEditorAjaxUrl=e.requisiteFormEditorAjaxUrl;this.initialize()};e.prototype={initialize:function(){if(this.container){if(this.visible)this.container.style.display="block";if(!this.presetSelector){this.presetSelector=new BX.Crm.RequisitePresetSelectorClass({editor:this,container:this.container,nextNode:null,containerId:this.containerId,requisiteEntityTypeId:this.requisiteEntityTypeId,requisiteEntityId:this.requisiteEntityId,presetList:this.presetList,presetLastSelectedId:this.presetLastSelectedId,requisiteEditHandler:BX.delegate(this.onRequisiteEdit,this)})}}},getMessage:function(e){return this.messages[e]},onRequisiteEdit:function(e,t,i,s,r,n,o,a){if(BX.type.isNumber(o)&&o>=0||BX.type.isNotEmptyString(o))o=parseInt(o);else o=-1;r=BX.type.isNotEmptyString(r)?r:"";n=BX.type.isNotEmptyString(n)?n:"";a=!!a;if(!this.requisitePopupManager){this.requisitePopupManager=new BX.Crm.RequisitePopupFormManagerClass({editor:this,blockArea:null,requisiteEntityTypeId:e,requisiteEntityId:t,requisiteId:s,requisiteData:r,requisiteDataSign:n,presetId:i,requisiteAjaxUrl:this.requisiteAjaxUrl,requisitePopupAjaxUrl:this.requisitePopupAjaxUrl,popupDestroyCallback:BX.delegate(this.onRequisitePopupDestroy,this),afterRequisiteEditCallback:BX.delegate(this.onAfterRequisiteEdit,this),blockIndex:o,copyMode:a});this.requisitePopupManager.openPopup()}},onAfterRequisiteEdit:function(e,t,i){if(BX.type.isNotEmptyString(this.gridId)){var s=window["bxGrid_"+this.gridId];if(s)s.Reload()}},onRequisitePopupDestroy:function(){if(this.requisitePopupManager){this.requisitePopupManager.destroy();this.requisitePopupManager=null}}};return e}();
//# sourceMappingURL=script.map.js