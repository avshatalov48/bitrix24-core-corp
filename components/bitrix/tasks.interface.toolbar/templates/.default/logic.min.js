"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(e){BX.Tasks.Component.TasksToolbar.instance=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){this.rerender("")}else{this.render()}},bindEvents:function(){var e={user_counter:this.onUserCounter};BX.addCustomEvent("onPullEvent-tasks",function(t,n){if(e[t]){e[t].apply(this,[n])}}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",function(e){this.rerender(e)}.bind(this));BX.addCustomEvent("BX.Kanban.ChangeGroup",function(e,t){this.option("groupId",e);this.rerender("")}.bind(this))},onUserCounter:function(e){var t=Number(this.option("userId"));var n=Number(this.option("ownerId"));var o=Number(this.option("groupId"));if(!this.option("showCounters")||!e.hasOwnProperty(o)||t!==n||t!==Number(e.userId)){return}var r=this.option("filterId")||null;if(r){var i="view_all";var s=BX.Main.filterManager.getById(r);if(s){var a=s.getFilterFieldsValues();i=a.ROLEID||i}this.option("counters",this.prepareCounters(e[o][i]));this.render()}},prepareCounters:function(e){var t={total:"",expired:6291456,new_comments:12582912};var n={};Object.keys(e).forEach((function(o){n[o]={code:t[o],counter:e[o]}}));return n},rerender:function(e){},render:function(){return;var e=this.option("templates");var t=this.option("counters");var n=this.option("foreign_counters");var o=this.option("messages");var r=this.option("classes");var i=this.option("buttons");var s=this.option("project_mode");var a=[];if(typeof t.total==="object"&&"counter"in t.total&&t.total.counter>0){a.push(e.total.replace("#COUNTER#",t.total.counter).replace("#TEXT#",o.total));Object.keys(t).forEach(function(n){var s=t[n];if(s.counter>0&&n!=="total"){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",n).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[n+"_"+BX.Loc.getPluralForm(s.counter)]).replace("#CLASS#",r[n]).replace("#BUTTON#",i[n]||""))}}.bind(this))}if(typeof n.foreign_expired==="object"&&"counter"in n.foreign_expired&&n.foreign_expired.counter>0||typeof n.foreign_comments==="object"&&"counter"in n.foreign_comments&&n.foreign_comments.counter>0){a.push(e.foreign.replace("#TEXT#",o.foreign));Object.keys(n).forEach(function(t){var s=n[t];if(s.counter>0){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",t).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[t+"_"+BX.Loc.getPluralForm(s.counter)]).replace("#CLASS#",r[t]).replace("#BUTTON#",i[t]||""))}}.bind(this))}if(!a.length){a.push(e.empty.replace("#TEXT#",o.empty))}this.scope().innerHTML=a.join("");var c=this.option("filterId")||null;var u=this.option("roleId")||"view_all";if(c){var l=BX.Main.filterManager.getById(c);if(l){var p=l.getFilterFieldsValues();u=p.ROLEID||u}}var d=this.scope().getElementsByClassName("tasks-counter-container");Object.values(d).forEach(function(e){BX.bind(e,"click",(function(e){BX.PreventDefault(e);BX.onCustomEvent("Tasks.Toolbar:onItem",[this.dataset.counterCode,window.location.href])}));if(e.nextSibling&&BX.hasClass(e.nextSibling,"tasks-counter-counter-button")&&e.nextSibling.dataset.counterId==="new_comments"){if(s){BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readProject",{data:{groupId:this.option("groupId")||0}})}.bind(this))}else{BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readAll",{data:{groupId:this.option("groupId")||0,userId:this.option("ownerId"),role:u}})}.bind(this))}}}.bind(this))}}})}).call(this);
//# sourceMappingURL=logic.map.js