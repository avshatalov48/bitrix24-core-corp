(function(e,t,i,a,r,n){"use strict";function s(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var o=new WeakMap;var d=function(e){babelHelpers.inherits(i,e);function i(e){var t;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,a));s(babelHelpers.assertThisInitialized(t),o,{writable:true,value:false});t.initDocumentTypeSelector();return t}babelHelpers.createClass(i,[{key:"getEntityType",value:function e(){return"Product"}},{key:"onSectionLayout",value:function e(i){var s=this;var l=i.getCompatData(),d=babelHelpers.slicedToArray(l,2),c=d[0],u=d[1];if(u.id==="catalog_parameters"){u.visible=this.isSimpleProduct&&this.isCardSettingEnabled("CATALOG_PARAMETERS")}a.EventEmitter.subscribe("BX.UI.EntityEditorList:onItemSelect",(function(e){var i;var a=!(s.isWithOrdersMode&&!s.isInventoryManagementUsed);if(babelHelpers.classPrivateFieldGet(s,o)||!a){return}var l=(i=e.getData()[1])===null||i===void 0?void 0:i.field;if(!l){return}if(l.getId()!=="QUANTITY_TRACE"||l._selectedValue!=="N"){return}var d=new r.Popup({content:t.Loc.getMessage("CPD_QUANTITY_TRACE_NOTICE"),overlay:true,titleBar:t.Loc.getMessage("CPD_QUANTITY_TRACE_NOTICE_TITLE"),closeByEsc:true,closeIcon:true,buttons:[new n.Button({text:t.Loc.getMessage("CPD_QUANTITY_TRACE_ACCEPT"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:function(){babelHelpers.classPrivateFieldSet(this,o,false);d.destroy()}.bind(s)}})],events:{onAfterClose:function(){babelHelpers.classPrivateFieldSet(this,o,false)}.bind(s)}});d.show();babelHelpers.classPrivateFieldSet(s,o,true)}));c===null||c===void 0?void 0:c.getChildren().forEach((function(e){if(s.hiddenFields.includes(e===null||e===void 0?void 0:e.getId())){e.setVisible(false)}}));a.EventEmitter.subscribe("onEntityUpdate",(function(e){var t;var i=(t=e.getData()[0])===null||t===void 0?void 0:t.sender;if(!i){return}var a=i._model.getField("QUANTITY_TRACE","D");var r=!(s.isWithOrdersMode&&!s.isInventoryManagementUsed);if(a!=="N"&&r){var n;(n=i.getControlById("QUANTITY_TRACE"))===null||n===void 0?void 0:n.setVisible(false)}}))}},{key:"onGridUpdatedHandler",value:function e(t){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"onGridUpdatedHandler",this).call(this,t);var a=t.getCompatData(),r=babelHelpers.slicedToArray(a,1),n=r[0];if(n&&n.getId()===this.getVariationGridId()&&n.getRows().getCountDisplayed()<=0){document.location.reload()}}},{key:"onEditorAjaxSubmit",value:function e(a){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"onEditorAjaxSubmit",this).call(this,a);var r=a.getCompatData(),n=babelHelpers.slicedToArray(r,2),s=n[1];if(s.data){if(s.data.NOTIFY_ABOUT_NEW_VARIATION){this.showNotification(t.Loc.getMessage("CPD_NEW_VARIATION_ADDED"))}}}},{key:"initDocumentTypeSelector",value:function e(){var t=document.getElementById(this.settings.productTypeSelector);var i=this.settings.productTypeSelectorTypes;if(!t||!i){return}var a=[];Object.keys(i).forEach((function(e){a.push({text:i[e],onclick:function t(i){var a=BX.SidePanel.Instance.getTopSlider();if(a){a.url=BX.Uri.addParam(a.getUrl(),{productTypeId:e});a.requestMethod="post";a.setFrameSrc()}}})}));var n=r.MenuManager.create({id:"productcard-product-type-selector",bindElement:t,items:a,minWidth:t.offsetWidth});t.addEventListener("click",(function(e){e.preventDefault();n.show()}))}}]);return i}(i.EntityCard);t.Reflection.namespace("BX.Catalog").ProductCard=d})(this.window=this.window||{},BX,BX.Catalog.EntityCard,BX.Event,BX.Main,BX.UI);
//# sourceMappingURL=script.map.js