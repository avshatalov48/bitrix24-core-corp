function BXFaceIdStart(e){var t=BX.localStorage.get("faceid-default-camera");var a=document.getElementById("faceid-video");var i=document.getElementById("faceid-canvas");var r=document.getElementById("faceid-startbutton");var n=false;var s={cameraRatio:0,screenRatio:window.screen.width/window.screen.height,cameraSmallWidth:640,cameraSmallHeight:0,snapshotWidth:640,snapshotHeight:0,cameraWidth:0,cameraHeight:0};{o()}function o(){navigator.mediaDevices.enumerateDevices().then(function(e){var a=document.getElementById("faceid-cameralist");var i="faceid-tracker-sidebar-photo-settings-checked";e.forEach(function(e){if(e.kind=="videoinput"){if(t==null){t=e.deviceId;BX.localStorage.set("faceid-default-camera",t,3600*24*360)}var r="faceid-tracker-sidebar-photo-settings-inner-list-item";var n=e.label.replace(/\(\w{4}:\w{4}\)/g,"");if(!n.length){n=BX.message("FACEID_TRACKER1C_CMP_JS_CAMERA_DEFAULT")}if(e.deviceId==t){r+=" "+i}var s=BX.create("div",{text:n,attrs:{class:r,"data-camera-id":e.deviceId}});a.appendChild(s);BX.bind(s,"click",function(){if(BX.hasClass(BX(this),i)){return}var e,r=BX.findChildren(a);for(e in r){BX.removeClass(r[e],i)}BX.addClass(BX(this),i);t=this.getAttribute("data-camera-id");BX.localStorage.set("faceid-default-camera",t,3600*24*360);d();BX.toggle(BX("faceid-settings-container"))})}});c()}).catch(function(e){console.log(e.name+": "+e.message);g(e.message)})}function c(){d();a.addEventListener("canplay",function(e){if(!n){s.cameraRatio=a.videoWidth/a.videoHeight;s.cameraSmallHeight=a.videoHeight/(a.videoWidth/s.cameraSmallWidth);s.snapshotHeight=a.videoHeight/(a.videoWidth/s.snapshotWidth);s.cameraWidth=s.cameraSmallWidth;s.cameraHeight=s.cameraSmallHeight;a.setAttribute("width",s.cameraWidth);a.setAttribute("height",s.cameraHeight);BX("faceid-sent-snapshot-canvas").setAttribute("width",s.cameraWidth);BX("faceid-sent-snapshot-canvas").setAttribute("height",s.cameraHeight);i.setAttribute("width",s.snapshotWidth);i.setAttribute("height",s.snapshotHeight);n=true;BX.hide(BX("faceid-1c-loader"));BX.show(a.parentNode)}},false);r.addEventListener("click",function(e){l()},false)}function d(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getMedia({video:{deviceId:{exact:t}},audio:false},function(e){if(navigator.mozGetUserMedia){a.mozSrcObject=e}else{try{a.srcObject=e}catch(i){var t=window.URL||window.webkitURL;a.src=t.createObjectURL(e)}}a.play()},function(e){console.log("An error occured! "+e);BX.localStorage.remove("faceid-default-camera");var t;if(e.toString().indexOf("DevicesNotFound")>=0){t=BX.message("FACEID_TRACKER1C_CMP_JS_CAMERA_NOT_FOUND")}else{t=BX.message("FACEID_TRACKER1C_CMP_JS_CAMERA_NO_SUPPORT")}g(t)})}function g(e){BX("faceid-camera-error").innerHTML=e;BX.show(BX("faceid-camera-error"))}function l(e){if(!e){var t=i.getContext("2d");t.drawImage(a,0,0,s.snapshotWidth,s.snapshotHeight);e=i.toDataURL("image/jpeg",.85)}var r=new Image;r.onload=function(){f(r.getAttribute("src"))};r.src=e;BX("faceid-sent-snapshot").setAttribute("src",e)}function f(t){v();BX.ajax({url:e.AJAX_IDENTIFY_URL,method:"POST",data:{action:"identify",image:t,auth:e.OAUTH_TOKEN},dataType:"json",processData:false,start:true,onsuccess:function(e){var t=false;var a=BX.message("FACEID_TRACKER1C_CMP_JS_AJAX_ERROR");var i;var r=2e3;if(e.length){i=e;var n=JSON.parse(e);if(n.error&&n.error.msg){i='{"contragents":{}, "error": "'+n.error.msg+'"}';u(n.error.msg);r=5e3}else{var s=BX("faceid-sent-snapshot-canvas").getContext("2d");var o=[145,255,79,255];for(var c in n.contragents){var d={x:n.contragents[c].FACE_X,y:n.contragents[c].FACE_Y,width:n.contragents[c].FACE_WIDTH,height:n.contragents[c].FACE_HEIGHT};m(s,d,10,o)}}}else{i='{"contragents":{}, "error": "'+a+'"}';u(a)}setTimeout(function(){h(i)},r)},onfailure:function(){var e=BX.message("FACEID_TRACKER1C_CMP_JS_AJAX_ERROR");response='{"contragents":{}, "error": "'+e+'"}';h(response)}})}function h(e){v();BX.ajax({url:"http://127.0.0.1:22017/stop_browser.bx",method:"POST",data:{response:e},dataType:"json",processData:false,start:true})}function m(e,t,a,i){e.save();e.strokeStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")";e.lineWidth=3;try{var r=t.x;var n=t.y;var s=t.x+t.width;var o=t.y+t.height;var c=a;var d=Math.PI/180;if(s-r-2*c<0){c=(s-r)/2}if(o-n-2*c<0){c=(o-n)/2}e.beginPath();e.moveTo(r+c,n);e.lineTo(s-c,n);e.arc(s-c,n+c,c,d*270,d*360,false);e.lineTo(s,o-c);e.arc(s-c,o-c,c,d*0,d*90,false);e.lineTo(r+c,o);e.arc(r+c,o-c,c,d*90,d*180,false);e.lineTo(r,n+c);e.arc(r+c,n+c,c,d*180,d*270,false);e.closePath();e.stroke();e.restore()}catch(e){console.log("BAD VALUE OF DETECTION");console.log(e)}}function v(){BX.toggle(BX("faceid-startbutton"));BX.toggle(BX("faceid-startbutton-progress"))}function u(e){BX.addClass(BX("faceid-1c-ajax-error"),"faceid-error-message-active");BX.findChild(BX("faceid-1c-ajax-error"),{class:"faceid-error-message-text"}).innerText=e}BX.bind(BX("faceid-settings-button"),"click",function(){BX.toggle(BX("faceid-settings-container"))})}
//# sourceMappingURL=script.map.js