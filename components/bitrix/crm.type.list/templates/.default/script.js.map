{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Reflection, Text, Type } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass TypeListComponent\n{\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\twelcomeMessageContainer: Element;\n\tisEmptyList: boolean;\n\n\tconstructor(params): void\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\t\t\tif (this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.welcomeMessageContainer))\n\t\t\t{\n\t\t\t\tthis.welcomeMessageContainer = params.welcomeMessageContainer;\n\t\t\t}\n\t\t\tthis.isEmptyList = Boolean(params.isEmptyList);\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onClickDelete', this.handleTypeDelete.bind(this));\n\n\t\tconst toolbarComponent = this.getToolbarComponent();\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\t/** @see BX.Crm.ToolbarComponent.subscribeTypeUpdatedEvent */\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent((event: BaseEvent) => {\n\t\t\t\tconst isUrlChanged = Type.isObject(event.getData()) && (event.getData().isUrlChanged === true);\n\t\t\t\tif (isUrlChanged)\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.gridId && Reflection.getClass('BX.Main.gridManager.reload'))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(document.getElementById('crm-type-list-container'), 'crm-type-list-grid-empty');\n\t\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = text + message + ' ';\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleTypeDelete(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.type.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmTypeListDeleteType',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t}\n\t\t\t\t}).then((response: {data: {}}) => {\n\t\t\t\t\tconst isUrlChanged = Type.isObject(response.data) && (response.data.isUrlChanged === true);\n\t\t\t\t\tif (isUrlChanged)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.grid.reloadTable();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\t//endregion\n\n\tgetToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif(Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nnamespace.TypeListComponent = TypeListComponent;\n"],"names":["namespace","Reflection","TypeListComponent","params","Type","isPlainObject","isString","gridId","BX","Main","grid","gridManager","getInstanceById","isElementNode","errorTextContainer","welcomeMessageContainer","isEmptyList","Boolean","bindEvents","EventEmitter","subscribe","handleTypeDelete","bind","toolbarComponent","getToolbarComponent","subscribeTypeUpdatedEvent","event","isUrlChanged","isObject","getData","window","location","reload","getClass","Dom","removeClass","document","getElementById","errors","text","forEach","message","innerText","parentElement","style","display","console","error","messages","push","showErrors","id","Text","toInteger","data","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","response","reloadTable","catch","showErrorsFromResponse","close","Crm","ToolbarComponent","Instance"],"mappings":"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"}