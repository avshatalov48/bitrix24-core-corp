this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,n,i){"use strict";function a(e,t){s(e,t);t.add(e)}function r(e,t,n){s(e,t);t.set(e,n)}function s(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function l(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var o=new WeakMap;var c=new WeakMap;var u=new WeakMap;var v=new WeakMap;var b=new WeakMap;var d=new WeakSet;var E=new WeakSet;var h=new WeakSet;var p=new WeakSet;var g=new WeakSet;var m=new WeakSet;var T=new WeakSet;var f=new WeakSet;var _=new WeakSet;var w=function(){babelHelpers.createClass(e,null,[{key:"productsTabId",get:function e(){return"tab_products"}}]);function e(t){babelHelpers.classCallCheck(this,e);a(this,_);a(this,f);a(this,T);a(this,m);a(this,g);a(this,p);a(this,h);a(this,E);a(this,d);r(this,o,{writable:true,value:void 0});r(this,c,{writable:true,value:void 0});r(this,u,{writable:true,value:void 0});r(this,v,{writable:true,value:void 0});r(this,b,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,o,t.onboardingData);babelHelpers.classPrivateFieldSet(this,c,t.contentContainer);babelHelpers.classPrivateFieldSet(this,u,t.serviceUrl);babelHelpers.classPrivateFieldSet(this,v,t.dealDetailManager)}babelHelpers.createClass(e,[{key:"processOnboarding",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,o).chain;var n=babelHelpers.classPrivateFieldGet(this,o).chainStep;var i=babelHelpers.classPrivateFieldGet(this,o).successDealGuideIsOver;if(t===0){if(n<1){l(this,h,C).call(this)}if(n<2){l(this,T,H).call(this)}}else if(t===1&&n===0){l(this,f,O).call(this)}if(!i){l(this,_,P).call(this)}}}]);return e}();function M(){return babelHelpers.classPrivateFieldGet(this,c)}function S(){return l(this,d,M).call(this).querySelector(".main-buttons")}function C(){var e={title:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_AUTOMATIC_RESERVATION_GUIDE_TITLE"),text:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_AUTOMATIC_RESERVATION_GUIDE_TEXT")};if(babelHelpers.classPrivateFieldGet(this,v).isTabButtonVisible(w.productsTabId)){l(this,g,I).call(this)}else{l(this,m,A).call(this)}}function D(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={title:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_AUTOMATIC_RESERVATION_GUIDE_TITLE"),text:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_AUTOMATIC_RESERVATION_GUIDE_TEXT")};return new i.Guide({steps:[{target:e,title:a.title,text:a.text,position:"bottom",events:n}],onEvents:true})}function I(){var e=this;var n=babelHelpers.classPrivateFieldGet(this,v).getTabMenuItemContainer(w.productsTabId);var i=l(this,p,D).call(this,n,{onShow:function e(){var a=i.getPopup().getPopupContainer();var r=t.Dom.getPosition(n).width/2;var s=parseFloat(a.style.left)-r;a.style.left="".concat(s,"px");i.handleResizeWindow()},onClose:function e(){t.userOptions.save("crm","warehouse-onboarding","firstChainStage",1)}});i.showNextStep();var a=babelHelpers.classPrivateFieldGet(this,v).getTabManager().getTabMenuContainer();var r=function n(){if(!babelHelpers.classPrivateFieldGet(e,v).isTabButtonVisible(w.productsTabId)){i.close();t.Event.unbind(window,"resize",n)}};t.Event.bind(window,"resize",r);t.Event.bindOnce(a,"mousedown",(function(){i.close();t.Event.unbind(window,"resize",r)}))}function A(){var e=this;var i=babelHelpers.classPrivateFieldGet(this,v).getTabManager().getMoreButton();var a=new BX.SpotLight({id:"".concat(w.productsTabId,"_spotlight"),targetElement:i,autoSave:true,targetVertex:"middle-center",zIndex:200});a.show();a.container.style.pointerEvents="none";var r=function i(r){var o=r.target.getMoreMenu();var c=babelHelpers.classPrivateFieldGet(e,v).getTabManager().getMoreMenu();if(o===c){a.close();var u=l(e,p,D).call(e,babelHelpers.classPrivateFieldGet(e,v).getTabFromMoreMenu(w.productsTabId));var b=o.getMenuContainer();var d=setTimeout((function(){u.showNextStep();BX.bindOnce(b,"click",h);var e=u.getPopup();n.EventEmitter.subscribeOnce(e,"onClose",E);var i=u.getPopup().getContentContainer().parentNode;BX.bind(i,"mouseenter",(function(){r.target.showMoreMenu()}));BX.bind(i,"mouseleave",(function(){var e=setTimeout((function(){r.target.closeMoreMenu()}),300);t.Event.bindOnce(c.getMenuContainer(),"mouseenter",(function(){clearTimeout(e)}))}))}),50);var E=function e(a){t.userOptions.save("crm","warehouse-onboarding","firstChainStage",1);t.Event.unbind(window,"resize",s);t.Event.unbind(b,"click",h);n.EventEmitter.unsubscribe("BX.Main.InterfaceButtons:onMoreMenuShow",i)};var h=function e(){t.userOptions.save("crm","warehouse-onboarding","firstChainStage",1);u.close()};t.Event.bind(c.getMenuContainer(),"click",E);n.EventEmitter.subscribeOnce("BX.Main.InterfaceButtons:onMoreMenuClose",(function(n){var i=n.target.getMoreMenu();var a=babelHelpers.classPrivateFieldGet(e,v).getTabManager().getMoreMenu();if(i===a){clearTimeout(d);t.Event.unbind(b,"click",h);u.close()}}))}};n.EventEmitter.subscribe("BX.Main.InterfaceButtons:onMoreMenuShow",r);var s=function i(){if(babelHelpers.classPrivateFieldGet(e,v).isTabButtonVisible(w.productsTabId)){a.close();l(e,g,I).call(e);t.Event.unbind(window,"resize",i);n.EventEmitter.unsubscribe("BX.Main.InterfaceButtons:onMoreMenuShow",r)}};t.Event.bind(window,"resize",s)}function H(){var e=this;var i=l(this,d,M).call(this).querySelector(".main-buttons");var a=function a(r){var s=babelHelpers.slicedToArray(r.data,1),l=s[0];var o=function e(){var n=l.getActiveHint();if(n!==null){n.close();t.Event.unbind(i,"click",e)}};t.Event.bind(i,"click",o);l.showFieldTourHint("STORE_INFO",{title:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_PRODUCT_STORE_GUIDE_TITLE"),text:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_PRODUCT_STORE_GUIDE_TEXT")},(function(){t.userOptions.save("crm","warehouse-onboarding","firstChainStage",2);BX.ajax.post(babelHelpers.classPrivateFieldGet(e,u),{ACTION:"FIX_FIRST_ONBOARD_CHAIN_VIEW"});t.Event.unbind(i,"click",o);n.EventEmitter.unsubscribe("onDemandRecalculateWrapper",a)}),["RESERVE_INFO"])};n.EventEmitter.subscribe("onDemandRecalculateWrapper",a)}function O(){var e=this;var a=function a(r){if(babelHelpers.classPrivateFieldGet(e,b)!==null){babelHelpers.classPrivateFieldGet(e,b).close()}var s=l(e,E,S).call(e);var o=document.querySelector('[data-cid="OPPORTUNITY_WITH_CURRENCY"]');var c=o&&o.querySelector(".crm-entity-widget-payment-add-box");if(c!==null){var u=o.querySelector(".ui-entity-editor-block-context-menu");var v=o.querySelector(".ui-entity-editor-draggable-btn");var d={title:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_ADD_DOCUMENT_GUIDE_TITLE"),text:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_ADD_DOCUMENT_GUIDE_TEXT")};var h=new i.Guide({steps:[{target:c,title:d.title,text:d.text,events:{onClose:function e(){t.Event.unbind(s,"click",p);t.Event.unbind(u,"click",p);t.Event.unbind(v,"mousedown",p)}}}],onEvents:true});babelHelpers.classPrivateFieldSet(e,b,h);var p=function e(){t.Event.unbind(s,"click",e);n.EventEmitter.unsubscribe("PaymentDocuments.EntityEditor:changeDocuments",a);h.close();t.userOptions.save("crm","warehouse-onboarding","secondChainStage",1)};h.showNextStep();t.Event.bind(h.getPopup().closeIcon,"click",p);t.Event.bind(s,"click",p);t.Event.bind(c,"click",p);t.Event.bind(u,"click",p);t.Event.bind(v,"mousedown",p)}};n.EventEmitter.subscribe("PaymentDocuments.EntityEditor:changeDocuments",a)}function P(){var e=this;var a=function a(r){if(r.data[1].currentStepId==="WON"&&r.data[1].currentSemantics==="success"){n.EventEmitter.unsubscribe("Crm.EntityProgress.Saved",a);var s=function a(r){n.EventEmitter.unsubscribe("BX.Crm.Timeline.Items.FinalSummaryDocuments:onHistoryNodeAdded",a);var s=babelHelpers.slicedToArray(r.data,1),o=s[0];var c=o.querySelector(".crm-entity-stream-content-document-description");var u={title:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_SUCCESS_DEAL_GUIDE_TITLE"),text:t.Loc.getMessage("CRM_DEAL_DETAIL_WAREHOUSE_SUCCESS_DEAL_GUIDE_TEXT")};var v=new i.Guide({steps:[{target:c,title:u.title,text:u.text,position:"bottom",events:{onClose:function e(){t.userOptions.save("crm","warehouse-onboarding","successDealGuideIsOver",true);p()}}}],onEvents:true});var b=l(e,d,M).call(e);var h=l(e,E,S).call(e);var p=function e(){t.Event.unbind(b,"click",v.close.bind(v));t.Event.unbind(h,"click",v.close.bind(v))};BX.onCustomEvent(window,"OpenEntityDetailTab",["main"]);setTimeout((function(){var e=t.Dom.getPosition(c);window.scrollTo(0,e.y-250);v.showNextStep();t.Event.bind(h,"click",v.close.bind(v));setTimeout((function(){t.Event.bind(b,"click",v.close.bind(v))}),3e3)}),500)};n.EventEmitter.subscribe("BX.Crm.Timeline.Items.FinalSummaryDocuments:onHistoryNodeAdded",s)}};n.EventEmitter.subscribe("Crm.EntityProgress.Saved",a)}function k(e,t,n){R(e,t);t.set(e,n)}function R(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var y=new WeakMap;var F=new WeakMap;var L=new WeakMap;var G=new WeakMap;var U=function(){function e(n){babelHelpers.classCallCheck(this,e);k(this,y,{writable:true,value:void 0});k(this,F,{writable:true,value:void 0});k(this,L,{writable:true,value:null});k(this,G,{writable:true,value:new t.Cache.MemoryCache});babelHelpers.classPrivateFieldSet(this,y,n.guid);babelHelpers.classPrivateFieldSet(this,F,BX.Crm.EntityDetailManager.get(babelHelpers.classPrivateFieldGet(this,y)))}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){var t=this;return babelHelpers.classPrivateFieldGet(this,G).remember("container",(function(){return document.getElementById(babelHelpers.classPrivateFieldGet(t,y)+"_container")}))}},{key:"getDealDetailManager",value:function e(){return babelHelpers.classPrivateFieldGet(this,F)}},{key:"enableOnboardingChain",value:function e(t,n){if(babelHelpers.classPrivateFieldGet(this,L)===null&&this.getDealDetailManager()!==null){babelHelpers.classPrivateFieldSet(this,L,new w({onboardingData:t,contentContainer:this.getContainer(),serviceUrl:n,dealDetailManager:this.getDealDetailManager()}));babelHelpers.classPrivateFieldGet(this,L).processOnboarding()}}}]);return e}();e.DealManager=U})(this.BX.Crm.Deal=this.BX.Crm.Deal||{},BX,BX.Event,BX.UI.Tour);
//# sourceMappingURL=script.map.js