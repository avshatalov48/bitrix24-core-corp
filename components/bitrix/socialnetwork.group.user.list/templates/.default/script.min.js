this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(e,t,i,n,r){"use strict";var s=function(){function e(t){var n=this;babelHelpers.classCallCheck(this,e);this.id=t.id;this.menuItems=t.menuItems;this.componentName=t.componentName;if(i.Type.isStringFilled(t.menuButtonId)){var r=document.getElementById(t.menuButtonId);if(r){r.addEventListener("click",(function(e){n.menuButtonClick(e.currentTarget)}))}}}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this._id}},{key:"getSetting",value:function e(t,i){return this._settings.getParam(t,i)}},{key:"menuButtonClick",value:function e(t){this.openMenu(t)}},{key:"openMenu",value:function e(t){if(this.menuOpened){this.closeMenu();return}if(!i.Type.isArray(this.menuItems)){return}var r=[];this.menuItems.forEach((function(e){if(!i.Type.isUndefined(e.SEPARATOR)&&e.SEPARATOR){r.push({SEPARATOR:true});return}if(!i.Type.isStringFilled(e.TYPE)){return}r.push({text:i.Type.isStringFilled(e.TITLE)?e.TITLE:"",onclick:i.Type.isStringFilled(e.LINK)?'window.location.href = "'.concat(e.LINK,'"; return false;'):""})}));this.menuId="".concat(this.id.toLowerCase(),"_menu");n.Popup.show(this.menuId,t,r,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,events:{onPopupShow:this.onPopupShow.bind(this),onPopupClose:this.onPopupClose.bind(this),onPopupDestroy:this.onPopupDestroy.bind(this)}});this.menuPopup=n.MenuManager.currentItem}},{key:"closeMenu",value:function e(){if(!this.menuPopup||!this.menuPopup.popupWindow){return}this.menuPopup.popupWindow.destroy()}},{key:"onPopupShow",value:function e(){this.menuOpened=true}},{key:"onPopupClose",value:function e(){this.closeMenu()}},{key:"onPopupDestroy",value:function e(){this.menuOpened=false;this.menuPopup=null;if(!i.Type.isUndefined(n.MenuManager.Data[this.menuId])){delete n.MenuManager.Data[this.menuId]}}}]);return e}();var a;var o=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t.parent;this.componentName=i.Type.isStringFilled(this.parent.componentName)?this.parent.componentName:"";this.signedParameters=i.Type.isStringFilled(this.parent.signedParameters)?this.parent.signedParameters:"";this.gridId=i.Type.isStringFilled(this.parent.gridId)?this.parent.gridId:"";this.useSlider=i.Type.isBoolean(this.parent.useSlider)?this.parent.useSlider:false}babelHelpers.createClass(e,[{key:"viewProfile",value:function e(t){var n=parseInt(!i.Type.isUndefined(t.userId)?t.userId:0);var r=i.Type.isStringFilled(t.pathToUser)?t.pathToUser:"";if(n<=0||!i.Type.isStringFilled(r)){return}r=r.replace("#ID#",n).replace("#USER_ID#",n).replace("#user_id#",n);if(this.useSlider){BX.SidePanel.Instance.open(r,{cacheable:false,allowChangeHistory:true,contentClassName:"bitrix24-profile-slider-content",loader:"intranet:profile",width:1100})}else{window.location.href=r}}},{key:"act",value:function e(t){var n=this;return new Promise((function(e,r){return i.ajax.runComponentAction(n.componentName,"act",{mode:"class",signedParameters:n.signedParameters,data:{action:t.action,fields:{userId:t.userId}}}).then((function(i){if(i.data.success){n.processActionSuccess(t)}else{n.processActionFailure(t)}e(i)}),(function(e){if(e.errors){n.processActionFailure(t,e.errors[0].message)}r(e)}))}))}},{key:"processActionSuccess",value:function e(t){var n=null;switch(t.action){case"exclude":n="afterUserExclude";break;case"setOwner":n="afterOwnerSet";break;case"setScrumMaster":n="afterSetScrumMaster";break;case"setModerator":n="afterModeratorAdd";break;case"removeModerator":n="afterModeratorRemove";break;case"acceptIncomingRequest":case"rejectIncomingRequest":n="afterRequestDelete";break;case"deleteOutgoingRequest":n="afterRequestOutDelete";break;default:}if(n&&top.BX.SidePanel&&window!==top.window){top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:n})}if(t.action==="reinvite"){BX.UI.Notification.Center.notify({content:i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_ACTION_REINVITE_SUCCESS")})}else{this.parent.reload()}}},{key:"processActionFailure",value:function e(t,n){if(!i.Type.isStringFilled(n)){n=i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_ACTION_FAILURE")}BX.UI.Notification.Center.notify({content:n})}},{key:"disconnectDepartment",value:function e(t){var n=this;var r=parseInt(!i.Type.isUndefined(t.id)?t.id:0);if(r<=0){return}i.ajax.runComponentAction(this.componentName,"disconnectDepartment",{mode:"class",signedParameters:this.signedParameters,data:{fields:{id:r}}}).then((function(e){if(e.data.success){if(top.BX.SidePanel&&window!==top.window){top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:"afterDeptUnconnect"})}n.parent.reload()}}))}},{key:"groupDelete",value:function e(){var t=this;var s=[new r.SendButton({text:i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_GROUP_ACTION_BUTTON_DELETE"),events:{click:function e(){n.PopupManager.getCurrentPopup().destroy();var i=BX.Main.gridManager.getInstanceById(t.gridId);if(!i){return}var r={ID:i.getRows().getSelectedIds(),apply_filter:"Y"};r[i.getActionKey()]="delete";r[i.getForAllKey()]="N";i.reloadTable("POST",r)}}}),new r.CancelButton({events:{click:function e(){n.PopupManager.getCurrentPopup().destroy()}}})];var o=n.PopupManager.create({id:"bx-sgul-group-delete-confirm",autoHide:false,closeByEsc:true,buttons:s,events:{onPopupClose:function e(t){t.destroy()}},content:i.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_GROUP_ACTION_CONFIRM_TEXT")),padding:20});o.show()}}]);return e}();var l=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function t(i){return e.repo.get(i)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.id=t.id;this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.useSlider=t.useSlider;this.gridId=t.gridId;this.filterId=i.Type.isStringFilled(t.filterId)?t.filterId:null;this.defaultFilterPresetId=i.Type.isStringFilled(t.defaultFilterPresetId)&&!["requests_in","requests_out"].includes(t.defaultFilterPresetId)?t.defaultFilterPresetId:"tmp_filter";this.defaultCounter=i.Type.isStringFilled(t.defaultCounter)?t.defaultCounter:"";this.gridContainer=i.Type.isStringFilled(t.gridContainerId)?document.getElementById(t.gridContainerId):null;this.urls=t.urls;t.toolbar.componentName=this.componentName;this.toolbarInstance=new s(t.toolbar);this.actionManagerInstance=new o({parent:this});e.repo.set(this.id,this);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.initEvents()}},{key:"initEvents",value:function e(){var n=this;if(this.gridContainer){this.gridContainer.addEventListener("click",this.processClickEvent.bind(this))}t.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(e){var t=e.getCompatData(),r=babelHelpers.slicedToArray(t,1),s=r[0];if(s.getEventId()==="sonetGroupEvent"&&!i.Type.isUndefined(s.data)&&i.Type.isStringFilled(s.data.code)&&s.data.code==="afterInvite"){n.reload()}}));t.EventEmitter.subscribe("Socialnetwork.Toolbar:onItem",(function(e){var t=e.getData();if(t.counter){if(t.counter.filter&&t.counter.filterPresetId&&t.counter.filter.filterManager){var r=t.counter.filter.getFilter().getApi();var s=t.counter.filter.filterManager;r.setFilter({preset_id:s.getPreset().getCurrentPresetId()===t.counter.filterPresetId?n.defaultFilterPresetId:t.counter.filterPresetId})}else if(i.Type.isStringFilled(t.counter.type)){var a="";if(t.counter.type===n.defaultCounter){a=n.urls.users}else{switch(t.counter.type){case"workgroup_requests_in":a=n.urls.requests;break;case"workgroup_requests_out":a=n.urls.requestsOut;break;default:}}if(i.Type.isStringFilled(a)){window.location=a.replace("#group_id#",n.g)}}}}));var r=BX.Main.filterManager.getById(this.filterId);if(r){var s=r.getEmitter();var a=r.getApi();s.subscribe("init",(function(e){var t=e.getData(),n=t.field;if(n.id==="INITIATED_BY_TYPE"){n.subscribe("change",(function(){if(i.Type.isStringFilled(n.getValue())){var e=r.getFilterFieldsValues();if(i.Type.isStringFilled(e.INITIATED_BY_TYPE)){if(JSON.stringify(Object.values(e.ROLE))===JSON.stringify(["Z"])){return}e.ROLE={0:"Z"};a.setFields(e)}}}))}}));t.EventEmitter.subscribe("BX.Grid.SettingsWindow:save",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),r=i[0];if(!r||!r.parent||r.parent.getId()!==n.gridId){return}a.setFilter({preset_id:n.defaultFilterPresetId})}))}}},{key:"reload",value:function e(){var t=BX.Main.gridManager.getInstanceById(this.gridId);if(!t){return}t.reloadTable("POST",{apply_filter:"Y"})}},{key:"processClickEvent",value:function e(t){var n=t.target;if(!n.classList.contains("sonet-group-user-grid-action")){return}var r=n.getAttribute("data-bx-action");if(r==="disconnectDepartment"){var s=Number(n.getAttribute("data-bx-department"));if(s>0){this.getActionManager().disconnectDepartment({id:s})}return}var a=n.getAttribute("data-bx-user-id");if(!i.Type.isStringFilled(r)||!i.Type.isStringFilled(a)){return}a=parseInt(a);if(a<=0){return}n.classList.add("--inactive");this.actionManagerInstance.act({action:r,userId:a}).then((function(){n.classList.remove("--inactive")}),(function(){n.classList.remove("--inactive")}));t.preventDefault();t.stopPropagation()}},{key:"getActionManager",value:function e(){return this.actionManagerInstance}}]);return e}();babelHelpers.defineProperty(l,"repo",new Map);e.Manager=l;e.Toolbar=s})(this.BX.Socialnetwork.WorkgroupUserList=this.BX.Socialnetwork.WorkgroupUserList||{},BX.Event,BX,BX.Main,BX.UI);
//# sourceMappingURL=script.map.js