this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(e,t,i,r,n){"use strict";var a;var s=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t.parent;this.componentName=i.Type.isStringFilled(this.parent.componentName)?this.parent.componentName:"";this.signedParameters=i.Type.isStringFilled(this.parent.signedParameters)?this.parent.signedParameters:"";this.gridId=i.Type.isStringFilled(this.parent.gridId)?this.parent.gridId:"";this.useSlider=i.Type.isBoolean(this.parent.useSlider)?this.parent.useSlider:false}babelHelpers.createClass(e,[{key:"viewProfile",value:function e(t){var r=parseInt(!i.Type.isUndefined(t.userId)?t.userId:0);var n=i.Type.isStringFilled(t.pathToUser)?t.pathToUser:"";if(r<=0||!i.Type.isStringFilled(n)){return}n=n.replace("#ID#",r).replace("#USER_ID#",r).replace("#user_id#",r);if(this.useSlider){BX.SidePanel.Instance.open(n,{cacheable:false,allowChangeHistory:true,contentClassName:"bitrix24-profile-slider-content",loader:"intranet:profile",width:1100})}else{window.location.href=n}}},{key:"act",value:function e(t){var r=this;return new Promise((function(e,n){return i.ajax.runComponentAction(r.componentName,"act",{mode:"class",signedParameters:r.signedParameters,data:{action:t.action,fields:{userId:t.userId}}}).then((function(i){if(i.data.success){r.processActionSuccess(t)}else{r.processActionFailure(t)}e(i)}),(function(e){if(e.errors){r.processActionFailure(t,e.errors[0].message)}n(e)}))}))}},{key:"processActionSuccess",value:function e(t){var r=null;switch(t.action){case"exclude":r="afterUserExclude";break;case"setOwner":r="afterOwnerSet";break;case"setScrumMaster":r="afterSetScrumMaster";break;case"setModerator":r="afterModeratorAdd";break;case"removeModerator":r="afterModeratorRemove";break;case"acceptIncomingRequest":case"rejectIncomingRequest":r="afterRequestDelete";break;case"deleteOutgoingRequest":r="afterRequestOutDelete";break;default:}if(r&&top.BX.SidePanel&&window!==top.window){top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:r})}if(t.action==="reinvite"){BX.UI.Notification.Center.notify({content:i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_ACTION_REINVITE_SUCCESS")})}else{this.parent.reload()}}},{key:"processActionFailure",value:function e(t,r){if(!i.Type.isStringFilled(r)){r=i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_ACTION_FAILURE")}BX.UI.Notification.Center.notify({content:r})}},{key:"disconnectDepartment",value:function e(t){var r=this;var n=parseInt(!i.Type.isUndefined(t.id)?t.id:0);if(n<=0){return}i.ajax.runComponentAction(this.componentName,"disconnectDepartment",{mode:"class",signedParameters:this.signedParameters,data:{fields:{id:n}}}).then((function(e){if(e.data.success){if(top.BX.SidePanel&&window!==top.window){top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:"afterDeptUnconnect"})}r.parent.reload()}}))}},{key:"groupDelete",value:function e(){var t=this;var s=[new n.SendButton({text:i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_GROUP_ACTION_BUTTON_DELETE"),events:{click:function e(){r.PopupManager.getCurrentPopup().destroy();var i=BX.Main.gridManager.getInstanceById(t.gridId);if(!i){return}var n={ID:i.getRows().getSelectedIds(),apply_filter:"Y"};n[i.getActionKey()]="delete";n[i.getForAllKey()]="N";i.reloadTable("POST",n)}}}),new n.CancelButton({events:{click:function e(){r.PopupManager.getCurrentPopup().destroy()}}})];var o=r.PopupManager.create({id:"bx-sgul-group-delete-confirm",autoHide:false,closeByEsc:true,buttons:s,events:{onPopupClose:function e(t){t.destroy()}},content:i.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),i.Loc.getMessage("SOCIALNETWORK_GROUP_USER_LIST_GROUP_ACTION_CONFIRM_TEXT")),padding:20});o.show()}}]);return e}();var o=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function t(i){return e.repo.get(i)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.id=t.id;this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.useSlider=t.useSlider;this.gridId=t.gridId;this.filterId=i.Type.isStringFilled(t.filterId)?t.filterId:null;this.defaultFilterPresetId=i.Type.isStringFilled(t.defaultFilterPresetId)&&!["requests_in","requests_out"].includes(t.defaultFilterPresetId)?t.defaultFilterPresetId:"tmp_filter";this.defaultCounter=i.Type.isStringFilled(t.defaultCounter)?t.defaultCounter:"";this.gridContainer=i.Type.isStringFilled(t.gridContainerId)?document.getElementById(t.gridContainerId):null;this.urls=t.urls;this.actionManagerInstance=new s({parent:this});e.repo.set(this.id,this);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.initEvents()}},{key:"initEvents",value:function e(){var r=this;if(this.gridContainer){this.gridContainer.addEventListener("click",this.processClickEvent.bind(this))}t.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),a=n[0];if(a.getEventId()==="sonetGroupEvent"&&!i.Type.isUndefined(a.data)&&i.Type.isStringFilled(a.data.code)&&["afterInvite","afterIncomingRequestCancel"].includes(a.data.code)){r.reload()}}));t.EventEmitter.subscribe("Socialnetwork.Toolbar:onItem",(function(e){var t=e.getData();if(t.counter){if(t.counter.filter&&t.counter.filterPresetId&&t.counter.filter.filterManager){var n=t.counter.filter.getFilter().getApi();var a=t.counter.filter.filterManager;n.setFilter({preset_id:a.getPreset().getCurrentPresetId()===t.counter.filterPresetId?r.defaultFilterPresetId:t.counter.filterPresetId})}else if(i.Type.isStringFilled(t.counter.type)){var s="";if(t.counter.type===r.defaultCounter){s=r.urls.users}else{switch(t.counter.type){case"workgroup_requests_in":s=r.urls.requests;break;case"workgroup_requests_out":s=r.urls.requestsOut;break;default:}}if(i.Type.isStringFilled(s)){window.location=s.replace("#group_id#",r.g)}}}}));var n=BX.Main.filterManager.getById(this.filterId);if(n){var a=n.getEmitter();var s=n.getApi();a.subscribe("init",(function(e){var t=e.getData(),r=t.field;if(r.id==="INITIATED_BY_TYPE"){r.subscribe("change",(function(){if(i.Type.isStringFilled(r.getValue())){var e=n.getFilterFieldsValues();if(i.Type.isStringFilled(e.INITIATED_BY_TYPE)){if(JSON.stringify(Object.values(e.ROLE))===JSON.stringify(["Z"])){return}e.ROLE={0:"Z"};s.setFields(e)}}}))}}));t.EventEmitter.subscribe("BX.Grid.SettingsWindow:save",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),n=i[0];if(!n||!n.parent||n.parent.getId()!==r.gridId){return}s.setFilter({preset_id:r.defaultFilterPresetId})}))}}},{key:"reload",value:function e(){var t=BX.Main.gridManager.getInstanceById(this.gridId);if(!t){return}t.reloadTable("POST",{apply_filter:"Y"})}},{key:"processClickEvent",value:function e(t){var r=t.target;if(!r.classList.contains("sonet-group-user-grid-action")){return}var n=r.getAttribute("data-bx-action");if(n==="disconnectDepartment"){var a=Number(r.getAttribute("data-bx-department"));if(a>0){this.getActionManager().disconnectDepartment({id:a})}return}var s=r.getAttribute("data-bx-user-id");if(!i.Type.isStringFilled(n)||!i.Type.isStringFilled(s)){return}s=parseInt(s);if(s<=0){return}r.classList.add("--inactive");this.actionManagerInstance.act({action:n,userId:s}).then((function(){r.classList.remove("--inactive")}),(function(){r.classList.remove("--inactive")}));t.preventDefault();t.stopPropagation()}},{key:"getActionManager",value:function e(){return this.actionManagerInstance}}]);return e}();babelHelpers.defineProperty(o,"repo",new Map);e.Manager=o})(this.BX.Socialnetwork.WorkgroupUserList=this.BX.Socialnetwork.WorkgroupUserList||{},BX.Event,BX,BX.Main,BX.UI);
//# sourceMappingURL=script.map.js