{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, ajax, Loc} from 'main.core';\nimport {Popup} from 'main.popup';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport {QrAuth} from \"crm.terminal\";\nimport {type BaseEvent, EventEmitter} from \"main.core.events\";\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nclass TerminalPaymentList\n{\n\tgrid = null;\n\tsettingsSliderUrl = '';\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tif (BX.Main.gridManager)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\tthis.settingsSliderUrl = options.settingsSliderUrl;\n\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler.bind(this));\n\t}\n\n\tdeletePayment(id)\n\t{\n\t\tlet popup = new Popup({\n\t\t\tid: 'crm_terminal_payment_list_delete_popup',\n\t\t\ttitleBar: Loc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_TITLE_DELETE_TITLE'),\n\t\t\tcontent: Loc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_TITLE_DELETE_CONTENT'),\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext:  Loc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_CONTINUE'),\n\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\tonclick: (button, event) => {\n\t\t\t\t\t\tbutton.setDisabled();\n\n\t\t\t\t\t\tajax.runAction(\n\t\t\t\t\t\t\t'crm.order.terminalpayment.delete',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t).then((response) => {\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0].message),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_CANCEL'),\n\t\t\t\t\tcolor: ButtonColor.DANGER,\n\t\t\t\t\tonclick: (button, event) => {\n\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t\tpopup.show();\n\t}\n\n\tdeletePayments()\n\t{\n\t\tlet paymentIds = this.grid.getRows().getSelectedIds();\n\t\tajax.runAction(\n\t\t\t'crm.order.terminalpayment.deleteList',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tids: paymentIds,\n\t\t\t\t}\n\t\t\t}\n\t\t).then((response) => {\n\t\t\tthis.grid.reload();\n\t\t}).catch((response) => {\n\t\t\tif (response.errors)\n\t\t\t{\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tif (error.message)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: BX.util.htmlspecialchars(error.message),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.grid.reload();\n\t\t});\n\t}\n\n\topenSmsSettingsSlider()\n\t{\n\t\tBX.SidePanel.Instance.open(this.settingsSliderUrl, {\n\t\t\twidth: 700,\n\t\t\tcacheable: false,\n\t\t\tallowChangeTitle: false,\n\t\t\tallowChangeHistory: false,\n\t\t});\n\t}\n\n\topenQrAuthPopup()\n\t{\n\t\t(new QrAuth).show();\n\t}\n\n\topenHelpdesk(event)\n\t{\n\t\tif(top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=17603024\");\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonGridUpdatedHandler(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (grid && grid.getId() === this.gridId && grid.getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\tajax.runComponentAction('bitrix:crm.terminal.payment.list', 'isRowsExists', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {},\n\t\t\t}).then(function (response) {\n\t\t\t\tif (response.data.IS_ROWS_EXIST === false)\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t}\n\t}\n}\n\nnamespace.TerminalPaymentList = TerminalPaymentList;"],"names":["namespace","Reflection","TerminalPaymentList","options","gridId","BX","Main","gridManager","grid","getInstanceById","settingsSliderUrl","EventEmitter","subscribe","onGridUpdatedHandler","bind","id","popup","Popup","titleBar","Loc","getMessage","content","buttons","Button","text","color","ButtonColor","SUCCESS","onclick","button","event","setDisabled","ajax","runAction","data","then","response","destroy","reload","errors","UI","Notification","Center","notify","util","htmlspecialchars","message","DANGER","show","paymentIds","getRows","getSelectedIds","ids","forEach","error","SidePanel","Instance","open","width","cacheable","allowChangeTitle","allowChangeHistory","QrAuth","top","Helper","preventDefault","getCompatData","getId","getCountDisplayed","runComponentAction","mode","IS_ROWS_EXIST","window","location"],"mappings":"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"}