(function(){if(window.BVoteConstructor)return;BX.addCustomEvent("onClickMulti",function(t){var e=BX.findChildren(t.parentNode.previousSibling,{attribute:{"data-bx-answer-field":"field-type"}},true);for(var i=0;i<e.length;i++){e[i].value=t.checked?"1":"0"}});var t=function(t){this.map=new Map;this.maxSort=0;this.currentId=0;t=t||{};this.maxCount=parseInt(t["maxCount"]||0);this.onEntityHasBeenDeleted=this.onEntityHasBeenDeleted.bind(this)};t.prototype={set:function(t,e){this.map.set(t,e);BX.addCustomEvent(e,"onEntityHasBeenDeleted",this.onEntityHasBeenDeleted);this.maxSort=Math.max(this.maxSort,e.getSort());this.currentId++},get:function(t){return this.map.get(t)},keys:function(){return this.map.keys()},delete:function(t){return this.map.delete(t)},onEntityHasBeenDeleted:function(t,e,i){this.delete(t);if(this.maxSort===parseInt(e)){var s=0;this.map.forEach(function(t){s=Math.max(s,parseInt(t.getSort()))});this.maxSort=s}},getNextId:function(){return this.currentId},getMaxSort:function(){return this.maxSort},canAdd:function(){return!(this.maxCount>0&&this.maxCount<=this.map.size)}};var e=function(t,i){this.id=[i["groupId"]||"vote",t.getAttribute("data-bx-number").toString()];this.eventObject=i["eventObject"];this.nodes={main:t,sort:null};this.delete=this.delete.bind(this);this.__sortDD=this.__sortDD.bind(this);this.onbxdragstart=this.onbxdragstart.bind(this);this.onbxdragstop=this.onbxdragstop.bind(this);this.onbxdrag=this.onbxdrag.bind(this);this.onbxdraghout=this.onbxdraghout.bind(this);this.onbxdestdraghover=this.onbxdestdraghover.bind(this);this.onbxdestdraghout=this.onbxdestdraghout.bind(this);this.onbxdestdragfinish=this.onbxdestdragfinish.bind(this);BX.addCustomEvent(this.eventObject,"onEntityHasBeenSorted",this.__sortDD);this.init(i);e.repo.set(this.id,this)};e.repo=new Map;e.getByFullId=function(t){return e.repo.get(t)};e.deleteByFullId=function(t){return e.repo.delete(t)};e.prototype={init:function(t){},bind:function(t){var e,i,s;if(BX(t)){e=BX.findChildren(t,{attribute:"data-bx-action"},true);if(t.hasAttribute("data-bx-action")){e.unshift(t)}}else{e=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true)}for(i=0;i<e.length;i++){if(!e[i].hasAttribute("data-bx-bo und")){s="__"+e[i].getAttribute("data-bx-action");if(typeof this[s]==="function"){e[i].setAttribute("data-bx-bound","Y");BX.bind(e[i],"click",this[s].bind(this))}}}this.nodes.main["entityId"]=this.getFullId()},initDD:function(){if(window["jsDD"]&&!this.nodes.main.hasAttribute("data-bx-drag-sensitive")){var t=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true),e;for(e=0;e<t.length;e++){if(t[e].getAttribute("data-bx-action")==="sortDD"&&!t[e].hasAttribute("data-bx-bound-dd")&&t[e].getAttribute("data-bx-bound")==="Y"){BX.unbindAll(t[e],"click");this.nodes.dd=t[e];this.nodes.dd.setAttribute("data-bx-bound-dd","Y");this.nodes.dd["entityId"]=this.getFullId();BX.addClass(this.nodes.dd,"bx-drag-draggable");this.nodes.main.hasAttribute("data-bx-drag-sensitive","Y");BX.addClass(this.nodes.main,"bx-drag-drag-sensitive");window.jsDD.registerObject(this.nodes.dd);this.nodes.dd.onbxdragstart=this.onbxdragstart;this.nodes.dd.onbxdragstop=this.onbxdragstop;this.nodes.dd.onbxdrag=this.onbxdrag;this.nodes.dd.onbxdraghout=this.onbxdraghout;window.jsDD.registerDest(this.nodes.main);this.nodes.main.onbxdestdraghover=this.onbxdestdraghover;this.nodes.main.onbxdestdraghout=this.onbxdestdraghout;this.nodes.main.onbxdestdragfinish=this.onbxdestdragfinish;var i=BX.findChild(this.nodes.main,{tagName:"INPUT",props:{type:"text"}},true,true);for(e=0;e<=i.length;e++){BX.bind(i[e],"mousedown",BX.eventCancelBubble)}}}}},getSort:function(){if(!this.__sort)this.__sort=parseInt(this.nodes["sort"].value);return this.__sort},setSort:function(t){this.__sort=this.nodes["sort"].value=parseInt(t)},__sortDD:function(t,e,i,s){if(BX.type.isInteger(t)&&i.getGroupId()===this.getGroupId()){if(this===i){this.setSort(e)}else if(t>e){if(e<=this.getSort()&&this.getSort()<=t){this.setSort(this.getSort()+10)}}else if(t<e){if(t<this.getSort()&&this.getSort()<=e){this.setSort(this.getSort()-10)}}}},__sortDown:function(){if(this.nodes.main.nextSibling&&this.nodes.main.nextSibling["entityId"]){var t=e.getByFullId(this.nodes.main.nextSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main.nextSibling,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},__sortUp:function(){if(this.nodes.main.previousSibling&&this.nodes.main.previousSibling["entityId"]){var t=e.getByFullId(this.nodes.main.previousSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main,this.nodes.main.previousSibling);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},getFullId:function(t){return t===true?this.id.join("_"):this.id},getId:function(){return this.id[1]},getGroupId:function(){return this.id[0]},delete:function(){var t=[],i,s=this.getSort();for(i in this.nodes){if(this.nodes.hasOwnProperty(i)){t.push(i)}}for(i=0;i<=t.length;i++){if(this.nodes.hasOwnProperty(t[i])){this.nodes[t[i]]=null;delete this.nodes[t[i]]}}e.deleteByFullId(this.getFullId());BX.onCustomEvent(this,"onEntityHasBeenDeleted",[this.getFullId(),s,this])},onbxdragstart:function(){var t=BX.create("DIV",{attrs:{className:"bx-drag-object"},style:{position:"absolute",zIndex:10,width:this.nodes.main.parentNode.clientWidth+"px"},html:this.nodes.main.outerHTML.replace(new RegExp(this.nodes.main.getAttribute("id"),"gi"),"DragCopy")});this.nodes.drag=t;this.nodes.dd["entitySort"]=this.getSort();this.dragPos={main:BX.pos(this.nodes.main),parent:BX.pos(this.nodes.main.parentNode)};document.body.appendChild(this.nodes.drag);BX.addClass(this.nodes.main,"bx-drag-source");t=null},onbxdragstop:function(){if(this.dragPos){BX.removeClass(this.nodes.main,"bx-drag-source");this.nodes.drag.parentNode.removeChild(this.nodes.drag);this.nodes.drag=null;delete this.nodes.drag;delete this.dragPos}return true},onbxdrag:function(t,e){if(this.nodes.drag){if(this.dragPos){if(!this.dragPos.main.deltaX)this.dragPos.main.deltaX=this.dragPos.main.left-t;if(!this.dragPos.main.deltaY)this.dragPos.main.deltaY=this.dragPos.main.top-e;t+=this.dragPos.main.deltaX;e+=this.dragPos.main.deltaY;e=Math.min(Math.max(e,this.dragPos.parent.top),this.dragPos.parent.bottom)}this.nodes.drag.style.left=t+"px";this.nodes.drag.style.top=e+"px"}},onbxdraghout:function(){},onbxdestdraghover:function(t){if(this.nodes.dd!==t){var e=parseInt(t["entitySort"]);if(this.getSort()<e)BX.addClass(this.nodes.main,"bx-drag-over-up");else BX.addClass(this.nodes.main,"bx-drag-over-down")}},onbxdestdraghout:function(){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down")},onbxdestdragfinish:function(t){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down");if(this.nodes.dd!==t){var i=e.getByFullId(t["entityId"]);if(i.getGroupId()===this.getGroupId()){var s=parseInt(t["entitySort"]);if(this.getSort()<s){this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}else{if(this.nodes.main.nextSibling)this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main.nextSibling);else this.nodes.main.parentNode.appendChild(i.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}}}}};var i=function(e,s){this.answers=new t({maxCount:s["maxAnswersCount"]});this.visibleId=0;i.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-question-field":"C_SORT"}},true)};BX.extend(i,e);i.prototype.init=function(t){this.nodes.answerList=BX.findChild(this.nodes.main,{attribute:{"data-bx-role":"answer-list"}},true);var e=BX.findChild(this.nodes.answerList,{tagName:"LI",attribute:{"data-bx-role":"answer"}},false,true),i,n;for(i=0;i<e.length;i++){n=new s(e[i],{eventObject:t["eventObject"],groupId:this.getId()});this.answers.set(n.getId(),n);this.visibleId++}this.bind();this.initDD();this.addAnswer=this.addAnswer.bind(this);this.toggleAddNode=this.toggleAddNode.bind(this);this.toggleAddNode(null,null);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",this.toggleAddNode)};i.prototype.toggleAddNode=function(t,e){if(e===null||e.getGroupId()===this.getId()){var i=BX.findChild(this.nodes["main"],{attribute:{"data-bx-action":"adda"}},true,true),s;for(s=0;s<i.length;s++){BX.unbind(i[s],"focus",this.addAnswer)}if(this.answers.canAdd()){BX.bind(i[i.length-1],"focus",this.addAnswer)}}};i.prototype.addAnswer=function(){var t=this.answers.getNextId(),e={"#Q#":this.getId(),"#A#":t,"#A_FIELD_TYPE#":BX("multi_"+this.getId())&&BX("multi_"+this.getId()).checked?"1":"0","#A_VALUE#":"","#A_C_SORT#":this.answers.getMaxSort()+10,"#A_PH#":++this.visibleId},i=BX.message("VOTE_TEMPLATE_ANSWER"),n;for(n in e){if(e.hasOwnProperty(n)){i=i.replace(new RegExp(n,"gi"),e[n])}}var d=BX.create("DIV",{html:i}).firstChild;this.nodes.answerList.appendChild(d);var o=new s(d,{eventObject:this.eventObject,groupId:this.getId()});this.bind(d);this.initDD(d);this.answers.set(o.getId(),o);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenAdded",[o.getFullId(),o])};i.prototype.__delq=function(){var t=BX.findChild(this.nodes.main,{attribute:{"data-bx-question-field":"MESSAGE"}},true);if(!t||t.value===""||confirm(BX.message("VVE_QUESTION_DELETE"))){var e=this.answers.keys(),i=e.next();t=this.nodes.main;while(!i.done){this.answers.get(i.value).delete();i=e.next()}this.delete();t.parentNode.removeChild(t);BX.onCustomEvent(this.eventObject,"onQuestionHasBeenDeleted",[this.getFullId(),this])}};var s=function(t,e){s.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-answer-field":"C_SORT"}},true)};BX.extend(s,e);s.prototype.init=function(t){this.bind();this.initDD(this.nodes.main)};s.prototype.__dela=function(t){var e=BX.findChild(this.nodes.main,{attribute:{"data-bx-answer-field":"MESSAGE"}},true),i;if(!e||e.value===""||confirm(BX.message("VVE_ANS_DELETE"))){e=this.nodes.main;this.delete();e.parentNode.removeChild(e);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",[this.getFullId(),this])}};top.BVoteConstructor=window.BVoteConstructor=function(e){this.controller=e.controller;this.questions=new t({maxCount:e["maxQ"]});this.nodes={questionList:BX.findChild(this.controller,{attribute:{"data-bx-role":"question-list"}},true),action:BX.findChild(this.controller,{attribute:{"data-bx-action":"addq"}},true)};this.toggleAddNode=this.toggleAddNode.bind(this);this.visibleId=0;this.maxAnswersCount=e["maxA"];this.init(e)};window.BVoteConstructor.prototype.init=function(){var t=BX.findChild(this.controller,{tagName:"LI",attribute:{"data-bx-role":"question"}},true,true),e,s;for(e=0;e<t.length;e++){s=new i(t[e],{eventObject:this,maxAnswersCount:this.maxAnswersCount});this.questions.set(s.getId(),s)}this.toggleAddNode();BX.addCustomEvent(this,"onQuestionHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this,"onQuestionHasBeenDeleted",this.toggleAddNode);BX.bind(this.nodes.action,"click",this.addq.bind(this))};window.BVoteConstructor.prototype.toggleAddNode=function(){if(this.questions.canAdd()){BX.show(this.nodes.action)}else{BX.hide(this.nodes.action)}};window.BVoteConstructor.prototype.addq=function(t){BX.PreventDefault(t);if(this.questions.canAdd()){var e=BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,0).replace(/#A_PH#/gi,1).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"10").replace(/#A_VALUE#/gi,"")+BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,1).replace(/#A_PH#/gi,2).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"20").replace(/#A_VALUE#/gi,"");e=BX.create("DIV",{html:BX.message("VOTE_TEMPLATE_QUESTION").replace(/#ANSWERS#/gi,e).replace(/#Q#/gi,this.questions.getNextId()).replace(/#Q_C_SORT#/gi,this.questions.getMaxSort()+10).replace(/#Q_PH#/gi,++this.visibleId).replace(/#Q_VALUE#/gi,"").replace(/#Q_MULTY#/gi,"")});var s=new i(e.firstChild,{eventObject:this,maxAnswersCount:this.maxAnswersCount});s.visibleId=2;this.questions.set(s.getId(),s);this.nodes.questionList.appendChild(e.firstChild);BX.onCustomEvent(this,"onQuestionHasBeenAdded",[s.getFullId(),s])}}})();
//# sourceMappingURL=script.map.js