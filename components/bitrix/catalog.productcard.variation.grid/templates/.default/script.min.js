(function(e,t,i,r,a,n){"use strict";var o,d,s,l,u,c,p,g,h,v,f,m;function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function b(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var E="template_0";var T=function(){function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"grid",null);babelHelpers.defineProperty(this,"isNew",false);babelHelpers.defineProperty(this,"propertiesWithMenu",[]);this.createPropertyId=i.createPropertyId;this.createPropertyHintId=i.createPropertyHintId;this.gridId=i.gridId;this.isNew=i.isNew;this.hiddenProperties=i.hiddenProperties;this.modifyPropertyLink=i.modifyPropertyLink;this.gridEditData=i.gridEditData;this.canHaveSku=i.canHaveSku||false;this.storeAmount=i.storeAmount;this.isShowedStoreReserve=i.isShowedStoreReserve;this.reservedDealsSliderLink=i.reservedDealsSliderLink;if(i.copyItemsMap){this.getGrid().arParams.COPY_ITEMS_MAP=i.copyItemsMap}var r=i.isGridReload||false;if(!r){this.addCustomClassToGrid();this.bindCreateNewVariation();this.bindCreateSkuProperty();this.clearGridSettingsPopupStuff()}var a=i.gridEditData||null;if(a){this.setGridEditData(a)}if(this.isNew){this.enableEdit();this.prepareNewNodes();this.getGrid().updateCounterSelected();this.getGrid().disableCheckAllCheckboxes()}else{this.bindInlineEdit();this.bindPopupInitToQuantityNodes();this.bindSliderToReservedQuantityNodes()}t.Event.bind(this.getGrid().getScrollContainer(),"scroll",t.Runtime.throttle(this.onScrollHandler.bind(this),50));t.Event.bind(this.getGridSettingsButton(),"click",this.showGridSettingsWindowHandler.bind(this));this.subscribeCustomEvents()}babelHelpers.createClass(e,[{key:"subscribeCustomEvents",value:function e(){this.onGridUpdatedHandler=this.onGridUpdated.bind(this);i.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler);this.onPropertySaveHandler=this.onPropertySave.bind(this);i.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.onPropertySaveHandler);this.onAllRowsSelectHandler=this.enableEdit.bind(this);i.EventEmitter.subscribe("Grid::allRowsSelected",this.onAllRowsSelectHandler);this.onAllRowsUnselectHandler=this.disableEdit.bind(this);i.EventEmitter.subscribe("Grid::allRowsUnselected",this.onAllRowsUnselectHandler);this.showPropertySettingsSliderHandler=this.showPropertySettingsSlider.bind(this);i.EventEmitter.subscribe("VariationGrid::propertyModify",this.showPropertySettingsSliderHandler);this.onPrepareDropDownItemsHandler=this.onPrepareDropDownItems.bind(this);i.EventEmitter.subscribe("Dropdown::onPrepareItems",this.onPrepareDropDownItemsHandler);this.onCreatePopupHandler=this.onCreatePopup.bind(this);i.EventEmitter.subscribe("UiSelect::onCreatePopup",this.onCreatePopupHandler)}},{key:"destroy",value:function e(){this.unsubscribeCustomEvents();this.destroyStoreAmountPopups()}},{key:"unsubscribeCustomEvents",value:function e(){if(this.onGridUpdatedHandler){i.EventEmitter.unsubscribe("Grid::updated",this.onGridUpdatedHandler);this.onGridUpdatedHandler=null}if(this.onPropertySaveHandler){i.EventEmitter.unsubscribe("SidePanel.Slider:onMessage",this.onPropertySaveHandler);this.onPropertySaveHandler=null}if(this.showPropertySettingsSliderHandler){i.EventEmitter.unsubscribe("VariationGrid::propertyModify",this.showPropertySettingsSliderHandler);this.showPropertySettingsSliderHandler=null}if(this.onPrepareDropDownItemsHandler){i.EventEmitter.unsubscribe("Dropdown::onPrepareItems",this.onPrepareDropDownItemsHandler);this.onPrepareDropDownItemsHandler=null}if(this.onAllRowsSelectHandler){i.EventEmitter.unsubscribe("Grid::allRowsSelected",this.onAllRowsSelectHandler);this.onAllRowsSelectHandler=null}if(this.onAllRowsUnselectHandler){i.EventEmitter.unsubscribe("Grid::allRowsUnselected",this.onAllRowsUnselectHandler);this.onAllRowsUnselectHandler=null}if(this.onCreatePopupHandler){i.EventEmitter.unsubscribe("UiSelect::onCreatePopup",this.onCreatePopupHandler);this.onCreatePopupHandler=null}}},{key:"getGridSettingsButton",value:function e(){return this.getGrid().getContainer().querySelector("."+this.getGrid().settings.get("classSettingsButton"))}},{key:"showGridSettingsWindowHandler",value:function e(t){var i=this;t.preventDefault();t.stopPropagation();this.askToLossGridData((function(){i.getGrid().getSettingsWindow()._onSettingsButtonClick()}))}},{key:"onScrollHandler",value:function e(t){var i=r.PopupManager.getCurrentPopup();if(i){i.close()}this.propertiesWithMenu.forEach((function(e){var t=r.MenuManager.getMenuById(e+"_menu");if(t){t.close()}}))}},{key:"onPrepareDropDownItems",value:function e(i){var r=i.getData(),a=babelHelpers.slicedToArray(r,3),n=a[0],o=a[1],d=a[2];if(!t.Type.isStringFilled(n)){return}this.propertiesWithMenu.push(n);if(n.indexOf("SKU_GRID_PROPERTY_")===-1){return}if(!t.Type.isArray(d)){return}var s=d.filter((function(e){return e.action==="create-new"}));if(s.length>0){return}var l=n.replace("SKU_GRID_PROPERTY_","").replace("_control","");d.push({action:"create-new",html:'\n\t\t\t\t<li data-role="createItem" class="catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new">\n\t\t\t\t\t<label class="catalog-productcard-popup-select-label main-dropdown-item" data-pseudo="true">\n\t\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t\t'.concat(t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"),"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</li>"),onclick:function e(){return BX.Catalog.VariationGrid.firePropertyModification(l,o)}});requestAnimationFrame((function(){var e=document.getElementById("menu-popup-"+o);t.Dom.addClass(e,"catalog-productcard-popup-list")}))}},{key:"onCreatePopup",value:function e(i){var r;var a=i.getData(),n=babelHelpers.slicedToArray(a,1),d=n[0];var s=d===null||d===void 0?void 0:(r=d.bindElement)===null||r===void 0?void 0:r.id;if(!t.Type.isStringFilled(s)){return}if(s.indexOf("SKU_GRID_PROPERTY_")===-1){return}var l=s.replace("SKU_GRID_PROPERTY_","").replace("_control","");var u=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="catalog-productcard-popup-select-item catalog-productcard-popup-multi-select-item-new">\n\t\t\t\t<label \n\t\t\t\t\tclass="catalog-productcard-popup-select-label main-dropdown-item">\n\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"));t.Event.bind(u,"mousedown",BX.Catalog.VariationGrid.firePropertyModification.bind(this,l));d.contentContainer.appendChild(u)}},{key:"clearGridSettingsPopupStuff",value:function e(){t.Dom.remove(document.getElementById(this.gridId+"-grid-settings-window"))}},{key:"bindCreateNewVariation",value:function e(){if(!this.canHaveSku){return}var i=document.querySelector('[data-role="catalog-productcard-variation-add-row"]');if(t.Type.isDomNode(i)){t.Event.bind(i,"click",this.addRowToGrid.bind(this))}}},{key:"addCustomClassToGrid",value:function e(){t.Dom.addClass(this.getGrid().getContainer(),"catalog-product-variation-grid")}},{key:"getGrid",value:function e(){if(this.grid===null){if(!t.Reflection.getClass("BX.Main.gridManager.getInstanceById")){throw Error("Cannot find grid with '".concat(this.gridId,"' id."))}this.grid=BX.Main.gridManager.getInstanceById(this.gridId)}return this.grid}},{key:"bindPopupInitToQuantityNodes",value:function e(){var i=this;var r=this.getGrid().getRows().getRows();r.forEach((function(e){if(e.isBodyChild()&&!e.isTemplate()){var r=e.getNode().querySelector(".main-grid-cell-content-catalog-quantity-inventory-management");if(t.Type.isDomNode(r)){t.Event.bind(r,"click",i.openStoreAmountPopup.bind(i,e.getId(),r))}}}))}},{key:"bindSliderToReservedQuantityNodes",value:function e(){var i=this;var r=this.getGrid().getRows().getRows();r.forEach((function(e){if(e.isBodyChild()&&!e.isTemplate()){var r=e.getNode().querySelector(".main-grid-cell-content-catalog-reserved-quantity");if(t.Type.isDomNode(r)){t.Event.bind(r,"click",i.openDealsWithReservedProductSlider.bind(i,e.getId()))}}}))}},{key:"openStoreAmountPopup",value:function e(t,i){var a=t+"-store-amount";var n=r.PopupManager.getPopupById(a);if(!n){n=new r.Popup(a,i,{autoHide:true,draggable:false,offsetLeft:-218,offsetTop:0,angle:{position:"top",offset:250},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.getStoreAmountPopupContent(t)})}n.show()}},{key:"openDealsWithReservedProductSlider",value:function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.reservedDealsSliderLink){return}var a=new t.Uri(this.reservedDealsSliderLink);a.setQueryParam("productId",i);if(r>0){a.setQueryParam("storeId",r)}BX.SidePanel.Instance.open(a.toString(),{allowChangeHistory:false,cacheable:false})}},{key:"getStoreAmountPopupContent",value:function e(i){var r=this.storeAmount[i];var a=r.storesCount;if(!t.Type.isObject(r)||a<=0){return t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="store-amount-popup-container">\n\t\t\t\t\t<p class="store-amount-popup-not-found-message">',"</p>\n\t\t\t\t</div>\n\t\t\t"])),t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_EMPTY"))}var n=r.stores;var o=r.linkToDetails;return t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="store-amount-popup-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.getStoreAmountTable(n,i),o?this.getOpenStoreAmountDetailsSliderLabel(o,a):"")}},{key:"getStoreAmountTable",value:function e(i,r){var a=this;var n=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<table class="main-grid-table"></table>'])));var o=n.createTHead();o.className="main-grid-header";var d=o.insertRow();d.className="main-grid-row-head";this.addCellToTable(d,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_STORE"),true,"left");this.addCellToTable(d,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_QUANTITY_COMMON1"),true);if(this.isShowedStoreReserve){this.addCellToTable(d,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_QUANTITY_RESERVED"),true);this.addCellToTable(d,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_QUANTITY_AVAILABLE"),true)}var s=n.createTBody();i.forEach((function(e){var i=s.insertRow();i.className="main-grid-row main-grid-row-body";a.addCellToTable(i,e.title,false,"left");a.addCellToTable(i,e.quantityCommon,false);if(a.isShowedStoreReserve){var n=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<a class="main-grid-cell-content-catalog-reserved-quantity">',"</a>"])),e.quantityReserved);t.Event.bind(n,"click",a.openDealsWithReservedProductSlider.bind(a,r,e.storeId));a.addCellToTable(i,n,false);a.addCellToTable(i,e.quantityAvailable,false)}}));return n}},{key:"addCellToTable",value:function e(i,r,a){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"right";var o=a?"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-":"main-grid-cell main-grid-cell-";var d=a?"main-grid-cell-head-container":"main-grid-cell-content";var s=i.insertCell();s.className=o+n;s.appendChild(t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="main-grid-cell-inner">\n\t\t\t\t<span class="','">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"])),d,r))}},{key:"getOpenStoreAmountDetailsSliderLabel",value:function e(i,r){var a=t.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="ui-link ui-link-secondary ui-link-dashed ui-link-open-store-amount-slider">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_OPEN_SLIDER_BUTTON",{"#STORE_COUNT#":r}));t.Event.bind(a,"click",this.openStoreAmountSlider.bind(this,i));return a}},{key:"openStoreAmountSlider",value:function e(t){BX.SidePanel.Instance.open(t,{width:700,allowChangeHistory:false,cacheable:false})}},{key:"destroyStoreAmountPopups",value:function e(){var t=this.getGrid().getRows().getRows();t.forEach((function(e){if(e.isBodyChild()&&!e.isTemplate()){var t;var i=e.getId()+"-store-amount";var a=r.PopupManager.getPopupById(i);a===null||a===void 0?void 0:(t=a.destroy)===null||t===void 0?void 0:t.call(a)}}))}},{key:"emitEditedRowsEvent",value:function e(){if(this.getGrid().getRows().isSelected()){i.EventEmitter.emit("Grid::thereEditedRows",[])}else{i.EventEmitter.emit("Grid::noEditedRows",[])}}},{key:"disableEdit",value:function e(){if(this.isNew){return}this.getGrid().getRows().getRows().forEach((function(e){if(!t.Dom.hasClass(e.getNode(),"main-grid-row-new")){e.editCancel();e.unselect()}}));this.emitEditedRowsEvent()}},{key:"enableEdit",value:function e(){var t=this;this.getGrid().getRows().selectAll();this.getGrid().getRows().editSelected();this.getGrid().getRows().getRows().forEach((function(e){return t.enableBarcodeEditor(e)}))}},{key:"prepareNewNodes",value:function e(){var t=this;this.getGrid().getRows().getBodyChild().map((function(e){var i=e.getNode();t.markNodeAsNew(i);t.addSkuListCreationItem(i);t.modifyCustomSkuProperties(i);t.disableCheckbox(e)}))}},{key:"disableCheckbox",value:function e(i){var r=i.getCheckbox();if(t.Type.isDomNode(r)){r.setAttribute("disabled","disabled")}}},{key:"markNodeAsNew",value:function e(i){t.Dom.addClass(i,"main-grid-row-new")}},{key:"bindInlineEdit",value:function e(){var i=this;this.getGrid().getRows().getBodyChild().forEach((function(e){return t.Event.bind(e.node,"click",(function(t){return i.toggleInlineEdit(e,t)}))}))}},{key:"getEditorInstance",value:function e(){if(t.Reflection.getClass("BX.UI.EntityEditor")){return BX.UI.EntityEditor.getDefault()}return null}},{key:"bindCreateSkuProperty",value:function e(){if(!this.canHaveSku){return}var i=document.getElementById(this.createPropertyId);var r=this.getEditorInstance().getControlByIdRecursive("variation_grid");if(t.Type.isDomNode(i)&&r){r._createChildButton=i;t.Event.bind(i,"click",r.onCreateFieldBtnClick.bind(r))}var a=document.getElementById(this.createPropertyHintId);t.Event.bind(a,"click",this.showHelp.bind(this))}},{key:"showHelp",value:function e(i){if(t.Reflection.getClass("top.BX.Helper")){top.BX.Helper.show("redirect=detail&code=11657102");i.preventDefault()}}},{key:"toggleInlineEdit",value:function e(t,i){var r=false;if(t.isEdit()){if(this.hasClickedOnCheckboxArea(t,i.target)){r=true;this.deactivateInlineEdit(t)}}else{if(i.target.nodeName!=="A"){r=true;this.activateInlineEdit(t)}}if(r){this.emitEditedRowsEvent();this.getGrid().adjustRows();this.getGrid().updateCounterSelected();this.getGrid().updateCounterDisplayed();this.getGrid().adjustCheckAllCheckboxes()}}},{key:"hasClickedOnCheckboxArea",value:function e(i,r){if(!t.Type.isDomNode(r)){return}var a=i.getCells();for(var n in a){if(a.hasOwnProperty(n)&&a[n].contains(i.getCheckbox())&&(a[n]===r||a[n].contains(r))){return true}}return false}},{key:"activateInlineEdit",value:function e(t){t.select();t.edit();this.enableBarcodeEditor(t);this.addSkuListCreationItem(t.getNode())}},{key:"deactivateInlineEdit",value:function e(t){var i=this;t.editCancel();t.unselect();this.getGrid().clickPrevent=true;setTimeout((function(){i.getGrid().clickPrevent=false}),100)}},{key:"enableBarcodeEditor",value:function e(i){var r;var a=(r=i.getCellById("SKU_GRID_BARCODE"))===null||r===void 0?void 0:r.querySelector('[data-role="barcode-selector"]');if(a){var o;a.innerHTML="";var d=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<div style="display: none"></div>'])));t.Dom.append(d,a);var s=(o=i.editData)===null||o===void 0?void 0:o.SKU_GRID_BARCODE_VALUES;var l=[];if(t.Type.isArray(s)){s.forEach((function(e){var i=t.Text.toNumber(e.ID);var r=e.BARCODE;l.push({entityId:"productBarcode",id:i,title:r});var a=t.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));a.name=i;a.value=r;d.appendChild(a)}))}var u=function e(i){if(c){clearTimeout(c)}var r=i.getTarget();var a=r.getTextBoxValue();a.split(" ").forEach((function(e){if(!t.Type.isStringFilled(e)){return}var i=t.Text.getRandom();r.addTag({id:i,title:e,entityId:"productBarcode"});var a=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));a.name=i;a.value=e;d.appendChild(a)}));p()};var c=null;var p=function e(){f.hideCreateButton();f.clearTextBox();f.showAddButton();f.hideTextBox()};var f=new n.TagSelector({placeholder:t.Loc.getMessage("C_PVG_STORE_CREATE_BARCODE_PLACEHOLDER"),addButtonCaption:t.Loc.getMessage("C_PVG_STORE_ADD_NEW_BARCODE"),addButtonCaptionMore:t.Loc.getMessage("C_PVG_STORE_ADD_ONE_MORE_BARCODE"),items:l,events:{onAddButtonClick:function e(t){var i=t.getTarget();i.showCreateButton()},onBeforeTagRemove:function e(i){var r;var a=i.getData();var n=(r=a.tag)===null||r===void 0?void 0:r.id;if(!t.Type.isNil(n)){var o='input[name="'+n+'"]';var s=d.querySelector(o);if(s){s.parentNode.removeChild(s)}}},onCreateButtonClick:u,onEnter:u,onMetaEnter:u,onBlur:function e(){c=setTimeout(p,300)}}});f.renderTo(a)}}},{key:"modifyCustomSkuProperties",value:function e(t){var i="_"+t.getAttribute("data-id");t.querySelectorAll('input[type="radio"]').forEach((function(e){e.id+=i;e.setAttribute("name",e.getAttribute("name")+i)}));t.querySelectorAll("label[data-role]").forEach((function(e){e.setAttribute("for",e.getAttribute("for")+i)}))}},{key:"addSkuListCreationItem",value:function e(i){i.querySelectorAll('[data-role="dropdownContent"] ul').forEach((function(e){if(!e.querySelector('[data-role="createItem"]')){var i=e.getAttribute("data-propertyId");var r=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<li data-role="createItem"\n\t\t\t\t\t\t class="catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new"\n\t\t\t\t\t\t onclick="BX.Catalog.VariationGrid.firePropertyModification(',')">\n\t\t\t\t\t\t<label class="catalog-productcard-popup-select-label">\n\t\t\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>"])),i,t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"));e.appendChild(r)}}))}},{key:"addRowToGrid",value:function e(){var r=this.redefineTemplateEditData();var a=this.getGrid();var n=a.prependRowEditor();this.disableCheckbox(n);var o=n.getNode();a.getRows().reset();if(t.Type.isDomNode(o)){var d=t.Text.getRandom();this.gridEditData[d]=b({},this.gridEditData["template_0"]);o.setAttribute("data-id",d);this.markNodeAsNew(o);this.modifyCustomSkuProperties(o);this.addSkuListCreationItem(o);this.setDeleteButton(o);this.enableBarcodeEditor(n);n.makeCountable()}if(r){this.setOriginalTemplateEditData(r)}i.EventEmitter.emit("Grid::thereEditedRows",[]);a.adjustRows();a.updateCounterDisplayed();a.updateCounterSelected();this.updateCounterTotal()}},{key:"updateCounterTotal",value:function e(){var t=this.getGrid();var i=t.getCounterTotal().querySelector(".main-grid-panel-content-text");i.textContent=t.getRows().getCountDisplayed()}},{key:"setDeleteButton",value:function e(i){var r;var a=i.querySelector(".main-grid-cell-action .main-grid-cell-content");var n=i===null||i===void 0?void 0:(r=i.dataset)===null||r===void 0?void 0:r.id;if(n){var o=t.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="main-grid-delete-button" \n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t'])),this.removeNewRowFromGrid.bind(this,n));t.Dom.append(o,a)}}},{key:"removeNewRowFromGrid",value:function e(i){if(!t.Type.isStringFilled(i)){return}var r=this.getGrid().getRows().getById(i);if(r){t.Dom.remove(r.getNode());this.getGrid().getRows().reset();this.getGrid().updateCounterDisplayed();this.getGrid().updateCounterSelected();this.updateCounterTotal();this.emitEditedRowsEvent()}}},{key:"removeRowFromGrid",value:function e(t){var i={id:t,action:"deleteRow"};this.getGrid().reloadTable("POST",i)}},{key:"getGridEditData",value:function e(){return this.getGrid().arParams.EDITABLE_DATA}},{key:"setGridEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA=t}},{key:"setOriginalTemplateEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA[E]=t}},{key:"redefineTemplateEditData",value:function e(){var t=this.getEditDataFromSelectedValues();if(!t){t=this.getEditDataFromNotSelectedValues()}if(t){t=b({},t);this.prepareNewRowData(t);var i=this.getGridEditData();var r=i[E];var a=this.prepareCustomEditData(r);this.setOriginalTemplateEditData(b(b(b({},r),t),a));return r}return null}},{key:"getEditDataFromSelectedValues",value:function e(){var t=this.getGrid().getRows().getSelected();return t.length?t[0].editGetValues():null}},{key:"getEditDataFromNotSelectedValues",value:function e(){var i=this.getGrid().arParams.EDITABLE_DATA;var r=Object.keys(i).reverse().find((function(e){return e!==E&&t.Type.isPlainObject(i[e])}));return r?i[r]:null}},{key:"prepareNewRowData",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)&&(i.includes("[VIEW_HTML]")||i.includes("[EDIT_HTML]"))){delete t[i]}}t["SKU_GRID_BARCODE"]='<div data-role="barcode-selector"></div>'}},{key:"prepareCustomEditData",value:function e(t){var i={};for(var r in t){if(t.hasOwnProperty(r)&&r.includes("[EDIT_HTML]")){if(t[r].indexOf("new BX.UI.ImageInput")>=0){var a="bx_file_"+r.replace("[EDIT_HTML]","").toLowerCase()+"_";var n=t[r].match(new RegExp("'("+a+"[A-Za-z0-9_]+)'"));if(n[1]){i[r]=t[r].replace(new RegExp(n[1],"g"),a+this.getRandomInt())}}}}return i}},{key:"getRandomInt",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1e5;return Math.floor(Math.random()*Math.floor(t))}},{key:"getHeaderNames",value:function e(){var t=[];var i=this.getGrid().getRows().getHeadFirstChild().getCells();Array.from(i).forEach((function(e){if("name"in e.dataset){t.push(e.dataset.name)}}));return t}},{key:"addPropertyToGridHeader",value:function e(t){var i=this;BX.ajax.runComponentAction("bitrix:catalog.productcard.variation.grid","addPropertyHeader",{mode:"ajax",data:{gridId:this.getGrid().getId(),propertyCode:t.id,anchor:t.anchor||null,currentHeaders:this.getHeaderNames()}}).then((function(e){i.reloadGrid()}))}},{key:"reloadGrid",value:function e(){this.getGrid().reload()}},{key:"onGridUpdated",value:function e(t){var i=this;this.getGrid().getSettingsWindow().getItems().forEach((function(e){if(i.getHeaderNames().indexOf(e.node.dataset.name)!==-1){e.state.selected=true;e.checkbox.checked=true}else{e.state.selected=false;e.checkbox.checked=false}}))}},{key:"onPropertySave",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,1),a=r[0];if(a.getEventId()==="PropertyCreationForm:onAdd"){var n=a.getData();this.addPropertyToGridHeader({id:n.fields.CODE})}if(a.getEventId()==="PropertyCreationForm:onModify"){this.reloadGrid()}}},{key:"showPropertySettingsSlider",value:function e(t){var i=t.getData(),r=babelHelpers.slicedToArray(i,1),a=r[0];var n=this.modifyPropertyLink.replace("#PROPERTY_ID#",a);this.askToLossGridData((function(){BX.SidePanel.Instance.open(n,{width:550,allowChangeHistory:false,cacheable:false})}))}},{key:"askToLossGridData",value:function e(i,r,n){if(this.isGridInEditMode()){var o={title:t.Loc.getMessage("C_PVG_UNSAVED_DATA_TITLE"),message:t.Loc.getMessage("C_PVG_UNSAVED_DATA_MESSAGE"),modal:true,buttons:a.MessageBoxButtons.OK_CANCEL,okCaption:t.Loc.getMessage("C_PVG_UNSAVED_DATA_CONTINUE"),onOk:function e(t){i&&i();t.close()},onCancel:function e(t){r&&r();t.close()}};a.MessageBox.show(b(b({},o),n))}else{i&&i()}}},{key:"isGridInEditMode",value:function e(){return this.getGrid().getRows().getBodyChild().filter((function(e){return e.isShown()&&e.isEdit()})).length>0}}],[{key:"firePropertyModification",value:function e(t,a){if(a){var n=r.MenuManager.getMenuById(a);if(n){n.close();n.destroy()}}else{var o=r.PopupManager.getCurrentPopup();if(o){o.close()}}i.EventEmitter.emit("VariationGrid::propertyModify",[t])}}]);return e}();t.Reflection.namespace("BX.Catalog").VariationGrid=T})(this.window=this.window||{},BX,BX.Event,BX.Main,BX.UI.Dialogs,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js