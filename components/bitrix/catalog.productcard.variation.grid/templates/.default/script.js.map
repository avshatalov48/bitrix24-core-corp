{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type, Uri} from 'main.core';\nimport {typeof BaseEvent, EventEmitter} from 'main.core.events';\nimport {MenuManager, Popup, PopupManager} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {TagSelector} from \"ui.entity-selector\";\nimport 'ui.buttons';\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\n\nclass VariationGrid\n{\n\tgrid = null;\n\tisNew = false;\n\tpropertiesWithMenu = []\n\n\tconstructor(settings = {})\n\t{\n\t\tthis.createPropertyId = settings.createPropertyId;\n\t\tthis.createPropertyHintId = settings.createPropertyHintId;\n\t\tthis.gridId = settings.gridId;\n\t\tthis.isNew = settings.isNew;\n\t\tthis.isReadOnly = settings.isReadOnly;\n\t\tthis.isSimple = settings.isSimple;\n\t\tthis.hiddenProperties = settings.hiddenProperties;\n\t\tthis.modifyPropertyLink = settings.modifyPropertyLink;\n\t\tthis.productCopyLink = settings.productCopyLink;\n\t\tthis.gridEditData = settings.gridEditData;\n\t\tthis.canHaveSku = settings.canHaveSku || false;\n\t\tthis.storeAmount = settings.storeAmount;\n\t\tthis.isShowedStoreReserve = settings.isShowedStoreReserve;\n\t\tthis.reservedDealsSliderLink = settings.reservedDealsSliderLink;\n\t\tif (settings.copyItemsMap)\n\t\t{\n\t\t\tthis.getGrid().arParams.COPY_ITEMS_MAP = settings.copyItemsMap;\n\t\t}\n\n\t\tif (!this.isNew)\n\t\t{\n\t\t\tthis.bindPopupInitToQuantityNodes();\n\t\t\tthis.bindSliderToReservedQuantityNodes();\n\t\t}\n\n\t\tif (this.isReadOnly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isGridReload = settings.isGridReload || false;\n\t\tif (!isGridReload)\n\t\t{\n\t\t\tthis.addCustomClassToGrid();\n\t\t\tthis.bindCreateNewVariation();\n\t\t\tthis.bindCreateSkuProperty();\n\t\t\tthis.clearGridSettingsPopupStuff();\n\t\t}\n\n\t\tconst gridEditData = settings.gridEditData || null;\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\n\t\tif (this.isNew)\n\t\t{\n\t\t\tthis.enableEdit();\n\t\t\tthis.prepareNewNodes();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.getGrid().disableCheckAllCheckboxes();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.bindInlineEdit();\n\t\t}\n\n\t\tEvent.bind(this.getGrid().getScrollContainer(), 'scroll', Runtime.throttle(this.onScrollHandler.bind(this), 50));\n\t\tEvent.bind(this.getGridSettingsButton(), 'click', this.showGridSettingsWindowHandler.bind(this));\n\n\t\tthis.modifyHeaders();\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.onGridUpdatedHandler = this.onGridUpdated.bind(this);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\n\t\tthis.onPropertySaveHandler = this.onPropertySave.bind(this);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\n\t\tthis.onAllRowsSelectHandler = this.enableEdit.bind(this)\n\t\tEventEmitter.subscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\n\t\tthis.onAllRowsUnselectHandler = this.disableEdit.bind(this);\n\t\tEventEmitter.subscribe('Grid::allRowsUnselected', this.onAllRowsUnselectHandler);\n\n\t\tthis.showPropertySettingsSliderHandler = this.showPropertySettingsSlider.bind(this);\n\t\tEventEmitter.subscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\n\t\tthis.onPrepareDropDownItemsHandler = this.onPrepareDropDownItems.bind(this);\n\t\tEventEmitter.subscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\n\t\tthis.onCreatePopupHandler = this.onCreatePopup.bind(this);\n\t\tEventEmitter.subscribe('UiSelect::onCreatePopup', this.onCreatePopupHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tthis.destroyStoreAmountPopups();\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.onGridUpdatedHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\t\tthis.onGridUpdatedHandler = null;\n\t\t}\n\n\t\tif (this.onPropertySaveHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\t\t\tthis.onPropertySaveHandler = null;\n\t\t}\n\n\t\tif (this.showPropertySettingsSliderHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\t\t\tthis.showPropertySettingsSliderHandler = null;\n\t\t}\n\n\t\tif (this.onPrepareDropDownItemsHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\t\t\tthis.onPrepareDropDownItemsHandler = null;\n\t\t}\n\n\t\tif (this.onAllRowsSelectHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\t\t\tthis.onAllRowsSelectHandler = null;\n\t\t}\n\n\t\tif (this.onAllRowsUnselectHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::allRowsUnselected', this.onAllRowsUnselectHandler);\n\t\t\tthis.onAllRowsUnselectHandler = null;\n\t\t}\n\n\t\tif (this.onCreatePopupHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('UiSelect::onCreatePopup', this.onCreatePopupHandler);\n\t\t\tthis.onCreatePopupHandler = null;\n\t\t}\n\t}\n\n\tmodifyHeaders()\n\t{\n\t\tconst headers = this.getGrid().getParam('COLUMNS_ALL');\n\t\tfor (const headerName in headers)\n\t\t{\n\t\t\tconst header = headers[headerName];\n\n\t\t\tif (!header.locked && !Type.isStringFilled(header.headerHint))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst headerCell = this.getGrid().getColumnHeaderCellByName(header.id);\n\t\t\tconst headerTitle = headerCell?.querySelector('.main-grid-head-title');\n\t\t\tif (!headerTitle)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (header.locked)\n\t\t\t{\n\t\t\t\tconst lock = Tag.render`<span class='ui-btn ui-btn-link ui-btn-icon-lock'></span>`;\n\t\t\t\tDom.addClass(headerTitle.parentNode, 'main-grid-cell-head-container--locked');\n\t\t\t\tDom.prepend(lock, headerTitle);\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(header.headerHint))\n\t\t\t{\n\t\t\t\tDom.attr(headerTitle, 'data-hint-no-icon', 'true');\n\t\t\t\tDom.attr(headerTitle, 'data-hint', header.headerHint);\n\t\t\t\tBX.UI.Hint.init(headerCell);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetGridSettingsButton()\n\t{\n\t\treturn this.getGrid().getContainer().querySelector('.' + this.getGrid().settings.get('classSettingsButton'))\n\t}\n\n\tshowGridSettingsWindowHandler(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.askToLossGridData(() => {\n\t\t\tthis.getGrid().getSettingsWindow()._onSettingsButtonClick();\n\t\t});\n\t}\n\n\tonScrollHandler(event)\n\t{\n\t\tconst popup = PopupManager.getCurrentPopup();\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\n\t\tthis.propertiesWithMenu.forEach(propertyId => {\n\t\t\tlet menu = MenuManager.getMenuById(propertyId + '_menu');\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t}\n\t\t})\n\t}\n\n\tonPrepareDropDownItems(event)\n\t{\n\t\tconst [controlId, menuId, items] = event.getData();\n\t\tif (!Type.isStringFilled(controlId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.propertiesWithMenu.push(controlId);\n\n\t\tif (controlId.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isArray(items))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionList = items.filter((item) => {\n\t\t\treturn (item.action === 'create-new');\n\t\t});\n\n\t\tif (actionList.length > 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = controlId.replace('SKU_GRID_PROPERTY_', '').replace('_control', '');\n\n\t\titems.push({\n\t\t\t'action': 'create-new',\n\t\t\t'html': `\n\t\t\t\t<li data-role=\"createItem\" class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\">\n\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label main-dropdown-item\" data-pseudo=\"true\">\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</li>`,\n\t\t\t'onclick': () => BX.Catalog.VariationGrid.firePropertyModification(propertyId, menuId)\n\t\t});\n\n\t\trequestAnimationFrame(function() {\n\t\t\tconst popup = document.getElementById('menu-popup-' + menuId);\n\t\t\tDom.addClass(popup, 'catalog-productcard-popup-list');\n\t\t});\n\t}\n\n\tonCreatePopup(event)\n\t{\n\t\tconst [popup] = event.getData();\n\t\tconst bindElementId = popup?.bindElement?.id;\n\n\t\tif (!Type.isStringFilled(bindElementId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (bindElementId.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = bindElementId.replace('SKU_GRID_PROPERTY_', '').replace('_control', '');\n\n\t\tconst addButton = Tag.render`\n\t\t\t<div class=\"catalog-productcard-popup-select-item catalog-productcard-popup-multi-select-item-new\">\n\t\t\t\t<label \n\t\t\t\t\tclass=\"catalog-productcard-popup-select-label main-dropdown-item\">\n\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(addButton, 'mousedown', BX.Catalog.VariationGrid.firePropertyModification.bind(this, propertyId));\n\n\t\tpopup.contentContainer.appendChild(addButton);\n\t}\n\n\tclearGridSettingsPopupStuff()\n\t{\n\t\tDom.remove(document.getElementById(this.gridId + '-grid-settings-window'));\n\t}\n\n\tbindCreateNewVariation()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addRowButton = document.querySelector('[data-role=\"catalog-productcard-variation-add-row\"]');\n\n\t\tif (!Type.isDomNode(addRowButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSimple)\n\t\t{\n\t\t\tEvent.bind(addRowButton, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.bind(addRowButton, 'click', this.addRowToGrid.bind(this));\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-variation-grid');\n\t}\n\n\t/**\n\t * @returns {BX.Main.grid|null}\n\t */\n\tgetGrid()\n\t{\n\t\tif (this.grid === null)\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${this.gridId}' id.`)\n\t\t\t}\n\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\tbindPopupInitToQuantityNodes()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst quantityNode = row.getNode().querySelector(\n\t\t\t\t\t'.main-grid-cell-content-catalog-quantity-inventory-management'\n\t\t\t\t);\n\t\t\t\tif (Type.isDomNode(quantityNode))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tquantityNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.openStoreAmountPopup.bind(this, row.getId(), quantityNode)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tbindSliderToReservedQuantityNodes()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst reservedQuantityNode = row.getNode().querySelector(\n\t\t\t\t\t'.main-grid-cell-content-catalog-reserved-quantity'\n\t\t\t\t);\n\t\t\t\tif (Type.isDomNode(reservedQuantityNode))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\treservedQuantityNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.openDealsWithReservedProductSlider.bind(this, row.getId())\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic #getSimpleProductRestrictionContent()\n\t{\n\n\t\tconst text = Loc.getMessage(\n\t\t\t'C_PVG_SIMPLE_PRODUCT_POPUP_TEXT',\n\t\t\t{\n\t\t\t\t\t\t'#COPY_BUTTON_NAME#': `<b>${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_COPY')}</b>`,\n\t\t\t\t\t\t'#LINK_INFO#': `<a href=\"\">${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_DOC_LINK_INFO')}</a>`,\n\t\t\t\t}\n\t\t\t);\n\n\t\tconst content = Tag.render`<span>${text}</span>`;\n\t\tEvent.bind(content.querySelector('a'), 'click', (event)=>{\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=16172654\");\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"catalog-simple-popup-wrapper\">\n\t\t\t\t<h3>${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_TITLE')}</h3>\n\t\t\t\t<div class=\"catalog-simple-popup-label-text\">${content}</div>\n\t\t\t\t<div class=\"catalog-simple-popup-link-block\">\n\t\t\t\t\t<a class=\"ui-link ui-link-primary \" target=\"_blank\" href=\"\">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\topenSimpleProductRestrictionPopup(event: Event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst id = 'simple-product-restriction';\n\t\tlet popup = PopupManager.getPopupById(id);\n\n\t\tif (!popup)\n\t\t{\n\t\t\tpopup = new Popup(\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\tzIndexOptions: 4000,\n\t\t\t\t\tautoHide: false,\n\t\t\t\t\tdraggable: true,\n\t\t\t\t\toverlay: true,\n\t\t\t\t\tclassName: \"bxc-popup-window\",\n\t\t\t\t\tcontent: VariationGrid.#getSimpleProductRestrictionContent(),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\t\ttext : Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_COPY'),\n\t\t\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tBX.SidePanel.Instance.open(this.productCopyLink);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\t\ttext : Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_CLOSE'),\n\t\t\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\topenStoreAmountPopup(rowId, quantityNode)\n\t{\n\t\tconst popupId = rowId + '-store-amount';\n\t\tlet popup = PopupManager.getPopupById(popupId);\n\n\t\tif (!popup)\n\t\t{\n\t\t\tpopup = new Popup(\n\t\t\t\tpopupId,\n\t\t\t\tquantityNode,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: -218,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 250},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.getStoreAmountPopupContent(rowId)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\topenDealsWithReservedProductSlider(rowId, storeId = 0)\n\t{\n\t\tif (!this.reservedDealsSliderLink)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sliderLink = new Uri(this.reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', rowId);\n\t\tif (storeId > 0)\n\t\t{\n\t\t\tsliderLink.setQueryParam('storeId', storeId);\n\t\t}\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\tgetStoreAmountPopupContent(rowId)\n\t{\n\t\tconst skuStoreAmountData = this.storeAmount[rowId];\n\t\tconst currentSkusCount = skuStoreAmountData?.storesCount || 0;\n\t\tif (!Type.isObject(skuStoreAmountData) || currentSkusCount <= 0)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"store-amount-popup-container\">\n\t\t\t\t\t<p class=\"store-amount-popup-not-found-message\">${Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_EMPTY')}</p>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst stores = skuStoreAmountData.stores;\n\t\tconst linkToDetails = skuStoreAmountData?.linkToDetails;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"store-amount-popup-container\">\n\t\t\t\t${this.getStoreAmountTable(stores, rowId)}\n\t\t\t\t${linkToDetails ? this.getOpenStoreAmountDetailsSliderLabel(linkToDetails, currentSkusCount) : ''}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStoreAmountTable(stores, rowId)\n\t{\n\t\tconst table = Tag.render`<table class=\"main-grid-table\"></table>`;\n\t\tconst tableHead = table.createTHead();\n\t\ttableHead.className = 'main-grid-header';\n\t\tconst tableHeadRow = tableHead.insertRow();\n\t\ttableHeadRow.className = 'main-grid-row-head';\n\n\t\tthis.addCellToTable(tableHeadRow,\n\t\t\tLoc.getMessage('C_PVG_STORE_AMOUNT_POPUP_STORE'),\n\t\t\ttrue,\n\t\t\t'left',\n\t\t);\n\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_COMMON1'), true);\n\t\tif (this.isShowedStoreReserve)\n\t\t{\n\t\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_RESERVED'), true);\n\t\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_AVAILABLE'), true);\n\t\t}\n\n\t\tconst tableBody = table.createTBody();\n\t\tstores.forEach((store) => {\n\t\t\tconst tableRow = tableBody.insertRow();\n\t\t\ttableRow.className = 'main-grid-row main-grid-row-body';\n\t\t\tthis.addCellToTable(tableRow, store.title, false, 'left');\n\t\t\tthis.addCellToTable(tableRow, store.quantityCommon, false);\n\t\t\tif (this.isShowedStoreReserve)\n\t\t\t{\n\t\t\t\tconst quantityReservedNode = Tag.render`<a class=\"main-grid-cell-content-catalog-reserved-quantity\">${store.quantityReserved}</a>`;\n\t\t\t\tEvent.bind(\n\t\t\t\t\tquantityReservedNode,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.openDealsWithReservedProductSlider.bind(this, rowId, store.storeId)\n\t\t\t\t);\n\t\t\t\tthis.addCellToTable(tableRow, quantityReservedNode, false);\n\t\t\t\tconst quantityAvailable = parseInt(store.quantityAvailable, 10);\n\t\t\t\tconst viewQuantityAvailable =\n\t\t\t\t\tquantityAvailable <= 0\n\t\t\t\t\t\t? `<span class=\"text--danger\">${quantityAvailable}</span>`\n\t\t\t\t\t\t: quantityAvailable\n\t\t\t\t;\n\t\t\t\tthis.addCellToTable(tableRow, viewQuantityAvailable, false);\n\t\t\t}\n\t\t});\n\n\t\treturn table;\n\t}\n\n\taddCellToTable(row, textContent, isHead, horizontalPosition = 'right')\n\t{\n\t\tconst cellClassName =\n\t\t\tisHead\n\t\t\t\t? 'main-grid-cell-head main-grid-col-no-sortable main-grid-cell-'\n\t\t\t\t: 'main-grid-cell main-grid-cell-'\n\t\t;\n\t\tconst innerClassName =\n\t\t\tisHead\n\t\t\t\t? 'main-grid-cell-head-container'\n\t\t\t\t: 'main-grid-cell-content'\n\t\t;\n\t\tconst cell = row.insertCell();\n\t\tcell.className = cellClassName + horizontalPosition;\n\t\tcell.appendChild(Tag.render`\n\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t<span class=\"${innerClassName}\">\n\t\t\t\t\t${textContent}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tgetOpenStoreAmountDetailsSliderLabel(linkToDetails, currentSkusCount)\n\t{\n\t\tconst openSliderLabel = Tag.render`\n\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dashed ui-link-open-store-amount-slider\">\n\t\t\t\t${Loc.getMessage(\n\t\t\t'C_PVG_STORE_AMOUNT_POPUP_OPEN_SLIDER_BUTTON',\n\t\t\t{'#STORE_COUNT#': currentSkusCount}\n\t\t)}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(openSliderLabel, 'click', this.openStoreAmountSlider.bind(this, linkToDetails));\n\n\t\treturn openSliderLabel;\n\t}\n\n\topenStoreAmountSlider(linkToDetails)\n\t{\n\t\tBX.SidePanel.Instance.open(linkToDetails, {\n\t\t\twidth: 700,\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\tdestroyStoreAmountPopups()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst popupId = row.getId() + '-store-amount';\n\t\t\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\t\t\tpopup?.destroy?.();\n\t\t\t}\n\t\t});\n\t}\n\n\temitEditedRowsEvent()\n\t{\n\t\tif (this.getGrid().getRows().isSelected())\n\t\t{\n\t\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit('Grid::noEditedRows', []);\n\t\t}\n\t}\n\n\tdisableEdit()\n\t{\n\t\tif (this.isNew)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getGrid().getRows().getRows().forEach((current) => {\n\t\t\tif (!Dom.hasClass(current.getNode(), 'main-grid-row-new'))\n\t\t\t{\n\t\t\t\tcurrent.editCancel();\n\t\t\t\tcurrent.unselect();\n\t\t\t}\n\t\t});\n\n\t\tthis.emitEditedRowsEvent();\n\t}\n\n\tenableEdit()\n\t{\n\t\tif (this.isReadOnly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getGrid().getRows().selectAll();\n\t\tthis.getGrid().getRows().editSelected();\n\t\tthis.getGrid()\n\t\t\t.getRows()\n\t\t\t.getRows()\n\t\t\t.forEach(item => this.enableBarcodeEditor(item))\n\t\t;\n\t}\n\n\tprepareNewNodes()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().map(row => {\n\t\t\tconst newNode = row.getNode();\n\t\t\tthis.markNodeAsNew(newNode)\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t\tthis.disableCheckbox(row);\n\t\t});\n\t}\n\n\tdisableCheckbox(row)\n\t{\n\t\tconst checkbox = row.getCheckbox();\n\t\tif (Type.isDomNode(checkbox))\n\t\t{\n\t\t\tcheckbox.setAttribute('disabled', 'disabled');\n\t\t}\n\t}\n\n\tmarkNodeAsNew(node)\n\t{\n\t\tDom.addClass(node, 'main-grid-row-new');\n\t}\n\n\tbindInlineEdit()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach(\n\t\t\titem => Event.bind(item.node, 'click', event => this.toggleInlineEdit(item, event))\n\t\t);\n\t}\n\n\t/**\n\t * @returns {BX.UI.EntityEditor|null}\n\t */\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.UI.EntityEditor'))\n\t\t{\n\t\t\treturn BX.UI.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindCreateSkuProperty()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst createPropertyNode = document.getElementById(this.createPropertyId);\n\t\tconst control = this.getEditorInstance().getControlByIdRecursive('variation_grid');\n\n\t\tif (Type.isDomNode(createPropertyNode) && control)\n\t\t{\n\t\t\tcontrol._createChildButton = createPropertyNode;\n\t\t\tEvent.bind(createPropertyNode, 'click', control.onCreateFieldBtnClick.bind(control));\n\t\t}\n\n\t\tconst createPropertyHintNode = document.getElementById(this.createPropertyHintId);\n\t\tEvent.bind(createPropertyHintNode, 'click', this.showHelp.bind(this));\n\t}\n\n\tshowHelp(event)\n\t{\n\t\tif (Reflection.getClass('top.BX.Helper'))\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=11657102');\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t// ToDo auto focus on input under event.point?\n\ttoggleInlineEdit(item: BX.Grid.Row, event)\n\t{\n\t\tlet changed = false;\n\n\t\tif (item.isEdit())\n\t\t{\n\t\t\tif (this.hasClickedOnCheckboxArea(item, event.target))\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.deactivateInlineEdit(item);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (event.target.nodeName !== 'A')\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.activateInlineEdit(item);\n\t\t\t}\n\n\t\t\tif (this.isSimple)\n\t\t\t{\n\t\t\t\titem.getNode()\n\t\t\t\t\t?.querySelectorAll('.main-grid-editor.main-dropdown.main-grid-editor-dropdown')\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\tconst id = item.id;\n\t\t\t\t\t\tif (Type.isNil(id) || id.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tEvent.unbindAll(item);\n\t\t\t\t\t\tEvent.bind(item, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\titem.getNode()\n\t\t\t\t\t?.querySelectorAll('.catalog-productcard-select-container .catalog-productcard-select-block')\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\titem.onclick = null;\n\t\t\t\t\t\tEvent.unbindAll(item);\n\t\t\t\t\t\tEvent.bind(item, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tthis.emitEditedRowsEvent();\n\n\t\t\tthis.getGrid().adjustRows();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.getGrid().updateCounterDisplayed();\n\t\t\tthis.getGrid().adjustCheckAllCheckboxes();\n\t\t}\n\t}\n\n\thasClickedOnCheckboxArea(item: BX.Grid.Row, target)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst cells = item.getCells();\n\n\t\tfor (let i in cells)\n\t\t{\n\t\t\tif (\n\t\t\t\tcells.hasOwnProperty(i)\n\t\t\t\t&& cells[i].contains(item.getCheckbox())\n\t\t\t\t&& (cells[i] === target || cells[i].contains(target))\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.select();\n\t\titem.edit();\n\t\tthis.enableBarcodeEditor(item);\n\n\t\tthis.addSkuListCreationItem(item.getNode());\n\t}\n\n\tdeactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.editCancel();\n\t\titem.unselect();\n\n\t\t// disable multi-selection(and self re-selection) while disabling editing\n\t\tthis.getGrid().clickPrevent = true;\n\t\tsetTimeout(() => {\n\t\t\tthis.getGrid().clickPrevent = false;\n\t\t}, 100);\n\t}\n\n\tenableBarcodeEditor(item: BX.Grid.Row)\n\t{\n\t\tconst barcodeNode =\n\t\t\titem.getCellById('SKU_GRID_BARCODE')\n\t\t\t\t?.querySelector('[data-role=\"barcode-selector\"]')\n\t\t;\n\n\t\tif (barcodeNode)\n\t\t{\n\t\t\tbarcodeNode.innerHTML = '';\n\t\t\tconst inputWrapper = Tag.render`<div style=\"display: none\"></div>`;\n\t\t\tDom.append(inputWrapper, barcodeNode);\n\t\t\tconst barcodes = item.editData?.SKU_GRID_BARCODE_VALUES;\n\n\t\t\tconst items = [];\n\t\t\tif (Type.isArray(barcodes))\n\t\t\t{\n\t\t\t\tbarcodes.forEach((barcode) => {\n\t\t\t\t\tconst id = Text.toNumber(barcode.ID);\n\t\t\t\t\tconst title = barcode.BARCODE;\n\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tentityId: 'productBarcode',\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst input = Tag.render`<input type=\"hidden\">`;\n\t\t\t\t\tinput.name = id;\n\t\t\t\t\tinput.value = title;\n\t\t\t\t\tinputWrapper.appendChild(input);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst createBarcode = (event: BaseEvent) => {\n\t\t\t\tif (blurThrottle)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(blurThrottle);\n\t\t\t\t}\n\n\t\t\t\tconst selector = event.getTarget();\n\t\t\t\tconst value = selector.getTextBoxValue();\n\n\t\t\t\tvalue.split(' ').forEach((title) => {\n\t\t\t\t\tif (!Type.isStringFilled(title))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst id = Text.getRandom();\n\t\t\t\t\tselector.addTag({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tentityId: 'productBarcode',\n\t\t\t\t\t});\n\n\t\t\t\t\tconst input = Tag.render`<input type=\"hidden\">`;\n\t\t\t\t\tinput.name = id;\n\t\t\t\t\tinput.value = title;\n\t\t\t\t\tinputWrapper.appendChild(input);\n\t\t\t\t});\n\n\t\t\t\thideBarcodeInput();\n\t\t\t};\n\n\t\t\tlet blurThrottle = null;\n\t\t\tconst hideBarcodeInput = () => {\n\t\t\t\ttagSelector.hideCreateButton();\n\t\t\t\ttagSelector.clearTextBox();\n\t\t\t\ttagSelector.showAddButton();\n\t\t\t\ttagSelector.hideTextBox();\n\t\t\t};\n\n\t\t\tconst tagSelector = new TagSelector({\n\t\t\t\tplaceholder: Loc.getMessage('C_PVG_STORE_CREATE_BARCODE_PLACEHOLDER'),\n\t\t\t\taddButtonCaption: Loc.getMessage('C_PVG_STORE_ADD_NEW_BARCODE'),\n\t\t\t\taddButtonCaptionMore: Loc.getMessage('C_PVG_STORE_ADD_ONE_MORE_BARCODE'),\n\t\t\t\titems,\n\t\t\t\tevents: {\n\t\t\t\t\tonAddButtonClick: (event: BaseEvent) => {\n\t\t\t\t\t\tconst selector = event.getTarget();\n\t\t\t\t\t\tselector.showCreateButton();\n\t\t\t\t\t},\n\t\t\t\t\tonBeforeTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\t\tconst barcodeId = data.tag?.id;\n\t\t\t\t\t\tif (!Type.isNil(barcodeId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst name = 'input[name=\"' + barcodeId + '\"]';\n\t\t\t\t\t\t\tconst input = inputWrapper.querySelector(name);\n\t\t\t\t\t\t\tif (input)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tinput.parentNode.removeChild(input);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonCreateButtonClick: createBarcode,\n\t\t\t\t\tonEnter: createBarcode,\n\t\t\t\t\tonMetaEnter: createBarcode,\n\t\t\t\t\tonBlur: () => {\n\t\t\t\t\t\tblurThrottle = setTimeout(hideBarcodeInput, 300);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\ttagSelector.renderTo(barcodeNode);\n\t\t}\n\t}\n\n\tmodifyCustomSkuProperties(node)\n\t{\n\t\tconst postfix = '_' + node.getAttribute('data-id');\n\n\t\tnode.querySelectorAll('input[type=\"radio\"]').forEach(input => {\n\t\t\tinput.id += postfix;\n\t\t\tinput.setAttribute('name', input.getAttribute('name') + postfix);\n\t\t});\n\n\t\tnode.querySelectorAll('label[data-role]').forEach(label => {\n\t\t\tlabel.setAttribute('for', label.getAttribute('for') + postfix);\n\t\t});\n\t}\n\n\taddSkuListCreationItem(node)\n\t{\n\t\tnode.querySelectorAll('[data-role=\"dropdownContent\"] ul').forEach((listNode) => {\n\t\t\tif (!listNode.querySelector('[data-role=\"createItem\"]'))\n\t\t\t{\n\t\t\t\tconst propertyId = listNode.getAttribute('data-propertyId');\n\t\t\t\tconst createItem = Tag.render`\n\t\t\t\t\t<li data-role=\"createItem\"\n\t\t\t\t\t\t class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\"\n\t\t\t\t\t\t onclick=\"BX.Catalog.VariationGrid.firePropertyModification(${propertyId})\">\n\t\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label\">\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>`;\n\t\t\t\tlistNode.appendChild(createItem);\n\t\t\t}\n\t\t});\n\t}\n\n\taddRowToGrid()\n\t{\n\t\tconst originalTemplate = this.redefineTemplateEditData();\n\n\t\tconst grid = this.getGrid();\n\t\tconst newRow = grid.prependRowEditor();\n\n\t\tthis.disableCheckbox(newRow);\n\n\t\tconst newNode = newRow.getNode();\n\t\tgrid.getRows().reset();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tconst newRowDataId = Text.getRandom();\n\t\t\tthis.gridEditData[newRowDataId] = {...this.gridEditData['template_0']};\n\t\t\tnewNode.setAttribute('data-id', newRowDataId);\n\t\t\tthis.markNodeAsNew(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tthis.setDeleteButton(newNode);\n\t\t\tthis.enableBarcodeEditor(newRow);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\t\tthis.updateCounterTotal();\n\t}\n\n\tupdateCounterTotal()\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\tcounterTotalTextContainer.textContent = grid.getRows().getCountDisplayed();\n\t}\n\n\tsetDeleteButton(row)\n\t{\n\t\tconst actionCellContentContainer = row.querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tconst rowId = row?.dataset?.id;\n\n\t\tif (rowId)\n\t\t{\n\t\t\tconst deleteButton = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"main-grid-delete-button\" \n\t\t\t\t\tonclick=\"${this.removeNewRowFromGrid.bind(this, rowId)}\"\n\t\t\t\t></span>\n\t\t\t`;\n\n\t\t\tDom.append(deleteButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tremoveNewRowFromGrid(rowId)\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t\tthis.getGrid().updateCounterDisplayed();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.updateCounterTotal();\n\n\t\t\tthis.emitEditedRowsEvent();\n\t\t}\n\t}\n\n\tremoveRowFromGrid(skuId)\n\t{\n\t\tconst data = {\n\t\t\t'id': skuId,\n\t\t\t'action': 'deleteRow'\n\t\t}\n\t\tthis.getGrid().reloadTable('POST', data);\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\t// rewrite edit data because of grid component cuts necessary fields (VIEW_HTML/EDIT_HTML)\n\tsetGridEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\tredefineTemplateEditData()\n\t{\n\t\tlet newRowData = this.getEditDataFromSelectedValues();\n\n\t\tif (!newRowData)\n\t\t{\n\t\t\tnewRowData = this.getEditDataFromNotSelectedValues();\n\t\t}\n\n\t\tif (newRowData)\n\t\t{\n\t\t\tnewRowData = {...newRowData};\n\t\t\tthis.prepareNewRowData(newRowData);\n\n\t\t\tconst data = this.getGridEditData();\n\t\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData);\n\n\t\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...newRowData, ...customEditData})\n\n\t\t\treturn originalTemplateData;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetEditDataFromSelectedValues()\n\t{\n\t\tconst rowNodes = this.getGrid().getRows().getSelected();\n\n\t\treturn rowNodes.length ? rowNodes[0].editGetValues() : null;\n\t}\n\n\tgetEditDataFromNotSelectedValues()\n\t{\n\t\tconst values = this.getGrid().arParams.EDITABLE_DATA;\n\t\tconst id = Object.keys(values)\n\t\t\t.reverse()\n\t\t\t.find(index => index !== GRID_TEMPLATE_ROW && Type.isPlainObject(values[index]))\n\t\t;\n\n\t\treturn id ? values[id] : null;\n\t}\n\n\tprepareNewRowData(newRowData)\n\t{\n\t\tfor (let i in newRowData)\n\t\t{\n\t\t\tif (newRowData.hasOwnProperty(i) && (i.includes('[VIEW_HTML]') || i.includes('[EDIT_HTML]')))\n\t\t\t{\n\t\t\t\tdelete newRowData[i]\n\t\t\t}\n\t\t}\n\t\tnewRowData['SKU_GRID_BARCODE'] = '<div data-role=\"barcode-selector\"></div>';\n\t}\n\n\tprepareCustomEditData(originalEditData)\n\t{\n\t\tconst customEditData = {};\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i) && i.includes('[EDIT_HTML]'))\n\t\t\t{\n\t\t\t\t// modify file input instance ids (due to collisions with default id)\n\t\t\t\tif (originalEditData[i].indexOf('new BX.UI.ImageInput') >= 0)\n\t\t\t\t{\n\t\t\t\t\tconst filePrefix = 'bx_file_' + i.replace('[EDIT_HTML]', '').toLowerCase() + '_';\n\t\t\t\t\tconst matches = originalEditData[i].match(new RegExp('\\'(' + filePrefix + '[A-Za-z0-9_]+)\\''));\n\n\t\t\t\t\tif (matches[1])\n\t\t\t\t\t{\n\t\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\t\tnew RegExp(matches[1], 'g'),\n\t\t\t\t\t\t\tfilePrefix + this.getRandomInt()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tgetRandomInt(max = 100000)\n\t{\n\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t}\n\n\tgetHeaderNames()\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\treturn headers;\n\t}\n\n\taddPropertyToGridHeader(item)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.variation.grid',\n\t\t\t'addPropertyHeader',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tgridId: this.getGrid().getId(),\n\t\t\t\t\tpropertyCode: item.id,\n\t\t\t\t\tanchor: item.anchor || null,\n\t\t\t\t\tcurrentHeaders: this.getHeaderNames()\n\t\t\t\t}\n\t\t\t}\n\t\t).then((response) => {\n\t\t\tthis.reloadGrid();\n\t\t});\n\t}\n\n\treloadGrid()\n\t{\n\t\tthis.getGrid().reload();\n\t}\n\n\tonGridUpdated(event: BaseEvent)\n\t{\n\t\tthis.getGrid().getSettingsWindow().getItems().forEach((column) => {\n\t\t\tif(this.getHeaderNames().indexOf(column.node.dataset.name) !== -1)\n\t\t\t{\n\t\t\t\tcolumn.state.selected = true;\n\t\t\t\tcolumn.checkbox.checked = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcolumn.state.selected = false;\n\t\t\t\tcolumn.checkbox.checked = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tonPropertySave(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onAdd')\n\t\t{\n\t\t\tconst eventArgs = sliderEvent.getData();\n\n\t\t\tthis.addPropertyToGridHeader({\n\t\t\t\tid: eventArgs.fields.CODE\n\t\t\t});\n\t\t}\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onModify')\n\t\t{\n\t\t\tthis.reloadGrid();\n\t\t}\n\t}\n\n\tshowPropertySettingsSlider(event: BaseEvent)\n\t{\n\t\tconst [propertyId] = event.getData();\n\t\tconst link = this.modifyPropertyLink.replace('#PROPERTY_ID#', propertyId);\n\n\t\tthis.askToLossGridData(() => {\n\t\t\tBX.SidePanel.Instance.open(link, {\n\t\t\t\twidth: 550,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false\n\t\t\t});\n\t\t});\n\t}\n\n\taskToLossGridData(okCallback?, cancelCallback?, options?: {})\n\t{\n\t\tif (this.isGridInEditMode())\n\t\t{\n\t\t\tconst defaultOptions = {\n\t\t\t\ttitle: Loc.getMessage('C_PVG_UNSAVED_DATA_TITLE'),\n\t\t\t\tmessage: Loc.getMessage('C_PVG_UNSAVED_DATA_MESSAGE'),\n\t\t\t\tmodal: true,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: Loc.getMessage('C_PVG_UNSAVED_DATA_CONTINUE'),\n\t\t\t\tonOk: messageBox => {\n\t\t\t\t\tokCallback && okCallback();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\tcancelCallback && cancelCallback();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tMessageBox.show({...defaultOptions, ...options});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tokCallback && okCallback();\n\t\t}\n\t}\n\n\tisGridInEditMode()\n\t{\n\t\treturn this.getGrid()\n\t\t\t.getRows()\n\t\t\t.getBodyChild()\n\t\t\t.filter(row => row.isShown() && row.isEdit())\n\t\t\t.length > 0;\n\t}\n\n\tstatic firePropertyModification(propertyId, menuId)\n\t{\n\t\tif (menuId)\n\t\t{\n\t\t\tconst menu = MenuManager.getMenuById(menuId);\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t\tmenu.destroy();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = PopupManager.getCurrentPopup();\n\t\t\tif (popup)\n\t\t\t{\n\t\t\t\tpopup.close();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('VariationGrid::propertyModify', [propertyId]);\n\t}\n}\n\nReflection.namespace('BX.Catalog').VariationGrid = VariationGrid;"],"names":["GRID_TEMPLATE_ROW","VariationGrid","settings","createPropertyId","createPropertyHintId","gridId","isNew","isReadOnly","isSimple","hiddenProperties","modifyPropertyLink","productCopyLink","gridEditData","canHaveSku","storeAmount","isShowedStoreReserve","reservedDealsSliderLink","copyItemsMap","getGrid","arParams","COPY_ITEMS_MAP","bindPopupInitToQuantityNodes","bindSliderToReservedQuantityNodes","isGridReload","addCustomClassToGrid","bindCreateNewVariation","bindCreateSkuProperty","clearGridSettingsPopupStuff","setGridEditData","enableEdit","prepareNewNodes","updateCounterSelected","disableCheckAllCheckboxes","bindInlineEdit","Event","bind","getScrollContainer","Runtime","throttle","onScrollHandler","getGridSettingsButton","showGridSettingsWindowHandler","modifyHeaders","subscribeCustomEvents","onGridUpdatedHandler","onGridUpdated","EventEmitter","subscribe","onPropertySaveHandler","onPropertySave","onAllRowsSelectHandler","onAllRowsUnselectHandler","disableEdit","showPropertySettingsSliderHandler","showPropertySettingsSlider","onPrepareDropDownItemsHandler","onPrepareDropDownItems","onCreatePopupHandler","onCreatePopup","unsubscribeCustomEvents","destroyStoreAmountPopups","unsubscribe","headers","getParam","headerName","header","locked","Type","isStringFilled","headerHint","headerCell","getColumnHeaderCellByName","id","headerTitle","querySelector","lock","Tag","render","Dom","addClass","parentNode","prepend","attr","BX","UI","Hint","init","getContainer","get","event","preventDefault","stopPropagation","askToLossGridData","getSettingsWindow","_onSettingsButtonClick","popup","PopupManager","getCurrentPopup","close","propertiesWithMenu","forEach","propertyId","menu","MenuManager","getMenuById","getData","controlId","menuId","items","push","indexOf","isArray","actionList","filter","item","action","length","replace","Loc","getMessage","Catalog","firePropertyModification","requestAnimationFrame","document","getElementById","bindElementId","bindElement","addButton","contentContainer","appendChild","remove","addRowButton","isDomNode","openSimpleProductRestrictionPopup","addRowToGrid","grid","Reflection","getClass","Error","Main","gridManager","getInstanceById","rows","getRows","row","isBodyChild","isTemplate","quantityNode","getNode","openStoreAmountPopup","getId","reservedQuantityNode","openDealsWithReservedProductSlider","getPopupById","Popup","width","zIndexOptions","autoHide","draggable","overlay","className","content","buttons","Button","text","color","Color","PRIMARY","onclick","SidePanel","Instance","open","LINK","show","rowId","popupId","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","getStoreAmountPopupContent","storeId","sliderLink","Uri","setQueryParam","toString","allowChangeHistory","cacheable","skuStoreAmountData","currentSkusCount","storesCount","isObject","stores","linkToDetails","getStoreAmountTable","getOpenStoreAmountDetailsSliderLabel","table","tableHead","createTHead","tableHeadRow","insertRow","addCellToTable","tableBody","createTBody","store","tableRow","title","quantityCommon","quantityReservedNode","quantityReserved","quantityAvailable","parseInt","viewQuantityAvailable","textContent","isHead","horizontalPosition","cellClassName","innerClassName","cell","insertCell","openSliderLabel","openStoreAmountSlider","destroy","isSelected","emit","current","hasClass","editCancel","unselect","emitEditedRowsEvent","selectAll","editSelected","enableBarcodeEditor","getBodyChild","map","newNode","markNodeAsNew","addSkuListCreationItem","modifyCustomSkuProperties","disableCheckbox","checkbox","getCheckbox","setAttribute","node","toggleInlineEdit","EntityEditor","getDefault","createPropertyNode","control","getEditorInstance","getControlByIdRecursive","_createChildButton","onCreateFieldBtnClick","createPropertyHintNode","showHelp","top","Helper","changed","isEdit","hasClickedOnCheckboxArea","target","deactivateInlineEdit","nodeName","activateInlineEdit","querySelectorAll","isNil","unbindAll","adjustRows","updateCounterDisplayed","adjustCheckAllCheckboxes","cells","getCells","i","hasOwnProperty","contains","select","edit","clickPrevent","setTimeout","barcodeNode","getCellById","innerHTML","inputWrapper","append","barcodes","editData","SKU_GRID_BARCODE_VALUES","barcode","Text","toNumber","ID","BARCODE","entityId","input","name","value","createBarcode","blurThrottle","clearTimeout","selector","getTarget","getTextBoxValue","split","getRandom","addTag","hideBarcodeInput","tagSelector","hideCreateButton","clearTextBox","showAddButton","hideTextBox","TagSelector","placeholder","addButtonCaption","addButtonCaptionMore","events","onAddButtonClick","showCreateButton","onBeforeTagRemove","data","barcodeId","tag","removeChild","onCreateButtonClick","onEnter","onMetaEnter","onBlur","renderTo","postfix","getAttribute","label","listNode","createItem","originalTemplate","redefineTemplateEditData","newRow","prependRowEditor","reset","newRowDataId","setDeleteButton","makeCountable","setOriginalTemplateEditData","updateCounterTotal","counterTotalTextContainer","getCounterTotal","getCountDisplayed","actionCellContentContainer","dataset","deleteButton","removeNewRowFromGrid","gridRow","getById","skuId","reloadTable","EDITABLE_DATA","newRowData","getEditDataFromSelectedValues","getEditDataFromNotSelectedValues","prepareNewRowData","getGridEditData","originalTemplateData","customEditData","prepareCustomEditData","rowNodes","getSelected","editGetValues","values","Object","keys","reverse","find","index","isPlainObject","includes","originalEditData","filePrefix","toLowerCase","matches","match","RegExp","getRandomInt","max","Math","floor","random","getHeadFirstChild","Array","from","ajax","runComponentAction","mode","propertyCode","anchor","currentHeaders","getHeaderNames","then","response","reloadGrid","reload","getItems","column","state","selected","checked","getCompatData","sliderEvent","getEventId","eventArgs","addPropertyToGridHeader","fields","CODE","link","okCallback","cancelCallback","options","isGridInEditMode","defaultOptions","message","modal","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","onCancel","MessageBox","isShown","namespace"],"mappings":"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"}