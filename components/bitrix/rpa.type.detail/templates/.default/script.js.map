{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Text, Type, ajax as Ajax} from 'main.core';\nimport {Component} from 'rpa.component';\nimport {FieldsController} from 'rpa.fieldscontroller';\n\nimport {Field} from 'ui.userfieldfactory';\n\nconst namespace = Reflection.namespace('BX.Rpa');\n\nclass TypeComponent extends Component\n{\n\tsetFieldsController(fieldsController: FieldsController): TypeComponent\n\t{\n\t\tif(fieldsController instanceof FieldsController)\n\t\t{\n\t\t\tthis.fieldsController = fieldsController;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tinit()\n\t{\n\t\tsuper.init();\n\n\t\tif(Type.isPlainObject(this.params.type))\n\t\t{\n\t\t\tthis.addDataToSlider('type', this.params.type);\n\t\t}\n\t}\n\n\tstatic getIconsNode(): ?Element\n\t{\n\t\treturn document.querySelector('[data-role=\"icon-selector\"]');\n\t}\n\n\tstatic getIcons(): ?Array\n\t{\n\t\tconst iconsNode = TypeComponent.getIconsNode();\n\t\tif(!iconsNode)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst nodeList = iconsNode.querySelectorAll('.rpa-automation-options-item');\n\t\tif(nodeList.length > 0)\n\t\t{\n\t\t\treturn Array.from(nodeList);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic onIconClick(icon)\n\t{\n\t\tconst icons = TypeComponent.getIcons();\n\t\tif(!icons)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ticons.forEach((node) =>\n\t\t{\n\t\t\tnode.classList.remove('rpa-automation-options-item-selected');\n\t\t});\n\n\t\ticon.classList.add('rpa-automation-options-item-selected');\n\t}\n\n\tstatic getSelectedIcon(): ?Element\n\t{\n\t\tconst iconsNode = TypeComponent.getIconsNode();\n\t\tif(!iconsNode)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn iconsNode.querySelector('.rpa-automation-options-item-selected');\n\t}\n\n\tprepareData()\n\t{\n\t\tconst data = {\n\t\t\tfields: {},\n\t\t};\n\t\tconst fields = Array.from(this.form.querySelectorAll('[data-type=\"field\"]'));\n\t\tfields.forEach((field) =>\n\t\t{\n\t\t\tif(field.name === 'id')\n\t\t\t{\n\t\t\t\tif(Text.toInteger(field.value) > 0)\n\t\t\t\t{\n\t\t\t\t\tdata.id = field.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdata.fields[field.name] = field.value;\n\t\t\t}\n\t\t});\n\n\t\tdata.fields.permissions = this.getPermissions();\n\n\t\tdata.fields.settings = this.getSettings();\n\n\t\tconst selectedIcon = TypeComponent.getSelectedIcon();\n\t\tif(selectedIcon)\n\t\t{\n\t\t\tdata.fields.image = selectedIcon.dataset.icon;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tgetSettings(): Object\n\t{\n\t\tconst settings = {\n\t\t\tscenarios: [],\n\t\t};\n\n\t\tconst nodes = Array.from(this.form.querySelectorAll('[data-type=\"scenario\"]'));\n\t\tnodes.forEach((node) =>\n\t\t{\n\t\t\tif(node.checked)\n\t\t\t{\n\t\t\t\tsettings.scenarios.push(node.value);\n\t\t\t}\n\t\t});\n\n\t\treturn settings;\n\t}\n\n\tgetPermissionSelectors()\n\t{\n\t\treturn [\n\t\t\t{action: 'ITEMS_CREATE', selector: '[data-role=\"permission-setting-items_create\"]'},\n\t\t\t{action: 'MODIFY', selector: '[data-role=\"permission-setting-modify\"]'},\n\t\t\t{action: 'VIEW', selector: '[data-role=\"permission-setting-view\"]'},\n\t\t];\n\t}\n\n\tafterSave(response)\n\t{\n\t\tsuper.afterSave(response);\n\n\t\tconst exit = () =>\n\t\t{\n\t\t\tif(!this.getSlider())\n\t\t\t{\n\t\t\t\tManager.Instance.openKanban(response.type.id)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst slider = this.getSlider();\n\t\t\t\tif(slider)\n\t\t\t\t{\n\t\t\t\t\tslider.close();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif(this.fieldsController)\n\t\t{\n\t\t\tconst fieldNames = [];\n\t\t\tthis.fieldsController.getFields().forEach((field: Field) =>\n\t\t\t{\n\t\t\t\tfieldNames.push(field.getName());\n\t\t\t});\n\t\t\tAjax.runAction('rpa.fields.setVisibilitySettings', {\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.params.type.typeId,\n\t\t\t\t\tfields: fieldNames,\n\t\t\t\t\tvisibility: 'create',\n\t\t\t\t}\n\t\t\t}).then(exit).catch(exit);\n\t\t}\n\t\telse\n\t\t{\n\t\t\texit();\n\t\t}\n\t}\n\n\tshowErrors(errors)\n\t{\n\t\tsuper.showErrors(errors);\n\t\tthis.errorsContainer.parentNode.style.display = 'block';\n\t}\n\n\thideErrors()\n\t{\n\t\tsuper.hideErrors();\n\t\tthis.errorsContainer.parentNode.style.display = 'none';\n\t}\n}\n\nnamespace.TypeComponent = TypeComponent;"],"names":["namespace","Reflection","TypeComponent","fieldsController","FieldsController","Type","isPlainObject","params","type","addDataToSlider","data","fields","Array","from","form","querySelectorAll","forEach","field","name","Text","toInteger","value","id","permissions","getPermissions","settings","getSettings","selectedIcon","getSelectedIcon","image","dataset","icon","scenarios","nodes","node","checked","push","action","selector","response","exit","getSlider","Manager","Instance","openKanban","slider","close","fieldNames","getFields","getName","Ajax","runAction","typeId","visibility","then","catch","errors","errorsContainer","parentNode","style","display","document","querySelector","iconsNode","getIconsNode","nodeList","length","icons","getIcons","classList","remove","add","Component"],"mappings":"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"}