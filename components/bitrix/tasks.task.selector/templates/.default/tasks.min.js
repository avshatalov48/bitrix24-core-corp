function TasksTask(e,t,a){this.name=e;this.multiple=t;this.arSelected=[];this.useLocalCache=a;this.arTasksData=[];this.ajaxParameters={}}TasksTask.arTasks={};TasksTask.arTasksData={};TasksTask.prototype.addAjaxParameter=function(e,t){if(typeof e!="undefined"&&e.toString().length>0){this.ajaxParameters[e.toString()]=t}};TasksTask.prototype.setSelected=function(){throw new Exception("setSelected is not implemented")};TasksTask.prototype.getSelected=function(){return this.toObject(this.arSelected)};TasksTask.prototype.select=function(e){var t;var a=e.target||e.srcElement;if(e.currentTarget){t=e.currentTarget}else{t=a;while(!BX.hasClass(t,"finder-box-item")){t=t.parentNode}}var s=BX.findChild(t,{tag:"input"});var i=BX.findChild(t,{tag:"DIV",className:"finder-box-item-text"},true);var n,r=null;if(typeof TasksTask.arTasksData[s.value]!="undefined"){n=TasksTask.arTasksData[s.value].sub;r=TasksTask.arTasksData[s.value].position}else if(typeof this.arTasksData[s.value]!="undefined"){n=this.arTasksData[s.value].sub;r=this.arTasksData[s.value].position}var l={id:s.value,name:BX.util.htmlspecialcharsback(i.innerHTML),sub:n,position:r};if(!this.multiple){var c=document.getElementsByName(this.name);for(var o=0;o<c.length;o++){if(c[o].value!=s.value){BX.removeClass(c[o].parentNode,"finder-box-item-selected")}else{BX.addClass(c[o].parentNode,"finder-box-item-selected")}}s.checked=true;BX.addClass(t,"finder-box-item-selected");this.searchInput.value=BX.util.htmlspecialcharsback(i.innerHTML);this.arSelected=[];this.arSelected[s.value]=l}else{c=document.getElementsByName(this.name+"[]");for(o=0;o<c.length;o++){if(c[o].value==s.value){c[o].checked=false;BX.toggleClass(c[o].parentNode,"finder-box-item-selected")}}if(BX.hasClass(s.parentNode,"finder-box-item-selected")){s.checked=true}if(s.checked){var d=BX.findChild(BX(this.name+"_selected_tasks"),{className:"finder-box-selected-items"});if(!BX(this.name+"_task_selected_"+s.value)){var h=BX.create("DIV");h.id=this.name+"_task_selected_"+s.value;h.className="finder-box-selected-item";h.innerHTML='<div class="finder-box-selected-item-icon" onclick="O_'+this.name+".unselect("+s.value+', this);" id="task-unselect-'+s.value+'"></div><a href="'+BX.message("TASKS_PATH_TO_TASK").replace("#task_id#",s.value).replace("#action#","view")+'" target="_blank" class="finder-box-selected-item-text">'+i.innerHTML+"</a>";d.appendChild(h);var u=BX(this.name+"_current_count");u.innerHTML=parseInt(u.innerHTML)+1;this.arSelected[s.value]=l}}else{BX.remove(BX(this.name+"_task_selected_"+s.value));u=BX(this.name+"_current_count");u.innerHTML=parseInt(u.innerHTML)-1;this.arSelected[s.value]=null}}if(this.onSelect){this.onSelect(l)}BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};TasksTask.prototype.toObject=function(e){var t={};for(var a in e){a=parseInt(a);if(typeof a=="number"&&e[a]!==null){t[a]=BX.clone(e[a])}}return t};TasksTask.prototype.unselect=function(e,t){if(!this.arSelected[e]){return}var a=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var s=0;s<a.length;s++){if(a[s].value==e){a[s].checked=false;BX.removeClass(a[s].parentNode,"finder-box-item-selected")}}if(this.multiple){if(!t){t=BX("task-unselect-"+e)}if(t){BX.remove(t.parentNode)}var i=BX(this.name+"_current_count");i.innerHTML=parseInt(i.innerHTML)-1}this.arSelected[e]=null;BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};TasksTask.prototype.setFocus=function(){var e=BX(this.name+"_task_input");if(e){e.focus()}};TasksTask.prototype.search=function(){if(this.searchInput.value.length>1){this.displayTab("search");var e=(typeof this.ajaxUrl!="undefined"?this.ajaxUrl:TasksTask.ajaxUrl)+"&MODE=SEARCH&SEARCH_STRING="+encodeURIComponent(this.searchInput.value)+"&"+BX.ajax.prepareData(this.filter,"FILTER");BX.ajax({url:e,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:this.ajaxParameters,onsuccess:BX.proxy(function(e){this.showResults(e)},this)})}};TasksTask.prototype.showResults=function(e){var t=e;var a=BX(this.name+"_search");var s=a.getElementsByTagName("input");for(var i=0,n=s.length;i<n;i++){if(s[i].checked){BX(this.name+"_last").appendChild(s[i])}}if(a){a.innerHTML="";for(i=0;i<t.length;i++){var r=false;(this.useLocalCache?this:TasksTask).arTasksData[t[i].ID]={id:t[i].ID,name:t[i].TITLE,status:t[i].STATUS};var l=BX.create("input",{props:{className:"tasks-hidden-input"}});if(this.multiple){l.name=this.name+"[]";l.type="checkbox"}else{l.name=this.name;l.type="radio"}s=document.getElementsByName(l.name);var c=0;while(!r&&c<s.length){if(s[c].value==t[i].ID&&s[c].checked){r=true}c++}l.value=t[i].ID;var o="";switch(parseInt(t[i].STATUS)){case-1:o=" task-status-overdue";break;case-2:case 1:o=" task-status-new";break;case 2:o=" task-status-accepted";break;case 3:o=" task-status-in-progress";break;case 4:o=" task-status-waiting";break;case 5:o=" task-status-completed";break;case 6:o=" task-status-delayed";break;case 7:o=" task-status-declined";break;default:break}obTaskRow=BX.create("div",{props:{className:"finder-box-item"+o+(r?" finder-box-item-selected":"")},events:{click:BX.proxy(this.select,this)},children:[l,BX.create("div",{props:{className:"finder-box-item-text"},text:t[i].TITLE}),BX.create("div",{props:{className:"finder-box-item-icon"}})]});a.appendChild(obTaskRow)}}};TasksTask.prototype.displayTab=function(e){BX.removeClass(BX(this.name+"_last"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_search"),"finder-box-tab-content-selected");BX.addClass(BX(this.name+"_"+e),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_tab_last"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_search"),"finder-box-tab-selected");BX.addClass(BX(this.name+"_tab_"+e),"finder-box-tab-selected")};
//# sourceMappingURL=tasks.map.js