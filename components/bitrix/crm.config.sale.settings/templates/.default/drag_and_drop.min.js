var DragManager=new function(){var e={};var t=this;function n(e){if(e==null)return null;if(!e.closest){e.closest=function(e){var t=this;while(t){if(!t.matches){t.matches=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector}if(t.matches(e))return t;else t=t.parentElement}return null}}return e}function a(t){if(t.which!=1)return;var a=n(t.target);if(!a)return;var r=a.closest(".draggable");if(!r)return;if(!r.parentNode.className.match(/\bdraghandle\b/))return;e.elem=r;e.downX=t.pageX;e.downY=t.pageY;return false}function r(n){if(!e.elem)return;if(!e.avatar){var a=n.pageX-e.downX;var r=n.pageY-e.downY;if(Math.abs(a)<3&&Math.abs(r)<3){return}e.avatar=l(n);if(!e.avatar){e={};return}var o=getCoords(e.avatar);e.shiftX=e.downX-o.left;e.shiftY=e.downY-o.top;s(n)}e.avatar.style.left=n.pageX-e.shiftX+"px";e.avatar.style.top=n.pageY-e.shiftY+"px";var i=u(n);if(!i)return false;t.onDragMove(e,i,n);return false}function o(t){if(e.avatar){i(t)}e={}}function i(n){var a=f(n),r=u(n);if(!a){t.onDragCancel(e)}else{t.onDragEnd(e,a,r)}}function l(t){var n=e.elem.parentNode;var a={parent:n.parentNode,nextSibling:n.nextSibling,position:n.position||"",left:n.left||"",top:n.top||"",zIndex:n.zIndex||""};n.rollback=function(){a.parent.insertBefore(n,a.nextSibling);n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};n.styleback=function(){n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};return n}function s(t){var n=e.avatar;document.body.appendChild(n);n.style.zIndex=9999;n.style.position="absolute"}function f(t){e.avatar.hidden=true;var a=document.elementFromPoint(t.clientX,t.clientY);e.avatar.hidden=false;a=n(a);if(a==null){return null}return a.closest(".droppable")}function u(t){e.avatar.hidden=true;var a=document.elementFromPoint(t.clientX,t.clientY);e.avatar.hidden=false;a=n(a);if(a==null)return null;return a.closest(".draghandle")}document.onmousemove=r;document.onmouseup=o;document.onmousedown=a;this.onDragEnd=function(e,t,n){};this.onDragCancel=function(e){};this.onDragMove=function(e,t,n){}};function getCoords(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}