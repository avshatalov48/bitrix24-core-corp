BX.namespace("BX.Crm");if(typeof BX.Crm.showModalWithStatusAction==="undefined"){BX.Crm.showModalWithStatusAction=function(t,e){if(!t.message){if(t.status=="success"){t.message=BX.message("CRM_JS_STATUS_ACTION_SUCCESS")}else{t.message=BX.message("CRM_JS_STATUS_ACTION_ERROR")+". "+this.getFirstErrorFromResponse(t)}}var s=BX.create("div",{props:{className:"bx-crm-alert"},children:[BX.create("span",{props:{className:"bx-crm-aligner"}}),BX.create("span",{props:{className:"bx-crm-alert-text"},text:t.message}),BX.create("div",{props:{className:"bx-crm-alert-footer"}})]});var i=BX.PopupWindowManager.getCurrentPopup();if(i){i.destroy()}var r=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-crm-status-action"){return}t.close();t.destroy()},3e3);var n=BX.PopupWindowManager.create("bx-crm-status-action",null,{content:s,onPopupClose:function(){this.destroy();clearTimeout(r)},autoHide:true,zIndex:10200,className:"bx-crm-alert-popup"});n.show();BX("bx-crm-status-action").onmouseover=function(t){clearTimeout(r)};BX("bx-crm-status-action").onmouseout=function(t){r=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-crm-status-action"){return}t.close();t.destroy()},3e3)}}}if(typeof BX.Crm.getFirstErrorFromResponse==="undefined"){BX.Crm.getFirstErrorFromResponse=function(t){t=t||{};if(!t.errors)return"";return t.errors.shift().message}}BX.Crm.ProductSectionCrumbsClass=function(){var t=function(t){this.containerId=t.containerId;this.catalogId=t.catalogId||0;this.sectionId=t.catalogId||0;this.crumbs=t.crumbs||[];this.componentId=t.componentId||"";this.collapsedCrumbs=[];this.childrenCrumbs=[];this.showOnlyDeleted=t.showOnlyDeleted||0;this.jsEventsMode=!!t.jsEventsMode;this.container=BX(this.containerId);this.isExternalSectionSelectDisabled=false;this.isSelectSectionEventDisabled=false;this.ajaxUrl="/bitrix/components/bitrix/crm.product.section.crumbs/ajax.php";this.jsEventsManagerId=t.jsEventsManagerId||"";this.jsEventsManager=BX.Crm[this.jsEventsManagerId]||null;this.container.style.opacity=1;this.buildCrumbs(this.sectionId,this.crumbs);if(this.jsEventsMode){this.jsEventsManager.registerEventHandler("CrmProduct_SelectSection",BX.delegate(this.onExternalSectionSelect,this))}};t.prototype={setEvents:function(){BX.bindDelegate(this.container,"click",{tag:"span",className:"icon-arrow"},BX.proxy(this.onClickArrow,this));BX.bind(BX("root_dots_"+this.containerId),"click",BX.proxy(this.onClickDots,this))},unsetEvents:function(){BX.unbindAll(this.container);BX.unbindAll(BX("root_dots_"+this.containerId))},expand:function(t,e,s){var i=t.getAttribute("data-objectId");BX.PopupMenu.show("crm_product_section_crumbs_"+i,e,s[i],{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})},onClickDots:function(t){var e=BX.PopupMenu.getMenuById("crm_product_section_crumbs_0");if(e&&e.popupWindow)BX.PopupMenu.destroy("crm_product_section_crumbs_0");var s=t.srcElement||t.target;BX.PopupMenu.show("crm_product_section_crumbs_0",s,this.collapsedCrumbs,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})},onClickArrow:function(t){var e=t.srcElement||t.target;var s=BX.findParent(e,{className:"bx-crm-interface-product-section-crumbs-item-container"},this.container);var i=s.getAttribute("data-objectId");var r=s.getAttribute("data-isRoot");if(i){var n=BX.PopupMenu.getMenuById("crm_product_section_crumbs_"+i);if(n&&n.popupWindow)BX.PopupMenu.destroy("crm_product_section_crumbs_"+i);this.expand(s,e,this.childrenCrumbs)}},reloadCrumbs:function(t){BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"getCrumbs",componentId:this.componentId,catalogId:this.catalogId,sectionId:t,urlTemplate:"#section_id#",jsEventsMode:this.jsEventsMode?"Y":"N",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e||e.status!="success"){BX.Crm.showModalWithStatusAction(e);return}this.buildCrumbs(t,e["response"])},this)})},onSectionSelect:function(t){if(!this.isSelectSectionEventDisabled&&this.jsEventsMode){this.isExternalSectionSelectDisabled=true;this.jsEventsManager.fireEvent("CrmProduct_SelectSection",[t]);this.reloadCrumbs(t["sectionId"]);this.isExternalSectionSelectDisabled=false}},onExternalSectionSelect:function(t){if(this.isExternalSectionSelectDisabled)return;if(t&&t.hasOwnProperty("sectionId")){this.reloadCrumbs(t.sectionId)}},buildCrumbs:function(t,e){var s=[];var i=[],r=[],n={},o,c;var a,u;this.cleanCrumbs();if(e instanceof Array){s=e.splice(-3,3);for(a=0;a<e.length;a++){n={};n["title"]="";n["text"]=BX.util.htmlspecialchars(e[a]["NAME"]);n["data"]={menuId:"crm_product_section_crumbs_0",sectionId:""+e[a]["ID"]};if(this.jsEventsMode)n["onclick"]=BX.proxy(this.onClickCrumbLink,this);else n["href"]=e[a]["LINK"];i[a]=n}}if(i.length>0){this.container.appendChild(BX.create("SPAN",{attrs:{id:"root_dots_"+this.containerId,className:"bx-crm-interface-product-section-crumbs-item-container-arrow"}}))}for(a=0;a<s.length;a++){if(s[a]["CHILDREN"]instanceof Array){o=s[a]["CHILDREN"];for(u=0;u<o.length;u++){n={};n["title"]="";n["text"]=BX.util.htmlspecialchars(o[u]["NAME"]);n["data"]={menuId:"crm_product_section_crumbs_"+s[a]["ID"],sectionId:o[u]["LINK"]};if(this.jsEventsMode)n["onclick"]=BX.proxy(this.onClickCrumbLink,this);else n["href"]=o[u]["LINK"];if(!r[s[a]["ID"]])r[s[a]["ID"]]=[];r[s[a]["ID"]].push(n)}c=BX.create("SPAN",{attrs:{"class":"bx-crm-interface-product-section-crumbs-item-container","data-isRoot":parseInt(s[a]["ID"])===0?"1":"","data-objectId":BX.util.htmlspecialchars(""+s[a]["ID"]),"data-objectName":BX.util.htmlspecialchars(s[a]["NAME"])}});if(s.length!==a+1){c.appendChild(BX.create("SPAN",{attrs:{className:"popup-control"},children:[BX.create("SPAN",{attrs:{className:"popup-current"},children:[BX.create("SPAN",{attrs:{className:"icon-arrow"}})]})]}))}if(this.jsEventsMode){c.appendChild(BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-link",style:"cursor: pointer;"},events:{click:BX.proxy(this.onClickCrumbLink,this)},children:[BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-current"},html:BX.util.htmlspecialchars(s[a]["NAME"])})]}))}else{c.appendChild(BX.create("A",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-link",style:"cursor: pointer;",href:s[a]["LINK"]},children:[BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-current"},html:BX.util.htmlspecialchars(s[a]["NAME"])})]}))}c.appendChild(BX.create("SPAN",{attrs:{className:"clb"}}));this.container.appendChild(c)}}this.sectionId=t;this.collapsedCrumbs=i;this.childrenCrumbs=r;this.setEvents()},cleanCrumbs:function(){this.unsetEvents();if(BX.type.isDomNode(this.container))BX.cleanNode(this.container)},onClickCrumbLink:function(t,e){if(t&&!e){var s=BX.getEventTarget(t);if(s){var i=BX.findParent(s,{className:"bx-crm-interface-product-section-crumbs-item-container"},this.container);var r=i.getAttribute("data-objectId");var n=i.getAttribute("data-objectName");var o=i.getAttribute("data-isRoot");if(r&&n)this.onSectionSelect({sectionId:r,sectionName:n})}}else if(e&&typeof e==="object"&&e["data"]&&e["data"]["menuId"]&&e["data"]["sectionId"]&&e["text"]){var c=BX.PopupMenu.getMenuById(e["data"]["menuId"]);if(c){if(c&&c.popupWindow)BX.PopupMenu.destroy(e["data"]["menuId"])}this.onSectionSelect({sectionId:e["data"]["sectionId"],sectionName:e["text"]})}}};return t}();
//# sourceMappingURL=script.map.js