BX.namespace("BX.Crm");if(typeof BX.Crm.showModalWithStatusAction==="undefined"){BX.Crm.showModalWithStatusAction=function(t,e){if(!t.message){if(t.status=="success"){t.message=BX.message("CRM_JS_STATUS_ACTION_SUCCESS")}else{t.message=BX.message("CRM_JS_STATUS_ACTION_ERROR")+". "+this.getFirstErrorFromResponse(t)}}var n=BX.create("div",{props:{className:"bx-crm-alert"},children:[BX.create("span",{props:{className:"bx-crm-aligner"}}),BX.create("span",{props:{className:"bx-crm-alert-text"},text:t.message}),BX.create("div",{props:{className:"bx-crm-alert-footer"}})]});var i=BX.PopupWindowManager.getCurrentPopup();if(i){i.destroy()}var s=setTimeout((function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-crm-status-action"){return}t.close();t.destroy()}),3e3);var o=BX.PopupWindowManager.create("bx-crm-status-action",null,{content:n,onPopupClose:function(){this.destroy();clearTimeout(s)},autoHide:true,zIndex:10200,className:"bx-crm-alert-popup"});o.show();BX("bx-crm-status-action").onmouseover=function(t){clearTimeout(s)};BX("bx-crm-status-action").onmouseout=function(t){s=setTimeout((function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-crm-status-action"){return}t.close();t.destroy()}),3e3)}}}if(typeof BX.Crm.getFirstErrorFromResponse==="undefined"){BX.Crm.getFirstErrorFromResponse=function(t){t=t||{};if(!t.errors)return"";return t.errors.shift().message}}BX.Crm.ProductSectionCrumbsClass=function(){var t=function(t){this.containerId=t.containerId;this.catalogId=t.catalogId||0;this.sectionId=t.catalogId||0;this.crumbs=t.crumbs||[];this.componentId=t.componentId||"";this.collapsedCrumbs=[];this.childrenCrumbs=[];this.showOnlyDeleted=t.showOnlyDeleted||0;this.jsEventsMode=!!t.jsEventsMode;this.container=BX(this.containerId);this.node={productSectionLink:null,productSectionLinkInner:null};this.isExternalSectionSelectDisabled=false;this.isSelectSectionEventDisabled=false;this.ajaxUrl="/bitrix/components/bitrix/crm.product.section.crumbs/ajax.php";this.jsEventsManagerId=t.jsEventsManagerId||"";this.jsEventsManager=BX.Crm[this.jsEventsManagerId]||null;this.container.style.opacity=1;this.buildCrumbs(this.sectionId,this.crumbs);if(this.jsEventsMode){this.jsEventsManager.registerEventHandler("CrmProduct_SelectSection",BX.delegate(this.onExternalSectionSelect,this))}};t.prototype={setEvents:function(){BX.bindDelegate(this.container,"click",{tag:"span",className:"icon-arrow"},BX.proxy(this.onClickArrow,this));BX.bind(BX("root_dots_"+this.containerId),"click",BX.proxy(this.onClickDots,this))},unsetEvents:function(){BX.unbindAll(this.container);BX.unbindAll(BX("root_dots_"+this.containerId))},expand:function(t,e,n){var i=t.getAttribute("data-objectId");BX.PopupMenu.show("crm_product_section_crumbs_"+i,e,n[i],{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})},onClickDots:function(t){var e=BX.PopupMenu.getMenuById("crm_product_section_crumbs_0");if(e&&e.popupWindow)BX.PopupMenu.destroy("crm_product_section_crumbs_0");var n=t.srcElement||t.target;BX.PopupMenu.show("crm_product_section_crumbs_0",n,this.collapsedCrumbs,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})},onClickArrow:function(t){var e=t.srcElement||t.target;var n=BX.findParent(e,{className:"bx-crm-interface-product-section-crumbs-item-container"},this.container);var i=n.getAttribute("data-objectId");var s=n.getAttribute("data-isRoot");if(i){var o=BX.PopupMenu.getMenuById("crm_product_section_crumbs_"+i);if(o&&o.popupWindow)BX.PopupMenu.destroy("crm_product_section_crumbs_"+i);this.expand(n,e,this.childrenCrumbs)}},reloadCrumbs:function(t){BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"getCrumbs",componentId:this.componentId,catalogId:this.catalogId,sectionId:t,urlTemplate:"#section_id#",jsEventsMode:this.jsEventsMode?"Y":"N",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate((function(e){if(!e||e.status!="success"){BX.Crm.showModalWithStatusAction(e);return}this.buildCrumbs(t,e["response"])}),this)})},onSectionSelect:function(t){if(!this.isSelectSectionEventDisabled&&this.jsEventsMode){this.isExternalSectionSelectDisabled=true;this.jsEventsManager.fireEvent("CrmProduct_SelectSection",[t]);this.reloadCrumbs(t["sectionId"]);this.isExternalSectionSelectDisabled=false}},onExternalSectionSelect:function(t){if(this.isExternalSectionSelectDisabled)return;if(t&&t.hasOwnProperty("sectionId")){this.reloadCrumbs(t.sectionId)}},buildCrumbs:function(t,e){var n=[];var i=[],s=[],o={},r,c;var a,u;this.cleanCrumbs();if(e instanceof Array){n=e.splice(-3,3);for(a=0;a<e.length;a++){o={};o["title"]="";o["text"]=BX.util.htmlspecialchars(e[a]["NAME"]);o["data"]={menuId:"crm_product_section_crumbs_0",sectionId:""+e[a]["ID"]};if(this.jsEventsMode)o["onclick"]=BX.proxy(this.onClickCrumbLink,this);else o["href"]=e[a]["LINK"];i[a]=o}}if(i.length>0){this.container.appendChild(BX.create("SPAN",{attrs:{id:"root_dots_"+this.containerId,className:"bx-crm-interface-product-section-crumbs-item-container-arrow"}}))}for(a=0;a<n.length;a++){if(n[a]["CHILDREN"]instanceof Array){r=n[a]["CHILDREN"];for(u=0;u<r.length;u++){o={};o["title"]="";o["text"]=BX.util.htmlspecialchars(r[u]["NAME"]);o["data"]={menuId:"crm_product_section_crumbs_"+n[a]["ID"],sectionId:r[u]["LINK"]};if(this.jsEventsMode)o["onclick"]=BX.proxy(this.onClickCrumbLink,this);else o["href"]=r[u]["LINK"];if(!s[n[a]["ID"]])s[n[a]["ID"]]=[];s[n[a]["ID"]].push(o)}c=BX.create("SPAN",{attrs:{class:"bx-crm-interface-product-section-crumbs-item-container","data-isRoot":parseInt(n[a]["ID"])===0?"1":"","data-objectId":BX.util.htmlspecialchars(""+n[a]["ID"]),"data-objectName":BX.util.htmlspecialchars(n[a]["NAME"])}});if(n.length!==a+1){c.appendChild(BX.create("SPAN",{attrs:{className:"popup-control"},children:[BX.create("SPAN",{attrs:{className:"popup-current"},children:[BX.create("SPAN",{attrs:{className:"icon-arrow"}})]})]}))}if(this.jsEventsMode){this.node.productSectionLink=BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-link",style:"cursor: pointer;"},events:{click:BX.proxy(this.onClickCrumbLink,this)},children:[this.node.productSectionLinkInner=BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-current"},html:BX.util.htmlspecialchars(n[a]["NAME"])})]});c.appendChild(this.node.productSectionLink)}else{this.node.productSectionLink=BX.create("A",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-link",style:"cursor: pointer;",href:n[a]["LINK"]},children:[this.node.productSectionLinkInner=BX.create("SPAN",{attrs:{className:"bx-crm-interface-product-section-crumbs-item-current"},html:BX.util.htmlspecialchars(n[a]["NAME"])})]});c.appendChild(this.node.productSectionLink)}c.appendChild(BX.create("SPAN",{attrs:{className:"clb"}}));this.container.appendChild(c);setTimeout(function(){if(this.node.productSectionLinkInner.offsetWidth>this.node.productSectionLink.offsetWidth){let t;let e=this.node.productSectionLink.offsetWidth;let n=250;let i=e/2-n/2+BX.Main.Popup.getOption("angleLeftOffset");let s=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");let o=n/2-s;let r=new BX.PopupWindow(null,this.node.productSectionLink,{content:this.node.productSectionLinkInner.innerText,offsetLeft:i,darkMode:true,minWidth:n,maxWidth:n,angle:{position:"top",offset:o},animation:"fading-slide"});this.node.productSectionLink.addEventListener("mouseenter",(function(){if(t){clearTimeout(t)}r.show()}));this.node.productSectionLink.addEventListener("mouseleave",(function(){t=setTimeout((function(){r.close()}),200)}))}}.bind(this),800)}}this.sectionId=t;this.collapsedCrumbs=i;this.childrenCrumbs=s;this.setEvents()},cleanCrumbs:function(){this.unsetEvents();if(BX.type.isDomNode(this.container))BX.cleanNode(this.container)},onClickCrumbLink:function(t,e){if(t&&!e){var n=BX.getEventTarget(t);if(n){var i=BX.findParent(n,{className:"bx-crm-interface-product-section-crumbs-item-container"},this.container);var s=i.getAttribute("data-objectId");var o=i.getAttribute("data-objectName");var r=i.getAttribute("data-isRoot");if(s&&o)this.onSectionSelect({sectionId:s,sectionName:o})}}else if(e&&typeof e==="object"&&e["data"]&&e["data"]["menuId"]&&e["data"]["sectionId"]&&e["text"]){var c=BX.PopupMenu.getMenuById(e["data"]["menuId"]);if(c){if(c&&c.popupWindow)BX.PopupMenu.destroy(e["data"]["menuId"])}this.onSectionSelect({sectionId:e["data"]["sectionId"],sectionName:e["text"]})}}};return t}();
//# sourceMappingURL=script.map.js