BX.namespace("BX.Crm");BX.Crm.PresetListManagerClass=function(){var e=function(e){var t,s,i;this.settings=e?e:{};this.presetNames=[];if(BX.type.isArray(this.settings["fixedPresetSelectItems"])){s=this.settings["fixedPresetSelectItems"];for(t=0;t<s.length;t++){if(!s[t]["type"]||s[t]["type"]!=="group"){i=s[t]["id"]>0?s[t]["title"]:"";this.presetNames[s[t]["id"]]=i}}}};e.prototype={getMessage:function(e){return typeof this.settings.messages[e]!="undefined"?this.settings.messages[e]:""},addPreset:function(){this.editPreset(0)},editPreset:function(e){e=parseInt(e);if(e<0)e=0;if(this.dlg&&this.dlg.popup)return;this.dlg={popupId:this.settings["id"]+(e===0?"_PresetAdd":"_PresetEdit"),popup:null,elements:{createNew:null,fixedPresetSelectWrapper:null,fixedPresetId:null,name:null,active:null,sort:null},handlers:{fixedPresetSelectChange:null},presetId:e,presetData:{NAME:this.getMessage("defaultName"),ACTIVE:this.getMessage("defaultActive"),SORT:this.getMessage("defaultSort"),COUNTRY_ID:this.getMessage("defaultCountryId")}};if(e>0&&this.settings.presetData[e])this.dlg.presetData=this.settings.presetData[e];this.dlg.popup=new BX.PopupWindow(this.dlg.popupId,null,{overlay:{opacity:10},autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.getMessage(this.dlg.presetId>0?"presetEditDialogTitle":"presetAddDialogTitle"),events:{onPopupShow:function(){},onPopupClose:BX.delegate(function(){if(this.dlg.elements.fixedPresetId){BX.unbind(this.dlg.elements.fixedPresetId,"change",this.dlg.handlers.fixedPresetSelectChange)}this.dlg.popup.destroy()},this),onPopupDestroy:BX.delegate(function(){delete this.dlg},this)},content:this._preparePresetEditDialogContent(),buttons:[new BX.PopupWindowButton({text:this.dlg.presetId===0?this.getMessage("addBtnText"):this.getMessage("editBtnText"),className:"popup-window-button-accept",events:{click:BX.delegate(this._hanlePresetEditDialogSave,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancelBtnText"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this._hanlePresetEditDialogCancel,this)}})]});this.dlg.popup.show();BX.focus(this.dlg.elements.name)},_preparePresetEditDialogTitle:function(){return BX.create("SPAN",{html:BX.util.htmlspecialchars(this.dlg.presetId>0?this.getMessage("presetEditDialogTitle"):this.getMessage("presetAddDialogTitle")),props:{className:"bx-crm-popup-title"}})},_preparePresetEditDialogContent:function(){var e=BX.create("TABLE",{style:{marginLeft:"12px",marginTop:"12px",marginRight:"12px",marginBottom:"12px",width:"470px"},attrs:{cellspacing:"7"}});if(this.dlg.presetId<=0){var t=this.dlg.popupId+"_CREATE_NEW";e.appendChild(BX.create("TR",{children:[BX.create("TD",{attrs:{colspan:"2"},children:[BX.create("TABLE",{attrs:{style:"width: 100%; text-align: center;"},children:[BX.create("TR",{children:[BX.create("TD",{children:[this.dlg.elements.createNew=BX.create("INPUT",{attrs:{id:t+"_1",type:"radio",name:t,value:"Y"},props:{checked:true},events:{click:BX.delegate(this._hanleCreateNewFlagSwitch,this)}}),BX.create("LABEL",{attrs:{"for":t+"_1"},text:this.getMessage("createNewTitle")})]}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{id:t+"_2",type:"radio",name:t,value:"N"},events:{click:BX.delegate(this._hanleCreateNewFlagSwitch,this)}}),BX.create("LABEL",{attrs:{"for":t+"_2"},text:this.getMessage("createSelectedTitle")})]})]})]})]})]}))}if(this.dlg.presetId<=0){this.dlg.elements.fixedPresetSelectWrapper=e.appendChild(BX.create("TR",{attrs:{style:"display: none;"},children:[BX.create("TD",{children:[BX.create("LABEL",{html:this.getMessage("fixedPresetFieldTitle")+":"})]}),BX.create("TD",{children:[this.dlg.elements.fixedPresetId=BX.create("SELECT")]})]}));BX.Crm.rebuildSelect(this.dlg.elements.fixedPresetId,this.settings["fixedPresetSelectItems"],0);this.dlg.handlers.fixedPresetSelectChange=BX.delegate(this._hanleChangePresetSelection,this);BX.bind(this.dlg.elements.fixedPresetId,"change",this.dlg.handlers.fixedPresetSelectChange)}e.appendChild(BX.create("TR",{children:[BX.create("TD",{children:[BX.create("LABEL",{html:'<span class="required">*</span>'+this.getMessage("nameFieldTitle")+":"})]}),BX.create("TD",{children:[this.dlg.elements.name=BX.create("INPUT",{attrs:{"class":"bx-crm-edit-input"},props:{type:"text",value:this.dlg.presetData.NAME}})]})]}));e.appendChild(BX.create("TR",{children:[BX.create("TD",{children:[BX.create("LABEL",{html:this.getMessage("activeFieldTitle")+":"})]}),BX.create("TD",{children:[this.dlg.elements.active=BX.create("INPUT",{props:{type:"checkbox",checked:this.dlg.presetData.ACTIVE==="Y"}})]})]}));e.appendChild(BX.create("TR",{children:[BX.create("TD",{children:[BX.create("LABEL",{html:this.getMessage("sortFieldTitle")+":"})]}),BX.create("TD",{children:[this.dlg.elements.sort=BX.create("INPUT",{attrs:{"class":"bx-crm-edit-input"},props:{type:"text",value:this.dlg.presetData.SORT}})]})]}));return e},_hanlePresetEditDialogSave:function(){var e=BX(this.settings["formId"]);var t=BX.findChild(e,{tag:"input",attr:{name:"action"}});var s=BX.findChild(e,{tag:"input",attr:{name:"ID"}});var i=BX.findChild(e,{tag:"input",attr:{name:"CREATE_NEW"}});var a=BX.findChild(e,{tag:"input",attr:{name:"FIXED_PRESET_ID"}});var l=BX.findChild(e,{tag:"input",attr:{name:"NAME"}});var r=BX.findChild(e,{tag:"input",attr:{name:"ACTIVE"}});var n=BX.findChild(e,{tag:"input",attr:{name:"SORT"}});var d=BX.findChild(e,{tag:"input",attr:{name:"COUNTRY_ID"}});var h=this.dlg.elements.createNew;var p=this.dlg.elements.fixedPresetId;var c=this.dlg.elements.name;var g=this.dlg.elements.active;var o=this.dlg.elements.sort;if(e&&t&&l){var u=c.value;if(!BX.type.isNotEmptyString(u)){alert(this.getMessage("emptyNameError"));return}else if(u.length>255){alert(this.getMessage("longNameError"));return}if(this.dlg.presetId===0){i.value=h.checked?"Y":"N";a.value=p.value;t.value="ADD_PRESET";s.value=0;l.value=u;r.value=g.checked?"Y":"N";n.value=o.value;d.value=this.dlg.presetData.COUNTRY_ID}else{i.value="N";a.value=0;t.value="edit";s.value=this.dlg.presetId;l.value=this.dlg.presetData.NAME=u;r.value=this.dlg.presetData.ACTIVE=g.checked?"Y":"N";n.value=this.dlg.presetData.SORT=o.value;d.value=this.dlg.presetData.COUNTRY_ID}BX.showWait();e.submit()}},_hanlePresetEditDialogCancel:function(){this.dlg.popup.close()},_hanleCreateNewFlagSwitch:function(){if(this.dlg.elements.createNew.checked)this.dlg.elements.fixedPresetSelectWrapper.style.display="none";else this.dlg.elements.fixedPresetSelectWrapper.style.display=""},_hanleChangePresetSelection:function(){var e=parseInt(this.dlg.elements.fixedPresetId.value);if(e<0||isNaN(e))e=0;if(BX.type.isString(this.presetNames[e]))this.dlg.elements.name.value=this.presetNames[e];else this.dlg.elements.name.value=""}};return e}();if(typeof BX.Crm.rebuildSelect==="undefined"){BX.Crm.rebuildSelect=function(e,t,s){var i,a,l,r,n;var d=false;var h,p;var c=null;if(!(s instanceof Array))s=[s];if(e){h=!!e.getAttribute("multiple");while(i=e.lastChild)e.removeChild(i);a=0;for(r=0;r<t.length;r++){p=false;if(t[r]["type"]&&t[r]["type"]==="group"){l=document.createElement("optgroup");l.label=t[r]["title"];p=true}else{l=document.createElement("option");l.value=t[r]["id"];l.innerHTML=BX.util.htmlspecialchars(t[r]["title"])}if(!p&&c)c.appendChild(l);else e.appendChild(l);if(p){c=l}else{if(!d||h){for(n=0;n<s.length;n++){if(t[r]["id"]==s[n]){l.selected=true;if(!d){d=true;e.selectedIndex=a}break}}}a++}}}}}
//# sourceMappingURL=script.map.js