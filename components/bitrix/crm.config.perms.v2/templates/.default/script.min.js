(function(e,t,n,s,i){"use strict";function o(e,t){c(e,t);t.add(e)}function c(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function a(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var r=t.Reflection.namespace("BX.Crm");var l=new WeakSet;var u=new WeakSet;var h=new WeakSet;var d=new WeakSet;var m=new WeakSet;var g=new WeakSet;var f=function(){function e(t){babelHelpers.classCallCheck(this,e);o(this,g);o(this,m);o(this,d);o(this,h);o(this,u);o(this,l);this.AccessRightsOption=t.AccessRightsOption;this.AccessRights=t.AccessRights;this.hasLeftMenu=t.hasLeftMenu;this.menuId=t.menuId}babelHelpers.createClass(e,[{key:"init",value:function e(){this.AccessRights.draw();a(this,h,R).call(this);if(this.hasLeftMenu){a(this,l,v).call(this);a(this,u,p).call(this)}}},{key:"openPermission",value:function e(t){if(this.menuId===t.menuId){return}if(!this.AccessRights.hasUnsavedChanges()){this.redrawAccessRight(t)}else{event.stopImmediatePropagation();a(this,m,A).call(this,t)}}},{key:"redrawAccessRight",value:function e(t){var n=this;var s=new BX.Loader({target:document.getElementById("bx-crm-perms-config-permissions")});this.AccessRights.destroy();s.show();a(this,d,w).call(this,t).then((function(e){var s=e.accessRightsData,o=e.maxVisibleUserGroups,c=e.additionalSaveParams;n.AccessRightsOption.userGroups=s.userGroups;n.AccessRightsOption.accessRights=s.accessRights;n.AccessRightsOption.maxVisibleUserGroups=o;n.AccessRightsOption.additionalSaveParams=c;n.AccessRights=new i.App(n.AccessRightsOption);n.AccessRights.draw();scrollTo({top:0});n.menuId=t.menuId}))["catch"]((function(e){var t,s;console.warn("ui.accessrights.v2: error during redraw",e);a(n,g,C).call(n,(e===null||e===void 0?void 0:(t=e.errors)===null||t===void 0?void 0:(s=t[0])===null||s===void 0?void 0:s.message)||"Something went wrong")}))["finally"]((function(){s.hide()}))}}]);return e}();function v(){var e=document.getElementById("ui-page-slider-content");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-slider-content";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function p(){var e=document.getElementById("left-panel");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-sidebar";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function R(){var e=t.Reflection.getClass("top.BX.Helper");var n=new s.Button({size:s.ButtonSize.MEDIUM,color:s.ButtonColor.LIGHT_BORDER,text:t.Loc.getMessage("CRM_CONFIG_PERMS_HELP"),noCaps:true,onclick:function t(){var n="23240636";e===null||e===void 0?void 0:e.show("redirect=detail&code=".concat(n))}});var i=document.querySelector(".crm-config-perms-v2-header");n.renderTo(i)}function w(e){return new Promise((function(n,s){t.ajax.runComponentAction("bitrix:crm.config.perms.v2","getData",{mode:"class",data:{controllerData:e}}).then((function(e){n(e.data)}))["catch"](s)}))}function A(e){var i=this;var o=n.MessageBox.create({message:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_TITLE"),modal:true,buttons:[new s.SaveButton({size:s.ButtonSize.SMALL,color:s.ButtonColor.PRIMARY,onclick:function t(n){n.setWaiting(true);i.AccessRights.sendActionRequest().then((function(){document.querySelector('[data-menu-id="'.concat(e.menuId,'"]')).click()}))["catch"]()["finally"]((function(){o.close()}))}}),new s.CancelButton({text:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_CANCEL"),size:s.ButtonSize.SMALL,onclick:function e(){o.close()}})]});o.show()}function C(e){BX.UI.Notification.Center.notify({content:e,position:"top-right",autoHideDelay:3e3})}r.ConfigPermsComponent=f})(this.window=this.window||{},BX,BX.UI.Dialogs,BX.UI,BX.UI.AccessRights.V2);
//# sourceMappingURL=script.map.js