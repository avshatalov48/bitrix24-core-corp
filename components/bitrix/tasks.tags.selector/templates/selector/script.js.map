{"version":3,"file":"script.js","sources":["src/legacy.js"],"sourcesContent":["'use strict';\n\nBX.namespace('BX.Tasks');\n\nBX.Tasks.TagsSelector = function(options) {\n\tthis.tagsAreConverting = options.tagsAreConverting;\n\tthis.groupId = (options.groupId || 0);\n\tthis.taskId = (options.taskId || 0);\n\tthis.isScrumTask = (options.isScrumTask === 'Y');\n\tthis.templateId = (options.templateId || 0);\n\tthis.tags = options.tags;\n\tthis.userId = (options.userId || 0);\n\n\tthis.entity = {\n\t\tid: 'task-tag',\n\t};\n\tif (this.taskId)\n\t{\n\t\tthis.entity.options = {\n\t\t\ttaskId: this.taskId,\n\t\t};\n\t\tthis.tags = [];\n\t}\n\n\tif (this.groupId)\n\t{\n\t\tthis.entity.options.groupId = this.groupId;\n\t}\n\n\tthis.bindEvents();\n};\n\nBX.Tasks.TagsSelector.prototype = {\n\tconstructor: BX.Tasks.TagsSelector,\n\n\tshow: function() {\n\t\tthis.getSelector() && this.getSelector().show();\n\t},\n\n\tbindEvents: function()\n\t{\n\t\tvar onPullTagChanged = function()\n\t\t{\n\t\t\tthis.dialog.hide();\n\t\t\tthis.dialog = null;\n\t\t}\n\t\tvar onPullTaskProjectChanged = function(params)\n\t\t{\n\t\t\tthis.dialog = null;\n\t\t\tthis.groupId = 0;\n\t\t\tif (params)\n\t\t\t{\n\t\t\t\tthis.groupId = params.data;\n\t\t\t}\n\t\t}\n\n\t\tBX.addCustomEvent('onProjectChanged', onPullTaskProjectChanged.bind(this));\n\t\tBX.PULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'tasks',\n\t\t\tcommand: 'tag_changed',\n\t\t\tcallback: onPullTagChanged.bind(this),\n\t\t});\n\t},\n\t//widget on task/template detail page\n\tgetSelector: function() {\n\t\tif (!this.dialog)\n\t\t{\n\t\t\tvar statusSuccess = {status: false};\n\n\t\t\tvar showAddButton = function()\n\t\t\t{\n\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasks-selector-task-tag-widget');\n\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = false;\n\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = false;\n\t\t\t}\n\n\t\t\tvar hideAddButton = function()\n\t\t\t{\n\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasks-selector-task-tag-widget');\n\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = true;\n\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = true;\n\t\t\t}\n\n\t\t\tvar onSearch = function(event) {\n\t\t\t\tvar query = event.getData().query;\n\t\t\t\tif (query.trim() !== '')\n\t\t\t\t{\n\t\t\t\t\tshowAddButton();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thideAddButton();\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar showAlert = function(className, error) {\n\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasks-selector-task-tag-widget');\n\n\t\t\t\tif (dialog.getContainer().querySelector(`div.${className}`))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar alert = document.createElement('div');\n\t\t\t\talert.className = className;\n\t\t\t\talert.innerHTML = `\n\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'  \n\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t${error}\n\t\t\t\t\t</span> \n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tdialog.getFooterContainer().before(alert);\n\t\t\t};\n\n\t\t\tvar onTagsLoad = function(event)\n\t\t\t{\n\t\t\t\tvar dialog = event.getTarget();\n\t\t\t\tvar events = ['click', 'keydown'];\n\n\t\t\t\tvar handler = function(event) {\n\t\t\t\t\tif (event.type === 'keydown')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!((event.ctrlKey || event.metaKey) && event.keyCode === 13))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tags = dialog.getSelectedItems().map(function(item) {\n\t\t\t\t\t\treturn item.getTitle();\n\t\t\t\t\t});\n\n\t\t\t\t\tvar newTag = dialog.getTagSelectorQuery();\n\t\t\t\t\tif (newTag.trim() === '')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tBX.ajax.runComponentAction('bitrix:tasks.tags.selector', 'updateTags', {\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttaskId: taskId,\n\t\t\t\t\t\t\ttagIds: tags,\n\t\t\t\t\t\t\tnewTag: newTag,\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(function(response) {\n\t\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatusSuccess.status = true;\n\t\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\t\tid: newTag,\n\t\t\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\t\t\ttitle: newTag,\n\t\t\t\t\t\t\t\tsort: 1,\n\t\t\t\t\t\t\t\tbadges: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttitle: response.data.owner,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tdialog.getTab('all').getRootNode().addItem(item);\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst alertClass = 'tasks-selector-tag-already-exists-alert';\n\t\t\t\t\t\t\tshowAlert(alertClass, response.data.error);\n\t\t\t\t\t\t\tconst removeAlert = function() {\n\t\t\t\t\t\t\t\tconst notification = dialog.getContainer().querySelector(`div.${alertClass}`);\n\t\t\t\t\t\t\t\tnotification && notification.remove();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tsetTimeout(removeAlert, 2000);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tevents.forEach(function(ev) {\n\t\t\t\t\tif (ev === 'click')\n\t\t\t\t\t{\n\t\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new')\n\t\t\t\t\t\t\t.addEventListener(ev, handler);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdialog.getContainer().addEventListener(ev, handler);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvar taskId = this.taskId;\n\t\t\tvar groupId = this.groupId;\n\t\t\tvar templateId = this.templateId;\n\t\t\tif (taskId !== 0)\n\t\t\t{\n\t\t\t\tif (this.tagsAreConverting)\n\t\t\t\t{\n\t\t\t\t\tvar message = new top.BX.UI.Dialogs.MessageBox({\n\t\t\t\t\t\ttitle: BX.message('TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_TITLE'),\n\t\t\t\t\t\tmessage: BX.message('TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_TEXT'),\n\t\t\t\t\t\tbuttons: top.BX.UI.Dialogs.MessageBoxButtons.OK,\n\t\t\t\t\t\tokCaption: BX.message('TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_COME_BACK_LATER'),\n\t\t\t\t\t\tonOk: function(){\n\t\t\t\t\t\t\tmessage.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tmessage.show();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\t\t\tid: 'tasks-selector-task-tag-widget',\n\t\t\t\t\ttargetNode: BX('task-tags-link'),\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 350,\n\t\t\t\t\theight: 400,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tcompactView: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'task-tag',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\t\t\tgroupId: groupId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tselectedItems: this.tags.map(\n\t\t\t\t\t\tfunction(tag) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: BX.util.htmlspecialcharsback(tag),\n\t\t\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\t\t\ttitle: BX.util.htmlspecialcharsback(tag),\n\t\t\t\t\t\t\t\ttabs: 'all',\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t\t},\n\t\t\t\t\tfooter: BX.Tasks.EntitySelector.Footer,\n\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\tgroupId: groupId,\n\t\t\t\t\t},\n\t\t\t\t\tclearUnavailableItems: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onLoad': function(event) {\n\t\t\t\t\t\t\tevent.getTarget().getFooterContainer().style.zIndex = 1;\n\t\t\t\t\t\t\tonTagsLoad(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'Item:onSelect': function(event) {\n\t\t\t\t\t\t\tthis.onTagsChange(event, statusSuccess);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'onSearch': function(event){\n\t\t\t\t\t\t\tonSearch(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'Item:onDeselect': function(event) {\n\t\t\t\t\t\t\tthis.onTagsChange(event, statusSuccess);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (templateId !== 0)\n\t\t\t{\n\t\t\t\tthis.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\t\t\tid: 'tasks-widget-tag-selector-template-detail',\n\t\t\t\t\ttargetNode: BX('task-tags-link'),\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 350,\n\t\t\t\t\theight: 400,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tcompactView: true,\n\t\t\t\t\tcontext: 'TEMPLATE_TAG',\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'template-tag',\n\t\t\t\t\t\t\toptions: {},\n\t\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t},\n\n\t\t\t\t\t],\n\t\t\t\t\tselectedItems: this.tags.map(\n\t\t\t\t\t\tfunction(tag) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: BX.util.htmlspecialcharsback(tag),\n\t\t\t\t\t\t\t\tentityId: 'template-tag',\n\t\t\t\t\t\t\t\ttitle: BX.util.htmlspecialcharsback(tag),\n\t\t\t\t\t\t\t\ttabs: 'all'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: true,\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Search:onItemCreateAsync': function (event) {\n\t\t\t\t\t\t\tconst promise = new BX.Promise();\n\t\t\t\t\t\t\tconst searchQuery = event.getData().searchQuery;\n\t\t\t\t\t\t\tconst dialog = event.getTarget();\n\n\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\t\t\tid: searchQuery.getQuery(),\n\t\t\t\t\t\t\t\t\tentityId: 'template-tag',\n\t\t\t\t\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\t\t\t\t\ttabs: 'all'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpromise.fulfill();\n\t\t\t\t\t\t\t}, 1000);\n\n\t\t\t\t\t\t\treturn promise;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': function (event) {\n\t\t\t\t\t\t\tthis.onTagsChange(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'Item:onDeselect': function (event) {\n\t\t\t\t\t\t\tthis.onTagsChange(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn this.dialog;\n\t},\n\n\tonTagsChange: function(event, statusSuccess) {\n\t\t// to pop up an item\n\t\tconst selectedItem = event.getData().item;\n\t\tselectedItem.setSort(1);\n\t\tthis.dialog.getTab('all').getRootNode().addItem(selectedItem);\n\n\t\tvar selectedItems = this.getSelector().getSelectedItems();\n\t\tvar tagIds = selectedItems.map(\n\t\t\tfunction(item) {\n\t\t\t\treturn item.getTitle();\n\t\t\t},\n\t\t);\n\n\t\tvar tagsString = tagIds.join(', ');\n\t\tthis.updateNode(tagsString);\n\n\t\t// event goes to tasks.task.template to update tags in task's template\n\t\tvar tags = tagIds.map(\n\t\t\tfunction(tag) {\n\t\t\t\treturn { name: tag };\n\t\t\t},\n\t\t);\n\t\tBX.onCustomEvent('onTaskTagSelect', [tags]);\n\t\tif (\n\t\t\ttypeof statusSuccess !== 'undefined'\n\t\t\t&& statusSuccess.status\n\t\t)\n\t\t{\n\t\t\tstatusSuccess.status = false;\n\t\t\tthis.dialog.clearSearch();\n\t\t\tthis.dialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = true;\n\t\t\tthis.dialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.taskId)\n\t\t{\n\t\t\tthis.updateTask(tagIds);\n\t\t}\n\t},\n\n\tupdateNode: function(tagsString) {\n\t\tvar tagLine = BX('task-tags-line');\n\t\tvar tagLink = BX('task-tags-link');\n\n\t\tBX.cleanNode(tagLine);\n\t\tBX.adjust(tagLine, { text: tagsString });\n\n\t\tif (tagsString.length > 0)\n\t\t{\n\t\t\ttagLine.innerHTML += '&nbsp;&nbsp;';\n\t\t\ttagLink.innerHTML = BX.message('TAGS_BUTTON_CHANGE');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttagLink.innerHTML = BX.message('TAGS_BUTTON_ADD');\n\t\t}\n\t},\n\n\tupdateTask: function(tagIds) {\n\t\tBX.ajax.runComponentAction('bitrix:tasks.tags.selector', 'updateTags', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\ttagIds: tagIds,\n\t\t\t},\n\t\t}).catch(function(response) {\n\t\t\tif (response.errors)\n\t\t\t{\n\t\t\t\tBX.Tasks.alert(response.errors);\n\t\t\t}\n\t\t});\n\t},\n};"],"names":["BX","namespace","Tasks","TagsSelector","options","tagsAreConverting","groupId","taskId","isScrumTask","templateId","tags","userId","entity","id","bindEvents","prototype","constructor","show","getSelector","onPullTagChanged","dialog","hide","onPullTaskProjectChanged","params","data","addCustomEvent","bind","PULL","subscribe","type","PullClient","SubscriptionType","Server","moduleId","command","callback","statusSuccess","status","showAddButton","UI","EntitySelector","Dialog","getById","getFooterContainer","querySelector","hidden","hideAddButton","onSearch","event","query","getData","trim","showAlert","className","error","getContainer","alert","document","createElement","innerHTML","before","onTagsLoad","getTarget","events","handler","ctrlKey","metaKey","keyCode","getSelectedItems","map","item","getTitle","newTag","getTagSelectorQuery","ajax","runComponentAction","mode","tagIds","then","response","success","addItem","entityId","title","sort","badges","owner","getTab","getRootNode","select","alertClass","removeAlert","notification","remove","setTimeout","forEach","ev","addEventListener","message","top","Dialogs","MessageBox","buttons","MessageBoxButtons","OK","okCaption","onOk","close","targetNode","enableSearch","width","height","multiple","dropdownMode","compactView","entities","selectedItems","tag","util","htmlspecialcharsback","tabs","searchOptions","allowCreateItem","footer","Footer","footerOptions","clearUnavailableItems","style","zIndex","onTagsChange","context","dynamicLoad","dynamicSearch","promise","Promise","searchQuery","getQuery","fulfill","selectedItem","setSort","tagsString","join","updateNode","name","onCustomEvent","clearSearch","updateTask","tagLine","tagLink","cleanNode","adjust","text","length","errors"],"mappings":"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"}