"use strict";BX.namespace("BX.Tasks");BX.Tasks.TagsSelector=function(t){this.groupId=t.groupId||0;this.taskId=t.taskId||0;this.isScrumTask=t.isScrumTask==="Y";this.templateId=t.templateId||0;this.tags=t.tags;this.entity={id:"task-tag"};if(this.taskId){this.entity.options={taskId:this.taskId};this.tags=[]}if(this.isScrumTask&&this.groupId){this.entity.options.groupId=this.groupId}};BX.Tasks.TagsSelector.prototype={constructor:BX.Tasks.TagsSelector,show:function(){this.getSelector().show()},getSelector:function(){if(!this.dialog){this.dialog=new BX.UI.EntitySelector.Dialog({targetNode:BX("task-tags-link"),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,context:this.isScrumTask?"TASKS_SCRUM_TAG_"+this.groupId:"TASKS_TAG",entities:[this.entity],selectedItems:this.tags.map((function(t){return{id:BX.util.htmlspecialcharsback(t),entityId:"task-tag",title:BX.util.htmlspecialcharsback(t),tabs:"all"}})),searchOptions:{allowCreateItem:true},events:{"Search:onItemCreateAsync":function(t){var e=new BX.Promise;var s=t.getData().searchQuery;var a=t.getTarget();setTimeout((function(){var t=a.addItem({id:s.getQuery(),entityId:"task-tag",title:s.getQuery(),tabs:"all"});if(t){t.select()}e.fulfill()}),1e3);return e},"Item:onSelect":function(){this.onTagsChange()}.bind(this),"Item:onDeselect":function(){this.onTagsChange()}.bind(this)}})}return this.dialog},onTagsChange:function(){var t=this.getSelector().getSelectedItems();var e=t.map((function(t){return t.getId()}));var s=e.join(", ");this.updateNode(s);var a=e.map((function(t){return{name:t}}));BX.onCustomEvent("onTaskTagSelect",[a]);if(this.taskId){this.updateTask(e)}},updateNode:function(t){var e=BX("task-tags-line");var s=BX("task-tags-link");BX.cleanNode(e);BX.adjust(e,{text:t});if(t.length>0){e.innerHTML+="&nbsp;&nbsp;";s.innerHTML=BX.message("TAGS_BUTTON_CHANGE")}else{s.innerHTML=BX.message("TAGS_BUTTON_ADD")}},updateTask:function(t){BX.ajax.runComponentAction("bitrix:tasks.tags.selector","updateTags",{mode:"class",data:{taskId:this.taskId,tagIds:t}}).catch((function(t){if(t.errors){BX.Tasks.alert(t.errors)}}))}};
//# sourceMappingURL=script.map.js