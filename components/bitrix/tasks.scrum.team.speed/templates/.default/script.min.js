this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,t,a){"use strict";var s=function(){function e(t){babelHelpers.classCallCheck(this,e);this.data=t;this.chart=null;this.loader=null}babelHelpers.createClass(e,[{key:"renderTo",value:function e(t){var a=this;setTimeout((function(){return a.create(t)}),300)}},{key:"create",value:function e(t){am4core.useTheme(am4themes_animated);this.chart=am4core.create(t,am4charts.XYChart);this.chart.data=this.data;this.chart.paddingRight=40;this.chart.responsive.enabled=true;this.createAxises();this.createColumn("plan",a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_PLAN_COLUMN"),"#2882b3");this.createColumn("done",a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_DONE_COLUMN"),"#9c1f1f");this.createLegend();if(this.data.length===0){this.showLoader(true)}}},{key:"render",value:function e(t){if(!this.chart){return}this.data=t;this.chart.data=this.data;if(this.data.length>0){this.removeLoader()}else{this.showLoader(true)}}},{key:"createAxises",value:function e(){var t=this.chart.xAxes.push(new am4charts.CategoryAxis);t.dataFields.category="sprintName";t.renderer.grid.template.location=0;t.renderer.labels.template.adapter.add("textOutput",(function(e){return a.Type.isNil(e)?e:e.replace(/ \(.*/,"")}));var s=t.renderer.labels.template;s.wrap=true;s.maxWidth=120;var i=this.chart.yAxes.push(new am4charts.ValueAxis);i.min=0}},{key:"createColumn",value:function e(t,a,s){var i=this.chart.series.push(new am4charts.ColumnSeries);i.dataFields.valueY=t;i.dataFields.categoryX="sprintName";i.name=a;i.stroke=am4core.color(s);i.fill=am4core.color(s);i.columns.template.tooltipText="{name}: [bold]{valueY}[/]";return i}},{key:"createLegend",value:function e(){this.chart.legend=new am4charts.Legend;this.chart.legend.position="bottom";this.chart.legend.paddingBottom=20;this.chart.legend.itemContainers.template.clickable=false}},{key:"showLoader",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.removeLoader();this.loader=this.chart.tooltipContainer.createChild(am4core.Container);this.loader.background.fill=am4core.color("#fff");this.loader.background.fillOpacity=.8;this.loader.width=am4core.percent(100);this.loader.height=am4core.percent(100);if(t){var s=this.loader.createChild(am4core.Label);s.text=a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_NOT_DATA_LABEL");s.align="center";s.valign="middle";s.fontSize=20}}},{key:"removeLoader",value:function e(){if(this.loader!==null){this.loader.dispose()}}}]);return e}();var i;var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.data=t;this.node=null}babelHelpers.createClass(e,[{key:"renderTo",value:function e(t){this.node=this.build();a.Dom.append(this.node,t)}},{key:"render",value:function e(t){if(!a.Type.isUndefined(t)){this.data=t}if(this.node){this.sync(this.build(),this.node)}else{this.node=this.build()}return this.node}},{key:"build",value:function e(){return a.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-team-speed-stats-container">\n\t\t\t\t<div class="tasks-scrum-sprint-team-speed-stats-row">\n\t\t\t\t\t<div>',"</div>\n\t\t\t\t\t<div>",'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-team-speed-stats-row">\n\t\t\t\t\t<div>',"</div>\n\t\t\t\t\t<div>",'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-team-speed-stats-row">\n\t\t\t\t\t<div>',"</div>\n\t\t\t\t\t<div>","</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_STATS_AVERAGE_LABEL"),a.Text.encode(this.data.average),a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_STATS_MAX_LABEL"),a.Text.encode(this.data.maximum),a.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_STATS_MIN_LABEL"),a.Text.encode(this.data.minimum))}},{key:"showLoader",value:function e(){if(this.node){a.Dom.addClass(this.node,"--loader")}}},{key:"sync",value:function e(t,s){if(t.attributes){Array.from(t.attributes).forEach((function(e){if(s.getAttribute(e.name)!==e.value){s.setAttribute(e.name,e.value)}}))}if(t.nodeValue!==s.nodeValue){s.nodeValue=t.nodeValue}var i=t.childNodes;var r=s.childNodes;for(var n=0;n<i.length||n<r.length;n++){var d=i[n];var l=r[n];if(d===undefined&&l!==undefined){s.remove(l)}if(d!==undefined&&l!==undefined&&d.tagName===l.tagName){this.sync(d,l)}if(d!==undefined&&l!==undefined&&d.tagName!==l.tagName){var o=this.createRealNodeByVirtual(d);this.sync(d,o);a.Dom.replace(l,o)}if(d!==undefined&&l===undefined){var h=this.createRealNodeByVirtual(d);this.sync(d,h);a.Dom.append(h,s)}}}},{key:"createRealNodeByVirtual",value:function e(t){if(t.nodeType===Node.TEXT_NODE){return document.createTextNode("")}return document.createElement(t.tagName)}}]);return e}();var n=function(){function e(t){babelHelpers.classCallCheck(this,e);this.filterId=t.filterId;this.signedParameters=t.signedParameters;this.chart=new s(t.chartData);this.stats=new r(t.statsData);this.filterManager=BX.Main.filterManager.getById(this.filterId);this.sidePanelManager=BX.SidePanel.Instance;this.bindEvents()}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){t.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"renderTo",value:function e(t,a){this.chart.renderTo(t);this.stats.renderTo(a)}},{key:"onFilterApply",value:function e(t){var s=this;var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,5),n=r[0],d=r[1],l=r[2],o=r[3],h=r[4];if(this.filterId!==n){return}this.chart.showLoader();this.stats.showLoader();a.ajax.runComponentAction("bitrix:tasks.scrum.team.speed","applyFilter",{mode:"class",signedParameters:this.signedParameters,data:{}}).then((function(e){var t=e.data.chartData;var a=e.data.statsData;s.chart.render(t);s.stats.render(a)}))}}]);return e}();e.TeamSpeed=n})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.Event,BX);
//# sourceMappingURL=script.map.js