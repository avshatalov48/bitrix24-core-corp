(function(t,e){"use strict";var n,i,s,o,a,c,u;var r=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.eventId=e.eventId;this.hasDecision=e.hasDecision;this.isPositiveDecision=e.isPositiveDecision;this.hash=e.hash;this.downnoloadLink=e.downloadLink;this.decisionButtonsBlock=document.querySelector(".calendar-pub-event-btn-container");this.titleBlock=document.querySelector(".calendar-pub-event-title-main");this.eventWrapper=document.querySelector(".calendar-pub-event-wrap");this.listBoxWrapper=document.querySelector(".calendar-pub-event-user-list-box");this.decisionBlockWrapper=decisionBlock;this.buttonsContainer=buttonsContainer;this.init()}babelHelpers.createClass(t,[{key:"init",value:function t(){this.initWrappersForButtons();this.initHandler()}},{key:"initWrappersForButtons",value:function t(){this.primaryButtonWrapper=this.buttonsContainer.children[0];this.secondButtonWrapper=this.buttonsContainer.children[1]}},{key:"initHandler",value:function t(){if(this.hasDecision){this.initChangeDecisionButton();e.Dom.append(this.changeDecisionButton,this.primaryButtonWrapper);if(this.isPositiveDecision){this.initDownloadButton();e.Dom.append(this.downloadButton,this.secondButtonWrapper)}}else{this.initAcceptButton();this.initDeclineButton();e.Dom.append(this.acceptDecisionButton,this.primaryButtonWrapper);e.Dom.append(this.declineDecisionButton,this.secondButtonWrapper)}this.initListBoxHandlers()}},{key:"initChangeDecisionButton",value:function t(){var e=this;this.changeDecisionButton=this.getChangeDecisionButton();this.changeDecisionButton.addEventListener("click",(function(){e.changeStateWithoutDecision()}))}},{key:"initAcceptButton",value:function t(){var e=this;this.acceptDecisionButton=this.getAcceptDecisionButton();this.acceptDecisionButton.addEventListener("click",(function(){e.changeStateWithDecision(true)}))}},{key:"initDeclineButton",value:function t(){var e=this;this.declineDecisionButton=this.getDeclineDecisionButton();this.declineDecisionButton.addEventListener("click",(function(){e.changeStateWithDecision(false)}))}},{key:"changeStateWithDecision",value:function t(n){var i=this;this.hasDecision=true;e.Dom.remove(this.acceptDecisionButton);this.acceptDecisionButton=undefined;e.Dom.remove(this.declineDecisionButton);this.declineDecisionButton=undefined;this.showChangeDecisionButton();if(n){this.showAcceptDecisionBlock();this.showDownloadButton()}else{this.showDeclineDecisionBlock()}this.isPositiveDecision=n;BX.ajax.runComponentAction("bitrix:calendar.pub.event","handleDecision",{mode:"class",data:{decision:n?"Y":"N",eventId:this.eventId,hash:this.hash}}).then((function(t){if(t.data.attendeesList.length>0){i.rebuildUserList(t.data.attendeesList)}}))}},{key:"showChangeDecisionButton",value:function t(){if(!this.changeDecisionButton){this.initChangeDecisionButton()}e.Dom.append(this.changeDecisionButton,this.primaryButtonWrapper)}},{key:"getChangeDecisionButton",value:function t(){return e.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="changeDecisionButton" class="ui-btn ui-btn-round ui-btn-lg ui-btn-success calendar-pub-event-btn calendar-pub-event-btn-change-decision">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),e.Loc.getMessage("EC_CALENDAR_CHANGE_DECISION_TITLE"))}},{key:"showAcceptDecisionBlock",value:function t(){var n=this.decisionBlockWrapper.children[1];n.innerText=e.Loc.getMessage("EC_CALENDAR_PUB_EVENT_DECISION_YES");e.Dom.removeClass(this.eventWrapper,"calendar-pub-event--decline ");e.Dom.addClass(this.eventWrapper,"calendar-pub-event--accept")}},{key:"showDeclineDecisionBlock",value:function t(){var n=this.decisionBlockWrapper.children[1];n.innerText=e.Loc.getMessage("EC_CALENDAR_PUB_EVENT_DECISION_NO");e.Dom.removeClass(this.eventWrapper,"calendar-pub-event--accept");e.Dom.addClass(this.eventWrapper,"calendar-pub-event--decline ")}},{key:"changeStateWithoutDecision",value:function t(){e.Dom.remove(this.changeDecisionButton);this.changeDecisionButton=undefined;if(this.downloadButton){e.Dom.remove(this.downloadButton);this.downloadButton=undefined}this.showAcceptDecisionButton();this.showDeclineDecisionButton()}},{key:"showAcceptDecisionButton",value:function t(){if(!this.acceptDecisionButton){this.initAcceptButton()}e.Dom.append(this.acceptDecisionButton,this.primaryButtonWrapper)}},{key:"getAcceptDecisionButton",value:function t(){return e.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="acceptDecisionButton" class="ui-btn ui-btn-round ui-btn-lg ui-btn-success calendar-pub-event-btn">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),e.Loc.getMessage("EC_CALENDAR_DECISION_TITLE_YES"))}},{key:"showDeclineDecisionButton",value:function t(){if(!this.declineDecisionButton){this.initDeclineButton()}e.Dom.append(this.declineDecisionButton,this.secondButtonWrapper)}},{key:"getDeclineDecisionButton",value:function t(){return e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="declineDecisionButton" class="ui-btn ui-btn-link ui-btn-lg calendar-pub-event-btn" data-decision="N">\n\t\t\t',"\n\t\t</button>\n\t\t"])),e.Loc.getMessage("EC_CALENDAR_DECISION_TITLE_NO"))}},{key:"initListBoxHandlers",value:function t(){this.initAttendeesListBoxHandlers();this.initAttachmentsListBoxHandlers()}},{key:"initAttendeesListBoxHandlers",value:function t(){var n=document.querySelector(".calendar-pub-event-user-list-btn");var i=document.querySelector(".calendar-pub-event-user-list-content");if(e.Type.isDomNode(n)){n.addEventListener("click",(function(){var t=i.scrollHeight;i.style.height=t+"px";i.style.maxHeight=t+"px";n.style.display="none"}))}}},{key:"initAttachmentsListBoxHandlers",value:function t(){var n=document.querySelector(".calendar-pub-event-user-attachment-btn");var i=document.querySelector(".calendar-pub-event-user-attachment-content");if(e.Type.isDomNode(n)){n.addEventListener("click",(function(){var t=i.scrollHeight;i.style.height=t+"px";i.style.maxHeight=t+"px";n.style.display="none"}))}}},{key:"initDownloadButton",value:function t(){this.downloadButton=this.getDownloadButton()}},{key:"showDownloadButton",value:function t(){this.initDownloadButton();e.Dom.append(this.downloadButton,this.secondButtonWrapper)}},{key:"getDownloadButton",value:function t(){return e.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a id="downloadButton" href="','" class="ui-btn ui-btn-link ui-btn-lg calendar-pub-event-btn" >\n\t\t\t',"\n\t\t</a>\n\t\t"])),BX.util.htmlspecialchars(this.downnoloadLink),e.Loc.getMessage("EC_CALENDAR_ICAL_INVITATION_DOWNLOAD_INVITATION"))}},{key:"getDecisionBlock",value:function t(){if(this.hasDecision){return document.querySelector(".calendar-pub-event-desc")}return null}},{key:"rebuildUserList",value:function t(n){var i=this;if(e.Type.isArray(n)){var s=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-pub-event-user-list-content">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),n.map((function(t){return e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="calendar-pub-event-user-list-item ','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"])),i.getAdditionalClassForAttendeesList(t["status"]),t["name"])})));var o=document.querySelector(".calendar-pub-event-user-list-content");var r=document.querySelector(".calendar-pub-event-user-list-btn");if(e.Type.isDomNode(o)){var l=o.parentElement;e.Dom.remove(o);if(e.Type.isDomNode(r)){e.Dom.remove(r)}e.Dom.append(s,l);if(n.length>3){var d=e.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div data-button="users" class="calendar-pub-event-user-list-btn">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t<span>(",")</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"])),e.Loc.getMessage("EC_CALENDAR_PUB_EVENT_ALL_ATTENDEES_TITLE"),n.length);e.Dom.append(d,l);this.initAttendeesListBoxHandlers()}}}}},{key:"getAdditionalClassForAttendeesList",value:function t(e){switch(e){case"ACCEPTED":return"calendar-pub-event-user--accept";case"DECLINED":return"calendar-pub-event-user--cancel";default:return"calendar-pub-event-user--waiting"}}}]);return t}();e.Reflection.namespace("BX.Calendar.Pub").CalendarEvent=r})(this.window=this.window||{},BX);
//# sourceMappingURL=script.map.js