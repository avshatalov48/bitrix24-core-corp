(function(){BX.namespace("BX.Crm.Report");BX.Crm.Report.ColumnFunnel=function(t){this.columnFunnelWrapperContainer=t.context.querySelector(".crm-report-column-funnel-wrapper");this.scaleBoxContainer=t.context.querySelector(".crm-report-column-funnel-scale-box");this.infoPopupContentTemplate=t.context.querySelector('[data-role="info-popup-content-template"]');this.firstColumnsContainer=this.columnFunnelWrapperContainer.querySelector('[data-role="first-columns-container"]');this.secondColumnsContainer=this.columnFunnelWrapperContainer.querySelector('[data-role="second-columns-container"]');this.thirdColumnsContainer=this.columnFunnelWrapperContainer.querySelector('[data-role="third-columns-container"]');this.context=t.context;this.columnsValues=[];this.maxColumnValue=null;this.minColumnValue=null;this.informationPopup=null;this.data=t.data;this.columns=[];this.init()};BX.Crm.Report.ColumnFunnel.prototype={init:function(){for(var t=0;t<this.data.length;t++){var e=this.data[t];if(e.columns===undefined){continue}for(var n=0;n<e.columns.length;n++){var o=e.columns[n];var i=this.buildColumn(o);if(t===0){this.firstColumnsContainer.appendChild(i)}if(t===1){this.secondColumnsContainer.appendChild(i)}if(t===2){this.thirdColumnsContainer.appendChild(i)}o.node=i;BX.bind(i,"mouseover",this.handleColumnMouseOver.bind(this,o));BX.bind(i,"mouseout",this.handleColumnMouseOut.bind(this));this.columns.push(o)}if(e["firstAdditionalAmountTargetUrl"]!==undefined){var l=this.context.querySelector('[data-role="first-additional-card-value-'+t+'"]');if(l){l.addEventListener("click",this.openSlider.bind(this,e["firstAdditionalAmountTargetUrl"]))}}}this.renderScaleItems();setTimeout(function(){this.adjustColumnsHeight()}.bind(this),500)},openSlider:function(t){BX.SidePanel.Instance.open(t,{cacheable:false})},renderScaleItems:function(){var t=this.getColumnMaxValue();var e=this.getColumnMinValue();var n=[];n.push(0);if(t!==e){var o=1;if(t<o){n.push(t)}else{var i=Math.round(t/o);if(i===1){n.push(t)}else{if(i>7){o=Math.round(t/7);i=Math.round(t/o)}var l=0;for(var a=1;a<=i;a++){l=a*o;if(l>=t){continue}n.push(l)}n.push(t)}}}else{if(t>0){n.push(t)}else{this.scaleBoxContainer.classList.add("crm-report-column-funnel-scale-single-value")}}n.reverse();n.forEach(function(t){this.scaleBoxContainer.appendChild(BX.create("div",{html:t,attrs:{className:"crm-report-column-funnel-scale-item"}}))}.bind(this))},buildColumn:function(t){var e=BX.create("div",{props:{className:"crm-report-column-funnel-through-funnel-widget-item"},style:{backgroundColor:t.color}});if(t.link.length>0){e.addEventListener("click",this.openSlider.bind(this,t.link));e.classList.add("crm-report-column-funnel-through-funnel-widget-item-clickable")}return e},adjustColumnsHeight:function(){for(var t=0;t<this.columns.length;t++){var e=this.columns[t].node;var n=this.columns[t].value;var o=this.calculatePercentValue(n);e.style.height=o+1+"%"}},calculatePercentValue:function(t){var e=this.getColumnMaxValue();var n=t;var o=0;if(e>0){o=n*100/e}return o},handleColumnMouseOver:function(t){this.openInformationPopup(t)},handleColumnMouseOut:function(){this.informationPopup.close()},openInformationPopup:function(t){if(this.informationPopup!==null){this.informationPopup.destroy()}this.informationPopup=new BX.PopupWindow("widget-column-funnel-information-popup",t.node,{bindOptions:{position:"top"},offsetLeft:30,offsetTop:-1,noAllPaddings:true,autoHide:false,draggable:{restrict:false},content:this.getInformationPopupContent(t)});this.informationPopup.show()},getInformationPopupContent:function(t){this.infoPopupContentTemplateLabel=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-content-label"]');this.infoPopupContentTemplateTopCard=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-card"]');this.infoPopupContentTemplateTopTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-title"]');this.infoPopupContentTemplateTopValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-value"]');this.infoPopupContentTemplateSecondCard=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-second-card"]');this.infoPopupContentTemplateSecondTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-second-title"]');this.infoPopupContentTemplateSecondValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-second-value"]');this.infoPopupContentTemplateThirdCard=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-third-card"]');this.infoPopupContentTemplateThirdTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-third-title"]');this.infoPopupContentTemplateThirdValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-third-value"]');this.infoPopupContentTemplateForthCard=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-forth-card"]');this.infoPopupContentTemplateForthTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-forth-title"]');this.infoPopupContentTemplateForthValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-forth-value"]');this.infoPopupContentTemplate.style.borderColor=t.color;this.infoPopupContentTemplateLabel.innerText=t.title;if(t.firstAdditionalTitle!==undefined){this.infoPopupContentTemplateTopCard.style.display="block";this.infoPopupContentTemplateTopTitle.innerText=t.firstAdditionalTitle;this.infoPopupContentTemplateTopValue.innerHTML=t.firstAdditionalValue;this.infoPopupContentTemplateTopValue.innerHTML+=t.firstAdditionalUnit}else{this.infoPopupContentTemplateTopCard.style.display="none"}if(t.secondAdditionalTitle!==undefined){this.infoPopupContentTemplateSecondCard.style.display="block";this.infoPopupContentTemplateSecondTitle.innerText=t.secondAdditionalTitle;this.infoPopupContentTemplateSecondValue.innerHTML=t.secondAdditionalValue;this.infoPopupContentTemplateSecondValue.innerHTML+=t.secondAdditionalUnit}else{this.infoPopupContentTemplateSecondCard.style.display="none"}if(t.thirdAdditionalValue!==undefined){this.infoPopupContentTemplateThirdCard.style.display="block";this.infoPopupContentTemplateThirdTitle.innerText=t.thirdAdditionalTitle;this.infoPopupContentTemplateThirdValue.innerHTML=t.thirdAdditionalValue;this.infoPopupContentTemplateThirdValue.innerHTML+=t.thirdAdditionalUnit}else{this.infoPopupContentTemplateThirdCard.style.display="none"}if(t.forthAdditionalValue!==undefined){this.infoPopupContentTemplateForthCard.style.display="block";this.infoPopupContentTemplateForthTitle.innerText=t.forthAdditionalTitle;this.infoPopupContentTemplateForthValue.innerHTML=t.forthAdditionalValue;this.infoPopupContentTemplateForthValue.innerHTML+=t.forthAdditionalUnit}else{this.infoPopupContentTemplateForthCard.style.display="none"}return this.infoPopupContentTemplate},getColumnMaxValue:function(){if(this.maxColumnValue!==null){return this.maxColumnValue}if(this.getColumnValues().length>0){this.maxColumnValue=Math.max.apply(null,this.getColumnValues());return this.maxColumnValue}this.maxColumnValue=0;return this.maxColumnValue},getColumnMinValue:function(){if(this.minColumnValue!==null){return this.minColumnValue}if(this.getColumnValues().length>0){this.minColumnValue=Math.min.apply(null,this.getColumnValues());return this.minColumnValue}this.minColumnValue=0;return this.minColumnValue},getColumnValues:function(){if(this.columnsValues.length!==0){return this.columnsValues}for(var t=0;t<this.columns.length;t++){this.columnsValues.push(this.columns[t].value)}return this.columnsValues}}})();
//# sourceMappingURL=script.map.js