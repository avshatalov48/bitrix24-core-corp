{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { ajax as Ajax, Dom, Runtime, Type, Uri, Event } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport 'main.polyfill.intersectionobserver';\n\nclass TaskResult\n{\n\ttaskId = null;\n\titemsContentNode = null;\n\ttargetBtnDown = null;\n\ttargetBtnUp = null;\n\titemsNodes = null;\n\titemsWrapperNode = null;\n\n\tconstructor(taskId)\n\t{\n\t\tthis.init(taskId);\n\t\tthis.setHeightAutoFunction = this.setHeightAuto.bind(this);\n\t}\n\n\tinit(taskId)\n\t{\n\t\tthis.taskId = taskId;\n\n\t\tthis.initExpand();\n\n\t\tEventEmitter.subscribe('onPullEvent-tasks', this.onPushResult.bind(this));\n\t\tEventEmitter.subscribe('BX.Livefeed:recalculateComments', this.onRecalculateLivefeedComments.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onLoad', this.onSidePanelLoad.bind(this));\n\t}\n\n\tscrollToResult()\n\t{\n\t\tconst resultId = TaskResult.getResultIdFromRequest();\n\t\tif (resultId)\n\t\t{\n\t\t\tconst resultItem = this.contentNode.querySelector(`[data-id=\"${resultId}\"]`);\n\t\t\tif (resultItem)\n\t\t\t{\n\t\t\t\tconst scrollTo = () => {\n\t\t\t\t\tTaskResult.activateBlinking(resultItem);\n\n\t\t\t\t\tconst itemTopPosition = Dom.getPosition(resultItem).top;\n\n\t\t\t\t\twindow.scrollTo({ top: itemTopPosition, behavior: 'smooth' });\n\t\t\t\t};\n\n\t\t\t\tif (Dom.hasClass(resultItem.parentElement, 'tasks-widget-result__item-more'))\n\t\t\t\t{\n\t\t\t\t\tEvent.bindOnce(this.itemsWrapperNode, 'transitionend', scrollTo);\n\n\t\t\t\t\tthis.showResults();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tscrollTo();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (resultId === 0)\n\t\t{\n\t\t\tconst commentNode = document\n\t\t\t\t.getElementById(`record-TASK_${this.taskId}-0-placeholder`)\n\t\t\t\t.parentElement\n\t\t\t;\n\t\t\tif (commentNode)\n\t\t\t{\n\t\t\t\tTaskResult.showCommentInput(commentNode);\n\n\t\t\t\twindow.scrollTo({\n\t\t\t\t\ttop: document.body.scrollHeight,\n\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getResultIdFromRequest(): ?number\n\t{\n\t\tconst uri = new Uri(window.location.href);\n\n\t\tconst resultId = uri.getQueryParam('RID');\n\n\t\treturn resultId ? parseInt(resultId, 10) : null;\n\t}\n\n\tblockResize()\n\t{\n\t\tthis.contentNode.style.height = `${this.containerNode.scrollHeight}px`;\n\t}\n\n\tonSidePanelLoad()\n\t{\n\t\tthis.blockResize();\n\n\t\tthis.scrollToResult();\n\t}\n\n\tinitExpand()\n\t{\n\t\tthis.initExpandButton();\n\n\t\tif (this.contentNode)\n\t\t{\n\t\t\tthis.blockResize();\n\t\t}\n\n\t\tthis.targetBtnDown && this.targetBtnDown.addEventListener('click', this.showResults.bind(this));\n\n\t\tthis.targetBtnUp && this.targetBtnUp.addEventListener('click', () => {\n\t\t\tthis.targetBtnUp.classList.remove('--visible');\n\t\t\tthis.targetBtnDown.classList.add('--visible');\n\n\t\t\tthis.itemsContentNode.classList.remove('--open');\n\t\t\tthis.itemsWrapperNode.style.height = `${this.itemsWrapperNode.scrollHeight}px`;\n\t\t\tthis.itemsWrapperNode.clientHeight; // it's needed, P.Rafeev magic\n\t\t\tthis.itemsWrapperNode.style.height = 0;\n\n\t\t\tif (this.contentNode)\n\t\t\t{\n\t\t\t\tthis.contentNode.style.height = `${this.itemsNodes[0].offsetHeight + 35}px`;\n\t\t\t}\n\t\t});\n\n\n\t}\n\n\tsetHeightAuto()\n\t{\n\t\tthis.itemsWrapperNode.style.height = 'auto';\n\t\tthis.itemsWrapperNode.removeEventListener('transitionend', this.setHeightAutoFunction);\n\t}\n\n\tinitExpandButton()\n\t{\n\t\tthis.contentNode = document.getElementById(`tasks-result-list-container-${this.taskId}`);\n\t\tthis.containerNode = document.getElementById(`tasks-result-list-wrapper-${this.taskId}`);\n\n\t\tif (!this.containerNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.itemsContentNode = this.containerNode.querySelector('[data-role=\"tasks-widget--content\"]');\n\t\tthis.targetBtnDown = this.containerNode.querySelector('[data-role=\"tasks-widget--btn-down\"]');\n\t\tthis.targetBtnUp = this.containerNode.querySelector('[data-role=\"tasks-widget--btn-up\"]');\n\t\tthis.itemsNodes = this.containerNode.querySelectorAll('[data-role=\"tasks-widget--result-item\"]');\n\t\tthis.itemsWrapperNode = this.containerNode.querySelector('[data-role=\"tasks-widget--wrapper\"]');\n\n\t\tif (\n\t\t\t!this.itemsWrapperNode\n\t\t\t|| this.itemsNodes.length <= 1\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.targetBtnDown.classList.add('--visible');\n\n\t\tthis.itemsNodes.length === 2\n\t\t\t? this.itemsContentNode.classList.add('--two-results')\n\t\t\t: this.itemsContentNode.classList.add('--many-results');\n\n\t\tEventEmitter.subscribe('BX.Forum.Spoiler:toggle', this.onSpoilerToggle.bind(this));\n\t}\n\n\tonSpoilerToggle(event)\n\t{\n\t\tconst [ eventData ] = event.getCompatData();\n\n\t\tif (!eventData.node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetContentNode = eventData.node.closest('.tasks-result-list-container');\n\t\tif (\n\t\t\t!targetContentNode\n\t\t\t|| !this.contentNode\n\t\t\t|| targetContentNode.id !== this.contentNode.id\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blockResize();\n\t}\n\n\tonPushResult(event: BaseEvent)\n\t{\n\t\tconst [ command, params ] = event.getData();\n\n\t\tif (\n\t\t\tcommand !== 'task_result_create'\n\t\t\t&& command !== 'task_result_update'\n\t\t\t&& command !== 'task_result_delete'\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!params.result\n\t\t\t|| !params.result.taskId\n\t\t\t|| params.result.taskId != this.taskId\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reloadResults();\n\t}\n\n\tonRecalculateLivefeedComments(event: BaseEvent)\n\t{\n\t\tconst [ data ] = event.getCompatData();\n\t\tif (!Type.isDomNode(data.rootNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst taskResultContainer = data.rootNode.querySelector('.tasks-result-list-container');\n\t\tif (\n\t\t\t!taskResultContainer\n\t\t\t|| taskResultContainer.id !== this.contentNode.id\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blockResize();\n\t}\n\n\tshowResults()\n\t{\n\t\tthis.targetBtnDown.classList.remove('--visible');\n\t\tthis.targetBtnUp.classList.add('--visible');\n\n\t\tthis.itemsContentNode.classList.add('--open');\n\t\tthis.itemsWrapperNode.style.height = `${this.itemsWrapperNode.scrollHeight}px`;\n\t\tthis.itemsWrapperNode.addEventListener('transitionend', this.setHeightAutoFunction);\n\n\t\tif (this.contentNode)\n\t\t{\n\t\t\tthis.contentNode.style.height = `${this.itemsWrapperNode.scrollHeight + this.containerNode.scrollHeight}px`;\n\t\t}\n\t}\n\n\tstatic activateBlinking(node: HTMLElement)\n\t{\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst observer = new IntersectionObserver(\n\t\t\t(entries) => {\n\t\t\t\tif (entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(node, '--blink');\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tDom.removeClass(node, '--blink');\n\t\t\t\t\t}, 300);\n\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0],\n\t\t\t},\n\t\t);\n\n\t\tobserver.observe(node);\n\t}\n\n\tstatic showCommentInput(node: HTMLElement)\n\t{\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst observer = new IntersectionObserver(\n\t\t\t(entries) => {\n\t\t\t\tif (entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tconst replyNode = node.querySelector('.feed-com-footer');\n\t\t\t\t\tif (replyNode)\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\t\t\t\tBX.fireEvent(replyNode, 'click');\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\twindow.scrollTo({\n\t\t\t\t\t\t\t\ttop: document.body.scrollHeight,\n\t\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst resultCheckbox = document.getElementById('IS_TASK_RESULT');\n\t\t\t\t\t\t\tresultCheckbox.checked = true;\n\t\t\t\t\t\t}, 300);\n\t\t\t\t\t}\n\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0],\n\t\t\t},\n\t\t);\n\n\t\tobserver.observe(node);\n\t}\n\n\treloadResults()\n\t{\n\t\tAjax.runComponentAction('bitrix:tasks.widget.result', 'getResults', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\ttaskId: this.taskId,\n\t\t\t}\n\t\t}).then(\n\t\t(response) => {\n\t\t\tif (!response.data)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.containerNode.innerHTML = response.data;\n\t\t\tRuntime.html(this.containerNode, response.data).then(() => {\n\t\t\t\tthis.initExpand();\n\t\t\t});\n\t\t});\n\t}\n\n}\n\nexport {\n\tTaskResult,\n}"],"names":["TaskResult","taskId","init","setHeightAutoFunction","setHeightAuto","bind","initExpand","EventEmitter","subscribe","onPushResult","onRecalculateLivefeedComments","onSidePanelLoad","resultId","getResultIdFromRequest","resultItem","contentNode","querySelector","scrollTo","activateBlinking","itemTopPosition","Dom","getPosition","top","window","behavior","hasClass","parentElement","Event","bindOnce","itemsWrapperNode","showResults","commentNode","document","getElementById","showCommentInput","body","scrollHeight","style","height","containerNode","blockResize","scrollToResult","initExpandButton","targetBtnDown","addEventListener","targetBtnUp","classList","remove","add","itemsContentNode","clientHeight","itemsNodes","offsetHeight","removeEventListener","querySelectorAll","length","onSpoilerToggle","event","getCompatData","eventData","node","targetContentNode","closest","id","getData","command","params","result","reloadResults","data","Type","isDomNode","rootNode","taskResultContainer","Ajax","runComponentAction","mode","then","response","innerHTML","Runtime","html","uri","Uri","location","href","getQueryParam","parseInt","isUndefined","IntersectionObserver","observer","entries","isIntersecting","addClass","setTimeout","removeClass","disconnect","threshold","observe","replyNode","BX","fireEvent","resultCheckbox","checked"],"mappings":"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"}