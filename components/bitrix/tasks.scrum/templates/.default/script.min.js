this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,t,i,n,s,r,a,o,l,u){"use strict";var c=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.SidePanel");e.sidePanelManager=BX.SidePanel.Instance;e.bindEvents();return e}babelHelpers.createClass(t,[{key:"bindEvents",value:function e(){var t=this;u.EventEmitter.subscribe("SidePanel.Slider:onLoad",function(e){var i=e.getCompatData(),n=babelHelpers.slicedToArray(i,1),s=n[0];var r=s.getSlider();r.setCacheable(false);t.emit("onLoadSidePanel",r)});u.EventEmitter.subscribe("SidePanel.Slider:onClose",function(e){var i=e.getCompatData(),n=babelHelpers.slicedToArray(i,1),s=n[0];var r=s.getSlider();t.emit("onCloseSidePanel",r)})}},{key:"isPreviousSidePanelExist",value:function e(t){return Boolean(this.sidePanelManager.getPreviousSlider(t))}},{key:"getTopSidePanel",value:function e(){var t=this.sidePanelManager.getTopSlider();return t?t:null}},{key:"reloadTopSidePanel",value:function e(){if(this.sidePanelManager.getTopSlider()){this.sidePanelManager.getTopSlider().reload()}}},{key:"closeTopSidePanel",value:function e(){if(this.sidePanelManager.getTopSlider()){this.sidePanelManager.getTopSlider().close()}}},{key:"reloadPreviousSidePanel",value:function e(t){var i=this.sidePanelManager.getPreviousSlider(t);i.reload()}},{key:"openSidePanelByUrl",value:function e(t){this.sidePanelManager.open(t)}},{key:"openSidePanel",value:function e(t,i){this.sidePanelManager.open(t,i)}},{key:"showByExtension",value:function e(t,i){var n="tasks.scrum."+t.toLowerCase();return l.Runtime.loadExtension(n).then(function(e){t=t.replaceAll("-","");if(e&&e[t]){var n=new e[t](i);n.show();return n}else{return null}})}}]);return t}(u.EventEmitter);var d=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.signedParameters=t.signedParameters?t.signedParameters:"";this.debugMode=t.debugMode}babelHelpers.createClass(e,[{key:"getSignedParameters",value:function e(){return this.signedParameters}},{key:"sendRequest",value:function e(t){var i=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(e,s){l.ajax.runAction(t,{signedParameters:i.signedParameters,data:n}).then(e,s)})}},{key:"sendRequestToComponent",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=arguments.length>1?arguments[1]:undefined;i.debugMode=this.debugMode;return new Promise(function(e,s){l.ajax.runComponentAction("bitrix:tasks.scrum",n,{mode:"class",signedParameters:t.signedParameters,data:i}).then(e,s)})}},{key:"updateItems",value:function e(t){return this.sendRequestToComponent(t,"updateItems")}},{key:"removeItems",value:function e(t){return this.sendRequestToComponent(t,"removeItems")}},{key:"updateItemSort",value:function e(t){return this.sendRequestToComponent(t,"updateItemSort")}},{key:"updateSprintSort",value:function e(t){return this.sendRequestToComponent(t,"updateSprintSort")}},{key:"createSprint",value:function e(t){return this.sendRequestToComponent(t,"createSprint")}},{key:"startSprint",value:function e(t){return this.sendRequestToComponent(t,"startSprint")}},{key:"completeSprint",value:function e(t){return this.sendRequestToComponent(t,"completeSprint")}},{key:"createTask",value:function e(t){return this.sendRequestToComponent(t,"createTask")}},{key:"updateItem",value:function e(t){return this.sendRequestToComponent(t,"updateItem")}},{key:"changeTaskResponsible",value:function e(t){return this.sendRequestToComponent(t,"changeTaskResponsible")}},{key:"getCurrentState",value:function e(t){return this.sendRequestToComponent(t,"getCurrentState")}},{key:"hasTaskInFilter",value:function e(t){return this.sendRequestToComponent(t,"hasTaskInFilter")}},{key:"removeSprint",value:function e(t){return this.sendRequestToComponent(t,"removeSprint")}},{key:"changeSprintName",value:function e(t){return this.sendRequestToComponent(t,"changeSprintName")}},{key:"changeSprintDeadline",value:function e(t){return this.sendRequestToComponent(t,"changeSprintDeadline")}},{key:"getSprintCompletedItems",value:function e(t){return this.sendRequestToComponent(t,"getSprintCompletedItems")}},{key:"getCompletedSprints",value:function e(t){return this.sendRequestToComponent(t,"getCompletedSprints")}},{key:"getCompletedSprintsStats",value:function e(t){return this.sendRequestToComponent(t,"getCompletedSprintsStats")}},{key:"getItems",value:function e(t){return this.sendRequestToComponent(t,"getItems")}},{key:"saveShortView",value:function e(t){return this.sendRequestToComponent(t,"saveShortView")}},{key:"saveDisplayPriority",value:function e(t){return this.sendRequestToComponent(t,"saveDisplayPriority")}},{key:"getEntityCounters",value:function e(t){return this.sendRequestToComponent(t,"getEntityCounters")}},{key:"attachFilesToTask",value:function e(t){return this.sendRequestToComponent(t,"attachFilesToTask")}},{key:"updateTaskTags",value:function e(t){return this.sendRequestToComponent(t,"updateTaskTags")}},{key:"removeTaskTags",value:function e(t){return this.sendRequestToComponent(t,"removeTaskTags")}},{key:"updateItemEpics",value:function e(t){return this.sendRequestToComponent(t,"updateItemEpics")}},{key:"updateBorderColorToLinkedItems",value:function e(t){return this.sendRequestToComponent(t,"updateBorderColorToLinkedItems")}},{key:"editEpic",value:function e(t){return this.sendRequestToComponent(t,"editEpic")}},{key:"removeEpic",value:function e(t){return this.sendRequestToComponent(t,"removeEpic")}},{key:"applyFilter",value:function e(t){return this.sendRequestToComponent(t,"applyFilter")}},{key:"showLinkedTasks",value:function e(t){return this.sendRequestToComponent(t,"showLinkedTasks")}},{key:"getAllUsedItemBorderColors",value:function e(t){return this.sendRequestToComponent(t,"getAllUsedItemBorderColors")}},{key:"getSubTaskItems",value:function e(t){return this.sendRequestToComponent(t,"getSubTaskItems")}},{key:"showErrorAlert",value:function e(t,i){if(l.Type.isUndefined(t.errors)){console.log(t);return}if(t.errors.length){var n=t.errors.shift();if(n){var s=n.code?n.code:"";var a=n.message+" "+s;var o=i?i:l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");r.MessageBox.alert(a,o)}}}}]);return e}();var h=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Filter");i.filterId=e.filterId;i.requestSender=e.requestSender;i.searchFieldApplied=false;i.initUiFilterManager();i.bindHandlers();return i}babelHelpers.createClass(t,[{key:"initUiFilterManager",value:function e(){this.filterManager=BX.Main.filterManager.getById(this.filterId)}},{key:"bindHandlers",value:function e(){u.EventEmitter.subscribe("BX.Main.Filter:apply",this.onApplyFilter.bind(this))}},{key:"isSearchFieldApplied",value:function e(){return this.searchFieldApplied}},{key:"getSearchContainer",value:function e(){return this.filterManager.getSearch().getContainer()}},{key:"getFilterManager",value:function e(){return this.filterManager}},{key:"scrollToSearchContainer",value:function e(){var t=this.getSearchContainer();if(!this.isNodeInViewport(t)){t.scrollIntoView(true)}}},{key:"onApplyFilter",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,5),s=n[0],r=n[1],a=n[2],o=n[3],l=n[4];if(a.getSearch().getSearchString()){this.searchFieldApplied=true}else{this.searchFieldApplied=false}if(this.filterId!==s){return}l.autoResolve=true;this.emit("applyFilter",{promise:o})}},{key:"addItemToListTypeField",value:function e(t,i){var n=this.filterManager.getField(t);var s=this.filterManager.getFieldByName(t);if(!n||!s){return}n.options.ITEMS.push(i);s.ITEMS.push(i);var r=n.node.querySelector("[data-name="+t+"]");var a=l.Dom.attr(r,"data-items");a.push(i);l.Dom.attr(r,"data-items",a)}},{key:"setValueToField",value:function e(t){var i=this.filterManager.getApi();var n=this.filterManager.getFilterFieldsValues();n[t.name]=t.value;i.setFields(n);i.apply()}},{key:"setValuesToField",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=this.filterManager.getApi();var s={};if(!i){s=this.filterManager.getFilterFieldsValues()}t.forEach(function(e){s[e.name]=e.value});n.setFields(s);n.apply()}},{key:"getValueFromField",value:function e(t){var i=this.filterManager.getFilterFieldsValues();return i[t.name]}},{key:"resetFilter",value:function e(){this.filterManager.resetFilter()}},{key:"applyFilter",value:function e(){this.filterManager.applyFilter()}},{key:"isNodeInViewport",value:function e(t){var i=t.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}}]);return t}(u.EventEmitter);function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-view-switcher">\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>','</a>\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>','</a>\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>',"</a>\n\t\t\t</div>\n\t\t"]);p=function t(){return e};return e}var v=function(){function e(t){babelHelpers.classCallCheck(this,e);this.sidePanel=t.sidePanel;this.views=t.views;this.node=null}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this;var i=this.views["plan"].active?"tasks-view-switcher--item --active":"";var n=this.views["activeSprint"].active?"tasks-view-switcher--item --active":"";var s=this.views["completedSprint"].active?"tasks-view-switcher--item --active":"";this.node=l.Tag.render(p(),this.views["plan"].url,i,l.Text.encode(this.views["plan"].name),this.views["activeSprint"].url,n,l.Text.encode(this.views["activeSprint"].name),this.views["completedSprint"].url,s,l.Text.encode(this.views["completedSprint"].name));this.node.querySelectorAll("a").forEach(function(e){l.Event.bind(e,"click",function(){var e=t.sidePanel.getTopSidePanel();if(e!==null){e.showLoader()}})});return this.node}}]);return e}();var g=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.View");i.isOwnerCurrentUser=e.isOwnerCurrentUser==="Y";i.sidePanel=new c;i.requestSender=new d({signedParameters:e.signedParameters,debugMode:e.debugMode});i.filter=new h({filterId:e.filterId,scrumManager:babelHelpers.assertThisInitialized(i),requestSender:i.requestSender});i.userId=parseInt(e.userId,10);i.groupId=parseInt(e.groupId,10);i.pathToTask=l.Type.isString(e.pathToTask)?e.pathToTask:"";return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){if(!l.Type.isDomNode(t)){throw new Error("Scrum: HTMLElement for scrum not found")}}},{key:"renderTabsTo",value:function e(t){if(!l.Type.isDomNode(t)){throw new Error("Scrum: HTMLElement for tabs not found")}var i=new v({sidePanel:this.sidePanel,views:this.views});l.Dom.append(i.render(),t)}},{key:"renderSprintStatsTo",value:function e(t){if(!l.Type.isDomNode(t)){throw new Error("Scrum: HTMLElement for Sprint stats not found")}}},{key:"renderRightElementsTo",value:function e(t){if(!l.Type.isDomNode(t)){throw new Error("Scrum: HTMLElement for buttons not found")}}},{key:"setDisplayPriority",value:function e(t){var i=new Set(["backlog","sprint"]);if(!i.has(t)){throw Error("Invalid parameter to set display priority")}}},{key:"getCurrentUserId",value:function e(){return this.userId}},{key:"getCurrentGroupId",value:function e(){return this.groupId}},{key:"getPathToTask",value:function e(){return this.pathToTask}}]);return t}(u.EventEmitter);function m(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t<div class="diskuf-files-block">\n\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t<input type="hidden" name="[','][]" value=""/>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<label for="file_loader_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type=\n\t\t\t\t\t\t\t"file" multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);m=function t(){return e};return e}var f=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.DiskManager");e.diskUrls={urlSelect:"/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+l.Loc.getMessage("SITE_ID"),urlRenameFile:"/bitrix/tools/disk/uf.php?action=renameFile",urlDeleteFile:"/bitrix/tools/disk/uf.php?action=deleteFile",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1"};e.attachedIds=[];return e}babelHelpers.createClass(t,[{key:"showAttachmentMenu",value:function e(t){var i=this;var n=l.Text.getRandom();this.popup=new s.Popup("disk-manager-attachment-menu-".concat(l.Text.getRandom()),t,{content:this.getAttachmentsLoaderContent(n),autoHide:false,closeByEsc:true,angle:false,offsetTop:12,offsetLeft:-32});this.popup.subscribe("onShow",function(){BX.Disk.UF.add({UID:n,controlName:"[".concat(n,"][]"),hideSelectDialog:false,urlSelect:i.diskUrls.urlSelect,urlRenameFile:i.diskUrls.urlRenameFile,urlDeleteFile:i.diskUrls.urlDeleteFile,urlUpload:i.diskUrls.urlUpload});var e=i.popup.contentContainer.querySelector("#files_chooser");BX.onCustomEvent(e,"DiskLoadFormController",["show"]);if(BX.DiskFileDialog){u.EventEmitter.subscribe(BX.DiskFileDialog,"loadItemsDone",i.openDiskFileDialog.bind(i))}});this.popup.subscribe("onClose",function(){i.emit("onFinish",i.attachedIds)});u.EventEmitter.subscribe("onFinish",function(){return i.popup.close()});this.popup.show()}},{key:"openDiskFileDialog",value:function e(){var t=this;if(BX.DiskFileDialog.popupWindow!=null){BX.DiskFileDialog.popupWindow.subscribe("onClose",function(){return t.popup.close()})}}},{key:"getAttachmentsLoaderContent",value:function e(t){var i=l.Tag.render(m(),t,t,t,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER"),t,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24"),l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(i,"OnFileUploadSuccess",this.onFileUploadSuccess.bind(this));return i}},{key:"onFileUploadSuccess",value:function e(t,i,n,s){if(typeof n==="undefined"||typeof s==="undefined"){return}this.attachedIds.push(t.element_id.toString())}}]);return t}(u.EventEmitter);function b(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--btn-toggle-tasks ','"></div>\n\t\t']);b=function t(){return e};return e}var k=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Item.Toggle");i.visible=e.visible;i.shown=false;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(b(),this.visible?"--visible":"");l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"onClick",value:function e(){if(this.isShown()){this.emit("hide")}else{this.emit("show")}}},{key:"show",value:function e(){this.shown=true}},{key:"hide",value:function e(){this.shown=false}},{key:"isShown",value:function e(){return this.shown}}]);return t}(u.EventEmitter);function y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--title ','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);y=function t(){return e};return e}var S=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Tasks.Scrum.Item.Name");n.value=l.Type.isString(e)&&e?e.trim():"";n.completed=i;if(!n.value){throw new Error(l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_NAME_ERROR"))}n.node=null;return n}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(y(),this.completed?"--completed":"",l.Text.encode(this.value));l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.value}},{key:"strikeOut",value:function e(){l.Dom.addClass(this.node,"--completed")}},{key:"unStrikeOut",value:function e(){l.Dom.removeClass(this.node,"--completed")}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function I(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--entity-tasks '," ",'">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);I=function t(){return e};return e}var T=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.complete=l.Type.isInteger(e.complete)?parseInt(e.complete,10):0;i.all=l.Type.isInteger(e.all)?parseInt(e.all,10):0;i.value="".concat(i.complete,"/").concat(i.all);i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-label ui-label-sm ui-label-light";this.node=l.Tag.render(I(),this.all?"--visible":"",t,this.value);l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.value}},{key:"getComplete",value:function e(){return this.complete}},{key:"getAll",value:function e(){return this.all}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function C(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--attachment-counter '," ",'">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);C=function t(){return e};return e}var E=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.value=l.Type.isInteger(e)?parseInt(e,10):0;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-label ui-label-sm ui-label-light";this.node=l.Tag.render(C(),this.value?"--visible":"",t,this.value);l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.value}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function w(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--comment-counter ',"\">\n\t\t\t\t<div class='ui-counter ","'>\n\t\t\t\t\t<div class='ui-counter-inner'>","</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);w=function t(){return e};return e}var _=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));if(l.Type.isUndefined(e)||l.Type.isNull(e)){e={color:"",value:0}}i.taskCounter=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(w(),this.taskCounter.value?"--visible":"",this.taskCounter.color,parseInt(this.taskCounter.value,10));l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.taskCounter}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function D(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item--epic-full-view ','"\n\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t>',"</div>\n\t\t"]);D=function t(){return e};return e}function A(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--epic ','">\n\t\t\t\t<i\n\t\t\t\t\tclass="tasks-scrum__item--epic-point"\n\t\t\t\t\tstyle="','"\n\t\t\t\t></i>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"]);A=function t(){return e};return e}var P=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Item.Epic");if(l.Type.isUndefined(e)||l.Type.isArray(e)||l.Type.isNull(e)){e={id:0,groupId:0,name:"",description:"",createdBy:0,modifiedBy:0,color:""}}i.epic=e;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(A(),this.epic.id?"--visible":"","background-color: ".concat(this.epic.color),l.Text.encode(this.epic.name));l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"renderFullView",value:function e(){var t=this.convertHexToRGBA(this.epic.color,.7);var i=this.convertHexToRGBA(this.epic.color,.3);var n=this.epic.id>0?"--visible":"";this.node=l.Tag.render(D(),n,i,t,l.Text.encode(this.epic.name));l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.epic}},{key:"getId",value:function e(){return this.epic.id}},{key:"onClick",value:function e(){this.emit("click")}},{key:"convertHexToRGBA",value:function e(t,i){var n=t.replace("#","");if(n.length===3){n="".concat(n[0]).concat(n[0]).concat(n[1]).concat(n[1]).concat(n[2]).concat(n[2])}var s=parseInt(n.substring(0,2),16);var r=parseInt(n.substring(2,4),16);var a=parseInt(n.substring(4,6),16);return"rgba(".concat(s,",").concat(r,",").concat(a,",").concat(i,")")}}]);return t}(u.EventEmitter);function H(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item--hashtag"></div>']);H=function t(){return e};return e}function N(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item--hashtag --visible">#',"</div>"]);N=function t(){return e};return e}function B(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t","\n\t\t\t"]);B=function t(){return e};return e}var M=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Item.Tags");i.tags=l.Type.isArray(e)?e:[];i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=this;if(this.tags.length){this.node=l.Tag.render(B(),this.tags.map(function(e){return l.Tag.render(N(),l.Text.encode(e))}))}else{this.node=l.Tag.render(H())}if(l.Type.isArray(this.node)){this.node.forEach(function(e){l.Event.bind(e,"click",t.onClick.bind(t))})}else{l.Event.bind(this.node,"click",this.onClick.bind(this))}return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.tags}},{key:"onClick",value:function e(t){this.emit("click",t.target.textContent.substring(1))}},{key:"isEqualTags",value:function e(t){return JSON.stringify(this.getValue())===JSON.stringify(t.getValue())}}]);return t}(u.EventEmitter);function L(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--responsible">\n\t\t\t\t<div class="tasks-scrum__item--responsible-photo ','" title="','">\n\t\t\t\t\t<i style="','"></i>\n\t\t\t\t</div>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"]);L=function t(){return e};return e}var R=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.setEventNamespace("BX.Tasks.Scrum.Item.Responsible");i.responsible=l.Type.isPlainObject(e)?e:null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-icon ui-icon-common-user";var i=l.Text.encode(this.responsible.name);var n=this.responsible.photo?l.Text.encode(this.responsible.photo.src):null;var s=n?"background-image: url('".concat(n,"');"):"";this.node=l.Tag.render(L(),t,i,s,i);l.Event.bind(this.node.querySelector("div"),"click",this.onClick.bind(this));l.Event.bind(this.node.querySelector("span"),"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.responsible}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);var F=function(){function e(){babelHelpers.classCallCheck(this,e);this.storyPoints=""}babelHelpers.createClass(e,[{key:"setPoints",value:function e(t){if(t===""){this.storyPoints="";return}if(l.Type.isUndefined(t)||isNaN(parseFloat(t))){return}if(l.Type.isFloat(t)){t=parseFloat(t).toFixed(1)}this.storyPoints=String(t)}},{key:"getPoints",value:function e(){return this.storyPoints}},{key:"clearPoints",value:function e(){this.storyPoints=""}},{key:"isEmpty",value:function e(){return this.storyPoints===""}}]);return e}();function O(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--story-points ','">\n\t\t\t\t<div class="tasks-scrum__item--story-points-content">\n\t\t\t\t\t<div class="tasks-scrum__item--story-points-element">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--story-points-input-container">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="tasks-scrum__item--story-points-input"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);O=function t(){return e};return e}var U=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.setEventNamespace("BX.Tasks.Scrum.Item.StoryPoints");i.storyPointsStorage=new F;i.storyPointsStorage.setPoints(e);i.disableStatus=false;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=l.Text.encode(this.storyPointsStorage.getPoints());this.node=l.Tag.render(O(),this.storyPointsStorage.isEmpty()?"--empty":"",this.storyPointsStorage.isEmpty()?"-":t,t);l.Event.bind(this.node.querySelector(".tasks-scrum__item--story-points-element"),"click",this.onClick.bind(this));var i=this.node.querySelector(".tasks-scrum__item--story-points-input");l.Event.bind(i,"blur",this.onBlur.bind(this));l.Event.bind(i,"keydown",this.onKeyDown.bind(i));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getValue",value:function e(){return this.storyPointsStorage}},{key:"isDisable",value:function e(){return this.disableStatus}},{key:"disable",value:function e(){this.disableStatus=true}},{key:"unDisable",value:function e(){this.disableStatus=false}},{key:"onClick",value:function e(){if(this.isDisable()){return}var t=this.node.querySelector(".tasks-scrum__item--story-points-input-container");var i=t.firstElementChild;var n=this.storyPointsStorage.getPoints();l.Dom.addClass(t,"--active");i.focus();i.setSelectionRange(n.length,n.length)}},{key:"onBlur",value:function e(){var t=this.node.querySelector(".tasks-scrum__item--story-points-input-container");var i=t.firstElementChild;var n=i.value.trim();var s=this.storyPointsStorage.getPoints();if(s!==n){this.emit("setStoryPoints",n)}l.Dom.removeClass(t,"--active")}},{key:"onKeyDown",value:function e(t){if(t.isComposing||t.key==="Escape"||t.key==="Enter"){this.blur()}}}]);return t}(u.EventEmitter);function x(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item-sub-tasks"></div>']);x=function t(){return e};return e}var q=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.parentItem=e;i.list=new Map;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(x());l.Event.bind(this.node,"transitionend",this.onTransitionEnd.bind(this,this.node));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"removeYourself",value:function e(){l.Dom.remove(this.node);this.node=null}},{key:"isEmpty",value:function e(){return this.list.size===0}},{key:"getParentItem",value:function e(){return this.parentItem}},{key:"addTask",value:function e(t){this.list.set(t.getId(),t)}},{key:"getList",value:function e(){return this.list}},{key:"cleanTasks",value:function e(){this.list.forEach(function(e){l.Dom.remove(e.getNode())});this.list.clear()}},{key:"show",value:function e(){if(this.list.size){this.hideLoader();this.renderSubTasks()}else{this.showLoader()}this.getNode().style.height="".concat(this.getNode().scrollHeight,"px")}},{key:"hide",value:function e(){this.hideLoader();this.getNode().style.height="".concat(this.getNode().scrollHeight,"px");this.getNode().clientHeight;this.getNode().style.height="0"}},{key:"isShown",value:function e(){return this.node!==null}},{key:"renderSubTasks",value:function e(){var t=this;this.node.innerHTML="";this.list.forEach(function(e){l.Dom.append(e.render(),t.getNode())})}},{key:"showLoader",value:function e(){if(this.loader){this.loader.show();return}var t=l.Dom.getPosition(this.getNode());this.loader=new n.Loader({target:this.getNode(),size:60,mode:"inline",color:"rgba(82, 92, 105, 0.9)",offset:{top:"12px",left:"".concat(t.width/2-30,"px")}});this.loader.show()}},{key:"hideLoader",value:function e(){if(this.loader){this.loader.hide()}}},{key:"onTransitionEnd",value:function e(t){var i=t.style.height==="0px";if(i){this.removeYourself()}else{t.style.height="auto"}}}]);return t}(u.EventEmitter);function V(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item',"","","tasks-scrum__item--drag --full-view ",'"\n\t\t\t\tdata-id="','"\n\t\t\t\tdata-sort="','"\n\t\t\t>\n\t\t\t<div class="tasks-scrum__item--info-task--basic">\n\t\t\t\t<div class="tasks-scrum__item--link"></div>\n\t\t\t\t<div class="tasks-scrum__item--info">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum__item--main-info">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--tags">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum__item--info-task--details">\n\t\t\t\t','\n\n\t\t\t\t\t<div class="tasks-scrum__item--counter-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\n\t\t\t\t",'\n\t\t\t</div>\n\n\t\t\t\t<div class="tasks-scrum__item--group-mode">\n\t\t\t\t\t<input type="checkbox" class="tasks-scrum__item--group-mode-input">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item--substrate"></div>\n\t\t\t</div>\n\t\t']);V=function t(){return e};return e}function K(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item',"","","tasks-scrum__item--drag --short-view ",'"\n\t\t\t\tdata-id="','"\n\t\t\t\tdata-sort="','"\n\t\t\t>\n\t\t\t\t<div class="tasks-scrum__item--link"></div>\n\t\t\t\t<div class="tasks-scrum__item--info">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum__item--main-info">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--tags">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--entity-content">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--counter-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="tasks-scrum__item--group-mode">\n\t\t\t\t\t<input type="checkbox" class="tasks-scrum__item--group-mode-input">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item--substrate"></div>\n\t\t\t</div>\n\t\t']);K=function t(){return e};return e}var G=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Item");i.groupMode=false;i.node=null;i.toggle=null;i.name=null;i.checklist=null;i.files=null;i.comments=null;i.epic=null;i.tags=null;i.responsible=null;i.storyPoints=null;i.subTasks=null;i.setItemParams(e);return i}babelHelpers.createClass(t,[{key:"setItemParams",value:function e(t){this.setId(t.id);this.setTmpId(t.tmpId);this.setSort(t.sort);this.setEntityId(t.entityId);this.setEntityType(t.entityType);this.setSourceId(t.sourceId);this.setInfo(t.info);this.setSubTasksInfo(t.subTasksInfo);this.setParentTask(t.isParentTask);this.setLinkedTask(t.isLinkedTask);this.setParentTaskId(t.parentTaskId);this.setSubTask(t.isSubTask);this.setCompleted(t.completed);this.setDisableStatus(false);this.setAllowedActions(t.allowedActions);this.shortView="Y"}},{key:"setToggle",value:function e(t){var i=new k({visible:t});if(this.toggle){l.Dom.replace(this.toggle.getNode(),i.render())}this.toggle=i;this.toggle.subscribe("show",this.onShowToggle.bind(this));this.toggle.subscribe("hide",this.onHideToggle.bind(this))}},{key:"getToggle",value:function e(){return this.toggle}},{key:"setName",value:function e(t){var i=this;var n=new S(t,this.isCompleted());if(this.name){l.Dom.replace(this.name.getNode(),n.render())}this.name=n;this.name.subscribe("click",function(){return i.emit("showTask")})}},{key:"getName",value:function e(){return this.name}},{key:"setChecklist",value:function e(t,i){var n=this;var s=new T({complete:t,all:i});if(this.checklist){l.Dom.replace(this.checklist.getNode(),s.render())}this.checklist=s;this.checklist.subscribe("click",function(){return n.emit("showTask")})}},{key:"getChecklist",value:function e(){return this.checklist}},{key:"setFiles",value:function e(t){var i=this;var n=new E(t);if(this.files){l.Dom.replace(this.files.getNode(),n.render())}this.files=n;this.files.subscribe("click",function(){return i.emit("showTask")})}},{key:"getFiles",value:function e(){return this.files}},{key:"setComments",value:function e(t){var i=this;var n=new _(t);if(this.comments){l.Dom.replace(this.comments.getNode(),n.render())}this.comments=n;this.comments.subscribe("click",function(){return i.emit("showTask")})}},{key:"getComments",value:function e(){return this.comments}},{key:"setEpic",value:function e(t){var i=this;var n=new P(t);if(this.epic){l.Dom.replace(this.epic.getNode(),this.isShortView()?n.render():n.renderFullView())}this.epic=n;this.updateTagsVisibility();this.epic.subscribe("click",function(){return i.emit("filterByEpic",i.epic.getId())})}},{key:"getEpic",value:function e(){return this.epic}},{key:"setTags",value:function e(t){var i=this;var n=new M(t);if(this.tags){if(this.getNode()){this.replaceTags(n)}}this.tags=n;this.updateTagsVisibility();this.tags.subscribe("click",function(e){return i.emit("filterByTag",e.getData())})}},{key:"getTags",value:function e(){return this.tags}},{key:"setShortView",value:function e(t){this.shortView=t==="Y"?"Y":"N";if(this.getNode()){l.Dom.replace(this.getNode(),this.render())}}},{key:"getShortView",value:function e(){return this.shortView}},{key:"isShortView",value:function e(){return this.shortView==="Y"}},{key:"setResponsible",value:function e(t){var i=new R(t);if(this.responsible){l.Dom.replace(this.responsible.getNode(),i.render())}this.responsible=i;this.responsible.subscribe("click",this.onResponsibleClick.bind(this))}},{key:"getResponsible",value:function e(){return this.responsible}},{key:"setStoryPoints",value:function e(t){var i=new U(t);if(this.storyPoints){l.Dom.replace(this.storyPoints.getNode(),i.render())}if(this.isDisabled()){i.disable()}this.storyPoints=i;this.storyPoints.subscribe("setStoryPoints",this.onSetStoryPoints.bind(this))}},{key:"getStoryPoints",value:function e(){return this.storyPoints}},{key:"setSubTasks",value:function e(){var t=this;this.subTasks=new q(this);this.subTasks.subscribe("click",function(){return t.emit("showTask")})}},{key:"getSubTasks",value:function e(){return this.subTasks}},{key:"setId",value:function e(t){this.id=l.Type.isInteger(t)?parseInt(t,10):l.Type.isString(t)&&t?t:l.Text.getRandom();if(this.getNode()){this.getNode().dataset.id=this.id}}},{key:"getId",value:function e(){return this.id}},{key:"setTmpId",value:function e(t){this.tmpId=l.Type.isString(t)?t:""}},{key:"getTmpId",value:function e(){return this.tmpId}},{key:"setSort",value:function e(t){this.setPreviousSort(this.sort);this.sort=l.Type.isInteger(t)?parseInt(t,10):0;if(this.getNode()){l.Dom.attr(this.getNode(),"data-sort",this.sort)}}},{key:"getSort",value:function e(){return this.sort}},{key:"setPreviousSort",value:function e(t){this.previousSort=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getPreviousSort",value:function e(){return this.previousSort}},{key:"setEntityId",value:function e(t){this.entityId=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"setEntityType",value:function e(t){this.entityType=new Set(["backlog","sprint"]).has(t)?t:"backlog";this.updateBorderColor()}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"setSourceId",value:function e(t){this.sourceId=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getSourceId",value:function e(){return this.sourceId}},{key:"setCompleted",value:function e(t){var i=t==="Y";if(this.name){if(i){this.name.strikeOut()}else{this.name.unStrikeOut()}}this.completed=i}},{key:"setAllowedActions",value:function e(t){this.allowedActions=l.Type.isPlainObject(t)?t:{}}},{key:"setSubTasksInfo",value:function e(t){this.subTasksInfo=t}},{key:"getSubTasksInfo",value:function e(){return this.subTasksInfo}},{key:"getSubTasksCount",value:function e(){if(!this.getSubTasksInfo()){return 0}return Object.keys(this.getSubTasksInfo()).length}},{key:"setParentTask",value:function e(t){this.parentTask=t==="Y";if(this.getNode()){this.setToggle(this.isParentTask());if(this.isParentTask()){l.Dom.addClass(this.getNode(),"--parent-tasks");if(this.getSubTasksCount()>1){l.Dom.addClass(this.getNode(),"--many")}else{l.Dom.removeClass(this.getNode(),"--many")}}else{l.Dom.removeClass(this.getNode(),"--parent-tasks")}}}},{key:"isParentTask",value:function e(){return this.parentTask}},{key:"setLinkedTask",value:function e(t){this.linkedTask=t==="Y";if(this.getNode()){if(this.isLinkedTask()&&!this.isSubTask()){l.Dom.addClass(this.getNode(),"--linked")}else{l.Dom.removeClass(this.getNode(),"--linked")}}}},{key:"isLinkedTask",value:function e(){return this.linkedTask}},{key:"setParentTaskId",value:function e(t){this.parentTaskId=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getParentTaskId",value:function e(){return this.parentTaskId}},{key:"setSubTask",value:function e(t){this.subTask=t==="Y";if(this.getNode()){if(this.isSubTask()){l.Dom.addClass(this.getNode(),"--subtasks")}else{l.Dom.removeClass(this.getNode(),"--subtasks")}}}},{key:"isSubTask",value:function e(){return this.subTask}},{key:"setInfo",value:function e(t){if(l.Type.isUndefined(t)){this.info={color:"",borderColor:""};return}this.info=t}},{key:"getInfo",value:function e(){return this.info}},{key:"setBorderColor",value:function e(t){this.info.borderColor=l.Type.isString(t)?t:"";this.updateBorderColor()}},{key:"getBorderColor",value:function e(){return l.Type.isString(this.info.borderColor)?this.info.borderColor:""}},{key:"updateBorderColor",value:function e(){if(this.isLinkedTask()&&!this.isSubTask()&&this.getNode()&&this.getBorderColor()!==""){var t=this.getNode().querySelector(".tasks-scrum__item--link");l.Dom.style(t,"backgroundColor",this.getBorderColor());switch(this.getEntityType()){case"backlog":l.Dom.style(this.getNode(),"borderLeft","3px solid"+this.getBorderColor());break;case"sprint":l.Dom.style(this.getNode(),"borderLeft",null);break}}}},{key:"isCompleted",value:function e(){return this.completed}},{key:"isDisabled",value:function e(){return this.disableStatus}},{key:"setMoveActivity",value:function e(t){this.moveActivity=Boolean(t)}},{key:"isMovable",value:function e(){return this.moveActivity}},{key:"setDisableStatus",value:function e(t){this.disableStatus=Boolean(t);if(this.isDisabled()){this.storyPoints.disable()}}},{key:"activateGroupMode",value:function e(){l.Dom.addClass(this.getNode(),"--checked")}},{key:"deactivateGroupMode",value:function e(){l.Dom.removeClass(this.getNode(),"--checked")}},{key:"activateLinkedMode",value:function e(){l.Dom.addClass(this.getNode(),"--linked-mode")}},{key:"deactivateLinkedMode",value:function e(){l.Dom.removeClass(this.getNode(),"--linked-mode");l.Dom.removeClass(this.getNode(),"--linked-mode-current")}},{key:"activateCurrentLinkedMode",value:function e(){l.Dom.addClass(this.getNode(),"--linked-mode-current")}},{key:"deactivateCurrentLinkedMode",value:function e(){l.Dom.removeClass(this.getNode(),"--linked-mode-current")}},{key:"addItemToGroupMode",value:function e(){this.groupMode=true;l.Dom.addClass(this.getNode(),["--group-mode"]);this.getNode().querySelector(".tasks-scrum__item--group-mode-input").checked=true}},{key:"removeItemFromGroupMode",value:function e(){this.groupMode=false;l.Dom.removeClass(this.getNode(),["--group-mode"]);this.getNode().querySelector(".tasks-scrum__item--group-mode-input").checked=false}},{key:"isGroupMode",value:function e(){return this.groupMode}},{key:"getNode",value:function e(){return this.node}},{key:"showSubTasks",value:function e(){l.Dom.addClass(this.getNode(),"--open");this.toggle.show();this.getSubTasks().show()}},{key:"hideSubTasks",value:function e(){l.Dom.removeClass(this.getNode(),"--open");this.toggle.hide();this.getSubTasks().hide()}},{key:"isShownSubTasks",value:function e(){return this.getSubTasks().isShown()}},{key:"setParentEntity",value:function e(t,i){this.setEntityId(t);this.setEntityType(i)}},{key:"isEditAllowed",value:function e(){return Boolean(this.allowedActions["task_edit"])}},{key:"isRemoveAllowed",value:function e(){return Boolean(this.allowedActions["task_remove"])}},{key:"updateYourself",value:function e(t){this.setToggle(t.isParentTask());if(this.getName().getValue()!==t.getName().getValue()){this.setName(t.getName().getValue())}if(this.getChecklist().getValue()!==t.getChecklist().getValue()){this.setChecklist(t.getChecklist().getComplete(),t.getChecklist().getAll())}if(this.getFiles().getValue()!==t.getFiles().getValue()){this.setFiles(t.getFiles().getValue())}if(this.getComments().getValue()!==t.getComments().getValue()){this.setComments(t.getComments().getValue())}if(this.getEpic().getValue()!==t.getEpic().getValue()){this.setEpic(t.getEpic().getValue())}if(!this.getTags().isEqualTags(t.getTags())){this.setTags(t.getTags().getValue())}if(this.getResponsible().getValue()!==t.getResponsible().getValue()){this.setResponsible(t.getResponsible().getValue())}if(!this.isSubTask()&&this.getStoryPoints().getValue().getPoints()!==t.getStoryPoints().getValue().getPoints()){this.setStoryPoints(t.getStoryPoints().getValue().getPoints())}this.setEntityId(t.getEntityId());if(this.isCompleted()!==t.isCompleted()){this.setCompleted(t.isCompleted()?"Y":"N")}this.setParentTask(t.isParentTask()?"Y":"N");this.setLinkedTask(t.isLinkedTask()?"Y":"N");this.setParentTaskId(t.getParentTaskId());this.setSubTask(t.isSubTask()?"Y":"N")}},{key:"removeYourself",value:function e(){l.Dom.remove(this.node);this.node=null}},{key:"render",value:function e(){if(this.isShortView()){return this.renderShortView()}else{return this.renderFullView()}}},{key:"renderShortView",value:function e(){var t=(this.isParentTask()?" --parent-tasks ":" ")+(this.isSubTask()?" --subtasks ":"");var i=this.getSubTasksCount()>1?" --many ":"";var n=this.isLinkedTask()&&!this.isSubTask()?" --linked ":"";var s="--item-"+this.getEntityType();this.node=l.Tag.render(K(),t,i,n,s,l.Text.encode(this.getId()),l.Text.encode(this.getSort()),this.toggle?this.toggle.render():"",this.name?this.name.render():"",this.epic?this.epic.render():"",this.tags?this.tags.render():"",this.comments?this.comments.render():"",this.files?this.files.render():"",this.checklist?this.checklist.render():"",this.responsible?this.responsible.render():"",!this.isSubTask()&&this.storyPoints?this.storyPoints.render():"");l.Event.bind(this.node,"click",this.onItemClick.bind(this));this.updateBorderColor();return this.node}},{key:"renderFullView",value:function e(){var t=(this.isParentTask()?" --parent-tasks ":" ")+(this.isSubTask()?" --subtasks ":"");var i=this.getSubTasksCount()>1?" --many ":"";var n=this.isLinkedTask()&&!this.isSubTask()?" --linked ":"";var s="--item-"+this.getEntityType();this.node=l.Tag.render(V(),t,i,n,s,l.Text.encode(this.getId()),l.Text.encode(this.getSort()),this.toggle?this.toggle.render():"",this.name?this.name.render():"",this.epic?this.epic.renderFullView():"",this.tags?this.tags.render():"",this.comments?this.comments.render():"",this.responsible?this.responsible.render():"",this.files?this.files.render():"",this.checklist?this.checklist.render():"",!this.isSubTask()&&this.storyPoints?this.storyPoints.render():"");this.updateTagsVisibility();l.Event.bind(this.node,"click",this.onItemClick.bind(this));this.updateBorderColor();return this.node}},{key:"updateTagsVisibility",value:function e(){if(!this.getNode()){return}if(this.epic.getValue().id>0||this.tags.getValue().length>0){l.Dom.addClass(this.getNode().querySelector(".tasks-scrum__item--tags"),"--visible")}else{l.Dom.removeClass(this.getNode().querySelector(".tasks-scrum__item--tags"),"--visible")}}},{key:"replaceTags",value:function e(t){var i=this.getNode().querySelector(".tasks-scrum__item--tags");var n=i.querySelectorAll(".tasks-scrum__item--hashtag");n.forEach(function(e){return l.Dom.remove(e)});var s=t.render();if(l.Type.isArray(s)){s.forEach(function(e){return l.Dom.append(e,i)})}else{l.Dom.append(s,i)}}},{key:"onItemClick",value:function e(t){var i=t.target;if(i.classList.contains("tasks-scrum__item--link")){this.emit("showLinked");return}if(this.isDisabled()){return}if(this.toggle&&this.hasNode(this.toggle.getNode(),i)){return}if(this.name&&this.hasNode(this.name.getNode(),i)){return}if(this.checklist&&this.hasNode(this.checklist.getNode(),i)){return}if(this.files&&this.hasNode(this.files.getNode(),i)){return}if(this.comments&&this.hasNode(this.comments.getNode(),i)){return}if(this.epic&&this.hasNode(this.epic.getNode(),i)){return}if(this.tags&&this.hasNode(this.tags.getNode(),i)){return}if(this.responsible&&this.hasNode(this.responsible.getNode(),i,true)){return}if(this.isSubTask()){return}if(this.storyPoints&&this.hasNode(this.storyPoints.getNode(),i)){return}this.emit("toggleActionPanel")}},{key:"onResponsibleClick",value:function e(){var t=this;if(this.isGroupMode()){return}if(this.isDisabled()){return}if(this.responsibleDialog){this.responsibleDialog.destroy();this.responsibleDialog=null;return}this.responsibleDialog=new i.Dialog({targetNode:this.responsible.getNode(),enableSearch:true,context:"TASKS",events:{"Item:onSelect":function e(i){t.responsibleDialog.hide();var n=i.getData().item;t.setResponsible({id:n.getId(),name:n.getTitle(),photo:{src:n.getAvatar()}});t.emit("changeTaskResponsible")}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}]});this.responsibleDialog.show()}},{key:"onSetStoryPoints",value:function e(t){if(this.isDisabled()){return}this.emit("updateItem",{itemId:this.getId(),entityId:this.getEntityId(),storyPoints:t.getData()});this.setStoryPoints(t.getData())}},{key:"onShowToggle",value:function e(){l.Dom.addClass(this.getNode(),"--open");this.toggle.show();this.emit("showSubTasks",this.getSubTasks())}},{key:"onHideToggle",value:function e(){this.hideSubTasks()}},{key:"hasNode",value:function e(t,i){var n=this;var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(l.Type.isArray(t)){var r=t.map(function(e){return n.hasNode(e,i,s)}).find(function(e){return e===true});return!l.Type.isUndefined(r)}if(!s&&i.isEqualNode(t)){return true}var a=t.getElementsByTagName("*");for(var o=0;o<a.length;o++){if(i.isEqualNode(a[o])){return true}}return false}},{key:"activateBlinking",value:function e(){var t=this;if(!this.getNode()){return}if(typeof IntersectionObserver==="undefined"){return}var i=new IntersectionObserver(function(e){if(e[0].isIntersecting===true){t.blink();i.disconnect()}},{threshold:[0]});i.observe(this.getNode())}},{key:"blink",value:function e(){var t=this;if(!this.getNode()){return}l.Dom.addClass(this.getNode(),"--blink");setTimeout(function(){l.Dom.removeClass(t.getNode(),"--blink")},300)}}],[{key:"buildItem",value:function e(i){var n=new t(i);n.setToggle(n.isParentTask());n.setName(i.name);n.setChecklist(i.checkListComplete,i.checkListAll);n.setFiles(i.attachedFilesCount);n.setComments(i.taskCounter);n.setEpic(i.epic);n.setTags(i.tags);n.setResponsible(i.responsible);if(!n.isSubTask()){n.setStoryPoints(i.storyPoints)}n.setSubTasks();return n}}]);return t}(u.EventEmitter);function z(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-entity-items-loader"></div>']);z=function t(){return e};return e}function X(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-items" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);X=function t(){return e};return e}var W=function(){function e(t){babelHelpers.classCallCheck(this,e);this.entity=t;this.node=null}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this;this.node=l.Tag.render(X(),this.entity.getId(),babelHelpers.toConsumableArray(this.entity.getItems().values()).map(function(e){e.setEntityType(t.entity.getEntityType());return e.render()}),this.renderLoader());return this.node}},{key:"renderLoader",value:function e(){return l.Tag.render(z())}},{key:"getNode",value:function e(){return this.node}},{key:"getListNode",value:function e(){return this.node}},{key:"setEntityId",value:function e(t){this.node.dataset.entityId=parseInt(t,10)}},{key:"addScrollbar",value:function e(){l.Dom.addClass(this.getNode(),"--scrollbar")}},{key:"removeScrollbar",value:function e(){l.Dom.removeClass(this.getNode(),"--scrollbar")}}]);return e}();var j=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.TagSearcher");e.allTags=new Map;return e}babelHelpers.createClass(t,[{key:"addTagToSearcher",value:function e(t){t=t.trim();t=t===""?l.Text.getRandom():t;this.allTags.set("tag_"+t,{id:t,entityId:"tag",tabs:"recents",title:t,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag.svg"})}},{key:"addEpicToSearcher",value:function e(t){var i=t.name.trim();this.allTags.set("epic_"+i,{id:t.id,entityId:"epic",tabs:"recents",title:i,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag-green.svg",name:i,description:t.description,color:t.color,groupId:t.groupId,createdBy:t.createdBy,modifiedBy:t.modifiedBy})}},{key:"getTagFromSearcher",value:function e(t){return this.allTags.get(t)}},{key:"removeEpicFromSearcher",value:function e(t){this.allTags.delete("epic_"+t.name)}},{key:"getAllList",value:function e(){return babelHelpers.toConsumableArray(this.allTags.values())}},{key:"getTagsList",value:function e(){var t=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(e){if(e.entityId==="tag"){t.push(e)}});return t}},{key:"getEpicList",value:function e(){var t=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(e){if(e.entityId==="epic"){t.push(e)}});return t}},{key:"getEpicByName",value:function e(t){var i=null;babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(e){if(e.entityId==="epic"&&e.name===t){i=e}});return i}},{key:"getEpicById",value:function e(t){return babelHelpers.toConsumableArray(this.allTags.values()).find(function(e){return e.entityId==="epic"&&e.id===t})}},{key:"showTagsDialog",value:function e(t,n){var s=this;var r=t.getTags().getValue();var a=[];r.forEach(function(e){var t=s.allTags.get(("tag_"+e).trim());if(t){a.push(t)}});var o=false;this.tagDialog=new i.Dialog({id:t.getId(),targetNode:n,width:400,height:300,multiple:true,dropdownMode:true,enableSearch:true,searchOptions:{allowCreateItem:true,footerOptions:{label:l.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_TAG_ADD")}},offsetTop:12,selectedItems:a,items:this.getTagsList(),events:{"Search:onItemCreateAsync":function e(t){return new Promise(function(e){var i=t.getData(),n=i.searchQuery;var r=t.getTarget();var a=n.getQuery();if(!a){r.focusSearch();return}s.addTagToSearcher(a);var o=s.getTagFromSearcher("tag_"+a);var l=r.addItem(o);l.select();r.getTagSelector().clearTextBox();r.focusSearch();r.selectFirstTab();var u=r.getContainer().querySelector(".ui-selector-footer-conjunction");u.textContent="";e()})},"Item:onSelect":function e(t){o=true;var i=t.getData().item;var n=i.getTitle();s.emit("attachTagToTask",n)},"Item:onDeselect":function e(t){o=true;var i=t.getData().item;var n=i.getTitle();s.emit("deAttachTagToTask",n)}},tagSelectorOptions:{events:{onInput:function e(t){var i=t.getData().selector;if(i){var n=i.getDialog();var s=n.getContainer().querySelector(".ui-selector-footer-conjunction");s.textContent=l.Text.encode(i.getTextBoxValue())}}}}});this.tagDialog.subscribe("onHide",function(){if(o){s.emit("hideTagDialog")}});this.tagDialog.show()}},{key:"showEpicDialog",value:function e(t,n){var s=this;var r=t.getEpic().getValue();var a=[];if(r){var o=this.allTags.get(("epic_"+r.name).trim());if(o){a.push(o)}}var u=false;this.epicDialog=new i.Dialog({id:t.getId(),targetNode:n,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,offsetTop:12,selectedItems:a,items:this.getEpicList(),events:{"Item:onSelect":function e(t){u=true;var i=t.getData().item;var n=i.getId();s.emit("updateItemEpic",n)},"Item:onDeselect":function e(t){setTimeout(function(){u=true;if(s.epicDialog.getSelectedItems().length===0){s.emit("updateItemEpic",0);s.epicDialog.hide()}},50)}},tagSelectorOptions:{placeholder:l.Loc.getMessage("TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER")}});this.epicDialog.subscribe("onHide",function(){if(u){s.emit("hideEpicDialog")}});this.epicDialog.show()}},{key:"isEpicDialogShown",value:function e(){return this.epicDialog&&this.epicDialog.isOpen()}},{key:"hasActionPanelDialog",value:function e(){return this.epicDialog||this.tagDialog}},{key:"showTagsSearchDialog",value:function e(n,s){var r=this;var a=n.getInputNode();if(this.tagSearchDialog&&this.tagSearchDialog.getId()!==n.getNodeId()){this.tagSearchDialog=null}if(!this.tagSearchDialog){this.tagSearchDialog=new i.Dialog({id:n.getNodeId(),targetNode:n.getNode(),width:n.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getTagsList(),searchOptions:{allowCreateItem:true,footerOptions:{label:l.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_TAG_ADD")}},events:{"Search:onItemCreateAsync":function e(t){return new Promise(function(e){var i=t.getTarget();i.hide();a.focus();e()})},"Item:onSelect":function e(i){var n=i.getData().item;var s="#"+n.getTitle();var r=t.getHashTagNamesFromText(a.value);var o=r.length>0?r.pop():"";a.value=a.value.replace(new RegExp("#"+o,"g"),s);a.focus();n.deselect()}}});this.tagSearchDialog.subscribe("onHide",function(){n.setTagsSearchMode(false)})}n.setTagsSearchMode(true);n.subscribeOnce("onMetaEnter",function(){r.tagSearchDialog.hide();a.focus()});this.tagSearchDialog.show();this.tagSearchDialog.search(s)}},{key:"closeTagsSearchDialog",value:function e(){if(this.tagSearchDialog){this.tagSearchDialog.hide()}}},{key:"showEpicSearchDialog",value:function e(n,s){var r=this;var a=n.getInputNode();if(this.epicSearchDialog&&this.epicSearchDialog.getId()!==n.getNodeId()){this.epicSearchDialog=null}if(!this.epicSearchDialog){this.epicSearchDialog=new i.Dialog({id:n.getNodeId(),targetNode:n.getNode(),width:n.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getEpicList(),events:{"Item:onSelect":function e(i){var o=i.getData().item;var l="@"+o.getTitle();a.value=a.value.replace(s===""?"@":new RegExp(t.epicRegExp,"g"),"");a.value=a.value+" "+l;a.focus();o.deselect();n.setEpic(r.getEpicByName(o.getTitle()))}}});this.epicSearchDialog.subscribe("onHide",function(){n.setEpicSearchMode(false)})}n.setEpicSearchMode(true);n.subscribeOnce("onEnter",function(){r.epicSearchDialog.hide();a.value=a.value.replace(new RegExp(t.epicRegExp,"g"),"");a.focus()});this.epicSearchDialog.show();this.epicSearchDialog.search(s)}},{key:"closeEpicSearchDialog",value:function e(){if(this.epicSearchDialog){this.epicSearchDialog.hide()}}}],[{key:"getHashTagNamesFromText",value:function e(i){var n=new RegExp(t.tagRegExp,"g");var s=[];var r;while(r=n.exec(i)){s.push(r[0].substring(1))}return s}},{key:"getHashEpicNamesFromText",value:function e(i){var n=new RegExp(t.epicRegExp,"g");var s=[];var r;while(r=n.exec(i)){s.push(r[0].substring(1))}return s}}]);return t}(u.EventEmitter);babelHelpers.defineProperty(j,"tagRegExp","#[^#@](?:[^#@]*[^s#@])?");babelHelpers.defineProperty(j,"epicRegExp","@[^#@](?:[^#@]*[^s#@])?");function Y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum__item --add-block">\n\t\t\t\t<textarea\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\tclass="tasks-scrum__item--textarea"\n\t\t\t\t>','</textarea>\n\t\t\t\t<div class="tasks-scrum__item--textarea-help">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Y=function t(){return e};return e}var J=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.Input");e.entity=null;e.bindNode=null;e.node=null;e.value="";e.epic=null;e.taskCreated=false;return e}babelHelpers.createClass(t,[{key:"setEntity",value:function e(t){this.entity=t}},{key:"getEntity",value:function e(){return this.entity}},{key:"setBindNode",value:function e(t){this.bindNode=t}},{key:"getBindNode",value:function e(){return this.bindNode}},{key:"cleanBindNode",value:function e(){this.bindNode=null}},{key:"render",value:function e(){var t=this;this.nodeId=l.Text.getRandom();this.node=l.Tag.render(Y(),l.Text.encode(this.nodeId),l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER"),l.Text.encode(this.value),l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER_HELPER"));l.Event.bind(this.getInputNode(),"input",function(e){t.onTagSearch(e);t.onEpicSearch(e)});l.Event.bind(this.getInputNode(),"keydown",this.onKeydown.bind(this));l.Event.bind(this.getInputNode(),"blur",this.onBlur.bind(this));this.emit("render");this.taskCreated=false;return this.node}},{key:"onKeydown",value:function e(t){if(t.isComposing||t.key==="Escape"||t.key==="Enter"){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){this.getInputNode().blur();t.stopImmediatePropagation()}if(t.key==="Enter"){this.emit("onEnter",{event:t});if(l.Browser.isMac()&&t.metaKey||t.ctrlKey){this.emit("onMetaEnter",{event:t})}}}}},{key:"onBlur",value:function e(){if(this.isTagsSearchMode()||this.isEpicSearchMode()){return}this.disable();var t=this.getInputNode();if(t.value===""){this.removeYourself()}else{this.createTaskItem()}}},{key:"onTagSearch",value:function e(t){var i=t.target;var n=j.getHashTagNamesFromText(i.value);if(t.data==="#"){this.setEpicSearchMode(false);this.setTagsSearchMode(true)}if(this.isTagsSearchMode()){var s=n.pop();this.emit("tagsSearchOpen",l.Type.isUndefined(s)?"":s)}else{this.emit("tagsSearchClose")}}},{key:"onEpicSearch",value:function e(t){var i=t.target;var n=j.getHashEpicNamesFromText(i.value);if(t.data==="@"){this.setTagsSearchMode(false);this.setEpicSearchMode(true)}if(this.isEpicSearchMode()){var s=n.pop();this.emit("epicSearchOpen",l.Type.isUndefined(s)?"":s)}else{this.emit("epicSearchClose")}}},{key:"focus",value:function e(){var t=this.getInputNode();var i=t.value.length;t.focus();t.setSelectionRange(i,i)}},{key:"disable",value:function e(){l.Dom.addClass(this.node,"--disabled");this.getInputNode().disabled=true}},{key:"unDisable",value:function e(){l.Dom.removeClass(this.node,"--disabled");this.getInputNode().disabled=false}},{key:"isTaskCreated",value:function e(){return this.taskCreated}},{key:"setEpic",value:function e(t){this.epic=t}},{key:"getNode",value:function e(){return this.node}},{key:"getNodeId",value:function e(){return this.nodeId}},{key:"getInputNode",value:function e(){return this.node.querySelector("textarea")}},{key:"getEpic",value:function e(){return this.epic}},{key:"removeYourself",value:function e(){l.Dom.remove(this.node);this.emit("remove")}},{key:"setTagsSearchMode",value:function e(t){l.Dom.attr(this.getInputNode(),"data-tag-disabled",t)}},{key:"isTagsSearchMode",value:function e(){return l.Dom.attr(this.getInputNode(),"data-tag-disabled")}},{key:"setEpicSearchMode",value:function e(t){l.Dom.attr(this.getInputNode(),"data-epic-disabled",t)}},{key:"isEpicSearchMode",value:function e(){return l.Dom.attr(this.getInputNode(),"data-epic-disabled")}},{key:"createTaskItem",value:function e(){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){var t=this.getInputNode();if(t.value){this.emit("createTaskItem",t.value);this.taskCreated=true;t.value=""}}}}]);return t}(u.EventEmitter);var Q=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Entity");i.storyPoints=new F;i.items=new Map;i.groupMode=false;i.groupModeItems=new Map;i.setEntityParams(e);i.node=null;i.listItems=null;i.itemsLoaderNode=null;i.blank=null;i.dropzone=null;return i}babelHelpers.createClass(t,[{key:"setEntityParams",value:function e(t){this.setId(t.id);this.setViews(t.views);this.setNumberTasks(t.numberTasks);this.setStoryPoints(t.storyPoints);this.setShortView(t.isShortView);this.exactSearchApplied=t.isExactSearchApplied==="Y";this.pageSize=parseInt(t.pageSize,10);this.pageNumberItems=l.Type.isInteger(t.pageNumberItems)?parseInt(t.pageNumberItems,10):1}},{key:"setListItems",value:function e(t){this.listItems=new W(t)}},{key:"getListItems",value:function e(){return this.listItems}},{key:"setShortView",value:function e(t){var i=this;this.shortView=t==="Y"?"Y":"N";this.getItems().forEach(function(e){if(e.isParentTask()&&e.isShownSubTasks()){e.hideSubTasks()}e.setShortView(i.shortView)})}},{key:"getShortView",value:function e(){return this.shortView}},{key:"isShortView",value:function e(){return this.shortView==="Y"}},{key:"getNode",value:function e(){return this.node}},{key:"setId",value:function e(t){this.id=l.Type.isInteger(t)?parseInt(t,10):0;if(this.listItems){this.listItems.setEntityId(this.id)}}},{key:"getId",value:function e(){return this.id}},{key:"setViews",value:function e(t){this.views=l.Type.isPlainObject(t)?t:{}}},{key:"getViews",value:function e(){return this.views}},{key:"getEntityType",value:function e(){return"entity"}},{key:"isBacklog",value:function e(){return this.getEntityType()==="backlog"}},{key:"isActive",value:function e(){return false}},{key:"isCompleted",value:function e(){return false}},{key:"getListItemsNode",value:function e(){return this.listItems?this.listItems.getListNode():null}},{key:"isEmpty",value:function e(){return this.items.size===0}},{key:"getNumberItems",value:function e(){return this.items.size}},{key:"getItems",value:function e(){return this.items}},{key:"hasItem",value:function e(t){return this.items.has(t.getId())}},{key:"getPageSize",value:function e(){return this.pageSize}},{key:"getPageNumberItems",value:function e(){return this.pageNumberItems}},{key:"incrementPageNumberItems",value:function e(){this.pageNumberItems++}},{key:"recalculateItemsSort",value:function e(){var t=this;var i=this.getListItemsNode();if(!i){return}var n=1;i.querySelectorAll(".tasks-scrum-item").forEach(function(e){var i=t.getItems().get(parseInt(e.dataset.id,10));if(i){i.setSort(n);n++}})}},{key:"setItem",value:function e(t){var i=this;this.items.set(t.getId(),t);this.subscribeToItem(t);babelHelpers.toConsumableArray(this.items.values()).map(function(e){i.setItemMoveActivity(e)});t.setEntityType(this.getEntityType());t.setShortView(this.getShortView());this.hideBlank();this.hideDropzone();this.adjustListItemsWidth()}},{key:"setItemMoveActivity",value:function e(t){t.setMoveActivity(this.items.size>2)}},{key:"removeItem",value:function e(t){var i=this;if(this.items.has(t.getId())){this.items.delete(t.getId());t.unsubscribeAll();babelHelpers.toConsumableArray(this.items.values()).map(function(e){i.setItemMoveActivity(e)});if(t.isParentTask()){t.getSubTasks().getList().forEach(function(e){i.removeItem(e)})}this.pageNumberItems=1;this.adjustListItemsWidth()}}},{key:"appendItemToList",value:function e(t){l.Dom.insertBefore(t.render(),this.getListItemsNode().lastElementChild);this.adjustListItemsWidth()}},{key:"isNodeCreated",value:function e(){return this.node!==null}},{key:"setNumberTasks",value:function e(t){this.numberTasks=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getNumberTasks",value:function e(){return this.numberTasks?this.numberTasks:this.getItems().size}},{key:"setExactSearchApplied",value:function e(t){this.exactSearchApplied=Boolean(t)}},{key:"isExactSearchApplied",value:function e(){return this.exactSearchApplied}},{key:"onAfterAppend",value:function e(){var t=this;babelHelpers.toConsumableArray(this.items.values()).map(function(e){t.subscribeToItem(e);t.setItemMoveActivity(e)});this.setStats();if(!this.isCompleted()){this.itemsLoaderNode=this.getNode().querySelector(".tasks-scrum-entity-items-loader");this.bindItemsLoader(this.itemsLoaderNode)}this.adjustListItemsWidth()}},{key:"subscribeToItem",value:function e(t){var i=this;if(!this.getListItemsNode()){return}t.setEntityType(this.getEntityType());t.subscribe("updateItem",function(e){i.emit("updateItem",e.getData())});t.subscribe("showTask",function(e){return i.emit("showTask",e.getTarget())});t.subscribe("changeTaskResponsible",function(e){var t=e.getTarget();i.emit("changeTaskResponsible",t)});t.subscribe("filterByEpic",function(e){i.emit("filterByEpic",e.getData())});t.subscribe("filterByTag",function(e){i.emit("filterByTag",e.getData())});t.subscribe("toggleActionPanel",function(e){i.emit("toggleActionPanel",e.getTarget())});t.subscribe("showLinked",function(e){i.emit("showLinked",e.getTarget())})}},{key:"getItemByItemId",value:function e(t){return this.items.get(l.Type.isInteger(t)?parseInt(t,10):t)}},{key:"getItemBySourceId",value:function e(t){return babelHelpers.toConsumableArray(this.items.values()).find(function(e){return e.getSourceId()===t})}},{key:"getItemsByParentTaskId",value:function e(t){var i=new Map;babelHelpers.toConsumableArray(this.items.values()).map(function(e){if(e.getParentTaskId()===t){i.set(e.getId(),e)}});return i}},{key:"setStoryPoints",value:function e(t){this.storyPoints.setPoints(t);this.setStats()}},{key:"getStoryPoints",value:function e(){return this.storyPoints}},{key:"isFirstItem",value:function e(t){var i=this.getListItemsNode();var n=t.getNode();var s=i.firstElementChild;return s.isEqualNode(n)}},{key:"isLastItem",value:function e(t){var i=this.getListItemsNode();var n=t.getNode();return i.lastElementChild.isEqualNode(n)}},{key:"getFirstItemNode",value:function e(t){var i=this.getListItemsNode();var n=i.firstElementChild;if(t&&n.isEqualNode(t.getNode())){return n.nextElementSibling}else{return n}}},{key:"getLoaderNode",value:function e(){return this.itemsLoaderNode?this.itemsLoaderNode:null}},{key:"fadeOut",value:function e(){l.Dom.addClass(this.getListItemsNode(),"tasks-scrum__entity-items-faded")}},{key:"fadeIn",value:function e(){l.Dom.removeClass(this.getListItemsNode(),"tasks-scrum__entity-items-faded")}},{key:"activateGroupMode",value:function e(){this.groupMode=true;this.getItems().forEach(function(e){e.activateGroupMode()})}},{key:"deactivateGroupMode",value:function e(){this.groupMode=false;this.getItems().forEach(function(e){e.deactivateGroupMode()});this.groupModeItems.forEach(function(e){e.removeItemFromGroupMode()});this.groupModeItems.clear()}},{key:"isGroupMode",value:function e(){return this.groupMode}},{key:"addItemToGroupMode",value:function e(t){this.groupModeItems.set(t.getId(),t);t.addItemToGroupMode()}},{key:"removeItemFromGroupMode",value:function e(t){this.groupModeItems.delete(t.getId());t.removeItemFromGroupMode()}},{key:"hasItemInGroupMode",value:function e(t){return this.groupModeItems.has(t.getId())}},{key:"getGroupModeItems",value:function e(){return this.groupModeItems}},{key:"bindItemsLoader",value:function e(t){var i=this;if(!t){if(this.itemsLoaderNode){t=this.itemsLoaderNode}else{return}}if(typeof IntersectionObserver==="undefined"){return}var n=new IntersectionObserver(function(e){if(e[0].isIntersecting===true){if(!i.isActiveLoadItems()){i.emit("loadItems")}}},{threshold:[0]});n.observe(t)}},{key:"setActiveLoadItems",value:function e(t){this.activeLoadItems=Boolean(t)}},{key:"isActiveLoadItems",value:function e(){return this.activeLoadItems===true}},{key:"showItemsLoader",value:function e(){var t=l.Dom.getPosition(this.itemsLoaderNode);var i=new n.Loader({target:this.itemsLoaderNode,size:60,mode:"inline",offset:{top:"7px",left:"".concat(t.width/2-30,"px")}});if(this.getNumberItems()>=this.pageSize){i.show()}return i}},{key:"setStats",value:function e(){}},{key:"showBlank",value:function e(){if(this.blank){l.Dom.addClass(this.blank.getNode(),"--open")}}},{key:"hideBlank",value:function e(){if(this.blank){l.Dom.removeClass(this.blank.getNode(),"--open")}}},{key:"showDropzone",value:function e(){if(this.dropzone){l.Dom.addClass(this.dropzone.getNode(),"--open")}}},{key:"hideDropzone",value:function e(){if(this.dropzone){l.Dom.removeClass(this.dropzone.getNode(),"--open")}}},{key:"getDropzone",value:function e(){return this.dropzone?this.dropzone.getNode():null}},{key:"appendNodeAfterItem",value:function e(t,i){if(i.nextElementSibling){l.Dom.insertBefore(t,i.nextElementSibling)}else{if(this.getLoaderNode()){l.Dom.append(t,this.getLoaderNode())}else{l.Dom.append(t,this.getListItemsNode())}}}},{key:"adjustListItemsWidth",value:function e(){var t=this.getListItemsNode().scrollHeight>this.getListItemsNode().clientHeight;if(t){this.getListItems().addScrollbar()}else{this.getListItems().removeScrollbar()}}}]);return t}(u.EventEmitter);function Z(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog-tasks">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Z=function t(){return e};return e}function $(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-header">\n\n\t\t\t\t<div class="tasks-scrum__name-container">\n\t\t\t\t\t<div class="tasks-scrum__title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\n\t\t\t\t<button class="tasks-scrum__backlog-btn ',' ui-btn-icon-add">\n\t\t\t\t\t','\n\t\t\t\t</button>\n\t\t\t\t<button class="tasks-scrum__backlog-btn ',' ui-btn-icon-add">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t"]);$=function t(){return e};return e}var ee=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.BacklogHeader");i.backlog=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-btn ui-btn-sm ui-btn-light-border ui-btn-themes ui-btn-round ui-btn-no-caps";var i="ui-btn ui-btn-sm ui-btn-success ui-btn-round ui-btn-no-caps ";this.node=l.Tag.render($(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE"),this.renderTaskCounterLabel(this.backlog.getNumberTasks()),t,l.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_EPIC"),i,l.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_TASK"));var n=this.node.querySelectorAll("button");l.Event.bind(n.item(0),"click",this.onEpicClick.bind(this,n.item(0)));l.Event.bind(n.item(1),"click",this.onTaskClick.bind(this));return this.node}},{key:"updateTaskCounter",value:function e(t){l.Dom.replace(this.node.querySelector(".tasks-scrum__backlog-tasks"),this.renderTaskCounterLabel(t))}},{key:"renderTaskCounterLabel",value:function e(t){return l.Tag.render(Z(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_TASK_COUNTER").replace("#value#",t))}},{key:"onEpicClick",value:function e(t){this.emit("epicClick",t)}},{key:"onTaskClick",value:function e(){this.emit("taskClick")}}]);return t}(u.EventEmitter);function te(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-empty">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);te=function t(){return e};return e}function ie(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog-empty">\n\t\t\t\t<div class="tasks-scrum__backlog-empty--icon"></div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--subtitle">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--text">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);ie=function t(){return e};return e}var ne=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.entity=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){if(this.entity.isBacklog()){return this.renderBacklog()}else if(this.entity.isCompleted()){return this.renderCompletedSprint()}}},{key:"renderBacklog",value:function e(){this.node=l.Tag.render(ie(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_1"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_2"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_3"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_4"));return this.node}},{key:"renderCompletedSprint",value:function e(){this.node=l.Tag.render(te(),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINT_EMPTY"));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"removeNode",value:function e(){l.Dom.remove(this.node);this.node=null}}]);return t}(u.EventEmitter);function se(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-empty" data-entity-id="','">\n\t\t\t\t<div class="tasks-scrum__content-empty--title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__content-empty--text">\n\t\t\t\t\t<span class="tasks-scrum__content-empty--btn-create">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);se=function t(){return e};return e}function re(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-empty --empty-backlog" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);re=function t(){return e};return e}var ae=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Dropzone");i.entity=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){if(this.entity.isBacklog()){return this.renderBacklog()}else{return this.renderSprint()}}},{key:"getNode",value:function e(){return this.node}},{key:"removeNode",value:function e(){l.Dom.remove(this.node);this.node=null}},{key:"renderBacklog",value:function e(){var t=this;this.node=l.Tag.render(re(),this.entity.getId(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_DROPZONE_1"));l.Event.bind(this.node,"click",function(){return t.emit("createTask")});return this.node}},{key:"renderSprint",value:function e(){var t=this;this.node=l.Tag.render(se(),this.entity.getId(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_1"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_2"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_3"));l.Event.bind(this.node.querySelector(".tasks-scrum__content-empty--btn-create"),"click",function(){return t.emit("createTask")});return this.node}}]);return t}(u.EventEmitter);function oe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog">\n\t\t\t\t<div class="tasks-scrum__content --with-header --open">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);oe=function t(){return e};return e}var le=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Backlog");i.setBacklogParams(e);i.header=null;return i}babelHelpers.createClass(t,[{key:"setBacklogParams",value:function e(t){var i=this;t.items.forEach(function(e){var t=G.buildItem(e);t.setShortView(i.getShortView());i.items.set(t.getId(),t)})}},{key:"setHeader",value:function e(t){var i=this;this.header=new ee(t);this.header.subscribe("epicClick",function(e){return i.emit("openAddEpicForm",e.getData())});this.header.subscribe("taskClick",function(){return i.emit("showInput")})}},{key:"setBlank",value:function e(t){this.blank=new ne(t)}},{key:"setDropzone",value:function e(t){var i=this;this.dropzone=new ae(t);this.dropzone.subscribe("createTask",function(){return i.emit("showInput")})}},{key:"setNumberTasks",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setNumberTasks",this).call(this,i);if(this.header){this.header.updateTaskCounter(this.getNumberTasks())}}},{key:"getEntityType",value:function e(){return"backlog"}},{key:"isDisabled",value:function e(){return false}},{key:"render",value:function e(){this.node=l.Tag.render(oe(),this.header?this.header.render():"",this.blank?this.blank.render():"",this.dropzone?this.dropzone.render():"",this.listItems?this.listItems.render():"");l.Event.bind(this.node.querySelector(".tasks-scrum__content-items"),"scroll",this.onItemsScroll.bind(this));return this.node}},{key:"setItem",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setItem",this).call(this,i);if(i.getNode()){l.Dom.addClass(i.getNode(),"--item-backlog")}}},{key:"removeItem",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"removeItem",this).call(this,i);if(this.isEmpty()){this.emit("showBlank")}}},{key:"onAfterAppend",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onAfterAppend",this).call(this);if(this.isEmpty()){this.emit("showBlank")}}},{key:"onItemsScroll",value:function e(){this.emit("itemsScroll")}}],[{key:"buildBacklog",value:function e(i){var n=new t(i);n.setHeader(n);n.setBlank(n);n.setDropzone(n);n.setListItems(n);return n}}]);return t}(Q);function ue(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--date-container">\n\t\t\t\t<div class="tasks-scrum__sprint--date --start">','</div>\n\t\t\t\t<div class="tasks-scrum__sprint--date-separator"> - </div>\n\t\t\t\t<div class="tasks-scrum__sprint--date --end">','</div>\n\t\t\t\t<input type="hidden" name="dateStart" value="',')">\n\t\t\t\t<input type="hidden" name="dateEnd" value="','">\n\t\t\t</div>\n\t\t']);ue=function t(){return e};return e}var ce=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Date");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){if(this.sprint.isActive()||this.sprint.isCompleted()){return""}this.node=l.Tag.render(ue(),t.getFormattedDateStart(this.sprint),t.getFormattedDateEnd(this.sprint),l.Text.encode(this.sprint.getDateStartFormatted()),l.Text.encode(this.sprint.getDateEndFormatted()));this.bindEvents();return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"bindEvents",value:function e(){var t=this;if(this.sprint.isActive()||this.sprint.isCompleted()){return}var i=this.node.closest(".popup-window");var n=function e(){BX.calendar.get().popup.close()};var s=function e(t,s){BX.calendar({node:t,field:s,bTime:false,bSetFocus:false,bHideTime:false});if(i){l.Event.bindOnce(i,"click",n)}};var r=function e(t,i){t.textContent=BX.date.format("j F",Math.floor(BX.parseDate(i).getTime()/1e3))};var a=function e(i){t.emit("changeSprintDeadline",i)};var o=this.node.querySelector(".--start");var u=this.node.querySelector(".--end");var c=this.node.querySelector('input[name="dateStart"]');var d=this.node.querySelector('input[name="dateEnd"]');l.Event.bind(this.node,"click",function(e){var t=e.target;if(t.classList.contains("--start")){s(t,c)}else if(t.classList.contains("--end")){s(t,d)}e.stopPropagation()});l.Event.bind(c,"change",function(e){var s=e.target.value;r(o,s);a({sprintId:t.sprint.getId(),dateStart:Math.floor(BX.parseDate(s).getTime()/1e3)});if(i){l.Event.unbind(i,"click",n)}});l.Event.bind(d,"change",function(e){var s=e.target.value;r(u,s);a({sprintId:t.sprint.getId(),dateEnd:Math.floor(BX.parseDate(s).getTime()/1e3)});if(i){l.Event.unbind(i,"click",n)}})}},{key:"getWeeks",value:function e(){var t=parseInt(this.sprint.getDefaultSprintDuration(),10)/604800;if(t>5){return t+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_3")}else if(t===1){return t+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_1")}else{return t+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_2")}}}],[{key:"getFormattedTitleDatePeriod",value:function e(i){return t.getFormattedDateStart(i)+" - "+t.getFormattedDateEnd(i)}},{key:"getFormattedDateStart",value:function e(t){return BX.date.format("j F",t.getDateStart(),null,true)}},{key:"getFormattedDateEnd",value:function e(t){return BX.date.format("j F",t.getDateEnd(),null,true)}}]);return t}(u.EventEmitter);var de=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"calculatePercentage",value:function e(t,i){if(t===0){return 0}var n=Math.round(i*100/t);return isNaN(n)?0:n}}]);return e}();function he(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);he=function t(){return e};return e}var pe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Stats");i.setSprintData(e);i.statsCalculator=new de;i.node=null;i.kanbanMode=false;return i}babelHelpers.createClass(t,[{key:"setKanbanStyle",value:function e(){this.kanbanMode=true}},{key:"isKanbanMode",value:function e(){return this.kanbanMode}},{key:"render",value:function e(){this.node=l.Tag.render(he());return this.node}},{key:"setSprintData",value:function e(t){this.sprint=t;this.setStoryPoints(t.getStoryPoints().getPoints());this.setCompletedStoryPoints(t.getCompletedStoryPoints().getPoints());this.setUncompletedStoryPoints(t.getUncompletedStoryPoints().getPoints());this.setEndDate(t.getDateEnd());this.weekendDaysTime=t.getWeekendDaysTime();if(this.node){l.Dom.replace(this.node,this.render())}}},{key:"setStoryPoints",value:function e(t){if(l.Type.isUndefined(t)||isNaN(parseFloat(t))){this.storyPoints=0}else{this.storyPoints=parseFloat(t)}}},{key:"getStoryPoints",value:function e(){return this.storyPoints}},{key:"setCompletedStoryPoints",value:function e(t){if(l.Type.isUndefined(t)||isNaN(parseFloat(t))){this.completedStoryPoints=0}else{this.completedStoryPoints=parseFloat(t)}}},{key:"getCompletedStoryPoints",value:function e(){return this.completedStoryPoints}},{key:"setUncompletedStoryPoints",value:function e(t){if(l.Type.isUndefined(t)||isNaN(parseFloat(t))){this.uncompletedStoryPoints=0}else{this.uncompletedStoryPoints=parseFloat(t)}}},{key:"getUncompletedStoryPoints",value:function e(){return this.completedStoryPoints}},{key:"setEndDate",value:function e(t){if(l.Type.isUndefined(t)||isNaN(parseInt(t,10))){this.endDate=Date.now()/1e3}else{this.endDate=parseInt(t,10)}}},{key:"getEndDate",value:function e(){return this.endDate}}]);return t}(u.EventEmitter);function ve(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);ve=function t(){return e};return e}var ge=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var i=this.getCompletedDate(this.getEndDate());var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL").replace("#percent#",t).replace("#date#",i);var s=ce.getFormattedTitleDatePeriod(this.sprint);this.node=l.Tag.render(ve(),s,n);return this.node}},{key:"getCompletedDate",value:function e(t){return BX.date.format("j F Y",t)}}]);return t}(pe);function me(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);me=function t(){return e};return e}var fe=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var i=this.getExpiredDay(this.getEndDate());var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL").replace("#percent#",t).replace("#date#",i);var s=ce.getFormattedTitleDatePeriod(this.sprint);this.node=l.Tag.render(me(),s,n);return this.node}},{key:"getExpiredDay",value:function e(t){return BX.date.format("j F Y",t)}}]);return t}(pe);function be(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);be=function t(){return e};return e}var ke=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=this.getRemainingDays(this.getEndDate());var i=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var n="";if(l.Type.isInteger(t)&&t<=1){n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LAST_LABEL").replace("#percent#",i)}else{n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL").replace("#days#",t).replace("#percent#",i)}var s=ce.getFormattedTitleDatePeriod(this.sprint);this.node=l.Tag.render(be(),s,n);return this.node}},{key:"getRemainingDays",value:function e(t){var i=new Date;i.setSeconds(i.getSeconds()+this.weekendDaysTime);i.setHours(0,0,0,0);var n=new Date(t*1e3);var s=60*1e3;var r=s*60;var a=r*24;var o=Math.round((n-i)/a);if(o<=1){return o}else{return BX.date.format("ddiff",i,n)}}}]);return t}(pe);var ye=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"build",value:function e(t){if(t.isCompleted()){return new ge(t)}else if(t.isExpired()){return new fe(t)}else if(t.isActive()){return new ke(t)}else{return new pe(t)}}}]);return e}();function Se(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content--event-params">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Se=function t(){return e};return e}var Ie=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Stats");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=ye.build(this.sprint);this.node=l.Tag.render(Se(),t.render());return this.node}},{key:"getNode",value:function e(){return this.node}}]);return t}(u.EventEmitter);function Te(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__sprint--remove"></div>']);Te=function t(){return e};return e}function Ce(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__sprint--edit"></div>']);Ce=function t(){return e};return e}function Ee(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__title-editing ','">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="tasks-scrum__title-editing-input ui-ctl-element"\n\t\t\t\t\tvalue="','"\n\t\t\t\t>\n\t\t\t</div>\n\t\t']);Ee=function t(){return e};return e}function we(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__name-container">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum__title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t"]);we=function t(){return e};return e}var _e=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Name");i.sprint=e;i.date=null;i.stats=null;i.node=null;return i}babelHelpers.createClass(t,[{key:"setDate",value:function e(t){var i=this;var n=new ce(t);if(this.date){l.Dom.replace(this.date.getNode(),n.render())}this.date=n;this.date.subscribe("changeSprintDeadline",function(e){i.emit("changeSprintDeadline",e.getData())})}},{key:"getDate",value:function e(){return this.date}},{key:"setStats",value:function e(t){var i=new Ie(t);if(this.stats){l.Dom.replace(this.stats.getNode(),i.render())}this.stats=i}},{key:"render",value:function e(){var t=this;this.node=l.Tag.render(we(),this.renderEditInput(),l.Text.encode(this.sprint.getName()),this.renderEdit(),this.renderRemove(),this.date?this.date.render():"",this.stats?this.stats.render():"");var i=this.node.querySelector(".tasks-scrum__title");var n=this.node.querySelector(".tasks-scrum__sprint--edit");l.Event.bind(i,"click",function(){t.emit("editClick",t.node.querySelector(".tasks-scrum__title-editing-input"))});l.Event.bind(n,"click",function(){t.emit("editClick",t.node.querySelector(".tasks-scrum__title-editing-input"))});if(this.sprint.isPlanned()){var s=this.node.querySelector(".tasks-scrum__sprint--remove");l.Event.bind(s,"click",function(){r.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT"),function(e){t.emit("removeSprint");e.close()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))})}return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"renderEditInput",value:function e(){var t="ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-underline ui-ctl-no-padding";return l.Tag.render(Ee(),t,l.Text.encode(this.sprint.getName()))}},{key:"renderEdit",value:function e(){if(!this.sprint.isCompleted()){return l.Tag.render(Ce())}else{return""}}},{key:"renderRemove",value:function e(){if(this.sprint.isPlanned()){return l.Tag.render(Te())}else{return""}}}]);return t}(u.EventEmitter);function De(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--btn-burn-down-chart">\n\t\t\t\t<div class="tasks-scrum__sprint--icon-burn-down-chart ','"></div>\n\t\t\t</div>\n\t\t']);De=function t(){return e};return e}var Ae=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.ChartIcon");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-btn ui-btn-xs ui-btn-light ui-btn-round";this.node=l.Tag.render(De(),t);l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function Pe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--event-content">\n\t\t\t\t<div class="tasks-scrum__sprint--event-container">\n\t\t\t\t\t<div class="tasks-scrum__sprint--subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__sprint--point">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprint--event-container">\n\t\t\t\t\t<div class="tasks-scrum__sprint--subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__sprint--point">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Pe=function t(){return e};return e}var He=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.Counters");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(Pe(),l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL"),parseInt(this.sprint.getNumberTasks(),10),l.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS"),this.sprint.getStoryPoints().isEmpty()?"-":this.sprint.getStoryPoints().getPoints());return this.node}}]);return t}(u.EventEmitter);function Ne(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="tasks-scrum__sprint--btn-add ','"></button>\n\t\t']);Ne=function t(){return e};return e}var Be=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.Button");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="ui-btn ui-btn-xs ui-btn-light ui-btn-round ui-btn-icon-add";this.node=l.Tag.render(Ne(),t);l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function Me(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--info">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);Me=function t(){return e};return e}var Le=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info");i.sprint=e;i.node=null;i.chartIcon=new Ae(e);i.counters=new He(e);i.button=new Be(e);return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=this;this.node=l.Tag.render(Me(),this.chartIcon.render(),this.counters.render(),this.button.render());this.chartIcon.subscribe("click",function(){return t.emit("showBurnDownChart")});this.button.subscribe("click",function(e){return t.emit("showCreateMenu",e.getTarget())});return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);function Re(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--btn-run ','" title="','">\n\t\t\t\t<span class="tasks-scrum__sprint--btn-run-text">',"</span>\n\t\t\t</div>\n\t\t"]);Re=function t(){return e};return e}var Fe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Button");i.sprint=e;i.disabled=false;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(Re(),this.getUiClasses(),this.getButtonText(),this.getButtonText());l.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"onClick",value:function e(){if(this.disabled){return}this.emit("click")}},{key:"getUiClasses",value:function e(){return"ui-btn ui-btn-sm ui-btn-primary ui-btn-round ui-btn-no-caps"}},{key:"getButtonText",value:function e(){return l.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_BUTTON_"+this.sprint.getStatus().toUpperCase())}},{key:"disable",value:function e(){this.disabled=true;if(this.node){l.Dom.addClass(this.node,"ui-btn-disabled")}}},{key:"unDisable",value:function e(){this.disabled=false;if(this.node){l.Dom.removeClass(this.node,"ui-btn-disabled")}}}]);return t}(u.EventEmitter);function Oe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down --up"></div>\n\t\t']);Oe=function t(){return e};return e}var Ue=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Tick");i.sprint=e;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(Oe());l.Event.bind(this.node,"click",this.onClick.bind(this));if(this.sprint.isCompleted()){l.Dom.removeClass(this.node,"--up")}return this.node}},{key:"onClick",value:function e(){this.emit("click")}},{key:"upTick",value:function e(){if(!this.node){return}l.Dom.addClass(this.node,"--up")}},{key:"downTick",value:function e(){if(!this.node){return}l.Dom.removeClass(this.node,"--up")}}]);return t}(u.EventEmitter);function xe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-header ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);xe=function t(){return e};return e}var qe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header");i.sprint=e;i.node=null;i.name=null;i.stats=null;i.info=null;i.button=null;i.tick=null;return i}babelHelpers.createClass(t,[{key:"setName",value:function e(t){var i=this;var n=new _e(t);if(t.isPlanned()){n.setDate(t)}if(t.isActive()){n.setStats(t)}if(this.name){l.Dom.replace(this.name.getNode(),n.render())}this.name=n;this.name.subscribe("editClick",function(e){i.emit("changeName",e.getData())});this.name.subscribe("removeSprint",function(){return i.emit("removeSprint")});this.name.subscribe("changeSprintDeadline",function(e){i.emit("changeSprintDeadline",e.getData())})}},{key:"getName",value:function e(){return this.name}},{key:"setStats",value:function e(t){if(!t.isCompleted()){return}var i=new Ie(t);if(this.stats){l.Dom.replace(this.stats.getNode(),i.render())}this.stats=i}},{key:"setInfo",value:function e(t){var i=this;var n=new Le(t);if(this.info){l.Dom.replace(this.info.getNode(),n.render())}this.info=n;this.info.subscribe("showBurnDownChart",function(){return i.emit("showBurnDownChart")});this.info.subscribe("showCreateMenu",function(e){return i.emit("showCreateMenu",e.getData())})}},{key:"setButton",value:function e(t){var i=this;var n=new Fe(t);if(this.button){l.Dom.replace(this.button.getNode(),n.render())}this.button=n;this.button.subscribe("click",function(){if(i.sprint.isActive()){i.emit("completeSprint")}else if(i.sprint.isPlanned()){i.emit("startSprint")}})}},{key:"setTick",value:function e(t){var i=this;this.tick=new Ue(t);this.tick.subscribe("click",function(){i.emit("toggleVisibilityContent")})}},{key:"render",value:function e(){this.node=l.Tag.render(xe(),this.getHeaderClass(),this.name?this.name.render():"",this.stats?this.stats.render():"",this.info?this.info.render():"",this.button?this.button.render():"",this.tick?this.tick.render():"");return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"getHeaderClass",value:function e(){return"tasks-scrum__content-header --"+this.sprint.getStatus()}},{key:"activateEditMode",value:function e(){l.Dom.addClass(this.getNode(),"--editing")}},{key:"deactivateEditMode",value:function e(){l.Dom.removeClass(this.getNode(),"--editing")}},{key:"upTick",value:function e(){if(!this.tick){return}this.tick.upTick()}},{key:"downTick",value:function e(){if(!this.tick){return}this.tick.downTick()}},{key:"disableButton",value:function e(){if(this.button){this.button.disable()}}},{key:"unDisableButton",value:function e(){if(this.button){this.button.unDisable()}}}],[{key:"buildHeader",value:function e(i){var n=new t(i);n.setName(i);if(i.isCompleted()){n.setStats(i)}else{n.setInfo(i);n.setButton(i)}n.setTick(i);return n}}]);return t}(u.EventEmitter);function Ve(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__content --with-header ','"\n\t\t\t\tdata-sprint-sort="','"\n\t\t\t\tdata-sprint-id="','"\n\t\t\t>\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum__content-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Ve=function t(){return e};return e}var Ke=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Sprint");i.completedStoryPoints=new F;i.uncompletedStoryPoints=new F;i.setSprintParams(e);i.hideCont=i.isCompleted();return i}babelHelpers.createClass(t,[{key:"setSprintParams",value:function e(t){this.setTmpId(t.tmpId);this.setName(t.name);this.setSort(t.sort);this.setDateStart(t.dateStart);this.setDateEnd(t.dateEnd);this.setDateStartFormatted(t.dateStartFormatted);this.setDateEndFormatted(t.dateEndFormatted);this.setWeekendDaysTime(t.weekendDaysTime);this.setDefaultSprintDuration(t.defaultSprintDuration);this.setStatus(t.status);this.setCompletedStoryPoints(t.completedStoryPoints);this.setUncompletedStoryPoints(t.uncompletedStoryPoints);this.setCompletedTasks(t.completedTasks);this.setUncompletedTasks(t.uncompletedTasks);this.setItems(t.items);this.setInfo(t.info)}},{key:"setHeader",value:function e(t){var i=this;var n=qe.buildHeader(t);if(this.header){l.Dom.replace(this.header.getNode(),n.render())}this.header=n;this.header.subscribe("changeName",this.onChangeName.bind(this));this.header.subscribe("removeSprint",function(){return i.emit("removeSprint")});this.header.subscribe("completeSprint",function(){return i.emit("completeSprint")});this.header.subscribe("startSprint",function(){return i.emit("startSprint")});this.header.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));this.header.subscribe("toggleVisibilityContent",function(){i.toggleVisibilityContent(i.getContentContainer())});this.header.subscribe("showBurnDownChart",function(){return i.emit("showSprintBurnDownChart")});this.header.subscribe("showCreateMenu",function(e){return i.emit("showSprintCreateMenu",e.getData())})}},{key:"setBlank",value:function e(t){this.blank=new ne(t)}},{key:"setDropzone",value:function e(t){var i=this;this.dropzone=new ae(t);this.dropzone.subscribe("createTask",function(){return i.emit("showInput")})}},{key:"isActive",value:function e(){return this.getStatus()==="active"}},{key:"isPlanned",value:function e(){return this.getStatus()==="planned"}},{key:"isCompleted",value:function e(){return this.getStatus()==="completed"}},{key:"isDisabled",value:function e(){return this.isCompleted()}},{key:"isExpired",value:function e(){var t=new Date(this.dateEnd*1e3);return this.isActive()&&t.getTime()<(new Date).getTime()}},{key:"getEntityType",value:function e(){return"sprint"}},{key:"setItem",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setItem",this).call(this,i);i.setDisableStatus(this.isDisabled());if(i.getNode()){l.Dom.addClass(i.getNode(),"--item-sprint")}}},{key:"removeItem",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"removeItem",this).call(this,i);if(this.isEmpty()){this.showDropzone()}}},{key:"setName",value:function e(t){this.name=l.Type.isString(t)?t:"";if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getName",value:function e(){return this.name}},{key:"setTmpId",value:function e(t){this.tmpId=l.Type.isString(t)?t:""}},{key:"getTmpId",value:function e(){return this.tmpId}},{key:"setSort",value:function e(t){this.sort=l.Type.isInteger(t)?parseInt(t,10):1;if(this.getNode()){this.getNode().dataset.sprintSort=this.sort}}},{key:"getSort",value:function e(){return this.sort}},{key:"setDateStart",value:function e(t){this.dateStart=l.Type.isInteger(t)?parseInt(t,10):0;if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getDateStart",value:function e(){return parseInt(this.dateStart,10)}},{key:"setDateEnd",value:function e(t){this.dateEnd=l.Type.isInteger(t)?parseInt(t,10):0;if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getDateEnd",value:function e(){return parseInt(this.dateEnd,10)}},{key:"setDateStartFormatted",value:function e(t){this.dateStartFormatted=l.Type.isString(t)?t:""}},{key:"getDateStartFormatted",value:function e(){return this.dateStartFormatted}},{key:"setDateEndFormatted",value:function e(t){this.dateEndFormatted=l.Type.isString(t)?t:""}},{key:"getDateEndFormatted",value:function e(){return this.dateEndFormatted}},{key:"setWeekendDaysTime",value:function e(t){this.weekendDaysTime=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getWeekendDaysTime",value:function e(){return this.weekendDaysTime}},{key:"setCompletedStoryPoints",value:function e(t){this.completedStoryPoints.setPoints(t);this.setStats()}},{key:"getCompletedStoryPoints",value:function e(){return this.completedStoryPoints}},{key:"setUncompletedStoryPoints",value:function e(t){this.uncompletedStoryPoints.setPoints(t);this.setStats()}},{key:"getUncompletedStoryPoints",value:function e(){return this.uncompletedStoryPoints}},{key:"setStats",value:function e(){if(this.header){this.header.setStats(this);this.header.setName(this);this.header.setInfo(this)}}},{key:"setItems",value:function e(t){var i=this;if(!l.Type.isArray(t)){return}t.forEach(function(e){var t=G.buildItem(e);t.setDisableStatus(i.isDisabled());t.setShortView(i.getShortView());i.items.set(t.getId(),t)})}},{key:"setInfo",value:function e(t){this.info=l.Type.isPlainObject(t)?t:{sprintGoal:""}}},{key:"setNumberTasks",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setNumberTasks",this).call(this,i);if(this.header){this.header.setInfo(this)}}},{key:"setCompletedTasks",value:function e(t){this.completedTasks=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getCompletedTasks",value:function e(){return this.completedTasks}},{key:"setUncompletedTasks",value:function e(t){this.uncompletedTasks=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getUncompletedTasks",value:function e(){return this.uncompletedTasks}},{key:"setDefaultSprintDuration",value:function e(t){this.defaultSprintDuration=l.Type.isInteger(t)?parseInt(t,10):0}},{key:"getDefaultSprintDuration",value:function e(){return this.defaultSprintDuration}},{key:"getInfo",value:function e(){return this.info}},{key:"getUncompletedItems",value:function e(){var t=new Map;this.items.forEach(function(e){if(!e.isCompleted()){t.set(e.getId(),e)}});return t}},{key:"setStatus",value:function e(t){var i=this;var n=new Set(["planned","active","completed"]);this.status=n.has(t)?t:"planned";this.setHeader(this);this.items.forEach(function(e){e.setDisableStatus(i.isDisabled())});if(this.isDisabled()){if(this.input){this.input.removeYourself()}}}},{key:"getStatus",value:function e(){return this.status}},{key:"disableHeaderButton",value:function e(){if(this.header){this.header.disableButton()}}},{key:"unDisableHeaderButton",value:function e(){if(this.header){this.header.unDisableButton()}}},{key:"updateYourself",value:function e(t){if(t.getName()!==this.getName()){this.setName(t.getName())}if(t.getDateStart()!==this.getDateStart()){this.setDateStart(t.getDateStart())}if(t.getDateEnd()!==this.getDateEnd()){this.setDateEnd(t.getDateEnd())}this.setStoryPoints(t.getStoryPoints().getPoints());this.setCompletedStoryPoints(t.getCompletedStoryPoints().getPoints());this.setUncompletedStoryPoints(t.getUncompletedStoryPoints().getPoints());if(t.getStatus()!==this.getStatus()){this.setStatus(t.getStatus())}if(this.node&&this.header){this.setHeader(this)}}},{key:"removeYourself",value:function e(){l.Dom.remove(this.node);this.node=null}},{key:"render",value:function e(){var t=this.isCompleted()?"":"--open";this.node=l.Tag.render(Ve(),t,this.sort,this.getId(),this.header?this.header.render():"",this.blank?this.blank.render():"",this.dropzone?this.dropzone.render():"",this.listItems?this.listItems.render():"");l.Event.bind(this.getContentContainer(),"transitionend",this.onTransitionEnd.bind(this,this.getContentContainer()));return this.node}},{key:"onAfterAppend",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onAfterAppend",this).call(this);if(this.isEmpty()&&!this.isCompleted()){this.showDropzone()}}},{key:"subscribeToItem",value:function e(i){var n=this;babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"subscribeToItem",this).call(this,i);i.subscribe("showSubTasks",function(e){var t=e.getTarget();var i=e.getData();if(i.isEmpty()){n.emit("getSubTasks",i)}n.appendNodeAfterItem(i.render(),t.getNode());i.show()});i.subscribe("updateCompletedStatus",function(e){babelHelpers.toConsumableArray(n.getItems().values()).map(function(e){if(e.isCompleted()){n.setCompletedTasks(n.getCompletedTasks()+1)}else{n.setUncompletedTasks(n.getUncompletedTasks()-1)}})});i.subscribe("toggleSubTasks",function(e){n.emit("toggleSubTasks",e.getTarget())})}},{key:"onChangeName",value:function e(t){var i=this;var n=t.getTarget();var s=t.getData();n.activateEditMode();var r=s.value.length;s.focus();s.setSelectionRange(r,r);l.Event.bind(s,"keydown",function(e){if(e.isComposing||e.key==="Escape"||e.key==="Enter"){s.blur()}});l.Event.bindOnce(s,"blur",function(){if(i.getName()!==s.value){i.setName(s.value);i.emit("changeSprintName",{sprintId:i.getId(),name:i.getName()})}n.deactivateEditMode()})}},{key:"onChangeSprintDeadline",value:function e(t){var i=t.getData();this.emit("changeSprintDeadline",i);if(i.hasOwnProperty("dateStart")){this.dateStart=parseInt(i.dateStart,10)}else if(i.hasOwnProperty("dateEnd")){this.dateEnd=parseInt(i.dateEnd,10)}}},{key:"onTransitionEnd",value:function e(t){if(t.style.height!=="0px"){t.style.height="auto"}this.emit("toggleVisibilityContent")}},{key:"toggleVisibilityContent",value:function e(t){if(this.isHideContent()){this.showContent(t);l.Dom.addClass(this.node,"--open");if(this.isCompleted()){if(this.getItems().size===0){this.emit("getSprintCompletedItems")}}}else{this.hideContent(t);l.Dom.removeClass(this.node,"--open")}}},{key:"showContent",value:function e(t){this.hideCont=false;t.style.height="".concat(t.scrollHeight,"px");if(this.header){this.header.upTick()}}},{key:"hideContent",value:function e(t){this.hideCont=true;t.style.height="".concat(t.scrollHeight,"px");t.clientHeight;t.style.height="0";if(this.header){this.header.downTick()}}},{key:"isHideContent",value:function e(){return this.hideCont}},{key:"showSprint",value:function e(){if(this.node){this.node.style.display="block"}}},{key:"hideSprint",value:function e(){if(this.node){this.node.style.display="none"}}},{key:"getContentContainer",value:function e(){return this.node.querySelector(".tasks-scrum__content-container")}},{key:"fadeOut",value:function e(){if(!this.isCompleted()){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"fadeOut",this).call(this)}}},{key:"fadeIn",value:function e(){if(!this.isCompleted()){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"fadeIn",this).call(this)}}}],[{key:"buildSprint",value:function e(i){var n=new t(i);n.setHeader(n);if(n.isCompleted()){n.setBlank(n)}n.setDropzone(n);n.setListItems(n);return n}}]);return t}(Q);var Ge=function(){function e(){babelHelpers.classCallCheck(this,e);this.backlog=null;this.sprints=new Map}babelHelpers.createClass(e,[{key:"addBacklog",value:function e(t){if(!(t instanceof le)){throw new Error("EntityStorage: Backlog is in wrong format")}this.backlog=t}},{key:"addSprint",value:function e(t){this.sprints.set(t.getId(),t)}},{key:"removeSprint",value:function e(t){this.sprints.delete(t)}},{key:"getBacklog",value:function e(){if(this.backlog===null){throw new Error("EntityStorage: Backlog not found")}return this.backlog}},{key:"getSprints",value:function e(){return this.sprints}},{key:"getActiveSprint",value:function e(){return babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.isActive()})}},{key:"getPlannedSprints",value:function e(){var t=new Set;this.sprints.forEach(function(e){if(e.isPlanned()){t.add(e)}});return t}},{key:"getSprintsAvailableForFilling",value:function e(t){var i=new Set;this.sprints.forEach(function(e){if(!e.isCompleted()&&t.getId()!==e.getId()){i.add(e)}});return i}},{key:"existCompletedSprint",value:function e(){return!l.Type.isUndefined(babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.isCompleted()}))}},{key:"getAllEntities",value:function e(){var t=new Map;t.set(this.backlog.getId(),this.backlog);babelHelpers.toConsumableArray(this.sprints.values()).map(function(e){return t.set(e.getId(),e)});return t}},{key:"getAllItems",value:function e(){var t=new Map(this.backlog.getItems());var i=this.getActiveSprint();if(i){t=new Map([].concat(babelHelpers.toConsumableArray(t),babelHelpers.toConsumableArray(i.getItems())))}babelHelpers.toConsumableArray(this.getPlannedSprints().values()).map(function(e){return t=new Map([].concat(babelHelpers.toConsumableArray(t),babelHelpers.toConsumableArray(e.getItems())))});return t}},{key:"existsAtLeastOneItem",value:function e(){var t=new Map(this.backlog.getItems());if(t.size>0){return true}var i=babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.getItems().size>0});return!l.Type.isUndefined(i)}},{key:"recalculateItemsSort",value:function e(){this.backlog.recalculateItemsSort();this.sprints.forEach(function(e){return e.recalculateItemsSort()})}},{key:"findEntityByEntityId",value:function e(t){t=parseInt(t,10);if(this.backlog.getId()===t){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.getId()===t})}},{key:"findItemByItemId",value:function e(t){t=parseInt(t,10);var i=this.backlog.getItems();if(i.has(t)){return i.get(t)}var n=babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.getItems().has(t)});if(n){return n.getItems().get(t)}return null}},{key:"findItemBySourceId",value:function e(t){t=parseInt(t,10);var i=new Map(this.backlog.getItems());babelHelpers.toConsumableArray(this.sprints.values()).map(function(e){return i=new Map([].concat(babelHelpers.toConsumableArray(i),babelHelpers.toConsumableArray(e.getItems())))});return babelHelpers.toConsumableArray(i.values()).find(function(e){return e.getSourceId()===t})}},{key:"findEntityByItemId",value:function e(t){t=parseInt(t,10);var i=this.backlog.getItems();if(i.has(t)){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.getItems().has(t)})}}]);return e}();function ze(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);ze=function t(){return e};return e}function Xe(){var e=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-completed-sprints-observer-target"></div>']);Xe=function t(){return e};return e}function We(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-list">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);We=function t(){return e};return e}function je(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-header">\n\t\t\t\t<div class="tasks-scrum__sprints--completed-name">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprints--completed-stats"></div>\n\t\t\t\t<div class="tasks-scrum__sprints--completed-btn ','"></div>\n\t\t\t</div>\n\t\t']);je=function t(){return e};return e}function Ye(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content">\n\t\t\t\t<div class="tasks-scrum__sprints--completed">\n\t\t\t\t\t<div class="tasks-scrum__sprints--completed-title">\n\t\t\t\t\t\t<span class="tasks-scrum__sprints--completed-title-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Ye=function t(){return e};return e}var Je=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.CompletedSprints");i.requestSender=e.requestSender;i.entityStorage=e.entityStorage;i.pageNumber=parseInt(e.pageNumber,10);i.isShortView=e.isShortView;i.statsUploaded=false;i.sprintsUploaded=false;i.loader=null;i.isActiveLoad=false;i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(Ye(),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_TITLE"),this.renderHeader(),this.renderList());var t=this.node.querySelector(".tasks-scrum__sprints--completed-list");l.Event.bind(t,"transitionend",this.onTransitionEnd.bind(this));var i=t.querySelector(".tasks-scrum-completed-sprints-observer-target");this.bindLoad(i);return this.node}},{key:"renderHeader",value:function e(){var t="tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down";var i=l.Tag.render(je(),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_NAME"),t);var n=i.querySelector(".tasks-scrum__sprints--completed-btn");l.Event.bind(n,"click",this.onBtnClick.bind(this));return i}},{key:"onBtnClick",value:function e(t){var i=t.currentTarget;var n=i.classList.contains("--up");if(n){l.Dom.removeClass(i,"--up")}else{l.Dom.addClass(i,"--up");var s=this.node.querySelector(".tasks-scrum__sprints--completed-list");l.Dom.addClass(s,"--visible");if(!this.sprintsUploaded){this.loader=this.showLoader()}}if(n){this.hideList()}else{this.showList()}this.onLoadStats()}},{key:"renderList",value:function e(){return l.Tag.render(We(),this.renderObserverTarget())}},{key:"renderObserverTarget",value:function e(){return l.Tag.render(Xe())}},{key:"renderStats",value:function e(t){return l.Tag.render(ze(),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_STATS").replace("#tasks#",parseInt(t.averageNumberTasks,10)).replace("#storypoints#",parseInt(t.averageNumberStoryPoints,10)).replace("#percent#",parseInt(t.averagePercentageCompletion,10)))}},{key:"bindLoad",value:function e(t){var i=this;if(typeof IntersectionObserver==="undefined"){return}var n=new IntersectionObserver(function(e){if(e[0].isIntersecting===true){if(!i.isActiveLoad){i.onLoadCompletedSprints()}}},{threshold:[0]});n.observe(t)}},{key:"onLoadStats",value:function e(){var t=this;if(this.statsUploaded){return}this.requestSender.getCompletedSprintsStats().then(function(e){t.statsUploaded=true;t.updateStats(e.data)}).catch(function(e){t.requestSender.showErrorAlert(e)})}},{key:"onLoadCompletedSprints",value:function e(){var t=this;this.isActiveLoad=true;if(this.sprintsUploaded){this.loader=this.showLoader()}var i={pageNumber:this.pageNumber};this.requestSender.getCompletedSprints(i).then(function(e){var i=e.data;if(l.Type.isArray(i)&&i.length){t.pageNumber++;t.createSprints(i);t.isActiveLoad=false;t.showList()}t.sprintsUploaded=true;if(t.loader){t.loader.hide()}}).catch(function(e){if(t.loader){t.loader.hide()}t.isActiveLoad=false;t.requestSender.showErrorAlert(e)})}},{key:"showLoader",value:function e(){var t=this.node.querySelector(".tasks-scrum__sprints--completed-list");var i=l.Dom.getPosition(t);var s=new n.Loader({target:t,size:60,mode:"inline",offset:{left:"".concat(i.width/2-30,"px")}});s.show();return s}},{key:"updateStats",value:function e(t){var i=this.node.querySelector(".tasks-scrum__sprints--completed-name");var n=this.node.querySelector(".tasks-scrum__sprints--completed-stats");i.textContent=i.textContent+"- "+parseInt(t.numberSprints,10);l.Dom.append(this.renderStats(t),n)}},{key:"createSprints",value:function e(t){var i=this;var n=this.node.querySelector(".tasks-scrum__sprints--completed-list");t.forEach(function(e){e.isShortView="Y";var t=Ke.buildSprint(e);i.entityStorage.addSprint(t);l.Dom.insertBefore(t.render(),n.querySelector(".tasks-scrum-completed-sprints-observer-target"));t.onAfterAppend();i.emit("createSprint",t)})}},{key:"showList",value:function e(){var t=this.node.querySelector(".tasks-scrum__sprints--completed");var i=this.node.querySelector(".tasks-scrum__sprints--completed-list");l.Dom.addClass(t,"--open");i.style.height="".concat(i.scrollHeight,"px");this.emit("adjustWidth")}},{key:"hideList",value:function e(){var t=this.node.querySelector(".tasks-scrum__sprints--completed");var i=this.node.querySelector(".tasks-scrum__sprints--completed-list");l.Dom.removeClass(t,"--open");i.style.height="".concat(i.scrollHeight,"px");i.clientHeight;i.style.height="0"}},{key:"onTransitionEnd",value:function e(){var t=this.node.querySelector(".tasks-scrum__sprints--completed-list");var i=t.style.height==="0px";if(i){l.Dom.removeClass(t,"--visible")}else{t.style.height="auto"}this.emit("adjustWidth")}}]);return t}(u.EventEmitter);function Qe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content">\n\t\t\t\t<div class="tasks-scrum__sprints--new-sprint">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Qe=function t(){return e};return e}function Ze(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints --scrollbar">\n\t\t\t\t<div class="tasks-scrum__sprints--active ','">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprints--planned ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);Ze=function t(){return e};return e}var $e=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.DomBuilder");i.requestSender=e.requestSender;i.entityStorage=e.entityStorage;i.defaultSprintDuration=e.defaultSprintDuration;i.pageNumberToCompletedSprints=e.pageNumberToCompletedSprints;i.displayPriority=e.displayPriority;i.isShortView=e.isShortView;return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.scrumContainer=t;this.setWidthPriority(this.displayPriority);l.Dom.append(this.entityStorage.getBacklog().render(),this.scrumContainer);this.entityStorage.getBacklog().onAfterAppend();l.Dom.append(this.renderSprintsContainer(),this.scrumContainer);this.entityStorage.getSprints().forEach(function(e){if(!e.isCompleted()){e.onAfterAppend()}});this.emit("setDraggable");this.adjustSprintListWidth()}},{key:"renderSprintsContainer",value:function e(){var t=this;this.completedSprints=new Je({requestSender:this.requestSender,entityStorage:this.entityStorage,pageNumber:this.pageNumberToCompletedSprints,isShortView:this.isShortView});this.completedSprints.subscribe("createSprint",function(e){t.emit("createSprint",e.getData())});this.completedSprints.subscribe("adjustWidth",function(){return t.adjustSprintListWidth()});var i=this.entityStorage.getActiveSprint();var n=this.entityStorage.getPlannedSprints();this.sprintsNode=l.Tag.render(Ze(),i?"":"--empty",i?i.render():"",n.size?"":"--empty",babelHelpers.toConsumableArray(n.values()).map(function(e){return e.render()}),this.renderSprintDropzone(),this.entityStorage.existCompletedSprint()?this.completedSprints.render():"");this.updatePlannedSprints(n,!l.Type.isUndefined(i));l.Event.bind(this.sprintsNode,"scroll",this.onSprintsScroll.bind(this));return this.sprintsNode}},{key:"renderSprintDropzone",value:function e(){this.sprintDropzone=l.Tag.render(Qe(),l.Loc.getMessage("TASKS_SCRUM_PLAN_SPRINT_DROPZONE"));l.Event.bind(this.sprintDropzone,"click",this.createSprint.bind(this));return this.sprintDropzone}},{key:"setWidthPriority",value:function e(t){if(t==="backlog"){l.Dom.addClass(this.scrumContainer,"--width-priority-backlog")}else{l.Dom.removeClass(this.scrumContainer,"--width-priority-backlog")}}},{key:"setShortView",value:function e(t){this.isShortView=t}},{key:"getSprintsContainer",value:function e(){return this.sprintsNode}},{key:"getSprintDropzone",value:function e(){return this.sprintDropzone}},{key:"isSprintDropzone",value:function e(t){if(t.firstElementChild){return t.firstElementChild.classList.contains("tasks-scrum__sprints--new-sprint")}else{return false}}},{key:"createSprint",value:function e(){var t=this;var i=this.entityStorage.getSprints().size;var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_NAME").replace("%s",i+1);var s=Math.floor(Date.now()/1e3);var r=Math.floor(Date.now()/1e3)+parseInt(this.defaultSprintDuration,10);var a=this.entityStorage.getPlannedSprints().size+1;var o={tmpId:l.Text.getRandom(),name:n,sort:a+1,dateStart:s,dateEnd:r};this.emit("beforeCreateSprint",o);return this.requestSender.createSprint(o).then(function(e){var i=e.data;i.isShortView=t.isShortView;var n=Ke.buildSprint(i);t.entityStorage.addSprint(n);t.appendToPlannedContainer(n);t.scrollToSprint(n);t.emit("createSprint",n);return n}).catch(function(e){t.requestSender.showErrorAlert(e)})}},{key:"createSprintNode",value:function e(t){t.setShortView(this.isShortView);this.entityStorage.addSprint(t);this.appendToPlannedContainer(t);this.emit("createSprintNode",t)}},{key:"appendToPlannedContainer",value:function e(t){var i=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--planned");l.Dom.append(t.render(),i);l.Dom.removeClass(i,"--empty");t.onAfterAppend();this.adjustSprintListWidth();this.updatePlannedSprints(this.entityStorage.getPlannedSprints(),!l.Type.isUndefined(this.entityStorage.getActiveSprint()))}},{key:"moveSprintToActiveListNode",value:function e(t){var i=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--active");l.Dom.append(t.getNode(),i);l.Dom.removeClass(i,"--empty");this.updatePlannedSprints(this.entityStorage.getPlannedSprints(),true)}},{key:"appendItemAfterItem",value:function e(t,i){if(i.nextElementSibling){l.Dom.insertBefore(t,i.nextElementSibling)}else{l.Dom.append(t,i.parentElement)}}},{key:"onSprintsScroll",value:function e(){this.emit("sprintsScroll")}},{key:"adjustSprintListWidth",value:function e(){var t=this.getSprintsContainer().scrollHeight>this.getSprintsContainer().clientHeight;if(t){l.Dom.addClass(this.getSprintsContainer(),"--scrollbar")}else{l.Dom.removeClass(this.getSprintsContainer(),"--scrollbar")}}},{key:"scrollToSprint",value:function e(t){window.scrollTo({top:240,behavior:"smooth"});var i=this.getSprintsContainer();var n=l.Dom.getRelativePosition(t.getNode(),i).bottom;i.scrollTo({top:i.scrollTop+n,behavior:"smooth"})}},{key:"updatePlannedSprints",value:function e(t,i){if(i){t.forEach(function(e){e.disableHeaderButton()})}else{t.forEach(function(e){e.unDisableHeaderButton()})}}},{key:"getScrumContainer",value:function e(){return this.scrumContainer}},{key:"blockScrumContainerSelect",value:function e(){l.Dom.addClass(this.scrumContainer,"--select-none")}},{key:"unblockScrumContainerSelect",value:function e(){l.Dom.removeClass(this.scrumContainer,"--select-none")}}]);return t}(u.EventEmitter);function et(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__action-panel--container tasks-scrum__action-panel--scope" tabindex="1">\n\t\t\t\t<div class="tasks-scrum__action-panel">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);et=function t(){return e};return e}function tt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-remove ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t']);tt=function t(){return e};return e}function it(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-decomposition ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);it=function t(){return e};return e}function nt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-epics "," ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);nt=function t(){return e};return e}function st(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-tags "," ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);st=function t(){return e};return e}function rt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-backlog ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);rt=function t(){return e};return e}function at(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-sprint "," ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);at=function t(){return e};return e}function ot(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-move "," ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);ot=function t(){return e};return e}function lt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-dod ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);lt=function t(){return e};return e}function ut(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-attachment ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);ut=function t(){return e};return e}function ct(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="'," tasks-scrum__action-panel--btn-task ",'">\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t']);ct=function t(){return e};return e}function dt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__action-panel--selected-btn tasks-scrum__action-panel--btn-selected">\n\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t','\n\t\t\t\t</span>\n\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t']);dt=function t(){return e};return e}var ht=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.ActionPanel");i.entity=e.entity;i.item=e.item;i.bindElement=i.item.getNode();i.itemList=babelHelpers.objectSpread({},{task:{activity:false},attachment:{activity:false},dod:{activity:false},move:{activity:false},sprint:{activity:false},backlog:{activity:false},tags:{activity:false},epic:{activity:false},decomposition:{activity:false},remove:{activity:false}},e.itemList);i.node=null;i.isBlockBlur=false;i.observeBindElement();return i}babelHelpers.createClass(t,[{key:"show",value:function e(){this.node=this.calculatePanelPosition(this.createActionPanel());this.bindItems();l.Dom.append(this.node,document.body)}},{key:"destroy",value:function e(){l.Dom.remove(this.node);this.node=null;if(this.observer){this.observer.disconnect()}}},{key:"getNode",value:function e(){return this.node}},{key:"getItem",value:function e(){return this.item}},{key:"createActionPanel",value:function e(){var t="";var i="";var n="";var s="";var r="";var a="";var o="";var u="";var c="";var d="";var h="tasks-scrum__action-panel--btn";var p="tasks-scrum__action-panel--btn-with-arrow";var v=l.Tag.render(dt(),this.getSelectedText(this.entity.getGroupModeItems().size));if(this.itemList.task.activity){var g=this.itemList.task.disable===true?"--disabled":"";t=l.Tag.render(ct(),h,g,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK"))}if(this.itemList.attachment.activity){var m=this.itemList.attachment.disable===true?"--disabled":"";i=l.Tag.render(ut(),h,m)}if(this.itemList.dod.activity){var f=this.itemList.dod.disable===true?"--disabled":"";n=l.Tag.render(lt(),h,f,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_DOD"))}if(this.itemList.move.activity){var b=this.itemList.move.disable===true?"--disabled":"";s=l.Tag.render(ot(),h,p,b,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE"))}if(this.itemList.sprint.activity){var k=this.itemList.sprint.disable===true?"--disabled":"";r=l.Tag.render(at(),h,p,k,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT"))}if(this.itemList.backlog.activity){var y=this.itemList.backlog.disable===true?"--disabled":"";a=l.Tag.render(rt(),h,y,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG"))}if(this.itemList.tags.activity){var S=this.itemList.tags.disable===true?"--disabled":"";o=l.Tag.render(st(),h,p,S,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAGS"))}if(this.itemList.epic.activity){var I=this.itemList.epic.disable===true?"--disabled":"";u=l.Tag.render(nt(),h,p,I,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC"))}if(this.itemList.decomposition.activity){var T=this.itemList.decomposition.disable===true?"--disabled":"";c=l.Tag.render(it(),h,T)}if(this.itemList.remove.activity){var C=this.itemList.remove.disable===true?"--disabled":"";d=l.Tag.render(tt(),h,C)}return l.Tag.render(et(),v,t,i,n,s,r,a,o,u,c,d)}},{key:"bindItems",value:function e(){var t=this;var i=this.node.querySelector(".tasks-scrum__action-panel--btn-selected");l.Event.bind(i.querySelector(".tasks-scrum__action-panel--icon"),"click",function(){return t.emit("unSelect")});if(this.itemList.task.activity&&this.itemList.task.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-task"),"click",this.itemList.task.callback)}if(this.itemList.attachment.activity&&this.itemList.attachment.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-attachment"),"click",this.itemList.attachment.callback)}if(this.itemList.dod.activity&&this.itemList.dod.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-dod"),"click",this.itemList.dod.callback)}if(this.itemList.move.activity&&this.itemList.move.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-move"),"click",this.itemList.move.callback)}if(this.itemList.sprint.activity&&this.itemList.sprint.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-sprint"),"click",this.itemList.sprint.callback)}if(this.itemList.backlog.activity&&this.itemList.backlog.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-backlog"),"click",this.itemList.backlog.callback)}if(this.itemList.tags.activity&&this.itemList.tags.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-tags"),"click",this.itemList.tags.callback)}if(this.itemList.epic.activity&&this.itemList.epic.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-epics"),"click",this.itemList.epic.callback)}if(this.itemList.decomposition.activity&&this.itemList.decomposition.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-decomposition"),"click",this.itemList.decomposition.callback)}if(this.itemList.remove.activity&&this.itemList.remove.disable!==true){l.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-remove"),"click",this.itemList.remove.callback)}}},{key:"getSelectedText",value:function e(t){return l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SELECTED")+parseInt(t,10)}},{key:"observeBindElement",value:function e(){var t=this;if(typeof IntersectionObserver==="undefined"){return}this.observer=new IntersectionObserver(function(e){if(e[0].isIntersecting===true){t.displayPanel()}else{t.hidePanel()}},{threshold:[0]});this.observer.observe(this.bindElement)}},{key:"displayPanel",value:function e(){if(!l.Dom.isShown(this.getNode())){l.Dom.style(this.getNode(),"display","block")}}},{key:"hidePanel",value:function e(){if(l.Dom.isShown(this.getNode())){l.Dom.style(this.getNode(),"display","none")}}},{key:"calculatePanelPosition",value:function e(t){var i=l.Dom.getPosition(this.bindElement);var n="".concat(i.top,"px");var s="".concat(i.left,"px");var r=t.cloneNode(true);r.style.visibility="hidden";r.style.top="".concat(i.top,"px");r.style.left="".concat(i.left,"px");l.Dom.append(r,document.body);if(this.isPanelWiderThanViewport(r)){var a=r.getBoundingClientRect();var o=window.innerWidth||document.documentElement.clientWidth;s="".concat(a.left-(a.right-o+40),"px")}l.Dom.remove(r);t.style.top=n;t.style.left=s;t.style.zIndex=1100;this.removeLastSeparator(t);return t}},{key:"isPanelWiderThanViewport",value:function e(t){var i=t.getBoundingClientRect();var n=window.innerWidth||document.documentElement.clientWidth;return i.right>n}},{key:"calculatePanelTopPosition",value:function e(){if(!this.getNode()){return}var t=l.Dom.getPosition(this.bindElement);this.getNode().style.top="".concat(t.top,"px")}},{key:"removeLastSeparator",value:function e(t){var i=t.querySelector(".tasks-scrum__action-panel");if(l.Dom.hasClass(i.lastElementChild,"tasks-scrum__action-panel--separator")){l.Dom.remove(i.lastElementChild)}}}]);return t}(u.EventEmitter);function pt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--nav-linked tasks-scrum__scope">\n\t\t\t\t<div class="tasks-scrum__item--nav-linked-close"></div>\n\t\t\t\t<div class="tasks-scrum__item--nav-linked-block">\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-prev"></div>\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-num-container --visible">\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-num">',"/",'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-next"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);pt=function t(){return e};return e}var vt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.SearchArrows");i.list=e.list;i.currentPosition=parseInt(e.currentPosition,10);i.node=null;return i}babelHelpers.createClass(t,[{key:"render",value:function e(){this.node=l.Tag.render(pt(),this.currentPosition,this.list.size);var t=this.node.querySelector(".tasks-scrum__item--nav-linked-close");var i=this.node.querySelector(".tasks-scrum__item--nav-linked-prev");var n=this.node.querySelector(".tasks-scrum__item--nav-linked-next");l.Event.bind(t,"click",this.onClose.bind(this));l.Event.bind(i,"click",this.onPrev.bind(this));l.Event.bind(n,"click",this.onNext.bind(this));return this.node}},{key:"getNode",value:function e(){return this.node}},{key:"updateCurrentPosition",value:function e(t){this.currentPosition=parseInt(t,10);if(this.node){this.node.querySelector(".tasks-scrum__item--nav-linked-num").textContent="".concat(this.currentPosition,"/").concat(this.list.size)}}},{key:"remove",value:function e(){l.Dom.remove(this.node);this.node=null}},{key:"onClose",value:function e(){this.emit("close")}},{key:"onPrev",value:function e(){this.emit("prev")}},{key:"onNext",value:function e(){this.emit("next")}}]);return t}(u.EventEmitter);var gt=function(){function e(t){babelHelpers.classCallCheck(this,e);this.planBuilder=t.planBuilder;this.entityStorage=t.entityStorage}babelHelpers.createClass(e,[{key:"scrollToItem",value:function e(t){if(this.isItemInViewport(t)){return}var i=112;if(this.isBacklogItem(t)){var n=this.entityStorage.getBacklog().getListItemsNode();var s=l.Dom.getRelativePosition(t.getNode(),n).top;n.scrollTo({top:n.scrollTop+s-i,behavior:"smooth"})}else{var r=this.planBuilder.getSprintsContainer();var a=l.Dom.getRelativePosition(t.getNode(),r).top;r.scrollTo({top:r.scrollTop+a-i,behavior:"smooth"})}}},{key:"isItemInViewport",value:function e(t){var i=t.getNode().getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"isBacklogItem",value:function e(t){return this.entityStorage.getBacklog().hasItem(t)}}]);return e}();var mt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.SearchItems");i.planBuilder=e.planBuilder;i.entityStorage=e.entityStorage;i.scroller=new gt({planBuilder:i.planBuilder,entityStorage:i.entityStorage});i.active=false;i.list=new Set;i.currentIndex=0;i.arrows=null;return i}babelHelpers.createClass(t,[{key:"start",value:function e(t,i){this.active=true;this.setList(i);this.fadeOutAll();if(!this.isBacklogItem(t)){this.scroller.scrollToItem(this.getCurrent())}if(!t.isDisabled()){this.updateCurrentIndexByItem(t);this.activateCurrent(t)}this.list.forEach(function(e){e.activateLinkedMode()});this.showArrows()}},{key:"stop",value:function e(){this.active=false;this.currentIndex=0;this.fadeInAll();this.cleanList();this.removeArrows()}},{key:"setList",value:function e(t){var i=this;this.list=new Set;var n=this.entityStorage.getAllItems();t.forEach(function(e){if(n.has(e)){i.list.add(n.get(e))}})}},{key:"isActive",value:function e(){return this.active}},{key:"isBacklogItem",value:function e(t){return this.entityStorage.getBacklog().hasItem(t)}},{key:"getCurrent",value:function e(){return babelHelpers.toConsumableArray(this.list.values())[this.currentIndex]}},{key:"updateCurrentIndexByItem",value:function e(t){var i=this;this.deactivateCurrent(this.getCurrent());babelHelpers.toConsumableArray(this.list.values()).forEach(function(e,n){if(t.getId()===e.getId()){i.currentIndex=n}});this.updateArrows()}},{key:"moveToPrev",value:function e(){this.deactivateCurrent(this.getCurrent());this.currentIndex--;if(this.currentIndex<0){this.currentIndex=this.list.size-1}this.updateArrows();var t=this.getCurrent();this.scroller.scrollToItem(t);this.activateCurrent(t)}},{key:"moveToNext",value:function e(){this.deactivateCurrent(this.getCurrent());this.currentIndex++;if(this.currentIndex===this.list.size){this.currentIndex=0}this.updateArrows();var t=this.getCurrent();this.scroller.scrollToItem(t);this.activateCurrent(t)}},{key:"activateCurrent",value:function e(t){t.activateCurrentLinkedMode(t)}},{key:"deactivateCurrent",value:function e(){this.list.forEach(function(e){e.deactivateCurrentLinkedMode()})}},{key:"fadeOutAll",value:function e(){this.entityStorage.getBacklog().fadeOut();this.entityStorage.getBacklog().setActiveLoadItems(true);var t=this.entityStorage.getActiveSprint();if(t){t.fadeOut();t.setActiveLoadItems(true);if(t.isHideContent()){t.toggleVisibilityContent(t.getContentContainer())}}this.entityStorage.getPlannedSprints().forEach(function(e){e.fadeOut();e.setActiveLoadItems(true);if(e.isHideContent()){e.toggleVisibilityContent(e.getContentContainer())}})}},{key:"fadeInAll",value:function e(){this.entityStorage.getBacklog().fadeIn();var t=this.entityStorage.getActiveSprint();if(t){t.fadeIn()}this.entityStorage.getPlannedSprints().forEach(function(e){e.fadeIn()})}},{key:"deactivateGroupMode",value:function e(){this.entityStorage.getBacklog().deactivateGroupMode();var t=this.entityStorage.getActiveSprint();if(t){t.deactivateGroupMode()}this.entityStorage.getPlannedSprints().forEach(function(e){e.deactivateGroupMode()})}},{key:"showArrows",value:function e(){this.arrows=new vt({currentPosition:this.currentIndex+1,list:this.list});this.arrows.subscribe("close",this.stop.bind(this));this.arrows.subscribe("prev",this.moveToPrev.bind(this));this.arrows.subscribe("next",this.moveToNext.bind(this));l.Dom.append(this.arrows.render(),document.body);this.adjustArrowsPosition()}},{key:"updateArrows",value:function e(){if(this.arrows){this.arrows.updateCurrentPosition(this.currentIndex+1)}}},{key:"adjustArrowsPosition",value:function e(){var t=l.Dom.getPosition(this.arrows.getNode());var i=l.Dom.getPosition(this.entityStorage.getBacklog().getNode());this.arrows.getNode().style.top="".concat(i.height/2+(i.top-t.height),"px");this.arrows.getNode().style.left="".concat(i.left-(t.width/2+16),"px")}},{key:"cleanList",value:function e(){this.list.forEach(function(e){return e.deactivateLinkedMode()});this.list=new Set}},{key:"removeArrows",value:function e(){this.arrows.remove()}},{key:"isClickInside",value:function e(t){var e=false;var i=this.entityStorage.getBacklog();if(i.getNode().contains(t)){e=true}var n=this.entityStorage.getActiveSprint();if(n&&n.getNode().contains(t)){e=true}if(this.arrows&&this.arrows.getNode().contains(t)){e=true}this.entityStorage.getPlannedSprints().forEach(function(i){if(i.getNode().contains(t)){e=true}});return e}}]);return t}(u.EventEmitter);var ft=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.planBuilder=t.planBuilder;this.entityStorage=t.entityStorage;this.bindHandlers()}babelHelpers.createClass(e,[{key:"bindHandlers",value:function e(){this.planBuilder.subscribe("setDraggable",this.onSetDraggable.bind(this))}},{key:"onSetDraggable",value:function e(t){}},{key:"onSprintMove",value:function e(t){var i=this;var n=t.getData();if(!n.endContainer){return}this.requestSender.updateSprintSort({sortInfo:this.calculateSprintSort()}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"calculateSprintSort",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i={};var n=this.entityStorage.getPlannedSprints();var s=1+t;n.forEach(function(e){e.setSort(s);i[e.getId()]={sort:s};s++});return i}}]);return e}();var bt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.sidePanel=e.sidePanel;i.groupId=parseInt(e.groupId,10);i.views=e.views;return i}babelHelpers.createClass(t,[{key:"showStartForm",value:function e(t){var i=this;this.sidePanel.showByExtension("Sprint-Start-Form",{groupId:this.groupId,sprintId:t.getId()}).then(function(e){if(e){e.subscribe("afterStart",function(e){location.href=i.views["activeSprint"].url})}})}},{key:"showCompletionForm",value:function e(){var t=this;this.sidePanel.showByExtension("Sprint-Completion-Form",{groupId:this.groupId}).then(function(e){if(e){e.subscribe("afterComplete",function(e){location.href=t.views["plan"].url});e.subscribe("taskClick",function(e){t.emit("showTask",e.getData())})}})}},{key:"showBurnDownChart",value:function e(t){this.sidePanel.showByExtension("Burn-Down-Chart",{groupId:this.groupId,sprintId:t.getId()})}}]);return t}(u.EventEmitter);var kt=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage}babelHelpers.createClass(e,[{key:"updateCounters",value:function e(t){var i=this;var n={entityIds:babelHelpers.toConsumableArray(t.keys())};this.requestSender.getEntityCounters(n).then(function(e){Object.keys(e.data).forEach(function(i){i=parseInt(i,10);var n=t.get(i);var s=e.data[i];n.setStoryPoints(s.storyPoints);n.setNumberTasks(s.numberTasks);if(n.isActive()){n.setCompletedStoryPoints(s.completedStoryPoints);n.setUncompletedStoryPoints(s.uncompletedStoryPoints)}})}).catch(function(e){i.requestSender.showErrorAlert(e)})}}]);return e}();var yt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.ItemMover");i.requestSender=e.requestSender;i.planBuilder=e.planBuilder;i.entityStorage=e.entityStorage;i.entityCounters=e.entityCounters;i.scroller=new gt({planBuilder:i.planBuilder,entityStorage:i.entityStorage});i.bindHandlers();return i}babelHelpers.createClass(t,[{key:"bindHandlers",value:function e(){var t=this;this.planBuilder.subscribe("setDraggable",this.onSetDraggable.bind(this));this.planBuilder.subscribe("createSprintNode",function(e){var i=e.getData();t.draggableItems.addContainer(i.getListItemsNode());t.draggableItems.addDropzone(i.getDropzone())})}},{key:"onSetDraggable",value:function e(t){var i=this.entityStorage.getBacklog();var n=[i.getListItemsNode()];var s=[i.getDropzone(),this.planBuilder.getSprintDropzone()];this.entityStorage.getSprints().forEach(function(e){if(!e.isDisabled()){n.push(e.getListItemsNode());if(e.getDropzone()){s.push(e.getDropzone())}}});this.draggableItems=new a.Draggable({container:n,dropzone:s,draggable:".tasks-scrum__item--drag",dragElement:".tasks-scrum__item",type:a.Draggable.DROP_PREVIEW,delay:300});this.draggableItems.subscribe("beforeStart",this.onBeforeDragStart.bind(this));this.draggableItems.subscribe("start",this.onDragStart.bind(this));this.draggableItems.subscribe("end",this.onDragEnd.bind(this));this.draggableItems.subscribe("drop",this.onDropEnd.bind(this));this.draggableItems.subscribe("container:enter",this.onDragContainerEnter.bind(this));this.draggableItems.subscribe("container:out",this.onDragContainerOut.bind(this));this.draggableItems.subscribe("out",this.onDragOut.bind(this))}},{key:"onBeforeDragStart",value:function e(t){var i=t.getData();if(!i.source){return}var n=parseInt(i.source.dataset.id,10);var s=this.entityStorage.findItemByItemId(n);if(s.isSubTask()||s.isDisabled()){t.preventDefault()}else{if(s.isShownSubTasks()){s.hideSubTasks()}this.entityStorage.getAllEntities().forEach(function(e){e.deactivateGroupMode();e.getItems().forEach(function(e){if(e.isShownSubTasks()){e.hideSubTasks()}})});this.emit("dragStart")}}},{key:"onDragStart",value:function e(t){this.planBuilder.blockScrumContainerSelect();var i=t.getData();var n=i.sourceContainer;var s=parseInt(n.dataset.entityId,10);var r=this.entityStorage.findEntityByEntityId(s);if(!r.isBacklog()){var a=this.entityStorage.getBacklog();if(a.isEmpty()){a.showDropzone();a.hideBlank()}}}},{key:"onDragEnd",value:function e(t){this.planBuilder.unblockScrumContainerSelect();var i=t.getData();var n=i.sourceContainer;var s=i.endContainer;if(!s){return}var r=parseInt(n.dataset.entityId,10);var a=parseInt(s.dataset.entityId,10);var o=this.entityStorage.findEntityByEntityId(r);var l=this.entityStorage.findEntityByEntityId(a);if(o&&l){var u=i.source;var c=parseInt(u.dataset.id,10);var d=this.entityStorage.findItemByItemId(c);if(d){this.onItemMove(d,o,l)}o.adjustListItemsWidth();l.adjustListItemsWidth()}if(!o.isBacklog()){var h=this.entityStorage.getBacklog();if(h.isEmpty()){h.showDropzone()}}this.planBuilder.adjustSprintListWidth()}},{key:"onDropEnd",value:function e(t){var i=this;var n=t.getData();var s=n.dropzone;var r=n.sourceContainer;var a=parseInt(r.dataset.entityId,10);var o=parseInt(s.dataset.entityId,10);var l=this.entityStorage.findEntityByEntityId(a);var u=this.entityStorage.findEntityByEntityId(o);var c=n.source;var d=parseInt(c.dataset.id,10);var h=this.entityStorage.findItemByItemId(d);if(this.planBuilder.isSprintDropzone(s)){this.planBuilder.createSprint().then(function(e){i.addSprintContainers(e);i.moveTo(l,e,h)})}else{if(l&&u){var p=n.source;var v=parseInt(p.dataset.id,10);var g=this.entityStorage.findItemByItemId(v);if(g){this.onItemMove(g,l,u,true)}l.adjustListItemsWidth();u.adjustListItemsWidth()}this.planBuilder.adjustSprintListWidth()}if(!l.isBacklog()){var m=this.entityStorage.getBacklog();if(m.isEmpty()){m.showDropzone()}}}},{key:"addSprintContainers",value:function e(t){if(!t.isDisabled()){this.draggableItems.addContainer(t.getListItemsNode());this.draggableItems.addDropzone(t.getDropzone())}}},{key:"onDragContainerEnter",value:function e(t){var i=t.getData();var n=i.sourceContainer;var s=i.enter;var r=this.draggableItems.getDropPreview();var a=n.isEqualNode(s)?parseInt(r.style.width,10):s.clientWidth;l.Dom.style(r,{width:"".concat(a,"px"),top:"".concat(parseInt(r.style.top,10)+s.scrollTop,"px")})}},{key:"onDragContainerOut",value:function e(t){var i=t.getData();var n=this.draggableItems.getDropPreview();l.Dom.style(n,{width:i.out.clientWidth+"px"})}},{key:"onDragOut",value:function e(t){var i=t.getData();if(l.Type.isUndefined(i.outContainer)){return}var n=this.draggableItems.getDropPreview();l.Dom.style(n,{width:"".concat(i.out.offsetWidth,"px"),height:"".concat(i.out.offsetHeight,"px"),top:"".concat(parseInt(n.style.top,10)+i.outContainer.scrollTop,"px")})}},{key:"onItemMove",value:function e(t,i,n,s){var r=this;if(i.getId()===n.getId()){this.moveInCurrentContainer(t,i)}else{var a=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");this.onMoveConfirm(i,a).then(function(){if(s){l.Dom.insertBefore(t.getNode(),n.getLoaderNode())}r.moveInAnotherContainer(t,i,n)}).catch(function(){l.Dom.insertBefore(t.getNode(),i.getListItemsNode().children[t.getSort()])})}}},{key:"onMoveItemUpdate",value:function e(t,i,n){var s=this;this.requestSender.updateItem({itemId:n.getId(),entityId:i.getId(),sourceEntityId:t.getId(),fromActiveSprint:t.getEntityType()==="sprint"&&t.isActive()?"Y":"N",toActiveSprint:i.getEntityType()==="sprint"&&i.isActive()?"Y":"N",sortInfo:babelHelpers.objectSpread({},this.calculateSort(i.getListItemsNode(),new Set([n.getId()]),true),this.calculateSort(t.getListItemsNode(),new Set,true))}).then(function(){s.updateEntityCounters(t,i)}).catch(function(e){s.requestSender.showErrorAlert(e)})}},{key:"onMoveConfirm",value:function e(t,i){return new Promise(function(e,n){if(t.isActive()){r.MessageBox.confirm(i,function(t){t.close();e()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"),function(e){e.close();n()})}else{e()}})}},{key:"moveItem",value:function e(t,i){var n=this;var s=this.entityStorage.findEntityByItemId(t.getId());var r=[];if(!s.isFirstItem(t)){r.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP"),onclick:function e(t,i){var r=s.getGroupModeItems();var a=babelHelpers.toConsumableArray(r.values()).sort(function(e,t){if(e.getSort()<t.getSort())return 1;if(e.getSort()>t.getSort())return-1});var o=new Set;a.forEach(function(e){o.add(e.getId());if(e.isParentTask()&&e.isShownSubTasks()){e.hideSubTasks()}n.moveItemToUp(e,s.getListItemsNode(),false);e.activateBlinking()});n.scroller.scrollToItem(a.values().next().value);n.requestSender.updateItemSort({sortInfo:n.calculateSort(s.getListItemsNode(),o)}).catch(function(e){n.requestSender.showErrorAlert(e)});s.deactivateGroupMode();i.getMenuWindow().close()}})}if(!s.isLastItem(t)){r.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN"),onclick:function e(t,i){var r=s.getGroupModeItems();var a=babelHelpers.toConsumableArray(r.values()).sort(function(e,t){if(e.getSort()>t.getSort())return 1;if(e.getSort()<t.getSort())return-1});var o=new Set;a.forEach(function(e){o.add(e.getId());if(e.isParentTask()&&e.isShownSubTasks()){e.hideSubTasks()}n.moveItemToDown(e,s.getListItemsNode(),false);e.activateBlinking()});n.scroller.scrollToItem(a.values().next().value);n.requestSender.updateItemSort({sortInfo:n.calculateSort(s.getListItemsNode(),o)}).catch(function(e){n.requestSender.showErrorAlert(e)});s.deactivateGroupMode();i.getMenuWindow().close()}})}this.showMoveItemMenu(t,i,r)}},{key:"moveItemToUp",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;l.Dom.insertBefore(t.getNode(),i.firstElementChild);if(n){this.updateItemsSort(t,i)}}},{key:"moveItemToDown",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;l.Dom.insertBefore(t.getNode(),i.lastElementChild);if(n){this.updateItemsSort(t,i)}}},{key:"updateItemsSort",value:function e(t,i){var n=this;this.requestSender.updateItem({itemId:t.getId(),sortInfo:babelHelpers.objectSpread({},this.calculateSort(i,new Set([t.getId()])))}).catch(function(e){n.requestSender.showErrorAlert(e)})}},{key:"moveInCurrentContainer",value:function e(t,i){var n=this;this.requestSender.updateItemSort({sortInfo:this.calculateSort(i.getListItemsNode(),new Set([t.getId()]))}).catch(function(e){n.requestSender.showErrorAlert(e)})}},{key:"moveInAnotherContainer",value:function e(t,i,n){var s=this;this.moveItemFromEntityToEntity(t,i,n);this.requestSender.updateItemSort({entityId:n.getId(),itemId:t.getId(),sourceEntityId:i.getId(),fromActiveSprint:i.getEntityType()==="sprint"&&i.isActive()?"Y":"N",toActiveSprint:n.getEntityType()==="sprint"&&n.isActive()?"Y":"N",sortInfo:this.calculateSort(n.getListItemsNode(),new Set([t.getId()]),true)}).then(function(){return s.updateEntityCounters(i,n)}).catch(function(e){return s.requestSender.showErrorAlert(e)})}},{key:"updateEntityCounters",value:function e(t,i){var n=new Map;n.set(t.getId(),t);if(i){n.set(i.getId(),i)}this.entityCounters.updateCounters(n)}},{key:"calculateSort",value:function e(t,i){var n=this;var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var r={};var a=babelHelpers.toConsumableArray(t.querySelectorAll("[data-sort]"));var o=1;a.forEach(function(e){var a=parseInt(e.dataset.id,10);var u=n.entityStorage.findItemByItemId(a);if(u&&!u.isSubTask()){var c=l.Text.getRandom();var d=o!==u.getSort();u.setSort(o);r[a]={sort:o};if(s){r[a].entityId=t.dataset.entityId;d=true}if(d&&i&&i.has(a)){r[a].tmpId=c;r[a].updatedItemId=a}e.dataset.sort=o;o++}});this.emit("calculateSort",r);return r}},{key:"moveToAnotherEntity",value:function e(t,i,n,s){var r=this;var a=l.Type.isNull(n);var o=a?this.entityStorage.getSprintsAvailableForFilling(t):null;if(a){if(o.size>1){this.showListSprintsToMove(t,i,s)}else{if(o.size===0){this.planBuilder.createSprint().then(function(e){r.moveToWithGroupMode(t,e,i,true,false)})}else{o.forEach(function(e){r.moveToWithGroupMode(t,e,i,true,false)})}}}else{var u=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE");this.onMoveConfirm(t,u).then(function(){r.moveToWithGroupMode(t,n,i,false,false)}).catch(function(){})}}},{key:"moveToWithGroupMode",value:function e(t,i,n){var s=this;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var o=t.getGroupModeItems();if(!o.has(n.getId())){o.set(n.getId(),n)}var l=babelHelpers.toConsumableArray(o.values()).sort(function(e,t){if(r){if(e.getSort()>t.getSort())return 1;if(e.getSort()<t.getSort())return-1}else{if(e.getSort()<t.getSort())return 1;if(e.getSort()>t.getSort())return-1}});var u=[];var c=new Set;l.forEach(function(e){s.moveTo(t,i,e,r,a);c.add(e.getId());u.push({itemId:e.getId(),entityId:i.getId(),sourceEntityId:t.getId(),fromActiveSprint:t.getEntityType()==="sprint"&&t.isActive()?"Y":"N",toActiveSprint:i.getEntityType()==="sprint"&&i.isActive()?"Y":"N"});e.activateBlinking()});this.scroller.scrollToItem(l.values().next().value);this.requestSender.updateItems({items:u,sortInfo:babelHelpers.objectSpread({},this.calculateSort(i.getListItemsNode(),c,true),this.calculateSort(t.getListItemsNode(),new Set,true))}).then(function(){s.updateEntityCounters(t,i)}).catch(function(e){s.requestSender.showErrorAlert(e)});t.deactivateGroupMode();i.deactivateGroupMode()}},{key:"moveTo",value:function e(t,i,n){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var a=n.getNode();var o=i.getListItemsNode();if(n.isParentTask()&&n.isShownSubTasks()){n.hideSubTasks()}if(s){l.Dom.insertBefore(a,o.lastElementChild)}else{l.Dom.insertBefore(a,o.firstElementChild)}this.moveItemFromEntityToEntity(n,t,i);if(r){this.onMoveItemUpdate(t,i,n)}}},{key:"moveToPosition",value:function e(t,i,n){var s=t.getId()!==i.getId();var r=n.getNode()?n.getNode():n.render();var a=n.getSort();var o=n.getPreviousSort();var u=i.getListItemsNode();var c=u.children[a-1];if(l.Dom.hasClass(c,"tasks-scrum__item")){var d=parseInt(c.dataset.sort,10);if(o>0&&d>=o){if(s){l.Dom.insertBefore(r,c)}else{this.planBuilder.appendItemAfterItem(r,c)}}else{l.Dom.insertBefore(r,c)}}else{if(i.isEmpty()){l.Dom.insertBefore(r,i.getLoaderNode())}else{if(i.isBacklog()){l.Dom.insertBefore(r,i.getFirstItemNode())}else{l.Dom.insertBefore(r,i.getLoaderNode())}}}this.moveItemFromEntityToEntity(n,t,i);this.updateEntityCounters(t,i)}},{key:"moveItemFromEntityToEntity",value:function e(t,i,n){i.removeItem(t);t.setParentEntity(n.getId(),n.getEntityType());n.setItem(t)}},{key:"showListSprintsToMove",value:function e(t,i,n){var r=this;var a="item-sprint-action-".concat(t.getEntityType()+t.getId()+i.getId());if(this.moveToSprintMenu){this.moveToSprintMenu.getPopupWindow().destroy()}this.moveToSprintMenu=new s.Menu({id:a,bindElement:n,offsetTop:12,offsetLeft:-32});this.entityStorage.getSprints().forEach(function(e){if(!e.isCompleted()&&!r.isSameSprint(t,e)){r.moveToSprintMenu.addMenuItem({text:e.getName(),onclick:function n(s,a){var o=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");if(t.isGroupMode()){o=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE")}r.onMoveConfirm(t,o).then(function(){r.moveToWithGroupMode(t,e,i,true,false)}).catch(function(){});a.getMenuWindow().close()}})}});this.moveToSprintMenu.getPopupWindow().subscribe("onClose",function(){r.moveToSprintMenu.destroy();r.moveToSprintMenu=null;r.emit("moveToSprintMenuClose")});this.moveToSprintMenu.show()}},{key:"isSameSprint",value:function e(t,i){return t.getEntityType()==="sprint"&&t.getId()===i.getId()}},{key:"showMoveItemMenu",value:function e(t,i,n){var r=this;var a="item-move-".concat(t.getId());if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().destroy()}this.moveItemMenu=new s.Menu({id:a,bindElement:i,offsetTop:12,offsetLeft:-28});n.forEach(function(e){r.moveItemMenu.addMenuItem(e)});this.moveItemMenu.getPopupWindow().subscribe("onClose",function(){r.moveItemMenu.destroy();r.moveItemMenu=null;r.emit("moveMenuClose")});this.moveItemMenu.show()}},{key:"hasActionPanelDialog",value:function e(){return this.moveItemMenu||this.moveToSprintMenu}}]);return t}(u.EventEmitter);var St=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.listAllUsedColors=new Set;this.randomColorCount=0;this.defaultColor="#2ECEFF"}babelHelpers.createClass(e,[{key:"getRandomColorForItemBorder",value:function e(){var t=this;this.randomColorCount=0;return this.getAllUsedColors().then(function(){return t.getRandomColor(t.getAllColors())})}},{key:"getAllColors",value:function e(){return["#2ECEFF","#10E5FC","#A5DE00","#EEC202","#AD8F47","#FF5B55","#EF3001","#F968B6","#6B52CC","#07BAB1","#5CD1DF","#A1A6AC","#949DA9","#01A64C","#B02FB0","#EF008B","#0202FF","#555555","#C4C4C4","#AAAAAA","#F89675","#C5E099","#7ECB9C","#78CDCA","#887FC0","#BD8AC0","#F6989C","#F26A47","#ABD46B","#00BBB4","#3FB2CD","#5471B9","#3E8BCD","#A861AB","#F26A7B","#9E0402","#A46200","#578520","#01736A","#0175A6","#033172","#460763","#630260","#9F0137","#B7EB81","#FFA900","#F7A700","#333333","#EDEEF0","#E1F3F9"]}},{key:"getRandomColor",value:function e(t){this.randomColorCount++;if(this.randomColorCount>=t.length){return this.defaultColor}var i=t[Math.floor(Math.random()*t.length)];if(this.isThisBorderColorAlreadyUse(i)){return this.getRandomColor(t)}else{return i}}},{key:"isThisBorderColorAlreadyUse",value:function e(t){var i=false;this.listAllUsedColors.forEach(function(e){if(e===t){i=true}});return i}},{key:"getAllUsedColors",value:function e(){var t=this;var i=new Set;this.entityStorage.getAllEntities().forEach(function(e){if(!e.isCompleted()){i.add(e.getId())}});return this.requestSender.getAllUsedItemBorderColors({entityIds:babelHelpers.toConsumableArray(i.values())}).then(function(e){t.listAllUsedColors=new Set(e.data)}).catch(function(e){t.requestSender.showErrorAlert(e)})}},{key:"updateBorderColor",value:function e(t){var i=this;var n=new Set;t.forEach(function(e){if(e.isLinkedTask()&&!e.getBorderColor()){n.add(e.getId())}});if(n.size){this.getAllUsedColors().then(function(){var e=new Map;n.forEach(function(t){e.set(t,i.getRandomColor(i.getAllColors()))});i.requestSender.updateBorderColorToLinkedItems({items:Object.fromEntries(e)}).then(function(e){var t=e.data;Object.keys(t).forEach(function(e){var n=t[e];var s=i.entityStorage.findItemByItemId(e);s.setBorderColor(n)})}).catch(function(e){i.requestSender.showErrorAlert(e)})})}}}]);return e}();var It=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.Epic.Helper");i.groupId=parseInt(e.groupId,10);i.entityStorage=e.entityStorage;i.sidePanel=e.sidePanel;i.filter=e.filter;i.tagSearcher=e.tagSearcher;i.subscribeToExtension();return i}babelHelpers.createClass(t,[{key:"subscribeToExtension",value:function e(){var t=this;u.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterAdd",function(e){t.onAfterAdd(e)});u.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterEdit",function(e){t.onAfterEdit(e)});u.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:openEdit",function(e){t.openEditForm(e.getData())});u.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:filterByTag",function(e){t.emit("filterByTag",e.getData())});u.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterRemove",function(e){t.onAfterRemove(e)})}},{key:"openAddForm",value:function e(){return this.sidePanel.showByExtension("Epic",{view:"add",groupId:this.groupId})}},{key:"openEditForm",value:function e(t){return this.sidePanel.showByExtension("Epic",{view:"edit",groupId:this.groupId,epicId:t})}},{key:"openViewForm",value:function e(t){return this.sidePanel.showByExtension("Epic",{view:"view",groupId:this.groupId,epicId:t})}},{key:"openList",value:function e(){return this.sidePanel.showByExtension("Epic",{view:"list",groupId:this.groupId})}},{key:"onAfterAdd",value:function e(t){var i=t.getData();this.tagSearcher.addEpicToSearcher(i);this.filter.addItemToListTypeField("EPIC",{NAME:i.name.trim(),VALUE:String(i.id)})}},{key:"onAfterEdit",value:function e(t){var i=t.getData();this.entityStorage.getAllItems().forEach(function(e){var t=e.getEpic().getValue();if(t&&t.id===i.id){e.setEpic(i)}});this.tagSearcher.removeEpicFromSearcher(i);this.tagSearcher.addEpicToSearcher(i)}},{key:"onAfterRemove",value:function e(t){var i=t.getData();this.entityStorage.getAllItems().forEach(function(e){var t=e.getEpic().getValue();if(t&&t.id===i.id){e.setEpic()}});this.tagSearcher.removeEpicFromSearcher(i)}}]);return t}(u.EventEmitter);var Tt=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.planBuilder=t.planBuilder;this.entityStorage=t.entityStorage;this.groupId=t.groupId;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"tasks"}},{key:"getMap",value:function e(){return{sprintAdded:this.onSprintAdded.bind(this),sprintUpdated:this.onSprintUpdated.bind(this),sprintRemoved:this.onSprintRemoved.bind(this)}}},{key:"onSprintAdded",value:function e(t){if(this.groupId!==t.groupId){return}var i=Ke.buildSprint(t);if(this.needSkipAdd(i)){this.cleanSkipAdd(i);return}this.planBuilder.createSprintNode(i)}},{key:"onSprintUpdated",value:function e(t){var i=Ke.buildSprint(t);if(this.needSkipUpdate(i)){this.cleanSkipUpdate(i);return}var n=this.entityStorage.findEntityByEntityId(i.getId());if(n){if(i.getStatus()!==n.getStatus()){if(i.getStatus()==="active"){this.planBuilder.moveSprintToActiveListNode(n)}else{this.planBuilder.updatePlannedSprints(this.entityStorage.getPlannedSprints(),false)}}n.updateYourself(i)}}},{key:"onSprintRemoved",value:function e(t){if(this.needSkipRemove(t.sprintId)){this.cleanSkipRemove(t.sprintId);return}var i=this.entityStorage.findEntityByEntityId(t.sprintId);if(i){i.removeYourself();this.entityStorage.removeSprint(i.getId())}}},{key:"addTmpIdToSkipAdding",value:function e(t){this.listIdsToSkipAdding.add(t)}},{key:"addIdToSkipUpdating",value:function e(t){this.listIdsToSkipUpdating.add(t)}},{key:"addIdToSkipRemoving",value:function e(t){this.listIdsToSkipRemoving.add(t)}},{key:"needSkipAdd",value:function e(t){return this.listIdsToSkipAdding.has(t.getTmpId())}},{key:"cleanSkipAdd",value:function e(t){this.listIdsToSkipAdding.delete(t.getTmpId())}},{key:"needSkipUpdate",value:function e(t){return this.listIdsToSkipUpdating.has(t.getId())}},{key:"cleanSkipUpdate",value:function e(t){this.listIdsToSkipUpdating.delete(t.getId())}},{key:"needSkipRemove",value:function e(t){return this.listIdsToSkipRemoving.has(t)}},{key:"cleanSkipRemove",value:function e(t){this.listIdsToSkipRemoving.delete(t)}}]);return e}();var Ct=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.entityCounters=t.entityCounters;this.tagSearcher=t.tagSearcher;this.itemMover=t.itemMover;this.currentUserId=t.currentUserId;this.listToAddAfterUpdate=new Map;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set;this.listIdsToSkipSorting=new Set;this.itemMover.subscribe("calculateSort",this.onCalculateSort.bind(this))}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"tasks"}},{key:"getMap",value:function e(){return{itemAdded:this.onItemAdded.bind(this),itemUpdated:this.onItemUpdated.bind(this),itemRemoved:this.onItemRemoved.bind(this),itemSortUpdated:this.onItemSortUpdated.bind(this),comment_add:this.onCommentAdd.bind(this)}}},{key:"onItemAdded",value:function e(t){var i=this;var n=G.buildItem(t);this.setDelayedAdd(n);this.externalAdd(n).finally(function(){return i.cleanDelayedAdd(n)}).then(function(){return i.addItemToEntity(n)}).catch(function(){})}},{key:"onItemUpdated",value:function e(t){var i=G.buildItem(t);if(this.isDelayedAdd(i)){this.cleanDelayedAdd(i);if(this.needSkipAdd(i)){this.cleanSkipAdd(i);return}this.addItemToEntity(i);return}if(this.needSkipUpdate(i)){this.cleanSkipUpdate(i);return}this.updateItem(i)}},{key:"onItemRemoved",value:function e(t){if(this.needSkipRemove(t.itemId)){this.cleanSkipRemove(t.itemId);return}var i=this.entityStorage.findItemByItemId(t.itemId);if(i){var n=this.entityStorage.findEntityByItemId(i.getId());n.removeItem(i);i.removeYourself()}}},{key:"onItemSortUpdated",value:function e(t){var i=this;var n=new Map;var s=new Map;Object.entries(t).forEach(function(e){var t=babelHelpers.slicedToArray(e,2),r=t[0],a=t[1];var o=i.entityStorage.findItemByItemId(r);if(o){if(!i.needSkipSort(a.tmpId)){n.set(o.getId(),o);s.set(o.getId(),a)}i.cleanSkipRemove(a.tmpId)}});n.forEach(function(e){var t=s.get(e.getId());e.setSort(t.sort);var n=i.entityStorage.findEntityByEntityId(e.getEntityId());if(n){var r=l.Type.isUndefined(t.entityId)?e.getEntityId():t.entityId;var a=i.entityStorage.findEntityByEntityId(r);if(!a||n.getId()===a.getId()){a=n}i.itemMover.moveToPosition(n,a,e);i.entityStorage.recalculateItemsSort()}})}},{key:"onCommentAdd",value:function e(t){var i=this;var n=l.Type.isArray(t.participants)?t.participants:[];if(n.includes(this.currentUserId.toString())){var s=t.entityXmlId.split("_");if(s){var r=s[0];var a=s[1];var o=this.entityStorage.findItemBySourceId(a);if(r==="TASK"&&o){this.requestSender.getCurrentState({taskId:o.getSourceId()}).then(function(e){var t=G.buildItem(e.data.itemData);i.updateItem(t,o)}).catch(function(e){i.requestSender.showErrorAlert(e)})}}}}},{key:"addItemToEntity",value:function e(t){var i=this;if(t.isSubTask()){return}this.requestSender.hasTaskInFilter({taskId:t.getSourceId()}).then(function(e){if(!e.data.has){return}var n=i.entityStorage.findEntityByEntityId(t.getEntityId());if(!n){return}i.itemMover.moveToPosition(n,n,t);i.entityStorage.recalculateItemsSort();t.getTags().getValue().forEach(function(e){i.tagSearcher.addTagToSearcher(e)})}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"updateItem",value:function e(t,i){if(!i){i=this.entityStorage.findItemByItemId(t.getId())}if(i){var n=t.isSubTask()!==i.isSubTask();if(n){if(t.isSubTask()){var s=this.entityStorage.findEntityByItemId(i.getId());s.removeItem(i);i.removeYourself()}return}var r=t.getEntityId();var a=i.getEntityId();var o=this.entityStorage.findEntityByEntityId(r);var l=this.entityStorage.findEntityByEntityId(a);if(t.getEntityId()!==i.getEntityId()){if(o&&l){this.itemMover.moveToPosition(l,o,i);this.entityStorage.recalculateItemsSort()}}else{this.updateEntityCounters(o)}i.updateYourself(t)}else{if(t.isSubTask()){var u=t.getEntityId();var c=this.entityStorage.findEntityByEntityId(u);this.updateEntityCounters(c)}else{this.addItemToEntity(t)}}}},{key:"updateEntityCounters",value:function e(t,i){var n=new Map;n.set(t.getId(),t);if(i){n.set(i.getId(),i)}this.entityCounters.updateCounters(n)}},{key:"onCalculateSort",value:function e(t){var i=this;var n=t.getData();Object.entries(n).forEach(function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],s=t[1];if(Object.prototype.hasOwnProperty.call(s,"tmpId")){i.addTmpIdToSkipSorting(s.tmpId)}})}},{key:"addTmpIdsToSkipAdding",value:function e(t){this.listIdsToSkipAdding.add(t)}},{key:"addIdToSkipUpdating",value:function e(t){this.listIdsToSkipUpdating.add(t)}},{key:"addIdToSkipRemoving",value:function e(t){this.listIdsToSkipRemoving.add(t)}},{key:"addTmpIdToSkipSorting",value:function e(t){this.listIdsToSkipSorting.add(t)}},{key:"externalAdd",value:function e(t){var i=this;return new Promise(function(e,n){setTimeout(function(){return i.isDelayedAdd(t)?e():n()},3e3)})}},{key:"isDelayedAdd",value:function e(t){return this.listToAddAfterUpdate.has(t.getId())}},{key:"setDelayedAdd",value:function e(t){this.listToAddAfterUpdate.set(t.getId(),t)}},{key:"cleanDelayedAdd",value:function e(t){this.listToAddAfterUpdate.delete(t.getId())}},{key:"needSkipAdd",value:function e(t){return this.listIdsToSkipAdding.has(t.getTmpId())}},{key:"cleanSkipAdd",value:function e(t){this.listIdsToSkipAdding.delete(t.getTmpId())}},{key:"needSkipUpdate",value:function e(t){return this.listIdsToSkipUpdating.has(t.getId())}},{key:"cleanSkipUpdate",value:function e(t){this.listIdsToSkipUpdating.delete(t.getId())}},{key:"needSkipRemove",value:function e(t){return this.listIdsToSkipRemoving.has(t)}},{key:"cleanSkipRemove",value:function e(t){this.listIdsToSkipRemoving.delete(t)}},{key:"needSkipSort",value:function e(t){return this.listIdsToSkipSorting.has(t)}},{key:"cleanSkipSort",value:function e(t){this.listIdsToSkipSorting.delete(t)}}]);return e}();var Et=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.epic=t.epic;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"tasks"}},{key:"getMap",value:function e(){return{epicAdded:this.onEpicAdded.bind(this),epicUpdated:this.onEpicUpdated.bind(this),epicRemoved:this.onEpicRemoved.bind(this)}}},{key:"onEpicAdded",value:function e(t){this.epic.onAfterAdd((new u.BaseEvent).setData(t))}},{key:"onEpicUpdated",value:function e(t){this.epic.onAfterEdit((new u.BaseEvent).setData(t))}},{key:"onEpicRemoved",value:function e(t){this.epic.onAfterRemove((new u.BaseEvent).setData(t))}}]);return e}();var wt=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.filterService=t.filterService;this.userId=t.userId;this.groupId=t.groupId}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"tasks"}},{key:"getMap",value:function e(){return{task_view:this.onTaskView.bind(this),project_read_all:this.onCommentsReadAll.bind(this)}}},{key:"onTaskView",value:function e(t){var i=this;var n=parseInt(t.TASK_ID,10);var s=parseInt(t.USER_ID,10);if(s!==this.userId){return}var r=this.entityStorage.findItemBySourceId(n);if(r){this.requestSender.getCurrentState({taskId:r.getSourceId()}).then(function(e){r.updateYourself(G.buildItem(e.data.itemData))}).catch(function(e){i.requestSender.showErrorAlert(e)})}}},{key:"onCommentsReadAll",value:function e(t){var i=t.GROUP_ID;if(i&&i===this.groupId){this.filterService.applyFilter()}}}]);return e}();var _t=function(){function e(t){babelHelpers.classCallCheck(this,e);this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.filterService=t.filter;this.isOwnerCurrentUser=t.isOwnerCurrentUser;this.userId=parseInt(t.userId,10);this.groupId=parseInt(t.groupId,10);this.filter=this.filterService.getFilterManager();this.updateFields();this.bindEvents();this.subscribeToPull()}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){u.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this));u.EventEmitter.subscribe("Tasks.Toolbar:onItem",this.onCounterClick.bind(this))}},{key:"subscribeToPull",value:function e(){o.PULL.subscribe(new wt({requestSender:this.requestSender,entityStorage:this.entityStorage,filterService:this.filterService,userId:this.userId,groupId:this.groupId}))}},{key:"onFilterApply",value:function e(){this.updateFields()}},{key:"updateFields",value:function e(){this.fields=this.filter.getFilterFieldsValues()}},{key:"onCounterClick",value:function e(t){var i=t.getData();if(i.counter&&i.counter.filter){this.toggleByField(babelHelpers.defineProperty({},i.counter.filterField,i.counter.filterValue))}}},{key:"isFilteredByField",value:function e(t){if(!Object.keys(this.fields).includes(t)){return false}if(l.Type.isArray(this.fields[t])){return this.fields[t].length>0}return this.fields[t]!==""}},{key:"isFilteredByFieldValue",value:function e(t,i){return this.isFilteredByField(t)&&this.fields[t]===i}},{key:"toggleByField",value:function e(t){var i=this;var n=Object.keys(t)[0];var s=t[n];if(!this.isFilteredByFieldValue(n,s)){this.filter.getApi().extendFilter(babelHelpers.defineProperty({},n,s));return}this.filter.getFilterFields().forEach(function(e){if(e.getAttribute("data-name")===n){i.filter.getFields().deleteField(e)}});this.filter.getSearch().apply()}}]);return e}();var Dt=function(){function e(t){babelHelpers.classCallCheck(this,e);this.filter=t.filter;this.requestSender=t.requestSender;this.entityStorage=t.entityStorage;this.filter.subscribe("applyFilter",this.onApplyFilter.bind(this))}babelHelpers.createClass(e,[{key:"onApplyFilter",value:function e(t){var i=this;this.fadeOutAll();this.requestSender.applyFilter().then(function(e){var t=e.data;i.entityStorage.getAllItems().forEach(function(e){var t=i.entityStorage.findEntityByEntityId(e.getEntityId());if(!t.isCompleted()){t.removeItem(e);e.removeYourself()}});t.forEach(function(e){var t=G.buildItem(e);var n=i.entityStorage.findEntityByEntityId(t.getEntityId());t.setShortView(n.getShortView());if(!n.isCompleted()){n.appendItemToList(t);n.setItem(t)}});i.fadeInAll()}).catch(function(e){i.fadeInAll();i.requestSender.showErrorAlert(e)})}},{key:"fadeOutAll",value:function e(){this.entityStorage.getBacklog().fadeOut();this.entityStorage.getSprints().forEach(function(e){if(!e.isCompleted()){e.fadeOut()}})}},{key:"fadeInAll",value:function e(){this.entityStorage.getBacklog().fadeIn();this.entityStorage.getSprints().forEach(function(e){if(!e.isCompleted()){e.fadeIn()}})}}]);return e}();var At=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parentItem=t.parentItem;this.count=1}babelHelpers.createClass(e,[{key:"getParentItem",value:function e(){return this.parentItem}},{key:"addNumberDecompositionsPerformed",value:function e(){this.count++}},{key:"getNumberDecompositionsPerformed",value:function e(){return this.count}}]);return e}();var Pt=function(e){babelHelpers.inherits(i,e);function i(e){var t;babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e));t.setEventNamespace("BX.Tasks.Scrum.Plan");t.pathToTask=e.pathToTask;t.defaultResponsible=e.defaultResponsible;t.pageSize=parseInt(e.pageSize,10);t.activeSprintId=parseInt(e.activeSprintId,10);t.views=e.views;t.isShortView=e.isShortView;t.displayPriority=e.displayPriority;t.entityStorage=new Ge;t.entityStorage.addBacklog(le.buildBacklog(e.backlog));e.sprints.forEach(function(i){i.defaultSprintDuration=e.defaultSprintDuration;i.isShortView=e.isShortView;var n=Ke.buildSprint(i);t.entityStorage.addSprint(n)});t.entityCounters=new kt({requestSender:t.requestSender,entityStorage:t.entityStorage});t.taskCounters=new _t({requestSender:t.requestSender,entityStorage:t.entityStorage,filter:t.filter,userId:e.userId,groupId:e.groupId,isOwnerCurrentUser:e.isOwnerCurrentUser});t.tagSearcher=new j;Object.values(e.tags.epic).forEach(function(e){t.tagSearcher.addEpicToSearcher(e)});Object.values(e.tags.task).forEach(function(e){t.tagSearcher.addTagToSearcher(e)});t.planBuilder=new $e({requestSender:t.requestSender,entityStorage:t.entityStorage,defaultSprintDuration:e.defaultSprintDuration,pageNumberToCompletedSprints:e.pageNumberToCompletedSprints,displayPriority:e.displayPriority,isShortView:e.isShortView});t.planBuilder.subscribe("beforeCreateSprint",function(e){var i=e.getData();t.pullSprint.addTmpIdToSkipAdding(i.tmpId)});t.planBuilder.subscribe("createSprint",function(e){var i=e.getData();t.subscribeToSprint(i);t.itemMover.addSprintContainers(i)});t.planBuilder.subscribe("createSprintNode",function(e){var i=e.getData();t.subscribeToSprint(i);t.itemMover.addSprintContainers(i)});t.planBuilder.subscribe("sprintsScroll",t.onActionPanelScroll.bind(babelHelpers.assertThisInitialized(t)));t.searchItems=new mt({planBuilder:t.planBuilder,entityStorage:t.entityStorage});t.sprintMover=new ft({requestSender:t.requestSender,planBuilder:t.planBuilder,entityStorage:t.entityStorage});t.itemMover=new yt({requestSender:t.requestSender,planBuilder:t.planBuilder,entityStorage:t.entityStorage,entityCounters:t.entityCounters});t.itemDesigner=new St({requestSender:t.requestSender,entityStorage:t.entityStorage});t.filterHandler=new Dt({filter:t.filter,requestSender:t.requestSender,entityStorage:t.entityStorage});t.epic=new It({groupId:t.groupId,sidePanel:t.sidePanel,entityStorage:t.entityStorage,filter:t.filter,tagSearcher:t.tagSearcher});t.pullSprint=new Tt({requestSender:t.requestSender,planBuilder:t.planBuilder,entityStorage:t.entityStorage,groupId:t.getCurrentGroupId()});t.pullItem=new Ct({requestSender:t.requestSender,entityStorage:t.entityStorage,entityCounters:t.entityCounters,tagSearcher:t.tagSearcher,itemMover:t.itemMover,currentUserId:t.getCurrentUserId()});t.pullEpic=new Et({requestSender:t.requestSender,entityStorage:t.entityStorage,epic:t.epic});t.input=new J;t.input.subscribe("createTaskItem",t.onCreateTaskItem.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("tagsSearchOpen",t.onTagsSearchOpen.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("tagsSearchClose",t.onTagsSearchClose.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("epicSearchOpen",t.onEpicSearchOpen.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("epicSearchClose",t.onEpicSearchClose.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("render",t.onRenderInput.bind(babelHelpers.assertThisInitialized(t)));t.input.subscribe("remove",t.onRemoveInput.bind(babelHelpers.assertThisInitialized(t)));t.actionPanel=null;t.bindHandlers();t.subscribeToPull();return t}babelHelpers.createClass(i,[{key:"renderTo",value:function e(t){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"renderTo",this).call(this,t);this.planBuilder.renderTo(t)}},{key:"renderRightElementsTo",value:function e(n){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"renderRightElementsTo",this).call(this,n);var s=new t.ShortView({isShortView:this.isShortView});s.renderTo(n);s.subscribe("change",this.onChangeShortView.bind(this))}},{key:"setDisplayPriority",value:function e(t){var n=this;babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"setDisplayPriority",this).call(this,t);this.planBuilder.setWidthPriority(t);this.requestSender.saveDisplayPriority({value:t}).then(function(e){}).catch(function(e){n.requestSender.showErrorAlert(e)})}},{key:"subscribeToPull",value:function e(){o.PULL.subscribe(this.pullSprint);o.PULL.subscribe(this.pullItem);o.PULL.subscribe(this.pullEpic)}},{key:"bindHandlers",value:function e(){var t=this;this.entityStorage.getBacklog().subscribe("showInput",this.onShowInput.bind(this));this.entityStorage.getBacklog().subscribe("updateItem",this.onUpdateItem.bind(this));this.entityStorage.getBacklog().subscribe("showTask",this.onShowTask.bind(this));this.entityStorage.getBacklog().subscribe("changeTaskResponsible",this.onChangeTaskResponsible.bind(this));this.entityStorage.getBacklog().subscribe("openAddEpicForm",this.onOpenEpicForm.bind(this));this.entityStorage.getBacklog().subscribe("tagsSearchOpen",this.onTagsSearchOpen.bind(this));this.entityStorage.getBacklog().subscribe("tagsSearchClose",this.onTagsSearchClose.bind(this));this.entityStorage.getBacklog().subscribe("epicSearchOpen",this.onEpicSearchOpen.bind(this));this.entityStorage.getBacklog().subscribe("epicSearchClose",this.onEpicSearchClose.bind(this));this.entityStorage.getBacklog().subscribe("filterByEpic",this.onFilterByEpic.bind(this));this.entityStorage.getBacklog().subscribe("filterByTag",this.onFilterByTag.bind(this));this.entityStorage.getBacklog().subscribe("loadItems",this.onLoadItems.bind(this));this.entityStorage.getBacklog().subscribe("toggleActionPanel",this.onToggleActionPanel.bind(this));this.entityStorage.getBacklog().subscribe("showLinked",this.onShowLinked.bind(this));this.entityStorage.getBacklog().subscribe("itemsScroll",this.onActionPanelScroll.bind(this));this.entityStorage.getBacklog().subscribe("showBlank",this.onShowBlank.bind(this));this.entityStorage.getSprints().forEach(function(e){return t.subscribeToSprint(e)});this.epic.subscribe("filterByTag",this.onFilterByTag.bind(this));this.itemMover.subscribe("dragStart",function(){t.destroyActionPanel();if(t.searchItems.isActive()){t.searchItems.stop()}});document.onkeydown=this.onDocumentKeyDown.bind(this);document.onclick=this.onDocumentClick.bind(this)}},{key:"subscribeToSprint",value:function e(t){var i=this;t.subscribe("showInput",this.onShowInput.bind(this));t.subscribe("updateItem",this.onUpdateItem.bind(this));t.subscribe("getSubTasks",this.onGetSubTasks.bind(this));t.subscribe("showTask",this.onShowTask.bind(this));t.subscribe("startSprint",this.onStartSprint.bind(this));t.subscribe("completeSprint",this.onCompleteSprint.bind(this));t.subscribe("changeTaskResponsible",this.onChangeTaskResponsible.bind(this));t.subscribe("removeSprint",this.onRemoveSprint.bind(this));t.subscribe("changeSprintName",this.onChangeSprintName.bind(this));t.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));t.subscribe("tagsSearchOpen",this.onTagsSearchOpen.bind(this));t.subscribe("tagsSearchClose",this.onTagsSearchClose.bind(this));t.subscribe("epicSearchOpen",this.onEpicSearchOpen.bind(this));t.subscribe("epicSearchClose",this.onEpicSearchClose.bind(this));t.subscribe("filterByEpic",this.onFilterByEpic.bind(this));t.subscribe("filterByTag",this.onFilterByTag.bind(this));t.subscribe("getSprintCompletedItems",this.onGetSprintCompletedItems.bind(this));t.subscribe("showSprintBurnDownChart",this.onShowSprintBurnDownChart.bind(this));t.subscribe("showSprintCreateMenu",this.onOpenSprintAddMenu.bind(this));t.subscribe("loadItems",this.onLoadItems.bind(this));t.subscribe("toggleActionPanel",this.onToggleActionPanel.bind(this));t.subscribe("showLinked",this.onShowLinked.bind(this));t.subscribe("toggleVisibilityContent",function(){i.planBuilder.adjustSprintListWidth()})}},{key:"showErrorAlert",value:function e(t){r.MessageBox.alert(t,l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP"))}},{key:"onDocumentKeyDown",value:function e(t){t=t||window.event;if(this.searchItems.isActive()){if(t.key==="ArrowUp"||t.key==="ArrowLeft"){t.preventDefault();this.searchItems.moveToPrev()}if(t.key==="ArrowDown"||t.key==="ArrowRight"){t.preventDefault();this.searchItems.moveToNext()}}if(t.key==="Escape"){var i=false;if(this.searchItems.isActive()){i=true;this.searchItems.stop()}if(this.actionPanel){i=true;this.destroyActionPanel();this.entityStorage.getAllEntities().forEach(function(e){e.deactivateGroupMode()})}if(i){t.stopImmediatePropagation()}}}},{key:"onDocumentClick",value:function e(t){t=t||window.event;if(this.searchItems.isActive()&&!this.searchItems.isClickInside(t.target)){this.searchItems.stop()}}},{key:"onShowInput",value:function e(t){var i=t.getTarget();this.input.setEntity(i);this.input.cleanBindNode();this.renderInput()}},{key:"onRenderInput",value:function e(t){var i=t.getTarget();var n=i.getEntity();n.hideBlank();n.hideDropzone()}},{key:"onRemoveInput",value:function e(t){var i=t.getTarget();var n=i.getEntity();if(!i.isTaskCreated()&&n.isEmpty()){if(n.isBacklog()){if(this.entityStorage.existsAtLeastOneItem()){n.showDropzone()}else{n.showBlank()}}else{n.showDropzone()}}if(this.decomposition){this.decomposition=null}n.adjustListItemsWidth()}},{key:"onCreateTaskItem",value:function e(t){var i=this;var n=t.getTarget();var s=n.getEntity();var r=t.getData();var a=null;try{a=this.createItem(r)}catch(e){this.showErrorAlert(e.message);n.removeYourself();return}if(this.decomposition){var o=this.decomposition.getParentItem();this.pullItem.addIdToSkipUpdating(o.getId());a.setParentEntity(s.getId(),s.getEntityType());a.setParentTaskId(o.getSourceId());a.setEpic(o.getEpic().getValue());a.setTags(o.getTags().getValue());a.setResponsible(o.getResponsible().getValue());if(s.isBacklog()){o.setLinkedTask("Y");o.updateBorderColor();a.setLinkedTask("Y");a.setBorderColor(o.getBorderColor());a.setSort(o.getSort()+this.decomposition.getNumberDecompositionsPerformed());l.Dom.insertBefore(a.render(),n.getNode())}else{a.setSubTask("Y");a.setSort(o.getSort()+(o.getSubTasksCount()+1));a.setParentTaskId(o.getSourceId());a.setParentTask("N")}this.decomposition.addNumberDecompositionsPerformed()}else{a.setEpic(n.getEpic());n.setEpic(null);this.fillItemBeforeCreation(s,a,r);if(s.isEmpty()){l.Dom.insertBefore(a.render(),s.getLoaderNode())}else{l.Dom.insertBefore(a.render(),s.getFirstItemNode(this.input))}}this.pullItem.addTmpIdsToSkipAdding(a.getId());this.pullItem.addTmpIdToSkipSorting(a.getId());this.sendRequestToCreateTask(s,a).then(function(e){n.unDisable();n.focus();i.fillItemAfterCreation(a,e.data);e.data.tags.forEach(function(e){i.tagSearcher.addTagToSearcher(e)});s.setItem(a);i.updateEntityCounters(s);if(i.decomposition){var t=i.decomposition.getParentItem();if(!s.isBacklog()){var r=t.getSubTasks();r.addTask(a);if(!r.isShown()){s.appendNodeAfterItem(r.render(),t.getNode())}var o={};o[a.getSourceId()]={sourceId:a.getSourceId(),completed:"N",storyPoints:""};t.setSubTasksInfo(babelHelpers.objectSpread({},t.getSubTasksInfo(),o));t.setParentTask("Y");t.showSubTasks()}}s.adjustListItemsWidth();i.planBuilder.adjustSprintListWidth()}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onUpdateItem",value:function e(t){var i=this;var n=t.getTarget();var s=t.getData();this.pullItem.addIdToSkipUpdating(s.itemId);this.requestSender.updateItem(t.getData()).then(function(){var e=!l.Type.isUndefined(s.storyPoints);if(e){i.updateEntityCounters(n)}}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onGetSubTasks",value:function e(t){var i=this;var n=t.getTarget();var s=t.getData();this.requestSender.getSubTaskItems({entityId:n.getId(),taskId:s.getParentItem().getSourceId()}).then(function(e){e.data.forEach(function(e){var t=G.buildItem(e);n.setItem(t);s.addTask(t)});s.show();i.planBuilder.adjustSprintListWidth()}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onChangeTaskResponsible",value:function e(t){var i=this;this.pullItem.addIdToSkipUpdating(t.getData().getId());this.requestSender.changeTaskResponsible({itemId:t.getData().getId(),sourceId:t.getData().getSourceId(),responsible:t.getData().getResponsible().getValue()}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onOpenEpicForm",value:function e(t){var i=t.getData();l.Dom.addClass(i,"ui-btn-wait");this.epic.openAddForm().then(function(){l.Dom.removeClass(i,"ui-btn-wait")})}},{key:"onStartSprint",value:function e(t){var i=t.getTarget();var n=new bt({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views});n.showStartForm(i)}},{key:"onCompleteSprint",value:function e(){var t=this;var i=new bt({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views});i.showCompletionForm();i.subscribe("showTask",function(e){t.sidePanel.openSidePanelByUrl(t.getPathToTask().replace("#task_id#",e.getData()))})}},{key:"onRemoveSprint",value:function e(t){var i=this;var n=t.getTarget();this.pullSprint.addIdToSkipRemoving(n.getId());this.requestSender.removeSprint({sprintId:n.getId(),sortInfo:this.sprintMover.calculateSprintSort()}).then(function(e){babelHelpers.toConsumableArray(n.getItems().values()).map(function(e){i.moveToBacklog(n,e)});i.destroyActionPanel();n.removeYourself();i.entityStorage.removeSprint(n.getId());i.planBuilder.adjustSprintListWidth()}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onChangeSprintName",value:function e(t){var i=this;var n=t.getData();this.pullSprint.addIdToSkipUpdating(n.sprintId);this.requestSender.changeSprintName(n).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onChangeSprintDeadline",value:function e(t){var i=this;var n=t.getData();this.pullSprint.addIdToSkipUpdating(n.sprintId);this.requestSender.changeSprintDeadline(n).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"onGetSprintCompletedItems",value:function e(t){var i=this;var s=t.getTarget();var r=s.getListItemsNode();var a=l.Dom.getPosition(r);s.getContentContainer().style.height="auto";var o=new n.Loader({size:60,mode:"inline",color:"#eaeaea",offset:{left:"".concat(a.width/2-30,"px")}});o.show();this.requestSender.getSprintCompletedItems({sprintId:s.getId()}).then(function(e){o.hide();if(e.data.length>0){e.data.forEach(function(e){var t=G.buildItem(e);t.setDisableStatus(s.isDisabled());s.appendItemToList(t);s.setItem(t)})}else{s.showBlank()}s.showContent(s.getContentContainer())}).catch(function(e){o.hide();i.requestSender.showErrorAlert(e)})}},{key:"onShowSprintBurnDownChart",value:function e(t){var i=t.getTarget();var n=new bt({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views});n.showBurnDownChart(i)}},{key:"onOpenSprintAddMenu",value:function e(t){var i=this;var n=t.getTarget();var r=t.getData().getNode();if(this.sprintAddMenu){this.sprintAddMenu.getPopupWindow().destroy();this.sprintAddMenu=null;return}var a=r.getBoundingClientRect();this.sprintAddMenu=new s.Menu({id:"tasks-scrum-sprint-add-menu",bindElement:r,closeByEsc:true,angle:{position:"top",offset:78},offsetLeft:a.width-67});this.sprintAddMenu.addMenuItem({text:l.Loc.getMessage("TASKS_SCRUM_BACKLOG_SPRINT_FIRST_ADD"),onclick:function e(t,s){i.input.setEntity(n);i.input.cleanBindNode();i.renderInput();s.getMenuWindow().close()}});this.sprintAddMenu.addMenuItem({text:l.Loc.getMessage("TASKS_SCRUM_BACKLOG_SPRINT_SECOND_ADD"),onclick:function e(t,n){i.planBuilder.createSprint();n.getMenuWindow().close()}});this.sprintAddMenu.getPopupWindow().subscribe("onClose",function(){i.sprintAddMenu.getPopupWindow().destroy();i.sprintAddMenu=null});this.sprintAddMenu.getPopupWindow().subscribe("onShow",function(){var e=i.sprintAddMenu.getMenuContainer().querySelector(".popup-window-angly");e.style.pointerEvents="none"});this.sprintAddMenu.show()}},{key:"onShowTask",value:function e(t){var i=t.getData();this.sidePanel.openSidePanelByUrl(this.pathToTask.replace("#task_id#",i.getSourceId()))}},{key:"onTagsSearchOpen",value:function e(t){this.tagSearcher.showTagsSearchDialog(this.input,t.getData())}},{key:"onTagsSearchClose",value:function e(){this.tagSearcher.closeTagsSearchDialog()}},{key:"onFilterByTag",value:function e(t){var i=t.getData();var n=this.filter.getValueFromField({name:"TAG",value:""});if(String(i)===String(n)){this.filter.setValueToField({name:"TAG",value:""})}else{this.filter.setValueToField({name:"TAG",value:String(i)})}this.filter.scrollToSearchContainer()}},{key:"onEpicSearchOpen",value:function e(t){this.tagSearcher.showEpicSearchDialog(this.input,t.getData())}},{key:"onEpicSearchClose",value:function e(){this.tagSearcher.closeEpicSearchDialog()}},{key:"onFilterByEpic",value:function e(t){var i=t.getData();var n=this.filter.getValueFromField({name:"EPIC",value:""});if(String(i)===String(n)){this.filter.setValueToField({name:"EPIC",value:""})}else{this.filter.setValueToField({name:"EPIC",value:String(i)})}this.filter.scrollToSearchContainer()}},{key:"onLoadItems",value:function e(t){var i=this;var n=t.getTarget();n.setActiveLoadItems(true);if(n.getNumberItems()>=this.pageSize){n.getListItems().addScrollbar()}var s=n.showItemsLoader();var r={entityId:n.getId(),pageNumber:n.getPageNumberItems()+1,pageSize:this.pageSize};this.requestSender.getItems(r).then(function(e){var t=e.data;if(l.Type.isArray(t)&&t.length){n.incrementPageNumberItems();n.setActiveLoadItems(false);i.createItemsInEntity(n,t);if(n.isGroupMode()){n.activateGroupMode()}n.bindItemsLoader()}s.hide()}).catch(function(e){s.hide();n.setActiveLoadItems(false);i.requestSender.showErrorAlert(e)})}},{key:"onShowTeamSpeedChart",value:function e(){this.sidePanel.showByExtension("Team-Speed-Chart",{groupId:this.groupId})}},{key:"onOpenListEpicGrid",value:function e(){this.epic.openList()}},{key:"onChangeShortView",value:function e(t){var i=this;var n=t.getData();this.planBuilder.setShortView(n);this.destroyActionPanel();var s=this.entityStorage.getAllEntities();s.forEach(function(e){if(!e.isCompleted()){e.deactivateGroupMode();e.fadeOut()}});this.requestSender.saveShortView({isShortView:n}).then(function(e){s.forEach(function(e){if(!e.isCompleted()){e.setShortView(n);e.fadeIn()}})}).catch(function(e){s.forEach(function(e){if(!e.isCompleted()){e.fadeIn()}});i.requestSender.showErrorAlert(e)})}},{key:"onToggleActionPanel",value:function e(t){var i=t.getData();var n=t.getTarget();if(this.actionPanel){var s=this.actionPanel.getItem().getId()===i.getId();this.destroyActionPanel();if(s||n.hasItemInGroupMode(i)){this.deactivateGroupMode(n,i);return}}this.activateGroupMode(n,i);this.showActionPanel(n,i);if(this.searchItems.isActive()){this.searchItems.updateCurrentIndexByItem(i)}}},{key:"onShowLinked",value:function e(t){var i=this;var s=t.getData();if(this.searchItems.isActive()){this.searchItems.stop();return}this.destroyActionPanel();var r=l.Dom.getPosition(this.planBuilder.getScrumContainer());window.scrollTo({top:r.top,behavior:"smooth"});var a=new n.Loader({target:this.planBuilder.getScrumContainer(),offset:{top:"".concat(r.top/2,"px")}});a.show();this.searchItems.deactivateGroupMode();this.searchItems.fadeOutAll();this.requestSender.showLinkedTasks({taskId:s.getSourceId()}).then(function(e){var t=e.data.items;var n=e.data.linkedItemIds;t.forEach(function(e){var t=G.buildItem(e);var n=i.entityStorage.findEntityByEntityId(t.getEntityId());if(!n.isCompleted()&&!n.hasItem(t)){t.setShortView(n.getShortView());n.appendItemToList(t);n.setItem(t)}});var r=i.entityStorage.getAllItems();var o=new Set;n.forEach(function(e){if(r.has(e)){o.add(r.get(e))}});i.itemDesigner.updateBorderColor(o);if(n.length>0){i.searchItems.start(s,n)}else{i.searchItems.fadeInAll()}a.hide()}).catch(function(e){i.requestSender.showErrorAlert(e);a.hide()})}},{key:"onActionPanelScroll",value:function e(){if(this.actionPanel){this.actionPanel.calculatePanelTopPosition()}}},{key:"onShowBlank",value:function e(t){var i=this;var n=t.getTarget();setTimeout(function(){if(!n.isEmpty()){return}if(i.entityStorage.existsAtLeastOneItem()){n.showDropzone()}else{n.showBlank()}},200)}},{key:"renderInput",value:function e(){var t=this.input.getEntity();var i=this.input.getBindNode();if(i){l.Dom.insertAfter(this.input.render(),i)}else{if(t.isEmpty()){l.Dom.insertBefore(this.input.render(),t.getLoaderNode())}else{l.Dom.insertBefore(this.input.render(),t.getFirstItemNode(this.input))}}this.input.getInputNode().focus();this.scrollToInput()}},{key:"scrollToInput",value:function e(){var t=this.input.getEntity();if(t.isBacklog()){var i=t.getListItemsNode();var n=l.Dom.getRelativePosition(this.input.getInputNode(),i).top;i.scrollTo({top:i.scrollTop+n-100,behavior:"smooth"})}else{var s=this.planBuilder.getSprintsContainer();var r=l.Dom.getRelativePosition(this.input.getInputNode(),s).top;s.scrollTo({top:s.scrollTop+r-100,behavior:"smooth"})}}},{key:"createItemsInEntity",value:function e(t,i){var n=this;i.forEach(function(e){var i=G.buildItem(e);i.setEntityType(t.getEntityType());if(!n.entityStorage.findItemByItemId(i.getId())){i.setShortView(t.getShortView());t.appendItemToList(i);t.setItem(i)}})}},{key:"showActionPanel",value:function e(t,i){var n=this;var s=function e(){if(n.searchItems.isActive()){n.searchItems.stop()}};var a=t.getGroupModeItems().size>1;this.actionPanel=new ht({entity:t,item:i,itemList:{task:{activity:true,disable:a,callback:function e(){n.onShowTask(new u.BaseEvent({data:i}));n.destroyActionPanel();t.deactivateGroupMode()}},attachment:{activity:true,disable:!i.isEditAllowed(),callback:function e(i){var s=new f({ufDiskFilesFieldName:"UF_TASK_WEBDAV_FILES"});s.subscribe("onFinish",function(e){n.attachFilesToTask(t,e.getData())});s.showAttachmentMenu(i.currentTarget)}},dod:{activity:true,disable:a,callback:function e(){n.showDod(i);n.destroyActionPanel();t.deactivateGroupMode()}},move:{activity:true,disable:!i.isMovable(),callback:function e(t){n.moveItem(i,t.currentTarget);s()}},sprint:{activity:true,disable:false,callback:function e(r){n.moveToSprint(t,i,r.currentTarget);s()}},backlog:{activity:true,disable:i.getEntityType()!=="sprint",callback:function e(){n.moveToBacklog(t,i);n.destroyActionPanel();s()}},tags:{activity:true,callback:function e(s){n.showTagSearcher(t,i,s.currentTarget)}},epic:{activity:true,callback:function e(s){n.showEpicSearcher(t,i,s.currentTarget)}},decomposition:{activity:true,disable:a,callback:function e(){if(t.isBacklog()){n.startBacklogDecomposition(t,i)}else{n.startSprintDecomposition(t,i)}n.destroyActionPanel();t.deactivateGroupMode();s()}},remove:{activity:true,disable:!i.isRemoveAllowed(),callback:function e(){r.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASKS"),function(e){e.close();n.removeGroupItems(t).then(function(){t.getGroupModeItems().forEach(function(e){t.removeItem(e);n.deactivateGroupMode(t,e);e.removeYourself()});n.updateEntityCounters(t)})},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"));n.destroyActionPanel();s()}}}});this.actionPanel.subscribe("unSelect",function(){n.destroyActionPanel();t.deactivateGroupMode()});this.actionPanel.show()}},{key:"activateGroupMode",value:function e(t,i){if(i){t.addItemToGroupMode(i)}if(t.isGroupMode()){return}t.activateGroupMode();if(t.getId()!==this.entityStorage.getBacklog().getId()){this.entityStorage.getBacklog().deactivateGroupMode()}this.entityStorage.getSprints().forEach(function(e){if(t.getId()!==e.getId()){e.deactivateGroupMode()}})}},{key:"deactivateGroupMode",value:function e(t,i){if(i){t.removeItemFromGroupMode(i)}if(!t.isGroupMode()){return}var n=t.getGroupModeItems();if(n.size===0){t.deactivateGroupMode()}else{this.showActionPanel(t,Array.from(n.values()).pop())}}},{key:"createItem",value:function e(t){var i=t.replace(new RegExp(j.tagRegExp,"g"),"").replace(new RegExp(j.epicRegExp,"g"),"");var n=G.buildItem({itemId:"",name:i});n.setShortView(this.isShortView);return n}},{key:"sendRequestToCreateTask",value:function e(t,i){var n={tmpId:i.getId(),name:i.getName().getValue(),entityId:i.getEntityId(),entityType:t.getEntityType(),epicId:i.getEpic().getValue().id,sort:i.getSort(),storyPoints:i.getStoryPoints().getValue().getPoints(),tags:i.getTags().getValue(),parentTaskId:i.getParentTaskId(),responsible:i.getResponsible().getValue(),info:i.getInfo(),sortInfo:this.itemMover.calculateSort(t.getListItemsNode())};return this.requestSender.createTask(n)}},{key:"fillItemBeforeCreation",value:function e(t,i,n){i.setParentEntity(t.getId(),t.getEntityType());i.setSort(1);i.setResponsible(this.defaultResponsible);var s=j.getHashTagNamesFromText(n);if(s.length>0){i.setTags(s)}var r=j.getHashEpicNamesFromText(n).pop();if(r){i.setEpic(this.tagSearcher.getEpicByName(r.trim()))}}},{key:"fillItemAfterCreation",value:function e(t,i){t.setId(i.id);t.setEpic(i.epic);t.setTags(i.tags);t.setResponsible(i.responsible);t.setSourceId(i.sourceId);t.setAllowedActions(i.allowedActions)}},{key:"openEpicEditForm",value:function e(t){this.epic.openEditForm(t)}},{key:"updateEntityCounters",value:function e(t,i){var n=new Map;n.set(t.getId(),t);if(i){n.set(i.getId(),i)}this.entityCounters.updateCounters(n)}},{key:"destroyActionPanel",value:function e(){if(this.actionPanel){this.actionPanel.destroy()}this.actionPanel=null}},{key:"getActionPanel",value:function e(){return this.actionPanel}},{key:"attachFilesToTask",value:function e(t,i){var n=this;if(i.length===0){return}var s=[];t.getGroupModeItems().forEach(function(e){n.pullItem.addIdToSkipUpdating(e.getId());s.push(e.getId())});this.requestSender.attachFilesToTask({itemIds:s,attachedIds:i}).then(function(e){t.getGroupModeItems().forEach(function(t){t.setFiles(e.data.attachedFilesCount[t.getId()])});n.destroyActionPanel();t.deactivateGroupMode()}).catch(function(e){n.requestSender.showErrorAlert(e)})}},{key:"showDod",value:function e(t){this.sidePanel.showByExtension("Dod",{view:"list",groupId:this.groupId,taskId:t.getSourceId(),skipNotifications:true})}},{key:"moveItem",value:function e(t,i){var n=this;this.itemMover.moveItem(t,i);this.itemMover.subscribe("moveMenuClose",function(){var e=n.itemMover.hasActionPanelDialog()||n.tagSearcher.hasActionPanelDialog();if(!e){n.destroyActionPanel()}})}},{key:"moveToSprint",value:function e(t,i,n){var s=this;this.itemMover.moveToAnotherEntity(t,i,null,n);this.itemMover.subscribe("moveToSprintMenuClose",function(){var e=s.itemMover.hasActionPanelDialog()||s.tagSearcher.hasActionPanelDialog();if(!e){s.destroyActionPanel()}});if(this.entityStorage.getSprintsAvailableForFilling(t).size<=1){this.destroyActionPanel()}}},{key:"moveToBacklog",value:function e(t,i){this.itemMover.moveToAnotherEntity(t,i,this.entityStorage.getBacklog())}},{key:"showTagSearcher",value:function e(t,i,n){var s=this;this.tagSearcher.showTagsDialog(i,n);this.tagSearcher.unsubscribeAll("attachTagToTask");this.tagSearcher.subscribe("attachTagToTask",function(e){var i=e.getData();var n=[];t.getGroupModeItems().forEach(function(e){s.pullItem.addIdToSkipUpdating(e.getId());n.push(e.getId())});s.requestSender.updateTaskTags({itemIds:n,tag:i}).then(function(e){t.getGroupModeItems().forEach(function(e){var t=e.getTags().getValue();t.push(i);e.setTags(t)})}).catch(function(e){s.requestSender.showErrorAlert(e)})});this.tagSearcher.unsubscribeAll("deAttachTagToTask");this.tagSearcher.subscribe("deAttachTagToTask",function(e){var i=e.getData();var n=[];t.getGroupModeItems().forEach(function(e){s.pullItem.addIdToSkipUpdating(e.getId());n.push(e.getId())});s.requestSender.removeTaskTags({itemIds:n,tag:i}).then(function(e){t.getGroupModeItems().forEach(function(e){var t=e.getTags().getValue();t.splice(t.indexOf(i),1);e.setTags(t)})}).catch(function(e){s.requestSender.showErrorAlert(e)})});this.tagSearcher.unsubscribeAll("hideTagDialog");this.tagSearcher.subscribe("hideTagDialog",function(){if(!s.tagSearcher.isEpicDialogShown()){s.destroyActionPanel();t.deactivateGroupMode()}})}},{key:"showEpicSearcher",value:function e(t,i,n){var s=this;this.tagSearcher.showEpicDialog(i,n);this.tagSearcher.unsubscribeAll("updateItemEpic");this.tagSearcher.subscribe("updateItemEpic",function(e){var i=[];var n=e.getData();t.getGroupModeItems().forEach(function(e){e.setEpic(s.tagSearcher.getEpicById(n));i.push(e.getId());s.pullItem.addIdToSkipUpdating(e.getId())});s.requestSender.updateItemEpics({itemIds:i,epicId:n}).then(function(e){}).catch(function(e){s.requestSender.showErrorAlert(e)})});this.tagSearcher.unsubscribeAll("hideEpicDialog");this.tagSearcher.subscribe("hideEpicDialog",function(){s.destroyActionPanel();t.deactivateGroupMode()})}},{key:"removeGroupItems",value:function e(t){var i=this;var n=[];t.getGroupModeItems().forEach(function(e){n.push(e.getId());i.pullItem.addIdToSkipRemoving(e.getId())});return this.requestSender.removeItems({itemIds:n,sortInfo:this.itemMover.calculateSort(t.getListItemsNode())}).catch(function(e){i.requestSender.showErrorAlert(e)})}},{key:"startBacklogDecomposition",value:function e(t,i){this.decomposition=new At({parentItem:i});this.input.setEntity(t);this.input.setBindNode(i.getNode());if(!i.isLinkedTask()){this.itemDesigner.getRandomColorForItemBorder().then(function(e){i.setBorderColor(e)})}this.renderInput()}},{key:"startSprintDecomposition",value:function e(t,i){var n=this;this.decomposition=new At({parentItem:i});var s=function e(s){if(!s.isShown()){t.appendNodeAfterItem(s.render(),i.getNode())}i.showSubTasks();n.input.setEntity(t);n.input.setBindNode(s.getNode());n.renderInput()};if(i.isParentTask()){var r=i.getSubTasks();if(r.isEmpty()){this.requestSender.getSubTaskItems({entityId:t.getId(),taskId:i.getSourceId()}).then(function(e){e.data.forEach(function(e){var i=G.buildItem(e);t.setItem(i);r.addTask(i)});s(r)}).catch(function(e){n.requestSender.showErrorAlert(e)})}else{s(r)}}else{this.input.setEntity(t);this.input.setBindNode(i.getNode());this.renderInput()}}}]);return i}(g);function Ht(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps">\n\t\t\t\t<span>\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"]);Ht=function t(){return e};return e}var Nt=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.ActiveSprintButton");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=l.Tag.render(Ht(),l.Loc.getMessage("TASKS_SCRUM_ACTIONS_COMPLETE_SPRINT"));l.Event.bind(t,"click",this.onCompleteSprintClick.bind(this));return t}},{key:"onCompleteSprintClick",value:function e(){this.emit("completeSprint")}}]);return t}(u.EventEmitter);function Bt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="','">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"]);Bt=function t(){return e};return e}var Mt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.sidePanel=e.sidePanel;i.isTaskLimitsExceeded=e.isTaskLimitsExceeded;i.canUseAutomation=e.canUseAutomation;i.groupId=e.groupId;i.setEventNamespace("BX.Tasks.Scrum.RobotButton");return i}babelHelpers.createClass(t,[{key:"render",value:function e(){var t="tasks-scrum-robot-btn ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-themes ui-btn-round";if(this.isShowLimitSidePanel()){t+=" ui-btn-icon-lock"}var i=l.Tag.render(Bt(),t,l.Loc.getMessage("TASKS_SCRUM_ROBOTS_BUTTON"));l.Event.bind(i,"click",this.onClick.bind(this));return i}},{key:"onClick",value:function e(){if(this.isShowLimitSidePanel()){BX.UI.InfoHelper.show("limit_tasks_robots")}else{var t="/bitrix/components/bitrix/tasks.automation/slider.php?site_id="+l.Loc.getMessage("SITE_ID")+"&project_id="+this.groupId;this.sidePanel.openSidePanelByUrl(t)}}},{key:"isShowLimitSidePanel",value:function e(){return this.isTaskLimitsExceeded&&!this.canUseAutomation}}]);return t}(u.EventEmitter);var Lt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.ActiveSprint");i.setParams(e);if(i.existActiveSprint()){i.bindHandlers()}i.sidePanel=new c;return i}babelHelpers.createClass(t,[{key:"renderSprintStatsTo",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"renderSprintStatsTo",this).call(this,i);if(this.sprint){this.stats=ye.build(this.sprint);this.stats.setKanbanStyle();l.Dom.append(this.stats.render(),i)}}},{key:"renderRightElementsTo",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"renderRightElementsTo",this).call(this,i);if(!this.existActiveSprint()){return}var n=new Mt({sidePanel:this.sidePanel,groupId:this.getCurrentGroupId(),isTaskLimitsExceeded:this.isTaskLimitsExceeded(),canUseAutomation:this.isCanUseAutomation()});var s=new Nt;s.subscribe("completeSprint",this.onCompleteSprint.bind(this));s.subscribe("showBurnDownChart",this.onShowSprintBurnDownChart.bind(this));l.Dom.addClass(i,"--without-bg");l.Dom.append(n.render(),i);l.Dom.append(s.render(),i)}},{key:"setParams",value:function e(t){this.activeSprintId=parseInt(t.activeSprintId,10);this.setTaskLimitsExceeded(t.taskLimitExceeded);this.setCanUseAutomation(t.canUseAutomation);this.views=t.views}},{key:"setTaskLimitsExceeded",value:function e(t){this.limitExceeded=t==="Y"}},{key:"isTaskLimitsExceeded",value:function e(){return this.limitExceeded}},{key:"setCanUseAutomation",value:function e(t){this.canUseAutomation=t==="Y"}},{key:"isCanUseAutomation",value:function e(){return this.canUseAutomation}},{key:"existActiveSprint",value:function e(){return this.activeSprintId>0}},{key:"bindHandlers",value:function e(){var t=this;var i=BX.Tasks.Scrum.Kanban;if(i){this.bindKanbanHandlers(i.getKanban());i.getKanbansGroupedByParentTasks().forEach(function(e){t.bindKanbanHandlers(e)})}}},{key:"bindKanbanHandlers",value:function e(t){var i=this;u.EventEmitter.subscribe(t,"Kanban.Grid:onItemMoved",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,3),s=n[0],r=n[1],a=n[2];i.onItemMoved(s,r,a)})}},{key:"onCompleteSprint",value:function e(t){var i=this;var n=new bt({groupId:this.groupId,sidePanel:this.sidePanel,views:this.views});n.showCompletionForm();n.subscribe("showTask",function(e){i.sidePanel.openSidePanelByUrl(i.getPathToTask().replace("#task_id#",e.getData()))})}},{key:"onItemMoved",value:function e(t,i,n){}},{key:"onShowSprintBurnDownChart",value:function e(t){var i=new bt({groupId:this.groupId,sidePanel:this.sidePanel,views:this.views});i.showBurnDownChart(this.sprint)}}]);return t}(g);function Rt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps">\n\t\t\t\t<span>\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"]);Rt=function t(){return e};return e}var Ft=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.setEventNamespace("BX.Tasks.Scrum.BurnDownButton");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){var t=l.Tag.render(Rt(),l.Loc.getMessage("TASKS_SCRUM_ACTIVE_SPRINT_BUTTON"));l.Event.bind(t,"click",this.onClick.bind(this));return t}},{key:"onClick",value:function e(){this.emit("click")}}]);return t}(u.EventEmitter);var Ot=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Tasks.Scrum.CompletedSprint");i.setParams(e);i.bindHandlers();return i}babelHelpers.createClass(t,[{key:"renderRightElementsTo",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"renderRightElementsTo",this).call(this,i);if(this.completedSprint===null){return}var n=new Ft;n.subscribe("click",this.onShowSprintBurnDownChart.bind(this));l.Dom.addClass(i,"--without-bg");l.Dom.append(n.render(),i)}},{key:"setParams",value:function e(t){var i=this;if(l.Type.isArray(t.completedSprint)){this.completedSprint=null}else{this.completedSprint=new Ke(t.completedSprint)}this.sidePanel=new c;this.sprints=new Map;t.sprints.forEach(function(e){var t=Ke.buildSprint(e);i.sprints.set(t.getId(),t)});this.views=t.views}},{key:"bindHandlers",value:function e(){u.EventEmitter.subscribe("onTasksGroupSelectorChange",this.onSprintSelectorChange.bind(this))}},{key:"onSprintSelectorChange",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),s=n[0];this.completedSprint=this.findSprintBySprintId(s.sprintId);this.titleContainer.textContent=l.Text.encode(s.name)}},{key:"onShowSprintBurnDownChart",value:function e(t){var i=new bt({groupId:this.groupId,sidePanel:this.sidePanel,views:this.views});i.showBurnDownChart(this.completedSprint)}},{key:"findSprintBySprintId",value:function e(t){return babelHelpers.toConsumableArray(this.sprints.values()).find(function(e){return e.getId()===parseInt(t,10)})}}]);return t}(g);var Ut=function(){function e(t){babelHelpers.classCallCheck(this,e);this.setParams(t);this.buildView(t)}babelHelpers.createClass(e,[{key:"setParams",value:function e(t){this.setViewName(t.viewName)}},{key:"setViewName",value:function e(t){var i=new Set(["plan","activeSprint","completedSprint"]);if(!i.has(t)){throw Error("Invalid value to activeView parameter")}this.viewName=t}},{key:"getViewName",value:function e(){return this.viewName}},{key:"setView",value:function e(t){if(t instanceof g){this.view=t}else{this.view=null}}},{key:"getView",value:function e(){return this.view}},{key:"buildView",value:function e(t){var i=this.getViewName();if(i==="plan"){this.setView(new Pt(t))}else if(i==="activeSprint"){this.setView(new Lt(t))}else if(i==="completedSprint"){this.setView(new Ot(t))}}},{key:"renderTo",value:function e(t){var i=this.getView();if(i instanceof g){this.getView().renderTo(t)}}},{key:"renderTabsTo",value:function e(t){var i=this.getView();if(i instanceof g){this.getView().renderTabsTo(t)}}},{key:"renderSprintStatsTo",value:function e(t){var i=this.getView();if(i instanceof g){this.getView().renderSprintStatsTo(t)}}},{key:"renderRightElementsTo",value:function e(t){var i=this.getView();if(i instanceof g){this.getView().renderRightElementsTo(t)}}},{key:"openEpicEditForm",value:function e(t){var i=this.getView();if(i instanceof Pt){i.openEpicEditForm(t)}}},{key:"removeEpic",value:function e(t){var i=this.getView();if(i instanceof Pt){i.removeEpic(t)}}},{key:"setDisplayPriority",value:function e(t,i){if(!l.Dom.hasClass(t,"menu-popup-item-accept")){this.refreshIcons(t);var n=this.getView();if(n instanceof g){this.getView().setDisplayPriority(i)}}}},{key:"refreshIcons",value:function e(t){t.parentElement.childNodes.forEach(function(e){l.Dom.removeClass(e,"menu-popup-item-accept")});l.Dom.addClass(t,"menu-popup-item-accept")}}]);return e}();e.Entry=Ut})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.ShortView,BX.UI.EntitySelector,BX,BX.Main,BX.UI.Dialogs,BX.UI.DragAndDrop,BX,BX,BX.Event);
//# sourceMappingURL=script.map.js