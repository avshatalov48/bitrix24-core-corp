(function(e,t,n,i,o,c){"use strict";var a=t.Reflection.namespace("BX.Messenger.PhpComponent");var r=function(){function e(n){babelHelpers.classCallCheck(this,e);this.pathToAdd=n.pathToAdd;this.pathToEdit=n.pathToEdit;this.pathToList=n.pathToList;this.sliderWidth=n.sliderWidth||800;this.gridId=n.gridId;this.gridManager=t.Reflection.getClass("top.BX.Main.gridManager");this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents()}},{key:"bindEvents",value:function e(){var t=this;n.EventEmitter.subscribe("Grid::updated",(function(){t.bindGridEvents()}));this.bindCreateButtonEvents();this.bindGridEvents()}},{key:"bindCreateButtonEvents",value:function e(){var n=this;var i=document.querySelector(".im-conference-list-empty-button");if(i){t.Event.bind(i,"click",(function(){n.openCreateSlider()}))}var o=document.querySelector(".im-conference-list-panel-button-create");t.Event.bind(o,"click",(function(){n.openCreateSlider()}))}},{key:"bindGridEvents",value:function e(){var n=this;this.rows=document.querySelectorAll(".main-grid-row");this.rows.forEach((function(e){var i=e.getAttribute("data-conference-id");var o=e.getAttribute("data-chat-id");var c=e.getAttribute("data-public-link");var a=!!e.getAttribute("data-conference-finished");var r=e.querySelector(".im-conference-list-controls-button-more");t.Event.bind(r,"click",(function(e){e.preventDefault();n.openContextMenu({buttonNode:r,conferenceId:i,chatId:o})}));var s=e.querySelector(".im-conference-list-controls-button-copy");t.Event.bind(s,"click",(function(e){e.preventDefault();n.copyLink(c)}));var l=e.querySelector(".im-conference-list-chat-name-link");t.Event.bind(l,"click",(function(e){e.preventDefault();n.openEditSlider(i)}))}))}},{key:"openCreateSlider",value:function e(){this.openSlider(this.pathToAdd)}},{key:"openEditSlider",value:function e(t){var n=this.pathToEdit.replace("#id#",t);this.openSlider(n)}},{key:"openSlider",value:function e(n){this.closeContextMenu();if(t.Reflection.getClass("BX.SidePanel")){BX.SidePanel.Instance.open(n,{width:this.sliderWidth,cacheable:false})}}},{key:"copyLink",value:function e(n){c.Clipboard.copy(n);if(t.Reflection.getClass("BX.UI.Notification.Center")){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("CONFERENCE_LIST_NOTIFICATION_LINK_COPIED")})}}},{key:"openContextMenu",value:function e(n){var o=this;var c=n.buttonNode,a=n.conferenceId,r=n.chatId;t.ajax.runComponentAction("bitrix:im.conference.list","getAllowedOperations",{mode:"ajax",data:{conferenceId:a}}).then((function(e){var n=e.data,s=n["delete"],l=n.edit;if(t.Type.isDomNode(c)){var d=[{text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_CHAT"),onclick:function e(){o.openChat(r)}}];if(l){d.push({text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_EDIT"),onclick:function e(){o.openEditSlider(a)}})}if(s){d.push({text:t.Loc.getMessage("CONFERENCE_LIST_CONTEXT_MENU_DELETE"),className:"im-conference-list-context-menu-item-delete menu-popup-no-icon",onclick:function e(){o.deleteAction(a)}})}o.menu=new i.Menu({bindElement:c,items:d,events:{onPopupClose:function e(){this.destroy()}}});o.menu.show()}}))["catch"]((function(e){console.error(e)}))}},{key:"closeContextMenu",value:function e(){if(this.menu){this.menu.close()}}},{key:"openChat",value:function e(n){this.closeContextMenu();if(t.Reflection.getClass("BXIM.openMessenger")){BXIM.openMessenger("chat"+n)}}},{key:"deleteAction",value:function e(n){var i=this;this.closeContextMenu();t.ajax.runComponentAction("bitrix:im.conference.list","deleteConference",{mode:"ajax",data:{conferenceId:n}}).then((function(e){i.onSuccessfulDelete(e)}))["catch"]((function(e){i.onFailedDelete(e)}))}},{key:"onSuccessfulDelete",value:function e(t){if(t.data["LAST_ROW"]===true){top.window.location=this.pathToList;return true}if(this.gridManager){this.gridManager.reload(this.gridId)}}},{key:"onFailedDelete",value:function e(t){o.MessageBox.alert(t["errors"][0].message)}}]);return e}();a.ConferenceList=r})(this.window=this.window||{},BX,BX.Event,BX.Main,BX.UI.Dialogs,BX.Messenger.Lib);
//# sourceMappingURL=script.map.js