BX.namespace("BX.Mobile.Crm.Quote.Edit");BX.Mobile.Crm.Quote.Edit={ajaxPath:"",formActionUrl:"",formId:"",quoteViewPath:"",mode:"",products:[],productDataFieldName:"",productsContainerNode:"",contactContainerNode:"",companyContainerNode:"",leadContainerNode:"",contactInfo:"",companyInfo:"",leadInfo:"",dealInfo:"",isRestrictedMode:false,convDealId:"",onDeleteCompanyEventName:"",onSelectCompanyEventName:"",onSelectContactEventName:"",onSelectDealEventName:"",onSelectLeadEventName:"",pageIdProductSelectorBack:"crmQuoteEditPage",init:function(e){if(e&&typeof e==="object"){this.ajaxPath=e.ajaxPath||"";this.formActionUrl=e.formActionUrl||"";this.formId=e.formId||"";this.quoteViewPath=e.quoteViewPath||"";this.mode=e.mode||"";this.isRestrictedMode=e.isRestrictedMode||false;this.products=e.products||[];this.productDataFieldName=e.productDataFieldName||"";this.contactInfo=e.contactInfo||"";this.companyInfo=e.companyInfo||"";this.leadInfo=e.leadInfo||"";this.dealInfo=e.dealInfo||"";this.convDealId=e.convDealId||"";this.productsContainerNode=document.querySelector("[data-role='mobile-crm-quote-edit-products']")||"";this.contactContainerNode=document.querySelector("[data-role='mobile-crm-quote-edit-contact']")||"";this.companyContainerNode=document.querySelector("[data-role='mobile-crm-quote-edit-company']")||"";this.leadContainerNode=document.querySelector("[data-role='mobile-crm-quote-edit-lead']")||"";this.dealContainerNode=document.querySelector("[data-role='mobile-crm-quote-edit-deal']")||"";this.onDeleteCompanyEventName=e.onDeleteCompanyEventName||"";this.onSelectCompanyEventName=e.onSelectCompanyEventName||"";this.onSelectContactEventName=e.onSelectContactEventName||"";this.onSelectDealEventName=e.onSelectDealEventName||"";this.onSelectLeadEventName=e.onSelectLeadEventName||"";this.pageIdProductSelectorBack=e.pageIdProductSelectorBack||"crmQuoteEditPage"}if(this.mode=="EDIT"||this.mode=="CREATE"){app.setPageID(this.pageIdProductSelectorBack)}if(this.mode=="EDIT"){BXMobileApp.addCustomEvent("onCrmQuoteEditUpdate",BX.proxy(function(e){if(e.formId==this.formId){BXMobileApp.UI.Page.reload()}},this))}if(this.mode=="VIEW"){BXMobileApp.addCustomEvent("onCrmQuoteViewUpdate",BX.proxy(function(e){if(e.formId==this.formId){BXMobileApp.UI.Page.reload()}},this));BX.addCustomEvent("onSubmitAjaxSuccess",BX.proxy(function(e){if(e.formId==this.formId)BXMobileApp.onCustomEvent("onCrmQuoteEditUpdate",{formId:this.formId},true)},this))}BX.addCustomEvent("onCrmQuoteDetailDelete",function(){BXMobileApp.onCustomEvent("onCrmQuoteListUpdate",{},true);BXMobileApp.UI.Page.close({drop:true})});var t={entityContainerNode:this.contactContainerNode,entityInfo:this.contactInfo,isRestrictedMode:this.isRestrictedMode,onSelectEventName:this.onSelectContactEventName};this.contactEditor=new BX.Mobile.Crm.EntityEditor(t);var o={entityContainerNode:this.companyContainerNode,entityInfo:this.companyInfo,isRestrictedMode:this.isRestrictedMode,onDeleteEventName:this.onDeleteCompanyEventName,onSelectEventName:this.onSelectCompanyEventName};this.companyEditor=new BX.Mobile.Crm.EntityEditor(o);if(!this.isRestrictedMode){BX.addCustomEvent(this.onSelectCompanyEventName,BX.proxy(function(e){BX.onCustomEvent("CrmEntitySelectorChangeValue",["COMPANY",e.id])},this));BX.addCustomEvent(this.onDeleteCompanyEventName,BX.proxy(function(){BX.onCustomEvent("CrmEntitySelectorChangeValue",["COMPANY",0])},this))}var i={entityContainerNode:this.leadContainerNode,entityInfo:this.leadInfo,isRestrictedMode:this.isRestrictedMode,onSelectEventName:this.onSelectLeadEventName};this.leadEditor=new BX.Mobile.Crm.EntityEditor(i);var n={entityContainerNode:this.dealContainerNode,entityInfo:this.dealInfo,isRestrictedMode:this.isRestrictedMode,onSelectEventName:this.onSelectDealEventName};this.dealEditor=new BX.Mobile.Crm.EntityEditor(n);if(this.mode=="CONVERT"||this.mode=="CREATE"){var a=function(){BX.removeCustomEvent("onOpenPageAfter",a);app.closeModalDialog()};BX.addCustomEvent("onCrmQuoteClosePage",function(){if(!(window.isCurrentPage&&window.isCurrentPage=="Y")){BX.addCustomEvent("onOpenPageAfter",a)}else{window.isCurrentPage=""}})}if(this.mode=="VIEW"){BXMobileApp.addCustomEvent("onSubmitForm",BX.proxy(function(e,t,o){if(e.formId==this.formId){if(o.checked==false||!o.hasAttribute("checked")){var i=BX.create("INPUT",{attrs:{type:"hidden",name:o.name,value:""}});o.parentNode.insertBefore(i,o)}}},this));BX.addCustomEvent("onSubmitAjaxSuccess",BX.proxy(function(e){if(e.hasOwnProperty("formId")&&e.formId==this.formId){BXMobileApp.onCustomEvent("onCrmQuoteListUpdate",{},true)}},this))}if(this.mode=="VIEW"||this.mode=="EDIT"){var d=BX.delegate(function(e,t,o){if(e==this.formId&&o){BX.addCustomEvent(o,"onChange",BX.proxy(this.onChange,this))}},this);BX.addCustomEvent("onInitialized",d);var r=BX.Mobile.Grid.Form.getByFormId(this.formId);d(this.formId,"",r)}},onChange:function(e,t,o){if(t&&t.name&&t.name=="CURRENCY_ID"){if(typeof BX.Mobile.Crm.ProductEditor=="object"&&BX.Mobile.Crm.ProductEditor){var i=BX.Mobile.Crm.ProductEditor;var n=t.value;i.setCurrencyId(n)}}},submit:function(){BXMobileApp.UI.Page.LoadingScreen.show();var e=BX(this.formId);if(e){var t={sessid:BX.bitrix_sessid()};if(this.convDealId){t["conv_deal_id"]=this.convDealId;t["continue"]="Y"}else{t["save"]="Y"}if(BX.Mobile.Crm.ProductEditor&&BX.Mobile.Crm.ProductEditor.products){t[this.productDataFieldName]=BX.Mobile.Crm.ProductEditor.products}if(this.contactEditor){t["CONTACT_ID"]=this.contactEditor.curEntityId}if(this.companyEditor){t["COMPANY_ID"]=this.companyEditor.curEntityId}if(this.leadEditor){t["LEAD_ID"]=this.leadEditor.curEntityId}if(this.dealEditor){t["DEAL_ID"]=this.dealEditor.curEntityId}BX.Mobile.Crm.Detail.collectInterfaceFormData(e,t);BX.ajax({method:"POST",dataType:"json",url:this.formActionUrl,data:t,onsuccess:BX.proxy(function(e){BXMobileApp.UI.Page.LoadingScreen.hide();if(e.error){app.alert({text:e.error})}else{if(this.mode=="EDIT"){BXMobileApp.onCustomEvent("onCrmQuoteListUpdate",{},true);BXMobileApp.onCustomEvent("onCrmQuoteViewUpdate",{formId:this.formId},true);app.closeModalDialog({cache:false})}if(this.mode=="CREATE"){var t=this.quoteViewPath.replace("#quote_id#",e.itemId);BXMobileApp.onCustomEvent("onCrmQuoteLoadPageBlank",{path:t},true);app.closeModalDialog({cache:false})}if(this.mode=="CONVERT"&&e.url){if(e.url.indexOf("page=edit")>0){BXMobileApp.PageManager.loadPageModal({url:e.url})}else{BXMobileApp.onCustomEvent("onCrmQuoteLoadPageBlank",{path:e.url,type:"convert"},true)}app.closeModalDialog({cache:false})}}},this)})}}};
//# sourceMappingURL=script.map.js