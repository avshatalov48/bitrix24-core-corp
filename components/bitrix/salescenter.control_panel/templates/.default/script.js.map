{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Tag, Event, Type, Reflection, ajax as Ajax} from 'main.core';\nimport {PopupMenu, PopupMenuWindow, PopupWindow, PopupWindowButton} from 'main.popup';\n\nimport {Manager} from 'salescenter.manager';\n\nimport 'marketplace';\nimport 'applayout';\n\nconst namespace = Reflection.namespace('BX.Salescenter');\n\nclass ControlPanel\n{\n\tstatic shopRoot = '/shop/settings/';\n\tstatic commonConnectionDependentTiles = [];\n\tstatic pageMenuTiles = [];\n\tstatic paymentSystemsTile;\n\tstatic userConsentTile;\n\n\tstatic init(options: {\n\t\tshopRoot: string,\n\t})\n\t{\n\t\tif(Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.constructor.shopRoot = options.shopRoot;\n\t\t}\n\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tif (BX.SidePanel.Instance)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.bindAnchors({\n\t\t\t\t\trules: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t\tthis.constructor.shopRoot + \"sale_delivery_service_edit/\",\n\t\t\t\t\t\t\t\tthis.constructor.shopRoot + \"sale_pay_system_edit/\"\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\thandler: this.constructor.adjustSidePanelOpener\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t\t\"/shop/orders/details/(\\\\d+)/\",\n\t\t\t\t\t\t\t\t\"/shop/orders/payment/details/(\\\\d+)/\",\n\t\t\t\t\t\t\t\t\"/shop/orders/shipment/details/(\\\\d+)/\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t\t\"/crm/configs/sale/\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!top.window[\"adminSidePanel\"] || !BX.is_subclass_of(top.window[\"adminSidePanel\"], top.BX.adminSidePanel))\n\t\t\t{\n\t\t\t\ttop.window[\"adminSidePanel\"] = new top.BX.adminSidePanel({\n\t\t\t\t\tpublicMode: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic addCommonConnectionDependentTile(tile: BaseItem)\n\t{\n\t\tControlPanel.commonConnectionDependentTiles.push(tile);\n\t}\n\n\tstatic addPageMenuTile(tile: BaseItem)\n\t{\n\t\tControlPanel.pageMenuTiles.push(tile);\n\t}\n\n\tstatic adjustSidePanelOpener(event, link)\n\t{\n\t\tif (BX.SidePanel.Instance)\n\t\t{\n\t\t\tconst isSidePanelParams = (link.url.indexOf(\"IFRAME=Y&IFRAME_TYPE=SIDE_SLIDER\") >= 0);\n\t\t\tif (!isSidePanelParams || (isSidePanelParams && !BX.SidePanel.Instance.getTopSlider()))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlink.url =\tBX.util.add_url_param(link.url, {\"publicSidePanel\": \"Y\"});\n\t\t\t\tBX.SidePanel.Instance.open(link.url, {\n\t\t\t\t\tallowChangeHistory: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic connectShop(id: string)\n\t{\n\t\tManager.startConnection({\n\t\t\tcontext: id,\n\t\t}).then(() =>\n\t\t{\n\t\t\tManager.loadConfig().then((result) =>\n\t\t\t{\n\t\t\t\tif(result.isSiteExists)\n\t\t\t\t{\n\t\t\t\t\tManager.showAfterConnectPopup();\n\t\t\t\t\tControlPanel.commonConnectionDependentTiles.forEach((item) =>\n\t\t\t\t\t{\n\t\t\t\t\t\titem.data.active = true;\n\t\t\t\t\t\titem.dropMenu();\n\t\t\t\t\t\titem.rerender();\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic paymentSystemsTileClick()\n\t{\n\t\tif(ControlPanel.paymentSystemsTile)\n\t\t{\n\t\t\tControlPanel.paymentSystemsTile.onClick();\n\t\t}\n\t}\n\n\tstatic closeMenu()\n\t{\n\t\tconst menu = PopupMenu.getCurrentMenu();\n\t\tif(menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tstatic dropPageMenus()\n\t{\n\t\tControlPanel.pageMenuTiles.forEach((item: BaseItem) =>\n\t\t{\n\t\t\titem.dropMenu();\n\t\t});\n\t}\n\n\tstatic reloadUserConsentTile()\n\t{\n\t\tif(ControlPanel.userConsentTile)\n\t\t{\n\t\t\tControlPanel.userConsentTile.reloadTile();\n\t\t}\n\t}\n}\n\nclass BaseItem extends BX.TileGrid.Item\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.title = options.title;\n\t\tthis.image = options.image;\n\t\tthis.data = options.data || {};\n\n\t\tif(this.isDependsOnConnection())\n\t\t{\n\t\t\tControlPanel.addCommonConnectionDependentTile(this);\n\t\t}\n\t\tif(this.hasPagesMenu())\n\t\t{\n\t\t\tControlPanel.addPageMenuTile(this);\n\t\t}\n\t\tif(this.id === 'payment-systems')\n\t\t{\n\t\t\tControlPanel.paymentSystemsTile = this;\n\t\t}\n\t\telse if (this.id === 'userconsent')\n\t\t{\n\t\t\tControlPanel.userConsentTile = this;\n\t\t}\n\t}\n\n\tisDependsOnConnection(): boolean\n\t{\n\t\treturn (this.data.isDependsOnConnection === true);\n\t}\n\n\thasPagesMenu(): boolean\n\t{\n\t\treturn (this.data.hasPagesMenu === true);\n\t}\n\n\tgetContent(): Element\n\t{\n\t\tthis.layout.innerContent = Tag.render`<div class=\"salescenter-item ${this.getAdditionalContentClass()}\" onclick=\"${this.onClick.bind(this)}\" style=\"${this.getContentStyles()}\">\n\t\t\t<div class=\"salescenter-item-content\">\n\t\t\t\t${this.getImage()}\n\t\t\t\t${this.getTitle()}\n\t\t\t\t${(this.isActive() ? this.getStatus() : '')}\n\t\t\t\t${this.getLabel()}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\treturn this.layout.innerContent;\n\t}\n\n\trerender()\n\t{\n\t\tif(!this.layout.innerContent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst contentNode = this.layout.innerContent.parentNode;\n\t\tcontentNode.removeChild(this.layout.innerContent);\n\t\tcontentNode.appendChild(this.getContent());\n\t}\n\n\tgetAdditionalContentClass(): string\n\t{\n\t\tif(this.isActive())\n\t\t{\n\t\t\treturn 'salescenter-item-selected';\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn (this.data.active === true);\n\t}\n\n\tgetLoadMenuItemsAction(): ?string\n\t{\n\t\treturn null;\n\t}\n\n\tonClick()\n\t{\n\t\tif(!this.isActive())\n\t\t{\n\t\t\tControlPanel.connectShop(this.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet menu = this.getMenuItems();\n\t\t\tif(!menu)\n\t\t\t{\n\t\t\t\tthis.reloadTile(true).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tmenu = this.getMenuItems();\n\t\t\t\t\tif(this.isActive() && menu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showMenu();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onClick();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showMenu();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetContentStyles(): string\n\t{\n\t\tlet styles = '';\n\t\tif(this.isActive() && this.data.activeColor && !this.isMarketplaceAll())\n\t\t{\n\t\t\tstyles = 'background-color: ' + this.data.activeColor;\n\t\t}\n\n\t\treturn styles;\n\t}\n\n\tgetImage()\n\t{\n\t\tlet path = '';\n\t\tlet className = 'salescenter-item-image';\n\t\tif(this.image)\n\t\t{\n\t\t\tpath = this.image;\n\t\t}\n\t\tif(this.isActive() && this.data.activeImage)\n\t\t{\n\t\t\tpath = this.data.activeImage;\n\t\t}\n\t\tpath = encodeURI(path);\n\n\t\tif (this.isMarketplaceAll()\n\t\t\t&& this.data.hasOwnProperty('hasOwnIcon')\n\t\t\t&& this.data.hasOwnIcon\n\t\t)\n\t\t{\n\t\t\tclassName = 'salescenter-marketplace-item-image';\n\t\t}\n\n\t\treturn Tag.render`<div class=\"${className}\" style=\"background-image:url(${path})\"></div>`;\n\t}\n\n\tgetStatus(): Element\n\t{\n\t\treturn Tag.render`<div class=\"salescenter-item-status-selected\"></div>`;\n\t}\n\n\tgetLabel(): ?Element\n\t{\n\t\tif (this.needNewLabel())\n\t\t{\n\t\t\tlet className = 'salescenter-item-label-new';\n\t\t\tlet classNameText = 'salescenter-item-label-new-text';\n\t\t\tif (this.isActive() && this.data.hasOwnProperty('activeColor'))\n\t\t\t{\n\t\t\t\tclassName = 'salescenter-item-label-new-active';\n\t\t\t\tclassNameText = 'salescenter-item-label-new-text-active';\n\t\t\t}\n\n\t\t\treturn Tag.render`<div class=\"${className}\"><div class=\"${classNameText}\">${BX.message('SALESCENTER_CONTROL_PANEL_ITEM_LABEL_NEW')}</div></div>`;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tgetTitle(): Element\n\t{\n\t\tlet className = this.isMarketplaceAll() ? 'salescenter-marketplace-item-title' : 'salescenter-item-title';\n\t\treturn Tag.render`<div class=\"${className}\">${this.title}</div>`;\n\t}\n\n\tgetMenuItems(): ?Array\n\t{\n\t\treturn this.data.menu;\n\t}\n\n\tdropMenu(): BaseItem\n\t{\n\t\tdelete this.data.menu;\n\n\t\treturn this;\n\t}\n\n\tshowMenu()\n\t{\n\t\tPopupMenu.show(this.id + '-menu', this.layout.container, this.getMenuItems(), {\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: 'salescenter-panel-menu'\n\t\t});\n\t}\n\n\tgetUrl(): ?string\n\t{\n\t\tif(Type.isString(this.data.url))\n\t\t{\n\t\t\treturn this.data.url;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treloadTile(isClick: boolean = false)\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isString(this.data.reloadAction))\n\t\t\t{\n\t\t\t\tAjax.runComponentAction(\n\t\t\t\t\t'bitrix:salescenter.control_panel',\n\t\t\t\t\tthis.data.reloadAction,\n\t\t\t\t\t{\n\t\t\t\t\t\tanalyticsLabel: isClick ? 'salescenterControlPanelReloadTile' : null,\n\t\t\t\t\t\tgetParameters: isClick ? {\n\t\t\t\t\t\t\ttileId: this.id,\n\t\t\t\t\t\t} : null,\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tif(!Type.isNil(response.data.active))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.data.active = response.data.active;\n\t\t\t\t\t}\n\t\t\t\t\tif(!Type.isNil(response.data.menu))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.data.menu = response.data.menu;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.rerender();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tisMarketplaceAll()\n\t{\n\t\treturn this.data.hasOwnProperty('itemSubType')\n\t\t\t&& this.data.itemSubType === 'marketplaceApp';\n\t}\n\n\tneedNewLabel()\n\t{\n\t\treturn this.data.hasOwnProperty('label')\n\t\t\t&& this.data.label === 'new';\n\t}\n\n\topenRestAppLayout(applicationId, appCode)\n\t{\n\t\tAjax.runComponentAction(\n\t\t\t\"bitrix:salescenter.control_panel\",\n\t\t\t\"getRestApp\",\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tcode: appCode\n\t\t\t\t}\n\t\t\t}\n\t\t).then(function(response)\n\t\t{\n\t\t\tlet app = response.data;\n\t\t\tif(app.TYPE === \"A\")\n\t\t\t{\n\t\t\t\tthis.showRestApplication(appCode);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.AppLayout.openApplication(applicationId);\n\t\t\t}\n\t\t}.bind(this)).catch(function(response)\n\t\t{\n\t\t\tthis.restAppErrorPopup(\" \", response.errors.pop().message);\n\t\t}.bind(this));\n\t}\n\n\tshowRestApplication(appCode)\n\t{\n\t\tlet applicationUrlTemplate = \"/marketplace/detail/#app#/\";\n\t\tlet url = applicationUrlTemplate.replace(\"#app#\", encodeURIComponent(appCode));\n\t\tManager.openSlider(url).then(this.reloadTile.bind(this));\n\t}\n\n\trestAppErrorPopup(title, text)\n\t{\n\t\tlet popup = new BX.PopupWindow('rest-app-error-alert', null, {\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: false,\n\t\t\ttitleBar: title,\n\t\t\tcontent: text,\n\t\t\tzIndex: 16000,\n\t\t\toverlay: {\n\t\t\t\tcolor: 'gray',\n\t\t\t\topacity: 30\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\t'id': 'close',\n\t\t\t\t\t'text': BX.message('SALESCENTER_CONTROL_PANEL_POPUP_CLOSE'),\n\t\t\t\t\t'events': {\n\t\t\t\t\t\t'click': function() {\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function() {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function() {\n\t\t\t\t\tpopup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpopup.show();\n\t}\n}\n\nclass PaymentItem extends BaseItem\n{\n\tdropMenu(): BaseItem\n\t{\n\t\treturn this;\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.isMarketplaceAll())\n\t\t{\n\t\t\tif (this.data.active)\n\t\t\t{\n\t\t\t\tthis.openRestAppLayout(this.data.appId, this.data.code);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showRestApplication(this.data.code);\n\t\t\t}\n\t\t}\n\t\telse if (this.isCrmStoreTile())\n\t\t{\n\t\t\tconst url = this.getUrl();\n\t\t\tif(url)\n\t\t\t{\n\t\t\t\tManager.openSlider(url);\n\t\t\t}\n\t\t}\n\t\telse if (this.isRecommendTile())\n\t\t{\n\t\t\tManager.openFeedbackPayOrderForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsuper.onClick();\n\t\t}\n\t}\n\n\tisRecommendTile()\n\t{\n\t\treturn this.id === 'recommendation';\n\t}\n\n\tisCrmStoreTile()\n\t{\n\t\treturn this.id === 'crmstore';\n\t}\n}\n\nclass PaymentSystemItem extends BaseItem\n{\n\tonClick()\n\t{\n\t\tif(this.isDependsOnConnection())\n\t\t{\n\t\t\tsuper.onClick();\n\t\t}\n\t\telse if(this.id === 'userconsent')\n\t\t{\n\t\t\tif(!this.isActive())\n\t\t\t{\n\t\t\t\tconst url = this.getUrl();\n\t\t\t\tif(url)\n\t\t\t\t{\n\t\t\t\t\tManager.openSlider(url).then(this.reloadTile.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showMenu();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst url = this.getUrl();\n\t\t\tif(url)\n\t\t\t{\n\t\t\t\tManager.openSlider(url).then(this.reloadTile.bind(this));\n\t\t\t}\n\t\t}\n\t}\n}\n\nnamespace.ControlPanel = ControlPanel;\nnamespace.PaymentItem = PaymentItem;\nnamespace.PaymentSystemItem = PaymentSystemItem;"],"names":["namespace","Reflection","ControlPanel","options","Type","isPlainObject","constructor","shopRoot","Event","ready","BX","SidePanel","Instance","bindAnchors","rules","condition","handler","adjustSidePanelOpener","top","window","is_subclass_of","adminSidePanel","publicMode","tile","commonConnectionDependentTiles","push","pageMenuTiles","event","link","isSidePanelParams","url","indexOf","getTopSlider","preventDefault","util","add_url_param","open","allowChangeHistory","id","Manager","startConnection","context","then","loadConfig","result","isSiteExists","showAfterConnectPopup","forEach","item","data","active","dropMenu","rerender","paymentSystemsTile","onClick","menu","PopupMenu","getCurrentMenu","destroy","userConsentTile","reloadTile","BaseItem","title","image","isDependsOnConnection","addCommonConnectionDependentTile","hasPagesMenu","addPageMenuTile","layout","innerContent","Tag","render","getAdditionalContentClass","bind","getContentStyles","getImage","getTitle","isActive","getStatus","getLabel","contentNode","parentNode","removeChild","appendChild","getContent","connectShop","getMenuItems","response","showMenu","styles","activeColor","isMarketplaceAll","path","className","activeImage","encodeURI","hasOwnProperty","hasOwnIcon","needNewLabel","classNameText","message","show","container","offsetLeft","offsetTop","closeByEsc","isString","isClick","Promise","resolve","reloadAction","Ajax","runComponentAction","analyticsLabel","getParameters","tileId","mode","isNil","itemSubType","label","applicationId","appCode","code","app","TYPE","showRestApplication","rest","AppLayout","openApplication","catch","restAppErrorPopup","errors","pop","applicationUrlTemplate","replace","encodeURIComponent","openSlider","text","popup","PopupWindow","closeIcon","autoHide","titleBar","content","zIndex","overlay","color","opacity","buttons","PopupWindowButton","close","events","onPopupClose","onPopupDestroy","TileGrid","Item","PaymentItem","openRestAppLayout","appId","isCrmStoreTile","getUrl","isRecommendTile","openFeedbackPayOrderForm","PaymentSystemItem"],"mappings":"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"}