var delegatePopup,delegateUser;var tasksTaskDetailDefaultTemplateInit=function(){BX.bind(BX("task-comments-switcher",true),"click",ToggleSwitcher);BX.bind(BX("task-log-switcher",true),"click",ToggleSwitcher);BX.bind(BX("task-time-switcher",true),"click",ToggleSwitcher);if(BX("task-add-elapsed-time",true)){BX.bind(BX("task-add-elapsed-time",true),"click",AddElaplsedTime);BX.bind(BX("task-send-elapsed-time",true),"click",SendElaplsedTime);BX.bind(BX("task-cancel-elapsed-time",true),"click",CancelElaplsedTime)}if(BX("task-group-edit",true)){BX.bind(BX("task-group-edit",true),"click",tasksDetailsNS.changeTaskGroup)}if(BX("task-group-add",true)){BX.bind(BX("task-group-add",true),"click",tasksDetailsNS.changeTaskGroup)}if(BX("task-group-remove",true)){BX.bind(BX("task-group-remove",true),"click",tasksDetailsNS.clearGroup)}if(BX("task-elapsed-time-form")){var e=BX("task-elapsed-time-form").getElementsByTagName("input");for(var t=0;t<e.length;t++){BX.bind(e[t],"keypress",function(e){if(!e)e=window.event;if(e.keyCode==13){BX.submit(this.form);BX.PreventDefault(e)}})}}var s=BX("task-detail-subtasks-block");if(BX.type.isElementNode(s)&&s.style.display==="none"){BX.addCustomEvent("onTaskListTaskAdd",function(){BX("task-detail-subtasks-block").style.display=""})}};var tasksDetailsNS={taskGroupPopup:null,deleteFile:function(e,t,s,a){if(!confirm(BX.message("TASKS_DELETE_FILE_CONFIRM")))return false;BX.ajax.post("/bitrix/components/bitrix/tasks.task.detail/ajax.php?action=remove_file",{fileId:e,taskId:t,sessid:BX.message("bitrix_sessid")},function(e,t){return function(s){try{if(s==="Success"){BX(e).style.textDecoration="line-through";BX.remove(t)}}catch(a){}}}(s,a))},loadCommentsComponent:function(e,t,s,a,o,i,l,r){BX.ajax.post(tasksDetailPartsNS.detailsAjaxUrl+"&action=render_comments",{sessid:BX.message("bitrix_sessid"),forumId:t,taskId:s,PATH_TO_USER_PROFILE:a,ITEM_DETAIL_COUNT:o,PATH_TO_FORUM_SMILE:i,SHOW_RATING:l,RATING_TYPE:r,NAME_TEMPLATE:BX.message("TASKS_CONTEXT_NAME_TEMPLATE"),TASK_ID:s},function(t){e.innerHTML=t})},loadGroupSelectorViaAjax:function(e){if(tasksDetailsNS.taskGroupPopup){if(e&&e.onload)e.onload();return}var t=BX("task-group-title").text;BX("task-group-title").text=BX.message("TASKS_GROUP_LOADING");BX.Tasks.lwPopup.__initSelectors([{requestedObject:"socialnetwork.group.selector",bindElement:"task-group-name",callbackOnSelect:function(e,t){tasksDetailsNS.onTaskGroupSelect(e,t)},onLoadedViaAjax:function(e,t){return function(s){var a=function(o,i){if(typeof window[s]==="undefined"){if(i>0)window.setTimeout(function(){a(o,i-o)},o)}else{tasksDetailsNS.taskGroupPopup=window[s];var l=BX("task-detail-selected-group-id").value;if(l>0){tasksDetailsNS.taskGroupPopup.select({id:l,title:t})}if(e&&e.onload)e.onload()}};a(100,15e3)}}(e,t)}])},changeTaskGroup:function(e){if(!e)e=window.event;tasksDetailsNS.loadGroupSelectorViaAjax({onload:function(){tasksDetailsNS.taskGroupPopup.show()}});BX.PreventDefault(e)},clearGroup:function(){var e=BX("task-detail-selected-group-id").value;if(typeof e!="undefined"&&e.toString().length>0){tasksDetailsNS.loadGroupSelectorViaAjax({onload:function(e,t){return function(){BX.addClass(BX("task-group-selected"),"hidden");BX.removeClass(BX("task-group-add"),"hidden");tasksDetailsNS.taskGroupPopup.deselect(e);tasksDetailsNS.saveGroup(0)}}(e,this)})}},saveGroup:function(e){var t={mode:"group",sessid:BX.message("bitrix_sessid"),id:detailTaksID,path_to_user:BX.message("TASKS_PATH_TO_USER_PROFILE"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),path_to_user_tasks_task:BX.message("PATH_TO_USER_TASKS_TASK"),groupId:e};BX("task-detail-selected-group-id").value=e;BX.ajax.post(ajaxUrl,t)},onTaskGroupSelect:function(e,t){try{if(typeof t==="object"&&typeof t.onInit!=="undefined"&&t.onInit===true){return}}catch(s){}if(e[0]){BX.html(BX("task-group-title"),BX.util.htmlspecialchars(e[0].title));BX("task-detail-selected-group-id").value=e[0].id;BX("task-group-title").href=BX.message("PATH_TO_GROUP").replace("#group_id#",parseInt(e[0].id));BX.removeClass(BX("task-group-selected"),"hidden");BX.addClass(BX("task-group-add"),"hidden");tasksDetailsNS.saveGroup(e[0].id)}},toggleFavorite:function(e,t){e=parseInt(e);if(!e)return;t=!!t;BX.onCustomEvent(window.document,"onTaskListTaskToggleFavorite",[{way:t}]);BX.ajax({url:ajaxUrl,method:"POST",dataType:"json",data:{mode:"favorite",sessid:BX.message("bitrix_sessid"),id:e,add:t?"1":"0"}})}};function ToggleSwitcher(){if(BX.hasClass(this,"task-switcher-selected"))return false;var e=["task-log","task-time","task-comments"];for(var t=0;t<e.length;t++){var s=BX(e[t]+"-block",true);var a=BX(e[t]+"-switcher",true);if(a===this){BX.addClass(a,"task-switcher-selected");BX.addClass(s,e[t]+"-block-selected")}else{BX.removeClass(a,"task-switcher-selected");if(s){BX.removeClass(s,e[t]+"-block-selected")}}}return false}function GetNumericCase(e,t,s,a){e=parseInt(e,10);if(isNaN(e))return a;if(e<0)e=0-e;e%=100;if(e>=5&&e<=20)return a;e%=10;if(e==1)return t;if(e>=2&&e<=4)return s;return a}function ChangeTaskUsers(e){var t=this.id.replace(/-change/,"");BX.addClass(this.parentNode.parentNode,"task-detail-info-users-empty");BX(t+"-add",true).parentNode.style.display="block";BX.PreventDefault(e)}function AddTaskUsers(e){var t=this.id.replace(/-add/,"");BX.removeClass(BX(t+"-change",true).parentNode.parentNode,"task-detail-info-users-empty");this.parentNode.style.display="none";BX.PreventDefault(e)}function ShowTemplatesPopup(e){var t=BX("task-popup-templates-popup-content",true);BX.PopupWindowManager.create("task-templates-popup",e,{autoHide:true,offsetTop:1,events:{onPopupClose:__onTemplatesPopupClose},content:t}).show();BX.addClass(e,"webform-button-active");return false}function __onTemplatesPopupClose(){BX.removeClass(this.bindElement,"webform-button-active")}function SetReport(e,t){if(t&&BX.hasClass(BX("task-detail-report-no"),"selected")||!t&&BX.hasClass(BX("task-detail-report-yes"),"selected")){BX.toggleClass(BX("task-detail-report-yes"),"selected");BX.toggleClass(BX("task-detail-report-no"),"selected");var s={mode:"report",sessid:BX.message("bitrix_sessid"),id:e,path_to_user:BX.message("TASKS_PATH_TO_USER_PROFILE"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),path_to_user_tasks_task:BX.message("PATH_TO_USER_TASKS_TASK"),report:t};BX.ajax.post(ajaxUrl,s)}}function SaveTags(e){var t="";for(var s=0,a=e.length;s<a;s++){if(s>0)t+=", ";t+=e[s].name}var o={mode:"tags",sessid:BX.message("bitrix_sessid"),id:detailTaksID,path_to_user:BX.message("TASKS_PATH_TO_USER_PROFILE"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),path_to_user_tasks_task:BX.message("PATH_TO_USER_TASKS_TASK"),tags:t};BX.ajax.post(ajaxUrl,o)}function GoToComment(e,t){if(t){BX.proxy(ToggleSwitcher,BX("task-comments-switcher",true))()}setTimeout('window.location = "'+e+'"',10)}var lastRow;function MoveForm(e){var t=BX.findNextSibling(e,{tag:"tr"});if(t){e.parentNode.insertBefore(BX("task-elapsed-time-form-row"),t)}else{e.parentNode.appendChild(BX("task-elapsed-time-form-row"))}if(lastRow){lastRow.style.display=""}lastRow=e;lastRow.style.display="none"}function ShowElapsedForm(e,t,s,a,o,i,l){var i=i||0;BX("task-elapsed-time-form").elements["ELAPSED_ID"].value=e;BX("task-elapsed-time-form").elements["ACTION"].value=t;BX("task-elapsed-time-form").elements["CREATED_DATE"].value=typeof l=="undefined"?"":l;BX("task-elapsed-time-form").elements["HOURS"].value=s;BX("task-elapsed-time-form").elements["MINUTES"].value=a;BX("task-elapsed-time-form").elements["SECONDS"].value=i;BX("task-elapsed-time-form").elements["COMMENT_TEXT"].value=o;if(i>0)BX("task-elapsed-time-form").elements["SECONDS"].style.display="";BX("task-elapsed-time-form-row").style.display="";BX("task-time-comment-column").style.display="";BX("task-elapsed-time-form").elements["HOURS"].focus();BX("task-elapsed-time-form").elements["HOURS"].select()}function AddElaplsedTime(){MoveForm(BX("task-elapsed-time-button-row"));ShowElapsedForm("","elapsed_add","1","00","","")}function EditElapsedTime(e,t,s,a,o,i){var o=o||0;MoveForm(BX("elapsed-time-"+e));ShowElapsedForm(e,"elapsed_update",t,s,a,o,i)}function CancelElaplsedTime(){if(lastRow){lastRow.style.display=""}BX("task-elapsed-time-form").elements["SECONDS"].style.display="none";BX("task-elapsed-time-form-row").style.display="none";BX("task-time-comment-column").style.display="none";BX("task-elapsed-time-button-row").style.display=""}function SendElaplsedTime(){BX.submit(BX("task-elapsed-time-form"));BX.unbind(BX("task-send-elapsed-time",true),"click",SendElaplsedTime)}function ShowNewTaskMenu(e,t,s){BX.PopupMenu.show(-1,e,s,{offsetTop:-2,offsetLeft:-10});return false}
//# sourceMappingURL=script.map.js