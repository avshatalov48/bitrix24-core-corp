(function(e,t,i,s,n){"use strict";var o,a;var r=t.Reflection.namespace("BX.Crm.WhatsNew");var l=function(){function e(i){var s=i.slides,n=i.steps,o=i.options,a=i.closeOptionCategory,r=i.closeOptionName;babelHelpers.classCallCheck(this,e);this.popup=null;this.slides=[];this.steps=[];this.options=o;this.slideClassName="crm-whats-new-slides-wrapper";this.closeOptionCategory=t.Type.isString(a)?a:"";this.closeOptionName=t.Type.isString(r)?r:"";this.onClickClose=this.onClickCloseHandler.bind(this);this.whatNewPromise=null;this.tourPromise=null;this.prepareSlides(s);this.prepareSteps(n)}babelHelpers.createClass(e,[{key:"prepareSlides",value:function e(i){var s=this;if(i.length){this.whatNewPromise=t.Runtime.loadExtension("ui.dialogs.whats-new")}this.slides=i.map((function(e){return{className:s.slideClassName,title:e.title,html:s.getPreparedSlideHtml(e)}}),this)}},{key:"getPreparedSlideHtml",value:function e(i){var s=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-whats-new-slide">\n\t\t\t\t<img src="','" alt="">\n\t\t\t\t<div class="crm-whats-new-slide-inner-title"> '," </div>\n\t\t\t\t<p>","</p>\n\t\t\t</div>\n\t\t"])),i.innerImage,i.innerTitle,i.innerDescription);var n=this.getPrepareSlideButtons(i);if(n.length){var r=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="crm-whats-new-slide-buttons"></div>'])));t.Dom.append(r,s);n.forEach((function(e){t.Dom.append(e.getContainer(),r)}))}return s}},{key:"getPrepareSlideButtons",value:function e(t){var i=this;var n=[];if(t.buttons){var o="ui-btn ui-btn-primary ui-btn-hover ui-btn-round ";n=t.buttons.map((function(e){var t;var n={className:o+((t=e.className)!==null&&t!==void 0?t:""),text:e.text};if(e.onClickClose){n.onclick=function(){return i.onClickClose()}}else if(e.helpDeskCode){n.onclick=function(){return i.showHelpDesk(e.helpDeskCode)}}return new s.Button(n)}),this)}return n}},{key:"prepareSteps",value:function e(i){var s=this;if(i.length){this.tourPromise=t.Runtime.loadExtension("ui.tour")}this.steps=i.map((function(e){var t={id:e.id,title:e.title,text:e.text,position:e.position};if(e.useDynamicTarget){var i;var o=(i=e.eventName)!==null&&i!==void 0?i:s.getDefaultStepEventName(t.id);n.EventEmitter.subscribeOnce(o,s.showStepByEvent.bind(s))}else{t.target=e.target}return t}),this)}},{key:"showStepByEvent",value:function e(t){var i=this;this.tourPromise.then((function(e){var s=t.data,n=s.stepId,o=s.target,a=s.delay;var r=i.steps.find((function(e){return e.id===n}));if(!r){console.error("step not found");return}setTimeout((function(){r.target=o;var t=e.Guide;var s=i.createGuideInstance(t,[r],true);i.setStepPopupOptions(s.getPopup());s.showNextStep();i.save()}),a||0)}))}},{key:"getDefaultStepEventName",value:function e(t){return"Crm.WhatsNew::onTargetSetted::".concat(t)}},{key:"onClickCloseHandler",value:function e(){var t=this.popup.getLastPosition();var i=this.popup.getPositionBySlide(this.popup.getCurrentSlide());if(i>=t){this.popup.destroy()}else{this.popup.selectNextSlide()}}},{key:"showHelpDesk",value:function e(t){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=".concat(t));event.preventDefault()}}},{key:"show",value:function e(){if(this.slides.length){this.executeWhatsNew()}else if(this.steps.length){this.executeGuide()}}},{key:"executeWhatsNew",value:function e(){var t=this;if(i.PopupManager&&i.PopupManager.isAnyPopupShown()){return}this.whatNewPromise.then((function(e){var i=e.WhatsNew;t.popup=new i({slides:t.slides,popupOptions:{height:440},events:{onDestroy:function e(){t.save();t.executeGuide()}}});t.popup.show()}),this)}},{key:"executeGuide",value:function e(){var i=this;var s=t.clone(this.steps);s=s.filter((function(e){return Boolean(e.target)}));if(!s.length){return}this.tourPromise.then((function(e){var t=e.Guide;var n=i.createGuideInstance(t,s,i.steps.length<=1);i.setStepPopupOptions(n.getPopup());if(n.steps.length>1){n.start()}else{n.showNextStep()}}))}},{key:"createGuideInstance",value:function e(t,i,s){var n=this;return new t({onEvents:s,steps:i,events:{onFinish:function e(){if(!n.slides.length){n.save()}}}})}},{key:"setStepPopupOptions",value:function e(t){t.setAutoHide(false);var i=this.options.steps;if(i&&i.popup){if(i.popup.width){t.setWidth(i.popup.width)}}}},{key:"save",value:function e(){BX.userOptions.save(this.closeOptionCategory,this.closeOptionName,"closed","Y")}}]);return e}();r.ActionViewMode=l})(this.window=this.window||{},BX,BX.Main,BX.UI,BX.Event);
//# sourceMappingURL=script.map.js