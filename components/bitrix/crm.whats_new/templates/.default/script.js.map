{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { BannerDispatcher } from 'crm.integration.ui.banner-dispatcher';\nimport { ajax as Ajax, clone, Dom, Reflection, Runtime, Tag, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { Guide as UIGuide } from 'ui.tour';\n\nconst namespaceCrmWhatsNew = Reflection.namespace('BX.Crm.WhatsNew');\n\ntype SlideConfig = {\n\ttitle: string,\n\tinnerImage: string,\n\tinnerTitle: string,\n\tinnerDescription: string,\n\tbuttons: Array<ButtonConfig>,\n};\n\ntype ButtonConfig = {\n\ttext: string,\n\tclassName: string,\n\tonClickClose: ?boolean,\n\thelpDeskCode: ?string,\n}\n\ntype Slide = {\n\ttitle: string,\n\tclassName: ?string,\n\thtml: string,\n}\n\ntype StepPosition = 'left' | 'right'; // it's bottom by default\n\ntype StepConfig = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n\treserveTargets: ?string[],\n\tuseDynamicTarget: ?boolean,\n\teventName: ?string,\n\tarticle: ?number,\n\tarticleAnchor?: string,\n\tinfoHelperCode: ?string,\n\tignoreIfTargetNotFound: ?boolean,\n}\n\ntype Step = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n}\n\ntype Option = {\n\tshowOverlayFromFirstStep?: boolean,\n\thideTourOnMissClick?: boolean,\n\tnumberOfViewsLimit:\tnumber,\n\tisNumberOfViewsExceeded?: boolean,\n\tdisableBannerDispatcher?: boolean,\n\tadditionalTourIdsForDisable?: Array<string>,\n\t...\n}\n\nclass ActionViewMode\n{\n\t#slides: Array<Slide>;\n\t#steps: Array<Step>;\n\t#options: Option;\n\n\t#popup: ?Popup;\n\t#bannerDispatcher: ?BannerDispatcher = null;\n\n\t#closeOptionName: string;\n\t#closeOptionCategory: string;\n\n\t#isViewHappened: boolean = false;\n\n\tconstructor({ slides, steps, options, closeOptionCategory, closeOptionName })\n\t{\n\t\tthis.#slides = [];\n\t\tthis.#steps = [];\n\n\t\tthis.#options = options;\n\t\tthis.#popup = null;\n\t\tthis.slideClassName = 'crm-whats-new-slides-wrapper';\n\t\tthis.#closeOptionCategory = Type.isString(closeOptionCategory) ? closeOptionCategory : '';\n\t\tthis.#closeOptionName = Type.isString(closeOptionName) ? closeOptionName : '';\n\t\tthis.onClickClose = this.onClickCloseHandler.bind(this);\n\n\t\tthis.whatNewPromise = null;\n\t\tthis.tourPromise = null;\n\n\t\tthis.#prepareSlides(slides);\n\t\tthis.#prepareSteps(steps);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.#options.isNumberOfViewsExceeded)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Number of views exceeded');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#slides.length > 0)\n\t\t{\n\t\t\tthis.#executeWhatsNew();\n\t\t}\n\t\telse if (this.#steps.length > 0)\n\t\t{\n\t\t\tthis.#executeGuide();\n\t\t}\n\t}\n\n\t#prepareSlides(slideConfigs: Array<SlideConfig>): void\n\t{\n\t\tif (slideConfigs.length > 0)\n\t\t{\n\t\t\tthis.whatNewPromise = Runtime.loadExtension('ui.dialogs.whats-new');\n\t\t}\n\n\t\tthis.#slides = slideConfigs.map((slideConfig: SlideConfig) => {\n\t\t\treturn {\n\t\t\t\tclassName: this.slideClassName,\n\t\t\t\ttitle: slideConfig.title,\n\t\t\t\thtml: this.#getPreparedSlideHtml(slideConfig),\n\t\t\t};\n\t\t});\n\t}\n\n\t#getPreparedSlideHtml(slideConfig: SlideConfig): HTMLElement\n\t{\n\t\tconst slide = Tag.render`\n\t\t\t<div class=\"crm-whats-new-slide\">\n\t\t\t\t<img src=\"${slideConfig.innerImage}\" alt=\"\">\n\t\t\t\t<div class=\"crm-whats-new-slide-inner-title\"> ${slideConfig.innerTitle} </div>\n\t\t\t\t<p>${slideConfig.innerDescription}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst buttons = this.#getPrepareSlideButtons(slideConfig);\n\t\tif (buttons.length > 0)\n\t\t{\n\t\t\tconst buttonsContainer = Tag.render`<div class=\"crm-whats-new-slide-buttons\"></div>`;\n\t\t\tDom.append(buttonsContainer, slide);\n\n\t\t\tbuttons.forEach((button) => {\n\t\t\t\tDom.append(button.getContainer(), buttonsContainer);\n\t\t\t});\n\t\t}\n\n\t\treturn slide;\n\t}\n\n\tasync #getBannerDispatcher(): Promise<BannerDispatcher>\n\t{\n\t\tif (this.#bannerDispatcher)\n\t\t{\n\t\t\treturn this.#bannerDispatcher;\n\t\t}\n\n\t\tconst { BannerDispatcher: Dispatcher } = await Runtime.loadExtension('crm.integration.ui.banner-dispatcher');\n\t\tthis.#bannerDispatcher = new Dispatcher();\n\n\t\treturn this.#bannerDispatcher;\n\t}\n\n\t#getPrepareSlideButtons(slideConfig: SlideConfig): Button[]\n\t{\n\t\tlet buttons = [];\n\t\tif (slideConfig.buttons)\n\t\t{\n\t\t\tconst className = 'ui-btn ui-btn-primary ui-btn-hover ui-btn-round ';\n\n\t\t\tbuttons = slideConfig.buttons.map((buttonConfig) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tclassName: className + (buttonConfig.className ?? ''),\n\t\t\t\t\ttext: buttonConfig.text,\n\t\t\t\t};\n\n\t\t\t\tif (buttonConfig.onClickClose)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.onClickClose();\n\t\t\t\t}\n\t\t\t\telse if (buttonConfig.helpDeskCode)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.#showHelpDesk(buttonConfig.helpDeskCode);\n\t\t\t\t}\n\n\t\t\t\treturn new Button(config);\n\t\t\t});\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\t#prepareSteps(stepsConfig): void\n\t{\n\t\tthis.#steps = stepsConfig.map((stepConfig: StepConfig) => {\n\t\t\tconst step = {\n\t\t\t\tid: stepConfig.id,\n\t\t\t\ttitle: stepConfig.title,\n\t\t\t\ttext: stepConfig.text,\n\t\t\t\tposition: stepConfig.position,\n\t\t\t\tarticle: stepConfig.article,\n\t\t\t\tarticleAnchor: stepConfig.articleAnchor ?? null,\n\t\t\t\tinfoHelperCode: stepConfig.infoHelperCode,\n\t\t\t};\n\n\t\t\tif (stepConfig.useDynamicTarget)\n\t\t\t{\n\t\t\t\tconst eventName = (stepConfig.eventName ?? this.#getDefaultStepEventName(step.id));\n\t\t\t\tEventEmitter.subscribeOnce(eventName, this.#showStepByEvent.bind(this));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst target = document.querySelector(stepConfig.target);\n\t\t\t\tif (target && Dom.style(target, 'display') !== 'none')\n\t\t\t\t{\n\t\t\t\t\tstep.target = stepConfig.target;\n\t\t\t\t}\n\t\t\t\telse if (Type.isArrayFilled(stepConfig.reserveTargets))\n\t\t\t\t{\n\t\t\t\t\tconst isFound = stepConfig.reserveTargets.some((reserveTarget) => {\n\t\t\t\t\t\tif (document.querySelector(reserveTarget))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstep.target = reserveTarget;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!isFound && stepConfig.ignoreIfTargetNotFound)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (stepConfig.ignoreIfTargetNotFound)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstep.target = stepConfig.target;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn step;\n\t\t});\n\n\t\tthis.#steps = this.#steps.filter((step: ?Object) => step !== null);\n\t\tif (this.#steps.length > 0)\n\t\t{\n\t\t\tthis.tourPromise = Runtime.loadExtension('ui.tour');\n\t\t}\n\t}\n\n\t#showStepByEvent(event: BaseEvent): void\n\t{\n\t\tconst { disableBannerDispatcher = false } = this.#options;\n\n\t\tvoid this.tourPromise.then((exports) => {\n\t\t\tconst { stepId, target } = event.data;\n\t\t\t// eslint-disable-next-line no-shadow\n\t\t\tconst step = this.#steps.find((step) => step.id === stepId);\n\t\t\tif (!step)\n\t\t\t{\n\t\t\t\tconsole.error('step not found');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstep.target = target;\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, [step], true);\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tif (disableBannerDispatcher === false)\n\t\t\t{\n\t\t\t\tthis.#runGuideWithBannerDispatcher(guide);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#runGuide(guide);\n\t\t\t}\n\t\t});\n\t}\n\n\t#runGuideWithBannerDispatcher(guide: Object): void\n\t{\n\t\tvoid this.#getBannerDispatcher().then((dispatcher: BannerDispatcher) => {\n\t\t\tdispatcher.toQueue((onDone: Function) => {\n\t\t\t\tthis.#runGuide(guide, onDone);\n\t\t\t});\n\t\t});\n\t}\n\n\t#onGuideFinish(guide: Object, onDone: Function = null): void\n\t{\n\t\tguide.subscribe('UI.Tour.Guide:onFinish', () => {\n\t\t\tthis.save();\n\t\t\tif (onDone)\n\t\t\t{\n\t\t\t\tonDone();\n\t\t\t}\n\t\t});\n\t}\n\n\t#runGuide(guide: Object, onDone: Function = null): void\n\t{\n\t\tthis.#onGuideFinish(guide, onDone);\n\t\tguide.showNextStep();\n\t}\n\n\t#getDefaultStepEventName(stepId: string): string\n\t{\n\t\treturn `Crm.WhatsNew::onTargetSetted::${stepId}`;\n\t}\n\n\t#isMultipleViewsAllowed(): boolean\n\t{\n\t\treturn this.#options.numberOfViewsLimit > 1;\n\t}\n\n\tonClickCloseHandler(): void\n\t{\n\t\tconst lastPosition = this.#popup.getLastPosition();\n\t\tconst currentPosition = this.#popup.getPositionBySlide(this.#popup.getCurrentSlide());\n\t\tif (currentPosition >= lastPosition)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup.selectNextSlide();\n\t\t}\n\t}\n\n\t#showHelpDesk(code: string): void\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${code}`);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#executeWhatsNew(): void\n\t{\n\t\tconst { disableBannerDispatcher = false } = this.#options;\n\n\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.whatNewPromise.then((exports) => {\n\t\t\tconst { WhatsNew } = exports;\n\t\t\tthis.#popup = new WhatsNew({\n\t\t\t\tslides: this.#slides,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\theight: 440,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tthis.#executeGuide(false);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (disableBannerDispatcher === false)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line promise/no-nesting\n\t\t\t\tvoid this.#getBannerDispatcher().then((dispatcher: BannerDispatcher) => {\n\t\t\t\t\tdispatcher.toQueue((onDone: Function) => {\n\t\t\t\t\t\tthis.#popup.subscribe('onDestroy', onDone);\n\t\t\t\t\t\tthis.#popup.show();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\n\t\t\tActionViewMode.whatsNewInstances.push(this.#popup);\n\t\t}, this);\n\t}\n\n\t#executeGuide(isAddToQueue: boolean = true): void\n\t{\n\t\tconst { disableBannerDispatcher = false } = this.#options;\n\t\tlet steps = clone(this.#steps);\n\n\t\tsteps = steps.filter((step) => Boolean(step.target));\n\n\t\tif (steps.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.tourPromise.then((exports) => {\n\t\t\tif (ActionViewMode.tourInstances.some((existedGuide) => existedGuide.getPopup()?.isShown()))\n\t\t\t{\n\t\t\t\treturn; // do not allow many guides at the same time\n\t\t\t}\n\n\t\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, steps, (this.#steps.length <= 1));\n\t\t\tActionViewMode.tourInstances.push(guide);\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tif (isAddToQueue)\n\t\t\t{\n\t\t\t\tif (disableBannerDispatcher === false)\n\t\t\t\t{\n\t\t\t\t\tthis.#runGuideWithBannerDispatcher(guide);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#runGuide(guide);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#showGuide(guide);\n\t\t});\n\t}\n\n\t#showGuide(guide: UIGuide): void\n\t{\n\t\tif (guide.steps.length > 1 || this.#options.showOverlayFromFirstStep)\n\t\t{\n\t\t\tguide.start();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tguide.showNextStep();\n\t\t}\n\t}\n\n\tcreateGuideInstance(Guide, steps: Array<Step>, onEvents: boolean): Object\n\t{\n\t\treturn new Guide({\n\t\t\tonEvents,\n\t\t\tsteps,\n\t\t\tevents: {\n\t\t\t\tonFinish: () => {\n\t\t\t\t\tif (this.#slides.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tsetStepPopupOptions(popup: Popup): void\n\t{\n\t\tconst { steps, hideTourOnMissClick = false } = this.#options;\n\n\t\tpopup.setAutoHide(hideTourOnMissClick);\n\n\t\tif (steps?.popup?.width)\n\t\t{\n\t\t\tpopup.setWidth(steps.popup.width);\n\t\t}\n\t}\n\n\tsave(): void\n\t{\n\t\tAjax.runAction('crm.settings.tour.updateOption', {\n\t\t\tjson: {\n\t\t\t\tcategory: this.#closeOptionCategory,\n\t\t\t\tname: this.#closeOptionName,\n\t\t\t\toptions: {\n\t\t\t\t\tisMultipleViewsAllowed: !this.#isViewHappened && this.#isMultipleViewsAllowed(),\n\t\t\t\t\tnumberOfViewsLimit: this.#options.numberOfViewsLimit ?? 1,\n\t\t\t\t\tadditionalTourIdsForDisable: this.#options.additionalTourIdsForDisable ?? null,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then(({ data }) => {\n\t\t\tthis.#options.isNumberOfViewsExceeded = data.isNumberOfViewsExceeded;\n\t\t\tthis.#isViewHappened = true;\n\t\t}).catch((errors) => {\n\t\t\tconsole.error('Could not save tour settings', errors);\n\t\t});\n\t}\n\n\tstatic tourInstances = [];\n\tstatic whatsNewInstances = [];\n}\n\nnamespaceCrmWhatsNew.ActionViewMode = ActionViewMode;\n"],"names":["namespaceCrmWhatsNew","Reflection","namespace","ActionViewMode","slides","steps","options","closeOptionCategory","closeOptionName","slideClassName","Type","isString","onClickClose","onClickCloseHandler","bind","whatNewPromise","tourPromise","isNumberOfViewsExceeded","console","warn","length","lastPosition","getLastPosition","currentPosition","getPositionBySlide","getCurrentSlide","destroy","selectNextSlide","Guide","onEvents","events","onFinish","save","popup","hideTourOnMissClick","setAutoHide","width","setWidth","Ajax","runAction","json","category","name","isMultipleViewsAllowed","numberOfViewsLimit","additionalTourIdsForDisable","then","data","errors","error","slideConfigs","Runtime","loadExtension","map","slideConfig","className","title","html","slide","Tag","render","innerImage","innerTitle","innerDescription","buttons","buttonsContainer","Dom","append","forEach","button","getContainer","Dispatcher","BannerDispatcher","buttonConfig","config","text","onclick","helpDeskCode","Button","stepsConfig","stepConfig","step","id","position","article","articleAnchor","infoHelperCode","useDynamicTarget","eventName","EventEmitter","subscribeOnce","target","document","querySelector","style","isArrayFilled","reserveTargets","isFound","some","reserveTarget","ignoreIfTargetNotFound","filter","event","disableBannerDispatcher","exports","stepId","find","guide","createGuideInstance","setStepPopupOptions","getPopup","dispatcher","toQueue","onDone","subscribe","showNextStep","code","top","BX","Helper","show","preventDefault","PopupManager","isAnyPopupShown","WhatsNew","popupOptions","height","onDestroy","whatsNewInstances","push","isAddToQueue","clone","Boolean","tourInstances","existedGuide","isShown","showOverlayFromFirstStep","start"],"mappings":"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"}