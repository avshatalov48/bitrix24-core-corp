{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, clone, Dom, Reflection, Runtime, Tag, Type } from 'main.core';\nimport { BannerDispatcher } from 'crm.integration.ui.banner-dispatcher';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { Guide as UIGuide } from 'ui.tour';\n\nconst namespaceCrmWhatsNew = Reflection.namespace('BX.Crm.WhatsNew');\n\ntype SlideConfig = {\n\ttitle: string,\n\tinnerImage: string,\n\tinnerTitle: string,\n\tinnerDescription: string,\n\tbuttons: Array<ButtonConfig>,\n};\n\ntype ButtonConfig = {\n\ttext: string,\n\tclassName: string,\n\tonClickClose: ?boolean,\n\thelpDeskCode: ?string,\n}\n\ntype Slide = {\n\ttitle: string,\n\tclassName: ?string,\n\thtml: string,\n}\n\ntype StepPosition = 'left' | 'right'; // it's bottom by default\n\ntype StepConfig = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n\tuseDynamicTarget: ?boolean,\n\teventName: ?string,\n\tarticle: ?number,\n\tinfoHelperCode: ?string,\n}\n\ntype Step = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n}\n\ntype Option = {\n\tshowOverlayFromFirstStep?: boolean,\n\thideTourOnMissClick?: boolean,\n\tnumberOfViewsLimit:\tnumber,\n\tisNumberOfViewsExceeded?: boolean,\n\t...\n}\n\nclass ActionViewMode\n{\n\t#slides: Array<Slide>;\n\t#steps: Array<Step>;\n\t#options: Option;\n\n\t#popup: ?Popup;\n\t#bannerDispatcher: ?BannerDispatcher = null;\n\n\t#closeOptionName: string;\n\t#closeOptionCategory: string;\n\n\t#isViewHappened: boolean = false;\n\n\tconstructor({ slides, steps, options, closeOptionCategory, closeOptionName })\n\t{\n\t\tthis.#slides = [];\n\t\tthis.#steps = [];\n\n\t\tthis.#options = options;\n\t\tthis.#popup = null;\n\t\tthis.slideClassName = 'crm-whats-new-slides-wrapper';\n\t\tthis.#closeOptionCategory = Type.isString(closeOptionCategory) ? closeOptionCategory : '';\n\t\tthis.#closeOptionName = Type.isString(closeOptionName) ? closeOptionName : '';\n\t\tthis.onClickClose = this.onClickCloseHandler.bind(this);\n\n\t\tthis.whatNewPromise = null;\n\t\tthis.tourPromise = null;\n\n\t\tthis.#prepareSlides(slides);\n\t\tthis.#prepareSteps(steps);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.#options.isNumberOfViewsExceeded)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Number of views exceeded');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#slides.length > 0)\n\t\t{\n\t\t\tthis.#executeWhatsNew();\n\t\t}\n\t\telse if (this.#steps.length > 0)\n\t\t{\n\t\t\tthis.#executeGuide();\n\t\t}\n\t}\n\n\t#prepareSlides(slideConfigs: Array<SlideConfig>): void\n\t{\n\t\tif (slideConfigs.length > 0)\n\t\t{\n\t\t\tthis.whatNewPromise = Runtime.loadExtension('ui.dialogs.whats-new');\n\t\t}\n\n\t\tthis.#slides = slideConfigs.map((slideConfig: SlideConfig) => {\n\t\t\treturn {\n\t\t\t\tclassName: this.slideClassName,\n\t\t\t\ttitle: slideConfig.title,\n\t\t\t\thtml: this.#getPreparedSlideHtml(slideConfig),\n\t\t\t};\n\t\t});\n\t}\n\n\t#getPreparedSlideHtml(slideConfig: SlideConfig): HTMLElement\n\t{\n\t\tconst slide = Tag.render`\n\t\t\t<div class=\"crm-whats-new-slide\">\n\t\t\t\t<img src=\"${slideConfig.innerImage}\" alt=\"\">\n\t\t\t\t<div class=\"crm-whats-new-slide-inner-title\"> ${slideConfig.innerTitle} </div>\n\t\t\t\t<p>${slideConfig.innerDescription}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst buttons = this.#getPrepareSlideButtons(slideConfig);\n\t\tif (buttons.length > 0)\n\t\t{\n\t\t\tconst buttonsContainer = Tag.render`<div class=\"crm-whats-new-slide-buttons\"></div>`;\n\t\t\tDom.append(buttonsContainer, slide);\n\n\t\t\tbuttons.forEach((button) => {\n\t\t\t\tDom.append(button.getContainer(), buttonsContainer);\n\t\t\t});\n\t\t}\n\n\t\treturn slide;\n\t}\n\n\tasync #getBannerDispatcher(): Promise<BannerDispatcher>\n\t{\n\t\tif (this.#bannerDispatcher)\n\t\t{\n\t\t\treturn this.#bannerDispatcher;\n\t\t}\n\n\t\tconst { BannerDispatcher: Dispatcher } = await Runtime.loadExtension('crm.integration.ui.banner-dispatcher');\n\t\tthis.#bannerDispatcher = new Dispatcher();\n\n\t\treturn this.#bannerDispatcher;\n\t}\n\n\t#getPrepareSlideButtons(slideConfig: SlideConfig): Button[]\n\t{\n\t\tlet buttons = [];\n\t\tif (slideConfig.buttons)\n\t\t{\n\t\t\tconst className = 'ui-btn ui-btn-primary ui-btn-hover ui-btn-round ';\n\n\t\t\tbuttons = slideConfig.buttons.map((buttonConfig) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tclassName: className + (buttonConfig.className ?? ''),\n\t\t\t\t\ttext: buttonConfig.text,\n\t\t\t\t};\n\n\t\t\t\tif (buttonConfig.onClickClose)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.onClickClose();\n\t\t\t\t}\n\t\t\t\telse if (buttonConfig.helpDeskCode)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.#showHelpDesk(buttonConfig.helpDeskCode);\n\t\t\t\t}\n\n\t\t\t\treturn new Button(config);\n\t\t\t});\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\t#prepareSteps(stepsConfig): void\n\t{\n\t\tif (stepsConfig.length > 0)\n\t\t{\n\t\t\tthis.tourPromise = Runtime.loadExtension('ui.tour');\n\t\t}\n\n\t\tthis.#steps = stepsConfig.map((stepConfig: StepConfig) => {\n\t\t\tconst step = {\n\t\t\t\tid: stepConfig.id,\n\t\t\t\ttitle: stepConfig.title,\n\t\t\t\ttext: stepConfig.text,\n\t\t\t\tposition: stepConfig.position,\n\t\t\t\tarticle: stepConfig.article,\n\t\t\t\tinfoHelperCode: stepConfig.infoHelperCode,\n\t\t\t};\n\n\t\t\tif (stepConfig.useDynamicTarget)\n\t\t\t{\n\t\t\t\tconst eventName = (stepConfig.eventName ?? this.#getDefaultStepEventName(step.id));\n\t\t\t\tEventEmitter.subscribeOnce(eventName, this.#showStepByEvent.bind(this));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstep.target = stepConfig.target;\n\t\t\t}\n\n\t\t\treturn step;\n\t\t});\n\t}\n\n\t#showStepByEvent(event: BaseEvent): void\n\t{\n\t\tvoid this.tourPromise.then((exports) => {\n\t\t\tconst { stepId, target } = event.data;\n\t\t\t// eslint-disable-next-line no-shadow\n\t\t\tconst step = this.#steps.find((step) => step.id === stepId);\n\t\t\tif (!step)\n\t\t\t{\n\t\t\t\tconsole.error('step not found');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstep.target = target;\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, [step], true);\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tvoid this.#getBannerDispatcher().then((dispatcher: BannerDispatcher) => {\n\t\t\t\tdispatcher.toQueue((onDone: Function) => {\n\t\t\t\t\tguide.subscribe('UI.Tour.Guide:onFinish', () => {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tonDone();\n\t\t\t\t\t});\n\n\t\t\t\t\tguide.showNextStep();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#getDefaultStepEventName(stepId: string): string\n\t{\n\t\treturn `Crm.WhatsNew::onTargetSetted::${stepId}`;\n\t}\n\n\t#isMultipleViewsAllowed(): boolean\n\t{\n\t\treturn this.#options.numberOfViewsLimit > 1;\n\t}\n\n\tonClickCloseHandler(): void\n\t{\n\t\tconst lastPosition = this.#popup.getLastPosition();\n\t\tconst currentPosition = this.#popup.getPositionBySlide(this.#popup.getCurrentSlide());\n\t\tif (currentPosition >= lastPosition)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup.selectNextSlide();\n\t\t}\n\t}\n\n\t#showHelpDesk(code: string): void\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${code}`);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#executeWhatsNew(): void\n\t{\n\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.whatNewPromise.then((exports) => {\n\t\t\tconst { WhatsNew } = exports;\n\t\t\tthis.#popup = new WhatsNew({\n\t\t\t\tslides: this.#slides,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\theight: 440,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tthis.#executeGuide(false);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// eslint-disable-next-line promise/no-nesting\n\t\t\tvoid this.#getBannerDispatcher().then((dispatcher: BannerDispatcher) => {\n\t\t\t\tdispatcher.toQueue((onDone: Function) => {\n\t\t\t\t\tthis.#popup.subscribe('onDestroy', onDone);\n\t\t\t\t\tthis.#popup.show();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tActionViewMode.whatsNewInstances.push(this.#popup);\n\t\t}, this);\n\t}\n\n\t#executeGuide(isAddToQueue: boolean = true): void\n\t{\n\t\tlet steps = clone(this.#steps);\n\n\t\tsteps = steps.filter((step) => Boolean(step.target));\n\n\t\tif (steps.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.tourPromise.then((exports) => {\n\t\t\tif (ActionViewMode.tourInstances.some((existedGuide) => existedGuide.getPopup()?.isShown()))\n\t\t\t{\n\t\t\t\treturn; // do not allow many guides at the same time\n\t\t\t}\n\n\t\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, steps, (this.#steps.length <= 1));\n\t\t\tActionViewMode.tourInstances.push(guide);\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tif (isAddToQueue)\n\t\t\t{\n\t\t\t\tvoid this.#getBannerDispatcher().then((dispatcher: BannerDispatcher) => {\n\t\t\t\t\tdispatcher.toQueue((onDone: Function) => {\n\t\t\t\t\t\tguide.subscribe('UI.Tour.Guide:onFinish', () => {\n\t\t\t\t\t\t\tonDone();\n\t\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#showGuide(guide);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#showGuide(guide);\n\t\t});\n\t}\n\n\t#showGuide(guide: UIGuide): void\n\t{\n\t\tif (guide.steps.length > 1 || this.#options.showOverlayFromFirstStep)\n\t\t{\n\t\t\tguide.start();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tguide.showNextStep();\n\t\t}\n\t}\n\n\tcreateGuideInstance(Guide, steps: Array<Step>, onEvents: boolean): Object\n\t{\n\t\treturn new Guide({\n\t\t\tonEvents,\n\t\t\tsteps,\n\t\t\tevents: {\n\t\t\t\tonFinish: () => {\n\t\t\t\t\tif (this.#slides.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tsetStepPopupOptions(popup: Popup): void\n\t{\n\t\tconst { steps, hideTourOnMissClick = false } = this.#options;\n\n\t\tpopup.setAutoHide(hideTourOnMissClick);\n\n\t\tif (steps?.popup?.width)\n\t\t{\n\t\t\tpopup.setWidth(steps.popup.width);\n\t\t}\n\t}\n\n\tsave(): void\n\t{\n\t\tAjax.runAction('crm.settings.tour.updateOption', {\n\t\t\tjson: {\n\t\t\t\tcategory: this.#closeOptionCategory,\n\t\t\t\tname: this.#closeOptionName,\n\t\t\t\toptions: {\n\t\t\t\t\tisMultipleViewsAllowed: !this.#isViewHappened && this.#isMultipleViewsAllowed(),\n\t\t\t\t\tnumberOfViewsLimit: this.#options.numberOfViewsLimit ?? 1,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then(({ data }) => {\n\t\t\tthis.#options.isNumberOfViewsExceeded = data.isNumberOfViewsExceeded;\n\t\t\tthis.#isViewHappened = true;\n\t\t}).catch((errors) => {\n\t\t\tconsole.error('Could not save tour settings', errors);\n\t\t});\n\t}\n\n\tstatic tourInstances = [];\n\tstatic whatsNewInstances = [];\n}\n\nnamespaceCrmWhatsNew.ActionViewMode = ActionViewMode;\n"],"names":["namespaceCrmWhatsNew","Reflection","namespace","ActionViewMode","slides","steps","options","closeOptionCategory","closeOptionName","slideClassName","Type","isString","onClickClose","onClickCloseHandler","bind","whatNewPromise","tourPromise","isNumberOfViewsExceeded","console","warn","length","lastPosition","getLastPosition","currentPosition","getPositionBySlide","getCurrentSlide","destroy","selectNextSlide","Guide","onEvents","events","onFinish","save","popup","hideTourOnMissClick","setAutoHide","width","setWidth","Ajax","runAction","json","category","name","isMultipleViewsAllowed","numberOfViewsLimit","then","data","errors","error","slideConfigs","Runtime","loadExtension","map","slideConfig","className","title","html","slide","Tag","render","innerImage","innerTitle","innerDescription","buttons","buttonsContainer","Dom","append","forEach","button","getContainer","Dispatcher","BannerDispatcher","buttonConfig","config","text","onclick","helpDeskCode","Button","stepsConfig","stepConfig","step","id","position","article","infoHelperCode","useDynamicTarget","eventName","EventEmitter","subscribeOnce","target","event","exports","stepId","find","guide","createGuideInstance","setStepPopupOptions","getPopup","dispatcher","toQueue","onDone","subscribe","showNextStep","code","top","BX","Helper","show","preventDefault","PopupManager","isAnyPopupShown","WhatsNew","popupOptions","height","onDestroy","whatsNewInstances","push","isAddToQueue","clone","filter","Boolean","tourInstances","some","existedGuide","isShown","showOverlayFromFirstStep","start"],"mappings":"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"}