{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { clone, Dom, Reflection, Runtime, Tag, Type } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { EventEmitter } from \"main.core.events\";\n\nconst namespaceCrmWhatsNew = Reflection.namespace('BX.Crm.WhatsNew');\n\ntype SlideConfig = {\n\ttitle: string,\n\tinnerImage: string,\n\tinnerTitle: string,\n\tinnerDescription: string,\n\tbuttons: Array<ButtonConfig>,\n};\n\ntype ButtonConfig = {\n\ttext: string,\n\tclassName: string,\n\tonClickClose: ?boolean,\n\thelpDeskCode: ?string,\n}\n\ntype Slide = {\n\ttitle: string,\n\tclassName: ?string,\n\thtml: string,\n}\n\ntype StepPosition = 'left' | 'right'; //it's bottom by default\n\ntype StepConfig = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n\tuseDynamicTarget: ?boolean,\n\teventName: ?string,\n\tarticle: ?number\n}\n\ntype Step = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tposition: ?StepPosition,\n\ttarget: ?string,\n}\n\ntype Option = {\n\tshowOverlayFromFirstStep?: boolean,\n\thideTourOnMissClick?: boolean,\n\t...\n}\n\nclass ActionViewMode\n{\n\tslides: Array<Slide>;\n\tsteps: Array<Step>;\n\tcloseOptionName: string;\n\tcloseOptionCategory: string;\n\toptions: Option;\n\tpopup;\n\n\tconstructor({ slides, steps, options, closeOptionCategory, closeOptionName })\n\t{\n\t\tthis.popup = null;\n\t\tthis.slides = [];\n\t\tthis.steps = [];\n\t\tthis.options = options;\n\t\tthis.slideClassName = 'crm-whats-new-slides-wrapper';\n\t\tthis.closeOptionCategory = Type.isString(closeOptionCategory) ? closeOptionCategory : '';\n\t\tthis.closeOptionName = Type.isString(closeOptionName) ? closeOptionName : '';\n\t\tthis.onClickClose = this.onClickCloseHandler.bind(this);\n\n\t\tthis.whatNewPromise = null;\n\t\tthis.tourPromise = null;\n\n\t\tthis.prepareSlides(slides);\n\t\tthis.prepareSteps(steps);\n\t}\n\n\tprepareSlides(slideConfigs: Array<SlideConfig>): void\n\t{\n\t\tif (slideConfigs.length)\n\t\t{\n\t\t\tthis.whatNewPromise = Runtime.loadExtension('ui.dialogs.whats-new');\n\t\t}\n\n\t\tthis.slides = slideConfigs.map((slideConfig: SlideConfig) => {\n\t\t\treturn {\n\t\t\t\tclassName: this.slideClassName,\n\t\t\t\ttitle: slideConfig.title,\n\t\t\t\thtml: this.getPreparedSlideHtml(slideConfig),\n\t\t\t};\n\t\t}, this);\n\t}\n\n\tgetPreparedSlideHtml(slideConfig: SlideConfig): HTMLElement\n\t{\n\t\tconst slide = Tag.render`\n\t\t\t<div class=\"crm-whats-new-slide\">\n\t\t\t\t<img src=\"${slideConfig.innerImage}\" alt=\"\">\n\t\t\t\t<div class=\"crm-whats-new-slide-inner-title\"> ${slideConfig.innerTitle} </div>\n\t\t\t\t<p>${slideConfig.innerDescription}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst buttons = this.getPrepareSlideButtons(slideConfig);\n\t\tif (buttons.length)\n\t\t{\n\t\t\tconst buttonsContainer =  Tag.render`<div class=\"crm-whats-new-slide-buttons\"></div>`;\n\t\t\tDom.append(buttonsContainer, slide);\n\n\t\t\tbuttons.forEach(button => {\n\t\t\t\tDom.append(button.getContainer(), buttonsContainer);\n\t\t\t});\n\t\t}\n\n\t\treturn slide;\n\t}\n\n\tgetPrepareSlideButtons(slideConfig: SlideConfig): Button[]\n\t{\n\t\tlet buttons = [];\n\t\tif (slideConfig.buttons)\n\t\t{\n\t\t\tconst className = 'ui-btn ui-btn-primary ui-btn-hover ui-btn-round ';\n\n\t\t\tbuttons = slideConfig.buttons.map((buttonConfig) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tclassName: className + (buttonConfig.className ?? ''),\n\t\t\t\t\ttext: buttonConfig.text,\n\t\t\t\t};\n\n\t\t\t\tif (buttonConfig.onClickClose)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.onClickClose();\n\t\t\t\t}\n\t\t\t\telse if (buttonConfig.helpDeskCode)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.showHelpDesk(buttonConfig.helpDeskCode);\n\t\t\t\t}\n\n\t\t\t\treturn new Button(config);\n\t\t\t}, this);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\tprepareSteps(stepsConfig)\n\t{\n\t\tif (stepsConfig.length)\n\t\t{\n\t\t\tthis.tourPromise = Runtime.loadExtension('ui.tour');\n\t\t}\n\n\t\tthis.steps = stepsConfig.map((stepConfig: StepConfig) => {\n\t\t\tconst step = {\n\t\t\t\tid: stepConfig.id,\n\t\t\t\ttitle: stepConfig.title,\n\t\t\t\ttext: stepConfig.text,\n\t\t\t\tposition: stepConfig.position,\n\t\t\t\tarticle: stepConfig.article,\n\t\t\t};\n\n\t\t\tif (stepConfig.useDynamicTarget)\n\t\t\t{\n\t\t\t\tconst eventName = (stepConfig.eventName ?? this.getDefaultStepEventName(step.id));\n\t\t\t\tEventEmitter.subscribeOnce(eventName, this.showStepByEvent.bind(this));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstep.target = stepConfig.target;\n\t\t\t}\n\n\t\t\treturn step;\n\n\t\t}, this);\n\t}\n\n\tshowStepByEvent(event): void\n\t{\n\t\tthis.tourPromise.then((exports) => {\n\t\t\tconst { stepId, target, delay }  = event.data;\n\t\t\tconst step = this.steps.find(step => step.id === stepId);\n\t\t\tif (!step)\n\t\t\t{\n\t\t\t\tconsole.error('step not found');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tstep.target = target;\n\t\t\t\tconst { Guide } = exports;\n\t\t\t\tconst guide = this.createGuideInstance(Guide, [step], true);\n\n\t\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\t\t\t\tguide.showNextStep();\n\t\t\t\tthis.save();\n\n\t\t\t}, delay || 0);\n\t\t});\n\t}\n\n\tgetDefaultStepEventName(stepId: string): string\n\t{\n\t\treturn `Crm.WhatsNew::onTargetSetted::${stepId}`;\n\t}\n\n\tonClickCloseHandler(): void\n\t{\n\t\tconst lastPosition = this.popup.getLastPosition();\n\t\tconst currentPosition = this.popup.getPositionBySlide(this.popup.getCurrentSlide());\n\t\tif (currentPosition >= lastPosition)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.popup.selectNextSlide();\n\t\t}\n\t}\n\n\tshowHelpDesk(code: string): void\n\t{\n\t\tif(top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${code}`);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.slides.length)\n\t\t{\n\t\t\tthis.executeWhatsNew();\n\t\t}\n\t\telse if (this.steps.length)\n\t\t{\n\t\t\tthis.executeGuide();\n\t\t}\n\t}\n\n\texecuteWhatsNew(): void\n\t{\n\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.whatNewPromise.then(exports => {\n\t\t\tconst { WhatsNew } = exports;\n\t\t\tthis.popup = new WhatsNew({\n\t\t\t\tslides: this.slides,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\theight: 440,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tthis.executeGuide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.popup.show();\n\n\t\t\tActionViewMode.whatsNewInstances.push(this.popup);\n\t\t}, this);\n\t}\n\n\texecuteGuide(): void\n\t{\n\t\tlet steps = clone(this.steps);\n\t\tsteps = steps.filter(step => Boolean(step.target));\n\t\tif (!steps.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tourPromise.then((exports) => {\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, steps, (this.steps.length <= 1));\n\n\t\t\tif (ActionViewMode.tourInstances.find((existedGuide) => existedGuide.getPopup()?.isShown()))\n\t\t\t{\n\t\t\t\treturn; // do not allow many guides at the same time\n\t\t\t}\n\t\t\tActionViewMode.tourInstances.push(guide);\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tif (guide.steps.length > 1 || this.options.showOverlayFromFirstStep)\n\t\t\t{\n\t\t\t\tguide.start();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tguide.showNextStep();\n\t\t\t}\n\t\t\tthis.save();\n\t\t});\n\t}\n\n\tcreateGuideInstance(guide, steps: Array<Step>, onEvents: boolean)\n\t{\n\t\treturn new guide({\n\t\t\tonEvents,\n\t\t\tsteps: steps,\n\t\t\tevents: {\n\t\t\t\tonFinish: () => {\n\t\t\t\t\tif (!this.slides.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tsetStepPopupOptions(popup: Popup)\n\t{\n\t\tconst { steps, hideTourOnMissClick = false } = this.options;\n\n\t\tpopup.setAutoHide(hideTourOnMissClick);\n\t\tif (steps && steps.popup)\n\t\t{\n\t\t\tif (steps.popup.width)\n\t\t\t{\n\t\t\t\tpopup.setWidth(steps.popup.width)\n\t\t\t}\n\t\t}\n\t}\n\n\tsave(): void\n\t{\n\t\tBX.userOptions.save(this.closeOptionCategory, this.closeOptionName, 'closed', 'Y');\n\t}\n\n\tstatic tourInstances = [];\n\tstatic whatsNewInstances = [];\n}\n\nnamespaceCrmWhatsNew.ActionViewMode = ActionViewMode;\n"],"names":["namespaceCrmWhatsNew","Reflection","namespace","ActionViewMode","slides","steps","options","closeOptionCategory","closeOptionName","popup","slideClassName","Type","isString","onClickClose","onClickCloseHandler","bind","whatNewPromise","tourPromise","prepareSlides","prepareSteps","slideConfigs","length","Runtime","loadExtension","map","slideConfig","className","title","html","getPreparedSlideHtml","slide","Tag","render","innerImage","innerTitle","innerDescription","buttons","getPrepareSlideButtons","buttonsContainer","Dom","append","forEach","button","getContainer","buttonConfig","config","text","onclick","helpDeskCode","showHelpDesk","Button","stepsConfig","stepConfig","step","id","position","article","useDynamicTarget","eventName","getDefaultStepEventName","EventEmitter","subscribeOnce","showStepByEvent","target","event","then","exports","data","stepId","delay","find","console","error","setTimeout","Guide","guide","createGuideInstance","setStepPopupOptions","getPopup","showNextStep","save","lastPosition","getLastPosition","currentPosition","getPositionBySlide","getCurrentSlide","destroy","selectNextSlide","code","top","BX","Helper","show","preventDefault","executeWhatsNew","executeGuide","PopupManager","isAnyPopupShown","WhatsNew","popupOptions","height","events","onDestroy","whatsNewInstances","push","clone","filter","Boolean","tourInstances","existedGuide","isShown","showOverlayFromFirstStep","start","onEvents","onFinish","hideTourOnMissClick","setAutoHide","width","setWidth","userOptions"],"mappings":"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"}