{"version":3,"file":"script.js","sources":["src/actionmanager.js","src/usercounter.js","src/pull/socialnetwork.js","src/pull/mainusercounter.js","src/pull/tasks.js","src/pull/tasksusercounter.js","src/pull.js","src/manager.js"],"sourcesContent":["import {ajax, Type, Loc, Tag} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {PopupManager} from 'main.popup';\nimport {SendButton, CancelButton} from 'ui.buttons';\nimport {Common} from 'socialnetwork.common';\n\nimport Manager from './manager'\n\nexport class ActionManager\n{\n\tconstructor(\n\t\tparams: {\n\t\t\tparent: Manager,\n\t\t}\n\t)\n\t{\n\t\tthis.parent = params.parent;\n\t\tthis.componentName = (Type.isStringFilled(this.parent.componentName) ? this.parent.componentName : '');\n\t\tthis.signedParameters = (Type.isStringFilled(this.parent.signedParameters) ? this.parent.signedParameters : '');\n\t\tthis.gridId = (Type.isStringFilled(this.parent.gridId) ? this.parent.gridId : '');\n\t\tthis.useSlider = (Type.isBoolean(this.parent.useSlider) ? this.parent.useSlider : false);\n\t}\n\n\tact(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t\tvalue: ?boolean,\n\t\t},\n\t\tevent: ?KeyboardEvent\n\t)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tif (['addToFavorites', 'removeFromFavorites'].includes(params.action))\n\t\t\t{\n\n\t\t\t\treturn this.setFavorites({\n\t\t\t\t\tgroupId: params.groupId,\n\t\t\t\t\tvalue: (params.action === 'addToFavorites'),\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tthis.processActionSuccess(params);\n\t\t\t\t}, (response) => {\n\t\t\t\t\tthis.processActionFailure(params, response.message);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn ajax.runComponentAction(this.componentName, 'act', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: params.action,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tgroupId: params.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionSuccess(params);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionFailure(params);\n\t\t\t\t\t}\n\t\t\t\t\tresolve(response);\n\t\t\t\t}, (response) => {\n\n\t\t\t\t\tif (response.errors)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionFailure(params, response.errors[0].message);\n\t\t\t\t\t}\n\t\t\t\t\treject(response);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessActionSuccess(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t}\n\t)\n\t{\n\t\tlet eventCode = null;\n\t\tlet message = '';\n\n\t\tswitch (params.action)\n\t\t{\n\t\t\tcase 'addToFavorites':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_ADD_TO_FAVORITES');\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromFavorites':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_REMOVE_FROM_FAVORITES');\n\t\t\t\tbreak;\n\t\t\tcase 'addToArchive':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_ADD_TO_ARCHIVE');\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromArchive':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_REMOVE_FROM_ARCHIVE');\n\t\t\t\tbreak;\n\t\t\tcase 'join':\n\t\t\t\teventCode = 'afterJoinRequestSend';\n\t\t\t\tbreak;\n\t\t\tcase 'setOwner':\n\t\t\t\teventCode = 'afterOwnerSet';\n\t\t\t\tbreak;\n\t\t\tcase 'setScrumMaster':\n\t\t\t\teventCode = 'afterSetScrumMaster';\n\t\t\t\tbreak;\n\t\t\tcase 'deleteOutgoingRequest':\n\t\t\t\teventCode = 'afterRequestOutDelete';\n\t\t\t\tbreak;\n\t\t\tcase 'deleteIncomingRequest':\n\t\t\t\teventCode = 'afterRequestInDelete';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\n\t\tif (message !== '')\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: message,\n\t\t\t});\n\t\t}\n\n\t\tif (\n\t\t\teventCode\n\t\t\t&& top.BX.SidePanel\n\t\t\t&& window !== top.window\n\t\t)\n\t\t{\n\t\t\ttop.BX.SidePanel.Instance.postMessageAll(window, 'sonetGroupEvent', {\n\t\t\t\tcode: eventCode,\n\t\t\t});\n\t\t}\n\n\t\tif (!BX.PULL)\n\t\t{\n\t\t\tthis.parent.reload();\n\t\t}\n\t}\n\n\tprocessActionFailure(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t\tevent: PointerEvent,\n\t\t},\n\t\terrorMessage: ?string\n\t)\n\t{\n\t\tif (!Type.isStringFilled(errorMessage))\n\t\t{\n\t\t\terrorMessage = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_ACTION_FAILURE');\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: errorMessage,\n\t\t});\n\t}\n\n\tsetFavorites(\n\t\tparams: {\n\t\t\tgroupId: number,\n\t\t\tvalue: boolean,\n\t\t}\n\t)\n\t{\n\t\tconst newValue = params.value;\n\t\tconst oldValue = !params.value;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCommon.setFavoritesAjax({\n\t\t\t\tgroupId: params.groupId,\n\t\t\t\tfavoritesValue: oldValue,\n\t\t\t\tcallback: {\n\t\t\t\t\tsuccess: (data) => {\n\n\t\t\t\t\t\tconst eventData = {\n\t\t\t\t\t\t\tcode: 'afterSetFavorites',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tgroupId: data.ID,\n\t\t\t\t\t\t\t\tvalue: (data.RESULT === 'Y'),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\twindow.top.BX.SidePanel.Instance.postMessageAll(window, 'sonetGroupEvent', eventData);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isStringFilled(data.NAME)\n\t\t\t\t\t\t\t&& Type.isStringFilled(data.URL)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit('BX.Socialnetwork.WorkgroupFavorites:onSet', new BaseEvent({\n\t\t\t\t\t\t\t\tcompatData: [{\n\t\t\t\t\t\t\t\t\tid: this.groupId,\n\t\t\t\t\t\t\t\t\tname: data.NAME,\n\t\t\t\t\t\t\t\t\turl: data.URL,\n\t\t\t\t\t\t\t\t\textranet: (Type.isStringFilled(data.EXTRANET) ? data.EXTRANET : 'N'),\n\t\t\t\t\t\t\t\t}, newValue],\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tfailure: (response) => {\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tmessage: response.ERROR,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tgroupAction(action)\n\t{\n\t\tlet buttonTitle = '';\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'addToArchive':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_ADD')\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromArchive':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_RETURN')\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_DELETE')\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\taction = '';\n\t\t}\n\n\t\tif (action === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttons = [\n\t\t\tnew SendButton({\n\t\t\t\ttext: buttonTitle,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tPopupManager.getCurrentPopup().destroy();\n\n\t\t\t\t\t\tconst gridInstance = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t\t\t\tif (!gridInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst data = {\n\t\t\t\t\t\t\tID: gridInstance.getRows().getSelectedIds(),\n\t\t\t\t\t\t\tapply_filter: 'Y',\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tdata[gridInstance.getActionKey()] = action;\n\t\t\t\t\t\tdata[gridInstance.getForAllKey()] = 'N';\n\n\t\t\t\t\t\tgridInstance.reloadTable('POST', data);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew CancelButton({\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tPopupManager.getCurrentPopup().destroy();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t})\n\t\t];\n\n\t\tconst confirmPopup = PopupManager.create({\n\t\t\tid: 'bx-sgl-group-delete-confirm',\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: buttons,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: (popup) => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontent: Tag.render`<div>${Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_CONFIRM_TEXT')}</div>`,\n\t\t\tpadding: 20,\n\t\t});\n\n\t\tconfirmPopup.show();\n\t}\n}\n","import {Type} from 'main.core';\n\nexport class UserCounterManager\n{\n\tconstructor(options)\n\t{\n\t\tthis.gridController = options.gridController;\n\t\tthis.url = options.url;\n\t\tthis.columnId = options.columnId;\n\t\tthis.sliderOptions = options.sliderOptions;\n\t\tthis.useTasksCounters = options.useTasksCounters;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tprocessCounterItem(counterData, groupId)\n\t{\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tgroupId === 0\n\t\t\t&& Number(counterData.value) === 0\n\t\t)\n\t\t{\n\t\t\tthis.gridController.getInstance().getRows().getRows().forEach((targetRow) => {\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isUndefined(counterData.scrum)\n\t\t\t\t\t&& counterData.scrum !== targetRow.getNode().getAttribute('data-scrum')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setRowCounter(targetRow, counterData, groupId);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.gridController.getInstance().isRowExist(groupId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setRowCounter(this.gridController.getInstance().getRowById(groupId), counterData, groupId);\n\t}\n\n\n\tsetRowCounter(targetRow, counterData, groupId)\n\t{\n\t\tconst rowCounterData = {};\n\n\t\tconst url = this.url\n\t\t\t.replace('#id#', groupId)\n\t\t\t.replace('#ID#', groupId)\n\t\t\t.replace('#GROUP_ID#', groupId)\n\t\t\t.replace('#group_id#', groupId);\n\n\t\trowCounterData[this.columnId] = {\n\t\t\tvalue: 0,\n\t\t\ttype: 'right',\n\t\t\tevents: (\n\t\t\t\tgroupId > 0\n\t\t\t\t\t? {\n\t\t\t\t\t\tclick: BX.SidePanel.Instance.open.bind(BX.SidePanel.Instance, url, this.sliderOptions),\n\t\t\t\t\t}\n\t\t\t\t\t: {}\n\t\t\t),\n\t\t\tcolor: 'ui-counter-danger',\n\t\t\tclass: 'sonet-ui-grid-counter',\n\t\t};\n\n\t\tlet storedCounterData = {};\n\n\t\ttry\n\t\t{\n\t\t\teval(`storedCounterData = ${targetRow.getNode().getAttribute('data-counters')};`);\n\t\t}\n\t\tcatch(e)\n\t\t{\n\n\t\t}\n\n\t\tif (\n\t\t\tstoredCounterData === null\n\t\t\t|| (\n\t\t\t\tcounterData.type === 'tasks_expired'\n\t\t\t\t&& targetRow.getNode().getAttribute('data-scrum') === 'Y'\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sumValue = 0;\n\t\tObject.entries(storedCounterData).forEach(([ key]) =>\n\t\t{\n\t\t\tif (key === counterData.type)\n\t\t\t{\n\t\t\t\tstoredCounterData[key] = counterData.value.toString();\n\t\t\t}\n\n\t\t\tsumValue += Number(storedCounterData[key]);\n\t\t});\n\n\t\ttargetRow.getNode().setAttribute('data-counters', `(${JSON.stringify(storedCounterData)})`);\n\t\trowCounterData[this.columnId].value = Number(sumValue);\n\t\ttargetRow.setCounters(rowCounterData);\n\t}\n\n}\n","import {Type, Loc} from 'main.core';\n\nexport class PullControllerSocialnetwork\n{\n\tstatic get events()\n\t{\n\t\treturn {\n\t\t\tadd: 'add',\n\t\t\tupdate: 'update',\n\t\t\tdelete: 'delete',\n\t\t\tuserAdd: 'userAdd',\n\t\t\tuserUpdate: 'userUpdate',\n\t\t\tuserDelete: 'userDelete',\n\t\t\tfavoritesChanged: 'favoritesChanged',\n\t\t\tpinChanged: 'pinChanged',\n\t\t};\n\t}\n\n\tstatic getInstance()\n\t{\n\n\t}\n\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'socialnetwork';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_ADD') ]: this.onWorkgroupAdd.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_UPDATE') ]: this.onWorkgroupUpdate.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_DELETE') ]: this.onWorkgroupDelete.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_ADD') ]: this.onWorkgroupUserAdd.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_UPDATE') ]: this.onWorkgroupUserUpdate.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_DELETE') ]: this.onWorkgroupUserDelete.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_FAVORITES_CHANGED') ]: this.onWorkgroupFavoritesChanged.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_PIN_CHANGED') ]: this.onWorkgroupPinChanged.bind(this),\n\t\t};\n\t}\n\n\tonWorkgroupAdd(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.add,\n\t\t\tmoveParams: {\n\t\t\t\trowBefore: this.gridPinController.getLastPinnedRowId(),\n\t\t\t\trowAfter: this.gridController.getInstance().getFirstRowId(),\n\t\t\t},\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUpdate(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.update,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupDelete(data)\n\t{\n\t\tthis.pullController.removeRow(data.params.GROUP_ID);\n\t}\n\n\tonWorkgroupUserAdd(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userAdd,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUserUpdate(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userUpdate,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUserDelete(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userDelete,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupFavoritesChanged(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.favoritesChanged,\n\t\t};\n\n\t\tthis.pullController.moveToDirectPlace(data.GROUP_ID, null, params);\n\t}\n\n\tonWorkgroupPinChanged(data)\n\t{\n\t\tif (\n\t\t\t!Type.isStringFilled(data.ACTION)\n\t\t\t|| !['pin', 'unpin'].includes(data.ACTION)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.pinChanged,\n\t\t};\n\n\t\tthis.pullController.moveToDirectPlace(data.GROUP_ID, null, params);\n\t}\n}","import {Loc, Type} from 'main.core';\n\nexport class PullControllerMainUserCounter\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.userCounterManager = options.userCounterManager;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'main';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_MAIN_USER_COUNTER') ]: this.onUserCounter.bind(this),\n\t\t};\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst siteId = Loc.getMessage('SITE_ID');\n\t\tconst eventCounterData = (Type.isPlainObject(data[siteId]) ? data[siteId] : {});\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tObject.entries(eventCounterData).forEach(([ key, value]) => {\n\t\t\tconst matches = key.match(/^\\*\\*SG(\\d+)/i);\n\t\t\tif (matches)\n\t\t\t{\n\t\t\t\tconst groupId = Number(matches[1]);\n\t\t\t\tvalue = Number(value)\n\n\t\t\t\tif (\n\t\t\t\t\tgroupId === 0\n\t\t\t\t\t&& value !== 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst counterData = {\n\t\t\t\t\ttype: 'livefeed',\n\t\t\t\t\tvalue: value,\n\t\t\t\t};\n\n\t\t\t\tthis.queueCounterData.set(groupId, counterData);\n\t\t\t}\n\t\t});\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.queueCounterData.forEach((counterData, groupId) => {\n\t\t\t// todo oh this.userCounterManager.processCounterItem(counterData, groupId);\n\t\t});\n\n\t\tthis.queueCounterData.clear();\n\t\tthis.timer = null;\n\t}\n\n}\n","import {Loc} from 'main.core';\n\nexport class PullControllerTasks\n{\n\n\tstatic get events()\n\t{\n\t\treturn {\n\t\t\tpinChanged: 'pinChanged',\n\t\t};\n\t}\n\n\tstatic get counterEvents()\n\t{\n\t\treturn [\n\t\t\t'onAfterTaskAdd',\n\t\t\t'onAfterTaskDelete',\n\t\t\t'onAfterTaskRestore',\n\t\t\t'onAfterTaskView',\n\t\t\t'onAfterTaskMute',\n\t\t\t'onAfterCommentAdd',\n\t\t\t'onAfterCommentDelete',\n\t\t\t'onProjectPermUpdate',\n\t\t];\n\t}\n\n\tstatic get movingProjectEvents()\n\t{\n\t\treturn [\n\t\t\t'onAfterTaskAdd',\n\t\t\t'onAfterCommentAdd',\n\t\t];\n\t}\n\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.timer = null;\n\t\tthis.counterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_COUNTER') ]: this.onTasksProjectCounter.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_SCRUM_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_COMMENT_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t};\n\t}\n\n\tonTasksProjectCounter(data)\n\t{\n\t\tconst groupId = data.GROUP_ID;\n\t\tconst event = data.EVENT;\n\n\t\tif (!PullControllerTasks.counterEvents.includes(event))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tif (PullControllerTasks.movingProjectEvents.includes(event) || !this.counterData.has(groupId))\n\t\t{\n\t\t\tthis.counterData.set(groupId, event);\n\t\t}\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.counterData.forEach((event, groupId) => {\n\n\t\t\tconst params = {\n\t\t\t\tevent,\n\t\t\t\thighlightParams: {\n\t\t\t\t\tskip: true,\n\t\t\t\t},\n\t\t\t\tupdateItemCondition: (event) => {\n\t\t\t\t\treturn PullControllerTasks.movingProjectEvents.includes(event);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (PullControllerTasks.movingProjectEvents.includes(event))\n\t\t\t{\n\t\t\t\tparams.moveParams = {\n\t\t\t\t\trowBefore: (\n\t\t\t\t\t\tthis.gridPinController.getIsPinned(groupId)\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: this.gridPinController.getLastPinnedRowId()\n\t\t\t\t\t),\n\t\t\t\t\trowAfter: this.gridController.getInstance().getFirstRowId(),\n\t\t\t\t};\n\t\t\t\tparams.highlightParams = {\n\t\t\t\t\tskip: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.pullController.checkExistence(groupId).then(\n\t\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, groupId, params),\n\t\t\t\tresponse => console.error(response)\n\t\t\t);\n\t\t});\n\t\tthis.counterData.clear();\n\t\tthis.timer = null;\n\t}\n\n\tonTasksProjectCommentsReadAll(data)\n\t{\n\t\tconst groupId = data.GROUP_ID;\n\n\t\tif (groupId)\n\t\t{\n\t\t\tif (this.gridController.getInstance().isRowExist(groupId))\n\t\t\t{\n\t\t\t\tthis.updateCounter([groupId]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCounter(this.gridController.getInstance().getItems());\n\t\t}\n\t}\n\n\tupdateCounter(rowIds)\n\t{\n\t\tthis.pullController.checkExistence(rowIds).then(\n\t\t\tresponse => {\n\t\t\t\tconst projects = response.data;\n\t\t\t\tif (projects)\n\t\t\t\t{\n\t\t\t\t\tObject.keys(projects).forEach((projectId) => {\n\t\t\t\t\t\tif (this.gridController.getInstance().isRowExist(projectId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.gridController.getInstance()\n\t\t\t\t\t\t\t\t.getRowById(projectId)\n\t\t\t\t\t\t\t\t.setCounters(projects[projectId].counters)\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n}","import {Loc, Type} from 'main.core';\n\nexport class PullControllerTasksUserCounter\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.userCounterManager = options.userCounterManager;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_USER_COUNTER') ]: this.onUserCounter.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_READ_ALL') ]: this.onProjectReadAllComments.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_SCRUM_READ_ALL') ]: this.onScrumReadAllComments.bind(this),\n\t\t};\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tObject.entries(data).forEach(([ key, value]) => {\n\t\t\tif (\n\t\t\t\tkey == Number(key)\n\t\t\t\t&& Number(key) > 0\n\t\t\t\t&& Type.isPlainObject(value.view_all)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!Type.isUndefined(value.view_all.new_comments))\n\t\t\t\t{\n\t\t\t\t\tthis.queueCounterData.set(`${key}_new_comments`, {\n\t\t\t\t\t\tgroupId: key,\n\t\t\t\t\t\ttype: 'tasks_new_comments',\n\t\t\t\t\t\tvalue: Number(value.view_all.new_comments),\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isUndefined(value.view_all.expired))\n\t\t\t\t{\n\t\t\t\t\tthis.queueCounterData.set(`${key}_expired`, {\n\t\t\t\t\t\tgroupId: key,\n\t\t\t\t\t\ttype: 'tasks_expired',\n\t\t\t\t\t\tvalue: Number(value.view_all.expired),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonProjectReadAllComments(data)\n\t{\n\t\tif (\n\t\t\tNumber(data.GROUP_ID) !== 0\n\t\t\t&& Number(data.USER_ID) !== Number(Loc.getMessage('USER_ID'))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tthis.queueCounterData.set(`0_new_comments`, {\n\t\t\tgroupId: 0,\n\t\t\ttype: 'tasks_new_comments',\n\t\t\tvalue: 0,\n\t\t\tscrum: 'N',\n\t\t});\n\t}\n\n\tonScrumReadAllComments(data)\n\t{\n\t\tif (\n\t\t\tNumber(data.GROUP_ID) !== 0\n\t\t\t&& Number(data.USER_ID) !== Number(Loc.getMessage('USER_ID'))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tthis.queueCounterData.set(`0_new_comments`, {\n\t\t\tgroupId: 0,\n\t\t\ttype: 'tasks_new_comments',\n\t\t\tvalue: 0,\n\t\t\tscrum: 'Y',\n\t\t});\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.queueCounterData.forEach((counterData) => {\n\t\t\t// todo oh this.userCounterManager.processCounterItem(counterData, Number(counterData.groupId));\n\t\t});\n\n\t\tthis.queueCounterData.clear();\n\t\tthis.timer = null;\n\t}\n\n}","import {ajax, Type} from 'main.core';\nimport {PULL as Pull} from 'pull.client';\n\nimport {UserCounterManager} from './usercounter';\nimport {PullControllerSocialnetwork} from './pull/socialnetwork';\nimport {PullControllerMainUserCounter} from './pull/mainusercounter';\nimport {PullControllerTasks} from './pull/tasks';\nimport {PullControllerTasksUserCounter} from './pull/tasksusercounter';\n\nexport class PullManager\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.urls = options.urls;\n\t\tthis.useTasksCounters = options.useTasksCounters;\n\t\tthis.livefeedCounterColumnId = options.livefeedCounterColumnId;\n\t\tthis.livefeedCounterSliderOptions = options.livefeedCounterSliderOptions;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.userCounterManagerInstance = new UserCounterManager({\n\t\t\tgridController: this.gridController,\n\t\t\turl: this.urls.groupLivefeedUrl,\n\t\t\tcolumnId: this.livefeedCounterColumnId,\n\t\t\tsliderOptions: this.livefeedCounterSliderOptions,\n\t\t\tuseTasksCounters: this.useTasksCounters,\n\t\t});\n\n\t\tthis.pullControllerSocialnetwork = new PullControllerSocialnetwork({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tgridController: this.gridController,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t\tpullController: this,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerSocialnetwork);\n\n\t\tthis.pullControllerMainUserCounter = new PullControllerMainUserCounter({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerMainUserCounter);\n\n\t\tthis.pullControllerTasksUserCounter = new PullControllerTasksUserCounter({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tgridController: this.gridController,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerTasksUserCounter);\n\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\tthis.pullControllerTasks = new PullControllerTasks({\n\t\t\t\tcomponentName: this.componentName,\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tgridController: this.gridController,\n\t\t\t\tpullController: this,\n\t\t\t});\n\n\t\t\tPull.subscribe(this.pullControllerTasks);\n\t\t}\n\t}\n\n\tcheckExistence(groupId)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(this.componentName, 'checkExistence', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tgroupIdList: Type.isArray(groupId) ? groupId : [ groupId ],\n\t\t\t\t},\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t}).then(\n\t\t\t\tresponse => resolve(response),\n\t\t\t\tresponse => reject(response)\n\t\t\t);\n\t\t});\n\t}\n\n\tonCheckExistenceSuccess(response, groupId, params)\n\t{\n\t\tif (Type.isUndefined(response.data[groupId]))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (response.data[groupId] === false)\n\t\t{\n\t\t\tthis.grid.removeRow(groupId);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.moveToDirectPlace(groupId, response.data[groupId], params);\n\t}\n\n\tisActivityRealtimeMode()\n\t{\n\t\tconst sort = this.gridController.getInstance().getSort();\n\n\t\treturn (\n\t\t\tsort.DATE_UPDATE\n\t\t\t&& sort.DATE_UPDATE === 'desc'\n\t\t);\n\t}\n\n\tupdateItem(rowId, rowData, params)\n\t{\n\t\tif (!this.gridController.getInstance().hasItem(rowId))\n\t\t{\n\t\t\tthis.gridController.getInstance().addItem(rowId);\n\t\t\tthis.addRow(rowId, rowData, params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateRow(rowId, rowData, params);\n\t\t}\n\t}\n\n\taddRow(rowId, rowData, params)\n\t{\n\t\tif (\n\t\t\tthis.gridController.getInstance().isRowExist(rowId)\n\t\t\t|| Type.isUndefined(rowData)\n\t\t\t|| Type.isNull(rowData)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().addRow(rowId, rowData, params);\n\t}\n\n\tupdateRow(rowId, rowData, params)\n\t{\n\t\tif (\n\t\t\t!this.gridController.getInstance().isRowExist(rowId)\n\t\t\t|| Type.isUndefined(rowData)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().updateRow(rowId, rowData, params);\n\t}\n\n\tremoveRow(rowId)\n\t{\n\t\tif (!this.gridController.getInstance().isRowExist(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().removeRow(rowId);\n\t}\n\n\tmoveToDirectPlace(groupId, data, params)\n\t{\n\t\tparams = params || {};\n\n\t\tajax.runComponentAction(this.componentName, 'findWorkgroupPlace', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tcurrentPage: this.gridController.getInstance().getCurrentPage(),\n\t\t\t},\n\t\t\tsignedParameters: this.signedParameters,\n\t\t}).then((response) => {\n\t\t\tif (response.data === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {workgroupBefore, workgroupAfter} = response.data;\n\n\t\t\tif (workgroupBefore === false && workgroupAfter === false)\n\t\t\t{\n\t\t\t\tthis.removeRow(groupId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t(workgroupBefore && this.gridController.getInstance().isRowExist(workgroupBefore))\n\t\t\t\t\t|| (workgroupAfter && this.gridController.getInstance().isRowExist(workgroupAfter))\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tparams.moveParams = {\n\t\t\t\t\t\trowBefore: workgroupBefore,\n\t\t\t\t\t\trowAfter: workgroupAfter,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tparams.moveParams = {\n\t\t\t\t\t\tskip: true,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.updateItem(groupId, data, params);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {\n\tController as GridController,\n\tActionController as GridActionController,\n\tTagController as GridTagController,\n\tFilter as GridFilter,\n} from 'socialnetwork.ui.grid';\n\nimport {Tour as TasksTour} from 'tasks.tour';\n\nimport {ActionManager} from './actionmanager';\nimport {PullManager} from './pull';\n\nexport default class Manager\n{\n\tstatic repo = new Map();\n\n\tstatic getById(id)\n\t{\n\t\treturn Manager.repo.get(id);\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.componentName = params.componentName;\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.useSlider = params.useSlider;\n\t\tthis.gridId = params.gridId;\n\t\tthis.filterId = (Type.isStringFilled(params.filterId) ? params.filterId : null);\n\t\tthis.sort = params.sort;\n\t\tthis.items = params.items;\n\t\tthis.pageSize = (Type.isNumber(params.pageSize) ? parseInt(params.pageSize) : 10);\n\t\tthis.gridStub = (!Type.isUndefined(params.gridStub) ? params.gridStub : null);\n\t\tthis.defaultFilterPresetId = (\n\t\t\tType.isStringFilled(params.defaultFilterPresetId)\n\t\t\t&& ![ 'requests_in', 'requests_out' ].includes(params.defaultFilterPresetId)\n\t\t\t\t? params.defaultFilterPresetId\n\t\t\t\t: 'tmp_filter'\n\t\t);\n\t\tthis.defaultCounter = (Type.isStringFilled(params.defaultCounter) ? params.defaultCounter : '');\n\t\tthis.gridContainer = (Type.isStringFilled(params.gridContainerId) ? document.getElementById(params.gridContainerId) : null);\n\t\tthis.urls = params.urls;\n\t\tthis.useTasksCounters = (Type.isBoolean(params.useTasksCounters) ? params.useTasksCounters : false);\n\n\t\tthis.livefeedCounterColumnId = (Type.isStringFilled(params.livefeedCounterColumnId) ? params.livefeedCounterColumnId : 'NAME');\n\t\tthis.livefeedCounterSliderOptions = (Type.isPlainObject(params.livefeedCounterSliderOptions) ? params.livefeedCounterSliderOptions : {});\n\n\t\tthis.init(params);\n\t}\n\n\tinit(params)\n\t{\n\t\tthis.initEvents();\n\n\t\tthis.actionManagerInstance = new ActionManager({\n\t\t\tparent: this,\n\t\t});\n\n\t\tthis.gridController = new GridController({\n\t\t\tid: this.id,\n\t\t\tsort: this.sort,\n\t\t\titems: this.items,\n\t\t\tpageSize: this.pageSize,\n\t\t\tgridStub: this.gridStub,\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tManager.repo.set(this.id, this);\n\n\t\tGridActionController.setOptions({\n\t\t\tgridInstance: this.gridController.getGrid(),\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tconst filter = new GridFilter({\n\t\t\tfilterId: this.filterId,\n\t\t\tdefaultFilterPresetId: this.defaultFilterPresetId,\n\t\t\tgridId: this.id,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\tthis.tasksTour = new TasksTour({\n\t\t\t\ttours: params.tours,\n\t\t\t});\n\t\t\tthis.tasksTour.subscribe('FirstProject:afterProjectCreated', this.onAfterGroupCreated.bind(this));\n\t\t\tthis.tasksTour.subscribe('FirstScrum:afterScrumCreated', this.onAfterGroupCreated.bind(this));\n\t\t}\n\n\t\tthis.initPull();\n\n\t\tif (filter)\n\t\t{\n\t\t\tGridTagController.setOptions({\n\t\t\t\tfilter,\n\t\t\t});\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tthis.pullManager = new PullManager({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\turls: this.urls,\n\t\t\tlivefeedCounterColumnId: this.livefeedCounterColumnId,\n\t\t\tlivefeedCounterSliderOptions: this.livefeedCounterSliderOptions,\n\t\t\tgridController: this.gridController,\n\t\t\tuseTasksCounters: this.useTasksCounters,\n\t\t});\n\t}\n\n\tsetActionsPanel(actionPanel)\n\t{\n\t\tGridActionController.setActionsPanel(actionPanel)\n\t}\n\n\tinitEvents()\n\t{\n\t\tif (this.gridContainer)\n\t\t{\n\t\t\tthis.gridContainer.addEventListener('click', this.processClickEvent.bind(this));\n\t\t}\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event: BaseEvent) => {\n\n\t\t\tconst [ sliderEvent ] = event.getCompatData();\n\n\t\t\tif (\n\t\t\t\t!BX.PULL\n\t\t\t\t&& sliderEvent.getEventId() === 'sonetGroupEvent'\n\t\t\t\t&& !Type.isUndefined(sliderEvent.data)\n\t\t\t\t&& Type.isStringFilled(sliderEvent.data.code)\n\t\t\t\t&& [\n\t\t\t\t\t'afterCreate',\n\t\t\t\t\t'afterEdit',\n\t\t\t\t\t'afterInvite',\n\t\t\t\t\t'afterJoinRequestSend',\n\t\t\t\t\t'afterLeave',\n\t\t\t\t\t'afterDelete',\n\t\t\t\t].includes(sliderEvent.data.code)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('Tasks.Toolbar:onItem', (event: BaseEvent) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.counter && data.counter.filter)\n\t\t\t{\n\t\t\t\tconst filter = data.counter.filter.getFilter();\n\n\t\t\t\tthis.toggleByField({\n\t\t\t\t\t[data.counter.filterField]: data.counter.filterValue,\n\t\t\t\t}, filter);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('Socialnetwork.Toolbar:onItem', (event: BaseEvent) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.counter && data.counter.filter)\n\t\t\t{\n\t\t\t\tconst filter = data.counter.filter.getFilter();\n\n\t\t\t\tthis.toggleByField({\n\t\t\t\t\t[data.counter.filterField]: data.counter.filterValue,\n\t\t\t\t}, filter);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggleByField(filterData, filter)\n\t{\n\t\tif (!filter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst name = Object.keys(filterData)[0];\n\t\tconst value = filterData[name];\n\t\tconst fields = filter.getFilterFieldsValues();\n\n\t\tif (!this.isFilteredByFieldValue(name, value, fields))\n\t\t{\n\t\t\tfilter.getApi().extendFilter({[name]: value});\n\t\t\treturn;\n\t\t}\n\n\t\tfilter.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tfilter.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tfilter.getSearch().apply();\n\t}\n\n\tisFilteredByField(field, fields)\n\t{\n\t\tif (!Object.keys(fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(fields[field]))\n\t\t{\n\t\t\treturn fields[field].length > 0;\n\t\t}\n\n\t\treturn fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value, fields)\n\t{\n\t\treturn this.isFilteredByField(field, fields) && fields[field] === value;\n\t}\n\n\treload()\n\t{\n\t\tconst gridInstance = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\tif (!gridInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tgridInstance.reloadTable('POST', {\n\t\t\tapply_filter: 'Y',\n\t\t}, () => {\n\t\t\tthis.gridController.getInstance().getPinController().colorPinnedRows();\n\t\t});\n\t}\n\n\tprocessClickEvent(e)\n\t{\n\t\tconst targetNode = e.target;\n\n\t\tif (!targetNode.classList.contains('sonet-group-grid-action'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = targetNode.getAttribute('data-bx-action');\n\n\t\tlet groupId = targetNode.getAttribute('data-bx-group-id');\n\n\t\tif (\n\t\t\t!Type.isStringFilled(action)\n\t\t\t|| !Type.isStringFilled(groupId)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tgroupId = parseInt(groupId);\n\t\tif (groupId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttargetNode.classList.add('--inactive');\n\n\t\tthis.actionManagerInstance.act({\n\t\t\taction: action,\n\t\t\tgroupId: groupId,\n\t\t}).then(() => {\n\t\t\ttargetNode.classList.remove('--inactive');\n\t\t}, () => {\n\t\t\ttargetNode.classList.remove('--inactive');\n\t\t});\n\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t}\n\n\tgetActionManager()\n\t{\n\t\treturn this.actionManagerInstance;\n\t}\n\n\tonAfterGroupCreated(baseEvent: BaseEvent)\n\t{\n\t\tconst projectId = baseEvent.getData();\n\n\t\tconst isRowExist = this.gridController.getInstance().isRowExist(projectId);\n\t\tif (isRowExist)\n\t\t{\n\t\t\tconst targetRow = this.gridController.getInstance().getRowNodeById(projectId);\n\t\t\tconst target = targetRow.querySelector('.sonet-group-grid-name-text');\n\n\t\t\tthis.tasksTour.showFinalStep(projectId, target);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t'SocialNetwork.Projects.Grid:RowAdd',\n\t\t\t\tthis.onGridRowAdded.bind(this, projectId)\n\t\t\t);\n\t\t}\n\t}\n\n\tonGridRowAdded(projectId, baseEvent: BaseEvent)\n\t{\n\t\tconst {id} = baseEvent.getData();\n\n\t\tif (Number(id) === Number(projectId))\n\t\t{\n\t\t\tconst targetRow = this.gridController.getInstance().getRowNodeById(projectId);\n\t\t\tconst target = targetRow.querySelector('.sonet-group-grid-name-text');\n\n\t\t\tthis.tasksTour.showFinalStep(target);\n\t\t}\n\t}\n}\n"],"names":["ActionManager","params","parent","componentName","Type","isStringFilled","signedParameters","gridId","useSlider","isBoolean","event","stopPropagation","preventDefault","Promise","resolve","reject","includes","action","setFavorites","groupId","value","then","response","processActionSuccess","processActionFailure","message","ajax","runComponentAction","mode","data","fields","success","errors","eventCode","Loc","getMessage","BX","UI","Notification","Center","notify","content","top","SidePanel","window","Instance","postMessageAll","code","PULL","reload","errorMessage","newValue","oldValue","Common","setFavoritesAjax","favoritesValue","callback","eventData","ID","RESULT","NAME","URL","EventEmitter","emit","BaseEvent","compatData","id","name","url","extranet","EXTRANET","failure","ERROR","buttonTitle","buttons","SendButton","text","events","click","PopupManager","getCurrentPopup","destroy","gridInstance","Main","gridManager","getInstanceById","getRows","getSelectedIds","apply_filter","getActionKey","getForAllKey","reloadTable","CancelButton","confirmPopup","create","autoHide","closeByEsc","onPopupClose","popup","Tag","render","padding","show","UserCounterManager","options","gridController","columnId","sliderOptions","useTasksCounters","timer","queueCounterData","Map","counterData","Number","getInstance","forEach","targetRow","isUndefined","scrum","getNode","getAttribute","setRowCounter","isRowExist","getRowById","rowCounterData","replace","type","open","bind","color","storedCounterData","eval","e","sumValue","Object","entries","key","toString","setAttribute","JSON","stringify","setCounters","PullControllerSocialnetwork","add","update","userAdd","userUpdate","userDelete","favoritesChanged","pinChanged","pullController","gridPinController","getPinController","grid","getGrid","onWorkgroupAdd","onWorkgroupUpdate","onWorkgroupDelete","onWorkgroupUserAdd","onWorkgroupUserUpdate","onWorkgroupUserDelete","onWorkgroupFavoritesChanged","onWorkgroupPinChanged","moveParams","rowBefore","getLastPinnedRowId","rowAfter","getFirstRowId","checkExistence","GROUP_ID","onCheckExistenceSuccess","console","error","removeRow","moveToDirectPlace","ACTION","PullControllerMainUserCounter","userCounterManager","onUserCounter","siteId","eventCounterData","isPlainObject","setTimeout","freeCounterQueue","matches","match","set","clear","PullControllerTasks","onTasksProjectCounter","onTasksProjectCommentsReadAll","EVENT","counterEvents","movingProjectEvents","has","highlightParams","skip","updateItemCondition","getIsPinned","updateCounter","getItems","rowIds","projects","keys","projectId","counters","PullControllerTasksUserCounter","onProjectReadAllComments","onScrumReadAllComments","view_all","new_comments","expired","USER_ID","PullManager","urls","livefeedCounterColumnId","livefeedCounterSliderOptions","init","userCounterManagerInstance","groupLivefeedUrl","pullControllerSocialnetwork","Pull","subscribe","pullControllerMainUserCounter","pullControllerTasksUserCounter","pullControllerTasks","groupIdList","isArray","sort","getSort","DATE_UPDATE","rowId","rowData","hasItem","addItem","addRow","updateRow","isNull","currentPage","getCurrentPage","workgroupBefore","workgroupAfter","updateItem","Manager","repo","get","filterId","items","pageSize","isNumber","parseInt","gridStub","defaultFilterPresetId","defaultCounter","gridContainer","gridContainerId","document","getElementById","initEvents","actionManagerInstance","GridController","GridActionController","setOptions","filter","GridFilter","tasksTour","TasksTour","tours","onAfterGroupCreated","initPull","GridTagController","pullManager","actionPanel","setActionsPanel","addEventListener","processClickEvent","getCompatData","sliderEvent","getEventId","getData","counter","getFilter","toggleByField","filterField","filterValue","filterData","getFilterFieldsValues","isFilteredByFieldValue","getApi","extendFilter","getFilterFields","field","getFields","deleteField","getSearch","apply","length","isFilteredByField","colorPinnedRows","targetNode","target","classList","contains","act","remove","baseEvent","getRowNodeById","querySelector","showFinalStep","subscribeOnce","onGridRowAdded"],"mappings":"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"}