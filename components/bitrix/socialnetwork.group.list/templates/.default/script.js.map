{"version":3,"file":"script.js","sources":["src/actionmanager.js","src/usercounter.js","src/pull/socialnetwork.js","src/pull/mainusercounter.js","src/pull/tasks.js","src/pull/tasksusercounter.js","src/pull.js","src/manager.js"],"sourcesContent":["import {ajax, Type, Loc, Tag} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {PopupManager} from 'main.popup';\nimport {SendButton, CancelButton} from 'ui.buttons';\nimport {Common} from 'socialnetwork.common';\n\nimport Manager from './manager'\n\nexport class ActionManager\n{\n\tconstructor(\n\t\tparams: {\n\t\t\tparent: Manager,\n\t\t}\n\t)\n\t{\n\t\tthis.parent = params.parent;\n\t\tthis.componentName = (Type.isStringFilled(this.parent.componentName) ? this.parent.componentName : '');\n\t\tthis.signedParameters = (Type.isStringFilled(this.parent.signedParameters) ? this.parent.signedParameters : '');\n\t\tthis.gridId = (Type.isStringFilled(this.parent.gridId) ? this.parent.gridId : '');\n\t\tthis.useSlider = (Type.isBoolean(this.parent.useSlider) ? this.parent.useSlider : false);\n\t}\n\n\tact(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t\tvalue: ?boolean,\n\t\t},\n\t\tevent: ?KeyboardEvent\n\t)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tif (['addToFavorites', 'removeFromFavorites'].includes(params.action))\n\t\t\t{\n\n\t\t\t\treturn this.setFavorites({\n\t\t\t\t\tgroupId: params.groupId,\n\t\t\t\t\tvalue: (params.action === 'addToFavorites'),\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tthis.processActionSuccess(params);\n\t\t\t\t}, (response) => {\n\t\t\t\t\tthis.processActionFailure(params, response.message);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn ajax.runComponentAction(this.componentName, 'act', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: params.action,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tgroupId: params.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionSuccess(params);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionFailure(params);\n\t\t\t\t\t}\n\t\t\t\t\tresolve(response);\n\t\t\t\t}, (response) => {\n\n\t\t\t\t\tif (response.errors)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.processActionFailure(params, response.errors[0].message);\n\t\t\t\t\t}\n\t\t\t\t\treject(response);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessActionSuccess(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t}\n\t)\n\t{\n\t\tlet eventCode = null;\n\t\tlet message = '';\n\n\t\tswitch (params.action)\n\t\t{\n\t\t\tcase 'addToFavorites':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_ADD_TO_FAVORITES');\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromFavorites':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_REMOVE_FROM_FAVORITES');\n\t\t\t\tbreak;\n\t\t\tcase 'addToArchive':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_ADD_TO_ARCHIVE');\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromArchive':\n\t\t\t\tmessage = Loc.getMessage('SGL_GROUP_ACTION_SUCCESS_NOTIFICATION_REMOVE_FROM_ARCHIVE');\n\t\t\t\tbreak;\n\t\t\tcase 'join':\n\t\t\t\teventCode = 'afterJoinRequestSend';\n\t\t\t\tbreak;\n\t\t\tcase 'setOwner':\n\t\t\t\teventCode = 'afterOwnerSet';\n\t\t\t\tbreak;\n\t\t\tcase 'setScrumMaster':\n\t\t\t\teventCode = 'afterSetScrumMaster';\n\t\t\t\tbreak;\n\t\t\tcase 'deleteOutgoingRequest':\n\t\t\t\teventCode = 'afterRequestOutDelete';\n\t\t\t\tbreak;\n\t\t\tcase 'deleteIncomingRequest':\n\t\t\t\teventCode = 'afterRequestInDelete';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\n\t\tif (message !== '')\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: message,\n\t\t\t});\n\t\t}\n\n\t\tif (\n\t\t\teventCode\n\t\t\t&& top.BX.SidePanel\n\t\t\t&& window !== top.window\n\t\t)\n\t\t{\n\t\t\ttop.BX.SidePanel.Instance.postMessageAll(window, 'sonetGroupEvent', {\n\t\t\t\tcode: eventCode,\n\t\t\t});\n\t\t}\n\n\t\tif (!BX.PULL)\n\t\t{\n\t\t\tthis.parent.reload();\n\t\t}\n\t}\n\n\tprocessActionFailure(\n\t\tparams: {\n\t\t\taction: string,\n\t\t\tgroupId: number,\n\t\t\tevent: PointerEvent,\n\t\t},\n\t\terrorMessage: ?string\n\t)\n\t{\n\t\tif (!Type.isStringFilled(errorMessage))\n\t\t{\n\t\t\terrorMessage = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_ACTION_FAILURE');\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: errorMessage,\n\t\t});\n\t}\n\n\tsetFavorites(\n\t\tparams: {\n\t\t\tgroupId: number,\n\t\t\tvalue: boolean,\n\t\t}\n\t)\n\t{\n\t\tconst newValue = params.value;\n\t\tconst oldValue = !params.value;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCommon.setFavoritesAjax({\n\t\t\t\tgroupId: params.groupId,\n\t\t\t\tfavoritesValue: oldValue,\n\t\t\t\tcallback: {\n\t\t\t\t\tsuccess: (data) => {\n\n\t\t\t\t\t\tconst eventData = {\n\t\t\t\t\t\t\tcode: 'afterSetFavorites',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tgroupId: data.ID,\n\t\t\t\t\t\t\t\tvalue: (data.RESULT === 'Y'),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\twindow.top.BX.SidePanel.Instance.postMessageAll(window, 'sonetGroupEvent', eventData);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isStringFilled(data.NAME)\n\t\t\t\t\t\t\t&& Type.isStringFilled(data.URL)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit('BX.Socialnetwork.WorkgroupFavorites:onSet', new BaseEvent({\n\t\t\t\t\t\t\t\tcompatData: [{\n\t\t\t\t\t\t\t\t\tid: this.groupId,\n\t\t\t\t\t\t\t\t\tname: data.NAME,\n\t\t\t\t\t\t\t\t\turl: data.URL,\n\t\t\t\t\t\t\t\t\textranet: (Type.isStringFilled(data.EXTRANET) ? data.EXTRANET : 'N'),\n\t\t\t\t\t\t\t\t}, newValue],\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tfailure: (response) => {\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tmessage: response.ERROR,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tgroupAction(action)\n\t{\n\t\tlet buttonTitle = '';\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'addToArchive':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_ADD')\n\t\t\t\tbreak;\n\t\t\tcase 'removeFromArchive':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_RETURN')\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\tbuttonTitle = Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_BUTTON_DELETE')\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\taction = '';\n\t\t}\n\n\t\tif (action === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttons = [\n\t\t\tnew SendButton({\n\t\t\t\ttext: buttonTitle,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tPopupManager.getCurrentPopup().destroy();\n\n\t\t\t\t\t\tconst gridInstance = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t\t\t\tif (!gridInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst data = {\n\t\t\t\t\t\t\tID: gridInstance.getRows().getSelectedIds(),\n\t\t\t\t\t\t\tapply_filter: 'Y',\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tdata[gridInstance.getActionKey()] = action;\n\t\t\t\t\t\tdata[gridInstance.getForAllKey()] = 'N';\n\n\t\t\t\t\t\tgridInstance.reloadTable('POST', data);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew CancelButton({\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tPopupManager.getCurrentPopup().destroy();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t})\n\t\t];\n\n\t\tconst confirmPopup = PopupManager.create({\n\t\t\tid: 'bx-sgl-group-delete-confirm',\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: buttons,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: (popup) => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontent: Tag.render`<div>${Loc.getMessage('SOCIALNETWORK_GROUP_LIST_GROUP_ACTION_CONFIRM_TEXT')}</div>`,\n\t\t\tpadding: 20,\n\t\t});\n\n\t\tconfirmPopup.show();\n\t}\n}\n","import {Type} from 'main.core';\n\nexport class UserCounterManager\n{\n\tconstructor(options)\n\t{\n\t\tthis.gridController = options.gridController;\n\t\tthis.url = options.url;\n\t\tthis.columnId = options.columnId;\n\t\tthis.sliderOptions = options.sliderOptions;\n\t\tthis.useTasksCounters = options.useTasksCounters;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tprocessCounterItem(counterData, groupId)\n\t{\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tgroupId === 0\n\t\t\t&& Number(counterData.value) === 0\n\t\t)\n\t\t{\n\t\t\tthis.gridController.getInstance().getRows().getRows().forEach((targetRow) => {\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isUndefined(counterData.scrum)\n\t\t\t\t\t&& counterData.scrum !== targetRow.getNode().getAttribute('data-scrum')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setRowCounter(targetRow, counterData, groupId);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.gridController.getInstance().isRowExist(groupId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setRowCounter(this.gridController.getInstance().getRowById(groupId), counterData, groupId);\n\t}\n\n\n\tsetRowCounter(targetRow, counterData, groupId)\n\t{\n\t\tconst rowCounterData = {};\n\n\t\tconst url = this.url\n\t\t\t.replace('#id#', groupId)\n\t\t\t.replace('#ID#', groupId)\n\t\t\t.replace('#GROUP_ID#', groupId)\n\t\t\t.replace('#group_id#', groupId);\n\n\t\trowCounterData[this.columnId] = {\n\t\t\tvalue: 0,\n\t\t\ttype: 'right',\n\t\t\tevents: (\n\t\t\t\tgroupId > 0\n\t\t\t\t\t? {\n\t\t\t\t\t\tclick: BX.SidePanel.Instance.open.bind(BX.SidePanel.Instance, url, this.sliderOptions),\n\t\t\t\t\t}\n\t\t\t\t\t: {}\n\t\t\t),\n\t\t\tcolor: 'ui-counter-danger',\n\t\t\tclass: 'sonet-ui-grid-counter',\n\t\t};\n\n\t\tlet storedCounterData = {};\n\n\t\ttry\n\t\t{\n\t\t\teval(`storedCounterData = ${targetRow.getNode().getAttribute('data-counters')};`);\n\t\t}\n\t\tcatch(e)\n\t\t{\n\n\t\t}\n\n\t\tif (\n\t\t\tstoredCounterData === null\n\t\t\t|| (\n\t\t\t\tcounterData.type === 'tasks_expired'\n\t\t\t\t&& targetRow.getNode().getAttribute('data-scrum') === 'Y'\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sumValue = 0;\n\t\tObject.entries(storedCounterData).forEach(([ key]) =>\n\t\t{\n\t\t\tif (key === counterData.type)\n\t\t\t{\n\t\t\t\tstoredCounterData[key] = counterData.value.toString();\n\t\t\t}\n\n\t\t\tsumValue += Number(storedCounterData[key]);\n\t\t});\n\n\t\ttargetRow.getNode().setAttribute('data-counters', `(${JSON.stringify(storedCounterData)})`);\n\t\trowCounterData[this.columnId].value = Number(sumValue);\n\t\ttargetRow.setCounters(rowCounterData);\n\t}\n\n}\n","import {Type, Loc} from 'main.core';\n\nexport class PullControllerSocialnetwork\n{\n\tstatic get events()\n\t{\n\t\treturn {\n\t\t\tadd: 'add',\n\t\t\tupdate: 'update',\n\t\t\tdelete: 'delete',\n\t\t\tuserAdd: 'userAdd',\n\t\t\tuserUpdate: 'userUpdate',\n\t\t\tuserDelete: 'userDelete',\n\t\t\tfavoritesChanged: 'favoritesChanged',\n\t\t\tpinChanged: 'pinChanged',\n\t\t};\n\t}\n\n\tstatic getInstance()\n\t{\n\n\t}\n\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'socialnetwork';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_ADD') ]: this.onWorkgroupAdd.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_UPDATE') ]: this.onWorkgroupUpdate.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_DELETE') ]: this.onWorkgroupDelete.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_ADD') ]: this.onWorkgroupUserAdd.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_UPDATE') ]: this.onWorkgroupUserUpdate.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_USER_DELETE') ]: this.onWorkgroupUserDelete.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_FAVORITES_CHANGED') ]: this.onWorkgroupFavoritesChanged.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_WORKGROUP_PIN_CHANGED') ]: this.onWorkgroupPinChanged.bind(this),\n\t\t};\n\t}\n\n\tonWorkgroupAdd(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.add,\n\t\t\tmoveParams: {\n\t\t\t\trowBefore: this.gridPinController.getLastPinnedRowId(),\n\t\t\t\trowAfter: this.gridController.getInstance().getFirstRowId(),\n\t\t\t},\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUpdate(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.update,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupDelete(data)\n\t{\n\t\tthis.removeRow(data.params.GROUP_ID);\n\t}\n\n\tonWorkgroupUserAdd(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userAdd,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUserUpdate(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userUpdate,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupUserDelete(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.userDelete,\n\t\t};\n\n\t\tthis.pullController.checkExistence(data.params.GROUP_ID).then(\n\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, data.params.GROUP_ID, params),\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tonWorkgroupFavoritesChanged(data)\n\t{\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.favoritesChanged,\n\t\t};\n\n\t\tthis.pullController.moveToDirectPlace(data.GROUP_ID, null, params);\n\t}\n\n\tonWorkgroupPinChanged(data)\n\t{\n\t\tif (\n\t\t\t!Type.isStringFilled(data.ACTION)\n\t\t\t|| !['pin', 'unpin'].includes(data.ACTION)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {\n\t\t\tevent: PullControllerSocialnetwork.events.pinChanged,\n\t\t};\n\n\t\tthis.pullController.moveToDirectPlace(data.GROUP_ID, null, params);\n\t}\n}","import {Loc, Type} from 'main.core';\n\nexport class PullControllerMainUserCounter\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.userCounterManager = options.userCounterManager;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'main';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_MAIN_USER_COUNTER') ]: this.onUserCounter.bind(this),\n\t\t};\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst siteId = Loc.getMessage('SITE_ID');\n\t\tconst eventCounterData = (Type.isPlainObject(data[siteId]) ? data[siteId] : {});\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tObject.entries(eventCounterData).forEach(([ key, value]) => {\n\t\t\tconst matches = key.match(/^\\*\\*SG(\\d+)/i);\n\t\t\tif (matches)\n\t\t\t{\n\t\t\t\tconst groupId = Number(matches[1]);\n\t\t\t\tvalue = Number(value)\n\n\t\t\t\tif (\n\t\t\t\t\tgroupId === 0\n\t\t\t\t\t&& value !== 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst counterData = {\n\t\t\t\t\ttype: 'livefeed',\n\t\t\t\t\tvalue: value,\n\t\t\t\t};\n\n\t\t\t\tthis.queueCounterData.set(groupId, counterData);\n\t\t\t}\n\t\t});\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.queueCounterData.forEach((counterData, groupId) => {\n\t\t\t// todo oh this.userCounterManager.processCounterItem(counterData, groupId);\n\t\t});\n\n\t\tthis.queueCounterData.clear();\n\t\tthis.timer = null;\n\t}\n\n}\n","import {Loc} from 'main.core';\n\nexport class PullControllerTasks\n{\n\n\tstatic get events()\n\t{\n\t\treturn {\n\t\t\tpinChanged: 'pinChanged',\n\t\t};\n\t}\n\n\tstatic get counterEvents()\n\t{\n\t\treturn [\n\t\t\t'onAfterTaskAdd',\n\t\t\t'onAfterTaskDelete',\n\t\t\t'onAfterTaskRestore',\n\t\t\t'onAfterTaskView',\n\t\t\t'onAfterTaskMute',\n\t\t\t'onAfterCommentAdd',\n\t\t\t'onAfterCommentDelete',\n\t\t\t'onProjectPermUpdate',\n\t\t];\n\t}\n\n\tstatic get movingProjectEvents()\n\t{\n\t\treturn [\n\t\t\t'onAfterTaskAdd',\n\t\t\t'onAfterCommentAdd',\n\t\t];\n\t}\n\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.timer = null;\n\t\tthis.counterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_COUNTER') ]: this.onTasksProjectCounter.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_SCRUM_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_COMMENT_READ_ALL') ]: this.onTasksProjectCommentsReadAll.bind(this),\n\t\t};\n\t}\n\n\tonTasksProjectCounter(data)\n\t{\n\t\tconst groupId = data.GROUP_ID;\n\t\tconst event = data.EVENT;\n\n\t\tif (!PullControllerTasks.counterEvents.includes(event))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tif (PullControllerTasks.movingProjectEvents.includes(event) || !this.counterData.has(groupId))\n\t\t{\n\t\t\tthis.counterData.set(groupId, event);\n\t\t}\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.counterData.forEach((event, groupId) => {\n\n\t\t\tconst params = {\n\t\t\t\tevent,\n\t\t\t\thighlightParams: {\n\t\t\t\t\tskip: true,\n\t\t\t\t},\n\t\t\t\tupdateItemCondition: (event) => {\n\t\t\t\t\treturn PullControllerTasks.movingProjectEvents.includes(event);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (PullControllerTasks.movingProjectEvents.includes(event))\n\t\t\t{\n\t\t\t\tparams.moveParams = {\n\t\t\t\t\trowBefore: (\n\t\t\t\t\t\tthis.gridPinController.getIsPinned(groupId)\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: this.gridPinController.getLastPinnedRowId()\n\t\t\t\t\t),\n\t\t\t\t\trowAfter: this.gridController.getInstance().getFirstRowId(),\n\t\t\t\t};\n\t\t\t\tparams.highlightParams = {\n\t\t\t\t\tskip: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.pullController.checkExistence(groupId).then(\n\t\t\t\tresponse => this.pullController.onCheckExistenceSuccess(response, groupId, params),\n\t\t\t\tresponse => console.error(response)\n\t\t\t);\n\t\t});\n\t\tthis.counterData.clear();\n\t\tthis.timer = null;\n\t}\n\n\tonTasksProjectCommentsReadAll(data)\n\t{\n\t\tconst groupId = data.GROUP_ID;\n\n\t\tif (groupId)\n\t\t{\n\t\t\tif (this.gridController.getInstance().isRowExist(groupId))\n\t\t\t{\n\t\t\t\tthis.updateCounter([groupId]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCounter(this.gridController.getInstance().getItems());\n\t\t}\n\t}\n\n\tupdateCounter(rowIds)\n\t{\n\t\tthis.pullController.checkExistence(rowIds).then(\n\t\t\tresponse => {\n\t\t\t\tconst projects = response.data;\n\t\t\t\tif (projects)\n\t\t\t\t{\n\t\t\t\t\tObject.keys(projects).forEach((projectId) => {\n\t\t\t\t\t\tif (this.gridController.getInstance().isRowExist(projectId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.gridController.getInstance()\n\t\t\t\t\t\t\t\t.getRowById(projectId)\n\t\t\t\t\t\t\t\t.setCounters(projects[projectId].counters)\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n}","import {Loc, Type} from 'main.core';\n\nexport class PullControllerTasksUserCounter\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.pullController = options.pullController;\n\n\t\tthis.gridPinController = this.gridController.getInstance().getPinController();\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.userCounterManager = options.userCounterManager;\n\n\t\tthis.timer = null;\n\t\tthis.queueCounterData = new Map();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_USER_COUNTER') ]: this.onUserCounter.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_PROJECT_READ_ALL') ]: this.onProjectReadAllComments.bind(this),\n\t\t\t[ Loc.getMessage('PUSH_EVENT_TASKS_SCRUM_READ_ALL') ]: this.onScrumReadAllComments.bind(this),\n\t\t};\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tObject.entries(data).forEach(([ key, value]) => {\n\t\t\tif (\n\t\t\t\tkey == Number(key)\n\t\t\t\t&& Number(key) > 0\n\t\t\t\t&& Type.isPlainObject(value.view_all)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!Type.isUndefined(value.view_all.new_comments))\n\t\t\t\t{\n\t\t\t\t\tthis.queueCounterData.set(`${key}_new_comments`, {\n\t\t\t\t\t\tgroupId: key,\n\t\t\t\t\t\ttype: 'tasks_new_comments',\n\t\t\t\t\t\tvalue: Number(value.view_all.new_comments),\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isUndefined(value.view_all.expired))\n\t\t\t\t{\n\t\t\t\t\tthis.queueCounterData.set(`${key}_expired`, {\n\t\t\t\t\t\tgroupId: key,\n\t\t\t\t\t\ttype: 'tasks_expired',\n\t\t\t\t\t\tvalue: Number(value.view_all.expired),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonProjectReadAllComments(data)\n\t{\n\t\tif (\n\t\t\tNumber(data.GROUP_ID) !== 0\n\t\t\t&& Number(data.USER_ID) !== Number(Loc.getMessage('USER_ID'))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tthis.queueCounterData.set(`0_new_comments`, {\n\t\t\tgroupId: 0,\n\t\t\ttype: 'tasks_new_comments',\n\t\t\tvalue: 0,\n\t\t\tscrum: 'N',\n\t\t});\n\t}\n\n\tonScrumReadAllComments(data)\n\t{\n\t\tif (\n\t\t\tNumber(data.GROUP_ID) !== 0\n\t\t\t&& Number(data.USER_ID) !== Number(Loc.getMessage('USER_ID'))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.timer)\n\t\t{\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.freeCounterQueue();\n\t\t\t}, 1000);\n\t\t}\n\n\t\tthis.queueCounterData.set(`0_new_comments`, {\n\t\t\tgroupId: 0,\n\t\t\ttype: 'tasks_new_comments',\n\t\t\tvalue: 0,\n\t\t\tscrum: 'Y',\n\t\t});\n\t}\n\n\tfreeCounterQueue()\n\t{\n\t\tthis.queueCounterData.forEach((counterData) => {\n\t\t\t// todo oh this.userCounterManager.processCounterItem(counterData, Number(counterData.groupId));\n\t\t});\n\n\t\tthis.queueCounterData.clear();\n\t\tthis.timer = null;\n\t}\n\n}","import {ajax, Type} from 'main.core';\nimport {PULL as Pull} from 'pull.client';\n\nimport {UserCounterManager} from './usercounter';\nimport {PullControllerSocialnetwork} from './pull/socialnetwork';\nimport {PullControllerMainUserCounter} from './pull/mainusercounter';\nimport {PullControllerTasks} from './pull/tasks';\nimport {PullControllerTasksUserCounter} from './pull/tasksusercounter';\n\nexport class PullManager\n{\n\tconstructor(options)\n\t{\n\t\tthis.componentName = options.componentName;\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.urls = options.urls;\n\t\tthis.useTasksCounters = options.useTasksCounters;\n\t\tthis.livefeedCounterColumnId = options.livefeedCounterColumnId;\n\t\tthis.livefeedCounterSliderOptions = options.livefeedCounterSliderOptions;\n\n\t\tthis.gridController = options.gridController;\n\t\tthis.grid = this.gridController.getGrid();\n\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.userCounterManagerInstance = new UserCounterManager({\n\t\t\tgridController: this.gridController,\n\t\t\turl: this.urls.groupLivefeedUrl,\n\t\t\tcolumnId: this.livefeedCounterColumnId,\n\t\t\tsliderOptions: this.livefeedCounterSliderOptions,\n\t\t\tuseTasksCounters: this.useTasksCounters,\n\t\t});\n\n\t\tthis.pullControllerSocialnetwork = new PullControllerSocialnetwork({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tgridController: this.gridController,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t\tpullController: this,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerSocialnetwork);\n\n\t\tthis.pullControllerMainUserCounter = new PullControllerMainUserCounter({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerMainUserCounter);\n\n\t\tthis.pullControllerTasksUserCounter = new PullControllerTasksUserCounter({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tgridController: this.gridController,\n\t\t\tuserCounterManager: this.userCounterManagerInstance,\n\t\t});\n\n\t\tPull.subscribe(this.pullControllerTasksUserCounter);\n\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\tthis.pullControllerTasks = new PullControllerTasks({\n\t\t\t\tcomponentName: this.componentName,\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tgridController: this.gridController,\n\t\t\t\tpullController: this,\n\t\t\t});\n\n\t\t\tPull.subscribe(this.pullControllerTasks);\n\t\t}\n\t}\n\n\tcheckExistence(groupId)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(this.componentName, 'checkExistence', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tgroupIdList: Type.isArray(groupId) ? groupId : [ groupId ],\n\t\t\t\t},\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t}).then(\n\t\t\t\tresponse => resolve(response),\n\t\t\t\tresponse => reject(response)\n\t\t\t);\n\t\t});\n\t}\n\n\tonCheckExistenceSuccess(response, groupId, params)\n\t{\n\t\tif (Type.isUndefined(response.data[groupId]))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (response.data[groupId] === false)\n\t\t{\n\t\t\tthis.grid.removeRow(groupId);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.moveToDirectPlace(groupId, response.data[groupId], params);\n\t}\n\n\tisActivityRealtimeMode()\n\t{\n\t\tconst sort = this.gridController.getInstance().getSort();\n\n\t\treturn (\n\t\t\tsort.DATE_UPDATE\n\t\t\t&& sort.DATE_UPDATE === 'desc'\n\t\t);\n\t}\n\n\tupdateItem(rowId, rowData, params)\n\t{\n\t\tif (!this.gridController.getInstance().hasItem(rowId))\n\t\t{\n\t\t\tthis.gridController.getInstance().addItem(rowId);\n\t\t\tthis.addRow(rowId, rowData, params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateRow(rowId, rowData, params);\n\t\t}\n\t}\n\n\taddRow(rowId, rowData, params)\n\t{\n\t\tif (\n\t\t\tthis.gridController.getInstance().isRowExist(rowId)\n\t\t\t|| Type.isUndefined(rowData)\n\t\t\t|| Type.isNull(rowData)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().addRow(rowId, rowData, params);\n\t}\n\n\tupdateRow(rowId, rowData, params)\n\t{\n\t\tif (\n\t\t\t!this.gridController.getInstance().isRowExist(rowId)\n\t\t\t|| Type.isUndefined(rowData)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().updateRow(rowId, rowData, params);\n\t}\n\n\tremoveRow(rowId)\n\t{\n\t\tif (!this.gridController.getInstance().isRowExist(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.gridController.getInstance().removeRow(rowId);\n\t}\n\n\tmoveToDirectPlace(groupId, data, params)\n\t{\n\t\tparams = params || {};\n\n\t\tajax.runComponentAction(this.componentName, 'findWorkgroupPlace', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tcurrentPage: this.gridController.getInstance().getCurrentPage(),\n\t\t\t},\n\t\t\tsignedParameters: this.signedParameters,\n\t\t}).then((response) => {\n\t\t\tif (response.data === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {workgroupBefore, workgroupAfter} = response.data;\n\n\t\t\tif (workgroupBefore === false && workgroupAfter === false)\n\t\t\t{\n\t\t\t\tthis.removeRow(groupId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t(workgroupBefore && this.gridController.getInstance().isRowExist(workgroupBefore))\n\t\t\t\t\t|| (workgroupAfter && this.gridController.getInstance().isRowExist(workgroupAfter))\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tparams.moveParams = {\n\t\t\t\t\t\trowBefore: workgroupBefore,\n\t\t\t\t\t\trowAfter: workgroupAfter,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tparams.moveParams = {\n\t\t\t\t\t\tskip: true,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.updateItem(groupId, data, params);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {\n\tController as GridController,\n\tActionController as GridActionController,\n\tTagController as GridTagController,\n\tFilter as GridFilter,\n} from 'socialnetwork.ui.grid';\n\nimport {Tour as TasksTour} from 'tasks.tour';\n\nimport {ActionManager} from './actionmanager';\nimport {PullManager} from './pull';\n\nexport default class Manager\n{\n\tstatic repo = new Map();\n\n\tstatic getById(id)\n\t{\n\t\treturn Manager.repo.get(id);\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.componentName = params.componentName;\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.useSlider = params.useSlider;\n\t\tthis.gridId = params.gridId;\n\t\tthis.filterId = (Type.isStringFilled(params.filterId) ? params.filterId : null);\n\t\tthis.sort = params.sort;\n\t\tthis.items = params.items;\n\t\tthis.pageSize = (Type.isNumber(params.pageSize) ? parseInt(params.pageSize) : 10);\n\t\tthis.gridStub = (!Type.isUndefined(params.gridStub) ? params.gridStub : null);\n\t\tthis.defaultFilterPresetId = (\n\t\t\tType.isStringFilled(params.defaultFilterPresetId)\n\t\t\t&& ![ 'requests_in', 'requests_out' ].includes(params.defaultFilterPresetId)\n\t\t\t\t? params.defaultFilterPresetId\n\t\t\t\t: 'tmp_filter'\n\t\t);\n\t\tthis.defaultCounter = (Type.isStringFilled(params.defaultCounter) ? params.defaultCounter : '');\n\t\tthis.gridContainer = (Type.isStringFilled(params.gridContainerId) ? document.getElementById(params.gridContainerId) : null);\n\t\tthis.urls = params.urls;\n\t\tthis.useTasksCounters = (Type.isBoolean(params.useTasksCounters) ? params.useTasksCounters : false);\n\n\t\tthis.livefeedCounterColumnId = (Type.isStringFilled(params.livefeedCounterColumnId) ? params.livefeedCounterColumnId : 'NAME');\n\t\tthis.livefeedCounterSliderOptions = (Type.isPlainObject(params.livefeedCounterSliderOptions) ? params.livefeedCounterSliderOptions : {});\n\n\t\tthis.init(params);\n\t}\n\n\tinit(params)\n\t{\n\t\tthis.initEvents();\n\n\t\tthis.actionManagerInstance = new ActionManager({\n\t\t\tparent: this,\n\t\t});\n\n\t\tthis.gridController = new GridController({\n\t\t\tid: this.id,\n\t\t\tsort: this.sort,\n\t\t\titems: this.items,\n\t\t\tpageSize: this.pageSize,\n\t\t\tgridStub: this.gridStub,\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tManager.repo.set(this.id, this);\n\n\t\tGridActionController.setOptions({\n\t\t\tgridInstance: this.gridController.getGrid(),\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tconst filter = new GridFilter({\n\t\t\tfilterId: this.filterId,\n\t\t\tdefaultFilterPresetId: this.defaultFilterPresetId,\n\t\t\tgridId: this.id,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t});\n\n\t\tif (this.useTasksCounters)\n\t\t{\n\t\t\tthis.tasksTour = new TasksTour({\n\t\t\t\ttours: params.tours,\n\t\t\t});\n\t\t\tthis.tasksTour.subscribe('FirstProject:afterProjectCreated', this.onAfterGroupCreated.bind(this));\n\t\t\tthis.tasksTour.subscribe('FirstScrum:afterScrumCreated', this.onAfterGroupCreated.bind(this));\n\t\t}\n\n\t\tthis.initPull();\n\n\t\tif (filter)\n\t\t{\n\t\t\tGridTagController.setOptions({\n\t\t\t\tfilter,\n\t\t\t});\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tthis.pullManager = new PullManager({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\turls: this.urls,\n\t\t\tlivefeedCounterColumnId: this.livefeedCounterColumnId,\n\t\t\tlivefeedCounterSliderOptions: this.livefeedCounterSliderOptions,\n\t\t\tgridController: this.gridController,\n\t\t\tuseTasksCounters: this.useTasksCounters,\n\t\t});\n\t}\n\n\tsetActionsPanel(actionPanel)\n\t{\n\t\tGridActionController.setActionsPanel(actionPanel)\n\t}\n\n\tinitEvents()\n\t{\n\t\tif (this.gridContainer)\n\t\t{\n\t\t\tthis.gridContainer.addEventListener('click', this.processClickEvent.bind(this));\n\t\t}\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event: BaseEvent) => {\n\n\t\t\tconst [ sliderEvent ] = event.getCompatData();\n\n\t\t\tif (\n\t\t\t\t!BX.PULL\n\t\t\t\t&& sliderEvent.getEventId() === 'sonetGroupEvent'\n\t\t\t\t&& !Type.isUndefined(sliderEvent.data)\n\t\t\t\t&& Type.isStringFilled(sliderEvent.data.code)\n\t\t\t\t&& [\n\t\t\t\t\t'afterCreate',\n\t\t\t\t\t'afterEdit',\n\t\t\t\t\t'afterInvite',\n\t\t\t\t\t'afterJoinRequestSend',\n\t\t\t\t\t'afterLeave',\n\t\t\t\t\t'afterDelete',\n\t\t\t\t].includes(sliderEvent.data.code)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('Tasks.Toolbar:onItem', (event: BaseEvent) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.counter && data.counter.filter)\n\t\t\t{\n\t\t\t\tconst filter = data.counter.filter.getFilter();\n\n\t\t\t\tthis.toggleByField({\n\t\t\t\t\t[data.counter.filterField]: data.counter.filterValue,\n\t\t\t\t}, filter);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('Socialnetwork.Toolbar:onItem', (event: BaseEvent) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.counter && data.counter.filter)\n\t\t\t{\n\t\t\t\tconst filter = data.counter.filter.getFilter();\n\n\t\t\t\tthis.toggleByField({\n\t\t\t\t\t[data.counter.filterField]: data.counter.filterValue,\n\t\t\t\t}, filter);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggleByField(filterData, filter)\n\t{\n\t\tif (!filter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst name = Object.keys(filterData)[0];\n\t\tconst value = filterData[name];\n\t\tconst fields = filter.getFilterFieldsValues();\n\n\t\tif (!this.isFilteredByFieldValue(name, value, fields))\n\t\t{\n\t\t\tfilter.getApi().extendFilter({[name]: value});\n\t\t\treturn;\n\t\t}\n\n\t\tfilter.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tfilter.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tfilter.getSearch().apply();\n\t}\n\n\tisFilteredByField(field, fields)\n\t{\n\t\tif (!Object.keys(fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(fields[field]))\n\t\t{\n\t\t\treturn fields[field].length > 0;\n\t\t}\n\n\t\treturn fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value, fields)\n\t{\n\t\treturn this.isFilteredByField(field, fields) && fields[field] === value;\n\t}\n\n\treload()\n\t{\n\t\tconst gridInstance = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\tif (!gridInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tgridInstance.reloadTable('POST', {\n\t\t\tapply_filter: 'Y',\n\t\t}, () => {\n\t\t\tthis.gridController.getInstance().getPinController().colorPinnedRows();\n\t\t});\n\t}\n\n\tprocessClickEvent(e)\n\t{\n\t\tconst targetNode = e.target;\n\n\t\tif (!targetNode.classList.contains('sonet-group-grid-action'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = targetNode.getAttribute('data-bx-action');\n\n\t\tlet groupId = targetNode.getAttribute('data-bx-group-id');\n\n\t\tif (\n\t\t\t!Type.isStringFilled(action)\n\t\t\t|| !Type.isStringFilled(groupId)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tgroupId = parseInt(groupId);\n\t\tif (groupId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttargetNode.classList.add('--inactive');\n\n\t\tthis.actionManagerInstance.act({\n\t\t\taction: action,\n\t\t\tgroupId: groupId,\n\t\t}).then(() => {\n\t\t\ttargetNode.classList.remove('--inactive');\n\t\t}, () => {\n\t\t\ttargetNode.classList.remove('--inactive');\n\t\t});\n\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t}\n\n\tgetActionManager()\n\t{\n\t\treturn this.actionManagerInstance;\n\t}\n\n\tonAfterGroupCreated(baseEvent: BaseEvent)\n\t{\n\t\tconst projectId = baseEvent.getData();\n\n\t\tconst isRowExist = this.gridController.getInstance().isRowExist(projectId);\n\t\tif (isRowExist)\n\t\t{\n\t\t\tconst targetRow = this.gridController.getInstance().getRowNodeById(projectId);\n\t\t\tconst target = targetRow.querySelector('.sonet-group-grid-name-text');\n\n\t\t\tthis.tasksTour.showFinalStep(projectId, target);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t'SocialNetwork.Projects.Grid:RowAdd',\n\t\t\t\tthis.onGridRowAdded.bind(this, projectId)\n\t\t\t);\n\t\t}\n\t}\n\n\tonGridRowAdded(projectId, baseEvent: BaseEvent)\n\t{\n\t\tconst {id} = baseEvent.getData();\n\n\t\tif (Number(id) === Number(projectId))\n\t\t{\n\t\t\tconst targetRow = this.gridController.getInstance().getRowNodeById(projectId);\n\t\t\tconst target = targetRow.querySelector('.sonet-group-grid-name-text');\n\n\t\t\tthis.tasksTour.showFinalStep(target);\n\t\t}\n\t}\n}\n"],"names":["ActionManager","params","parent","componentName","Type","isStringFilled","signedParameters","gridId","useSlider","isBoolean","event","stopPropagation","preventDefault","Promise","resolve","reject","includes","action","setFavorites","groupId","value","then","response","processActionSuccess","processActionFailure","message","ajax","runComponentAction","mode","data","fields","success","errors","eventCode","Loc","getMessage","BX","UI","Notification","Center","notify","content","top","SidePanel","window","Instance","postMessageAll","code","PULL","reload","errorMessage","newValue","oldValue","Common","setFavoritesAjax","favoritesValue","callback","eventData","ID","RESULT","NAME","URL","EventEmitter","emit","BaseEvent","compatData","id","name","url","extranet","EXTRANET","failure","ERROR","buttonTitle","buttons","SendButton","text","events","click","PopupManager","getCurrentPopup","destroy","gridInstance","Main","gridManager","getInstanceById","getRows","getSelectedIds","apply_filter","getActionKey","getForAllKey","reloadTable","CancelButton","confirmPopup","create","autoHide","closeByEsc","onPopupClose","popup","Tag","render","padding","show","UserCounterManager","options","gridController","columnId","sliderOptions","useTasksCounters","timer","queueCounterData","Map","counterData","Number","getInstance","forEach","targetRow","isUndefined","scrum","getNode","getAttribute","setRowCounter","isRowExist","getRowById","rowCounterData","replace","type","open","bind","color","storedCounterData","eval","e","sumValue","Object","entries","key","toString","setAttribute","JSON","stringify","setCounters","PullControllerSocialnetwork","add","update","userAdd","userUpdate","userDelete","favoritesChanged","pinChanged","pullController","gridPinController","getPinController","grid","getGrid","onWorkgroupAdd","onWorkgroupUpdate","onWorkgroupDelete","onWorkgroupUserAdd","onWorkgroupUserUpdate","onWorkgroupUserDelete","onWorkgroupFavoritesChanged","onWorkgroupPinChanged","moveParams","rowBefore","getLastPinnedRowId","rowAfter","getFirstRowId","checkExistence","GROUP_ID","onCheckExistenceSuccess","console","error","removeRow","moveToDirectPlace","ACTION","PullControllerMainUserCounter","userCounterManager","onUserCounter","siteId","eventCounterData","isPlainObject","setTimeout","freeCounterQueue","matches","match","set","clear","PullControllerTasks","onTasksProjectCounter","onTasksProjectCommentsReadAll","EVENT","counterEvents","movingProjectEvents","has","highlightParams","skip","updateItemCondition","getIsPinned","updateCounter","getItems","rowIds","projects","keys","projectId","counters","PullControllerTasksUserCounter","onProjectReadAllComments","onScrumReadAllComments","view_all","new_comments","expired","USER_ID","PullManager","urls","livefeedCounterColumnId","livefeedCounterSliderOptions","init","userCounterManagerInstance","groupLivefeedUrl","pullControllerSocialnetwork","Pull","subscribe","pullControllerMainUserCounter","pullControllerTasksUserCounter","pullControllerTasks","groupIdList","isArray","sort","getSort","DATE_UPDATE","rowId","rowData","hasItem","addItem","addRow","updateRow","isNull","currentPage","getCurrentPage","workgroupBefore","workgroupAfter","updateItem","Manager","repo","get","filterId","items","pageSize","isNumber","parseInt","gridStub","defaultFilterPresetId","defaultCounter","gridContainer","gridContainerId","document","getElementById","initEvents","actionManagerInstance","GridController","GridActionController","setOptions","filter","GridFilter","tasksTour","TasksTour","tours","onAfterGroupCreated","initPull","GridTagController","pullManager","actionPanel","setActionsPanel","addEventListener","processClickEvent","getCompatData","sliderEvent","getEventId","getData","counter","getFilter","toggleByField","filterField","filterValue","filterData","getFilterFieldsValues","isFilteredByFieldValue","getApi","extendFilter","getFilterFields","field","getFields","deleteField","getSearch","apply","length","isFilteredByField","colorPinnedRows","targetNode","target","classList","contains","act","remove","baseEvent","getRowNodeById","querySelector","showFinalStep","subscribeOnce","onGridRowAdded"],"mappings":"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"}