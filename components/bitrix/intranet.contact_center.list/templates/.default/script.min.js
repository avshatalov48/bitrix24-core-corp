(function(){"use strict";if(window["SBPETabs"])return;BX.namespace("BX.ContactCenter");BX.ContactCenter.TileGrid=function(e){if(typeof e==="object"){this.wrapper=e.wrapper;this.inner=e.inner;this.innerPartnersBlock=e.innerPartnersBlock;this.tiles=e.tiles;this.minTileWidth=0;this.maxTileWidth=0;this.tileRowLength=0;if(e.sizeSettings){this.minTileWidth=e.sizeSettings.minWidth;this.maxTileWidth=e.sizeSettings.maxWidth}else if(e.tileRowLength){this.tileRowLength=e.tileRowLength}else{this.minTileWidth=180;this.maxTileWidth=250}this.tileRatio=e.tileRatio||1.8;this.maxTileHeight=this.maxTileWidth/this.tileRatio}this.setTileWidth();BX.bind(window,"resize",this.setTileWidth.bind(this))};BX.ContactCenter.TileGrid.prototype={setTileWidth:function(){var e=this.getTileCalculating();var t=e.width;var i=e.height;if(this.minTileWidth){t=t<=this.maxTileWidth?e.width:this.maxTileWidth;i=i<=this.maxTileHeight?e.height:this.maxTileHeight}requestAnimationFrame(function(){for(var n=0;n<this.tiles.length;n++){this.tiles[n].style.width=t+"px";this.tiles[n].style.height=i+"px";this.tiles[n].style.marginLeft=e.margin+"px";this.tiles[n].style.marginTop=e.margin+"px"}this.inner.style.marginLeft=e.margin*-1+"px";this.inner.style.marginTop=e.margin*-1+"px";this.innerPartnersBlock.style.marginLeft=e.margin*-1+"px";this.innerPartnersBlock.style.marginTop=e.margin*-1+"px"}.bind(this))},getTileCalculating:function(){var e=this.wrapper.clientWidth;var t=e/100*5;var i=0,n=0;if(this.tileRowLength){n=this.tileRowLength;i=(e-t)/this.tileRowLength}else{i=this.minTileWidth;n=(e-t)/i;if(n>this.tiles.length){i=(e-t)/this.tiles.length;i=i>this.maxTileWidth?this.maxTileWidth:i}else if(n-Math.floor(n)>0){n=Math.floor(n);i=(e-t)/n}}return{width:i,margin:t/(n-1),height:i/this.tileRatio}}};BX.ContactCenter.Menu=function(e){this.element=e.element;this.bindElement=document.getElementById(e.bindElement);this.items=this.prepareItems(e.items);this.init()};BX.ContactCenter.Menu.prototype={init:function(){var e={maxHeight:300};var t=BX.PopupWindowManager.getPopupById("menu-popup-"+this.element);if(t){t.destroy()}this.menu=new BX.PopupMenuWindow(this.element,this.bindElement,this.items,e);BX.bind(this.bindElement,"click",BX.delegate(this.show,this))},show:function(){this.menu.show()},close:function(){this.menu.close()},prepareItems:function(e){if(typeof e==="object"){e=Object.values(e)}var t=[];var i;for(var n=0;n<e.length;n++){i=this.prepareItem(e[n]);if(i.delimiterBefore){t.push({delimiter:true})}t.push(i);if(i.delimiterAfter){t.push({delimiter:true})}}return t},prepareItem:function(item){var newItem={};newItem.title=item.NAME;newItem.text=item.NAME;newItem.delimiterAfter=item.DELIMITER_AFTER;newItem.delimiterBefore=item.DELIMITER_BEFORE;if(item.IS_ACTIVE==="Y"){newItem.className="contact-center-list-item-status-active"}else if(item.IS_ACTIVE==="N"){newItem.className="contact-center-list-item-status-inactive"}if(item.FIXED){newItem.className="menu-popup-no-icon intranet-contact-list-item-add"}if(item.ONCLICK){newItem.onclick=BX.delegate(function(e){eval(item.ONCLICK);this.close()},this)}if(item.LIST){newItem.items=this.prepareItems(item.LIST)}return newItem}};BX.ContactCenter.Loader=function(e){this.parentNode=document.querySelector("#"+e+"");this.blockNode=this.parentNode.querySelector(".intranet-contact-item");this.loaderIndicator=new BX.Loader({size:40,color:"#868d95"});this.body=BX.create("div",{props:{className:"intranet-side-panel-overlay"}});this.setSizeDelegated();BX.bind(window,"resize",this.setSizeDelegated.bind(this))};BX.ContactCenter.Loader.prototype={show:function(e){if(e){this.parentNode=e.parentNode;this.blockNode=e}this.parentNode.insertBefore(this.body,this.blockNode);this.loaderIndicator.show(this.body)},hide:function(){this.loaderIndicator.hide();this.parentNode.removeChild(this.body)},setSize:function(){this.body.style.width=this.blockNode.clientWidth+"px";this.body.style.height=this.blockNode.clientHeight+"px";this.body.style.marginTop=this.blockNode.style.marginTop;this.body.style.marginLeft=this.blockNode.style.marginLeft},setSizeDelegated:function(){setTimeout(BX.delegate(function(e){this.setSize()},this),500)}};BX.ContactCenter.Ajax=function(e,t){this.signedParameters=e.signedParameters;this.componentName=e.componentName;this.sliderUrls=e.sliderUrls;this.loader=new BX.ContactCenter.Loader(e.parentSelector);this.appearance=t;this.init()};BX.ContactCenter.Ajax.prototype={init:function(){BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()==="ContactCenter:reload"){this.reload()}else if(e.getEventId()==="ContactCenter:reloadItem"){var t=e.getData();var i=document.querySelector('#intranet-contact-list [data-module="'+t.moduleId+'"][data-item="'+t.itemCode+'"]');this.reloadItem(i)}},this));BX.addCustomEvent("Rest:AppLayout:ApplicationInstall",BX.delegate(function(e,t){this.reload()},this))},reload:function(){BX.ajax.runComponentAction(this.componentName,"reload",{mode:"class",signedParameters:this.signedParameters}).then(BX.delegate(function(e){var t=BX.create("div");t.innerHTML=e.data.html;BX("intranet-contact-list").innerHTML=t.querySelector("#intranet-contact-list").innerHTML;this.appearance.loadPage(e.data.js_data);BX.remove(t)},this),BX.delegate(function(e){},this))},reloadItem:function(e){this.loader.show(e);var t={moduleId:e.dataset.module,itemCode:e.dataset.item};BX.ajax.runComponentAction(this.componentName,"reloadItem",{mode:"class",signedParameters:this.signedParameters,data:t}).then(BX.delegate(function(t){this.appearance.loadItem(e,t.data);this.loader.hide()},this),BX.delegate(function(e){this.loader.hide()},this))},isContactCenterBlockUrl:function(e){var t=false,i;if(e){for(var n=0;n<this.sliderUrls.length;n++){i=new RegExp(this.sliderUrls[n],"ig");if(e.match(i)!==null){t=true;break}}}return t}};BX.ContactCenter.Appearance=function(e){this.loadPage(e)};BX.ContactCenter.Appearance.prototype={loadPage:function(e){var t=BX("intranet-contact-wrap");var i=Array.prototype.slice.call(t.getElementsByClassName("intranet-contact-item"));this.setItemBlockColorAll(t);new BX.ContactCenter.TileGrid({wrapper:t,inner:BX(e.parentSelector),innerPartnersBlock:BX(e.parentSelectorPartnersBlock),tiles:i,sizeSettings:{minWidth:190,maxWidth:250}});if(e.handleMailLinks){this.bindMailPagesSlider()}if(e.menu){for(var n=0;n<e.menu.length;n++){new BX.ContactCenter.Menu(e.menu[n])}}},loadItem:function(e,t){if(t.data.SELECTED){e.classList.add("intranet-contact-item-selected");this.setBlockColor(e,"")}else{e.classList.remove("intranet-contact-item-selected");e.style.backgroundColor="#ffffff"}if(t.js_data.menu){for(var i=0;i<t.js_data.menu.length;i++){new BX.ContactCenter.Menu(t.js_data.menu[i])}}},bindMailPagesSlider:function(){if(window===window.top){top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:["^/mail/config/(new|edit)"],options:{width:760,cacheable:false,allowChangeHistory:false}}]})}},setItemBlockColorAll:function(e){var t=e.querySelectorAll(".intranet-contact-item");var i=["#90be00","#2fc6f6","#ff5752","#55d0e0","#3871ba","#ffa900","#3e7cac","#38659f","#02aff0","#00b4ac","#d56c9a"];var n=0;var a="";for(var o=0;o<t.length;o++){if(t[o].classList.contains("intranet-contact-item-selected")){var s=t[o].querySelector(".intranet-contact-logo");if(s&&s.classList.contains("ui-icon-service-common")){a=i[n];n=n<i.length-1?n+1:0}else{a=""}this.setBlockColor(t[o],a)}}},setBlockColor:function(e,t){e=BX(e);var i=e.querySelector(".intranet-contact-logo i");if(i){if(t!==""){e.style.backgroundColor=t;i.style.backgroundColor=t}else{var n=getComputedStyle(i);e.style.backgroundColor=n.backgroundColor}}},setBlockImage:function(e,t){e=BX(e);var i=e.querySelector(".intranet-contact-logo i");if(i){if(!!t){e.style.backgroundImage=color;i.style.backgroundImage=color}}}};BX.ContactCenter.Init=function(e){var t=new BX.ContactCenter.Appearance(e);var i=new BX.ContactCenter.Ajax(e,t)};BX.ContactCenter.MarketplaceApp=function(e,t){this.openRestAppLayout(e,t)};BX.ContactCenter.MarketplaceApp.prototype={openRestAppLayout:function(e,t){BX.ajax.runComponentAction("bitrix:intranet.contact_center.list","getRestApp",{mode:"class",data:{code:t}}).then(function(i){if(i.data.TYPE==="A"){this.showRestApplication(t)}else{BX.rest.AppLayout.openApplication(e)}})},showRestApplication:function(e){var t="/marketplace/detail/#app#/";var i=t.replace("#app#",encodeURIComponent(e));BX.SidePanel.Instance.open(i,{allowChangeHistory:false})}}})();
//# sourceMappingURL=script.map.js