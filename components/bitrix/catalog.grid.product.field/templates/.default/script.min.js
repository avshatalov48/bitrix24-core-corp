(function(e,t,r,n){"use strict";function i(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,s=false,l;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();o=t.done;return t},e:function e(t){s=true;l=t},f:function e(){try{if(!o&&r["return"]!=null)r["return"]()}finally{if(s)throw l}}}}function a(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=new Map;var l=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function e(t){return s.get(t)||null}}]);function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"onSelectEditHandler",this.onSelectEdit.bind(this));babelHelpers.defineProperty(this,"onCancelEditHandler",this.onCancelEdit.bind(this));babelHelpers.defineProperty(this,"onBeforeGridRequestHandler",this.onBeforeGridRequest.bind(this));babelHelpers.defineProperty(this,"onUnsubscribeEventsHandler",this.unsubscribeEvents.bind(this));babelHelpers.defineProperty(this,"onSkuLoadedHandler",this.onSkuLoaded.bind(this));babelHelpers.defineProperty(this,"onGridUpdateHandler",this.onGridUpdate.bind(this));this.selector=new n.ProductSelector(t,r);this.columnName=r.columnName||"CATALOG_PRODUCT";this.componentName=r.componentName||"";this.signedParameters=r.signedParameters||"";this.rowIdMask=r.rowIdMask||"#ID#";this.subscribeEvents();s.set(t,this)}babelHelpers.createClass(e,[{key:"subscribeEvents",value:function e(){r.EventEmitter.incrementMaxListeners("Grid::thereEditedRows",1);r.EventEmitter.incrementMaxListeners("Grid::noEditedRows",1);r.EventEmitter.incrementMaxListeners("Grid::beforeRequest",1);r.EventEmitter.incrementMaxListeners("Grid::updated",1);r.EventEmitter.subscribe("Grid::thereEditedRows",this.onSelectEditHandler);r.EventEmitter.subscribe("Grid::noEditedRows",this.onCancelEditHandler);r.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.subscribe("Grid::updated",this.onGridUpdateHandler);r.EventEmitter.subscribe("BX.Catalog.SkuTree::onSkuLoaded",this.onSkuLoadedHandler);r.EventEmitter.subscribeOnce(this.selector,"onBeforeChange",this.onUnsubscribeEventsHandler)}},{key:"unsubscribeEvents",value:function e(){r.EventEmitter.unsubscribe("Grid::thereEditedRows",this.onSelectEditHandler);r.EventEmitter.unsubscribe("Grid::noEditedRows",this.onCancelEditHandler);r.EventEmitter.unsubscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.unsubscribe("Grid::updated",this.onUnsubscribeEventsHandler);r.EventEmitter.unsubscribe("BX.Catalog.SkuTree::onSkuLoaded",this.onSkuLoadedHandler);this.selector.unsubscribeEvents()}},{key:"onSkuLoaded",value:function e(r){var n=document.getElementById(r.data.id).closest(".main-grid-row.main-grid-row-body");if(!n||!n.querySelectorAll(".main-grid-fixed-column")||n.style.height){return}var i=babelHelpers.toConsumableArray(n.querySelectorAll(".main-grid-cell"));if(i.length===0){return}var a=Math.max.apply(Math,babelHelpers.toConsumableArray(i.map((function(e){return parseInt(t.Dom.style(e,"height"),10)}))));if(!a){return}t.Dom.style(n,"height","".concat(a,"px"))}},{key:"onGridUpdate",value:function e(){setTimeout((function(){document.querySelectorAll(".main-grid-row.main-grid-row-body").forEach((function(e){if(e.style.height){return}var r=babelHelpers.toConsumableArray(e.querySelectorAll(".main-grid-cell"));if(r.length===0){return}var n=Math.max.apply(Math,babelHelpers.toConsumableArray(r.map((function(e){return parseInt(t.Dom.style(e,"height"),10)}))));if(!n){return}t.Dom.style(e,"height","".concat(n,"px"))}))}),0);this.onUnsubscribeEventsHandler()}},{key:"getSelector",value:function e(){return this.selector}},{key:"onBeforeGridRequest",value:function e(t){var r=this.getSelector().getWrapper();if(!r){return}var n=t.getData(),a=babelHelpers.slicedToArray(n,2),o=a[1];var s=BX.prop.get(o,"data",{});if(!s.FIELDS){return}var l=this.getSelector().getModel().getProductId();l=this.rowIdMask.replace("#ID#",l);s.FIELDS[l]=s.FIELDS[l]||{};var u=r.querySelector(".ui-image-input-container");if(u){var d=u.querySelectorAll("input");var c={};var b=new RegExp(/([0-9A-Za-z_]+?(_n\d+)*)\[([A-Za-z_]+)\]/);var f=i(d),h;try{for(f.s();!(h=f.n()).done;){var g=h.value;if(b.test(g.name)){var E=g.name.match(b),m=babelHelpers.slicedToArray(E,4),v=m[1],y=m[2],p=m[3];if(v&&p){c[v]=c[v]||{};c[v][p]=g.value}}else{c[g.name]=g.value}}}catch(e){f.e(e)}finally{f.f()}s.FIELDS[l]=s.FIELDS[l]||{};if(Object.keys(c).length>0){s.FIELDS[l]["MORE_PHOTO"]=c}}var S=r.querySelector('input[name="NAME"]');if(S){s.FIELDS[l]["NAME"]=S.value}}},{key:"onCancelEdit",value:function r(){this.getSelector().setMode(BX.Catalog.ProductSelector.MODE_VIEW);this.getSelector().clearLayout();this.getSelector().layout();var n=BX.Main.gridManager.getInstanceById(this.getSelector().getConfig("GRID_ID"));if(!n){return}var i=n.getRows().getById(this.selector.getConfig("ROW_ID"));if(!i){return}var a=i.getCellById(this.columnName);if(a){t.Dom.removeClass(i.getContentContainer(a),e.EDIT_CLASS)}}},{key:"onSelectEdit",value:function r(){if(!this.getSelector().getConfig("GRID_ID",null)){return}var n=BX.Main.gridManager.getInstanceById(this.getSelector().getConfig("GRID_ID"));if(!n){return}var i=n.getRows().getById(this.selector.getConfig("ROW_ID"));if(i&&i.isEdit()){this.getSelector().setMode(BX.Catalog.ProductSelector.MODE_EDIT);this.getSelector().clearLayout();this.getSelector().layout();var a=i.getCellById(this.columnName);if(a){t.Dom.addClass(i.getContentContainer(a),e.EDIT_CLASS)}}}}]);return e}();babelHelpers.defineProperty(l,"EDIT_CLASS","catalog-grid-product-field-edit");babelHelpers.defineProperty(l,"PRODUCT_MODE","product");babelHelpers.defineProperty(l,"SKU_MODE","sku");t.Reflection.namespace("BX.Catalog.Grid").ProductField=l})(this.window=this.window||{},BX,BX.Event,BX.Catalog);
//# sourceMappingURL=script.map.js