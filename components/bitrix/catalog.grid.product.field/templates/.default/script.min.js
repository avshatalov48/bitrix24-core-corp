(function(e,t,r,n){"use strict";function i(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,l;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();a=t.done;return t},e:function e(t){o=true;l=t},f:function e(){try{if(!a&&r["return"]!=null)r["return"]()}finally{if(o)throw l}}}}function s(e,t){if(!e)return;if(typeof e==="string")return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}function a(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=new Map;var l=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function e(t){return o.get(t)||null}}]);function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"onSelectEditHandler",this.onSelectEdit.bind(this));babelHelpers.defineProperty(this,"onCancelEditHandler",this.onCancelEdit.bind(this));babelHelpers.defineProperty(this,"onBeforeGridRequestHandler",this.onBeforeGridRequest.bind(this));babelHelpers.defineProperty(this,"onUnsubscribeEventsHandler",this.unsubscribeEvents.bind(this));this.selector=new n.ProductSelector(t,r);this.columnName=r.columnName||"CATALOG_PRODUCT";this.componentName=r.componentName||"";this.signedParameters=r.signedParameters||"";this.rowIdMask=r.rowIdMask||"#ID#";this.subscribeEvents();o.set(t,this)}babelHelpers.createClass(e,[{key:"subscribeEvents",value:function e(){r.EventEmitter.incrementMaxListeners("Grid::thereEditedRows",1);r.EventEmitter.incrementMaxListeners("Grid::noEditedRows",1);r.EventEmitter.incrementMaxListeners("Grid::beforeRequest",1);r.EventEmitter.incrementMaxListeners("Grid::updated",1);r.EventEmitter.subscribe("Grid::thereEditedRows",this.onSelectEditHandler);r.EventEmitter.subscribe("Grid::noEditedRows",this.onCancelEditHandler);r.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.subscribe("Grid::updated",this.onUnsubscribeEventsHandler);r.EventEmitter.subscribeOnce(this.selector,"onBeforeChange",this.onUnsubscribeEventsHandler)}},{key:"unsubscribeEvents",value:function e(){r.EventEmitter.unsubscribe("Grid::thereEditedRows",this.onSelectEditHandler);r.EventEmitter.unsubscribe("Grid::noEditedRows",this.onCancelEditHandler);r.EventEmitter.unsubscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);r.EventEmitter.unsubscribe("Grid::updated",this.onUnsubscribeEventsHandler);this.selector.unsubscribeEvents()}},{key:"getSelector",value:function e(){return this.selector}},{key:"onBeforeGridRequest",value:function e(t){var r=this.getSelector().getWrapper();if(!r){return}var n=t.getData(),s=babelHelpers.slicedToArray(n,2),a=s[1];var o=BX.prop.get(a,"data",{});if(!o.FIELDS){return}var l=this.getSelector().getModel().getProductId();l=this.rowIdMask.replace("#ID#",l);o.FIELDS[l]=o.FIELDS[l]||{};var u=r.querySelector(".ui-image-input-container");if(u){var c=u.querySelectorAll("input");var d={};var f=new RegExp(/([0-9A-Za-z_]+?(_n\d+)*)\[([A-Za-z_]+)\]/);var b=i(c),E;try{for(b.s();!(E=b.n()).done;){var h=E.value;if(f.test(h.name)){var v=h.name.match(f),g=babelHelpers.slicedToArray(v,4),m=g[1],y=g[2],p=g[3];if(m&&p){d[m]=d[m]||{};d[m][p]=h.value}}else{d[h.name]=h.value}}}catch(e){b.e(e)}finally{b.f()}o.FIELDS[l]=o.FIELDS[l]||{};if(Object.keys(d).length>0){o.FIELDS[l]["MORE_PHOTO"]=d}}var S=r.querySelector('input[name="NAME"]');if(S){o.FIELDS[l]["NAME"]=S.value}}},{key:"onCancelEdit",value:function r(){this.getSelector().setMode(BX.Catalog.ProductSelector.MODE_VIEW);this.getSelector().clearLayout();this.getSelector().layout();var n=BX.Main.gridManager.getInstanceById(this.getSelector().getConfig("GRID_ID"));if(!n){return}var i=n.getRows().getById(this.selector.getConfig("ROW_ID"));if(!i){return}var s=i.getCellById(this.columnName);if(s){t.Dom.removeClass(i.getContentContainer(s),e.EDIT_CLASS)}}},{key:"onSelectEdit",value:function r(){if(!this.getSelector().getConfig("GRID_ID",null)){return}var n=BX.Main.gridManager.getInstanceById(this.getSelector().getConfig("GRID_ID"));if(!n){return}var i=n.getRows().getById(this.selector.getConfig("ROW_ID"));if(i&&i.isEdit()){this.getSelector().setMode(BX.Catalog.ProductSelector.MODE_EDIT);this.getSelector().clearLayout();this.getSelector().layout();var s=i.getCellById(this.columnName);if(s){t.Dom.addClass(i.getContentContainer(s),e.EDIT_CLASS)}}}}]);return e}();babelHelpers.defineProperty(l,"EDIT_CLASS","catalog-grid-product-field-edit");babelHelpers.defineProperty(l,"PRODUCT_MODE","product");babelHelpers.defineProperty(l,"SKU_MODE","sku");t.Reflection.namespace("BX.Catalog.Grid").ProductField=l})(this.window=this.window||{},BX,BX.Event,BX.Catalog);
//# sourceMappingURL=script.map.js