{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Dom, Event, Reflection, Type, Text, Loc } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Mode, Session } from 'bizproc.debugger';\nimport { Button, ButtonColor, ButtonSize } from 'ui.buttons';\nimport './css/style.css';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\nclass DebuggerStartComponent\n{\n\t#documentSigned: string = '';\n\t#activeSession: Session | null = null;\n\t#currentUserId: number = null;\n\n\tconstructor(options)\n\t{\n\t\tthis.#documentSigned = options.documentSigned;\n\t\tthis.#activeSession = options.activeSession ? new Session(options.activeSession) : null;\n\t\tthis.#currentUserId = Text.toInteger(options.currentUserId);\n\t}\n\n\tinit()\n\t{\n\t\tif (this.#activeSession)\n\t\t{\n\t\t\tthis.#disableButtons();\n\t\t\tthis.#setActiveSessionHint();\n\n\t\t\tif (this.#currentUserId === this.#activeSession.startedBy)\n\t\t\t{\n\t\t\t\tthis.#renderFinishSessionButton();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initEvents();\n\t\t}\n\t}\n\n\tget buttons(): Object\n\t{\n\t\tconst buttons = {};\n\t\tbuttons[Mode.experimental.id] = document.getElementById('bizproc-debugger-start-experimental-element');\n\t\tbuttons[Mode.interception.id] = document.getElementById('bizproc-debugger-start-interception-element');\n\n\t\treturn buttons;\n\t}\n\n\t#disableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.addClass(buttons[key], 'ui-btn-disabled');\n\t\t});\n\t}\n\n\t#enableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.removeClass(buttons[key], 'ui-btn-disabled');\n\t\t\tDom.attr(buttons[key], 'disabled', null);\n\t\t});\n\t}\n\n\t#setActiveSessionHint()\n\t{\n\t\tif (!this.#activeSession)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.attr(buttons[key], 'data-hint', Text.encode(this.#activeSession.shortDescription));\n\t\t\tDom.attr(buttons[key], 'data-hint-no-icon', 'y');\n\n\t\t\tBX.UI.Hint.init(BX(buttons[key].id).parentElement);\n\t\t});\n\t}\n\n\t#renderFinishSessionButton()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tconst mode = this.#activeSession.modeId;\n\n\t\tif (buttons[mode])\n\t\t{\n\t\t\tconst buttonId = buttons[mode].id;\n\n\t\t\tconst button = new Button({\n\t\t\t\tprops: {\n\t\t\t\t\tid: buttonId,\n\t\t\t\t},\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_DEBUGGER_START_TEMPLATE_FINISH'),\n\t\t\t\tround: true,\n\t\t\t\tonclick: this.#onFinishSessionClick.bind(this),\n\t\t\t});\n\n\t\t\tDom.replace(buttons[mode], (button).render());\n\t\t}\n\t}\n\n\t#initEvents()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tEvent.bind(buttons[key], 'click', () => {\n\t\t\t\tthis.#onStartSessionClick(buttons[key], key);\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStartSessionClick(btn: HTMLButtonElement, modeId: number)\n\t{\n\t\ttop.BX.Runtime.loadExtension('bizproc.debugger')\n\t\t\t.then((exports) => {\n\t\t\t\tthis.#disableButtons();\n\t\t\t\tDom.addClass(btn, 'ui-btn-wait');\n\n\t\t\t\tconst {Manager} = exports;\n\t\t\t\tManager.Instance.startSession(this.#documentSigned, Text.toInteger(modeId))\n\t\t\t\t\t.then(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\tBX.SidePanel.Instance.closeAll();\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\t\t\tDom.removeClass(btn, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t)\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t}\n\n\t#onFinishSessionClick(button: Button)\n\t{\n\t\tbutton.setDisabled(true);\n\t\tbutton.setWaiting(true);\n\n\t\tif (top.BX.Bizproc.Debugger)\n\t\t{\n\t\t\ttop.BX.Bizproc.Debugger.Manager.Instance.askFinishSession(this.#activeSession)\n\t\t\t\t.then(\n\t\t\t\t\tthis.#onAfterFinishSession.bind(this),\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tbutton.setDisabled(false);\n\t\t\t\t\t\t\t\tbutton.setWaiting(false);\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#activeSession.finish()\n\t\t\t\t.then(\n\t\t\t\t\tthis.#onAfterFinishSession.bind(this),\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tbutton.setDisabled(false);\n\t\t\t\t\t\t\t\tbutton.setWaiting(false);\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t;\n\t\t}\n\t}\n\n\t#onAfterFinishSession()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tconst mode = this.#activeSession.modeId;\n\t\tconst buttonId = buttons[mode].id;\n\n\t\tthis.#enableButtons();\n\t\tthis.#activeSession = null;\n\n\t\tDom.replace(\n\t\t\tbuttons[mode],\n\t\t\t(new Button({\n\t\t\t\tprops: {\n\t\t\t\t\tid: buttonId,\n\t\t\t\t},\n\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_DEBUGGER_START_TEMPLATE_START'),\n\t\t\t\tround: true,\n\t\t\t})).render()\n\t\t);\n\n\t\tthis.init();\n\t}\n\n\t#reject(response, callback: Function)\n\t{\n\t\tif (Type.isArrayFilled(response.errors))\n\t\t{\n\t\t\tlet message = '';\n\t\t\tresponse.errors.forEach((error)=>{\n\t\t\t\tmessage = message + '\\n' + error.message;\n\t\t\t});\n\n\t\t\tMessageBox.alert(message, callback);\n\t\t}\n\t\telse if (Type.isFunction(callback))\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t}\n}\n\nnamespace.DebuggerStartComponent = DebuggerStartComponent;"],"names":["namespace","Reflection","DebuggerStartComponent","options","documentSigned","activeSession","Session","Text","toInteger","currentUserId","startedBy","buttons","Mode","experimental","id","document","getElementById","interception","Object","keys","forEach","key","Dom","addClass","removeClass","attr","encode","shortDescription","BX","UI","Hint","init","parentElement","mode","modeId","buttonId","button","Button","props","color","ButtonColor","LIGHT_BORDER","size","ButtonSize","SMALL","text","Loc","getMessage","round","onclick","bind","replace","render","Event","btn","top","Runtime","loadExtension","then","exports","Manager","Instance","startSession","SidePanel","closeAll","response","setDisabled","setWaiting","Bizproc","Debugger","askFinishSession","finish","SUCCESS","callback","Type","isArrayFilled","errors","message","error","MessageBox","alert","isFunction"],"mappings":"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"}