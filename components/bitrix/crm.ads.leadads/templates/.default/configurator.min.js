if(typeof CrmAdsLeadAds==="undefined"){CrmAdsLeadAds=function(t){this.containerId=t.containerId||"crm-robot-ads-container-"+t.provider.TYPE;this.provider=t.provider;this.context=t.context;this.onRequest=t.onRequest;this.mess=t.mess;this.mess=t.mess;if(t.destroyEventName){BX.addCustomEvent(window,t.destroyEventName,BX.proxy(function(){this.unbindAll();this.cleanInstances()},this))}this.data=t.data;this.accountId=t.accountId;this.formId=t.formId;this.crmFormId=t.crmFormId;this.actionRequestUrl=t.actionRequestUrl;this.hasForms=false;this.loaded=[];this.init();this.showBlockByAuth();BX.UI.Hint.init(this.context)};CrmAdsLeadAds.prototype={instances:[],attrBlocked:"data-blocked",cleanInstances:function(){for(var t=0,e=this.instances.length;t<e;t++){if(!this.instances[t]){continue}this.instances[t].unbindAll();delete this.instances[t];this.instances[t]=null}},unbindAll:function(){BX.removeCustomEvent(window,"seo-client-auth-result",BX.proxy(this.onSeoAuth,this))},init:function(){this.cleanInstances();this.instances.push(this);this.containerNode=BX(this.containerId);if(!this.containerNode){this.containerNode=BX.create("div");this.containerNode.id=this.containerId}this.insertTemplateIntoNode("settings",this.containerNode);this.uiNodes={avatar:this.containerNode.querySelector("[data-bx-ads-auth-avatar]"),name:this.containerNode.querySelector("[data-bx-ads-auth-name]"),link:this.containerNode.querySelector("[data-bx-ads-auth-link]"),logout:this.containerNode.querySelector("[data-bx-ads-auth-logout]"),account:this.containerNode.querySelector("[data-bx-ads-account]"),groupReg:this.containerNode.querySelector("[data-bx-ads-group-reg]"),groupLogout:this.containerNode.querySelector("[data-bx-ads-group-logout]"),accountLoader:this.containerNode.querySelector("[data-bx-ads-account-loader]"),formName:this.containerNode.querySelector("[data-bx-ads-form-name]"),formLocale:this.containerNode.querySelector("[data-bx-ads-form-locale]"),formSuccessUrl:this.containerNode.querySelector("[data-bx-ads-form-url]"),exportButton:this.containerNode.querySelector("[data-bx-ads-btn-export]"),exportHint:this.containerNode.querySelector("[data-bx-ads-btn-hint]"),exportDate:this.containerNode.querySelector("[data-bx-ads-btn-date]"),formIdNode:this.containerNode.querySelector("[data-bx-ads-form-id]"),form:[],errorNotFound:this.containerNode.querySelector("[data-bx-ads-account-not-found]"),refreshButton:this.containerNode.querySelector("[data-bx-ads-refresh-btn]"),createLinks:BX.convert.nodeListToArray(this.containerNode.querySelectorAll("[data-bx-ads-audience-create-link]")),autoRemover:{node:this.containerNode.querySelector("[data-bx-ads-audience-auto-remove]"),checker:this.containerNode.querySelector("[data-bx-ads-audience-auto-remove-checker]"),select:this.containerNode.querySelector("[data-bx-ads-audience-auto-remove-select]")}};this.uiNodes.createLinks.forEach(function(t){BX.bind(t,"click",BX.proxy(function(){if(!this.hasForms)this.showBlockRefresh()},this))},this);BX.bind(this.uiNodes.refreshButton,"click",BX.proxy(function(){this.getProvider()},this));if(this.uiNodes.exportButton){BX.bind(this.uiNodes.exportButton,"click",this.onButtonClick.bind(this));this.btnState.init(this)}if(this.uiNodes.groupReg){BX.bind(this.uiNodes.groupReg,"click",this.registerGroup.bind(this))}if(this.uiNodes.groupLogout){BX.bind(this.uiNodes.groupLogout,"click",this.logoutGroup.bind(this))}this.loader.init(this);BX.bind(this.uiNodes.logout,"click",BX.proxy(this.logout,this));this.listenSeoAuth()},showBlockByAuth:function(){if(this.provider.HAS_AUTH){this.showBlockMain()}else{this.showBlockLogin()}},listenSeoAuth:function(){BX.addCustomEvent(window,"seo-client-auth-result",BX.proxy(this.onSeoAuth,this))},onSeoAuth:function(t){t.reload=false;this.reload()},reload:function(){window.location.reload()},logout:function(){this.showBlock("loading");this.request("logout",{},BX.delegate(function(t){this.provider=t;this.showBlockByAuth()},this))},logoutGroup:function(){this.showBlock("loading");this.request("logoutGroup",{groupId:this.uiNodes.account.value},BX.delegate(function(){this.reload()},this))},registerGroup:function(){var t=BX.util.popup("",800,600);var e={type:this.provider.TYPE,accountId:this.uiNodes.account.value,groupId:this.uiNodes.account.value};this.request("registerGroup",e,function(e){t.location=e["groupAuthUrl"]})},getProvider:function(){this.showBlock("loading");this.request("getProvider",{},BX.delegate(function(t){this.provider=t;this.showBlockByAuth()},this))},onButtonClick:function(){if(this.btnState.isStateExport()){this.exportForm()}else{this.unlinkForm()}},exportForm:function(){this.btnState.setWaiting();var t={type:this.provider.TYPE,accountId:this.uiNodes.account.value,crmFormId:this.crmFormId,accountName:this.uiNodes.account.options[this.uiNodes.account.selectedIndex].text,crmFormName:this.uiNodes.formName.value,crmFormSuccessUrl:this.uiNodes.formSuccessUrl.value,formLocale:this.uiNodes.formLocale?this.uiNodes.formLocale.value:null};this.request("exportForm",t,this.btnState.animate.bind(this.btnState),this.btnState.setReadyToExport.bind(this.btnState))},unlinkForm:function(){this.btnState.setWaiting();var t={type:this.provider.TYPE,crmFormId:this.crmFormId};this.request("unlinkForm",t,this.btnState.animate.bind(this.btnState),this.btnState.setReadyToUnlink.bind(this.btnState))},btnState:{caller:null,btn:null,hint:null,date:null,attrState:"data-bx-state",attrTextSend:"data-bx-text-send",attrTextUnlink:"data-bx-text-disconnect",attrTextSuccess:"data-bx-text-success",attrDateTextNow:"data-bx-text-now",attrHintEnabled:"data-bx-text-enabled",attrHintDisabled:"data-bx-text-disabled",classNameWait:"ui-btn-wait",classNameSend:"ui-btn-primary",init:function(t){this.caller=t;this.btn=this.caller.uiNodes.exportButton;this.hint=this.caller.uiNodes.exportHint;this.date=this.caller.uiNodes.exportDate;this.formIdNode=this.caller.uiNodes.formIdNode;if(this.isStateExport()){this.setReadyToExport()}else{this.setReadyToUnlink()}},isStateExport:function(){return!this.btn.getAttribute(this.attrState)},setState:function(t){this.btn.setAttribute(this.attrState,t?"":"1");this.changeFieldsEnable()},setText:function(t,e){t.innerText=e?t.getAttribute(e):""},changeFieldsEnable:function(){var t=!this.isStateExport();var e=this.caller.uiNodes.account.hasAttribute(this.caller.attrBlocked);this.caller.uiNodes.account.disabled=e?true:t;this.caller.uiNodes.formName.disabled=t;this.caller.uiNodes.formSuccessUrl.disabled=t},setWaiting:function(){BX.removeClass(this.btn,this.classNameSend);BX.addClass(this.btn,this.classNameWait);this.setText(this.hint,null);this.setText(this.date,null);this.formIdNode.style.display="none"},removeWaiting:function(){BX.removeClass(this.btn,this.classNameWait)},setSuccess:function(){this.removeWaiting();this.setText(this.btn,this.attrTextSuccess)},setReadyToExport:function(){this.removeWaiting();this.setText(this.btn,this.attrTextSend);this.setText(this.hint,this.attrHintEnabled);this.setText(this.date,null);BX.addClass(this.btn,this.classNameSend);this.formIdNode.style.display="none";this.setState(true)},setReadyToUnlink:function(){this.removeWaiting();this.setText(this.btn,this.attrTextUnlink);this.setText(this.hint,this.attrHintDisabled);if(!this.date.innerText){this.setText(this.date,this.attrDateTextNow)}BX.removeClass(this.btn,this.classNameSend);this.formIdNode.style.display="";this.setState(false)},animate:function(){this.setSuccess();setTimeout(this.animateFinal.bind(this),1e3)},animateFinal:function(){this.setWaiting();var t=this.isStateExport()?this.setReadyToUnlink:this.setReadyToExport;setTimeout(t.bind(this),300)}},showBlock:function(t){t=BX.type.isArray(t)?t:[t];var e="data-bx-ads-block";var i=this.containerNode.querySelectorAll("["+e+"]");i=BX.convert.nodeListToArray(i);i.forEach(function(i){var s=i.getAttribute(e);var o=BX.util.in_array(s,t);i.style.display=o?"block":"none"},this)},showBlockRefresh:function(){this.showBlock(["auth","refresh"])},showBlockLogin:function(){this.showBlock("login")},showBlockMain:function(){if(this.uiNodes.avatar){this.uiNodes.avatar.style["background-image"]="url("+this.provider.PROFILE.PICTURE+")"}if(this.uiNodes.name){this.uiNodes.name.innerText=this.provider.PROFILE.NAME}if(this.uiNodes.link){if(this.provider.PROFILE.LINK){this.uiNodes.link.href=this.provider.PROFILE.LINK}else{this.uiNodes.link.removeAttribute("href")}}this.showBlock(["auth","main"]);this.loadSettings()},insertTemplateIntoNode:function(t,e,i){i=i||false;var s="template-crm-ads-dlg-"+t;var o=s+"-"+this.provider.TYPE;var n=BX(o);if(!n){n=BX(s)}var a=BX.create("div");a.innerHTML=n.innerHTML;if(!i){e.innerHTML=""}var r=BX.convert.nodeListToArray(a.children);r.forEach(function(t){e.appendChild(t)})},onResponse:function(t,e){if(!t.errors||t.errors.length==0){e.apply(this,[t.data])}},request:function(t,e,i,s){e.action=t;e.type=this.provider.TYPE;var o=function(t,e){this.showErrorPopup(e);if(t){t.apply(this,[e])}};if(this.onRequest){var n=[e,BX.delegate(function(t){this.onResponse(t,i)},this),o.bind(this,s)];this.onRequest.apply(this,n)}else{this.sendActionRequest(t,e,function(t){this.onResponse(t,i)},o.bind(this,s))}},sendActionRequest:function(t,e,i,s){i=i||null;s=s||BX.proxy(this.showErrorPopup,this);e=e||e;e.sessid=BX.bitrix_sessid();BX.ajax({url:this.actionRequestUrl,method:"POST",data:e,timeout:30,dataType:"json",processData:true,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){s.apply(this,[t])}else if(i){i.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};s.apply(this,[t])},this)})},showErrorPopup:function(t){t=t||{};var e=t.text||this.mess.errorAction;var i=BX.PopupWindowManager.getCurrentPopup();var s=function(t,e){t.close();if(e){e.show()}};var o=BX.PopupWindowManager.create("crm_ads_forms_error",null,{autoHide:true,lightShadow:true,closeByEsc:true,overlay:{backgroundColor:"black",opacity:500}});o.setButtons([new BX.PopupWindowButton({text:this.mess.dlgBtnClose,events:{click:s.bind(this,o,i)}})]);o.setContent('<span class="crm-ads-forms-warning-alert">'+e+"</span>");o.show()},loader:{init:function(t){this.caller=t},change:function(t,e,i){t.style.display=i?"":"none";if(e){var s=e.options.length==0||i;if(!s&&!this.caller.btnState.isStateExport()){s=true}var o=e.hasAttribute(this.caller.attrBlocked);e.disabled=o?true:s}},forAccount:function(t){this.change(this.caller.uiNodes.accountLoader,this.caller.uiNodes.account,t);this.change(this.caller.uiNodes.exportButton,null,!t)},forForms:function(t,e){this.caller.uiNodes.form.forEach(function(t){this.change(t.loader,t.node,e)},this);if(this.caller.uiNodes.autoRemover.node){this.caller.uiNodes.autoRemover.node.style.display=e?"none":""}}},loadSettings:function(){var t=this.provider.TYPE;if(BX.util.in_array(t,this.loaded))return;this.loaded.push(t);this.loadSettingsAccounts()},loadSettingsAccounts:function(){this.loader.forAccount(true);this.request("getAccounts",{},BX.delegate(function(t){var e=t.map(function(t){return{caption:t.name,value:t.id,selected:t.id==this.accountId}},this);this.fillDropDownControl(this.uiNodes.account,e);this.loader.forAccount(false);if(e.length>0){BX.fireEvent(this.uiNodes.account,"change")}else{this.showErrorEmptyAccounts()}},this))},showErrorEmptyAccounts:function(){this.uiNodes.errorNotFound.style.display=this.hasForms?"none":""},fillDropDownControl:function(t,e){e=e||[];t.innerHTML="";e.forEach(function(e){if(!e||!e.caption){return}var i=document.createElement("option");i.value=e.value;i.selected=!!e.selected;i.innerText=e.caption;t.appendChild(i)})}}}
//# sourceMappingURL=configurator.map.js