(function(){"use strict";BX.namespace("BX.Crm.Buyer.Edit");BX.Crm.Buyer.Edit=function(e){this.params=e.params||{};this.signedParameters=e.signedParameters;this.componentName=e.componentName;this.bindEvents()};BX.Crm.Buyer.Edit.prototype={processSuccess:function(e){if(this.params.IFRAME){window.top.BX.SidePanel.Instance.postMessage(window,"OrderBuyerEdit::onSave",{});window.top.BX.SidePanel.Instance.getTopSlider().destroy()}else if(BX.type.isNotEmptyString(e.redirectUrl)){document.location.href=e.redirectUrl}},clearErrors:function(){BX.cleanNode(BX("bx-crm-error"))},fillErrors:function(e){var r=BX("bx-crm-error");var t="";e.forEach(function(e){t+='<div class="crm-entity-widget-content-error-text">'+e.message+"</div>"});r.innerHTML=t;BX.scrollToNode(r)},saveAction:function(e){var r=BX("crm-order-buyer-edit-wrapper");var t=BX.getEventTarget(e);BX.addClass(t,"ui-btn-clock");BX.ajax.runComponentAction(this.componentName,"saveFormAjax",{mode:"class",signedParameters:this.signedParameters,data:BX.ajax.prepareForm(r)}).then(function(e){BX.removeClass(t,"ui-btn-clock");this.clearErrors();this.processSuccess(e.data)}.bind(this)).catch(function(e){BX.removeClass(t,"ui-btn-clock");this.fillErrors(e.errors)}.bind(this))},closeSlider:function(){window.top.BX.SidePanel.Instance.close()},saveClickHandler:function(e){this.saveAction(e)},bindEvents:function(){BX.bind(BX("CRM_ORDER_BUYER_EDIT_APPLY_BUTTON"),"click",BX.proxy(this.saveClickHandler,this));BX.bind(BX("CRM_ORDER_BUYER_EDIT_SUBMIT_BUTTON"),"click",BX.proxy(this.saveClickHandler,this));BX.bind(BX("CRM_ORDER_BUYER_EDIT_CANCEL"),"click",BX.proxy(this.closeSlider,this))}}})();