"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetTagSelector!="undefined"){return}BX.Tasks.Component.TasksWidgetTagSelector=BX.Tasks.Component.extend({sys:{code:"tag-sel-is"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.subInstance("items",(function(){return new this.constructor.Items({scope:this.scope(),data:this.option("data"),preRendered:true})}))}}});BX.Tasks.Component.TasksWidgetTagSelector.Items=BX.Tasks.Util.ItemSet.extend({sys:{code:"tag-sel"},options:{controlBind:"class",itemFx:"horizontal",itemFxHoverDelete:true},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.ItemSet);this.preselectedItems=this.option("data")},openAddForm:function(t){this.getDialog(t).show()},getDialog:function(t){var e=function(){var e=document.querySelectorAll("div.task-options-item-open-inner");var i=t;e.forEach((function(t){if(t.contains(i)){i=t}}));return i}.bind(this);if(!this.dialog){this.dialog=new BX.UI.EntitySelector.Dialog({id:"tasks-widget-tag-selector-template-edit",targetNode:e(),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,entities:[{id:"template-tag",options:{},dynamicLoad:true,dynamicSearch:true}],selectedItems:this.preselectedItems.map((function(t){return{id:t.NAME,entityId:"template-tag",title:t.NAME,tabs:"all"}})),searchOptions:{allowCreateItem:true},events:{"Search:onItemCreateAsync":function(t){var e=new BX.Promise;var i=t.getData().searchQuery;var s=t.getTarget();setTimeout((function(){var t=s.addItem({id:i.getQuery(),entityId:"template-tag",title:i.getQuery(),tabs:"all"});if(t){t.select()}e.fulfill()}),1e3);return e},"Item:onSelect":this.onTagsChange.bind(this),"Item:onDeselect":this.onTagsChange.bind(this)}})}return this.dialog},onTagsChange:function(){var t=[];this.each((function(e){t.push(e.display())}));var e=this.getDialog().getSelectedItems().map((function(t){return t.getTitle()}));e.forEach(function(e){if(!BX.util.in_array(e,t)){this.addItem({NAME:e})}}.bind(this));this.each((function(t){if(!BX.util.in_array(t.display(),e)){this.deleteItem(t.value())}}))},onItemDeleteByCross:function(t){this.callMethod(BX.Tasks.Util.ItemSet,"onItemDeleteByCross",arguments);var e=t.data();this.deleteFromPreselected(e.VALUE.toString());this.deselectDialogItem(e)},deleteFromPreselected:function(t){var e=this.preselectedItems.findIndex(function(e){return this.extractItemValue(e)===t}.bind(this));if(e!==-1){this.preselectedItems.splice(e,1)}},deselectDialogItem:function(t){if(this.dialog){var e=this.getDialog().getItem(this.prepareDialogItems([t])[0]);e&&e.deselect()}},prepareDialogItems:function(t){return t.map(function(t){return["task-tag",this.extractItemDisplay(t)]}.bind(this))},extractItemDisplay:function(t){return t.NAME},extractItemValue:function(t){if("VALUE"in t){return t.VALUE}return Math.abs(this.hashCode(t.NAME))},hashCode:function(t){if(!BX.type.isNotEmptyString(t)){return 0}var e=0;for(var i=0;i<t.length;i++){var s=t.charCodeAt(i);if(s>255){s-=848}e=(e<<5)-e+s;e=e&e}return e}}})}).call(this);
//# sourceMappingURL=logic.map.js