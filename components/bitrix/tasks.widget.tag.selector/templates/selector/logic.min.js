"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetTagSelector!="undefined"){return}BX.Tasks.Component.TasksWidgetTagSelector=BX.Tasks.Component.extend({sys:{code:"tag-sel-is"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.subInstance("items",(function(){return new this.constructor.Items({scope:this.scope(),data:this.option("data"),groupId:this.option("groupId"),taskId:this.option("taskId"),isScrumTask:this.option("isScrumTask")==="Y",preRendered:true})}))}}});BX.Tasks.Component.TasksWidgetTagSelector.Items=BX.Tasks.Util.ItemSet.extend({sys:{code:"tag-sel"},options:{controlBind:"class",itemFx:"horizontal",itemFxHoverDelete:true,dialog:null,dialogCallback:true},methods:{bindEvents:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindEvents");this.bindDelegateControl("form-control","click",this.passCtx(this.openAddForm));BX.addCustomEvent(window,"onTaskTagSelectAlt",this.onTagsChange.bind(this));this.getTagSelector().load()},onTagsChange:function(t){var e=[];this.each((function(t){e.push(t.display())}));var s=this.getTagSelector().getItems();var o=[];for(var i=0;i<s.length;i++){var a=s[i];if(a.isSelected()){o.push(a.getId());if(!BX.util.in_array(a.getId(),e)){this.addItem({NAME:a.getId()})}}}this.each((function(t){if(!BX.util.in_array(t.display(),o)){this.deleteItem(t.value())}}))},openAddForm:function(t){this.getTagSelector().show()},onItemDeleteByCross:function(t){BX.onCustomEvent("onTaskTagDeleteByCross",[t.opts.data]);this.callMethod(BX.Tasks.Util.ItemSet,"onItemDeleteByCross",arguments);this.unselectDialogItem(t)},unselectDialogItem:function(t){var e=this.getTagSelector();if(!e){return}this.opts.dialogCallback=false;if(typeof t==="object"){t=t.data()}var s=e.getItem(this.prepareItemData(t));s&&s.deselect();this.opts.dialogCallback=true},prepareItemData:function(t){return["task-tag",t.NAME]},extractItemDisplay:function(t){return t.NAME},extractItemValue:function(t){if("VALUE"in t){return t.VALUE}return Math.abs(this.hashCode(t.NAME))},hashCode:function(t){if(!BX.type.isNotEmptyString(t)){return 0}var e=0;for(var s=0;s<t.length;s++){var o=t.charCodeAt(s);if(o>255){o-=848}e=(e<<5)-e+o;e=e&e}return e},getTagSelector:function(){if(!this.opts.dialog){this.opts.dialog=new BX.UI.EntitySelector.Dialog({id:"tasksTagSelector",targetNode:this.control("form-control"),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,context:this.option("isScrumTask")?"TASKS_SCRUM_TAG_"+this.option("groupId"):"TASKS_TAG",entities:[{id:"task-tag",options:{taskId:this.option("taskId"),groupId:this.option("isScrumTask")?this.option("groupId"):0}}],searchOptions:{allowCreateItem:true},events:{onShow:function(){}.bind(this),onHide:function(){}.bind(this),"Search:onItemCreateAsync":function(t){var e=new BX.Promise;var s=t.getData().searchQuery;var o=t.getTarget();setTimeout((function(){var t=o.addItem({id:s.getQuery(),entityId:"task-tag",title:s.getQuery(),tabs:"all"});if(t){t.select()}e.fulfill()}),1e3);return e},"Item:onSelect":function(t){if(this.opts.dialogCallback===false){return}this.onTagsChange(t)}.bind(this),"Item:onDeselect":function(t){if(this.opts.dialogCallback===false){return}this.onTagsChange(t)}.bind(this)}})}return this.opts.dialog}}})}).call(this);
//# sourceMappingURL=logic.map.js