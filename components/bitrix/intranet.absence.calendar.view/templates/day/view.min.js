function JCCalendarViewDay(t){this.ID="day";this._parent=null;this.SETTINGS={};this.ENTRIES=[];if(!window._DAY_STYLE_LOADED){BX.loadCSS("/bitrix/components/bitrix/intranet.absence.calendar.view/templates/day/view.css");window._DAY_STYLE_LOADED=true}BX.bind(window,"resize",BX.proxy(this.__onresize,this))}JCCalendarViewDay.prototype.__onresize=function(){this.UnloadData(true);this.__drawData()};JCCalendarViewDay.prototype.Load=function(){this._parent.FILTER.SHORT_EVENTS="Y";if(null!=this.ENTRIES&&this.ENTRIES.length>0)this.UnloadData();this.__drawLayout();this.TYPE_BGCOLORS=this._parent.TYPE_BGCOLORS;this._parent.LoadData(this.SETTINGS.DATE_START,this.SETTINGS.DATE_FINISH)};JCCalendarViewDay.prototype.LoadData=function(t){this.ENTRIES=t;if(BX.browser.IsIE()){setTimeout(BX.proxy(this.__drawData,this),10)}else{this.__drawData()}};JCCalendarViewDay.prototype.UnloadData=function(t){if(null==this.ENTRIES)return;if(null==t)t=false;for(var e=0;e<this.ENTRIES.length;e++){if(null!=this.ENTRIES[e].DATA){for(var T=0;T<this.ENTRIES[e].DATA.length;T++){if(null==this.ENTRIES[e].DATA[T].VISUAL)continue;this._parent.UnRegisterEntry(this.ENTRIES[e].DATA[T]);BX.cleanNode(this.ENTRIES[e].DATA[T].VISUAL,true);this.ENTRIES[e].DATA[T].VISUAL=null}}var a=document.getElementById("bx_calendar_user_"+this.ENTRIES[e]["ID"]);if(null!=a)a.parentNode.removeChild(a)}if(!t)this.ENTRIES=null};JCCalendarViewDay.prototype.SetSettings=function(t){this.SETTINGS=t;var e=new Date;if(null==this.SETTINGS.DATE_START||e>=this.SETTINGS.DATE_START&&e<=this.SETTINGS.DATE_FINISH)this.SETTINGS.DATE_START=e;this.SETTINGS.DATE_START.setHours(this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START);this.SETTINGS.DATE_START.setMinutes(0);this.SETTINGS.DATE_START.setSeconds(0);this.SETTINGS.DATE_START.setMilliseconds(0);this.SETTINGS.DATE_FINISH=new Date(this.SETTINGS.DATE_START.valueOf());this.SETTINGS.DATE_FINISH.setHours(this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH)};JCCalendarViewDay.prototype.Unload=function(){BX.unbind(window,"resize",BX.proxy(this.__onresize,this));this.UnloadData()};JCCalendarViewDay.prototype.changeDay=function(t){if(t!=-1)t=1;this.SETTINGS.DATE_START.setDate(this.SETTINGS.DATE_START.getDate()+t);this.SETTINGS.DATE_FINISH.setDate(this.SETTINGS.DATE_FINISH.getDate()+t);this.Load()};JCCalendarViewDay.prototype.__drawLayout=function(){var t=this;var e=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var T=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;this._parent.CONTROLS.CALENDAR.innerHTML="";this.obTable=document.createElement("TABLE");this.obTable.className="bx-calendar-day-main-table";this.obTable.setAttribute("cellSpacing","0");this._parent.CONTROLS.CALENDAR.appendChild(this.obTable);this.obTable.appendChild(document.createElement("TBODY"));var a=new Date(this.SETTINGS.DATE_FINISH.valueOf());a.setSeconds(a.getSeconds()-1);var i=this._parent.DAYS_FULL[this.SETTINGS.DATE_START.getDay()]+", "+this.SETTINGS.DATE_START.getDate()+" "+this._parent.MONTHS_R[this.SETTINGS.DATE_START.getMonth()]+" "+this.SETTINGS.DATE_START.getFullYear();this._parent.CONTROLS.DATEROW.innerHTML=this._parent.CONTROLS.DATEROW.innerHTML='<table class="bx-calendar-day-control-table" align="center"><tr>'+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-back"></a></td>'+"<td>"+i+"</td>"+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-fwd"></a></td>'+"</tr></table>";var s=this._parent.CONTROLS.DATEROW.getElementsByTagName("A");s[0].onclick=function(){t.changeDay(-1)};s[1].onclick=function(){t.changeDay(1)};this.obDelimRow=this.obTable.tBodies[0].insertRow(-1);this.obDelimRow.insertCell(-1);this.obDelimRow.cells[0].className="bx-calendar-day-empty";if(BX.browser.IsIE())this.obDelimRow.cells[0].innerHTML="&nbsp;";var E=new Date(this.SETTINGS.DATE_START.valueOf());var n=new Date;n.setMinutes(0);n.setSeconds(0);n.setMilliseconds(0);for(var S=e;S<T;S++){var r=this.obDelimRow.insertCell(-1);r.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(E.valueOf()==n.valueOf())r.className+=" bx-calendar-day-now";if(S<this.SETTINGS.DAY_START||S>=this.SETTINGS.DAY_FINISH)r.className+=" bx-calendar-day-hour-nonwork";var h=BX.isAmPmMode()?E.getHours()%12>0?E.getHours()%12:12:E.getHours();h+=BX.isAmPmMode()?E.getHours()<12?"am":"pm":"<sup>00</sup>";r.innerHTML=h;E.setHours(E.getHours()+1)}this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this.obPageBar=document.createElement("DIV");this.obPageBar.style.padding="10px 10px 3px";this.obPageBar.style.fontSize="0.95em";this._parent.CONTROLS.CALENDAR.appendChild(this.obPageBar);this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"))};JCCalendarViewDay.prototype.__drawData=function(){var t=this;var e=new Date;e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);var T=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var a=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;var i=this.SETTINGS.DATE_START;var s=new Date(this.SETTINGS.DATE_FINISH);s.setSeconds(s.getSeconds()-1);for(var E=0;E<(null==this.ENTRIES?0:this.ENTRIES.length);E++){for(var n=0;n<this.ENTRIES[E]["DATA"].length;n++){var S=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_TO"];if(i.valueOf()>r.valueOf()||s.valueOf()<S.valueOf()){this.ENTRIES[E]["DATA"].splice(n,1);n--}}if(this.ENTRIES[E]["DATA"].length==0&&!this._parent.FILTER.USERS_ALL){continue}var h=-1;if(null!=this.ENTRIES[E]["DATA"]&&this.ENTRIES[E]["DATA"].length>0){for(var n=0;n<this.ENTRIES[E]["DATA"].length;n++){var S=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_TO"];if(this.SETTINGS.DATE_START.valueOf()>=S.valueOf()&&this.SETTINGS.DATE_FINISH.valueOf()<=r.valueOf()+1e3){h=this.obDelimRow.rowIndex;break}}}var A=this.obTable.tBodies[0].insertRow(h);A.insertCell(-1);A.cells[0].className="bx-calendar-day-first-col";A.id="bx_calendar_user_"+this.ENTRIES[E]["ID"];var l=A.cells[0].appendChild(document.createElement("DIV"));var o=this._parent.FormatName(this.SETTINGS.NAME_TEMPLATE,this.ENTRIES[E]);l.title=o;if(this.ENTRIES[E]["DETAIL_URL"]){var N=document.createElement("A");N.appendChild(document.createTextNode(o));N.href=this.ENTRIES[E]["DETAIL_URL"]}else{var N=document.createTextNode(o)}l.appendChild(N);var I=new Date(this.SETTINGS.DATE_START.valueOf());for(var n=T;n<a;n++){var d=A.insertCell(-1);d.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(I.valueOf()==e.valueOf())d.className+=" bx-calendar-day-now";if(n<this.SETTINGS.DAY_START||n>=this.SETTINGS.DAY_FINISH)d.className+=" bx-calendar-day-hour-nonwork";if(BX.browser.IsIE())d.innerHTML="&nbsp;";I.setHours(I.getHours()+1)}}var D=2;for(var E=0;E<(null==this.ENTRIES?0:this.ENTRIES.length);E++){var _=BX("bx_calendar_user_"+this.ENTRIES[E]["ID"]);if(_&&this.ENTRIES[E]["DATA"]){var R=BX.pos(_,true);for(var n=0;n<this.ENTRIES[E]["DATA"].length;n++){var S=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][n]["DATE_ACTIVE_TO"];this.ENTRIES[E]["DATA"][n].VISUAL=document.createElement("DIV");this.ENTRIES[E]["DATA"][n].VISUAL.bx_color_variant=this.ENTRIES[E]["DATA"][n]["TYPE"].length?this.ENTRIES[E]["DATA"][n]["TYPE"]:"OTHER";this.ENTRIES[E]["DATA"][n].VISUAL.className="bx-calendar-entry bx-calendar-color-"+this.ENTRIES[E]["DATA"][n].VISUAL.bx_color_variant;this.ENTRIES[E]["DATA"][n].VISUAL.style.background=this.TYPE_BGCOLORS[this.ENTRIES[E]["DATA"][n]["TYPE"].length?this.ENTRIES[E]["DATA"][n]["TYPE"]:"OTHER"];this.ENTRIES[E]["DATA"][n].VISUAL.style.top=R.top+D+"px";if(i.valueOf()>S.valueOf())S=i;if(s.valueOf()<r.valueOf())r=s;var c=S.getHours()+1-T,u=r.getHours()+1-T;if(u<c)u=c;var p=_.cells[c],f=_.cells[u];var O=BX.pos(p,true),v=O.left+D;if(S.getMinutes()>40)v+=O.right-O.left;else if(S.getMinutes()>20)v+=Math.round((O.right-O.left)/2);if(p!=f)O=BX.pos(f,true);var G=O.left;if(r.getMinutes()>40)G=O.right;else if(r.getMinutes()>20)G+=Math.round((O.right-O.left)/2);var b=Math.abs(parseInt(G-v-D*2));if(isNaN(b)||b<5)b=5;this.ENTRIES[E]["DATA"][n].VISUAL.style.left=parseInt(v)+"px";this.ENTRIES[E]["DATA"][n].VISUAL.style.width=b+"px";this.ENTRIES[E]["DATA"][n].VISUAL.style.height=parseInt(O.height-2*D)+"px";this.ENTRIES[E]["DATA"][n].VISUAL.innerHTML="<nobr>"+BX.util.htmlspecialchars(this.ENTRIES[E]["DATA"][n]["NAME"])+" ("+this.ENTRIES[E]["DATA"][n]["DATE_FROM"]+" - "+this.ENTRIES[E]["DATA"][n]["DATE_TO"]+")"+"</nobr>";this.ENTRIES[E]["DATA"][n].VISUAL.__bx_user_id=this.ENTRIES[E]["ID"];this._parent.MAIN_LAYOUT.appendChild(this.ENTRIES[E]["DATA"][n].VISUAL);this._parent.RegisterEntry(this.ENTRIES[E].DATA[n])}}}if(this.SETTINGS.PAGE_COUNT>1||this.SETTINGS.PAGE_NUMBER>0){this.obPageBar.innerHTML=this._parent.MESSAGES.INTR_ABSC_TPL_PAGE_BAR+": ";for(var E=0;E<=this.SETTINGS.PAGE_NUMBER;E++){if(E==this.SETTINGS.PAGE_NUMBER){var C=document.createTextNode(E+1)}else{var C=document.createElement("A");C.href="javascript:void(0);";C.innerHTML=E+1;C.onclick=function(e){return function(){t.SETTINGS.PAGE_NUMBER=e;t.Load()}}(E)}this.obPageBar.appendChild(C);this.obPageBar.appendChild(document.createTextNode(" "));if(E==0&&this.SETTINGS.PAGE_NUMBER>=6){var C=document.createTextNode("...");this.obPageBar.appendChild(C);this.obPageBar.appendChild(document.createTextNode(" "));E=this.SETTINGS.PAGE_NUMBER-4}}if(this.SETTINGS.PAGE_COUNT-1>this.SETTINGS.PAGE_NUMBER){var C=document.createElement("A");C.href="javascript:void(0);";C.innerHTML=this._parent.MESSAGES.INTR_ABSC_TPL_PAGE_NEXT;C.onclick=function(){t.SETTINGS.PAGE_NUMBER+=1;t.Load()};this.obPageBar.appendChild(C)}}};