{"version":3,"file":"script.js","sources":["src/user-manager.js","src/base-command-handler.js","src/client-command-handler.js","src/server-command-handler.js","src/custom-error-controls.js","src/onlyoffice.js","src/waiting.js"],"sourcesContent":["import type {Context, User, UserManagerOptions} from \"./types\";\nimport {PULL} from \"pull.client\";\nimport {ajax as Ajax} from \"main.core\";\nimport {Users} from \"disk.users\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\n\nconst ALLOWED_ATTEMPTS_TO_GET_USER_INFO = 3;\nconst SECONDS_TO_ACTUALIZE_ONLINE = 25;\n\nexport default class UserManager\n{\n\tuserBoxNode: HTMLElement = null;\n\tcontext: Context = null\n\tusers: Users;\n\tbadAttempts: Map<number>;\n\talreadySaidHi: boolean = false;\n\n\tconstructor(options: UserManagerOptions)\n\t{\n\t\tthis.users = new BX.Disk.Users([]);\n\t\tthis.badAttempts = new Map();\n\t\tthis.context = options.context;\n\t\tthis.userBoxNode = options.userBoxNode;\n\t\tthis.alreadySaidHi = false;\n\t\tthis.add(this.context.currentUser);\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('onPullStatus', (event: BaseEvent) => {\n\t\t\tif (event.getData()[0] === 'online')\n\t\t\t{\n\t\t\t\tthis.handleWhenPullConnected();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleWhenPullConnected(): void\n\t{\n\t\tif (!this.sentGreetings())\n\t\t{\n\t\t\tthis.sendHiToUsers();\n\t\t\tsetInterval(this.actualizeOnline.bind(this), 1000*SECONDS_TO_ACTUALIZE_ONLINE);\n\t\t}\n\t}\n\n\tactualizeOnline(): void\n\t{\n\t\tthis.refineUsersByOnline();\n\t\tif (!this.sentGreetings())\n\t\t{\n\t\t\tthis.sendHiToUsers();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendPingToUsers();\n\t\t}\n\t}\n\n\tsentGreetings(): boolean\n\t{\n\t\treturn this.alreadySaidHi;\n\t}\n\n\tsendHiToUsers(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'hiToDocument', {\n\t\t\tuser: {\n\t\t\t\tid: this.context.currentUser.id,\n\t\t\t\tname: this.context.currentUser.name,\n\t\t\t\tavatar: this.#makeLinkAbsolute(this.context.currentUser.avatar),\n\t\t\t},\n\t\t});\n\n\t\tthis.alreadySaidHi = true;\n\t}\n\n\t#makeLinkAbsolute(link: string): string\n\t{\n\t\tif (link.includes('http://') || link.includes('https://'))\n\t\t{\n\t\t\treturn link;\n\t\t}\n\n\t\treturn document.location.origin + link;\n\t}\n\n\tsendWelcomeToUser(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'welcomeToDocument', {\n\t\t\tuser: {\n\t\t\t\tid: this.context.currentUser.id,\n\t\t\t\tname: this.context.currentUser.name,\n\t\t\t\tavatar: this.#makeLinkAbsolute(this.context.currentUser.avatar),\n\t\t\t},\n\t\t});\n\t}\n\n\tsendPingToUsers(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'pingDocument', {\n\t\t\tfromUserId: this.context.currentUser.id,\n\t\t\tinfoToken: this.context.currentUser.infoToken,\n\t\t});\n\t}\n\n\tadd(user: User): void\n\t{\n\t\tif (!this.users.hasUser(user.id))\n\t\t{\n\t\t\tthis.users.addUser(user);\n\n\t\t\tconsole.log('Hi new user!', user.id);\n\t\t}\n\n\t\tthis.updateOnline(user.id);\n\t\tthis.renderBox();\n\t}\n\n\tupdateOnline(userId: number): void\n\t{\n\t\tif (this.users.hasUser(userId))\n\t\t{\n\t\t\tthis.users.getUser(userId).onlineAt = Date.now();\n\t\t}\n\t}\n\n\tgetUserInfo(userId: number, infoToken: string): Promise\n\t{\n\t\tif (this.badAttempts.get(userId) >= ALLOWED_ATTEMPTS_TO_GET_USER_INFO)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\treject({\n\t\t\t\t\tstatus: 'blocked',\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runComponentAction('bitrix:disk.file.editor-onlyoffice', 'getUserInfo', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tjson: {\n\t\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tinfoToken: infoToken,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.status === 'success')\n\t\t\t\t{\n\t\t\t\t\tthis.badAttempts.delete(userId);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t}\n\t\t\t}, (response) => {\n\t\t\t\tconst attempts = this.badAttempts.get(userId) || 0;\n\t\t\t\tthis.badAttempts.set(userId, attempts + 1);\n\t\t\t\tconsole.log(this.badAttempts)\n\n\t\t\t\treject(response);\n\t\t\t});\n\t\t});\n\t}\n\n\thas(userId: number): boolean\n\t{\n\t\treturn this.users.hasUser(userId);\n\t}\n\n\tremove(userId: number): void\n\t{\n\t\tif (userId === this.context.currentUser.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.users.deleteUser(userId);\n\t\tthis.renderBox();\n\t}\n\n\trefineUsersByOnline(): void\n\t{\n\t\tconst secondsToOffline = 1000*(SECONDS_TO_ACTUALIZE_ONLINE+1)*2;\n\t\tconst now = Date.now();\n\n\t\tthis.users.forEach((user: User) => {\n\t\t\tif (now - user.onlineAt > secondsToOffline)\n\t\t\t{\n\t\t\t\tthis.remove(user.id);\n\t\t\t}\n\t\t})\n\t}\n\n\trenderBox(): void\n\t{\n\t\tif (!this.userBoxNode.childElementCount)\n\t\t{\n\t\t\tthis.userBoxNode.appendChild(this.users.getContainer());\n\t\t}\n\t}\n};","import {PullClient} from \"pull.client\";\nimport type {CommandOptions} from \"./types\";\nimport UserManager from \"./user-manager\";\nimport OnlyOffice from \"./onlyoffice\";\n\nexport default class BaseCommandHandler\n{\n\toptions: CommandOptions = null;\n\tonlyOffice: OnlyOffice = null;\n\tuserManager: UserManager = null;\n\n\tconstructor(commandOptions: CommandOptions)\n\t{\n\t\tthis.options = commandOptions;\n\t\tthis.userManager = commandOptions.userManager;\n\t\tthis.context = commandOptions.context;\n\t\tthis.onlyOffice = commandOptions.onlyOffice;\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'disk';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tfilterCurrentObject(handler: Function): any\n\t{\n\t\treturn (data) => {\n\t\t\tif (this.context.object.id !== data.object.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn handler(data);\n\t\t};\n\t}\n\n\tisCurrentUser(userId: number): boolean\n\t{\n\t\treturn this.context.currentUser.id === userId;\n\t}\n}","import BaseCommandHandler from \"./base-command-handler\";\nimport {PullClient} from \"pull.client\";\nimport type {ExitDocumentMessage, HiDocumentMessage, PingDocumentMessage, WelcomeDocumentMessage} from \"./types\";\n\nexport default class ClientCommandHandler extends BaseCommandHandler\n{\n\tgetSubscriptionType(): string\n\t{\n\t\treturn PullClient.SubscriptionType.Client;\n\t}\n\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\texitDocument: this.handleExitDocument.bind(this),\n\t\t\tpingDocument: this.handlePingDocument.bind(this),\n\t\t\thiToDocument: this.handleHiToDocument.bind(this),\n\t\t\twelcomeToDocument: this.handleWelcomeToDocument.bind(this),\n\t\t};\n\t}\n\n\thandleExitDocument(data: ExitDocumentMessage): void\n\t{\n\t\tconsole.log('exitDocument', data);\n\n\t\tconst fromUserId = data.fromUserId;\n\t\tif (!this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\tthis.userManager.remove(fromUserId);\n\t\t}\n\t}\n\n\thandleWelcomeToDocument(data: WelcomeDocumentMessage): void\n\t{\n\t\tconsole.log('handleWelcomeToDocument', data);\n\n\t\tthis.processNewbieInDocument(data);\n\t}\n\n\thandleHiToDocument(data: HiDocumentMessage): void\n\t{\n\t\tconsole.log('handleHiToDocument', data);\n\n\t\tconst newbieAdded = this.processNewbieInDocument(data);\n\t\tif (newbieAdded)\n\t\t{\n\t\t\t//immediately send welcome to add actual online information for new user.\n\t\t\tthis.userManager.sendWelcomeToUser();\n\t\t}\n\t}\n\n\tprocessNewbieInDocument(data: HiDocumentMessage|WelcomeDocumentMessage): boolean\n\t{\n\t\tconst fromUserId = data.user.id;\n\t\tif (this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.userManager.has(fromUserId))\n\t\t{\n\t\t\tthis.userManager.updateOnline(fromUserId);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.userManager.add(data.user);\n\n\t\treturn true;\n\t}\n\n\thandlePingDocument(data: PingDocumentMessage): void\n\t{\n\t\tconsole.log('handlePingDocument', data);\n\n\t\tconst fromUserId = data.fromUserId;\n\t\tif (this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userManager.has(fromUserId))\n\t\t{\n\t\t\tthis.userManager.updateOnline(fromUserId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.userManager.sentGreetings())\n\t\t\t{\n\t\t\t\tthis.userManager.getUserInfo(data.fromUserId, data.infoToken).then(userData => {\n\t\t\t\t\tthis.userManager.add(userData);\n\t\t\t\t}, () => {});\n\t\t\t}\n\t\t}\n\t}\n}","import BaseCommandHandler from \"./base-command-handler\";\nimport type {DocumentSavedMessage} from \"./types\";\nimport {ContentUpdatedMessage} from \"./types\";\nimport {Loc, Tag, Text} from \"main.core\";\n\nexport default class ServerCommandHandler extends BaseCommandHandler\n{\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\tonlyoffice: this.filterCurrentObject(this.handleSavedDocument.bind(this)),\n\t\t\tcontentUpdated: this.filterCurrentObject(this.handleContentUpdated.bind(this)),\n\t\t};\n\t}\n\n\thandleSavedDocument(data: DocumentSavedMessage): void\n\t{\n\t\tconsole.log('handleSavedDocument', data);\n\n\t\tif (data.documentSessionInfo.wasFinallySaved)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tautoHide: false,\n\t\t\t\tcontent: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_SAVED_AFTER_IDLE'),\n\t\t\t});\n\t\t}\n\t}\n\n\thandleContentUpdated(data: ContentUpdatedMessage): void\n\t{\n\t\tconsole.log('handleContentUpdated', data);\n\n\t\tif (!data.object.updatedBy || this.isCurrentUser(data.object.updatedBy))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.onlyOffice.wasDocumentChanged())\n\t\t{\n\t\t\tthis.userManager.getUserInfo(data.object.updatedBy, data.updatedBy.infoToken).then(userData => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_SAVED_WHILE_EDITING', {\n\t\t\t\t\t\t'#NAME#': Text.encode(data.object.name),\n\t\t\t\t\t\t'#USER_NAME#': Text.encode(userData.name),\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}, () => {});\n\t\t}\n\t\telse if (this.onlyOffice.isViewMode())\n\t\t{\n\t\t\tthis.userManager.getUserInfo(data.object.updatedBy, data.updatedBy.infoToken).then(userData => {\n\t\t\t\tlet content = Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_VIEW_NON_ACTUAL_VERSION', {\n\t\t\t\t\t'#NAME#': Text.encode(data.object.name),\n\t\t\t\t\t'#USER_NAME#': Text.encode(userData.name),\n\t\t\t\t});\n\t\t\t\tcontent = Tag.render`<span>${content}</span>`;\n\n\t\t\t\tconst refreshButton = content.querySelector('[data-refresh-btn]');\n\t\t\t\tif (refreshButton)\n\t\t\t\t{\n\t\t\t\t\tTag.style(refreshButton)`\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t`;\n\t\t\t\t\trefreshButton.addEventListener('click', this.#handleClickToRefreshEditor.bind(this));\n\t\t\t\t}\n\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t}, () => {});\n\t\t}\n\t}\n\n\t#handleClickToRefreshEditor(): void\n\t{\n\t\tthis.onlyOffice.reloadView();\n\t}\n}","import {Dom, Loc, Tag, Text} from \"main.core\";\nimport {Button} from \"ui.buttons\";\nimport type {CommonWarningOptions} from \"./types\";\n\nexport default class CustomErrorControl\n{\n\tshowWhenTooLarge(fileName: string, container: HTMLElement, targetNode: HTMLElement, linkToDownload: string): void\n\t{\n\t\tthis.showCommonWarning({\n\t\t\tcontainer: container,\n\t\t\ttargetNode: targetNode,\n\t\t\ttitle: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_LARGE_FILE_TITLE'),\n\t\t\tdescription: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_LARGE_FILE_DESCR'),\n\t\t\tfileName: fileName,\n\t\t\tlinkToDownload: linkToDownload,\n\t\t});\n\t}\n\n\tshowWhenNotFound(container: HTMLElement, targetNode: HTMLElement): void\n\t{\n\t\tthis.showCommonWarning({\n\t\t\tcontainer: container,\n\t\t\ttargetNode: targetNode,\n\t\t\ttitle: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_FILE_TITLE'),\n\t\t\tdescription: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_RIGHTS_OR_NOT_FOUND_DESCR'),\n\t\t});\n\t}\n\n\tshowCommonWarning(options: CommonWarningOptions): void\n\t{\n\t\tconst containerClass = 'disk-fe-office-warning--popup';\n\n\t\tlet fileNameNode = '';\n\t\tif (options.fileName)\n\t\t{\n\t\t\tfileNameNode = Tag.render`<div class=\"disk-fe-office-warning-file-name\">${Text.encode(options.fileName)}</div>`;\n\t\t}\n\n\t\tlet downloadButtonNode = '';\n\t\tif (options.linkToDownload)\n\t\t{\n\t\t\tconst downloadButton = new Button({\n\t\t\t\ttext: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_HEADER_BTN_DOWNLOAD'),\n\t\t\t\tround: true,\n\t\t\t\ttag: Button.Tag.LINK,\n\t\t\t\tlink: options.linkToDownload,\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tclassName: 'disk-fe-office-warning-btn',\n\t\t\t\tprops: {\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t}\n\t\t\t});\n\t\t\tdownloadButtonNode = downloadButton.render();\n\t\t}\n\n\t\tconst errorControl = Tag.render`\n\t\t\t<div class=\"disk-fe-office-warning-wrap\">\n\t\t\t\t<div class=\"disk-fe-office-warning-overlay\"></div>\n\t\t\t\t<div class=\"disk-fe-office-warning-box\">\n\t\t\t\t\t<div class=\"disk-fe-office-warning-icon\"></div>\n\t\t\t\t\t<div class=\"disk-fe-office-warning-title\">${options.title}</div>\n\t\t\t\t\t${fileNameNode}\n\t\t\t\t\t<div class=\"disk-fe-office-warning-desc\">${options.description}</div>\n\t\t\t\t\t${downloadButtonNode}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.addClass(options.container, containerClass);\n\t\tDom.prepend(errorControl, options.targetNode);\n\t}\n}\n","import {ajax as Ajax, Runtime, Type} from \"main.core\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport { MenuItem } from \"main.popup\";\nimport {PULL, PullClient} from \"pull.client\";\nimport type {EditorOptions, DocumentSession, Context} from \"./types\";\nimport {ButtonManager, Button, SplitButton} from \"ui.buttons\";\nimport ClientCommandHandler from \"./client-command-handler\";\nimport ServerCommandHandler from \"./server-command-handler\";\nimport UserManager from \"./user-manager\";\nimport {LegacyPopup, SharingControlType} from \"disk.sharing-legacy-popup\";\nimport {ExternalLink} from \"disk.external-link\";\nimport {PromoPopup} from \"disk.onlyoffice-promo-popup\";\nimport CustomErrorControl from \"./custom-error-controls\";\n\nconst SECONDS_TO_MARK_AS_STILL_WORKING = 60;\n\nimport { LocalStorageCache } from 'main.core.cache';\nconst cache = new LocalStorageCache();\n\nexport default class OnlyOffice\n{\n\teditor: any = null;\n\teditorJson: any = null;\n\tuserBoxNode: HTMLElement = null;\n\teditorNode: HTMLElement = null;\n\teditorWrapperNode: HTMLElement = null;\n\ttargetNode: HTMLElement = null;\n\tdocumentSession: DocumentSession = null;\n\tlinkToEdit: string = null;\n\tlinkToView: string = null;\n\tlinkToDownload: string = null;\n\tpullConfig: any = null;\n\teditButton: SplitButton = null;\n\tsetupSharingButton: Button = null;\n\tdocumentWasChanged: boolean = false;\n\tdontEndCurrentDocumentSession: boolean = false;\n\tcontext: Context = null;\n\tusersInDocument: UserManager = null;\n\tsharingControlType: ?SharingControlType = null;\n\tbrokenDocumentOpened: boolean = false;\n\n\tconstructor(editorOptions: EditorOptions)\n\t{\n\t\tconst options = Type.isPlainObject(editorOptions) ? editorOptions : {};\n\n\t\tthis.pullConfig = options.pullConfig;\n\t\tthis.documentSession = options.documentSession;\n\t\tthis.linkToEdit = options.linkToEdit;\n\t\tthis.linkToView = options.linkToView;\n\t\tthis.linkToDownload = options.linkToDownload;\n\t\tthis.targetNode = options.targetNode;\n\t\tthis.userBoxNode = options.userBoxNode;\n\t\tthis.editorNode = options.editorNode;\n\t\tthis.editorWrapperNode = options.editorWrapperNode;\n\t\tthis.editButton = ButtonManager.createByUniqId(editorOptions.panelButtonUniqIds.edit);\n\t\tthis.setupSharingButton = ButtonManager.createByUniqId(editorOptions.panelButtonUniqIds.setupSharing);\n\t\tthis.sharingControlType = editorOptions.sharingControlType;\n\t\tthis.context = {\n\t\t\tcurrentUser: options.currentUser,\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: options.object,\n\t\t\tattachedObject: options.attachedObject,\n\t\t};\n\t\tthis.context.object.publicChannel = options.publicChannel;\n\t\tthis.usersInDocument = new UserManager({\n\t\t\tcontext: this.context,\n\t\t\tuserBoxNode: this.userBoxNode,\n\t\t});\n\n\t\tthis.sendTelemetryEvent('load');\n\t\tthis.initializeEditor(options.editorJson);\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (currentSlider)\n\t\t{\n\t\t\tcurrentSlider.getData().set('documentSession', this.documentSession);\n\t\t}\n\n\t\tthis.loadDiskExtensionInTopWindow();\n\n\t\tthis.initPull();\n\t\tthis.bindEvents();\n\t\tif (this.isEditMode())\n\t\t{\n\t\t\tthis.registerTimerToTrackWork();\n\t\t}\n\n\t\tif (PromoPopup.shouldShowViewPromo())\n\t\t{\n\t\t\tPromoPopup.showViewPromo();\n\t\t}\n\t}\n\n\tregisterTimerToTrackWork(): void\n\t{\n\t\tsetInterval(this.#trackWork.bind(this), SECONDS_TO_MARK_AS_STILL_WORKING*1000);\n\t}\n\n\t#trackWork(): void\n\t{\n\t\t\tAjax.runComponentAction('bitrix:disk.file.editor-onlyoffice', 'markAsStillWorkingSession', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tjson: {\n\t\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tinitPull(): void\n\t{\n\t\tif (this.pullConfig)\n\t\t{\n\t\t\tBX.PULL = new PullClient({\n\t\t\t\tskipStorageInit: true\n\t\t\t});\n\t\t\tBX.PULL.start(this.pullConfig);\n\t\t}\n\t}\n\n\tsendTelemetryEvent(action, data): void\n\t{\n\t\tdata = data || {};\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentSliderData = currentSlider.getData();\n\t\tdata.action = action;\n\t\tdata.uid = currentSliderData.get('uid');\n\t\tdata.documentSessionId = this.context.documentSession.id;\n\t\tdata.documentSessionHash = this.context.documentSession.hash;\n\t\tdata.fileSize = this.context.object.size;\n\n\t\tBX.Disk.sendTelemetryEvent(data);\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe(\"SidePanel.Slider:onClose\", this.handleSliderClose.bind(this));\n\t\twindow.addEventListener(\"beforeunload\", this.handleClose.bind(this));\n\n\t\tif (window.top !== window)\n\t\t{\n\t\t\twindow.addEventListener(\"message\", (event: MessageEvent) => {\n\t\t\t\tif (event.data === 'closeIframe')\n\t\t\t\t{\n\t\t\t\t\tthis.handleClose();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.editorJson.document.permissions.edit === true && this.editButton)\n\t\t{\n\t\t\tif (this.editButton.hasOwnProperty('mainButton'))\n\t\t\t{\n\t\t\t\tthis.editButton.getMainButton().bindEvent('click', this.handleClickEditButton.bind(this));\n\n\t\t\t\tlet menuWindow = this.editButton.getMenuWindow();\n\t\t\t\tlet menuItems = Runtime.clone(menuWindow.getMenuItems());\n\n\t\t\t\tfor (let i = 0; i < menuItems.length; i++)\n\t\t\t\t{\n\t\t\t\t\tlet menuItem = menuItems[i];\n\t\t\t\t\tlet menuItemOptions = Runtime.clone(menuItem.options);\n\t\t\t\t\tmenuItemOptions.onclick = this.handleClickEditSubItems.bind(this);\n\n\t\t\t\t\tmenuWindow.removeMenuItem(menuItem.getId());\n\t\t\t\t\tmenuWindow.addMenuItem(menuItemOptions);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.editButton.bindEvent('click', this.handleClickEditButton.bind(this));\n\t\t\t}\n\t\t}\n\t\tif (this.setupSharingButton)\n\t\t{\n\t\t\tlet menuWindow = this.setupSharingButton.getMenuWindow();\n\t\t\tlet extLinkOptions = menuWindow.getMenuItem('ext-link').options;\n\t\t\textLinkOptions.onclick = this.handleClickSharingByExternalLink.bind(this);\n\n\t\t\tmenuWindow.removeMenuItem('ext-link');\n\t\t\tmenuWindow.addMenuItem(extLinkOptions);\n\n\t\t\tlet sharingOptions = menuWindow.getMenuItem('sharing').options;\n\t\t\tsharingOptions.onclick = this.handleClickSharing.bind(this);\n\n\t\t\tmenuWindow.removeMenuItem('sharing');\n\t\t\tmenuWindow.addMenuItem(sharingOptions);\n\t\t}\n\n\t\tPULL.subscribe(new ClientCommandHandler({\n\t\t\tonlyOffice: this,\n\t\t\tcontext: this.context,\n\t\t\tuserManager: this.usersInDocument,\n\t\t}));\n\t\tPULL.subscribe(new ServerCommandHandler({\n\t\t\tonlyOffice: this,\n\t\t\tcontext: this.context,\n\t\t\tuserManager: this.usersInDocument,\n\t\t}));\n\t}\n\n\tinitializeEditor(options): void\n\t{\n\t\toptions.events = {\n\t\t\tonDocumentStateChange: this.handleDocumentStateChange.bind(this),\n\t\t\tonDocumentReady: this.handleDocumentReady.bind(this),\n\t\t\tonMetaChange: this.handleMetaChange.bind(this),\n\t\t\tonInfo: this.handleInfo.bind(this),\n\t\t\tonWarning: this.handleWarning.bind(this),\n\t\t\tonError: this.handleError.bind(this),\n\t\t\tonRequestClose: this.handleRequestClose.bind(this),\n\t\t}\n\n\t\tif (options.document.permissions.rename)\n\t\t{\n\t\t\toptions.events.onRequestRename = this.handleRequestRename.bind(this);\n\t\t}\n\n\t\tthis.editorJson = options;\n\t\tthis.editor = new DocsAPI.DocEditor(this.editorNode.id, options);\n\t}\n\n\tloadDiskExtensionInTopWindow(): void\n\t{\n\t\tif (window.top !== window && !BX.getClass('window.top.BX.Disk.endEditSession'))\n\t\t{\n\t\t\ttop.BX.loadExt('disk');\n\t\t}\n\t}\n\n\temitEventOnSaved(): void\n\t{\n\t\tconst sliderByWindow = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (sliderByWindow)\n\t\t{\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'Disk.OnlyOffice:onSaved', {\n\t\t\t\tdocumentSession: this.documentSession,\n\t\t\t\tobject: this.context.object,\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.emit('Disk.OnlyOffice:onSaved', {\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: this.context.object,\n\t\t});\n\t}\n\n\temitEventOnClosed(): void\n\t{\n\t\tconst sliderByWindow = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tlet process = 'edit';\n\t\tif (sliderByWindow)\n\t\t{\n\t\t\tprocess = sliderByWindow.getData().get('process') || 'edit';\n\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'Disk.OnlyOffice:onClosed', {\n\t\t\t\tdocumentSession: this.documentSession,\n\t\t\t\tobject: this.context.object,\n\t\t\t\tprocess: process,\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.emit('Disk.OnlyOffice:onClosed', {\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: this.context.object,\n\t\t\tprocess: process,\n\t\t});\n\t}\n\n\thandleClickEditButton(): void\n\t{\n\t\tif (PromoPopup.shouldShowEditPromo())\n\t\t{\n\t\t\tPromoPopup.showEditPromo();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleRequestEditRights();\n\t}\n\n\thandleClickSharing(): void\n\t{\n\t\tswitch (this.sharingControlType)\n\t\t{\n\t\t\tcase SharingControlType.WITH_CHANGE_RIGHTS:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithChangeRights({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.WITH_SHARING:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithChangeRights({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.WITHOUT_EDIT:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithoutEdit({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.BLOCKED_BY_FEATURE:\n\t\t\t\tBX.UI.InfoHelper.show('limit_office_files_access_permissions');\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleClickSharingByExternalLink(event, menuItem: MenuItem): void\n\t{\n\t\tif (menuItem.dataset.shouldBlockExternalLinkFeature)\n\t\t{\n\t\t\teval(menuItem.dataset.blockerExternalLinkFeature);\n\n\t\t\treturn;\n\t\t}\n\n\t\tExternalLink.showPopup(this.context.object.id);\n\t}\n\n\thandleClickEditSubItems(event, menuItem: MenuItem): void\n\t{\n\t\tlet serviceCode = menuItem.getId();\n\t\tif(serviceCode === 'onlyoffice')\n\t\t{\n\t\t\tthis.handleClickEditButton();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.Disk.Viewer.Actions.runActionEdit({\n\t\t\tname: this.context.object.name,\n\t\t\tobjectId: this.context.object.id,\n\t\t\tattachedObjectId: this.context.attachedObject.id,\n\t\t\tserviceCode: serviceCode,\n\t\t});\n\t}\n\n\thandleSaveButtonClick(): void\n\t{\n\t\tPULL.subscribe({\n\t\t\tmoduleId: 'disk',\n\t\t\tcommand: 'onlyoffice',\n\t\t\tcallback: (data) => {\n\t\t\t\tif (data.hash === this.documentSession.hash)\n\t\t\t\t{\n\t\t\t\t\tthis.emitEventOnSaved();\n\n\t\t\t\t\twindow.BX.Disk.showModalWithStatusAction();\n\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleRequestClose(): void\n\t{\n\t\tconsole.log('handleRequestClose');\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcurrentSlider.getData().set('dontInvokeRequestClose', true);\n\t\tthis.handleClose();\n\t\tcurrentSlider.close();\n\t}\n\n\tisDocumentReadyToEdit(): boolean\n\t{\n\t\tif (this.brokenDocumentOpened)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.caughtDocumentReady)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\thandleSliderClose(event: BaseEvent): void\n\t{\n\t\tconsole.log('handleSliderClose');\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentSliderData = currentSlider.getData();\n\t\tconst uid = currentSliderData.get('uid');\n\n\t\t/** @type {BX.SidePanel.Event} */\n\t\tconst [sliderEvent] = event.getData();\n\t\tif (sliderEvent.getSlider().getData().get('uid') !== uid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isViewMode() || !this.isDocumentReadyToEdit())\n\t\t{\n\t\t\tthis.handleClose();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.editor.hasOwnProperty('requestClose'))\n\t\t{\n\t\t\tif (currentSliderData.get('dontInvokeRequestClose'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editor.requestClose();\n\t\t\tsliderEvent.denyAction();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.handleClose();\n\t\t}\n\t}\n\n\thandleClose(): void\n\t{\n\t\tconsole.log('handleClose');\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'exitDocument', {\n\t\t\tfromUserId: this.context.currentUser.id,\n\t\t});\n\n\t\tthis.sendTelemetryEvent('exit');\n\n\t\tthis.emitEventOnClosed();\n\n\t\tif (this.dontEndCurrentDocumentSession)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttop.BX.Disk.endEditSession({\n\t\t\tid: this.documentSession.id,\n\t\t\thash: this.documentSession.hash,\n\t\t\tdocumentWasChanged: this.documentWasChanged,\n\t\t});\n\t}\n\n\thandleDocumentStateChange(event): void\n\t{\n\t\tif (!this.caughtDocumentReady || !this.caughtInfoEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Date.now() - Math.max(this.caughtDocumentReady, this.caughtInfoEvent) < 500)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentWasChanged = true;\n\t}\n\n\twasDocumentChanged(): boolean\n\t{\n\t\treturn this.documentWasChanged;\n\t}\n\n\tisEditMode(): boolean\n\t{\n\t\treturn this.editorJson.editorConfig.mode === 'edit';\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn !this.isEditMode();\n\t}\n\n\treloadView(): void\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tdocument.location = this.linkToView;\n\t\t}\n\t}\n\n\thandleInfo(): void\n\t{\n\t\tthis.caughtInfoEvent = Date.now();\n\t}\n\n\thandleWarning(d): void\n\t{\n\t\tconsole.log('onlyoffice warning:', d.data);\n\t}\n\n\thandleError(d): void\n\t{\n\t\tconsole.log('onlyoffice error:', d.data);\n\n\t\tif (d.data.errorCode === -82)\n\t\t{\n\t\t\tthis.brokenDocumentOpened = true;\n\t\t\tthis.processBrokenDocument();\n\t\t}\n\t\telse if (d.data.errorCode === -84)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\t(new CustomErrorControl()).showWhenTooLarge(\n\t\t\t\t\tthis.context.object.name,\n\t\t\t\t\tthis.getEditorWrapperNode(),\n\t\t\t\t\tthis.getContainer(),\n\t\t\t\t\tthis.linkToDownload,\n\t\t\t\t);\n\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tprocessBrokenDocument(): void\n\t{\n\t\tif (!this.context.documentSession.id || !this.brokenDocumentOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst key = `oo_broken_doc_${this.context.documentSession.id}`;\n\t\tconst lastTime = cache.get(key);\n\t\tif (lastTime && Date.now() - lastTime < 1000 * 60)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAjax.runAction('disk.api.onlyoffice.recoverSessionWithBrokenFile', {\n\t\t\tmode: 'ajax',\n\t\t\tjson: {\n\t\t\t\tforce: true,\n\t\t\t\tsessionId: this.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.documentSession.hash,\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tif (response.status === 'success')\n\t\t\t{\n\t\t\t\tdocument.location.href = response.data.link;\n\t\t\t}\n\t\t});\n\n\t\tcache.set(key, Date.now());\n\t}\n\n\thandleRequestRename(event): void\n\t{\n\t\tconst newName = event.data;\n\t\tAjax.runAction('disk.api.onlyoffice.renameDocument', {\n\t\t\tmode: 'ajax',\n\t\t\tjson: {\n\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\tnewName: newName,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMetaChange(event): void\n\t{\n\t}\n\n\thandleDocumentReady(): void\n\t{\n\t\tthis.sendTelemetryEvent('ready');\n\n\t\tthis.caughtDocumentReady = Date.now();\n\t}\n\n\thandleRequestEditRights(): void\n\t{\n\t\tthis.dontEndCurrentDocumentSession = true;\n\n\t\tlet linkToEdit = BX.util.add_url_param(\n\t\t\t'/bitrix/services/main/ajax.php',\n\t\t\t{\n\t\t\t\taction: 'disk.api.documentService.goToEdit',\n\t\t\t\tserviceCode: 'onlyoffice',\n\t\t\t\tdocumentSessionId: this.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.documentSession.hash,\n\t\t\t}\n\t\t);\n\n\t\tif (this.linkToEdit)\n\t\t{\n\t\t\tlinkToEdit = this.linkToEdit;\n\t\t}\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\twindow.location = linkToEdit;\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet customLeftBoundary = currentSlider.getCustomLeftBoundary();\n\t\tcurrentSlider.close();\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tlinkToEdit, {\n\t\t\twidth: '100%',\n\t\t\tcustomLeftBoundary: customLeftBoundary,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\tdata: {\n\t\t\t\tdocumentEditor: true\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorNode(): HTMLElement\n\t{\n\t\treturn this.editorNode;\n\t}\n\n\tgetEditorWrapperNode(): HTMLElement\n\t{\n\t\treturn this.editorWrapperNode;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.targetNode;\n\t}\n}\n","import {ajax as Ajax, Type} from \"main.core\";\nimport {PULL} from \"pull.client\";\nimport type {WaitingOptions, DocumentSession, BaseObject} from \"./types\";\n\nexport default class Waiting\n{\n\tdocumentSession: DocumentSession = null;\n\tobject: BaseObject = null;\n\n\tconstructor(waitingOptions: WaitingOptions)\n\t{\n\t\tconst options = Type.isPlainObject(waitingOptions) ? waitingOptions : {};\n\n\t\tthis.documentSession = options.documentSession;\n\t\tthis.object = options.object;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: options.targetNode,\n\t\t});\n\t\tloader.show();\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tPULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'disk',\n\t\t\tcommand: 'onlyoffice',\n\t\t\tcallback: this.handleSavedDocument.bind(this),\n\t\t});\n\t}\n\n\thandleSavedDocument(data): void\n\t{\n\t\tconsole.log('handleSavedDocument', data);\n\n\t\tAjax.runAction('disk.api.onlyoffice.continueWithNewSession', {\n\t\t\tmode: 'ajax',\n\t\t\tjson: {\n\t\t\t\tsessionId: this.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.documentSession.hash,\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tif (response.status === 'success')\n\t\t\t{\n\t\t\t\tdocument.location.href = response.data.documentSession.link;\n\t\t\t}\n\t\t});\n\t}\n}"],"names":["ALLOWED_ATTEMPTS_TO_GET_USER_INFO","SECONDS_TO_ACTUALIZE_ONLINE","UserManager","options","users","BX","Disk","Users","badAttempts","Map","context","userBoxNode","alreadySaidHi","add","currentUser","bindEvents","EventEmitter","subscribe","event","getData","handleWhenPullConnected","sentGreetings","sendHiToUsers","setInterval","actualizeOnline","bind","refineUsersByOnline","sendPingToUsers","PULL","isConnected","sendMessageToChannels","object","publicChannel","user","id","name","avatar","fromUserId","infoToken","hasUser","addUser","console","log","updateOnline","renderBox","userId","getUser","onlineAt","Date","now","get","Promise","resolve","reject","status","Ajax","runComponentAction","mode","json","documentSessionId","documentSession","documentSessionHash","hash","then","response","data","attempts","set","deleteUser","secondsToOffline","forEach","remove","childElementCount","appendChild","getContainer","link","includes","document","location","origin","BaseCommandHandler","commandOptions","userManager","onlyOffice","PullClient","SubscriptionType","Server","handler","ClientCommandHandler","Client","exitDocument","handleExitDocument","pingDocument","handlePingDocument","hiToDocument","handleHiToDocument","welcomeToDocument","handleWelcomeToDocument","isCurrentUser","processNewbieInDocument","newbieAdded","sendWelcomeToUser","has","getUserInfo","userData","ServerCommandHandler","_classPrivateMethodInitSpec","onlyoffice","filterCurrentObject","handleSavedDocument","contentUpdated","handleContentUpdated","documentSessionInfo","wasFinallySaved","UI","Notification","Center","notify","autoHide","content","Loc","getMessage","updatedBy","wasDocumentChanged","Text","encode","isViewMode","Tag","render","refreshButton","querySelector","style","addEventListener","_classPrivateMethodGet","reloadView","CustomErrorControl","fileName","container","targetNode","linkToDownload","showCommonWarning","title","description","containerClass","fileNameNode","downloadButtonNode","downloadButton","Button","text","round","tag","LINK","color","Color","SUCCESS","className","props","target","errorControl","Dom","addClass","prepend","SECONDS_TO_MARK_AS_STILL_WORKING","cache","LocalStorageCache","OnlyOffice","editorOptions","Type","isPlainObject","pullConfig","linkToEdit","linkToView","editorNode","editorWrapperNode","editButton","ButtonManager","createByUniqId","panelButtonUniqIds","edit","setupSharingButton","setupSharing","sharingControlType","attachedObject","usersInDocument","sendTelemetryEvent","initializeEditor","editorJson","currentSlider","SidePanel","Instance","getSliderByWindow","window","loadDiskExtensionInTopWindow","initPull","isEditMode","registerTimerToTrackWork","PromoPopup","shouldShowViewPromo","showViewPromo","skipStorageInit","start","action","currentSliderData","uid","fileSize","size","handleSliderClose","handleClose","top","permissions","hasOwnProperty","getMainButton","bindEvent","handleClickEditButton","menuWindow","getMenuWindow","menuItems","Runtime","clone","getMenuItems","i","length","menuItem","menuItemOptions","onclick","handleClickEditSubItems","removeMenuItem","getId","addMenuItem","extLinkOptions","getMenuItem","handleClickSharingByExternalLink","sharingOptions","handleClickSharing","events","onDocumentStateChange","handleDocumentStateChange","onDocumentReady","handleDocumentReady","onMetaChange","handleMetaChange","onInfo","handleInfo","onWarning","handleWarning","onError","handleError","onRequestClose","handleRequestClose","rename","onRequestRename","handleRequestRename","editor","DocsAPI","DocEditor","getClass","loadExt","sliderByWindow","postMessageAll","emit","process","shouldShowEditPromo","showEditPromo","handleRequestEditRights","SharingControlType","WITH_CHANGE_RIGHTS","LegacyPopup","showSharingDetailWithChangeRights","WITH_SHARING","WITHOUT_EDIT","showSharingDetailWithoutEdit","BLOCKED_BY_FEATURE","InfoHelper","show","dataset","shouldBlockExternalLinkFeature","eval","blockerExternalLinkFeature","ExternalLink","showPopup","serviceCode","Viewer","Actions","runActionEdit","objectId","attachedObjectId","moduleId","command","callback","emitEventOnSaved","showModalWithStatusAction","close","brokenDocumentOpened","caughtDocumentReady","sliderEvent","getSlider","isDocumentReadyToEdit","requestClose","denyAction","emitEventOnClosed","dontEndCurrentDocumentSession","endEditSession","documentWasChanged","caughtInfoEvent","Math","max","editorConfig","d","errorCode","processBrokenDocument","setTimeout","showWhenTooLarge","getEditorWrapperNode","key","lastTime","runAction","force","sessionId","href","newName","util","add_url_param","customLeftBoundary","getCustomLeftBoundary","open","width","cacheable","allowChangeHistory","documentEditor","Waiting","waitingOptions","loader","Loader","type"],"mappings":";;;;;;;;AACA,CAKA,IAAMA,iCAAiC,GAAG,CAAC;CAC3C,IAAMC,2BAA2B,GAAG,EAAE;CAAC;CAAA,IAElBC,WAAW;GAQ/B,qBAAYC,OAA2B,EACvC;KAAA;KAAA;KAAA,iDAP2B,IAAI;KAAA,6CACZ,IAAI;KAAA,mDAGE,KAAK;KAI7B,IAAI,CAACC,KAAK,GAAG,IAAIC,EAAE,CAACC,IAAI,CAACC,KAAK,CAAC,EAAE,CAAC;KAClC,IAAI,CAACC,WAAW,GAAG,IAAIC,GAAG,EAAE;KAC5B,IAAI,CAACC,OAAO,GAAGP,OAAO,CAACO,OAAO;KAC9B,IAAI,CAACC,WAAW,GAAGR,OAAO,CAACQ,WAAW;KACtC,IAAI,CAACC,aAAa,GAAG,KAAK;KAC1B,IAAI,CAACC,GAAG,CAAC,IAAI,CAACH,OAAO,CAACI,WAAW,CAAC;KAElC,IAAI,CAACC,UAAU,EAAE;;GACjB;KAAA;KAAA,6BAGD;OAAA;OACCC,6BAAY,CAACC,SAAS,CAAC,cAAc,EAAE,UAACC,KAAgB,EAAK;SAC5D,IAAIA,KAAK,CAACC,OAAO,EAAE,CAAC,CAAC,CAAC,KAAK,QAAQ,EACnC;WACC,KAAI,CAACC,uBAAuB,EAAE;;QAE/B,CAAC;;;KACF;KAAA,0CAGD;OACC,IAAI,CAAC,IAAI,CAACC,aAAa,EAAE,EACzB;SACC,IAAI,CAACC,aAAa,EAAE;SACpBC,WAAW,CAAC,IAAI,CAACC,eAAe,CAACC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,GAACxB,2BAA2B,CAAC;;;;KAE/E;KAAA,kCAGD;OACC,IAAI,CAACyB,mBAAmB,EAAE;OAC1B,IAAI,CAAC,IAAI,CAACL,aAAa,EAAE,EACzB;SACC,IAAI,CAACC,aAAa,EAAE;QACpB,MAED;SACC,IAAI,CAACK,eAAe,EAAE;;;;KAEvB;KAAA,gCAGD;OACC,OAAO,IAAI,CAACf,aAAa;;;KACzB;KAAA,gCAGD;OACC,IAAI,CAACgB,gBAAI,CAACC,WAAW,EAAE,EACvB;SACC;;OAGDD,gBAAI,CAACE,qBAAqB,CAAC,CAAC,IAAI,CAACpB,OAAO,CAACqB,MAAM,CAACC,aAAa,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE;SACvFC,IAAI,EAAE;WACLC,EAAE,EAAE,IAAI,CAACxB,OAAO,CAACI,WAAW,CAACoB,EAAE;WAC/BC,IAAI,EAAE,IAAI,CAACzB,OAAO,CAACI,WAAW,CAACqB,IAAI;WACnCC,MAAM,yBAAE,IAAI,8CAAJ,IAAI,EAAmB,IAAI,CAAC1B,OAAO,CAACI,WAAW,CAACsB,MAAM;;QAE/D,CAAC;OAEF,IAAI,CAACxB,aAAa,GAAG,IAAI;;;KACzB;KAAA,oCAaD;OACC,IAAI,CAACgB,gBAAI,CAACC,WAAW,EAAE,EACvB;SACC;;OAGDD,gBAAI,CAACE,qBAAqB,CAAC,CAAC,IAAI,CAACpB,OAAO,CAACqB,MAAM,CAACC,aAAa,CAAC,EAAE,MAAM,EAAE,mBAAmB,EAAE;SAC5FC,IAAI,EAAE;WACLC,EAAE,EAAE,IAAI,CAACxB,OAAO,CAACI,WAAW,CAACoB,EAAE;WAC/BC,IAAI,EAAE,IAAI,CAACzB,OAAO,CAACI,WAAW,CAACqB,IAAI;WACnCC,MAAM,yBAAE,IAAI,8CAAJ,IAAI,EAAmB,IAAI,CAAC1B,OAAO,CAACI,WAAW,CAACsB,MAAM;;QAE/D,CAAC;;;KACF;KAAA,kCAGD;OACC,IAAI,CAACR,gBAAI,CAACC,WAAW,EAAE,EACvB;SACC;;OAGDD,gBAAI,CAACE,qBAAqB,CAAC,CAAC,IAAI,CAACpB,OAAO,CAACqB,MAAM,CAACC,aAAa,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE;SACvFK,UAAU,EAAE,IAAI,CAAC3B,OAAO,CAACI,WAAW,CAACoB,EAAE;SACvCI,SAAS,EAAE,IAAI,CAAC5B,OAAO,CAACI,WAAW,CAACwB;QACpC,CAAC;;;KACF;KAAA,oBAEGL,IAAU,EACd;OACC,IAAI,CAAC,IAAI,CAAC7B,KAAK,CAACmC,OAAO,CAACN,IAAI,CAACC,EAAE,CAAC,EAChC;SACC,IAAI,CAAC9B,KAAK,CAACoC,OAAO,CAACP,IAAI,CAAC;SAExBQ,OAAO,CAACC,GAAG,CAAC,cAAc,EAAET,IAAI,CAACC,EAAE,CAAC;;OAGrC,IAAI,CAACS,YAAY,CAACV,IAAI,CAACC,EAAE,CAAC;OAC1B,IAAI,CAACU,SAAS,EAAE;;;KAChB;KAAA,6BAEYC,MAAc,EAC3B;OACC,IAAI,IAAI,CAACzC,KAAK,CAACmC,OAAO,CAACM,MAAM,CAAC,EAC9B;SACC,IAAI,CAACzC,KAAK,CAAC0C,OAAO,CAACD,MAAM,CAAC,CAACE,QAAQ,GAAGC,IAAI,CAACC,GAAG,EAAE;;;;KAEjD;KAAA,4BAEWJ,MAAc,EAAEP,SAAiB,EAC7C;OAAA;OACC,IAAI,IAAI,CAAC9B,WAAW,CAAC0C,GAAG,CAACL,MAAM,CAAC,IAAI7C,iCAAiC,EACrE;SACC,OAAO,IAAImD,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;WACvCA,MAAM,CAAC;aACNC,MAAM,EAAE;YACR,CAAC;UACF,CAAC;;OAGH,OAAO,IAAIH,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;SACvCE,cAAI,CAACC,kBAAkB,CAAC,oCAAoC,EAAE,aAAa,EAAE;WAC5EC,IAAI,EAAE,MAAM;WACZC,IAAI,EAAE;aACLC,iBAAiB,EAAE,MAAI,CAACjD,OAAO,CAACkD,eAAe,CAAC1B,EAAE;aAClD2B,mBAAmB,EAAE,MAAI,CAACnD,OAAO,CAACkD,eAAe,CAACE,IAAI;aACtDjB,MAAM,EAAEA,MAAM;aACdP,SAAS,EAAEA;;UAEZ,CAAC,CAACyB,IAAI,CAAC,UAACC,QAAQ,EAAK;WACrB,IAAIA,QAAQ,CAACV,MAAM,KAAK,SAAS,EACjC;aACC,MAAI,CAAC9C,WAAW,UAAO,CAACqC,MAAM,CAAC;aAC/BO,OAAO,CAACY,QAAQ,CAACC,IAAI,CAAChC,IAAI,CAAC;;UAE5B,EAAE,UAAC+B,QAAQ,EAAK;WAChB,IAAME,QAAQ,GAAG,MAAI,CAAC1D,WAAW,CAAC0C,GAAG,CAACL,MAAM,CAAC,IAAI,CAAC;WAClD,MAAI,CAACrC,WAAW,CAAC2D,GAAG,CAACtB,MAAM,EAAEqB,QAAQ,GAAG,CAAC,CAAC;WAC1CzB,OAAO,CAACC,GAAG,CAAC,MAAI,CAAClC,WAAW,CAAC;WAE7B6C,MAAM,CAACW,QAAQ,CAAC;UAChB,CAAC;QACF,CAAC;;;KACF;KAAA,oBAEGnB,MAAc,EAClB;OACC,OAAO,IAAI,CAACzC,KAAK,CAACmC,OAAO,CAACM,MAAM,CAAC;;;KACjC;KAAA,uBAEMA,MAAc,EACrB;OACC,IAAIA,MAAM,KAAK,IAAI,CAACnC,OAAO,CAACI,WAAW,CAACoB,EAAE,EAC1C;SACC;;OAGD,IAAI,CAAC9B,KAAK,CAACgE,UAAU,CAACvB,MAAM,CAAC;OAC7B,IAAI,CAACD,SAAS,EAAE;;;KAChB;KAAA,sCAGD;OAAA;OACC,IAAMyB,gBAAgB,GAAG,IAAI,IAAEpE,2BAA2B,GAAC,CAAC,CAAC,GAAC,CAAC;OAC/D,IAAMgD,GAAG,GAAGD,IAAI,CAACC,GAAG,EAAE;OAEtB,IAAI,CAAC7C,KAAK,CAACkE,OAAO,CAAC,UAACrC,IAAU,EAAK;SAClC,IAAIgB,GAAG,GAAGhB,IAAI,CAACc,QAAQ,GAAGsB,gBAAgB,EAC1C;WACC,MAAI,CAACE,MAAM,CAACtC,IAAI,CAACC,EAAE,CAAC;;QAErB,CAAC;;;KACF;KAAA,4BAGD;OACC,IAAI,CAAC,IAAI,CAACvB,WAAW,CAAC6D,iBAAiB,EACvC;SACC,IAAI,CAAC7D,WAAW,CAAC8D,WAAW,CAAC,IAAI,CAACrE,KAAK,CAACsE,YAAY,EAAE,CAAC;;;;GAExD;CAAA;CAAA,4BAnIiBC,IAAY,EAC9B;GACC,IAAIA,IAAI,CAACC,QAAQ,CAAC,SAAS,CAAC,IAAID,IAAI,CAACC,QAAQ,CAAC,UAAU,CAAC,EACzD;KACC,OAAOD,IAAI;;GAGZ,OAAOE,QAAQ,CAACC,QAAQ,CAACC,MAAM,GAAGJ,IAAI;CACvC;;CCzFqC,IAEjBK,kBAAkB;GAMtC,4BAAYC,cAA8B,EAC1C;KAAA;KAAA,6CAL0B,IAAI;KAAA,gDACL,IAAI;KAAA,iDACF,IAAI;KAI9B,IAAI,CAAC9E,OAAO,GAAG8E,cAAc;KAC7B,IAAI,CAACC,WAAW,GAAGD,cAAc,CAACC,WAAW;KAC7C,IAAI,CAACxE,OAAO,GAAGuE,cAAc,CAACvE,OAAO;KACrC,IAAI,CAACyE,UAAU,GAAGF,cAAc,CAACE,UAAU;;GAC3C;KAAA;KAAA,8BAGD;OACC,OAAO,MAAM;;;KACb;KAAA,sCAGD;OACC,OAAOC,sBAAU,CAACC,gBAAgB,CAACC,MAAM;;;KACzC;KAAA,oCAEmBC,OAAiB,EACrC;OAAA;OACC,OAAO,UAACtB,IAAI,EAAK;SAChB,IAAI,KAAI,CAACvD,OAAO,CAACqB,MAAM,CAACG,EAAE,KAAK+B,IAAI,CAAClC,MAAM,CAACG,EAAE,EAC7C;WACC;;SAGD,OAAOqD,OAAO,CAACtB,IAAI,CAAC;QACpB;;;KACD;KAAA,8BAEapB,MAAc,EAC5B;OACC,OAAO,IAAI,CAACnC,OAAO,CAACI,WAAW,CAACoB,EAAE,KAAKW,MAAM;;;GAC7C;CAAA;;CC3CqC,IAGlB2C,oBAAoB;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,sCAGxC;OACC,OAAOJ,sBAAU,CAACC,gBAAgB,CAACI,MAAM;;;KACzC;KAAA,yBAGD;OACC,OAAO;SACNC,YAAY,EAAE,IAAI,CAACC,kBAAkB,CAAClE,IAAI,CAAC,IAAI,CAAC;SAChDmE,YAAY,EAAE,IAAI,CAACC,kBAAkB,CAACpE,IAAI,CAAC,IAAI,CAAC;SAChDqE,YAAY,EAAE,IAAI,CAACC,kBAAkB,CAACtE,IAAI,CAAC,IAAI,CAAC;SAChDuE,iBAAiB,EAAE,IAAI,CAACC,uBAAuB,CAACxE,IAAI,CAAC,IAAI;QACzD;;;KACD;KAAA,mCAEkBwC,IAAyB,EAC5C;OACCxB,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEuB,IAAI,CAAC;OAEjC,IAAM5B,UAAU,GAAG4B,IAAI,CAAC5B,UAAU;OAClC,IAAI,CAAC,IAAI,CAAC6D,aAAa,CAAC7D,UAAU,CAAC,EACnC;SACC,IAAI,CAAC6C,WAAW,CAACX,MAAM,CAAClC,UAAU,CAAC;;;;KAEpC;KAAA,wCAEuB4B,IAA4B,EACpD;OACCxB,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAEuB,IAAI,CAAC;OAE5C,IAAI,CAACkC,uBAAuB,CAAClC,IAAI,CAAC;;;KAClC;KAAA,mCAEkBA,IAAuB,EAC1C;OACCxB,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEuB,IAAI,CAAC;OAEvC,IAAMmC,WAAW,GAAG,IAAI,CAACD,uBAAuB,CAAClC,IAAI,CAAC;OACtD,IAAImC,WAAW,EACf;;SAEC,IAAI,CAAClB,WAAW,CAACmB,iBAAiB,EAAE;;;;KAErC;KAAA,wCAEuBpC,IAA8C,EACtE;OACC,IAAM5B,UAAU,GAAG4B,IAAI,CAAChC,IAAI,CAACC,EAAE;OAC/B,IAAI,IAAI,CAACgE,aAAa,CAAC7D,UAAU,CAAC,EAClC;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAAC6C,WAAW,CAACoB,GAAG,CAACjE,UAAU,CAAC,EACpC;SACC,IAAI,CAAC6C,WAAW,CAACvC,YAAY,CAACN,UAAU,CAAC;SAEzC,OAAO,KAAK;;OAGb,IAAI,CAAC6C,WAAW,CAACrE,GAAG,CAACoD,IAAI,CAAChC,IAAI,CAAC;OAE/B,OAAO,IAAI;;;KACX;KAAA,mCAEkBgC,IAAyB,EAC5C;OAAA;OACCxB,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEuB,IAAI,CAAC;OAEvC,IAAM5B,UAAU,GAAG4B,IAAI,CAAC5B,UAAU;OAClC,IAAI,IAAI,CAAC6D,aAAa,CAAC7D,UAAU,CAAC,EAClC;SACC;;OAGD,IAAI,IAAI,CAAC6C,WAAW,CAACoB,GAAG,CAACjE,UAAU,CAAC,EACpC;SACC,IAAI,CAAC6C,WAAW,CAACvC,YAAY,CAACN,UAAU,CAAC;QACzC,MAED;SACC,IAAI,IAAI,CAAC6C,WAAW,CAAC7D,aAAa,EAAE,EACpC;WACC,IAAI,CAAC6D,WAAW,CAACqB,WAAW,CAACtC,IAAI,CAAC5B,UAAU,EAAE4B,IAAI,CAAC3B,SAAS,CAAC,CAACyB,IAAI,CAAC,UAAAyC,QAAQ,EAAI;aAC9E,KAAI,CAACtB,WAAW,CAACrE,GAAG,CAAC2F,QAAQ,CAAC;YAC9B,EAAE,YAAM,EAAE,CAAC;;;;;GAGd;CAAA,EA1FgDxB,kBAAkB;;;;;;ACJpE,CAGyC;CAAA,IAEpByB,oBAAoB;GAAA;GAAA;KAAA;KAAA;KAAA;KAAA;OAAA;;KAAA;KAAAC;KAAA;;GAAA;KAAA;KAAA,yBAGxC;OACC,OAAO;SACNC,UAAU,EAAE,IAAI,CAACC,mBAAmB,CAAC,IAAI,CAACC,mBAAmB,CAACpF,IAAI,CAAC,IAAI,CAAC,CAAC;SACzEqF,cAAc,EAAE,IAAI,CAACF,mBAAmB,CAAC,IAAI,CAACG,oBAAoB,CAACtF,IAAI,CAAC,IAAI,CAAC;QAC7E;;;KACD;KAAA,oCAEmBwC,IAA0B,EAC9C;OACCxB,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEuB,IAAI,CAAC;OAExC,IAAIA,IAAI,CAAC+C,mBAAmB,CAACC,eAAe,EAC5C;SACC5G,EAAE,CAAC6G,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAChCC,QAAQ,EAAE,KAAK;WACfC,OAAO,EAAEC,aAAG,CAACC,UAAU,CAAC,8CAA8C;UACtE,CAAC;;;;KAEH;KAAA,qCAEoBxD,IAA2B,EAChD;OAAA;OACCxB,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEuB,IAAI,CAAC;OAEzC,IAAI,CAACA,IAAI,CAAClC,MAAM,CAAC2F,SAAS,IAAI,IAAI,CAACxB,aAAa,CAACjC,IAAI,CAAClC,MAAM,CAAC2F,SAAS,CAAC,EACvE;SACC;;OAGD,IAAI,IAAI,CAACvC,UAAU,CAACwC,kBAAkB,EAAE,EACxC;SACC,IAAI,CAACzC,WAAW,CAACqB,WAAW,CAACtC,IAAI,CAAClC,MAAM,CAAC2F,SAAS,EAAEzD,IAAI,CAACyD,SAAS,CAACpF,SAAS,CAAC,CAACyB,IAAI,CAAC,UAAAyC,QAAQ,EAAI;WAC9FnG,EAAE,CAAC6G,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;aAChCE,OAAO,EAAEC,aAAG,CAACC,UAAU,CAAC,iDAAiD,EAAE;eAC1E,QAAQ,EAAEG,cAAI,CAACC,MAAM,CAAC5D,IAAI,CAAClC,MAAM,CAACI,IAAI,CAAC;eACvC,aAAa,EAAEyF,cAAI,CAACC,MAAM,CAACrB,QAAQ,CAACrE,IAAI;cACxC;YACD,CAAC;UACF,EAAE,YAAM,EAAE,CAAC;QACZ,MACI,IAAI,IAAI,CAACgD,UAAU,CAAC2C,UAAU,EAAE,EACrC;SACC,IAAI,CAAC5C,WAAW,CAACqB,WAAW,CAACtC,IAAI,CAAClC,MAAM,CAAC2F,SAAS,EAAEzD,IAAI,CAACyD,SAAS,CAACpF,SAAS,CAAC,CAACyB,IAAI,CAAC,UAAAyC,QAAQ,EAAI;WAC9F,IAAIe,OAAO,GAAGC,aAAG,CAACC,UAAU,CAAC,qDAAqD,EAAE;aACnF,QAAQ,EAAEG,cAAI,CAACC,MAAM,CAAC5D,IAAI,CAAClC,MAAM,CAACI,IAAI,CAAC;aACvC,aAAa,EAAEyF,cAAI,CAACC,MAAM,CAACrB,QAAQ,CAACrE,IAAI;YACxC,CAAC;WACFoF,OAAO,GAAGQ,aAAG,CAACC,MAAM,mGAAST,OAAO,CAAS;WAE7C,IAAMU,aAAa,GAAGV,OAAO,CAACW,aAAa,CAAC,oBAAoB,CAAC;WACjE,IAAID,aAAa,EACjB;aACCF,aAAG,CAACI,KAAK,CAACF,aAAa,CAAC;aAGxBA,aAAa,CAACG,gBAAgB,CAAC,OAAO,EAAEC,+BAAI,6DAA6B5G,IAAI,CAAC,MAAI,CAAC,CAAC;;WAGrFpB,EAAE,CAAC6G,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;aAChCE,OAAO,EAAEA;YACT,CAAC;UACF,EAAE,YAAM,EAAE,CAAC;;;;GAEb;CAAA,EAlEgDvC,kBAAkB;CAAA,wCAqEnE;GACC,IAAI,CAACG,UAAU,CAACmD,UAAU,EAAE;CAC7B;;;AC5ED,KAIqBC,kBAAkB;GAAA;KAAA;;GAAA;KAAA;KAAA,iCAErBC,QAAgB,EAAEC,SAAsB,EAAEC,UAAuB,EAAEC,cAAsB,EAC1G;OACC,IAAI,CAACC,iBAAiB,CAAC;SACtBH,SAAS,EAAEA,SAAS;SACpBC,UAAU,EAAEA,UAAU;SACtBG,KAAK,EAAErB,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC;SAClFqB,WAAW,EAAEtB,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC;SACxFe,QAAQ,EAAEA,QAAQ;SAClBG,cAAc,EAAEA;QAChB,CAAC;;;KACF;KAAA,iCAEgBF,SAAsB,EAAEC,UAAuB,EAChE;OACC,IAAI,CAACE,iBAAiB,CAAC;SACtBH,SAAS,EAAEA,SAAS;SACpBC,UAAU,EAAEA,UAAU;SACtBG,KAAK,EAAErB,aAAG,CAACC,UAAU,CAAC,qDAAqD,CAAC;SAC5EqB,WAAW,EAAEtB,aAAG,CAACC,UAAU,CAAC,oEAAoE;QAChG,CAAC;;;KACF;KAAA,kCAEiBtH,OAA6B,EAC/C;OACC,IAAM4I,cAAc,GAAG,+BAA+B;OAEtD,IAAIC,YAAY,GAAG,EAAE;OACrB,IAAI7I,OAAO,CAACqI,QAAQ,EACpB;SACCQ,YAAY,GAAGjB,aAAG,CAACC,MAAM,gJAAiDJ,cAAI,CAACC,MAAM,CAAC1H,OAAO,CAACqI,QAAQ,CAAC,CAAQ;;OAGhH,IAAIS,kBAAkB,GAAG,EAAE;OAC3B,IAAI9I,OAAO,CAACwI,cAAc,EAC1B;SACC,IAAMO,cAAc,GAAG,IAAIC,iBAAM,CAAC;WACjCC,IAAI,EAAE5B,aAAG,CAACC,UAAU,CAAC,iDAAiD,CAAC;WACvE4B,KAAK,EAAE,IAAI;WACXC,GAAG,EAAEH,iBAAM,CAACpB,GAAG,CAACwB,IAAI;WACpB5E,IAAI,EAAExE,OAAO,CAACwI,cAAc;WAC5Ba,KAAK,EAAEL,iBAAM,CAACM,KAAK,CAACC,OAAO;WAC3BC,SAAS,EAAE,4BAA4B;WACvCC,KAAK,EAAE;aACNC,MAAM,EAAE;;UAET,CAAC;SACFZ,kBAAkB,GAAGC,cAAc,CAAClB,MAAM,EAAE;;OAG7C,IAAM8B,YAAY,GAAG/B,aAAG,CAACC,MAAM,igBAKgB7H,OAAO,CAAC0I,KAAK,EACvDG,YAAY,EAC6B7I,OAAO,CAAC2I,WAAW,EAC5DG,kBAAkB,CAGtB;OAEDc,aAAG,CAACC,QAAQ,CAAC7J,OAAO,CAACsI,SAAS,EAAEM,cAAc,CAAC;OAC/CgB,aAAG,CAACE,OAAO,CAACH,YAAY,EAAE3J,OAAO,CAACuI,UAAU,CAAC;;;GAC7C;CAAA;;;;;ACtEF,CAcA,IAAMwB,gCAAgC,GAAG,EAAE;AAE3C,CACA,IAAMC,KAAK,GAAG,IAAIC,iCAAiB,EAAE;CAAC;AAAA,KAEjBC,UAAU;GAsB9B,oBAAYC,aAA4B,EACxC;KAAA;KAAA5D;KAAA,4CArBc,IAAI;KAAA,gDACA,IAAI;KAAA,iDACK,IAAI;KAAA,gDACL,IAAI;KAAA,uDACG,IAAI;KAAA,gDACX,IAAI;KAAA,qDACK,IAAI;KAAA,gDAClB,IAAI;KAAA,gDACJ,IAAI;KAAA,oDACA,IAAI;KAAA,gDACX,IAAI;KAAA,gDACI,IAAI;KAAA,wDACD,IAAI;KAAA,wDACH,KAAK;KAAA,mEACM,KAAK;KAAA,6CAC3B,IAAI;KAAA,qDACQ,IAAI;KAAA,wDACO,IAAI;KAAA,0DACd,KAAK;KAIpC,IAAMvG,OAAO,GAAGoK,cAAI,CAACC,aAAa,CAACF,aAAa,CAAC,GAAGA,aAAa,GAAG,EAAE;KAEtE,IAAI,CAACG,UAAU,GAAGtK,OAAO,CAACsK,UAAU;KACpC,IAAI,CAAC7G,eAAe,GAAGzD,OAAO,CAACyD,eAAe;KAC9C,IAAI,CAAC8G,UAAU,GAAGvK,OAAO,CAACuK,UAAU;KACpC,IAAI,CAACC,UAAU,GAAGxK,OAAO,CAACwK,UAAU;KACpC,IAAI,CAAChC,cAAc,GAAGxI,OAAO,CAACwI,cAAc;KAC5C,IAAI,CAACD,UAAU,GAAGvI,OAAO,CAACuI,UAAU;KACpC,IAAI,CAAC/H,WAAW,GAAGR,OAAO,CAACQ,WAAW;KACtC,IAAI,CAACiK,UAAU,GAAGzK,OAAO,CAACyK,UAAU;KACpC,IAAI,CAACC,iBAAiB,GAAG1K,OAAO,CAAC0K,iBAAiB;KAClD,IAAI,CAACC,UAAU,GAAGC,wBAAa,CAACC,cAAc,CAACV,aAAa,CAACW,kBAAkB,CAACC,IAAI,CAAC;KACrF,IAAI,CAACC,kBAAkB,GAAGJ,wBAAa,CAACC,cAAc,CAACV,aAAa,CAACW,kBAAkB,CAACG,YAAY,CAAC;KACrG,IAAI,CAACC,kBAAkB,GAAGf,aAAa,CAACe,kBAAkB;KAC1D,IAAI,CAAC3K,OAAO,GAAG;OACdI,WAAW,EAAEX,OAAO,CAACW,WAAW;OAChC8C,eAAe,EAAE,IAAI,CAACA,eAAe;OACrC7B,MAAM,EAAE5B,OAAO,CAAC4B,MAAM;OACtBuJ,cAAc,EAAEnL,OAAO,CAACmL;MACxB;KACD,IAAI,CAAC5K,OAAO,CAACqB,MAAM,CAACC,aAAa,GAAG7B,OAAO,CAAC6B,aAAa;KACzD,IAAI,CAACuJ,eAAe,GAAG,IAAIrL,WAAW,CAAC;OACtCQ,OAAO,EAAE,IAAI,CAACA,OAAO;OACrBC,WAAW,EAAE,IAAI,CAACA;MAClB,CAAC;KAEF,IAAI,CAAC6K,kBAAkB,CAAC,MAAM,CAAC;KAC/B,IAAI,CAACC,gBAAgB,CAACtL,OAAO,CAACuL,UAAU,CAAC;KAEzC,IAAMC,aAAa,GAAGtL,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;KACrE,IAAIJ,aAAa,EACjB;OACCA,aAAa,CAACxK,OAAO,EAAE,CAACgD,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAACP,eAAe,CAAC;;KAGrE,IAAI,CAACoI,4BAA4B,EAAE;KAEnC,IAAI,CAACC,QAAQ,EAAE;KACf,IAAI,CAAClL,UAAU,EAAE;KACjB,IAAI,IAAI,CAACmL,UAAU,EAAE,EACrB;OACC,IAAI,CAACC,wBAAwB,EAAE;;KAGhC,IAAIC,oCAAU,CAACC,mBAAmB,EAAE,EACpC;OACCD,oCAAU,CAACE,aAAa,EAAE;;;GAE3B;KAAA;KAAA,2CAGD;OACC/K,WAAW,CAAC8G,6BAAI,2BAAY5G,IAAI,CAAC,IAAI,CAAC,EAAEyI,gCAAgC,GAAC,IAAI,CAAC;;;KAC9E;KAAA,2BAcD;OACC,IAAI,IAAI,CAACO,UAAU,EACnB;SACCpK,EAAE,CAACuB,IAAI,GAAG,IAAIwD,sBAAU,CAAC;WACxBmH,eAAe,EAAE;UACjB,CAAC;SACFlM,EAAE,CAACuB,IAAI,CAAC4K,KAAK,CAAC,IAAI,CAAC/B,UAAU,CAAC;;;;KAE/B;KAAA,mCAEkBgC,MAAM,EAAExI,IAAI,EAC/B;OACCA,IAAI,GAAGA,IAAI,IAAI,EAAE;OAEjB,IAAM0H,aAAa,GAAGtL,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACrE,IAAI,CAACJ,aAAa,EAClB;SACC;;OAGD,IAAMe,iBAAiB,GAAGf,aAAa,CAACxK,OAAO,EAAE;OACjD8C,IAAI,CAACwI,MAAM,GAAGA,MAAM;OACpBxI,IAAI,CAAC0I,GAAG,GAAGD,iBAAiB,CAACxJ,GAAG,CAAC,KAAK,CAAC;OACvCe,IAAI,CAACN,iBAAiB,GAAG,IAAI,CAACjD,OAAO,CAACkD,eAAe,CAAC1B,EAAE;OACxD+B,IAAI,CAACJ,mBAAmB,GAAG,IAAI,CAACnD,OAAO,CAACkD,eAAe,CAACE,IAAI;OAC5DG,IAAI,CAAC2I,QAAQ,GAAG,IAAI,CAAClM,OAAO,CAACqB,MAAM,CAAC8K,IAAI;OAExCxM,EAAE,CAACC,IAAI,CAACkL,kBAAkB,CAACvH,IAAI,CAAC;;;KAChC;KAAA,6BAGD;OAAA;OACCjD,6BAAY,CAACC,SAAS,CAAC,0BAA0B,EAAE,IAAI,CAAC6L,iBAAiB,CAACrL,IAAI,CAAC,IAAI,CAAC,CAAC;OACrFsK,MAAM,CAAC3D,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC2E,WAAW,CAACtL,IAAI,CAAC,IAAI,CAAC,CAAC;OAEpE,IAAIsK,MAAM,CAACiB,GAAG,KAAKjB,MAAM,EACzB;SACCA,MAAM,CAAC3D,gBAAgB,CAAC,SAAS,EAAE,UAAClH,KAAmB,EAAK;WAC3D,IAAIA,KAAK,CAAC+C,IAAI,KAAK,aAAa,EAChC;aACC,KAAI,CAAC8I,WAAW,EAAE;;UAEnB,CAAC;;OAGH,IAAI,IAAI,CAACrB,UAAU,CAAC7G,QAAQ,CAACoI,WAAW,CAAC/B,IAAI,KAAK,IAAI,IAAI,IAAI,CAACJ,UAAU,EACzE;SACC,IAAI,IAAI,CAACA,UAAU,CAACoC,cAAc,CAAC,YAAY,CAAC,EAChD;WACC,IAAI,CAACpC,UAAU,CAACqC,aAAa,EAAE,CAACC,SAAS,CAAC,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAAC5L,IAAI,CAAC,IAAI,CAAC,CAAC;WAEzF,IAAI6L,UAAU,GAAG,IAAI,CAACxC,UAAU,CAACyC,aAAa,EAAE;WAChD,IAAIC,SAAS,GAAGC,iBAAO,CAACC,KAAK,CAACJ,UAAU,CAACK,YAAY,EAAE,CAAC;WAExD,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,SAAS,CAACK,MAAM,EAAED,CAAC,EAAE,EACzC;aACC,IAAIE,QAAQ,GAAGN,SAAS,CAACI,CAAC,CAAC;aAC3B,IAAIG,eAAe,GAAGN,iBAAO,CAACC,KAAK,CAACI,QAAQ,CAAC3N,OAAO,CAAC;aACrD4N,eAAe,CAACC,OAAO,GAAG,IAAI,CAACC,uBAAuB,CAACxM,IAAI,CAAC,IAAI,CAAC;aAEjE6L,UAAU,CAACY,cAAc,CAACJ,QAAQ,CAACK,KAAK,EAAE,CAAC;aAC3Cb,UAAU,CAACc,WAAW,CAACL,eAAe,CAAC;;UAExC,MAED;WACC,IAAI,CAACjD,UAAU,CAACsC,SAAS,CAAC,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAAC5L,IAAI,CAAC,IAAI,CAAC,CAAC;;;OAG3E,IAAI,IAAI,CAAC0J,kBAAkB,EAC3B;SACC,IAAImC,WAAU,GAAG,IAAI,CAACnC,kBAAkB,CAACoC,aAAa,EAAE;SACxD,IAAIc,cAAc,GAAGf,WAAU,CAACgB,WAAW,CAAC,UAAU,CAAC,CAACnO,OAAO;SAC/DkO,cAAc,CAACL,OAAO,GAAG,IAAI,CAACO,gCAAgC,CAAC9M,IAAI,CAAC,IAAI,CAAC;SAEzE6L,WAAU,CAACY,cAAc,CAAC,UAAU,CAAC;SACrCZ,WAAU,CAACc,WAAW,CAACC,cAAc,CAAC;SAEtC,IAAIG,cAAc,GAAGlB,WAAU,CAACgB,WAAW,CAAC,SAAS,CAAC,CAACnO,OAAO;SAC9DqO,cAAc,CAACR,OAAO,GAAG,IAAI,CAACS,kBAAkB,CAAChN,IAAI,CAAC,IAAI,CAAC;SAE3D6L,WAAU,CAACY,cAAc,CAAC,SAAS,CAAC;SACpCZ,WAAU,CAACc,WAAW,CAACI,cAAc,CAAC;;OAGvC5M,gBAAI,CAACX,SAAS,CAAC,IAAIuE,oBAAoB,CAAC;SACvCL,UAAU,EAAE,IAAI;SAChBzE,OAAO,EAAE,IAAI,CAACA,OAAO;SACrBwE,WAAW,EAAE,IAAI,CAACqG;QAClB,CAAC,CAAC;OACH3J,gBAAI,CAACX,SAAS,CAAC,IAAIwF,oBAAoB,CAAC;SACvCtB,UAAU,EAAE,IAAI;SAChBzE,OAAO,EAAE,IAAI,CAACA,OAAO;SACrBwE,WAAW,EAAE,IAAI,CAACqG;QAClB,CAAC,CAAC;;;KACH;KAAA,iCAEgBpL,OAAO,EACxB;OACCA,OAAO,CAACuO,MAAM,GAAG;SAChBC,qBAAqB,EAAE,IAAI,CAACC,yBAAyB,CAACnN,IAAI,CAAC,IAAI,CAAC;SAChEoN,eAAe,EAAE,IAAI,CAACC,mBAAmB,CAACrN,IAAI,CAAC,IAAI,CAAC;SACpDsN,YAAY,EAAE,IAAI,CAACC,gBAAgB,CAACvN,IAAI,CAAC,IAAI,CAAC;SAC9CwN,MAAM,EAAE,IAAI,CAACC,UAAU,CAACzN,IAAI,CAAC,IAAI,CAAC;SAClC0N,SAAS,EAAE,IAAI,CAACC,aAAa,CAAC3N,IAAI,CAAC,IAAI,CAAC;SACxC4N,OAAO,EAAE,IAAI,CAACC,WAAW,CAAC7N,IAAI,CAAC,IAAI,CAAC;SACpC8N,cAAc,EAAE,IAAI,CAACC,kBAAkB,CAAC/N,IAAI,CAAC,IAAI;QACjD;OAED,IAAItB,OAAO,CAAC0E,QAAQ,CAACoI,WAAW,CAACwC,MAAM,EACvC;SACCtP,OAAO,CAACuO,MAAM,CAACgB,eAAe,GAAG,IAAI,CAACC,mBAAmB,CAAClO,IAAI,CAAC,IAAI,CAAC;;OAGrE,IAAI,CAACiK,UAAU,GAAGvL,OAAO;OACzB,IAAI,CAACyP,MAAM,GAAG,IAAIC,OAAO,CAACC,SAAS,CAAC,IAAI,CAAClF,UAAU,CAAC1I,EAAE,EAAE/B,OAAO,CAAC;;;KAChE;KAAA,+CAGD;OACC,IAAI4L,MAAM,CAACiB,GAAG,KAAKjB,MAAM,IAAI,CAAC1L,EAAE,CAAC0P,QAAQ,CAAC,mCAAmC,CAAC,EAC9E;SACC/C,GAAG,CAAC3M,EAAE,CAAC2P,OAAO,CAAC,MAAM,CAAC;;;;KAEvB;KAAA,mCAGD;OACC,IAAMC,cAAc,GAAG5P,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACtE,IAAIkE,cAAc,EAClB;SACC5P,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACqE,cAAc,CAACnE,MAAM,EAAE,yBAAyB,EAAE;WACvEnI,eAAe,EAAE,IAAI,CAACA,eAAe;WACrC7B,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB;UACrB,CAAC;;OAGHf,6BAAY,CAACmP,IAAI,CAAC,yBAAyB,EAAE;SAC5CvM,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC7B,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB;QACrB,CAAC;;;KACF;KAAA,oCAGD;OACC,IAAMkO,cAAc,GAAG5P,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACtE,IAAIqE,OAAO,GAAG,MAAM;OACpB,IAAIH,cAAc,EAClB;SACCG,OAAO,GAAGH,cAAc,CAAC9O,OAAO,EAAE,CAAC+B,GAAG,CAAC,SAAS,CAAC,IAAI,MAAM;SAE3D7C,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACqE,cAAc,CAACnE,MAAM,EAAE,0BAA0B,EAAE;WACxEnI,eAAe,EAAE,IAAI,CAACA,eAAe;WACrC7B,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB,MAAM;WAC3BqO,OAAO,EAAEA;UACT,CAAC;;OAGHpP,6BAAY,CAACmP,IAAI,CAAC,0BAA0B,EAAE;SAC7CvM,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC7B,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB,MAAM;SAC3BqO,OAAO,EAAEA;QACT,CAAC;;;KACF;KAAA,wCAGD;OACC,IAAIhE,oCAAU,CAACiE,mBAAmB,EAAE,EACpC;SACCjE,oCAAU,CAACkE,aAAa,EAAE;SAE1B;;OAGD,IAAI,CAACC,uBAAuB,EAAE;;;KAC9B;KAAA,qCAGD;OACC,QAAQ,IAAI,CAAClF,kBAAkB;SAE9B,KAAKmF,0CAAkB,CAACC,kBAAkB;WACxC,IAAIC,mCAAW,EAAE,CAAEC,iCAAiC,CAAC;aACrD5O,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB;YACrB,CAAC;WACF;SACD,KAAKyO,0CAAkB,CAACI,YAAY;WAClC,IAAIF,mCAAW,EAAE,CAAEC,iCAAiC,CAAC;aACrD5O,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB;YACrB,CAAC;WACF;SACD,KAAKyO,0CAAkB,CAACK,YAAY;WAClC,IAAIH,mCAAW,EAAE,CAAEI,4BAA4B,CAAC;aAChD/O,MAAM,EAAE,IAAI,CAACrB,OAAO,CAACqB;YACrB,CAAC;WACF;SACD,KAAKyO,0CAAkB,CAACO,kBAAkB;WACzC1Q,EAAE,CAAC6G,EAAE,CAAC8J,UAAU,CAACC,IAAI,CAAC,uCAAuC,CAAC;WAC9D;;;;KAEF;KAAA,iDAEgC/P,KAAK,EAAE4M,QAAkB,EAC1D;OACC,IAAIA,QAAQ,CAACoD,OAAO,CAACC,8BAA8B,EACnD;SACCC,IAAI,CAACtD,QAAQ,CAACoD,OAAO,CAACG,0BAA0B,CAAC;SAEjD;;OAGDC,8BAAY,CAACC,SAAS,CAAC,IAAI,CAAC7Q,OAAO,CAACqB,MAAM,CAACG,EAAE,CAAC;;;KAC9C;KAAA,wCAEuBhB,KAAK,EAAE4M,QAAkB,EACjD;OACC,IAAI0D,WAAW,GAAG1D,QAAQ,CAACK,KAAK,EAAE;OAClC,IAAGqD,WAAW,KAAK,YAAY,EAC/B;SACC,IAAI,CAACnE,qBAAqB,EAAE;SAE5B;;OAGDhN,EAAE,CAACC,IAAI,CAACmR,MAAM,CAACC,OAAO,CAACC,aAAa,CAAC;SACpCxP,IAAI,EAAE,IAAI,CAACzB,OAAO,CAACqB,MAAM,CAACI,IAAI;SAC9ByP,QAAQ,EAAE,IAAI,CAAClR,OAAO,CAACqB,MAAM,CAACG,EAAE;SAChC2P,gBAAgB,EAAE,IAAI,CAACnR,OAAO,CAAC4K,cAAc,CAACpJ,EAAE;SAChDsP,WAAW,EAAEA;QACb,CAAC;;;KACF;KAAA,wCAGD;OAAA;OACC5P,gBAAI,CAACX,SAAS,CAAC;SACd6Q,QAAQ,EAAE,MAAM;SAChBC,OAAO,EAAE,YAAY;SACrBC,QAAQ,EAAE,kBAAC/N,IAAI,EAAK;WACnB,IAAIA,IAAI,CAACH,IAAI,KAAK,MAAI,CAACF,eAAe,CAACE,IAAI,EAC3C;aACC,MAAI,CAACmO,gBAAgB,EAAE;aAEvBlG,MAAM,CAAC1L,EAAE,CAACC,IAAI,CAAC4R,yBAAyB,EAAE;aAC1C7R,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACsG,KAAK,EAAE;;;QAG/B,CAAC;;;KACF;KAAA,qCAGD;OACC1P,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;OACjC,IAAMiJ,aAAa,GAAGtL,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACrE,IAAI,CAACJ,aAAa,EAClB;SACC;;OAGDA,aAAa,CAACxK,OAAO,EAAE,CAACgD,GAAG,CAAC,wBAAwB,EAAE,IAAI,CAAC;OAC3D,IAAI,CAAC4I,WAAW,EAAE;OAClBpB,aAAa,CAACwG,KAAK,EAAE;;;KACrB;KAAA,wCAGD;OACC,IAAI,IAAI,CAACC,oBAAoB,EAC7B;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC,IAAI,CAACC,mBAAmB,EAC7B;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI;;;KACX;KAAA,kCAEiBnR,KAAgB,EAClC;OACCuB,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;OAEhC,IAAMiJ,aAAa,GAAGtL,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACrE,IAAI,CAACJ,aAAa,EAClB;SACC;;OAGD,IAAMe,iBAAiB,GAAGf,aAAa,CAACxK,OAAO,EAAE;OACjD,IAAMwL,GAAG,GAAGD,iBAAiB,CAACxJ,GAAG,CAAC,KAAK,CAAC;;;OAGxC,qBAAsBhC,KAAK,CAACC,OAAO,EAAE;SAAA;SAA9BmR,WAAW;OAClB,IAAIA,WAAW,CAACC,SAAS,EAAE,CAACpR,OAAO,EAAE,CAAC+B,GAAG,CAAC,KAAK,CAAC,KAAKyJ,GAAG,EACxD;SACC;;OAGD,IAAI,IAAI,CAAC7E,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC0K,qBAAqB,EAAE,EACtD;SACC,IAAI,CAACzF,WAAW,EAAE;SAElB;;OAGD,IAAI,IAAI,CAAC6C,MAAM,CAAC1C,cAAc,CAAC,cAAc,CAAC,EAC9C;SACC,IAAIR,iBAAiB,CAACxJ,GAAG,CAAC,wBAAwB,CAAC,EACnD;WACC;;SAGD,IAAI,CAAC0M,MAAM,CAAC6C,YAAY,EAAE;SAC1BH,WAAW,CAACI,UAAU,EAAE;QACxB,MAED;SACC,IAAI,CAAC3F,WAAW,EAAE;;;;KAEnB;KAAA,8BAGD;OACCtK,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;OAE1Bd,gBAAI,CAACE,qBAAqB,CAAC,CAAC,IAAI,CAACpB,OAAO,CAACqB,MAAM,CAACC,aAAa,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE;SACvFK,UAAU,EAAE,IAAI,CAAC3B,OAAO,CAACI,WAAW,CAACoB;QACrC,CAAC;OAEF,IAAI,CAACsJ,kBAAkB,CAAC,MAAM,CAAC;OAE/B,IAAI,CAACmH,iBAAiB,EAAE;OAExB,IAAI,IAAI,CAACC,6BAA6B,EACtC;SACC;;OAGD5F,GAAG,CAAC3M,EAAE,CAACC,IAAI,CAACuS,cAAc,CAAC;SAC1B3Q,EAAE,EAAE,IAAI,CAAC0B,eAAe,CAAC1B,EAAE;SAC3B4B,IAAI,EAAE,IAAI,CAACF,eAAe,CAACE,IAAI;SAC/BgP,kBAAkB,EAAE,IAAI,CAACA;QACzB,CAAC;;;KACF;KAAA,0CAEyB5R,KAAK,EAC/B;OACC,IAAI,CAAC,IAAI,CAACmR,mBAAmB,IAAI,CAAC,IAAI,CAACU,eAAe,EACtD;SACC;;OAGD,IAAI/P,IAAI,CAACC,GAAG,EAAE,GAAG+P,IAAI,CAACC,GAAG,CAAC,IAAI,CAACZ,mBAAmB,EAAE,IAAI,CAACU,eAAe,CAAC,GAAG,GAAG,EAC/E;SACC;;OAGD,IAAI,CAACD,kBAAkB,GAAG,IAAI;;;KAC9B;KAAA,qCAGD;OACC,OAAO,IAAI,CAACA,kBAAkB;;;KAC9B;KAAA,6BAGD;OACC,OAAO,IAAI,CAACpH,UAAU,CAACwH,YAAY,CAACzP,IAAI,KAAK,MAAM;;;KACnD;KAAA,6BAGD;OACC,OAAO,CAAC,IAAI,CAACyI,UAAU,EAAE;;;KACzB;KAAA,6BAGD;OACC,IAAI,IAAI,CAACpE,UAAU,EAAE,EACrB;SACCjD,QAAQ,CAACC,QAAQ,GAAG,IAAI,CAAC6F,UAAU;;;;KAEpC;KAAA,6BAGD;OACC,IAAI,CAACoI,eAAe,GAAG/P,IAAI,CAACC,GAAG,EAAE;;;KACjC;KAAA,8BAEakQ,CAAC,EACf;OACC1Q,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEyQ,CAAC,CAAClP,IAAI,CAAC;;;KAC1C;KAAA,4BAEWkP,CAAC,EACb;OAAA;OACC1Q,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEyQ,CAAC,CAAClP,IAAI,CAAC;OAExC,IAAIkP,CAAC,CAAClP,IAAI,CAACmP,SAAS,KAAK,CAAC,EAAE,EAC5B;SACC,IAAI,CAAChB,oBAAoB,GAAG,IAAI;SAChC,IAAI,CAACiB,qBAAqB,EAAE;QAC5B,MACI,IAAIF,CAAC,CAAClP,IAAI,CAACmP,SAAS,KAAK,CAAC,EAAE,EACjC;SACCE,UAAU,CAAC,YAAM;WACf,IAAI/K,kBAAkB,EAAE,CAAEgL,gBAAgB,CAC1C,MAAI,CAAC7S,OAAO,CAACqB,MAAM,CAACI,IAAI,EACxB,MAAI,CAACqR,oBAAoB,EAAE,EAC3B,MAAI,CAAC9O,YAAY,EAAE,EACnB,MAAI,CAACiE,cAAc,CACnB;UAED,EAAE,GAAG,CAAC;;;;KAER;KAAA,wCAGD;OACC,IAAI,CAAC,IAAI,CAACjI,OAAO,CAACkD,eAAe,CAAC1B,EAAE,IAAI,CAAC,IAAI,CAACkQ,oBAAoB,EAClE;SACC;;OAGD,IAAMqB,GAAG,2BAAoB,IAAI,CAAC/S,OAAO,CAACkD,eAAe,CAAC1B,EAAE,CAAE;OAC9D,IAAMwR,QAAQ,GAAGvJ,KAAK,CAACjH,GAAG,CAACuQ,GAAG,CAAC;OAC/B,IAAIC,QAAQ,IAAI1Q,IAAI,CAACC,GAAG,EAAE,GAAGyQ,QAAQ,GAAG,IAAI,GAAG,EAAE,EACjD;SACC;;OAGDnQ,cAAI,CAACoQ,SAAS,CAAC,kDAAkD,EAAE;SAClElQ,IAAI,EAAE,MAAM;SACZC,IAAI,EAAE;WACLkQ,KAAK,EAAE,IAAI;WACXC,SAAS,EAAE,IAAI,CAACjQ,eAAe,CAAC1B,EAAE;WAClC2B,mBAAmB,EAAE,IAAI,CAACD,eAAe,CAACE;;QAE3C,CAAC,CAACC,IAAI,CAAC,UAACC,QAAQ,EAAK;SACrB,IAAIA,QAAQ,CAACV,MAAM,KAAK,SAAS,EACjC;WACCuB,QAAQ,CAACC,QAAQ,CAACgP,IAAI,GAAG9P,QAAQ,CAACC,IAAI,CAACU,IAAI;;QAE5C,CAAC;OAEFwF,KAAK,CAAChG,GAAG,CAACsP,GAAG,EAAEzQ,IAAI,CAACC,GAAG,EAAE,CAAC;;;KAC1B;KAAA,oCAEmB/B,KAAK,EACzB;OACC,IAAM6S,OAAO,GAAG7S,KAAK,CAAC+C,IAAI;OAC1BV,cAAI,CAACoQ,SAAS,CAAC,oCAAoC,EAAE;SACpDlQ,IAAI,EAAE,MAAM;SACZC,IAAI,EAAE;WACLC,iBAAiB,EAAE,IAAI,CAACjD,OAAO,CAACkD,eAAe,CAAC1B,EAAE;WAClD2B,mBAAmB,EAAE,IAAI,CAACnD,OAAO,CAACkD,eAAe,CAACE,IAAI;WACtDiQ,OAAO,EAAEA;;QAEV,CAAC;;;KACF;KAAA,iCAEgB7S,KAAK,EACtB;;KACC;KAAA,sCAGD;OACC,IAAI,CAACsK,kBAAkB,CAAC,OAAO,CAAC;OAEhC,IAAI,CAAC6G,mBAAmB,GAAGrP,IAAI,CAACC,GAAG,EAAE;;;KACrC;KAAA,0CAGD;OACC,IAAI,CAAC2P,6BAA6B,GAAG,IAAI;OAEzC,IAAIlI,UAAU,GAAGrK,EAAE,CAAC2T,IAAI,CAACC,aAAa,CACrC,gCAAgC,EAChC;SACCxH,MAAM,EAAE,mCAAmC;SAC3C+E,WAAW,EAAE,YAAY;SACzB7N,iBAAiB,EAAE,IAAI,CAACC,eAAe,CAAC1B,EAAE;SAC1C2B,mBAAmB,EAAE,IAAI,CAACD,eAAe,CAACE;QAC1C,CACD;OAED,IAAI,IAAI,CAAC4G,UAAU,EACnB;SACCA,UAAU,GAAG,IAAI,CAACA,UAAU;;OAG7B,IAAMiB,aAAa,GAAGtL,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACC,iBAAiB,CAACC,MAAM,CAAC;OACrE,IAAI,CAACJ,aAAa,EAClB;SACCI,MAAM,CAACjH,QAAQ,GAAG4F,UAAU;SAE5B;;OAGD,IAAIwJ,kBAAkB,GAAGvI,aAAa,CAACwI,qBAAqB,EAAE;OAC9DxI,aAAa,CAACwG,KAAK,EAAE;OAErB9R,EAAE,CAACuL,SAAS,CAACC,QAAQ,CAACuI,IAAI,CACzB1J,UAAU,EAAE;SACZ2J,KAAK,EAAE,MAAM;SACbH,kBAAkB,EAAEA,kBAAkB;SACtCI,SAAS,EAAE,KAAK;SAChBC,kBAAkB,EAAE,KAAK;SACzBtQ,IAAI,EAAE;WACLuQ,cAAc,EAAE;;QAEjB,CAAC;;;KACF;KAAA,4BAGD;OACC,OAAO,IAAI,CAAC5E,MAAM;;;KAClB;KAAA,gCAGD;OACC,OAAO,IAAI,CAAChF,UAAU;;;KACtB;KAAA,uCAGD;OACC,OAAO,IAAI,CAACC,iBAAiB;;;KAC7B;KAAA,+BAGD;OACC,OAAO,IAAI,CAACnC,UAAU;;;GACtB;CAAA;CAAA,uBA9hBD;GACEnF,cAAI,CAACC,kBAAkB,CAAC,oCAAoC,EAAE,2BAA2B,EAAE;KAC1FC,IAAI,EAAE,MAAM;KACZC,IAAI,EAAE;OACLC,iBAAiB,EAAE,IAAI,CAACjD,OAAO,CAACkD,eAAe,CAAC1B,EAAE;OAClD2B,mBAAmB,EAAE,IAAI,CAACnD,OAAO,CAACkD,eAAe,CAACE;;IAEnD,CAAC;CACJ;;KCvGoB2Q,OAAO;GAK3B,iBAAYC,cAA8B,EAC1C;KAAA;KAAA,qDAJmC,IAAI;KAAA,4CAClB,IAAI;KAIxB,IAAMvU,OAAO,GAAGoK,cAAI,CAACC,aAAa,CAACkK,cAAc,CAAC,GAAGA,cAAc,GAAG,EAAE;KAExE,IAAI,CAAC9Q,eAAe,GAAGzD,OAAO,CAACyD,eAAe;KAC9C,IAAI,CAAC7B,MAAM,GAAG5B,OAAO,CAAC4B,MAAM;KAE5B,IAAM4S,MAAM,GAAG,IAAItU,EAAE,CAACuU,MAAM,CAAC;OAC5B/K,MAAM,EAAE1J,OAAO,CAACuI;MAChB,CAAC;KACFiM,MAAM,CAAC1D,IAAI,EAAE;KAEb,IAAI,CAAClQ,UAAU,EAAE;;GACjB;KAAA;KAAA,6BAGD;OACCa,gBAAI,CAACX,SAAS,CAAC;SACd4T,IAAI,EAAExU,EAAE,CAAC+E,UAAU,CAACC,gBAAgB,CAACC,MAAM;SAC3CwM,QAAQ,EAAE,MAAM;SAChBC,OAAO,EAAE,YAAY;SACrBC,QAAQ,EAAE,IAAI,CAACnL,mBAAmB,CAACpF,IAAI,CAAC,IAAI;QAC5C,CAAC;;;KACF;KAAA,oCAEmBwC,IAAI,EACxB;OACCxB,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEuB,IAAI,CAAC;OAExCV,cAAI,CAACoQ,SAAS,CAAC,4CAA4C,EAAE;SAC5DlQ,IAAI,EAAE,MAAM;SACZC,IAAI,EAAE;WACLmQ,SAAS,EAAE,IAAI,CAACjQ,eAAe,CAAC1B,EAAE;WAClC2B,mBAAmB,EAAE,IAAI,CAACD,eAAe,CAACE;;QAE3C,CAAC,CAACC,IAAI,CAAC,UAACC,QAAQ,EAAK;SACrB,IAAIA,QAAQ,CAACV,MAAM,KAAK,SAAS,EACjC;WACCuB,QAAQ,CAACC,QAAQ,CAACgP,IAAI,GAAG9P,QAAQ,CAACC,IAAI,CAACL,eAAe,CAACe,IAAI;;QAE5D,CAAC;;;GACF;CAAA;;;;;;;;;;"}