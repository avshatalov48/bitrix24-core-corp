this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,n){"use strict";var o=function(){function e(i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"editor",null);babelHelpers.defineProperty(this,"editorJson",null);babelHelpers.defineProperty(this,"editorNode",null);babelHelpers.defineProperty(this,"editorWrapperNode",null);babelHelpers.defineProperty(this,"targetNode",null);babelHelpers.defineProperty(this,"documentSession",null);babelHelpers.defineProperty(this,"object",null);babelHelpers.defineProperty(this,"documentWasChanged",false);babelHelpers.defineProperty(this,"dontEndCurrentDocumentSession",false);var n=t.Type.isPlainObject(i)?i:{};this.documentSession=n.documentSession;this.object=n.object;this.targetNode=n.targetNode;this.editorNode=n.editorNode;this.editorWrapperNode=n.editorWrapperNode;this.initializeEditor(n.editorJson);var o=BX.SidePanel.Instance.getSliderByWindow(window);o.getData().set("documentSession",this.documentSession);this.bindEvents()}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){i.EventEmitter.subscribe("SidePanel.Slider:onClose",this.handleClose.bind(this))}},{key:"initializeEditor",value:function e(t){this.adjustEditorHeight(t);t.events={onDocumentStateChange:this.handleDocumentStateChange.bind(this),onDocumentReady:this.handleDocumentReady.bind(this),onInfo:this.handleInfo.bind(this)};if(t.document.permissions.edit===true){t.events.onRequestEditRights=this.handleRequestEditRights.bind(this)}this.editorJson=t;this.editor=new DocsAPI.DocEditor(this.editorNode.id,t)}},{key:"adjustEditorHeight",value:function e(t){t.height=document.body.clientHeight+"px"}},{key:"emitEventOnSaved",value:function e(){var t=BX.SidePanel.Instance.getSliderByWindow(window);if(t){BX.SidePanel.Instance.postMessageAll(window,"Disk.OnlyOffice:onSaved",{documentSession:this.documentSession,object:this.object})}i.EventEmitter.emit("Disk.OnlyOffice:onSaved",{documentSession:this.documentSession,object:this.object})}},{key:"emitEventOnClosed",value:function e(){var t=BX.SidePanel.Instance.getSliderByWindow(window);var n="edit";if(t){n=t.getData().get("process")||"edit";BX.SidePanel.Instance.postMessageAll(window,"Disk.OnlyOffice:onClosed",{documentSession:this.documentSession,object:this.object,process:n})}i.EventEmitter.emit("Disk.OnlyOffice:onClosed",{documentSession:this.documentSession,object:this.object,process:n})}},{key:"handleSaveButtonClick",value:function e(){var t=this;n.PULL.subscribe({moduleId:"disk",command:"onlyoffice",callback:function e(i){if(i.hash===t.documentSession.hash){t.emitEventOnSaved();window.BX.Disk.showModalWithStatusAction();BX.SidePanel.Instance.close()}}})}},{key:"handleClose",value:function e(){this.emitEventOnClosed();if(this.dontEndCurrentDocumentSession){return}top.BX.Disk.endEditSession({id:this.documentSession.id,hash:this.documentSession.hash,documentWasChanged:this.documentWasChanged})}},{key:"handleDocumentStateChange",value:function e(t){if(!this.caughtDocumentReady||!this.caughtInfoEvent){return}if(Date.now()-Math.max(this.caughtDocumentReady,this.caughtInfoEvent)<500){return}this.documentWasChanged=true}},{key:"handleInfo",value:function e(){this.caughtInfoEvent=Date.now()}},{key:"handleDocumentReady",value:function e(){this.caughtDocumentReady=Date.now()}},{key:"handleRequestEditRights",value:function e(){this.dontEndCurrentDocumentSession=true;var t=BX.SidePanel.Instance.getSliderByWindow(window);var i=t.getCustomLeftBoundary();t.close();BX.SidePanel.Instance.open(BX.util.add_url_param("/bitrix/services/main/ajax.php",{action:"disk.api.documentService.goToEdit",serviceCode:"onlyoffice",documentSessionId:this.documentSession.id,documentSessionHash:this.documentSession.hash}),{width:"100%",customLeftBoundary:i,cacheable:false,allowChangeHistory:false,data:{documentEditor:true}})}},{key:"getEditor",value:function e(){return this.editor}},{key:"getEditorNode",value:function e(){return this.editorNode}},{key:"getEditorWrapperNode",value:function e(){return this.editorWrapperNode}},{key:"getContainer",value:function e(){return this.targetNode}}]);return e}();e.OnlyOffice=o})(this.BX.Disk.Editor=this.BX.Disk.Editor||{},BX,BX.Event,BX);
//# sourceMappingURL=script.map.js