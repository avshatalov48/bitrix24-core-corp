{"version":3,"sources":["src/options.js","src/items/item-new.js","src/file-uploader.js","src/controllers/default-controller.js","src/items/item-more.js","src/backend.js","src/items/item.js","src/items/item-image.js","src/controllers/file-parser.js","src/items/index.js","src/controllers/file-controller.js","src/controllers/settings-controller.js","src/controllers/document-controller.js","src/controllers/panel-controller.js","src/controllers/file-selector.js","src/items/item-new-selected-cloud.js","src/controllers/file-selector-cloud.js","src/controllers/file-mover.js","src/form-brief.js","src/form.js","src/index.js","script-old.js"],"names":["Options","optionsToSet","optionName","hasOwnProperty","documentHandlers","code","handler","find","width","height","ItemNew","fileId","fileObject","id","object","data","NAME","name","EventEmitter","subscribe","onUploadProgress","bind","onUploadDone","onUploadError","progress","BX","UI","ProgressRound","colorTrack","colorBar","lineSize","statusType","Status","INCIRCLE","textBefore","textAfter","size","container","extension","split","pop","toLowerCase","Text","encode","Tag","render","getContainer","onClickDelete","event","preventDefault","stopPropagation","emit","setTimeout","deleteFile","compatData","Math","min","max","getValue","update","file","hash","setTextBefore","Loc","getMessage","classList","add","FileUploader","dropZone","input","agent","Uploader","getInstance","allowUpload","uploadFormData","uploadMethod","uploadFileUrl","urlUpload","showImage","sortItems","pasteFileHashInForm","catchFile","packageFormer","previewParams","previewSize","exact","post","incrementItemsCount","item","itemData","blob","constructor","decrementItemsCount","convertToItemSavedType","itemContainer","removeChild","appendChild","progressPercent","ceil","random","files","onAttach","ID","attachId","IS_LOCKED","IS_MARK_DELETED","EDITABLE","FROM_EXTERNAL_SYSTEM","CAN_RESTORE","CAN_UPDATE","canChangeName","CAN_RENAME","CAN_MOVE","COPY_TO_ME_URL","DELETE_URL","DOWNLOAD_URL","EDIT_URL","VIEW_URL","PREVIEW_URL","previewUrl","BIG_PREVIEW_URL","replace","EXTENSION","ext","SIZE","SIZE_BYTES","sizeInt","STORAGE","storage","TYPE_FILE","fileType","Symbol","DefaultController","eventObject","Cache","MemoryCache","pluggedIn","properties","dataset","bxHtmlEditable","hasContainer","style","display","ItemMoreButton","cache","remember","onClick","getValueContainer","document","createElement","hiddenFilesCount","stepNumber","innerHTML","show","step","hide","itemsCount","stepValue","decrement","Backend","fileName","dialogName","Promise","resolve","ajax","get","Uri","addParam","urlSelect","ACTION","MULTI","join","wish","targetID","libLink","DiskFileDialog","obCurrentTab","link","use_light_view","AJAX_CALL","SIMPLE_UPLOAD","IFRAME","sessid","bitrix_sessid","SECTION_ID","CHECK_NAME","loadJSON","service","cloudImport","targetFolderId","Disk","method","dataType","url","addToLinkParam","attachedId","onsuccess","runAction","newName","Item","insertedInText","setEventNamespace","String","setData","onMoved","FILE_ID","key","getId","value","Dom","addClass","nameParts","length","nameWithoutExtension","substr","insertInText","isPluggedIn","onClickInsertInText","onClickMore","extensionNode","getNameWithoutExtension","getIcon","getNameBox","getDeleteButton","getButtonBox","querySelector","keys","forEach","node","Type","isDomNode","parentNode","has","getData","fullName","cleanName","substring","moreButton","contextMenu","Menu","getRandom","bindElement","items","bxRole","text","onclick","close","html","className","target","type","onRenamed","clearMenu","delimiter","onClickMoveTo","filter","preItem","angle","offsetLeft","destroy","deleteAction","getMenu","element_id","row","result","rename","renameAction","tagId","targetNode","currentTarget","targetNodeWidth","offsetWidth","PopupWindow","content","cacheable","animation","offsetTop","bindOptions","position","darkMode","events","onClose","onShow","popup","getTarget","getPopupContainer","setOffset","setAngle","offset","ItemImage","BIG_REVIEW_URL","justCounter","FileParser","fileController","init","htmlEditor","parse","unparse","regexp","tag","isStringFilled","RegExp","bbDelimiter","htmlDelimiter","getItemBBCode","getItemHTML","setInsertedInText","fileIds","getAllIds","GetViewMode","doc","GetIframeDoc","ii","bxTags","indexOf","getElementById","SaveContent","GetContent","str","foundId","SetContent","Focus","test","foundedItem","values","bxTag","itemId","getHTMLForHTMLEditor","SetBxTag","itemMappings","getItem","itemClassName","itemClass","detect","FileController","fieldName","multiple","Map","buildInHTMLEditor","getParser","hasInterface","getInterface","fileData","manualClearing","Object","uf","duplicateControlItems","isArray","prefixHTMLNode","stringId","img","infoNode","hasAttribute","getAttribute","src","push","set","e","console","log","clear","counter","maxVisibleCount","addItem","appendNode","getItemMore","reset","increment","setPluggedIn","insertFile","replaceChild","res","showMoreItems","timeoutCounter","itemMoreNode","opacity","visibility","insertBefore","addEventListener","removeClass","parser","SettingsController","allowEditNode","allowGridNode","checked","remove","bxSave","userOptions","save","bxName","buildDocumentServiceTextLabel","buildSubMenuWithDocumentServices","currentService","getDocumentService","isAvailableOnlyOffice","getDocumentHandler","getDocumentHandlers","saveDocumentService","getMenuWindow","getParentMenuItem","setText","getPopupWindow","DocumentController","Array","from","querySelectorAll","createDocument","documentType","insertDocumentIntoUf","extendedFileData","parts","Document","Local","Instance","isSetWorkWithLocalBDisk","createFile","then","response","createProcess","CreateProcess","typeFile","serviceCode","onAfterSave","status","getMetaDataForCreatedFileInUf","start","folderName","PanelController","FileSelector","openSection","selectFile","getSelectedData","obCallback","saveButton","openDialog","dialog2","tab","path","selected","unsubscribe","ItemNewSelectedCloud","ExternalLoader","startLoad","onFinish","newData","onProgress","FileSelectorCloud","services","getSelectedCloudData","ufId","sizeFormatted","FileMover","loadFolder","stopLoadingFolder","checkFileName","onApply","onCancel","getSelectedFile","getFileId","cancelButton","someDialogName","element","documentExists","permission","timeout","clearTimeout","showNotice","closeNotice","someData","folderByPath","moved","moveQuery","sectionProperties","sectionPath","moveFile","showModalWithStatusAction","showMovedFile","i","sectionID","iblockID","iblock_id","section_id","exist","obItems","subscribed","stopImmediatePropagation","fire","shift","instance","_camelToSNAKE","obj","o","k","toUpperCase","FormBrief","streams","params","fileSelector","onSelectionIsDone","fileSelectorCloud","attrs","setAttribute","element_name","element_url","getEventObject","BaseEvent","onFileIs","preview_url","onCustomEvent","Form","parserParams","getFileController","setParams","getFilesUploader","initDocumentController","settingsController","panelController","switcher","nodeItem","GLOBAL_TARGET","addTestThumb","addTestErrorThumb","documentController","isRelevant","bxDiskDocumentButton","closest","BODY","removeAttribute","filesController","filesUploader","fileToUpload","onSuccess","upload","reject","onFailed","image","showInitialLoader","getPanelController","hideInitialLoader","repo","isNodeInDom","addCustomEvent","UF","getBriefInstance","UID","controlName","findChild"],"mappings":"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AjB,GAA0B,CAAhD,IAAqD,CAAC4R,MAAM,CAAC,kBAAD,CAAhE,EACCvd,EAAE,CAACme,aAAH,CAAiBvd,SAAS,CAACkM,UAA3B,EAAuC,wBAAvC,EAAiE,CAAC,MAAD,CAAjE;CACD;CACD,CA/BD;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js.map","sourcesContent":["export default class Options\n{\n\tstatic urlUpload = null;\n\tstatic documentHandlers = null;\n\tstatic previewSize = {width: 115, height: 115};\n\n\tstatic set(optionsToSet: Object): void\n\t{\n\t\tfor (let optionName in optionsToSet)\n\t\t{\n\t\t\tif (Options.hasOwnProperty(optionName))\n\t\t\t{\n\t\t\t\tOptions[optionName] = optionsToSet[optionName];\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getDocumentHandlers(): Array<Object>\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn Options.documentHandlers;\n\t}\n\n\tstatic getDocumentHandler(code): Object\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tlet handler = Options.documentHandlers.find(function (handler) {\n\t\t\treturn handler.code === code;\n\t\t});\n\n\t\treturn handler || {};\n\t}\n}","import {Tag, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\n\nexport default class ItemNew\n{\n\tid: string;\n\tobject: Object;\n\tcontainer: Element;\n\tdata: Object;\n\tprogress;\n\n\tconstructor(fileId, fileObject)\n\t{\n\t\tthis.id = fileId;\n\t\tthis.object = fileObject;\n\t\tthis.data = {\n\t\t\tNAME: fileObject.name,\n\t\t};\n\t\tEventEmitter.subscribe(this.object, 'onUploadProgress', this.onUploadProgress.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadDone', this.onUploadDone.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadError', this.onUploadError.bind(this));\n\t\tthis.progress = new BX.UI.ProgressRound({\n\t\t\twidth: 18,\n\t\t\tcolorTrack: 'rgba(255,255,255,.3)',\n\t\t\tcolorBar: '#fff',\n\t\t\tlineSize: 3,\n\t\t\tstatusType: BX.UI.ProgressRound.Status.INCIRCLE,\n\t\t\ttextBefore: '<i></i>',\n\t\t\ttextAfter: this.object.size,\n\t\t});\n\t}\n\n\tgetContainer()\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tlet extension = this.object.name.split('.').pop().toLowerCase();\n\t\t\textension = Text.encode(extension === this.object.name ? '' : extension);\n\t\t\tthis.container = Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension} disk-file-thumb--active\">\n\t\t\t<div class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div class=\"disk-file-thumb-text\">${Text.encode(this.object.name)}</div>\n\t\t\t<div class=\"disk-file-thumb-loader\">\n\t\t\t\t${this.progress.getContainer()}\n\t\t\t\t<div class=\"disk-file-thumb-loader-btn\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t`;\n\t\t}\n\t\treturn this.container;\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tsetTimeout(() => { this.object.deleteFile(); }, 400);\n\t\tdelete this.container;\n\t}\n\n\tonUploadProgress({compatData: [fileObject, progress]})\n\t{\n\t\tprogress = Math.min(Math.max(this.progress.getValue(), progress), 98);\n\t\tthis.progress.update(progress);\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadDone', [file, fileObject.file]);\n\t\tdelete this.object.hash;\n\t\tthis.object.deleteFile();\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.setTextBefore(Loc.getMessage('WDUF_ITEM_ERROR'));\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t\tthis.object.deleteFile();\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport Options from './options';\nimport ItemNew from './items/item-new';\nimport 'main.core_uploader';\nimport type {ItemUploadedType, ItemSavedType} from \"./items/item-type\";\n\nexport default class FileUploader\n{\n\t#itemsCount: number = 0;\n\tcontainer: Element;\n\tstatic #deleted = Symbol('deleted');\n\n\n\tconstructor({id, container, dropZone, input})\n\t{\n\t\tthis.container = container;\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: dropZone,\n\t\t\tinput: input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tEventEmitter.subscribe(this.agent, 'onFileIsCreated', this.catchFile.bind(this));\n\t\tEventEmitter.subscribe(this.agent, 'onPackageIsInitialized', ({compatData: [packageFormer]}) => {\n\t\t\tconst previewParams = {\n\t\t\t\twidth: Options.previewSize.width,\n\t\t\t\theight: Options.previewSize.height,\n\t\t\t\texact: 'N'\n\t\t\t};\n\t\t\tif (packageFormer.data)\n\t\t\t{\n\t\t\t\tpackageFormer.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpackageFormer.post.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t});\n\t}\n\n\tcatchFile({compatData: [fileId, fileObject]})\n\t{\n\t\tthis.incrementItemsCount();\n\t\tconst item = new ItemNew(fileId, fileObject);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType, blob]}) => {\n\t\t\tif (!item[this.constructor.#deleted])\n\t\t\t{\n\t\t\t\tthis.decrementItemsCount();\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t\tblob: blob\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', ({data: [blob]}) => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer(), blob: blob});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\taddTestThumb(progressPercent)\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\tif (progressPercent > 0)\n\t\t{\n\t\t\titem.onUploadProgress({compatData: [null, progressPercent]})\n\t\t}\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\taddTestErrorThumb()\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\titem.onUploadError({compatData: [{file: null}]});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\tupload([...files])\n\t{\n\t\tthis.agent.onAttach(files);\n\t}\n\n\tconvertToItemSavedType(item: ItemUploadedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.attachId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: item.canChangeName,\n\t\t\tCAN_RENAME: item.canChangeName,\n\t\t\tCAN_MOVE:  item.canChangeName,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item.storage,\n\t\t\tTYPE_FILE: item.fileType,\n\t\t};\n\t}\n\tincrementItemsCount()\n\t{\n\t\tif (this.#itemsCount <= 0)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsStart');\n\t\t}\n\t\tthis.#itemsCount++;\n\t}\n\tdecrementItemsCount()\n\t{\n\t\tif (this.#itemsCount === 1)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsDone');\n\t\t}\n\n\t\tthis.#itemsCount = Math.max(this.#itemsCount--, 0);\n\t}\n}\n","import {Cache} from 'main.core';\n\nexport default class DefaultController {\n\thasContainer: boolean = false;\n\tcontainer: Element;\n\teventObject: Element;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false,\n\t};\n\n\tconstructor({container, eventObject})\n\t{\n\t\tthis.container = container;\n\t\tthis.eventObject = eventObject;\n\t\tthis.properties.pluggedIn = this.eventObject && this.eventObject.dataset.bxHtmlEditable === 'Y';\n\t\tif (!this.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hasContainer = true;\n\t}\n\n\n\tisRelevant()\n\t{\n\t\treturn this.hasContainer;\n\t}\n\n\tgetEventObject()\n\t{\n\t\treturn this.eventObject;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.container;\n\t}\n\n\tisPluggedIn(): boolean\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tshow()\n\t{\n\t\tthis.container.style.display = '';\n\t\tdelete this.container.style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.container.style.display = 'none';\n\t}\n}\n","import {Tag, Cache} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport default class ItemMoreButton\n{\n\thiddenFilesCount: number = 0;\n\tstepNumber: number = 0;\n\tcache = new Cache.MemoryCache();\n\tstepValue = 5;\n\n\tconstructor()\n\t{\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div class=\"ui-icon ui-icon-more disk-file-thumb-icon\">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class=\"disk-file-thumb-text\">${this.getValueContainer()}</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetValueContainer(): Element\n\t{\n\t\treturn this.cache.remember('valueContainer', () => {\n\t\t\treturn document.createElement('DIV');\n\t\t});\n\t}\n\n\treset()\n\t{\n\t\tthis.hiddenFilesCount = 1;\n\t\tthis.stepNumber = 0;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t\treturn this;\n\t}\n\n\tincrement()\n\t{\n\t\tthis.hiddenFilesCount++;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t}\n\n\tdecrement(step: number = 1)\n\t{\n\t\tthis.hiddenFilesCount -= step;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tif (this.hiddenFilesCount <= 0)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tthis.stepNumber++;\n\t\tconst itemsCount = Math.min(30, this.stepValue * this.stepNumber);\n\t\tthis.decrement(itemsCount);\n\t\tEventEmitter.emit(this, 'onGetMore', {itemsCount: itemsCount});\n\t}\n\n\tshow()\n\t{\n\t\tdelete this.getContainer().style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.getContainer().style.display = 'none';\n\t}\n}\n","import {ajax, Loc, Uri} from 'main.core';\n\nexport default class Backend\n{\n\tstatic urlSelect = '/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID=' +\n\t\tLoc.getMessage('SITE_ID') + '&dialog2=Y&ACTION=SELECT&MULTI=Y';\n\n\tstatic getSelectedFile(fileId, fileName, dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tACTION: 'none',\n\t\t\t\t\tMULTI: 'Y',\n\t\t\t\t\tID: ['E', fileId].join(''),\n\t\t\t\t\tNAME: fileName,\n\t\t\t\t\twish: 'fakemove',\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic loadFolder(fileId, fileName, dialogName)\n\t{\n\t\tconst targetID = fileId;\n\t\tconst libLink = Uri.addParam(\n\t\t\t[\n\t\t\t\tBX.DiskFileDialog.obCurrentTab[dialogName].link\n\t\t\t\t\t.replace('/index.php', '')\n\t\t\t\t\t.replace('/files/lib/', '/files/'),\n\t\t\t\t'element/upload',\n\t\t\t\ttargetID\n\t\t\t].join('/'),\n\t\t\t{\n\t\t\t\tuse_light_view: 'Y',\n\t\t\t\tAJAX_CALL: 'Y',\n\t\t\t\tSIMPLE_UPLOAD: 'Y',\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\tSECTION_ID: targetID,\n\t\t\t\tCHECK_NAME: fileName\n\t\t\t}\n\t\t);\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.loadJSON(libLink, {}, resolve);\n\t\t});\n\t}\n\n\tstatic getSelectedData(dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic getSelectedCloudData(dialogName, service)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tcloudImport: 1,\n\t\t\t\t\tservice: service,\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic moveFile(id, targetFolderId)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.Disk.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: BX.Disk.addToLinkParam('/bitrix/tools/disk/uf.php', 'action', 'moveUploadedFile'),\n\t\t\t\tdata: {\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\ttargetFolderId: targetFolderId\n\t\t\t\t},\n\t\t\t\tonsuccess: resolve\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic getMetaDataForCreatedFileInUf(id)\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'disk.api.file.getMetaDataForCreatedFileInUf',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tid: id\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic renameAction(id, newName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=renameFile',\n\t\t\t\t{\n\t\t\t\t\tnewName: newName,\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic deleteAction(id)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=deleteFile',\n\t\t\t\t{\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n}","import {Cache, Tag, Text, Type, Dom, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Menu} from 'main.popup';\nimport type {ItemSavedType} from './item-type';\nimport Backend from '../backend';\n\nexport default class Item extends EventEmitter\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false,\n\t\tinsertedInText: false,\n\t};\n\t#hintPopup: null;\n\n\tconstructor(itemData: ItemSavedType)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('Disk:UF:');\n\t\tthis.id = String(itemData['ID']);\n\n\t\tthis.setData(itemData);\n\t\tthis.subscribe('onMoved', this.onMoved.bind(this))\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetFileId(): string\n\t{\n\t\treturn this.data.FILE_ID;\n\t}\n\n\tgetData(key:?string)\n\t{\n\t\tif (key)\n\t\t{\n\t\t\treturn this.data[key];\n\t\t}\n\t\treturn this.data;\n\t}\n\n\tgetAllIds()\n\t{\n\t\treturn [this.getId(), ['n', this.data.FILE_ID].join('')];\n\t}\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t}\n\n\tsetPluggedIn(value: boolean = true): boolean\n\t{\n\t\tthis.properties.pluggedIn = (value === true);\n\t}\n\n\tisPluggedIn()\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tsetInsertedInText(value: boolean = true): boolean\n\t{\n\t\tthis.properties.insertedInText = (value === true);\n\t\tDom.addClass(this.getContainer(), '--edit-text-preview');\n\t}\n\n\tisInsertedInText(): boolean\n\t{\n\t\treturn this.properties.insertedInText;\n\t}\n\n\tgetNameWithoutExtension(): string\n\t{\n\t\tlet nameParts = this.data['NAME'].split('.');\n\t\tif (nameParts.length > 1)\n\t\t{\n\t\t\tnameParts.pop();\n\t\t}\n\n\t\tconst nameWithoutExtension = nameParts.join('.');\n\t\tif (nameWithoutExtension.length > 50)\n\t\t{\n\t\t\treturn nameWithoutExtension.substr(0, 39) + '...' + nameWithoutExtension.substr(-5);\n\t\t}\n\n\t\treturn nameWithoutExtension;\n\t}\n\n\t#handleMouseEnter(event: Event)\n\t{\n\t\tif (this.#hintPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetNode = event.currentTarget;\n\t\tconst targetNodeWidth = targetNode.offsetWidth;\n\n\t\tthis.#hintPopup = new BX.PopupWindow({\n\t\t\tcontent: Loc.getMessage('WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT'),\n\t\t\tcacheable: false,\n\t\t\tanimation: 'fading-slide',\n\t\t\tbindElement: targetNode,\n\t\t\toffsetTop: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tdarkMode: true,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.#hintPopup.destroy();\n\t\t\t\t\tthis.#hintPopup = null;\n\t\t\t\t},\n\t\t\t\tonShow: (event) => {\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.#hintPopup.show();\n\t}\n\n\t#handleMouseLeave(event: Event)\n\t{\n\t\tif (!this.#hintPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#hintPopup.close();\n\t\tthis.#hintPopup = null;\n\t}\n\n\tgetButtonBox(): HTMLElement\n\t{\n\t\tlet insertInText = '';\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tinsertInText = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"disk-file-thumb-btn-text-copy\"\n\t\t\t\t\tonclick=\"${this.onClickInsertInText.bind(this)}\"\n\t\t\t\t\tonmouseenter=\"${this.#handleMouseEnter.bind(this)}\"\n\t\t\t\t\tonmouseleave=\"${this.#handleMouseLeave.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t</div>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"disk-file-thumb-btn-box\">\n\t\t\t\t${insertInText}\n\t\t\t\t<div class=\"disk-file-thumb-btn-more\" data-bx-role=\"more\" onclick=\"${this.onClickMore.bind(this)}\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetDeleteButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"disk-file-thumb-btn-close-box\">\n\t\t\t\t<div class=\"disk-file-thumb-btn-close\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetNameBox(nameWithoutExtension, extension): HTMLElement\n\t{\n\t\tlet extensionNode = '';\n\t\tif (extension)\n\t\t{\n\t\t\textensionNode = Tag.render`<span class=\"disk-file-thumb-file-extension\">.${extension}</span>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"disk-file-thumb-text-box\">\n\t\t\t\t<div data-bx-role=\"name\" class=\"disk-file-thumb-text\">\n\t\t\t\t\t${nameWithoutExtension}\n\t\t\t\t\t${extensionNode}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetIcon(extension): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div data-bx-role=\"icon\" class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t`;\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\n\t\t\tconst nameWithoutExtension = Text.encode(this.getNameWithoutExtension());\n\t\t\tlet extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\tswitch (extension) {\n\t\t\t\tcase 'pptx':\n\t\t\t\t\textension = 'ppt';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension}\">\n\t\t\t${this.getIcon(extension)}\n\t\t\t${this.getNameBox(nameWithoutExtension, extension)}\n\t\t\t${this.getDeleteButton()}\n\t\t\t${this.getButtonBox()}\n\t\t</div>`;\n\t\t});\n\t}\n\n\trename(newName: string)\n\t{\n\t\tthis.data['NAME'] = newName;\n\t\tif (this.hasContainer())\n\t\t{\n\t\t\tthis.getContainer().querySelector('[data-bx-role=\"name\"]').innerHTML = Text.encode(this.data['NAME']);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tconst keys = this.cache.keys();\n\t\tkeys.forEach((key) => {\n\t\t\tconst node = this.cache.get(key);\n\t\t\tif (Type.isDomNode(node) && node.parentNode)\n\t\t\t{\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t}\n\t\t\tthis.cache.delete(key);\n\t\t});\n\n\t\tthis.emit('onDestroy');\n\t}\n\n\thasContainer(): boolean\n\t{\n\t\treturn this.cache.has('container');\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tlet extension = this.getData('NAME').split('.').pop();\n\t\textension = (extension === this.getData('NAME') ? '' : ['.', extension].join(''));\n\t\tconst fullName = String(this.getData('NAME'));\n\t\tconst cleanName = fullName.substring(0, fullName.length - extension.length);\n\n\t\treturn this.cache.remember('menu', () => {\n\t\t\tconst moreButton = this.getContainer().querySelector('div[data-bx-role=\\'more\\']');\n\t\t\tconst contextMenu = new Menu({\n\t\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\t\tbindElement: moreButton,\n\t\t\t\titems: ([\n\t\t\t\t\tthis.isPluggedIn() ? {\n\t\t\t\t\t\tdataset: {bxRole: 'insertIntoTheText'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT'),\n\t\t\t\t\t\tonclick : (event, item) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickInsertInText(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'deleteFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_DELETE'),\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickDelete(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t/*TODO For the Future\n\t\t\t\t\t   (this.data['CAN_UPDATE'] === true && this.data['EDITABLE'] === true ? {\n\t\t\t\t\t\ttext:  Loc.getMessage('WDUF_ITEM_MENU_EDIT'),\n\t\t\t\t\t\tclassName: 'menu-popup-item-edit',\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickEdit(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null),*/\n\t\t\t\t\t(this.data['CAN_RENAME'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'renameFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_RENAME'),\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml:\n\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t`<textarea class=\"disk-file-popup-rename-file-textarea\"\n\t\t\t\t\t\t\t\t\t\t\tname=\"rename\" onkeydown=\"if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector('input[name=save]'), 'click'); }\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"${Text.encode(cleanName)}\">${Text.encode(cleanName)}</textarea>`,\n\t\t\t\t\t\t\t\t\t\t`<div class=\"ui-btn-container ui-btn-container-center\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-primary\" name=\"save\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_SAVE')}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-link\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_CANCEL')}\">\n\t\t\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t\t\t].join(''),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-rename-form',\n\t\t\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\t\t\tif (Type.isDomNode(event.target) && event.target.type === 'button')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tif (event.target.name === 'save')\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.onRenamed([item.getContainer().querySelector('textarea').value, extension].join(''));\n\t\t\t\t\t\t\t\t\t\t\tthis.clearMenu();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t} : null),\n\t\t\t\t\t{\n\t\t\t\t\t\tdelimiter : true,\n\t\t\t\t\t\ttext: [\n\t\t\t\t\t\t\tLoc.getMessage('WDUF_ITEM_MENU_FILE'),\n\t\t\t\t\t\t\tText.encode(this.data['SIZE'])\n\t\t\t\t\t\t].join(' ')\n\t\t\t\t\t},\n\t\t\t\t\t(this.data['CAN_MOVE'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'moveFile'},\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\tevent['counter'] = (event['counter'] ?? 1) + 1;\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickMoveTo(event, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : {\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t})\n\t\t\t\t].\n\t\t\t\tfilter(preItem => preItem !== null)),\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: 9\n\t\t\t});\n\t\t\treturn contextMenu;\n\t\t});\n\t}\n\n\tclearMenu()\n\t{\n\t\tif (this.cache.has('menu'))\n\t\t{\n\t\t\tthis.cache.get('menu').destroy();\n\t\t\tthis.cache.delete('menu');\n\t\t}\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tthis.emit('onClick');\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.emit('onDelete');\n\t\tthis.destroy();\n\t\tBackend.deleteAction(this.getId());\n\t}\n\n\tonClickInsertInText(event: MouseEvent)\n\t{\n\t\tthis.emit('onClickInsertInText');\n\t}\n\n\tonClickMore(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.getMenu().show();\n\t}\n\n\tonClickEdit()\n\t{\n\n\t}\n\n\tonClickMoveTo(element_id, name, row)\n\t{\n\t\tconst result = EventEmitter.emit(BX.DiskFileDialog, 'onFileNeedsToMove', [this]);\n\t\treturn result.length > 0;\n\t}\n\n\tonMoved({data})\n\t{\n\t\tthis.data['STORAGE'] = data;\n\t\tthis.clearMenu();\n\t}\n\n\tonRenamed(newName)\n\t{\n\t\tif (this.getData('NAME') === newName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.rename(newName);\n\t\tBackend.renameAction(this.getId(), newName);\n\t}\n\n\t//region HTMLEditor functions\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\tif (this.getData('TYPE_FILE') === 'player')\n\t\t{\n\t\t\treturn `<img contenteditable=\"false\" class=\"bxhtmled-player-surrogate\" data-bx-file-id=\"${Text.encode(this.data.ID)}\" id=\"${tagId}\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" />`;\n\t\t}\n\t\treturn `<span contenteditable=\"false\" data-bx-file-id=\"${Text.encode(this.data.ID)}\" id=\"${tagId}\" style=\"color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;\">${Text.encode(this.data.NAME)}</span>`;\n\t}\n\t//endregion\n\n\tstatic detect()\n\t{\n\t\treturn true;\n\t}\n}\n","import {Cache, Tag, Text} from 'main.core';\nimport Item from './item';\nimport type {ItemSavedType} from './item-type';\n\nexport default class ItemImage extends Item\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t\tthis.data.BIG_REVIEW_URL = this.data.PREVIEW_URL.replace(/\\&(width|height)\\=\\d+/gi, '');\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\tconst nameWithoutExtension = Text.encode(this.getNameWithoutExtension());\n\t\t\tconst extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-preview\">\n\t\t\t<div style=\"background-image: url('${this.data['PREVIEW_URL']}'); background-size: cover;\" class=\"disk-file-thumb-image\"></div>\n\t\t\t${this.getIcon(extension)}\n\t\t\t${this.getNameBox(nameWithoutExtension, extension)}\n\t\t\t${this.getDeleteButton()}\n\t\t\t${this.getButtonBox()}\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\treturn `<img style=\"max-width: 90%;\" data-bx-file-id=\"${Text.encode(this.data.ID)}\" id=\"${tagId}\" src=\"${this.data.BIG_REVIEW_URL}\" />`\n\t}\n\n\tstatic detect(itemData: ItemSavedType)\n\t{\n\t\treturn !!itemData['PREVIEW_URL'];\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport FileController from './file-controller';\nimport Item from '../items/item';\nimport ItemImage from '../items/item-image';\n\nlet justCounter = 0;\n\nexport default class FileParser {\n\tid: String;\n\thtmlEditor;\n\titems: Map<Item>;\n\ttag: string = '[DISK FILE ID=#id#]';\n\tregexp: RegExp = /\\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\\]/ig;\n\n\tconstructor(fileController: FileController)\n\t{\n\t\tthis.id = ['diskfile' + justCounter++].join('_');\n\t\tthis.items = fileController.items;\n\t}\n\n\tgetInterface()\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tinit: (htmlEditor) => {\n\t\t\t\tthis.htmlEditor = htmlEditor;\n\t\t\t},\n\t\t\tparse: this.parse.bind(this),\n\t\t\tunparse: this.unparse.bind(this),\n\t\t};\n\t}\n\n\thasInterface()\n\t{\n\t\treturn this.regexp !== null && this.tag !== null;\n\t}\n\n\tsetParams({tag, regexp})\n\t{\n\t\tif (Type.isStringFilled(tag) && tag !== 'null')\n\t\t{\n\t\t\tthis.tag = tag;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.tag = null;\n\t\t}\n\n\t\tif (Type.isStringFilled(regexp) && regexp !== 'null')\n\t\t{\n\t\t\tthis.regexp = new RegExp(regexp);\n\t\t}\n\t\telse if (regexp instanceof RegExp)\n\t\t{\n\t\t\tthis.regexp = regexp;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.regexp = null;\n\t\t}\n\t}\n\n\tinsertFile(id: string)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\tconst bbDelimiter = item instanceof ItemImage ? '\\n' : ' ';\n\t\t\tconst htmlDelimiter = item instanceof ItemImage ? '<br>' : '&nbsp;';\n\t\t\tEventEmitter.emit(this.htmlEditor, 'OnInsertContent', [\n\t\t\t\tbbDelimiter + this.getItemBBCode(id) + bbDelimiter,\n\t\t\t\thtmlDelimiter + this.getItemHTML(id) + htmlDelimiter\n\t\t\t]);\n\t\t}\n\t}\n\n\tgetItemBBCode(id: String)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item && item.isPluggedIn())\n\t\t{\n\t\t\titem.setInsertedInText();\n\t\t}\n\n\t\treturn this.tag.replace('#id#', id);\n\t}\n\n\tgetItemHTML(id: String)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\treturn this.#getHTMLByItem(item, id);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getHTMLByItem(item: Item, id: string)\n\t{\n\t\tif (item.isPluggedIn())\n\t\t{\n\t\t\titem.setInsertedInText();\n\t\t}\n\n\t\treturn item.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false, {tag: this.id, fileId: id, itemId: item.getId()}));\n\t}\n\n\tdeleteFile(fileId)\n\t{\n\t\tif (!this.items.has(fileId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileIds = this.items.get(fileId).getAllIds();\n\n\t\tif (this.htmlEditor.GetViewMode() === 'wysiwyg')\n\t\t{\n\t\t\tconst doc = this.htmlEditor.GetIframeDoc();\n\n\t\t\tfor (let ii in this.htmlEditor.bxTags)\n\t\t\t{\n\t\t\t\tif (this.htmlEditor.bxTags.hasOwnProperty(ii)\n\t\t\t\t\t&& typeof this.htmlEditor.bxTags[ii] === 'object'\n\t\t\t\t\t&& this.htmlEditor.bxTags[ii]['tag'] === this.id\n\t\t\t\t\t&& fileIds.indexOf(String(this.htmlEditor.bxTags[ii]['itemId'])) >= 0\n\t\t\t\t\t&& doc.getElementById(ii)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst node = doc.getElementById(ii);\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.htmlEditor.SaveContent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = this.htmlEditor.GetContent().replace(this.regexp,\n\t\t\t\tfunction(str, foundId) {\n\t\t\t\t\treturn fileIds.indexOf(foundId) >= 0 ? '' : str;\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.htmlEditor.SetContent(content);\n\t\t\tthis.htmlEditor.Focus();\n\t\t}\n\t}\n\n\tparse(content)\n\t{\n\t\tif (!this.regexp.test(content))\n\t\t{\n\t\t\treturn content;\n\t\t}\n\t\tcontent = content.replace(\n\t\t\tthis.regexp,\n\t\t\tfunction(str, id)\n\t\t\t{\n\t\t\t\tconst foundedItem = this.items.has(id) ? this.items.get(id) : [...this.items.values()].find((item: Item) => {\n\t\t\t\t\treturn item.getAllIds().indexOf(id) >= 0;\n\t\t\t\t});\n\t\t\t\tif (foundedItem)\n\t\t\t\t{\n\t\t\t\t\treturn this.#getHTMLByItem(foundedItem, id);\n\t\t\t\t}\n\t\t\t\treturn str;\n\t\t\t}.bind(this)\n\t\t);\n\t\treturn content;\n\t}\n\n\tunparse(bxTag, {node})\n\t{\n\t\tconst id = bxTag.itemId;\n\n\t\tif (this.items.has(id))\n\t\t{\n\t\t\treturn this.getItemBBCode(id);\n\t\t}\n\t\treturn '';\n\t}\n}","import Item from './item';\nimport ItemImage from './item-image';\n\nconst itemMappings = [\n\tItem,\n\tItemImage,\n];\n\nexport default function getItem(itemData): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn new itemClassName(itemData);\n}","import {Type, Dom, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport ItemMoreButton from '../items/item-more';\nimport FileParser from './file-parser';\nimport type {ItemSavedType, ItemNew} from '../items/item-type';\nimport getItem from '../items/index';\n\nexport default class FileController extends DefaultController {\n\tmaxVisibleCount = 10;\n\tparser: FileParser;\n\tprefixHTMLNode = 'disk-attach-';\n\n\tconstructor({id, container, fieldName, multiple, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject});\n\t\tthis.items = new Map();\n\t\tthis.multiple = multiple !== false;\n\t\tthis.fieldName = fieldName;\n\t\tif (!container.querySelector('[data-bx-role=\"placeholder\"]'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tthis.buildInHTMLEditor();\n\t\t}\n\t}\n\n\tbuildInHTMLEditor()\n\t{\n\t\tif (this.getParser().hasInterface())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'OnParserRegister', this.getParser().getInterface());\n\t\t}\n\t\tEventEmitter.subscribe(this.eventObject, 'onReinitializeBefore', ({data: [text, fileData]}) => {\n\t\t\tlet manualClearing = true;\n\t\t\tif (fileData)\n\t\t\t{\n\t\t\t\tObject.values(fileData).forEach((uf) => {\n\t\t\t\t\tif (uf &&\n\t\t\t\t\t\tuf['USER_TYPE_ID'] === \"disk_file\"\n\t\t\t\t\t\t&& uf['FIELD_NAME'].replace('[]', '') === this.fieldName.replace('[]', '')\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst items = [];\n\t\t\t\t\t\t\tconst duplicateControlItems = {};\n\t\t\t\t\t\t\tif (Type.isArray(uf['VALUE']))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tuf['VALUE'].forEach((id) => {\n\t\t\t\t\t\t\t\t\tlet node = document.querySelector(['#', this.prefixHTMLNode, id].join(''));\n\t\t\t\t\t\t\t\t\tconst stringId = String(id);\n\t\t\t\t\t\t\t\t\tif (!node || duplicateControlItems[stringId])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tduplicateControlItems[stringId] = true;\n\n\t\t\t\t\t\t\t\t\tconst img = node.querySelector('img') || node.querySelector('div[data-bx-preview]');\n\t\t\t\t\t\t\t\t\tconst infoNode = img || node;\n\t\t\t\t\t\t\t\t\tconst name = infoNode.hasAttribute(\"data-title\") ? infoNode.getAttribute(\"data-title\")\n\t\t\t\t\t\t\t\t\t\t: (infoNode.hasAttribute(\"data-bx-title\") ? infoNode.getAttribute(\"data-bx-title\") : '');\n\n\t\t\t\t\t\t\t\t\tconst itemData = {\n\t\t\t\t\t\t\t\t\t\tID: id,\n\t\t\t\t\t\t\t\t\t\tFILE_ID: infoNode.getAttribute(\"bx-attach-file-id\"),\n\t\t\t\t\t\t\t\t\t\t// IS_LOCKED: boolean\n\t\t\t\t\t\t\t\t\t\t// IS_MARK_DELETED: boolean\n\t\t\t\t\t\t\t\t\t\t// EDITABLE: boolean\n\t\t\t\t\t\t\t\t\t\t// FROM_EXTERNAL_SYSTEM: boolean\n\n\t\t\t\t\t\t\t\t\t\tCAN_RESTORE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_UPDATE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_RENAME: false,\n\t\t\t\t\t\t\t\t\t\tCAN_MOVE: false,\n\n\t\t\t\t\t\t\t\t\t\tCOPY_TO_ME_URL: null,\n\t\t\t\t\t\t\t\t\t\tDELETE_URL: null,\n\t\t\t\t\t\t\t\t\t\tDOWNLOAD_URL: null,\n\t\t\t\t\t\t\t\t\t\tEDIT_URL: null,\n\t\t\t\t\t\t\t\t\t\tVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tPREVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\t\t\t\t\t\t\t\tEXTENSION: name.split('.').pop(),\n\t\t\t\t\t\t\t\t\t\tNAME: name,\n\t\t\t\t\t\t\t\t\t\tSIZE: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSIZE_BYTES: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSTORAGE: 'disk',\n\t\t\t\t\t\t\t\t\t\tTYPE_FILE: infoNode.getAttribute(\"bx-attach-file-type\"),\n\t\t\t\t\t\t\t\t\t\t// width: node.getAttribute(\"data-bx-width\"),\n\t\t\t\t\t\t\t\t\t\t// height: node.getAttribute(\"data-bx-height\"),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tif (img)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titemData['PREVIEW_URL'] = img.hasAttribute('data-bx-preview') && Type.isStringFilled(img.getAttribute('data-bx-preview'))\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-bx-preview') : (\n\t\t\t\t\t\t\t\t\t\t\t\timg.hasAttribute('data-thumb-src') && Type.isStringFilled(img.getAttribute('data-thumb-src'))\n\t\t\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-thumb-src') :\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.src\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\titemData['BIG_PREVIEW_URL'] = img.hasAttribute(\"data-bx-src\")\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute(\"data-bx-src\") :\n\t\t\t\t\t\t\t\t\t\t\timg.getAttribute('data-src')\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\titems.push(itemData);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.set(items);\n\t\t\t\t\t\t\tmanualClearing = false;\n\t\t\t\t\t\t}catch (e) {\n\t\t\t\t\t\t\tconsole.log('e: ', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (manualClearing !== false)\n\t\t\t{\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t});\n\t}\n\n\tset(values: Array<ItemSavedType>): Promise\n\t{\n\t\tthis.clear();\n\n\t\tlet counter = this.maxVisibleCount;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tvalues.forEach((itemData: ItemSavedType) => {\n\t\t\t\tconst item = this.addItem(itemData);\n\t\t\t\tcounter--;\n\t\t\t\tif (counter > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.appendNode(item);\n\t\t\t\t}\n\t\t\t\telse if (counter === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.container.appendChild(this.getItemMore().reset().getContainer());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.getItemMore().increment();\n\t\t\t\t}\n\t\t\t});\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tclear()\n\t{\n\t\tthis.items.forEach((item) => {\n\t\t\titem.destroy();\n\t\t});\n\n\t\tthis.container.innerHTML = '';\n\t}\n\n\t// to add into DOM fom uploader\n\tadd(itemData: ItemNew, itemContainer: ?Element)\n\t{\n\t\tthis.multiple || this.clear();\n\t\tconst item = this.addItem(itemData);\n\t\tthis.appendNode(item, itemContainer);\n\t\treturn item;\n\t}\n\n\taddItem(itemData: ItemSavedType)\n\t{\n\t\tconst item = getItem(itemData);\n\n\t\tlet input = this.getContainer()\n\t\t\t.querySelector(`[data-bx-role=\"reserve-item\"][value=\"${Text.encode(item.getId())}\"]`);\n\t\tif (!input)\n\t\t{\n\t\t\tinput = document.createElement('INPUT');\n\t\t\tinput.name = this.fieldName;\n\t\t\tinput.type = 'hidden';\n\t\t\tinput.value = item.getId();\n\t\t\tthis.container.appendChild(input);\n\t\t}\n\t\titem.subscribe('onDelete', () => {\n\t\t\tif (input && input.parentNode)\n\t\t\t{\n\t\t\t\tinput.parentNode.removeChild(input);\n\t\t\t}\n\t\t\tEventEmitter.emit(this, 'OnItemDelete', item);\n\t\t});\n\t\titem.subscribe('onDestroy', () => {\n\t\t\tthis.items.delete(item.getId())\n\t\t});\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Increment');\n\t\t\tif (this.getParser().hasInterface())\n\t\t\t{\n\t\t\t\titem.setPluggedIn();\n\t\t\t\titem.subscribe('onClickInsertInText', () => {\n\t\t\t\t\tthis.getParser().insertFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDelete', () => {\n\t\t\t\t\tthis.getParser().deleteFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDestroy', () => {\n\t\t\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Decrement');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.items.set(item.getId(), item);\n\t\treturn item;\n\t}\n\n\tgetItem(id)\n\t{\n\t\treturn this.items.get(id);\n\t}\n\n\t/*@\n\tAppends node to the container\n\t */\n\tappendNode(item: Item, itemContainer: ?Element)\n\t{\n\t\tif (itemContainer)\n\t\t{\n\t\t\tif (itemContainer.parentNode)\n\t\t\t{\n\t\t\t\titemContainer.parentNode.replaceChild(item.getContainer(), itemContainer)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.container.appendChild(item.getContainer());\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetItemMore(): ItemMoreButton\n\t{\n\t\treturn this.cache.remember('moreButton', () => {\n\t\t\tconst res = new ItemMoreButton();\n\t\t\tEventEmitter.subscribe(res, 'onGetMore', this.showMoreItems.bind(this));\n\t\t\treturn res;\n\t\t});\n\t}\n\n\tshowMoreItems({data:{itemsCount}})\n\t{\n\t\tconst timeoutCounter = itemsCount;\n\t\tconst itemMoreNode = this.getItemMore().getContainer();\n\t\titemMoreNode.style.opacity = '0';\n\t\titemMoreNode.style.visibility = 'hidden';\n\t\tthis.items.forEach((item: Item) => {\n\t\t\tif (itemsCount > 0)\n\t\t\t{\n\t\t\t\tif (!item.hasContainer())\n\t\t\t\t{\n\t\t\t\t\titemsCount--;\n\t\t\t\t\tconst node = document.createElement('DIV');\n\t\t\t\t\titemMoreNode.parentNode.insertBefore(node, itemMoreNode);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '0');\n\t\t\t\t\t\tDom.addClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '');\n\t\t\t\t\t\tnode.parentNode.replaceChild(item.getContainer(), node);\n\t\t\t\t\t\titem.getContainer().addEventListener('transitionend', () => {\n\t\t\t\t\t\t\tDom.removeClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\t})\n\t\t\t\t\t}, (timeoutCounter - itemsCount) * 100);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (itemsCount <= 0)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\titemMoreNode.style.opacity = '';\n\t\t\t\titemMoreNode.style.visibility = '';\n\t\t\t}, timeoutCounter * 100 + 100);\n\t\t}\n\t}\n\n\tgetParser()\n\t{\n\t\tthis.parser = this.parser || new FileParser(this);\n\t\treturn this.parser;\n\t}\n}\n","import {Loc} from 'main.core';\nimport {Menu, MenuItem} from 'main.popup';\nimport DefaultController from \"./default-controller\";\nimport Options from \"../options\";\n\nexport default class SettingsController extends DefaultController\n{\n\tallowEditNode: ?Element;\n\tallowGridNode: ?Element;\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"setting\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tthis.getContainer().addEventListener('click', this.show.bind(this))\n\t\t\tthis.allowEditNode = container.querySelector('input[data-bx-role=\"settings-allow-edit\"]');\n\t\t\tthis.allowGridNode = container.querySelector('input[data-bx-role=\"settings-allow-grid\"]');\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = new Menu({\n\t\t\t\tbindElement: this.getContainer(),\n\t\t\t\tclassName: 'disk-uf-file-popup-settings',\n\t\t\t\titems: [\n\t\t\t\t\tthis.allowEditNode ? {\n\t\t\t\t\t\tdataset: {bxRole: 'allowEdit'},\n\t\t\t\t\t\tclassName: this.allowEditNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_EDIT'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowEditNode.checked = !this.allowEditNode.checked;\n\t\t\t\t\t\t\tif (this.allowEditNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'allowGrid'},\n\t\t\t\t\t\tclassName: this.allowGridNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_COLLAGE'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowGridNode.checked = !this.allowGridNode.checked;\n\t\t\t\t\t\t\tif (this.allowGridNode.dataset.bxSave === 'Y')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.userOptions.save('disk', 'disk.uf.file', this.allowGridNode.dataset.bxName, (this.allowGridNode.checked ? 'grid' : '.default'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.allowGridNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.buildDocumentServiceTextLabel(),\n\t\t\t\t\t\titems: this.buildSubMenuWithDocumentServices(),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tangle: true,\n\t\t\t\toffsetTop: -16,\n\t\t\t\toffsetLeft: 16,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tdelete this.popup;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tthis.popup.show()\n\t}\n\n\tbuildDocumentServiceTextLabel(): string\n\t{\n\t\tlet currentService = BX.Disk.getDocumentService();\n\t\tif (!currentService && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tcurrentService = 'onlyoffice';\n\t\t}\n\t\telse if (!currentService)\n\t\t{\n\t\t\tcurrentService = 'l';\n\t\t}\n\n\t\tconst name = Options.getDocumentHandler(currentService).name;\n\n\t\treturn Loc.getMessage('DISK_UF_FILE_EDIT_SERVICE_LABEL', { '#NAME#' : name});\n\t}\n\n\tbuildSubMenuWithDocumentServices(): Array<Object>\n\t{\n\t\tlet items = [];\n\n\t\tOptions.getDocumentHandlers().forEach(item => {\n\t\t\titems.push({\n\t\t\t\ttext: item.name,\n\t\t\t\tdataset: {\n\t\t\t\t\tcode: item.code,\n\t\t\t\t},\n\t\t\t\tonclick: (event, item: MenuItem) => {\n\t\t\t\t\tBX.Disk.saveDocumentService(item.dataset.code);\n\n\t\t\t\t\titem.getMenuWindow().getParentMenuItem().setText(this.buildDocumentServiceTextLabel());\n\t\t\t\t\titem.getMenuWindow().getPopupWindow().close();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\thide()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n \t\t}\n\t}\n}","import DefaultController from './default-controller';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedType, ItemUploadedType} from \"../items/item-type\";\n\nexport default class DocumentController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"document-area\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tArray.from(\n\t\t\t\tthis.getContainer().querySelectorAll('[data-bx-handler]')\n\t\t\t)\n\t\t\t\t.forEach((item) => {\n\t\t\t\t\titem.addEventListener('click', () => {\n\t\t\t\t\t\tthis.createDocument(item.getAttribute('data-bx-handler'));\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t}\n\t}\n\n\tcreateDocument(documentType)\n\t{\n\t\tif (!BX.Disk.getDocumentService() && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('onlyoffice');\n\t\t}\n\t\telse if (!BX.Disk.getDocumentService())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('l');\n\t\t}\n\n\t\tlet insertDocumentIntoUf = function (extendedFileData) {\n\t\t\tvar parts = extendedFileData.object.name.split('.');\n\t\t\tparts.pop();\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(this,\n\t\t\t\t\t'onFileIsCreated',\n\t\t\t\t\t{itemData: this.convertToItemSavedType(extendedFileData)});\n\t\t\t}, 200);\n\t\t}.bind(this);\n\n\t\tif (BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk())\n\t\t{\n\t\t\tBX.Disk.Document.Local.Instance.createFile({\n\t\t\t\ttype: documentType\n\t\t\t}).then(function (response) {\n\t\t\t\tinsertDocumentIntoUf(response);\n\t\t\t}.bind(this));\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet createProcess = new BX.Disk.Document.CreateProcess({\n\t\t\ttypeFile: documentType,\n\t\t\tserviceCode: BX.Disk.getDocumentService(),\n\t\t\tonAfterSave: function(response, extendedFileData) {\n\t\t\t\tif (response.status !== 'success')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!extendedFileData)\n\t\t\t\t{\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.getMetaDataForCreatedFileInUf(response.object.id)\n\t\t\t\t\t\t.then(function({data}) {\n\t\t\t\t\t\t\tinsertDocumentIntoUf(data);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tinsertDocumentIntoUf(extendedFileData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tcreateProcess.start();\n\t}\n\n\tconvertToItemSavedType(extendedFileData) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: 'n' + extendedFileData.object.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: true,\n\t\t\tCAN_RENAME: true,\n\t\t\tCAN_MOVE:  true,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: extendedFileData.link,\n\t\t\tPREVIEW_URL: null,\n\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\tEXTENSION: extendedFileData.object.extension,\n\t\t\tNAME: extendedFileData.object.name,\n\t\t\tSIZE: extendedFileData.object.size,\n\t\t\tSIZE_BYTES: extendedFileData.object.sizeInt,\n\t\t\tSTORAGE: extendedFileData.folderName\n\t\t};\n\t}\n}\n\n","import DefaultController from './default-controller';\n\nexport default class PanelController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"control-panel\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t}\n}","import {Uri, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport Backend from '../backend';\nimport type {ItemSelectedType, ItemSavedType} from \"../items/item-type\";\n\nlet justCounter = 0;\nexport default class FileSelector extends DefaultController\n{\n\topened: boolean = false;\n\tdialogName: string;\n\tconstructor({container, eventObject})\n\t{\n\t\tconst node = container.querySelector('[data-bx-role=\"file-local-controller\"]') ||\n\t\t\tcontainer.querySelector('.diskuf-selector-link');\n\n\t\tsuper({\n\t\t\tcontainer: node,\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tthis.dialogName = ['selectFile', justCounter++].join('-');\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getContainer().addEventListener('click', this.onClick.bind(this));\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t}\n\n\tonClick()\n\t{\n\t\tBackend\n\t\t\t.getSelectedData(this.dialogName)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {itemData: this.convertToItemSavedType(selected[id])});\n\t\t\t}\n\t\t}\n\t}\n\n\tconvertToItemSavedType(item: ItemSelectedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item['storage'] ?? Loc.getMessage('WDUF_MY_DISK'),\n\t\t};\n\t}\n}\n","import {Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\nimport ItemNew from \"./item-new\";\n\nexport default class ItemNewSelectedCloud extends ItemNew\n{\n\tconstructor(fileId, fileObject: ItemNewSelectedCloud)\n\t{\n\t\tsuper(fileId, fileObject);\n\n\t\tBX.Disk.ExternalLoader.startLoad({\n\t\t\tfile: {\n\t\t\t\tid: this.id,\n\t\t\t\tname: this.object.name,\n\t\t\t\tservice: this.object.service\n\t\t\t},\n\t\t\tonFinish: (newData) => {\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', [newData]);\n\t\t\t},\n\t\t\tonProgress: (progress) => {\n\t\t\t\tthis.onUploadProgress({compatData: [{}, progress]});\n\t\t\t}\n\t\t});\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tdelete this.container;\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.getContainer().parentNode.removeChild(this.progress.getContainer());\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t}\n}\n","import {Uri} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedCloudType, ItemSavedType, ItemUploadedType, ItemSelectedCloudType} from \"../items/item-type\";\nimport ItemNewSelectedCloud from \"../items/item-new-selected-cloud\";\nimport DefaultController from \"./default-controller\";\n\nlet justCounter = 0;\nexport default class FileSelectorCloud extends DefaultController\n{\n\tdialogName: string;\n\tservices: Array<Element> = [];\n\titems: Map = new Map;\n\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tArray.from(\n\t\t\tcontainer\n\t\t\t\t.querySelectorAll('[data-bx-role=\"file-external-controller\"]')\n\t\t)\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\t\tArray.from(\n\t\t\tcontainer\n\t\t\t\t.querySelectorAll('.diskuf-selector-link-cloud')\n\t\t)\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\n\t\tthis.eventObject = eventObject;\n\t\tthis.dialogName = ['selectFileCloud', justCounter++].join('-');\n\t\tthis.services.forEach((node) => {\n\t\t\tnode.addEventListener('click', this.onClick.bind(this));\n\t\t});\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tthis.currentService = event.currentTarget.getAttribute('data-bx-doc-handler');\n\n\t\tBackend\n\t\t\t.getSelectedCloudData(this.dialogName, this.currentService)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id) && selected[id].type === 'file')\n\t\t\t{\n\t\t\t\tthis.catchFile(selected[id], this.currentService);\n\t\t\t}\n\t\t}\n\t\tthis.currentService = null;\n\t}\n\n\tcatchFile(fileObject: ItemSelectedCloudType, service)\n\t{\n\t\tif (this.items.has(fileObject.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfileObject['service'] = fileObject['provider'] || service;\n\t\tconst item = new ItemNewSelectedCloud(fileObject.id, fileObject);\n\t\tthis.items.set(item.id, item);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType]}) => {\n\t\t\tif (this.items.has(item.id))\n\t\t\t{\n\t\t\t\tthis.items.delete(item.id);\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer()});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\tconvertToItemSavedType(item: ItemSavedCloudType) :ItemSavedType\n\t{\n\t\tconst extension = item.name.split('.').pop().toLowerCase();\n\t\tconst itemData = {\n\t\t\tID: item.ufId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: true,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: extension === item.name ? '' : extension,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.sizeFormatted,\n\t\t\tSIZE_BYTES: item.size,\n\t\t\tSTORAGE: item.storage,\n\t\t};\n\t\treturn itemData;\n\t}\n}\n","import {Uri, Loc} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport Item from \"../items/item\";\n\nexport default class FileMover\n{\n\tstatic subscribed = false;\n\tstatic instance = null;\n\tdialogName: string = 'moveFile';\n\titem: ?Item;\n\ttimeout: ?number;\n\n\tconstructor()\n\t{\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.loadFolder = this.loadFolder.bind(this);\n\t\tthis.stopLoadingFolder = this.stopLoadingFolder.bind(this);\n\t\tthis.checkFileName = this.checkFileName.bind(this);\n\t\tthis.onApply = this.onApply.bind(this);\n\t\tthis.onCancel = this.onCancel.bind(this);\n\t}\n\n\tfire(item: Item): void\n\t{\n\t\tif (this.item !== null && this.item !== item)\n\t\t{\n\t\t\tthis.onCancel();\n\t\t}\n\n\t\tthis.item = item;\n\t\tBackend.getSelectedFile(\n\t\t\titem.getFileId(),\n\t\t\titem.getData('NAME'),\n\t\t\tthis.dialogName\n\t\t)\n\t\t.then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.onApply, cancelButton: this.onCancel};\n\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t}, 10)\n\t\t});\n\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.subscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t}\n\n\topenSection({data: [link, someDialogName]}): void\n\t{\n\t\tif (someDialogName === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[someDialogName] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tloadFolder({data: [element, itemId: string, someDialogName]}): void\n\t{\n\t\tif (someDialogName !== this.dialogName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBackend\n\t\t\t.loadFolder(itemId.substr(1), this.item.getData('NAME'), this.dialogName)\n\t\t\t.then((result) => {\n\t\t\t\tconst documentExists = (result.permission === true && result[\"okmsg\"] !== '');\n\n\t\t\t\tif (this.timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.timeout);\n\t\t\t\t}\n\t\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\t\tif (documentExists)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t});\n\t}\n\n\tstopLoadingFolder({data: someData}): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = setTimeout(this.checkFileName, 200);\n\t}\n\n\tonApply(tab, path, selected, folderByPath)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\n\t\tif (!this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = this.item.getId();\n\t\tlet moved = false;\n\n\t\tconst moveQuery = (id, targetFolderId, sectionProperties, sectionPath) => {\n\t\t\tBackend\n\t\t\t\t.moveFile(id, targetFolderId)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response || response.status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.showMovedFile(id, sectionProperties, sectionPath);\n\t\t\t\t});\n\t\t};\n\n\t\tlet sectionPath, sectionProperties;\n\t\tfor (let i in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(i) && selected[i].type === 'folder')\n\t\t\t{\n\t\t\t\tsectionPath = tab.name + selected[i].path;\n\t\t\t\tsectionProperties = { sectionID : i, iblockID : tab.iblock_id };\n\n\t\t\t\tmoveQuery(id, selected[i].id, sectionProperties, sectionPath);\n\t\t\t\tmoved = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!moved)\n\t\t{\n\t\t\tsectionPath = tab.name;\n\t\t\tsectionProperties = { sectionID : tab.section_id, iblockID : tab.iblock_id };\n\t\t\tif (!!folderByPath && !!folderByPath.path && folderByPath.path !== '/')\n\t\t\t{\n\t\t\t\tsectionPath += folderByPath.path;\n\t\t\t\tsectionProperties.sectionID = folderByPath.id;\n\t\t\t\tif(!!folderByPath)\n\t\t\t\t{\n\t\t\t\t\tmoveQuery(id, folderByPath.id, sectionProperties, sectionPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckFileName(someDialogName): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\n\t\tif (someDialogName !== this.dialogName || !this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileName = this.item.getData('NAME');\n\t\tlet exist = false;\n\n\t\tfor (let i in BX.DiskFileDialog.obItems[this.dialogName])\n\t\t{\n\t\t\tif (BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(i)\n\t\t\t\t&& BX.DiskFileDialog.obItems[this.dialogName][i]['name'] === fileName)\n\t\t\t{\n\t\t\t\texist = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (exist)\n\t\t{\n\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t}\n\t}\n\n\tshowMovedFile(id, sectionProperties, sectionPath): void\n\t{\n\t\tif (this.item)\n\t\t{\n\t\t\tthis.item.emit('onMoved', sectionPath);\n\t\t}\n\t\tthis.item = null;\n\t}\n\n\tonCancel(): void\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t\tthis.item = null;\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = null;\n\t}\n\n\tstatic subscribe(): void\n\t{\n\t\tif (BX.DiskFileDialog.subscribed !== true)\n\t\t{\n\t\t\tBX.DiskFileDialog.subscribed = true;\n\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'onFileNeedsToMove', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tFileMover.getInstance().fire([...event.getData()].shift());\n\t\t\t})\n\t\t}\n\t}\n\n\tstatic getInstance(): FileMover\n\t{\n\t\tif (this.instance === null)\n\t\t{\n\t\t\tthis.instance = new FileMover();\n\t\t}\n\t\treturn this.instance;\n\t}\n}\n","import {Tag, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport DefaultController from './controllers/default-controller';\nimport Options from \"./options\";\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport type {ItemSavedType} from './items/item-type'\n\nlet justCounter = 0;\nfunction _camelToSNAKE(obj)\n{\n\tvar o = {}, i, k;\n\tfor (i in obj)\n\t{\n\t\tk = i.replace(/(.)([A-Z])/g, \"$1_$2\").toUpperCase();\n\t\to[k] = obj[i];\n\t\to[i] = obj[i];\n\t}\n\n\treturn o;\n}\n\nexport default class FormBrief extends DefaultController {\n\tid: string;\n\tfileUploader: FileUploader;\n\tfieldName: string;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\n\tconstructor({id, fieldName, container, eventObject, input})\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (!this.input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tstreams: 1,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: null,\n\t\t\tinput: this.input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tthis.onUploadDone = this.onUploadDone.bind(this);\n\t\tthis.onUploadError = this.onUploadError.bind(this);\n\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploaded\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadDone(item, params);\n\t\t});\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploadedWithError\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadError(item, params);\n\t\t});\n\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t}\n\n\tonSelectionIsDone(item: ItemSavedType)\n\t{\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + item['ID'],\n\t\t\t'bx-agentFileId': item['ID']\n\t\t};\n\t\tif (item[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + item[\"FILE_ID\"];\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${item['ID']}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\n\t\tlet res = {\n\t\t\telement_id: item['ID'],\n\t\t\telement_name: item['NAME'],\n\t\t\telement_url: item['PREVIEW_URL'],\n\t\t\tstorage: item['STORAGE']\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, {}, null, {\n\t\t\t\tid: justCounter++,\n\t\t\t\tname: item['NAME'],\n\t\t\t\tsize: item['SIZE'],\n\t\t\t\tsizeInt: item['SIZE_INT'],\n\t\t\t}]})\n\t\t);\n\n\t}\n\n\tonUploadDone(item, result)\n\t{\n\t\tif (result[\"file\"] && result[\"file\"][\"attachId\"] !== result[\"file\"][\"id\"])\n\t\t{\n\t\t\tresult[\"file\"][\"id\"] = result[\"file\"][\"attachId\"];\n\t\t\tdelete result[\"file\"][\"attachId\"];\n\t\t}\n\n\t\tconst file = _camelToSNAKE(result[\"file\"]);\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + file.id,\n\t\t\t'bx-agentFileId': item.id\n\t\t};\n\t\tif (file[\"XML_ID\"])\n\t\t\tattrs[\"bx-attach-xml-id\"] = file[\"XML_ID\"];\n\t\tif (file[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + file[\"FILE_ID\"];\n\t\tif (file['FILE_TYPE'])\n\t\t\tattrs[\"bx-attach-file-type\"] = file[\"FILE_TYPE\"];\n\t\tfile.element_id = file.id;\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${file.id}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\t\tthis.onFileIs(item, file);\n\t}\n\t\n\tonFileIs(item, file)\n\t{\n\t\tlet res = {\n\t\t\telement_id : file.element_id,\n\t\t\telement_name : (file.element_name || item.name),\n\t\t\telement_url: (file.element_name || file.previewUrl || file.preview_url),\n\t\t\tstorage: 'disk'\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, this, item.file, item]}));\n\t}\n\n\tonUploadError(item, params)\n\t{\n\t\tBX.onCustomEvent(this.getEventObject(), 'OnFileUploadFailed', [this, item.file, item]);\n\t}\n}","import {Loc, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport FileController from './controllers/file-controller';\nimport DefaultController from './controllers/default-controller';\nimport SettingsController from './controllers/settings-controller';\nimport DocumentController from './controllers/document-controller';\nimport PanelController from './controllers/panel-controller';\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport FileMover from \"./controllers/file-mover\";\nimport {Ears} from 'ui.ears';\nimport FormBrief from './form-brief'\n\nexport default class Form extends DefaultController {\n\tid: string;\n\tfilesController: FileController;\n\tfileUploader: FileUploader;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\tfieldName: string;\n\n\tconstructor({id, fieldName, container, eventObject, input, parserParams}, values: ?Array)\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (parserParams)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.getParser()\n\t\t\t\t.setParams(parserParams);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (values.length > 0)\n\t\t{\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.show(values);\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.input)\n\t\t{\n\t\t\tthis.getFilesUploader();\n\t\t}\n\n\t\tthis.initDocumentController();\n\t\tthis.settingsController = new SettingsController(this, {});\n\t\tthis.panelController = new PanelController(this);\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t});\n\n\t\tconst switcher = (event: BaseEvent) => {\n\t\t\tlet status = Type.isArray(event.getData()) ? event.getData().shift() : event.getData();\n\t\t\tif (status === 'show')\n\t\t\t{\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\t\t//region compatibility\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onCollectControllers', (event) => {\n\t\t\tevent.data[this.fieldName] = {\n\t\t\t\tstorage: 'disk',\n\t\t\t\ttag: this.getFileController().isPluggedIn() ? this.getFileController().getParser().tag : null,\n\t\t\t\tvalues: [],\n\t\t\t\thandler: {\n\t\t\t\t\tselectFile: (tab, path, selected) => {\n\t\t\t\t\t\tthis.fileSelector.selectFile(tab, path, selected);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tArray.from(\n\t\t\t\tthis.getContainer()\n\t\t\t\t\t.querySelectorAll(`input[type=\"hidden\"][name=\"${this.fieldName}\"]`)\n\t\t\t)\n\t\t\t\t.forEach((nodeItem) => {\n\t\t\t\t\tevent.data[this.fieldName].values.push(nodeItem.value);\n\t\t\t\t});\n\t\t});\n\t\t//endregion\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\n\t\t// (new Ears({\n\t\t// \tcontainer: this.getContainer().querySelector('[data-bx-role=\"control-panel-main-actions\"]'),\n\t\t// \tnoScrollbar: false,\n\t\t// \tclassName: 'disk-documents-ears'\n\t\t// })).init();\n\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:upload', ({data}) => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestThumb(data);\n\t\t});\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:error', () => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestErrorThumb();\n\t\t});\n\t}\n\n\tinitDocumentController()\n\t{\n\t\tthis.documentController = new DocumentController({container: this.getContainer(), eventObject: this.getEventObject()});\n\t\tEventEmitter.subscribe(this.documentController, 'onFileIsCreated', ({data: {itemData}}) => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\n\t\tif (!this.documentController.isRelevant())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\telse if (!this.isPluggedIn())\n\t\t{\n\t\t\tthis.documentController.show();\n\t\t\treturn;\n\t\t}\n\t\tif (this.eventObject.dataset.bxDiskDocumentButton !== 'added')\n\t\t{\n\t\t\tthis.eventObject.dataset.bxDiskDocumentButton = 'added';\n\n\t\t\tconst node = document.createElement('DIV');\n\t\t\tnode.addEventListener('click', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container && container.hasAttribute('data-bx-button-status'))\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'hide');\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowDocuments', 'show')\n\t\t\t\t}\n\t\t\t});\n\t\t\tnode.innerHTML = '<i></i>' + Loc.getMessage('WDUF_CREATE_DOCUMENT');\n\n\t\t\tEventEmitter.emit(this.eventObject, 'OnAddButton', [{BODY: node, ID: 'disk-document'}, 'file']);\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.setAttribute('data-bx-button-status', 'active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.removeAttribute('data-bx-button-status');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\tsuper.show();\n\t\t\tthis.documentController.show();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\tsuper.hide();\n\t\t\tthis.documentController.hide();\n\t\t});\n\t\tconst switcher = ({data}) => {\n\t\t\tif (data === 'show')\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t}\n\t\t};\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t}\n\n\tgetFileController(): FileController\n\t{\n\t\tif (!this.filesController)\n\t\t{\n\t\t\tthis.filesController = new FileController({\n\t\t\t\tid: this.id,\n\t\t\t\tfieldName: this.fieldName,\n\t\t\t\tcontainer: this.container,\n\t\t\t\teventObject: this.eventObject\n\t\t\t});\n\t\t}\n\t\treturn this.filesController\n\t}\n\n\tgetFilesUploader()\n\t{\n\t\tif (!this.filesUploader)\n\t\t{\n\t\t\tthis.filesUploader = new FileUploader({\n\t\t\t\tid: this.id,\n\t\t\t\tcontainer: this.container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\t\tdropZone: this.container,\n\t\t\t\tinput: this.input,\n\t\t\t});\n\t\t\t//Video\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnVideoHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\tthis.getFileController().getParser().insertFile(itemData.ID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t});\n\t\t\t//Image\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnImageHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\tresolve({image: {src: itemData.PREVIEW_URL}, html: this.getFileController().getParser().getItemHTML(itemData.ID)});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\tconst onFailed = ({data: {blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\t});\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveCaught', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tthis.filesUploader.upload([...event.getData()]);\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsStart', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onBusy', this);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsDone', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onReady', this);\n\t\t\t});\n\n\t\t}\n\t\treturn this.filesUploader;\n\t}\n\n\tgetPanelController(): PanelController\n\t{\n\t\treturn this.panelController;\n\t}\n\n\tshow(values: ?Array)\n\t{\n\t\tconst switcher = this.getContainer().parentNode.querySelector('#' + this.getContainer().id + '-switcher');\n\t\tif (switcher)\n\t\t{\n\t\t\tswitcher.parentNode.removeChild(switcher);\n\t\t}\n\t\tif (this.getFileController().isPluggedIn())\n\t\t{\n\t\t\tthis.getContainer().setAttribute('data-bx-plugged-in', 'Y');\n\t\t}\n\t\tsuper.show();\n\t\tthis.showInitialLoader();\n\t\tthis.getFileController().show();\n\t\tthis.getPanelController().show();\n\n\t\tif (values)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.set(values)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.hideInitialLoader();\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideInitialLoader();\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tsuper.hide();\n\t\tthis.getFileController().hide();\n\t\tthis.getPanelController().hide();\n\t}\n\n\tshowInitialLoader()\n\t{\n\t}\n\n\thideInitialLoader()\n\t{\n\t}\n\n\tstatic repo = {};\n\n\tstatic getInstance(data, values)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new Form(data, values);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n\n\tstatic getBriefInstance(data)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new FormBrief(data, []);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n}\n\nsetTimeout(() => {\n\tif (BX.DiskFileDialog)\n\t{\n\t\tFileMover.subscribe();\n\t}\n}, 1000);\n","import Form from './form.js';\nimport Options from './options.js';\n\nconst add = function(params)\n{\n\tconst container = BX('diskuf-selectdialog-' + params['UID']);\n\n\tif (container && BX.isNodeInDom(container))\n\t{\n\t\tconst eventObject = container.parentNode;\n\t\tif (!container.hasAttribute(\"bx-disk-load-is-bound\"))\n\t\t{\n\t\t\tcontainer.setAttribute(\"bx-disk-load-is-bound\", \"Y\");\n\t\t\tBX.addCustomEvent(eventObject, \"DiskLoadFormController\", function (status)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tBX.Disk.UF.Options.set({urlUpload: params.urlUpload});\n\t\t\t\t\treturn BX.Disk.UF.Form.getBriefInstance({\n\t\t\t\t\t\tcontainer: container,\n\t\t\t\t\t\teventObject: container.parentNode,\n\t\t\t\t\t\tid: params.UID,\n\t\t\t\t\t\tfieldName: params.controlName,\n\t\t\t\t\t\tinput: BX.findChild(container, { className : 'diskuf-fileUploader' }, true)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch(e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Error with compatibility', e);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!!params['values'] && params['values'].length > 0 && !params['hideSelectDialog'])\n\t\t\tBX.onCustomEvent(container.parentNode, 'DiskLoadFormController', ['show']);\n\t}\n}\nexport {\n\tForm,\n\tOptions,\n\tadd\n}\n",null]}