{"version":3,"sources":["src/options.js","src/items/item-new.js","src/file-uploader.js","src/controllers/default-controller.js","src/items/item-more.js","src/backend.js","src/items/item.js","src/items/item-image.js","src/controllers/file-parser.js","src/items/index.js","src/controllers/file-controller.js","src/controllers/settings-controller.js","src/controllers/document-controller.js","src/controllers/panel-controller.js","src/controllers/file-selector.js","src/items/item-new-selected-cloud.js","src/controllers/file-selector-cloud.js","src/controllers/file-mover.js","src/form-brief.js","src/form.js","src/index.js","script-old.js"],"names":["Options","optionsToSet","optionName","hasOwnProperty","documentHandlers","code","handler","find","width","height","ItemNew","fileId","fileObject","id","object","data","NAME","name","EventEmitter","subscribe","onUploadProgress","bind","onUploadDone","onUploadError","progress","BX","UI","ProgressRound","colorTrack","colorBar","lineSize","statusType","Status","INCIRCLE","textBefore","textAfter","size","container","extension","split","pop","toLowerCase","Text","encode","Tag","render","getContainer","onClickDelete","event","preventDefault","stopPropagation","emit","setTimeout","deleteFile","compatData","Math","min","max","getValue","update","file","hash","setTextBefore","Loc","getMessage","classList","add","FileUploader","dropZone","input","agent","Uploader","getInstance","allowUpload","uploadFormData","uploadMethod","uploadFileUrl","urlUpload","showImage","sortItems","pasteFileHashInForm","catchFile","packageFormer","previewParams","previewSize","exact","post","incrementItemsCount","item","itemData","blob","constructor","decrementItemsCount","convertToItemSavedType","itemContainer","removeChild","appendChild","progressPercent","ceil","random","files","onAttach","ID","attachId","IS_LOCKED","IS_MARK_DELETED","EDITABLE","FROM_EXTERNAL_SYSTEM","CAN_RESTORE","CAN_UPDATE","canChangeName","CAN_RENAME","CAN_MOVE","COPY_TO_ME_URL","DELETE_URL","DOWNLOAD_URL","EDIT_URL","VIEW_URL","PREVIEW_URL","previewUrl","BIG_PREVIEW_URL","replace","EXTENSION","ext","SIZE","SIZE_BYTES","sizeInt","STORAGE","storage","TYPE_FILE","fileType","Symbol","DefaultController","eventObject","Cache","MemoryCache","pluggedIn","properties","dataset","bxHtmlEditable","hasContainer","style","display","ItemMoreButton","cache","remember","onClick","getValueContainer","document","createElement","hiddenFilesCount","stepNumber","innerHTML","show","step","hide","itemsCount","stepValue","decrement","Backend","fileName","dialogName","Promise","resolve","ajax","get","Uri","addParam","urlSelect","ACTION","MULTI","join","wish","targetID","libLink","DiskFileDialog","obCurrentTab","link","use_light_view","AJAX_CALL","SIMPLE_UPLOAD","IFRAME","sessid","bitrix_sessid","SECTION_ID","CHECK_NAME","loadJSON","service","cloudImport","targetFolderId","Disk","method","dataType","url","addToLinkParam","attachedId","onsuccess","runAction","newName","Item","setEventNamespace","String","setData","onMoved","FILE_ID","key","getId","value","onClickMore","querySelector","keys","forEach","node","Type","isDomNode","parentNode","delete","has","getData","fullName","cleanName","substring","length","moreButton","contextMenu","Menu","getRandom","bindElement","items","isPluggedIn","bxRole","text","onclick","close","html","className","target","type","onRenamed","clearMenu","delimiter","onClickMoveTo","filter","preItem","angle","offsetLeft","destroy","deleteAction","getMenu","element_id","row","result","rename","renameAction","tagId","ItemImage","BIG_REVIEW_URL","justCounter","FileParser","fileController","init","htmlEditor","parse","unparse","regexp","tag","isStringFilled","RegExp","bbDelimiter","htmlDelimiter","getItemBBCode","getItemHTML","getHTMLForHTMLEditor","SetBxTag","itemId","fileIds","getAllIds","GetViewMode","doc","GetIframeDoc","ii","bxTags","indexOf","getElementById","SaveContent","content","GetContent","str","foundId","SetContent","Focus","test","foundedItem","values","bxTag","itemMappings","getItem","itemClassName","itemClass","detect","FileController","fieldName","multiple","Map","buildInHTMLEditor","getParser","hasInterface","getInterface","fileData","manualClearing","Object","uf","duplicateControlItems","isArray","prefixHTMLNode","stringId","img","infoNode","hasAttribute","getAttribute","src","push","set","e","console","log","clear","counter","maxVisibleCount","addItem","appendNode","getItemMore","reset","increment","setPluggedIn","insertFile","replaceChild","res","showMoreItems","timeoutCounter","itemMoreNode","opacity","visibility","insertBefore","Dom","addClass","addEventListener","removeClass","parser","SettingsController","allowEditNode","allowGridNode","popup","checked","remove","bxSave","userOptions","save","bxName","buildDocumentServiceTextLabel","buildSubMenuWithDocumentServices","offsetTop","events","onClose","currentService","getDocumentService","isAvailableOnlyOffice","getDocumentHandler","getDocumentHandlers","saveDocumentService","getMenuWindow","getParentMenuItem","setText","getPopupWindow","DocumentController","Array","from","querySelectorAll","createDocument","documentType","insertDocumentIntoUf","extendedFileData","parts","Document","Local","Instance","isSetWorkWithLocalBDisk","createFile","then","response","createProcess","CreateProcess","typeFile","serviceCode","onAfterSave","status","getMetaDataForCreatedFileInUf","start","folderName","PanelController","FileSelector","openSection","selectFile","getSelectedData","obCallback","saveButton","openDialog","dialog2","tab","path","selected","unsubscribe","ItemNewSelectedCloud","ExternalLoader","startLoad","onFinish","newData","onProgress","FileSelectorCloud","services","currentTarget","getSelectedCloudData","ufId","sizeFormatted","FileMover","loadFolder","stopLoadingFolder","checkFileName","onApply","onCancel","getSelectedFile","getFileId","cancelButton","someDialogName","element","substr","documentExists","permission","timeout","clearTimeout","showNotice","closeNotice","someData","folderByPath","moved","moveQuery","sectionProperties","sectionPath","moveFile","showModalWithStatusAction","showMovedFile","i","sectionID","iblockID","iblock_id","section_id","exist","obItems","subscribed","stopImmediatePropagation","fire","shift","instance","_camelToSNAKE","obj","o","k","toUpperCase","FormBrief","streams","params","fileSelector","onSelectionIsDone","fileSelectorCloud","attrs","setAttribute","element_name","element_url","getEventObject","BaseEvent","onFileIs","preview_url","onCustomEvent","Form","parserParams","getFileController","setParams","getFilesUploader","initDocumentController","settingsController","panelController","switcher","nodeItem","GLOBAL_TARGET","addTestThumb","addTestErrorThumb","documentController","isRelevant","bxDiskDocumentButton","closest","BODY","removeAttribute","filesController","filesUploader","fileToUpload","onSuccess","upload","reject","onFailed","image","showInitialLoader","getPanelController","hideInitialLoader","repo","isNodeInDom","addCustomEvent","UF","getBriefInstance","UID","controlName","findChild"],"mappings":"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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js.map","sourcesContent":["export default class Options\n{\n\tstatic urlUpload = null;\n\tstatic documentHandlers = null;\n\tstatic previewSize = {width: 115, height: 115};\n\n\tstatic set(optionsToSet: Object): void\n\t{\n\t\tfor (let optionName in optionsToSet)\n\t\t{\n\t\t\tif (Options.hasOwnProperty(optionName))\n\t\t\t{\n\t\t\t\tOptions[optionName] = optionsToSet[optionName];\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getDocumentHandlers(): Array<Object>\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn Options.documentHandlers;\n\t}\n\n\tstatic getDocumentHandler(code): Object\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tlet handler = Options.documentHandlers.find(function (handler) {\n\t\t\treturn handler.code === code;\n\t\t});\n\n\t\treturn handler || {};\n\t}\n}","import {Tag, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\n\nexport default class ItemNew\n{\n\tid: string;\n\tobject: Object;\n\tcontainer: Element;\n\tdata: Object;\n\tprogress;\n\n\tconstructor(fileId, fileObject)\n\t{\n\t\tthis.id = fileId;\n\t\tthis.object = fileObject;\n\t\tthis.data = {\n\t\t\tNAME: fileObject.name,\n\t\t};\n\t\tEventEmitter.subscribe(this.object, 'onUploadProgress', this.onUploadProgress.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadDone', this.onUploadDone.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadError', this.onUploadError.bind(this));\n\t\tthis.progress = new BX.UI.ProgressRound({\n\t\t\twidth: 18,\n\t\t\tcolorTrack: 'rgba(255,255,255,.3)',\n\t\t\tcolorBar: '#fff',\n\t\t\tlineSize: 3,\n\t\t\tstatusType: BX.UI.ProgressRound.Status.INCIRCLE,\n\t\t\ttextBefore: '<i></i>',\n\t\t\ttextAfter: this.object.size,\n\t\t});\n\t}\n\n\tgetContainer()\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tlet extension = this.object.name.split('.').pop().toLowerCase();\n\t\t\textension = Text.encode(extension === this.object.name ? '' : extension);\n\t\t\tthis.container = Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension} disk-file-thumb--active\">\n\t\t\t<div class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div class=\"disk-file-thumb-text\">${this.object.name}</div>\n\t\t\t<div class=\"disk-file-thumb-loader\">\n\t\t\t\t${this.progress.getContainer()}\n\t\t\t\t<div class=\"disk-file-thumb-loader-btn\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t`;\n\t\t}\n\t\treturn this.container;\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tsetTimeout(() => { this.object.deleteFile(); }, 400);\n\t\tdelete this.container;\n\t}\n\n\tonUploadProgress({compatData: [fileObject, progress]})\n\t{\n\t\tprogress = Math.min(Math.max(this.progress.getValue(), progress), 98);\n\t\tthis.progress.update(progress);\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadDone', [file, fileObject.file]);\n\t\tdelete this.object.hash;\n\t\tthis.object.deleteFile();\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.setTextBefore(Loc.getMessage('WDUF_ITEM_ERROR'));\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t\tthis.object.deleteFile();\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport Options from './options';\nimport ItemNew from './items/item-new';\nimport 'main.core_uploader';\nimport type {ItemUploadedType, ItemSavedType} from \"./items/item-type\";\n\nexport default class FileUploader\n{\n\t#itemsCount: number = 0;\n\tcontainer: Element;\n\tstatic #deleted = Symbol('deleted');\n\n\n\tconstructor({id, container, dropZone, input})\n\t{\n\t\tthis.container = container;\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: dropZone,\n\t\t\tinput: input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tEventEmitter.subscribe(this.agent, 'onFileIsCreated', this.catchFile.bind(this));\n\t\tEventEmitter.subscribe(this.agent, 'onPackageIsInitialized', ({compatData: [packageFormer]}) => {\n\t\t\tconst previewParams = {\n\t\t\t\twidth: Options.previewSize.width,\n\t\t\t\theight: Options.previewSize.height,\n\t\t\t\texact: 'N'\n\t\t\t};\n\t\t\tif (packageFormer.data)\n\t\t\t{\n\t\t\t\tpackageFormer.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpackageFormer.post.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t});\n\t}\n\n\tcatchFile({compatData: [fileId, fileObject]})\n\t{\n\t\tthis.incrementItemsCount();\n\t\tconst item = new ItemNew(fileId, fileObject);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType, blob]}) => {\n\t\t\tif (!item[this.constructor.#deleted])\n\t\t\t{\n\t\t\t\tthis.decrementItemsCount();\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t\tblob: blob\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', ({data: [blob]}) => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer(), blob: blob});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\taddTestThumb(progressPercent)\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\tif (progressPercent > 0)\n\t\t{\n\t\t\titem.onUploadProgress({compatData: [null, progressPercent]})\n\t\t}\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\taddTestErrorThumb()\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\titem.onUploadError({compatData: [{file: null}]});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\tupload([...files])\n\t{\n\t\tthis.agent.onAttach(files);\n\t}\n\n\tconvertToItemSavedType(item: ItemUploadedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.attachId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: item.canChangeName,\n\t\t\tCAN_RENAME: item.canChangeName,\n\t\t\tCAN_MOVE:  item.canChangeName,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item.storage,\n\t\t\tTYPE_FILE: item.fileType,\n\t\t};\n\t}\n\tincrementItemsCount()\n\t{\n\t\tif (this.#itemsCount <= 0)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsStart');\n\t\t}\n\t\tthis.#itemsCount++;\n\t}\n\tdecrementItemsCount()\n\t{\n\t\tif (this.#itemsCount === 1)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsDone');\n\t\t}\n\n\t\tthis.#itemsCount = Math.max(this.#itemsCount--, 0);\n\t}\n}\n","import {Cache} from 'main.core';\n\nexport default class DefaultController {\n\thasContainer: boolean = false;\n\tcontainer: Element;\n\teventObject: Element;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false,\n\t};\n\n\tconstructor({container, eventObject})\n\t{\n\t\tthis.container = container;\n\t\tthis.eventObject = eventObject;\n\t\tthis.properties.pluggedIn = this.eventObject && this.eventObject.dataset.bxHtmlEditable === 'Y';\n\t\tif (!this.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hasContainer = true;\n\t}\n\n\n\tisRelevant()\n\t{\n\t\treturn this.hasContainer;\n\t}\n\n\tgetEventObject()\n\t{\n\t\treturn this.eventObject;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.container;\n\t}\n\n\tisPluggedIn(): boolean\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tshow()\n\t{\n\t\tthis.container.style.display = '';\n\t\tdelete this.container.style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.container.style.display = 'none';\n\t}\n}\n","import {Tag, Cache} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport default class ItemMoreButton\n{\n\thiddenFilesCount: number = 0;\n\tstepNumber: number = 0;\n\tcache = new Cache.MemoryCache();\n\tstepValue = 5;\n\n\tconstructor()\n\t{\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div class=\"ui-icon ui-icon-more disk-file-thumb-icon\">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class=\"disk-file-thumb-text\">${this.getValueContainer()}</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetValueContainer(): Element\n\t{\n\t\treturn this.cache.remember('valueContainer', () => {\n\t\t\treturn document.createElement('DIV');\n\t\t});\n\t}\n\n\treset()\n\t{\n\t\tthis.hiddenFilesCount = 1;\n\t\tthis.stepNumber = 0;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t\treturn this;\n\t}\n\n\tincrement()\n\t{\n\t\tthis.hiddenFilesCount++;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t}\n\n\tdecrement(step: number = 1)\n\t{\n\t\tthis.hiddenFilesCount -= step;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tif (this.hiddenFilesCount <= 0)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tthis.stepNumber++;\n\t\tconst itemsCount = Math.min(30, this.stepValue * this.stepNumber);\n\t\tthis.decrement(itemsCount);\n\t\tEventEmitter.emit(this, 'onGetMore', {itemsCount: itemsCount});\n\t}\n\n\tshow()\n\t{\n\t\tdelete this.getContainer().style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.getContainer().style.display = 'none';\n\t}\n}\n","import {ajax, Loc, Uri} from 'main.core';\n\nexport default class Backend\n{\n\tstatic urlSelect = '/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID=' +\n\t\tLoc.getMessage('SITE_ID') + '&dialog2=Y&ACTION=SELECT&MULTI=Y';\n\n\tstatic getSelectedFile(fileId, fileName, dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tACTION: 'none',\n\t\t\t\t\tMULTI: 'Y',\n\t\t\t\t\tID: ['E', fileId].join(''),\n\t\t\t\t\tNAME: fileName,\n\t\t\t\t\twish: 'fakemove',\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic loadFolder(fileId, fileName, dialogName)\n\t{\n\t\tconst targetID = fileId;\n\t\tconst libLink = Uri.addParam(\n\t\t\t[\n\t\t\t\tBX.DiskFileDialog.obCurrentTab[dialogName].link\n\t\t\t\t\t.replace('/index.php', '')\n\t\t\t\t\t.replace('/files/lib/', '/files/'),\n\t\t\t\t'element/upload',\n\t\t\t\ttargetID\n\t\t\t].join('/'),\n\t\t\t{\n\t\t\t\tuse_light_view: 'Y',\n\t\t\t\tAJAX_CALL: 'Y',\n\t\t\t\tSIMPLE_UPLOAD: 'Y',\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\tSECTION_ID: targetID,\n\t\t\t\tCHECK_NAME: fileName\n\t\t\t}\n\t\t);\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.loadJSON(libLink, {}, resolve);\n\t\t});\n\t}\n\n\tstatic getSelectedData(dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic getSelectedCloudData(dialogName, service)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tcloudImport: 1,\n\t\t\t\t\tservice: service,\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic moveFile(id, targetFolderId)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.Disk.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: BX.Disk.addToLinkParam('/bitrix/tools/disk/uf.php', 'action', 'moveUploadedFile'),\n\t\t\t\tdata: {\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\ttargetFolderId: targetFolderId\n\t\t\t\t},\n\t\t\t\tonsuccess: resolve\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic getMetaDataForCreatedFileInUf(id)\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'disk.api.file.getMetaDataForCreatedFileInUf',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tid: id\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic renameAction(id, newName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=renameFile',\n\t\t\t\t{\n\t\t\t\t\tnewName: newName,\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic deleteAction(id)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=deleteFile',\n\t\t\t\t{\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n}","import {Cache, Tag, Text, Type, Dom, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Menu} from 'main.popup';\nimport type {ItemSavedType} from './item-type';\nimport Backend from '../backend';\n\nexport default class Item extends EventEmitter\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false\n\t};\n\n\tconstructor(itemData: ItemSavedType)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('Disk:UF:');\n\t\tthis.id = String(itemData['ID']);\n\n\t\tthis.setData(itemData);\n\t\tthis.subscribe('onMoved', this.onMoved.bind(this))\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetFileId(): string\n\t{\n\t\treturn this.data.FILE_ID;\n\t}\n\n\tgetData(key:?string)\n\t{\n\t\tif (key)\n\t\t{\n\t\t\treturn this.data[key];\n\t\t}\n\t\treturn this.data;\n\t}\n\n\tgetAllIds()\n\t{\n\t\treturn [this.getId(), ['n', this.data.FILE_ID].join('')];\n\t}\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t}\n\n\tsetPluggedIn(value: boolean = true): boolean\n\t{\n\t\tthis.properties.pluggedIn = (value === true);\n\t}\n\n\tisPluggedIn()\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\tconst name = Text.encode(this.data['NAME']);\n\t\t\tlet extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\tswitch (extension) {\n\t\t\t\tcase 'pptx':\n\t\t\t\t\textension = 'ppt';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension}\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div data-bx-role=\"icon\" class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div data-bx-role=\"name\" class=\"disk-file-thumb-text\">${name}</div>\n\t\t\t<div class=\"disk-file-thumb-btn-box\">\n\t\t\t\t<div class=\"disk-file-thumb-btn-close\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t\t<div class=\"disk-file-thumb-btn-more\" data-bx-role=\"more\" onclick=\"${this.onClickMore.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\trename(newName: string)\n\t{\n\t\tthis.data['NAME'] = newName;\n\t\tif (this.hasContainer())\n\t\t{\n\t\t\tthis.getContainer().querySelector('[data-bx-role=\"name\"]').innerHTML = Text.encode(this.data['NAME']);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tconst keys = this.cache.keys();\n\t\tkeys.forEach((key) => {\n\t\t\tconst node = this.cache.get(key);\n\t\t\tif (Type.isDomNode(node) && node.parentNode)\n\t\t\t{\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t}\n\t\t\tthis.cache.delete(key);\n\t\t});\n\n\t\tthis.emit('onDestroy');\n\t}\n\n\thasContainer(): boolean\n\t{\n\t\treturn this.cache.has('container');\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tlet extension = this.getData('NAME').split('.').pop();\n\t\textension = (extension === this.getData('NAME') ? '' : ['.', extension].join(''));\n\t\tconst fullName = String(this.getData('NAME'));\n\t\tconst cleanName = fullName.substring(0, fullName.length - extension.length);\n\n\t\treturn this.cache.remember('menu', () => {\n\t\t\tconst moreButton = this.getContainer().querySelector('div[data-bx-role=\\'more\\']');\n\t\t\tconst contextMenu = new Menu({\n\t\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\t\tbindElement: moreButton,\n\t\t\t\titems: ([\n\t\t\t\t\tthis.isPluggedIn() ? {\n\t\t\t\t\t\tdataset: {bxRole: 'insertIntoTheText'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT'),\n\t\t\t\t\t\tonclick : (event, item) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClick(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'deleteFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_DELETE'),\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickDelete(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t/*TODO For the Future\n\t\t\t\t\t   (this.data['CAN_UPDATE'] === true && this.data['EDITABLE'] === true ? {\n\t\t\t\t\t\ttext:  Loc.getMessage('WDUF_ITEM_MENU_EDIT'),\n\t\t\t\t\t\tclassName: 'menu-popup-item-edit',\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickEdit(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null),*/\n\t\t\t\t\t(this.data['CAN_RENAME'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'renameFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_RENAME'),\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml:\n\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t`<textarea class=\"disk-file-popup-rename-file-textarea\"\n\t\t\t\t\t\t\t\t\t\t\tname=\"rename\" onkeydown=\"if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector('input[name=save]'), 'click'); }\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"${Text.encode(cleanName)}\">${Text.encode(cleanName)}</textarea>`,\n\t\t\t\t\t\t\t\t\t\t`<div class=\"ui-btn-container ui-btn-container-center\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-primary\" name=\"save\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_SAVE')}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-link\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_CANCEL')}\">\n\t\t\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t\t\t].join(''),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-rename-form',\n\t\t\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\t\t\tif (Type.isDomNode(event.target) && event.target.type === 'button')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tif (event.target.name === 'save')\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.onRenamed([item.getContainer().querySelector('textarea').value, extension].join(''));\n\t\t\t\t\t\t\t\t\t\t\tthis.clearMenu();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t} : null),\n\t\t\t\t\t{\n\t\t\t\t\t\tdelimiter : true,\n\t\t\t\t\t\ttext: [\n\t\t\t\t\t\t\tLoc.getMessage('WDUF_ITEM_MENU_FILE'),\n\t\t\t\t\t\t\tText.encode(this.data['SIZE'])\n\t\t\t\t\t\t].join(' ')\n\t\t\t\t\t},\n\t\t\t\t\t(this.data['CAN_MOVE'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'moveFile'},\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\tevent['counter'] = (event['counter'] ?? 1) + 1;\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickMoveTo(event, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : {\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t})\n\t\t\t\t].\n\t\t\t\tfilter(preItem => preItem !== null)),\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: 9\n\t\t\t});\n\t\t\treturn contextMenu;\n\t\t});\n\t}\n\n\tclearMenu()\n\t{\n\t\tif (this.cache.has('menu'))\n\t\t{\n\t\t\tthis.cache.get('menu').destroy();\n\t\t\tthis.cache.delete('menu');\n\t\t}\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tthis.emit('onClick');\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.emit('onDelete');\n\t\tthis.destroy();\n\t\tBackend.deleteAction(this.getId());\n\t}\n\n\tonClickMore(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.getMenu().show();\n\t}\n\n\tonClickEdit()\n\t{\n\n\t}\n\n\tonClickMoveTo(element_id, name, row)\n\t{\n\t\tconst result = EventEmitter.emit(BX.DiskFileDialog, 'onFileNeedsToMove', [this]);\n\t\treturn result.length > 0;\n\t}\n\n\tonMoved({data})\n\t{\n\t\tthis.data['STORAGE'] = data;\n\t\tthis.clearMenu();\n\t}\n\n\tonRenamed(newName)\n\t{\n\t\tif (this.getData('NAME') === newName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.rename(newName);\n\t\tBackend.renameAction(this.getId(), newName);\n\t}\n\n\t//region HTMLEditor functions\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\tif (this.getData('TYPE_FILE') === 'player')\n\t\t{\n\t\t\treturn `<img contenteditable=\"false\" class=\"bxhtmled-player-surrogate\" data-bx-file-id=\"${this.data.ID}\" id=\"${tagId}\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" />`;\n\t\t}\n\t\treturn `<span contenteditable=\"false\" data-bx-file-id=\"${this.data.ID}\" id=\"${tagId}\" style=\"color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;\">${Text.encode(this.data.NAME)}</span>`;\n\t}\n\t//endregion\n\n\tstatic detect()\n\t{\n\t\treturn true;\n\t}\n}\n","import {Cache, Tag, Text} from 'main.core';\nimport Item from './item';\nimport type {ItemSavedType} from './item-type';\n\nexport default class ItemImage extends Item\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t\tthis.data.BIG_REVIEW_URL = this.data.PREVIEW_URL.replace(/\\&(width|height)\\=\\d+/gi, '');\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\tconst name = Text.encode(this.data['NAME']);\n\t\t\tconst extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-preview\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div style=\"background-image: url('${this.data['PREVIEW_URL']}'); background-size: cover;\" class=\"disk-file-thumb-image\"></div>\n\t\t\t<div data-bx-role=\"icon\" class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div data-bx-role=\"name\" class=\"disk-file-thumb-text\">${name}</div>\n\t\t\t<div class=\"disk-file-thumb-btn-box\">\n\t\t\t\t<div class=\"disk-file-thumb-btn-close\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t\t<div class=\"disk-file-thumb-btn-more\" data-bx-role=\"more\" onclick=\"${this.onClickMore.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\treturn `<img style=\"max-width: 90%;\" data-bx-file-id=\"${this.data.ID}\" id=\"${tagId}\" src=\"${this.data.BIG_REVIEW_URL}\" />`\n\t}\n\n\tstatic detect(itemData: ItemSavedType)\n\t{\n\t\treturn !!itemData['PREVIEW_URL'];\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport FileController from './file-controller';\nimport Item from '../items/item';\nimport ItemImage from '../items/item-image';\n\nlet justCounter = 0;\n\nexport default class FileParser {\n\tid: String;\n\thtmlEditor;\n\titems: Map<Item>;\n\ttag: string = '[DISK FILE ID=#id#]';\n\tregexp: RegExp = /\\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\\]/ig;\n\n\tconstructor(fileController: FileController)\n\t{\n\t\tthis.id = ['diskfile' + justCounter++].join('_');\n\t\tthis.items = fileController.items;\n\t}\n\n\tgetInterface()\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tinit: (htmlEditor) => {\n\t\t\t\tthis.htmlEditor = htmlEditor;\n\t\t\t},\n\t\t\tparse: this.parse.bind(this),\n\t\t\tunparse: this.unparse.bind(this),\n\t\t};\n\t}\n\n\thasInterface()\n\t{\n\t\treturn this.regexp !== null && this.tag !== null;\n\t}\n\n\tsetParams({tag, regexp})\n\t{\n\t\tif (Type.isStringFilled(tag) && tag !== 'null')\n\t\t{\n\t\t\tthis.tag = tag;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.tag = null;\n\t\t}\n\n\t\tif (Type.isStringFilled(regexp) && regexp !== 'null')\n\t\t{\n\t\t\tthis.regexp = new RegExp(regexp);\n\t\t}\n\t\telse if (regexp instanceof RegExp)\n\t\t{\n\t\t\tthis.regexp = regexp;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.regexp = null;\n\t\t}\n\t}\n\n\tinsertFile(id: string)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\tconst bbDelimiter = item instanceof ItemImage ? '\\n' : ' ';\n\t\t\tconst htmlDelimiter = item instanceof ItemImage ? '<br>' : '&nbsp;';\n\t\t\tEventEmitter.emit(this.htmlEditor, 'OnInsertContent', [\n\t\t\t\tbbDelimiter + this.getItemBBCode(id) + bbDelimiter,\n\t\t\t\thtmlDelimiter + this.getItemHTML(id) + htmlDelimiter\n\t\t\t]);\n\t\t}\n\t}\n\n\tgetItemBBCode(id: String)\n\t{\n\t\treturn this.tag.replace('#id#', id);\n\t}\n\n\tgetItemHTML(id: String)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\treturn item.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false, {tag: this.id, fileId: id, itemId: item.getId()}));\n\t\t}\n\t\treturn null;\n\t}\n\n\tdeleteFile(fileId)\n\t{\n\t\tif (!this.items.has(fileId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileIds = this.items.get(fileId).getAllIds();\n\n\t\tif (this.htmlEditor.GetViewMode() === 'wysiwyg')\n\t\t{\n\t\t\tconst doc = this.htmlEditor.GetIframeDoc();\n\n\t\t\tfor (let ii in this.htmlEditor.bxTags)\n\t\t\t{\n\t\t\t\tif (this.htmlEditor.bxTags.hasOwnProperty(ii)\n\t\t\t\t\t&& typeof this.htmlEditor.bxTags[ii] === 'object'\n\t\t\t\t\t&& this.htmlEditor.bxTags[ii]['tag'] === this.id\n\t\t\t\t\t&& fileIds.indexOf(String(this.htmlEditor.bxTags[ii]['itemId'])) >= 0\n\t\t\t\t\t&& doc.getElementById(ii)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst node = doc.getElementById(ii);\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.htmlEditor.SaveContent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = this.htmlEditor.GetContent().replace(this.regexp,\n\t\t\t\tfunction(str, foundId) {\n\t\t\t\t\treturn fileIds.indexOf(foundId) >= 0 ? '' : str;\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.htmlEditor.SetContent(content);\n\t\t\tthis.htmlEditor.Focus();\n\t\t}\n\t}\n\n\tparse(content)\n\t{\n\t\tif (!this.regexp.test(content))\n\t\t{\n\t\t\treturn content;\n\t\t}\n\t\tcontent = content.replace(\n\t\t\tthis.regexp,\n\t\t\tfunction(str, id)\n\t\t\t{\n\t\t\t\tconst foundedItem = this.items.has(id) ? this.items.get(id) : [...this.items.values()].find((item: Item) => {\n\t\t\t\t\treturn item.getAllIds().indexOf(id) >= 0;\n\t\t\t\t});\n\t\t\t\tif (foundedItem)\n\t\t\t\t{\n\t\t\t\t\treturn foundedItem.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false, {tag: this.id, fileId: id, itemId: foundedItem.getId()}))\n\t\t\t\t}\n\t\t\t\treturn str;\n\t\t\t}.bind(this)\n\t\t);\n\t\treturn content;\n\t}\n\n\tunparse(bxTag, {node})\n\t{\n\t\tconst id = bxTag.itemId;\n\n\t\tif (this.items.has(id))\n\t\t{\n\t\t\treturn this.getItemBBCode(id);\n\t\t}\n\t\treturn '';\n\t}\n}","import Item from './item';\nimport ItemImage from './item-image';\n\nconst itemMappings = [\n\tItem,\n\tItemImage,\n];\n\nexport default function getItem(itemData): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn new itemClassName(itemData);\n}","import {Type, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport ItemMoreButton from '../items/item-more';\nimport FileParser from './file-parser';\nimport type {ItemSavedType, ItemNew} from '../items/item-type';\nimport getItem from '../items/index';\n\nexport default class FileController extends DefaultController {\n\tmaxVisibleCount = 10;\n\tparser: FileParser;\n\tprefixHTMLNode = 'disk-attach-';\n\n\tconstructor({id, container, fieldName, multiple, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject});\n\t\tthis.items = new Map();\n\t\tthis.multiple = multiple !== false;\n\t\tthis.fieldName = fieldName;\n\t\tif (!container.querySelector('[data-bx-role=\"placeholder\"]'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tthis.buildInHTMLEditor();\n\t\t}\n\t}\n\n\tbuildInHTMLEditor()\n\t{\n\t\tif (this.getParser().hasInterface())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'OnParserRegister', this.getParser().getInterface());\n\t\t}\n\t\tEventEmitter.subscribe(this.eventObject, 'onReinitializeBefore', ({data: [text, fileData]}) => {\n\t\t\tlet manualClearing = true;\n\t\t\tif (fileData)\n\t\t\t{\n\t\t\t\tObject.values(fileData).forEach((uf) => {\n\t\t\t\t\tif (uf &&\n\t\t\t\t\t\tuf['USER_TYPE_ID'] === \"disk_file\"\n\t\t\t\t\t\t&& uf['FIELD_NAME'].replace('[]', '') === this.fieldName.replace('[]', '')\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst items = [];\n\t\t\t\t\t\t\tconst duplicateControlItems = {};\n\t\t\t\t\t\t\tif (Type.isArray(uf['VALUE']))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tuf['VALUE'].forEach((id) => {\n\t\t\t\t\t\t\t\t\tlet node = document.querySelector(['#', this.prefixHTMLNode, id].join(''));\n\t\t\t\t\t\t\t\t\tconst stringId = String(id);\n\t\t\t\t\t\t\t\t\tif (!node || duplicateControlItems[stringId])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tduplicateControlItems[stringId] = true;\n\n\t\t\t\t\t\t\t\t\tconst img = node.querySelector('img') || node.querySelector('div[data-bx-preview]');\n\t\t\t\t\t\t\t\t\tconst infoNode = img || node;\n\t\t\t\t\t\t\t\t\tconst name = infoNode.hasAttribute(\"data-title\") ? infoNode.getAttribute(\"data-title\")\n\t\t\t\t\t\t\t\t\t\t: (infoNode.hasAttribute(\"data-bx-title\") ? infoNode.getAttribute(\"data-bx-title\") : '');\n\n\t\t\t\t\t\t\t\t\tconst itemData = {\n\t\t\t\t\t\t\t\t\t\tID: id,\n\t\t\t\t\t\t\t\t\t\tFILE_ID: infoNode.getAttribute(\"bx-attach-file-id\"),\n\t\t\t\t\t\t\t\t\t\t// IS_LOCKED: boolean\n\t\t\t\t\t\t\t\t\t\t// IS_MARK_DELETED: boolean\n\t\t\t\t\t\t\t\t\t\t// EDITABLE: boolean\n\t\t\t\t\t\t\t\t\t\t// FROM_EXTERNAL_SYSTEM: boolean\n\n\t\t\t\t\t\t\t\t\t\tCAN_RESTORE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_UPDATE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_RENAME: false,\n\t\t\t\t\t\t\t\t\t\tCAN_MOVE: false,\n\n\t\t\t\t\t\t\t\t\t\tCOPY_TO_ME_URL: null,\n\t\t\t\t\t\t\t\t\t\tDELETE_URL: null,\n\t\t\t\t\t\t\t\t\t\tDOWNLOAD_URL: null,\n\t\t\t\t\t\t\t\t\t\tEDIT_URL: null,\n\t\t\t\t\t\t\t\t\t\tVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tPREVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\t\t\t\t\t\t\t\tEXTENSION: name.split('.').pop(),\n\t\t\t\t\t\t\t\t\t\tNAME: name,\n\t\t\t\t\t\t\t\t\t\tSIZE: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSIZE_BYTES: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSTORAGE: 'disk',\n\t\t\t\t\t\t\t\t\t\tTYPE_FILE: infoNode.getAttribute(\"bx-attach-file-type\"),\n\t\t\t\t\t\t\t\t\t\t// width: node.getAttribute(\"data-bx-width\"),\n\t\t\t\t\t\t\t\t\t\t// height: node.getAttribute(\"data-bx-height\"),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tif (img)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titemData['PREVIEW_URL'] = img.hasAttribute('data-bx-preview') && Type.isStringFilled(img.getAttribute('data-bx-preview'))\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-bx-preview') : (\n\t\t\t\t\t\t\t\t\t\t\t\timg.hasAttribute('data-thumb-src') && Type.isStringFilled(img.getAttribute('data-thumb-src'))\n\t\t\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-thumb-src') :\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.src\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\titemData['BIG_PREVIEW_URL'] = img.hasAttribute(\"data-bx-src\")\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute(\"data-bx-src\") :\n\t\t\t\t\t\t\t\t\t\t\timg.getAttribute('data-src')\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\titems.push(itemData);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.set(items);\n\t\t\t\t\t\t\tmanualClearing = false;\n\t\t\t\t\t\t}catch (e) {\n\t\t\t\t\t\t\tconsole.log('e: ', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (manualClearing !== false)\n\t\t\t{\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t});\n\t}\n\n\tset(values: Array<ItemSavedType>): Promise\n\t{\n\t\tthis.clear();\n\n\t\tlet counter = this.maxVisibleCount;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tvalues.forEach((itemData: ItemSavedType) => {\n\t\t\t\tconst item = this.addItem(itemData);\n\t\t\t\tcounter--;\n\t\t\t\tif (counter > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.appendNode(item);\n\t\t\t\t}\n\t\t\t\telse if (counter === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.container.appendChild(this.getItemMore().reset().getContainer());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.getItemMore().increment();\n\t\t\t\t}\n\t\t\t});\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tclear()\n\t{\n\t\tthis.items.forEach((item) => {\n\t\t\titem.destroy();\n\t\t});\n\n\t\tthis.container.innerHTML = '';\n\t}\n\n\t// to add into DOM fom uploader\n\tadd(itemData: ItemNew, itemContainer: ?Element)\n\t{\n\t\tthis.multiple || this.clear();\n\t\tconst item = this.addItem(itemData);\n\t\tthis.appendNode(item, itemContainer);\n\t\treturn item;\n\t}\n\n\taddItem(itemData: ItemSavedType)\n\t{\n\t\tconst item = getItem(itemData);\n\n\t\tlet input = this.getContainer()\n\t\t\t.querySelector(`[data-bx-role=\"reserve-item\"][value=\"${item.getId()}\"]`);\n\t\tif (!input)\n\t\t{\n\t\t\tinput = document.createElement('INPUT');\n\t\t\tinput.name = this.fieldName;\n\t\t\tinput.type = 'hidden';\n\t\t\tinput.value = item.getId();\n\t\t\tthis.container.appendChild(input);\n\t\t}\n\t\titem.subscribe('onDelete', () => {\n\t\t\tif (input && input.parentNode)\n\t\t\t{\n\t\t\t\tinput.parentNode.removeChild(input);\n\t\t\t}\n\t\t\tEventEmitter.emit(this, 'OnItemDelete', item);\n\t\t});\n\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Increment');\n\t\t\tif (this.getParser().hasInterface())\n\t\t\t{\n\t\t\t\titem.setPluggedIn();\n\t\t\t\titem.subscribe('onClick', () => {\n\t\t\t\t\tthis.getParser().insertFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDelete', () => {\n\t\t\t\t\tthis.getParser().deleteFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDestroy', () => {\n\t\t\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Decrement');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.items.set(item.getId(), item);\n\t\treturn item;\n\t}\n\n\tgetItem(id)\n\t{\n\t\treturn this.items.get(id);\n\t}\n\n\t/*@\n\tAppends node to the container\n\t */\n\tappendNode(item: Item, itemContainer: ?Element)\n\t{\n\t\tif (itemContainer)\n\t\t{\n\t\t\tif (itemContainer.parentNode)\n\t\t\t{\n\t\t\t\titemContainer.parentNode.replaceChild(item.getContainer(), itemContainer)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.container.appendChild(item.getContainer());\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetItemMore(): ItemMoreButton\n\t{\n\t\treturn this.cache.remember('moreButton', () => {\n\t\t\tconst res = new ItemMoreButton();\n\t\t\tEventEmitter.subscribe(res, 'onGetMore', this.showMoreItems.bind(this));\n\t\t\treturn res;\n\t\t});\n\t}\n\n\tshowMoreItems({data:{itemsCount}})\n\t{\n\t\tconst timeoutCounter = itemsCount;\n\t\tconst itemMoreNode = this.getItemMore().getContainer();\n\t\titemMoreNode.style.opacity = '0';\n\t\titemMoreNode.style.visibility = 'hidden';\n\t\tthis.items.forEach((item: Item) => {\n\t\t\tif (itemsCount > 0)\n\t\t\t{\n\t\t\t\tif (!item.hasContainer())\n\t\t\t\t{\n\t\t\t\t\titemsCount--;\n\t\t\t\t\tconst node = document.createElement('DIV');\n\t\t\t\t\titemMoreNode.parentNode.insertBefore(node, itemMoreNode);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '0');\n\t\t\t\t\t\tDom.addClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '');\n\t\t\t\t\t\tnode.parentNode.replaceChild(item.getContainer(), node);\n\t\t\t\t\t\titem.getContainer().addEventListener('transitionend', () => {\n\t\t\t\t\t\t\tDom.removeClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\t})\n\t\t\t\t\t}, (timeoutCounter - itemsCount) * 100);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (itemsCount <= 0)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\titemMoreNode.style.opacity = '';\n\t\t\t\titemMoreNode.style.visibility = '';\n\t\t\t}, timeoutCounter * 100 + 100);\n\t\t}\n\t}\n\n\tgetParser()\n\t{\n\t\tthis.parser = this.parser || new FileParser(this);\n\t\treturn this.parser;\n\t}\n}\n","import {Loc} from 'main.core';\nimport {Menu, MenuItem} from 'main.popup';\nimport DefaultController from \"./default-controller\";\nimport Options from \"../options\";\n\nexport default class SettingsController extends DefaultController\n{\n\tallowEditNode: ?Element;\n\tallowGridNode: ?Element;\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"setting\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tthis.getContainer().addEventListener('click', this.show.bind(this))\n\t\t\tthis.allowEditNode = container.querySelector('input[data-bx-role=\"settings-allow-edit\"]');\n\t\t\tthis.allowGridNode = container.querySelector('input[data-bx-role=\"settings-allow-grid\"]');\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = new Menu({\n\t\t\t\tbindElement: this.getContainer(),\n\t\t\t\tclassName: 'disk-uf-file-popup-settings',\n\t\t\t\titems: [\n\t\t\t\t\tthis.allowEditNode ? {\n\t\t\t\t\t\tdataset: {bxRole: 'allowEdit'},\n\t\t\t\t\t\tclassName: this.allowEditNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_EDIT'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowEditNode.checked = !this.allowEditNode.checked;\n\t\t\t\t\t\t\tif (this.allowEditNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'allowGrid'},\n\t\t\t\t\t\tclassName: this.allowGridNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_COLLAGE'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowGridNode.checked = !this.allowGridNode.checked;\n\t\t\t\t\t\t\tif (this.allowGridNode.dataset.bxSave === 'Y')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.userOptions.save('disk', 'disk.uf.file', this.allowGridNode.dataset.bxName, (this.allowGridNode.checked ? 'grid' : '.default'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.allowGridNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.buildDocumentServiceTextLabel(),\n\t\t\t\t\t\titems: this.buildSubMenuWithDocumentServices(),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tangle: true,\n\t\t\t\toffsetTop: -16,\n\t\t\t\toffsetLeft: 16,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tdelete this.popup;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tthis.popup.show()\n\t}\n\n\tbuildDocumentServiceTextLabel(): string\n\t{\n\t\tlet currentService = BX.Disk.getDocumentService();\n\t\tif (!currentService && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tcurrentService = 'onlyoffice';\n\t\t}\n\t\telse if (!currentService)\n\t\t{\n\t\t\tcurrentService = 'l';\n\t\t}\n\n\t\tconst name = Options.getDocumentHandler(currentService).name;\n\n\t\treturn Loc.getMessage('DISK_UF_FILE_EDIT_SERVICE_LABEL', { '#NAME#' : name});\n\t}\n\n\tbuildSubMenuWithDocumentServices(): Array<Object>\n\t{\n\t\tlet items = [];\n\n\t\tOptions.getDocumentHandlers().forEach(item => {\n\t\t\titems.push({\n\t\t\t\ttext: item.name,\n\t\t\t\tdataset: {\n\t\t\t\t\tcode: item.code,\n\t\t\t\t},\n\t\t\t\tonclick: (event, item: MenuItem) => {\n\t\t\t\t\tBX.Disk.saveDocumentService(item.dataset.code);\n\n\t\t\t\t\titem.getMenuWindow().getParentMenuItem().setText(this.buildDocumentServiceTextLabel());\n\t\t\t\t\titem.getMenuWindow().getPopupWindow().close();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\thide()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n \t\t}\n\t}\n}","import DefaultController from './default-controller';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedType, ItemUploadedType} from \"../items/item-type\";\n\nexport default class DocumentController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"document-area\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tArray.from(\n\t\t\t\tthis.getContainer().querySelectorAll('[data-bx-handler]')\n\t\t\t)\n\t\t\t\t.forEach((item) => {\n\t\t\t\t\titem.addEventListener('click', () => {\n\t\t\t\t\t\tthis.createDocument(item.getAttribute('data-bx-handler'));\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t}\n\t}\n\n\tcreateDocument(documentType)\n\t{\n\t\tif (!BX.Disk.getDocumentService() && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('onlyoffice');\n\t\t}\n\t\telse if (!BX.Disk.getDocumentService())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('l');\n\t\t}\n\n\t\tlet insertDocumentIntoUf = function (extendedFileData) {\n\t\t\tvar parts = extendedFileData.object.name.split('.');\n\t\t\tparts.pop();\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(this,\n\t\t\t\t\t'onFileIsCreated',\n\t\t\t\t\t{itemData: this.convertToItemSavedType(extendedFileData)});\n\t\t\t}, 200);\n\t\t}.bind(this);\n\n\t\tif (BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk())\n\t\t{\n\t\t\tBX.Disk.Document.Local.Instance.createFile({\n\t\t\t\ttype: documentType\n\t\t\t}).then(function (response) {\n\t\t\t\tinsertDocumentIntoUf(response);\n\t\t\t}.bind(this));\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet createProcess = new BX.Disk.Document.CreateProcess({\n\t\t\ttypeFile: documentType,\n\t\t\tserviceCode: BX.Disk.getDocumentService(),\n\t\t\tonAfterSave: function(response, extendedFileData) {\n\t\t\t\tif (response.status !== 'success')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!extendedFileData)\n\t\t\t\t{\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.getMetaDataForCreatedFileInUf(response.object.id)\n\t\t\t\t\t\t.then(function({data}) {\n\t\t\t\t\t\t\tinsertDocumentIntoUf(data);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tinsertDocumentIntoUf(extendedFileData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tcreateProcess.start();\n\t}\n\n\tconvertToItemSavedType(extendedFileData) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: 'n' + extendedFileData.object.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: true,\n\t\t\tCAN_RENAME: true,\n\t\t\tCAN_MOVE:  true,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: extendedFileData.link,\n\t\t\tPREVIEW_URL: null,\n\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\tEXTENSION: extendedFileData.object.extension,\n\t\t\tNAME: extendedFileData.object.name,\n\t\t\tSIZE: extendedFileData.object.size,\n\t\t\tSIZE_BYTES: extendedFileData.object.sizeInt,\n\t\t\tSTORAGE: extendedFileData.folderName\n\t\t};\n\t}\n}\n\n","import DefaultController from './default-controller';\n\nexport default class PanelController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"control-panel\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t}\n}","import {Uri, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport Backend from '../backend';\nimport type {ItemSelectedType, ItemSavedType} from \"../items/item-type\";\n\nlet justCounter = 0;\nexport default class FileSelector extends DefaultController\n{\n\topened: boolean = false;\n\tdialogName: string;\n\tconstructor({container, eventObject})\n\t{\n\t\tconst node = container.querySelector('[data-bx-role=\"file-local-controller\"]') ||\n\t\t\tcontainer.querySelector('.diskuf-selector-link');\n\n\t\tsuper({\n\t\t\tcontainer: node,\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tthis.dialogName = ['selectFile', justCounter++].join('-');\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getContainer().addEventListener('click', this.onClick.bind(this));\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t}\n\n\tonClick()\n\t{\n\t\tBackend\n\t\t\t.getSelectedData(this.dialogName)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {itemData: this.convertToItemSavedType(selected[id])});\n\t\t\t}\n\t\t}\n\t}\n\n\tconvertToItemSavedType(item: ItemSelectedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item['storage'] ?? Loc.getMessage('WDUF_MY_DISK'),\n\t\t};\n\t}\n}\n","import {Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\nimport ItemNew from \"./item-new\";\n\nexport default class ItemNewSelectedCloud extends ItemNew\n{\n\tconstructor(fileId, fileObject: ItemNewSelectedCloud)\n\t{\n\t\tsuper(fileId, fileObject);\n\n\t\tBX.Disk.ExternalLoader.startLoad({\n\t\t\tfile: {\n\t\t\t\tid: this.id,\n\t\t\t\tname: this.object.name,\n\t\t\t\tservice: this.object.service\n\t\t\t},\n\t\t\tonFinish: (newData) => {\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', [newData]);\n\t\t\t},\n\t\t\tonProgress: (progress) => {\n\t\t\t\tthis.onUploadProgress({compatData: [{}, progress]});\n\t\t\t}\n\t\t});\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tdelete this.container;\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.getContainer().parentNode.removeChild(this.progress.getContainer());\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t}\n}\n","import {Uri} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedCloudType, ItemSavedType, ItemUploadedType, ItemSelectedCloudType} from \"../items/item-type\";\nimport ItemNewSelectedCloud from \"../items/item-new-selected-cloud\";\nimport DefaultController from \"./default-controller\";\n\nlet justCounter = 0;\nexport default class FileSelectorCloud extends DefaultController\n{\n\tdialogName: string;\n\tservices: Array<Element> = [];\n\titems: Map = new Map;\n\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tArray.from(\n\t\t\tcontainer\n\t\t\t\t.querySelectorAll('[data-bx-role=\"file-external-controller\"]')\n\t\t)\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\t\tArray.from(\n\t\t\tcontainer\n\t\t\t\t.querySelectorAll('.diskuf-selector-link-cloud')\n\t\t)\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\n\t\tthis.eventObject = eventObject;\n\t\tthis.dialogName = ['selectFileCloud', justCounter++].join('-');\n\t\tthis.services.forEach((node) => {\n\t\t\tnode.addEventListener('click', this.onClick.bind(this));\n\t\t});\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tthis.currentService = event.currentTarget.getAttribute('data-bx-doc-handler');\n\n\t\tBackend\n\t\t\t.getSelectedCloudData(this.dialogName, this.currentService)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id) && selected[id].type === 'file')\n\t\t\t{\n\t\t\t\tthis.catchFile(selected[id], this.currentService);\n\t\t\t}\n\t\t}\n\t\tthis.currentService = null;\n\t}\n\n\tcatchFile(fileObject: ItemSelectedCloudType, service)\n\t{\n\t\tif (this.items.has(fileObject.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfileObject['service'] = fileObject['provider'] || service;\n\t\tconst item = new ItemNewSelectedCloud(fileObject.id, fileObject);\n\t\tthis.items.set(item.id, item);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType]}) => {\n\t\t\tif (this.items.has(item.id))\n\t\t\t{\n\t\t\t\tthis.items.delete(item.id);\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer()});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\tconvertToItemSavedType(item: ItemSavedCloudType) :ItemSavedType\n\t{\n\t\tconst extension = item.name.split('.').pop().toLowerCase();\n\t\tconst itemData = {\n\t\t\tID: item.ufId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: true,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: extension === item.name ? '' : extension,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.sizeFormatted,\n\t\t\tSIZE_BYTES: item.size,\n\t\t\tSTORAGE: item.storage,\n\t\t};\n\t\treturn itemData;\n\t}\n}\n","import {Uri, Loc} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport Item from \"../items/item\";\n\nexport default class FileMover\n{\n\tstatic subscribed = false;\n\tstatic instance = null;\n\tdialogName: string = 'moveFile';\n\titem: ?Item;\n\ttimeout: ?number;\n\n\tconstructor()\n\t{\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.loadFolder = this.loadFolder.bind(this);\n\t\tthis.stopLoadingFolder = this.stopLoadingFolder.bind(this);\n\t\tthis.checkFileName = this.checkFileName.bind(this);\n\t\tthis.onApply = this.onApply.bind(this);\n\t\tthis.onCancel = this.onCancel.bind(this);\n\t}\n\n\tfire(item: Item): void\n\t{\n\t\tif (this.item !== null && this.item !== item)\n\t\t{\n\t\t\tthis.onCancel();\n\t\t}\n\n\t\tthis.item = item;\n\t\tBackend.getSelectedFile(\n\t\t\titem.getFileId(),\n\t\t\titem.getData('NAME'),\n\t\t\tthis.dialogName\n\t\t)\n\t\t.then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.onApply, cancelButton: this.onCancel};\n\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t}, 10)\n\t\t});\n\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.subscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t}\n\n\topenSection({data: [link, someDialogName]}): void\n\t{\n\t\tif (someDialogName === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[someDialogName] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tloadFolder({data: [element, itemId: string, someDialogName]}): void\n\t{\n\t\tif (someDialogName !== this.dialogName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBackend\n\t\t\t.loadFolder(itemId.substr(1), this.item.getData('NAME'), this.dialogName)\n\t\t\t.then((result) => {\n\t\t\t\tconst documentExists = (result.permission === true && result[\"okmsg\"] !== '');\n\n\t\t\t\tif (this.timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.timeout);\n\t\t\t\t}\n\t\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\t\tif (documentExists)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t});\n\t}\n\n\tstopLoadingFolder({data: someData}): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = setTimeout(this.checkFileName, 200);\n\t}\n\n\tonApply(tab, path, selected, folderByPath)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\n\t\tif (!this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = this.item.getId();\n\t\tlet moved = false;\n\n\t\tconst moveQuery = (id, targetFolderId, sectionProperties, sectionPath) => {\n\t\t\tBackend\n\t\t\t\t.moveFile(id, targetFolderId)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response || response.status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.showMovedFile(id, sectionProperties, sectionPath);\n\t\t\t\t});\n\t\t};\n\n\t\tlet sectionPath, sectionProperties;\n\t\tfor (let i in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(i) && selected[i].type === 'folder')\n\t\t\t{\n\t\t\t\tsectionPath = tab.name + selected[i].path;\n\t\t\t\tsectionProperties = { sectionID : i, iblockID : tab.iblock_id };\n\n\t\t\t\tmoveQuery(id, selected[i].id, sectionProperties, sectionPath);\n\t\t\t\tmoved = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!moved)\n\t\t{\n\t\t\tsectionPath = tab.name;\n\t\t\tsectionProperties = { sectionID : tab.section_id, iblockID : tab.iblock_id };\n\t\t\tif (!!folderByPath && !!folderByPath.path && folderByPath.path !== '/')\n\t\t\t{\n\t\t\t\tsectionPath += folderByPath.path;\n\t\t\t\tsectionProperties.sectionID = folderByPath.id;\n\t\t\t\tif(!!folderByPath)\n\t\t\t\t{\n\t\t\t\t\tmoveQuery(id, folderByPath.id, sectionProperties, sectionPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckFileName(someDialogName): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\n\t\tif (someDialogName !== this.dialogName || !this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileName = this.item.getData('NAME');\n\t\tlet exist = false;\n\n\t\tfor (let i in BX.DiskFileDialog.obItems[this.dialogName])\n\t\t{\n\t\t\tif (BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(i)\n\t\t\t\t&& BX.DiskFileDialog.obItems[this.dialogName][i]['name'] === fileName)\n\t\t\t{\n\t\t\t\texist = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (exist)\n\t\t{\n\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t}\n\t}\n\n\tshowMovedFile(id, sectionProperties, sectionPath): void\n\t{\n\t\tif (this.item)\n\t\t{\n\t\t\tthis.item.emit('onMoved', sectionPath);\n\t\t}\n\t\tthis.item = null;\n\t}\n\n\tonCancel(): void\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t\tthis.item = null;\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = null;\n\t}\n\n\tstatic subscribe(): void\n\t{\n\t\tif (BX.DiskFileDialog.subscribed !== true)\n\t\t{\n\t\t\tBX.DiskFileDialog.subscribed = true;\n\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'onFileNeedsToMove', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tFileMover.getInstance().fire([...event.getData()].shift());\n\t\t\t})\n\t\t}\n\t}\n\n\tstatic getInstance(): FileMover\n\t{\n\t\tif (this.instance === null)\n\t\t{\n\t\t\tthis.instance = new FileMover();\n\t\t}\n\t\treturn this.instance;\n\t}\n}\n","import {Tag, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport DefaultController from './controllers/default-controller';\nimport Options from \"./options\";\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport type {ItemSavedType} from './items/item-type'\n\nlet justCounter = 0;\nfunction _camelToSNAKE(obj)\n{\n\tvar o = {}, i, k;\n\tfor (i in obj)\n\t{\n\t\tk = i.replace(/(.)([A-Z])/g, \"$1_$2\").toUpperCase();\n\t\to[k] = obj[i];\n\t\to[i] = obj[i];\n\t}\n\n\treturn o;\n}\n\nexport default class FormBrief extends DefaultController {\n\tid: string;\n\tfileUploader: FileUploader;\n\tfieldName: string;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\n\tconstructor({id, fieldName, container, eventObject, input})\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (!this.input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tstreams: 1,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: null,\n\t\t\tinput: this.input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tthis.onUploadDone = this.onUploadDone.bind(this);\n\t\tthis.onUploadError = this.onUploadError.bind(this);\n\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploaded\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadDone(item, params);\n\t\t});\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploadedWithError\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadError(item, params);\n\t\t});\n\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t}\n\n\tonSelectionIsDone(item: ItemSavedType)\n\t{\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + item['ID'],\n\t\t\t'bx-agentFileId': item['ID']\n\t\t};\n\t\tif (item[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + item[\"FILE_ID\"];\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${item['ID']}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\n\t\tlet res = {\n\t\t\telement_id: item['ID'],\n\t\t\telement_name: item['NAME'],\n\t\t\telement_url: item['PREVIEW_URL'],\n\t\t\tstorage: item['STORAGE']\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, {}, null, {\n\t\t\t\tid: justCounter++,\n\t\t\t\tname: item['NAME'],\n\t\t\t\tsize: item['SIZE'],\n\t\t\t\tsizeInt: item['SIZE_INT'],\n\t\t\t}]})\n\t\t);\n\n\t}\n\n\tonUploadDone(item, result)\n\t{\n\t\tif (result[\"file\"] && result[\"file\"][\"attachId\"] !== result[\"file\"][\"id\"])\n\t\t{\n\t\t\tresult[\"file\"][\"id\"] = result[\"file\"][\"attachId\"];\n\t\t\tdelete result[\"file\"][\"attachId\"];\n\t\t}\n\n\t\tconst file = _camelToSNAKE(result[\"file\"]);\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + file.id,\n\t\t\t'bx-agentFileId': item.id\n\t\t};\n\t\tif (file[\"XML_ID\"])\n\t\t\tattrs[\"bx-attach-xml-id\"] = file[\"XML_ID\"];\n\t\tif (file[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + file[\"FILE_ID\"];\n\t\tif (file['FILE_TYPE'])\n\t\t\tattrs[\"bx-attach-file-type\"] = file[\"FILE_TYPE\"];\n\t\tfile.element_id = file.id;\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${file.id}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\t\tthis.onFileIs(item, file);\n\t}\n\t\n\tonFileIs(item, file)\n\t{\n\t\tlet res = {\n\t\t\telement_id : file.element_id,\n\t\t\telement_name : (file.element_name || item.name),\n\t\t\telement_url: (file.element_name || file.previewUrl || file.preview_url),\n\t\t\tstorage: 'disk'\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, this, item.file, item]}));\n\t}\n\n\tonUploadError(item, params)\n\t{\n\t\tBX.onCustomEvent(this.getEventObject(), 'OnFileUploadFailed', [this, item.file, item]);\n\t}\n}","import {Loc, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport FileController from './controllers/file-controller';\nimport DefaultController from './controllers/default-controller';\nimport SettingsController from './controllers/settings-controller';\nimport DocumentController from './controllers/document-controller';\nimport PanelController from './controllers/panel-controller';\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport FileMover from \"./controllers/file-mover\";\nimport {Ears} from 'ui.ears';\nimport FormBrief from './form-brief'\n\nexport default class Form extends DefaultController {\n\tid: string;\n\tfilesController: FileController;\n\tfileUploader: FileUploader;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\tfieldName: string;\n\n\tconstructor({id, fieldName, container, eventObject, input, parserParams}, values: ?Array)\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (parserParams)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.getParser()\n\t\t\t\t.setParams(parserParams);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (values.length > 0)\n\t\t{\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.show(values);\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.input)\n\t\t{\n\t\t\tthis.getFilesUploader();\n\t\t}\n\n\t\tthis.initDocumentController();\n\t\tthis.settingsController = new SettingsController(this, {});\n\t\tthis.panelController = new PanelController(this);\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t});\n\n\t\tconst switcher = (event: BaseEvent) => {\n\t\t\tlet status = Type.isArray(event.getData()) ? event.getData().shift() : event.getData();\n\t\t\tif (status === 'show')\n\t\t\t{\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\t\t//region compatibility\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onCollectControllers', (event) => {\n\t\t\tevent.data[this.fieldName] = {\n\t\t\t\tstorage: 'disk',\n\t\t\t\ttag: this.getFileController().isPluggedIn() ? this.getFileController().getParser().tag : null,\n\t\t\t\tvalues: [],\n\t\t\t\thandler: {\n\t\t\t\t\tselectFile: (tab, path, selected) => {\n\t\t\t\t\t\tthis.fileSelector.selectFile(tab, path, selected);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tArray.from(\n\t\t\t\tthis.getContainer()\n\t\t\t\t\t.querySelectorAll(`input[type=\"hidden\"][name=\"${this.fieldName}\"]`)\n\t\t\t)\n\t\t\t\t.forEach((nodeItem) => {\n\t\t\t\t\tevent.data[this.fieldName].values.push(nodeItem.value);\n\t\t\t\t});\n\t\t});\n\t\t//endregion\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\n\t\t// (new Ears({\n\t\t// \tcontainer: this.getContainer().querySelector('[data-bx-role=\"control-panel-main-actions\"]'),\n\t\t// \tnoScrollbar: false,\n\t\t// \tclassName: 'disk-documents-ears'\n\t\t// })).init();\n\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:upload', ({data}) => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestThumb(data);\n\t\t});\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:error', () => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestErrorThumb();\n\t\t});\n\t}\n\n\tinitDocumentController()\n\t{\n\t\tthis.documentController = new DocumentController({container: this.getContainer(), eventObject: this.getEventObject()});\n\t\tEventEmitter.subscribe(this.documentController, 'onFileIsCreated', ({data: {itemData}}) => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\n\t\tif (!this.documentController.isRelevant())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\telse if (!this.isPluggedIn())\n\t\t{\n\t\t\tthis.documentController.show();\n\t\t\treturn;\n\t\t}\n\t\tif (this.eventObject.dataset.bxDiskDocumentButton !== 'added')\n\t\t{\n\t\t\tthis.eventObject.dataset.bxDiskDocumentButton = 'added';\n\n\t\t\tconst node = document.createElement('DIV');\n\t\t\tnode.addEventListener('click', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container && container.hasAttribute('data-bx-button-status'))\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'hide');\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowDocuments', 'show')\n\t\t\t\t}\n\t\t\t});\n\t\t\tnode.innerHTML = '<i></i>' + Loc.getMessage('WDUF_CREATE_DOCUMENT');\n\n\t\t\tEventEmitter.emit(this.eventObject, 'OnAddButton', [{BODY: node, ID: 'disk-document'}, 'file']);\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.setAttribute('data-bx-button-status', 'active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.removeAttribute('data-bx-button-status');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\tsuper.show();\n\t\t\tthis.documentController.show();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\tsuper.hide();\n\t\t\tthis.documentController.hide();\n\t\t});\n\t\tconst switcher = ({data}) => {\n\t\t\tif (data === 'show')\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t}\n\t\t};\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t}\n\n\tgetFileController(): FileController\n\t{\n\t\tif (!this.filesController)\n\t\t{\n\t\t\tthis.filesController = new FileController({\n\t\t\t\tid: this.id,\n\t\t\t\tfieldName: this.fieldName,\n\t\t\t\tcontainer: this.container,\n\t\t\t\teventObject: this.eventObject\n\t\t\t});\n\t\t}\n\t\treturn this.filesController\n\t}\n\n\tgetFilesUploader()\n\t{\n\t\tif (!this.filesUploader)\n\t\t{\n\t\t\tthis.filesUploader = new FileUploader({\n\t\t\t\tid: this.id,\n\t\t\t\tcontainer: this.container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\t\tdropZone: this.container,\n\t\t\t\tinput: this.input,\n\t\t\t});\n\t\t\t//Video\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnVideoHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\tthis.getFileController().getParser().insertFile(itemData.ID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t});\n\t\t\t//Image\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnImageHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\tresolve({image: {src: itemData.PREVIEW_URL}, html: this.getFileController().getParser().getItemHTML(itemData.ID)});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\tconst onFailed = ({data: {blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\t});\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveCaught', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tthis.filesUploader.upload([...event.getData()]);\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsStart', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onBusy', this);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsDone', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onReady', this);\n\t\t\t});\n\n\t\t}\n\t\treturn this.filesUploader;\n\t}\n\n\tgetPanelController(): PanelController\n\t{\n\t\treturn this.panelController;\n\t}\n\n\tshow(values: ?Array)\n\t{\n\t\tconst switcher = this.getContainer().parentNode.querySelector('#' + this.getContainer().id + '-switcher');\n\t\tif (switcher)\n\t\t{\n\t\t\tswitcher.parentNode.removeChild(switcher);\n\t\t}\n\t\tif (this.getFileController().isPluggedIn())\n\t\t{\n\t\t\tthis.getContainer().setAttribute('data-bx-plugged-in', 'Y');\n\t\t}\n\t\tsuper.show();\n\t\tthis.showInitialLoader();\n\t\tthis.getFileController().show();\n\t\tthis.getPanelController().show();\n\n\t\tif (values)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.set(values)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.hideInitialLoader();\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideInitialLoader();\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tsuper.hide();\n\t\tthis.getFileController().hide();\n\t\tthis.getPanelController().hide();\n\t}\n\n\tshowInitialLoader()\n\t{\n\t}\n\n\thideInitialLoader()\n\t{\n\t}\n\n\tstatic repo = {};\n\n\tstatic getInstance(data, values)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new Form(data, values);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n\n\tstatic getBriefInstance(data)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new FormBrief(data, []);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n}\n\nsetTimeout(() => {\n\tif (BX.DiskFileDialog)\n\t{\n\t\tFileMover.subscribe();\n\t}\n}, 1000);\n","import Form from './form.js';\nimport Options from './options.js';\n\nconst add = function(params)\n{\n\tconst container = BX('diskuf-selectdialog-' + params['UID']);\n\n\tif (container && BX.isNodeInDom(container))\n\t{\n\t\tconst eventObject = container.parentNode;\n\t\tif (!container.hasAttribute(\"bx-disk-load-is-bound\"))\n\t\t{\n\t\t\tcontainer.setAttribute(\"bx-disk-load-is-bound\", \"Y\");\n\t\t\tBX.addCustomEvent(eventObject, \"DiskLoadFormController\", function (status)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tBX.Disk.UF.Options.set({urlUpload: params.urlUpload});\n\t\t\t\t\treturn BX.Disk.UF.Form.getBriefInstance({\n\t\t\t\t\t\tcontainer: container,\n\t\t\t\t\t\teventObject: container.parentNode,\n\t\t\t\t\t\tid: params.UID,\n\t\t\t\t\t\tfieldName: params.controlName,\n\t\t\t\t\t\tinput: BX.findChild(container, { className : 'diskuf-fileUploader' }, true)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch(e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Error with compatibility', e);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!!params['values'] && params['values'].length > 0 && !params['hideSelectDialog'])\n\t\t\tBX.onCustomEvent(container.parentNode, 'DiskLoadFormController', ['show']);\n\t}\n}\nexport {\n\tForm,\n\tOptions,\n\tadd\n}\n",null]}