{"version":3,"file":"script.js","sources":["src/js/index.js"],"sourcesContent":["import { Event, Dom } from 'main.core';\n\ntype FolderEditOptions = {\n\tsiteId: number,\n\tsiteType: string,\n\tfolderId: number,\n\tselectorCreateIndex: ?HTMLElement,\n\tselectorIndexMetaBlock: HTMLElement,\n\tselectorSelect: HTMLElement,\n\tselectorPageLink: HTMLElement,\n\tselectorFieldId: HTMLElement,\n\tselectorPreviewBlock: HTMLElement,\n\tselectorPreviewTitle: HTMLElement,\n\tselectorPreviewDescription: HTMLElement,\n\tselectorPreviewPicture: HTMLElement,\n\tselectorPreviewSrcPicture: HTMLElement,\n\tselectorPreviewPictureWrapper: HTMLElement,\n\tpathToLandingEdit: string,\n\tpathToLandingCreate: string,\n\tisUseNewMarket: bool,\n};\n\nexport class FolderEdit\n{\n\t#siteId: number;\n\t#siteType: string;\n\t#folderId: number;\n\t#selectorCreateIndex: ?HTMLElement;\n\t#selectorIndexMetaBlock: HTMLElement;\n\t#selectorSelect: HTMLElement;\n\t#selectorPageLink: HTMLElement;\n\t#selectorFieldId: HTMLElement;\n\t#selectorPreviewBlock: HTMLElement;\n\t#selectorPreviewTitle: HTMLElement;\n\t#selectorPreviewDescription: HTMLElement;\n\t#selectorPreviewPicture: HTMLElement;\n\t#selectorPreviewSrcPicture: HTMLElement;\n\t#selectorPreviewPictureWrapper: HTMLElement;\n\t#pathToLandingEdit: string;\n\t#pathToLandingCreate: string;\n\t#isUseNewMarket: bool;\n\t#linkUrlSelector: BX.Landing.UI.Field.LinkUrl;\n\t#linkPictureSelector: BX.Landing.UI.Field.Image;\n\t#ajaxPathLoadPreview: string = '/bitrix/services/main/ajax.php?action=landing.api.landing.getById&landingId=#id#';\n\n\tconstructor(options: FolderEditOptions)\n\t{\n\t\tthis.#siteId = options.siteId;\n\t\tthis.#siteType = options.siteType;\n\t\tthis.#folderId = options.folderId;\n\t\tthis.#selectorCreateIndex = options.selectorCreateIndex;\n\t\tthis.#selectorIndexMetaBlock = options.selectorIndexMetaBlock;\n\t\tthis.#selectorSelect = options.selectorSelect;\n\t\tthis.#selectorPageLink = options.selectorPageLink;\n\t\tthis.#selectorFieldId = options.selectorFieldId;\n\t\tthis.#selectorPreviewBlock = options.selectorPreviewBlock;\n\t\tthis.#selectorPreviewTitle = options.selectorPreviewTitle;\n\t\tthis.#selectorPreviewDescription = options.selectorPreviewDescription;\n\t\tthis.#selectorPreviewPicture = options.selectorPreviewPicture;\n\t\tthis.#selectorPreviewSrcPicture = options.selectorPreviewSrcPicture;\n\t\tthis.#selectorPreviewPictureWrapper = options.selectorPreviewPictureWrapper;\n\t\tthis.#pathToLandingEdit = options.pathToLandingEdit;\n\t\tthis.#pathToLandingCreate = options.pathToLandingCreate;\n\t\tthis.#isUseNewMarket = options.isUseNewMarket;\n\n\t\tthis.#initSelector();\n\t\tthis.#initPicture();\n\n\t\tEvent.bind(this.#selectorSelect, 'click', this.#onClickSelect.bind(this));\n\n\t\tif (this.#selectorCreateIndex)\n\t\t{\n\t\t\tEvent.bind(this.#selectorCreateIndex, 'click', this.#onClickIndexCreate.bind(this));\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tthis.#linkUrlSelector = new BX.Landing.UI.Field.LinkUrl({\n\t\t\ttitle: null,\n\t\t\tcontent: null,\n\t\t\tallowedTypes: [\n\t\t\t\tBX.Landing.UI.Field.LinkUrl.TYPE_PAGE\n\t\t\t],\n\t\t\toptions: {\n\t\t\t\tsiteId: this.#siteId,\n\t\t\t\tcurrentSiteOnly: true,\n\t\t\t\tdisableAddPage: true,\n\t\t\t\tlandingId: -1,\n\t\t\t\tfilter: {\n\t\t\t\t\t'ID': this.#siteId,\n\t\t\t\t\t'=TYPE': this.#siteType\n\t\t\t\t},\n\t\t\t\tfilterLanding: {\n\t\t\t\t\t'FOLDER_ID': this.#folderId\n\t\t\t\t}\n\t\t\t},\n\t\t\tonInput: this.#onSelect.bind(this)\n\t\t});\n\t}\n\n\t#initPicture()\n\t{\n\t\tif (!this.#selectorPreviewSrcPicture)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#linkPictureSelector = new BX.Landing.UI.Field.Image({\n\t\t\tid: 'folderPicture',\n\t\t\tdisableLink: true,\n\t\t\tdisableAltField: true,\n\t\t\tallowClear: true,\n\t\t\tcontent: {\n\t\t\t\tsrc: this.#selectorPreviewSrcPicture.getAttribute('value'),\n\t\t\t\tid: this.#selectorPreviewPicture.getAttribute('value')\n\t\t\t},\n\t\t\tuploadParams: {\n\t\t\t\taction: 'Site::uploadFile',\n\t\t\t\tid: this.#siteId\n\t\t\t},\n\t\t\tdimensions: {\n\t\t\t\twidth: 1200,\n\t\t\t\theight: 1200\n\t\t\t}\n\t\t});\n\n\t\tDom.clean(this.#selectorPreviewPictureWrapper);\n\t\tDom.append(this.#linkPictureSelector['layout'], this.#selectorPreviewPictureWrapper);\n\n\t\tthis.#linkPictureSelector['layout'].addEventListener('input', () => {\n\t\t\tconst file = this.#linkPictureSelector.getValue();\n\t\t\tthis.#selectorPreviewPicture.setAttribute(\n\t\t\t\t'value',\n\t\t\t\tfile['id2x']\n\t\t\t);\n\t\t});\n\t}\n\n\t#onSelect(title)\n\t{\n\t\tlet id;\n\t\tconst linkUrlSelectorValue = this.#linkUrlSelector.getValue();\n\t\tif (linkUrlSelectorValue.startsWith('page:'))\n\t\t{\n\t\t\tid = linkUrlSelectorValue.substr(13);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = linkUrlSelectorValue.substr(8);\n\t\t}\n\t\tconst path = this.#pathToLandingEdit.replace('#landing_edit#', id);\n\n\t\tthis.#selectorPageLink.innerHTML =\n\t\t\t`<span id=\"landing-folder-index-link-text\" class=\"landing-folder-index-link-text\">${title}</span>`;\n\t\tthis.#selectorPageLink.setAttribute('href', path);\n\t\tthis.#selectorFieldId.setAttribute('value', id);\n\n\t\tthis.#loadPreview(id);\n\t}\n\n\t#onClickSelect()\n\t{\n\t\tthis.#linkUrlSelector.onSelectButtonClick();\n\t}\n\n\t#onClickIndexCreate(e)\n\t{\n\t\tconst options = {\n\t\t\tallowChangeHistory: false,\n\n\t\t\tevents: {\n\t\t\t\tonClose: function()\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tif (this.#isUseNewMarket)\n\t\t{\n\t\t\toptions.cacheable = false;\n\t\t\toptions.customLeftBoundary = 0;\n\t\t}\n\t\tBX.SidePanel.Instance.open(this.#pathToLandingCreate, options);\n\t\tBX.PreventDefault(e);\n\t}\n\n\t#loadPreview(landingId)\n\t{\n\t\tthis.#selectorPreviewBlock.style.display = 'block';\n\t\tthis.#selectorIndexMetaBlock.style.display = 'flex';\n\n\t\tBX.ajax({\n\t\t\turl: this.#ajaxPathLoadPreview.replace('#id#', landingId),\n\t\t\tmethod: 'GET',\n\t\t\tdataType: 'json',\n\t\t\tonsuccess: result => {\n\n\t\t\t\tconst data = result.data;\n\n\t\t\t\tif (!data['ADDITIONAL_FIELDS'])\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst title = data['ADDITIONAL_FIELDS']['METAOG_TITLE'] || data['TITLE'];\n\t\t\t\tconst description = data['ADDITIONAL_FIELDS']['METAOG_DESCRIPTION'] || data['DESCRIPTION'] || '';\n\n\t\t\t\tthis.#selectorPreviewTitle.setAttribute('value', title);\n\t\t\t\tthis.#selectorPreviewDescription.setAttribute('value', description);\n\t\t\t\tthis.#selectorPreviewPicture.setAttribute('value', '');\n\n\t\t\t\tthis.#selectorPreviewPicture.setAttribute(\n\t\t\t\t\t'value',\n\t\t\t\t\tdata['ADDITIONAL_FIELDS']['~METAOG_IMAGE'] || ''\n\t\t\t\t);\n\t\t\t\tthis.#selectorPreviewSrcPicture.setAttribute(\n\t\t\t\t\t'value',\n\t\t\t\t\tdata['ADDITIONAL_FIELDS']['METAOG_IMAGE'] || ''\n\t\t\t\t);\n\n\t\t\t\tthis.#linkPictureSelector.setValue({\n\t\t\t\t\tsrc: data['ADDITIONAL_FIELDS']['METAOG_IMAGE'] || '',\n\t\t\t\t\tid: data['ADDITIONAL_FIELDS']['~METAOG_IMAGE'] || -1\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n"],"names":["FolderEdit","options","siteId","siteType","folderId","selectorCreateIndex","selectorIndexMetaBlock","selectorSelect","selectorPageLink","selectorFieldId","selectorPreviewBlock","selectorPreviewTitle","selectorPreviewDescription","selectorPreviewPicture","selectorPreviewSrcPicture","selectorPreviewPictureWrapper","pathToLandingEdit","pathToLandingCreate","isUseNewMarket","Event","bind","BX","Landing","UI","Field","LinkUrl","title","content","allowedTypes","TYPE_PAGE","currentSiteOnly","disableAddPage","landingId","filter","filterLanding","onInput","Image","id","disableLink","disableAltField","allowClear","src","getAttribute","uploadParams","action","dimensions","width","height","Dom","clean","append","addEventListener","file","getValue","setAttribute","linkUrlSelectorValue","startsWith","substr","path","replace","innerHTML","onSelectButtonClick","e","allowChangeHistory","events","onClose","window","location","reload","cacheable","customLeftBoundary","SidePanel","Instance","open","PreventDefault","style","display","ajax","url","method","dataType","onsuccess","result","data","description","setValue"],"mappings":"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"}