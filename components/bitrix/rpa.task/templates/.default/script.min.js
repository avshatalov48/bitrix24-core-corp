(function(t,e,i){"use strict";var s=e.Reflection.namespace("BX.Rpa");var a=function(){function t(e,i,s){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"typeId",null);babelHelpers.defineProperty(this,"itemId",null);babelHelpers.defineProperty(this,"buttons",[]);babelHelpers.defineProperty(this,"task",null);babelHelpers.defineProperty(this,"onTaskComplete",null);babelHelpers.defineProperty(this,"editor",false);babelHelpers.defineProperty(this,"requestStarted",false);this.typeId=e;this.itemId=i;this.buttons=s.buttons||[];this.task=s.task||null;this.onTaskComplete=s.onTaskComplete||null}babelHelpers.createClass(t,[{key:"init",value:function t(){var e=this;[].forEach.call(this.buttons,function(t){t.style.color=i.Manager.calculateTextColor(t.style.backgroundColor);BX.bind(t,"click",e.clickButtonHandler.bind(e,t))},this);if(this.task.ACTIVITY==="RpaRequestActivity"){this.prepareEditor()}}},{key:"startRequest",value:function t(){this.requestStarted=true;if(BX.UI&&BX.UI.ButtonManager){this.buttons.forEach(function(t){var e=BX.UI.ButtonManager.createFromNode(t);if(e){e.setWaiting(true)}})}}},{key:"stopRequest",value:function t(){this.requestStarted=false;if(BX.UI&&BX.UI.ButtonManager){this.buttons.forEach(function(t){var e=BX.UI.ButtonManager.createFromNode(t);if(e){e.setWaiting(false)}})}}},{key:"clickButtonHandler",value:function t(e,i){i.preventDefault();if(this.editor){if(this.validateFields()){this.startRequest();this.editor.save()}}else{this.doTask(e)}}},{key:"doTask",value:function t(i){var s=this;if(this.requestStarted){return}this.startRequest();var a=new FormData(i.closest("form"));a.append(i.name,i.value);e.ajax.runAction("rpa.task.do",{analyticsLabel:"rpaTaskDo",data:a}).then(function(t){s.stopRequest();if(t.data.completed){if(s.onTaskComplete){s.onTaskComplete(t.data)}}})}},{key:"prepareEditor",value:function t(){this.editor=i.Manager.getEditor(this.typeId,this.itemId);BX.addCustomEvent(window,"BX.UI.EntityEditorAjax:onSubmitFailure",this.onEditorErrors.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditor:onFailedValidation",this.onEditorErrors.bind(this));this.unregisterActiveFields()}},{key:"unregisterActiveFields",value:function t(){var e=this.editor.getControlById("to_show");var i=e?e.getChildren():[];i.forEach(function(t){t._isActive=false})}},{key:"validateFields",value:function t(){var i=this;var s=true;var a=this.editor.getControlById("to_set");var o=a?a.getChildren():[];o.forEach(function(t){if(BX.Main.UF.Factory.isEmpty(t.getId())){var a=i.editor.getControlById(t.getId());if(!a.hasError()){a.showError(e.Loc.getMessage("RPA_TASK_FIELD_VALIDATION_ERROR"))}s=false}});return s}},{key:"onEditorSubmit",value:function t(i,s){this.stopRequest();if(s.data.completed&&e.Type.isFunction(this.onTaskComplete)){setTimeout(this.onTaskComplete.bind(this,s.data),10)}}},{key:"onEditorErrors",value:function t(e){this.stopRequest();var i=e.pop().message;BX.UI.Notification.Center.notify({content:i})}}]);return t}();s.TaskComponent=a})(this.window=this.window||{},BX,BX.Rpa);
//# sourceMappingURL=script.map.js