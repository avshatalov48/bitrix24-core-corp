(function(t,e,i){"use strict";var o=e.Reflection.namespace("BX.Rpa");var a=function(){function t(e,i,o){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"typeId",null);babelHelpers.defineProperty(this,"itemId",null);babelHelpers.defineProperty(this,"buttons",[]);babelHelpers.defineProperty(this,"task",null);babelHelpers.defineProperty(this,"onTaskComplete",null);babelHelpers.defineProperty(this,"editor",false);babelHelpers.defineProperty(this,"requestStarted",false);this.typeId=e;this.itemId=i;this.buttons=o.buttons||[];this.task=o.task||null;this.onTaskComplete=o.onTaskComplete||null}babelHelpers.createClass(t,[{key:"init",value:function t(){var e=this;[].forEach.call(this.buttons,(function(t){t.style.color=i.Manager.calculateTextColor(t.style.backgroundColor);BX.bind(t,"click",e.clickButtonHandler.bind(e,t))}),this);if(this.task.ACTIVITY==="RpaRequestActivity"){this.prepareEditor()}}},{key:"startRequest",value:function t(){this.requestStarted=true;if(BX.UI&&BX.UI.ButtonManager){this.buttons.forEach((function(t){var e=BX.UI.ButtonManager.createFromNode(t);if(e){e.setWaiting(true)}}))}}},{key:"stopRequest",value:function t(){this.requestStarted=false;if(BX.UI&&BX.UI.ButtonManager){this.buttons.forEach((function(t){var e=BX.UI.ButtonManager.createFromNode(t);if(e){e.setWaiting(false)}}))}}},{key:"clickButtonHandler",value:function t(e,i){i.preventDefault();if(this.editor){if(this.validateFields()){this.startRequest();this.editor.save()}}else{this.doTask(e)}}},{key:"doTask",value:function t(i){var o=this;if(this.requestStarted){return}this.startRequest();var a=new FormData(i.closest("form"));a.append(i.name,i.value);e.ajax.runAction("rpa.task.do",{analyticsLabel:"rpaTaskDo",data:a}).then((function(t){o.stopRequest();if(t.data.completed){if(o.onTaskComplete){o.onTaskComplete(t.data)}}}))}},{key:"prepareEditor",value:function t(){this.editor=i.Manager.getEditor(this.typeId,this.itemId);BX.addCustomEvent(window,"BX.UI.EntityEditorAjax:onSubmitFailure",this.onEditorErrors.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditor:onSave",this.onEditorSave.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditor:onFailedValidation",this.onEditorErrors.bind(this));this.unregisterActiveFields()}},{key:"unregisterActiveFields",value:function t(){var e=this.editor.getControlById("to_show");var i=e?e.getChildren():[];i.forEach((function(t){t._isActive=false}))}},{key:"validateFields",value:function t(){var i=this;var o=true;var a=this.editor.getControlById("to_set");var s=a?a.getChildren():[];s.forEach((function(t){if(BX.Main.UF.Factory.isEmpty(t.getId())){var a=i.editor.getControlById(t.getId());if(!a.hasError()){a.showError(e.Loc.getMessage("RPA_TASK_FIELD_VALIDATION_ERROR"))}o=false}}));return o}},{key:"onEditorSubmit",value:function t(i,o){this.stopRequest();if(o.data.completed&&e.Type.isFunction(this.onTaskComplete)){setTimeout(this.onTaskComplete.bind(this,o.data),10)}}},{key:"onEditorSave",value:function t(e,i){if(this.editor===e){i.enableCloseConfirmation=false}}},{key:"onEditorErrors",value:function t(e){this.stopRequest();var i=e.pop().message;BX.UI.Notification.Center.notify({content:i})}}]);return t}();o.TaskComponent=a})(this.window=this.window||{},BX,BX.Rpa);
//# sourceMappingURL=script.map.js