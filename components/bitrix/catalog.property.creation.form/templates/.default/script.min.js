(function(e,t){"use strict";function r(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<p class="ui-entity-editor-field-error-text">',"</p>\n\t\t\t"]);r=function t(){return e};return e}var a=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"initialize",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"initialize",this).call(this,t,r);BX.addCustomEvent(this,"onSave",BX.delegate(this.onFormSave,this));BX.addCustomEvent(this,"onCancel",BX.delegate(this.onFormCancel,this));this.componentName=r.componentName||"";this.signedParameters=r.signedParameters||""}},{key:"getInputTitle",value:function e(){return!this.isCreationMode()?this._field.getTitle():""}},{key:"isAllowedMultipleCheckBox",value:function e(){return!this.isCreationMode()&&babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"isAllowedMultipleCheckBox",this).call(this)}},{key:"isCreationMode",value:function e(){return this._field===null}},{key:"onFormSave",value:function e(t,r){if(this._isLocked){return}this._isLocked=true;BX.addClass(this._saveButton,"ui-btn-wait");var a=this.formatConfiguratorFields(r);if(this.isCreationMode()){this.addProperty(a)}else{this.updateProperty(a)}}},{key:"addProperty",value:function e(r){var a=this;t.ajax.runComponentAction(this.componentName,"addProperty",{mode:"class",signedParameters:this.signedParameters,data:r}).then(function(e){r.CODE=e.data.PROPERTY_GRID_CODE;BX.SidePanel.Instance.postMessage(window,"PropertyCreationForm:onAdd",{fields:r});a.onFormCancel()}).catch(this.onError.bind(this))}},{key:"updateProperty",value:function e(r){var a=this;t.ajax.runComponentAction(this.componentName,"updateProperty",{mode:"class",signedParameters:this.signedParameters,data:r}).then(function(e){BX.SidePanel.Instance.postMessage(window,"PropertyCreationForm:onModify",{fields:r});a.onFormCancel()}).catch(this.onError.bind(this))}},{key:"onError",value:function e(r){var a=this;t.Dom.removeClass(this._saveButton,"ui-btn-wait");this._isLocked=false;if(this._errorContainer){t.Dom.clean(this._errorContainer);if(t.Type.isArray(r.errors)){r.errors.forEach(function(e){a.showError(e)})}}}},{key:"getFormFieldName",value:function e(t){return"fields["+t+"]"}},{key:"showError",value:function e(a){this._errorContainer.append(t.Tag.render(r(),a.message))}},{key:"formatConfiguratorFields",value:function e(t){var r=this;var a=new FormData;var i={NAME:t.label,MULTIPLE:t.multiple?"Y":"N",IS_REQUIRED:t.mandatory?"Y":"N",IS_PUBLIC:t.isPublic?"Y":"N",PROPERTY_TYPE:"S"};if(t.field){i.ID=t.field.getId()}switch(t.typeId){case"directory":i.DIRECTORY_NAME=t.directoryName;i.USER_TYPE="directory";t.enumeration=t.enumeration||[];t.enumeration.forEach(function(e,t){a.append(r.getFormFieldName("VALUES]["+t+"][SORT"),e.SORT);a.append(r.getFormFieldName("VALUES]["+t+"][VALUE"),e.VALUE.value);if(!r.isCreationMode()){a.append(r.getFormFieldName("VALUES]["+t+"][XML_ID"),e.XML_ID);a.append(r.getFormFieldName("VALUES]["+t+"][FILE_ID"),e.FILE_ID)}a.append("FILES["+e.SORT+"]",e.VALUE.file)});break;case"list":case"multilist":i.PROPERTY_TYPE="L";t.enumeration=t.enumeration||[];t.enumeration.forEach(function(e,t){a.append(r.getFormFieldName("VALUES]["+t+"][SORT"),e.SORT);a.append(r.getFormFieldName("VALUES]["+t+"][VALUE"),e.VALUE);a.append(r.getFormFieldName("VALUES]["+t+"][ID"),e.ID)});break;case"boolean":i.PROPERTY_TYPE="L";i.VALUES=["Y"];i.LIST_TYPE="C";break}for(var n=0,o=Object.entries(i);n<o.length;n++){var s=babelHelpers.slicedToArray(o[n],2),l=s[0],d=s[1];a.append(this.getFormFieldName(l),d)}return a}},{key:"onFormCancel",value:function e(){BX.SidePanel.Instance.close()}},{key:"isAllowedShowAlwaysCheckBox",value:function e(){return false}}]);return a}(BX.Catalog.IblockFieldConfigurator);t.Reflection.namespace("BX.Catalog").PropertyCreationForm=a})(this.window=this.window||{},BX);
//# sourceMappingURL=script.map.js