{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {ajax, Dom, Reflection, Tag, Type} from 'main.core';\n\nclass PropertyCreationForm extends BX.Catalog.IblockFieldConfigurator\n{\n\tinitialize(id, settings = {})\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tBX.addCustomEvent(this, \"onSave\", BX.delegate(this.onFormSave, this));\n\t\tBX.addCustomEvent(this, \"onCancel\", BX.delegate(this.onFormCancel, this));\n\t\tthis.componentName = settings.componentName || '';\n\t\tthis.signedParameters = settings.signedParameters || '';\n\t}\n\n\tgetInputTitle()\n\t{\n\t\treturn (!this.isCreationMode()) ? this._field.getTitle() : '';\n\t}\n\n\tisAllowedMultipleCheckBox()\n\t{\n\t\treturn !this.isCreationMode() && super.isAllowedMultipleCheckBox();\n\t}\n\n\tisCreationMode()\n\t{\n\t\treturn this._field === null;\n\t}\n\n\tonFormSave(sender, params)\n\t{\n\t\tif (this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isLocked = true;\n\t\tBX.addClass(this._saveButton, \"ui-btn-wait\");\n\t\tconst fields = this.formatConfiguratorFields(params);\n\n\t\tif (this.isCreationMode())\n\t\t{\n\t\t\tthis.addProperty(fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateProperty(fields);\n\t\t}\n\t}\n\n\taddProperty(fields)\n\t{\n\t\tajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'addProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tfields.CODE = response.data.PROPERTY_GRID_CODE;\n\t\t\t\tBX.SidePanel.Instance.postMessage(window, 'PropertyCreationForm:onAdd', {fields});\n\t\t\t\tthis.onFormCancel();\n\t\t\t})\n\t\t\t.catch(this.onError.bind(this))\n\t\t;\n\t}\n\n\tupdateProperty(fields)\n\t{\n\t\tajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'updateProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tBX.SidePanel.Instance.postMessage(window, 'PropertyCreationForm:onModify', {fields});\n\t\t\t\tthis.onFormCancel();\n\t\t\t})\n\t\t\t.catch(this.onError.bind(this))\n\t\t;\n\t}\n\n\tonError(response)\n\t{\n\t\tDom.removeClass(this._saveButton, \"ui-btn-wait\");\n\t\tthis._isLocked = false;\n\n\t\tif (this._errorContainer)\n\t\t{\n\t\t\tDom.clean(this._errorContainer);\n\n\t\t\tif (Type.isArray(response.errors))\n\t\t\t{\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tthis.showError(error);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFormFieldName(name)\n\t{\n\t\treturn 'fields['+name+']';\n\t}\n\n\tshowError(error)\n\t{\n\t\tthis._errorContainer.append(\n\t\t\tTag.render`\n\t\t\t\t<p class=\"ui-entity-editor-field-error-text\">${error.message}</p>\n\t\t\t`\n\t\t);\n\t}\n\n\tformatConfiguratorFields(fields)\n\t{\n\t\tconst form = new FormData();\n\t\tconst formatted = {\n\t\t\tNAME: fields.label,\n\t\t\tMULTIPLE: fields.multiple ? 'Y' : 'N',\n\t\t\tIS_REQUIRED: fields.mandatory ? 'Y' : 'N',\n\t\t\tIS_PUBLIC: fields.isPublic ? 'Y' : 'N',\n\t\t\tPROPERTY_TYPE: 'S',\n\t\t};\n\n\t\tif (fields.field)\n\t\t{\n\t\t\tformatted.ID = fields.field.getId();\n\t\t}\n\n\t\tswitch (fields.typeId)\n\t\t{\n\t\t\tcase 'directory':\n\t\t\t\tformatted.DIRECTORY_NAME = fields.directoryName;\n\t\t\t\tformatted.USER_TYPE = 'directory';\n\t\t\t\tfields.enumeration = fields.enumeration || [];\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][VALUE'), enumItem.VALUE.value);\n\t\t\t\t\tif (!this.isCreationMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][XML_ID'), enumItem.XML_ID);\n\t\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][FILE_ID'), enumItem.FILE_ID);\n\t\t\t\t\t}\n\t\t\t\t\tform.append('FILES['+enumItem.SORT+']' , enumItem.VALUE.file);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\tcase 'multilist':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tfields.enumeration = fields.enumeration || [];\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][VALUE'), enumItem.VALUE);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][ID'), enumItem.ID);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tformatted.VALUES = ['Y'];\n\t\t\t\tformatted.LIST_TYPE = 'C';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let [key, item] of Object.entries(formatted))\n\t\t{\n\t\t\tform.append(this.getFormFieldName(key), item);\n\t\t}\n\t\treturn form;\n\t}\n\n\tonFormCancel()\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisAllowedShowAlwaysCheckBox()\n\t{\n\t\treturn false;\n\t}\n}\n\nReflection.namespace('BX.Catalog').PropertyCreationForm = PropertyCreationForm;"],"names":["PropertyCreationForm","id","settings","BX","addCustomEvent","delegate","onFormSave","onFormCancel","componentName","signedParameters","isCreationMode","_field","getTitle","sender","params","_isLocked","addClass","_saveButton","fields","formatConfiguratorFields","addProperty","updateProperty","ajax","runComponentAction","mode","data","then","response","CODE","PROPERTY_GRID_CODE","SidePanel","Instance","postMessage","window","onError","bind","Dom","removeClass","_errorContainer","clean","Type","isArray","errors","forEach","error","showError","name","append","Tag","render","message","form","FormData","formatted","NAME","label","MULTIPLE","multiple","IS_REQUIRED","mandatory","IS_PUBLIC","isPublic","PROPERTY_TYPE","field","ID","getId","typeId","DIRECTORY_NAME","directoryName","USER_TYPE","enumeration","enumItem","key","getFormFieldName","SORT","VALUE","value","XML_ID","FILE_ID","file","VALUES","LIST_TYPE","Object","entries","item","close","Catalog","IblockFieldConfigurator","Reflection","namespace"],"mappings":"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"}