(function(){BX.namespace("BX.Call.AI");const t=BX.Call.Lib?.Analytics;BX.Call.AI.Tabs={callId:null,tabsList:[],tabButtons:[],taskButtons:[],meetingButtons:[],mensionElements:[],userListAppInstance:null,audioPlayerInstance:null,playbackMarks:[],init:function(){this.tabsList=document.getElementsByClassName("bx-call-component-call-ai__tab-content");this.callId=document.getElementsByClassName("bx-call-component-call-ai")[0]?.dataset.callId;this.hideAllTabs();this.initEvents();this.initAudioPlayer();this.initUserList();this.initPlaybackMarks()},onTabClick:function(e){const{tabId:n,tabName:a}=e.target.dataset;this.hideAllTabs();t.getInstance().copilot.onOpenFollowUpTab({callId:this.callId,tabName:a});for(let t=0;t<this.tabButtons.length;t++){this.tabButtons[t].className=this.tabButtons[t].className.replace(" --active-button","")}document.getElementById(n).style.display="flex";e.currentTarget.className+=" --active-button"},hideAllTabs:function(){for(let t=0;t<this.tabsList.length;t++){this.tabsList[t].style.display="none"}},onCreateTaskClick:function(e){t.getInstance().copilot.onFollowUpCreateTaskClick({callId:this.callId});const{userId:n,description:a,auditors:s}=e.target.dataset;const i=`/company/personal/user/${n}/tasks/task/edit/0/`;BX.SidePanel.Instance.open(i,{requestMethod:"post",requestParams:{AUDITORS:s,DESCRIPTION:a,RESPONSIBLE_ID:n},cacheable:false})},onCreateMeetingClick:function(e){t.getInstance().copilot.onFollowUpCreateEventClick({callId:this.callId});const{meetingDescription:n,meetingId:a,meetingIdType:s}=e.target.dataset;new(window.top.BX||window.BX).Calendar.SliderLoader(0,{entryDescription:n,sliderId:a,type:s}).show()},getTimeInSeconds:function(t){const e=this.playbackMarks[t].innerText.split(/[-\u2014\u2013]/)[0];const[n,a,s]=e.split(":").map(Number).reverse();return s===undefined?a*60+n:s*3600+a*60+n},initEvents:function(){this.tabButtons=document.getElementsByClassName("bx-call-component-call-ai__tab-header-button");for(let t=0;t<this.tabButtons.length;t++){this.tabButtons[t].addEventListener("click",this.onTabClick.bind(this))}if(this.tabButtons.length){this.tabButtons[0].click()}this.taskButtons=document.getElementsByClassName("bx-call-component-call-ai__task-button");for(let t=0;t<this.taskButtons.length;t++){this.taskButtons[t].addEventListener("click",this.onCreateTaskClick.bind(this))}this.meetingButtons=document.getElementsByClassName("bx-call-component-call-ai__meetings-button");for(let t=0;t<this.meetingButtons.length;t++){this.meetingButtons[t].addEventListener("click",this.onCreateMeetingClick.bind(this))}this.mensionElements=document.getElementsByClassName("bx-call-component-call-ai__user-mention");for(let t=0;t<this.mensionElements.length;t++){this.mensionElements[t].addEventListener("click",this.clickMension.bind(this))}const t=document.getElementsByClassName("bx-call-component-call-ai__disclaimer-link");t[0]?.addEventListener("click",this.clickDisclaimer.bind(this))},initAudioPlayer:function(){if(!BX.Vue3){return}const e=BX.Vue3.BitrixVue;const n=document.getElementsByClassName("bx-call-component-call-ai__call-audio-record");if(!n.length){return}const{audioSrc:a}=n[0].dataset;const s=this.callId;if(!a){return}this.audioPlayerInstance=e.createApp({components:{AudioPlayer:BX.Call.Component.Elements.AudioPlayer},data(){return{audioSrc:a,analyticsCallback:()=>{t.getInstance().copilot.onAIPlayRecord({callId:s})}}},template:`\n\t\t\t\t\t<AudioPlayer :src="audioSrc" :analyticsCallback="analyticsCallback" ref="AudioPlayerRef"/>\n\t\t\t\t`}).mount(".bx-call-component-call-ai__call-audio-record")},initUserList:function(){if(!BX.Vue3){return}const t=BX.Vue3.BitrixVue;const e=document.getElementsByClassName("bx-call-component-call-ai-page__title-users-container");const{callId:n}=e[0].dataset;if(!n){return}t.createApp({components:{UserList:BX.Call.Component.UserList},data(){return{isLoadingUsers:true,callId:n,usersData:[]}},created(){BX.ajax.runComponentAction("bitrix:call.ai","getUsers",{mode:"ajax",data:{callId:n}}).then((t=>{this.isLoadingUsers=false;this.usersData=Object.values(t.data.users)})).catch((t=>{this.isLoadingUsers=false}))},template:`\n\t\t\t\t\t<UserList :loading="isLoadingUsers" :usersData="usersData" />\n\t\t\t\t`}).mount(".bx-call-component-call-ai-page__title-users-container")},initPlaybackMarks:function(){if(!this.audioPlayerInstance){return}this.playbackMarks=document.getElementsByClassName("bx-call-component-call-ai-decryption-block__time");for(let e=0;e<this.playbackMarks.length;e++){this.playbackMarks[e].addEventListener("click",(()=>{t.getInstance().copilot.onAIRecordTimeCodeClick({callId:this.callId});this.audioPlayerInstance.$refs.AudioPlayerRef.choosePlaybackTime(this.getTimeInSeconds(e))}))}},clickMension:function(t){const{userId:e}=t.target.dataset;if(!e){return}BX.Messenger.Public.openChat(e)},clickDisclaimer:function(){const t=top.BX.UI.InfoHelper;const e="20412666";if(!t){return}if(t.isOpen()){t.close()}t.show(e)}};document.addEventListener("DOMContentLoaded",(()=>{BX.Call.AI.Tabs.init()}))})();
//# sourceMappingURL=script.map.js