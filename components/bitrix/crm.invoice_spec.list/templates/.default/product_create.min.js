if(typeof BX.CrmProductCreateDialog==="undefined"){BX.CrmProductCreateDialog=function(e){this.settings=e;this.messages=e["messages"];this.random=Math.random().toString().substring(2);this.popupContentId="";this.errorContainerId="";this.popup=null;var t=this;var i=BX(this.settings["createProductBtnId"]);if(i){this.createLink=i;var r=BX.findChild(i,{tag:"span"});BX.bind(r,"click",function(){t.show()})}};BX.CrmProductCreateDialog.prototype={show:function(){var e=this;var t=BX.create("TABLE",{attrs:{id:this.random+"_table",cellspacing:"7"}});var i=BX.create("DIV",{attrs:{id:this.random+"_error",className:"bx-crm-dialog-quick-create-error-wrap"}});var r=BX.create("DIV",{style:{marginLeft:"12px",marginTop:"12px",marginRight:"12px",marginBottom:"12px"},attrs:{id:this.random+"_content"},children:[i,t]});var a=null;var s=this.settings["fields"];var n=this.settings["messages"];var o,c,l,d,u,p;for(var f=0;f<s.length;f++){if(s[f]["skip"]==="Y")continue;a={children:[BX.create("TD",{children:[BX.create("SPAN",{text:n[s[f]["textCode"]]+":"})]})]};l=s[f]["type"];p=parseInt(s[f]["maxLength"]);d=40;u=4;switch(l){case"select":o=BX.create("SELECT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+f,className:"bx-crm-dialog-quick-create-field-select"}});this.rebuildSelect(o,s[f]["items"],s[f]["value"]);break;case"checkbox":o=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+f,type:l}});o.checked=s[f]["value"]==="Y";break;case"textarea":o=BX.create("TEXTAREA",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+f,className:"bx-crm-dialog-quick-create-field-text-input",type:l,text:BX.util.htmlspecialchars(s[f]["value"]),cols:d,rows:u,maxlength:p>0?p:7500}});break;default:o=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+f,className:"bx-crm-dialog-quick-create-field-text-input",type:l,value:s[f]["value"],size:d,maxlength:p>0?p:255}});break}a.children.push(BX.create("TD",{children:[o]}));t.appendChild(BX.create("TR",a))}var h=new BX.PopupWindow("CrmProductCreateDialog_"+this.random,null,{overlay:{opacity:10},autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.messages["dialogTitle"],events:{onPopupClose:function(){if(h)h.destroy()}},content:r,buttons:[new BX.PopupWindowButton({text:this.messages["buttonCreateTitle"],className:"popup-window-button-accept",events:{click:function(){if(h){if(r){e.popupContentId=r.id;e.errorContainerId=i.id;e.popup=h;e.createProduct()}}}}}),new BX.PopupWindowButtonLink({text:this.messages["buttonCancelTitle"],className:"popup-window-button-link-cancel",events:{click:function(){if(h)h.close()}}})]});h.show()},createProduct:function(){var e,t,i={};var r=this.settings["fields"];for(e=0;e<r.length;e++){if(r[e]["skip"]==="Y")continue;t=BX(this.random+"_"+e);if(t){i[r[e]["textCode"]]=r[e]["type"]!=="checkbox"?t.value:t.checked?"Y":"N"}}if(e>0){var a=this;var s=this.settings["ownerCurrencyId"];i["sessid"]=this.settings["sessid"];i["ajax"]="Y";if(s.length>0&&i["CURRENCY"].length>0&&s!==i["CURRENCY"]){i["currencyTo"]=s}BX.showWait(this.popupContentId,this.messages["waitMessage"]);BX.ajax({url:this.settings["url"],method:"POST",dataType:"json",data:i,onsuccess:function(e){var t=0,i="";BX.closeWait();i=e["err"]!==""?e["err"]:"";t=parseInt(e["productId"])>0?parseInt(e["productId"]):0;if(t>0){if(a.popup){a.popup.close();a.popup=null}if(typeof e["productData"]!=="undefined"){var r=e["productData"];if(typeof r["NAME"]!=="undefined"&&typeof r["PRICE"]!=="undefined"&&typeof(a.settings["productAdditionHandler"]==="function")){var s=a.settings["productAdditionHandler"];var n={product:[{id:t,title:r["NAME"],customData:{price:r["PRICE"]}}]};s(n)}}}else{a.showAjaxError(i)}},onfailure:function(e){BX.closeWait();a.showAjaxError("")}})}},showAjaxError:function(e){if(e==="")e=this.messages["ajaxError"];var t=BX(this.errorContainerId);if(t){t.innerHTML=e}},setSelectValue:function(e,t){var i,r;var a=false;var s=!!e.getAttribute("multiple");if(!(t instanceof Array))t=[t];for(i=0;i<e.options.length;i++){for(r in t){if(e.options[i].value==t[r]){if(!a){a=true;e.selectedIndex=i}e.options[i].selected=true;break}}if(!s&&a)break}},rebuildSelect:function(e,t,i){var r,a,s,n;var o=false;var c;if(!(i instanceof Array))i=[i];if(e){c=!!e.getAttribute("multiple");while(r=e.lastChild)e.removeChild(r);for(s=0;s<t.length;s++){a=document.createElement("option");a.value=t[s]["id"];a.innerHTML=BX.util.htmlspecialchars(t[s]["title"]);try{e.add(a,e.options[null])}catch(l){a=document.createElement("option");a.text=t[s]["title"];e.add(a,null)}if(!o||c){for(n=0;n<i.length;n++){if(t[s]["id"]==i[n]){a.selected=true;if(!o){o=true;e.selectedIndex=s}break}}}}}}}}
//# sourceMappingURL=product_create.map.js