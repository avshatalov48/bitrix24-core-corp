this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(t,e,i,n){"use strict";var r=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filterId=e.filterId;this.filterManager=BX.Main.filterManager.getById(this.filterId);this.bindEvents();setTimeout(this.updateFields.bind(this),100)}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){n.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){this.updateFields()}},{key:"updateFields",value:function t(){var e=this.getFilter();if(!e){return}this.presetId=e.getPreset().getCurrentPresetId()}},{key:"isFilteredByPresetId",value:function t(e){return e===this.presetId}},{key:"getFilter",value:function t(){return this.filterManager}}]);return t}();var s,a,o,l;var u=function(){function t(e){babelHelpers.classCallCheck(this,t);this.count=e.count;this.name=e.name;this.type=e.type;this.color=e.color;this.filterPresetId=e.filterPresetId;this.filter=e.filter;this.activeByDefault=!!e.activeByDefault;this.$container=null;this.$remove=null;this.$counter=null;this.bindEvents()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){var e=this;n.EventEmitter.subscribe("BX.Socialnetwork.Interface.Counters:active",(function(t){e!==t.data?e.unActive():null}))}},{key:"getCounter",value:function t(){if(!this.$counter){var e=this.count>99?"99+":this.count;this.$counter=i.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sonet-counters--item-num ','">\n\t\t\t\t\t<div class="sonet-counters--item-num-text --stop --without-animate">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),this.getCounterColor(),e)}return this.$counter}},{key:"getCounterColor",value:function t(){if(!this.color){return null}return"--".concat(this.color)}},{key:"animateCounter",value:function t(e,n){var r=this;if(e>99&&n>99){return}n>99?n=99:null;if(e>99){e=99}var s=e-n;if(s<0){s=s*-1}this.$counter.innerHTML="";this.getCounter().classList.remove("--update");this.getCounter().classList.remove("--update-multi");if(s>5){setTimeout((function(){r.getCounter().style.animationDuration=s*50+"ms";r.getCounter().classList.add("--update-multi")}))}var o=setInterval((function(){n<e?e--:e++;var t=i.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sonet-counters--item-num-text ','">',"</div>\n\t\t\t"])),n<e?"--decrement":"",e);if(e===n){t.classList.add("--stop");if(s<5){r.getCounter().classList.add("--update")}clearInterval(o);e===0?r.fade():r.unFade()}if(e!==n){i.Event.bind(t,"animationend",(function(){t.parentNode.removeChild(t)}))}r.$counter.appendChild(t)}),50)}},{key:"updateCount",value:function t(e){if(this.count===e){return}this.animateCounter(this.count,e);this.count=e}},{key:"getRemove",value:function t(){if(!this.$remove){this.$remove=i.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sonet-counters--item-remove"></div>\n\t\t\t'])))}return this.$remove}},{key:"fade",value:function t(){this.getContainer().classList.add("--fade")}},{key:"unFade",value:function t(){this.getContainer().classList.remove("--fade")}},{key:"active",value:function t(e){var r=i.Type.isDomNode(e)?e:this.getContainer();r.classList.add("--hover");n.EventEmitter.emit("BX.Socialnetwork.Interface.Counters:active",this)}},{key:"unActive",value:function t(e){var r=i.Type.isDomNode(e)?e:this.getContainer();r.classList.remove("--hover");n.EventEmitter.emit("BX.Socialnetwork.Interface.Counters:unActive",this)}},{key:"adjustClick",value:function t(){n.EventEmitter.emit("Socialnetwork.Toolbar:onItem",{counter:this});this.$container.classList.contains("--hover")?this.unActive():this.active()}},{key:"getContainer",value:function t(){if(!this.$container){this.$container=i.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sonet-counters--item ','">\n\t\t\t\t\t<div class="sonet-counters--item-wrapper">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="sonet-counters--item-title">',"</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),Number(this.count)===0?" --fade":"",this.getCounter(),this.name,this.getRemove());if(this.filter.isFilteredByPresetId(this.filterPresetId)||this.activeByDefault){this.active(this.$container)}i.Event.bind(this.$container,"click",this.adjustClick.bind(this))}return this.$container}}]);return t}();var c,d;var h=function(){babelHelpers.createClass(t,null,[{key:"counterTypes",get:function t(){return{workgroup_detail:["workgroup_requests_in","workgroup_requests_out"]}}}]);function t(e){babelHelpers.classCallCheck(this,t);this.userId=e.userId;this.targetUserId=e.targetUserId;this.entityType=e.entityType||"";this.entityId=parseInt(e.entityId||0);this.role=e.role;this.entityTitle=e.entityTitle||"";this.counters=e.counters;this.initialCounterTypes=e.counterTypes;this.renderTo=e.renderTo;this.signedParameters=e.signedParameters;this.initialCounter=e.initialCounter||"";this.$other={cropped:null,layout:null};this.$entityHead=null;this.filter=new r({filterId:e.filterId});this.bindEvents();this.setData(this.counters);this.initPull()}babelHelpers.createClass(t,[{key:"isWorkgroupList",value:function t(){return false}},{key:"initPull",value:function t(){var i=this;e.PULL.subscribe({moduleId:"socialnetwork",callback:function t(e){return i.processPullEvent(e)}})}},{key:"extendWatch",value:function t(){var e=this;if(this.isWorkgroupList()){var i="WORKGROUP_LIST";BX.PULL.extendWatch(i,true);setTimeout((function(){return e.extendWatch()}),29*60*1e3)}}},{key:"processPullEvent",value:function t(e){var i={user_counter:this.onUserCounter.bind(this)};var n=Object.prototype.hasOwnProperty;var r=e.command,s=e.params;if(n.call(i,r)){var a=i[r];if(a){a.apply(this,[s])}}}},{key:"bindEvents",value:function t(){n.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){var e=this;this.filter.updateFields();Object.values(this.counterItems).forEach((function(t){if(t){e.filter.isFilteredByPresetId(t.filterPresetId)?t.active():t.unActive()}}))}},{key:"onUserCounter",value:function t(e){var i=this;var n=Object.prototype.hasOwnProperty;if(this.entityType==="workgroup_detail"){if(!n.call(e,"workgroupId")||!n.call(e,"values")||this.entityId!==parseInt(e.workgroupId)||this.userId!==Number(e.userId)){return}Object.entries(e.values).forEach((function(t){var e=babelHelpers.slicedToArray(t,2),n=e[0],r=e[1];if(i.counterItems[n]){i.counterItems[n].updateCount(r)}}))}}},{key:"getCounterItem",value:function t(e){return new u({count:e.count,name:e.name,type:e.type,color:e.color,filterPresetId:e.filterPresetId,activeByDefault:e.type===this.initialCounter,filter:this.filter})}},{key:"setData",value:function e(i){var n=this;this.counterItems={};var r=babelHelpers.toConsumableArray(t.counterTypes.workgroup_detail);Object.entries(i).forEach((function(t){var e=babelHelpers.slicedToArray(t,2),i=e[0],s=e[1];if(!r.includes(i)){return}n.counterItems[i]=n.getCounterItem({type:i,name:s.TITLE,count:Number(s.VALUE),color:s.STYLE,filterPresetId:s.FILTER_PRESET_ID})}))}},{key:"isCroppedBlock",value:function t(e){if(e){return e.classList.contains("--cropp")}}},{key:"getContainer",value:function t(){var e=[];Object.values(this.counterItems).forEach((function(t){return e.push(t.getContainer())}));this.$entityHead=i.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sonet-counters--group-head">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.entityTitle);this.$element=i.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sonet-counters sonet-counters--scope">\n\t\t\t\t<div class="sonet-counters--group">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="sonet-counters--group-content">',"</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.$entityHead,e);return this.$element}},{key:"render",value:function t(){var e=this.getContainer();var n=e.cloneNode(true);n.classList.add("sonet-counters");n.style.position="fixed";n.style.opacity="0";n.style.width="auto";n.style.pointerEvents="none";document.body.appendChild(n);this.nodeWidth=n.offsetWidth;document.body.removeChild(n);i.Dom.replace(this.renderTo.firstChild,e)}}]);return t}();babelHelpers.defineProperty(h,"updateTimeout",false);babelHelpers.defineProperty(h,"needUpdate",false);babelHelpers.defineProperty(h,"timeoutTTL",5e3);t.Counters=h})(this.BX.Socialnetwork.Interface=this.BX.Socialnetwork.Interface||{},BX,BX,BX.Event);
//# sourceMappingURL=script.map.js