(function(){BX.namespace("BX.Sender.Config");if(BX.Sender.Config.Limits){return}var e=BX.Sender.Helper;function t(e){this.init(e)}t.prototype.init=function(t){this.name=t.name;this.context=t.context;this.manager=t.manager;this.editNode=e.getNode("percentage-edit",this.context);this.inputNode=e.getNode("percentage-input",this.context);this.textNode=e.getNode("percentage-text",this.context);this.viewNode=e.getNode("percentage-view",this.context);this.limitNode=e.getNode("percentage-limit",this.context);this.availableNode=e.getNode("percentage-available",this.context);if(this.inputNode){this.input=this.inputNode.querySelector("input");this.current=parseInt(this.input.value);BX.bind(this.editNode,"click",this.onEdit.bind(this));BX.bind(this.input,"blur",this.onSave.bind(this))}};t.prototype.setValue=function(t){this.current=parseInt(t.percentage);this.input.value=this.current;this.textNode.textContent=this.current;this.viewNode.style.left=this.current+"%";e.animate.numbers(this.limitNode,t.limit);e.animate.numbers(this.availableNode,t.available)};t.prototype.onEdit=function(){BX.addClass(this.viewNode,"sender-config-limits-progress-active");var e=this;setTimeout(function(){BX.focus(e.input)},50)};t.prototype.onSave=function(){BX.removeClass(this.viewNode,"sender-config-limits-progress-active");var e=parseInt(this.input.value);if(this.current===e){return}var t=this;this.manager.ajaxAction.request({action:"setLimitPercentage",onsuccess:function(e){t.setValue(e)},data:{percentage:e}})};function i(e){}i.prototype.init=function(t){this.mess=t.mess||{};this.actionUri=t.actionUri||"";this.context=BX(t.containerId);e.getNodes("percentage-context",this.context).forEach(this.initPercentage,this);this.ajaxAction=new BX.AjaxAction(this.actionUri);this.canTrackMailNode=document.querySelector(".sender-track-mail-option");this.mailConsentNode=document.querySelector(".sender-mail-consent-option");this.sendingTimeNode=document.querySelector(".sender-sending-time-option");this.sendingTimeConfigurationBlock=document.querySelector(".sender-sending-time-configuration-block");this.sendingTimeViewBlock=document.querySelector(".sender-sending-time-view-block");this.sendingTimeEditBlock=document.querySelector(".sender-sending-time-edit-block");this.sendingTimeEditBtn=document.querySelector(".sender-sending-time-edit-btn");this.sendingStartNode=document.querySelector(".sender-sending-start");this.sendingEndNode=document.querySelector(".sender-sending-end");this.sendingTimeSaveBtn=document.querySelector(".sender-save-time-limit-configuration");this.sendingTimeConfigurationBlock.style.display=this.sendingTimeNode.checked?"block":"none";BX.bind(this.canTrackMailNode,"change",this.switchCanTrackMail.bind(this));BX.bind(this.mailConsentNode,"change",this.switchMailConsentOption.bind(this));BX.bind(this.sendingTimeNode,"change",this.switchSendingTimeOption.bind(this));BX.bind(this.sendingTimeSaveBtn,"click",this.saveSendingTimeOptions.bind(this));BX.bind(this.sendingTimeEditBtn,"click",this.switchSendingTimeConfigurationBlock.bind(this));this.changeLeftMenuOption(t.defaultTab)};i.prototype.changeLeftMenuOption=function(e){var t=document.querySelectorAll("[data-tab]");t.forEach(function(t){if(t.dataset.tab===e){t.classList.add("sender-type-tab-current")}else{t.classList.remove("sender-type-tab-current")}})};i.prototype.initPercentage=function(e){if(!e){return}var i=e.getAttribute("data-name");if(!i){return}new t({name:i,context:e,manager:this})};i.prototype.switchCanTrackMail=function(){this.ajaxAction.request({action:"switchTrackMailOption",onsuccess:function(e){},data:{canTrackMail:this.canTrackMailNode.checked}})};i.prototype.switchMailConsentOption=function(){this.ajaxAction.request({action:"switchMailConsentOption",onsuccess:function(e){},data:{mailConsent:this.mailConsentNode.checked}})};i.prototype.switchSendingTimeOption=function(){this.sendingTimeConfigurationBlock.style.display=this.sendingTimeNode.checked?"block":"none";this.ajaxAction.request({action:"switchSendingTimeOption",onsuccess:function(e){},data:{sendingTime:this.sendingTimeNode.checked}})};i.prototype.switchSendingTimeConfigurationBlock=function(){var e=this.sendingTimeViewBlock.style.display==="none";document.querySelector(".sender-sending-start-caption").textContent=this.sendingStartNode.value;document.querySelector(".sender-sending-end-caption").textContent=this.sendingEndNode.value;this.sendingTimeViewBlock.style.display=e?"block":"none";this.sendingTimeEditBlock.style.display=e?"none":"block"};i.prototype.saveSendingTimeOptions=function(){this.sendingTimeSaveBtn.classList.add("ui-btn-wait");this.ajaxAction.request({action:"setSendingTimeOption",onsuccess:function(e){this.sendingTimeSaveBtn.classList.remove("ui-btn-wait");BX.UI.Notification.Center.notify({content:this.mess.success,position:"top-right",autoHideDelay:2e3});this.switchSendingTimeConfigurationBlock()}.bind(this),data:{sendingStart:this.sendingStartNode.value,sendingEnd:this.sendingEndNode.value}})};i.prototype.showMailPopup=function(){BX.Sender.B24License.showDefaultPopup()};i.prototype.showMailRatingPopup=function(e){this.popup=BX.PopupWindowManager.create("sender-config-limit-mail-rating",null,{titleBar:this.mess.mailDailyLimitTitle,width:620,height:225,autoHide:true,lightShadow:true,closeByEsc:true,closeIcon:true,overlay:true,buttons:[new BX.PopupWindowButton({text:this.mess.close,className:"popup-window-button-accept",events:{click:function(){this.popupWindow.close()}}})]});this.popup.setContent(this.mess.mailDailyLimit);this.popup.show()};BX.Sender.Config.Limits=new i})(window);
//# sourceMappingURL=script.map.js