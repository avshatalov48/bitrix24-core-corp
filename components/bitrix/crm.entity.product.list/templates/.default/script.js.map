{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Tag, Text, Loc, Event, Cache, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\n\t#model = null;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options)\n\t{\n\t\tthis.#model = options.model;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isInputDisabled = options.isInputDisabled || false;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tnode.appendChild(\n\t\t\tTag.render`<div>${this.#getReserveInputNode()}</div>`\n\t\t);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tnode.appendChild(\n\t\t\tTag.render`${this.#getDateNode()}`\n\t\t);\n\n\t\tEvent.bind(this.#getDateNode(), 'click', this.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#model.getField(this.dateFieldName) || null;\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.quantityFieldName));\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tlet value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\t\tvalue = this.getQuantity();\n\t\t\tinput.value = value;\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tif (this.getDateReservation() === null)\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(this.#model.getField(this.dateFieldName));\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.#model.setField(this.inputFieldName, value);\n\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.inputFieldName,\n\t\t\tVALUE: value,\n\t\t})\n\t}\n\n\t#onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input \n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\" \n\t\t\t\t\t\tname=\"${this.dateFieldName}\" \n\t\t\t\t\t\ttype=\"hidden\" \n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tlet tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\" \n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled ? \"crm-entity-product-list-locked-field\" : \"\"}\" \n\t\t\t\t\t\tautoComplete=\"off\" \n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\" \n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isInputDisabled)\n\t\t\t{\n\t\t\t\ttag.onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: ?string = null)\n\t{\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.dateFieldName,\n\t\t\tVALUE: date,\n\t\t})\n\n\t\tthis.#model.setField(this.dateFieldName, date);\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: ?string = null): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === null)\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\tonFocusUnchangeablePrice = this.#showChangePriceNotify.bind(this);\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.refreshFieldsLayout();\n\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tclearChanges()\n\t{\n\t\tthis.getModel().clearChangedList();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.getNode().querySelector('[data-name=\"PRICE\"]');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tpriceNode.setAttribute('disabled', true);\n\t\t\tDom.addClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.setAttribute('disabled', 'true')\n\t\t\t;\n\t\t\tif (!this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t\t{\n\t\t\t\tEvent.bind(priceNode, 'mouseenter', this.onFocusUnchangeablePrice);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpriceNode.removeAttribute('disabled');\n\t\t\tDom.removeClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.removeAttribute('disabled')\n\t\t\t;\n\t\t\tEvent.unbind(priceNode, 'mouseenter', this.onFocusUnchangeablePrice);\n\t\t}\n\t}\n\n\t#showChangePriceNotify()\n\t{\n\t\tif (this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hint = Text.encode(this.editor.getSettingValue('catalogPriceEditArticleHint'));\n\n\t\tconst changePriceNotifyId = 'disabled-crm-changing-price';\n\t\tlet changePriceNotify = BX.UI.Notification.Center.getBalloonById(changePriceNotifyId);\n\t\tif (!changePriceNotify)\n\t\t{\n\t\t\tconst content = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div style=\"padding: 9px\">${hint}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst buttonRow = Tag.render`<div></div>`;\n\t\t\tcontent.appendChild(buttonRow);\n\n\t\t\tconst articleCode = this.editor.getSettingValue('catalogPriceEditArticleCode');\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tconst moreLink = Tag.render`\n\t\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_MORE_LINK')}\n\t\t\t\t\t</span>\t\t\t\t\n\t\t\t\t`;\n\n\t\t\t\tEvent.bind(moreLink, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=\" + articleCode);\n\t\t\t\t\tchangePriceNotify.close();\n\t\t\t\t});\n\t\t\t\tbuttonRow.appendChild(moreLink);\n\t\t\t}\n\n\t\t\tconst disableNotificationLink = Tag.render`\n\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_DISABLE_NOTIFICATION')}\n\t\t\t\t</span>\t\t\t\t\n\t\t\t`;\n\n\t\t\tEvent.bind(disableNotificationLink, 'click', () => {\n\t\t\t\tchangePriceNotify.close();\n\t\t\t\tthis.editor.setSettingValue('disableNotifyChangingPrice', true);\n\t\t\t\tajax\n\t\t\t\t\t.runComponentAction(\n\t\t\t\t\t\tthis.editor.getComponentName(),\n\t\t\t\t\t\t'setGridSetting',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tsignedParameters: this.editor.getSignedParameters(),\n\t\t\t\t\t\t\t\tsettingId: 'DISABLE_NOTIFY_CHANGING_PRICE',\n\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t});\n\n\t\t\tbuttonRow.appendChild(disableNotificationLink);\n\n\t\t\tconst notificationOptions = {\n\t\t\t\tid: changePriceNotifyId,\n\t\t\t\tcloseButton: true,\n\t\t\t\tcategory: Row.CATALOG_PRICE_CHANGING_DISABLED,\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcontent,\n\t\t\t};\n\n\t\t\tchangePriceNotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t}\n\n\t\tchangePriceNotify.show();\n\t}\n\n\t#isEditableCatalogPrice()\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice()\n\t{\n\t\treturn this.editor.canSaveCatalogPrice()\n\t\t\t|| (this.getModel().isCatalogExisted() && this.getModel().isNew())\n\t\t;\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"STORE_INFO\"]');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\tif (this.isReserveBlocked())\n\t\t\t{\n\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tRuntime.debounce(this.#onStoreFieldClear.bind(this), 500, this)\n\t\t);\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tlet storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tstoreSearchInput.getNameInput().classList.add('crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"RESERVE_INFO\"]');\n\t\tif (storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\tmodel: this.getModel(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisInputDisabled: this.isReserveBlocked(),\n\t\t\t});\n\n\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onChange',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst item = event.getData();\n\t\t\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear(event)\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tlet fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetEnteredPrice(): number\n\t{\n\t\treturn this.getField('ENTERED_PRICE', this.getBasePrice());\n\t}\n\n\tgetCatalogPrice(): number\n\t{\n\t\treturn this.getField('CATALOG_PRICE', this.getBasePrice());\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = event.type === 'input' ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'PRICE':\n\t\t\t\tthis.changeEnteredPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'CATALOG_PRICE':\n\t\t\t\tthis.changeCatalogPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.setBasePrice(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_RESERVED':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeEnteredPrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setField('ENTERED_PRICE', preparedValue);\n\t\tif (mode === MODE_EDIT && originalPrice >= 0)\n\t\t{\n\t\t\tif (!this.#isEditableCatalogPrice)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.getModel().isCatalogExisted() && this.#isSaveableCatalogPrice())\n\t\t\t{\n\t\t\t\tthis.#showPriceNotifier(preparedValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setBasePrice(preparedValue, mode);\n\t\t\t}\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t\tthis.addActionDisableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshFieldsLayout();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tchangeCatalogPrice(value)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('CATALOG_PRICE', preparedValue);\n\t\tthis.refreshFieldsLayout();\n\t}\n\n\t#showPriceNotifier(enteredPrice)\n\t{\n\t\tconst disabledPriceNotify = BX.UI.Notification.Center.getBalloonByCategory(Row.CATALOG_PRICE_CHANGING_DISABLED);\n\t\tif (disabledPriceNotify)\n\t\t{\n\t\t\tdisabledPriceNotify.close();\n\t\t}\n\t\tthis.getModel().showSaveNotifier(\n\t\t\t'priceChanger_' + this.getId(),\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_PRICE_CHANGED_QUERY'),\n\t\t\t\tevents: {\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tif (this.getBasePrice() > this.getEnteredPrice())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setField('ENTERED_PRICE', this.getBasePrice());\n\t\t\t\t\t\t\tthis.updateUiInputField('PRICE', this.getBasePrice())\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setPrice(enteredPrice);\n\n\t\t\t\t\t\tif (this.getField('DISCOUNT_SUM') > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst settingPopup = this.getEditor().getSettingsPopup();\n\t\t\t\t\t\t\tconst setting = settingPopup?.getSetting('DISCOUNTS');\n\t\t\t\t\t\t\tif (setting && setting.checked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsettingPopup.requestGridSettings(setting, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\tthis.setField('ENTERED_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setField('PRICE', enteredPrice);\n\t\t\t\t\t\tthis.changeCatalogPrice('CATALOG_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setBasePrice(enteredPrice);\n\t\t\t\t\t\tthis.getModel().save(['BASE_PRICE', 'CURRENCY']);\n\n\t\t\t\t\t\tthis.refreshFieldsLayout();\n\t\t\t\t\t\tthis.addActionUpdateTotal();\n\t\t\t\t\t\tthis.executeExternalActions();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tconst taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(this.parseFloat(taxRate.VALUE));\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number): void\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.addActionProductChange();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getModel().getField('STORE_ID');\n\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\n\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t{\n\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\tif (maxStore.AMOUNT > currentAmount && this.storeSelector)\n\t\t\t{\n\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t}\n\t\t}\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tconst reserved = this.model.getStoreCollection().getStoreReserved(storeId);\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\tconst amountWrapper = this.getNode().querySelector('[data-name=\"STORE_RESERVED\"]');\n\t\tif (amountWrapper)\n\t\t{\n\t\t\tamountWrapper.innerHTML = Text.toNumber(reserved) + ' ' + Text.encode(measureName);\n\t\t}\n\n\t\tconst availableWrapper = this.getNode().querySelector('[data-name=\"STORE_AVAILABLE\"]');\n\t\tif (availableWrapper)\n\t\t{\n\t\t\tavailableWrapper.innerHTML = Text.toNumber(available) + ' ' + Text.encode(measureName);\n\t\t}\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tthis.setField('RESERVE_QUANTITY', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tlet imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\n\t\t\tif (Type.isObject(imageInfo))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.#onChangeStoreData.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetPrice(value)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tconst calculatedFields = this.getCalculator()\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getBasePrice()))\n\t\t\t.calculatePrice(value)\n\t\t;\n\n\t\tdelete(calculatedFields['BASE_PRICE']);\n\t\tthis.setFields(calculatedFields);\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t\tthis.executeExternalActions();\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE', 'ENTERED_PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\tif (value < this.getField('RESERVE_QUANTITY'))\n\t\t{\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.updateUiInputField('QUANTITY', this.getField('QUANTITY'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t}\n\t\telse if (isChangedValue)\n\t\t{\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"RESERVE_INFO\"]');\n\t\t\tconst input = node?.querySelector('input[name=\"RESERVE_QUANTITY\"]');\n\t\t\tif (Type.isElementNode(input))\n\t\t\t{\n\t\t\t\tinput.value = value;\n\t\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tlet text = value === DiscountType.MONETARY ? this.getEditor().getCurrencyText() : '%';\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() == value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE' || field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field)\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked()\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tlet lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\tlock.onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t\t\theader?.insertBefore(lock, header.firstChild);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields() : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = this.getProductSelector(current.getField('ID'));\n\t\t\t// Used to avoid dependence on catalog 21.100.0\n\t\t\tif (productSelector && typeof productSelector.unsubscribeEvents !== 'undefined')\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): bool\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'ENTERED_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'ENTERED_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribe(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t\tpopup.OVERLAY.style.zIndex = 798;\n\t\t}));\n\n\t\tEventEmitter.subscribe(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (typeof BX.Crm.EntityEvent !== \"undefined\")\n\t\t{\n\t\t\tEventEmitter.subscribe(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst product = new Row(rowId, fields, {isReserveBlocked}, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tfields['CATALOG_PRICE'] = fields['BASE_PRICE'];\n\t\t\t\tfields['ENTERED_PRICE'] = fields['BASE_PRICE'];\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeEnteredPrice(0);\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields();\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tEventEmitter.subscribeOnce(this, 'onAjaxSuccess', () => {\n\t\t\t\t\t\t\tsetTimeout(resolve, 100);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve()\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response)\n\t{\n\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper');\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","model","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","defaultDateReservation","isInputDisabled","appendChild","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getReservedQuantity","getDateReservation","onDateChange","toNumber","getField","event","value","target","changeInputValue","getQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","input","changeDateReservation","setField","EventEmitter","emit","NAME","VALUE","newDate","parseDate","current","Date","setHours","date","calendar","field","parentNode","bTime","remember","tag","onclick","top","InfoHelper","linkText","link","innerText","hiddenInput","MODE_EDIT","MODE_SET","Row","fields","settings","_classPrivateMethodGet","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","refreshFieldsLayout","requestAnimationFrame","initHandlers","cache","rowId","getEditorContainer","mainSelector","getModel","clearChangedList","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","priceNode","setAttribute","Dom","addClass","getSettingValue","onFocusUnchangeablePrice","removeAttribute","removeClass","unbind","number","textContent","result","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeEnteredPrice","changeCatalogPrice","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","setBasePrice","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","originalPrice","Math","max","parseFloat","getPricePrecision","isCatalogExisted","addActionProductChange","addActionUpdateTotal","addActionDisableSaveButton","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","setTaxRate","isBoolean","setRowSum","toString","isChangedValue","isReserveBlocked","updateUiStoreAmountData","storeId","reserved","getStoreCollection","getStoreReserved","available","getStoreAvailableAmount","measureName","getDefaultMeasure","SYMBOL","amountWrapper","innerHTML","availableWrapper","isNil","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","JSON","parse","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","subscribe","storeSelector","calculatedFields","calculateBasePrice","calculatePrice","updateUiInputField","exceptFieldNames","events","onClose","calculateQuantity","isElementNode","reserveControl","measure","updateUiMoneyField","isNew","save","showSaveNotifier","title","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","trim","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","disabled","isEmpty","products","PopupMenu","bindElement","items","cacheable","preventDefault","append","hint","changePriceNotifyId","changePriceNotify","buttonRow","articleCode","moreLink","Helper","disableNotificationLink","setSettingValue","ajax","runComponentAction","getComponentName","data","signedParameters","getSignedParameters","settingId","selected","category","CATALOG_PRICE_CHANGING_DISABLED","canEditCatalogPrice","canSaveCatalogPrice","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","URL_BUILDER_CONTEXT","mainInfoNode","numberSelector","selectorWrapper","renderTo","StoreSelector","inputFieldId","inputFieldTitle","storeWrapper","storeSearchInput","searchInput","getNameInput","toggleIcon","getSearchIcon","classList","add","getWrapper","getData","initHandlersForSelectors","enteredPrice","disabledPriceNotify","getBalloonByCategory","onCancel","getEnteredPrice","setPrice","settingPopup","getSettingsPopup","setting","getSetting","requestGridSettings","currentAmount","getStoreAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","handleProductErrorsChange","showNegative","load","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","currentHeaders","then","message","panel","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","Hint","init","Slider","open","url","settingItem","settingEnabled","stack","width","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","Map","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","window","subscribeDomEvents","subscribeCustomEvents","headersToLock","container","headerId","lock","insertBefore","firstChild","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","onDialogSelectProductHandler","onSaveHandler","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","unsubscribe","getCompatData","productId","getProductCount","addProductRow","selectProductInRow","getProductSelector","onProductSelect","product","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","panelCode","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","subscribeOnce","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","unsubscribeEvents","setForm","clearController","clearProductList","readOnly","setOption","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","remove","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","popup","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","zIndex","defer","Get","style","GetWindowScrollPos","scrollTop","OVERLAY","Close","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","focusProductSelector","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","Object","assign","taxId","taxIncluded","keys","key","tableUnfade","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","itemFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","setTimeout","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","sort","a","b","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}