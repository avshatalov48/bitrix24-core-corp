{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/money.control.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}\n","import {Tag, Text, Loc, Event, Cache, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport { Row } from './product.list.row';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#row:Row = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\twrapper = null;\n\tmeasureName;\n\n\tconstructor(options)\n\t{\n\t\tthis.#row = options.row;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\t\tthis.measureName = options.measureName;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#row.isNewRow()\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tthis.wrapper = node;\n\n\t\tDom.append(Tag.render`<div>${this.#getReserveInputNode()}</div>`, this.wrapper);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tDom.append(this.#getDateNode(), this.wrapper);\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#row.getField(this.dateFieldName) || '';\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tconst dateReservation = this.getDateReservation();\n\t\t\tif (dateReservation === '')\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(dateReservation);\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.setReservedQuantity(value, false);\n\t\tthis.#row.updateField(this.inputFieldName, value);\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled(): boolean\n\t{\n\t\tif (this.isBlocked)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst model = this.#row.getModel();\n\t\tif (model)\n\t\t{\n\t\t\treturn model.isSimple() || model.isService();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: string = '')\n\t{\n\t\tif (date !== this.getDateReservation())\n\t\t{\n\t\t\tthis.#row.updateField(this.dateFieldName, date);\n\t\t}\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: string = ''): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === '')\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n\n\tdisable(wrapper: Element|null): void\n\t{\n\t\tconst node = wrapper || this.wrapper;\n\t\tif (node)\n\t\t{\n\t\t\tnode.innerHTML = this.getReservedQuantity() + ' ' + Text.encode(this.measureName);\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Uri } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tthis.#node.classList.add('store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\trefreshStoreInfo()\n\t{\n\t\tthis.#model.getStoreCollection().refresh();\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\t\tconst viewAvailableQuantity =\n\t\t\tavailableQuantity <= 0\n\t\t\t\t? `<span class=\"text--danger\">${availableQuantity}`\n\t\t\t\t: availableQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(viewAvailableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","export default class MoneyControl\n{\n\tnode: Element;\n\thint: String|null;\n\n\tconstructor(options)\n\t{\n\t\tthis.node = options.node;\n\t\tthis.hint = options.hint;\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.node.removeAttribute('disabled');\n\t\tthis.node.removeAttribute('data-hint-no-icon');\n\t\tthis.node.removeAttribute('data-hint');\n\t\tthis.node.classList.remove('ui-ctl-element');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.add('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = false;\n\t\t}\n\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.removeAttribute('disabled');\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.node.setAttribute('disabled', '');\n\t\tthis.node.classList.add('ui-ctl-element');\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.setAttribute('disabled', '');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.remove('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = true;\n\t\t}\n\n\t\tif (this.hint)\n\t\t{\n\t\t\tthis.node.setAttribute('data-hint-no-icon', '');\n\t\t\tthis.node.setAttribute('data-hint', this.hint);\n\n\t\t\tBX.UI.Hint.init(this.node.parentNode);\n\t\t}\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\nimport MoneyControl from './money.control';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\thandleOnGridUpdated = this.#onGridUpdated.bind(this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.modifyQuantityInput();\n\t\tthis.refreshFieldsLayout();\n\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t\tdisabled: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new MoneyControl({\n\t\t\tnode: priceNode,\n\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_PRICE_CHANGING_RESTRICTED'),\n\t\t});\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tcontrol.disable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontrol.enable();\n\t\t}\n\t}\n\n\tmodifyQuantityInput(): void\n\t{\n\t\tif (!this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst countField = this.#getNodeChildByDataName('QUANTITY');\n\t\tif (countField)\n\t\t{\n\t\t\tconst control = new MoneyControl({\n\t\t\t\tnode: countField,\n\t\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_RESTRICTED_BY_STORE'),\n\t\t\t});\n\t\t\tcontrol.disable();\n\t\t}\n\t}\n\n\t#isEditableCatalogPrice(): boolean\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice(): boolean\n\t{\n\t\treturn this.getModel().isCatalogExisted() && this.getModel().isNew();\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\t\tSELECTOR_INPUT_DISABLED: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.mainSelector.subscribeEvents();\n\t\t}\n\n\t\tif (this.isRestrictedStoreInfo())\n\t\t{\n\t\t\tthis.mainSelector.setMode(ProductSelector.MODE_VIEW);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<div class=\"main-grid-row-number\"></div>`, mainInfoNode);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`;\n\t\t\t\tDom.append(selectorWrapper, mainInfoNode);\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\n\t\tif (this.isRestrictedStoreInfo() && this.storeSelector.searchInput)\n\t\t{\n\t\t\tthis.storeSelector.searchInput.disable(\n\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_STORE_RESTRICTED_BY_STORE')\n\t\t\t);\n\t\t}\n\n\t\tthis.layoutStoreSelector();\n\t}\n\n\tlayoutStoreSelector()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\tif (this.#needStoreSelectorInput())\n\t\t\t{\n\t\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\t\tif (this.isReserveBlocked())\n\t\t\t\t{\n\t\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t});\n\n\t\t// runs once because after grid update, row re-created.\n\t\tEventEmitter.subscribeOnce(\n\t\t\t'Grid::updated',\n\t\t\tthis.handleOnGridUpdated\n\t\t);\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tDom.addClass(storeSearchInput.getNameInput(), 'crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => this.editor.openIntegrationLimitSlider();\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.#getAllowedStores().length)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\trow: this,\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t\tmeasureName: this.#getMeasureName(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t{\n\t\t\t\tthis.reserveControl.disable();\n\t\t\t}\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear()\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\n\t\t\tif (this.#needReserveControlInput())\n\t\t\t{\n\t\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t\t{\n\t\t\t\t\tstoreWrapper.innerHTML = this.reserveControl.getReservedQuantity() + ' ' + Text.encode(this.#getMeasureName());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\tclearReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (const fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tconst fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisEmptyRow(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'PRICE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'TYPE':\n\t\t\t\tthis.setType(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tlet taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (!taxRate)\n\t\t\t{\n\t\t\t\ttaxRate = taxList.find((item) => Type.isNil(item.VALUE));\n\t\t\t}\n\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(taxRate.VALUE);\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number | null): void\n\t{\n\t\tconst preparedValue =\n\t\t\tType.isNil(value) || value === ''\n\t\t\t\t? null\n\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t;\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.layoutReserveControl();\n\t\tthis.addActionProductChange();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tlet storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow() && this.storeSelector)\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t\telse if (Type.isNil(storeId))\n\t\t\t\t{\n\t\t\t\t\tstoreId = +this.storeSelector.getStoreId();\n\t\t\t\t\tif (storeId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeStore(storeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tif (!storeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\t\tconst amount = Text.toNumber(available)\n\n\t\tlet amountWithMeasure = '';\n\n\t\tif (!this.getModel().isCatalogExisted() || this.isRestrictedStoreInfo() || this.getModel().isService())\n\t\t{\n\t\t\t//do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\tamountWithMeasure = amount + ' ' + this.#getMeasureName();\n\t\t}\n\n\t\tavailableWrapper.innerHTML =\n\t\t\tamount > 0\n\t\t\t\t? amountWithMeasure\n\t\t\t\t: `<span class=\"store-available-popup-link--danger\">${amountWithMeasure}</span>`\n\t\t;\n\t}\n\n\tupdatePropertyFields()\n\t{\n\t\tconst productProps = this.model.getField('PRODUCT_PROPERTIES');\n\n\t\tfor (const property in productProps)\n\t\t{\n\t\t\tconst availableWrapper = this.#getNodeChildByDataName(property);\n\t\t\tif (availableWrapper)\n\t\t\t{\n\t\t\t\tconst value = this.model.getField('PRODUCT_PROPERTIES')[property] ?? '';\n\t\t\t\tavailableWrapper.innerHTML = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tclearPropertyFields()\n\t{\n\t\tconst propNodes = this.#getNodesChild();\n\t\tpropNodes.forEach((property) => {\n\t\t\tproperty.innerHTML = '';\n\t\t})\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + this.#getMeasureName();\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + this.#getMeasureName();\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference === 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\n\t\t\tif (Type.isObject(imageInfo))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (\n\t\t\t\tthis.reserveControl\n\t\t\t\t&& this.#isReserveEqualProductQuantity()\n\t\t\t\t&& this.#needReserveControlInput()\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\n\t\t\t\t\tthis.reserveControl.changeInputValue(this.getField('QUANTITY'));\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_EDIT && !this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tvalue = this.getField('BASE_PRICE');\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(uiName);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue =\n\t\t\t\t\t\tType.isNil(value) || value === ''\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field): boolean\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0): number\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0): number\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tconst callback = this.onAfterExecuteExternalActions;\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t\tcallback.call();\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked(): boolean\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\tisRestrictedStoreInfo(): boolean\n\t{\n\t\tif (!this.editor.getSettingValue('allowReservation', true))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID')?.toString();\n\t\tif (Type.isNil(storeId) || storeId === '0')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\telse if (this.getModel().isSimple() || this.getModel().isService())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !this.#getAllowedStores().includes(storeId)\n\t\t\t|| !this.editor.getSettingValue('allowEntityReserve', true)\n\t\t;\n\t}\n\n\t#getAllowedStores(): Array\n\t{\n\t\treturn this.editor.getSettingValue('allowedStores', []);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\t#getMeasureName()\n\t{\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treturn Text.encode(measureName);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#getNodesChild(): NodeList\n\t{\n\t\treturn this.getNode().querySelectorAll(`span[data-name]`);\n\t}\n\n\t#onGridUpdated(): void\n\t{\n\t\tif (this.storeAvailablePopup)\n\t\t{\n\t\t\tthis.storeAvailablePopup.refreshStoreInfo();\n\t\t}\n\t}\n\n\tsetType(value)\n\t{\n\t\tthis.setField('TYPE', value);\n\n\t\tif (this.getModel().isService())\n\t\t{\n\t\t\tthis.clearReserveControl();\n\t\t}\n\t}\n\n\t#needReserveControlInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n\n\t#needStoreSelectorInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from 'ui.tour';\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonBeforeProductClearHandler = this.handleOnBeforeProductClear.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.crm-entity-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tif (!this.getSettingValue('disabledSelectProductButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tselectButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.getSettingValue('disabledAddRowButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('.crm-product-list-payment-side-table-column').forEach((column) => {\n\t\t\t\tconst valueElement = column.querySelector('.crm-product-list-result-grid-total');\n\t\t\t\tif (valueElement)\n\t\t\t\t{\n\t\t\t\t\tcolumn.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst settings = {\n\t\t\tisReserveBlocked,\n\t\t\tselectorId: 'crm_grid_' + rowId,\n\t\t};\n\t\tconst product = new Row(rowId, fields, settings, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\tproduct\n\t\t\t.getSelector()\n\t\t\t?.setConfig(\n\t\t\t\t'ENABLE_EMPTY_PRODUCT_ERROR',\n\t\t\t\tthis.getSettingValue('enableEmptyProductError', false)\n\t\t\t)\n\t\t;\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t\t\t{\n\t\t\t\t\t\tfields['DISCOUNT_ROW'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_SUM'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_RATE'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT'] = 0;\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.layoutStoreSelector();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.updatePropertyFields();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnBeforeProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tproduct.clearPropertyFields();\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t{\n\t\t\t\tproduct.setDiscount(0);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t}\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","row","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","measureName","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","isNewRow","wrapper","Dom","append","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","getAvailableQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","setReservedQuantity","dateReservation","changeDateReservation","updateField","model","getModel","isSimple","isService","newDate","parseDate","current","Date","setHours","date","innerHTML","calendar","field","parentNode","bTime","remember","tag","isInputDisabled","onclick","EventEmitter","emit","linkText","link","innerText","hiddenInput","StoreAvailablePopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","rowId","setNode","classList","add","togglePopup","getStoreCollection","refresh","storeId","storeCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","reservedQuantityLink","viewAvailableQuantity","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","getPopupContent","_classPrivateMethodGet","popupId","popup","PopupManager","getPopupById","create","bindElement","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MoneyControl","hint","removeAttribute","remove","currencyBlock","dataset","disabled","setAttribute","Hint","init","MODE_EDIT","MODE_SET","Row","fields","settings","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","modifyQuantityInput","refreshFieldsLayout","requestAnimationFrame","initHandlers","cache","getEditorContainer","mainSelector","isNaN","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","handleChangeStoreData","handleProductErrorsChange","priceNode","control","disable","enable","isRestrictedStoreInfo","countField","storeWrapper","renderTo","isReserveBlocked","reserveControl","clearCache","number","textContent","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","setField","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","trim","isEmpty","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","changeBasePrice","setDeductedQuantity","setRowReserved","setType","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","parseFloat","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","getPricePrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","isNil","VALUE","setTaxRate","isBoolean","setRowSum","isChangedValue","addActionProductChange","updateUiStoreAmountData","layoutReserveControl","availableWrapper","available","amount","amountWithMeasure","isCatalogExisted","productProps","property","propNodes","reserveWrapper","deductedWrapper","reserveDifference","newReserve","Math","max","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","getSettingValue","subscribe","setOption","addActionUpdateTotal","resetReserveFields","onAfterExecuteExternalActions","updateUiInputField","originalPrice","calculatedFields","calculateBasePrice","exceptFieldNames","calculateQuantity","isElementNode","measure","SYMBOL","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","selectItem","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","callback","call","clearReserveControl","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","products","PopupMenu","items","canEditCatalogPrice","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","SELECTOR_INPUT_DISABLED","URL_BUILDER_CONTEXT","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","subscribeEvents","setMode","MODE_VIEW","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","StoreSelector","inputFieldId","inputFieldTitle","searchInput","layoutStoreSelector","storeAvaiableNode","storeAvailablePopup","subscribeOnce","handleOnGridUpdated","storeSearchInput","getNameInput","toggleIcon","getSearchIcon","addClass","getWrapper","openIntegrationLimitSlider","quantityInput","setReserveQuantity","data","getData","initHandlersForSelectors","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","getStoreId","showNegative","load","getDefaultMeasure","refreshStoreInfo","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","setting","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","settingId","selected","currentHeaders","then","message","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","category","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","Slider","url","settingItem","getSetting","settingEnabled","requestGridSettings","stack","width","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","unbind","getScrollContainer","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","undefined","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","Object","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","Map","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleProductListFocus","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnBeforeProductClear","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","hasClass","lock","insertBefore","firstChild","buttonBlock","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onSaveHandler","onFocusToProductList","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onBeforeProductClearHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","command","getCompatData","getProductCount","addProductRow","selectProductInRow","getProductSelector","onProductSelect","product","listHaveEmptyRows","isEmptyRow","focusProductSelector","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","actionUpdateTotalData","isInternalChanging","panelCode","removeClass","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","getSettingsPopup","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","column","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","top","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","setConfig","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","taxId","taxIncluded","keys","key","updatePropertyFields","tableUnfade","clearPropertyFields","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","a","b","addictedFields","productNode","processFieldTour","getActiveHint","InfoHelper","helperSlider","getSlider","slider","location","search","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}