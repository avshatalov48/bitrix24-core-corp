{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/money.control.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}\n","import {Tag, Text, Loc, Event, Cache, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport { Row } from './product.list.row';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#row:Row = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\twrapper = null;\n\tmeasureName;\n\n\tconstructor(options)\n\t{\n\t\tthis.#row = options.row;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\t\tthis.measureName = options.measureName;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#row.isNewRow()\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tthis.wrapper = node;\n\n\t\tDom.append(Tag.render`<div>${this.#getReserveInputNode()}</div>`, this.wrapper);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tDom.append(this.#getDateNode(), this.wrapper);\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#row.getField(this.dateFieldName) || '';\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tconst dateReservation = this.getDateReservation();\n\t\t\tif (dateReservation === '')\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(dateReservation);\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.setReservedQuantity(value, false);\n\t\tthis.#row.updateField(this.inputFieldName, value);\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled(): boolean\n\t{\n\t\tif (this.isBlocked)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst model = this.#row.getModel();\n\t\tif (model)\n\t\t{\n\t\t\treturn model.isSimple() || model.isService();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: string = '')\n\t{\n\t\tif (date !== this.getDateReservation())\n\t\t{\n\t\t\tthis.#row.updateField(this.dateFieldName, date);\n\t\t}\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: string = ''): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === '')\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n\n\tdisable(wrapper: Element|null): void\n\t{\n\t\tconst node = wrapper || this.wrapper;\n\t\tif (node)\n\t\t{\n\t\t\tnode.innerHTML = this.getReservedQuantity() + ' ' + Text.encode(this.measureName);\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Uri, Dom } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tDom.addClass(this.#node, 'store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPopupContent(): HTMLElement\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\t\tconst viewAvailableQuantity =\n\t\t\tavailableQuantity <= 0\n\t\t\t\t? `<span class=\"text--danger\">${availableQuantity}`\n\t\t\t\t: availableQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(viewAvailableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","export default class MoneyControl\n{\n\tnode: Element;\n\thint: String|null;\n\n\tconstructor(options)\n\t{\n\t\tthis.node = options.node;\n\t\tthis.hint = options.hint;\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.node.removeAttribute('disabled');\n\t\tthis.node.removeAttribute('data-hint-no-icon');\n\t\tthis.node.removeAttribute('data-hint');\n\t\tthis.node.classList.remove('ui-ctl-element');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.add('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = false;\n\t\t}\n\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.removeAttribute('disabled');\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.node.setAttribute('disabled', '');\n\t\tthis.node.classList.add('ui-ctl-element');\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.setAttribute('disabled', '');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.remove('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = true;\n\t\t}\n\n\t\tif (this.hint)\n\t\t{\n\t\t\tthis.node.setAttribute('data-hint-no-icon', '');\n\t\t\tthis.node.setAttribute('data-hint', this.hint);\n\n\t\t\tBX.UI.Hint.init(this.node.parentNode);\n\t\t}\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\nimport MoneyControl from './money.control';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nconst enableImageInputCache = new Map();\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.modifyQuantityInput();\n\t\tthis.refreshFieldsLayout();\n\t\tthis.updateUiStoreAmountData();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t\tdisabled: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new MoneyControl({\n\t\t\tnode: priceNode,\n\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_PRICE_CHANGING_RESTRICTED'),\n\t\t});\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tcontrol.disable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontrol.enable();\n\t\t}\n\t}\n\n\tmodifyQuantityInput(): void\n\t{\n\t\tif (!this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst countField = this.#getNodeChildByDataName('QUANTITY');\n\t\tif (countField)\n\t\t{\n\t\t\tconst control = new MoneyControl({\n\t\t\t\tnode: countField,\n\t\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_RESTRICTED_BY_STORE'),\n\t\t\t});\n\t\t\tcontrol.disable();\n\t\t}\n\t}\n\n\t#isEditableCatalogPrice(): boolean\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice(): boolean\n\t{\n\t\treturn this.getModel().isCatalogExisted() && this.getModel().isNew();\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tconst enableImageInput = this.editor.getSettingValue('enableSelectProductImageInput', true);\n\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: enableImageInput,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\t\tSELECTOR_INPUT_DISABLED: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.mainSelector.subscribeEvents();\n\n\t\t\tif (enableImageInput !== enableImageInputCache[id])\n\t\t\t{\n\t\t\t\tthis.mainSelector.setConfig('ENABLE_IMAGE_INPUT', enableImageInput);\n\t\t\t\tif (enableImageInput)\n\t\t\t\t{\n\t\t\t\t\tthis.mainSelector.layoutImage();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tenableImageInputCache[id] = enableImageInput;\n\n\t\tif (this.isRestrictedStoreInfo())\n\t\t{\n\t\t\tthis.mainSelector.setMode(ProductSelector.MODE_VIEW);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<div class=\"main-grid-row-number\"></div>`, mainInfoNode);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`;\n\t\t\t\tDom.append(selectorWrapper, mainInfoNode);\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tif (this.editor.isVisible())\n\t\t\t{\n\t\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.mainSelector.wrapper = selectorWrapper;\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\n\t\tif (this.isRestrictedStoreInfo() && this.storeSelector.searchInput)\n\t\t{\n\t\t\tthis.storeSelector.searchInput.disable(\n\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_STORE_RESTRICTED_BY_STORE')\n\t\t\t);\n\t\t}\n\n\t\tthis.layoutStoreSelector();\n\t}\n\n\tlayoutStoreSelector()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\tif (this.#needStoreSelectorInput())\n\t\t\t{\n\t\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\t\tif (this.isReserveBlocked())\n\t\t\t\t{\n\t\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t});\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tDom.addClass(storeSearchInput.getNameInput(), 'crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => this.editor.openIntegrationLimitSlider();\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.#getAllowedStores().length)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\trow: this,\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t\tmeasureName: this.#getMeasureName(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t{\n\t\t\t\tthis.reserveControl.disable();\n\t\t\t}\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear()\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\n\t\t\tif (this.#needReserveControlInput())\n\t\t\t{\n\t\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t\t{\n\t\t\t\t\tstoreWrapper.innerHTML = this.reserveControl.getReservedQuantity() + ' ' + Text.encode(this.#getMeasureName());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\tclearReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (const fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tconst fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisEmptyRow(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'PRICE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'TYPE':\n\t\t\t\tthis.setType(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tlet taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (!taxRate)\n\t\t\t{\n\t\t\t\ttaxRate = taxList.find((item) => Type.isNil(item.VALUE));\n\t\t\t}\n\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(taxRate.VALUE);\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number | null): void\n\t{\n\t\tconst preparedValue =\n\t\t\tType.isNil(value) || value === ''\n\t\t\t\t? null\n\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t;\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.layoutReserveControl();\n\t\tthis.addActionProductChange();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tlet storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow() && this.storeSelector)\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t\telse if (Type.isNil(storeId))\n\t\t\t\t{\n\t\t\t\t\tstoreId = +this.storeSelector.getStoreId();\n\t\t\t\t\tif (storeId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeStore(storeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tif (!storeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\t\tconst amount = Text.toNumber(available)\n\n\t\tlet amountWithMeasure = '';\n\n\t\tif (!this.getModel().isCatalogExisted() || this.isRestrictedStoreInfo() || this.getModel().isService())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tamountWithMeasure = amount + ' ' + this.#getMeasureName();\n\t\tavailableWrapper.innerHTML =\n\t\t\tamount > 0\n\t\t\t\t? amountWithMeasure\n\t\t\t\t: `<span class=\"store-available-popup-link--danger\">${amountWithMeasure}</span>`\n\t\t;\n\t}\n\n\tupdatePropertyFields()\n\t{\n\t\tconst productProps = this.model.getField('PRODUCT_PROPERTIES');\n\n\t\tfor (const property in productProps)\n\t\t{\n\t\t\tconst availableWrapper = this.#getNodeChildByDataName(property);\n\t\t\tif (availableWrapper)\n\t\t\t{\n\t\t\t\tconst value = this.model.getField('PRODUCT_PROPERTIES')[property] ?? '';\n\t\t\t\tavailableWrapper.innerHTML = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tclearPropertyFields()\n\t{\n\t\tconst propNodes = this.#getNodesChild();\n\t\tpropNodes.forEach((property) => {\n\t\t\tproperty.innerHTML = '';\n\t\t})\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + this.#getMeasureName();\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + this.#getMeasureName();\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference === 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_MAP'] ?? {},\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\t// fill after change setting show pictures.\n\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\t\tif (Type.isObject(imageInfo))\n\t\t{\n\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (\n\t\t\t\tthis.reserveControl\n\t\t\t\t&& this.#isReserveEqualProductQuantity()\n\t\t\t\t&& this.#needReserveControlInput()\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\n\t\t\t\t\tthis.reserveControl.changeInputValue(this.getField('QUANTITY'));\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_EDIT && !this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tvalue = this.getField('BASE_PRICE');\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(uiName);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue =\n\t\t\t\t\t\tType.isNil(value) || value === ''\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field): boolean\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0): number\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0): number\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tconst callback = this.onAfterExecuteExternalActions;\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t\tcallback.call();\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked(): boolean\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\tisRestrictedStoreInfo(): boolean\n\t{\n\t\tif (!this.editor.getSettingValue('allowReservation', true))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID')?.toString();\n\t\tif (Type.isNil(storeId) || storeId === '0')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\telse if (this.getModel().isSimple() || this.getModel().isService())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !this.#getAllowedStores().includes(storeId)\n\t\t\t|| !this.editor.getSettingValue('allowEntityReserve', true)\n\t\t;\n\t}\n\n\t#getAllowedStores(): Array\n\t{\n\t\treturn this.editor.getSettingValue('allowedStores', []);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\t#getMeasureName()\n\t{\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treturn Text.encode(measureName);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#getNodesChild(): NodeList\n\t{\n\t\treturn this.getNode().querySelectorAll(`span[data-name]`);\n\t}\n\n\tsetType(value)\n\t{\n\t\tthis.setField('TYPE', value);\n\n\t\tif (this.getModel().isService())\n\t\t{\n\t\t\tthis.clearReserveControl();\n\t\t}\n\t}\n\n\t#needReserveControlInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n\n\t#needStoreSelectorInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from 'ui.tour';\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tisVisibleGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonBeforeProductClearHandler = this.handleOnBeforeProductClear.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.crm-entity-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tif (!this.getSettingValue('disabledSelectProductButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tselectButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.getSettingValue('disabledAddRowButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('.crm-product-list-payment-side-table-column').forEach((column) => {\n\t\t\t\tconst valueElement = column.querySelector('.crm-product-list-result-grid-total');\n\t\t\t\tif (valueElement)\n\t\t\t\t{\n\t\t\t\t\tcolumn.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst settings = {\n\t\t\tisReserveBlocked,\n\t\t\tselectorId: 'crm_grid_' + rowId,\n\t\t};\n\t\tconst product = new Row(rowId, fields, settings, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\tproduct\n\t\t\t.getSelector()\n\t\t\t?.setConfig(\n\t\t\t\t'ENABLE_EMPTY_PRODUCT_ERROR',\n\t\t\t\tthis.getSettingValue('enableEmptyProductError', false)\n\t\t\t)\n\t\t;\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t\t\t{\n\t\t\t\t\t\tfields['DISCOUNT_ROW'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_SUM'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_RATE'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT'] = 0;\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.layoutStoreSelector();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.updatePropertyFields();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnBeforeProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tproduct.clearPropertyFields();\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t{\n\t\t\t\tproduct.setDiscount(0);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t}\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tif (!this.isVisible())\n\t\t{\n\t\t\tthis.products.forEach(\n\t\t\t\t(product) => {\n\t\t\t\t\tproduct.getSelector()?.layout();\n\t\t\t\t\tproduct.initHandlersForSelectors();\n\t\t\t\t});\n\t\t}\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\n\t\tthis.isVisibleGrid = true;\n\t}\n\n\tisVisible(): boolean\n\t{\n\t\treturn this.isVisibleGrid;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n}\n"],"names":["HintPopup","editor","babelHelpers","classCallCheck","createClass","key","value","load","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","_templateObject","taggedTemplateLiteral","Text","encode","show","close","_row","WeakMap","_cache","_getDateNode","WeakSet","_getReserveInputNode","_layoutDateReservation","ReserveControl","options","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","Cache","MemoryCache","defineProperty","classPrivateFieldSet","row","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","measureName","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","classPrivateFieldGet","isNewRow","renderTo","wrapper","Dom","append","_classPrivateMethodGet","_getReserveInputNode2","call","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","_layoutDateReservation2","getDateReservation","_getDateNode2","_classStaticPrivateMethodGet","_onDateInputClick","onDateChange","setReservedQuantity","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","getAvailableQuantity","event","target","changeInputValue","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","_templateObject2","Loc","getMessage","dateReservation","changeDateReservation","updateField","clearCache","isInputDisabled","model","getModel","isSimple","isService","newDate","parseDate","current","Date","setHours","_templateObject3","date","arguments","length","undefined","disable","innerHTML","calendar","field","parentNode","bTime","_this","remember","_templateObject4","_this2","tag","_templateObject5","onclick","EventEmitter","emit","linkText","link","innerText","hiddenInput","_rowId","_model","_node","_popup","_createPopup","StoreAvailablePopup","rowId","setNode","addClass","togglePopup","getPopupContent","storeId","storeCollection","getStoreCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","concat","renderRow","reservedQuantityLink","viewAvailableQuantity","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","_createPopup2","popupId","popup","PopupManager","getPopupById","create","bindElement","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MoneyControl","hint","enable","_this$node$querySelec","removeAttribute","classList","remove","currencyBlock","add","dataset","disabled","_this$node$querySelec2","setAttribute","Hint","init","MODE_EDIT","MODE_SET","enableImageInputCache","Map","_initActions","_isEditableCatalogPrice","_isSaveableCatalogPrice","_initSelector","_onMainSelectorClear","_initStoreSelector","_initStoreAvailablePopup","_applyStoreSelectorRestrictionTweaks","_initReservedControl","_onStoreFieldChange","_onStoreFieldClear","_onChangeStoreData","_onProductErrorsChange","_shouldShowSmallPriceHint","_togglePriceHintPopup","_getAllowedStores","_isReserveEqualProductQuantity","_getMeasureName","_getNodeChildByDataName","_getNodesChild","_needReserveControlInput","_needStoreSelectorInput","Row","fields","settings","_onChangeStoreData2","_onProductErrorsChange2","_onMainSelectorClear2","_onStoreFieldChange2","_onStoreFieldClear2","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","_initActions2","_initSelector2","_initStoreSelector2","_initStoreAvailablePopup2","_initReservedControl2","modifyBasePriceInput","modifyQuantityInput","refreshFieldsLayout","updateUiStoreAmountData","requestAnimationFrame","initHandlers","getNode","cache","getEditorContainer","getSelector","mainSelector","isNaN","getSettings","Type","isPlainObject","getSettingValue","name","defaultValue","hasOwnProperty","setSettingValue","getEditor","getContainer","getHintPopup","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","initHandlersForSelectors","selectorNames","unsubscribeCustomEvents","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","handleChangeStoreData","handleProductErrorsChange","priceNode","_getNodeChildByDataName2","control","_isEditableCatalogPrice2","isRestrictedStoreInfo","countField","layoutStoreSelector","storeWrapper","_needStoreSelectorInput2","isReserveBlocked","_applyStoreSelectorRestrictionTweaks2","layoutReserveControl","reserveControl","_needReserveControlInput2","_getMeasureName2","clearReserveControl","setRowNumber","number","textContent","getFields","isArrayFilled","clone","_iterator","_createForOfIteratorHelper","_step","s","n","done","fieldName","err","f","fixedProductName","isStringFilled","getCatalogFields","getBasePrice","getTaxIncluded","getTaxId","getCalculateFields","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","setField","changeModel","getUiFieldId","isPriceNetto","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","isDiscountUndefined","isDiscountPercentage","PERCENTAGE","isDiscountMonetary","MONETARY","isDiscountHandmade","isEmptyDiscount","isEmptyRow","trim","isEmpty","getTaxSum","getTaxNode","taxNode","isDomNode","selectedIndex","getAttribute","updateFieldByEvent","fieldCode","type","checked","mode","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","changeBasePrice","setDeductedQuantity","setRowReserved","setType","updateFieldByName","setTaxIncluded","handleCopyAction","menuItem","_this$getEditor","copyRow","menu","getMenuWindow","destroy","handleDeleteAction","_this$getEditor2","deleteRow","preparedValue","parseInt","setProductId","parseFloat","getQuantityPrecision","setQuantity","_this3","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","getPricePrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","isNil","VALUE","setTaxRate","isBoolean","setRowSum","isChangedValue","addActionProductChange","availableWrapper","available","amount","amountWithMeasure","isCatalogExisted","updatePropertyFields","productProps","property","_this$model$getField$","clearPropertyFields","propNodes","_getNodesChild2","reserveWrapper","deductedWrapper","reserveDifference","newReserve","Math","max","resetReserveFields","exceptFields","includes","updateUiField","getCalculator","selectorId","ProductModel","getById","_fields$STORE_MAP","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","storeMap","setDetailPath","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","_isReserveEqualProductQuantity2","subscribe","_this4","_this$storeSelector","setOption","addActionUpdateTotal","onAfterExecuteExternalActions","updateUiInputField","originalPrice","calculatedFields","calculateBasePrice","exceptFieldNames","_togglePriceHintPopup2","calculateQuantity","setReserveQuantity","isElementNode","_this$reserveControl","measure","_this5","SYMBOL","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","getInputByFieldName","fieldId","document","getElementById","updateUiDiscountTypeField","getCurrencyText","getMoneyFieldDropdownApi","Reflection","getClass","Main","dropdownManager","updateMoneyFieldUiWithDropdownApi","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","updateMoneyFieldUiManually","span","dropdownApi","updateUiMeasure","updateUiHtmlField","html","updateUiCurrencyFields","_this6","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","CurrencyCore","currencyFormat","precision","externalActions","addExternalAction","action","actions","productChange","addActionDisableSaveButton","disableSaveButton","updateListField","addActionStateChanged","stateChanged","addActionStateReset","updateTotal","executeActions","callback","_this$getField","_getAllowedStores2","_this7","isReadOnly","actionCellContentContainer","actionsButton","menuItems","products","PopupMenu","items","canEditCatalogPrice","enableImageInput","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","SELECTOR_INPUT_DISABLED","URL_BUILDER_CONTEXT","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","subscribeEvents","setConfig","layoutImage","setMode","MODE_VIEW","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","isVisible","StoreSelector","inputFieldId","inputFieldTitle","searchInput","storeAvaiableNode","storeAvailablePopup","_this8","storeSearchInput","getNameInput","toggleIcon","getSearchIcon","getWrapper","openIntegrationLimitSlider","_this9","quantityInput","_this9$reserveControl","_this10","data","getData","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","getStoreId","_shouldShowSmallPriceHint2","showNegative","_this$editor$getDefau","getDefaultMeasure","PageEventsManager","_settings","eventHandlers","registerEventHandler","eventName","eventHandler","addCustomEvent","fireEvent","eventParams","onCustomEvent","unregisterEventHandlers","i","removeCustomEvent","_target","_editor","_prepareSettingsContent","_getSettingItem","_setSetting","_showNotification","SettingsPopup","getPopup","random","_prepareSettingsContent2","getSetting","requestGridSettings","setting","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","settingId","selected","currentHeaders","then","message","panel","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","_showNotification2","category","updateCheckboxState","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","_getSettingItem2","_item$disabled","descriptionNode","desc","hintNode","Slider","url","_setSetting2","settingItem","settingEnabled","stack","width","_gridGetter","_contentContainer","_bindGridNodeVisionChange","_getPossibleToValidateFieldNodes","_fieldNodeIsInGridVision","_bindSpotlightToNode","_freezeGridContainer","_tieTourToNode","FieldHintManager","contentContainer","gridGetter","processFieldTour","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","_fieldNodeIsInGridVision2","tourObject","_tieTourToNode2","_freezeGridContainer2","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","_bindSpotlightToNode2","_bindGridNodeVisionChange2","getActiveHint","Guide","observedNode","onSuccessVisionCallback","_classPrivateMethodGe","callbackParams","addictedNodes","observedNodes","_getPossibleToValidateFieldNodes2","apply","toConsumableArray","observer","_classPrivateMethodGe2","unbind","getScrollContainer","mainNode","_babelHelpers$classPr","_babelHelpers$classPr2","nodesTuple","_len","_key","_i","_addictedNodes","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","_babelHelpers$classPr3","_babelHelpers$classPr4","gridLeftEdge","gridRightEdge","_len2","fieldNodes","_key2","_i2","_fieldNodes","_fieldNode$getClientR","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","Object","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","_fieldHintManager","_initSupportCustomRowActions","_getCalculatePriceFieldNames","_childrenHasErrors","Editor","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleProductListFocus","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnBeforeProductClear","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","_initSupportCustomRowActions2","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","hasClass","lock","insertBefore","firstChild","buttonBlock","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","onDialogSelectProductHandler","onSaveHandler","onFocusToProductList","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onBeforeProductClearHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","command","_this$products$","_event$getCompatData","getCompatData","_event$getCompatData2","slicedToArray","getProductCount","addProductRow","_this$products$2","selectProductInRow","_this5$getProductSele","getProductSelector","onProductSelect","product","_objectSpread","listHaveEmptyRows","focusProductSelector","_event$getData","_event$getData2","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","subscribeOnce","actionUpdateTotalData","isInternalChanging","panelCode","removeClass","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","_event$getCompatData3","_event$getCompatData4","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","_getAjaxFields","locationId","clearEditor","_event$getCompatData5","_event$getCompatData6","getSettingsPopup","_event$getCompatData7","_event$getCompatData8","ids","resortProductsByIds","refreshSortFields","numerateRows","initPageEventsManager","componentId","pageEventsManager","getPageEventsManager","canSaveCatalogPrice","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","wasProductsInitiated","setForm","clearController","setController","clearProductList","getContainerId","getLanguageId","getSiteId","getCatalogId","setReadOnly","readOnly","setCurrencyId","_product$getModel","changeCurrencyId","priceFields","_getCalculatePriceFieldNames2","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","onCalculatePricesResponse","updateTotalUiCurrency","_this11","totalBlock","column","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getDataSettingsFieldName","getDiscountEnabled","getTaxAllowed","getTaxEnabled","isTaxEnabled","isTaxUniform","getRowIdPrefix","_parseInt","_x","isNumberValue","isStringValue","isNegative","indexOf","_parseFloat","_x2","dot","comma","s1","substr","decimalLength","round","factor","pow","calculatePriceWithoutDiscount","price","discount","discountType","calculateDiscountRate","discountRate","calculatePriceWithoutTax","calculatePriceWithTax","_this12","formId","form","isExistForm","getForm","initFormFields","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","initFormField","attrs","removeFormFields","getFormField","list","_iterator2","_step2","index","_this13","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","setOriginalTemplateEditData","_childrenHasErrors2","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","_event$getData3","_event$getData4","dropdownId","regExp","RegExp","matches","match","_matches","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","top","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","_this$getGrid$getRows","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","has","get","_this14","_this15","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","adjustRows","updateCounterDisplayed","updateCounterSelected","handleDeleteRow","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","_product$getSelector3","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","_product$getSelector","_product$getSelector2","splice","reloadFileInput","layout","unshift","isTaxIncludedActive","_this16","_this16$getProductSel","searchInDialog","focusName","tableFade","_this17","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","taxId","taxIncluded","_this17$getTaxList","keys","tableUnfade","_event$getData5","_event$getData6","compileProductData","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","ENABLE_TAX","productDataValue","productData","saveFields","test","_this18","_iterator3","_step3","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","allowUpdateListField","updateFieldForList","_iterator4","_step4","totalData","updateTotalDataDelayedHandler","stateChange","isChangedGrid","getProductFieldListForTotalData","productFields","_iterator5","_step5","setTotalData","_list","sendTotalData","_this19","needMarkAsChanged","changeSumTotal","_this20","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","validateSubmit","currentBalloon","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","_this21","a","b","handleOnTabShow","_product$getSelector4","isVisibleGrid","showFieldTourHint","addictedFields","productNode","_iterator6","_step6","InfoHelper","helperSlider","getSlider","_event$getData$","slider","location","search","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}