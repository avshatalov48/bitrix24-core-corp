var responsiblePopup,accomplicesPopup,responsiblesPopup,prevTasksPopup,authorPopup;var arAccomplices=[];var arResponsibles=[];var arPrevTasks=[];var tasksEditNS={checkWarningsId:null,checkWarnings:function(){if(this.checkWarningsId)window.clearTimeout(this.checkWarningsId);this.checkWarningsId=window.setTimeout(function(){if(!BX("task-edit-warnings-area"))return;var e=0;var t=document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value;if(document.forms["task-edit-form"].elements["GROUP_ID"])e=document.forms["task-edit-form"].elements["GROUP_ID"].value;var a={sessid:BX.message("bitrix_sessid"),TASK:{RESPONSIBLE_ID:t,GROUP_ID:e},action:"getWarnings"};var s=BX.ajax({method:"POST",dataType:"html",url:"/bitrix/components/bitrix/tasks.task.edit/ajax.php",data:a,async:false});if(s.responseText.length){BX("task-edit-warnings-area-message").innerHTML=s.responseText;BX("task-edit-warnings-area").style.display="block"}else{BX("task-edit-warnings-area").style.display="none";BX("task-edit-warnings-area-message").innerHTML=""}},250)},onFilesChange:function(){var e=[];var t="";if(this.files&&this.files.length>0){e=this.files}else{var a=this.value;var s=a.replace(/.*\\(.*)/,"$1");s=s.replace(/.*\/(.*)/,"$1");e=[{fileName:s}]}var n;do{n=Math.floor(Math.random()*99999)}while(BX("iframe-"+n));var i=BX("webform-field-upload-list");var o=[];for(var r=0;r<e.length;r++){if(!e[r].fileName&&e[r].name){e[r].fileName=e[r].name}t=e[r].fileName;if(t.length>=95)t=t.substr(0,91)+"...";var l=BX.create("li",{props:{className:"uploading",id:"file-"+r+"-"+n},children:[BX.create("a",{props:{href:"",target:"_blank",className:"upload-file-name",title:e[r].fileName},text:t,events:{click:function(e){BX.PreventDefault(e)}}}),BX.create("i",{}),BX.create("a",{props:{href:"",className:"delete-file"},events:{click:function(e){BX.PreventDefault(e)}}})]});i.appendChild(l);o.push(l)}var d="iframe-"+n;var p=BX.create("iframe",{props:{name:d,id:d},style:{display:"none"}});document.body.appendChild(p);var c=this.parentNode;var u=BX.create("form",{props:{method:"post",action:"/bitrix/components/bitrix/tasks.task.edit/upload.php",enctype:"multipart/form-data",encoding:"multipart/form-data",target:d},style:{display:"none"},children:[this,BX.create("input",{props:{type:"hidden",name:"sessid",value:BX.message("bitrix_sessid")}}),BX.create("input",{props:{type:"hidden",name:"uniqueID",value:n}}),BX.create("input",{props:{type:"hidden",name:"mode",value:"upload"}})]});document.body.appendChild(u);BX.submit(u);setTimeout(BX.delegate(function(){c.appendChild(this);BX.cleanNode(u,true)},this),15)}};function changeDurationType(e){bindElement=BX("task-duration-"+e);if(!BX.hasClass(bindElement,"selected")){BX("task-duration-type").value=e;BX.addClass(bindElement,"selected");bindElement.parentNode.appendChild(BX("task-duration-"+(e=="days"?"hours":"days")));BX.toggleClass(BX("task-duration-"+(e=="days"?"hours":"days")),"selected")}fillPlanDates()}function fillPlanDates(){if((duration=parseInt(BX("task-duration").value,10))&&duration>0){if(BX("task-duration-type").value=="days")duration*=24;if(BX("task-start-date").value.length>0){var e=BX("task-start-date",true).value;var t=new Date(BX.parseDate(e).getTime()+duration*60*60*1e3);var a=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),t);BX("task-end-date").value=a.replace(" 12:00:00 AM"," ").replace(/ 00:00:00$/," ").replace(" 12:00 AM"," ").replace(/ 00:00$/," ");BX.removeClass(BX("task-end-date").parentNode.parentNode,"webform-field-textbox-empty")}else if(BX("task-end-date").value.length>0){var t=BX("task-end-date",true).value;var e=new Date(BX.parseDate(t).getTime()-duration*60*60*1e3);var a=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),e);BX("task-start-date").value=a.replace(" 12:00:00 AM"," ").replace(/ 00:00:00$/," ").replace(" 12:00 AM"," ").replace(/ 00:00$/," ");BX.removeClass(BX("task-start-date").parentNode.parentNode,"webform-field-textbox-empty")}}}var taskManagerForm={funcOnChangeStartOrEndDate:function(e){if(e.value.length>0)BX.removeClass(e.parentNode.parentNode,"webform-field-textbox-empty");var t=BX("task-start-date",true).value;t=BX.parseDate(t);var a=BX("task-end-date",true).value;a=BX.parseDate(a);if(t&&a){var s=Math.floor((a.getTime()-t.getTime())/1e3/60/60);if(s>0){if(s%24){BX("task-duration").value=s;BX("task-duration-hours").click();changeDurationType("hours")}else{BX("task-duration").value=s/24;changeDurationType("days")}}}},init:function(e){BX.bind(BX("task-title"),"focus",function(){if(this.value==BX.message("TASKS_DEFAULT_TITLE")){this.value="";BX.removeClass(this,"inactive")}});BX.bind(BX("task-title"),"blur",function(){if(this.value==""){this.value=BX.message("TASKS_DEFAULT_TITLE");BX.addClass(this,"inactive")}});if(BX.type.isNotEmptyString(e.editorId)){setTimeout(function(){var t=BX("task-title");var a=window.BXHtmlEditor.Get(e.editorId);if(BX.type.isElementNode(t)&&typeof a!="undefined"&&"Focus"in a){a.Focus(false);t.focus()}},1e3)}var t=document.getElementById("task-priority").getElementsByTagName("a");for(var a=0;a<t.length;a++)BX.bind(t[a],"click",taskManagerForm._changePriority);BX.bind(BX("task-planning-dates-link"),"click",function(e){if(!e)e=window.event;var t=BX("task-planning-dates");if(t.style.display=="none")t.style.display="block";else t.style.display="none";BX.PreventDefault(e)});BX.bind(BX("task-duration-hours"),"click",function(e){if(!e)e=window.event;changeDurationType("hours");BX.PreventDefault(e)});BX.bind(BX("task-duration-days"),"click",function(e){if(!e)e=window.event;changeDurationType("days");BX.PreventDefault(e)});BX.bind(BX("task-duration"),"change",function(e){if(!e)e=window.event;fillPlanDates()});if(BX("webform-field-upload-list")){var s=BX("webform-field-upload-list").children;for(var a=0;a<s.length;a++){BX.bind(s[a].lastChild.previousSibling,"click",taskManagerForm._deleteFile)}BX.bind(BX("task-upload"),"change",tasksEditNS.onFilesChange)}BX.bind(BX("webform-field-additional-link"),"click",function(){BX.toggleClass(this,"selected");BX("webform-additional-fields-content").style.display=BX.hasClass(this,"selected")?"block":"none"});BX.bind(BX("task-previous-tasks-link"),"click",function(e){if(!e)e=window.event;arPrevTasks=O_PREV_TASKS.arSelected;prevTasksPopup=BX.PopupWindowManager.create("prev-tasks-employee-popup",this,{autoHide:true,closeByEsc:true,content:BX("PREV_TASKS_selector_content"),buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_SELECT"),className:"popup-window-button-accept",events:{click:function(e){if(!e)e=window.event;var t=[];var s=BX.create("ol",{props:{className:"task-to-tasks-list",id:"task-previous-tasks-list"}});for(a=0;a<arPrevTasks.length;a++){if(arPrevTasks[a]){s.appendChild(BX.create("li",{props:{className:"task-to-tasks-item"},children:[BX.create("a",{props:{className:"task-to-tasks-item-name",href:BX.message("TASKS_PATH_TO_TASK").replace("#task_id#",arPrevTasks[a].id).replace("#action#","view"),title:arPrevTasks[a].name,target:"_blank"},text:arPrevTasks[a].name}),BX.create("span",{props:{className:"task-to-tasks-item-delete"},events:{click:function(){var e=arPrevTasks[a].id;return function(t){if(!t)t=window.event;onPrevTasksUnselect(e,this)}}()}})]}));t.push(arPrevTasks[a].id)}}setTimeout(function(){BX.cleanNode(BX("task-previous-tasks-list-outer"));BX("task-previous-tasks-list-outer").appendChild(s)},0);document.forms["task-edit-form"].elements["PREV_TASKS_IDS"].value=t.join(",");this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(e){if(!e)e=window.event;this.popupWindow.close();BX.PreventDefault(e)}}})]});BX.addCustomEvent(prevTasksPopup,"onAfterPopupShow",function(e){setTimeout("O_PREV_TASKS.searchInput.focus();",100)});prevTasksPopup.show();this.value="";BX.focus(this);BX.PreventDefault(e)});BX.bind(BX("task-supertask-link"),"click",function(e){if(!e)e=window.event;parentTaskPopup=BX.PopupWindowManager.create("parent-task-employee-popup",this,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("PARENT_TASK_selector_content"),buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_CLOSE_POPUP"),className:"popup-window-button-accept",events:{click:function(e){if(!e)e=window.event;this.popupWindow.close()}}})]});BX.addCustomEvent(parentTaskPopup,"onAfterPopupShow",function(e){setTimeout("O_PARENT_TASK.searchInput.focus();",100)});parentTaskPopup.show();this.value="";BX.focus(this);BX.PreventDefault(e)});var n=[BX("task-repeating-interval-start-date"),BX("task-repeating-interval-end-date")];for(var a=0;a<n.length;a++){if(n[a]){BX.bind(n[a].nextSibling,"click",taskManagerForm._clearTextBox);BX.bind(n[a],"click",taskManagerForm._showCalendar)}}BX.bind(BX("task-deadline-date").nextSibling,"click",taskManagerForm._clearTextBox);BX.bind(BX("task-deadline-date"),"click",function(e){if(!e)e=window.event;taskManagerForm._showCalendar.call(this,e,function(){var e=BX("task-deadline-date");var t=BX.CJSTask.ui.extractDefaultTimeFromDataAttribute(e);e.value=BX.CJSTask.addTimeToDateTime(e.value,t);if(e.value.length>0)BX.removeClass(e.parentNode.parentNode,"webform-field-textbox-empty");tasksRemindersPopUp.setDeadline(e.value)})});BX.bind(BX("task-start-date").nextSibling,"click",taskManagerForm._clearTextBox);BX.bind(BX("task-start-date"),"click",taskManagerForm._showCalendarWithCallback);BX.bind(BX("task-end-date").nextSibling,"click",taskManagerForm._clearTextBox);BX.bind(BX("task-end-date"),"click",taskManagerForm._showCalendarWithCallback);if(BX("task-repeating-checkbox")){BX.bind(BX("task-repeating-checkbox"),"click",taskManagerForm._enableRepeating);var i=BX("task-repeating-timespan").getElementsByTagName("a");for(var a=0;a<i.length;a++)BX.bind(i[a],"click",taskManagerForm._changeRepeating);var o=BX("task-repeating-timespan-days").getElementsByTagName("a");for(var a=0;a<o.length;a++)BX.bind(o[a],"click",taskManagerForm._changeRepeatingDay)}BX.bind(BX("task-submit-button"),"click",taskManagerForm._submitForm);if(BX("task-submit-back-to-form-button")){BX.bind(BX("task-submit-back-to-form-button"),"click",taskManagerForm._submitFormAndBack)}if(BX("task-submit-and-create-new-when-back-to-form-button")){BX.bind(BX("task-submit-and-create-new-when-back-to-form-button"),"click",taskManagerForm._submitFormAndBackForCreateNew)}BX.bind(BX("task-responsible-employee"),"focus",BX.proxy(ShowResponsibleSelector,BX("task-responsible-employee").parentNode));BX.bind(BX("task-responsible-employee").parentNode,"click",function(e){if(!e)e=window.event;BX("task-responsible-employee").focus();BX.PreventDefault(e)});BX.bind(BX("task-sonet-group-selector"),"click",function(e){if(!e)e=window.event;groupsPopup.show();BX.PreventDefault(e)});function r(e){if(!e)e=window.event;if(!authorPopup||authorPopup.popupContainer.style.display!="block"){authorPopup=BX.PopupWindowManager.create("author-employee-popup",this,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("AUTHOR_selector_content")});BX.addCustomEvent(authorPopup,"onAfterPopupShow",function(e){setTimeout("O_AUTHOR.searchInput.focus();",100)});authorPopup.show();this.value="";BX.focus(this)}BX.PreventDefault(e)}if(BX("task-author-employee")){BX.bind(BX("task-author-employee"),"click",BX.proxy(r,BX("task-author-employee").parentNode))}BX.bind(BX("task-assistants-link"),"click",function(e){if(!e)e=window.event;arAccomplices=O_ACCOMPLICES.arSelected;accomplicesPopup=BX.PopupWindowManager.create("accomplices-employee-popup",this,{autoHide:true,closeByEsc:true,content:BX("ACCOMPLICES_selector_content"),buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_SELECT"),className:"popup-window-button-accept",events:{click:function(e){if(!e)e=window.event;var t=[];BX.cleanNode(BX("task-assistants-list"));var s=BX("task-assistants-link");for(a=0;a<arAccomplices.length;a++){if(arAccomplices[a]){BX("task-assistants-list").appendChild(BX.create("div",{props:{className:"task-assistant-item"},children:[BX.create("span",{props:{className:"task-assistant-link",href:BX.message("TASKS_PATH_TO_USER_PROFILE").replace("#user_id#",arAccomplices[a].id),target:"_blank",title:arAccomplices[a].name},text:arAccomplices[a].name})]}));t.push(arAccomplices[a].id)}}if(t.length>0){if(s.innerHTML.substr(s.innerHTML.length-1)!=":"){s.innerHTML=s.innerHTML+":"}}else{if(s.innerHTML.substr(s.innerHTML.length-1)==":"){s.innerHTML=s.innerHTML.substr(0,s.innerHTML.length-1)}}document.forms["task-edit-form"].elements["ACCOMPLICES_IDS"].value=t.join(",");this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(e){if(!e)e=window.event;this.popupWindow.close();BX.PreventDefault(e)}}})]});BX.addCustomEvent(accomplicesPopup,"onAfterPopupShow",function(e){setTimeout("O_ACCOMPLICES.searchInput.focus();",100)});accomplicesPopup.show();this.value="";BX.focus(this);BX.PreventDefault(e)});if(BX("task-responsibles-link")){BX.bind(BX("task-responsibles-link"),"click",function(e){if(!e)e=window.event;arResponsibles=O_RESPONSIBLES.arSelected;responsiblesPopup=BX.PopupWindowManager.create("responsibles-employee-popup",this,{autoHide:true,closeByEsc:true,content:BX("RESPONSIBLES_selector_content"),buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_SELECT"),className:"popup-window-button-accept",events:{click:function(e){if(!e)e=window.event;var t=[];BX.cleanNode(BX("task-responsible-employees-list"));for(a=0;a<arResponsibles.length;a++){if(arResponsibles[a]){BX("task-responsible-employees-list").appendChild(BX.create("div",{props:{className:"task-responsible-employee-item"},children:[BX.create("a",{props:{className:"task-responsible-employee-link",href:BX.message("TASKS_PATH_TO_USER_PROFILE").replace("#user_id#",arResponsibles[a].id),target:"_blank",title:arResponsibles[a].name},text:arResponsibles[a].name})]}));t.push(arResponsibles[a].id)}}document.forms["task-edit-form"].elements["RESPONSIBLES_IDS"].value=t.join(",");this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(e){if(!e)e=window.event;this.popupWindow.close();BX.PreventDefault(e)}}})]});responsiblesPopup.show();this.value="";BX.focus(this);BX.PreventDefault(e)})}},_activateCurrentItem:function(e,t){for(var a=0;a<e.length;a++){if(e[a]==t)BX.addClass(e[a],"selected");else BX.removeClass(e[a],"selected")}},_changePriority:function(e){if(!e)e=window.event;BX("task-priority-field").value=this.id.substr(this.id.lastIndexOf("-")+1);taskManagerForm._activateCurrentItem(this.parentNode.children,this);BX.PreventDefault(e)},_enableRepeating:function(e){if(!e)e=window.event;if(this.checked)BX.addClass(BX("task-repeating"),"selected");else{BX.removeClass(BX("task-repeating"),"selected");return}var t=document.getElementById("task-repeating-timespan").getElementsByTagName("a");for(var a=0;a<t.length;a++)if(BX.hasClass(t[a],"selected"))return;taskManagerForm._activateCurrentItem(t[0].parentNode.children,t[0]);var s=BX("task-repeating-timespan-details");taskManagerForm._activateCurrentItem(s.children[0].children,s.children[0].children[0])},_changeRepeating:function(e){if(!e)e=window.event;if(BX("task-repeating-checkbox").checked){BX("task-repeat-period").value=this.id.substr(this.id.lastIndexOf("-")+1);taskManagerForm._activateCurrentItem(this.parentNode.children,this);var t=BX("task-repeating-timespan-details");taskManagerForm._activateCurrentItem(t.children[0].children,BX.findChild(t.children[0],{tagName:"div",className:this.id}));if(this.id=="task-repeating-by-weekly"){var a=BX("task-repeating-timespan-days").children;var s=false;for(var n=0;n<a.length;n++){if(BX.hasClass(a[n],"selected")){s=true;break}}if(!s)BX.addClass(a[0],"selected")}}BX.PreventDefault(e)},_changeRepeatingDay:function(e){if(!e)e=window.event;BX.toggleClass(this,"selected");var t=[];var a=BX("task-repeating-timespan-days").getElementsByTagName("a");for(var s=0;s<a.length;s++){if(BX.hasClass(a[s],"selected")){t.push(a[s].id.substr(a[s].id.lastIndexOf("-")+1))}}BX("task-week-days").value=t.join(",");BX.PreventDefault(e)},_clearTextBox:function(e){if(!e)e=window.event;this.previousSibling.value="";if(this.previousSibling.id=="task-deadline-date"){tasksRemindersPopUp.setDeadline(false)}BX.addClass(this.parentNode.parentNode,"webform-field-textbox-empty");BX.PreventDefault(e)},_submitForm:function(e){if(!e)e=window.event;if(BX("task-title").value==BX.message("TASKS_DEFAULT_TITLE")){BX("task-title").value=""}if(BX("task-upload"))BX("task-upload").disabled=true;BX.submit(BX("task-edit-form"));BX.unbind(BX("task-submit-button"),"click",taskManagerForm._submitForm);BX.PreventDefault(e)},_submitFormAndBack:function(e){if(!e)e=window.event;BX("task-edit-form").elements["apply"].value="save_and_back";BX("task-upload").disabled=true;taskManagerForm._submitForm();BX.unbind(BX("task-submit-back-to-form-button"),"click",taskManagerForm._submitFormAndBack);BX.PreventDefault(e)},_submitFormAndBackForCreateNew:function(e){if(!e)e=window.event;BX("task-edit-form").elements["apply"].value="save_and_create_new";taskManagerForm._submitForm(e);BX.unbind(BX("task-submit-and-create-new-when-back-to-form-button"),"click",taskManagerForm._submitFormAndBack);BX.PreventDefault(e)},_showCalendar:function(e,t){if(!e)e=window.event;var a=this.name;var s=true;var n="task-edit-form";var i={node:this.parentNode,form:n,field:a,bTime:s,value:BX.CJSTask.ui.getInputDateTimeValue(this),bHideTime:false};if(t)i.callback_after=t;var o=BX.calendar(i)},_showCalendarWithCallback:function(e){if(!e)e=window.event;var t=this.name;var a=true;var s="task-edit-form";var n=this;BX.calendar({node:this.parentNode,form:s,field:t,bTime:a,value:BX.CJSTask.ui.getInputDateTimeValue(this),bHideTime:false,callback_after:function(e){taskManagerForm.funcOnChangeStartOrEndDate(n,e)}})},_filesUploaded:function(e,t){for(i=0;i<e.length;i++){var a=BX("file-"+i+"-"+t);if(e[i].fileID){BX.removeClass(a,"uploading");BX.adjust(a.firstChild,{props:{href:e[i].fileULR}});BX.unbindAll(a.firstChild);BX.unbindAll(a.lastChild);BX.bind(a.lastChild,"click",taskManagerForm._deleteFile);a.appendChild(BX.create("input",{props:{type:"hidden",name:"FILES[]",value:e[i].fileID}}))}else{BX.cleanNode(a,true)}}BX.cleanNode(BX("iframe-"+t),true)},_deleteFile:function(e){if(!e)e=window.event;if(confirm(BX.message("TASKS_DELETE_CONFIRM"))){if(!BX.hasClass(this.parentNode,"saved")){var t={fileID:this.nextSibling.value,sessid:BX.message("bitrix_sessid"),mode:"delete"};var a="/bitrix/components/bitrix/tasks.task.edit/upload.php";BX.ajax.post(a,t)}BX.remove(this.parentNode);if(BX.browser.IsIE()){BX("task-upload-container").innerHTML="";BX("task-upload-container").appendChild(BX.create("input",{props:{multiple:"multiple",id:"task-upload",size:1,name:"task-attachments[]",type:"file"},events:{change:tasksEditNS.onFilesChange}}))}}BX.PreventDefault(e)}};function ShowResponsibleSelector(e){if(!e)e=window.event;if(!responsiblePopup||responsiblePopup.popupContainer.style.display!="block"){responsiblePopup=BX.PopupWindowManager.create("responsible-employee-popup",this,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("RESPONSIBLE_selector_content")});responsiblePopup.show();BX.addCustomEvent(responsiblePopup,"onPopupClose",onResponsibleClose);this.value="";BX.focus(this)}BX.PreventDefault(e)}function onResponsibleSelect(e){var t=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",name:"GROUP_ID"});if(t&&t.value>0&&e.id>0){var a=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",className:"tasks-notclass-GROUP_NAME"});var s=t.value;var n=a.value;tasksEditNS.checkWarnings()}document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value=e.id;if(e.id==loggedInUser){BX("task-control").parentNode.firstChild.disabled=true;BX("task-control").parentNode.firstChild.checked=false;BX.addClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}else{BX("task-control").parentNode.firstChild.disabled=false;BX("task-control").parentNode.firstChild.checked=BX.message("TASKS_META_RECCOMEND_TASK_CONTROL")==="Y"?true:false;BX.removeClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}if(e.id==currentUser){BX("add-in-report").parentNode.firstChild.disabled=true;BX("add-in-report").parentNode.firstChild.checked=false;BX.addClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled");if(BX("add-to-timeman")){BX("add-to-timeman").parentNode.firstChild.disabled=false;BX.removeClass(BX("add-to-timeman").parentNode,"webform-field-checkbox-option-disabled")}}else{if(e.sub){BX("add-in-report").parentNode.firstChild.disabled=false;BX("add-in-report").parentNode.firstChild.checked=true;BX.removeClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled")}if(BX("add-to-timeman")){BX("add-to-timeman").parentNode.firstChild.disabled=true;BX("add-to-timeman").parentNode.firstChild.checked=false;BX.addClass(BX("add-to-timeman").parentNode,"webform-field-checkbox-option-disabled")}}responsiblePopup.close()}function onResponsibleClose(){var e=O_RESPONSIBLE.arSelected.pop();if(e){O_RESPONSIBLE.arSelected.push(e);O_RESPONSIBLE.searchInput.value=e.name}}function onAuthorSelect(e){var t=BX.findNextSibling(BX("task-author-employee"),{tagName:"a"});if(t==null)t=BX.findNextSibling(BX("task-author-employee"),{tagName:"span"});BX.remove(t);BX("task-author-employee").parentNode.appendChild(BX.create("span",{props:{className:"task-director-link",href:BX.message("TASKS_PATH_TO_USER_PROFILE").replace("#user_id#",e.id),target:"_blank",title:e.name},text:e.name}));document.forms["task-edit-form"].elements["CREATED_BY"].value=e.id;if(e.id==loggedInUser){BX("task-control").parentNode.firstChild.disabled=true;BX("task-control").parentNode.firstChild.checked=false;BX.addClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}else{BX("task-control").parentNode.firstChild.disabled=false;BX("task-control").parentNode.firstChild.checked=BX.message("TASKS_META_RECCOMEND_TASK_CONTROL")==="Y"?true:false;BX.removeClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}if(!(isAdmin||isPortalB24Admin)){if(e.id!=currentUser){previousUser=document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value;previousUserName=BX("task-responsible-employee").value;prevUserSubordinate=!BX("add-in-report").parentNode.firstChild.disabled;document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value=currentUser;BX("task-responsible-employee").value=currentUserName;BX.addClass(document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].parentNode.parentNode,"webform-field-combobox-disabled");BX.unbindAll(BX("task-responsible-employee").parentNode);BX.unbindAll(BX("task-responsible-employee"));if(BX("duplicate-task")){BX("duplicate-task").disabled=true;BX.addClass(BX("duplicate-task").parentNode,"webform-field-checkbox-option-disabled")}BX("task-responsible-employee").disabled=true;BX.bind(BX("task-responsible-employee").parentNode,"click",function(e){if(!e)e=window.event;BX.PreventDefault(e)});if(e.sup){BX("add-in-report").parentNode.firstChild.disabled=false;BX("add-in-report").parentNode.firstChild.checked=true;BX.removeClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled")}else{BX("add-in-report").parentNode.firstChild.disabled=true;BX("add-in-report").parentNode.firstChild.checked=false;BX.addClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled")}}else{if(prevUserSubordinate){BX("add-in-report").parentNode.firstChild.disabled=false;BX("add-in-report").parentNode.firstChild.checked=true;BX.removeClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled")}else{BX("add-in-report").parentNode.firstChild.disabled=true;BX("add-in-report").parentNode.firstChild.checked=false;BX.addClass(BX("add-in-report").parentNode,"webform-field-checkbox-option-disabled")}document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value=previousUser;BX("task-responsible-employee").value=previousUserName;BX("duplicate-task").disabled=false;BX.removeClass(BX("duplicate-task").parentNode,"webform-field-checkbox-option-disabled");BX("task-responsible-employee").disabled=false;BX.removeClass(document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].parentNode.parentNode,"webform-field-combobox-disabled");BX.bind(BX("task-responsible-employee"),"focus",BX.proxy(ShowResponsibleSelector,BX("task-responsible-employee").parentNode));BX.bind(BX("task-responsible-employee"),"keyup",BX.proxy(O_RESPONSIBLE.search,O_RESPONSIBLE));BX.bind(BX("task-responsible-employee"),"focus",BX.proxy(O_RESPONSIBLE._onFocus,O_RESPONSIBLE));BX.bind(BX("task-responsible-employee").parentNode,"click",function(e){if(!e)e=window.event;BX("task-responsible-employee").focus();BX.PreventDefault(e)})}}authorPopup.close()}function onAccomplicesChange(e){arAccomplices=e}function onPrevTasksChange(e){arPrevTasks=e}function onPrevTasksUnselect(e,t){O_PREV_TASKS.unselect(e,BX("task-unselect-"+e));BX.remove(t.parentNode);var a=[];for(i=0;i<O_PREV_TASKS.arSelected.length;i++){if(O_PREV_TASKS.arSelected[i]){a.push(O_PREV_TASKS.arSelected[i].id)}}document.forms["task-edit-form"].elements["PREV_TASKS_IDS"].value=a.join(",")}function onResponsiblesChange(e){arResponsibles=e}function onParentTaskSelect(e){var t=[];BX.cleanNode(BX("task-parent-tasks-list"));BX("task-parent-tasks-list").appendChild(BX.create("li",{props:{className:"task-to-tasks-item"},children:[BX.create("a",{props:{className:"task-to-tasks-item-name",href:BX.message("TASKS_PATH_TO_TASK").replace("#task_id#",e.id).replace("#action#","view"),title:e.name,target:"_blank"},text:e.name}),BX.create("span",{props:{className:"task-to-tasks-item-delete"},events:{click:function(){var t=e.id;return function(e){if(!e)e=window.event;onParentTasksRemove(t,this)}}()}})]}));document.forms["task-edit-form"].elements["PARENT_ID"].value=e.id;parentTaskPopup.close()}function onParentTasksRemove(e,t){O_PARENT_TASK.unselect(e);BX.remove(t.parentNode);document.forms["task-edit-form"].elements["PARENT_ID"].value=""}function CopyTask(e){var t=BX("task-responsible-employee-label",true);var a=BX("task-responsible-employee-block",true);var s=BX("task-responsible-employees-block",true);var n=BX("task-assistants-block",true);var i=BX("task-director-employees-block",true);var o=false;if(document.forms["task-edit-form"].elements["RESPONSIBLE_ID"].value==loggedInUser)o=false;else o=true;if(e.checked){o=true;t.htmlFor="";t.innerHTML=BX.message("TASKS_RESPONSIBLES");a.style.display="none";s.style.display="block";n.style.display="none";if(!(isAdmin||isPortalB24Admin))i.style.display="none"}else{t.htmlFor="task-responsible-employee";t.innerHTML=BX.message("TASKS_RESPONSIBLE");a.style.display="block";s.style.display="none";n.style.display="block";if(!(isAdmin||isPortalB24Admin))i.style.display="block"}if(!o){BX("task-control").parentNode.firstChild.disabled=true;BX("task-control").parentNode.firstChild.checked=false;BX.addClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}else{BX("task-control").parentNode.firstChild.disabled=false;BX("task-control").parentNode.firstChild.checked=BX.message("TASKS_META_RECCOMEND_TASK_CONTROL")==="Y"?true:false;BX.removeClass(BX("task-control").parentNode,"webform-field-checkbox-option-disabled")}}function onGroupSelect(e){if(e[0]){BX.adjust(BX("task-sonet-group-selector"),{text:BX.message("TASKS_TASK_GROUP")+": "+e[0].title});var t=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"span",className:"task-group-delete"});if(t){BX.adjust(t,{events:{click:function(t){if(!t)t=window.event;deleteGroup(e[0].id)}}})}else{BX("task-sonet-group-selector").parentNode.appendChild(BX.create("span",{props:{className:"task-group-delete"},events:{click:function(t){if(!t)t=window.event;deleteGroup(e[0].id)}}}))}var a=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",className:"tasks-notclass-GROUP_ID"});if(a){BX.adjust(a,{props:{value:e[0].id}});var s=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",className:"tasks-notclass-GROUP_NAME"});BX.adjust(s,{props:{value:e[0].title}})}else{BX("task-sonet-group-selector").parentNode.appendChild(BX.create("input",{props:{name:"GROUP_ID",className:"tasks-notclass-GROUP_ID",type:"hidden",value:e[0].id}}));BX("task-sonet-group-selector").parentNode.appendChild(BX.create("input",{props:{name:"GROUP_NAME",className:"tasks-notclass-GROUP_NAME",type:"hidden",value:e[0].title}}))}tasksEditNS.checkWarnings()}}function deleteGroup(e){tasksEditNS.checkWarnings();BX.adjust(BX("task-sonet-group-selector"),{text:BX.message("TASKS_TASK_GROUP")});var t=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"span",className:"task-group-delete"});if(t){BX.cleanNode(t,true)}var a=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",className:"tasks-notclass-GROUP_ID"});if(a){a.value=0}var a=BX.findNextSibling(BX("task-sonet-group-selector"),{tag:"input",className:"tasks-notclass-GROUP_NAME"});if(a){a.value=""}groupsPopup.deselect(e)}function onCancelClick(e,t){if(!e)e=window.event;if(window.top.BX.TasksIFrameInst&&window.top.BX.TasksIFrameInst.isOpened()){if(document.referrer&&t=="edit"&&document.referrer.indexOf("IFRAME=Y")!=-1){var a=true;window.top.BX.TasksIFrameInst.isEditMode=!a;window.top.BX.TasksIFrameInst.load(document.referrer,a)}else{window.top.BX.TasksIFrameInst.close()}BX.PreventDefault(e)}}
//# sourceMappingURL=script.map.js