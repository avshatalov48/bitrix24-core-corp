{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\nconst PRODUCT_TYPE_SET = 2;\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tvalidatingFields: Map<string, boolean> = new Map();\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo',true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth',true),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (barcodeWrapper)\n\t\t{\n\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames)\n\t\t\t.forEach( rowName => {\n\t\t\t\tconst selectorOptions = {\n\t\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\t\tmodel: this.model,\n\t\t\t\t};\n\n\t\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\tif (storeSelector)\n\t\t\t\t{\n\t\t\t\t\tstoreSelector.renderTo(storeWrapper);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\tstoreSelector,\n\t\t\t\t\t'onChange',\n\t\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t\t);\n\n\t\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tupdateRowTotalPrice()\n\t{\n\t\tconst field = this.getEditor().getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tlet value = this.getAmount() * this.getField(field, 0);\n\t\tvalue = Math.max(value, 0);\n\n\t\tthis.setField('TOTAL_PRICE', value);\n\t\tthis.updateUiField('TOTAL_PRICE', value.toFixed(this.getPricePrecision()));\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t});\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t'_AMOUNT': () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t'_RESERVED': () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t'_AVAILABLE_AMOUNT': () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts) {\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix)) {\n\t\t\t\t\tconst wrapper = this.getNode().querySelector('[data-name=' + fieldName + postfix + ']');\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\t\t\t\t\t\twrapper.innerHTML = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.updateRowTotalPrice();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\tcase 'TOTAL_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tconst moneyFields = ['BASE_PRICE', 'PURCHASING_PRICE', 'TOTAL_PRICE'];\n\t\tif (moneyFields.includes(field))\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (Boolean(validatorCallback(eventObject.target.valueAsNumber)))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from \"ui.tour\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ROW_ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.executeExternalActions();\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'SKU_ID',\n\t\t\t'AMOUNT',\n\t\t\t'PURCHASING_PRICE',\n\t\t\t'BASE_PRICE',\n\t\t\t'BASE_PRICE_EXTRA',\n\t\t\t'BASE_PRICE_EXTRA_RATE',\n\t\t\t'DOC_BARCODE',\n\t\t\t'BARCODE',\n\t\t\t'STORE_TO',\n\t\t\t'STORE_FROM',\n\t\t\t'BASE_PRICE_ID',\n\t\t\t'BASKET_ID',\n\t\t\t'DOC_ID',\n\t\t\t'ELEMENT_ID',\n\t\t\t'IBLOCK_ID',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'NAME',\n\t\t\t'OFFERS_IBLOCK_ID',\n\t\t\t'PARENT_PRODUCT_ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'ROW_ID',\n\t\t\t'STORE_FROM_AMOUNT',\n\t\t\t'STORE_FROM_AVAILABLE_AMOUNT',\n\t\t\t'STORE_FROM_RESERVED',\n\t\t\t'STORE_FROM_TITLE',\n\t\t\t'STORE_TO_AMOUNT',\n\t\t\t'STORE_TO_AVAILABLE_AMOUNT',\n\t\t\t'STORE_TO_RESERVED',\n\t\t\t'STORE_TO_TITLE',\n\t\t\t'TOTAL_PRICE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = []): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tconst firstProductRowNode = this.products[0].getNode();\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = firstProductRowNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = firstProductRowNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","MODE_EDIT","MODE_SET","PRODUCT_TYPE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","selectorNames","storeFields","Object","keys","number","textContent","result","isArrayFilled","Runtime","clone","fieldName","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","innerHTML","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","selectorId","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","updateRowTotalPrice","getAmount","storeSelectors","selector","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","amount","amounts","getStoreReserved","getStoreAvailableAmount","postfix","call","wrapper","updateUiInputField","measure","isEmpty","SYMBOL","showSaveNotifier","title","Loc","getMessage","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","inputBlock","getInputByFieldName","parentNode","undefined","Reflection","getClass","BX","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","moneyFields","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","trim","getBasePrice","errorsList","isReadOnly","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","URL_BUILDER_CONTEXT","ProductSelector","mainInfoNode","numberSelector","appendChild","selectorWrapper","renderTo","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","ENABLE_SKU_TREE","scannerToken","barcodeWrapper","fieldNames","rowName","inputFieldId","inputFieldTitle","storeWrapper","data","getData","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","validatorCallback","fieldInput","fieldWrapper","getInputWrapperByFieldName","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","Boolean","unbind","remove","amountValue","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","input","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","options","UI","Notification","Center","notify","stack","width","autoHideDelay","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","getScrollContainer","window","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleProductListFocus","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onFocusToProductList","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","productId","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","listHaveEmptyRows","isEmptyRow","focusProductSelector","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","Error","gridManager","getInstanceById","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","ID","IMAGE_INFO","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","a","b","removeSpotlight","removeQrAuth","errorsArray","concat","validate","addictedFields","firstProductRowNode","processFieldTour","getActiveHint","_clickOnRowActionsButton","hasErrors"],"mappings":"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"}