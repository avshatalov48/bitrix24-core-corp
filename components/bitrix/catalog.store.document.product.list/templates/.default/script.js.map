{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/access.denied.input.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Tag, Loc} from 'main.core';\n\nexport class AccessDeniedInput\n{\n\thint: string;\n\ttext: string;\n\tisReadOnly: boolean;\n\n\tconstructor(options)\n\t{\n\t\tthis.text = options.text || Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT');\n\t\tthis.hint = options.hint;\n\t\tthis.isReadOnly = options.isReadOnly === true;\n\t}\n\n\trenderTo(node: Element): void\n\t{\n\t\tconst className =\n\t\t\tthis.isReadOnly\n\t\t\t\t? 'ui-ctl-no-border catalog-document-product-list-access-denied-readonly'\n\t\t\t\t: 'ui-ctl-disabled catalog-document-product-list-access-denied'\n\t\t;\n\t\tconst block = Tag.render`\n\t\t<div\n\t\t\tclass=\"ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ${className}\"\n\t\t\tdata-hint=\"${this.hint}\"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class=\"ui-ctl-before catalog-document-product-list-access-denied-lock\"></div>\n\t\t\t<div class=\"ui-ctl-after catalog-document-product-list-access-denied-hint\"></div>\n\t\t\t<div class=\"ui-ctl-element\">${this.text}</div>\n\t\t</div>\n\t\t`;\n\n\t\tnode.innerHTML = '';\n\t\tnode.appendChild(block);\n\n\t\tBX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 100,\n\t\t\t\t},\n\t\t\t},\n\t\t}).init();\n\t}\n}\n","import { ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type } from 'main.core';\nimport { Editor } from './product.list.editor';\nimport { CurrencyCore } from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport { ProductModel } from 'catalog.product-model';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { ProductSelector } from 'catalog.product-selector';\nimport { StoreSelector } from 'catalog.store-selector';\nimport { PopupMenu } from 'main.popup';\nimport { PriceCalculator } from './price.calculator';\nimport { AccessDeniedInput } from './access.denied.input';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\n\tvalidatingFields: Map<string, boolean> = new Map();\n\trealValues: ?Array;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\tthis.#initSimpleFields();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\tthis.#hideFields();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector(`[data-id=\"${rowId}\"]`);\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\t// eslint-disable-next-line no-prototype-builtins\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(node, 'blur', editor.blurProductFieldHandler);\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll(`[data-name=\"${name}\"] input[type=\"text\"]`).forEach((node) => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.getField('EDITABLE') === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.debouncedPurchasingPriceCalculation = Runtime.debounce(this.calculateStoreCostPrice, 500, this);\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: `${this.getId()}_actions_popup`,\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector(`catalog_document_grid_${this.getId()}`, selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<div class=\"main-grid-row-number\"></div>`, mainInfoNode);\n\t\t\t}\n\n\t\t\tlet selectorWrapper = mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`;\n\t\t\t\tDom.append(selectorWrapper, mainInfoNode);\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this),\n\t\t);\n\t}\n\n\t#initSimpleFields()\n\t{\n\t\tconst fields = [\n\t\t\t'COMMENT',\n\t\t];\n\n\t\tfor (const name of fields)\n\t\t{\n\t\t\tconst input = this.getNode().querySelector(`[name=\"${name}\"]`);\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tconst value = this.getField(name);\n\t\t\t\tinput.value = Type.isNil(value) ? '' : value;\n\t\t\t}\n\t\t}\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo', true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth', true),\n\t\t\t\tIS_INSTALLED_MOBILE_APP: this.editor.getSettingValue('isInstalledMobileApp', null),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector(`catalog_document_grid_${this.getId()}_barcode`, selectorOptions);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeScannerInstallChecked',\n\t\t\tthis.#handleBarcodeScannerInstallCheck.bind(this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeChange',\n\t\t\tthis.#handleBarcodeChange.bind(this),\n\t\t);\n\n\t\tthis.layoutBarcode();\n\t}\n\n\tlayoutBarcode(): void\n\t{\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (this.barcodeSelector && barcodeWrapper)\n\t\t{\n\t\t\tbarcodeWrapper.innerHTML = '';\n\n\t\t\tif (this.#needBarcode())\n\t\t\t{\n\t\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\tDom.remove(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue = this.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: `${this.getId()}_extra_type_popup`,\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(extraNode, node);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach((rowName) => {\n\t\t\tconst selectorOptions = {\n\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\tinputFieldTitle: `${fieldNames[rowName]}_TITLE`,\n\t\t\t\tisDisabledEmpty: true,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t};\n\n\t\t\tconst storeSelector = new StoreSelector(`${this.getId()}_${rowName}`, selectorOptions);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onChange',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this),\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onClear',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this),\n\t\t\t);\n\n\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t});\n\n\t\tthis.layoutStoreSelector(fieldNames);\n\t}\n\n\tlayoutStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach((rowName) => {\n\t\t\tconst selectorId = `${this.getId()}_${rowName}`;\n\n\t\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\t\tif (selector.getId() === selectorId)\n\t\t\t\t{\n\t\t\t\t\tconst storeWrapper = this.getNode().querySelector(`[data-name=\"${rowName}\"]`);\n\t\t\t\t\tif (storeWrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector.renderTo(storeWrapper);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach((node) => {\n\t\t\tnode.textContent = `${number}.`;\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (const fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\n\t\t// merge with real values\n\t\tconst realValues = this.#getRealValues();\n\t\tfor (const fieldName in realValues)\n\t\t{\n\t\t\tif (\n\t\t\t\tObject.hasOwnProperty.call(realValues, fieldName)\n\t\t\t\t&& Object.hasOwnProperty.call(result, fieldName)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult[fieldName] = realValues[fieldName];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Get real values field.\n\t *\n\t * Stores the real values of rows that are hidden due to lack of user access.\n\t *\n\t * @returns\n\t */\n\t#getRealValues()\n\t{\n\t\tif (this.realValues)\n\t\t{\n\t\t\treturn this.realValues;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst value = this.getField('REAL_VALUES');\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tconst parsedValue = JSON.parse(atob(value));\n\t\t\t\tif (Type.isPlainObject(parsedValue))\n\t\t\t\t{\n\t\t\t\t\tthis.realValues = parsedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(`Cannot parse REAL_VALUE: ${e.getMessage()}`);\n\t\t}\n\n\t\treturn this.realValues;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\tif (name !== 'REAL_VALUES')\n\t\t{\n\t\t\tconst realValues = this.#getRealValues();\n\t\t\tif (realValues && Object.hasOwnProperty.call(realValues, name))\n\t\t\t{\n\t\t\t\treturn realValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn `${this.getId()}_${field}`;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'COMMENT':\n\t\t\t\tthis.changeComment(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\t\t\t\tthis.#getCalculator()\n\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\t\t\t\tthis.#getCalculator()\n\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\t\tthis.addActionProductChange();\n\t\t\tif (this.getEditor().getSettingValue('isCalculableStorePurchasingPrice'))\n\t\t\t{\n\t\t\t\tthis.debouncedPurchasingPriceCalculation();\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeComment(value)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString().trim();\n\t\tif (preparedValue !== this.getField('COMMENT'))\n\t\t{\n\t\t\tthis.setField('COMMENT', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME'),\n\t\t);\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = `catalog_document_grid_${this.getId()}`;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields.IBLOCK_ID,\n\t\t\t\tbasePriceId: fields.BASE_PRICE_ID,\n\t\t\t\tskuTree: Type.isStringFilled(fields.SKU_TREE) ? JSON.parse(fields.SKU_TREE) : null,\n\t\t\t\tstoreMap: fields.STORE_AMOUNT_MAP,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields.IMAGE_INFO.preview);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields.IMAGE_INFO.input);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields.IMAGE_INFO.values);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields.DETAIL_URL))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields.DETAIL_URL);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this),\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (\n\t\t\t\tcode === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT\n\t\t\t\t|| code === StoreSelector.ErrorCodes.NOT_SELECTED_STORE\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst { model } = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\t#handleBarcodeScannerInstallCheck(event: BaseEvent): void\n\t{\n\t\tthis.editor.enableSendBarcodeMobilePush();\n\t}\n\n\t#handleBarcodeChange(event: BaseEvent): void\n\t{\n\t\tconst { value } = event.getData();\n\t\tthis.changeBarcode(value, MODE_EDIT);\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.#hidePurchasingPrice();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tupdateRowTotalPrice()\n\t{\n\t\tconst field = this.getEditor().getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tlet value = this.getAmount() * this.getField(field, 0);\n\t\tvalue = Math.max(value, 0);\n\n\t\tthis.setField('TOTAL_PRICE', value);\n\t\tthis.updateUiField('TOTAL_PRICE', value.toFixed(this.getPricePrecision()));\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(`${this.getId()}_${key}`);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName);\n\t\t});\n\n\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\tif (!this.model.getStoreCollection().isInited())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t_AMOUNT: () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t_RESERVED: () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t_AVAILABLE_AMOUNT: () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts)\n\t\t\t{\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix))\n\t\t\t\t{\n\t\t\t\t\tconst wrapper = this.#getNodeChildByDataName(fieldName + postfix);\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\twrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\n\t\t\t\t\t\t\tconst amountWithMeasure = `${amount} ${Text.encode(this.getField('MEASURE_NAME'))}`;\n\t\t\t\t\t\t\tlet htmlAmount = amountWithMeasure;\n\n\t\t\t\t\t\t\tif (postfix === '_AVAILABLE_AMOUNT')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtmlAmount = amount > 0\n\t\t\t\t\t\t\t\t\t? amountWithMeasure\n\t\t\t\t\t\t\t\t\t: `<span class=\"text--danger\">${amountWithMeasure}</span>`\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\twrapper.innerHTML = htmlAmount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.updateRowTotalPrice();\n\n\t\t\tif (this.getEditor().getSettingValue('isCalculableStorePurchasingPrice'))\n\t\t\t{\n\t\t\t\tthis.debouncedPurchasingPriceCalculation();\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculateStoreCostPrice()\n\t{\n\t\tif (this.isEmptyRow())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runComponentAction(\n\t\t\tthis.editor.getComponentName(),\n\t\t\t'calculateStoreCostPrice',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.editor.getSignedParameters(),\n\t\t\t\tdata: {\n\t\t\t\t\tproductId: this.getField('SKU_ID'),\n\t\t\t\t\tquantity: this.getField('AMOUNT'),\n\t\t\t\t\tstoreId: this.getField('STORE_FROM'),\n\t\t\t\t\tcurrency: this.editor.getCurrencyId(),\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then(\n\t\t\t\t(result) => {\n\t\t\t\t\tthis.setPurchasingPrice(result.data);\n\t\t\t\t},\n\t\t\t);\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t`measureChanger_${this.getId()}`,\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME'),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME'),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector(`[name=\"${fieldId}\"]`);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(`${this.getId()}_${name}_control`);\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector(`[data-value=\"${value}\"]`);\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name),\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = `${this.getEditor().getCurrencyId()}`;\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), '.', '');\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\tcase 'TOTAL_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tconst moneyFields = ['BASE_PRICE', 'PURCHASING_PRICE', 'TOTAL_PRICE'];\n\t\tif (moneyFields.includes(field))\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn 'money';\n\t\t\t}\n\n\t\t\treturn 'money_html';\n\t\t}\n\n\t\tif (field === 'AMOUNT')\n\t\t{\n\t\t\treturn 'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId(),\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal,\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (validatorCallback(eventObject.target.valueAsNumber))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#needInventory(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#needBarcode(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#isRowAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED') === true;\n\t}\n\n\t#hideFields()\n\t{\n\t\tif (!this.#isRowAccessDenied())\n\t\t{\n\t\t\tthis.#hidePurchasingPrice();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst hiddenFields = this.getEditor().getSettingValue('hiddenFields');\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\n\t\thiddenFields.forEach((fieldName) => {\n\t\t\tconst columnIndex = columnIndexes[fieldName];\n\t\t\tif (columnIndex === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getNode().querySelector(`.main-grid-cell:nth-child(${columnIndex + 1}) .main-grid-cell-content`);\n\t\t\tif (Type.isElementNode(item))\n\t\t\t{\n\t\t\t\titem.innerHTML = '';\n\t\t\t}\n\t\t});\n\n\t\tconst fieldWithHintIndex = columnIndexes.AMOUNT;\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex + 1}) .main-grid-cell-content`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT'),\n\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t});\n\t\t\t\tinput.renderTo(fieldWithHintNode);\n\t\t\t}\n\t\t}\n\t}\n\n\t#isPurchasingPriceAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED_TO_PURCHASING_PRICE') === true;\n\t}\n\n\t#hidePurchasingPrice()\n\t{\n\t\tif (!this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\t\tconst fieldWithHintIndex = columnIndexes.PURCHASING_PRICE;\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex + 1})`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst priceNode = fieldWithHintNode.querySelector('.main-grid-editor-container');\n\t\t\t\tif (priceNode)\n\t\t\t\t{\n\t\t\t\t\tpriceNode.remove();\n\t\t\t\t}\n\n\t\t\t\tconst contentNode = fieldWithHintNode.querySelector('.main-grid-cell-content');\n\t\t\t\tif (contentNode)\n\t\t\t\t{\n\t\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT'),\n\t\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t\t});\n\t\t\t\t\tinput.renderTo(contentNode);\n\t\t\t\t\tcontentNode.style.display = 'block';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport {StoreSelector} from \"catalog.store-selector\";\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from \"ui.tour\";\nimport {UI} from 'ui.notification';\nimport \"ui.hint\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nconst isEmptyObject = function(obj): boolean\n{\n\tif (!Type.isPlainObject(obj))\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const key in obj)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tblurProductFieldHandler = this.handleFieldBlur.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.catalog-document-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (this.getSettingValue('enabledCreateProductButton', true))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ROW_ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (\n\t\t\t\t!current.isHeadChild()\n\t\t\t\t&& !current.isTemplate()\n\t\t\t\t&& !isEmptyObject(current.getEditData())\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tisSalesOrdersDocument(): boolean\n\t{\n\t\tconst salesOrdersDocumentTypeCodes = ['REALIZATION', 'W'];\n\n\t\treturn salesOrdersDocumentTypeCodes.includes(this.settings.documentType);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\tconst totalsList = ['totalCost'];\n\t\t\ttotalBlock.querySelectorAll('.catalog-document-product-list-result-grid-total').forEach((row) => {\n\t\t\t\tfor (const totalId of totalsList)\n\t\t\t\t{\n\t\t\t\t\tconst valueElement = row.querySelector('[data-total=\"' + totalId + '\"]');\n\t\t\t\t\tif (valueElement)\n\t\t\t\t\t{\n\t\t\t\t\t\trow.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tgetGridColumnIndexes()\n\t{\n\t\treturn this.cache.remember('getGridColumnIndexes', () => {\n\t\t\tlet result = {};\n\n\t\t\tconst columns = this.getGrid().getHead().querySelectorAll('.main-grid-cell-head');\n\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\tconst node = columns[i];\n\t\t\t\tconst columnName = node.dataset.name;\n\n\t\t\t\tif (columnName)\n\t\t\t\t{\n\t\t\t\t\tresult[columnName] = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleFieldBlur(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tconst value = event.target.value;\n\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\tif (!Type.isStringFilled(fieldCode))\n\t\t{\n\t\t\tconst cell = event.target.closest('td');\n\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t}\n\n\t\tif (this.isSalesOrdersDocument() && fieldCode === 'AMOUNT' && value <= 0)\n\t\t{\n\t\t\tevent.target.value = 1;\n\t\t\tthis.handleFieldChange(event);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\twidth: 'auto',\n\t\t\t\tcontent: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_REALIZATION'),\n\t\t\t});\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (Type.isNil(anchorProduct) && this.products.length > 0)\n\t\t{\n\t\t\tconst previousRow =\n\t\t\t\tthis.getSettingValue('newRowPosition') === 'bottom'\n\t\t\t\t\t? this.products[this.products.length - 1]\n\t\t\t\t\t: this.products[0]\n\t\t\t;\n\t\t\tconst stores = this.getSettingValue('stores', {});\n\t\t\tconst storeFields = previousRow.getSettingValue('storeHeaderMap', {});\n\t\t\tObject.values(storeFields).forEach((field) => {\n\t\t\t\tconst previousStoreValue = previousRow.getField(field);\n\t\t\t\tif (Type.isNil(stores[previousStoreValue]))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfields[field] = previousRow.getField(field);\n\t\t\t\tconst titleName = field + '_TITLE';\n\t\t\t\tfields[titleName] = previousRow.getField(titleName);\n\t\t\t});\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.layoutStoreSelector(productRow.getSettingValue('storeHeaderMap', {}));\n\t\t\tproductRow.layoutBarcode();\n\t\t\tproductRow.executeExternalActions();\n\n\t\t\tif (this.isSalesOrdersDocument())\n\t\t\t{\n\t\t\t\tproductRow.changeAmount(productRow.getAmount() > 0 ? productRow.getAmount() : 1);\n\t\t\t}\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'SKU_ID',\n\t\t\t'AMOUNT',\n\t\t\t'PURCHASING_PRICE',\n\t\t\t'BASE_PRICE',\n\t\t\t'BASE_PRICE_EXTRA',\n\t\t\t'BASE_PRICE_EXTRA_RATE',\n\t\t\t'COMMENT',\n\t\t\t'DOC_BARCODE',\n\t\t\t'BARCODE',\n\t\t\t'STORE_TO',\n\t\t\t'STORE_FROM',\n\t\t\t'BASE_PRICE_ID',\n\t\t\t'BASKET_ID',\n\t\t\t'DOC_ID',\n\t\t\t'ELEMENT_ID',\n\t\t\t'IBLOCK_ID',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'NAME',\n\t\t\t'OFFERS_IBLOCK_ID',\n\t\t\t'PARENT_PRODUCT_ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'ROW_ID',\n\t\t\t'STORE_FROM_AMOUNT',\n\t\t\t'STORE_FROM_AVAILABLE_AMOUNT',\n\t\t\t'STORE_FROM_RESERVED',\n\t\t\t'STORE_FROM_TITLE',\n\t\t\t'STORE_TO_AMOUNT',\n\t\t\t'STORE_TO_AVAILABLE_AMOUNT',\n\t\t\t'STORE_TO_RESERVED',\n\t\t\t'STORE_TO_TITLE',\n\t\t\t'TOTAL_PRICE',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tenableSendBarcodeMobilePush(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.setConfig('IS_INSTALLED_MOBILE_APP', true);\n\t\t})\n\n\t\tthis.setSettingValue('isInstalledMobileApp', true);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n\n\tprocessApplyActionButtonClick(actionId: string): void\n\t{\n\t\tif (actionId === 'STORE_FROM_INFO' || actionId === 'STORE_TO_INFO')\n\t\t{\n\t\t\tthis.#processSetStoryAction(actionId);\n\t\t}\n\t}\n\n\t#processSetStoryAction(actionId)\n\t{\n\t\tconst actionPanel = this.getGrid()?.getActionsPanel();\n\t\tconst actionValues = actionPanel?.getValues();\n\t\tconst actionStoreId = actionValues[actionId];\n\t\tif (!actionValues || Type.isUndefined(actionStoreId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedRows  = this.getGrid().getRows().getSelected();\n\t\tif (selectedRows.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst stores = this.getSettingValue('stores', {});\n\t\tconst actionStore = stores[actionStoreId];\n\t\tif (!Type.isNil(actionStore))\n\t\t{\n\t\t\tconst actionStoreName = actionStore?.TITLE || '';\n\n\t\t\tselectedRows.forEach((row) => {\n\t\t\t\tconst selectedItem = this.products.find(product => product.getField('ID') === row.getId());\n\t\t\t\tif (selectedItem)\n\t\t\t\t{\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(selectedItem.getId() + '_' + actionId);\n\t\t\t\t\tif (storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(actionStoreId, actionStoreName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst documentTypeMoving = 'M';\n\t\t\tconst messageId =\n\t\t\t\tthis.settings.documentType !== documentTypeMoving\n\t\t\t\t\t? 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_STORE_CHANGED_HINT'\n\t\t\t\t\t: 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_' + actionId + '_CHANGED_HINT'\n\t\t\t;\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage(messageId, {'#STORE_NAME#': Text.encode(actionStoreName)}),\n\t\t\t\tautoHide: true,\n\t\t\t\tautoHideDelay: 4000,\n\t\t\t});\n\t\t}\n\n\t\tconst dropdown = actionPanel.getDropdowns().find(dropdown => dropdown.id === 'actionListId_control');\n\t\tif (dropdown)\n\t\t{\n\t\t\tactionPanel.removeItemsRelativeCurrent(dropdown.parentNode);\n\t\t\tDom.attr(dropdown, 'data-value', null);\n\t\t\tconst innerWrapper = dropdown.querySelector('.main-dropdown-inner');\n\t\t\tif (innerWrapper)\n\t\t\t{\n\t\t\t\tinnerWrapper.innerText = Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_DEFAULT');\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","AccessDeniedInput","options","Loc","getMessage","hint","isReadOnly","className","block","innerHTML","appendChild","BX","UI","Hint","createInstance","popupParameters","angle","offset","init","MODE_EDIT","MODE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","blurProductFieldHandler","selectorNames","storeFields","Object","keys","barcodeWrapper","renderTo","fieldNames","rowName","selectorId","storeSelectors","selector","storeWrapper","number","textContent","result","isArrayFilled","fieldName","Runtime","clone","realValues","call","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","changeComment","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","layoutStoreSelector","debouncedPurchasingPriceCalculation","trim","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","model","ProductModel","getById","currency","getCurrencyId","iblockId","IBLOCK_ID","basePriceId","BASE_PRICE_ID","skuTree","isStringFilled","SKU_TREE","JSON","parse","storeMap","STORE_AMOUNT_MAP","isObject","IMAGE_INFO","getImageCollection","setPreview","preview","setEditInput","input","setMorePhotoValues","values","DETAIL_URL","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","updateRowTotalPrice","getAmount","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","isInited","amount","amounts","_AMOUNT","_RESERVED","getStoreReserved","_AVAILABLE_AMOUNT","getStoreAvailableAmount","postfix","wrapper","amountWithMeasure","htmlAmount","updateUiInputField","isEmptyRow","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","data","productId","quantity","storeId","then","measure","isEmpty","SYMBOL","showSaveNotifier","title","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","inputBlock","getInputByFieldName","parentNode","undefined","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","moneyFields","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","getBasePrice","errorsList","calculateStoreCostPrice","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","URL_BUILDER_CONTEXT","ProductSelector","mainInfoNode","numberSelector","selectorWrapper","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","IS_INSTALLED_MOBILE_APP","ENABLE_SKU_TREE","scannerToken","layoutBarcode","inputFieldId","inputFieldTitle","isDisabledEmpty","getData","parsedValue","atob","e","console","error","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","NOT_SELECTED_STORE","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","enableSendBarcodeMobilePush","validatorCallback","fieldInput","fieldWrapper","getInputWrapperByFieldName","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","unbind","remove","amountValue","isService","hiddenFields","columnIndexes","getGridColumnIndexes","columnIndex","fieldWithHintIndex","fieldWithHintNode","PURCHASING_PRICE","priceNode","contentNode","style","display","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","position","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","selected","currentHeaders","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","Notification","Center","notify","stack","width","autoHideDelay","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","getScrollContainer","window","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","isEmptyObject","obj","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleProductListFocus","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","handleFieldBlur","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","buttonBlock","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onFocusToProductList","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","listHaveEmptyRows","focusProductSelector","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","getEditData","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","salesOrdersDocumentTypeCodes","documentType","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","totalsList","row","totalId","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","Error","gridManager","getInstanceById","getHead","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","isSalesOrdersDocument","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","previousRow","stores","previousStoreValue","titleName","ID","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","a","b","removeSpotlight","removeQrAuth","errorsArray","concat","validate","addictedFields","productNode","processFieldTour","getActiveHint","actionId","_clickOnRowActionsButton","hasErrors","actionPanel","getActionsPanel","actionValues","getValues","actionStoreId","isUndefined","selectedRows","getSelected","actionStore","actionStoreName","TITLE","selectedItem","documentTypeMoving","messageId","getDropdowns","removeItemsRelativeCurrent","innerWrapper","innerText"],"mappings":"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"}