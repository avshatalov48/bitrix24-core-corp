this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,t,r,a,n){"use strict";var s=function(){function e(r){babelHelpers.classCallCheck(this,e);this.groupId=t.Type.isNumber(r.groupId)?parseInt(r.groupId,10):0;this.selectorContainer=r.selectorContainer;this.infoContainer=r.infoContainer;this.currentSprint=r.currentSprint;this.sidePanelManager=BX.SidePanel.Instance;this.chart=null}babelHelpers.createClass(e,[{key:"render",value:function e(t,r){var a=this;this.renderSelectorTo(this.selectorContainer);setTimeout((function(){return a.create(t,r)}),300)}},{key:"renderSelectorTo",value:function e(r){var a=this;if(!t.Type.isElementNode(r)){return}this.selectorButton=new n.Button({text:this.currentSprint.dateStartFormatted+" - "+this.currentSprint.dateEndFormatted,color:n.Button.Color.LIGHT_BORDER,dropdown:true,className:"ui-btn-themes",onclick:function e(){var t=a.createSelectorDialog(a.selectorButton.getContainer(),a.currentSprint);t.show()}});this.selectorButton.renderTo(r)}},{key:"createSelectorDialog",value:function e(t,r){var n=this;return new a.Dialog({targetNode:t,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",r.id]],entities:[{id:"sprint-selector",options:{groupId:this.groupId},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function e(t){var r=t.getData(),a=r.item;n.selectorButton.setText(a.customData.get("label"));n.changeChart(a.getId())}}})}},{key:"changeChart",value:function e(r){var a=this;t.ajax.runComponentAction("bitrix:tasks.scrum.burn.down","changeChart",{mode:"class",data:{groupId:this.groupId,sprintId:r}}).then((function(e){a.chart.data=e.data.chart;a.currentSprint=e.data.sprint;a.infoContainer.querySelector(".tasks-scrum-sprint-burn-down-info-name").textContent=t.Text.encode(a.currentSprint.name)}))}},{key:"create",value:function e(t,r){window.am4core.useTheme(am4themes_animated);this.chart=window.am4core.create(t,am4charts.XYChart);this.chart.data=r;this.chart.paddingRight=40;this.createAxises();this.createIdealLine();this.createRemainLine();this.createLegend()}},{key:"createAxises",value:function e(){var t=this.chart.xAxes.push(new am4charts.CategoryAxis);t.renderer.grid.template.location=0;t.dataFields.category="day";t.renderer.minGridDistance=60;var r=this.chart.yAxes.push(new am4charts.ValueAxis);r.min=-.1}},{key:"createIdealLine",value:function e(){var r=this.chart.series.push(new am4charts.LineSeries);r.name=t.Loc.getMessage("TASKS_SCRUM_SPRINT_IDEAL_BURN_DOWN_CHART_LINE_LABEL");r.stroke=window.am4core.color("#2882b3");r.strokeWidth=2;r.dataFields.categoryX="day";r.dataFields.valueY="idealValue";var a="#2882b3";var n=new am4charts.CircleBullet;n.circle.radius=4;n.circle.fill=window.am4core.color(a);n.circle.stroke=window.am4core.color(a);r.bullets.push(n);var s=r.segments.template;var i=s.states.create("hover");i.properties.strokeWidth=4}},{key:"createRemainLine",value:function e(){var r=this.chart.series.push(new am4charts.LineSeries);r.name=t.Loc.getMessage("TASKS_SCRUM_SPRINT_REMAIN_BURN_DOWN_CHART_LINE_LABEL");r.stroke=window.am4core.color("#9c1f1f");r.strokeWidth=2;r.dataFields.categoryX="day";r.dataFields.valueY="remainValue";var a="#9c1f1f";var n=new am4charts.CircleBullet;n.circle.radius=4;n.circle.fill=window.am4core.color(a);n.circle.stroke=window.am4core.color(a);r.bullets.push(n);var s=r.segments.template;var i=s.states.create("hover");i.properties.strokeWidth=4}},{key:"createLegend",value:function e(){var t=this;this.chart.legend=new am4charts.Legend;this.chart.legend.itemContainers.template.clickable=false;this.chart.legend.position="bottom";this.chart.legend.itemContainers.template.events.on("over",(function(e){t.processOver(e.target.dataItem.dataContext)}));this.chart.legend.itemContainers.template.events.on("out",(function(){return t.processOut()}))}},{key:"processOver",value:function e(t){t.toFront();t.segments.each((function(e){return e.setState("hover")}))}},{key:"processOut",value:function e(){this.chart.series.each((function(e){e.segments.each((function(e){return e.setState("default")}));e.bulletsContainer.setState("default")}))}}]);return e}();e.BurnDownChart=s})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Event,BX.UI.EntitySelector,BX.UI);
//# sourceMappingURL=script.map.js