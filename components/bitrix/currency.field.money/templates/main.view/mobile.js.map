{"version":3,"file":"mobile.js","sources":["src/mobile.js"],"sourcesContent":["import {Loc} from 'main.core';\n\nlet\n\tBX = window.BX,\n\tBXMobileApp = window.BXMobileApp;\n\nlet nodeMoney = (function ()\n{\n\tlet nodeMoney = function (node, containerValue, containerCurrency)\n\t{\n\t\tthis.node = node;\n\n\t\tthis.containerValue = containerValue;\n\t\tthis.clickValue = BX.delegate(this.clickValue, this);\n\t\tBX.bind(this.containerValue, \"click\", this.clickValue);\n\t\tthis.callbackValue = BX.delegate(this.callbackValue, this);\n\n\t\tthis.containerCurrency = containerCurrency;\n\t\tthis.clickCurrency = BX.delegate(this.clickCurrency, this);\n\t\tBX.bind(this.containerCurrency, \"click\", this.clickCurrency);\n\t\tthis.callbackCurrency = BX.delegate(this.callbackCurrency, this);\n\n\t\tthis.nodeValue = BX(containerValue);\n\t\tthis.nodeCurrency = BX(containerCurrency);\n\t};\n\tnodeMoney.prototype = {\n\t\tclickValue: function (e)\n\t\t{\n\t\t\tthis.showValue();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshowValue: function ()\n\t\t{\n\t\t\twindow.app.exec('showPostForm', {\n\t\t\t\tattachButton: {\n\t\t\t\t\titems: []\n\t\t\t\t},\n\t\t\t\tattachFileSettings: {},\n\t\t\t\tattachedFiles: [],\n\t\t\t\textraData: {},\n\t\t\t\tmentionButton: {},\n\t\t\t\tsmileButton: {},\n\t\t\t\tmessage: {\n\t\t\t\t\ttext: BX.util.htmlspecialcharsback(this.nodeValue.previousElementSibling.value)\n\t\t\t\t},\n\t\t\t\tokButton: {\n\t\t\t\t\tcallback: this.callbackValue,\n\t\t\t\t\tname: Loc.getMessage('interface_form_save')\n\t\t\t\t},\n\t\t\t\tcancelButton: {\n\t\t\t\t\tcallback: function ()\n\t\t\t\t\t{\n\t\t\t\t\t},\n\t\t\t\t\tname: Loc.getMessage('interface_form_cancel')\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcallbackValue: function (data)\n\t\t{\n\t\t\tdata.text = (BX.util.htmlspecialchars(data.text) || '');\n\t\t\tthis.containerValue.previousElementSibling.value = data.text;\n\t\t\tif (data.text == '')\n\t\t\t{\n\t\t\t\tthis.containerValue.innerHTML = `<span class=\"placeholder\">${this.node.getAttribute('placeholder')}</span>`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.containerValue.innerHTML = data.text;\n\t\t\t}\n\t\t\tthis.node.value = data.text + '|' + this.containerCurrency.previousElementSibling.value;\n\t\t\tBX.onCustomEvent(this, 'onChange', [this, this.node]);\n\t\t},\n\t\tclickCurrency: function (e)\n\t\t{\n\t\t\tthis.showCurrency();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshowCurrency: function ()\n\t\t{\n\t\t\tthis.initCurrencies();\n\t\t\tBXMobileApp.UI.SelectPicker.show({\n\t\t\t\tcallback: this.callbackCurrency,\n\t\t\t\tvalues: this.currencies,\n\t\t\t\tmultiselect: false,\n\t\t\t\tdefault_value: this.defaultCurrency\n\t\t\t});\n\t\t},\n\t\tcallbackCurrency: function(data){\n\t\t\tlet currency = data.values[0];\n\t\t\tlet value = this.containerValue.previousElementSibling.value;\n\t\t\tthis.containerCurrency.innerHTML = currency;\n\t\t\tthis.node.value = value + '|' + currency;\n\t\t\tBX.onCustomEvent(this, 'onChange', [this, this.node]);\n\t\t},\n\t\tinitCurrencies: function ()\n\t\t{\n\t\t\tthis.currencies = [];\n\t\t\tthis.defaultCurrency = [];\n\t\t\tfor (let ii = 0; ii < this.containerCurrency.previousElementSibling.options.length; ii++)\n\t\t\t{\n\t\t\t\tthis.currencies.push(this.containerCurrency.previousElementSibling.options[ii].innerHTML);\n\t\t\t\tif (this.containerCurrency.previousElementSibling.options[ii].hasAttribute('selected'))\n\t\t\t\t{\n\t\t\t\t\tthis.defaultCurrency.push(this.containerCurrency.previousElementSibling.options[ii].innerHTML);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n\treturn nodeMoney;\n})();\n\nwindow.app.exec('enableCaptureKeyboard', true);\n\nBX.Mobile.Field.Money = function (params)\n{\n\tthis.init(params);\n};\n\nBX.Mobile.Field.Money.prototype = {\n\t__proto__: BX.Mobile.Field.prototype,\n\tbindElement: function (node)\n\t{\n\t\tlet result = null;\n\t\tif (BX(node))\n\t\t{\n\t\t\tresult = new nodeMoney(node, BX(`${node.id}_value`), BX(`${node.id}_currency`));\n\t\t}\n\t\treturn result;\n\t}\n};"],"names":["BX","window","BXMobileApp","nodeMoney","node","containerValue","containerCurrency","clickValue","delegate","bind","callbackValue","clickCurrency","callbackCurrency","nodeValue","nodeCurrency","prototype","e","showValue","PreventDefault","app","exec","attachButton","items","attachFileSettings","attachedFiles","extraData","mentionButton","smileButton","message","text","util","htmlspecialcharsback","previousElementSibling","value","okButton","callback","name","Loc","getMessage","cancelButton","data","htmlspecialchars","innerHTML","getAttribute","onCustomEvent","showCurrency","initCurrencies","UI","SelectPicker","show","values","currencies","multiselect","default_value","defaultCurrency","currency","ii","options","length","push","hasAttribute","Mobile","Field","Money","params","init","__proto__","bindElement","result","id"],"mappings":";;;;;;CAEA,IACCA,EAAE,GAAGC,MAAM,CAACD,EADb;CAAA,IAECE,WAAW,GAAGD,MAAM,CAACC,WAFtB;;CAIA,IAAIC,SAAS,GAAI,YACjB;CACC,MAAIA,SAAS,GAAG,SAAZA,SAAY,CAAUC,IAAV,EAAgBC,cAAhB,EAAgCC,iBAAhC,EAChB;CACC,SAAKF,IAAL,GAAYA,IAAZ;CAEA,SAAKC,cAAL,GAAsBA,cAAtB;CACA,SAAKE,UAAL,GAAkBP,EAAE,CAACQ,QAAH,CAAY,KAAKD,UAAjB,EAA6B,IAA7B,CAAlB;CACAP,IAAAA,EAAE,CAACS,IAAH,CAAQ,KAAKJ,cAAb,EAA6B,OAA7B,EAAsC,KAAKE,UAA3C;CACA,SAAKG,aAAL,GAAqBV,EAAE,CAACQ,QAAH,CAAY,KAAKE,aAAjB,EAAgC,IAAhC,CAArB;CAEA,SAAKJ,iBAAL,GAAyBA,iBAAzB;CACA,SAAKK,aAAL,GAAqBX,EAAE,CAACQ,QAAH,CAAY,KAAKG,aAAjB,EAAgC,IAAhC,CAArB;CACAX,IAAAA,EAAE,CAACS,IAAH,CAAQ,KAAKH,iBAAb,EAAgC,OAAhC,EAAyC,KAAKK,aAA9C;CACA,SAAKC,gBAAL,GAAwBZ,EAAE,CAACQ,QAAH,CAAY,KAAKI,gBAAjB,EAAmC,IAAnC,CAAxB;CAEA,SAAKC,SAAL,GAAiBb,EAAE,CAACK,cAAD,CAAnB;CACA,SAAKS,YAAL,GAAoBd,EAAE,CAACM,iBAAD,CAAtB;CACA,GAhBD;;CAiBAH,EAAAA,SAAS,CAACY,SAAV,GAAsB;CACrBR,IAAAA,UAAU,EAAE,oBAAUS,CAAV,EACZ;CACC,WAAKC,SAAL;CACA,aAAOjB,EAAE,CAACkB,cAAH,CAAkBF,CAAlB,CAAP;CACA,KALoB;CAMrBC,IAAAA,SAAS,EAAE,qBACX;CACChB,MAAAA,MAAM,CAACkB,GAAP,CAAWC,IAAX,CAAgB,cAAhB,EAAgC;CAC/BC,QAAAA,YAAY,EAAE;CACbC,UAAAA,KAAK,EAAE;CADM,SADiB;CAI/BC,QAAAA,kBAAkB,EAAE,EAJW;CAK/BC,QAAAA,aAAa,EAAE,EALgB;CAM/BC,QAAAA,SAAS,EAAE,EANoB;CAO/BC,QAAAA,aAAa,EAAE,EAPgB;CAQ/BC,QAAAA,WAAW,EAAE,EARkB;CAS/BC,QAAAA,OAAO,EAAE;CACRC,UAAAA,IAAI,EAAE7B,EAAE,CAAC8B,IAAH,CAAQC,oBAAR,CAA6B,KAAKlB,SAAL,CAAemB,sBAAf,CAAsCC,KAAnE;CADE,SATsB;CAY/BC,QAAAA,QAAQ,EAAE;CACTC,UAAAA,QAAQ,EAAE,KAAKzB,aADN;CAET0B,UAAAA,IAAI,EAAEC,aAAG,CAACC,UAAJ,CAAe,qBAAf;CAFG,SAZqB;CAgB/BC,QAAAA,YAAY,EAAE;CACbJ,UAAAA,QAAQ,EAAE,oBACV,EAFa;CAIbC,UAAAA,IAAI,EAAEC,aAAG,CAACC,UAAJ,CAAe,uBAAf;CAJO;CAhBiB,OAAhC;CAuBA,KA/BoB;CAgCrB5B,IAAAA,aAAa,EAAE,uBAAU8B,IAAV,EACf;CACCA,MAAAA,IAAI,CAACX,IAAL,GAAa7B,EAAE,CAAC8B,IAAH,CAAQW,gBAAR,CAAyBD,IAAI,CAACX,IAA9B,KAAuC,EAApD;CACA,WAAKxB,cAAL,CAAoB2B,sBAApB,CAA2CC,KAA3C,GAAmDO,IAAI,CAACX,IAAxD;;CACA,UAAIW,IAAI,CAACX,IAAL,IAAa,EAAjB,EACA;CACC,aAAKxB,cAAL,CAAoBqC,SAApB,yCAA6D,KAAKtC,IAAL,CAAUuC,YAAV,CAAuB,aAAvB,CAA7D;CACA,OAHD,MAKA;CACC,aAAKtC,cAAL,CAAoBqC,SAApB,GAAgCF,IAAI,CAACX,IAArC;CACA;;CACD,WAAKzB,IAAL,CAAU6B,KAAV,GAAkBO,IAAI,CAACX,IAAL,GAAY,GAAZ,GAAkB,KAAKvB,iBAAL,CAAuB0B,sBAAvB,CAA8CC,KAAlF;CACAjC,MAAAA,EAAE,CAAC4C,aAAH,CAAiB,IAAjB,EAAuB,UAAvB,EAAmC,CAAC,IAAD,EAAO,KAAKxC,IAAZ,CAAnC;CACA,KA9CoB;CA+CrBO,IAAAA,aAAa,EAAE,uBAAUK,CAAV,EACf;CACC,WAAK6B,YAAL;CACA,aAAO7C,EAAE,CAACkB,cAAH,CAAkBF,CAAlB,CAAP;CACA,KAnDoB;CAoDrB6B,IAAAA,YAAY,EAAE,wBACd;CACC,WAAKC,cAAL;CACA5C,MAAAA,WAAW,CAAC6C,EAAZ,CAAeC,YAAf,CAA4BC,IAA5B,CAAiC;CAChCd,QAAAA,QAAQ,EAAE,KAAKvB,gBADiB;CAEhCsC,QAAAA,MAAM,EAAE,KAAKC,UAFmB;CAGhCC,QAAAA,WAAW,EAAE,KAHmB;CAIhCC,QAAAA,aAAa,EAAE,KAAKC;CAJY,OAAjC;CAMA,KA7DoB;CA8DrB1C,IAAAA,gBAAgB,EAAE,0BAAS4B,IAAT,EAAc;CAC/B,UAAIe,QAAQ,GAAGf,IAAI,CAACU,MAAL,CAAY,CAAZ,CAAf;CACA,UAAIjB,KAAK,GAAG,KAAK5B,cAAL,CAAoB2B,sBAApB,CAA2CC,KAAvD;CACA,WAAK3B,iBAAL,CAAuBoC,SAAvB,GAAmCa,QAAnC;CACA,WAAKnD,IAAL,CAAU6B,KAAV,GAAkBA,KAAK,GAAG,GAAR,GAAcsB,QAAhC;CACAvD,MAAAA,EAAE,CAAC4C,aAAH,CAAiB,IAAjB,EAAuB,UAAvB,EAAmC,CAAC,IAAD,EAAO,KAAKxC,IAAZ,CAAnC;CACA,KApEoB;CAqErB0C,IAAAA,cAAc,EAAE,0BAChB;CACC,WAAKK,UAAL,GAAkB,EAAlB;CACA,WAAKG,eAAL,GAAuB,EAAvB;;CACA,WAAK,IAAIE,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG,KAAKlD,iBAAL,CAAuB0B,sBAAvB,CAA8CyB,OAA9C,CAAsDC,MAA5E,EAAoFF,EAAE,EAAtF,EACA;CACC,aAAKL,UAAL,CAAgBQ,IAAhB,CAAqB,KAAKrD,iBAAL,CAAuB0B,sBAAvB,CAA8CyB,OAA9C,CAAsDD,EAAtD,EAA0Dd,SAA/E;;CACA,YAAI,KAAKpC,iBAAL,CAAuB0B,sBAAvB,CAA8CyB,OAA9C,CAAsDD,EAAtD,EAA0DI,YAA1D,CAAuE,UAAvE,CAAJ,EACA;CACC,eAAKN,eAAL,CAAqBK,IAArB,CAA0B,KAAKrD,iBAAL,CAAuB0B,sBAAvB,CAA8CyB,OAA9C,CAAsDD,EAAtD,EAA0Dd,SAApF;CACA;CACD;CACD;CAjFoB,GAAtB;CAmFA,SAAOvC,SAAP;CACA,CAvGe,EAAhB;;CAyGAF,MAAM,CAACkB,GAAP,CAAWC,IAAX,CAAgB,uBAAhB,EAAyC,IAAzC;;CAEApB,EAAE,CAAC6D,MAAH,CAAUC,KAAV,CAAgBC,KAAhB,GAAwB,UAAUC,MAAV,EACxB;CACC,OAAKC,IAAL,CAAUD,MAAV;CACA,CAHD;;CAKAhE,EAAE,CAAC6D,MAAH,CAAUC,KAAV,CAAgBC,KAAhB,CAAsBhD,SAAtB,GAAkC;CACjCmD,EAAAA,SAAS,EAAElE,EAAE,CAAC6D,MAAH,CAAUC,KAAV,CAAgB/C,SADM;CAEjCoD,EAAAA,WAAW,EAAE,qBAAU/D,IAAV,EACb;CACC,QAAIgE,MAAM,GAAG,IAAb;;CACA,QAAIpE,EAAE,CAACI,IAAD,CAAN,EACA;CACCgE,MAAAA,MAAM,GAAG,IAAIjE,SAAJ,CAAcC,IAAd,EAAoBJ,EAAE,WAAII,IAAI,CAACiE,EAAT,YAAtB,EAA4CrE,EAAE,WAAII,IAAI,CAACiE,EAAT,eAA9C,CAAT;CACA;;CACD,WAAOD,MAAP;CACA;CAVgC,CAAlC;;;;"}