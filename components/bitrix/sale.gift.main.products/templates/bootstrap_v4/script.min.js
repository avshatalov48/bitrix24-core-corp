BX.namespace("BX.Sale");BX.Sale.GiftMainProductsClass=function(){var t=function(t){this.ajaxUrl="/bitrix/components/bitrix/sale.gift.main.products/ajax.php";this.contextAjaxData=t.contextAjaxData||{};this.mainProductState=t.mainProductState||null;this.injectId=t.injectId||null;this.isGift=!!t.isGift;this.productId=t.productId;this.offerId=t.offerId;this.offers=t.offers||[];this.setEvents();if(document.location.hash.match(/as_gift/g)){if(this.isGift){this.enableGift()}else{this.raiseNonGiftEvent()}}BX.bindDelegate(BX(this.injectId),"click",{tagName:"a"},BX.proxy(this.clickNavLink,this))};t.prototype.clickNavLink=function(t){if(this.onPageNavigationByLink(BX.proxy_context)){return BX.PreventDefault(t)}};t.prototype.setEvents=function(){BX.addCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this));BX.addCustomEvent("onAddToBasketMainProduct",BX.proxy(this.onAddToBasketMainProduct,this))};t.prototype.unsubscribeEvents=function(){BX.removeCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this))};t.prototype.onAddToBasketMainProduct=function(t){this.enableGift()};t.prototype.onCatalogStoreProductChange=function(t){if(t==this.offerId){return}BX.ajax({url:this.ajaxUrl,method:"POST",data:BX.merge(this.contextAjaxData,{offerId:t,mainProductState:this.mainProductState,SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:false,start:true,onsuccess:BX.delegate(function(e){this.offerId=t;var i=BX.processHTML(e);if(!i.HTML){if(document.location.hash.match(/as_gift/g)){if(this.isGift){this.raiseGiftEvent()}else{this.raiseNonGiftEvent()}}return}this.unsubscribeEvents();BX(this.injectId).innerHTML=i.HTML;BX.ajax.processScripts(i.SCRIPT)},this)})};t.prototype.onPageNavigationByLink=function(t){var e=BX.delegate(function(t){if(!BX.type.isElementNode(t)||!t.href){return false}if(t.href.indexOf(this.ajaxUrl)>=0){return true}return t.href.indexOf("PAGEN_")!==-1},this);if(!e(t)){return false}BX.ajax({url:t.href,method:"POST",data:BX.merge(this.contextAjaxData,{SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:false,start:true,onsuccess:BX.delegate(function(t){var e=BX.processHTML(t);if(!e.HTML){return}this.unsubscribeEvents();BX(this.injectId).innerHTML=e.HTML;BX.ajax.processScripts(e.SCRIPT)},this)});return true};t.prototype.enableGift=function(){this.isGift=true;this.raiseGiftEvent()};t.prototype.raiseGiftEvent=function(){BX.onCustomEvent("onSaleProductIsGift",[this.productId,this.offerId])};t.prototype.raiseNonGiftEvent=function(){BX.onCustomEvent("onSaleProductIsNotGift",[this.productId,this.offerId])};return t}();