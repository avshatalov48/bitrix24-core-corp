this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,a){"use strict";let t=e=>e,l;var i=babelHelpers.classPrivateFieldLooseKey("params");var o=babelHelpers.classPrivateFieldLooseKey("layout");var r=babelHelpers.classPrivateFieldLooseKey("copilotLoaded");var b=babelHelpers.classPrivateFieldLooseKey("copilotContextMenu");var n=babelHelpers.classPrivateFieldLooseKey("copilotShown");var c=babelHelpers.classPrivateFieldLooseKey("render");var d=babelHelpers.classPrivateFieldLooseKey("createCopilot");var v=babelHelpers.classPrivateFieldLooseKey("onButtonMouseDown");var p=babelHelpers.classPrivateFieldLooseKey("onButtonClick");var P=babelHelpers.classPrivateFieldLooseKey("show");var h=babelHelpers.classPrivateFieldLooseKey("getBindElement");var L=babelHelpers.classPrivateFieldLooseKey("hide");var B=babelHelpers.classPrivateFieldLooseKey("copyIntoComment");var u=babelHelpers.classPrivateFieldLooseKey("copyIntoNewTask");class H{constructor(e){Object.defineProperty(this,u,{value:K});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,h,{value:O});Object.defineProperty(this,P,{value:m});Object.defineProperty(this,p,{value:T});Object.defineProperty(this,v,{value:f});Object.defineProperty(this,d,{value:y});Object.defineProperty(this,c,{value:F});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e;babelHelpers.classPrivateFieldLooseBase(this,o)[o]={};if(babelHelpers.classPrivateFieldLooseBase(this,i)[i].enabledBySettings){void babelHelpers.classPrivateFieldLooseBase(this,d)[d]()}s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,c)[c](),babelHelpers.classPrivateFieldLooseBase(this,i)[i].container)}}function F(){babelHelpers.classPrivateFieldLooseBase(this,o)[o].button=s.Tag.render(l||(l=t`
			<span class="task-detail-extra-copilot-readonly">
				<a>${0}</a>
			</span>
		`),s.Loc.getMessage("TASKS_TASK_BUTTON_COPILOT"));s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,o)[o].button,"mousedown",babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this));s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,o)[o].button,"click",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this));return babelHelpers.classPrivateFieldLooseBase(this,o)[o].button}async function y(){const{CopilotContextMenu:e}=await s.Runtime.loadExtension("ai.copilot");const a={moduleId:babelHelpers.classPrivateFieldLooseBase(this,i)[i].copilotParams.moduleId,contextId:babelHelpers.classPrivateFieldLooseBase(this,i)[i].copilotParams.contextId,category:babelHelpers.classPrivateFieldLooseBase(this,i)[i].copilotParams.category,bindElement:babelHelpers.classPrivateFieldLooseBase(this,h)[h](),angle:true,extraResultMenuItems:[{code:"insert-into-comment",text:s.Loc.getMessage("TASKS_TASK_BUTTON_COPILOT_COPY_INTO_COMMENT"),command:()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getResultText();babelHelpers.classPrivateFieldLooseBase(this,b)[b].hide();babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)}},{code:"insert-into-new-task",text:s.Loc.getMessage("TASKS_TASK_BUTTON_COPILOT_COPY_INTO_NEW_TASK"),command:()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getResultText();babelHelpers.classPrivateFieldLooseBase(this,b)[b].hide();babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}}]};babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new e(a);try{await babelHelpers.classPrivateFieldLooseBase(this,b)[b].init();babelHelpers.classPrivateFieldLooseBase(this,r)[r]=true}catch(e){console.error("Failed to init copilot",e)}}function f(){var e;if(!babelHelpers.classPrivateFieldLooseBase(this,i)[i].enabledBySettings){return}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=(e=babelHelpers.classPrivateFieldLooseBase(this,b)[b])==null?void 0:e.isShown()}function T(){if(!babelHelpers.classPrivateFieldLooseBase(this,i)[i].enabledBySettings){BX.UI.InfoHelper.show("limit_copilot_off");return}if(babelHelpers.classPrivateFieldLooseBase(this,n)[n]){babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}else{babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}}function m(){if(babelHelpers.classPrivateFieldLooseBase(this,r)[r]){babelHelpers.classPrivateFieldLooseBase(this,b)[b].setContext(babelHelpers.classPrivateFieldLooseBase(this,i)[i].description);babelHelpers.classPrivateFieldLooseBase(this,b)[b].show({bindElement:babelHelpers.classPrivateFieldLooseBase(this,h)[h]()})}}function O(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o].button}function I(){babelHelpers.classPrivateFieldLooseBase(this,b)[b].hide()}function w(e){var s;const a=FCList.getInstance({ENTITY_XML_ID:babelHelpers.classPrivateFieldLooseBase(this,i)[i].taskId});const t=a.form;const l=LHEPostForm.getHandlerByFormId(a.form.formId);if((s=l.oEditor)!=null&&s.IsShown()){l.oEditor.action.Exec("insertHTML",e)}const o=()=>{l.oEditor.action.Exec("insertHTML",e);BX.removeCustomEvent(l.oEditor,"OnAfterIframeInit",o)};l.exec((()=>{BX.addCustomEvent(l.oEditor,"OnAfterIframeInit",o)}));t.show(a)}function K(e){BX.SidePanel.Instance.open(`${babelHelpers.classPrivateFieldLooseBase(this,i)[i].pathToTaskCreate}#${encodeURIComponent(e)}`)}e.TaskCopilotReadonly=H})(this.BX.Tasks.View=this.BX.Tasks.View||{},BX,BX.Event);
//# sourceMappingURL=script.map.js