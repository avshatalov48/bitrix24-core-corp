(function(){"use strict";BX.namespace("BX.SaleCenterPaySystem");BX.SaleCenterPaySystem={paySystem:null,paySystemApp:null,mode:"main",signedParameters:null,init:function(e){this.mode=e.mode;this.paySystemParams=e.paySystemParams;this.paySystemAppParams=e.paySystemAppParams;this.signedParameters=e.signedParameters;this.paySystem=new BX.TileGrid.Grid(this.paySystemParams);this.paySystem.draw();if(this.mode==="main"){this.paySystemApp=new BX.TileGrid.Grid(this.paySystemAppParams);this.paySystemApp.draw()}if(!top.window["adminSidePanel"]||!BX.is_subclass_of(top.window["adminSidePanel"],BX.adminSidePanel)){top.window["adminSidePanel"]=new BX.adminSidePanel({publicMode:true})}},reloadSlider:function(e){if(e.paySystemPanelParams){this.paySystem.redraw(e.paySystemPanelParams)}if(e.paySystemAppPanelParams&&this.mode==="main"){this.paySystemApp.redraw(e.paySystemAppPanelParams)}}};BX.SaleCenterPaySystem.TileGrid=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.itemSelected=e.itemSelected;this.itemSelectedColor=e.itemSelectedColor;this.itemSelectedImage=e.itemSelectedImage;this.outerImage=e.outerImage||false;this.layout={container:null,image:null,title:null};this.data=e.data||{}};BX.SaleCenterPaySystem.TileGrid.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){if(this.data.type==="counter"){return this.getItemCounter()}if(!this.layout.wrapper){this.layout.wrapper=BX.create("div",{props:{className:"salescenter-paysystem-item"},children:[BX.create("div",{props:{className:"salescenter-paysystem-item-content"},children:[this.getImage(),this.getTitle(),this.getStatus(),this.getLabel()]})],events:{click:function(){this.onClick()}.bind(this)}})}if(this.itemSelected||this.data.type==="actionbox"){this.setSelected()}return this.layout.wrapper},getImage:function(){if(!this.layout.image){var e=BX.create("div",{props:{className:"salescenter-paysystem-item-image"},style:{top:this.data.recommendation?"25px":null,backgroundSize:this.outerImage?"50px":"",backgroundImage:this.image?'url("'+encodeURI(this.image)+'")':null}});if(this.data.type==="marketplaceApp"&&this.data.hasOwnIcon){e.style.backgroundSize="35% auto"}this.layout.image=e}return this.layout.image},getStatus:function(){if(!this.itemSelected)return;this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-paysystem-item-status-selected"}});return this.layout.itemSelected},getLabel:function(){if(!this.data.recommendation)return;this.layout.itemLabel=BX.create("div",{props:{className:"salescenter-item-label"},children:[BX.create("div",{props:{className:"salescenter-item-label-text"},text:BX.message("SALESCENTER_CONTROL_PANEL_ITEM_LABEL_RECOMMENDATION")})]});return this.layout.itemLabel},setSelected:function(){BX.addClass(this.layout.wrapper,"salescenter-paysystem-item-selected");if(this.itemSelectedImage){this.layout.image.style.backgroundImage="url("+this.itemSelectedImage+")"}if(this.itemSelectedColor){this.layout.wrapper.style.backgroundColor=this.itemSelectedColor}},isDarkColor:function(e){if(typeof e==="string"&&e.substring(0,1)==="#"){e=e.substring(1)}if(!this.isValidColor(e)){return false}if(e.length===3){e=e.replace(/([a-f0-9])/gi,"$1$1")}e=e.toLowerCase();var t=parseInt(e,16);var a=t>>16&255;var i=t>>8&255;var s=t&255;var n=(a*299+i*587+s*114)/1e3;return n<200},isValidColor:function(e){return BX.type.isNotEmptyString(e)&&e.match(/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)},getTitle:function(){if(!this.layout.title){this.layout.title=BX.create("div",{props:{className:this.data.type==="marketplaceApp"?"salescenter-paysystem-marketplace-app-item-title":"salescenter-paysystem-item-title"},text:this.title});if(this.itemSelected&&this.itemSelectedColor){this.layout.title.style.color=this.isDarkColor(this.itemSelectedColor)?"#fff":"#525c69"}}return this.layout.title},getItemCounter:function(){return BX.create("div",{props:{className:"salescenter-paysystem-item salescenter-paysystem-integration-marketplace-tile-item salescenter-paysystem-integration-marketplace-tile-counter"},children:[BX.create("div",{props:{className:"salescenter-paysystem-integration-marketplace-tile-counter-head"},children:[BX.create("div",{props:{className:"salescenter-paysystem-integration-marketplace-tile-counter-name"},text:this.title}),BX.create("div",{props:{className:"salescenter-paysystem-integration-marketplace-tile-counter-value"},text:this.data.count})]}),BX.create("div",{props:{className:"salescenter-paysystem-integration-marketplace-tile-counter-link-box"},children:[BX.create("div",{props:{className:"salescenter-paysystem-integration-marketplace-tile-counter-link"},text:this.data.description})]})],events:{click:function(){this.onClick()}.bind(this)}})},openRestAppLayout:function(e,t){BX.ajax.runComponentAction("bitrix:salescenter.paysystem.panel","getRestApp",{data:{code:t}}).then(function(a){var i=a.data;if(i.TYPE==="A"){this.showRestApplication(t)}else{BX.rest.AppLayout.openApplication(e)}}.bind(this)).catch(function(e){this.restAppErrorPopup(" ",e.errors.pop().message)}.bind(this))},restAppErrorPopup:function(e,t){var a=new BX.PopupWindow("rest-app-error-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:e,content:t,zIndex:16e3,overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("SPP_SALESCENTER_JS_POPUP_CLOSE"),events:{click:function(){a.close()}}})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){a=null}}});a.show()},onClick:function(){if(this.data.type==="paysystem"){BX.Salescenter.Manager.addAnalyticAction({analyticsLabel:"salescenterClickPaymentTile",isConnected:this.itemSelected?"y":"n",type:this.data.paySystemType});var e={cacheable:false,allowChangeHistory:false,width:1e3,events:{onClose:this.reload.bind(this,BX.SaleCenterPaySystem.mode,BX.SaleCenterPaySystem.signedParameters)}};if(!this.itemSelected&&!this.data.showMenu){BX.SidePanel.Instance.open(this.data.connectPath,e)}else{this.showItemMenu(this,{sliderOptions:e})}}else if(this.data.type==="paysystem_extra"){var e={allowChangeHistory:false,events:{onClose:this.reload.bind(this,"main",BX.SaleCenterPaySystem.signedParameters)}};BX.SidePanel.Instance.open(this.data.connectPath,e)}else if(this.data.type==="counter"){BX.SidePanel.Instance.open(this.data.connectPath)}else if(this.data.type==="integration"){window.open(this.data.url)}else if(this.data.type==="marketplaceApp"){if(this.itemSelected){this.openRestAppLayout(this.id,this.data.code)}else{this.showRestApplication(this.data.code)}}else if(this.data.type==="actionbox"){if(this.data.handler==="anchor"){window.open(this.data.move)}else if(this.data.handler==="marketplace"){BX.rest.Marketplace.open({PLACEMENT:this.data.move})}else if(this.data.handler==="landing"){var t=this.data.move;BX.SidePanel.Instance.open("salecenter",{contentCallback:function(){return"<iframe src='"+t+"'"+" style='width: 100%; height:"+" -webkit-calc(100vh - 20px); height:"+" calc(100vh - 20px);'></iframe>"}})}}else if(this.data.type==="recommend"){BX.SidePanel.Instance.open(this.data.connectPath,{width:735})}},showItemMenu:function(e,t){var a=[],i,s=e.layout.container,n="salescenter-item-menu-"+BX.util.getRandomString(),o;e.sliderOptions={};if(t.sliderOptions){e.sliderOptions=t.sliderOptions}for(i in e.data.menuItems){if(e.data.menuItems.hasOwnProperty(i)){if(e.data.menuItems[i].DELIMITER){a.push({delimiter:true})}else{a.push({text:e.data.menuItems[i].NAME,link:e.data.menuItems[i].LINK,onclick:function(t,a){e.moreTabsMenu.close();BX.SidePanel.Instance.open(a.options.link,e.sliderOptions)}})}}}e.moreTabsMenu=BX.PopupMenu.create(n,s,a,{autoHide:true,offsetLeft:0,offsetTop:0,closeByEsc:true,events:{onPopupClose:function(){e.moreTabsMenu.popupWindow.destroy();BX.PopupMenu.destroy(n)},onPopupDestroy:function(){e.moreTabsMenu=null}}});e.moreTabsMenu.popupWindow.show()},reloadPage:function(){var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));var t=e?e.getWindow():top;if(t){t.window.location.reload()}},showRestApplication:function(e){var t="/marketplace/detail/#app#/";var a=t.replace("#app#",encodeURIComponent(e));BX.SidePanel.Instance.open(a,{allowChangeHistory:false,events:{onClose:this.reload.bind(this,"main",BX.SaleCenterPaySystem.signedParameters)}})},reload:function(e,t){BX.ajax.runComponentAction("bitrix:salescenter.paysystem.panel","getComponentResult",{mode:"ajax",data:{mode:e,signedParameters:t}}).then((function(e){BX.SaleCenterPaySystem.reloadSlider(e.data)}))}}})();
//# sourceMappingURL=script.map.js