(function(){var e=BX.namespace("BX.Crm.WebForm");function t(){}t.prototype={init:function(e){this.context=BX(e.containerId);this.themes=e.themes;this.picker=new BX.ColorPicker({popupOptions:{offsetLeft:15,offsetTop:5}});this.themeControl=this.context.querySelector('[name="design-virtual-theme"]');this.modeControls=BX.convert.nodeListToArray(this.context.querySelectorAll('[name="design-virtual-mode"]'));BX.bind(this.themeControl,"change",this.applyTheme.bind(this));this.modeControls.forEach(function(e){BX.bind(e,"change",this.applyTheme.bind(this))},this);this.colorControls=[];this.controls=BX.convert.nodeListToArray(this.context.querySelectorAll('[name^="DESIGN"]'));this.controls.forEach(function(e){if(e.type==="hidden"){if(e.dataset.color){this.colorControls.push(new i({node:e,picker:this.picker,handler:this.onChange.bind(this),defaultColor:function(){return this.getTheme().color[e.dataset.color]}.bind(this)}))}}else{BX.bind(e,"change",this.onChange.bind(this))}},this);var t=BX("design-more-fields");var o=BX("design-more-fields-btn");BX.bind(o,"click",function(){var e=t.style.display!=="none";t.style.display=e?"none":""});this.modifyB24Form()},modifyB24Form:function(){if(window.b24form&&window.b24form.App){if(window.b24form.App.list()[0]){window.b24form.App.list()[0].provider.submit=function(e){e.loading=false;return new Promise(function(){})};return}}setTimeout(this.modifyB24Form.bind(this),50)},getMode:function(){return this.context.querySelector('[name="design-virtual-mode"]:checked').value},getThemeCode:function(){return this.themeControl.value+"-"+(this.getMode()==="Y"?"dark":"light")},getTheme:function(){return this.themes[this.getThemeCode()]},applyTheme:function(){this.context.querySelector('[name="DESIGN[theme]"]').value=this.getThemeCode();this.applyThemeOptions(this.getTheme());this.colorControls.forEach(function(e){e.reload()});this.onChange()},applyThemeOptions:function(e,t){for(var i in e){if(!e.hasOwnProperty(i)){continue}var o=e[i];if(typeof o==="object"){this.applyThemeOptions(o,i)}else{var n="DESIGN["+(t?t+"][":"")+i+"]";this.controls.filter(function(e){return e.name===n},this).forEach(function(e){if(e.type==="radio"||e.type==="checkbox"){e.checked=e.value===o}else{e.value=o}},this)}}},onChange:function(){var e=this.controls.reduce(this.accumulateElementValue.bind(this),{});console.log("design",e);b24form.App.list()[0].adjust({design:e})},accumulateElementValue:function(e,t){var i=t.value;if(t.type==="radio"||t.type==="checkbox"){if(t.value==="Y"){i=t.checked?"Y":"N"}else if(!t.checked){return e}}var o=t.name.replace("DESIGN","").replace("][","|").replace(/[\]\[]/g,"").split("|");var n=o[1];o=o[0];i=i==="Y"?true:i==="N"?false:i;if(n){if(o==="color"&&!i){return e}e[o]=e[o]?e[o]:{};e[o][n]=i}else{e[o]=i}return e}};function i(e){this.node=e.node;this.picker=e.picker;this.handler=e.handler;this.defaultColor=e.defaultColor;this.circleNode=this.node.parentElement.querySelector("[data-color-circle]");this.opacityNode=this.node.parentElement.querySelector("[data-color-opacity]");BX.bind(this.circleNode,"click",this.showPicker.bind(this));if(this.opacityNode){BX.bind(this.opacityNode,"change",function(){this.applyColor();this.handler()}.bind(this));if(this.opacityNode.children.length===0){for(var t=0;t<=100;t++){var i=document.createElement("option");i.value=t/100;i.textContent=t+"%";this.opacityNode.appendChild(i)}}}this.reload()}i.prototype={showPicker:function(){this.picker.close();this.picker.open({defaultColor:this.defaultColor?this.defaultColor():"",allowCustomColor:true,bindElement:this.circleNode,onColorSelected:this.onColorSelected.bind(this)})},onColorSelected:function(e){this.applyColor(e);this.handler()},reload:function(){this.initialized=false;this.applyColor();this.initialized=true},applyColor:function(e){var t=this.node;var i=this.circleNode;var o=this.opacityNode;var n=this.parseHex(e||t.value);if(o&&this.initialized){n[3]=o.value}if(o){o.value=n[3]}i.style.background=this.toRgba(n);t.value=this.toHex(n)},parseHex:function(e){e=this.fillHex(e);var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(!t){t=[0,0,0,1]}else{t=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(100*(parseInt(t[4]||"ff",16)/255))/100]}return t},toRgba:function(e,t,i,o){var n=arguments.length===1?arguments[0]:[].slice.call(arguments);return"rgba("+n.join(", ")+")"},toHex:function(e,t,i,o){var n=arguments.length===1?arguments[0]:[].slice.call(arguments);n[3]=typeof n[3]==="undefined"?1:n[3];n[3]=parseInt(255*n[3]);return"#"+n.map(function(e){e=e.toString(16);return e.length===1?"0"+e:e}).join("")},hexToRgba:function(e){return"rgba("+this.parseHex(e).join(", ")+")"},fillHex:function(e,t){if(e.length===4||t&&e.length===5){e=e.replace(/([a-f0-9])/gi,"$1$1")}if(t&&e.length===7){e+="ff"}return e}};e.Design=new t})();
//# sourceMappingURL=script.map.js