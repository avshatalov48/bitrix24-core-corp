(function(){"use strict";if(BX.SalecenterPaySystem)return;BX.SalecenterPaySystem={init:function(e){this.slider=null;this.paySystemHandler=e.paySystemHandler;this.paySystemMode=e.paySystemMode;this.paySystemId=e.paySystemId;this.containerNode=BX(e.containerId);this.buttonSaveNode=BX(e.buttonSaveId);this.formId=e.formId;this.auth=e.auth;this.errorMessageNode=BX(e.errorMessageId);this.paySystemFormData=[];this.checkedAuthStatus=false;this.settingsFormLinkNameCodeMap=e.settingsFormLinkNameCodeMap;this.handlerClassName=e.handlerClassName;this.isExistsSettings=e.isExistsSettings;this.isExistsOnlyCommonSettings=e.isExistsOnlyCommonSettings;this.settingsMenu=null;this.settingsMenuNode=BX(e.settingsMenuId);this.buttonPanelId=e.buttonPanelId;this.uiNodes={name:this.containerNode.querySelector("[data-bx-salescenter-auth-name]"),link:this.containerNode.querySelector("[data-bx-salescenter-auth-link]"),logout:this.containerNode.querySelector("[data-bx-salescenter-auth-logout]")};this.initExpertMenu();this.showBlockByAuth();this.bindEvents();var t=top.BX.adminSidePanel||BX.adminSidePanel;if(t){if(!top.window["adminSidePanel"]||!BX.is_subclass_of(top.window["adminSidePanel"],t)){top.window["adminSidePanel"]=new t({publicMode:true})}}},bindEvents:function(){BX.bind(BX("bx-salescenter-add-button"),"click",BX.proxy(this.openSlider,this));BX.bind(BX("bx-salescenter-connect-button"),"click",BX.proxy(this.openPopup,this));BX.bind(BX("LOGOTIP"),"bxchange",BX.proxy(this.showLogotip,this));BX.bind(this.buttonSaveNode,"click",BX.proxy(this.savePaySystemAction,this));BX.bind(this.uiNodes.logout,"click",BX.proxy(this.logoutAction,this));BX.addCustomEvent(window,"seo-client-auth-result",BX.proxy(this.checkAuthStatusAction,this));BX.addCustomEvent("onPopupOpen",BX.proxy(this.onPopupOpenHandler,this));BX.addCustomEvent("SidePanel.Slider:onLoad",BX.proxy(this.onLoadSlider,this));BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.onCloseSlider,this));BX.addCustomEvent("SidePanel.Slider:onMessage",BX.proxy(this.onMessageSlider,this));BX.addCustomEvent("BX.Sale.PaySystem.Registration.Robokassa:onAddSettings",BX.proxy(this.onAddSettings,this))},initExpertMenu(){var e=this;this.settingsMenu=new BX.Main.Menu({bindElement:this.settingsMenuNode,angle:true,offsetLeft:20,closeByEsc:true,items:[]});this.settingsMenu.addMenuItem({text:BX.message("SALESCENTER_SP_PAY_SYSTEM_EXPERT_SETTINGS"),onclick:function(){e.settingsMenu.close();e.openSlider()}.bind(this)});if(this.paySystemId>0){this.settingsMenu.addMenuItem({text:BX.message("SALESCENTER_SP_PAY_SYSTEM_DELETE"),onclick:function(t){e.settingsMenu.close();e.remove(t)}.bind(this)})}if(this.isExistsOnlyCommonSettings){this.addLogoutMenuItem()}},addLogoutMenuItem(){var e=this;this.settingsMenu.addMenuItem({id:"logoutMenuItem",text:BX.message("SALESCENTER_SP_PAY_SYSTEM_SETTINGS_LOGOUT"),onclick:function(){e.settingsMenu.close();e.logoutFromSettings()}.bind(this)})},removeLogoutMenuItem(){this.settingsMenu.removeMenuItem("logoutMenuItem")},showExpertSettingsMenu(e){e.preventDefault();this.settingsMenu.show()},onLoadSlider:function(e){this.slider=e.slider;top.BX.addCustomEvent("AdminSidePanel:onSendRequest",BX.proxy(this.onSendAdminSidePanelRequest.bind(this,this.slider)));var t=this.getSliderDocument(this.slider);this.formData=this.getAllFormDataJson(t)},onCloseSlider:function(e){this.onCloseSliderPopup(e)},openPopup:function(e){var t;if(this.auth&&this.auth.URL){t=BX.util.popup(this.auth.URL,800,600);if(t){BX.onCustomEvent("onPopupOpen",[t])}}},onPopupOpenHandler:function(e){var t=this,s=setInterval((function(){if(e.closed){clearInterval(s);if(t.checkedAuthStatus===false){t.checkAuthStatusAction()}}}),1e3)},logoutAction:function(){BX.UI.Dialogs.MessageBox.confirm(BX.message("SALESCENTER_SP_LOGOUT_CONFIRMATION_TEXT"),BX.message("SALESCENTER_SP_LOGOUT_CONFIRMATION_TITLE"),(e=>{e.close();BX.ajax.runComponentAction("bitrix:salescenter.paysystem","logoutProfile",{mode:"ajax",data:{type:this.auth.TYPE}}).then(function(e){this.toggleLogoutBlock()}.bind(this),function(e){this.showErrorPopup(e.errors)}.bind(this))}),BX.message("SALESCENTER_SP_LOGOUT_CONFIRMATION_OK"),(e=>e.close()),BX.message("SALESCENTER_SP_LOGOUT_CONFIRMATION_CANCEL"))},checkAuthStatusAction:function(e){e.reload=false;this.checkedAuthStatus=true;BX.ajax.runComponentAction("bitrix:salescenter.paysystem","getProfileStatus",{mode:"ajax",data:{type:this.auth.TYPE}}).then(function(e){this.toggleAuthBlock(e.data.profile)}.bind(this),function(e){this.showErrorPopup(e.errors)}.bind(this))},toggleAuthBlock:function(e){if(e){this.setProfileData(e);this.showBlock(["profile","settings","form"]);BX.removeClass(BX(this.buttonPanelId),"ui-button-panel-wrapper-hide")}else{this.showBlock(["settings","form"]);BX.addClass(BX(this.buttonPanelId),"ui-button-panel-wrapper-hide")}if(this.slider){this.slider.reload()}},toggleLogoutBlock:function(){this.showBlock(["auth"]);if(this.slider){this.slider.reload()}},setProfileData:function(e){if(this.uiNodes.name&&e.NAME){if(this.auth.TYPE==="yookassa"){this.uiNodes.name.innerText="Shop ID "+e.NAME}else{this.uiNodes.name.innerText=e.NAME}}if(this.uiNodes.link){if(e.LINK){this.uiNodes.link.setAttribute("href",e.LINK)}else{this.uiNodes.link.removeAttribute("href")}}},showBlock:function(e){e=BX.type.isArray(e)?e:[e];var t="data-bx-salescenter-block";var s=this.containerNode.querySelectorAll("["+t+"]");s=BX.convert.nodeListToArray(s);s.forEach((function(s){var i=s.getAttribute(t);var n=BX.util.in_array(i,e);s.style.display=n?"block":"none"}),this)},showBlockByAuth:function(){if(this.auth.HAS_AUTH){this.setProfileData(this.auth.PROFILE);if(this.auth.PROFILE){this.showBlock(["profile","settings","form"])}else{this.showBlock(["profile"])}}else{if(this.auth.PROFILE){this.setProfileData(this.auth.PROFILE);this.showBlock(["profile","settings","form"])}else{if(this.auth.CAN_AUTH){this.showBlock(["auth"])}else{this.showBlock(["settings","form"])}}}},openSlider:function(){var e=true;var t={allowChangeHistory:false,events:{onLoad:function(t){if(e){var s=t.getSlider();this.updatePaySystemForm(s);e=false}}.bind(this),onClose:function(e){var t=e.getSlider(),s;s=this.getPaySystemFormData(t);if(s.hasOwnProperty("ID")&&s.ID>0){this.paySystemId=s.ID;this.updateCommonSettingsForm(s);this.savePaySystem().then(function(e){t.destroy();this.slider.url=BX.util.add_url_param(this.slider.url,{ID:this.paySystemId});this.slider.setFrameSrc();this.slider.reload()}.bind(this))}else{this.updateCommonSettingsForm(s)}}.bind(this)}};BX.SidePanel.Instance.open(this.getConnectPath(),t)},onMessageSlider:function(e){if(e.getEventId()==="save"){if(this.paySystemId>0){this.slider.reload()}else{this.closeSlider()}}},closeSlider:function(){var e=BX("salescenter-form-is-saved");if(e){e.value="y"}if(this.slider){this.slider.close()}},getConnectPath:function(){var e="/shop/settings/sale_pay_system_edit/?publicSidePanel=Y";if(this.paySystemId>0){e+="&ID="+this.paySystemId}else if(this.paySystemHandler){e+="&ACTION_FILE="+this.paySystemHandler;if(this.paySystemMode){e+="&PS_MODE="+this.paySystemMode}}return e},savePaySystemAction:function(e){e.preventDefault();this.savePaySystem().then(function(e){BX.removeClass(this.buttonSaveNode,"ui-btn-wait");this.hideError();this.closeSlider()}.bind(this),function(e){BX.removeClass(this.buttonSaveNode,"ui-btn-wait");this.showError(e.errors);if(e.data.hasOwnProperty("ID")){this.paySystemId=e.data.ID;BX("ID").value=this.paySystemId}window.scrollTo(0,0)}.bind(this))},savePaySystem:function(){var e,t;if(this.paySystemId>0){e="salescenterUpdatePaymentSystem"}else{e="salescenterAddPaymentSystem"}t=this.paySystemHandler;if(this.paySystemMode){t=t+":"+this.paySystemMode}return BX.ajax.runComponentAction("bitrix:salescenter.paysystem","savePaySystem",{mode:"ajax",data:this.getSaveData(),analyticsLabel:{analyticsLabel:e,type:t}})},getSaveData:function(){var e=this.getAllFormData(document);for(var t in this.paySystemFormData){if(this.paySystemFormData.hasOwnProperty(t)){if(this.isObject(this.paySystemFormData[t])){e.append(t,JSON.stringify(this.paySystemFormData[t]))}else{e.append(t,this.paySystemFormData[t])}}}if(this.paySystemFormData.hasOwnProperty("NAME")){e.append("ACTIVE",e.get("ACTIVE"));e.append("NAME",e.get("NAME"));e.append("DESCRIPTION",e.get("DESCRIPTION"));e.append("IS_CASH",e.get("IS_CASH"));e.append("CAN_PRINT_CHECK",e.get("CAN_PRINT_CHECK"))}return e},updatePaySystemForm:function(e){var t,s,i,n,a;t=this.getSliderDocument(e);a=this.getCommonSettingsFormData();if(this.paySystemId>0){this.setPaySystemFormFields(t,a)}else{i=t.getElementById("LOGOTIP").closest("span").firstChild;n=this.elementObserver(i,function(e){this.setPaySystemFormFields(t,a);n.disconnect()}.bind(this));var o=t.getElementById("ACTION_FILE");if(o){s=new Event("change");o.dispatchEvent(s)}}},setPaySystemFormFields:function(e,t){var s,i,n,a,o,r,l;n=e.getElementById("PSA_NAME");if(n&&t.NAME){n.value=t.NAME}a=e.getElementById("NAME");if(a&&t.NAME){a.value=t.NAME}o=e.getElementsByName("IS_CASH");if(o&&t.IS_CASH){o[0].value=t.IS_CASH}s=e.getElementById("ACTION_FILE");if(s){s.closest("tr").style.display="none"}i=e.getElementById("PS_MODE");if(i){i.closest("tr").style.display="none"}if(t.CAN_PRINT_CHECK_SELF&&t.CAN_PRINT_CHECK_SELF==="Y"){r=e.getElementById("CAN_PRINT_CHECK");if(r){r.closest("tr").style.display="none"}}else{r=e.getElementById("CAN_PRINT_CHECK");if(r&&t.CAN_PRINT_CHECK){r.checked=t.CAN_PRINT_CHECK==="Y"}}l=e.getElementById("tab_cont_cashbox_edit");if(l){l.style.display="none";e.getElementById("cashbox_edit").style.display="none"}try{var h=this.lookupDescriptionEditor(e);if(h){h.SetEditorContent(BX.util.htmlspecialchars(t.DESCRIPTION));h.SaveContent();if(h.pEditorDocument){BX.bind(h.pEditorDocument,"click",BX.proxy(h.OnClick,h));BX.bind(h.pEditorDocument,"mousedown",BX.proxy(h.OnMousedown,h))}}}catch(e){}},getPaySystemFormData:function(e){var t,s;t=this.getSliderDocument(e);s=this.getAllFormDataList(t);try{var i=this.lookupDescriptionEditor(t);if(i){i.SaveContent();s.DESCRIPTION=BX.util.htmlspecialcharsback(i.GetContent())}}catch(e){}return s},updateCommonSettingsForm:function(e){var t,s,i,n,a;var o=this.getCommonSettingsFormData();t=BX("ID");s=BX("NAME");i=BX("DESCRIPTION");n=BX("IS_CASH");a=BX("CAN_PRINT_CHECK");if(t&&e.ID){t.value=e.ID}if(s&&e.NAME){s.value=e.NAME}if(i&&e.DESCRIPTION){i.value=e.DESCRIPTION}if(n&&e.IS_CASH){n.value=e.IS_CASH}if(a){if(o.CAN_PRINT_CHECK_SELF&&o.CAN_PRINT_CHECK_SELF==="Y"){a.checked=true}else{a.checked=!!(e.CAN_PRINT_CHECK&&e.CAN_PRINT_CHECK==="Y")}}this.paySystemFormData=e},getCommonSettingsFormData:function(){var e;e=this.getAllFormDataList(document);return e},onSendAdminSidePanelRequest:function(e,t){if(t.indexOf("action=delete")!==-1){e.close()}},elementObserver:function(e,t){if(!window.MutationObserver){return}var s={attributes:true,childList:true,characterData:true};var i=new MutationObserver((function(e){e.forEach((function(e){t(e)}))}));i.observe(e,s);return i},getAllFormDataJson:function(e){var t=this.getAllFormDataList(e);return t?JSON.stringify(t):""},getAllFormData:function(e){var t=new FormData,s=this.getAllFormDataList(e);for(var i in s){if(s.hasOwnProperty(i)){if(this.isObject(s[i])){t.append(i,JSON.stringify(s[i]))}else{t.append(i,s[i])}}}return t},getAllFormDataList:function(e){var t={},s,i,n;if(!e){return t}n=e.getElementsByTagName("form");for(s=0;s<n.length;s++){var a=this.getFormData(n[s]);for(i in a){if(a.hasOwnProperty(i)){t[i]=a[i]}}}return t},getFormData:function(e){var t=BX.ajax.prepareForm(e),s;for(s in t.data){if(t.data.hasOwnProperty(s)&&s===""){delete t.data[s]}}return!!t&&t.data?t.data:{}},showErrorPopup:function(e){var t,s=[];e.forEach((function(e){s.push(BX.create("p",{text:e.message}))}));if(!s.length){return}t=BX.create("div",{children:s});BX.UI.Dialogs.MessageBox.alert(t,BX.Loc.getMessage("SALESCENTER_SP_ERROR_POPUP_TITLE"),(e=>e.close()),BX.Loc.getMessage("SALESCENTER_SP_BUTTON_CLOSE"))},showError:function(e){var t="";e.forEach((function(e){t+=e.message+"<br>"}));if(this.errorMessageNode&&t){this.errorMessageNode.parentNode.style.display="block";this.errorMessageNode.innerHTML=t}},hideError:function(){if(this.errorMessageNode){this.errorMessageNode.innerHTML="";this.errorMessageNode.parentNode.style.display="none"}},getSliderDocument:function(e){var t,s;t=e.iframe;s=t.contentDocument||t.contentWindow.document;return s},lookupDescriptionEditor:function(e){try{var t=e.defaultView||e.parentWindow;var s="LightHTMLEditorhndl_dscr_0";if(this.paySystemId&&this.paySystemId>0){s="LightHTMLEditorhndl_dscr_"+this.paySystemId}return t[s]}catch(e){}},showLogotip:function(e){if(e.currentTarget.files&&e.currentTarget.files[0]){var t=new FileReader;t.onload=function(e){BX("salescenter-img-preload").src=e.target.result};t.readAsDataURL(e.currentTarget.files[0])}},onCloseSliderPopup:function(e){var t=this.getSliderDocument(e.slider);var s=t.getElementById("salescenter-form-is-saved");if(s&&s.value==="y"){return true}var i=this.getAllFormDataJson(t);if(this.formData===i||this.isClose===true){this.isClose=false;return false}e.action=false;if(this.isPopupShown){return false}BX.UI.Dialogs.MessageBox.confirm(BX.Loc.getMessage("SALESCENTER_SP_POPUP_CONTENT_MSGVER_1"),(e=>{this.isPopupShown=false;this.isClose=true;e.close();BX.SidePanel.Instance.getTopSlider().close()}),BX.Loc.getMessage("SALESCENTER_SP_POPUP_BUTTON_CLOSE_MSGVER_1"),(e=>{this.isPopupShown=false;e.close();BX.SidePanel.Instance.getTopSlider().focus()}),BX.Loc.getMessage("SALESCENTER_SP_POPUP_BUTTON_STAY"));this.isPopupShown=true;return false},isObject:function(e){return e&&typeof e==="object"&&e.constructor===Object},remove:function(e){var t=e.target;e.preventDefault();if(this.paySystemId>0&&confirm(BX.message("SALESCENTER_SP_PAYSYSTEM_DELETE_CONFIRM"))){var s=this.paySystemHandler;if(this.paySystemMode){s=s+":"+this.paySystemMode}BX.ajax.runComponentAction("bitrix:salescenter.paysystem","deletePaySystem",{mode:"ajax",data:{paySystemId:this.paySystemId},analyticsLabel:{analyticsLabel:"salescenterDeletePaymentSystem",type:s}}).then(function(){BX.removeClass(t,"ui-btn-wait");this.closeSlider()}.bind(this),function(e){BX.removeClass(t,"ui-btn-wait");this.showError(e.errors)}.bind(this))}else{setTimeout((function(){BX.removeClass(t,"ui-btn-wait")}),100)}},change:function(){if(this.paySystemId<=0){return}var e=this.getSliderDocument(this.slider);var t=this.getAllFormDataJson(e);if(this.formData===t){BX.addClass(BX(this.buttonPanelId),"ui-button-panel-wrapper-hide");return}BX.removeClass(BX(this.buttonPanelId),"ui-button-panel-wrapper-hide")},openSettingsForm(e){BX.SidePanel.Instance.open(e,{cacheable:false,allowChangeHistory:false,width:500})},onAddSettings(e){var t=e.getData();if(t&&t.handlerClassName){this.getPaySystemSettingsData(t.handlerClassName).then(function(e){var s=e.data;this.reloadSettingsBlockOnAdd(t.handlerClassName,s);if(s.IS_SETTINGS_EXISTS){this.showNotificationOnAddSetting()}}.bind(this))}},getPaySystemSettingsData(e){return BX.ajax.runComponentAction("bitrix:salescenter.paysystem","getPaySystemSettingsData",{mode:"class",data:{handlerClassName:e}})},reloadSettingsBlockOnAdd(e,t){var s=t.PAY_SYSTEM_ROBOKASSA_SETTINGS;if(s&&s.IS_SUPPORT_SETTINGS){if(s.IS_ONLY_COMMON_SETTINGS_EXISTS){this.addLogoutMenuItem();var i=this.settingsFormLinkNameCodeMap["DEFAULT"];e=this.handlerClassName.replace(/\/\//g,"/");if(this.settingsFormLinkNameCodeMap.hasOwnProperty(e)){i=this.settingsFormLinkNameCodeMap[e]["EXIST"]}BX("salescenter-settings-paysystem-form-link").text=i}if(s.IS_SETTINGS_EXISTS&&BX("salescenter-settings-paysystem-register-component")){BX.remove(BX("salescenter-settings-paysystem-register-component"))}}},showNotificationOnAddSetting(){window.top.BX.UI.Notification.Center.notify({content:BX.message("SALESCENTER_SP_PAYSYSTEM_SETTINGS_ADD_NOTIFICATION")})},logoutFromSettings(){this.deletePaySystemSettings().then(function(){this.getPaySystemSettingsData(this.handlerClassName).then(function(e){var t=e.data;if(!t.IS_SETTINGS_EXISTS){this.removeLogoutMenuItem();this.getRegisterPaySystemComponentAction().then(function(e){this.reloadSettingsBlockOnLogout(e.data)}.bind(this))}}.bind(this))}.bind(this))},deletePaySystemSettings(){return BX.ajax.runAction("sale.paysystem.settings.robokassa.delete",{})},getRegisterPaySystemComponentAction(){return BX.ajax.runAction("sale.paysystem.settings.robokassa.getRegisterComponent",{})},reloadSettingsBlockOnLogout(e){if(BX("salescenter-settings-paysystem-register-component")){BX.remove(BX("salescenter-settings-paysystem-register-component"))}var t=BX("salescenter-settings-block");if(t){var s=BX.create("span",{props:{id:"salescenter-settings-paysystem-register-component"}});BX.html(s,e.html);t.prepend(s);var i=this.settingsFormLinkNameCodeMap["DEFAULT"];var n=this.handlerClassName.replace(/\/\//g,"/");if(this.settingsFormLinkNameCodeMap.hasOwnProperty(n)){i=this.settingsFormLinkNameCodeMap[n]["NEW"]}BX("salescenter-settings-paysystem-form-link").text=i}}};if(BX.SalecenterPaySystemCashbox)return;BX.SalecenterPaySystemCashbox={init:function(e){this.paySystemId=e.paySystemId;this.formNode=BX(e.formId);this.cashboxContainerInfoNode=BX(e.cashboxContainerInfoId);this.cashboxContainerNode=BX(e.cashboxContainerId);this.cashboxWarningContainerNode=BX(e.cashboxWarningContainerId);this.canPrintCheckNode=BX(e.canPrintCheckId);this.cashboxSwitchet=null;this.containerNodeList={settings:BX(e.containerList.settings),cashboxSettings:BX(e.containerList.cashboxSettings)};this.section=e.section;this.fields=e.fields;this.initSwitcher();this.renderSettings(this.cashboxContainerNode)},renderSettings:function(e){Object.keys(this.section).forEach(function(t){if(this.fields[t]){var s=this.section[t];var i=s.type;if(this.containerNodeList[i]){this.containerNodeList[i].appendChild(this.renderSection(s,this.fields[t]))}else{e.appendChild(this.renderSection(s,this.fields[t]))}}}.bind(this))},renderSection:function(e,t){var s=BX.create("div",{props:{className:"salescenter-editor-section-content"}});var i=BX.create("div",{props:{className:"salescenter-paysystem-section-title salescenter-paysystem-angle-icon-after"},children:[BX.create("div",{props:{className:"salescenter-paysystem-section-title-block"},children:[BX.create("div",{props:{className:"ui-title-6"},text:e.title}),e.hint&&BX.UI.Hint.createNode(e.hint)]}),BX.create("div",{props:{className:"salescenter-paysystem-angle-icon"}})]});s.appendChild(i);s.appendChild(BX.create("div",{props:{className:"ui-hr"}}));var n=BX.create("div");if(e.collapsed==="Y"){BX.hide(n)}s.appendChild(n);if(e.warning){n.appendChild(BX.create("div",{props:{className:"ui-alert ui-alert-warning"},text:e.warning}))}t.forEach(function(e){var t=BX.create("div",{props:{className:"salescenter-editor-content-block"}});this.renderField(e).forEach((function(e){t.appendChild(e)}));n.appendChild(t)}.bind(this));i.addEventListener("click",(function(){BX.toggle(n)}));return s},renderField:function(e){if(e.type==="checkbox"){return this.renderCheckbox(e)}if(e.type==="select"){return this.renderSelect(e)}return this.renderString(e)},renderString:function(e){var t=[];t.push(BX.create("div",{props:{className:"ui-ctl-label-text"+(e.required?" salescenter-paysystem-control-required":"")},text:e.label}));t.push(BX.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"},html:e.input}));if(e.hint){t.push(BX.create("div",{props:{className:"ui-ctl-label-text"},style:{marginTop:"5px"},children:[BX.create("span",{props:{className:"salescenter-editor-content-logo-hint"},text:e.hint})]}))}return t},renderSelect:function(e){var t=[];t.push(BX.create("div",{props:{className:"ui-ctl-label-text"+(e.required?" salescenter-paysystem-control-required":"")},text:e.label}));var s=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100"},children:[BX.create("div",{props:{className:"ui-ctl-after ui-ctl-icon-angle"}})]});s.insertAdjacentHTML("beforeend",e.input);t.push(s);return t},renderCheckbox:function(e){var t=[];var s=BX.create("label",{props:{className:"ui-ctl ui-ctl-checkbox ui-ctl-w100"},html:e.input});s.appendChild(BX.create("div",{props:{className:"ui-ctl-label-text"+(e.required?" salescenter-paysystem-control-required":"")},text:e.label}));t.push(s);return t},initSwitcher:function(){var e=this.formNode.getElementsByClassName("js-cashbox-ui-switcher");e=BX.convert.nodeListToArray(e);e.forEach(function(e){if(e.getAttribute("data-switcher-init")){return}var t=new BX.UI.Switcher({node:e});this.cashboxSwitchet=t;this.canPrintCheckNode.onchange=()=>this.onToggleCanPrintCheckNode(this.canPrintCheckNode);BX.addCustomEvent(t,"unchecked",BX.proxy(this.onToggleCashboxSwitcher.bind(this,t)));BX.addCustomEvent(t,"checked",BX.proxy(this.onToggleCashboxSwitcher.bind(this,t)))}.bind(this))},onToggleCashboxSwitcher:function(e){BX.SalecenterPaySystem.change();if(e.isChecked()){this.canPrintCheckNode.checked=true;this.cashboxContainerInfoNode.classList.remove("salescenter-paysystem-cashbox-block--disabled");if(this.cashboxWarningContainerNode){BX.hide(this.cashboxWarningContainerNode)}this.showCashboxSettings()}else{this.cashboxContainerInfoNode.classList.add("salescenter-paysystem-cashbox-block--disabled");if(this.cashboxWarningContainerNode){BX.show(this.cashboxWarningContainerNode)}this.hideCashboxSettings()}},onToggleCanPrintCheckNode:function(e){if(e.checked===false){this.cashboxSwitchet.check(false)}},showCashboxSettings:function(){BX("salescenter-paysystem-cashbox").style.display="block"},hideCashboxSettings:function(){BX("salescenter-paysystem-cashbox").style.display="none"},reloadCashboxSettings:function(e){var t=this;BX.ajax.runComponentAction("bitrix:salescenter.paysystem","reloadCashboxSettings",{mode:"class",data:{paySystemId:this.paySystemId,kkmId:e.value}}).then((function(e){if(e.data.hasOwnProperty("IS_FISCALIZATION_ENABLE")){var s=e.data.IS_FISCALIZATION_ENABLE;t.cashboxSwitchet.check(s)}t.section=e.data.CASHBOX.section;t.fields=e.data.CASHBOX.fields;t.resetAllSection();if(t.section){t.renderSettings(t.cashboxContainerNode)}}))},resetSection:function(e){e.forEach(function(e){var t=this.section[e].type;if(this.containerNodeList[t]){this.containerNodeList[t].innerHTML=""}}.bind(this))},resetAllSection:function(){Object.keys(this.containerNodeList).forEach(function(e){this.containerNodeList[e].innerHTML=""}.bind(this))}}})(window);
//# sourceMappingURL=script.map.js