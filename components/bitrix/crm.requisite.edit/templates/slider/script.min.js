if(typeof BX.Crm.RequisiteSliderEditor==="undefined"){BX.Crm.RequisiteSliderEditor=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._formId="";this._formSumbitUrl="";this._requisiteAjaxUrl="";this._elementId=0;this._entityTypeId=0;this._entityId=0;this._presetId=0;this._externalContextId="";this._pseudoId="";this._popupManager=null;this._toolPanel=null;this._isRequestRunning=false};BX.Crm.RequisiteSliderEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX(BX.prop.getString(this._settings,"containerId",""));this._formId=BX.prop.getString(this._settings,"formId","");this._elementId=BX.prop.getInteger(this._settings,"elementId",0);this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._entityId=BX.prop.getInteger(this._settings,"entityId",0);this._presetId=BX.prop.getInteger(this._settings,"presetId",0);this._formSumbitUrl=BX.prop.getString(this._settings,"formSumbitUrl","");this._requisiteAjaxUrl=BX.prop.getString(this._settings,"requisiteAjaxUrl","");this._externalContextId=BX.prop.getString(this._settings,"externalContextId","");this._pseudoId=BX.prop.getString(this._settings,"pseudoId","");this._toolPanel=BX.Crm.EntityEditorToolPanel.create(this._id,{visible:true});this._toolPanel.addOnButtonClickListener(BX.delegate(this.onToolPanelButtonClick,this));this._toolPanel.layout();var i=BX.Crm.RequisiteEditFormManager.items[this._formId];if(i){this._popupManager=new BX.Crm.RequisitePopupFormManagerClass({editor:this,blockArea:null,blockIndex:-1,presetId:this._presetId,requisiteEntityTypeId:this._entityTypeId,requisiteEntityId:this._entityId,requisiteId:this._elementId,requisiteData:null,requisiteDataSign:null,requisitePopupAjaxUrl:"",requisiteAjaxUrl:this._requisiteAjaxUrl});this._popupManager.bindToForm(i)}},getId:function(){return this._id},getFormId:function(){return this._formId},getFormNodeId:function(){return"form_"+this._formId},getForm:function(){return BX(this.getFormNodeId())},getMessage:function(t){return BX.prop.getString(BX.Crm.RequisiteSliderEditor.messages,t,t)},onToolPanelButtonClick:function(t,e){var i=BX.prop.getString(e,"buttonId","");if(i==="SAVE"){this.save()}else if(i==="CANCEL"){this.cancel()}},save:function(){this.startSaveRequest()},startSaveRequest:function(){if(this._isRequestRunning){return}this._isRequestRunning=true;var t=this.getForm();var e={verify:"Y",popup_manager_id:this._id.toLowerCase()};if(this._elementId>0){e["requisite_id"]=this._elementId}else{e["etype"]=this._entityTypeId;e["eid"]=this._entityId;e["pid"]=this._presetId;e["pseudoId"]=this._pseudoId}BX.ajax.submitAjax(t,{url:this._formSumbitUrl,method:"POST",data:e,onsuccess:BX.delegate(this.onSaveRequestSuccess,this),onfailure:BX.delegate(this.onSaveRequestFailure,this)})},cancel:function(){if(typeof top.BX.Bitrix24.Slider!=="undefined"){var t=top.BX.Bitrix24.Slider.getCurrentPage();if(t){t.close(false)}}},onSaveRequestSuccess:function(t){this._isRequestRunning=false;if(!this._container){return}this._container.innerHTML=t;var e=BX(this._id.toLowerCase()+"_response");if(!e){return}var i="";var s="";var r=e.querySelector('input[name="REQUISITE_DATA"]');if(r){i=r.value}var n=e.querySelector('input[name="REQUISITE_DATA_SIGN"]');if(n){s=n.value}if(i!==""&&s!==""){var o={context:this._externalContextId,entityTypeId:this._entityTypeId,entityId:this._entityId,presetId:this._presetId,requisiteId:this._elementId,requisiteDataSign:s,requisiteData:i};if(this._elementId>0){o["requisiteId"]=this._elementId}else{o["pseudoId"]=this._pseudoId}BX.localStorage.set("BX.Crm.RequisiteSliderEditor:onSave",o,10)}},onRequestFailure:function(t){this._isRequestRunning=false}};if(typeof BX.Crm.RequisiteSliderEditor.messages==="undefined"){BX.Crm.RequisiteSliderEditor.messages={}}BX.Crm.RequisiteSliderEditor.create=function(t,e){var i=new BX.Crm.RequisiteSliderEditor;i.initialize(t,e);return i}}
//# sourceMappingURL=script.map.js