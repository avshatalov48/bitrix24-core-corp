"use strict";BX.namespace("BX.Disk.TileGrid");BX.Disk.TileGrid.Item=function(t){BX.TileGrid.Item.apply(this,arguments);this.isDraggable=false;this.isDroppable=false;this.dblClickDelay=0;this.title=t.name;this.isFolder=t.isFolder;this.isFile=t.isFile;this.canAdd=t.canAdd;this.isLocked=t.isLocked;this.isSymlink=t.isSymlink;this.image=t.image;this.actions=t.actions;this.link=t.link;this.attributes=t.attributes;this.item={container:null,action:null,title:null,titleWrapper:null,titleLink:null,titleInput:null,lock:null,symlink:null,imageBlock:null,picture:null,fileType:null,icons:null};this.actionsMenu=null;this.imageItemHandler=null;BX.addCustomEvent(window,"TileGrid.Grid:onItemDragStart",function(){if(this.actionsMenu)this.actionsMenu.popupWindow.close()}.bind(this))};BX.Disk.TileGrid.Item.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,handleDblClick:function(){BX.fireEvent(this.item.titleLink,"click")},handleEnter:function(){BX.onCustomEvent("Disk.TileItem.Item:onItemEnter",[this])},getContent:function(){this.item.container=BX.create("div",{attrs:{className:this.isFile?"disk-folder-list-item":"disk-folder-list-item disk-folder-list-item-folder"},children:[this.getImage(),this.getActionBlock(),BX.create("div",{props:{className:!this.getLocked()&&!this.getSymlink()?"disk-folder-list-item-bottom disk-folder-list-item-bottom-without-icons":"disk-folder-list-item-bottom"},children:[this.getTitle(),this.getIconsContainer()]})],events:{contextmenu:function(t){if(t.ctrlKey){return}this.showActionsMenu(t);this.gridTile.resetSelection();this.gridTile.selectItem(this);t.preventDefault()}.bind(this)}});if(this.image){this.imageItemHandler=BX.throttle(this.appendImageItem,20,this);BX.bind(window,"resize",this.imageItemHandler);BX.bind(window,"scroll",this.imageItemHandler)}return this.item.container},appendImageItem:function(){if(this.isVisibleOnFolderList()){this.item.picture.setAttribute("src",this.image);BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(window,"resize",this.imageItemHandler);BX.unbind(window,"scroll",this.imageItemHandler)}},lock:function(){this.item.lock.style.display=null},unlock:function(){this.item.lock.style.display="none"},getIconsContainer:function(){this.item.icons=BX.create("div",{props:{className:"disk-folder-list-item-icons"},children:[this.getLocked(),this.getSymlink()]});return this.item.icons},getLocked:function(){this.item.lock=BX.create("div",{attrs:{className:"disk-folder-list-item-locked"},style:{display:this.isLocked?null:"none"}});return this.item.lock},getSymlink:function(){this.item.symlink=BX.create("div",{attrs:{className:"disk-folder-list-item-shared"},style:{display:this.isSymlink?null:"none"}});return this.item.symlink},getTitle:function(){return this.item.title=BX.create("div",{props:{className:"disk-folder-list-item-title"},children:[this.item.titleWrapper=BX.create("div",{props:{className:"disk-folder-list-item-title-wrapper"},children:[this.getTitleInput(),this.item.titleLink=BX.create("a",{attrs:{className:"disk-folder-list-item-title-link",href:this.link,title:this.title,id:"disk_obj_"+this.id},text:this.title,dataset:BX.mergeEx({objectId:this.id,canAdd:this.canAdd},this.attributes)})]})]})},getTitleInput:function(){this.item.titleInput=BX.create("input",{attrs:{className:"disk-folder-list-item-title-input",type:"text",value:this.title}});BX.bind(this.item.titleInput,"click",function(t){t.stopPropagation()});BX.addCustomEvent(window,"BX.TileGrid.Grid:resetSelectAllItems",this.cancelRenaming.bind(this));BX.addCustomEvent(window,"BX.TileGrid.Grid:selectItem",this.cancelRenaming.bind(this));BX.bind(this.item.titleInput,"keydown",function(t){if(t.key==="Escape"){this.cancelRenaming();t.preventDefault()}if(t.key==="Enter"){this.cancelRenaming();this.runRename();t.preventDefault()}t.stopPropagation()}.bind(this));BX.bind(this.item.titleInput,"blur",function(t){this.cancelRenaming();this.runRename()}.bind(this));return this.item.titleInput},onRename:function(){this.gridTile.resetSelection();jsDD.Disable();this.item.titleInput.value=this.title;BX.addClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.focus();if(this.isFile){this.item.titleInput.setSelectionRange(0,this.title.lastIndexOf("."))}else{this.item.titleInput.select()}},cancelRenaming:function(){BX.removeClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.blur();jsDD.Enable()},rename:function(t){BX.addClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed");this.item.titleLink.addEventListener("animationend",function(){BX.removeClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed")}.bind(this));this.item.titleLink.textContent=t;this.item.titleLink.setAttribute("title",t);this.title=t;this.rebuildLinkAfterRename(t);jsDD.Enable()},rebuildLinkAfterRename:function(t){if(this.link!==""){this.link=this.link.substring(0,this.link.lastIndexOf("/")+1)+encodeURIComponent(t);this.item.titleLink.href=this.link;this.actions.forEach(function(t){if(t.id==="open"&&t.href){t.href=this.link}},this)}this.destroyActionsMenu()},runRename:function(){if(this.item.titleInput.value===this.title){return}var t=this.title;this.rename(this.item.titleInput.value);BX.Disk.Documents.Backend.renameAction(this.getId(),this.title).then(function(t){if(t.data.object.name!==this.title){this.rename(t.data.object.name)}}.bind(this)).catch(function(i){BX.Disk.showModalWithStatusAction(i);this.rename(t)}.bind(this))},afterRender:function(){if(!this.item.picture)return;if(this.isVisibleOnFolderList()){this.appendImageItem()}BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));this.item.picture.onload=function(){BX.show(this.item.picture);BX.hide(this.item.fileType)}.bind(this)},isVisibleOnFolderList:function(){var t=this.layout.container.getBoundingClientRect();var i=document.body.getBoundingClientRect();var e=this.layout.container.offsetHeight*2;if(t.top<0||t.bottom<0)return false;return i.height>t.top-e&&i.height>=t.bottom-e},getImage:function(){var t=this.getFileExtension(this.title);this.item.imageBlock=BX.create("div",{attrs:{className:"disk-folder-list-item-image"},children:[this.item.fileType=BX.create("div",{attrs:{className:"ui-icon ui-icon-file ui-icon-file-"+t},style:{width:this.isFolder?"85%":"70%"},html:"<i></i>"}),this.item.picture=this.image?BX.create("img",{attrs:{className:"disk-folder-list-item-image-img"},style:{display:"none"}}):null]});return this.item.imageBlock},markAsShared:function(){this.isSymlink=true;if(this.isFolder){this.item.fileType.classList.add("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display=null}},unmarkAsShared:function(){this.isSymlink=false;if(this.isFolder){this.item.fileType.classList.remove("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display="none"}},getFileExtension:function(t){var i=t.substring(t.lastIndexOf(".")+1);switch(i){case"mp4":case"mkv":case"mpeg":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"swf":case"wmv":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":i="zip";break;case"set":i="set";break;case"mov":i="mov";break;case"img":case"jpg":case"jpeg":case"gif":i="img";break;default:i="empty"}this.isFolder?i="folder":null;this.isSymlink&&this.isFolder?i="folder-shared":null;return i},getActionBlock:function(){if(!this.item.action){this.item.action=BX.create("div",{attrs:{className:"disk-folder-list-item-action"},events:{click:function(t){this.showActionsMenu(t,BX.getEventTarget(t))}.bind(this)}})}return this.item.action},getActions:function(){return this.actions},destroyActionsMenu:function(){if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}},getActionsMenu:function(t){if(this.actions.length<=0){return}if(this.actionsMenu){return this.actionsMenu}this.actionsMenu=BX.PopupMenu.create("disk-tile-grid-actions-menu-"+this.getId(),t,this.actions,{autoHide:true,offsetLeft:20,angle:true});BX.onCustomEvent("Disk:Documents:TileGrid:MenuAction:FirstShow",[this,this.id,this.actionsMenu]);BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",function(t){var i=this.getActionsMenu();if(i){var e=BX.getEventTarget(t);var s=BX.findParent(e,{className:"menu-popup-item"},10);if(!s||!s.dataset.preventCloseContextMenu){i.close()}}}.bind(this));return this.actionsMenu},showActionsMenu:function(t,i){BX.fireEvent(document.body,"click");var e=this.getActionsMenu(i);e.show();if(!i){e.popupWindow.popupContainer.style.top=t.pageY+"px";e.popupWindow.popupContainer.style.left=t.pageX-35+"px"}else if(i){var s=BX.pos(i);s.forceBindPosition=true;e.popupWindow.setBindElement(i);e.popupWindow.adjustPosition(s)}}};
//# sourceMappingURL=grid-tile-item.map.js