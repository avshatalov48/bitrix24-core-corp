(function(t,e,a,n){"use strict";function i(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-edit-robot-btn-list-target-target"></div>']);i=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-edit-robot-btn-item-drag-target"></div>']);r=function e(){return t};return t}function s(){var t=babelHelpers.taggedTemplateLiteral(['<input class="rpa-stage-phase-title-input" value="','" onblur="','" />']);s=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['<span class="rpa-stage-phase-title">\n\t\t\t<span class="rpa-stage-phase-title-inner">\n\t\t\t\t<span class="rpa-stage-phase-name">','</span>\n\t\t\t\t<span class="rpa-stage-phase-icon-edit" onclick="','" title="','"></span>\n\t\t\t</span>\n\t\t\t<span class="rpa-stage-phase-title-form">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t</span>"]);o=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['<span class="rpa-stage-phase-icon">\n\t\t\t<span class="','"></span>\n\t\t</span>']);l=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-stage-phase-panel-button" title="','" onclick="','"></div>']);g=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['<div title="','" class="rpa-stage-phase-panel-button rpa-stage-phase-panel-button-close" onclick="','"></div>']);u=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-stage-phase-panel">\n\t\t\t<div title="','" class="rpa-stage-phase-panel-button rpa-stage-phase-panel-button-refresh" onclick="','"></div>\n\t\t\t',"\n\t\t\t","\n\t\t</div>"]);h=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-stage-phase-inner"></div>']);c=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['<div class="rpa-stage-phase"></div>']);d=function e(){return t};return t}var p=e.Reflection.namespace("BX.Rpa");var f=function(t){babelHelpers.inherits(a,t);function a(){var t;var n;babelHelpers.classCallCheck(this,a);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++){r[s]=arguments[s]}n=babelHelpers.possibleConstructorReturn(this,(t=babelHelpers.getPrototypeOf(a)).call.apply(t,[this].concat(r)));n.stages=new Set;if(e.Type.isArray(n.params.stages)){n.params.stages.forEach(function(t){if(n.stages.size<=0){t.first=true}var e=n.createStage(t);if(e){n.addStage(e)}})}n.typeId=n.params.typeId;n.firstStageContainer=n.form.querySelector('[data-role="rpa-stages-first"]');n.commonStagesContainer=n.form.querySelector('[data-role="rpa-stages-common"]');n.successStageContainer=n.form.querySelector('[data-role="rpa-stages-success"]');n.failStageContainer=n.form.querySelector('[data-role="rpa-stages-fail"]');n.addCommonStageButton=n.form.querySelector('[data-role="rpa-stage-common-add"]');n.addFailStageButton=n.form.querySelector('[data-role="rpa-stage-fail-add"]');return n}babelHelpers.createClass(a,[{key:"init",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"init",this).call(this);this.renderStages()}},{key:"renderStages",value:function t(){var a=this;this.stages.forEach(function(t){if(t.isFirst()&&a.firstStageContainer){e.Dom.append(t.render(),a.firstStageContainer)}else if(t.isSuccess()&&a.successStageContainer){e.Dom.append(t.render(),a.successStageContainer)}else if(t.isFail()&&a.failStageContainer){e.Dom.append(t.render(),a.failStageContainer)}else if(a.commonStagesContainer){e.Dom.append(t.render(),a.commonStagesContainer)}})}},{key:"bindEvents",value:function t(){var n=this;babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"bindEvents",this).call(this);if(this.addCommonStageButton&&this.commonStagesContainer){e.Event.bind(this.addCommonStageButton,"click",function(){var t={name:e.Loc.getMessage("RPA_STAGES_NEW_STAGE_NAME"),color:n.constructor.defaultCommonStageColor};var a=n.createStage(t);if(a){n.addStage(a);e.Dom.append(a.render(),n.commonStagesContainer)}})}if(this.addFailStageButton&&this.failStageContainer){e.Event.bind(this.addFailStageButton,"click",function(){var t={name:e.Loc.getMessage("RPA_STAGES_NEW_STAGE_NAME"),color:n.constructor.defaultFailStageColor,semantic:"FAIL"};var a=n.createStage(t);if(a){n.addStage(a);e.Dom.append(a.render(),n.failStageContainer)}})}}},{key:"createStage",value:function t(a){var n=null;if(e.Type.isPlainObject(a)&&e.Type.isString(a.name)){a.typeId=this.typeId;n=new m(a);n.setComponent(this)}return n}},{key:"addStage",value:function t(e){if(e instanceof m){this.stages.add(e)}}},{key:"removeStage",value:function t(e){this.stages.delete(e);return this}},{key:"onMoveStage",value:function t(e){var a=this;var n=e.getContainer().parentElement;if(!n){return}var i=new Set;this.stages.forEach(function(t){if(t.isFail()&&e.isFail()||!t.isFinal()&&!e.isFinal()&&!t.isFirst()&&!e.isFirst()){i.add(t);a.removeStage(t)}});n.childNodes.forEach(function(t){var e=a.getStageByElement(t,i);if(e){i.delete(e);a.stages.add(e)}})}},{key:"getStageByElement",value:function t(e,a){var n=null;a.forEach(function(t){if(t.getContainer()===e){n=t}});return n}},{key:"prepareData",value:function t(){var e={stages:[],typeId:this.typeId};var a=1e3;var n=function t(e,a,n){a.push({id:e.getId(),name:e.getName(),color:e.getColor(),semantic:e.getSemantic(),typeId:e.getTypeId(),sort:n})};this.stages.forEach(function(t){if(t.isFirst()){n(t,e.stages,a);a+=1e3}});this.stages.forEach(function(t){if(!t.isFirst()&&!t.isFinal()){n(t,e.stages,a);a+=1e3}});this.stages.forEach(function(t){if(t.isSuccess()){n(t,e.stages,a);a+=1e3}});this.stages.forEach(function(t){if(t.isFail()){n(t,e.stages,a);a+=1e3}});return e}},{key:"afterSave",value:function t(e){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"afterSave",this).call(this,e);var n=this.getSlider();if(n){n.close()}}},{key:"showErrors",value:function t(e){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"showErrors",this).call(this,e);this.errorsContainer.parentNode.style.display="block"}},{key:"hideErrors",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"hideErrors",this).call(this);this.errorsContainer.parentNode.style.display="none"}}]);return a}(a.Component);babelHelpers.defineProperty(f,"defaultCommonStageColor","39A8EF");babelHelpers.defineProperty(f,"defaultFailStageColor","FF5752");var m=function(){function t(e){babelHelpers.classCallCheck(this,t);this.id=e.id;this.name=e.name;this.color=e.color;this.sort=e.sort;this.semantic=e.semantic;this.first=e.first;this.typeId=e.typeId;this.initialData=e;this.layout={}}babelHelpers.createClass(t,[{key:"setComponent",value:function t(e){this.stagesComponent=e;return this}},{key:"getComponent",value:function t(){return this.stagesComponent}},{key:"getId",value:function t(){if(this.id>0){return this.id}return 0}},{key:"getTypeId",value:function t(){return this.typeId}},{key:"getName",value:function t(){if(e.Type.isString(this.name)){return this.name}return""}},{key:"getColor",value:function t(){if(e.Type.isString(this.color)){return this.color}return"39A8EF"}},{key:"setName",value:function t(e){this.name=e;return this}},{key:"setColor",value:function t(e){this.color=e;return this}},{key:"getSemantic",value:function t(){if(e.Type.isString(this.semantic)){return this.semantic}return null}},{key:"isFirst",value:function t(){return this.first===true}},{key:"isFinal",value:function t(){return this.isSuccess()||this.isFail()}},{key:"isSuccess",value:function t(){return this.semantic==="SUCCESS"}},{key:"isFail",value:function t(){return this.semantic==="FAIL"}},{key:"getContainer",value:function t(){if(!this.layout.container){this.layout.container=e.Tag.render(d())}return this.layout.container}},{key:"getInnerContainer",value:function t(){if(!this.layout.innerContainer){this.layout.innerContainer=e.Tag.render(c())}return this.layout.innerContainer}},{key:"render",value:function t(){var a=this.getInnerContainer();var n=this.getContainer();e.Dom.clean(a);e.Dom.append(this.renderPanel(),a);e.Dom.append(this.renderIcon(),a);e.Dom.append(this.renderTitle(),a);e.Dom.append(a,n);if(!this.isFirst()&&!this.isSuccess()){var i=new v({stage:this});i.init()}this.adjustColors();return n}},{key:"renderPanel",value:function t(){this.layout.panel=e.Tag.render(h(),e.Loc.getMessage("RPA_STAGES_STAGE_PANEL_RELOAD"),this.restoreInitialData.bind(this),this.getColorButton(),this.getDeleteButton()?this.getDeleteButton():"");return this.layout.panel}},{key:"getDeleteButton",value:function t(){if(!this.isSuccess()&&!this.isFirst()){if(!this.layout.deleteButton){this.layout.deleteButton=e.Tag.render(u(),e.Loc.getMessage("RPA_COMMON_ACTION_DELETE"),this.destroy.bind(this))}}else if(this.layout.deleteButton){e.Dom.remove(this.layout.deleteButton);this.layout.deleteButton=null}return this.layout.deleteButton}},{key:"getColorButton",value:function t(){if(!this.layout.colorButton){this.layout.colorButton=e.Tag.render(g(),e.Loc.getMessage("RPA_STAGES_STAGE_PANEL_COLOR"),this.showColorPicker.bind(this))}return this.layout.colorButton}},{key:"renderIcon",value:function t(){this.layout.icon=e.Tag.render(l(),this.isFirst()||this.isSuccess()?"rpa-stage-phase-icon-arrow":"rpa-stage-phase-icon-burger");return this.layout.icon}},{key:"renderTitle",value:function t(){this.layout.title=e.Tag.render(o(),e.Text.encode(this.getName()),this.switchToEditMode.bind(this),e.Loc.getMessage("RPA_STAGES_STAGE_CHANGE_TITLE"),this.getNameInput());return this.layout.title}},{key:"getNameInput",value:function t(){if(!this.layout.nameInput){this.layout.nameInput=e.Tag.render(s(),e.Text.encode(this.getName()),this.switchToViewMode.bind(this))}return this.layout.nameInput}},{key:"switchToEditMode",value:function t(){this.getContainer().classList.add("rpa-stage-edit-mode");this.getNameInput().value=this.getName();this.focusNameInput()}},{key:"switchToViewMode",value:function t(){this.name=this.getNameInput().value;this.getContainer().classList.remove("rpa-stage-edit-mode");this.render()}},{key:"focusNameInput",value:function t(){this.getNameInput().focus();this.getNameInput().selectionStart=this.getNameInput().value.length}},{key:"adjustColors",value:function t(){var e="#"+this.getColor();var a=n.Manager.calculateTextColor(e);this.layout.innerContainer.style.backgroundColor=e;this.layout.innerContainer.style.color=a}},{key:"getColorPicker",value:function t(){var e=this;if(this.colorPicker){return this.colorPicker}this.colorPicker=new BX.ColorPicker({bindElement:this.getColorButton(),onColorSelected:function t(a){e.setColor(a.substr(1));e.adjustColors()}});return this.colorPicker}},{key:"showColorPicker",value:function t(){this.getColorPicker().open()}},{key:"restoreInitialData",value:function t(){this.name=this.initialData.name;this.color=this.initialData.color;this.render()}},{key:"destroy",value:function t(){e.Dom.remove(this.getContainer());if(this.getComponent()){this.getComponent().removeStage(this)}}}]);return t}();var v=function(){function t(e){babelHelpers.classCallCheck(this,t);this.stage=e.stage;this.itemContainer=this.stage.getContainer();this.draggableItemContainer=null;this.dragElement=null}babelHelpers.createClass(t,[{key:"init",value:function t(){var e=this.itemContainer.querySelector(".rpa-stage-phase-icon");if(jsDD){e.onbxdragstart=this.onDragStart.bind(this);e.onbxdrag=this.onDrag.bind(this);e.onbxdragstop=this.onDragStop.bind(this);jsDD.registerObject(e);this.itemContainer.onbxdestdraghover=this.onDragEnter.bind(this);this.itemContainer.onbxdestdraghout=this.onDragLeave.bind(this);this.itemContainer.onbxdestdragfinish=this.onDragDrop.bind(this);jsDD.registerDest(this.itemContainer,30)}}},{key:"onDragStart",value:function t(){e.Dom.addClass(this.itemContainer,"rpa-edit-robot-btn-item-disabled");if(!this.dragElement){this.dragElement=this.itemContainer.cloneNode(true);this.dragElement.style.position="absolute";this.dragElement.style.width=this.itemContainer.offsetWidth+"px";this.dragElement.className="rpa-edit-robot-btn-item rpa-edit-robot-btn-item-drag";e.Dom.append(this.dragElement,document.body)}}},{key:"onDrag",value:function t(e,a){if(this.dragElement){this.dragElement.style.left=e+"px";this.dragElement.style.top=a+"px"}}},{key:"onDragStop",value:function t(){e.Dom.removeClass(this.itemContainer,"rpa-edit-robot-btn-item-disabled");e.Dom.remove(this.dragElement);this.dragElement=null}},{key:"onDragEnter",value:function t(e){this.draggableItemContainer=e.closest(".rpa-stage-phase");if(this.draggableItemContainer!==this.itemContainer){this.showDragTarget()}}},{key:"onDragLeave",value:function t(){this.hideDragTarget()}},{key:"onDragDrop",value:function t(){if(this.draggableItemContainer!==this.itemContainer){this.hideDragTarget();e.Dom.remove(this.draggableItemContainer);e.Dom.insertBefore(this.draggableItemContainer,this.itemContainer);this.stage.getComponent().onMoveStage(this.stage)}}},{key:"showDragTarget",value:function t(){e.Dom.addClass(this.getDragTarget(),"rpa-edit-robot-btn-item-drag-target-shown");this.getDragTarget().style.height=this.itemContainer.offsetHeight+"px"}},{key:"hideDragTarget",value:function t(){e.Dom.removeClass(this.getDragTarget(),"rpa-edit-robot-btn-item-drag-target-shown");this.getDragTarget().style.height=0}},{key:"getDragTarget",value:function t(){if(!this.dragTarget){this.dragTarget=e.Tag.render(r());e.Dom.prepend(this.dragTarget,this.itemContainer)}return this.dragTarget}}]);return t}();var y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.container=e;this.items=[];this.height=null}babelHelpers.createClass(t,[{key:"init",value:function t(){if(jsDD){this.container.onbxdestdraghover=BX.delegate(this.onDragEnter,this);this.container.onbxdestdraghout=BX.delegate(this.onDragLeave,this);this.container.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);jsDD.registerDest(this.container,40)}}},{key:"onDragEnter",value:function t(e){this.draggableItemContainer=e.closest(".rpa-stage-phase");this.height=this.draggableItemContainer.offsetHeight;this.showDragTarget()}},{key:"onDragLeave",value:function t(){this.hideDragTarget()}},{key:"onDragDrop",value:function t(){this.hideDragTarget();e.Dom.remove(this.draggableItemContainer);e.Dom.insertBefore(this.draggableItemContainer,this.dragTarget)}},{key:"showDragTarget",value:function t(){e.Dom.addClass(this.container,"rpa-edit-robot-btn-list-target-shown");this.getDragTarget().style.height=this.height+"px"}},{key:"hideDragTarget",value:function t(){e.Dom.removeClass(this.container,"rpa-edit-robot-btn-list-target-shown");this.getDragTarget().style.height=0}},{key:"getDragTarget",value:function t(){if(!this.dragTarget){this.dragTarget=e.Tag.render(i());e.Dom.append(this.dragTarget,this.container)}return this.dragTarget}}]);return t}();p.DragDropItem=v;p.DragDropItemContainer=y;p.StagesComponent=f})(this.window=this.window||{},BX,BX.Rpa,BX.Rpa);
//# sourceMappingURL=script.map.js