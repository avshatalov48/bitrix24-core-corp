{"version":3,"file":"script.js","sources":["src/js/index.js"],"sourcesContent":["import {Event, ajax as Ajax, Tag, Dom} from 'main.core';\nimport {Loader} from \"main.loader\";\n\ntype PageOption = {\n\tpage: string,\n\tname: string,\n\tlink: ?string,\n\tlinkToSave: ?string,\n\tcurrent: ?boolean,\n\tcontainer: ?HTMLDivElement,\n\tform: ?HTMLFormElement,\n}\n\nexport class LandingSettings\n{\n\tsiteId: number;\n\tlandingId: number;\n\tpages: {\n\t\t[code: string]: PageOption\n\t};\n\tcurrentPage: PageOption;\n\tcontainer: HTMLDivElement;\n\tlinks: [HTMLAnchorElement];\n\tsaveButton: HTMLButtonElement;\n\tloader: Loader;\n\tloadingPages: [string];\n\n\t/**\n\t * Constructor.\n\t */\n\tconstructor(options: {\n\t\tsiteId: number,\n\t\tlandingId: number,\n\t\tpages: {\n\t\t\t[code: string]: PageOption\n\t\t},\n\t\tmenuId: string,\n\t\tcontainerId: string,\n\t\tsaveButtonId: string,\n\t})\n\t{\n\t\tthis.siteId = options.siteId;\n\t\tthis.landingId = options.landingId;\n\n\t\t// pages\n\t\tthis.pages = options.pages;\n\t\tthis.container = document.getElementById(options.containerId);\n\n\t\tfor (let page in this.pages)\n\t\t{\n\t\t\tthis.pages[page].container = Tag.render`<div class=\"landing-settings-page-container\"></div>`;\n\t\t\tDom.append(this.pages[page].container, this.container);\n\t\t}\n\t\tthis.loadingPages = [];\n\n\t\tthis.loaderContainer = Tag.render`<div class=\"landing-settings-loader-container\"></div>`;\n\t\tDom.insertAfter(this.loaderContainer, this.container);\n\t\tthis.loader = new Loader({target: this.loaderContainer});\n\n\t\t// links\n\t\tthis.links = document.getElementById(options.menuId).querySelectorAll('li a');\n\t\tlet currentLink = this.links[0];\n\t\tthis.links.forEach(link =>\n\t\t{\n\t\t\tEvent.bind(link, 'click', (event) =>\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tthis.onLinkClick(link)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tlink.dataset.page\n\t\t\t\t&& this.pages[link.dataset.page]\n\t\t\t\t&& this.pages[link.dataset.page].current === true\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrentLink = link;\n\t\t\t}\n\t\t});\n\t\tif (currentLink)\n\t\t{\n\t\t\tthis.onLinkClick(currentLink);\n\t\t}\n\n\t\t// save\n\t\tthis.saveButton = document.getElementById(options.saveButtonId);\n\t\tthis.onSave = this.onSave.bind(this);\n\t\tEvent.bind(this.saveButton, 'click', this.onSave);\n\t}\n\n\tshowLoader()\n\t{\n\t\tthis.loader.show();\n\t\tDom.show(this.loaderContainer);\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.loader.hide();\n\t\tDom.hide(this.loaderContainer);\n\t}\n\n\tonLinkClick(link: HTMLAnchorElement)\n\t{\n\t\tif (link.dataset.page)\n\t\t{\n\t\t\tthis.onPageChange(link.dataset.page);\n\t\t}\n\t\telse if (link.dataset.placement)\n\t\t{\n\t\t\t// for open app pages in slider\n\t\t\tif (\n\t\t\t\ttypeof BX.rest !== 'undefined' &&\n\t\t\t\ttypeof BX.rest.Marketplace !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.rest.Marketplace.bindPageAnchors({});\n\t\t\t}\n\t\t\tBX.rest.AppLayout.openApplication(\n\t\t\t\tlink.dataset.appId,\n\t\t\t\t{\n\t\t\t\t\tSITE_ID: this.siteId,\n\t\t\t\t\tLID: this.landingId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tPLACEMENT: link.dataset.placement,\n\t\t\t\t\tPLACEMENT_ID: link.dataset.placementId,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tonPageChange(pageId: string)\n\t{\n\t\tconst pageToLoad = this.pages[pageId];\n\t\tif (pageToLoad)\n\t\t{\n\t\t\tif (pageToLoad.container.childNodes.length === 0)\n\t\t\t{\n\t\t\t\tthis.showLoader();\n\t\t\t\tthis.loadingPages.push(pageId);\n\t\t\t\tAjax.get(pageToLoad.link, result =>\n\t\t\t\t{\n\t\t\t\t\tpageToLoad.container.innerHTML = result;\n\t\t\t\t\tthis.loadingPages.splice(this.loadingPages.indexOf(pageId), 1);\n\t\t\t\t\tif (this.loadingPages.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t}\n\t\t\t\t\tconst form = pageToLoad.container.querySelector('form.landing-form');\n\t\t\t\t\tif (form)\n\t\t\t\t\t{\n\t\t\t\t\t\tpageToLoad.form = form;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.currentPage)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentPage.container.hidden = true;\n\t\t\t\t\t}\n\t\t\t\t\tthis.currentPage = pageToLoad;\n\t\t\t\t\tthis.currentPage.container.hidden = false;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.currentPage)\n\t\t\t\t{\n\t\t\t\t\tthis.currentPage.container.hidden = true;\n\t\t\t\t}\n\t\t\t\tthis.currentPage = pageToLoad;\n\t\t\t\tthis.currentPage.container.hidden = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonSave()\n\t{\n\t\tthis.showLoader()\n\n\t\tconst submits = [];\n\t\tfor (let page in this.pages)\n\t\t{\n\t\t\tconst currPage = this.pages[page];\n\t\t\tif (currPage.form)\n\t\t\t{\n\t\t\t\tsubmits.push(\n\t\t\t\t\tfetch(currPage.linkToSave, {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tbody: new FormData(currPage.form),\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Bx-ajax': true,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tPromise.all(submits)\n\t\t\t.then((results: [Response]) =>\n\t\t\t{\n\t\t\t\tlet all = true;\n\t\t\t\tresults.forEach(result => {\n\t\t\t\t\tall = all && result.ok;\n\t\t\t\t});\n\t\t\t\tif (all)\n\t\t\t\t{\n\t\t\t\t\ttop.window['landingSettingsSaved'] = true;\n\t\t\t\t\ttop.BX.onCustomEvent('BX.Landing.Filter:apply');\n\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\ttop.window.location.reload();\n\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err =>\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n}"],"names":["LandingSettings","options","siteId","landingId","pages","container","document","getElementById","containerId","page","Tag","render","Dom","append","loadingPages","loaderContainer","insertAfter","loader","Loader","target","links","menuId","querySelectorAll","currentLink","forEach","link","Event","bind","event","preventDefault","stopPropagation","onLinkClick","dataset","current","saveButton","saveButtonId","onSave","show","hide","onPageChange","placement","BX","rest","Marketplace","bindPageAnchors","AppLayout","openApplication","appId","SITE_ID","LID","PLACEMENT","PLACEMENT_ID","placementId","pageId","pageToLoad","childNodes","length","showLoader","push","Ajax","get","result","innerHTML","splice","indexOf","hideLoader","form","querySelector","currentPage","hidden","submits","currPage","fetch","linkToSave","method","body","FormData","headers","Promise","all","then","results","ok","top","window","onCustomEvent","location","reload","SidePanel","Instance","close","err","console","error"],"mappings":"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"}