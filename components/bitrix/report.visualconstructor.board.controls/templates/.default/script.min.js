(function(){"use strict";BX.namespace("BX.Report.VisualConstructor.Board");BX.Report.VisualConstructor.Board.Controls=function(t){this.addFormSlider=null;this.reportCategories=t.reportCategories;this.configurationButton=t.configurationButton;this.boardId=t.boardId;this.demoToggle=t.demoToggle;this.init()};BX.Report.VisualConstructor.Board.Controls.prototype={init:function(){BX.bind(BX("add_report_popup_button"),"click",this.handlePopupButtonClick.bind(this));BX.bind(this.configurationButton,"click",this.handleConfigurationButtonClick.bind(this));BX.addCustomEvent("BX.Report.VisualConstructor.afterWidgetAdd",this.closeSlider.bind(this))},handleConfigurationButtonClick:function(){this.confirmationPopup=new BX.PopupWindow("visualconstructor-dashboard-configuration-popup",this.configurationButton,{title:"Select Row Layout",noAllPaddings:true,closeByEsc:true,autoHide:true,content:this.getConfigurationButtonLayout()});this.confirmationPopup.show()},handlePopupButtonClick:function(){this.openSlider()},openSlider:function(){this.addFormSlider=BX.SidePanel.Instance;this.addFormSlider.open("widget:add-widget-to-board",{cacheable:false,contentCallback:BX.delegate(function t(o){var e=new BX.Promise;BX.Report.VC.Core.ajaxGet("board.showAddForm",{urlParams:{categories:this.reportCategories,boardId:this.boardId},onFullSuccess:BX.delegate(function(t){o.getData().set("addFormContent",t.data);e.fulfill(t.data);var r=o.getContentContainer();r.addEventListener("scroll",function(){BX.Report.VC.PopupWindowManager.adjustPopupsPositions()})},this)});return e},this),animationDuration:100,width:950,events:{onLoad:function(t){var o=t.getSlider();BX.html(null,o.getData().get("addFormContent"))},onClose:function(){BX.Report.VC.PopupWindowManager.closeAllPopups()}}})},closeSlider:function(){this.addFormSlider.closeAll()},getConfigurationButtonLayout:function(){var t=[];t.push(BX.create("div",{attrs:{className:"visualconsructor-configuration-popup-item"},children:[BX.create("div",{text:this.getToggleBoardTitle(),attrs:{className:"visualconsructor-configuration-popup-item-text"}})],events:{click:BX.delegate(this.toggleBoard,this)}}));if(this.demoToggle){t.push(BX.create("div",{attrs:{className:"visualconsructor-configuration-popup-item"},children:[BX.create("div",{text:this.getDemoModeToggleButtonTitle(),attrs:{className:"visualconsructor-configuration-popup-item-text"}})],events:{click:BX.delegate(this.toggleDemoMode,this)}}))}return BX.create("div",{attrs:{className:"visualconsructor-configuration-popup-container"},children:t})},getToggleBoardTitle:function(){return BX.message("VISUALCONSTRUCTOR_DASHBOARD_GO_TO_DEFAULT")},getDesignerModeToggleButtonTitle:function(){var t=BX.VisualConstructor.BoardRepository.getBoard(this.boardId).getDashboard();return!t.isDesignerMode()?BX.message("VISUALCONSTRUCTOR_DASHBOARD_DESIGN_MODE_ON_TITLE"):BX.message("VISUALCONSTRUCTOR_DASHBOARD_DESIGN_MODE_OFF_TITLE")},getDemoModeToggleButtonTitle:function(){var t=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);return!t.isDemoMode()?BX.message("VISUALCONSTRUCTOR_DASHBOARD_DEMO_MODE_ON_TITLE"):BX.message("VISUALCONSTRUCTOR_DASHBOARD_DEMO_MODE_OFF_TITLE")},toggleBoard:function(){BX.Report.VC.Core.abortAllRunningRequests();BX.Report.VC.Core.ajaxPost("board.toggleToDefault",{data:{boardKey:this.boardId},onFullSuccess:BX.delegate(function(t){var o=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);if(!t.errors.length){o.getDashboard().clearRows();o.getDashboard().destroy();BX.Report.VC.Core.ajaxGet("widget.loadByBoardId",{urlParams:{boardId:this.boardId},onFullSuccess:BX.delegate(function(t){if(t.data.rows){o.getDashboard().addRows(t.data.rows);o.getDashboard().render()}},this)})}},this)});this.confirmationPopup.close()},toggleBoardDesignerMode:function(){var t=BX.VisualConstructor.BoardRepository.getBoard(this.boardId).getDashboard();t.toggleDesignerMode();this.confirmationPopup.close()},toggleDemoMode:function(){var t=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);t.toggleDemoMode();this.confirmationPopup.close()}}})();
//# sourceMappingURL=script.map.js