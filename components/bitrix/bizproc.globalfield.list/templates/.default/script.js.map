{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Type, Loc } from 'main.core';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { Globals } from 'bizproc.globals';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\nclass GlobalFieldListComponent\n{\n\tcomponentName: string;\n\tsignedParameters: string;\n\n\tgridId: string;\n\tsignedDocumentType: string;\n\tmode: string;\n\n\tslider: BX.SidePanel.Slider | null;\n\tsliderDict: BX.SidePanel.Dictionary | null;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options)) {\n\t\t\tthis.componentName = options.componentName;\n\t\t\tthis.signedParameters = options.signedParameters;\n\t\t\tthis.gridId = options.gridId;\n\t\t\tthis.signedDocumentType = options.signedDocumentType;\n\t\t\tthis.mode = options.mode;\n\n\t\t\tthis.slider = options.slider;\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.sliderDict = this.slider ? this.slider.getData() : null;\n\t}\n\n\tgetGrid(): BX.Main.grid | null\n\t{\n\t\tif (this.gridId) {\n\t\t\treturn BX.Main.gridManager && BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treloadGrid()\n\t{\n\t\tconst grid = this.getGrid();\n\t\tif (grid) {\n\t\t\tgrid.reload();\n\t\t}\n\t};\n\n\tonCreateButtonClick()\n\t{\n\t\tconst me = this;\n\t\tGlobals.Manager.Instance.createGlobals(this.mode, this.signedDocumentType)\n\t\t\t.then((slider) => me.onAfterUpsert(slider))\n\t\t;\n\t}\n\n\teditGlobalFieldAction(id, mode)\n\t{\n\t\tconst me = this;\n\t\tGlobals.Manager.Instance.editGlobals(id, mode, this.signedDocumentType)\n\t\t\t.then((slider) => me.onAfterUpsert(slider))\n\t\t;\n\t}\n\n\tonAfterUpsert(slider)\n\t{\n\t\tconst info = slider.getData().entries();\n\t\tconst keys = Object.keys(info);\n\t\tif (keys.length <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.sliderDict)\n\t\t{\n\t\t\tconst items = this.sliderDict.get('upsert') ?? {};\n\t\t\titems[keys[0]] = info[keys[0]];\n\t\t\tthis.sliderDict.set('upsert', items);\n\t\t}\n\n\t\tthis.reloadGrid();\n\t}\n\n\tgetDeletePhrase(mode): string\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_VARIABLE_DELETE');\n\t\t}\n\t\telse if (mode === Globals.Manager.Instance.mode.constant) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_CONSTANT_DELETE');\n\t\t}\n\t\telse {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tgetPluralDeletePhrase(mode): string\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_VARIABLES_DELETE');\n\t\t}\n\t\telse if (mode === Globals.Manager.Instance.mode.constant) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_CONSTANTS_DELETE');\n\t\t}\n\t\telse {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tdeleteGlobalFieldAction(id, mode)\n\t{\n\t\tconst me = this;\n\t\tconst message = this.getDeletePhrase(mode);\n\n\t\tnew MessageBox({\n\t\t\tmessage: message,\n\t\t\tokCaption: Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tGlobals.Manager.Instance.deleteGlobalsAction(id, mode, me.signedDocumentType).then((response) => {\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (me.sliderDict)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = me.sliderDict.get('delete') ?? [];\n\t\t\t\t\t\t\titems.push(id);\n\t\t\t\t\t\t\tme.sliderDict.set('delete', items);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.reloadGrid();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\n\t\t\t\t\t\tif (okBtn) {\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n\n\tdeleteFieldsAction(mode)\n\t{\n\t\tconst me = this;\n\t\tconst message = this.getPluralDeletePhrase(mode);\n\n\t\tnew MessageBox({\n\t\t\tmessage,\n\t\t\tokCaption: Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tBX.ajax.runComponentAction(me.componentName, 'processGridDelete', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\t\tdocumentType: this.signedDocumentType,\n\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\tids: this.getGrid().getRows().getSelectedIds()\n\t\t\t\t\t}\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (me.sliderDict)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = me.sliderDict.get('delete') ?? [];\n\t\t\t\t\t\t\tthis.getGrid().getRows().getSelectedIds()\n\t\t\t\t\t\t\t\t.forEach((id)=> {\n\t\t\t\t\t\t\t\t\titems.push(id);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tme.sliderDict.set('delete', items);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.reloadGrid();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\n\t\t\t\t\t\tif (okBtn) {\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n}\n\nnamespace.GlobalFieldListComponent = GlobalFieldListComponent;"],"names":["namespace","Reflection","GlobalFieldListComponent","options","Type","isPlainObject","componentName","signedParameters","gridId","signedDocumentType","mode","slider","sliderDict","getData","BX","Main","gridManager","getInstanceById","grid","getGrid","reload","me","Globals","Manager","Instance","createGlobals","then","onAfterUpsert","id","editGlobals","info","entries","keys","Object","length","items","get","set","reloadGrid","variable","Loc","getMessage","constant","message","getDeletePhrase","MessageBox","okCaption","onOk","deleteGlobalsAction","response","data","error","alert","push","buttons","MessageBoxButtons","OK_CANCEL","popupOptions","events","onAfterShow","event","okBtn","getTarget","getButton","getContainer","focus","show","getPluralDeletePhrase","ajax","runComponentAction","documentType","ids","getRows","getSelectedIds","forEach"],"mappings":"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"}