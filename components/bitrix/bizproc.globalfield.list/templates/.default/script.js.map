{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Type, Loc } from 'main.core';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { Globals } from 'bizproc.globals';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\nclass GlobalFieldListComponent\n{\n\tcomponentName: string;\n\tsignedParameters: string;\n\n\tgridId: string;\n\tsignedDocumentType: string;\n\tmode: string;\n\n\tslider: BX.SidePanel.Slider | null;\n\tsliderDict: BX.SidePanel.Dictionary | null;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options)) {\n\t\t\tthis.componentName = options.componentName;\n\t\t\tthis.signedParameters = options.signedParameters;\n\t\t\tthis.gridId = options.gridId;\n\t\t\tthis.signedDocumentType = options.signedDocumentType;\n\t\t\tthis.mode = options.mode;\n\n\t\t\tthis.slider = options.slider;\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.sliderDict = this.slider ? this.slider.getData() : null;\n\t}\n\n\tgetGrid(): BX.Main.grid | null\n\t{\n\t\tif (this.gridId) {\n\t\t\treturn BX.Main.gridManager && BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treloadGrid()\n\t{\n\t\tconst grid = this.getGrid();\n\t\tif (grid) {\n\t\t\tgrid.reload();\n\t\t}\n\t};\n\n\tonCreateButtonClick()\n\t{\n\t\tconst me = this;\n\t\tGlobals.Manager.Instance.createGlobals(this.mode, this.signedDocumentType)\n\t\t\t.then((slider) => me.onAfterUpsert(slider))\n\t\t;\n\t}\n\n\teditGlobalFieldAction(id, mode)\n\t{\n\t\tconst me = this;\n\t\tGlobals.Manager.Instance.editGlobals(id, mode, this.signedDocumentType)\n\t\t\t.then((slider) => me.onAfterUpsert(slider))\n\t\t;\n\t}\n\n\tonAfterUpsert(slider)\n\t{\n\t\tconst info = slider.getData().entries();\n\t\tconst keys = Object.keys(info);\n\t\tif (keys.length <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.sliderDict)\n\t\t{\n\t\t\tconst items = this.sliderDict.get('upsert') ?? {};\n\t\t\titems[keys[0]] = info[keys[0]];\n\t\t\tthis.sliderDict.set('upsert', items);\n\t\t}\n\n\t\tthis.reloadGrid();\n\t}\n\n\tgetDeletePhrase(mode): string\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_VARIABLE_DELETE');\n\t\t}\n\t\telse if (mode === Globals.Manager.Instance.mode.constant) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_CONSTANT_DELETE');\n\t\t}\n\t\telse {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tgetPluralDeletePhrase(mode): string\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_VARIABLES_DELETE');\n\t\t}\n\t\telse if (mode === Globals.Manager.Instance.mode.constant) {\n\t\t\treturn Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_CONFIRM_CONSTANTS_DELETE');\n\t\t}\n\t\telse {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tdeleteGlobalFieldAction(id, mode)\n\t{\n\t\tconst me = this;\n\t\tconst message = this.getDeletePhrase(mode);\n\n\t\tnew MessageBox({\n\t\t\tmessage: message,\n\t\t\tokCaption: Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tGlobals.Manager.Instance.deleteGlobalsAction(id, mode, me.signedDocumentType).then((response) => {\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (me.sliderDict)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = me.sliderDict.get('delete') ?? [];\n\t\t\t\t\t\t\titems.push(id);\n\t\t\t\t\t\t\tme.sliderDict.set('delete', items);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.reloadGrid();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\n\t\t\t\t\t\tif (okBtn) {\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n\n\tdeleteFieldsAction(mode)\n\t{\n\t\tconst me = this;\n\t\tconst message = this.getPluralDeletePhrase(mode);\n\n\t\tnew MessageBox({\n\t\t\tmessage,\n\t\t\tokCaption: Loc.getMessage('BIZPROC_GLOBALFIELDS_LIST_BTN_DELETE'),\n\t\t\tonOk: () => {\n\t\t\t\tBX.ajax.runComponentAction(me.componentName, 'processGridDelete', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\t\tdocumentType: this.signedDocumentType,\n\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\tids: this.getGrid().getRows().getSelectedIds()\n\t\t\t\t\t}\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tif (response.data && response.data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (me.sliderDict)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = me.sliderDict.get('delete') ?? [];\n\t\t\t\t\t\t\tthis.getGrid().getRows().getSelectedIds()\n\t\t\t\t\t\t\t\t.forEach((id)=> {\n\t\t\t\t\t\t\t\t\titems.push(id);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tme.sliderDict.set('delete', items);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.reloadGrid();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterShow: (event) => {\n\t\t\t\t\t\tconst okBtn = event.getTarget().getButton('ok');\n\n\t\t\t\t\t\tif (okBtn) {\n\t\t\t\t\t\t\tokBtn.getContainer().focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n}\n\nnamespace.GlobalFieldListComponent = GlobalFieldListComponent;"],"names":["namespace","Reflection","GlobalFieldListComponent","options","Type","isPlainObject","componentName","signedParameters","gridId","signedDocumentType","mode","slider","sliderDict","getData","BX","Main","gridManager","getInstanceById","grid","getGrid","reload","me","Globals","Manager","Instance","createGlobals","then","onAfterUpsert","id","editGlobals","info","entries","keys","Object","length","items","get","set","reloadGrid","variable","Loc","getMessage","constant","message","getDeletePhrase","MessageBox","okCaption","onOk","deleteGlobalsAction","response","data","error","alert","push","buttons","MessageBoxButtons","OK_CANCEL","popupOptions","events","onAfterShow","event","okBtn","getTarget","getButton","getContainer","focus","show","getPluralDeletePhrase","ajax","runComponentAction","documentType","ids","getRows","getSelectedIds","forEach"],"mappings":"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"}