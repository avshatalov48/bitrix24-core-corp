(function(e,t,i,n){"use strict";var a;var s=function(){function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"DOM",{});this.maxEntryAmount=i.maxEntryAmount||5;if(i&&i.entries){this.renderList(i.entries)}else{this.displayEventList()}this.displayEventListDebounce=t.Runtime.debounce(this.displayEventList,3e3,this);t.Event.bind(document,"visibilitychange",this.checkDisplayEventList.bind(this));n.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.checkDisplayEventList.bind(this));n.EventEmitter.subscribe("onPullEvent-calendar",this.displayEventListDebounce)}babelHelpers.createClass(e,[{key:"checkDisplayEventList",value:function e(){if(this.needReload){this.displayEventListDebounce()}}},{key:"displayEventList",value:function e(){var t=this;if(this.isDisplayingNow()){this.showLoader();this.getEventList().then((function(e){t.hideLoader();t.renderList(e)}))}else{this.needReload=true}}},{key:"getEventList",value:function e(){var t=this;return new Promise((function(e){BX.ajax.runAction("calendar.api.calendarentryajax.getnearestevents",{data:{ownerId:t.ownerId,type:t.type,futureDaysAmount:60,maxEntryAmount:t.maxEntryAmount}}).then((function(t){var i;e(t===null||t===void 0?void 0:(i=t.data)===null||i===void 0?void 0:i.entries)}))}))}},{key:"showWidget",value:function e(){this.getOuterWrap().style.display=""}},{key:"hideWidget",value:function e(){this.getOuterWrap().style.display="none"}},{key:"showLoader",value:function e(){this.hideLoader();this.DOM.loader=this.getEventListWrap().appendChild(i.Util.getLoader(40,"next-events-loader"))}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader)}}},{key:"renderList",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!t.Type.isArray(n)){n=[]}n=n.slice(0,this.maxEntryAmount);t.Dom.clean(this.getEventListWrap());var a=this.getEventListWrap();n.forEach((function(e,t){if(t===0){i.setReloadTimeout(e)}a.appendChild(i.renderEntry(e))}));if(n.length){this.showWidget()}else{this.hideWidget()}this.needReload=false}},{key:"renderEntry",value:function e(i){var n=BX.Calendar.Util.parseDate(i["DATE_FROM"]);return t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a href="','" class="sidebar-widget-item">\n\t\t\t\t<span class="calendar-item-date">','</span>\n\t\t\t\t<span class="calendar-item-text">\n\t\t\t\t\t<span class="calendar-item-link">','</span>\n\t\t\t\t</span>\n\t\t\t\t<span class="calendar-item-icon">\n\t\t\t\t\t<span class="calendar-item-icon-day">','</span>\n\t\t\t\t\t<span class="calendar-item-icon-date">',"</span>\n\t\t\t\t</span>\n\t\t\t</a>\n\t\t"])),t.Text.encode(i["~URL"]),i["~FROM_TO_HTML"],t.Text.encode(i["NAME"]),t.Text.encode(i["~WEEK_DAY"]),n.getDate())}},{key:"getOuterWrap",value:function e(){if(!this.DOM.outerWrap){this.DOM.outerWrap=document.querySelector(".sidebar-widget.sidebar-widget-calendar")}return this.DOM.outerWrap}},{key:"getEventListWrap",value:function e(){if(!this.DOM.listWrap){this.DOM.listWrap=this.getOuterWrap().querySelector(".calendar-events-wrap")}return this.DOM.listWrap}},{key:"setReloadTimeout",value:function e(i){if(this.reloadTimeout){clearTimeout(this.reloadTimeout);this.reloadTimeout=null}var n=BX.Calendar.Util.parseDate(i["DATE_TO"]);if(t.Type.isDate(n)){var a=new Date;var s=Math.min(Math.max(n.getTime()-a.getTime()+6e4,6e4),864e5);this.reloadTimeout=setTimeout(this.displayEventList.bind(this),s)}}},{key:"isDisplayingNow",value:function e(){return!document.hidden&&!BX.SidePanel.Instance.getOpenSliders().length}}]);return e}();t.Reflection.namespace("BX.Calendar").NextEventList=s})(this.window=this.window||{},BX,BX.Calendar,BX.Event);
//# sourceMappingURL=script.map.js