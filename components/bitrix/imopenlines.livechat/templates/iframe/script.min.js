function LiveChatBackend(e){this.init=function(e){this.initParams=e;this.timeout={};this.postMessageDomain=null;this.postMessageOrigin=null;this.postMessageSource=null;this.initFrameParameters();this.initEvent()};this.initFrameParameters=function(){if(!this.isFrame()){return}if(!window.location.hash){return}var e={};try{e=JSON.parse(decodeURIComponent(window.location.hash.substring(1)))}catch(e){}if(e.domain){this.postMessageDomain=e.domain}};this.isFrame=function(){return window!=window.top};this.initEvent=function(){if(!this.isFrame()){return}if(typeof window.postMessage==="function"){BX.bind(window,"message",BX.proxy(function(e){if(e&&e.origin==this.postMessageDomain){var s={};try{s=JSON.parse(e.data)}catch(e){}if(s.action=="init"){this.uniqueLoadId=s.uniqueLoadId;this.postMessageSource=e.source;this.postMessageOrigin=e.origin;this.postMessageStartShowed=s.showed;var t={};t["uniqueLoadId"]=this.uniqueLoadId;t["action"]="init";t["title"]=this.initParams.LINE_NAME;t["connectors"]=this.initParams.CONNECTORS;t["queue"]=this.initParams.QUEUE;t["showedDialog"]=this.showedDialog?"Y":"N";if(this.initParams.ERROR_CODE){t["errorCode"]=this.initParams.ERROR_CODE}this.sendDataToFrameHolder(t);if(typeof BXIM!="undefined"){BXIM.messenger.popupMessengerTextarea.value=s.textarea;BXIM.messenger.textareaCheckText();if(this.postMessageStartShowed){setTimeout(function(){BXIM.messenger.popupMessengerTextarea.focus()},200)}}else{BX.addCustomEvent("onImInit",BX.delegate(function(e){e.messenger.popupMessengerTextarea.value=s.textarea;e.messenger.textareaCheckText();if(this.postMessageStartShowed){setTimeout(function(){e.messenger.popupMessengerTextarea.focus()},200)}},this))}}else if(s.action=="message"){BXIM.messenger.popupMessengerTextarea.value=s.text;BXIM.messenger.sendMessage(BXIM.messenger.currentTab)}else if(s.action=="textareaFocus"){setTimeout(function(){if(typeof BXIM!="undefined"){BXIM.messenger.popupMessengerTextarea.focus()}},200)}}},this))}BX.addCustomEvent("onImTextareaFocus",BX.delegate(function(e){var s={};s["uniqueLoadId"]=this.uniqueLoadId;s["action"]=e?"textareaFocused":"textareaBlured";this.sendDataToFrameHolder(s)},this));BX.addCustomEvent("onImDrawTab",BX.delegate(function(e){if(e.hasMessage){this.showedDialog=true;var s={};s["uniqueLoadId"]=this.uniqueLoadId;s["action"]="showDialog";this.sendDataToFrameHolder(s)}},this));BX.addCustomEvent("onImBeforeMessageSend",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="sendMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImMessageRead",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="readMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImMessageReceive",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="receiveMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImResizeTextarea",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="resizeTextarea";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenFileMenu",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openFileMenu";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenSmileMenu",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openSmileMenu";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenFrameDialog",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openFrameDialog";this.sendDataToFrameHolder(e)},this))};this.sendDataToFrameHolder=function(e){var s=JSON.stringify(e);if(!this.postMessageOrigin){clearTimeout(this.timeout[s]);this.timeout[s]=setTimeout(BX.delegate(function(){this.sendDataToFrameHolder(e)},this),10);return true}if(typeof window.postMessage==="function"){if(this.postMessageSource){this.postMessageSource.postMessage(s,this.postMessageOrigin)}}var t=0;if(t){var i=window.location.hash.substring(1);top.location=i.substring(0,i.indexOf("#"))+"#"+s}};this.init(e)}function ImExtendLinesLivechatFormShow(e,s,t){var i=BX.message("PHONE_BASE_LANG")=="ru"||BX.message("PHONE_BASE_LANG")=="ua";if(this.popupMessengerLiveChatFormStage==e+"-"+s){return true}if(e!="done"){this.popupMessengerDialog.className="bx-messenger-box-dialog bx-messenger-chat-livechat"}this.popupMessengerLiveChatFormType=e;this.popupMessengerLiveChatFormStage=e+"-"+s;this.popupMessengerBodyLiveChatForm.className="bx-messenger-livechat-form";clearTimeout(this.popupMessengerLiveChatActionTimeout);var a=BX.MessengerCommon.livechatGetSession(this.currentTab.toString().substr(4));if(a.showForm=="N"){}else if(e=="offline"){if(typeof this.phones[this.BXIM.userId]!="undefined"||this.BXIM.userEmail){return false}if(!s||s==1){BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_OFFLINE")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"offline"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_NEW"),name:"email"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){this.tooltipClose();if(e.keyCode==9||e.keyCode==13){this.linesLivechatFormShow("offline",2)}if(e.ctrlKey||e.metaKey||e.shiftKey){return true}if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){setTimeout(BX.proxy(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12})},this),500)}}clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormShow("offline",2)},this),500)},this),blur:BX.delegate(function(){if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.delegate(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12})},this),500)}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("span",{props:{className:"bx-messenger-livechat-form-input-flag"}}),BX.create("input",{attrs:{name:i?"":"phone",placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_PHONE")},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-phone",value:BX.message("PHONE_CODE")},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}}),i?BX.create("input",{attrs:{type:"hidden",name:"phone"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-hidden"}}):null]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_NAME_NEW"),name:"name",value:this.BXIM.messenger.users[this.BXIM.userId].name==BX.message("DEFAULT_GUEST_NAME")?"":this.BXIM.messenger.users[this.BXIM.userId].name},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-name"},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_SEND")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(!s.value||!s.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){this.tooltip(s,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12});s.focus()}else{var t={};BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();t[e.name]=e.value;return true});this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_OFFLINE"),values:t})}return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-offline-1");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active");var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-phone");if(i){new BXMaskedPhone({url:BX.message("PHONE_BASE_PATH"),country:BX.message("PHONE_BASE_LANG"),maskedInput:{input:e,dataInput:e.nextElementSibling},flagNode:e.previousElementSibling,flagSize:24})}else{e.previousElementSibling.style.display="none";e.style.paddingLeft="13px"}},this)()}if(s==2){BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-offline-2");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}}else if(e=="welcome"){if(typeof this.phones[this.BXIM.userId]!="undefined"||this.BXIM.userEmail||this.users[this.BXIM.userId].name!=BX.message("DEFAULT_GUEST_NAME")){return false}if(!s||s==1){BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_WELCOME")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"welcome"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_NAME_NEW"),name:"name"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-name"},events:{keydown:BX.delegate(function(e){if(e.keyCode==9||e.keyCode==13){this.linesLivechatFormShow("welcome",2)}if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}if(e.ctrlKey||e.metaKey||e.shiftKey){return true}clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormShow("welcome",2)},this),500)},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_NEW"),name:"email"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();if(BX.proxy_context.value&&!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){setTimeout(BX.proxy(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12})},this),500)}}},this),blur:BX.delegate(function(){if(BX.proxy_context.value&&!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.delegate(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12})},this),500)}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("span",{props:{className:"bx-messenger-livechat-form-input-flag"}}),BX.create("input",{attrs:{name:i?"":"phone",placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_PHONE")},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-phone",value:BX.message("PHONE_CODE")},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}}),i?BX.create("input",{attrs:{type:"hidden",name:"phone"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-hidden"}}):null]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_SEND")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=true;var t=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(t.value&&!t.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(!this.tooltipIsOpen()){this.tooltip(t,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12});s=false}}if(s){this.tooltipClose();var i={};var a=false;BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();i[e.name]=e.value;if(e.value&&e.name!="FORM"){a=true}return true});if(a){this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_WELCOME"),values:i})}else{this.linesLivechatFormHide()}}return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-welcome-1");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active");var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-phone");if(i){new BXMaskedPhone({url:BX.message("PHONE_BASE_PATH"),country:BX.message("PHONE_BASE_LANG"),maskedInput:{input:e,dataInput:e.nextElementSibling},flagNode:e.previousElementSibling,flagSize:24})}else{e.previousElementSibling.style.display="none";e.style.paddingLeft="13px"}},this)()}if(s==2){BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-welcome-2");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}}else if(e=="history"){if(a.sessionId<=0)return false;BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_HISTORY_NEW")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"history"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_NEW"),name:"email",value:this.BXIM.userEmail},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){this.tooltipClose();if(e.keyCode==9||e.keyCode==13){if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){this.tooltip(BX.proxy_context,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_2_NEW"),{offsetTop:10,offsetLeft:12});BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();return BX.PreventDefault(e)}else if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_YES")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=true;var t=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(!t.value||!t.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(!this.tooltipIsOpen()){this.tooltip(t,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_NEW"),{offsetTop:10,offsetLeft:12})}t.focus();s=false}if(s){this.tooltipClose();var i={};BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();i[e.name]=e.value;return true});this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_HISTORY"),values:i})}return BX.PreventDefault(e)},this)}}),BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_NO")},props:{className:"bx-messenger-livechat-form-cancel"},events:{click:BX.delegate(function(e){this.tooltipClose();this.linesLivechatFormShow();return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-history");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}else if(e=="done"){var n=t.text.length<=27;BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text-block-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text-block"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-icon-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-icon"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text"+(n?"":" bx-messenger-livechat-form-done-text-small")},html:t.text})]})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add(n?"bx-messenger-livechat-form-done-small":"bx-messenger-livechat-form-done");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)();clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormHide()},this),(n?3:5)*1e3);if(t.values){this.linesLivechatFormSend(t.values)}this.popupMessengerTextarea.focus()}else{this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-animation");clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){BX.cleanNode(this.popupMessengerBodyLiveChatForm)},this),1e3);this.popupMessengerTextarea.focus()}BX.MessengerCommon.linesBodyScroll();return true}function ImExtendLinesLivechatFormSend(e){var s=this.currentTab.substr(4);if(this.blockJoinChat[s])return false;if(this.chat[s]&&this.chat[s].entity_type!="LIVECHAT")return false;if(!BX.MessengerCommon.userInChat(s))return false;this.blockJoinChat[s]=true;var t=e.FORM?e.FORM.toUpperCase():null;if(!t)return false;delete e.FORM;if(typeof e.NAME!="undefined"){this.users[this.BXIM.userId].name=e.NAME}if(t!="HISTORY"&&typeof e.EMAIL!="undefined"){this.BXIM.userEmail=e.EMAIL}if(typeof e.PHONE!="undefined"){if(!this.phones[this.BXIM.userId]){this.phones[this.BXIM.userId]={}}this.phones[this.BXIM.userId]["PERSONAL_MOBILE"]=e.PHONE}this.popupMessengerLiveChatLastSend=+new Date;BX.ajax({url:this.BXIM.pathToAjax+"?LINES_LIVECHAT_FORM&V="+this.BXIM.revision,method:"POST",dataType:"json",timeout:60,data:{COMMAND:"sendLivechatForm",CHAT_ID:s,FORM:t,FIELDS:e,IM_OPEN_LINES_CLIENT:"Y",IM_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(){this.blockJoinChat[s]=false},this),onfailure:BX.delegate(function(){this.blockJoinChat[s]=false},this)});return true}if(!window.LiveChatBackendInit){window.LiveChatBackendInit=true;BX.addCustomEvent(window,"onImInit",function(e){e.messenger.linesLivechatFormShow=ImExtendLinesLivechatFormShow;e.messenger.linesLivechatFormSend=ImExtendLinesLivechatFormSend})}
//# sourceMappingURL=script.map.js