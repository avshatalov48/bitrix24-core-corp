function BXMaskedInput(t){this.defaultDefinitions={cypher:{"char":"9",rule:"[0-9]"},hexrgb:{"char":"h",rule:"[A-Fa-f0-9]"},lang_en:{"char":"a",rule:"[a-zA-Z]"}};this.init(t)}BXMaskedInput.prototype={init:function(t){t.definitions=t.definitions||["cypher","lang_en"];this.initDefinitions(t.definitions);this.placeholder=(t.placeholder||"_").substring(0,1);this.mask=t.mask||"";this.initInput(t);this.setChangeEventFiring(true)},setMask:function(t){if(this.mask==t){return}var e=this.getValueClean();this.mask=t;this.setChangeEventFiring(false);this.setValue(e);this.setChangeEventFiring(true)},getMask:function(){return this.mask},setValue:function(t){if(!this.mask){this.input.val(t);this.fireChangeEvent();return}var e=this.input.getSelectionStart();this.moveCaret(0);this.input.val(this.mask);var n=0;for(var i=0;i<this.mask.length;i++){if(!this.isMaskCharReplaceable(i)){this.replaceChar(i,this.mask.charAt(i));continue}while(true){var s=t.charAt(n);if(!s){s=this.placeholder;break}if(s==this.placeholder){break}if(this.testChar(i,s)){break}n++}this.replaceChar(i,s);n++}this.moveCaret(e);this.fireChangeEvent()},getValue:function(){return this.input.val()},getFirstEmptyPosition:function(){var t=this.getValue();for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}var n=t.charAt(e);if(n==this.placeholder){return e}}return null},getValueClean:function(){var t="";var e=this.getValue();if(!this.mask){return e}for(var n=0;n<e.length;n++){if(!this.isMaskCharReplaceable(n)){continue}var i=e.charAt(n);t+=i==this.placeholder?"":i}return t},checkValue:function(){var t=this.getValue();if(!this.mask){return t}for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}if(t.charAt(e)==this.placeholder){return false}}return true},onInputDelete:function(t){if(this.deleteSelection()){this.fireChangeEvent();return}var e=this.input.getSelectionStart();if(t){if(e===this.mask.length){this.replaceChar(e-1,this.placeholder)}else{this.shift(e,e-1)}this.moveCaret(e-1)}else{if(e===this.mask.length-1){this.replaceChar(e,this.placeholder)}else if(e<this.mask.length-1){this.shift(e+1,e)}this.moveCaret(e)}this.fireChangeEvent()},onInputPaste:function(t){this.deleteSelection();for(var e=0;e<t.length;e++){this.setCharOnCaret(t.charAt(e))}this.fireChangeEvent()},onInputChange:function(t){if(this.input.val()==""&&this.mask){this.input.val(this.getMaskedPlaceholder());this.input.setCaretPosition(0)}this.deleteSelection();this.setCharOnCaret(t);this.fireChangeEvent()},moveCaret:function(t){if(t>this.mask.length){t=this.mask.length}else if(t<0){t=0}else if(t===null){return this.input.getSelectionStart()}this.input.setCaretPosition(t);return t},findClosestAllowPosition:function(t,e,n){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=null}if(typeof n==="undefined"){n=false}while(true){if(!n&&t>=this.mask.length){return null}else if(n&&t<=0){return 0}if(this.isMaskCharReplaceable(t)){break}if(!n){t++}else{t--}}if(!this.isMaskCharReplaceable(t)){return null}if(e&&!this.testChar(t,e)){return null}return t},setCharOnCaret:function(t){var e=this.input.getSelectionStart();e=this.findClosestAllowPosition(e,t);if(e===null){return}this.shift(e,e+1);e=this.replaceChar(e,t);if(e===null){return}e=this.findClosestAllowPosition(e+1);this.moveCaret(e);if(BX.browser.IsAndroid()){if(this.input.detectAndroidVersion&&this.input.detectAndroidVersion()<7){var n=this;setTimeout(function(){n.moveCaret(e)},50)}}},shift:function(t,e){var n,i=null;var s=[];for(n=t;n<this.mask.length;n++){if(!this.isMaskCharReplaceable(n))continue;var a=this.input.val();s.push(a.charAt(n));this.replaceChar(n,this.placeholder)}s.reverse();for(n=e;n<this.mask.length;n++){if(!this.isMaskCharReplaceable(n))continue;if(s.length>0){i=s.pop()}else{i=this.placeholder}this.replaceChar(n,i)}},deleteSelection:function(){var t=this.input.getSelectionStart();var e=this.input.getSelectionEnd();if(t==e){return false}for(var n=t;n<e;n++){if(!this.isMaskCharReplaceable(n)){continue}this.replaceChar(n,this.placeholder)}this.shift(e,t);this.moveCaret(t);return true},setChangeEventFiring:function(t){this.stopChangeEvent=!t},fireChangeEvent:function(){if(!this.stopChangeEvent){BX.onCustomEvent(this,"change",[this.getValueClean(),this.getValue()])}},replaceChar:function(t,e){if(isNaN(t)){return null}var n=this.input.val();var i=n.substring(0,t)+e;i+=t>=n.length?"":n.substring(t+1);n=i;this.input.val(n);return t},isMaskCharReplaceable:function(t){var e=this.mask.charAt(t);if(!e){return false}return!!this.definitions[e]},getMaskedPlaceholder:function(){var t="";for(var e=0;e<this.mask.length;e++){var n=this.mask[e];if(this.definitions[n]){n=this.placeholder}t+=n}return t},initInput:function(t){if(t.input.tagName=="INPUT"){this.input=new BXMaskedInputElement({node:t.input})}else{this.input=new BXMaskedTextElement({node:t.input})}this.dataInput=t.dataInput||null;this.isDataInputClean=t.isDataInputClean||false;this.isHoldOverInputValueInit=t.isHoldOverInputValueInit||false;this.onDataInputChange=t.onDataInputChange||null;this.onDataInputInitValue=t.onDataInputInitValue||null;this.enableCheckingValue=t.enableCheckingValue||false;BX.addCustomEvent(this.input,"change",BX.proxy(this.onInputChange,this));BX.addCustomEvent(this.input,"paste",BX.proxy(this.onInputPaste,this));BX.addCustomEvent(this.input,"delete",BX.proxy(this.onInputDelete,this));BX.bind(this.input.node,"focus",BX.proxy(function(){if(this.getFirstEmptyPosition()===null){return}setTimeout(BX.proxy(function(){this.moveCaret(this.getFirstEmptyPosition())},this),50)},this));if(!this.isHoldOverInputValueInit&&!this.test(this.input.val())){this.input.val(this.getMaskedPlaceholder())}if(this.dataInput){var e=this.dataInput.value;if(BX.type.isFunction(this.onDataInputInitValue)){e=this.onDataInputInitValue.apply(this,[e])}if(BX.type.isString(e)&&e.length>0){this.setValue(e)}BX.addCustomEvent(this,"change",BX.proxy(function(){var t="";if(BX.type.isFunction(this.onDataInputChange)){t=this.onDataInputChange.apply(this,[this.getValueClean(),this.getValue()])}else if(this.isDataInputClean){t=this.getValueClean()}else{t=this.getValue()}if(!BX.type.isString(t)){t=""}if(this.enableCheckingValue&&!this.checkValue()){t=""}this.dataInput.value=t},this))}},initDefinitions:function(t){this.definitions={};this.charTests=[];t.forEach(function(t){if(BX.type.isString(t)&&this.defaultDefinitions[t]){t=this.defaultDefinitions[t]}if(BX.type.isPlainObject(t)){var e={rule:t.rule,isFunction:false};if(BX.type.isFunction(t.rule)){e.isFunction=true}else{e.regexp=new RegExp(t.rule)}this.definitions[t.char]=e}},this)},test:function(t){for(var e=0;e<t.length;e++){var n=this.testChar(e,t[e]);if(!n){return false}}return true},testChar:function(t,e){var n=this.mask[t];if(!this.definitions[n]){return e===n}var i=true;if(this.definitions[n].isFunction){i=!!this.definitions[n].func.apply(this,[e])}else{i=this.definitions[n].regexp.test(e)}return i}};function BXMaskedInputElement(t){this.node=t.node;BX.bind(this.node,"paste",BX.proxy(this.onChange,this));BX.bind(this.node,"keypress",BX.proxy(this.onChange,this));if(BX.browser.IsAndroid()&&this.detectAndroidVersion()<7){BX.bind(this.node,"textInput",BX.proxy(this.onAndroidInput,this));BX.bind(this.node,"keydown",BX.proxy(this.onAndroidInput,this))}else{BX.bind(this.node,"keydown",BX.proxy(this.onChange,this))}}BXMaskedInputElement.prototype={skipTextInputEvent:false,val:function(t){if(typeof t!="undefined"){this.node.value=t}return this.node.value},detectAndroidVersion:function(){var t=new RegExp("Android ([0-9]+[.0-9]*)");if(t.exec(navigator.userAgent)!=null)return parseFloat(RegExp.$1);else return 0},onAndroidInput:function(t){var e=0;if(t.type=="keydown"){e=typeof t.which=="number"?t.which:t.keyCode;if(e!=8){if(t.key=="Unidentified"){this.skipTextInputEvent=false;BX.PreventDefault(t);return false}else{this.skipTextInputEvent=true}}}else{if(this.skipTextInputEvent){BX.PreventDefault(t);return false}e=t.data.toUpperCase().charCodeAt(0)}var n={keyCode:e,which:e,type:"keydown"};return this.onChange(n,t)},onChange:function(t,e){var n=true;var i=typeof t.which=="number"?t.which:t.keyCode;if(i<=0){return}switch(t.type){case"keydown":n=!t.ctrlKey&&!t.altKey&&!t.metaKey&&(i&&(i>46&&i<=90||i>145||i===13||i===8||i===46||BX.browser.IsIOS()&&i===127));break;case"keypress":break}if(!n){return}BX.PreventDefault(e||t);if(t.type=="paste"){var s=t.clipboardData||window.clipboardData;var a=s.getData("Text");BX.onCustomEvent(this,"paste",[a])}else if(i===8||i===46||BX.browser.IsIOS()&&i===127){var r=i===8;BX.onCustomEvent(this,"delete",[r])}else{var h=String.fromCharCode(i);BX.onCustomEvent(this,"change",[h])}},setCaretPosition:function(t){this.node.setSelectionRange(t,t)},getSelectionStart:function(){if(this.node.selectionStart){return this.node.selectionStart}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveEnd("character",this.node.value.length);if(t.text==""){return this.node.value.length}else{return this.node.value.lastIndexOf(t.text)}}else{return 0}},getSelectionEnd:function(){if(this.node.selectionEnd){return this.node.selectionEnd}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveStart("character",-this.node.value.length);return t.text.length}else{return 0}}};function BXMaskedTextElement(t){this.node=t.node}BXMaskedTextElement.prototype={val:function(t){if(typeof t!="undefined"){this.node.innerText=t}return this.node.innerText},onChange:function(t){},setCaretPosition:function(t){},getSelectionStart:function(){return 0},getSelectionEnd:function(){return 0}};function BXMaskedPhone(t){this.country=t.country||this.getBrowserCountry();this.onChangeMask=t.onChangeMask||null;this.onChangeFlag=t.onChangeFlag||null;this.url=t.url||"/upload/callback/base";this.flagSize=t.flagSize&&BX.util.in_array(parseInt(t.flagSize),[16,24,32])?t.flagSize:16;this.flagNode=t.flagNode&&BX.type.isDomNode(t.flagNode)?t.flagNode:null;if(t.maskedInput instanceof BXMaskedInput){this.maskedInput=t.maskedInput}else if(BX.type.isPlainObject(t.maskedInput)){t.maskedInput.onDataInputChange=t.maskedInput.onDataInputChange||this.onDataInputChange;t.maskedInput.isHoldOverInputValueInit=true;t.maskedInput.enableCheckingValue=true;this.maskedInput=new BXMaskedInput(t.maskedInput)}else{throw Error('Parameter "maskedInput" not found.')}this.current=null;this.wasInited=false;BX.addCustomEvent(this.maskedInput,"change",BX.proxy(this.onChange,this));BX.addCustomEvent(window,"bx-masked-phone-codes-loaded",BX.proxy(this.onCodesLoaded,this));if(this.codes===null){BXMaskedPhone.prototype.codes=[];this.loadJson()}else if(this.codes.length>0){this.onCodesLoaded()}}BXMaskedPhone.prototype={codes:null,loadJson:function(t){var e=(t?"country_"+t:"countries")+".json";var n=this;BX.ajax.load({url:this.url+"/"+e,type:"json",callback:function(e){n.prepareDataCodes(e,t)}})},findCurrent:function(t){t=this.getCyphers(t||"");if(this.codes.length<=0){return}var e=this.country;if(t.length==0&&(!e||e.length==0)){return}var n=null;var i=null;for(var s=0;s<this.codes.length;s++){n=null;i=null;var a=this.codes[s];if(!a||!a.code||!a.data){continue}if(t){if(t.substring(0,a.code.length)!=a.code){continue}}else if(e){for(var r=0;r<a.data.length;r++){if(e==a.data[r].id){i=a.data[r]}}if(!i){continue}}n=a;if(!i){i=a.data[0]}break}this.current=null;if(!n&&!i){return}this.current=i;this.current.code=n.code;if(this.current.codes===true){this.current.codes=[];this.loadJson(this.current.id)}},findMaskByValue:function(t){t=this.getCyphers(t||"");var e=this.current.mask;if(BX.type.isArray(this.current.codes)){filtered=null;for(var n=0;n<this.current.codes.length;n++){var i=this.current.codes[n];if(!i.code){continue}if(t.substring(0,i.code.length)!=i.code){continue}if(!filtered||i.code.length>filtered.code.length){filtered=i}}if(filtered){e=filtered.mask}}return e},getCyphers:function(t){var e="";for(var n=0;n<t.length;n++){var i=t.charAt(n);if(!i){break}if(isNaN(i)){continue}e+=i}return e},changeMask:function(){var t=this.maskedInput.getValueClean();this.findCurrent(t);if(!this.current){this.changeFlag();return}var e=this.findMaskByValue(t);e=e.replace(new RegExp("_","g"),"9");this.maskedInput.setMask(e);if(!this.wasInited){if(!t){this.maskedInput.setChangeEventFiring(false);this.maskedInput.setValue(this.current.code);this.maskedInput.setChangeEventFiring(true)}this.maskedInput.moveCaret(this.maskedInput.getFirstEmptyPosition());this.wasInited=true}if(this.onChangeMask){this.onChangeMask.apply(this,[e])}this.changeFlag()},onCodesLoaded:function(){this.changeMask()},prepareDataCodes:function(t,e){if(!t){return}if(!e&&this.codes.length==0){BXMaskedPhone.prototype.codes=t;BX.onCustomEvent(window,"bx-masked-phone-codes-loaded")}else{if(this.current.id===e){this.current.codes=t}this.onCodesLoaded()}},onDataInputChange:function(t,e){return"+"+t},onChange:function(t,e){this.changeMask()},changeFlag:function(){var t=this.current?this.current.id:"";if(this.onChangeFlag){this.onChangeFlag.apply(this,[t,this.flagSize])}if(!this.flagNode){return}var e=this.flagNode.className.split(" ");if(e){e.forEach(function(t){if(t.length==2){BX.removeClass(this.flagNode,t)}},this)}BX.addClass(this.flagNode,"bx-flag-"+this.flagSize);BX.addClass(this.flagNode,t)},getBrowserCountry:function(){var t=window.navigator.languages?window.navigator.languages[0]:null;t=t||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;if(t.indexOf("-")!==-1){t=t.split("-")[1]}if(!t&&t.indexOf("_")!==-1){t=t.split("_")[0]}return t?t.toLowerCase():"us"}};
//# sourceMappingURL=masked.map.js