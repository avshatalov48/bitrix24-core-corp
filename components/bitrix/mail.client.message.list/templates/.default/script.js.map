{"version":3,"file":"script.js","sources":["src/js/progressbar.es6.js","src/js/counters.es6.js","src/js/leftmenu.es6.js","src/js/list.es6.js","script.es6.js"],"sourcesContent":["export class ProgressBar\n{\n\t#node;\n\t#errorTitleNode;\n\t#errorTextNode;\n\t#errorBoxNode;\n\t#syncButton;\n\t#errorHintNode;\n\n\tconstructor(node)\n\t{\n\t\tthis.#node = node;\n\t}\n\n\tsetSyncButton(button)\n\t{\n\t\tthis.#syncButton = button;\n\t}\n\n\tgetSyncButton()\n\t{\n\t\treturn this.#syncButton;\n\t}\n\n\tgetErrorBoxNode()\n\t{\n\t\treturn this.#errorBoxNode;\n\t}\n\n\tsetErrorBoxNode(errorBoxNode)\n\t{\n\t\tthis.#errorBoxNode = errorBoxNode;\n\t}\n\n\tsetErrorTitleNode(errorTitleNode)\n\t{\n\t\tthis.#errorTitleNode = errorTitleNode;\n\t}\n\n\tsetErrorTextNode(errorTextNode)\n\t{\n\t\tthis.#errorTextNode = errorTextNode;\n\t}\n\n\tsetErrorHintNode(errorHintNode)\n\t{\n\t\tthis.#errorHintNode = errorHintNode;\n\t}\n\n\tgetErrorTextNode()\n\t{\n\t\treturn this.#errorTextNode;\n\t}\n\n\tgetErrorHintNode()\n\t{\n\t\treturn this.#errorHintNode;\n\t}\n\n\tgetErrorTitleNode()\n\t{\n\t\treturn this.#errorTitleNode;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.getSyncButton() !== undefined) this.getSyncButton().setWaiting(true);\n\t\tthis.#node.classList.add(\"mail-progress-show\");\n\t\tthis.#node.classList.remove(\"mail-progress-hide\");\n\t}\n\n\thide()\n\t{\n\t\tif(this.getSyncButton() !== undefined) this.getSyncButton().setWaiting(false);\n\t\tthis.#node.classList.add(\"mail-progress-hide\");\n\t\tthis.#node.classList.remove(\"mail-progress-show\");\n\t}\n\n\thideErrorBox()\n\t{\n\t\tthis.#errorBoxNode.classList.add(\"mail-hidden-element\");\n\t\tthis.#errorBoxNode.classList.remove(\"mail-visible-element\");\n\t}\n\n\tshowErrorBox()\n\t{\n\t\tthis.#errorBoxNode.classList.add(\"mail-visible-element\");\n\t\tthis.#errorBoxNode.classList.remove(\"mail-hidden-element\");\n\t}\n}","import { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Counters\n{\n\tcounters = [];\n\thiddenCountersForTotalCounter =[];\n\t#name;\n\n\tconstructor(name)\n\t{\n\t\tthis.#name = name;\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.#name;\n\t}\n\n\tsetHiddenCountersForTotalCounter(...counterNames)\n\t{\n\t\tfor (let counter of counterNames)\n\t\t{\n\t\t\tthis.hiddenCountersForTotalCounter[counter] = 'disabled';\n\t\t}\n\t}\n\n\tgetTotalCounter()\n\t{\n\t\tlet counters = 0;\n\t\tfor (let name in this.counters)\n\t\t{\n\t\t\tif(name in this.hiddenCountersForTotalCounter) continue;\n\t\t\tcounters += this.counters[name];\n\t\t}\n\n\t\treturn counters;\n\t}\n\n\tgetCounterObjects()\n\t{\n\t\treturn this.counters;\n\t}\n\n\tgetCounter(name)\n\t{\n\t\treturn this.counters[name];\n\t}\n\n\taddCounter(name,count)\n\t{\n\t\tthis.counters[name] = Number(count);\n\t\treturn this.counters[name];\n\t}\n\n\taddCounters(counters)\n\t{\n\t\tlet resultCounters = {};\n\n\t\tfor (let i = 0; i < counters.length; i++)\n\t\t{\n\t\t\tconst counter = counters[i]\n\t\t\tconst path = counter['path'];\n\t\t\tthis.addCounter(path,counter['count']);\n\t\t\tresultCounters[path] = counter['count'];\n\t\t}\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcounters: resultCounters,\n\t\t\t\tname: this.getName(),\n\t\t\t}\n\t\t});\n\t\tEventEmitter.emit('BX.Mail.Home:updatingCounters', event);\n\t}\n\n\t/*Set counters as when adding. Old counters with different names are retained*/\n\tsetCounters(counters)\n\t{\n\t\tthis.addCounters(counters);\n\t}\n\n\tisExists(name)\n\t{\n\t\treturn this.counters[name] !== undefined;\n\t}\n\n\tincreaseCounter(name,count = 1 )\n\t{\n\t\tif(!this.isExists(name))\n\t\t{\n\t\t\treturn \"no counter\";\n\t\t}\n\t\tthis.counters[name] += Number(count);\n\t}\n\n\tlowerCounter(name,count = 1 )\n\t{\n\t\tif(!this.isExists(name))\n\t\t{\n\t\t\treturn \"no counter\";\n\t\t}\n\n\t\tconst newValue = this.counters[name] - Number(count);\n\t\tif(newValue < 0)\n\t\t{\n\t\t\treturn \"negative value\";\n\t\t}\n\n\t\tthis.counters[name] = newValue;\n\t}\n\n\t/*Change counters by rule*/\n\tupdateCounters(counters = [\n\t\t{\n\t\t\tname: 'counter1',\n\t\t\tcount: 2,\n\t\t\tincrease: false,\n\t\t\tlower: true,\n\t\t},\n\t\t{\n\t\t\tname: 'counter2',\n\t\t\tcount: 2,\n\t\t\tincrease: true,\n\t\t\tlower: false,\n\t\t},\n\t])\n\t{\n\t\tlet resultCounters = {};\n\t\tlet countersAreNotLoadedFromTheServer = false;\n\n\t\tfor (let i = 0; i < counters.length; i++)\n\t\t{\n\t\t\tconst counter = counters[i];\n\t\t\tconst name = counter['name'];\n\n\t\t\tif(counter['lower'])\n\t\t\t{\n\t\t\t\tif(this.lowerCounter(name,counter['count']) === \"negative value\")\n\t\t\t\t{\n\t\t\t\t\tcountersAreNotLoadedFromTheServer = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(counter['increase'] && countersAreNotLoadedFromTheServer === false)\n\t\t\t{\n\t\t\t\tthis.increaseCounter(name,counter['count'])\n\t\t\t}\n\n\t\t\tresultCounters[name] = this.getCounter(name);\n\t\t}\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcounters: resultCounters,\n\t\t\t\tname: this.getName(),\n\t\t\t}\n\t\t});\n\t\tEventEmitter.emit('BX.Mail.Home:updatingCounters', event);\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { DirectoryMenu } from 'mail.directorymenu';\n\nexport class LeftMenu\n{\n\tconstructor(config={\n\t\tdirsWithUnseenMailCounters: {},\n\t\tmailboxId:'',\n\t\tfilterId: '',\n\t})\n\t{\n\t\tconst leftDirectoryMenuWrapper = document.querySelector('.mail-left-menu-wrapper');\n\n\t\tthis.directoryMenu = new DirectoryMenu({\n\t\t\tdirsWithUnseenMailCounters: config['dirsWithUnseenMailCounters'],\n\t\t\tfilterId: config['filterId'],\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Mail.Sync:newLettersArrived', () => {\n\n\t\t\tBX.ajax.runComponentAction('bitrix:mail.client.message.list', 'getDirsWithUnseenMailCounters', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tmailboxId: config['mailboxId'],\n\t\t\t\t},\n\t\t\t}).then(response => {\n\t\t\t\tconst data = response.data || {};\n\t\t\t\tBX.Mail.Home.Counters.setCounters(data);\n\t\t\t});\n\t\t});\n\n\t\tleftDirectoryMenuWrapper.append(this.directoryMenu.getNode());\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { Loc } from 'main.core';\n\nexport class List\n{\n\tconstructor(options)\n\t{\n\t\tthis.pageCounter = options.pageCounter;\n\t\tthis.pageCounterTitle = options.pageCounterTitle;\n\t\tthis.mailReadAllButton = options.mailReadAllButton;\n\t\tthis.gridId = options.gridId;\n\t\tthis.mailboxId = options.mailboxId;\n\t\tthis.canMarkSpam = options.canMarkSpam;\n\t\tthis.canDelete = options.canDelete;\n\t\tthis.connectedMailboxesLicenseInfo = options.connectedMailboxesLicenseInfo;\n\t\tthis.ERROR_CODE_CAN_NOT_DELETE = options.ERROR_CODE_CAN_NOT_DELETE;\n\t\tthis.ERROR_CODE_CAN_NOT_MARK_SPAM = options.ERROR_CODE_CAN_NOT_MARK_SPAM;\n\t\tthis.disabledClassName = 'js-disabled';\n\t\tthis.userInterfaceManager = new BX.Mail.Client.Message.List.UserInterfaceManager(options);\n\t\tthis.userInterfaceManager.resetGridSelection = this.resetGridSelection.bind(this);\n\t\tthis.userInterfaceManager.isSelectedRowsHaveClass = this.isSelectedRowsHaveClass.bind(this);\n\t\tthis.userInterfaceManager.getGridInstance = this.getGridInstance.bind(this);\n\t\tthis.cache = {};\n\t\tthis.addEventHandlers();\n\n\t\tBX.Mail.Client.Message.List[options.id] = this;\n\t};\n\n\taddEventHandlers()\n\t{\n\t\t// todo delete this hack\n\t\t// it is here to prevent grid's title changing after filter apply\n\t\tBX.ajax.UpdatePageData = (function() {\n\t\t});\n\n\t\tEventEmitter.subscribe(\n\t\t\t'onSubMenuShow',\n\t\t\tfunction(event){\n\t\t\t\tconst menuItem = event.target;\n\t\t\t\tconst container = menuItem.getMenuWindow().getPopupWindow().getPopupContainer();\n\t\t\t\tlet id = null;\n\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tid = BX.data(container, 'grid-row-id');\n\t\t\t\t}\n\n\t\t\t\tBX.data(\n\t\t\t\t\tmenuItem.getSubMenu().getPopupWindow().getPopupContainer(),\n\t\t\t\t\t'grid-row-id',\n\t\t\t\t\tmenuItem.gridRowId || id,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\n\t\tBX.Mail.Home.LeftMenuNode.directoryMenu.setDirectory(this.getCurrentFolder());\n\n\t\tEventEmitter.subscribe('Mail::directoryChanged', () =>\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t})\n\n\t\tEventEmitter.subscribe('BX.Mail.Home:updatingCounters', (event) => {\n\t\t\tif(event['data']['name']!== 'mailboxCounters')\n\t\t\t{\n\t\t\t\tconst counters = event['data']['counters'];\n\t\t\t\tBX.Mail.Home.LeftMenuNode.directoryMenu.setCounters(counters);\n\t\t\t\tconst currentFolderCount = counters[this.getCurrentFolder()];\n\n\t\t\t\tif (currentFolderCount !== undefined)\n\t\t\t\t{\n\t\t\t\t\tthis.changeCurrentFolderCount(currentFolderCount);\n\t\t\t\t}\n\n\t\t\t\tBX.Mail.Home.mailboxCounters.setCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tpath: 'unseenCountInCurrentMailbox',\n\t\t\t\t\t\tcount: BX.Mail.Home.Counters.getTotalCounter(),\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.userInterfaceManager.updateLeftMenuCounter();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.DirectoryMenu:onChangeFilter', (event) => {\n\t\t\tthis.changeCurrentFolderCount(BX.Mail.Home.Counters.getCounter(event['data']['directory']));\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Menu.Item:onmouseenter', function(event) {\n\t\t\tconst menuItem = event.target;\n\n\t\t\tif (!menuItem.dataset || !menuItem.getMenuWindow())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst menuWindow = menuItem.getMenuWindow();\n\t\t\tconst subMenuItems = menuWindow.getMenuItems();\n\n\t\t\tconst path = menuItem.dataset.path;\n\t\t\tconst hash = menuItem.dataset.dirMd5;\n\t\t\tconst hasChild = menuItem.dataset.hasChild;\n\n\t\t\tif (!hasChild)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < subMenuItems.length; i++)\n\t\t\t{\n\t\t\t\tconst item = subMenuItems[i];\n\n\t\t\t\tif (item.getId() === path)\n\t\t\t\t{\n\t\t\t\t\tconst hasSubMenu = item.hasSubMenu();\n\n\t\t\t\t\tif (hasSubMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.showSubMenu();\n\t\t\t\t\t\tconst subMenu = item.getSubMenu();\n\n\t\t\t\t\t\tlet hasLoadingItem = false;\n\n\t\t\t\t\t\tif (subMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = subMenu.getMenuItems();\n\n\t\t\t\t\t\t\tfor (let k = 0; k < items.length; k++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst subItem = items[k];\n\n\t\t\t\t\t\t\t\tif (subItem.getId() === 'loading')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thasLoadingItem = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!hasLoadingItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.loadLevelMenu(item, hash);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tconst itemsMenu = document.querySelectorAll('.ical-event-control-menu');\n\n\t\tfor (let i = 0; i < itemsMenu.length; i++)\n\t\t{\n\t\t\titemsMenu[i].addEventListener('click', this.showICalMenuDropdown.bind(this));\n\t\t}\n\n\t\tBX.bindDelegate(document.body, 'click', { className: 'ical-event-control-button' }, this.onClickICalButton.bind(this));\n\t}\n\n\tchangeCurrentFolderCount(count)\n\t{\n\t\tif(count > 0){\n\t\t\tthis.pageCounter.textContent = count;\n\t\t\tthis.pageCounterTitle.classList.remove(\"main-ui-hide\");\n\t\t\tthis.mailReadAllButton.classList.remove(\"main-ui-hide\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.pageCounterTitle.classList.add(\"main-ui-hide\");\n\t\t\tthis.mailReadAllButton.classList.add(\"main-ui-hide\");\n\t\t}\n\t}\n\n\tloadLevelMenu(menuItem, hash)\n\t{\n\t\tconst menu = this.getCache(menuItem.getId());\n\t\tconst popup = BX.Main.PopupManager.getPopupById('menu-popup-popup-submenu-' + menuItem.getId());\n\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.destroy();\n\t\t}\n\n\t\tif (menu)\n\t\t{\n\t\t\tmenuItem.destroySubMenu();\n\t\t\tmenuItem.addSubMenu(menu);\n\t\t\tmenuItem.showSubMenu();\n\t\t\treturn;\n\t\t}\n\n\t\tconst subItem = {\n\t\t\t'id': 'loading',\n\t\t\t'text': Loc.getMessage('MAIL_CLIENT_BUTTON_LOADING'),\n\t\t\t'disabled': true,\n\t\t};\n\n\t\tmenuItem.destroySubMenu();\n\t\tmenuItem.addSubMenu([subItem]);\n\t\tmenuItem.showSubMenu();\n\n\t\tBX.ajax.runComponentAction('bitrix:mail.client.config.dirs', 'level', {\n\t\t\tmode: 'class',\n\t\t\tdata: { mailboxId: this.mailboxId, dir: { path: menuItem.getId(), dirMd5: hash } },\n\t\t}).then(\n\t\t\tfunction(response) {\n\t\t\t\tconst dirs = response.data.dirs;\n\t\t\t\tconst items = [];\n\n\t\t\t\tfor (let i = 0; i < dirs.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst hasChild = /(HasChildren)/i.test(dirs[i].FLAGS);\n\t\t\t\t\tconst item = {\n\t\t\t\t\t\t'id': dirs[i].PATH,\n\t\t\t\t\t\t'text': dirs[i].NAME,\n\t\t\t\t\t\t'dataset': {\n\t\t\t\t\t\t\t'path': dirs[i].PATH,\n\t\t\t\t\t\t\t'dirMd5': dirs[i].DIR_MD5,\n\t\t\t\t\t\t\t'isDisabled': dirs[i].IS_DISABLED,\n\t\t\t\t\t\t\t'hasChild': hasChild,\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: hasChild ? [{\n\t\t\t\t\t\t\tid: 'loading',\n\t\t\t\t\t\t\t'text': Loc.getMessage('MAIL_CLIENT_BUTTON_LOADING'),\n\t\t\t\t\t\t\t'disabled': true,\n\t\t\t\t\t\t}] : [],\n\t\t\t\t\t};\n\n\t\t\t\t\titems.push(item);\n\t\t\t\t}\n\n\t\t\t\tthis.setCache(menuItem.getId(), items);\n\n\t\t\t\tconst popup = BX.Main.PopupManager.getPopupById('menu-popup-popup-submenu-' + menuItem.getId());\n\t\t\t\tconst isShown = menuItem.getMenuWindow().getPopupWindow().isShown();\n\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t}\n\n\t\t\t\tif (isShown)\n\t\t\t\t{\n\t\t\t\t\tmenuItem.destroySubMenu();\n\t\t\t\t\tmenuItem.addSubMenu(items);\n\t\t\t\t\tmenuItem.showSubMenu();\n\t\t\t\t}\n\t\t\t}.bind(this),\n\t\t\tfunction(response) {\n\t\t\t}.bind(this),\n\t\t);\n\t}\n\n\tshowLicensePopup(code)\n\t{\n\t\tB24.licenseInfoPopup.show(\n\t\t\tcode,\n\t\t\tLoc.getMessage('MAIL_MAILBOX_LICENSE_CONNECTED_MAILBOXES_LIMIT_TITLE'),\n\t\t\tthis.connectedMailboxesLicenseInfo,\n\t\t);\n\t}\n\n\tonCrmClick(id)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tconst row = id ? this.getGridInstance().getRows().getById(id) : selected[0];\n\t\tif (!(row && row.node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst addToCrm = this.userInterfaceManager.isAddToCrmActionAvailable(row.node);\n\t\tconst messageIdNode = row.node.querySelector('[data-message-id]');\n\t\tif (!(messageIdNode.dataset && messageIdNode.dataset.messageId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\n\t\tif (addToCrm)\n\t\t{\n\t\t\tif (typeof this.isAddingToCrmInProgress !== \"object\")\n\t\t\t{\n\t\t\t\tthis.isAddingToCrmInProgress = {};\n\t\t\t}\n\t\t\tif (this.isAddingToCrmInProgress[id] === true)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isAddingToCrmInProgress[id] = true;\n\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t'bitrix:mail.client',\n\t\t\t\t'createCrmActivity',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessageId: messageIdNode.dataset.messageId,\n\t\t\t\t\t},\n\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t\t'bindings': this.getRowsBindings([row]),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(\n\t\t\t\tfunction(id) {\n\t\t\t\t\tthis.isAddingToCrmInProgress[id] = false;\n\t\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_ADDED_TO_CRM'));\n\t\t\t\t}.bind(this, id),\n\t\t\t\tfunction(json) {\n\t\t\t\t\tthis.isAddingToCrmInProgress[id] = false;\n\t\t\t\t\tif (json.errors && json.errors.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notify(json.errors.map(\n\t\t\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\t\t\treturn item.message;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t).join('<br>'), 5000);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_ADD_TO_CRM_ERROR'));\n\t\t\t\t\t}\n\t\t\t\t}.bind(this),\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t'bitrix:mail.client',\n\t\t\t\t'removeCrmActivity',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessageId: messageIdNode.dataset.messageId,\n\t\t\t\t\t},\n\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t\t'bindings': this.getRowsBindings([row]),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(function(messageIdNode) {\n\t\t\t\tthis.userInterfaceManager.onCrmBindingDeleted(messageIdNode.dataset.messageId);\n\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_EXCLUDED_FROM_CRM'));\n\t\t\t}.bind(this, messageIdNode));\n\t\t}\n\n\t\tlet selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\tif(selectedIds.length === 1 && selectedIds[0]===id)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tonViewClick(id)\n\t{\n\t\tif (id === undefined && this.getGridInstance().getRows().getSelectedIds().length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t// @TODO: path\n\t\tBX.SidePanel.Instance.open(\"/mail/message/\" + id, {\n\t\t\twidth: 1080,\n\t\t\tloader: 'view-mail-loader',\n\t\t});\n\t}\n\n\tonDeleteImmediately(id)\n\t{\n\t\tlet additionalOptions =\n\t\t{\n\t\t\t'deleteImmediately' : true,\n\t\t};\n\t\tthis.onDeleteClick(id,additionalOptions);\n\t}\n\n\tonDeleteClick(id,additionalOptions)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.canDelete)\n\t\t{\n\t\t\tthis.showDirsSlider();\n\t\t\treturn;\n\t\t}\n\t\tlet options = {\n\t\t\tparams: (additionalOptions !== undefined) ? additionalOptions : {},\n\t\t\tkeepRows: true,\n\t\t\tanalyticsLabel: {\n\t\t\t\t'groupCount': selected.length,\n\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t},\n\t\t};\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\t\t\n\t\tselectedIds = this.filterRowsByClassName(this.disabledClassName, selectedIds, true);\n\t\toptions.ids = selectedIds;\n\n\t\tif (this.userInterfaceManager.isCurrentFolderTrash || (additionalOptions !== undefined && additionalOptions['deleteImmediately']) )\n\t\t{\n\t\t\tconst confirmPopup = this.getConfirmDeletePopup(options);\n\t\t\tconfirmPopup.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tthis.runAction('delete', options,() =>\n\t\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t\t);\n\t\t\tif(id === undefined)\n\t\t\t{\n\t\t\t\tthis.resetGridSelection();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMoveToFolderClick(event)\n\t{\n\t\tconst folderOptions = event.currentTarget.dataset;\n\t\tlet id = undefined;\n\t\tconst popupSubmenu = BX.findParent(event.currentTarget, { className: 'popup-window' });\n\t\tif (popupSubmenu)\n\t\t{\n\t\t\tid = BX.data(popupSubmenu, 'grid-row-id');\n\t\t}\n\t\tconst isDisabled = JSON.parse(folderOptions.isDisabled);\n\t\tconst toFolderByPath = folderOptions.path;\n\t\tconst toFolderByName = toFolderByPath;\n\n\t\tif ((id === undefined && this.getGridInstance().getRows().getSelectedIds().length === 0) || isDisabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selected = this.getGridInstance().getRows().getSelected();\n\t\tlet idsForMoving = (id ? [id] : this.getGridInstance().getRows().getSelectedIds());\n\t\tidsForMoving = this.filterRowsByClassName(this.disabledClassName, idsForMoving, true);\n\t\tif (!idsForMoving.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// to hide the context menu\n\t\tBX.onCustomEvent('Grid::updated');\n\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\n\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t{\n\t\t\t\tname:toFolderByName,\n\t\t\t\tincrease: true,\n\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\tlower: true,\n\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t},\n\t\t]);\n\n\t\tthis.runAction(\n\t\t\t'moveToFolder',\n\t\t\t{\n\t\t\t\tkeepRows: true,\n\t\t\t\tids: idsForMoving,\n\t\t\t\tparams: {\n\t\t\t\t\tfolder: toFolderByPath,\n\t\t\t\t},\n\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t\t},\n\t\t\t},\n\t\t\t()=> {\n\t\t\t\tBX.Mail.Home.Grid.reloadTable();\n\t\t\t}\n\t\t);\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tonReadClick(id)\n\t{\n\t\tlet selected = [];\n\t\tlet resultIds = [];\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselected = this.getGridInstance().getRows().getSelected();\n\t\t\tresultIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t\tif(selectedIds.length === 1 && selectedIds[0]===id)\n\t\t\t{\n\t\t\t\t/*if the action is non-group, but one cell is selected,\n\t\t\t\tthen the action was performed through the \"Action panel\"\n\t\t\t\tand the selection should be reset*/\n\t\t\t\tselected = this.getGridInstance().getRows().getSelected();\n\t\t\t\tresultIds = selectedIds;\n\t\t\t\tid = undefined;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresultIds = [id];\n\t\t\t}\n\n\t\t}\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst actionName = 'all' == id || this.isSelectedRowsHaveClass('mail-msg-list-cell-unseen', id) ? 'markAsSeen' : 'markAsUnseen';\n\n\t\tresultIds = this.filterRowsByClassName('mail-msg-list-cell-unseen', resultIds, actionName !== 'markAsSeen');\n\t\tresultIds = this.filterRowsByClassName(this.disabledClassName, resultIds, true);\n\t\tif (!resultIds.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = function() {\n\t\t\tthis.userInterfaceManager.onMessagesRead(resultIds, { action: actionName });\n\t\t\tconst currentFolder = this.getCurrentFolder();\n\t\t\tif (actionName === 'markAsSeen')\n\t\t\t{\n\t\t\t\tlet count = resultIds.length;\n\t\t\t\tif ('all' === id)\n\t\t\t\t{\n\t\t\t\t\tcount = BX.Mail.Home.Counters.getCounter(currentFolder);\n\t\t\t\t}\n\t\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tname: currentFolder,\n\t\t\t\t\t\tlower: true,\n\t\t\t\t\t\tcount: count,\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tname: currentFolder,\n\t\t\t\t\t\tincrease: true,\n\t\t\t\t\t\tcount: resultIds.length,\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\tif(id === undefined) {\n\t\t\t\tthis.resetGridSelection();\n\t\t\t}\n\n\t\t\tif ('all' == id)\n\t\t\t{\n\t\t\t\tresultIds['for_all'] = this.mailboxId + '-' + this.userInterfaceManager.getCurrentFolder();\n\t\t\t}\n\n\t\t\tthis.userInterfaceManager.updateUnreadCounters();\n\n\t\t\tthis.runAction(actionName, {\n\t\t\t\tids: resultIds,\n\t\t\t\tkeepRows: true,\n\t\t\t\tsuccessParams: actionName,\n\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t\t},\n\t\t\t\tonSuccess: false,\n\t\t\t});\n\n\t\t\treturn true;\n\t\t};\n\t\thandler.apply(this);\n\t}\n\n\tonSpamClick(id)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.canMarkSpam)\n\t\t{\n\t\t\tthis.showDirsSlider();\n\t\t\treturn;\n\t\t}\n\t\tconst actionName = this.isSelectedRowsHaveClass('js-spam', id) ? 'restoreFromSpam' : 'markAsSpam';\n\t\tlet resultIds = this.filterRowsByClassName('js-spam', id, actionName !== 'restoreFromSpam');\n\t\tresultIds = this.filterRowsByClassName(this.disabledClassName, resultIds, true);\n\t\tif (!resultIds.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst options = {\n\t\t\tkeepRows: true,\n\t\t\tanalyticsLabel: {\n\t\t\t\t'groupCount': selected.length,\n\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t},\n\t\t};\n\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\n\t\toptions.ids = selectedIds;\n\n\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\tif(actionName === 'markAsSpam')\n\t\t{\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.spamDir,\n\t\t\t\t\tincrease: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.spamDir,\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.inboxDir,\n\t\t\t\t\tincrease: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\n\t\tthis.runAction(actionName, options,() =>\n\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t);\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tgetConfirmDeletePopup(options)\n\t{\n\t\treturn new BX.UI.Dialogs.MessageBox({\n\t\t\ttitle: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_TITLE'),\n\t\t\tmessage: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_DELETE'),\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\ttext: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN'),\n\t\t\t\t\tonclick: (function(button) {\n\t\t\t\t\t\tthis.runAction('delete', options,() =>\n\t\t\t\t\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t\tBX.Mail.Home.Grid.hideRowByIds(options.ids);\n\t\t\t\t\t}).bind(this),\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: function(button) {\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\tresetGridSelection()\n\t{\n\t\tBX.onCustomEvent('Mail::resetGridSelection');\n\t\tthis.getGridInstance().getRows().unselectAll();\n\t\tthis.getGridInstance().adjustCheckAllCheckboxes();\n\t\tBX.Mail.Home.Grid.hidePanel();\n\t}\n\n\tisSelectedRowsHaveClass(className, id)\n\t{\n\t\tlet selectedIds;\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\t\tconst ids = selectedIds.length ? selectedIds : (id ? [id] : []);\n\n\t\tfor (let i = 0; i < ids.length; i++)\n\t\t{\n\t\t\tconst row = this.getGridInstance().getRows().getById(ids[i]);\n\t\t\tif (row && row.node)\n\t\t\t{\n\t\t\t\tconst columns = row.node.getElementsByClassName(className);\n\t\t\t\tif (columns && columns.length)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tfilterRowsByClassName(className, ids, isReversed)\n\t{\n\t\tlet resIds = [];\n\t\tif ('all' == ids)\n\t\t{\n\t\t\tresIds = this.getGridInstance().getRows().getBodyChild().map(\n\t\t\t\tfunction(current) {\n\t\t\t\t\treturn current.getId();\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse if (Array.isArray(ids))\n\t\t{\n\t\t\tresIds = ids;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t\tresIds = selectedIds.length ? selectedIds : (ids ? [ids] : []);\n\t\t}\n\t\tconst resultIds = [];\n\t\tfor (let i = resIds.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst row = this.getGridInstance().getRows().getById(resIds[i]);\n\t\t\tif (row && row.node)\n\t\t\t{\n\t\t\t\tconst columns = row.node.getElementsByClassName(className);\n\t\t\t\tif (!isReversed && (columns && columns.length))\n\t\t\t\t{\n\t\t\t\t\tresultIds.push(resIds[i]);\n\t\t\t\t}\n\t\t\t\telse if (isReversed && !(columns && columns.length))\n\t\t\t\t{\n\t\t\t\t\tresultIds.push(resIds[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn resultIds;\n\t}\n\n\tnotify(text, delay)\n\t{\n\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\tautoHideDelay: delay > 0 ? delay : 2000,\n\t\t\tcontent: text ? text : Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_SUCCESS'),\n\t\t});\n\t}\n\n\trunAction(actionName, options, actionOnSuccess)\n\t{\n\t\toptions = options ? options : {};\n\n\t\tlet selectedIds = [];\n\n\t\tif (options.ids)\n\t\t{\n\t\t\tselectedIds = options.ids;\n\t\t}\n\t\tif (!selectedIds.length && !selectedIds.for_all)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!options.keepRows)\n\t\t{\n\t\t\tthis.getGridInstance().tableFade();\n\t\t}\n\t\tconst data = { ids: selectedIds };\n\t\tif (options.params)\n\t\t{\n\t\t\tconst optionsKeys = Object.keys(Object(options.params));\n\t\t\tfor (let nextIndex = 0, len = optionsKeys.length; nextIndex < len; nextIndex++)\n\t\t\t{\n\t\t\t\tconst nextKey = optionsKeys[nextIndex];\n\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(options.params, nextKey);\n\t\t\t\tif (desc !== undefined && desc.enumerable)\n\t\t\t\t{\n\t\t\t\t\tdata[nextKey] = options.params[nextKey];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tBX.ajax.runComponentAction('bitrix:mail.client', actionName, {\n\t\t\tmode: 'ajax',\n\t\t\tdata: data,\n\t\t\tanalyticsLabel: options.analyticsLabel,\n\t\t}).then(\n\t\t\tfunction() {\n\t\t\t\tif (options.onSuccess === false)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onSuccess && typeof (options.onSuccess) === \"function\")\n\t\t\t\t{\n\t\t\t\t\toptions.onSuccess.bind(this, selectedIds, options.successParams)();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(actionOnSuccess === undefined)\n\t\t\t\t{\n\t\t\t\t\tthis.notify();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactionOnSuccess();\n\t\t\t\t}\n\t\t\t}.bind(this),\n\t\t\tfunction(response) {\n\t\t\t\toptions.onError && typeof (options.onError) === \"function\" ?\n\t\t\t\t\toptions.onError().bind(this, response) :\n\t\t\t\t\tthis.onErrorRequest(response);\n\t\t\t}.bind(this),\n\t\t);\n\t}\n\n\tonErrorRequest(response)\n\t{\n\t\tlet options = {};\n\t\tthis.checkErrorRights(response.errors);\n\t\toptions.errorMessage = response.errors[0].message;\n\t}\n\n\tcheckErrorRights(errors)\n\t{\n\t\tfor (let i = 0; i < errors.length; i++)\n\t\t{\n\t\t\tif (errors[i].code === this.ERROR_CODE_CAN_NOT_DELETE)\n\t\t\t{\n\t\t\t\tthis.canDelete = false;\n\t\t\t}\n\t\t\tif (errors[i].code === this.ERROR_CODE_CAN_NOT_MARK_SPAM)\n\t\t\t{\n\t\t\t\tthis.canMarkSpam = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowDirsSlider()\n\t{\n\t\tconst url = BX.util.add_url_param(\"/mail/config/dirs\", {\n\t\t\tmailboxId: this.mailboxId,\n\t\t});\n\t\tBX.SidePanel.Instance.open(url, {\n\t\t\twidth: 640,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t});\n\t\tthis.canDelete = true;\n\t\tthis.canMarkSpam = true;\n\t}\n\n\tonDisabledGroupActionClick()\n\t{\n\t}\n\n\tonUnreadCounterClick()\n\t{\n\t\tthis.userInterfaceManager.onUnreadCounterClick();\n\t}\n\n\tgetCurrentFolder()\n\t{\n\t\treturn this.userInterfaceManager.getCurrentFolder();\n\t}\n\n\tgetGridInstance()\n\t{\n\t\treturn BX.Main.gridManager.getById(this.gridId).instance;\n\t}\n\n\tgetRowsBindings(rows)\n\t{\n\t\treturn BX.util.array_unique(Array.prototype.concat.apply(\n\t\t\t[],\n\t\t\trows.map(\n\t\t\t\tfunction(row) {\n\t\t\t\t\tif (!row || !row.node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Array.prototype.map.call(\n\t\t\t\t\t\trow.node.querySelectorAll('[class^=\"js-bind-\"] [data-type]'),\n\t\t\t\t\t\tfunction(node) {\n\t\t\t\t\t\t\treturn node.dataset.type;\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t));\n\t}\n\n\tgetCache(key)\n\t{\n\t\tif (!key)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.cache[key] ? this.cache[key] : null;\n\t}\n\n\tsetCache(key, value)\n\t{\n\t\treturn this.cache[key] = value;\n\t}\n\n\tshowICalMenuDropdown(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst menu = event.currentTarget.dataset.menu;\n\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.iCalMenuDropdown = BX.Main.MenuManager.create({\n\t\t\tid: 'mail-client-message-list-ical-dropdown-menu',\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\titems: JSON.parse(menu),\n\t\t\tzIndex: 7001,\n\t\t\tmaxHeight: 400,\n\t\t\tmaxWidth: 200,\n\t\t\tangle: {\n\t\t\t\tposition: \"top\",\n\t\t\t\toffset: 40,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function() {\n\t\t\t\t\tthis.removeICalMenuDropdown();\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t});\n\t\tthis.iCalMenuDropdown.popupWindow.setBindElement(event.currentTarget);\n\t\tthis.iCalMenuDropdown.show();\n\t}\n\n\tremoveICalMenuDropdown()\n\t{\n\t\tif (this.iCalMenuDropdown)\n\t\t{\n\t\t\tBX.Main.MenuManager.destroy(this.iCalMenuDropdown.id);\n\t\t}\n\t}\n\n\tonClickICalButton(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst messageId = event.target.dataset.messageid || event.target.parentNode.dataset.messageid;\n\t\tconst action = event.target.dataset.action || event.target.parentNode.dataset.action;\n\t\tconst button = event.target;\n\n\t\tbutton.classList.add('ui-btn-wait');\n\t\tthis.removeICalMenuDropdown();\n\n\t\tthis.sendICal(messageId, action)\n\t\t\t.then(function() {\n\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\t\t\t\tthis.notify(Loc.getMessage(action === 'cancelled' ? 'MAIL_MESSAGE_ICAL_NOTIFY_REJECT' : 'MAIL_MESSAGE_ICAL_NOTIFY_ACCEPT'));\n\t\t\t}.bind(this))\n\t\t\t.catch(function() {\n\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_ICAL_NOTIFY_ERROR'));\n\t\t\t}.bind(this));\n\t}\n\n\tsendICal(messageId, action)\n\t{\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tBX.ajax.runComponentAction('bitrix:mail.client', 'ical', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { messageId, action },\n\t\t\t}).then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolve();\n\t\t\t\t}.bind(this),\n\t\t\t\tfunction() {\n\t\t\t\t\treject();\n\t\t\t\t}.bind(this),\n\t\t\t);\n\t\t});\n\t}\n}","import { Type, Reflection, Event, Loc } from 'main.core';\nimport { Avatar } from 'mail.avatar';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageGrid } from 'mail.messagegrid';\nimport { ProgressBar } from './src/js/progressbar.es6';\nimport { Counters } from './src/js/counters.es6';\nimport { LeftMenu } from './src/js/leftmenu.es6';\nimport { List } from './src/js/list.es6';\nimport { Button } from 'ui.buttons';\n\nconst namespaceMailHome = Reflection.namespace('BX.Mail.Home');\n\nEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\tconst [messageEvent] = event.getCompatData();\n\tif(messageEvent.getEventId() === 'mail-mailbox-config-success')\n\t{\n\t\tBXMailMailbox.sync(namespaceMailHome.ProgressBar, namespaceMailHome.Grid.getId(), false,true);\n\t}\n});\n\nlet sliderPage;\nlet progressBar;\nlet errorBox;\nlet syncButtonWrapper;\n\nlet selectedIdsForRecovery = {};\n\nEvent.ready(() => {\n\n\tsyncButtonWrapper = document.querySelector('[data-role=\"mail-msg-sync-button-wrapper\"]');\n\n\tconst syncButton = new Button({\n\t\tclassName:\"ui-btn ui-btn-themes ui-btn-light-border mail-msg-sync-button\",\n\t\ticon: Button.Icon.BUSINESS,\n\t\tprops: {\n\t\t\ttitle: Loc.getMessage(\"MAIL_MESSAGE_SYNC_BTN_HINT\")\n\t\t},\n\t\tonclick: function() {\n\t\t\tBXMailMailbox.sync(namespaceMailHome.ProgressBar, Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\"),false,true);\n\t\t},\n\t});\n\n\tsyncButtonWrapper.append(\n\t\tsyncButton.getContainer()\n\t)\n\n\tEventEmitter.subscribe('BX.Main.Grid:onBeforeReload', (event) => {\n\t\tconst [grid] = event.getCompatData();\n\t\tif(grid !== {} && grid !== undefined && Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\") === grid.getId())\n\t\t{\n\t\t\tselectedIdsForRecovery = grid.getRows().getSelectedIds();\n\t\t}\n\t});\n\n\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif(grid !== {} && grid !== undefined && Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\") === grid.getId())\n\t\t{\n\t\t\tlet rowsWereSelected = false;\n\t\t\tnamespaceMailHome.Grid.getRows().map(function (row)\n\t\t\t{\n\t\t\t\tif(Type.isFunction(selectedIdsForRecovery.indexOf) && selectedIdsForRecovery.indexOf(row.getId()) !== -1)\n\t\t\t\t{\n\t\t\t\t\tif(row.isShown())\n\t\t\t\t\t{\n\t\t\t\t\t\trow.select();\n\t\t\t\t\t\trowsWereSelected = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tselectedIdsForRecovery = {}\n\n\t\t\tif(rowsWereSelected)\n\t\t\t{\n\t\t\t\tsetTimeout(\n\t\t\t\t\tfunction ()\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.emit(window,'Grid::thereSelectedRows');\n\t\t\t\t\t},\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\n\tAvatar.replaceTagsWithAvatars({\n\t\tclassName: 'mail-ui-avatar',\n\t});\n\n\tsliderPage = document.getElementsByClassName(\"ui-slider-page\")[0];\n\tprogressBar = document.querySelector('[data-role=\"mail-progress-bar\"]');\n\tsliderPage.insertBefore(progressBar,sliderPage.firstChild);\n\terrorBox = document.querySelector('[data-role=\"error-box\"]');\n\n\tnamespaceMailHome.ProgressBar = new ProgressBar(progressBar);\n\tnamespaceMailHome.unreadMessageMailboxesMarker = document.querySelector('[data-role=\"unreadMessageMailboxesMarker\"]');;\n\n\tnamespaceMailHome.ProgressBar.setSyncButton(syncButton);\n\tnamespaceMailHome.ProgressBar.setErrorBoxNode(document.querySelector('[data-role=\"error-box\"]'))\n\tnamespaceMailHome.ProgressBar.setErrorTextNode(document.querySelector('[data-role=\"error-box-text\"]'));\n\tnamespaceMailHome.ProgressBar.setErrorHintNode(document.querySelector('[data-role=\"error-box-hint\"]'));\n\tnamespaceMailHome.ProgressBar.setErrorTitleNode(document.querySelector('[data-role=\"error-box-title\"]'));\n});\n\nnamespaceMailHome.Counters = new Counters();\nnamespaceMailHome.mailboxCounters = new Counters('mailboxCounters');\nnamespaceMailHome.Grid = new MessageGrid();\n\nnamespaceMailHome.LeftMenu = LeftMenu;\n\nconst namespaceClientMessage = Reflection.namespace('BX.Mail.Client.Message');\nnamespaceClientMessage.List = List;\n"],"names":["ProgressBar","node","button","errorBoxNode","errorTitleNode","errorTextNode","errorHintNode","getSyncButton","undefined","setWaiting","classList","add","remove","Counters","name","counterNames","counter","hiddenCountersForTotalCounter","counters","count","Number","resultCounters","i","length","path","addCounter","event","BaseEvent","data","getName","EventEmitter","emit","addCounters","isExists","newValue","increase","lower","countersAreNotLoadedFromTheServer","lowerCounter","increaseCounter","getCounter","LeftMenu","config","dirsWithUnseenMailCounters","mailboxId","filterId","leftDirectoryMenuWrapper","document","querySelector","directoryMenu","DirectoryMenu","subscribe","BX","ajax","runComponentAction","mode","then","response","Mail","Home","setCounters","append","getNode","List","options","pageCounter","pageCounterTitle","mailReadAllButton","gridId","canMarkSpam","canDelete","connectedMailboxesLicenseInfo","ERROR_CODE_CAN_NOT_DELETE","ERROR_CODE_CAN_NOT_MARK_SPAM","disabledClassName","userInterfaceManager","Client","Message","UserInterfaceManager","resetGridSelection","bind","isSelectedRowsHaveClass","getGridInstance","cache","addEventHandlers","id","UpdatePageData","menuItem","target","container","getMenuWindow","getPopupWindow","getPopupContainer","getSubMenu","gridRowId","LeftMenuNode","setDirectory","getCurrentFolder","currentFolderCount","changeCurrentFolderCount","mailboxCounters","getTotalCounter","updateLeftMenuCounter","dataset","menuWindow","subMenuItems","getMenuItems","hash","dirMd5","hasChild","item","getId","hasSubMenu","showSubMenu","subMenu","hasLoadingItem","items","k","subItem","loadLevelMenu","itemsMenu","querySelectorAll","addEventListener","showICalMenuDropdown","bindDelegate","body","className","onClickICalButton","textContent","menu","getCache","popup","Main","PopupManager","getPopupById","destroy","destroySubMenu","addSubMenu","Loc","getMessage","dir","dirs","test","FLAGS","PATH","NAME","DIR_MD5","IS_DISABLED","push","setCache","isShown","code","B24","licenseInfoPopup","show","selected","getRows","getSelected","row","getById","addToCrm","isAddToCrmActionAvailable","messageIdNode","messageId","isAddingToCrmInProgress","analyticsLabel","getRowsBindings","notify","json","errors","map","message","join","onCrmBindingDeleted","selectedIds","getSelectedIds","SidePanel","Instance","open","width","loader","additionalOptions","onDeleteClick","showDirsSlider","params","keepRows","Grid","filterRowsByClassName","ids","isCurrentFolderTrash","confirmPopup","getConfirmDeletePopup","hideRowByIds","unseenRowsIdsCount","updateCounters","runAction","reloadTable","folderOptions","currentTarget","popupSubmenu","findParent","isDisabled","JSON","parse","toFolderByPath","toFolderByName","idsForMoving","onCustomEvent","folder","resultIds","actionName","handler","onMessagesRead","action","currentFolder","updateUnreadCounters","successParams","onSuccess","apply","spamDir","inboxDir","UI","Dialogs","MessageBox","title","buttons","Button","color","Color","DANGER","text","onclick","getContext","close","CancelButton","unselectAll","adjustCheckAllCheckboxes","hidePanel","columns","getElementsByClassName","isReversed","resIds","getBodyChild","current","Array","isArray","delay","top","Notification","Center","autoHideDelay","content","actionOnSuccess","for_all","tableFade","optionsKeys","Object","keys","nextIndex","len","nextKey","desc","getOwnPropertyDescriptor","enumerable","onError","onErrorRequest","checkErrorRights","errorMessage","url","util","add_url_param","cacheable","allowChangeHistory","onUnreadCounterClick","gridManager","instance","rows","array_unique","prototype","concat","call","type","key","value","stopPropagation","preventDefault","iCalMenuDropdown","MenuManager","create","autoHide","closeByEsc","zIndex","maxHeight","maxWidth","angle","position","offset","events","onPopupClose","removeICalMenuDropdown","popupWindow","setBindElement","messageid","parentNode","sendICal","catch","Promise","resolve","reject","namespaceMailHome","Reflection","namespace","getCompatData","messageEvent","getEventId","BXMailMailbox","sync","sliderPage","progressBar","errorBox","syncButtonWrapper","selectedIdsForRecovery","Event","ready","syncButton","icon","Icon","BUSINESS","props","getContainer","grid","rowsWereSelected","Type","isFunction","indexOf","select","setTimeout","window","Avatar","replaceTagsWithAvatars","insertBefore","firstChild","unreadMessageMailboxesMarker","setSyncButton","setErrorBoxNode","setErrorTextNode","setErrorHintNode","setErrorTitleNode","MessageGrid","namespaceClientMessage"],"mappings":";;;KAAaA,WAAb;CASC,uBAAYC,IAAZ,EACA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CACC,mDAAaA,IAAb;CACA;;CAZF;CAAA;CAAA,kCAceC,MAdf,EAeC;CACC,2DAAmBA,MAAnB;CACA;CAjBF;CAAA;CAAA,oCAoBC;CACC,+CAAO,IAAP;CACA;CAtBF;CAAA;CAAA,sCAyBC;CACC,+CAAO,IAAP;CACA;CA3BF;CAAA;CAAA,oCA6BiBC,YA7BjB,EA8BC;CACC,6DAAqBA,YAArB;CACA;CAhCF;CAAA;CAAA,sCAkCmBC,cAlCnB,EAmCC;CACC,+DAAuBA,cAAvB;CACA;CArCF;CAAA;CAAA,qCAuCkBC,aAvClB,EAwCC;CACC,8DAAsBA,aAAtB;CACA;CA1CF;CAAA;CAAA,qCA4CkBC,aA5ClB,EA6CC;CACC,8DAAsBA,aAAtB;CACA;CA/CF;CAAA;CAAA,uCAkDC;CACC,+CAAO,IAAP;CACA;CApDF;CAAA;CAAA,uCAuDC;CACC,+CAAO,IAAP;CACA;CAzDF;CAAA;CAAA,wCA4DC;CACC,+CAAO,IAAP;CACA;CA9DF;CAAA;CAAA,2BAiEC;CACC,UAAG,KAAKC,aAAL,OAAyBC,SAA5B,EAAuC,KAAKD,aAAL,GAAqBE,UAArB,CAAgC,IAAhC;CACvC,qDAAWC,SAAX,CAAqBC,GAArB,CAAyB,oBAAzB;CACA,qDAAWD,SAAX,CAAqBE,MAArB,CAA4B,oBAA5B;CACA;CArEF;CAAA;CAAA,2BAwEC;CACC,UAAG,KAAKL,aAAL,OAAyBC,SAA5B,EAAuC,KAAKD,aAAL,GAAqBE,UAArB,CAAgC,KAAhC;CACvC,qDAAWC,SAAX,CAAqBC,GAArB,CAAyB,oBAAzB;CACA,qDAAWD,SAAX,CAAqBE,MAArB,CAA4B,oBAA5B;CACA;CA5EF;CAAA;CAAA,mCA+EC;CACC,6DAAmBF,SAAnB,CAA6BC,GAA7B,CAAiC,qBAAjC;CACA,6DAAmBD,SAAnB,CAA6BE,MAA7B,CAAoC,sBAApC;CACA;CAlFF;CAAA;CAAA,mCAqFC;CACC,6DAAmBF,SAAnB,CAA6BC,GAA7B,CAAiC,sBAAjC;CACA,6DAAmBD,SAAnB,CAA6BE,MAA7B,CAAoC,qBAApC;CACA;CAxFF;CAAA;CAAA;;;;;;;;;;;;;;KCEaC,QAAb;CAMC,oBAAYC,IAAZ,EACA;CAAA;CAAA,kDALW,EAKX;CAAA,uEAJ+B,EAI/B;;CAAA;CAAA;CAAA;CAAA;;CACC,mDAAaA,IAAb;CACA;;CATF;CAAA;CAAA,8BAYC;CACC,+CAAO,IAAP;CACA;CAdF;CAAA;CAAA,uDAiBC;CAAA,wCADoCC,YACpC;CADoCA,QAAAA,YACpC;CAAA;;CACC,uCAAoBA,YAApB,mCACA;CADK,YAAIC,OAAO,oBAAX;CAEJ,aAAKC,6BAAL,CAAmCD,OAAnC,IAA8C,UAA9C;CACA;CACD;CAtBF;CAAA;CAAA,sCAyBC;CACC,UAAIE,QAAQ,GAAG,CAAf;;CACA,WAAK,IAAIJ,IAAT,IAAiB,KAAKI,QAAtB,EACA;CACC,YAAGJ,IAAI,IAAI,KAAKG,6BAAhB,EAA+C;CAC/CC,QAAAA,QAAQ,IAAI,KAAKA,QAAL,CAAcJ,IAAd,CAAZ;CACA;;CAED,aAAOI,QAAP;CACA;CAlCF;CAAA;CAAA,wCAqCC;CACC,aAAO,KAAKA,QAAZ;CACA;CAvCF;CAAA;CAAA,+BAyCYJ,IAzCZ,EA0CC;CACC,aAAO,KAAKI,QAAL,CAAcJ,IAAd,CAAP;CACA;CA5CF;CAAA;CAAA,+BA8CYA,IA9CZ,EA8CiBK,KA9CjB,EA+CC;CACC,WAAKD,QAAL,CAAcJ,IAAd,IAAsBM,MAAM,CAACD,KAAD,CAA5B;CACA,aAAO,KAAKD,QAAL,CAAcJ,IAAd,CAAP;CACA;CAlDF;CAAA;CAAA,gCAoDaI,QApDb,EAqDC;CACC,UAAIG,cAAc,GAAG,EAArB;;CAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,QAAQ,CAACK,MAA7B,EAAqCD,CAAC,EAAtC,EACA;CACC,YAAMN,OAAO,GAAGE,QAAQ,CAACI,CAAD,CAAxB;CACA,YAAME,IAAI,GAAGR,OAAO,CAAC,MAAD,CAApB;CACA,aAAKS,UAAL,CAAgBD,IAAhB,EAAqBR,OAAO,CAAC,OAAD,CAA5B;CACAK,QAAAA,cAAc,CAACG,IAAD,CAAd,GAAuBR,OAAO,CAAC,OAAD,CAA9B;CACA;;CAED,UAAMU,KAAK,GAAG,IAAIC,0BAAJ,CAAc;CAC3BC,QAAAA,IAAI,EAAE;CACLV,UAAAA,QAAQ,EAAEG,cADL;CAELP,UAAAA,IAAI,EAAE,KAAKe,OAAL;CAFD;CADqB,OAAd,CAAd;CAMAC,MAAAA,6BAAY,CAACC,IAAb,CAAkB,+BAAlB,EAAmDL,KAAnD;CACA;CAED;;CAzED;CAAA;CAAA,gCA0EaR,QA1Eb,EA2EC;CACC,WAAKc,WAAL,CAAiBd,QAAjB;CACA;CA7EF;CAAA;CAAA,6BA+EUJ,IA/EV,EAgFC;CACC,aAAO,KAAKI,QAAL,CAAcJ,IAAd,MAAwBN,SAA/B;CACA;CAlFF;CAAA;CAAA,oCAoFiBM,IApFjB,EAqFC;CAAA,UADqBK,KACrB,uEAD6B,CAC7B;;CACC,UAAG,CAAC,KAAKc,QAAL,CAAcnB,IAAd,CAAJ,EACA;CACC,eAAO,YAAP;CACA;;CACD,WAAKI,QAAL,CAAcJ,IAAd,KAAuBM,MAAM,CAACD,KAAD,CAA7B;CACA;CA3FF;CAAA;CAAA,iCA6FcL,IA7Fd,EA8FC;CAAA,UADkBK,KAClB,uEAD0B,CAC1B;;CACC,UAAG,CAAC,KAAKc,QAAL,CAAcnB,IAAd,CAAJ,EACA;CACC,eAAO,YAAP;CACA;;CAED,UAAMoB,QAAQ,GAAG,KAAKhB,QAAL,CAAcJ,IAAd,IAAsBM,MAAM,CAACD,KAAD,CAA7C;;CACA,UAAGe,QAAQ,GAAG,CAAd,EACA;CACC,eAAO,gBAAP;CACA;;CAED,WAAKhB,QAAL,CAAcJ,IAAd,IAAsBoB,QAAtB;CACA;CAED;;CA7GD;CAAA;CAAA,qCA4HC;CAAA,UAdehB,QAcf,uEAd0B,CACzB;CACCJ,QAAAA,IAAI,EAAE,UADP;CAECK,QAAAA,KAAK,EAAE,CAFR;CAGCgB,QAAAA,QAAQ,EAAE,KAHX;CAICC,QAAAA,KAAK,EAAE;CAJR,OADyB,EAOzB;CACCtB,QAAAA,IAAI,EAAE,UADP;CAECK,QAAAA,KAAK,EAAE,CAFR;CAGCgB,QAAAA,QAAQ,EAAE,IAHX;CAICC,QAAAA,KAAK,EAAE;CAJR,OAPyB,CAc1B;CACC,UAAIf,cAAc,GAAG,EAArB;CACA,UAAIgB,iCAAiC,GAAG,KAAxC;;CAEA,WAAK,IAAIf,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,QAAQ,CAACK,MAA7B,EAAqCD,CAAC,EAAtC,EACA;CACC,YAAMN,OAAO,GAAGE,QAAQ,CAACI,CAAD,CAAxB;CACA,YAAMR,IAAI,GAAGE,OAAO,CAAC,MAAD,CAApB;;CAEA,YAAGA,OAAO,CAAC,OAAD,CAAV,EACA;CACC,cAAG,KAAKsB,YAAL,CAAkBxB,IAAlB,EAAuBE,OAAO,CAAC,OAAD,CAA9B,MAA6C,gBAAhD,EACA;CACCqB,YAAAA,iCAAiC,GAAG,IAApC;CACA;CACD;;CACD,YAAGrB,OAAO,CAAC,UAAD,CAAP,IAAuBqB,iCAAiC,KAAK,KAAhE,EACA;CACC,eAAKE,eAAL,CAAqBzB,IAArB,EAA0BE,OAAO,CAAC,OAAD,CAAjC;CACA;;CAEDK,QAAAA,cAAc,CAACP,IAAD,CAAd,GAAuB,KAAK0B,UAAL,CAAgB1B,IAAhB,CAAvB;CACA;;CAED,UAAMY,KAAK,GAAG,IAAIC,0BAAJ,CAAc;CAC3BC,QAAAA,IAAI,EAAE;CACLV,UAAAA,QAAQ,EAAEG,cADL;CAELP,UAAAA,IAAI,EAAE,KAAKe,OAAL;CAFD;CADqB,OAAd,CAAd;CAMAC,MAAAA,6BAAY,CAACC,IAAb,CAAkB,+BAAlB,EAAmDL,KAAnD;CACA;CA3JF;CAAA;CAAA;;;;KCCae,QAAb,GAEC,oBAKA;CAAA,MALYC,MAKZ,uEALmB;CAClBC,IAAAA,0BAA0B,EAAE,EADV;CAElBC,IAAAA,SAAS,EAAC,EAFQ;CAGlBC,IAAAA,QAAQ,EAAE;CAHQ,GAKnB;CAAA;CACC,MAAMC,wBAAwB,GAAGC,QAAQ,CAACC,aAAT,CAAuB,yBAAvB,CAAjC;CAEA,OAAKC,aAAL,GAAqB,IAAIC,gCAAJ,CAAkB;CACtCP,IAAAA,0BAA0B,EAAED,MAAM,CAAC,4BAAD,CADI;CAEtCG,IAAAA,QAAQ,EAAEH,MAAM,CAAC,UAAD;CAFsB,GAAlB,CAArB;CAKAZ,EAAAA,6BAAY,CAACqB,SAAb,CAAuB,gCAAvB,EAAyD,YAAM;CAE9DC,IAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,iCAA3B,EAA8D,+BAA9D,EAA+F;CAC9FC,MAAAA,IAAI,EAAE,OADwF;CAE9F3B,MAAAA,IAAI,EAAE;CACLgB,QAAAA,SAAS,EAAEF,MAAM,CAAC,WAAD;CADZ;CAFwF,KAA/F,EAKGc,IALH,CAKQ,UAAAC,QAAQ,EAAI;CACnB,UAAM7B,IAAI,GAAG6B,QAAQ,CAAC7B,IAAT,IAAiB,EAA9B;CACAwB,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsB+C,WAAtB,CAAkChC,IAAlC;CACA,KARD;CASA,GAXD;CAaAkB,EAAAA,wBAAwB,CAACe,MAAzB,CAAgC,KAAKZ,aAAL,CAAmBa,OAAnB,EAAhC;CACA,CA7BF;;KCAaC,IAAb;CAEC,gBAAYC,OAAZ,EACA;CAAA;CACC,SAAKC,WAAL,GAAmBD,OAAO,CAACC,WAA3B;CACA,SAAKC,gBAAL,GAAwBF,OAAO,CAACE,gBAAhC;CACA,SAAKC,iBAAL,GAAyBH,OAAO,CAACG,iBAAjC;CACA,SAAKC,MAAL,GAAcJ,OAAO,CAACI,MAAtB;CACA,SAAKxB,SAAL,GAAiBoB,OAAO,CAACpB,SAAzB;CACA,SAAKyB,WAAL,GAAmBL,OAAO,CAACK,WAA3B;CACA,SAAKC,SAAL,GAAiBN,OAAO,CAACM,SAAzB;CACA,SAAKC,6BAAL,GAAqCP,OAAO,CAACO,6BAA7C;CACA,SAAKC,yBAAL,GAAiCR,OAAO,CAACQ,yBAAzC;CACA,SAAKC,4BAAL,GAAoCT,OAAO,CAACS,4BAA5C;CACA,SAAKC,iBAAL,GAAyB,aAAzB;CACA,SAAKC,oBAAL,GAA4B,IAAIvB,EAAE,CAACM,IAAH,CAAQkB,MAAR,CAAeC,OAAf,CAAuBd,IAAvB,CAA4Be,oBAAhC,CAAqDd,OAArD,CAA5B;CACA,SAAKW,oBAAL,CAA0BI,kBAA1B,GAA+C,KAAKA,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAA/C;CACA,SAAKL,oBAAL,CAA0BM,uBAA1B,GAAoD,KAAKA,uBAAL,CAA6BD,IAA7B,CAAkC,IAAlC,CAApD;CACA,SAAKL,oBAAL,CAA0BO,eAA1B,GAA4C,KAAKA,eAAL,CAAqBF,IAArB,CAA0B,IAA1B,CAA5C;CACA,SAAKG,KAAL,GAAa,EAAb;CACA,SAAKC,gBAAL;CAEAhC,IAAAA,EAAE,CAACM,IAAH,CAAQkB,MAAR,CAAeC,OAAf,CAAuBd,IAAvB,CAA4BC,OAAO,CAACqB,EAApC,IAA0C,IAA1C;CACA;;CAvBF;CAAA;CAAA,uCA0BC;CAAA;;CACC;CACA;CACAjC,MAAAA,EAAE,CAACC,IAAH,CAAQiC,cAAR,GAA0B,YAAW,EAArC;;CAGAxD,MAAAA,6BAAY,CAACqB,SAAb,CACC,eADD,EAEC,UAASzB,KAAT,EAAe;CACd,YAAM6D,QAAQ,GAAG7D,KAAK,CAAC8D,MAAvB;CACA,YAAMC,SAAS,GAAGF,QAAQ,CAACG,aAAT,GAAyBC,cAAzB,GAA0CC,iBAA1C,EAAlB;CACA,YAAIP,EAAE,GAAG,IAAT;;CAEA,YAAII,SAAJ,EACA;CACCJ,UAAAA,EAAE,GAAGjC,EAAE,CAACxB,IAAH,CAAQ6D,SAAR,EAAmB,aAAnB,CAAL;CACA;;CAEDrC,QAAAA,EAAE,CAACxB,IAAH,CACC2D,QAAQ,CAACM,UAAT,GAAsBF,cAAtB,GAAuCC,iBAAvC,EADD,EAEC,aAFD,EAGCL,QAAQ,CAACO,SAAT,IAAsBT,EAHvB;CAKA,OAjBF;CAoBAjC,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAaoC,YAAb,CAA0B9C,aAA1B,CAAwC+C,YAAxC,CAAqD,KAAKC,gBAAL,EAArD;CAEAnE,MAAAA,6BAAY,CAACqB,SAAb,CAAuB,wBAAvB,EAAiD,YACjD;CACC,QAAA,KAAI,CAAC4B,kBAAL;CACA,OAHD;CAKAjD,MAAAA,6BAAY,CAACqB,SAAb,CAAuB,+BAAvB,EAAwD,UAACzB,KAAD,EAAW;CAClE,YAAGA,KAAK,CAAC,MAAD,CAAL,CAAc,MAAd,MAAyB,iBAA5B,EACA;CACC,cAAMR,QAAQ,GAAGQ,KAAK,CAAC,MAAD,CAAL,CAAc,UAAd,CAAjB;CACA0B,UAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAaoC,YAAb,CAA0B9C,aAA1B,CAAwCW,WAAxC,CAAoD1C,QAApD;;CACA,cAAMgF,kBAAkB,GAAGhF,QAAQ,CAAC,KAAI,CAAC+E,gBAAL,EAAD,CAAnC;;CAEA,cAAIC,kBAAkB,KAAK1F,SAA3B,EACA;CACC,YAAA,KAAI,CAAC2F,wBAAL,CAA8BD,kBAA9B;CACA;;CAED9C,UAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAayC,eAAb,CAA6BxC,WAA7B,CAAyC,CACxC;CACCpC,YAAAA,IAAI,EAAE,6BADP;CAECL,YAAAA,KAAK,EAAEiC,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBwF,eAAtB;CAFR,WADwC,CAAzC;CAMA,SAjBD,MAmBA;CACC,UAAA,KAAI,CAAC1B,oBAAL,CAA0B2B,qBAA1B;CACA;CACD,OAvBD;CAyBAxE,MAAAA,6BAAY,CAACqB,SAAb,CAAuB,iCAAvB,EAA0D,UAACzB,KAAD,EAAW;CACpE,QAAA,KAAI,CAACyE,wBAAL,CAA8B/C,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsB2B,UAAtB,CAAiCd,KAAK,CAAC,MAAD,CAAL,CAAc,WAAd,CAAjC,CAA9B;CACA,OAFD;CAIAI,MAAAA,6BAAY,CAACqB,SAAb,CAAuB,gCAAvB,EAAyD,UAASzB,KAAT,EAAgB;CACxE,YAAM6D,QAAQ,GAAG7D,KAAK,CAAC8D,MAAvB;;CAEA,YAAI,CAACD,QAAQ,CAACgB,OAAV,IAAqB,CAAChB,QAAQ,CAACG,aAAT,EAA1B,EACA;CACC;CACA;;CAED,YAAMc,UAAU,GAAGjB,QAAQ,CAACG,aAAT,EAAnB;CACA,YAAMe,YAAY,GAAGD,UAAU,CAACE,YAAX,EAArB;CAEA,YAAMlF,IAAI,GAAG+D,QAAQ,CAACgB,OAAT,CAAiB/E,IAA9B;CACA,YAAMmF,IAAI,GAAGpB,QAAQ,CAACgB,OAAT,CAAiBK,MAA9B;CACA,YAAMC,QAAQ,GAAGtB,QAAQ,CAACgB,OAAT,CAAiBM,QAAlC;;CAEA,YAAI,CAACA,QAAL,EACA;CACC;CACA;;CAED,aAAK,IAAIvF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmF,YAAY,CAAClF,MAAjC,EAAyCD,CAAC,EAA1C,EACA;CACC,cAAMwF,IAAI,GAAGL,YAAY,CAACnF,CAAD,CAAzB;;CAEA,cAAIwF,IAAI,CAACC,KAAL,OAAiBvF,IAArB,EACA;CACC,gBAAMwF,UAAU,GAAGF,IAAI,CAACE,UAAL,EAAnB;;CAEA,gBAAIA,UAAJ,EACA;CACCF,cAAAA,IAAI,CAACG,WAAL;CACA,kBAAMC,OAAO,GAAGJ,IAAI,CAACjB,UAAL,EAAhB;CAEA,kBAAIsB,cAAc,GAAG,KAArB;;CAEA,kBAAID,OAAJ,EACA;CACC,oBAAME,KAAK,GAAGF,OAAO,CAACR,YAAR,EAAd;;CAEA,qBAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAC7F,MAA1B,EAAkC8F,CAAC,EAAnC,EACA;CACC,sBAAMC,OAAO,GAAGF,KAAK,CAACC,CAAD,CAArB;;CAEA,sBAAIC,OAAO,CAACP,KAAR,OAAoB,SAAxB,EACA;CACCI,oBAAAA,cAAc,GAAG,IAAjB;CACA;CACD;CACD;;CAED,kBAAI,CAACA,cAAL,EACA;CACC;CACA;CACD;;CAED,iBAAKI,aAAL,CAAmBT,IAAnB,EAAyBH,IAAzB;CACA;CACD;CACD,OA3DwD,CA2DvD3B,IA3DuD,CA2DlD,IA3DkD,CAAzD;CA6DA,UAAMwC,SAAS,GAAGzE,QAAQ,CAAC0E,gBAAT,CAA0B,0BAA1B,CAAlB;;CAEA,WAAK,IAAInG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkG,SAAS,CAACjG,MAA9B,EAAsCD,CAAC,EAAvC,EACA;CACCkG,QAAAA,SAAS,CAAClG,CAAD,CAAT,CAAaoG,gBAAb,CAA8B,OAA9B,EAAuC,KAAKC,oBAAL,CAA0B3C,IAA1B,CAA+B,IAA/B,CAAvC;CACA;;CAED5B,MAAAA,EAAE,CAACwE,YAAH,CAAgB7E,QAAQ,CAAC8E,IAAzB,EAA+B,OAA/B,EAAwC;CAAEC,QAAAA,SAAS,EAAE;CAAb,OAAxC,EAAoF,KAAKC,iBAAL,CAAuB/C,IAAvB,CAA4B,IAA5B,CAApF;CACA;CA7JF;CAAA;CAAA,6CA+J0B7D,KA/J1B,EAgKC;CACC,UAAGA,KAAK,GAAG,CAAX,EAAa;CACZ,aAAK8C,WAAL,CAAiB+D,WAAjB,GAA+B7G,KAA/B;CACA,aAAK+C,gBAAL,CAAsBxD,SAAtB,CAAgCE,MAAhC,CAAuC,cAAvC;CACA,aAAKuD,iBAAL,CAAuBzD,SAAvB,CAAiCE,MAAjC,CAAwC,cAAxC;CACA,OAJD,MAMA;CACC,aAAKsD,gBAAL,CAAsBxD,SAAtB,CAAgCC,GAAhC,CAAoC,cAApC;CACA,aAAKwD,iBAAL,CAAuBzD,SAAvB,CAAiCC,GAAjC,CAAqC,cAArC;CACA;CACD;CA3KF;CAAA;CAAA,kCA6Ke4E,QA7Kf,EA6KyBoB,IA7KzB,EA8KC;CACC,UAAMsB,IAAI,GAAG,KAAKC,QAAL,CAAc3C,QAAQ,CAACwB,KAAT,EAAd,CAAb;CACA,UAAMoB,KAAK,GAAG/E,EAAE,CAACgF,IAAH,CAAQC,YAAR,CAAqBC,YAArB,CAAkC,8BAA8B/C,QAAQ,CAACwB,KAAT,EAAhE,CAAd;;CAEA,UAAIoB,KAAJ,EACA;CACCA,QAAAA,KAAK,CAACI,OAAN;CACA;;CAED,UAAIN,IAAJ,EACA;CACC1C,QAAAA,QAAQ,CAACiD,cAAT;CACAjD,QAAAA,QAAQ,CAACkD,UAAT,CAAoBR,IAApB;CACA1C,QAAAA,QAAQ,CAAC0B,WAAT;CACA;CACA;;CAED,UAAMK,OAAO,GAAG;CACf,cAAM,SADS;CAEf,gBAAQoB,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAFO;CAGf,oBAAY;CAHG,OAAhB;CAMApD,MAAAA,QAAQ,CAACiD,cAAT;CACAjD,MAAAA,QAAQ,CAACkD,UAAT,CAAoB,CAACnB,OAAD,CAApB;CACA/B,MAAAA,QAAQ,CAAC0B,WAAT;CAEA7D,MAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,gCAA3B,EAA6D,OAA7D,EAAsE;CACrEC,QAAAA,IAAI,EAAE,OAD+D;CAErE3B,QAAAA,IAAI,EAAE;CAAEgB,UAAAA,SAAS,EAAE,KAAKA,SAAlB;CAA6BgG,UAAAA,GAAG,EAAE;CAAEpH,YAAAA,IAAI,EAAE+D,QAAQ,CAACwB,KAAT,EAAR;CAA0BH,YAAAA,MAAM,EAAED;CAAlC;CAAlC;CAF+D,OAAtE,EAGGnD,IAHH,CAIC,UAASC,QAAT,EAAmB;CAClB,YAAMoF,IAAI,GAAGpF,QAAQ,CAAC7B,IAAT,CAAciH,IAA3B;CACA,YAAMzB,KAAK,GAAG,EAAd;;CAEA,aAAK,IAAI9F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuH,IAAI,CAACtH,MAAzB,EAAiCD,CAAC,EAAlC,EACA;CACC,cAAMuF,QAAQ,GAAG,iBAAiBiC,IAAjB,CAAsBD,IAAI,CAACvH,CAAD,CAAJ,CAAQyH,KAA9B,CAAjB;CACA,cAAMjC,IAAI,GAAG;CACZ,kBAAM+B,IAAI,CAACvH,CAAD,CAAJ,CAAQ0H,IADF;CAEZ,oBAAQH,IAAI,CAACvH,CAAD,CAAJ,CAAQ2H,IAFJ;CAGZ,uBAAW;CACV,sBAAQJ,IAAI,CAACvH,CAAD,CAAJ,CAAQ0H,IADN;CAEV,wBAAUH,IAAI,CAACvH,CAAD,CAAJ,CAAQ4H,OAFR;CAGV,4BAAcL,IAAI,CAACvH,CAAD,CAAJ,CAAQ6H,WAHZ;CAIV,0BAAYtC;CAJF,aAHC;CASZO,YAAAA,KAAK,EAAEP,QAAQ,GAAG,CAAC;CAClBxB,cAAAA,EAAE,EAAE,SADc;CAElB,sBAAQqD,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAFU;CAGlB,0BAAY;CAHM,aAAD,CAAH,GAIV;CAbO,WAAb;CAgBAvB,UAAAA,KAAK,CAACgC,IAAN,CAAWtC,IAAX;CACA;;CAED,aAAKuC,QAAL,CAAc9D,QAAQ,CAACwB,KAAT,EAAd,EAAgCK,KAAhC;CAEA,YAAMe,KAAK,GAAG/E,EAAE,CAACgF,IAAH,CAAQC,YAAR,CAAqBC,YAArB,CAAkC,8BAA8B/C,QAAQ,CAACwB,KAAT,EAAhE,CAAd;CACA,YAAMuC,OAAO,GAAG/D,QAAQ,CAACG,aAAT,GAAyBC,cAAzB,GAA0C2D,OAA1C,EAAhB;;CAEA,YAAInB,KAAJ,EACA;CACCA,UAAAA,KAAK,CAACI,OAAN;CACA;;CAED,YAAIe,OAAJ,EACA;CACC/D,UAAAA,QAAQ,CAACiD,cAAT;CACAjD,UAAAA,QAAQ,CAACkD,UAAT,CAAoBrB,KAApB;CACA7B,UAAAA,QAAQ,CAAC0B,WAAT;CACA;CACD,OA1CD,CA0CEjC,IA1CF,CA0CO,IA1CP,CAJD,EA+CC,UAASvB,QAAT,EAAmB,EAAnB,CACEuB,IADF,CACO,IADP,CA/CD;CAkDA;CA3PF;CAAA;CAAA,qCA6PkBuE,IA7PlB,EA8PC;CACCC,MAAAA,GAAG,CAACC,gBAAJ,CAAqBC,IAArB,CACCH,IADD,EAECb,aAAG,CAACC,UAAJ,CAAe,sDAAf,CAFD,EAGC,KAAKpE,6BAHN;CAKA;CApQF;CAAA;CAAA,+BAsQYc,EAtQZ,EAuQC;CACC,UAAMsE,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAjB;CACA,UAAMC,GAAG,GAAGzE,EAAE,GAAG,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC1E,EAAzC,CAAH,GAAkDsE,QAAQ,CAAC,CAAD,CAAxE;;CACA,UAAI,EAAEG,GAAG,IAAIA,GAAG,CAAC7J,IAAb,CAAJ,EACA;CACC;CACA;;CACD,UAAM+J,QAAQ,GAAG,KAAKrF,oBAAL,CAA0BsF,yBAA1B,CAAoDH,GAAG,CAAC7J,IAAxD,CAAjB;CACA,UAAMiK,aAAa,GAAGJ,GAAG,CAAC7J,IAAJ,CAAS+C,aAAT,CAAuB,mBAAvB,CAAtB;;CACA,UAAI,EAAEkH,aAAa,CAAC3D,OAAd,IAAyB2D,aAAa,CAAC3D,OAAd,CAAsB4D,SAAjD,CAAJ,EACA;CACC;CACA;;CAED,UAAG9E,EAAE,KAAK7E,SAAV,EACA;CACC,aAAKuE,kBAAL;CACA;;CAED,UAAIiF,QAAJ,EACA;CACC,YAAI,oBAAO,KAAKI,uBAAZ,MAAwC,QAA5C,EACA;CACC,eAAKA,uBAAL,GAA+B,EAA/B;CACA;;CACD,YAAI,KAAKA,uBAAL,CAA6B/E,EAA7B,MAAqC,IAAzC,EACA;CACC;CACA;;CACD,aAAK+E,uBAAL,CAA6B/E,EAA7B,IAAmC,IAAnC;CAEAjC,QAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CACC,oBADD,EAEC,mBAFD,EAGC;CACCC,UAAAA,IAAI,EAAE,MADP;CAEC3B,UAAAA,IAAI,EAAE;CACLuI,YAAAA,SAAS,EAAED,aAAa,CAAC3D,OAAd,CAAsB4D;CAD5B,WAFP;CAKCE,UAAAA,cAAc,EAAE;CACf,0BAAcV,QAAQ,CAACpI,MADR;CAEf,wBAAY,KAAK+I,eAAL,CAAqB,CAACR,GAAD,CAArB;CAFG;CALjB,SAHD,EAaEtG,IAbF,CAcC,UAAS6B,EAAT,EAAa;CACZ,eAAK+E,uBAAL,CAA6B/E,EAA7B,IAAmC,KAAnC;CACA,eAAKkF,MAAL,CAAY7B,aAAG,CAACC,UAAJ,CAAe,uCAAf,CAAZ;CACA,SAHD,CAGE3D,IAHF,CAGO,IAHP,EAGaK,EAHb,CAdD,EAkBC,UAASmF,IAAT,EAAe;CACd,eAAKJ,uBAAL,CAA6B/E,EAA7B,IAAmC,KAAnC;;CACA,cAAImF,IAAI,CAACC,MAAL,IAAeD,IAAI,CAACC,MAAL,CAAYlJ,MAAZ,GAAqB,CAAxC,EACA;CACC,iBAAKgJ,MAAL,CAAYC,IAAI,CAACC,MAAL,CAAYC,GAAZ,CACX,UAAS5D,IAAT,EAAe;CACd,qBAAOA,IAAI,CAAC6D,OAAZ;CACA,aAHU,EAIVC,IAJU,CAIL,MAJK,CAAZ,EAIgB,IAJhB;CAKA,WAPD,MASA;CACC,iBAAKL,MAAL,CAAY7B,aAAG,CAACC,UAAJ,CAAe,2CAAf,CAAZ;CACA;CACD,SAdD,CAcE3D,IAdF,CAcO,IAdP,CAlBD;CAkCA,OA9CD,MAgDA;CACC5B,QAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CACC,oBADD,EAEC,mBAFD,EAGC;CACCC,UAAAA,IAAI,EAAE,MADP;CAEC3B,UAAAA,IAAI,EAAE;CACLuI,YAAAA,SAAS,EAAED,aAAa,CAAC3D,OAAd,CAAsB4D;CAD5B,WAFP;CAKCE,UAAAA,cAAc,EAAE;CACf,0BAAcV,QAAQ,CAACpI,MADR;CAEf,wBAAY,KAAK+I,eAAL,CAAqB,CAACR,GAAD,CAArB;CAFG;CALjB,SAHD,EAaEtG,IAbF,CAaO,UAAS0G,aAAT,EAAwB;CAC9B,eAAKvF,oBAAL,CAA0BkG,mBAA1B,CAA8CX,aAAa,CAAC3D,OAAd,CAAsB4D,SAApE;CACA,eAAKI,MAAL,CAAY7B,aAAG,CAACC,UAAJ,CAAe,4CAAf,CAAZ;CACA,SAHM,CAGL3D,IAHK,CAGA,IAHA,EAGMkF,aAHN,CAbP;CAiBA;;CAED,UAAIY,WAAW,GAAG,KAAK5F,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAAlB;;CACA,UAAGD,WAAW,CAACvJ,MAAZ,KAAuB,CAAvB,IAA4BuJ,WAAW,CAAC,CAAD,CAAX,KAAiBzF,EAAhD,EACA;CACC,aAAKN,kBAAL;CACA;CACD;CAnWF;CAAA;CAAA,gCAqWaM,EArWb,EAsWC;CACC,UAAIA,EAAE,KAAK7E,SAAP,IAAoB,KAAK0E,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,GAAkDxJ,MAAlD,KAA6D,CAArF,EACA;CACC;CACA,OAJF;;;CAMC6B,MAAAA,EAAE,CAAC4H,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B,mBAAmB7F,EAA9C,EAAkD;CACjD8F,QAAAA,KAAK,EAAE,IAD0C;CAEjDC,QAAAA,MAAM,EAAE;CAFyC,OAAlD;CAIA;CAhXF;CAAA;CAAA,wCAkXqB/F,EAlXrB,EAmXC;CACC,UAAIgG,iBAAiB,GACrB;CACC,6BAAsB;CADvB,OADA;CAIA,WAAKC,aAAL,CAAmBjG,EAAnB,EAAsBgG,iBAAtB;CACA;CAzXF;CAAA;CAAA,kCA2XehG,EA3Xf,EA2XkBgG,iBA3XlB,EA4XC;CACC,UAAM1B,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAjB;;CACA,UAAIxE,EAAE,KAAK7E,SAAP,IAAoBmJ,QAAQ,CAACpI,MAAT,KAAoB,CAA5C,EACA;CACC;CACA;;CACD,UAAI,CAAC,KAAK+C,SAAV,EACA;CACC,aAAKiH,cAAL;CACA;CACA;;CACD,UAAIvH,OAAO,GAAG;CACbwH,QAAAA,MAAM,EAAGH,iBAAiB,KAAK7K,SAAvB,GAAoC6K,iBAApC,GAAwD,EADnD;CAEbI,QAAAA,QAAQ,EAAE,IAFG;CAGbpB,QAAAA,cAAc,EAAE;CACf,wBAAcV,QAAQ,CAACpI,MADR;CAEf,sBAAY,KAAK+I,eAAL,CAAqBjF,EAAE,GAAG,CAAC,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC1E,EAAzC,CAAD,CAAH,GAAoDsE,QAA3E;CAFG;CAHH,OAAd;CAQA,UAAImB,WAAJ;;CAEA,UAAGzF,EAAE,KAAK7E,SAAV,EACA;CACCsK,QAAAA,WAAW,GAAG1H,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBX,cAAlB,EAAd;CACA,OAHD,MAKA;CACCD,QAAAA,WAAW,GAAG,CAACzF,EAAD,CAAd;CACA;;CAEDyF,MAAAA,WAAW,GAAG,KAAKa,qBAAL,CAA2B,KAAKjH,iBAAhC,EAAmDoG,WAAnD,EAAgE,IAAhE,CAAd;CACA9G,MAAAA,OAAO,CAAC4H,GAAR,GAAcd,WAAd;;CAEA,UAAI,KAAKnG,oBAAL,CAA0BkH,oBAA1B,IAAmDR,iBAAiB,KAAK7K,SAAtB,IAAmC6K,iBAAiB,CAAC,mBAAD,CAA3G,EACA;CACC,YAAMS,YAAY,GAAG,KAAKC,qBAAL,CAA2B/H,OAA3B,CAArB;CACA8H,QAAAA,YAAY,CAACpC,IAAb;CACA,OAJD,MAMA;CACCtG,QAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBM,YAAlB,CAA+BlB,WAA/B;CAEA,YAAMmB,kBAAkB,GAAG,KAAKN,qBAAL,CAA2B,2BAA3B,EAAwDb,WAAxD,EAAqEvJ,MAAhG;CAEA6B,QAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,UAAAA,IAAI,EAAE,KAAKmF,gBAAL,EADP;CAEC7D,UAAAA,KAAK,EAAE,IAFR;CAGCjB,UAAAA,KAAK,EAAE8K;CAHR,SADoC,CAArC;CAQA,aAAKE,SAAL,CAAe,QAAf,EAAyBnI,OAAzB,EAAiC;CAAA,iBAChCZ,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBU,WAAlB,EADgC;CAAA,SAAjC;;CAGA,YAAG/G,EAAE,KAAK7E,SAAV,EACA;CACC,eAAKuE,kBAAL;CACA;CACD;CACD;CAxbF;CAAA;CAAA,wCA0bqBrD,KA1brB,EA2bC;CACC,UAAM2K,aAAa,GAAG3K,KAAK,CAAC4K,aAAN,CAAoB/F,OAA1C;CACA,UAAIlB,EAAE,GAAG7E,SAAT;CACA,UAAM+L,YAAY,GAAGnJ,EAAE,CAACoJ,UAAH,CAAc9K,KAAK,CAAC4K,aAApB,EAAmC;CAAExE,QAAAA,SAAS,EAAE;CAAb,OAAnC,CAArB;;CACA,UAAIyE,YAAJ,EACA;CACClH,QAAAA,EAAE,GAAGjC,EAAE,CAACxB,IAAH,CAAQ2K,YAAR,EAAsB,aAAtB,CAAL;CACA;;CACD,UAAME,UAAU,GAAGC,IAAI,CAACC,KAAL,CAAWN,aAAa,CAACI,UAAzB,CAAnB;CACA,UAAMG,cAAc,GAAGP,aAAa,CAAC7K,IAArC;CACA,UAAMqL,cAAc,GAAGD,cAAvB;;CAEA,UAAKvH,EAAE,KAAK7E,SAAP,IAAoB,KAAK0E,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,GAAkDxJ,MAAlD,KAA6D,CAAlF,IAAwFkL,UAA5F,EACA;CACC;CACA;;CACD,UAAI9C,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAf;CACA,UAAIiD,YAAY,GAAIzH,EAAE,GAAG,CAACA,EAAD,CAAH,GAAU,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAAhC;CACA+B,MAAAA,YAAY,GAAG,KAAKnB,qBAAL,CAA2B,KAAKjH,iBAAhC,EAAmDoI,YAAnD,EAAiE,IAAjE,CAAf;;CACA,UAAI,CAACA,YAAY,CAACvL,MAAlB,EACA;CACC;CACA,OAtBF;;;CAyBC6B,MAAAA,EAAE,CAAC2J,aAAH,CAAiB,eAAjB;CAEA,UAAIjC,WAAJ;;CAEA,UAAGzF,EAAE,KAAK7E,SAAV,EACA;CACCsK,QAAAA,WAAW,GAAG1H,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBX,cAAlB,EAAd;CACA,OAHD,MAKA;CACCD,QAAAA,WAAW,GAAG,CAACzF,EAAD,CAAd;CACA;;CAEDjC,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBM,YAAlB,CAA+BlB,WAA/B;CAEA,UAAMmB,kBAAkB,GAAG,KAAKN,qBAAL,CAA2B,2BAA3B,EAAwDb,WAAxD,EAAqEvJ,MAAhG;CAEA6B,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,QAAAA,IAAI,EAAC+L,cADN;CAEC1K,QAAAA,QAAQ,EAAE,IAFX;CAGChB,QAAAA,KAAK,EAAE8K;CAHR,OADoC,EAMpC;CACCnL,QAAAA,IAAI,EAAE,KAAKmF,gBAAL,EADP;CAEC7D,QAAAA,KAAK,EAAE,IAFR;CAGCjB,QAAAA,KAAK,EAAE8K;CAHR,OANoC,CAArC;CAaA,WAAKE,SAAL,CACC,cADD,EAEC;CACCV,QAAAA,QAAQ,EAAE,IADX;CAECG,QAAAA,GAAG,EAAEkB,YAFN;CAGCtB,QAAAA,MAAM,EAAE;CACPwB,UAAAA,MAAM,EAAEJ;CADD,SAHT;CAMCvC,QAAAA,cAAc,EAAE;CACf,wBAAcV,QAAQ,CAACpI,MADR;CAEf,sBAAY,KAAK+I,eAAL,CAAqBjF,EAAE,GAAG,CAAC,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC1E,EAAzC,CAAD,CAAH,GAAoDsE,QAA3E;CAFG;CANjB,OAFD,EAaC,YAAK;CACJvG,QAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBU,WAAlB;CACA,OAfF;;CAiBA,UAAG/G,EAAE,KAAK7E,SAAV,EACA;CACC,aAAKuE,kBAAL;CACA;CACD;CAvgBF;CAAA;CAAA,gCAygBaM,EAzgBb,EA0gBC;CACC,UAAIsE,QAAQ,GAAG,EAAf;CACA,UAAIsD,SAAS,GAAG,EAAhB;;CAEA,UAAG5H,EAAE,KAAK7E,SAAV,EACA;CACCmJ,QAAAA,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAX;CACAoD,QAAAA,SAAS,GAAG,KAAK/H,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAAZ;CACA,OAJD,MAMA;CACC,YAAID,WAAW,GAAG,KAAK5F,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAAlB;;CACA,YAAGD,WAAW,CAACvJ,MAAZ,KAAuB,CAAvB,IAA4BuJ,WAAW,CAAC,CAAD,CAAX,KAAiBzF,EAAhD,EACA;CACC;;;CAGAsE,UAAAA,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAX;CACAoD,UAAAA,SAAS,GAAGnC,WAAZ;CACAzF,UAAAA,EAAE,GAAG7E,SAAL;CACA,SARD,MAUA;CACCyM,UAAAA,SAAS,GAAG,CAAC5H,EAAD,CAAZ;CACA;CAED;;CACD,UAAIA,EAAE,KAAK7E,SAAP,IAAoBmJ,QAAQ,CAACpI,MAAT,KAAoB,CAA5C,EACA;CACC;CACA;;CACD,UAAM2L,UAAU,GAAG,SAAS7H,EAAT,IAAe,KAAKJ,uBAAL,CAA6B,2BAA7B,EAA0DI,EAA1D,CAAf,GAA+E,YAA/E,GAA8F,cAAjH;CAEA4H,MAAAA,SAAS,GAAG,KAAKtB,qBAAL,CAA2B,2BAA3B,EAAwDsB,SAAxD,EAAmEC,UAAU,KAAK,YAAlF,CAAZ;CACAD,MAAAA,SAAS,GAAG,KAAKtB,qBAAL,CAA2B,KAAKjH,iBAAhC,EAAmDuI,SAAnD,EAA8D,IAA9D,CAAZ;;CACA,UAAI,CAACA,SAAS,CAAC1L,MAAf,EACA;CACC;CACA;;CAED,UAAM4L,OAAO,GAAG,SAAVA,OAAU,GAAW;CAC1B,aAAKxI,oBAAL,CAA0ByI,cAA1B,CAAyCH,SAAzC,EAAoD;CAAEI,UAAAA,MAAM,EAAEH;CAAV,SAApD;CACA,YAAMI,aAAa,GAAG,KAAKrH,gBAAL,EAAtB;;CACA,YAAIiH,UAAU,KAAK,YAAnB,EACA;CACC,cAAI/L,KAAK,GAAG8L,SAAS,CAAC1L,MAAtB;;CACA,cAAI,UAAU8D,EAAd,EACA;CACClE,YAAAA,KAAK,GAAGiC,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsB2B,UAAtB,CAAiC8K,aAAjC,CAAR;CACA;;CACDlK,UAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,YAAAA,IAAI,EAAEwM,aADP;CAEClL,YAAAA,KAAK,EAAE,IAFR;CAGCjB,YAAAA,KAAK,EAAEA;CAHR,WADoC,CAArC;CAOA,SAdD,MAgBA;CACCiC,UAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,YAAAA,IAAI,EAAEwM,aADP;CAECnL,YAAAA,QAAQ,EAAE,IAFX;CAGChB,YAAAA,KAAK,EAAE8L,SAAS,CAAC1L;CAHlB,WADoC,CAArC;CAOA;;CAED,YAAG8D,EAAE,KAAK7E,SAAV,EAAqB;CACpB,eAAKuE,kBAAL;CACA;;CAED,YAAI,SAASM,EAAb,EACA;CACC4H,UAAAA,SAAS,CAAC,SAAD,CAAT,GAAuB,KAAKrK,SAAL,GAAiB,GAAjB,GAAuB,KAAK+B,oBAAL,CAA0BsB,gBAA1B,EAA9C;CACA;;CAED,aAAKtB,oBAAL,CAA0B4I,oBAA1B;CAEA,aAAKpB,SAAL,CAAee,UAAf,EAA2B;CAC1BtB,UAAAA,GAAG,EAAEqB,SADqB;CAE1BxB,UAAAA,QAAQ,EAAE,IAFgB;CAG1B+B,UAAAA,aAAa,EAAEN,UAHW;CAI1B7C,UAAAA,cAAc,EAAE;CACf,0BAAcV,QAAQ,CAACpI,MADR;CAEf,wBAAY,KAAK+I,eAAL,CAAqBjF,EAAE,GAAG,CAAC,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC1E,EAAzC,CAAD,CAAH,GAAoDsE,QAA3E;CAFG,WAJU;CAQ1B8D,UAAAA,SAAS,EAAE;CARe,SAA3B;CAWA,eAAO,IAAP;CACA,OApDD;;CAqDAN,MAAAA,OAAO,CAACO,KAAR,CAAc,IAAd;CACA;CAxmBF;CAAA;CAAA,gCA0mBarI,EA1mBb,EA2mBC;CACC,UAAMsE,QAAQ,GAAG,KAAKzE,eAAL,GAAuB0E,OAAvB,GAAiCC,WAAjC,EAAjB;;CACA,UAAIxE,EAAE,KAAK7E,SAAP,IAAoBmJ,QAAQ,CAACpI,MAAT,KAAoB,CAA5C,EACA;CACC;CACA;;CACD,UAAI,CAAC,KAAK8C,WAAV,EACA;CACC,aAAKkH,cAAL;CACA;CACA;;CACD,UAAM2B,UAAU,GAAG,KAAKjI,uBAAL,CAA6B,SAA7B,EAAwCI,EAAxC,IAA8C,iBAA9C,GAAkE,YAArF;CACA,UAAI4H,SAAS,GAAG,KAAKtB,qBAAL,CAA2B,SAA3B,EAAsCtG,EAAtC,EAA0C6H,UAAU,KAAK,iBAAzD,CAAhB;CACAD,MAAAA,SAAS,GAAG,KAAKtB,qBAAL,CAA2B,KAAKjH,iBAAhC,EAAmDuI,SAAnD,EAA8D,IAA9D,CAAZ;;CACA,UAAI,CAACA,SAAS,CAAC1L,MAAf,EACA;CACC;CACA;;CACD,UAAMyC,OAAO,GAAG;CACfyH,QAAAA,QAAQ,EAAE,IADK;CAEfpB,QAAAA,cAAc,EAAE;CACf,wBAAcV,QAAQ,CAACpI,MADR;CAEf,sBAAY,KAAK+I,eAAL,CAAqBjF,EAAE,GAAG,CAAC,KAAKH,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC1E,EAAzC,CAAD,CAAH,GAAoDsE,QAA3E;CAFG;CAFD,OAAhB;CAQA,UAAImB,WAAJ;;CAEA,UAAGzF,EAAE,KAAK7E,SAAV,EACA;CACCsK,QAAAA,WAAW,GAAG1H,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBX,cAAlB,EAAd;CACA,OAHD,MAKA;CACCD,QAAAA,WAAW,GAAG,CAACzF,EAAD,CAAd;CACA;;CAEDrB,MAAAA,OAAO,CAAC4H,GAAR,GAAcd,WAAd;CAEA1H,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBM,YAAlB,CAA+BlB,WAA/B;CAEA,UAAMmB,kBAAkB,GAAG,KAAKN,qBAAL,CAA2B,2BAA3B,EAAwDb,WAAxD,EAAqEvJ,MAAhG;;CAEA,UAAG2L,UAAU,KAAK,YAAlB,EACA;CACC9J,QAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,UAAAA,IAAI,EAAE,KAAK6D,oBAAL,CAA0BgJ,OADjC;CAECxL,UAAAA,QAAQ,EAAE,IAFX;CAGChB,UAAAA,KAAK,EAAE8K;CAHR,SADoC,EAMpC;CACCnL,UAAAA,IAAI,EAAE,KAAKmF,gBAAL,EADP;CAEC7D,UAAAA,KAAK,EAAE,IAFR;CAGCjB,UAAAA,KAAK,EAAE8K;CAHR,SANoC,CAArC;CAYA,OAdD,MAgBA;CACC7I,QAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa9C,QAAb,CAAsBqL,cAAtB,CAAqC,CACpC;CACCpL,UAAAA,IAAI,EAAE,KAAK6D,oBAAL,CAA0BgJ,OADjC;CAECvL,UAAAA,KAAK,EAAE,IAFR;CAGCjB,UAAAA,KAAK,EAAE8K;CAHR,SADoC,EAMpC;CACCnL,UAAAA,IAAI,EAAE,KAAK6D,oBAAL,CAA0BiJ,QADjC;CAECzL,UAAAA,QAAQ,EAAE,IAFX;CAGChB,UAAAA,KAAK,EAAE8K;CAHR,SANoC,CAArC;CAYA;;CAED,WAAKE,SAAL,CAAee,UAAf,EAA2BlJ,OAA3B,EAAmC;CAAA,eAClCZ,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBU,WAAlB,EADkC;CAAA,OAAnC;;CAGA,UAAG/G,EAAE,KAAK7E,SAAV,EACA;CACC,aAAKuE,kBAAL;CACA;CACD;CA5rBF;CAAA;CAAA,0CA8rBuBf,OA9rBvB,EA+rBC;CACC,aAAO,IAAIZ,EAAE,CAACyK,EAAH,CAAMC,OAAN,CAAcC,UAAlB,CAA6B;CACnCC,QAAAA,KAAK,EAAEtF,aAAG,CAACC,UAAJ,CAAe,iCAAf,CAD4B;CAEnCgC,QAAAA,OAAO,EAAEjC,aAAG,CAACC,UAAJ,CAAe,kCAAf,CAF0B;CAGnCsF,QAAAA,OAAO,EAAE,CACR,IAAI7K,EAAE,CAACyK,EAAH,CAAMK,MAAV,CAAiB;CAChBC,UAAAA,KAAK,EAAE/K,EAAE,CAACyK,EAAH,CAAMK,MAAN,CAAaE,KAAb,CAAmBC,MADV;CAEhBC,UAAAA,IAAI,EAAE5F,aAAG,CAACC,UAAJ,CAAe,sCAAf,CAFU;CAGhB4F,UAAAA,OAAO,EAAG,UAASrO,MAAT,EAAiB;CAC1B,iBAAKiM,SAAL,CAAe,QAAf,EAAyBnI,OAAzB,EAAiC;CAAA,qBAChCZ,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBU,WAAlB,EADgC;CAAA,aAAjC;CAGAlM,YAAAA,MAAM,CAACsO,UAAP,GAAoBC,KAApB;CACArL,YAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBM,YAAlB,CAA+BhI,OAAO,CAAC4H,GAAvC;CACA,WANQ,CAMN5G,IANM,CAMD,IANC;CAHO,SAAjB,CADQ,EAYR,IAAI5B,EAAE,CAACyK,EAAH,CAAMa,YAAV,CAAuB;CACtBH,UAAAA,OAAO,EAAE,iBAASrO,MAAT,EAAiB;CACzBA,YAAAA,MAAM,CAACsO,UAAP,GAAoBC,KAApB;CACA;CAHqB,SAAvB,CAZQ;CAH0B,OAA7B,CAAP;CAsBA;CAttBF;CAAA;CAAA,yCAytBC;CACCrL,MAAAA,EAAE,CAAC2J,aAAH,CAAiB,0BAAjB;CACA,WAAK7H,eAAL,GAAuB0E,OAAvB,GAAiC+E,WAAjC;CACA,WAAKzJ,eAAL,GAAuB0J,wBAAvB;CACAxL,MAAAA,EAAE,CAACM,IAAH,CAAQC,IAAR,CAAa+H,IAAb,CAAkBmD,SAAlB;CACA;CA9tBF;CAAA;CAAA,4CAguByB/G,SAhuBzB,EAguBoCzC,EAhuBpC,EAiuBC;CACC,UAAIyF,WAAJ;;CACA,UAAGzF,EAAE,KAAK7E,SAAV,EACA;CACCsK,QAAAA,WAAW,GAAG,KAAK5F,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAAd;CACA,OAHD,MAKA;CACCD,QAAAA,WAAW,GAAG,CAACzF,EAAD,CAAd;CACA;;CACD,UAAMuG,GAAG,GAAGd,WAAW,CAACvJ,MAAZ,GAAqBuJ,WAArB,GAAoCzF,EAAE,GAAG,CAACA,EAAD,CAAH,GAAU,EAA5D;;CAEA,WAAK,IAAI/D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsK,GAAG,CAACrK,MAAxB,EAAgCD,CAAC,EAAjC,EACA;CACC,YAAMwI,GAAG,GAAG,KAAK5E,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyC6B,GAAG,CAACtK,CAAD,CAA5C,CAAZ;;CACA,YAAIwI,GAAG,IAAIA,GAAG,CAAC7J,IAAf,EACA;CACC,cAAM6O,OAAO,GAAGhF,GAAG,CAAC7J,IAAJ,CAAS8O,sBAAT,CAAgCjH,SAAhC,CAAhB;;CACA,cAAIgH,OAAO,IAAIA,OAAO,CAACvN,MAAvB,EACA;CACC,mBAAO,IAAP;CACA;CACD;CACD;;CACD,aAAO,KAAP;CACA;CA1vBF;CAAA;CAAA,0CA4vBuBuG,SA5vBvB,EA4vBkC8D,GA5vBlC,EA4vBuCoD,UA5vBvC,EA6vBC;CACC,UAAIC,MAAM,GAAG,EAAb;;CACA,UAAI,SAASrD,GAAb,EACA;CACCqD,QAAAA,MAAM,GAAG,KAAK/J,eAAL,GAAuB0E,OAAvB,GAAiCsF,YAAjC,GAAgDxE,GAAhD,CACR,UAASyE,OAAT,EAAkB;CACjB,iBAAOA,OAAO,CAACpI,KAAR,EAAP;CACA,SAHO,CAAT;CAKA,OAPD,MAQK,IAAIqI,KAAK,CAACC,OAAN,CAAczD,GAAd,CAAJ,EACL;CACCqD,QAAAA,MAAM,GAAGrD,GAAT;CACA,OAHI,MAKL;CACC,YAAMd,WAAW,GAAG,KAAK5F,eAAL,GAAuB0E,OAAvB,GAAiCmB,cAAjC,EAApB;CACAkE,QAAAA,MAAM,GAAGnE,WAAW,CAACvJ,MAAZ,GAAqBuJ,WAArB,GAAoCc,GAAG,GAAG,CAACA,GAAD,CAAH,GAAW,EAA3D;CACA;;CACD,UAAMqB,SAAS,GAAG,EAAlB;;CACA,WAAK,IAAI3L,CAAC,GAAG2N,MAAM,CAAC1N,MAAP,GAAgB,CAA7B,EAAgCD,CAAC,IAAI,CAArC,EAAwCA,CAAC,EAAzC,EACA;CACC,YAAMwI,GAAG,GAAG,KAAK5E,eAAL,GAAuB0E,OAAvB,GAAiCG,OAAjC,CAAyCkF,MAAM,CAAC3N,CAAD,CAA/C,CAAZ;;CACA,YAAIwI,GAAG,IAAIA,GAAG,CAAC7J,IAAf,EACA;CACC,cAAM6O,OAAO,GAAGhF,GAAG,CAAC7J,IAAJ,CAAS8O,sBAAT,CAAgCjH,SAAhC,CAAhB;;CACA,cAAI,CAACkH,UAAD,IAAgBF,OAAO,IAAIA,OAAO,CAACvN,MAAvC,EACA;CACC0L,YAAAA,SAAS,CAAC7D,IAAV,CAAe6F,MAAM,CAAC3N,CAAD,CAArB;CACA,WAHD,MAIK,IAAI0N,UAAU,IAAI,EAAEF,OAAO,IAAIA,OAAO,CAACvN,MAArB,CAAlB,EACL;CACC0L,YAAAA,SAAS,CAAC7D,IAAV,CAAe6F,MAAM,CAAC3N,CAAD,CAArB;CACA;CACD;CACD;;CACD,aAAO2L,SAAP;CACA;CAlyBF;CAAA;CAAA,2BAoyBQqB,IApyBR,EAoyBcgB,KApyBd,EAqyBC;CACCC,MAAAA,GAAG,CAACnM,EAAJ,CAAOyK,EAAP,CAAU2B,YAAV,CAAuBC,MAAvB,CAA8BlF,MAA9B,CAAqC;CACpCmF,QAAAA,aAAa,EAAEJ,KAAK,GAAG,CAAR,GAAYA,KAAZ,GAAoB,IADC;CAEpCK,QAAAA,OAAO,EAAErB,IAAI,GAAGA,IAAH,GAAU5F,aAAG,CAACC,UAAJ,CAAe,kCAAf;CAFa,OAArC;CAIA;CA1yBF;CAAA;CAAA,8BA4yBWuE,UA5yBX,EA4yBuBlJ,OA5yBvB,EA4yBgC4L,eA5yBhC,EA6yBC;CACC5L,MAAAA,OAAO,GAAGA,OAAO,GAAGA,OAAH,GAAa,EAA9B;CAEA,UAAI8G,WAAW,GAAG,EAAlB;;CAEA,UAAI9G,OAAO,CAAC4H,GAAZ,EACA;CACCd,QAAAA,WAAW,GAAG9G,OAAO,CAAC4H,GAAtB;CACA;;CACD,UAAI,CAACd,WAAW,CAACvJ,MAAb,IAAuB,CAACuJ,WAAW,CAAC+E,OAAxC,EACA;CACC;CACA;;CACD,UAAI,CAAC7L,OAAO,CAACyH,QAAb,EACA;CACC,aAAKvG,eAAL,GAAuB4K,SAAvB;CACA;;CACD,UAAMlO,IAAI,GAAG;CAAEgK,QAAAA,GAAG,EAAEd;CAAP,OAAb;;CACA,UAAI9G,OAAO,CAACwH,MAAZ,EACA;CACC,YAAMuE,WAAW,GAAGC,MAAM,CAACC,IAAP,CAAYD,MAAM,CAAChM,OAAO,CAACwH,MAAT,CAAlB,CAApB;;CACA,aAAK,IAAI0E,SAAS,GAAG,CAAhB,EAAmBC,GAAG,GAAGJ,WAAW,CAACxO,MAA1C,EAAkD2O,SAAS,GAAGC,GAA9D,EAAmED,SAAS,EAA5E,EACA;CACC,cAAME,OAAO,GAAGL,WAAW,CAACG,SAAD,CAA3B;CACA,cAAMG,IAAI,GAAGL,MAAM,CAACM,wBAAP,CAAgCtM,OAAO,CAACwH,MAAxC,EAAgD4E,OAAhD,CAAb;;CACA,cAAIC,IAAI,KAAK7P,SAAT,IAAsB6P,IAAI,CAACE,UAA/B,EACA;CACC3O,YAAAA,IAAI,CAACwO,OAAD,CAAJ,GAAgBpM,OAAO,CAACwH,MAAR,CAAe4E,OAAf,CAAhB;CACA;CACD;CACD;;CAEDhN,MAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,oBAA3B,EAAiD4J,UAAjD,EAA6D;CAC5D3J,QAAAA,IAAI,EAAE,MADsD;CAE5D3B,QAAAA,IAAI,EAAEA,IAFsD;CAG5DyI,QAAAA,cAAc,EAAErG,OAAO,CAACqG;CAHoC,OAA7D,EAIG7G,IAJH,CAKC,YAAW;CACV,YAAIQ,OAAO,CAACyJ,SAAR,KAAsB,KAA1B,EACA;CACC;CACA;;CACD,YAAIzJ,OAAO,CAACyJ,SAAR,IAAqB,OAAQzJ,OAAO,CAACyJ,SAAhB,KAA+B,UAAxD,EACA;CACCzJ,UAAAA,OAAO,CAACyJ,SAAR,CAAkBzI,IAAlB,CAAuB,IAAvB,EAA6B8F,WAA7B,EAA0C9G,OAAO,CAACwJ,aAAlD;CACA;CACA;;CACD,YAAGoC,eAAe,KAAKpP,SAAvB,EACA;CACC,eAAK+J,MAAL;CACA,SAHD,MAKA;CACCqF,UAAAA,eAAe;CACf;CACD,OAlBD,CAkBE5K,IAlBF,CAkBO,IAlBP,CALD,EAwBC,UAASvB,QAAT,EAAmB;CAClBO,QAAAA,OAAO,CAACwM,OAAR,IAAmB,OAAQxM,OAAO,CAACwM,OAAhB,KAA6B,UAAhD,GACCxM,OAAO,CAACwM,OAAR,GAAkBxL,IAAlB,CAAuB,IAAvB,EAA6BvB,QAA7B,CADD,GAEC,KAAKgN,cAAL,CAAoBhN,QAApB,CAFD;CAGA,OAJD,CAIEuB,IAJF,CAIO,IAJP,CAxBD;CA8BA;CA32BF;CAAA;CAAA,mCA62BgBvB,QA72BhB,EA82BC;CACC,UAAIO,OAAO,GAAG,EAAd;CACA,WAAK0M,gBAAL,CAAsBjN,QAAQ,CAACgH,MAA/B;CACAzG,MAAAA,OAAO,CAAC2M,YAAR,GAAuBlN,QAAQ,CAACgH,MAAT,CAAgB,CAAhB,EAAmBE,OAA1C;CACA;CAl3BF;CAAA;CAAA,qCAo3BkBF,MAp3BlB,EAq3BC;CACC,WAAK,IAAInJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmJ,MAAM,CAAClJ,MAA3B,EAAmCD,CAAC,EAApC,EACA;CACC,YAAImJ,MAAM,CAACnJ,CAAD,CAAN,CAAUiI,IAAV,KAAmB,KAAK/E,yBAA5B,EACA;CACC,eAAKF,SAAL,GAAiB,KAAjB;CACA;;CACD,YAAImG,MAAM,CAACnJ,CAAD,CAAN,CAAUiI,IAAV,KAAmB,KAAK9E,4BAA5B,EACA;CACC,eAAKJ,WAAL,GAAmB,KAAnB;CACA;CACD;CACD;CAj4BF;CAAA;CAAA,qCAo4BC;CACC,UAAMuM,GAAG,GAAGxN,EAAE,CAACyN,IAAH,CAAQC,aAAR,CAAsB,mBAAtB,EAA2C;CACtDlO,QAAAA,SAAS,EAAE,KAAKA;CADsC,OAA3C,CAAZ;CAGAQ,MAAAA,EAAE,CAAC4H,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B0F,GAA3B,EAAgC;CAC/BzF,QAAAA,KAAK,EAAE,GADwB;CAE/B4F,QAAAA,SAAS,EAAE,KAFoB;CAG/BC,QAAAA,kBAAkB,EAAE;CAHW,OAAhC;CAKA,WAAK1M,SAAL,GAAiB,IAAjB;CACA,WAAKD,WAAL,GAAmB,IAAnB;CACA;CA/4BF;CAAA;CAAA,iDAk5BC;CAl5BD;CAAA;CAAA,2CAs5BC;CACC,WAAKM,oBAAL,CAA0BsM,oBAA1B;CACA;CAx5BF;CAAA;CAAA,uCA25BC;CACC,aAAO,KAAKtM,oBAAL,CAA0BsB,gBAA1B,EAAP;CACA;CA75BF;CAAA;CAAA,sCAg6BC;CACC,aAAO7C,EAAE,CAACgF,IAAH,CAAQ8I,WAAR,CAAoBnH,OAApB,CAA4B,KAAK3F,MAAjC,EAAyC+M,QAAhD;CACA;CAl6BF;CAAA;CAAA,oCAo6BiBC,IAp6BjB,EAq6BC;CACC,aAAOhO,EAAE,CAACyN,IAAH,CAAQQ,YAAR,CAAqBjC,KAAK,CAACkC,SAAN,CAAgBC,MAAhB,CAAuB7D,KAAvB,CAC3B,EAD2B,EAE3B0D,IAAI,CAAC1G,GAAL,CACC,UAASZ,GAAT,EAAc;CACb,YAAI,CAACA,GAAD,IAAQ,CAACA,GAAG,CAAC7J,IAAjB,EACA;CACC,iBAAO,IAAP;CACA;;CAED,eAAOmP,KAAK,CAACkC,SAAN,CAAgB5G,GAAhB,CAAoB8G,IAApB,CACN1H,GAAG,CAAC7J,IAAJ,CAASwH,gBAAT,CAA0B,iCAA1B,CADM,EAEN,UAASxH,IAAT,EAAe;CACd,iBAAOA,IAAI,CAACsG,OAAL,CAAakL,IAApB;CACA,SAJK,CAAP;CAMA,OAbF,CAF2B,CAArB,CAAP;CAkBA;CAx7BF;CAAA;CAAA,6BA07BUC,GA17BV,EA27BC;CACC,UAAI,CAACA,GAAL,EACA;CACC;CACA;;CAED,aAAO,KAAKvM,KAAL,CAAWuM,GAAX,IAAkB,KAAKvM,KAAL,CAAWuM,GAAX,CAAlB,GAAoC,IAA3C;CACA;CAl8BF;CAAA;CAAA,6BAo8BUA,GAp8BV,EAo8BeC,KAp8Bf,EAq8BC;CACC,aAAO,KAAKxM,KAAL,CAAWuM,GAAX,IAAkBC,KAAzB;CACA;CAv8BF;CAAA;CAAA,yCAy8BsBjQ,KAz8BtB,EA08BC;CACCA,MAAAA,KAAK,CAACkQ,eAAN;CACAlQ,MAAAA,KAAK,CAACmQ,cAAN;CAEA,UAAM5J,IAAI,GAAGvG,KAAK,CAAC4K,aAAN,CAAoB/F,OAApB,CAA4B0B,IAAzC;;CAEA,UAAI,CAACA,IAAL,EACA;CACC;CACA;;CAED,WAAK6J,gBAAL,GAAwB1O,EAAE,CAACgF,IAAH,CAAQ2J,WAAR,CAAoBC,MAApB,CAA2B;CAClD3M,QAAAA,EAAE,EAAE,6CAD8C;CAElD4M,QAAAA,QAAQ,EAAE,IAFwC;CAGlDC,QAAAA,UAAU,EAAE,IAHsC;CAIlD9K,QAAAA,KAAK,EAAEsF,IAAI,CAACC,KAAL,CAAW1E,IAAX,CAJ2C;CAKlDkK,QAAAA,MAAM,EAAE,IAL0C;CAMlDC,QAAAA,SAAS,EAAE,GANuC;CAOlDC,QAAAA,QAAQ,EAAE,GAPwC;CAQlDC,QAAAA,KAAK,EAAE;CACNC,UAAAA,QAAQ,EAAE,KADJ;CAENC,UAAAA,MAAM,EAAE;CAFF,SAR2C;CAYlDC,QAAAA,MAAM,EAAE;CACPC,UAAAA,YAAY,EAAE,YAAW;CACxB,iBAAKC,sBAAL;CACA,WAFa,CAEZ3N,IAFY,CAEP,IAFO;CADP;CAZ0C,OAA3B,CAAxB;CAkBA,WAAK8M,gBAAL,CAAsBc,WAAtB,CAAkCC,cAAlC,CAAiDnR,KAAK,CAAC4K,aAAvD;CACA,WAAKwF,gBAAL,CAAsBpI,IAAtB;CACA;CAz+BF;CAAA;CAAA,6CA4+BC;CACC,UAAI,KAAKoI,gBAAT,EACA;CACC1O,QAAAA,EAAE,CAACgF,IAAH,CAAQ2J,WAAR,CAAoBxJ,OAApB,CAA4B,KAAKuJ,gBAAL,CAAsBzM,EAAlD;CACA;CACD;CAj/BF;CAAA;CAAA,sCAm/BmB3D,KAn/BnB,EAo/BC;CACCA,MAAAA,KAAK,CAACkQ,eAAN;CACAlQ,MAAAA,KAAK,CAACmQ,cAAN;CAEA,UAAM1H,SAAS,GAAGzI,KAAK,CAAC8D,MAAN,CAAae,OAAb,CAAqBuM,SAArB,IAAkCpR,KAAK,CAAC8D,MAAN,CAAauN,UAAb,CAAwBxM,OAAxB,CAAgCuM,SAApF;CACA,UAAMzF,MAAM,GAAG3L,KAAK,CAAC8D,MAAN,CAAae,OAAb,CAAqB8G,MAArB,IAA+B3L,KAAK,CAAC8D,MAAN,CAAauN,UAAb,CAAwBxM,OAAxB,CAAgC8G,MAA9E;CACA,UAAMnN,MAAM,GAAGwB,KAAK,CAAC8D,MAArB;CAEAtF,MAAAA,MAAM,CAACQ,SAAP,CAAiBC,GAAjB,CAAqB,aAArB;CACA,WAAKgS,sBAAL;CAEA,WAAKK,QAAL,CAAc7I,SAAd,EAAyBkD,MAAzB,EACE7J,IADF,CACO,YAAW;CAChBtD,QAAAA,MAAM,CAACQ,SAAP,CAAiBE,MAAjB,CAAwB,aAAxB;CACA,aAAK2J,MAAL,CAAY7B,aAAG,CAACC,UAAJ,CAAe0E,MAAM,KAAK,WAAX,GAAyB,iCAAzB,GAA6D,iCAA5E,CAAZ;CACA,OAHK,CAGJrI,IAHI,CAGC,IAHD,CADP,EAKEiO,KALF,CAKQ,YAAW;CACjB/S,QAAAA,MAAM,CAACQ,SAAP,CAAiBE,MAAjB,CAAwB,aAAxB;CACA,aAAK2J,MAAL,CAAY7B,aAAG,CAACC,UAAJ,CAAe,gCAAf,CAAZ;CACA,OAHM,CAGL3D,IAHK,CAGA,IAHA,CALR;CASA;CAxgCF;CAAA;CAAA,6BA0gCUmF,SA1gCV,EA0gCqBkD,MA1gCrB,EA2gCC;CACC,aAAO,IAAI6F,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;CAC5ChQ,QAAAA,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,oBAA3B,EAAiD,MAAjD,EAAyD;CACxDC,UAAAA,IAAI,EAAE,MADkD;CAExD3B,UAAAA,IAAI,EAAE;CAAEuI,YAAAA,SAAS,EAATA,SAAF;CAAakD,YAAAA,MAAM,EAANA;CAAb;CAFkD,SAAzD,EAGG7J,IAHH,CAIC,YAAW;CACV2P,UAAAA,OAAO;CACP,SAFD,CAEEnO,IAFF,CAEO,IAFP,CAJD,EAOC,YAAW;CACVoO,UAAAA,MAAM;CACN,SAFD,CAEEpO,IAFF,CAEO,IAFP,CAPD;CAWA,OAZM,CAAP;CAaA;CAzhCF;CAAA;CAAA;;CCOA,IAAMqO,iBAAiB,GAAGC,oBAAU,CAACC,SAAX,CAAqB,cAArB,CAA1B;AAEAzR,8BAAY,CAACqB,SAAb,CAAuB,4BAAvB,EAAqD,UAACzB,KAAD,EAAW;CAAA,6BACxCA,KAAK,CAAC8R,aAAN,EADwC;CAAA;CAAA,MACxDC,YADwD;;CAE/D,MAAGA,YAAY,CAACC,UAAb,OAA8B,6BAAjC,EACA;CACCC,IAAAA,aAAa,CAACC,IAAd,CAAmBP,iBAAiB,CAACrT,WAArC,EAAkDqT,iBAAiB,CAAC3H,IAAlB,CAAuB3E,KAAvB,EAAlD,EAAkF,KAAlF,EAAwF,IAAxF;CACA;CACD,CAND;CAQA,IAAI8M,UAAJ;CACA,IAAIC,WAAJ;CACA,IAAIC,QAAJ;CACA,IAAIC,iBAAJ;CAEA,IAAIC,sBAAsB,GAAG,EAA7B;AAEAC,gBAAK,CAACC,KAAN,CAAY,YAAM;CAEjBH,EAAAA,iBAAiB,GAAGjR,QAAQ,CAACC,aAAT,CAAuB,4CAAvB,CAApB;CAEA,MAAMoR,UAAU,GAAG,IAAIlG,iBAAJ,CAAW;CAC7BpG,IAAAA,SAAS,EAAC,+DADmB;CAE7BuM,IAAAA,IAAI,EAAEnG,iBAAM,CAACoG,IAAP,CAAYC,QAFW;CAG7BC,IAAAA,KAAK,EAAE;CACNxG,MAAAA,KAAK,EAAEtF,aAAG,CAACC,UAAJ,CAAe,4BAAf;CADD,KAHsB;CAM7B4F,IAAAA,OAAO,EAAE,mBAAW;CACnBoF,MAAAA,aAAa,CAACC,IAAd,CAAmBP,iBAAiB,CAACrT,WAArC,EAAkD0I,aAAG,CAACC,UAAJ,CAAe,sBAAf,CAAlD,EAAyF,KAAzF,EAA+F,IAA/F;CACA;CAR4B,GAAX,CAAnB;CAWAqL,EAAAA,iBAAiB,CAACnQ,MAAlB,CACCuQ,UAAU,CAACK,YAAX,EADD;CAIA3S,EAAAA,6BAAY,CAACqB,SAAb,CAAuB,6BAAvB,EAAsD,UAACzB,KAAD,EAAW;CAAA,gCACjDA,KAAK,CAAC8R,aAAN,EADiD;CAAA;CAAA,QACzDkB,IADyD;;CAEhE,QAAGA,IAAI,KAAK,EAAT,IAAeA,IAAI,KAAKlU,SAAxB,IAAqCkI,aAAG,CAACC,UAAJ,CAAe,sBAAf,MAA2C+L,IAAI,CAAC3N,KAAL,EAAnF,EACA;CACCkN,MAAAA,sBAAsB,GAAGS,IAAI,CAAC9K,OAAL,GAAemB,cAAf,EAAzB;CACA;CACD,GAND;CAQAjJ,EAAAA,6BAAY,CAACqB,SAAb,CAAuB,eAAvB,EAAwC,UAACzB,KAAD,EAAW;CAAA,gCACnCA,KAAK,CAAC8R,aAAN,EADmC;CAAA;CAAA,QAC3CkB,IAD2C;;CAGlD,QAAGA,IAAI,KAAK,EAAT,IAAeA,IAAI,KAAKlU,SAAxB,IAAqCkI,aAAG,CAACC,UAAJ,CAAe,sBAAf,MAA2C+L,IAAI,CAAC3N,KAAL,EAAnF,EACA;CACC,UAAI4N,gBAAgB,GAAG,KAAvB;CACAtB,MAAAA,iBAAiB,CAAC3H,IAAlB,CAAuB9B,OAAvB,GAAiCc,GAAjC,CAAqC,UAAUZ,GAAV,EACrC;CACC,YAAG8K,cAAI,CAACC,UAAL,CAAgBZ,sBAAsB,CAACa,OAAvC,KAAmDb,sBAAsB,CAACa,OAAvB,CAA+BhL,GAAG,CAAC/C,KAAJ,EAA/B,MAAgD,CAAC,CAAvG,EACA;CACC,cAAG+C,GAAG,CAACR,OAAJ,EAAH,EACA;CACCQ,YAAAA,GAAG,CAACiL,MAAJ;CACAJ,YAAAA,gBAAgB,GAAG,IAAnB;CACA;CACD;CACD,OAVD;CAWAV,MAAAA,sBAAsB,GAAG,EAAzB;;CAEA,UAAGU,gBAAH,EACA;CACCK,QAAAA,UAAU,CACT,YACA;CACClT,UAAAA,6BAAY,CAACC,IAAb,CAAkBkT,MAAlB,EAAyB,yBAAzB;CACA,SAJQ,EAKT,CALS,CAAV;CAOA;CACD;CACD,GA9BD;CAgCAC,EAAAA,kBAAM,CAACC,sBAAP,CAA8B;CAC7BrN,IAAAA,SAAS,EAAE;CADkB,GAA9B;CAIA+L,EAAAA,UAAU,GAAG9Q,QAAQ,CAACgM,sBAAT,CAAgC,gBAAhC,EAAkD,CAAlD,CAAb;CACA+E,EAAAA,WAAW,GAAG/Q,QAAQ,CAACC,aAAT,CAAuB,iCAAvB,CAAd;CACA6Q,EAAAA,UAAU,CAACuB,YAAX,CAAwBtB,WAAxB,EAAoCD,UAAU,CAACwB,UAA/C;CACAtB,EAAAA,QAAQ,GAAGhR,QAAQ,CAACC,aAAT,CAAuB,yBAAvB,CAAX;CAEAqQ,EAAAA,iBAAiB,CAACrT,WAAlB,GAAgC,IAAIA,WAAJ,CAAgB8T,WAAhB,CAAhC;CACAT,EAAAA,iBAAiB,CAACiC,4BAAlB,GAAiDvS,QAAQ,CAACC,aAAT,CAAuB,4CAAvB,CAAjD;AAAsH,CAEtHqQ,EAAAA,iBAAiB,CAACrT,WAAlB,CAA8BuV,aAA9B,CAA4CnB,UAA5C;CACAf,EAAAA,iBAAiB,CAACrT,WAAlB,CAA8BwV,eAA9B,CAA8CzS,QAAQ,CAACC,aAAT,CAAuB,yBAAvB,CAA9C;CACAqQ,EAAAA,iBAAiB,CAACrT,WAAlB,CAA8ByV,gBAA9B,CAA+C1S,QAAQ,CAACC,aAAT,CAAuB,8BAAvB,CAA/C;CACAqQ,EAAAA,iBAAiB,CAACrT,WAAlB,CAA8B0V,gBAA9B,CAA+C3S,QAAQ,CAACC,aAAT,CAAuB,8BAAvB,CAA/C;CACAqQ,EAAAA,iBAAiB,CAACrT,WAAlB,CAA8B2V,iBAA9B,CAAgD5S,QAAQ,CAACC,aAAT,CAAuB,+BAAvB,CAAhD;CACA,CA5ED;CA8EAqQ,iBAAiB,CAACxS,QAAlB,GAA6B,IAAIA,QAAJ,EAA7B;CACAwS,iBAAiB,CAACjN,eAAlB,GAAoC,IAAIvF,QAAJ,CAAa,iBAAb,CAApC;CACAwS,iBAAiB,CAAC3H,IAAlB,GAAyB,IAAIkK,4BAAJ,EAAzB;CAEAvC,iBAAiB,CAAC5Q,QAAlB,GAA6BA,QAA7B;CAEA,IAAMoT,sBAAsB,GAAGvC,oBAAU,CAACC,SAAX,CAAqB,wBAArB,CAA/B;CACAsC,sBAAsB,CAAC9R,IAAvB,GAA8BA,IAA9B;;;;"}