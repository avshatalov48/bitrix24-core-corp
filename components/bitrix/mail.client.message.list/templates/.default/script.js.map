{"version":3,"file":"script.js","sources":["src/js/progressbar.es6.js","src/js/counters.es6.js","src/js/leftmenu.es6.js","src/js/list.es6.js","script.es6.js"],"sourcesContent":["export class ProgressBar\n{\n\t#node;\n\t#errorTitleNode;\n\t#errorTextNode;\n\t#errorBoxNode;\n\t#syncButton;\n\t#errorHintNode;\n\n\tconstructor(node)\n\t{\n\t\tthis.#node = node;\n\t}\n\n\tsetSyncButton(button)\n\t{\n\t\tthis.#syncButton = button;\n\t}\n\n\tgetSyncButton()\n\t{\n\t\treturn this.#syncButton;\n\t}\n\n\tgetErrorBoxNode()\n\t{\n\t\treturn this.#errorBoxNode;\n\t}\n\n\tsetErrorBoxNode(errorBoxNode)\n\t{\n\t\tthis.#errorBoxNode = errorBoxNode;\n\t}\n\n\tsetErrorTitleNode(errorTitleNode)\n\t{\n\t\tthis.#errorTitleNode = errorTitleNode;\n\t}\n\n\tsetErrorTextNode(errorTextNode)\n\t{\n\t\tthis.#errorTextNode = errorTextNode;\n\t}\n\n\tsetErrorHintNode(errorHintNode)\n\t{\n\t\tthis.#errorHintNode = errorHintNode;\n\t}\n\n\tgetErrorTextNode()\n\t{\n\t\treturn this.#errorTextNode;\n\t}\n\n\tgetErrorHintNode()\n\t{\n\t\treturn this.#errorHintNode;\n\t}\n\n\tgetErrorTitleNode()\n\t{\n\t\treturn this.#errorTitleNode;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.getSyncButton() !== undefined) this.getSyncButton().setWaiting(true);\n\t\tthis.#node.classList.add(\"mail-progress-show\");\n\t\tthis.#node.classList.remove(\"mail-progress-hide\");\n\t}\n\n\thide()\n\t{\n\t\tif(this.getSyncButton() !== undefined) this.getSyncButton().setWaiting(false);\n\t\tthis.#node.classList.add(\"mail-progress-hide\");\n\t\tthis.#node.classList.remove(\"mail-progress-show\");\n\t}\n\n\thideErrorBox()\n\t{\n\t\tthis.#errorBoxNode.classList.add(\"mail-hidden-element\");\n\t\tthis.#errorBoxNode.classList.remove(\"mail-visible-element\");\n\t}\n\n\tshowErrorBox()\n\t{\n\t\tthis.#errorBoxNode.classList.add(\"mail-visible-element\");\n\t\tthis.#errorBoxNode.classList.remove(\"mail-hidden-element\");\n\t}\n}","import { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Counters\n{\n\tcachedCounters = [];\n\tcounters = [];\n\thiddenCountersForTotalCounter = [];\n\tshortcuts = [];\n\t#name;\n\tselectedDirectory;\n\n\tconstructor(name,selectedDirectory)\n\t{\n\t\tthis.#name = name;\n\t\tthis.setDirectory(selectedDirectory);\n\t}\n\n\tgetCounters()\n\t{\n\t\treturn this.counters;\n\t}\n\n\tgetDirPath(shortcut)\n\t{\n\t\tif(shortcut === undefined)\n\t\t{\n\t\t\tshortcut = '';\n\t\t}\n\n\t\tif(this.shortcuts[shortcut] !== undefined)\n\t\t{\n\t\t\treturn this.shortcuts[shortcut];\n\t\t}\n\n\t\treturn shortcut;\n\t}\n\n\tgetShortcut(path)\n\t{\n\t\t//because they have a closure\n\t\treturn this.getDirPath(path);\n\t}\n\n\tsetDirectory(name)\n\t{\n\t\tif(name === undefined)\n\t\t{\n\t\t\tname = '';\n\t\t}\n\n\t\tif(this.shortcuts[name])\n\t\t{\n\t\t\tthis.selectedDirectory = this.shortcuts[name];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectedDirectory = name;\n\t\t}\n\n\t\tlet resultCounters = {};\n\t\tresultCounters[this.selectedDirectory] = this.getCounter(this.selectedDirectory);\n\t\tthis.sendCounterUpdateEvent(resultCounters);\n\t}\n\n\tsetShortcut(shortcutName,name)\n\t{\n\t\t//backlink\n\t\tthis.shortcuts[shortcutName] = name;\n\t\tthis.shortcuts[name] = shortcutName;\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.#name;\n\t}\n\n\tsetHiddenCountersForTotalCounter(counterNames)\n\t{\n\t\tfor (let counter of counterNames)\n\t\t{\n\t\t\tthis.hiddenCountersForTotalCounter[counter] = 'disabled';\n\t\t}\n\t}\n\n\tisHidden(name):boolean\n\t{\n\t\tif(this.hiddenCountersForTotalCounter[name] === 'disabled')\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetTotalCounter()\n\t{\n\t\tlet counters = 0;\n\t\tfor (let name in this.counters)\n\t\t{\n\t\t\tif(name in this.hiddenCountersForTotalCounter)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tcounters += this.counters[name];\n\t\t}\n\n\t\treturn counters;\n\t}\n\n\tgetCounterObjects()\n\t{\n\t\treturn this.counters;\n\t}\n\n\tgetCounter(name)\n\t{\n\t\treturn this.counters[name];\n\t}\n\n\taddCounter(name,count)\n\t{\n\t\tthis.counters[name] = Number(count);\n\t\treturn this.counters[name];\n\t}\n\n\taddCounters(counters)\n\t{\n\t\tthis.cacheCounters();\n\n\t\tlet resultCounters = {};\n\n\t\tfor (let i = 0; i < counters.length; i++)\n\t\t{\n\t\t\tconst counter = counters[i]\n\n\t\t\tcounter['count'] = Number(counter['count']);\n\n\t\t\tconst path = counter['path'];\n\t\t\tthis.addCounter(path,counter['count']);\n\n\t\t\tif(this.shortcuts[path])\n\t\t\t{\n\t\t\t\tresultCounters[this.shortcuts[path]] = counter['count'];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresultCounters[path] = counter['count'];\n\t\t\t}\n\n\t\t}\n\n\t\tthis.sendCounterUpdateEvent(resultCounters);\n\t}\n\n\t/*Set counters as when adding. Old counters with different names are retained*/\n\tsetCounters(counters)\n\t{\n\t\tthis.addCounters(counters);\n\t}\n\n\tisExists(name)\n\t{\n\t\treturn this.counters[name] !== undefined;\n\t}\n\n\tincreaseCounter(name,count = 1 )\n\t{\n\t\tthis.cacheCounters();\n\n\t\tif(name in this.hiddenCountersForTotalCounter)\n\t\t{\n\t\t\treturn \"hidden counters for total counter\";\n\t\t}\n\n\t\tif(!this.isExists(name))\n\t\t{\n\t\t\treturn \"no counter\";\n\t\t}\n\t\tthis.counters[name] += Number(count);\n\t}\n\n\tlowerCounter(name,count = 1 )\n\t{\n\t\tthis.cacheCounters();\n\n\t\tif(name in this.hiddenCountersForTotalCounter)\n\t\t{\n\t\t\treturn \"hidden counters for total counter\";\n\t\t}\n\n\t\tif(!this.isExists(name))\n\t\t{\n\t\t\treturn \"no counter\";\n\t\t}\n\n\t\tconst newValue = this.counters[name] - Number(count);\n\t\tif(newValue < 0)\n\t\t{\n\t\t\treturn \"negative value\";\n\t\t}\n\n\t\tthis.counters[name] = newValue;\n\t}\n\n\tcacheCounters()\n\t{\n\t\tthis.cachedCounters = [];\n\t\tObject.assign(this.cachedCounters, this.counters);\n\t}\n\n\trestoreFromCache()\n\t{\n\t\tthis.counters = [];\n\t\tObject.assign(this.counters, this.cachedCounters);\n\t\tthis.sendCounterUpdateEvent(this.counters);\n\t}\n\n\t/*Change counters by rule*/\n\tupdateCounters(counters = [\n\t\t{\n\t\t\tname: 'counter1',\n\t\t\tcount: 2,\n\t\t\tincrease: false,\n\t\t\tlower: true,\n\t\t},\n\t\t{\n\t\t\tname: 'counter2',\n\t\t\tcount: 2,\n\t\t\tincrease: true,\n\t\t\tlower: false,\n\t\t},\n\t])\n\t{\n\t\tthis.cacheCounters();\n\t\tlet resultCounters = {};\n\t\tlet countersAreNotLoadedFromTheServer = false;\n\n\t\tfor (let i = 0; i < counters.length; i++)\n\t\t{\n\t\t\tconst counter = counters[i];\n\t\t\tconst name = counter['name'];\n\n\t\t\tif(counter['lower'])\n\t\t\t{\n\t\t\t\tif(this.lowerCounter(name,counter['count']) === \"negative value\")\n\t\t\t\t{\n\t\t\t\t\tcountersAreNotLoadedFromTheServer = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(counter['increase'] && countersAreNotLoadedFromTheServer === false)\n\t\t\t{\n\t\t\t\tthis.increaseCounter(name,counter['count'])\n\t\t\t}\n\n\t\t\tif(this.shortcuts[name])\n\t\t\t{\n\t\t\t\tresultCounters[this.shortcuts[name]] = this.getCounter(name);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresultCounters[name] = this.getCounter(name);\n\t\t\t}\n\t\t}\n\n\t\tthis.sendCounterUpdateEvent(resultCounters);\n\t}\n\n\tsendCounterUpdateEvent(counters)\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcounters: counters,\n\t\t\t\thidden: this.hiddenCountersForTotalCounter,\n\t\t\t\tselectedDirectory: this.selectedDirectory,\n\t\t\t\tname: this.getName(),\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.emit('BX.Mail.Home:updatingCounters', event);\n\t}\n\n}","import { EventEmitter } from \"main.core.events\";\nimport { DirectoryMenu } from 'mail.directorymenu';\n\nexport class LeftMenu\n{\n\tconstructor(config={\n\t\tdirsWithUnseenMailCounters: {},\n\t\tmailboxId:'',\n\t\tfilterId: '',\n\t\tsystemDirs :\n\t\t{\n\t\t\tspam: 'Spam',\n\t\t\ttrash: 'Trash',\n\t\t\toutcome: 'Outcome',\n\t\t\tdrafts: 'Drafts',\n\t\t\tinbox: 'Inbox',\n\t\t}\n\t})\n\t{\n\t\tconst leftDirectoryMenuWrapper = document.querySelector('.mail-left-menu-wrapper');\n\n\t\tthis.directoryMenu = new DirectoryMenu({\n\t\t\tdirsWithUnseenMailCounters: config['dirsWithUnseenMailCounters'],\n\t\t\tfilterId: config['filterId'],\n\t\t\tsystemDirs: config['systemDirs'],\n\t\t});\n\n\t\tleftDirectoryMenuWrapper.append(this.directoryMenu.getNode());\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { Loc } from 'main.core';\n\nexport class List\n{\n\tconstructor(options)\n\t{\n\t\tthis.mailReadAllButton = options.mailReadAllButton;\n\t\tthis.gridId = options.gridId;\n\t\tthis.mailboxId = options.mailboxId;\n\t\tthis.canMarkSpam = options.canMarkSpam;\n\t\tthis.canDelete = options.canDelete;\n\t\tthis.ERROR_CODE_CAN_NOT_DELETE = options.ERROR_CODE_CAN_NOT_DELETE;\n\t\tthis.ERROR_CODE_CAN_NOT_MARK_SPAM = options.ERROR_CODE_CAN_NOT_MARK_SPAM;\n\t\tthis.disabledClassName = 'js-disabled';\n\t\tthis.userInterfaceManager = new BX.Mail.Client.Message.List.UserInterfaceManager(options);\n\t\tthis.userInterfaceManager.resetGridSelection = this.resetGridSelection.bind(this);\n\t\tthis.userInterfaceManager.isSelectedRowsHaveClass = this.isSelectedRowsHaveClass.bind(this);\n\t\tthis.userInterfaceManager.getGridInstance = this.getGridInstance.bind(this);\n\t\tthis.cache = {};\n\t\tthis.addEventHandlers();\n\n\t\tBX.Mail.Client.Message.List[options.id] = this;\n\t};\n\n\taddEventHandlers()\n\t{\n\t\t// todo delete this hack\n\t\t// it is here to prevent grid's title changing after filter apply\n\t\tBX.ajax.UpdatePageData = (function() {\n\t\t});\n\n\t\tEventEmitter.subscribe(\n\t\t\t'onSubMenuShow',\n\t\t\tfunction(event){\n\t\t\t\tconst menuItem = event.target;\n\t\t\t\tconst container = menuItem.getMenuWindow().getPopupWindow().getPopupContainer();\n\t\t\t\tlet id = null;\n\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tid = BX.data(container, 'grid-row-id');\n\t\t\t\t}\n\n\t\t\t\tBX.data(\n\t\t\t\t\tmenuItem.getSubMenu().getPopupWindow().getPopupContainer(),\n\t\t\t\t\t'grid-row-id',\n\t\t\t\t\tmenuItem.gridRowId || id,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\n\t\tEventEmitter.subscribe('Mail::directoryChanged', () =>\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t})\n\n\t\tEventEmitter.subscribe('BX.Mail.Home:updatingCounters', (event) => {\n\t\t\tif(event['data']['name'] !== 'mailboxCounters')\n\t\t\t{\n\t\t\t\tconst counters = event['data']['counters'];\n\t\t\t\tBX.Mail.Home.LeftMenuNode.directoryMenu.setCounters(counters);\n\n\t\t\t\tBX.Mail.Home.mailboxCounters.setCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tpath: 'unseenCountInCurrentMailbox',\n\t\t\t\t\t\tcount: BX.Mail.Home.Counters.getTotalCounter(),\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.userInterfaceManager.updateLeftMenuCounter();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Menu.Item:onmouseenter', function(event) {\n\t\t\tconst menuItem = event.target;\n\n\t\t\tif (!menuItem.dataset || !menuItem.getMenuWindow())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst menuWindow = menuItem.getMenuWindow();\n\t\t\tconst subMenuItems = menuWindow.getMenuItems();\n\n\t\t\tconst path = menuItem.dataset.path;\n\t\t\tconst hash = menuItem.dataset.dirMd5;\n\t\t\tconst hasChild = menuItem.dataset.hasChild;\n\n\t\t\tif (!hasChild)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < subMenuItems.length; i++)\n\t\t\t{\n\t\t\t\tconst item = subMenuItems[i];\n\n\t\t\t\tif (item.getId() === path)\n\t\t\t\t{\n\t\t\t\t\tconst hasSubMenu = item.hasSubMenu();\n\n\t\t\t\t\tif (hasSubMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.showSubMenu();\n\t\t\t\t\t\tconst subMenu = item.getSubMenu();\n\n\t\t\t\t\t\tlet hasLoadingItem = false;\n\n\t\t\t\t\t\tif (subMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = subMenu.getMenuItems();\n\n\t\t\t\t\t\t\tfor (let k = 0; k < items.length; k++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst subItem = items[k];\n\n\t\t\t\t\t\t\t\tif (subItem.getId() === 'loading')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thasLoadingItem = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!hasLoadingItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.loadLevelMenu(item, hash);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tconst itemsMenu = document.querySelectorAll('.ical-event-control-menu');\n\n\t\tfor (let i = 0; i < itemsMenu.length; i++)\n\t\t{\n\t\t\titemsMenu[i].addEventListener('click', this.showICalMenuDropdown.bind(this));\n\t\t}\n\n\t\tBX.bindDelegate(document.body, 'click', { className: 'ical-event-control-button' }, this.onClickICalButton.bind(this));\n\t}\n\n\tloadLevelMenu(menuItem, hash)\n\t{\n\t\tconst menu = this.getCache(menuItem.getId());\n\t\tconst popup = BX.Main.PopupManager.getPopupById('menu-popup-popup-submenu-' + menuItem.getId());\n\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.destroy();\n\t\t}\n\n\t\tif (menu)\n\t\t{\n\t\t\tmenuItem.destroySubMenu();\n\t\t\tmenuItem.addSubMenu(menu);\n\t\t\tmenuItem.showSubMenu();\n\t\t\treturn;\n\t\t}\n\n\t\tconst subItem = {\n\t\t\t'id': 'loading',\n\t\t\t'text': Loc.getMessage('MAIL_CLIENT_BUTTON_LOADING'),\n\t\t\t'disabled': true,\n\t\t};\n\n\t\tmenuItem.destroySubMenu();\n\t\tmenuItem.addSubMenu([subItem]);\n\t\tmenuItem.showSubMenu();\n\n\t\tBX.ajax.runComponentAction('bitrix:mail.client.config.dirs', 'level', {\n\t\t\tmode: 'class',\n\t\t\tdata: { mailboxId: this.mailboxId, dir: { path: menuItem.getId(), dirMd5: hash } },\n\t\t}).then(\n\t\t\tfunction(response) {\n\t\t\t\tconst dirs = response.data.dirs;\n\t\t\t\tconst items = [];\n\n\t\t\t\tfor (let i = 0; i < dirs.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst hasChild = /(HasChildren)/i.test(dirs[i].FLAGS);\n\t\t\t\t\tconst item = {\n\t\t\t\t\t\t'id': dirs[i].PATH,\n\t\t\t\t\t\t'text': dirs[i].NAME,\n\t\t\t\t\t\t'dataset': {\n\t\t\t\t\t\t\t'path': dirs[i].PATH,\n\t\t\t\t\t\t\t'dirMd5': dirs[i].DIR_MD5,\n\t\t\t\t\t\t\t'isDisabled': dirs[i].IS_DISABLED,\n\t\t\t\t\t\t\t'hasChild': hasChild,\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: hasChild ? [{\n\t\t\t\t\t\t\tid: 'loading',\n\t\t\t\t\t\t\t'text': Loc.getMessage('MAIL_CLIENT_BUTTON_LOADING'),\n\t\t\t\t\t\t\t'disabled': true,\n\t\t\t\t\t\t}] : [],\n\t\t\t\t\t};\n\n\t\t\t\t\titems.push(item);\n\t\t\t\t}\n\n\t\t\t\tthis.setCache(menuItem.getId(), items);\n\n\t\t\t\tconst popup = BX.Main.PopupManager.getPopupById('menu-popup-popup-submenu-' + menuItem.getId());\n\t\t\t\tconst isShown = menuItem.getMenuWindow().getPopupWindow().isShown();\n\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t}\n\n\t\t\t\tif (isShown)\n\t\t\t\t{\n\t\t\t\t\tmenuItem.destroySubMenu();\n\t\t\t\t\tmenuItem.addSubMenu(items);\n\t\t\t\t\tmenuItem.showSubMenu();\n\t\t\t\t}\n\t\t\t}.bind(this),\n\t\t\tfunction(response) {\n\t\t\t}.bind(this),\n\t\t);\n\t}\n\n\tonCrmClick(id)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tconst row = id ? this.getGridInstance().getRows().getById(id) : selected[0];\n\t\tif (!(row && row.node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst addToCrm = this.userInterfaceManager.isAddToCrmActionAvailable(row.node);\n\t\tconst messageIdNode = row.node.querySelector('[data-message-id]');\n\t\tif (!(messageIdNode.dataset && messageIdNode.dataset.messageId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\n\t\tif (addToCrm)\n\t\t{\n\t\t\tconst crmBtnInRow = row.node.querySelector('.mail-binding-crm.mail-ui-not-active');\n\n\t\t\tif(crmBtnInRow)\n\t\t\t{\n\t\t\t\tcrmBtnInRow.startWait();\n\t\t\t}\n\n\t\t\tif (typeof this.isAddingToCrmInProgress !== \"object\")\n\t\t\t{\n\t\t\t\tthis.isAddingToCrmInProgress = {};\n\t\t\t}\n\t\t\tif (this.isAddingToCrmInProgress[id] === true)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isAddingToCrmInProgress[id] = true;\n\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t'bitrix:mail.client',\n\t\t\t\t'createCrmActivity',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessageId: messageIdNode.dataset.messageId,\n\t\t\t\t\t},\n\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t\t'bindings': this.getRowsBindings([row]),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(\n\t\t\t\tfunction(id) {\n\t\t\t\t\tthis.isAddingToCrmInProgress[id] = false;\n\t\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_ADDED_TO_CRM'));\n\t\t\t\t}.bind(this, id),\n\t\t\t\tfunction(json) {\n\n\t\t\t\t\tif(crmBtnInRow)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmBtnInRow.stopWait();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.isAddingToCrmInProgress[id] = false;\n\t\t\t\t\tif (json.errors && json.errors.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notify(json.errors.map(\n\t\t\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\t\t\treturn item.message;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t).join('<br>'), 5000);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_ADD_TO_CRM_ERROR'));\n\t\t\t\t\t}\n\t\t\t\t}.bind(this),\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.userInterfaceManager.onCrmBindingDeleted(messageIdNode.dataset.messageId);\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t'bitrix:mail.client',\n\t\t\t\t'removeCrmActivity',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessageId: messageIdNode.dataset.messageId,\n\t\t\t\t\t},\n\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t\t'bindings': this.getRowsBindings([row]),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(function(messageIdNode) {\n\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_EXCLUDED_FROM_CRM'));\n\t\t\t}.bind(this, messageIdNode));\n\t\t}\n\n\t\tlet selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\tif(selectedIds.length === 1 && selectedIds[0]===id)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tonViewClick(id)\n\t{\n\t\tif (id === undefined && this.getGridInstance().getRows().getSelectedIds().length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t// @TODO: path\n\t\tBX.SidePanel.Instance.open(\"/mail/message/\" + id, {\n\t\t\twidth: 1080,\n\t\t\tloader: 'view-mail-loader',\n\t\t});\n\t}\n\n\tonDeleteImmediately(id)\n\t{\n\t\tlet additionalOptions =\n\t\t{\n\t\t\t'deleteImmediately' : true,\n\t\t};\n\t\tthis.onDeleteClick(id,additionalOptions);\n\t}\n\n\tonDeleteClick(id,additionalOptions)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.canDelete)\n\t\t{\n\t\t\tthis.showDirsSlider();\n\t\t\treturn;\n\t\t}\n\t\tlet options = {\n\t\t\tparams: (additionalOptions !== undefined) ? additionalOptions : {},\n\t\t\tkeepRows: true,\n\t\t\tanalyticsLabel: {\n\t\t\t\t'groupCount': selected.length,\n\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t},\n\t\t};\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\n\t\tselectedIds = this.filterRowsByClassName(this.disabledClassName, selectedIds, true);\n\t\toptions.ids = selectedIds;\n\n\t\tif (this.userInterfaceManager.isCurrentFolderTrash || (additionalOptions !== undefined && additionalOptions['deleteImmediately']) )\n\t\t{\n\t\t\tconst confirmPopup = this.getConfirmDeletePopup(options);\n\t\t\tconfirmPopup.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tthis.runAction('delete', options,() =>\n\t\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t\t);\n\t\t\tif(id === undefined)\n\t\t\t{\n\t\t\t\tthis.resetGridSelection();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMoveToFolderClick(event)\n\t{\n\t\tconst folderOptions = event.currentTarget.dataset;\n\t\tconst toFolderByPath = folderOptions.path;\n\t\tconst toFolderByName = toFolderByPath;\n\n\t\tif(toFolderByPath === this.getCurrentFolder())\n\t\t{\n\t\t\tthis.notify(Loc.getMessage('MESSAGES_ALREADY_EXIST_IN_FOLDER'));\n\t\t\treturn;\n\t\t}\n\n\t\tlet id = undefined;\n\t\tconst popupSubmenu = BX.findParent(event.currentTarget, { className: 'popup-window' });\n\t\tif (popupSubmenu)\n\t\t{\n\t\t\tid = BX.data(popupSubmenu, 'grid-row-id');\n\t\t}\n\t\tconst isDisabled = JSON.parse(folderOptions.isDisabled);\n\n\t\tif ((id === undefined && this.getGridInstance().getRows().getSelectedIds().length === 0) || isDisabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selected = this.getGridInstance().getRows().getSelected();\n\t\tlet idsForMoving = (id ? [id] : this.getGridInstance().getRows().getSelectedIds());\n\t\tidsForMoving = this.filterRowsByClassName(this.disabledClassName, idsForMoving, true);\n\t\tif (!idsForMoving.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// to hide the context menu\n\t\tBX.onCustomEvent('Grid::updated');\n\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\n\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t{\n\t\t\t\tname:toFolderByName,\n\t\t\t\tincrease: true,\n\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\tlower: true,\n\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t},\n\t\t]);\n\n\t\tthis.runAction(\n\t\t\t'moveToFolder',\n\t\t\t{\n\t\t\t\tkeepRows: true,\n\t\t\t\tids: idsForMoving,\n\t\t\t\tparams: {\n\t\t\t\t\tfolder: toFolderByPath,\n\t\t\t\t},\n\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t\t},\n\t\t\t},\n\t\t\t()=> {\n\t\t\t\tBX.Mail.Home.Grid.reloadTable();\n\t\t\t},\n\t\t);\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tonReadClick(id)\n\t{\n\t\tlet selected = [];\n\t\tlet resultIds = [];\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselected = this.getGridInstance().getRows().getSelected();\n\t\t\tresultIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t\tif(selectedIds.length === 1 && selectedIds[0]===id)\n\t\t\t{\n\t\t\t\t/*if the action is non-group, but one cell is selected,\n\t\t\t\tthen the action was performed through the \"Action panel\"\n\t\t\t\tand the selection should be reset*/\n\t\t\t\tselected = this.getGridInstance().getRows().getSelected();\n\t\t\t\tresultIds = selectedIds;\n\t\t\t\tid = undefined;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresultIds = [id];\n\t\t\t}\n\n\t\t}\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst actionName = 'all' == id || this.isSelectedRowsHaveClass('mail-msg-list-cell-unseen', id) ? 'markAsSeen' : 'markAsUnseen';\n\n\t\tresultIds = this.filterRowsByClassName('mail-msg-list-cell-unseen', resultIds, actionName !== 'markAsSeen');\n\t\tresultIds = this.filterRowsByClassName(this.disabledClassName, resultIds, true);\n\n\t\tif (!resultIds.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = function() {\n\t\t\tthis.userInterfaceManager.onMessagesRead(resultIds, { action: actionName });\n\t\t\tconst currentFolder = this.getCurrentFolder();\n\n\t\t\tconst oldMessagesCount = actionName !== 'markAsSeen'? this.isSelectedRowsHaveClass('mail-msg-list-cell-old') : 0;\n\t\t\tlet countMessages = resultIds.length - oldMessagesCount;\n\n\t\t\tif (actionName === 'markAsSeen')\n\t\t\t{\n\t\t\t\tif ('all' === id)\n\t\t\t\t{\n\t\t\t\t\tcountMessages = BX.Mail.Home.Counters.getCounter(currentFolder) - oldMessagesCount;\n\t\t\t\t}\n\t\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tname: currentFolder,\n\t\t\t\t\t\tlower: true,\n\t\t\t\t\t\tcount: countMessages,\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t\t{\n\t\t\t\t\t\tname: currentFolder,\n\t\t\t\t\t\tincrease: true,\n\t\t\t\t\t\tcount: countMessages,\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\tif(id === undefined) {\n\t\t\t\tthis.resetGridSelection();\n\t\t\t}\n\n\t\t\tif ('all' == id)\n\t\t\t{\n\t\t\t\tresultIds['for_all'] = this.mailboxId + '-' + this.userInterfaceManager.getCurrentFolder();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t}\n\n\t\t\tthis.userInterfaceManager.updateUnreadCounters();\n\n\t\t\tthis.runAction(actionName, {\n\t\t\t\tids: resultIds,\n\t\t\t\tkeepRows: true,\n\t\t\t\tsuccessParams: actionName,\n\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t'groupCount': selected.length,\n\t\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t\t},\n\t\t\t\tonSuccess: false,\n\t\t\t});\n\n\t\t\treturn true;\n\t\t};\n\t\thandler.apply(this);\n\t}\n\n\tonSpamClick(id)\n\t{\n\t\tconst selected = this.getGridInstance().getRows().getSelected();\n\t\tif (id === undefined && selected.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.canMarkSpam)\n\t\t{\n\t\t\tthis.showDirsSlider();\n\t\t\treturn;\n\t\t}\n\t\tconst actionName = this.isSelectedRowsHaveClass('js-spam', id) ? 'restoreFromSpam' : 'markAsSpam';\n\t\tlet resultIds = this.filterRowsByClassName('js-spam', id, actionName !== 'restoreFromSpam');\n\t\tresultIds = this.filterRowsByClassName(this.disabledClassName, resultIds, true);\n\t\tif (!resultIds.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst options = {\n\t\t\tkeepRows: true,\n\t\t\tanalyticsLabel: {\n\t\t\t\t'groupCount': selected.length,\n\t\t\t\t'bindings': this.getRowsBindings(id ? [this.getGridInstance().getRows().getById(id)] : selected),\n\t\t\t},\n\t\t};\n\n\t\tlet selectedIds;\n\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = BX.Mail.Home.Grid.getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\n\t\toptions.ids = selectedIds;\n\n\t\tBX.Mail.Home.Grid.hideRowByIds(selectedIds);\n\n\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', selectedIds).length;\n\n\t\tif(actionName === 'markAsSpam')\n\t\t{\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.spamDir,\n\t\t\t\t\tincrease: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.spamDir,\n\t\t\t\t\tlower: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: this.userInterfaceManager.inboxDir,\n\t\t\t\t\tincrease: true,\n\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\n\t\tthis.runAction(actionName, options,() =>\n\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t);\n\t\tif(id === undefined)\n\t\t{\n\t\t\tthis.resetGridSelection();\n\t\t}\n\t}\n\n\tgetConfirmDeletePopup(options)\n\t{\n\t\treturn new BX.UI.Dialogs.MessageBox({\n\t\t\ttitle: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_TITLE'),\n\t\t\tmessage: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_DELETE'),\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\ttext: Loc.getMessage('MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN'),\n\t\t\t\t\tonclick: (function(button) {\n\n\t\t\t\t\t\tconst unseenRowsIdsCount = this.filterRowsByClassName('mail-msg-list-cell-unseen', options.ids).length;\n\n\t\t\t\t\t\tBX.Mail.Home.Counters.updateCounters([\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: this.getCurrentFolder(),\n\t\t\t\t\t\t\t\tlower: true,\n\t\t\t\t\t\t\t\tcount: unseenRowsIdsCount,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]);\n\n\t\t\t\t\t\tthis.runAction('delete', options,() =>\n\t\t\t\t\t\t\tBX.Mail.Home.Grid.reloadTable()\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t\tBX.Mail.Home.Grid.hideRowByIds(options.ids);\n\t\t\t\t\t}).bind(this),\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: function(button) {\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\tresetGridSelection()\n\t{\n\t\tBX.onCustomEvent('Mail::resetGridSelection');\n\t\tthis.getGridInstance().getRows().unselectAll();\n\t\tthis.getGridInstance().adjustCheckAllCheckboxes();\n\t\tBX.Mail.Home.Grid.hidePanel();\n\t}\n\n\tisSelectedRowsHaveClass(className, id)\n\t{\n\t\tlet selectedIds;\n\t\tif(id === undefined)\n\t\t{\n\t\t\tselectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectedIds = [id];\n\t\t}\n\t\tconst ids = selectedIds.length ? selectedIds : (id ? [id] : []);\n\n\t\tlet selectedLinesWithClassNumber = 0;\n\n\t\tfor (let i = 0; i < ids.length; i++)\n\t\t{\n\t\t\tconst row = this.getGridInstance().getRows().getById(ids[i]);\n\t\t\tif (row && row.node)\n\t\t\t{\n\t\t\t\tconst columns = row.node.getElementsByClassName(className);\n\t\t\t\tif (columns && columns.length)\n\t\t\t\t{\n\t\t\t\t\tselectedLinesWithClassNumber++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selectedLinesWithClassNumber;\n\t}\n\n\tfilterRowsByClassName(className, ids, isReversed)\n\t{\n\t\tlet resIds = [];\n\t\tif ('all' == ids)\n\t\t{\n\t\t\tresIds = this.getGridInstance().getRows().getBodyChild().map(\n\t\t\t\tfunction(current) {\n\t\t\t\t\treturn current.getId();\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse if (Array.isArray(ids))\n\t\t{\n\t\t\tresIds = ids;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedIds = this.getGridInstance().getRows().getSelectedIds();\n\t\t\tresIds = selectedIds.length ? selectedIds : (ids ? [ids] : []);\n\t\t}\n\t\tconst resultIds = [];\n\t\tfor (let i = resIds.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst row = this.getGridInstance().getRows().getById(resIds[i]);\n\t\t\tif (row && row.node)\n\t\t\t{\n\t\t\t\tconst columns = row.node.getElementsByClassName(className);\n\t\t\t\tif (!isReversed && (columns && columns.length))\n\t\t\t\t{\n\t\t\t\t\tresultIds.push(resIds[i]);\n\t\t\t\t}\n\t\t\t\telse if (isReversed && !(columns && columns.length))\n\t\t\t\t{\n\t\t\t\t\tresultIds.push(resIds[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn resultIds;\n\t}\n\n\tnotify(text, delay)\n\t{\n\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\tautoHideDelay: delay > 0 ? delay : 2000,\n\t\t\tcontent: text ? text : Loc.getMessage('MAIL_MESSAGE_LIST_NOTIFY_SUCCESS'),\n\t\t});\n\t}\n\n\trunAction(actionName, options, actionOnSuccess)\n\t{\n\t\toptions = options ? options : {};\n\n\t\tlet selectedIds = [];\n\n\t\tif (options.ids)\n\t\t{\n\t\t\tselectedIds = options.ids;\n\t\t}\n\t\tif (!selectedIds.length && !selectedIds.for_all)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!options.keepRows)\n\t\t{\n\t\t\tthis.getGridInstance().tableFade();\n\t\t}\n\t\tconst data = { ids: selectedIds };\n\t\tif (options.params)\n\t\t{\n\t\t\tconst optionsKeys = Object.keys(Object(options.params));\n\t\t\tfor (let nextIndex = 0, len = optionsKeys.length; nextIndex < len; nextIndex++)\n\t\t\t{\n\t\t\t\tconst nextKey = optionsKeys[nextIndex];\n\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(options.params, nextKey);\n\t\t\t\tif (desc !== undefined && desc.enumerable)\n\t\t\t\t{\n\t\t\t\t\tdata[nextKey] = options.params[nextKey];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tBX.ajax.runComponentAction('bitrix:mail.client', actionName, {\n\t\t\tmode: 'ajax',\n\t\t\tdata: data,\n\t\t\tanalyticsLabel: options.analyticsLabel,\n\t\t}).then(\n\t\t\tfunction() {\n\t\t\t\tif (options.onSuccess === false)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onSuccess && typeof (options.onSuccess) === \"function\")\n\t\t\t\t{\n\t\t\t\t\toptions.onSuccess.bind(this, selectedIds, options.successParams)();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(actionOnSuccess === undefined)\n\t\t\t\t{\n\t\t\t\t\tthis.notify();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactionOnSuccess();\n\t\t\t\t}\n\t\t\t}.bind(this),\n\t\t\tfunction(response) {\n\t\t\t\tBX.Mail.Home.Counters.restoreFromCache();\n\t\t\t\tBX.Mail.Home.Grid.reloadTable();\n\t\t\t\toptions.onError && typeof (options.onError) === \"function\" ?\n\t\t\t\t\toptions.onError().bind(this, response) :\n\t\t\t\t\tthis.onErrorRequest(response);\n\t\t\t}.bind(this),\n\t\t);\n\t}\n\n\tonErrorRequest(response)\n\t{\n\t\tlet options = {};\n\t\tthis.checkErrorRights(response.errors);\n\t\toptions.errorMessage = response.errors[0].message;\n\t\tthis.notify(options.errorMessage);\n\t}\n\n\tcheckErrorRights(errors)\n\t{\n\t\tfor (let i = 0; i < errors.length; i++)\n\t\t{\n\t\t\tif (errors[i].code === this.ERROR_CODE_CAN_NOT_DELETE)\n\t\t\t{\n\t\t\t\tthis.canDelete = false;\n\t\t\t}\n\t\t\tif (errors[i].code === this.ERROR_CODE_CAN_NOT_MARK_SPAM)\n\t\t\t{\n\t\t\t\tthis.canMarkSpam = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowDirsSlider()\n\t{\n\t\tconst url = BX.util.add_url_param(\"/mail/config/dirs\", {\n\t\t\tmailboxId: this.mailboxId,\n\t\t});\n\t\tBX.SidePanel.Instance.open(url, {\n\t\t\twidth: 640,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t});\n\t\tthis.canDelete = true;\n\t\tthis.canMarkSpam = true;\n\t}\n\n\tonDisabledGroupActionClick()\n\t{\n\t}\n\n\tgetCurrentFolder()\n\t{\n\t\treturn this.userInterfaceManager.getCurrentFolder();\n\t}\n\n\tgetGridInstance()\n\t{\n\t\treturn BX.Main.gridManager.getById(this.gridId).instance;\n\t}\n\n\tgetRowsBindings(rows)\n\t{\n\t\treturn BX.util.array_unique(Array.prototype.concat.apply(\n\t\t\t[],\n\t\t\trows.map(\n\t\t\t\tfunction(row) {\n\t\t\t\t\tif (!row || !row.node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Array.prototype.map.call(\n\t\t\t\t\t\trow.node.querySelectorAll('[class^=\"js-bind-\"] [data-type]'),\n\t\t\t\t\t\tfunction(node) {\n\t\t\t\t\t\t\treturn node.dataset.type;\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t));\n\t}\n\n\tgetCache(key)\n\t{\n\t\tif (!key)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.cache[key] ? this.cache[key] : null;\n\t}\n\n\tsetCache(key, value)\n\t{\n\t\treturn this.cache[key] = value;\n\t}\n\n\tshowICalMenuDropdown(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst menu = event.currentTarget.dataset.menu;\n\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.iCalMenuDropdown = BX.Main.MenuManager.create({\n\t\t\tid: 'mail-client-message-list-ical-dropdown-menu',\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\titems: JSON.parse(menu),\n\t\t\tzIndex: 7001,\n\t\t\tmaxHeight: 400,\n\t\t\tmaxWidth: 200,\n\t\t\tangle: {\n\t\t\t\tposition: \"top\",\n\t\t\t\toffset: 40,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function() {\n\t\t\t\t\tthis.removeICalMenuDropdown();\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t});\n\t\tthis.iCalMenuDropdown.popupWindow.setBindElement(event.currentTarget);\n\t\tthis.iCalMenuDropdown.show();\n\t}\n\n\tremoveICalMenuDropdown()\n\t{\n\t\tif (this.iCalMenuDropdown)\n\t\t{\n\t\t\tBX.Main.MenuManager.destroy(this.iCalMenuDropdown.id);\n\t\t}\n\t}\n\n\tonClickICalButton(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst messageId = event.target.dataset.messageid || event.target.parentNode.dataset.messageid;\n\t\tconst action = event.target.dataset.action || event.target.parentNode.dataset.action;\n\t\tconst button = event.target;\n\n\t\tbutton.classList.add('ui-btn-wait');\n\t\tthis.removeICalMenuDropdown();\n\n\t\tthis.sendICal(messageId, action)\n\t\t\t.then(function() {\n\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\t\t\t\tthis.notify(Loc.getMessage(action === 'cancelled' ? 'MAIL_MESSAGE_ICAL_NOTIFY_REJECT' : 'MAIL_MESSAGE_ICAL_NOTIFY_ACCEPT'));\n\t\t\t}.bind(this))\n\t\t\t.catch(function() {\n\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\t\t\t\tthis.notify(Loc.getMessage('MAIL_MESSAGE_ICAL_NOTIFY_ERROR'));\n\t\t\t}.bind(this));\n\t}\n\n\tsendICal(messageId, action)\n\t{\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tBX.ajax.runComponentAction('bitrix:mail.client', 'ical', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { messageId, action },\n\t\t\t}).then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolve();\n\t\t\t\t}.bind(this),\n\t\t\t\tfunction() {\n\t\t\t\t\treject();\n\t\t\t\t}.bind(this),\n\t\t\t);\n\t\t});\n\t}\n}\n","import { Type, Reflection, Event, Loc } from 'main.core';\nimport { Avatar } from 'mail.avatar';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageGrid } from 'mail.messagegrid';\nimport { ProgressBar } from './src/js/progressbar.es6';\nimport { Counters } from './src/js/counters.es6';\nimport { LeftMenu } from './src/js/leftmenu.es6';\nimport { List } from './src/js/list.es6';\nimport { Button } from 'ui.buttons';\n\nconst namespaceMailHome = Reflection.namespace('BX.Mail.Home');\n\nEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\tconst [messageEvent] = event.getCompatData();\n\tif(messageEvent.getEventId() === 'mail-mailbox-config-success')\n\t{\n\t\tBXMailMailbox.sync(namespaceMailHome.ProgressBar, namespaceMailHome.Grid.getId(), false,true);\n\t}\n});\n\nlet sliderPage;\nlet progressBar;\nlet errorBox;\nlet syncButtonWrapper;\n\nlet selectedIdsForRecovery = {};\n\nEvent.ready(() => {\n\n\tsyncButtonWrapper = document.querySelector('[data-role=\"mail-msg-sync-button-wrapper\"]');\n\n\tconst syncButton = new Button({\n\t\tclassName:\"ui-btn ui-btn-themes ui-btn-light-border mail-msg-sync-button\",\n\t\ticon: Button.Icon.BUSINESS,\n\t\tprops: {\n\t\t\ttitle: Loc.getMessage(\"MAIL_MESSAGE_SYNC_BTN_HINT\")\n\t\t},\n\t\tonclick: function() {\n\t\t\tBXMailMailbox.sync(namespaceMailHome.ProgressBar, Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\"),false,true);\n\t\t},\n\t});\n\n\tsyncButtonWrapper.append(\n\t\tsyncButton.getContainer()\n\t)\n\n\tEventEmitter.subscribe('BX.Main.Grid:onBeforeReload', (event) => {\n\t\tconst [grid] = event.getCompatData();\n\t\tif(grid !== {} && grid !== undefined && Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\") === grid.getId())\n\t\t{\n\t\t\tselectedIdsForRecovery = grid.getRows().getSelectedIds();\n\t\t}\n\t});\n\n\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif(grid !== {} && grid !== undefined && Loc.getMessage(\"MAIL_MESSAGE_GRID_ID\") === grid.getId())\n\t\t{\n\t\t\tlet rowsWereSelected = false;\n\t\t\tnamespaceMailHome.Grid.getRows().map(function (row)\n\t\t\t{\n\t\t\t\tif(Type.isFunction(selectedIdsForRecovery.indexOf) && selectedIdsForRecovery.indexOf(row.getId()) !== -1)\n\t\t\t\t{\n\t\t\t\t\tif(row.isShown())\n\t\t\t\t\t{\n\t\t\t\t\t\trow.select();\n\t\t\t\t\t\trowsWereSelected = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tselectedIdsForRecovery = {}\n\n\t\t\tif(rowsWereSelected)\n\t\t\t{\n\t\t\t\tsetTimeout(\n\t\t\t\t\tfunction ()\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.emit(window,'Grid::thereSelectedRows');\n\t\t\t\t\t},\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\n\tAvatar.replaceTagsWithAvatars({\n\t\tclassName: 'mail-ui-avatar',\n\t});\n\n\tsliderPage = document.getElementsByClassName(\"ui-slider-page\")[0];\n\tprogressBar = document.querySelector('[data-role=\"mail-progress-bar\"]');\n\tsliderPage.insertBefore(progressBar,sliderPage.firstChild);\n\terrorBox = document.querySelector('[data-role=\"error-box\"]');\n\n\tnamespaceMailHome.ProgressBar = new ProgressBar(progressBar);\n\tnamespaceMailHome.unreadMessageMailboxesMarker = document.querySelector('[data-role=\"unreadMessageMailboxesMarker\"]');;\n\n\tnamespaceMailHome.ProgressBar.setSyncButton(syncButton);\n\tnamespaceMailHome.ProgressBar.setErrorBoxNode(document.querySelector('[data-role=\"error-box\"]'))\n\tnamespaceMailHome.ProgressBar.setErrorTextNode(document.querySelector('[data-role=\"error-box-text\"]'));\n\tnamespaceMailHome.ProgressBar.setErrorHintNode(document.querySelector('[data-role=\"error-box-hint\"]'));\n\tnamespaceMailHome.ProgressBar.setErrorTitleNode(document.querySelector('[data-role=\"error-box-title\"]'));\n});\n\nBX.ready(function() {\n\tnamespaceMailHome.Counters = new Counters('dirs', Loc.getMessage(\"DEFAULT_DIR\"));\n\tnamespaceMailHome.mailboxCounters = new Counters('mailboxCounters');\n\tnamespaceMailHome.Grid = new MessageGrid();\n});\nnamespaceMailHome.LeftMenu = LeftMenu;\n\nconst namespaceClientMessage = Reflection.namespace('BX.Mail.Client.Message');\nnamespaceClientMessage.List = List;\n"],"names":["ProgressBar","node","button","errorBoxNode","errorTitleNode","errorTextNode","errorHintNode","getSyncButton","undefined","setWaiting","classList","add","remove","Counters","name","selectedDirectory","_classPrivateFieldInitSpec","setDirectory","counters","shortcut","shortcuts","path","getDirPath","resultCounters","getCounter","sendCounterUpdateEvent","shortcutName","counterNames","counter","hiddenCountersForTotalCounter","count","Number","cacheCounters","i","length","addCounter","addCounters","isExists","newValue","cachedCounters","Object","assign","increase","lower","countersAreNotLoadedFromTheServer","lowerCounter","increaseCounter","event","BaseEvent","data","hidden","getName","EventEmitter","emit","LeftMenu","config","dirsWithUnseenMailCounters","mailboxId","filterId","systemDirs","spam","trash","outcome","drafts","inbox","leftDirectoryMenuWrapper","document","querySelector","directoryMenu","DirectoryMenu","append","getNode","List","options","mailReadAllButton","gridId","canMarkSpam","canDelete","ERROR_CODE_CAN_NOT_DELETE","ERROR_CODE_CAN_NOT_MARK_SPAM","disabledClassName","userInterfaceManager","BX","Mail","Client","Message","UserInterfaceManager","resetGridSelection","bind","isSelectedRowsHaveClass","getGridInstance","cache","addEventHandlers","id","ajax","UpdatePageData","subscribe","menuItem","target","container","getMenuWindow","getPopupWindow","getPopupContainer","getSubMenu","gridRowId","Home","LeftMenuNode","setCounters","mailboxCounters","getTotalCounter","updateLeftMenuCounter","dataset","menuWindow","subMenuItems","getMenuItems","hash","dirMd5","hasChild","item","getId","hasSubMenu","showSubMenu","subMenu","hasLoadingItem","items","k","subItem","loadLevelMenu","itemsMenu","querySelectorAll","addEventListener","showICalMenuDropdown","bindDelegate","body","className","onClickICalButton","menu","getCache","popup","Main","PopupManager","getPopupById","destroy","destroySubMenu","addSubMenu","Loc","getMessage","runComponentAction","mode","dir","then","response","dirs","test","FLAGS","PATH","NAME","DIR_MD5","IS_DISABLED","push","setCache","isShown","selected","getRows","getSelected","row","getById","addToCrm","isAddToCrmActionAvailable","messageIdNode","messageId","crmBtnInRow","startWait","isAddingToCrmInProgress","analyticsLabel","getRowsBindings","notify","json","stopWait","errors","map","message","join","onCrmBindingDeleted","selectedIds","getSelectedIds","SidePanel","Instance","open","width","loader","additionalOptions","onDeleteClick","showDirsSlider","params","keepRows","Grid","filterRowsByClassName","ids","isCurrentFolderTrash","confirmPopup","getConfirmDeletePopup","show","hideRowByIds","unseenRowsIdsCount","updateCounters","getCurrentFolder","runAction","reloadTable","folderOptions","currentTarget","toFolderByPath","toFolderByName","popupSubmenu","findParent","isDisabled","JSON","parse","idsForMoving","onCustomEvent","folder","resultIds","actionName","handler","onMessagesRead","action","currentFolder","oldMessagesCount","countMessages","updateUnreadCounters","successParams","onSuccess","apply","spamDir","inboxDir","UI","Dialogs","MessageBox","title","buttons","Button","color","Color","DANGER","text","onclick","getContext","close","CancelButton","unselectAll","adjustCheckAllCheckboxes","hidePanel","selectedLinesWithClassNumber","columns","getElementsByClassName","isReversed","resIds","getBodyChild","current","Array","isArray","delay","top","Notification","Center","autoHideDelay","content","actionOnSuccess","for_all","tableFade","optionsKeys","keys","nextIndex","len","nextKey","desc","getOwnPropertyDescriptor","enumerable","restoreFromCache","onError","onErrorRequest","checkErrorRights","errorMessage","code","url","util","add_url_param","cacheable","allowChangeHistory","gridManager","instance","rows","array_unique","prototype","concat","call","type","key","value","stopPropagation","preventDefault","iCalMenuDropdown","MenuManager","create","autoHide","closeByEsc","zIndex","maxHeight","maxWidth","angle","position","offset","events","onPopupClose","removeICalMenuDropdown","popupWindow","setBindElement","messageid","parentNode","sendICal","Promise","resolve","reject","namespaceMailHome","Reflection","namespace","getCompatData","messageEvent","getEventId","BXMailMailbox","sync","sliderPage","progressBar","errorBox","syncButtonWrapper","selectedIdsForRecovery","Event","ready","syncButton","icon","Icon","BUSINESS","props","getContainer","grid","rowsWereSelected","Type","isFunction","indexOf","select","setTimeout","window","Avatar","replaceTagsWithAvatars","insertBefore","firstChild","unreadMessageMailboxesMarker","setSyncButton","setErrorBoxNode","setErrorTextNode","setErrorHintNode","setErrorTitleNode","MessageGrid","namespaceClientMessage"],"mappings":"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"}