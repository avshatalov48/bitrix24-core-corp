(function(e,t,n,i,a,r,s){"use strict";var o=function(){function e(t){babelHelpers.classCallCheck(this,e);l.set(this,{writable:true,value:void 0});u.set(this,{writable:true,value:void 0});d.set(this,{writable:true,value:void 0});c.set(this,{writable:true,value:void 0});g.set(this,{writable:true,value:void 0});h.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,l,t)}babelHelpers.createClass(e,[{key:"setSyncButton",value:function e(t){babelHelpers.classPrivateFieldSet(this,g,t)}},{key:"getSyncButton",value:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"getErrorBoxNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,c)}},{key:"setErrorBoxNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,c,t)}},{key:"setErrorTitleNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,u,t)}},{key:"setErrorTextNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,d,t)}},{key:"setErrorHintNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,h,t)}},{key:"getErrorTextNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"getErrorHintNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}},{key:"getErrorTitleNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"show",value:function e(){if(this.getSyncButton()!==undefined)this.getSyncButton().setWaiting(true);babelHelpers.classPrivateFieldGet(this,l).classList.add("mail-progress-show");babelHelpers.classPrivateFieldGet(this,l).classList.remove("mail-progress-hide")}},{key:"hide",value:function e(){if(this.getSyncButton()!==undefined)this.getSyncButton().setWaiting(false);babelHelpers.classPrivateFieldGet(this,l).classList.add("mail-progress-hide");babelHelpers.classPrivateFieldGet(this,l).classList.remove("mail-progress-show")}},{key:"hideErrorBox",value:function e(){babelHelpers.classPrivateFieldGet(this,c).classList.add("mail-hidden-element");babelHelpers.classPrivateFieldGet(this,c).classList.remove("mail-visible-element")}},{key:"showErrorBox",value:function e(){babelHelpers.classPrivateFieldGet(this,c).classList.add("mail-visible-element");babelHelpers.classPrivateFieldGet(this,c).classList.remove("mail-hidden-element")}}]);return e}();var l=new WeakMap;var u=new WeakMap;var d=new WeakMap;var c=new WeakMap;var g=new WeakMap;var h=new WeakMap;var f=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"counters",[]);babelHelpers.defineProperty(this,"hiddenCountersForTotalCounter",[]);v.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,v,t)}babelHelpers.createClass(e,[{key:"getName",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"setHiddenCountersForTotalCounter",value:function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++){n[i]=arguments[i]}for(var a=0,r=n;a<r.length;a++){var s=r[a];this.hiddenCountersForTotalCounter[s]="disabled"}}},{key:"getTotalCounter",value:function e(){var t=0;for(var n in this.counters){if(n in this.hiddenCountersForTotalCounter)continue;t+=this.counters[n]}return t}},{key:"getCounterObjects",value:function e(){return this.counters}},{key:"getCounter",value:function e(t){return this.counters[t]}},{key:"addCounter",value:function e(t,n){this.counters[t]=Number(n);return this.counters[t]}},{key:"addCounters",value:function e(t){var n={};for(var i=0;i<t.length;i++){var r=t[i];var s=r["path"];this.addCounter(s,r["count"]);n[s]=r["count"]}var o=new a.BaseEvent({data:{counters:n,name:this.getName()}});a.EventEmitter.emit("BX.Mail.Home:updatingCounters",o)}},{key:"setCounters",value:function e(t){this.addCounters(t)}},{key:"isExists",value:function e(t){return this.counters[t]!==undefined}},{key:"increaseCounter",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!this.isExists(t)){return"no counter"}this.counters[t]+=Number(n)}},{key:"lowerCounter",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!this.isExists(t)){return"no counter"}var i=this.counters[t]-Number(n);if(i<0){return"negative value"}this.counters[t]=i}},{key:"updateCounters",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[{name:"counter1",count:2,increase:false,lower:true},{name:"counter2",count:2,increase:true,lower:false}];var n={};var i=false;for(var r=0;r<t.length;r++){var s=t[r];var o=s["name"];if(s["lower"]){if(this.lowerCounter(o,s["count"])==="negative value"){i=true}}if(s["increase"]&&i===false){this.increaseCounter(o,s["count"])}n[o]=this.getCounter(o)}var l=new a.BaseEvent({data:{counters:n,name:this.getName()}});a.EventEmitter.emit("BX.Mail.Home:updatingCounters",l)}}]);return e}();var v=new WeakMap;var m=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{dirsWithUnseenMailCounters:{},mailboxId:"",filterId:""};babelHelpers.classCallCheck(this,e);var n=document.querySelector(".mail-left-menu-wrapper");this.directoryMenu=new i.DirectoryMenu({dirsWithUnseenMailCounters:t["dirsWithUnseenMailCounters"],filterId:t["filterId"]});a.EventEmitter.subscribe("BX.Mail.Sync:newLettersArrived",function(){BX.ajax.runComponentAction("bitrix:mail.client.message.list","getDirsWithUnseenMailCounters",{mode:"class",data:{mailboxId:t["mailboxId"]}}).then(function(e){var t=e.data||{};BX.Mail.Home.Counters.setCounters(t)})});n.append(this.directoryMenu.getNode())};var C=function(){function e(t){babelHelpers.classCallCheck(this,e);this.pageCounter=t.pageCounter;this.pageCounterTitle=t.pageCounterTitle;this.mailReadAllButton=t.mailReadAllButton;this.gridId=t.gridId;this.mailboxId=t.mailboxId;this.canMarkSpam=t.canMarkSpam;this.canDelete=t.canDelete;this.connectedMailboxesLicenseInfo=t.connectedMailboxesLicenseInfo;this.ERROR_CODE_CAN_NOT_DELETE=t.ERROR_CODE_CAN_NOT_DELETE;this.ERROR_CODE_CAN_NOT_MARK_SPAM=t.ERROR_CODE_CAN_NOT_MARK_SPAM;this.disabledClassName="js-disabled";this.userInterfaceManager=new BX.Mail.Client.Message.List.UserInterfaceManager(t);this.userInterfaceManager.resetGridSelection=this.resetGridSelection.bind(this);this.userInterfaceManager.isSelectedRowsHaveClass=this.isSelectedRowsHaveClass.bind(this);this.userInterfaceManager.getGridInstance=this.getGridInstance.bind(this);this.cache={};this.addEventHandlers();BX.Mail.Client.Message.List[t.id]=this}babelHelpers.createClass(e,[{key:"addEventHandlers",value:function e(){var t=this;BX.ajax.UpdatePageData=function(){};a.EventEmitter.subscribe("onSubMenuShow",function(e){var t=e.target;var n=t.getMenuWindow().getPopupWindow().getPopupContainer();var i=null;if(n){i=BX.data(n,"grid-row-id")}BX.data(t.getSubMenu().getPopupWindow().getPopupContainer(),"grid-row-id",t.gridRowId||i)});BX.Mail.Home.LeftMenuNode.directoryMenu.setDirectory(this.getCurrentFolder());a.EventEmitter.subscribe("Mail::directoryChanged",function(){t.resetGridSelection()});a.EventEmitter.subscribe("BX.Mail.Home:updatingCounters",function(e){if(e["data"]["name"]!=="mailboxCounters"){var n=e["data"]["counters"];BX.Mail.Home.LeftMenuNode.directoryMenu.setCounters(n);var i=n[t.getCurrentFolder()];if(i!==undefined){t.changeCurrentFolderCount(i)}BX.Mail.Home.mailboxCounters.setCounters([{path:"unseenCountInCurrentMailbox",count:BX.Mail.Home.Counters.getTotalCounter()}])}else{t.userInterfaceManager.updateLeftMenuCounter()}});a.EventEmitter.subscribe("BX.DirectoryMenu:onChangeFilter",function(e){t.changeCurrentFolderCount(BX.Mail.Home.Counters.getCounter(e["data"]["directory"]))});a.EventEmitter.subscribe("BX.Main.Menu.Item:onmouseenter",function(e){var t=e.target;if(!t.dataset||!t.getMenuWindow()){return}var n=t.getMenuWindow();var i=n.getMenuItems();var a=t.dataset.path;var r=t.dataset.dirMd5;var s=t.dataset.hasChild;if(!s){return}for(var o=0;o<i.length;o++){var l=i[o];if(l.getId()===a){var u=l.hasSubMenu();if(u){l.showSubMenu();var d=l.getSubMenu();var c=false;if(d){var g=d.getMenuItems();for(var h=0;h<g.length;h++){var f=g[h];if(f.getId()==="loading"){c=true}}}if(!c){return}}this.loadLevelMenu(l,r)}}}.bind(this));var n=document.querySelectorAll(".ical-event-control-menu");for(var i=0;i<n.length;i++){n[i].addEventListener("click",this.showICalMenuDropdown.bind(this))}BX.bindDelegate(document.body,"click",{className:"ical-event-control-button"},this.onClickICalButton.bind(this))}},{key:"changeCurrentFolderCount",value:function e(t){if(t>0){this.pageCounter.textContent=t;this.pageCounterTitle.classList.remove("main-ui-hide");this.mailReadAllButton.classList.remove("main-ui-hide")}else{this.pageCounterTitle.classList.add("main-ui-hide");this.mailReadAllButton.classList.add("main-ui-hide")}}},{key:"loadLevelMenu",value:function e(t,n){var i=this.getCache(t.getId());var a=BX.Main.PopupManager.getPopupById("menu-popup-popup-submenu-"+t.getId());if(a){a.destroy()}if(i){t.destroySubMenu();t.addSubMenu(i);t.showSubMenu();return}var s={id:"loading",text:r.Loc.getMessage("MAIL_CLIENT_BUTTON_LOADING"),disabled:true};t.destroySubMenu();t.addSubMenu([s]);t.showSubMenu();BX.ajax.runComponentAction("bitrix:mail.client.config.dirs","level",{mode:"class",data:{mailboxId:this.mailboxId,dir:{path:t.getId(),dirMd5:n}}}).then(function(e){var n=e.data.dirs;var i=[];for(var a=0;a<n.length;a++){var s=/(HasChildren)/i.test(n[a].FLAGS);var o={id:n[a].PATH,text:n[a].NAME,dataset:{path:n[a].PATH,dirMd5:n[a].DIR_MD5,isDisabled:n[a].IS_DISABLED,hasChild:s},items:s?[{id:"loading",text:r.Loc.getMessage("MAIL_CLIENT_BUTTON_LOADING"),disabled:true}]:[]};i.push(o)}this.setCache(t.getId(),i);var l=BX.Main.PopupManager.getPopupById("menu-popup-popup-submenu-"+t.getId());var u=t.getMenuWindow().getPopupWindow().isShown();if(l){l.destroy()}if(u){t.destroySubMenu();t.addSubMenu(i);t.showSubMenu()}}.bind(this),function(e){}.bind(this))}},{key:"showLicensePopup",value:function e(t){B24.licenseInfoPopup.show(t,r.Loc.getMessage("MAIL_MAILBOX_LICENSE_CONNECTED_MAILBOXES_LIMIT_TITLE"),this.connectedMailboxesLicenseInfo)}},{key:"onCrmClick",value:function e(t){var n=this.getGridInstance().getRows().getSelected();var i=t?this.getGridInstance().getRows().getById(t):n[0];if(!(i&&i.node)){return}var a=this.userInterfaceManager.isAddToCrmActionAvailable(i.node);var s=i.node.querySelector("[data-message-id]");if(!(s.dataset&&s.dataset.messageId)){return}if(t===undefined){this.resetGridSelection()}if(a){if(babelHelpers.typeof(this.isAddingToCrmInProgress)!=="object"){this.isAddingToCrmInProgress={}}if(this.isAddingToCrmInProgress[t]===true){return}this.isAddingToCrmInProgress[t]=true;BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:s.dataset.messageId},analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings([i])}}).then(function(e){this.isAddingToCrmInProgress[e]=false;this.notify(r.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_ADDED_TO_CRM"))}.bind(this,t),function(e){this.isAddingToCrmInProgress[t]=false;if(e.errors&&e.errors.length>0){this.notify(e.errors.map(function(e){return e.message}).join("<br>"),5e3)}else{this.notify(r.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_ADD_TO_CRM_ERROR"))}}.bind(this))}else{BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:s.dataset.messageId},analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings([i])}}).then(function(e){this.userInterfaceManager.onCrmBindingDeleted(e.dataset.messageId);this.notify(r.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_EXCLUDED_FROM_CRM"))}.bind(this,s))}var o=this.getGridInstance().getRows().getSelectedIds();if(o.length===1&&o[0]===t){this.resetGridSelection()}}},{key:"onViewClick",value:function e(t){if(t===undefined&&this.getGridInstance().getRows().getSelectedIds().length===0){return}BX.SidePanel.Instance.open("/mail/message/"+t,{width:1080,loader:"view-mail-loader"})}},{key:"onDeleteImmediately",value:function e(t){var n={deleteImmediately:true};this.onDeleteClick(t,n)}},{key:"onDeleteClick",value:function e(t,n){var i=this.getGridInstance().getRows().getSelected();if(t===undefined&&i.length===0){return}if(!this.canDelete){this.showDirsSlider();return}var a={params:n!==undefined?n:{},keepRows:true,analyticsLabel:{groupCount:i.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:i)}};var r;if(t===undefined){r=BX.Mail.Home.Grid.getSelectedIds()}else{r=[t]}r=this.filterRowsByClassName(this.disabledClassName,r,true);a.ids=r;if(this.userInterfaceManager.isCurrentFolderTrash||n!==undefined&&n["deleteImmediately"]){var s=this.getConfirmDeletePopup(a);s.show()}else{BX.Mail.Home.Grid.hideRowByIds(r);var o=this.filterRowsByClassName("mail-msg-list-cell-unseen",r).length;BX.Mail.Home.Counters.updateCounters([{name:this.getCurrentFolder(),lower:true,count:o}]);this.runAction("delete",a,function(){return BX.Mail.Home.Grid.reloadTable()});if(t===undefined){this.resetGridSelection()}}}},{key:"onMoveToFolderClick",value:function e(t){var n=t.currentTarget.dataset;var i=undefined;var a=BX.findParent(t.currentTarget,{className:"popup-window"});if(a){i=BX.data(a,"grid-row-id")}var r=JSON.parse(n.isDisabled);var s=n.path;var o=s;if(i===undefined&&this.getGridInstance().getRows().getSelectedIds().length===0||r){return}var l=this.getGridInstance().getRows().getSelected();var u=i?[i]:this.getGridInstance().getRows().getSelectedIds();u=this.filterRowsByClassName(this.disabledClassName,u,true);if(!u.length){return}BX.onCustomEvent("Grid::updated");var d;if(i===undefined){d=BX.Mail.Home.Grid.getSelectedIds()}else{d=[i]}BX.Mail.Home.Grid.hideRowByIds(d);var c=this.filterRowsByClassName("mail-msg-list-cell-unseen",d).length;BX.Mail.Home.Counters.updateCounters([{name:o,increase:true,count:c},{name:this.getCurrentFolder(),lower:true,count:c}]);this.runAction("moveToFolder",{keepRows:true,ids:u,params:{folder:s},analyticsLabel:{groupCount:l.length,bindings:this.getRowsBindings(i?[this.getGridInstance().getRows().getById(i)]:l)}},function(){BX.Mail.Home.Grid.reloadTable()});if(i===undefined){this.resetGridSelection()}}},{key:"onReadClick",value:function e(t){var n=[];var i=[];if(t===undefined){n=this.getGridInstance().getRows().getSelected();i=this.getGridInstance().getRows().getSelectedIds()}else{var a=this.getGridInstance().getRows().getSelectedIds();if(a.length===1&&a[0]===t){n=this.getGridInstance().getRows().getSelected();i=a;t=undefined}else{i=[t]}}if(t===undefined&&n.length===0){return}var r="all"==t||this.isSelectedRowsHaveClass("mail-msg-list-cell-unseen",t)?"markAsSeen":"markAsUnseen";i=this.filterRowsByClassName("mail-msg-list-cell-unseen",i,r!=="markAsSeen");i=this.filterRowsByClassName(this.disabledClassName,i,true);if(!i.length){return}var s=function e(){this.userInterfaceManager.onMessagesRead(i,{action:r});var a=this.getCurrentFolder();if(r==="markAsSeen"){var s=i.length;if("all"===t){s=BX.Mail.Home.Counters.getCounter(a)}BX.Mail.Home.Counters.updateCounters([{name:a,lower:true,count:s}])}else{BX.Mail.Home.Counters.updateCounters([{name:a,increase:true,count:i.length}])}if(t===undefined){this.resetGridSelection()}if("all"==t){i["for_all"]=this.mailboxId+"-"+this.userInterfaceManager.getCurrentFolder()}this.userInterfaceManager.updateUnreadCounters();this.runAction(r,{ids:i,keepRows:true,successParams:r,analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:n)},onSuccess:false});return true};s.apply(this)}},{key:"onSpamClick",value:function e(t){var n=this.getGridInstance().getRows().getSelected();if(t===undefined&&n.length===0){return}if(!this.canMarkSpam){this.showDirsSlider();return}var i=this.isSelectedRowsHaveClass("js-spam",t)?"restoreFromSpam":"markAsSpam";var a=this.filterRowsByClassName("js-spam",t,i!=="restoreFromSpam");a=this.filterRowsByClassName(this.disabledClassName,a,true);if(!a.length){return}var r={keepRows:true,analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:n)}};var s;if(t===undefined){s=BX.Mail.Home.Grid.getSelectedIds()}else{s=[t]}r.ids=s;BX.Mail.Home.Grid.hideRowByIds(s);var o=this.filterRowsByClassName("mail-msg-list-cell-unseen",s).length;if(i==="markAsSpam"){BX.Mail.Home.Counters.updateCounters([{name:this.userInterfaceManager.spamDir,increase:true,count:o},{name:this.getCurrentFolder(),lower:true,count:o}])}else{BX.Mail.Home.Counters.updateCounters([{name:this.userInterfaceManager.spamDir,lower:true,count:o},{name:this.userInterfaceManager.inboxDir,increase:true,count:o}])}this.runAction(i,r,function(){return BX.Mail.Home.Grid.reloadTable()});if(t===undefined){this.resetGridSelection()}}},{key:"getConfirmDeletePopup",value:function e(t){return new BX.UI.Dialogs.MessageBox({title:r.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_TITLE"),message:r.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_DELETE"),buttons:[new BX.UI.Button({color:BX.UI.Button.Color.DANGER,text:r.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN"),onclick:function(e){this.runAction("delete",t,function(){return BX.Mail.Home.Grid.reloadTable()});e.getContext().close();BX.Mail.Home.Grid.hideRowByIds(t.ids)}.bind(this)}),new BX.UI.CancelButton({onclick:function e(t){t.getContext().close()}})]})}},{key:"resetGridSelection",value:function e(){BX.onCustomEvent("Mail::resetGridSelection");this.getGridInstance().getRows().unselectAll();this.getGridInstance().adjustCheckAllCheckboxes();BX.Mail.Home.Grid.hidePanel()}},{key:"isSelectedRowsHaveClass",value:function e(t,n){var i;if(n===undefined){i=this.getGridInstance().getRows().getSelectedIds()}else{i=[n]}var a=i.length?i:n?[n]:[];for(var r=0;r<a.length;r++){var s=this.getGridInstance().getRows().getById(a[r]);if(s&&s.node){var o=s.node.getElementsByClassName(t);if(o&&o.length){return true}}}return false}},{key:"filterRowsByClassName",value:function e(t,n,i){var a=[];if("all"==n){a=this.getGridInstance().getRows().getBodyChild().map(function(e){return e.getId()})}else if(Array.isArray(n)){a=n}else{var r=this.getGridInstance().getRows().getSelectedIds();a=r.length?r:n?[n]:[]}var s=[];for(var o=a.length-1;o>=0;o--){var l=this.getGridInstance().getRows().getById(a[o]);if(l&&l.node){var u=l.node.getElementsByClassName(t);if(!i&&u&&u.length){s.push(a[o])}else if(i&&!(u&&u.length)){s.push(a[o])}}}return s}},{key:"notify",value:function e(t,n){top.BX.UI.Notification.Center.notify({autoHideDelay:n>0?n:2e3,content:t?t:r.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_SUCCESS")})}},{key:"runAction",value:function e(t,n,i){n=n?n:{};var a=[];if(n.ids){a=n.ids}if(!a.length&&!a.for_all){return}if(!n.keepRows){this.getGridInstance().tableFade()}var r={ids:a};if(n.params){var s=Object.keys(Object(n.params));for(var o=0,l=s.length;o<l;o++){var u=s[o];var d=Object.getOwnPropertyDescriptor(n.params,u);if(d!==undefined&&d.enumerable){r[u]=n.params[u]}}}BX.ajax.runComponentAction("bitrix:mail.client",t,{mode:"ajax",data:r,analyticsLabel:n.analyticsLabel}).then(function(){if(n.onSuccess===false){return}if(n.onSuccess&&typeof n.onSuccess==="function"){n.onSuccess.bind(this,a,n.successParams)();return}if(i===undefined){this.notify()}else{i()}}.bind(this),function(e){n.onError&&typeof n.onError==="function"?n.onError().bind(this,e):this.onErrorRequest(e)}.bind(this))}},{key:"onErrorRequest",value:function e(t){var n={};this.checkErrorRights(t.errors);n.errorMessage=t.errors[0].message}},{key:"checkErrorRights",value:function e(t){for(var n=0;n<t.length;n++){if(t[n].code===this.ERROR_CODE_CAN_NOT_DELETE){this.canDelete=false}if(t[n].code===this.ERROR_CODE_CAN_NOT_MARK_SPAM){this.canMarkSpam=false}}}},{key:"showDirsSlider",value:function e(){var t=BX.util.add_url_param("/mail/config/dirs",{mailboxId:this.mailboxId});BX.SidePanel.Instance.open(t,{width:640,cacheable:false,allowChangeHistory:false});this.canDelete=true;this.canMarkSpam=true}},{key:"onDisabledGroupActionClick",value:function e(){}},{key:"onUnreadCounterClick",value:function e(){this.userInterfaceManager.onUnreadCounterClick()}},{key:"getCurrentFolder",value:function e(){return this.userInterfaceManager.getCurrentFolder()}},{key:"getGridInstance",value:function e(){return BX.Main.gridManager.getById(this.gridId).instance}},{key:"getRowsBindings",value:function e(t){return BX.util.array_unique(Array.prototype.concat.apply([],t.map(function(e){if(!e||!e.node){return null}return Array.prototype.map.call(e.node.querySelectorAll('[class^="js-bind-"] [data-type]'),function(e){return e.dataset.type})})))}},{key:"getCache",value:function e(t){if(!t){return}return this.cache[t]?this.cache[t]:null}},{key:"setCache",value:function e(t,n){return this.cache[t]=n}},{key:"showICalMenuDropdown",value:function e(t){t.stopPropagation();t.preventDefault();var n=t.currentTarget.dataset.menu;if(!n){return}this.iCalMenuDropdown=BX.Main.MenuManager.create({id:"mail-client-message-list-ical-dropdown-menu",autoHide:true,closeByEsc:true,items:JSON.parse(n),zIndex:7001,maxHeight:400,maxWidth:200,angle:{position:"top",offset:40},events:{onPopupClose:function(){this.removeICalMenuDropdown()}.bind(this)}});this.iCalMenuDropdown.popupWindow.setBindElement(t.currentTarget);this.iCalMenuDropdown.show()}},{key:"removeICalMenuDropdown",value:function e(){if(this.iCalMenuDropdown){BX.Main.MenuManager.destroy(this.iCalMenuDropdown.id)}}},{key:"onClickICalButton",value:function e(t){t.stopPropagation();t.preventDefault();var n=t.target.dataset.messageid||t.target.parentNode.dataset.messageid;var i=t.target.dataset.action||t.target.parentNode.dataset.action;var a=t.target;a.classList.add("ui-btn-wait");this.removeICalMenuDropdown();this.sendICal(n,i).then(function(){a.classList.remove("ui-btn-wait");this.notify(r.Loc.getMessage(i==="cancelled"?"MAIL_MESSAGE_ICAL_NOTIFY_REJECT":"MAIL_MESSAGE_ICAL_NOTIFY_ACCEPT"))}.bind(this)).catch(function(){a.classList.remove("ui-btn-wait");this.notify(r.Loc.getMessage("MAIL_MESSAGE_ICAL_NOTIFY_ERROR"))}.bind(this))}},{key:"sendICal",value:function e(t,n){return new Promise(function(e,i){BX.ajax.runComponentAction("bitrix:mail.client","ical",{mode:"ajax",data:{messageId:t,action:n}}).then(function(){e()}.bind(this),function(){i()}.bind(this))})}}]);return e}();var p=r.Reflection.namespace("BX.Mail.Home");a.EventEmitter.subscribe("SidePanel.Slider:onMessage",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),i=n[0];if(i.getEventId()==="mail-mailbox-config-success"){BXMailMailbox.sync(p.ProgressBar,p.Grid.getId(),false,true)}});var b;var M;var I;var y;var w={};r.Event.ready(function(){y=document.querySelector('[data-role="mail-msg-sync-button-wrapper"]');var e=new s.Button({className:"ui-btn ui-btn-themes ui-btn-light-border mail-msg-sync-button",icon:s.Button.Icon.BUSINESS,props:{title:r.Loc.getMessage("MAIL_MESSAGE_SYNC_BTN_HINT")},onclick:function e(){BXMailMailbox.sync(p.ProgressBar,r.Loc.getMessage("MAIL_MESSAGE_GRID_ID"),false,true)}});y.append(e.getContainer());a.EventEmitter.subscribe("BX.Main.Grid:onBeforeReload",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),i=n[0];if(i!=={}&&i!==undefined&&r.Loc.getMessage("MAIL_MESSAGE_GRID_ID")===i.getId()){w=i.getRows().getSelectedIds()}});a.EventEmitter.subscribe("Grid::updated",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),i=n[0];if(i!=={}&&i!==undefined&&r.Loc.getMessage("MAIL_MESSAGE_GRID_ID")===i.getId()){var s=false;p.Grid.getRows().map(function(e){if(r.Type.isFunction(w.indexOf)&&w.indexOf(e.getId())!==-1){if(e.isShown()){e.select();s=true}}});w={};if(s){setTimeout(function(){a.EventEmitter.emit(window,"Grid::thereSelectedRows")},0)}}});t.Avatar.replaceTagsWithAvatars({className:"mail-ui-avatar"});b=document.getElementsByClassName("ui-slider-page")[0];M=document.querySelector('[data-role="mail-progress-bar"]');b.insertBefore(M,b.firstChild);I=document.querySelector('[data-role="error-box"]');p.ProgressBar=new o(M);p.unreadMessageMailboxesMarker=document.querySelector('[data-role="unreadMessageMailboxesMarker"]');p.ProgressBar.setSyncButton(e);p.ProgressBar.setErrorBoxNode(document.querySelector('[data-role="error-box"]'));p.ProgressBar.setErrorTextNode(document.querySelector('[data-role="error-box-text"]'));p.ProgressBar.setErrorHintNode(document.querySelector('[data-role="error-box-hint"]'));p.ProgressBar.setErrorTitleNode(document.querySelector('[data-role="error-box-title"]'))});p.Counters=new f;p.mailboxCounters=new f("mailboxCounters");p.Grid=new n.MessageGrid;p.LeftMenu=m;var S=r.Reflection.namespace("BX.Mail.Client.Message");S.List=C})(this.window=this.window||{},BX.Mail,BX.Mail,BX.Mail,BX.Event,BX,BX.UI);
//# sourceMappingURL=script.map.js