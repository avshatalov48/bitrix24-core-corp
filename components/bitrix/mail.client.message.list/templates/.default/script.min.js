(function(e,t,n,r,i,a,s){"use strict";var o=new WeakMap;var l=new WeakMap;var u=new WeakMap;var d=new WeakMap;var c=new WeakMap;var g=new WeakMap;var h=function(){function e(t){babelHelpers.classCallCheck(this,e);o.set(this,{writable:true,value:void 0});l.set(this,{writable:true,value:void 0});u.set(this,{writable:true,value:void 0});d.set(this,{writable:true,value:void 0});c.set(this,{writable:true,value:void 0});g.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,o,t)}babelHelpers.createClass(e,[{key:"setSyncButton",value:function e(t){babelHelpers.classPrivateFieldSet(this,c,t)}},{key:"getSyncButton",value:function e(){return babelHelpers.classPrivateFieldGet(this,c)}},{key:"getErrorBoxNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"setErrorBoxNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,d,t)}},{key:"setErrorTitleNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,l,t)}},{key:"setErrorTextNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,u,t)}},{key:"setErrorHintNode",value:function e(t){babelHelpers.classPrivateFieldSet(this,g,t)}},{key:"getErrorTextNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getErrorHintNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"getErrorTitleNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,l)}},{key:"show",value:function e(){if(this.getSyncButton()!==undefined)this.getSyncButton().setWaiting(true);babelHelpers.classPrivateFieldGet(this,o).classList.add("mail-progress-show");babelHelpers.classPrivateFieldGet(this,o).classList.remove("mail-progress-hide")}},{key:"hide",value:function e(){if(this.getSyncButton()!==undefined)this.getSyncButton().setWaiting(false);babelHelpers.classPrivateFieldGet(this,o).classList.add("mail-progress-hide");babelHelpers.classPrivateFieldGet(this,o).classList.remove("mail-progress-show")}},{key:"hideErrorBox",value:function e(){babelHelpers.classPrivateFieldGet(this,d).classList.add("mail-hidden-element");babelHelpers.classPrivateFieldGet(this,d).classList.remove("mail-visible-element")}},{key:"showErrorBox",value:function e(){babelHelpers.classPrivateFieldGet(this,d).classList.add("mail-visible-element");babelHelpers.classPrivateFieldGet(this,d).classList.remove("mail-hidden-element")}}]);return e}();function f(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=m(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var r=0;var i=function e(){};return{s:i,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function t(){n=n.call(e)},n:function e(){var t=n.next();a=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!a&&n.return!=null)n.return()}finally{if(s)throw o}}}}function m(e,t){if(!e)return;if(typeof e==="string")return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}function v(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++){r[n]=e[n]}return r}var C=new WeakMap;var p=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"counters",[]);babelHelpers.defineProperty(this,"hiddenCountersForTotalCounter",[]);C.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,C,t)}babelHelpers.createClass(e,[{key:"getName",value:function e(){return babelHelpers.classPrivateFieldGet(this,C)}},{key:"setHiddenCountersForTotalCounter",value:function e(t){var n=f(t),r;try{for(n.s();!(r=n.n()).done;){var i=r.value;this.hiddenCountersForTotalCounter[i]="disabled"}}catch(e){n.e(e)}finally{n.f()}}},{key:"getTotalCounter",value:function e(){var t=0;for(var n in this.counters){if(n in this.hiddenCountersForTotalCounter){continue}t+=this.counters[n]}return t}},{key:"getCounterObjects",value:function e(){return this.counters}},{key:"getCounter",value:function e(t){return this.counters[t]}},{key:"addCounter",value:function e(t,n){this.counters[t]=Number(n);return this.counters[t]}},{key:"addCounters",value:function e(t){var n={};for(var r=0;r<t.length;r++){var a=t[r];var s=a["path"];this.addCounter(s,a["count"]);n[s]=a["count"]}var o=new i.BaseEvent({data:{counters:n,name:this.getName()}});i.EventEmitter.emit("BX.Mail.Home:updatingCounters",o)}},{key:"setCounters",value:function e(t){this.addCounters(t)}},{key:"isExists",value:function e(t){return this.counters[t]!==undefined}},{key:"increaseCounter",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(t in this.hiddenCountersForTotalCounter){return"hidden counters for total counter"}if(!this.isExists(t)){return"no counter"}this.counters[t]+=Number(n)}},{key:"lowerCounter",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(t in this.hiddenCountersForTotalCounter){return"hidden counters for total counter"}if(!this.isExists(t)){return"no counter"}var r=this.counters[t]-Number(n);if(r<0){return"negative value"}this.counters[t]=r}},{key:"updateCounters",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[{name:"counter1",count:2,increase:false,lower:true},{name:"counter2",count:2,increase:true,lower:false}];var n={};var r=false;for(var a=0;a<t.length;a++){var s=t[a];var o=s["name"];if(s["lower"]){if(this.lowerCounter(o,s["count"])==="negative value"){r=true}}if(s["increase"]&&r===false){this.increaseCounter(o,s["count"])}n[o]=this.getCounter(o)}var l=new i.BaseEvent({data:{counters:n,name:this.getName()}});i.EventEmitter.emit("BX.Mail.Home:updatingCounters",l)}}]);return e}();var b=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{dirsWithUnseenMailCounters:{},mailboxId:"",filterId:""};babelHelpers.classCallCheck(this,e);var n=document.querySelector(".mail-left-menu-wrapper");this.directoryMenu=new r.DirectoryMenu({dirsWithUnseenMailCounters:t["dirsWithUnseenMailCounters"],filterId:t["filterId"]});i.EventEmitter.subscribe("BX.Mail.Sync:newLettersArrived",function(){BX.ajax.runComponentAction("bitrix:mail.client.message.list","getDirsWithUnseenMailCounters",{mode:"class",data:{mailboxId:t["mailboxId"]}}).then(function(e){var t=e.data||{};BX.Mail.Home.Counters.setCounters(t)})});n.append(this.directoryMenu.getNode())};var M=function(){function e(t){babelHelpers.classCallCheck(this,e);this.pageCounter=t.pageCounter;this.pageCounterTitle=t.pageCounterTitle;this.mailReadAllButton=t.mailReadAllButton;this.gridId=t.gridId;this.mailboxId=t.mailboxId;this.canMarkSpam=t.canMarkSpam;this.canDelete=t.canDelete;this.ERROR_CODE_CAN_NOT_DELETE=t.ERROR_CODE_CAN_NOT_DELETE;this.ERROR_CODE_CAN_NOT_MARK_SPAM=t.ERROR_CODE_CAN_NOT_MARK_SPAM;this.disabledClassName="js-disabled";this.userInterfaceManager=new BX.Mail.Client.Message.List.UserInterfaceManager(t);this.userInterfaceManager.resetGridSelection=this.resetGridSelection.bind(this);this.userInterfaceManager.isSelectedRowsHaveClass=this.isSelectedRowsHaveClass.bind(this);this.userInterfaceManager.getGridInstance=this.getGridInstance.bind(this);this.cache={};this.addEventHandlers();BX.Mail.Client.Message.List[t.id]=this}babelHelpers.createClass(e,[{key:"addEventHandlers",value:function e(){var t=this;BX.ajax.UpdatePageData=function(){};i.EventEmitter.subscribe("onSubMenuShow",function(e){var t=e.target;var n=t.getMenuWindow().getPopupWindow().getPopupContainer();var r=null;if(n){r=BX.data(n,"grid-row-id")}BX.data(t.getSubMenu().getPopupWindow().getPopupContainer(),"grid-row-id",t.gridRowId||r)});BX.Mail.Home.LeftMenuNode.directoryMenu.setDirectory(this.getCurrentFolder());i.EventEmitter.subscribe("Mail::directoryChanged",function(){t.resetGridSelection()});i.EventEmitter.subscribe("BX.Mail.Home:updatingCounters",function(e){if(e["data"]["name"]!=="mailboxCounters"){var n=e["data"]["counters"];BX.Mail.Home.LeftMenuNode.directoryMenu.setCounters(n);var r=n[t.getCurrentFolder()];if(r!==undefined){t.changeCurrentFolderCount(r)}BX.Mail.Home.mailboxCounters.setCounters([{path:"unseenCountInCurrentMailbox",count:BX.Mail.Home.Counters.getTotalCounter()}])}else{t.userInterfaceManager.updateLeftMenuCounter()}});i.EventEmitter.subscribe("BX.DirectoryMenu:onChangeFilter",function(e){t.changeCurrentFolderCount(BX.Mail.Home.Counters.getCounter(e["data"]["directory"]))});i.EventEmitter.subscribe("BX.Main.Menu.Item:onmouseenter",function(e){var t=e.target;if(!t.dataset||!t.getMenuWindow()){return}var n=t.getMenuWindow();var r=n.getMenuItems();var i=t.dataset.path;var a=t.dataset.dirMd5;var s=t.dataset.hasChild;if(!s){return}for(var o=0;o<r.length;o++){var l=r[o];if(l.getId()===i){var u=l.hasSubMenu();if(u){l.showSubMenu();var d=l.getSubMenu();var c=false;if(d){var g=d.getMenuItems();for(var h=0;h<g.length;h++){var f=g[h];if(f.getId()==="loading"){c=true}}}if(!c){return}}this.loadLevelMenu(l,a)}}}.bind(this));var n=document.querySelectorAll(".ical-event-control-menu");for(var r=0;r<n.length;r++){n[r].addEventListener("click",this.showICalMenuDropdown.bind(this))}BX.bindDelegate(document.body,"click",{className:"ical-event-control-button"},this.onClickICalButton.bind(this))}},{key:"changeCurrentFolderCount",value:function e(t){if(t>0){this.pageCounter.textContent=t;this.pageCounterTitle.classList.remove("main-ui-hide");this.mailReadAllButton.classList.remove("main-ui-hide")}else{this.pageCounterTitle.classList.add("main-ui-hide");this.mailReadAllButton.classList.add("main-ui-hide")}}},{key:"loadLevelMenu",value:function e(t,n){var r=this.getCache(t.getId());var i=BX.Main.PopupManager.getPopupById("menu-popup-popup-submenu-"+t.getId());if(i){i.destroy()}if(r){t.destroySubMenu();t.addSubMenu(r);t.showSubMenu();return}var s={id:"loading",text:a.Loc.getMessage("MAIL_CLIENT_BUTTON_LOADING"),disabled:true};t.destroySubMenu();t.addSubMenu([s]);t.showSubMenu();BX.ajax.runComponentAction("bitrix:mail.client.config.dirs","level",{mode:"class",data:{mailboxId:this.mailboxId,dir:{path:t.getId(),dirMd5:n}}}).then(function(e){var n=e.data.dirs;var r=[];for(var i=0;i<n.length;i++){var s=/(HasChildren)/i.test(n[i].FLAGS);var o={id:n[i].PATH,text:n[i].NAME,dataset:{path:n[i].PATH,dirMd5:n[i].DIR_MD5,isDisabled:n[i].IS_DISABLED,hasChild:s},items:s?[{id:"loading",text:a.Loc.getMessage("MAIL_CLIENT_BUTTON_LOADING"),disabled:true}]:[]};r.push(o)}this.setCache(t.getId(),r);var l=BX.Main.PopupManager.getPopupById("menu-popup-popup-submenu-"+t.getId());var u=t.getMenuWindow().getPopupWindow().isShown();if(l){l.destroy()}if(u){t.destroySubMenu();t.addSubMenu(r);t.showSubMenu()}}.bind(this),function(e){}.bind(this))}},{key:"onCrmClick",value:function e(t){var n=this.getGridInstance().getRows().getSelected();var r=t?this.getGridInstance().getRows().getById(t):n[0];if(!(r&&r.node)){return}var i=this.userInterfaceManager.isAddToCrmActionAvailable(r.node);var s=r.node.querySelector("[data-message-id]");if(!(s.dataset&&s.dataset.messageId)){return}if(t===undefined){this.resetGridSelection()}if(i){if(babelHelpers.typeof(this.isAddingToCrmInProgress)!=="object"){this.isAddingToCrmInProgress={}}if(this.isAddingToCrmInProgress[t]===true){return}this.isAddingToCrmInProgress[t]=true;BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:s.dataset.messageId},analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings([r])}}).then(function(e){this.isAddingToCrmInProgress[e]=false;this.notify(a.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_ADDED_TO_CRM"))}.bind(this,t),function(e){this.isAddingToCrmInProgress[t]=false;if(e.errors&&e.errors.length>0){this.notify(e.errors.map(function(e){return e.message}).join("<br>"),5e3)}else{this.notify(a.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_ADD_TO_CRM_ERROR"))}}.bind(this))}else{BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:s.dataset.messageId},analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings([r])}}).then(function(e){this.userInterfaceManager.onCrmBindingDeleted(e.dataset.messageId);this.notify(a.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_EXCLUDED_FROM_CRM"))}.bind(this,s))}var o=this.getGridInstance().getRows().getSelectedIds();if(o.length===1&&o[0]===t){this.resetGridSelection()}}},{key:"onViewClick",value:function e(t){if(t===undefined&&this.getGridInstance().getRows().getSelectedIds().length===0){return}BX.SidePanel.Instance.open("/mail/message/"+t,{width:1080,loader:"view-mail-loader"})}},{key:"onDeleteImmediately",value:function e(t){var n={deleteImmediately:true};this.onDeleteClick(t,n)}},{key:"onDeleteClick",value:function e(t,n){var r=this.getGridInstance().getRows().getSelected();if(t===undefined&&r.length===0){return}if(!this.canDelete){this.showDirsSlider();return}var i={params:n!==undefined?n:{},keepRows:true,analyticsLabel:{groupCount:r.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:r)}};var a;if(t===undefined){a=BX.Mail.Home.Grid.getSelectedIds()}else{a=[t]}a=this.filterRowsByClassName(this.disabledClassName,a,true);i.ids=a;if(this.userInterfaceManager.isCurrentFolderTrash||n!==undefined&&n["deleteImmediately"]){var s=this.getConfirmDeletePopup(i);s.show()}else{BX.Mail.Home.Grid.hideRowByIds(a);var o=this.filterRowsByClassName("mail-msg-list-cell-unseen",a).length;BX.Mail.Home.Counters.updateCounters([{name:this.getCurrentFolder(),lower:true,count:o}]);this.runAction("delete",i,function(){return BX.Mail.Home.Grid.reloadTable()});if(t===undefined){this.resetGridSelection()}}}},{key:"onMoveToFolderClick",value:function e(t){var n=t.currentTarget.dataset;var r=undefined;var i=BX.findParent(t.currentTarget,{className:"popup-window"});if(i){r=BX.data(i,"grid-row-id")}var a=JSON.parse(n.isDisabled);var s=n.path;var o=s;if(r===undefined&&this.getGridInstance().getRows().getSelectedIds().length===0||a){return}var l=this.getGridInstance().getRows().getSelected();var u=r?[r]:this.getGridInstance().getRows().getSelectedIds();u=this.filterRowsByClassName(this.disabledClassName,u,true);if(!u.length){return}BX.onCustomEvent("Grid::updated");var d;if(r===undefined){d=BX.Mail.Home.Grid.getSelectedIds()}else{d=[r]}BX.Mail.Home.Grid.hideRowByIds(d);var c=this.filterRowsByClassName("mail-msg-list-cell-unseen",d).length;BX.Mail.Home.Counters.updateCounters([{name:o,increase:true,count:c},{name:this.getCurrentFolder(),lower:true,count:c}]);this.runAction("moveToFolder",{keepRows:true,ids:u,params:{folder:s},analyticsLabel:{groupCount:l.length,bindings:this.getRowsBindings(r?[this.getGridInstance().getRows().getById(r)]:l)}},function(){BX.Mail.Home.Grid.reloadTable()});if(r===undefined){this.resetGridSelection()}}},{key:"onReadClick",value:function e(t){var n=[];var r=[];if(t===undefined){n=this.getGridInstance().getRows().getSelected();r=this.getGridInstance().getRows().getSelectedIds()}else{var i=this.getGridInstance().getRows().getSelectedIds();if(i.length===1&&i[0]===t){n=this.getGridInstance().getRows().getSelected();r=i;t=undefined}else{r=[t]}}if(t===undefined&&n.length===0){return}var a="all"==t||this.isSelectedRowsHaveClass("mail-msg-list-cell-unseen",t)?"markAsSeen":"markAsUnseen";r=this.filterRowsByClassName("mail-msg-list-cell-unseen",r,a!=="markAsSeen");r=this.filterRowsByClassName(this.disabledClassName,r,true);if(!r.length){return}var s=function e(){this.userInterfaceManager.onMessagesRead(r,{action:a});var i=this.getCurrentFolder();var s=a!=="markAsSeen"?this.isSelectedRowsHaveClass("mail-msg-list-cell-old"):0;var o=r.length-s;if(a==="markAsSeen"){if("all"===t){o=BX.Mail.Home.Counters.getCounter(i)-s}BX.Mail.Home.Counters.updateCounters([{name:i,lower:true,count:o}])}else{BX.Mail.Home.Counters.updateCounters([{name:i,increase:true,count:o}])}if(t===undefined){this.resetGridSelection()}if("all"==t){r["for_all"]=this.mailboxId+"-"+this.userInterfaceManager.getCurrentFolder()}this.userInterfaceManager.updateUnreadCounters();this.runAction(a,{ids:r,keepRows:true,successParams:a,analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:n)},onSuccess:false});return true};s.apply(this)}},{key:"onSpamClick",value:function e(t){var n=this.getGridInstance().getRows().getSelected();if(t===undefined&&n.length===0){return}if(!this.canMarkSpam){this.showDirsSlider();return}var r=this.isSelectedRowsHaveClass("js-spam",t)?"restoreFromSpam":"markAsSpam";var i=this.filterRowsByClassName("js-spam",t,r!=="restoreFromSpam");i=this.filterRowsByClassName(this.disabledClassName,i,true);if(!i.length){return}var a={keepRows:true,analyticsLabel:{groupCount:n.length,bindings:this.getRowsBindings(t?[this.getGridInstance().getRows().getById(t)]:n)}};var s;if(t===undefined){s=BX.Mail.Home.Grid.getSelectedIds()}else{s=[t]}a.ids=s;BX.Mail.Home.Grid.hideRowByIds(s);var o=this.filterRowsByClassName("mail-msg-list-cell-unseen",s).length;if(r==="markAsSpam"){BX.Mail.Home.Counters.updateCounters([{name:this.userInterfaceManager.spamDir,increase:true,count:o},{name:this.getCurrentFolder(),lower:true,count:o}])}else{BX.Mail.Home.Counters.updateCounters([{name:this.userInterfaceManager.spamDir,lower:true,count:o},{name:this.userInterfaceManager.inboxDir,increase:true,count:o}])}this.runAction(r,a,function(){return BX.Mail.Home.Grid.reloadTable()});if(t===undefined){this.resetGridSelection()}}},{key:"getConfirmDeletePopup",value:function e(t){return new BX.UI.Dialogs.MessageBox({title:a.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_TITLE"),message:a.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_DELETE"),buttons:[new BX.UI.Button({color:BX.UI.Button.Color.DANGER,text:a.Loc.getMessage("MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN"),onclick:function(e){var n=this.filterRowsByClassName("mail-msg-list-cell-unseen",t.ids).length;BX.Mail.Home.Counters.updateCounters([{name:this.getCurrentFolder(),lower:true,count:n}]);this.runAction("delete",t,function(){return BX.Mail.Home.Grid.reloadTable()});e.getContext().close();BX.Mail.Home.Grid.hideRowByIds(t.ids)}.bind(this)}),new BX.UI.CancelButton({onclick:function e(t){t.getContext().close()}})]})}},{key:"resetGridSelection",value:function e(){BX.onCustomEvent("Mail::resetGridSelection");this.getGridInstance().getRows().unselectAll();this.getGridInstance().adjustCheckAllCheckboxes();BX.Mail.Home.Grid.hidePanel()}},{key:"isSelectedRowsHaveClass",value:function e(t,n){var r;if(n===undefined){r=this.getGridInstance().getRows().getSelectedIds()}else{r=[n]}var i=r.length?r:n?[n]:[];var a=0;for(var s=0;s<i.length;s++){var o=this.getGridInstance().getRows().getById(i[s]);if(o&&o.node){var l=o.node.getElementsByClassName(t);if(l&&l.length){a++}}}return a}},{key:"filterRowsByClassName",value:function e(t,n,r){var i=[];if("all"==n){i=this.getGridInstance().getRows().getBodyChild().map(function(e){return e.getId()})}else if(Array.isArray(n)){i=n}else{var a=this.getGridInstance().getRows().getSelectedIds();i=a.length?a:n?[n]:[]}var s=[];for(var o=i.length-1;o>=0;o--){var l=this.getGridInstance().getRows().getById(i[o]);if(l&&l.node){var u=l.node.getElementsByClassName(t);if(!r&&u&&u.length){s.push(i[o])}else if(r&&!(u&&u.length)){s.push(i[o])}}}return s}},{key:"notify",value:function e(t,n){top.BX.UI.Notification.Center.notify({autoHideDelay:n>0?n:2e3,content:t?t:a.Loc.getMessage("MAIL_MESSAGE_LIST_NOTIFY_SUCCESS")})}},{key:"runAction",value:function e(t,n,r){n=n?n:{};var i=[];if(n.ids){i=n.ids}if(!i.length&&!i.for_all){return}if(!n.keepRows){this.getGridInstance().tableFade()}var a={ids:i};if(n.params){var s=Object.keys(Object(n.params));for(var o=0,l=s.length;o<l;o++){var u=s[o];var d=Object.getOwnPropertyDescriptor(n.params,u);if(d!==undefined&&d.enumerable){a[u]=n.params[u]}}}BX.ajax.runComponentAction("bitrix:mail.client",t,{mode:"ajax",data:a,analyticsLabel:n.analyticsLabel}).then(function(){if(n.onSuccess===false){return}if(n.onSuccess&&typeof n.onSuccess==="function"){n.onSuccess.bind(this,i,n.successParams)();return}if(r===undefined){this.notify()}else{r()}}.bind(this),function(e){n.onError&&typeof n.onError==="function"?n.onError().bind(this,e):this.onErrorRequest(e)}.bind(this))}},{key:"onErrorRequest",value:function e(t){var n={};this.checkErrorRights(t.errors);n.errorMessage=t.errors[0].message}},{key:"checkErrorRights",value:function e(t){for(var n=0;n<t.length;n++){if(t[n].code===this.ERROR_CODE_CAN_NOT_DELETE){this.canDelete=false}if(t[n].code===this.ERROR_CODE_CAN_NOT_MARK_SPAM){this.canMarkSpam=false}}}},{key:"showDirsSlider",value:function e(){var t=BX.util.add_url_param("/mail/config/dirs",{mailboxId:this.mailboxId});BX.SidePanel.Instance.open(t,{width:640,cacheable:false,allowChangeHistory:false});this.canDelete=true;this.canMarkSpam=true}},{key:"onDisabledGroupActionClick",value:function e(){}},{key:"onUnreadCounterClick",value:function e(){this.userInterfaceManager.onUnreadCounterClick()}},{key:"getCurrentFolder",value:function e(){return this.userInterfaceManager.getCurrentFolder()}},{key:"getGridInstance",value:function e(){return BX.Main.gridManager.getById(this.gridId).instance}},{key:"getRowsBindings",value:function e(t){return BX.util.array_unique(Array.prototype.concat.apply([],t.map(function(e){if(!e||!e.node){return null}return Array.prototype.map.call(e.node.querySelectorAll('[class^="js-bind-"] [data-type]'),function(e){return e.dataset.type})})))}},{key:"getCache",value:function e(t){if(!t){return}return this.cache[t]?this.cache[t]:null}},{key:"setCache",value:function e(t,n){return this.cache[t]=n}},{key:"showICalMenuDropdown",value:function e(t){t.stopPropagation();t.preventDefault();var n=t.currentTarget.dataset.menu;if(!n){return}this.iCalMenuDropdown=BX.Main.MenuManager.create({id:"mail-client-message-list-ical-dropdown-menu",autoHide:true,closeByEsc:true,items:JSON.parse(n),zIndex:7001,maxHeight:400,maxWidth:200,angle:{position:"top",offset:40},events:{onPopupClose:function(){this.removeICalMenuDropdown()}.bind(this)}});this.iCalMenuDropdown.popupWindow.setBindElement(t.currentTarget);this.iCalMenuDropdown.show()}},{key:"removeICalMenuDropdown",value:function e(){if(this.iCalMenuDropdown){BX.Main.MenuManager.destroy(this.iCalMenuDropdown.id)}}},{key:"onClickICalButton",value:function e(t){t.stopPropagation();t.preventDefault();var n=t.target.dataset.messageid||t.target.parentNode.dataset.messageid;var r=t.target.dataset.action||t.target.parentNode.dataset.action;var i=t.target;i.classList.add("ui-btn-wait");this.removeICalMenuDropdown();this.sendICal(n,r).then(function(){i.classList.remove("ui-btn-wait");this.notify(a.Loc.getMessage(r==="cancelled"?"MAIL_MESSAGE_ICAL_NOTIFY_REJECT":"MAIL_MESSAGE_ICAL_NOTIFY_ACCEPT"))}.bind(this)).catch(function(){i.classList.remove("ui-btn-wait");this.notify(a.Loc.getMessage("MAIL_MESSAGE_ICAL_NOTIFY_ERROR"))}.bind(this))}},{key:"sendICal",value:function e(t,n){return new Promise(function(e,r){BX.ajax.runComponentAction("bitrix:mail.client","ical",{mode:"ajax",data:{messageId:t,action:n}}).then(function(){e()}.bind(this),function(){r()}.bind(this))})}}]);return e}();var I=a.Reflection.namespace("BX.Mail.Home");i.EventEmitter.subscribe("SidePanel.Slider:onMessage",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),r=n[0];if(r.getEventId()==="mail-mailbox-config-success"){BXMailMailbox.sync(I.ProgressBar,I.Grid.getId(),false,true)}});var y;var w;var S;var B;var E={};a.Event.ready(function(){B=document.querySelector('[data-role="mail-msg-sync-button-wrapper"]');var e=new s.Button({className:"ui-btn ui-btn-themes ui-btn-light-border mail-msg-sync-button",icon:s.Button.Icon.BUSINESS,props:{title:a.Loc.getMessage("MAIL_MESSAGE_SYNC_BTN_HINT")},onclick:function e(){BXMailMailbox.sync(I.ProgressBar,a.Loc.getMessage("MAIL_MESSAGE_GRID_ID"),false,true)}});B.append(e.getContainer());i.EventEmitter.subscribe("BX.Main.Grid:onBeforeReload",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),r=n[0];if(r!=={}&&r!==undefined&&a.Loc.getMessage("MAIL_MESSAGE_GRID_ID")===r.getId()){E=r.getRows().getSelectedIds()}});i.EventEmitter.subscribe("Grid::updated",function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),r=n[0];if(r!=={}&&r!==undefined&&a.Loc.getMessage("MAIL_MESSAGE_GRID_ID")===r.getId()){var s=false;I.Grid.getRows().map(function(e){if(a.Type.isFunction(E.indexOf)&&E.indexOf(e.getId())!==-1){if(e.isShown()){e.select();s=true}}});E={};if(s){setTimeout(function(){i.EventEmitter.emit(window,"Grid::thereSelectedRows")},0)}}});t.Avatar.replaceTagsWithAvatars({className:"mail-ui-avatar"});y=document.getElementsByClassName("ui-slider-page")[0];w=document.querySelector('[data-role="mail-progress-bar"]');y.insertBefore(w,y.firstChild);S=document.querySelector('[data-role="error-box"]');I.ProgressBar=new h(w);I.unreadMessageMailboxesMarker=document.querySelector('[data-role="unreadMessageMailboxesMarker"]');I.ProgressBar.setSyncButton(e);I.ProgressBar.setErrorBoxNode(document.querySelector('[data-role="error-box"]'));I.ProgressBar.setErrorTextNode(document.querySelector('[data-role="error-box-text"]'));I.ProgressBar.setErrorHintNode(document.querySelector('[data-role="error-box-hint"]'));I.ProgressBar.setErrorTitleNode(document.querySelector('[data-role="error-box-title"]'))});I.Counters=new p;I.mailboxCounters=new p("mailboxCounters");I.Grid=new n.MessageGrid;I.LeftMenu=b;var R=a.Reflection.namespace("BX.Mail.Client.Message");R.List=M})(this.window=this.window||{},BX.Mail,BX.Mail,BX.Mail,BX.Event,BX,BX.UI);
//# sourceMappingURL=script.map.js