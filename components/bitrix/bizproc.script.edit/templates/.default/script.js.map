{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Tag, Dom, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {UI} from 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Bizproc');\n\nconst toJsonString = function(data)\n{\n\treturn JSON.stringify(data, (i, v) => {\n\t\tif (typeof(v) === 'boolean')\n\t\t{\n\t\t\treturn v ? '1' : '0';\n\t\t}\n\t\treturn v;\n\t});\n}\n\nclass ScriptEditComponent\n{\n\tbaseNode;\n\tleftMenuNode;\n\tsaveButtonNode;\n\tformNode;\n\tscriptNameNode;\n\tdocumentType;\n\tsignedParameters;\n\tautomationDesigner;\n\tsaveCallback;\n\tconfigsMenuItem;\n\n\tconstantPrefix = 'Constant__';\n\tparameterPrefix = 'Parameter__';\n\n\tconstructor(options)\n\t{\n\t\tif(Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.baseNode = options.baseNode;\n\t\t\tthis.leftMenuNode = options.leftMenuNode;\n\t\t\tthis.saveButtonNode = options.saveButtonNode;\n\t\t\tthis.formNode = options.formNode;\n\t\t\tthis.documentType = options.documentType;\n\t\t\tthis.signedParameters = options.signedParameters;\n\t\t\tthis.saveCallback = options.saveCallback\n\t\t}\n\t\tthis.automationDesigner = BX.Bizproc.Automation.Designer.getInstance().component;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.saveButtonNode)\n\t\t{\n\t\t\tEvent.bind(this.saveButtonNode, 'click', this.saveHandler.bind(this));\n\t\t}\n\t\tif (this.baseNode && this.leftMenuNode)\n\t\t{\n\t\t\tthis.initMenu();\n\t\t}\n\n\t\tif (this.formNode)\n\t\t{\n\t\t\tthis.scriptNameNode = this.formNode.elements.NAME;\n\t\t\tEvent.bind(this.scriptNameNode, 'blur', () => {\n\t\t\t\tif (!Type.isStringFilled(this.scriptNameNode.value))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.scriptNameNode.closest('.ui-ctl'), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.scriptNameNode.closest('.ui-ctl'), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.automationDesigner)\n\t\t{\n\t\t\tEventEmitter.subscribe(this.automationDesigner, 'onTemplateConstantAdd', () => {\n\t\t\t\tif (this.configsMenuItem)\n\t\t\t\t{\n\t\t\t\t\tthis.configsMenuItem.addNoticeIcon();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsaveHandler()\n\t{\n\t\tconst form = new FormData(this.formNode);\n\t\tconst scriptFields = {};\n\t\tfor (let field of form.entries())\n\t\t{\n\t\t\tscriptFields[field[0]] = field[1];\n\t\t}\n\n\t\tif (!this.#validateScriptName(scriptFields.NAME))\n\t\t{\n\t\t\tDom.removeClass(this.saveButtonNode, 'ui-btn-wait');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\t\tthis.setTemplateValues(robotsTemplate);\n\n\t\tif (!this.#validateConstants(robotsTemplate.getConstants(), robotsTemplate.collectUsages().Constant))\n\t\t{\n\t\t\tDom.removeClass(this.saveButtonNode, 'ui-btn-wait');\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.ajax.runComponentAction('bitrix:bizproc.script.edit', 'saveScript', {\n\t\t\tanalyticsLabel: scriptFields.ID > 0 ? 'bizprocScriptUpdate' : 'bizprocScriptAdd',\n\t\t\tdata: {\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdocumentType: this.documentType,\n\t\t\t\tscript: scriptFields,\n\t\t\t\trobotsTemplate: toJsonString(robotsTemplate.serialize())\n\t\t\t}\n\t\t}).then((result) =>\n\t\t{\n\t\t\tif (result.status === 'success' && !Type.isArrayFilled(result.errors))\n\t\t\t{\n\t\t\t\trobotsTemplate.markModified(false);\n\t\t\t}\n\n\t\t\tif (Type.isFunction(this.saveCallback))\n\t\t\t{\n\t\t\t\tthis.saveCallback(result);\n\t\t\t}\n\t\t});\n\t}\n\n\t#getRobotsTemplate()\n\t{\n\t\treturn this.automationDesigner.templateManager.templates[0];\n\t}\n\n\t#activateSection(section: string): void\n\t{\n\t\tif (BX.UI.DropdownMenuItem.getItemByNode)\n\t\t{\n\t\t\tconst menuItem = BX.UI.DropdownMenuItem.getItemByNode(this.leftMenuNode.querySelector(`[data-page=\"${section}\"]`));\n\n\t\t\tthis.menuActivateHandler(section);\n\t\t\tmenuItem && menuItem.setActiveHandler();\n\t\t}\n\n\t\tif (section === 'general')\n\t\t{\n\t\t\tthis.scriptNameNode.focus();\n\t\t}\n\t\tif (section !== 'configs')\n\t\t{\n\t\t\tthis.setTemplateValues(this.#getRobotsTemplate());\n\t\t}\n\t}\n\n\t#validateScriptName(name: string): boolean\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_EDIT_VALIDATION_EMPTY_NAME')\n\t\t\t});\n\n\t\t\tthis.#activateSection('general');\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t#validateConstants(constants: [], usedConstants: Set): boolean\n\t{\n\t\tlet result = true;\n\n\t\tconstants.forEach((constant) => {\n\t\t\tif (usedConstants.has(constant.Id) && !Type.isStringFilled(constant.Default))\n\t\t\t{\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t});\n\n\t\tif (!result)\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_EDIT_VALIDATION_EMPTY_CONFIGS')\n\t\t\t});\n\n\t\t\tthis.#activateSection('configs');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinitMenu()\n\t{\n\t\tArray.from(this.leftMenuNode.querySelectorAll('[data-role=\"menu-item\"]')).forEach((el) =>\n\t\t{\n\t\t\tEvent.bind(el, 'click', this.menuActivateHandler.bind(this, el.getAttribute('data-page')));\n\n\t\t\tif (el.getAttribute('data-page') === 'configs' && BX.UI.DropdownMenuItem.getItemByNode)\n\t\t\t{\n\t\t\t\tthis.configsMenuItem = BX.UI.DropdownMenuItem.getItemByNode(el);\n\t\t\t}\n\t\t});\n\t}\n\n\tmenuActivateHandler(page)\n\t{\n\t\tArray.from(this.baseNode.querySelectorAll('[data-section]')).forEach((el) =>\n\t\t\t{\n\t\t\t\tif (el.getAttribute('data-section') === page)\n\t\t\t\t{\n\t\t\t\t\tif (page === 'configs' && Dom.hasClass(el,'bizproc-script-edit-block-hidden'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showConfigsHandler(el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTemplateValues(this.#getRobotsTemplate());\n\t\t\t\t\t}\n\t\t\t\t\tDom.removeClass(el, 'bizproc-script-edit-block-hidden')\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(el, 'bizproc-script-edit-block-hidden');\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tshowConfigsHandler(configsNode)\n\t{\n\t\tDom.clean(configsNode);\n\n\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\t\tconst constants = robotsTemplate.getConstants();\n\t\tconst parameters = robotsTemplate.getParameters();\n\t\tconst robotNodes = [];\n\n\t\trobotsTemplate.robots.forEach((robot) => {\n\t\t\tconst node = this.renderRobotConfigBlock(robot, constants, parameters);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\trobotNodes.push(node);\n\t\t\t}\n\t\t});\n\n\t\tif (robotNodes.length)\n\t\t{\n\t\t\tDom.append(Tag.render`<form data-role=\"constant-list\" onsubmit=\"return false;\">${robotNodes}</form>`, configsNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Dom.append(\n\t\t\t\tTag.render`<div class=\"ui-alert ui-alert-default ui-alert-xs ui-alert-icon-info\">\n\t\t\t\t\t<span class=\"ui-alert-message\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_SECTION_CONFIGS_EMPTY')}</span>\n\t\t\t\t</div>`,\n\t\t\t\tconfigsNode\n\t\t\t);\n\t\t}\n\t}\n\n\trenderRobotConfigBlock(robot, constants, parameters): ?HTMLElement\n\t{\n\t\tconst usages = robot.collectUsages();\n\t\tconst itemNodes = [];\n\n\t\tif (usages.Constant.size)\n\t\t{\n\t\t\tlet headPushed = false;\n\t\t\tusages.Constant.forEach((constId) => {\n\t\t\t\tconst constant = constants.find((c) => c.Id === constId && c.Type !== 'file');\n\t\t\t\tif (constant)\n\t\t\t\t{\n\t\t\t\t\tif (!headPushed)\n\t\t\t\t\t{\n\t\t\t\t\t\titemNodes.push(Tag.render`<div class=\"bizproc-script-edit-item\">\n\t\t\t\t\t\t\t<div class=\"bizproc-script-edit-title\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_CONSTANT_LABEL')}</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-script-edit-text\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_CONSTANT_DESCRIPTION')}</div>\n\t\t\t\t\t\t</div>`);\n\t\t\t\t\t\theadPushed = true;\n\t\t\t\t\t}\n\n\t\t\t\t\titemNodes.push(this.renderPropertyBlock(constant, this.constantPrefix));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (usages.Parameter.size)\n\t\t{\n\t\t\tlet headPushed = false;\n\t\t\tusages.Parameter.forEach((paramId) => {\n\t\t\t\tconst parameter = parameters.find((p) => p.Id === paramId && p.Type !== 'file');\n\t\t\t\tif (parameter)\n\t\t\t\t{\n\t\t\t\t\tif (!headPushed)\n\t\t\t\t\t{\n\t\t\t\t\t\titemNodes.push(Tag.render`<div class=\"bizproc-script-edit-item\">\n\t\t\t\t\t\t\t<div class=\"bizproc-script-edit-title\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_PARAMETER_LABEL')}</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-script-edit-text\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_PARAMETER_DESCRIPTION')}</div>\n\t\t\t\t\t\t</div>`);\n\t\t\t\t\t\theadPushed = true;\n\t\t\t\t\t}\n\t\t\t\t\titemNodes.push(this.renderPropertyBlock(parameter, this.parameterPrefix));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!itemNodes.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t<div class=\"ui-slider-heading-4 ui-slider-heading-4--bizproc-icon\">${Text.encode(robot.getTitle())}</div>\n\t\t\t\t${itemNodes}\n\t\t\t</div>`\n\t\t;\n\t}\n\n\trenderPropertyBlock(property: {}, prefix: string)\n\t{\n\t\tconst control = BX.Bizproc.FieldType.renderControlPublic(\n\t\t\tthis.automationDesigner.document.getRawType(),\n\t\t\tproperty,\n\t\t\tprefix + property.Id,\n\t\t\tproperty.Default,\n\t\t\tfalse\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-script-edit-item\">\n\t\t\t\t<div class=\"bizproc-script-edit-subtitle\">${Text.encode(property.Name)}</div>\n\t\t\t\t<div class=\"bizproc-script-edit-text\">${Text.encode(property.Description)}</div>\n\t\t\t\t<a onclick=\"${this.changePropertyDescription.bind(this, prefix, property)}\" class=\"ui-link ui-link-secondary ui-link-dashed\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_BTN_CHANGE')}</a>\n\t\t\t\t<div class=\"bizproc-script-edit-field\">\n\t\t\t\t\t${control}\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t;\n\t}\n\n\tchangePropertyDescription(prefix, property, event)\n\t{\n\t\tconst element = event.currentTarget;\n\t\tconst wrapper = element.previousElementSibling;\n\n\t\tDom.hide(element);\n\n\t\tconst inputElement = Tag.render`\n\t\t\t<input value=\"\" type=\"text\" class=\"ui-ctl-element\">\n\t\t`;\n\n\t\tinputElement.value = property.Description || '';\n\n\t\tDom.clean(wrapper);\n\t\tDom.append(inputElement, wrapper);\n\t\tinputElement.focus();\n\n\t\tconst applyNewDescription = () =>\n\t\t{\n\t\t\tconst text = inputElement.value.trim();\n\n\t\t\tproperty.Description = text;\n\t\t\tDom.clean(wrapper);\n\t\t\twrapper.textContent = text;\n\t\t\tDom.show(element);\n\n\t\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\n\t\t\tif (prefix === this.constantPrefix)\n\t\t\t{\n\t\t\t\trobotsTemplate.updateConstant(property.Id, property);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trobotsTemplate.updateParameter(property.Id, property);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(inputElement, 'blur', applyNewDescription);\n\t\tEvent.bind(inputElement, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tEvent.unbind(inputElement, 'blur', applyNewDescription);\n\t\t\t\tapplyNewDescription();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetTemplateValues(template): void\n\t{\n\t\tconst formNode = this.baseNode? this.baseNode.querySelector('[data-role=\"constant-list\"]') : null;\n\t\tif (!formNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst form = new FormData(formNode);\n\n\t\ttemplate.getConstants().forEach((constant) => {\n\t\t\ttemplate.setConstantValue(constant.Id, form.get(this.constantPrefix+constant.Id));\n\t\t});\n\n\t\ttemplate.getParameters().forEach((param) => {\n\t\t\ttemplate.setParameterValue(param.Id, form.get(this.parameterPrefix+param.Id));\n\t\t});\n\t}\n}\n\nnamespace.ScriptEditComponent = ScriptEditComponent;"],"names":["namespace","Reflection","toJsonString","data","JSON","stringify","i","v","ScriptEditComponent","options","Type","isPlainObject","baseNode","leftMenuNode","saveButtonNode","formNode","documentType","signedParameters","saveCallback","automationDesigner","BX","Bizproc","Automation","Designer","getInstance","component","Event","bind","saveHandler","initMenu","scriptNameNode","elements","NAME","isStringFilled","value","Dom","addClass","closest","removeClass","EventEmitter","subscribe","configsMenuItem","addNoticeIcon","form","FormData","scriptFields","entries","field","robotsTemplate","setTemplateValues","getConstants","collectUsages","Constant","ajax","runComponentAction","analyticsLabel","ID","script","serialize","then","result","status","isArrayFilled","errors","markModified","isFunction","Array","from","querySelectorAll","forEach","el","menuActivateHandler","getAttribute","UI","DropdownMenuItem","getItemByNode","page","hasClass","showConfigsHandler","configsNode","clean","constants","parameters","getParameters","robotNodes","robots","robot","node","renderRobotConfigBlock","push","length","append","Tag","render","Loc","getMessage","usages","itemNodes","size","headPushed","constId","constant","find","c","Id","renderPropertyBlock","constantPrefix","Parameter","paramId","parameter","p","parameterPrefix","Text","encode","getTitle","property","prefix","control","FieldType","renderControlPublic","document","getRawType","Default","Name","Description","changePropertyDescription","event","element","currentTarget","wrapper","previousElementSibling","hide","inputElement","focus","applyNewDescription","text","trim","textContent","show","updateConstant","updateParameter","keyCode","unbind","template","querySelector","setConstantValue","get","param","setParameterValue","templateManager","templates","section","menuItem","setActiveHandler","name","Notification","Center","notify","content","usedConstants","has"],"mappings":"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"}