(function(e,t,n,a){"use strict";function i(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a href="','" class="sidebar-widget-item">\n\t\t\t\t<span class="calendar-item-date">','</span>\n\t\t\t\t<span class="calendar-item-text">\n\t\t\t\t\t<span class="calendar-item-link">','</span>\n\t\t\t\t</span>\n\t\t\t\t<span class="calendar-item-icon">\n\t\t\t\t\t<span class="calendar-item-icon-day">','</span>\n\t\t\t\t\t<span class="calendar-item-icon-date">',"</span>\n\t\t\t\t</span>\n\t\t\t</a>\n\t\t"]);i=function t(){return e};return e}var r=function(){function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"DOM",{});this.maxEntryAmount=n.maxEntryAmount||5;if(n&&n.entries){this.renderList(n.entries)}else{this.displayEventList()}a.EventEmitter.subscribe("onPullEvent-calendar",t.Runtime.debounce(this.displayEventList,3e3,this))}babelHelpers.createClass(e,[{key:"displayEventList",value:function e(){var t=this;this.showLoader();this.getEventList().then(function(e){t.hideLoader();t.renderList(e)})}},{key:"getEventList",value:function e(){var t=this;return new Promise(function(e){BX.ajax.runAction("calendar.api.calendarentryajax.getnearestevents",{data:{ownerId:t.ownerId,type:t.type,futureDaysAmount:60,maxEntryAmount:t.maxEntryAmount}}).then(function(t){var n;e(t===null||t===void 0?void 0:(n=t.data)===null||n===void 0?void 0:n.entries)})})}},{key:"showWidget",value:function e(){this.getOuterWrap().style.display=""}},{key:"hideWidget",value:function e(){this.getOuterWrap().style.display="none"}},{key:"showLoader",value:function e(){this.hideLoader();this.DOM.loader=this.getEventListWrap().appendChild(n.Util.getLoader(40,"next-events-loader"))}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader)}}},{key:"renderList",value:function e(){var n=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!t.Type.isArray(a)){a=[]}a=a.slice(0,this.maxEntryAmount);t.Dom.clean(this.getEventListWrap());var i=this.getEventListWrap();a.forEach(function(e,t){if(t===0){n.setReloadTimeout(e)}i.appendChild(n.renderEntry(e))});if(a.length){this.showWidget()}else{this.hideWidget()}}},{key:"renderEntry",value:function e(n){var a=BX.Calendar.Util.parseDate(n["DATE_FROM"]);return t.Tag.render(i(),t.Text.encode(n["~URL"]),n["~FROM_TO_HTML"],t.Text.encode(n["NAME"]),t.Text.encode(n["~WEEK_DAY"]),a.getDate())}},{key:"getOuterWrap",value:function e(){if(!this.DOM.outerWrap){this.DOM.outerWrap=document.querySelector(".sidebar-widget.sidebar-widget-calendar")}return this.DOM.outerWrap}},{key:"getEventListWrap",value:function e(){if(!this.DOM.listWrap){this.DOM.listWrap=this.getOuterWrap().querySelector(".calendar-events-wrap")}return this.DOM.listWrap}},{key:"setReloadTimeout",value:function e(n){if(this.reloadTimeout){clearTimeout(this.reloadTimeout);this.reloadTimeout=null}var a=BX.Calendar.Util.parseDate(n["DATE_TO"]);if(t.Type.isDate(a)){var i=new Date;var r=Math.min(Math.max(a.getTime()-i.getTime()+6e4,6e4),864e5);this.reloadTimeout=setTimeout(this.displayEventList.bind(this),r)}}}]);return e}();t.Reflection.namespace("BX.Calendar").NextEventList=r})(this.window=this.window||{},BX,BX.Calendar,BX.Event);
//# sourceMappingURL=script.map.js