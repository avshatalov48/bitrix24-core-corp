(function(e){e.EditEventManager=function(e){this.config=e;this.id=this.config.id;this.bAMPM=this.config.bAMPM;this.dayLength=864e5;this.plannerId="calendarLiveFeedPlanner";this.ajaxAction="/bitrix/components/bitrix/calendar.livefeed.edit/ajax_action.php";this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));else this.TIME_FORMAT=BX.date.convertBitrixFormat(this.bAMPM?"H:MI:SS T":"HH:MI:SS");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.bFullDay=false;this.bReminder=false;this.bAdditional=false;this.locationName="EVENT_LOCATION";var t=this;BX.addCustomEvent("onCalendarLiveFeedShown",function(){t.Init();t.defaultValues={remind:{count:15,type:"min"}};t.config.arEvent=t.HandleEvent(t.config.arEvent);t.ShowFormData(t.config.arEvent)})};e.EditEventManager.prototype={Init:function(){var t=this;this.pFromToCont=BX("feed-cal-from-to-cont"+this.id);this.pFromDate=BX("feed-cal-event-from"+this.id);this.pToDate=BX("feed-cal-event-to"+this.id);this.pFromTime=BX("feed_cal_event_from_time"+this.id);this.pToTime=BX("feed_cal_event_to_time"+this.id);this.pFullDay=BX("event-full-day"+this.id);this.pDefTimezone=BX("feed-cal-tz-def"+this.id);this.pDefTimezoneWrap=BX("feed-cal-tz-def-wrap"+this.id);this.pFromTz=BX("feed-cal-tz-from"+this.id);this.pToTz=BX("feed-cal-tz-to"+this.id);this.pDefTimezone.onchange=BX.proxy(this.DefaultTimezoneOnChange,this);this.pTzOuterCont=BX("feed-cal-tz-cont-outer"+this.id);this.pTzSwitch=BX("feed-cal-tz-switch"+this.id);this.pTzCont=BX("feed-cal-tz-cont"+this.id);this.pTzInnerCont=BX("feed-cal-tz-inner-cont"+this.id);this.pTzSwitch.onclick=BX.proxy(this.TimezoneSwitch,this);this.pFromTz.onchange=BX.proxy(this.TimezoneFromOnChange,this);this.pToTz.onchange=BX.proxy(this.TimezoneToOnChange,this);new BX.CHint({parent:BX("feed-cal-tz-tip"+this.id),hint:t.config.message.eventTzHint});new BX.CHint({parent:BX("feed-cal-tz-def-tip"+this.id),hint:t.config.message.eventTzDefHint});this.pReminderCont=BX("feed-cal-reminder-cont"+this.id);this.pReminder=BX("event-reminder"+this.id);this.pEventName=BX("feed-cal-event-name"+this.id);this.pForm=this.pEventName.form;this.pLocation=BX("event-location"+this.id);this.pImportance=BX("event-importance"+this.id);this.pAccessibility=BX("event-accessibility"+this.id);this.pSection=BX("event-section"+this.id);this.pRemCount=BX("event-remind_count"+this.id);this.pRemType=BX("event-remind_type"+this.id);this.pPlannerBlock=BX("event-planner-block"+this.id);this.pPlannerTitle=BX("event-planner-block-title"+this.id);this.pPlannerLinkWrap=BX("event-planner-expand-link-wrap"+this.id);BX.bind(this.pPlannerBlock,"click",BX.proxy(this.ExpandPlanner,this));this.pPlannerProposeLink=BX("event-planner-propose-link"+this.id);BX.bind(this.pPlannerProposeLink,"click",BX.proxy(this.ProposeTime,this));if(this.config.meetingRooms){this.Location=new BXInputPopup({id:this.id+"_loc_mr",values:this.config.meetingRooms,input:this.pLocation,defaultValue:this.config.message.SelectMR,openTitle:this.config.message.OpenMRPage,className:"calendar-inp calendar-inp-time calendar-inp-loc",noMRclassName:"calendar-inp calendar-inp-time calendar-inp-loc"});this.Loc={};BX.addCustomEvent(this.Location,"onInputPopupChanged",BX.proxy(this.LocationOnChange,this));BX.addClass(this.pLocation,"calendar-inp-time");this.Location.Set(false,"")}this.pFullDay.onclick=BX.proxy(this.FullDay,this);this.pReminder.onclick=BX.proxy(this.Reminder,this);BX.bind(this.pFullDay,"click",BX.proxy(this.RefreshPlannerState,this));BX.bind(this.pForm,"submit",BX.proxy(this.OnSubmit,this));BX("feed-cal-additional-show").onclick=BX("feed-cal-additional-hide").onclick=BX.proxy(this.ShowAdditionalParams,this);this.InitDateTimeControls();var i=e["BXHtmlEditor"].Get(this.config.editorId);if(i&&i.IsShown()){this.CustomizeHtmlEditor(i)}else{BX.addCustomEvent(e["BXHtmlEditor"],"OnEditorCreated",function(e){if(e.id==t.config.editorId){t.CustomizeHtmlEditor(e)}})}this.pRepeat=BX("event-repeat"+this.id);this.pRepeatDetails=BX("event-repeat-details"+this.id);this.RepeatEndsOnNever=BX(this.id+"event-endson-never");this.RepeatEndsOnCount=BX(this.id+"event-endson-count");this.RepeatEndsOnUntil=BX(this.id+"event-endson-until");this.RepeatDiapTo=BX("event-repeat-to"+this.id);this.RepeatCountInp=BX(this.id+"event-endson-count-input");this.pRepeat.onchange=function(){var e=this.value;t.pRepeatDetails.className="feed-cal-repeat-details feed-cal-repeat-details-"+e.toLowerCase()};this.pRepeat.onchange();BX.bind(this.RepeatEndsOnNever,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatEndsOnCount,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatEndsOnUntil,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatDiapTo,"click",BX.proxy(function(){this.RepeatEndsOnUntil.checked="checked";BX.calendar({node:this.RepeatDiapTo,field:this.RepeatDiapTo,bTime:false});BX.focus(this.RepeatDiapTo);this.EndsOnChange()},this));BX.bind(this.RepeatCountInp,"click",BX.proxy(function(){this.RepeatEndsOnCount.checked="checked";BX.focus(this.RepeatCountInp);this.EndsOnChange()},this));this.eventNode=BX("div"+this.config.editorId);if(this.eventNode){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow"])}BX.addCustomEvent("OnDestinationLivefeedChanged",BX.proxy(this.CheckPlannerState,this));BX.addCustomEvent("OnCalendarPlannerSelectorChanged",function(e){t.pFromDate.value=t.FormatDate(e.dateFrom);t.pFromTime.value=t.FormatTime(e.dateFrom);t.pToDate.value=t.FormatDate(e.dateTo);t.pToTime.value=t.FormatTime(e.dateTo);t.pFullDay.checked=e.fullDay;t.FullDay(false,!e.fullDay)});BX.addCustomEvent("OnCalendarPlannerScaleChanged",function(e){t.UpdatePlanner({entrieIds:e.entrieIds,entries:e.entries,from:e.from,to:e.to,location:t.Loc?t.Loc.NEW:t.pLocation.value,focusSelector:e.focusSelector===true,params:e.params})});setTimeout(function(){BX.bind(e,"resize",BX.proxy(t.OnResize,t))},200)},EndsOnChange:function(){if(this.RepeatEndsOnNever.checked){this.RepeatCountInp.value="";this.RepeatDiapTo.value=""}else if(this.RepeatEndsOnCount.checked){this.RepeatDiapTo.value="";if(!this.RepeatCountInp.value)this.RepeatCountInp.value=this.RepeatCountInp.placeholder;BX.focus(this.RepeatCountInp);this.RepeatCountInp.select()}else{this.RepeatCountInp.value="";BX.focus(this.RepeatDiapTo);this.RepeatDiapTo.select()}},OnResize:function(){var e=this.pPlannerBlock&&BX.hasClass(this.pPlannerBlock,"feed-event-planner-block-shown");if(e){var t=this.pPlannerBlock.offsetWidth-this.pPlannerTitle.offsetWidth-this.pPlannerLinkWrap.offsetWidth-80;if(this.pPlannerTitle.offsetWidth>0){var i="15min";if(t<800)i="30min";if(t<500)i="1hour";if(t<400)i="2hour";BX.onCustomEvent("OnCalendarPlannerDoSetConfig",[{plannerId:this.plannerId,config:{scaleType:i}}])}BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:this.plannerId,timeoutCheck:true,width:t}])}},CustomizeHtmlEditor:function(e){if(e.toolbar.controls&&e.toolbar.controls.spoiler){BX.remove(e.toolbar.controls.spoiler.pCont)}},InitDateTimeControls:function(){var i=this;this.pFromDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pToDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pFromDate.onchange=function(){var e=i._FromDateValue?BX.parseDate(i._FromDateValue):false;if(e&&e.getTime){var a=BX.parseDate(i.pFromDate.value),n=BX.parseDate(i.pToDate.value);if(a&&n){var s=n.getTime()-e.getTime();if(s<0)s=0;n=new Date(a.getTime()+s);if(n)i.pToDate.value=t(n.getDate(),n.getMonth()+1,n.getFullYear())}i._FromDateValue=i.pFromDate.value}i.RefreshPlannerState()};this.pFromTime.parentNode.onclick=this.pFromTime.onclick=e["bxShowClock_"+"feed_cal_event_from_time"+this.id];this.pToTime.parentNode.onclick=this.pToTime.onclick=e["bxShowClock_"+"feed_cal_event_to_time"+this.id];this.pFromTime.onchange=function(){var e=i.ParseDate(BX.util.trim(i.pFromDate.value)+" "+BX.util.trim(i.pFromTime.value));if(i.pToDate.value=="")i.pToDate.value=i.pFromDate.value;var t=i.ParseDate(BX.util.trim(i.pToDate.value)+" "+BX.util.trim(i.pToTime.value));if(i._FromTimeValue){var a=i.ParseDate(BX.util.trim(i.pFromDate.value)+" "+i._FromTimeValue);var n=t.getTime()-a.getTime();if(n<0)n=36e5;var s=new Date(e.getTime()+n);i.pToDate.value=i.FormatDate(s);i.pToTime.value=i.FormatTime(s)}i._FromTimeValue=i.pFromTime.value;i.RefreshPlannerState()};BX.bind(this.pToDate,"change",BX.proxy(this.RefreshPlannerState,this));BX.bind(this.pToTime,"change",BX.proxy(this.RefreshPlannerState,this))},OnSubmit:function(t){if(!this.CheckUserAccessibility()){alert(this.config.message.EC_BUSY_ALERT);setBlogPostFormSubmitted(false);return BX.PreventDefault(t)}var i=this,a=this.parseTime(this.pFromTime.value),n=this.parseTime(this.pToTime.value),s=BX.parseDate(BX.util.trim(this.pFromDate.value)),o=BX.parseDate(BX.util.trim(this.pToDate.value));if(s&&a)s.setHours(a.h,a.m,0);if(o&&n)o.setHours(n.h,n.m,0);BX(this.id+"_time_from_real").value=BX.date.format(this.TIME_FORMAT,s.getTime()/1e3);BX(this.id+"_time_to_real").value=BX.date.format(this.TIME_FORMAT,o.getTime()/1e3);this.pLocation.name=this.locationName;if(this.Loc&&this.Loc.NEW&&this.Loc.NEW.substr(0,5)=="ECMR_"&&!this.bLocationChecked&&e.setBlogPostFormSubmitted){top.BXCRES_Check=null;this.CheckMeetingRoom({from:this.FormatDateTime(s),to:this.FormatDateTime(o),location:this.Loc.NEW},function(){setTimeout(function(){var e=top.BXCRES_Check;if((!e||e=="reserved")&&BX("blog-submit-button-save")){setBlogPostFormSubmitted(false);BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock")}if(!e){return alert(i.config.message.MRReserveErr)}if(e=="reserved"){return alert(i.config.message.MRNotReservedErr)}i.bLocationChecked=true;BX("event-location-new"+i.id).name=i.locationName;BX("event-location-new"+i.id).value=i.Loc.NEW;i.pLocation.name="";setBlogPostFormSubmitted(false);submitBlogPostForm()},100)});return BX.PreventDefault(t)}else if(this.Loc&&this.Loc.NEW!=undefined&&!this.bLocationChecked){BX("event-location"+this.id).value=this.Loc.NEW}},CheckUserAccessibility:function(){var e,t=true;if(this.plannerData){for(e in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(e)&&this.plannerData.entries[e].id&&this.plannerData.entries[e].status!=="h"&&parseInt(this.plannerData.entries[e].strictStatus)&&!this.plannerData.entries[e].currentStatus){t=false;break}}}return t},HandleEvent:function(e){if(e){e.DT_FROM_TS=BX.date.getBrowserTimestamp(e.DT_FROM_TS);e.DT_TO_TS=BX.date.getBrowserTimestamp(e.DT_TO_TS);if(e.DT_FROM_TS>e.DT_TO_TS)e.DT_FROM_TS=e.DT_TO_TS;if(e.RRULE&&e.RRULE.FREQ&&e.RRULE.FREQ!="NONE"){e["~DT_FROM_TS"]=BX.date.getBrowserTimestamp(e["~DT_FROM_TS"]);e["~DT_TO_TS"]=BX.date.getBrowserTimestamp(e["~DT_TO_TS"]);if(e.RRULE&&e.RRULE.UNTIL)e.RRULE.UNTIL=BX.date.getBrowserTimestamp(e.RRULE.UNTIL)}}return e},ShowFormData:function(e){var t=false;if(!e||!e.ID){t=true;e={}}this.pEventName.value=e.NAME||"";this.linkFromToTz=true;this.linkFromToDefaultTz=true;if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}var i=this.GetUsableDateTime((new Date).getTime(),30);var a=this.GetUsableDateTime(i.getTime()+36e5,30);this.pFromDate.value=this.FormatDate(i);this.pToDate.value=this.FormatDate(a);this.pFromTime.value=this.FormatTime(i);this.pToTime.value=this.FormatTime(a);this._FromDateValue=this.pFromDate.value;this._FromTimeValue=this.pFromTime.value;if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}this.pFullDay.checked=e.DT_SKIP_TIME=="Y";this.FullDay(false,e.DT_SKIP_TIME!=="Y");if(t){this.pLocation.value="";if(this.Location){this.Location.Set(false,"")}this.pImportance.value="normal";this.pAccessibility.value="busy";if(this.pSection.options&&this.pSection.options.length>0)this.pSection.value=this.pSection.options[0].value;this.pReminder.checked=!!this.defaultValues.remind;this.pRemCount.value=this.defaultValues.remind&&this.defaultValues.remind.count||"15";this.pRemType.value=this.defaultValues.remind&&this.defaultValues.remind.type||"min"}else{this.pLocation.value=e.LOCATION;this.pImportance.value=e.IMPORTANCE;this.pAccessibility.value=e.ACCESSIBILITY;this.pSection.value=e.SECT_ID;this.pReminder.checked=e.REMIND&&e.REMIND[0];this.pRemCount.value=e.REMIND[0].count;this.pRemType.value=e.REMIND[0].type}this.Reminder(false,true);var n=this;setTimeout(function(){BX.focus(n.pEventName)},100)},FullDay:function(e,t){if(t==undefined)t=!this.bFullDay;if(t)BX.removeClass(this.pFromToCont,"feed-cal-full-day");else BX.addClass(this.pFromToCont,"feed-cal-full-day");this.bFullDay=t},Reminder:function(e,t){if(t==undefined)t=!this.bReminder;this.pReminderCont.className=t?"feed-event-reminder":"feed-event-reminder-collapsed";this.bReminder=t},ShowAdditionalParams:function(){var e=!this.bAdditional;if(!this.pAdditionalCont)this.pAdditionalCont=BX("feed-cal-additional");if(e)BX.removeClass(this.pAdditionalCont,"feed-event-additional-hidden");else BX.addClass(this.pAdditionalCont,"feed-event-additional-hidden");this.bAdditional=e},parseTime:function(e){var t=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date)+" "+e,false);return t?{h:t.getHours(),m:t.getMinutes()}:t},parseDate:function(e,t,i){var a,n,s,o,r=false;if(!t)t=BX.message("FORMAT_DATETIME");e=BX.util.trim(e);if(i!==false)t=t.replace(":SS","");if(BX.type.isNotEmptyString(e)){o="";for(a=1;a<=12;a++){o=o+"|"+BX.message("MON_"+a)}var l=new RegExp("([0-9]+|[a-z]+"+o+")","ig"),h=e.match(l),p=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),c=[],m=[],d={};if(!h){return null}if(h.length>p.length){p=t.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(a=0,n=h.length;a<n;a++){if(BX.util.trim(h[a])!=""){c[c.length]=h[a]}}for(a=0,n=p.length;a<n;a++){if(BX.util.trim(p[a])!=""){m[m.length]=p[a]}}var u=BX.util.array_search("MMMM",m);if(u>0){c[u]=BX.getNumMonth(c[u]);m[u]="MM"}else{u=BX.util.array_search("M",m);if(u>0){c[u]=BX.getNumMonth(c[u]);m[u]="MM"}}for(a=0,n=m.length;a<n;a++){s=m[a].toUpperCase();d[s]=s=="T"||s=="TT"?c[a]:parseInt(c[a],10)}if(d["DD"]>0&&d["MM"]>0&&d["YYYY"]>0){var f=new Date;if(r){f.setUTCDate(1);f.setUTCFullYear(d["YYYY"]);f.setUTCMonth(d["MM"]-1);f.setUTCDate(d["DD"]);f.setUTCHours(0,0,0)}else{f.setDate(1);f.setFullYear(d["YYYY"]);f.setMonth(d["MM"]-1);f.setDate(d["DD"]);f.setHours(0,0,0)}if((!isNaN(d["HH"])||!isNaN(d["GG"])||!isNaN(d["H"])||!isNaN(d["G"]))&&!isNaN(d["MI"])){if(!isNaN(d["H"])||!isNaN(d["G"])){var T=(d["T"]||d["TT"]||"am").toUpperCase()=="PM";var B=parseInt(d["H"]||d["G"]||0,10);if(T){d["HH"]=B+(B==12?0:12)}else{d["HH"]=B<12?B:0}}else{d["HH"]=parseInt(d["HH"]||d["GG"]||0,10)}if(isNaN(d["SS"]))d["SS"]=0;if(r){f.setUTCHours(d["HH"],d["MI"],d["SS"])}else{f.setHours(d["HH"],d["MI"],d["SS"])}}return f}}return null},TimezoneSwitch:function(){if(this.pTzCont.offsetHeight>0){this.pTzCont.style.height=0;BX.removeClass(this.pTzOuterCont,"feed-ev-timezone-outer-wrap-opened")}else{this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"feed-ev-timezone-outer-wrap-opened")}},DefaultTimezoneOnChange:function(){var e=this.pDefTimezone.value;BX.userOptions.save("calendar","timezone_name","timezone_name",e);if(this.linkFromToDefaultTz)this.pToTz.value=this.pFromTz.value=this.pDefTimezone.value},TimezoneFromOnChange:function(){if(this.linkFromToTz)this.pToTz.value=this.pFromTz.value;this.linkFromToDefaultTz=false;this.CheckPlannerState()},TimezoneToOnChange:function(){this.linkFromToTz=false;this.linkFromToDefaultTz=false},FormatDate:function(e){return BX.date.format(this.DATE_FORMAT,e.getTime()/1e3)},FormatTime:function(e,t){return BX.date.format(t===true?this.TIME_FORMAT:this.TIME_FORMAT_SHORT,e.getTime()/1e3)},FormatDateTime:function(e){return BX.date.format(this.DATETIME_FORMAT,e.getTime()/1e3)},GetUsableDateTime:function(e,t){var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return new Date(e)},ParseDate:function(e,t){var i=false;var a=BX.message("FORMAT_DATETIME");if(t!==false)a=a.replace(":SS","");if(BX.type.isNotEmptyString(e)){var n="";for(l=1;l<=12;l++){n=n+"|"+BX.message("MON_"+l)}var s=new RegExp("([0-9]+|[a-z]+"+n+")","ig");var o=e.match(s),r=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),l,h,p=[],c=[],m={};if(!o)return null;if(o.length>r.length){r=a.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(l=0,h=o.length;l<h;l++){if(BX.util.trim(o[l])!=""){p[p.length]=o[l]}}for(l=0,h=r.length;l<h;l++){if(BX.util.trim(r[l])!=""){c[c.length]=r[l]}}var d=BX.util.array_search("MMMM",c);if(d>0){p[d]=BX.getNumMonth(p[d]);c[d]="MM"}else{d=BX.util.array_search("M",c);if(d>0){p[d]=BX.getNumMonth(p[d]);c[d]="MM"}}for(l=0,h=c.length;l<h;l++){var u=c[l].toUpperCase();m[u]=u=="T"||u=="TT"?p[l]:parseInt(p[l],10)}if(m["DD"]>0&&m["MM"]>0&&m["YYYY"]>0){var f=new Date;if(i){f.setUTCDate(1);f.setUTCFullYear(m["YYYY"]);f.setUTCMonth(m["MM"]-1);f.setUTCDate(m["DD"]);f.setUTCHours(0,0,0)}else{f.setDate(1);f.setFullYear(m["YYYY"]);f.setMonth(m["MM"]-1);f.setDate(m["DD"]);f.setHours(0,0,0)}if((!isNaN(m["HH"])||!isNaN(m["GG"])||!isNaN(m["H"])||!isNaN(m["G"]))&&!isNaN(m["MI"])){if(!isNaN(m["H"])||!isNaN(m["G"])){var T=(m["T"]||m["TT"]||"am").toUpperCase()=="PM";var B=parseInt(m["H"]||m["G"]||0,10);if(T){m["HH"]=B+(B==12?0:12)}else{m["HH"]=B<12?B:0}}else{m["HH"]=parseInt(m["HH"]||m["GG"]||0,10)}if(isNaN(m["SS"]))m["SS"]=0;if(i){f.setUTCHours(m["HH"],m["MI"],m["SS"])}else{f.setHours(m["HH"],m["MI"],m["SS"])}}return f}}},LocationOnChange:function(e,t,i){this.pLocation.className="calendar-inp calendar-inp-time calendar-inp-loc";if(t===false){this.Loc.NEW=i||""}else{this.Loc.NEW="ECMR_"+this.config.meetingRooms[t].ID}this.CheckPlannerState()},CheckMeetingRoom:function(e,t){e.bx_event_calendar_check_meeting_room="Y";e.sessid=BX.bitrix_sessid();BX.ajax.get(this.ajaxAction,e,function(){if(t&&typeof t=="function")t();return true})},CheckPlannerState:function(e){if(e!==false){var t=this;if(this.checkPlannerTimeout)this.checkPlannerTimeout=!!clearTimeout(this.checkPlannerTimeout);this.checkPlannerTimeout=setTimeout(function(){t.CheckPlannerState(false)},300)}else if(BX("feed-event-dest-cont",true)){var i={},a=this.ParseDate(BX.util.trim(this.pFromDate.value)),n=this.ParseDate(BX.util.trim(this.pToDate.value)),s=BX("feed-event-dest-cont",true).getElementsByTagName("INPUT"),o,r=[];for(o=0;o<s.length;o++){r.push(s[o].value)}if(a&&n&&a.getTime&&n.getTime&&a.getTime()<=n.getTime()&&(i.location||r.length>0)){i.codes=r;i.from=BX.date.format(this.DATE_FORMAT,(a.getTime()-this.dayLength*3)/1e3);i.to=BX.date.format(this.DATE_FORMAT,(n.getTime()+this.dayLength*10)/1e3);i.location=this.Loc?this.Loc.NEW:this.pLocation.value;if(i.location||i.codes.length>0)this.UpdatePlanner(i)}else if(this.pPlannerBlock&&BX.hasClass(this.pPlannerBlock,"feed-event-planner-block-shown")){this.HidePlanner()}}},UpdatePlanner:function(e){var t=this;top.BXCRES_Planner={};BX.ajax.get(this.ajaxAction,{codes:e.codes||false,from:e.from,to:e.to,location:e.location,entries:e.entrieIds,sessid:BX.bitrix_sessid(),timezone:this.pFromTz.value,bx_event_calendar_update_planner:"Y"},function(){setTimeout(function(){var i=!!(e.entries||top.BXCRES_Planner&&top.BXCRES_Planner.entries&&top.BXCRES_Planner.entries.length>0),a=BX.hasClass(t.pPlannerBlock,"feed-event-planner-block-shown");if(i){var n={show:i&&!a,params:e.params};if(e.entries){top.BXCRES_Planner.entries=e.entries;n.scaleFrom=e.from;n.scaleTo=e.to}n.loadedDataFrom=e.from;n.loadedDataTo=e.to;n.data=top.BXCRES_Planner;n.focusSelector=e.focusSelector==undefined?false:e.focusSelector;t.ShowPlannerAnimation();t.RefreshPlannerState(n)}else if(!i&&a){t.HidePlanner()}},100);return true})},RefreshPlannerState:function(e){if(!e||typeof e!=="object")e={};this.plannerData=e.data;var t,i,a=this.pFullDay.checked,n={},s=90,o,r,l,h,p,c,m=this.pPlannerBlock&&BX.hasClass(this.pPlannerBlock,"feed-event-planner-block-shown");if(e.focusSelector==undefined)e.focusSelector=true;if(!m&&e.show){BX.addClass(this.pPlannerBlock,"feed-event-planner-block-shown");BX.removeClass(this.pPlannerBlock,"feed-event-planner-expanded");n.showTimelineDayTitle=false;n.minWidth=300;n.adjustCellWidth=true;n.readonly=true;n.compactMode=true}c=this.pPlannerTitle.offsetWidth>0;if(a){t=this.ParseDate(BX.util.trim(this.pFromDate.value));i=this.ParseDate(BX.util.trim(this.pToDate.value))||t}else{t=this.ParseDate(BX.util.trim(this.pFromDate.value)+" "+BX.util.trim(this.pFromTime.value));if(this.pToDate.value=="")this.pToDate.value=this.pFromDate.value;i=this.ParseDate(BX.util.trim(this.pToDate.value)+" "+BX.util.trim(this.pToTime.value))}if(t&&i&&t.getTime&&i.getTime&&t.getTime()<=i.getTime()){if(!m&&!e.data){this.CheckPlannerState()}else{if(c){l=this.pPlannerBlock.offsetWidth-this.pPlannerTitle.offsetWidth-this.pPlannerLinkWrap.offsetWidth-80}if(a){p=Math.round((i.getTime()-t.getTime())/this.dayLength+1);o=new Date(t.getTime());if(c){h=Math.floor(l/s);if(p>=h){r=new Date(o.getTime()+this.dayLength*h)}else{o=new Date(o.getTime()-this.dayLength);r=new Date(o.getTime()+this.dayLength*(h-1))}n.width=h*s;e.focusSelector=false}else{o=e.scaleFrom||new Date(o.getTime()-this.dayLength*3);r=e.scaleTo||new Date(o.getTime()+this.dayLength*10)}n.scaleType="1day";n.scaleDateFrom=o;n.scaleDateTo=r;n.adjustCellWidth=false}else{if(c){n.scaleType="15min";if(l<800)n.scaleType="30min";if(l<500)n.scaleType="1hour";if(l<400)n.scaleType="2hour";n.width=l;n.adjustCellWidth=true;n.scaleDateFrom=new Date(t.getTime());n.scaleDateTo=new Date(t.getTime());e.focusSelector=false}else{n.changeFromFullDay={scaleType:"1hour",timelineCellWidth:40}}n.shownScaleTimeFrom=parseInt(this.config.workTimeStart);n.shownScaleTimeTo=parseInt(this.config.workTimeEnd)}BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:n,focusSelector:e.focusSelector,selector:{from:t,to:i,fullDay:!!this.pFullDay.checked,animation:true,updateScaleLimits:true},data:e.data||false,loadedDataFrom:e.loadedDataFrom,loadedDataTo:e.loadedDataTo,show:!!e.show,params:e.params}])}}else if(m){this.HidePlanner()}},HidePlanner:function(){var e=this;BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,hide:true}]);this.pPlannerBlock.style.opacity=1;this.pPlannerBlock.style.display="";this.pPlannerBlock.style.height=this.pPlannerBlock.offsetHeight+"px";this.pPlannerBlock.style.overflow="hidden";new BX.easing({duration:600,start:{opacity:100,height:parseInt(this.pPlannerBlock.offsetHeight),padding:14},finish:{opacity:0,height:0,padding:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.pPlannerBlock.style.opacity=t.opacity/100;e.pPlannerBlock.style.height=t.height+"px";e.pPlannerBlock.style.padding=Math.max(Math.round(t.padding),0)+"px"},complete:function(){BX.removeClass(e.pPlannerBlock,"feed-event-planner-block-shown");e.pPlannerBlock.removeAttribute("style")}}).animate()},ShowPlannerAnimation:function(){var e=this;this.pPlannerBlock.style.opacity=0;this.pPlannerBlock.style.display="";new BX.easing({duration:300,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.pPlannerBlock.style.opacity=t.opacity/100},complete:function(){e.pPlannerBlock.removeAttribute("style")}}).animate()},ExpandPlanner:function(){BX.addClass(this.pPlannerBlock,"feed-event-planner-expanded");var e=this.pPlannerBlock.offsetWidth-26;BX.onCustomEvent("OnCalendarPlannerDoExpand",[{plannerId:this.plannerId,config:{scaleType:"1hour",timelineCellWidth:40,compactMode:false,readonly:false,width:e,adjustCellWidth:false}}])},ProposeTime:function(){BX.onCustomEvent("OnCalendarPlannerDoProposeTime",[{plannerId:this.plannerId}])}};function t(e,t,a){var n=BX.message("FORMAT_DATE");n=n.replace(/YY(YY)?/gi,a);n=n.replace(/MMMM/gi,BX.message("MONTH_"+this.Number(t)));n=n.replace(/MM/gi,i(t));n=n.replace(/M/gi,BX.message("MON_"+this.Number(t)));n=n.replace(/DD/gi,i(e));return n}function i(e){e=parseInt(e,10);if(isNaN(e))e=0;return e<10?"0"+e.toString():e.toString()}function a(e,t){var i=new Date(e);if(!t){var a=i.getHours()||0,n=i.getMinutes()||0;i={date:i.getDate(),month:i.getMonth()+1,year:i.getFullYear(),bTime:!!(a||n),oDate:i};if(i.bTime){i.hour=a;i.min=n}}return i}function n(e,t){var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return a(e)}function s(e,t,i){var a="";if(t==undefined)t="00";else{t=parseInt(t,10);if(isNaN(t))t="00";else{if(t>59)t=59;t=t<10?"0"+t.toString():t.toString()}}e=parseInt(e,10);if(e>24)e=24;if(isNaN(e))e=0;if(i){var n="am";if(e==0){e=12}else if(e==12){n="pm"}else if(e>12){n="pm";e-=12}a=e.toString()+":"+t.toString()+" "+n}else{a=(e<10?"0":"")+e.toString()+":"+t.toString()}return a}})(window);
//# sourceMappingURL=script.map.js