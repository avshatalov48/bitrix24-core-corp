this.BX=this.BX||{};(function(e,t,o,a,n){"use strict";var s=function(e){babelHelpers.inherits(t,e);function t(e){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));a.updateData(e);a.calendarContext=o.Util.getCalendarContext();return a}babelHelpers.createClass(t,[{key:"updateData",value:function e(t){this.data=t||{};this.type=t.CAL_TYPE||"";this.necessity=t.NECESSITY||"N";this.capacity=parseInt(t.CAPACITY)||0;this.ownerId=parseInt(t.OWNER_ID)||0;this.id=parseInt(t.ID);this.location_id=parseInt(t.LOCATION_ID);this.color=this.data.COLOR;this.name=this.data.NAME}},{key:"belongsToView",value:function e(){return true}}]);return t}(a.CalendarSection);var i=function(e){babelHelpers.inherits(a,e);function a(e,t){var o;babelHelpers.classCallCheck(this,a);o=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,e,t));o.locationAccess=t.locationAccess||false;o.locationContext=t.locationContext||null;o.setRooms(e.rooms);o.setConfig(t);o.sortRooms();o.setSections(e.sections);o.sortSections();n.EventEmitter.subscribeOnce("BX.Calendar.Rooms:delete",o.deleteRoomHandler.bind(babelHelpers.assertThisInitialized(o)));return o}babelHelpers.createClass(a,[{key:"sortRooms",value:function e(){var t=this;this.roomsIndex={};this.rooms=this.rooms.sort((function(e,t){if(e.name.toLowerCase()>t.name.toLowerCase()){return 1}if(e.name.toLowerCase()<t.name.toLowerCase()){return-1}return 0}));this.rooms.forEach((function(e,o){t.roomsIndex[e.getId()]=o}))}},{key:"setRooms",value:function e(){var t=this;var o=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.rooms=[];this.roomsIndex={};o.forEach((function(e){var o=new s(e);t.rooms.push(o);t.roomsIndex[o.getId()]=t.rooms.length-1}))}},{key:"getRooms",value:function e(){return this.rooms}},{key:"getRoom",value:function e(t){return this.rooms[this.roomsIndex[t]]}},{key:"createRoom",value:function e(a){var n=this;return new Promise((function(e){a.name=n.checkName(a.name);a.capacity=n.checkCapacity(a.capacity);a.necessity=a.necessity&&a.capacity!==0?"Y":"N";BX.ajax.runAction("calendar.api.locationajax.createRoom",{data:{name:a.name,capacity:a.capacity,necessity:a.necessity,ownerId:n.ownerId,color:a.color,access:a.access||null}}).then((function(a){var s=a.data.rooms||[];var i=a.data.sections||[];n.setRooms(s);n.sortRooms();n.setSections(i);n.sortSections();o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:create",new t.Event.BaseEvent({data:{roomsList:s}}));n.setLocationSelector(s);e(a.data)}),(function(t){BX.Calendar.Util.displayError(t.errors);e(t.data)}))}))}},{key:"updateRoom",value:function e(a){var n=this;return new Promise((function(e){a.name=n.checkName(a.name);a.capacity=n.checkCapacity(a.capacity);a.necessity=a.necessity&&a.capacity!==0?"Y":"N";BX.ajax.runAction("calendar.api.locationajax.updateRoom",{data:{id:a.id,location_id:a.location_id,name:a.name,capacity:a.capacity,necessity:a.necessity,color:a.color,access:a.access||null}}).then((function(s){var i=s.data.rooms||[];var r=s.data.sections||[];n.setRooms(i);n.sortRooms();n.setSections(r);n.sortSections();n.unsetHiddenRoom(a.id);o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:update",new t.Event.BaseEvent({data:{roomsList:i}}));n.setLocationSelector(i);e(s.data)}),(function(t){BX.Calendar.Util.displayError(t.errors);e(t.data)}))}))}},{key:"deleteRoom",value:function e(a,n){var s=this;if(confirm(BX.message("EC_ROOM_DELETE_CONFIRM"))){var i=o.Util.getBX().Event;i.EventEmitter.emit("BX.Calendar.Section:delete",new i.BaseEvent({data:{sectionId:a}}));return new Promise((function(e){BX.ajax.runAction("calendar.api.locationajax.deleteRoom",{data:{id:a,location_id:n}}).then((function(n){var i=n.data.rooms||[];var r=n.data.sections||[];if(!i.length){BX.reload()}s.setRooms(i);s.sortRooms();s.setSections(r);s.sortSections();o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:delete",new t.Event.BaseEvent({data:{id:a}}));s.setLocationSelector(i);e(n.data)}),(function(t){BX.Calendar.Util.displayError(t.errors);e(t.data)}))}))}}},{key:"checkName",value:function e(o){if(typeof o==="string"){o=o.trim();if(a.isEmpty(o)){o=t.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM")}}else{o=t.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM")}return o}},{key:"checkCapacity",value:function e(t){if(a.isEmpty(t)||t<=0||t>=1e4){return 0}return t}},{key:"getRoomsInfo",value:function e(){var t=this;var o=[];var a=[];var n=[];var s=[];this.rooms.forEach((function(e){if(e.isShown()&&t.calendarType==="location"&&e.type==="location"){if(e.isSuperposed()){a.push(e.id)}else{n.push(e.id)}o.push(e.id)}else{s.push(e.id)}}));return{superposed:a,active:n,hidden:s,allActive:o}}},{key:"getRoomName",value:function e(t){if(a.isEmpty(t)){return null}var o=this.getRoom(t);return o.name}},{key:"unsetHiddenRoom",value:function e(t){if(t){this.room=this.getRoom(t);if(!this.room.isShown()){this.room.show()}return null}}},{key:"handlePullRoomChanges",value:function e(a){if(a.command==="delete_room"){var n=parseInt(a.ID,10);if(this.roomsIndex[n]){this.deleteRoomHandler(n);o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:pull-delete",new t.Event.BaseEvent({data:{roomId:n}}))}else{this.reloadRoomData()}}else if(a.command==="create_room"){this.reloadRoomData().then(this.reloadData().then((function(){o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:pull-create")})));o.Util.getBX().Event.EventEmitter.emit("BX.Calendar:doRefresh")}else if(a.command==="update_room"){this.reloadRoomData().then(this.reloadData().then((function(){o.Util.getBX().Event.EventEmitter.emit("BX.Calendar.Rooms:pull-update")})));o.Util.getBX().Event.EventEmitter.emit("BX.Calendar:doRefresh")}else{this.reloadRoomData().then(this.reloadData)}}},{key:"deleteRoomHandler",value:function e(t){if(this.roomsIndex[t]!==undefined){this.rooms.splice(this.roomsIndex[t],1);for(var o=0;o<this.rooms.length;o++){this.roomsIndex[this.rooms[o].id]=o}}if(this.sectionIndex[t]!==undefined){this.sections.splice(this.sectionIndex[t],1);for(var a=0;a<this.sections.length;a++){this.sectionIndex[this.sections[a].id]=a}}}},{key:"reloadRoomData",value:function e(){var t=this;return new Promise((function(e){BX.ajax.runAction("calendar.api.locationajax.getRoomsList").then((function(o){t.setRooms(o.data.rooms||[]);t.sortRooms();BX.Calendar.Controls.Location.setLocationList(o.data.rooms);e(o.data)}),(function(t){e(t.data)}))}))}},{key:"getLocationAccess",value:function e(){return this.locationAccess}},{key:"setLocationSelector",value:function e(t){BX.Calendar.Controls.Location.setLocationList(t);if(this.locationContext!==null){this.locationContext.setValues()}}}],[{key:"isEmpty",value:function e(o){if(t.Type.isArray(o)){return!o.length}return o===null||o===undefined||o===""||o===[]||o==={}}}]);return a}(a.SectionManager);e.RoomsSection=s;e.RoomsManager=i})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Calendar,BX.Calendar,BX.Event);
//# sourceMappingURL=roomsmanager.bundle.map.js