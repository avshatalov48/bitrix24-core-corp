{"version":3,"file":"roomsmanager.bundle.js","sources":["../src/roomssection.js","../src/roomsmanager.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport { CalendarSection } from 'calendar.sectionmanager';\n\nexport class RoomsSection extends CalendarSection\n{\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\t\tthis.updateData(data);\n\t\tthis.calendarContext = Util.getCalendarContext();\n\t\t// this.roomsManager = this.calendarContext.roomsManager;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tthis.data = data || {};\n\t\tthis.type = data.CAL_TYPE || '';\n\t\tthis.necessity = data.NECESSITY || 'N';\n\t\tthis.capacity = parseInt(data.CAPACITY) || 0;\n\t\tthis.ownerId = parseInt(data.OWNER_ID) || 0;\n\t\tthis.id = parseInt(data.ID);\n\t\tthis.location_id = parseInt(data.LOCATION_ID);\n\t\tthis.color = this.data.COLOR;\n\t\tthis.name = this.data.NAME;\n\t\tthis.categoryId = parseInt(this.data.CATEGORY_ID);\n\t\tthis.reserved = this.data.reserved || false;\n\t}\n\n\tbelongsToView()\n\t{\n\t\treturn true;\n\t}\n}","import {Type, Loc, Event, Runtime } from 'main.core';\nimport { SectionManager } from 'calendar.sectionmanager';\nimport { Util } from 'calendar.util';\nimport { RoomsSection } from './roomssection';\nimport { EventEmitter } from 'main.core.events';\nexport { RoomsSection };\n\nexport class RoomsManager extends SectionManager\n{\n\tconstructor(data, config)\n\t{\n\t\tsuper(data, config);\n\t\tthis.locationAccess = config.locationAccess || false;\n\t\tthis.locationContext = config.locationContext || null;\n\t\tthis.setRooms(data.rooms);\n\t\tthis.setConfig(config);\n\t\tthis.sortRooms();\n\t\tthis.setSections(data.sections);\n\t\tthis.sortSections();\n\t\tthis.reloadRoomsFromDatabaseDebounce = Runtime.debounce(this.reloadRoomsFromDatabase, SectionManager.RELOAD_DELAY, this);\n\n\t\tEventEmitter.subscribeOnce('BX.Calendar.Rooms:delete', this.deleteRoomHandler.bind(this));\n\t}\n\n\tsortRooms()\n\t{\n\t\tthis.roomsIndex = {};\n\t\tthis.rooms = this.rooms.sort((a, b) => {\n\t\t\tif (a.name.toLowerCase() > b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.name.toLowerCase() < b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\tthis.rooms.forEach((room, i) => {\n\t\t\tthis.roomsIndex[room.getId()] = i;\n\t\t});\n\t}\n\n\tsetRooms(params = [])\n\t{\n\t\tthis.rooms = [];\n\t\tthis.roomsIndex = {};\n\t\tparams.forEach((roomData) => {\n\t\t\tlet room = new RoomsSection(roomData);\n\t\t\tthis.rooms.push(room);\n\t\t\tthis.roomsIndex[room.getId()] = this.rooms.length - 1;\n\t\t});\n\t}\n\n\tgetRooms()\n\t{\n\t\treturn this.rooms;\n\t}\n\n\tgetRoom(id)\n\t{\n\t\treturn this.rooms[this.roomsIndex[id]];\n\t}\n\n\tcreateRoom(params)\n\t{\n\t\treturn new Promise(resolve => {\n\n\t\t\tparams.name = this.checkName(params.name);\n\t\t\tparams.capacity = this.checkCapacity(params.capacity);\n\t\t\tparams.necessity = (params.necessity && params.capacity !== 0) ? 'Y' : 'N';\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.createRoom', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\tcapacity: params.capacity,\n\t\t\t\t\t\tnecessity: params.necessity,\n\t\t\t\t\t\townerId: this.ownerId,\n\t\t\t\t\t\tcolor: params.color,\n\t\t\t\t\t\taccess: params.access || null,\n\t\t\t\t\t\tcategoryId: params.categoryId,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst roomList = response.data.rooms || [];\n\t\t\t\t\t\tconst sectionList = response.data.sections || [];\n\t\t\t\t\t\tthis.setRooms(roomList);\n\t\t\t\t\t\tthis.sortRooms();\n\t\t\t\t\t\tthis.setSections(sectionList);\n\t\t\t\t\t\tthis.sortSections();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms:create',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { roomsList: roomList }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setLocationSelector(roomList);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t});\n\t}\n\n\tupdateRoom(params)\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tparams.name = this.checkName(params.name);\n\t\t\tparams.capacity = this.checkCapacity(params.capacity);\n\t\t\tparams.necessity = (params.necessity && params.capacity !== 0) ? 'Y' : 'N';\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.updateRoom', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: params.id,\n\t\t\t\t\t\tlocation_id: params.location_id,\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\tcapacity: params.capacity,\n\t\t\t\t\t\tnecessity: params.necessity,\n\t\t\t\t\t\tcolor: params.color,\n\t\t\t\t\t\taccess: params.access || null,\n\t\t\t\t\t\tcategoryId: params.categoryId,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst roomList = response.data.rooms || [];\n\t\t\t\t\t\tconst sectionList = response.data.sections || [];\n\t\t\t\t\t\tthis.setRooms(roomList);\n\t\t\t\t\t\tthis.sortRooms();\n\t\t\t\t\t\tthis.setSections(sectionList);\n\t\t\t\t\t\tthis.sortSections();\n\t\t\t\t\t\tthis.unsetHiddenRoom(params.id)\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms:update',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { roomsList: roomList }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setLocationSelector(roomList);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tdeleteRoom(id, location_id)\n\t{\n\t\tif (confirm(BX.message('EC_ROOM_DELETE_CONFIRM')))\n\t\t{\n\t\t\tconst EventAlias = Util.getBX().Event;\n\t\t\tEventAlias.EventEmitter.emit(\n\t\t\t\t'BX.Calendar.Section:delete',\n\t\t\t\tnew EventAlias.BaseEvent({data: {sectionId: id}})\n\t\t\t);\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tBX.ajax.runAction('calendar.api.locationajax.deleteRoom', {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\tlocation_id: location_id\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst roomList = response.data.rooms || [];\n\t\t\t\t\t\t\tconst sectionList = response.data.sections || [];\n\t\t\t\t\t\t\tif (!roomList.length)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.setRooms(roomList);\n\t\t\t\t\t\t\tthis.sortRooms();\n\t\t\t\t\t\t\tthis.setSections(sectionList);\n\t\t\t\t\t\t\tthis.sortSections();\n\n\t\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t\t'BX.Calendar.Rooms:delete',\n\t\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.setLocationSelector(roomList);\n\t\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tcheckName(name)\n\t{\n\t\tif (typeof name === 'string')\n\t\t{\n\t\t\tname = name.trim();\n\t\t\tif (RoomsManager.isEmpty(name))\n\t\t\t{\n\t\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_ROOM');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_ROOM');\n\t\t}\n\t\treturn name;\n\t}\n\n\tcheckCapacity(capacity)\n\t{\n\t\tif (RoomsManager.isEmpty(capacity) || capacity <= 0 || capacity >= 10000)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\treturn capacity;\n\t}\n\n\tgetRoomsInfo()\n\t{\n\t\tconst allActive = [];\n\t\tconst superposed = [];\n\t\tconst active = [];\n\t\tconst hidden = [];\n\n\t\tthis.rooms.forEach((room) => {\n\t\t\tif (room.isShown() && this.calendarType === 'location' && room.type === 'location')\n\t\t\t{\n\t\t\t\tif (room.isSuperposed())\n\t\t\t\t{\n\t\t\t\t\tsuperposed.push(room.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactive.push(room.id);\n\t\t\t\t}\n\t\t\t\tallActive.push(room.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thidden.push(room.id);\n\t\t\t}\n\t\t});\n\n\t\treturn { superposed, active, hidden, allActive };\n\t}\n\n\tgetRoomName(id)\n\t{\n\t\tif (RoomsManager.isEmpty(id))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst room = this.getRoom(id);\n\t\treturn room.name;\n\t}\n\n\tunsetHiddenRoom(id)\n\t{\n\t\tif (id)\n\t\t{\n\t\t\tconst room = this.getRoom(id)\n\t\t\tif (room.calendarContext && !room.isShown())\n\t\t\t{\n\t\t\t\troom.show();\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePullRoomChanges(params)\n\t{\n\t\tif (params.command === 'delete_room')\n\t\t{\n\t\t\tconst roomId = parseInt(params.ID, 10);\n\t\t\tif (this.roomsIndex[roomId])\n\t\t\t{\n\t\t\t\tthis.deleteRoomHandler(roomId);\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t'BX.Calendar.Rooms:pull-delete',\n\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: { roomId: roomId }\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadRoomsFromDatabaseDebounce();\n\t\t\t}\n\t\t}\n\t\telse if (params.command === 'create_room')\n\t\t{\n\t\t\tthis.reloadRoomsFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms:pull-create');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse if (params.command === 'update_room')\n\t\t{\n\t\t\tthis.reloadRoomsFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms:pull-update');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reloadRoomsFromDatabase().then(this.reloadDataDebounce());\n\t\t}\n\t}\n\n\tdeleteRoomHandler(id)\n\t{\n\t\tif (this.roomsIndex[id] !== undefined)\n\t\t{\n\t\t\tthis.rooms.splice(this.roomsIndex[id], 1);\n\t\t\tfor (let i = 0; i < this.rooms.length; i++)\n\t\t\t{\n\t\t\t\tthis.roomsIndex[this.rooms[i].id] = i;\n\t\t\t}\n\t\t}\n\t\tif (this.sectionIndex[id] !== undefined)\n\t\t{\n\t\t\tthis.sections.splice(this.sectionIndex[id], 1);\n\t\t\tfor (let i = 0; i < this.sections.length; i++)\n\t\t\t{\n\t\t\t\tthis.sectionIndex[this.sections[i].id] = i;\n\t\t\t}\n\t\t}\n\t}\n\n\treloadRoomsFromDatabase()\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.getRoomsList')\n\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.setRooms(response.data.rooms || []);\n\t\t\t\t\t\tthis.sortRooms();\n\t\t\t\t\t\tBX.Calendar.Controls.Location.setLocationList(response.data.rooms);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t// Failure\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tgetLocationAccess()\n\t{\n\t\treturn this.locationAccess;\n\t}\n\n\tsetLocationSelector(roomList)\n\t{\n\t\tBX.Calendar.Controls.Location.setLocationList(roomList);\n\t\tif (this.locationContext !== null)\n\t\t{\n\t\t\tthis.locationContext.setValues();\n\t\t}\n\t}\n\n\tstatic isEmpty(param)\n\t{\n\t\tif (Type.isArray(param))\n\t\t{\n\t\t\treturn !param.length;\n\t\t}\n\t\treturn param === null || param === undefined || param === '' || param === [] || param === {};\n\t}\n}"],"names":["RoomsSection","CalendarSection","constructor","data","updateData","calendarContext","Util","getCalendarContext","type","CAL_TYPE","necessity","NECESSITY","capacity","parseInt","CAPACITY","ownerId","OWNER_ID","id","ID","location_id","LOCATION_ID","color","COLOR","name","NAME","categoryId","CATEGORY_ID","reserved","belongsToView","RoomsManager","SectionManager","config","locationAccess","locationContext","setRooms","rooms","setConfig","sortRooms","setSections","sections","sortSections","reloadRoomsFromDatabaseDebounce","Runtime","debounce","reloadRoomsFromDatabase","RELOAD_DELAY","EventEmitter","subscribeOnce","deleteRoomHandler","bind","roomsIndex","sort","a","b","toLowerCase","forEach","room","i","getId","params","roomData","push","length","getRooms","getRoom","createRoom","Promise","resolve","checkName","checkCapacity","BX","ajax","runAction","access","then","response","roomList","sectionList","getBX","Event","emit","BaseEvent","roomsList","setLocationSelector","Calendar","displayError","errors","updateRoom","unsetHiddenRoom","deleteRoom","confirm","message","EventAlias","sectionId","reload","trim","isEmpty","Loc","getMessage","getRoomsInfo","allActive","superposed","active","hidden","isShown","calendarType","isSuperposed","getRoomName","show","handlePullRoomChanges","command","roomId","reloadDataDebounce","undefined","splice","sectionIndex","Controls","Location","setLocationList","getLocationAccess","setValues","param","Type","isArray"],"mappings":"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"}