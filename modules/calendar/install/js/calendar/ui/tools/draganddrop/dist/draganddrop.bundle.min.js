this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};this.BX.Calendar.Ui=this.BX.Calendar.Ui||{};(function(t){"use strict";class e{constructor(t,e,i){this.maxTryDuration=50;this.stickDistanceInPercents=34;this.magnetizeDistanceInMinutes=15;this.getDateByPos=t;this.getPosByDate=e;this.getEvents=i}getFinalFrom(){return this.finalFrom}getFinalTo(){return this.finalTo}onDragStart(t,e=0){this.savedDuration=t;this.tryDuration=0;const i=this.getBoundaryFromPosition(e);this.finalFrom=i.from;this.finalTo=i.to}getDragBoundary(t){const e=this.previousPosition?this.previousPosition-t:0;this.previousPosition=t;this.calculateTryDuration(e);this.resetMagnetStamps(e);let i=this.getBoundaryFromPosition(t);if(this.doMagnetize()){i=this.getMagnetizedBoundary(i,e)}i.size=this.getPosByDate(i.to)-this.getPosByDate(i.from);this.finalFrom=i.from;this.finalTo=i.to;return i}getBoundaryFromPosition(t){const e=this.getDateByPos(t);const i=e?new Date(e.getTime()+this.savedDuration):null;return{from:e,to:i,position:t,wasMagnetized:false}}getMagnetizedBoundary(t,e){let i=t.position;let s=this.savedDuration;const n=this.getMagnetizedTimeInterval(t.from,t.to);const o=this.getPosByDate(n.from);const a=n.wasMagnetizedTo||n.wasMagnetizedFrom;if(a){i=o;s=n.to.getTime()-n.from.getTime()}if(!this.endMagnetStamp&&t.to.getTime()<n.to.getTime()&&e<0){this.endMagnetStamp=i}if(this.endMagnetStamp){if(this.endMagnetStamp+5<i){this.endMagnetStamp=null}else{i=this.endMagnetStamp}}if(!this.startMagnetStamp&&t.from.getTime()>n.from.getTime()&&e>0){this.startMagnetStamp=i}if(this.startMagnetStamp){if(o<this.startMagnetStamp){this.startMagnetStamp=null}else{i=this.startMagnetStamp}}const r=this.getDateByPos(i);const g=new Date(r.getTime()+s);return{from:r,to:g,position:i,wasMagnetized:a}}getMagnetizedTimeInterval(t,e){let i=false;let s=false;let n=new Date(t.getTime());let o=new Date(e.getTime());const a=o.getTime()-n.getTime();const r=this.magnetizeDistanceInMinutes*60*1e3;const g=this.stickDistanceInPercents/100*this.savedDuration;let m=new Date(n.getTime());m.setHours(0,0,0,0);let h=new Date(o.getTime());h.setHours(23,59,0,0);const T=this.getEvents();for(const t of T){const e=t.from.getTime();const i=t.to.getTime();if(i>m.getTime()&&i<=o.getTime()){m=new Date(i)}if(e<h.getTime()&&e>=n.getTime()){h=new Date(e)}}if(m.getTime()>=h.getTime()){return{from:n,to:o,wasMagnetizedFrom:i,wasMagnetizedTo:s}}if(m.getTime()>n.getTime()&&m.getTime()-n.getTime()<=g){n=new Date(m.getTime());o=new Date(n.getTime()+a);i=true}if(h.getTime()<o.getTime()&&o.getTime()-h.getTime()<=g){o=new Date(h.getTime());n=new Date(o.getTime()-a);s=true}if(m.getTime()>n.getTime()&&m.getTime()-n.getTime()<=g){n=new Date(m.getTime());o=new Date(n.getTime()+a);i=true}if(i&&s){n=new Date(m.getTime());o=new Date(h.getTime())}if(!i&&!s){if(n.getTime()>m.getTime()&&n.getTime()-m.getTime()<=r){i=true}if(h.getTime()>o.getTime()&&h.getTime()-o.getTime()<=r){s=true}if(i&&!s){n=new Date(m.getTime());o=new Date(n.getTime()+a)}if(s&&!i){o=new Date(h.getTime());n=new Date(o.getTime()-a)}}return{from:n,to:o,wasMagnetizedFrom:i,wasMagnetizedTo:s}}resetMagnetStamps(t){if(t>0){this.endMagnetStamp=null}if(t<0){this.startMagnetStamp=null}}calculateTryDuration(t){if(Math.abs(t)<1){this.tryDuration++}if(Math.abs(t)>3){this.tryDuration=0}}doMagnetize(){return!this.isAnyModifierKeyPressed()&&!this.isUserTryingToTurnOffMagnet()}isUserTryingToTurnOffMagnet(){return this.tryDuration>this.maxTryDuration}isAnyModifierKeyPressed(){if(window.event){return window.event.altKey||window.event.shiftKey||window.event.ctrlKey||window.event.metaKey}return true}}class i{constructor(t,e){this.getDateByPos=t;this.getPosByDate=e}getFinalFrom(){return this.from}getFinalTo(){return this.to}onDragStart(t,e=0,i=false){this.from=t.from;this.to=t.to;this.isStartResizer=i;this.direction=i?-1:1;this.positionStart=this.getPosByDate(this.from);this.positionEnd=this.getPosByDate(this.to);this.size=this.positionEnd-this.positionStart;this.minSize=e}getDragBoundary(t){const e=Math.max(this.size+t*this.direction,this.minSize);if(this.isStartResizer){this.positionStart=this.positionEnd-e;const t=this.getDateByPos(this.positionStart);this.from.setHours(t.getHours(),t.getMinutes(),0,0)}else{this.positionEnd=this.positionStart+e;const t=this.getDateByPos(this.positionEnd);this.to.setHours(t.getHours(),t.getMinutes(),0,0)}return{from:this.from,to:this.to,position:this.positionStart,size:e}}}t.EventDragAndDrop=e;t.ResizeDragAndDrop=i})(this.BX.Calendar.Ui.Tools=this.BX.Calendar.Ui.Tools||{});
//# sourceMappingURL=draganddrop.bundle.map.js