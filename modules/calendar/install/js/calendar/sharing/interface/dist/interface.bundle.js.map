{"version":3,"file":"interface.bundle.js","sources":["../src/controls/dialog-qr.js","../src/controls/dialog-new.js","../src/controls/sharingbutton.js","../src/interface.js"],"sourcesContent":["import {Tag, Loc, Runtime} from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\n\ntype DialogQrOptions = {\n\tsharingUrl: string,\n\tcontext: 'calendar' | 'crm',\n}\nexport default class DialogQr\n{\n\tQRCODE_SIZE = 114;\n\tQRCODE_COLOR_LIGHT = '#fff';\n\tQRCODE_COLOR_DARK = '#000';\n\t#popup;\n\t#loader;\n\t#layout;\n\t#qrCode;\n\t#context;\n\n\tconstructor(options: DialogQrOptions)\n\t{\n\t\tthis.#popup = null;\n\t\tthis.#loader = null;\n\t\tthis.#layout = {\n\t\t\tqr: null,\n\t\t};\n\t\tthis.#qrCode = null;\n\t\tthis.#context = options.context;\n\n\t\tthis.sharingUrl = options.sharingUrl;\n\t}\n\n\t/**\n\t *\n\t * @returns {Popup}\n\t */\n\tgetPopup()\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tclassName: 'calendar-sharing__qr',\n\t\t\t\twidth: 315,\n\t\t\t\tpadding: 0,\n\t\t\t\tcontent: this.getContent(),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\toverlay: true,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t/**\n\t *\n\t * @returns {Loader}\n\t */\n\tgetLoader()\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({ size: 95 });\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetNodeQr()\n\t{\n\t\tif (!this.#layout.qr)\n\t\t{\n\t\t\tthis.#layout.qr = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__qr-block\"></div>\n\t\t\t`;\n\n\t\t\t// qr emulation\n\t\t\tthis.getLoader().show(this.#layout.qr);\n\n\t\t\tthis.showQr();\n\t\t}\n\n\t\treturn this.#layout.qr;\n\t}\n\n\tasync showQr()\n\t{\n\t\tawait this.initQrCode();\n\t\tthis.QRCode = new QRCode(this.#layout.qr, {\n\t\t\ttext: this.sharingUrl,\n\t\t\twidth: this.QRCODE_SIZE,\n\t\t\theight: this.QRCODE_SIZE,\n\t\t\tcolorDark : this.QRCODE_COLOR_DARK,\n\t\t\tcolorLight : this.QRCODE_COLOR_LIGHT,\n\t\t\tcorrectLevel : QRCode.CorrectLevel.H\n\t\t});\n\t\tawait this.getLoader().hide();\n\t}\n\n\tasync initQrCode()\n\t{\n\t\tawait Runtime.loadExtension(['main.qrcode']);\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetContent()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__qr-content\">\n\t\t\t\t<div class=\"calendar-sharing__qr-title\">${this.getPhraseDependsOnContext('SHARING_INFO_POPUP_QR_TITLE')}</div>\n\t\t\t\t${this.getNodeQr()}\n\t\t\t\t<div class=\"calendar-sharing__qr-info\">${Loc.getMessage('SHARING_INFO_POPUP_QR_INFO')}</div>\n\t\t\t\t<a class=\"calendar-sharing__dialog-link\" href=\"${this.sharingUrl}\" target=\"_blank\">${Loc.getMessage('SHARING_INFO_POPUP_QR_OPEN_LINK')}</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.getPopup().isShown();\n\t}\n\tclose()\n\t{\n\t\tthis.getPopup().close();\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.getPopup().destroy();\n\t}\n\n\tgetPhraseDependsOnContext(code: string)\n\t{\n\t\treturn Loc.getMessage(code + '_' + this.#context.toUpperCase())\n\t}\n}","import { Tag, Loc, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport DialogQr from './dialog-qr';\n\nimport 'main.qrcode';\nimport 'ui.design-tokens';\nimport {Util} from \"calendar.util\";\n\ntype DialogOptions = {\n\tbindElement: HTMLElement,\n\tdialogQr: DialogQr,\n\tsharingUrl: string,\n\tcontext: 'calendar' | 'crm',\n}\n\nexport default class DialogNew\n{\n\tHELP_DESK_CODE_CALENDAR = 17198666;\n\tHELP_DESK_CODE_CRM = 17502612;\n\t#popup;\n\t#layout;\n\t#dialogQr;\n\t#context;\n\n\tconstructor(options: DialogOptions)\n\t{\n\t\tthis.#popup = null;\n\t\tthis.#dialogQr = null;\n\t\tthis.#layout = {\n\t\t\twrapper: null,\n\t\t\tcontentTop: null,\n\t\t\tcontentBody: null,\n\t\t\tcontentBottom: null,\n\t\t\tbuttonCopy: null\n\t\t};\n\t\tthis.#context = options.context;\n\n\t\tthis.bindElement = options.bindElement || null;\n\t\tthis.sharingUrl = options.sharingUrl || null;\n\t}\n\n\t/**\n\t *\n\t * @returns {Popup}\n\t */\n\tgetPopup()\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tclassName: 'calendar-sharing__dialog',\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: 0,\n\t\t\t\twidth: 470,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: this.bindElement.offsetWidth / 2 + 16\n\t\t\t\t},\n\t\t\t\tautoHideHandler: (event) => { return this.autoHideHandler(event)},\n\t\t\t\tcontent: this.getPopupWrapper(),\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => this.bindElement.classList.add('ui-btn-hover'),\n\t\t\t\t\tonPopupClose: () => this.bindElement.classList.remove('ui-btn-hover')\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\tautoHideHandler(event)\n\t{\n\t\treturn !this.#layout.wrapper.contains(event.target) && !this.#dialogQr?.isShown();\n\t}\n\n\t/**\n\t *\n\t * @returns {DialogQr}\n\t */\n\tgetDialogQr()\n\t{\n\t\tif (!this.#dialogQr)\n\t\t{\n\t\t\tthis.#dialogQr = new DialogQr({\n\t\t\t\tsharingUrl: this.sharingUrl,\n\t\t\t\tcontext: this.#context,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#dialogQr;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetPopupWrapper()\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tthis.#layout.wrapper = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-wrapper\">\n\t\t\t\t\t${this.getPopupContentTop()}\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-body\">\n\t\t\t\t\t\t<div class=\"calendar-sharing__dialog-userpic\"></div>\n\t\t\t\t\t\t<div class=\"calendar-sharing__dialog-notify\">\n\t\t\t\t\t\t\t<div class=\"calendar-sharing__dialog-notify_content\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('SHARING_INFO_POPUP_CONTENT_4', {'#LINK#': this.sharingUrl})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getPopupContentBottom()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetPopupCopyLinkButton()\n\t{\n\t\tif (!this.#layout.buttonCopy)\n\t\t{\n\t\t\tthis.#layout.buttonCopy = Tag.render`\n\t\t\t\t<span onclick=\"${this.adjustSave.bind(this)}\" class=\"ui-btn ui-btn-success ui-btn-round ui-btn-no-caps\">${Loc.getMessage('SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON')}</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.buttonCopy;\n\t}\n\n\tadjustSave()\n\t{\n\t\tif (this.copyLink())\n\t\t{\n\t\t\tthis.onSuccessfulCopyingLink();\n\t\t}\n\t}\n\n\tcopyLink()\n\t{\n\t\tlet result = false;\n\t\tif (this.sharingUrl)\n\t\t{\n\t\t\tresult = BX.clipboard.copy(this.sharingUrl);\n\t\t}\n\t\tif (result)\n\t\t{\n\t\t\tUtil.showNotification(Loc.getMessage('SHARING_COPY_LINK_NOTIFICATION'));\n\t\t\tEventEmitter.emit('CalendarSharing:LinkCopied');\n\t\t}\n\t\treturn result;\n\t}\n\n\tonSuccessfulCopyingLink()\n\t{\n\t\tthis.getPopup().close();\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetPopupContentBottom()\n\t{\n\t\tif (!this.#layout.contentBottom)\n\t\t{\n\t\t\tconst adjustClick = () => {\n\t\t\t\tthis.getDialogQr().show();\n\t\t\t};\n\n\t\t\tthis.#layout.contentBottom = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-bottom\">\n\t\t\t\t\t${this.getPopupCopyLinkButton()}\n\t\t\t\t\t<span onclick=\"${adjustClick}\" class=\"calendar-sharing__dialog-link\">${Loc.getMessage('SHARING_INFO_POPUP_WHAT_SEE_USERS')}</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.contentBottom;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetPopupContentTop()\n\t{\n\t\tif (!this.#layout.contentTop)\n\t\t{\n\t\t\tconst openHelpDesk = () => {\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=' + this.getHelpDeskCodeDependsOnContext());\n\t\t\t};\n\n\t\t\tthis.#layout.contentTop = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-top\">\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-title\">\n\t\t\t\t\t\t<span>${Loc.getMessage('SHARING_BUTTON_TITLE')}</span>\n\t\t\t\t\t\t<span onclick=\"${openHelpDesk}\" class=\"calendar-sharing__dialog-title-help\"  title=\"${Loc.getMessage('SHARING_INFO_POPUP_HOW_IT_WORK')}\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-info\">${this.getPhraseDependsOnContext('SHARING_INFO_POPUP_CONTENT_3') + ' '}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst infoNotify = this.#layout.contentTop.querySelector('[ data-role=\"calendar-sharing_popup-open-link\"]');\n\n\t\t\tif (infoNotify)\n\t\t\t{\n\t\t\t\tlet infoNotifyHint;\n\t\t\t\tlet timer;\n\t\t\t\tinfoNotify.addEventListener('mouseenter', () => {\n\t\t\t\t\ttimer = setTimeout(()=> {\n\t\t\t\t\t\tif (!infoNotifyHint)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinfoNotifyHint = new Popup({\n\t\t\t\t\t\t\t\tbindElement: infoNotify,\n\t\t\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\t\t\toffset: infoNotify.offsetWidth / 2 + 16\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\twidth: 410,\n\t\t\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SHARING_INFO_POPUP_SLOT_DESC'),\n\t\t\t\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinfoNotifyHint.show()\n\t\t\t\t\t}, 1000);\n\t\t\t\t});\n\n\t\t\t\tinfoNotify.addEventListener('mouseleave', () => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\tif (infoNotifyHint)\n\t\t\t\t\t{\n\t\t\t\t\t\tinfoNotifyHint.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.#layout.contentTop;\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.getPopup().isShown();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.bindElement)\n\t\t{\n\t\t\tconsole.warn('BX.Calendar.Sharing: \"bindElement\" is not defined');\n\t\t\treturn;\n\t\t}\n\t\tthis.getPopup().show();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.getPopup().destroy();\n\t\tthis.getDialogQr().destroy();\n\t}\n\n\tgetPhraseDependsOnContext(code: string)\n\t{\n\t\treturn Loc.getMessage(code + '_' + this.#context.toUpperCase())\n\t}\n\n\tgetHelpDeskCodeDependsOnContext()\n\t{\n\t\tlet code = 0;\n\t\tswitch (this.#context)\n\t\t{\n\t\t\tcase 'calendar':\n\t\t\t{\n\t\t\t\tcode = this.HELP_DESK_CODE_CALENDAR;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'crm':\n\t\t\t{\n\t\t\t\tcode = this.HELP_DESK_CODE_CRM;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn code;\n\t}\n}","import {Dom, Event, Loc, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Button, ButtonSize, ButtonColor, ButtonIcon} from 'ui.buttons';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Util} from 'calendar.util';\nimport DialogNew from './dialog-new';\nimport 'ui.switcher';\nimport 'spotlight';\nimport {Guide} from \"ui.tour\";\nimport {Counter} from 'ui.cnt';\n\nexport default class SharingButton\n{\n\tPAY_ATTENTION_TO_NEW_FEATURE_DELAY = 1000;\n\n\tPAY_ATTENTION_TO_NEW_FEATURE_FIRST = 'first-feature';\n\tPAY_ATTENTION_TO_NEW_FEATURE_NEW = 'new-feature';\n\tPAY_ATTENTION_TO_NEW_FEATURE_REMIND = 'remind-feature';\n\n\tPAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS = [this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];\n\tPAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS = [this.PAY_ATTENTION_TO_NEW_FEATURE_NEW, this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];\n\tAVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS = [\n\t\t...this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS,\n\t\t...this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS\n\t];\n\n\tconstructor(options = {})\n\t{\n\t\tthis.wrap = options.wrap;\n\t\tthis.userId = options.userId;\n\t\tthis.sharingConfig = Util.getSharingConfig();\n\t\tthis.sharingUrl = this.sharingConfig?.url || null;\n\t\tthis.payAttentionToNewFeatureMode = options.payAttentionToNewFeature;\n\t\tthis.sharingFeatureLimit = options.sharingFeatureLimit;\n\t}\n\n\tshow()\n\t{\n\t\tDom.addClass(this.wrap, 'calendar-sharing__btn-wrap');\n\t\tthis.button = new Button({\n\t\t\ttext: Loc.getMessage('SHARING_BUTTON_TITLE'),\n\t\t\tround: true,\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\ticon: this.sharingFeatureLimit ? ButtonIcon.LOCK : null,\n\t\t\tclassName: 'ui-btn-themes calendar-sharing__btn',\n\t\t\tonclick: (button, event) => {\n\t\t\t\tif (!this.switcher.getNode().contains(event.target))\n\t\t\t\t{\n\t\t\t\t\tthis.handleSharingButtonClick();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.button.renderTo(this.wrap);\n\t\tthis.renderSwitcher();\n\n\t\tif (this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS.includes(this.payAttentionToNewFeatureMode))\n\t\t{\n\t\t\tthis.payAttentionToNewFeature(this.payAttentionToNewFeatureMode);\n\t\t\tBX.ajax.runAction('calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature');\n\t\t}\n\t}\n\n\thandleSharingButtonClick()\n\t{\n\t\tif (this.sharingFeatureLimit)\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_office_calendar_free_slots');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isSharingEnabled())\n\t\t{\n\t\t\tthis.switcher.toggle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openDialog();\n\t\t}\n\t}\n\n\tgetSwitcherContainer()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__switcher\"></div>\n\t\t`;\n\t}\n\n\tgetSwitcherDivider()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__switcher_divider\"></div>\n\t\t`;\n\t}\n\n\trenderSwitcher()\n\t{\n\t\tDom.append(this.getSwitcherDivider(), this.wrap);\n\t\tthis.switcherWrap = Tag.render`<div class=\"calendar-sharing__switcher-wrap\"></div>`;\n\t\tDom.append(this.switcherWrap, this.wrap);\n\t\tEvent.bind(this.switcherWrap, 'click', this.handleSwitcherWrapClick.bind(this), {capture: true});\n\n\t\tthis.switcher = new BX.UI.Switcher({\n\t\t\tnode: this.getSwitcherContainer(),\n\t\t\tchecked: this.isSharingEnabled() && !this.sharingFeatureLimit,\n\t\t\tcolor: 'green',\n\t\t\tsize: 'small',\n\t\t\thandlers: {\n\t\t\t\ttoggled: () => this.handleSwitcherToggled(),\n\t\t\t},\n\t\t});\n\n\t\tthis.switcher.renderTo(this.switcherWrap);\n\t}\n\n\thandleSwitcherWrapClick(event)\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tthis.showWarningPopup();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t}\n\n\thandleSwitcherToggled()\n\t{\n\t\tif (this.sharingFeatureLimit && this.switcher.isChecked())\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_office_calendar_free_slots');\n\t\t\tthis.switcher.toggle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isToggledAfterErrorOccurred())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tthis.enableSharing();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableSharing();\n\t\t}\n\t}\n\n\tisToggledAfterErrorOccurred()\n\t{\n\t\treturn this.switcher.isChecked() === this.isSharingEnabled();\n\t}\n\n\tisSharingEnabled()\n\t{\n\t\treturn Type.isString(this.sharingUrl);\n\t}\n\n\tenableSharing()\n\t{\n\t\tconst action = 'calendar.api.sharingajax.enableUserSharing';\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingEnabled';\n\n\t\tBX.ajax.runAction(action)\n\t\t\t.then((response) => {\n\t\t\t\tthis.sharingUrl = response.data.url;\n\t\t\t\tthis.openDialog();\n\n\t\t\t\tEventEmitter.emit(\n\t\t\t\t\tevent,\n\t\t\t\t\t{\n\t\t\t\t\t\t'isChecked': this.switcher.isChecked(),\n\t\t\t\t\t\t'url': response.data.url,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n\n\topenDialog()\n\t{\n\t\tthis.pulsar?.close();\n\t\tDom.remove(this.counterNode);\n\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.button.getContainer(),\n\t\t\t\tsharingUrl: this.sharingUrl,\n\t\t\t\tcontext: \"calendar\",\n\t\t\t});\n\t\t}\n\n\t\tif (!this.newDialog.isShown())\n\t\t{\n\t\t\tthis.newDialog.show();\n\t\t\tthis.newDialog.copyLink();\n\t\t}\n\t}\n\n\tdisableSharing()\n\t{\n\t\tconst action = 'calendar.api.sharingajax.disableUserSharing';\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingDisabled';\n\t\tthis.warningPopup.close();\n\n\t\tBX.ajax.runAction(action)\n\t\t\t.then(() => {\n\t\t\t\tthis.sharingUrl = null;\n\t\t\t\tif (this.newDialog)\n\t\t\t\t{\n\t\t\t\t\tthis.newDialog.destroy();\n\t\t\t\t\tthis.newDialog = null;\n\t\t\t\t}\n\t\t\t\tEventEmitter.emit(event, {'isChecked': this.switcher.isChecked()});\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n\n\tshowWarningPopup()\n\t{\n\t\tif (!this.warningPopup)\n\t\t{\n\t\t\tthis.warningPopup = new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('SHARING_WARNING_POPUP_TITLE_1'),\n\t\t\t\tmessage: Loc.getMessage('SHARING_WARNING_POPUP_CONTENT_1'),\n\t\t\t\tbuttons: this.getWarningPopupButtons(),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tminWidth: 365,\n\t\t\t\t\tmaxWidth: 365,\n\t\t\t\t\tminHeight: 180,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.warningPopup.show();\n\t}\n\n\tgetWarningPopupButtons()\n\t{\n\t\treturn [this.getSubmitButton(), this.getCancelButton()]\n\t}\n\n\tgetSubmitButton()\n\t{\n\t\treturn new Button({\n\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\tcolor: ButtonColor.DANGER,\n\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_SUBMIT_BUTTON'),\n\t\t\tevents: {\n\t\t\t\tclick: () => this.handleSubmitButtonClick(),\n\t\t\t}\n\t\t});\n\t}\n\n\tgetCancelButton()\n\t{\n\t\treturn new Button({\n\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_CANCEL_BUTTON'),\n\t\t\tevents: {\n\t\t\t\tclick: () => this.handleCancelButtonClick(),\n\t\t\t}\n\t\t});\n\t}\n\n\thandleSubmitButtonClick()\n\t{\n\t\tthis.switcher.toggle();\n\t\tthis.warningPopup.close();\n\t}\n\n\thandleCancelButtonClick()\n\t{\n\t\tthis.warningPopup.close();\n\t}\n\n\tpayAttentionToNewFeature(mode)\n\t{\n\t\tif (this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(mode))\n\t\t{\n\t\t\tthis.payAttentionToNewFeatureWithoutText();\n\t\t}\n\t\tif (this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(mode))\n\t\t{\n\t\t\tthis.payAttentionToNewFeatureWithText(mode);\n\t\t}\n\t}\n\n\tpayAttentionToNewFeatureWithoutText()\n\t{\n\t\tthis.pulsar = this.getPulsar(this.wrap, false);\n\t\tthis.pulsar.show();\n\t\tEvent.bind(this.pulsar.container, 'click', () => {\n\t\t\tthis.handleSharingButtonClick();\n\t\t});\n\n\t\tthis.counterNode = (new Counter({\n\t\t\tvalue: 1,\n\t\t\tcolor: Counter.Color.DANGER,\n\t\t\tsize: Counter.Size.MEDIUM,\n\t\t\tanimation: false\n\t\t})).getContainer();\n\t\tDom.addClass(this.counterNode, 'calendar-sharing__new-feature-counter');\n\t\tDom.append(this.counterNode, this.wrap);\n\t}\n\n\tpayAttentionToNewFeatureWithText(mode)\n\t{\n\t\tlet title = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TITLE');\n\t\tlet text = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TEXT');\n\t\tif (mode === this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND)\n\t\t{\n\t\t\ttitle = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TITLE');\n\t\t\ttext = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TEXT');\n\t\t}\n\n\t\tconst guide = this.getGuide(title, text);\n\t\tconst pulsar = this.getPulsar(this.wrap);\n\n\t\tsetTimeout(() => {\n\t\t\tguide.showNextStep();\n\t\t\tguide.getPopup().setAngle({ offset: 210 });\n\n\t\t\tpulsar.show();\n\t\t}, this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY);\n\t}\n\n\tgetGuide(title, text)\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.wrap,\n\t\t\t\t\ttitle: title,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = guide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'calendar-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(400);\n\t\tguidePopup.getContentContainer().style.paddingRight = getComputedStyle(guidePopup.closeIcon)['width'];\n\n\t\treturn guide;\n\t}\n\n\tgetPulsar(target, hideOnHover = true)\n\t{\n\t\tconst pulsar = new BX.SpotLight({\n\t\t\ttargetElement: target,\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tlightMode: true,\n\t\t});\n\t\tif (hideOnHover)\n\t\t{\n\t\t\tpulsar.bindEvents({\n\t\t\t\t'onTargetEnter': () => pulsar.close(),\n\t\t\t});\n\t\t}\n\n\t\treturn pulsar;\n\t}\n}\n","import SharingButton from './controls/sharingbutton';\n\nexport default class Interface\n{\n\tconstructor(options)\n\t{\n\t\tthis.buttonWrap = options.buttonWrap;\n\t\tthis.userId = options.userId;\n\t\tthis.payAttentionToNewFeature = options.payAttentionToNewFeature ?? false;\n\t\tthis.sharingFeatureLimit = options.sharingFeatureLimit ?? false;\n\t}\n\n\tshowSharingButton()\n\t{\n\t\tthis.sharingButton = new SharingButton({\n\t\t\twrap: this.buttonWrap,\n\t\t\tuserId: this.userId,\n\t\t\tpayAttentionToNewFeature: this.payAttentionToNewFeature,\n\t\t\tsharingFeatureLimit: this.sharingFeatureLimit,\n\t\t});\n\t\tthis.sharingButton.show();\n\t}\n}"],"names":["DialogQr","constructor","options","QRCODE_SIZE","QRCODE_COLOR_LIGHT","QRCODE_COLOR_DARK","qr","context","sharingUrl","getPopup","Popup","className","width","padding","content","getContent","closeIcon","closeByEsc","autoHide","overlay","animation","getLoader","Loader","size","getNodeQr","Tag","render","show","showQr","initQrCode","QRCode","text","height","colorDark","colorLight","correctLevel","CorrectLevel","H","hide","Runtime","loadExtension","getPhraseDependsOnContext","Loc","getMessage","isShown","close","destroy","code","toUpperCase","DialogNew","HELP_DESK_CODE_CALENDAR","HELP_DESK_CODE_CRM","wrapper","contentTop","contentBody","contentBottom","buttonCopy","bindElement","angle","offset","offsetWidth","autoHideHandler","event","getPopupWrapper","events","onPopupShow","classList","add","onPopupClose","remove","contains","target","getDialogQr","getPopupContentTop","getPopupContentBottom","getPopupCopyLinkButton","adjustSave","bind","copyLink","onSuccessfulCopyingLink","result","BX","clipboard","copy","Util","showNotification","EventEmitter","emit","adjustClick","openHelpDesk","top","Helper","getHelpDeskCodeDependsOnContext","infoNotify","querySelector","infoNotifyHint","timer","addEventListener","setTimeout","darkMode","clearTimeout","console","warn","SharingButton","PAY_ATTENTION_TO_NEW_FEATURE_DELAY","PAY_ATTENTION_TO_NEW_FEATURE_FIRST","PAY_ATTENTION_TO_NEW_FEATURE_NEW","PAY_ATTENTION_TO_NEW_FEATURE_REMIND","PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS","PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS","AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS","wrap","userId","sharingConfig","getSharingConfig","url","payAttentionToNewFeatureMode","payAttentionToNewFeature","sharingFeatureLimit","Dom","addClass","button","Button","round","ButtonSize","EXTRA_SMALL","color","ButtonColor","LIGHT_BORDER","icon","ButtonIcon","LOCK","onclick","switcher","getNode","handleSharingButtonClick","renderTo","renderSwitcher","includes","ajax","runAction","UI","InfoHelper","isSharingEnabled","toggle","openDialog","getSwitcherContainer","getSwitcherDivider","append","switcherWrap","Event","handleSwitcherWrapClick","capture","Switcher","node","checked","handlers","toggled","handleSwitcherToggled","isChecked","showWarningPopup","stopPropagation","isToggledAfterErrorOccurred","enableSharing","disableSharing","Type","isString","action","then","response","data","catch","pulsar","counterNode","newDialog","getContainer","warningPopup","MessageBox","title","message","buttons","getWarningPopupButtons","popupOptions","draggable","minWidth","maxWidth","minHeight","getSubmitButton","getCancelButton","MEDIUM","DANGER","click","handleSubmitButtonClick","handleCancelButtonClick","mode","payAttentionToNewFeatureWithoutText","payAttentionToNewFeatureWithText","getPulsar","container","Counter","value","Color","Size","guide","getGuide","showNextStep","setAngle","Guide","simpleMode","onEvents","steps","position","condition","bottom","guidePopup","popupContainer","setWidth","getContentContainer","style","paddingRight","getComputedStyle","hideOnHover","SpotLight","targetElement","targetVertex","lightMode","bindEvents","Interface","buttonWrap","showSharingButton","sharingButton"],"mappings":"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"}