this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(t,e,i,n){"use strict";let o=t=>t,a,s;class r{constructor(t){this.link=t.link;this.checked=this.link.active;this.create()}create(){this.container=this.createContainer();this.checkbox=this.createCheckbox();n.Event.bind(this.checkbox,"click",this.saveCheckBoxState.bind(this));n.Dom.append(this.checkbox,this.container)}createContainer(){return n.Tag.render(a||(a=o`
			<div class="calendar-sharing-dialog-controls-checkbox-container"></div>
		`))}createCheckbox(){return n.Tag.render(s||(s=o`
			<input type="checkbox" ${0}>
		`),this.checked?"checked":"")}saveCheckBoxState(){this.link.active=this.checkbox.checked;BX.ajax.runAction("calendar.api.sharingajax.toggleLink",{data:{userLinkId:this.link.id,isActive:this.link.active}})}getContainer(){return this.container}renderTo(t){if(n.Type.isDomNode(t)){return t.appendChild(this.getContainer())}return null}}let h=t=>t,l,c,d,u,p,g,k,B,C,w,v,L;class S{constructor(t={}){this.POPUP_WIDTH=420;this.zIndex=3100;this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";this.bindElement=t.bindElement;this.userId=t.userId;this.isSharingOn=t.isSwitchCheckedOnStart;this.switcherNode=t.switcherNode;this.create()}create(){this.popup=new BX.Main.Popup({bindElement:this.bindElement,minHeight:230,width:this.POPUP_WIDTH,autoHide:true,autoHideHandler:t=>this.dialogPopupAutoHideHandler(t),closeByEsc:true,angle:{offset:this.POPUP_WIDTH/2},offsetLeft:this.bindElement.offsetWidth/2-this.POPUP_WIDTH/2.25,events:{onFirstShow:this.onFirstShow.bind(this),onClose:this.onClose.bind(this)}});this.createLoader().show()}dialogPopupAutoHideHandler(t){if(this.switcherNode.contains(t.target)||this.popup.getPopupContainer().contains(t.target)){return false}return true}getPopup(){return this.popup}getLoader(){return this.loader}isShown(){var t;return(t=this.popup)==null?void 0:t.isShown()}destroy(){var t;(t=this.popup)==null?void 0:t.destroy()}createLoader(){this.loader=new BX.Loader({target:this.popup.getContentContainer(),size:110});return this.loader}async onFirstShow(){await this.loadDialogData();await this.initQrCode();this.getPopup().setContent(this.createDialogContent());this.onAfterDialogContentCreated();this.getLoader().hide()}onClose(){e.EventEmitter.emit("Calendar.Sharing.Dialog:onClose")}async loadDialogData(){const t=await BX.ajax.runAction("calendar.api.sharingajax.getDialogData",{data:{isSharingOn:this.isSharingOn}});this.links=t.data.links}async initQrCode(){await n.Runtime.loadExtension(["main.qrcode"])}onAfterDialogContentCreated(){this.subscribeToEvents();n.Dom.style(this.copyLinkButtonContainer.firstChild,"min-width",this.copyLinkButtonContainer.offsetWidth+1+"px")}subscribeToEvents(){e.EventEmitter.subscribe("Calendar.Sharing.copyLinkButton:onSwitchToggled",(t=>{var i;(i=this.copyLinkButton)==null?void 0:i.setDisabled(!t.data);if(this.previewBlockQr){n.Dom.removeClass(this.previewBlockQr,"calendar-sharing-dialog-preview-block-qr-container-blurred")}if(this.previewBlockAnnotationLink){n.Dom.removeClass(this.previewBlockAnnotationLink,"calendar-sharing-dialog-preview-block-annotation-link-disabled")}this.links.forEach((t=>{if(t.linkInputNode){n.Dom.removeClass(t.linkContainerNode,"calendar-sharing-dialog-sharing-block-link-container-disabled");n.Dom.removeClass(t.linkInputNode,"calendar-sharing-dialog-controls-link-text-disabled");n.Dom.attr(t.linkInputNode,"value",t.url);e.EventEmitter.emit("Calendar.Sharing.LinkTextContainer:onChange")}}));BX.ajax.runAction("calendar.api.sharingajax.toggleLink",{data:{userLinkId:this.links[0].id,isActive:this.links[0].active}})}))}getDialogContent(){return this.dialogContent}createDialogContent(){this.dialogContent=this.createContentWrap();n.Dom.append(this.createSharingBlock(),this.dialogContent);n.Dom.append(this.createPreviewBlock(),this.dialogContent);return this.dialogContent}createContentWrap(){this.contentWrap=n.Tag.render(l||(l=h`
			<div class="calendar-sharing-dialog-wrap"></div>
		`));return this.contentWrap}createSharingBlock(){this.sharingBlock=this.createBlock();n.Dom.append(this.createSharingBlockTitle(),this.sharingBlock);n.Dom.append(this.createSharingBlockLinks(),this.sharingBlock);return this.sharingBlock}createBlock(){return n.Tag.render(c||(c=h`
			<div class="calendar-sharing-dialog-block"></div>
		`))}createSharingBlockTitle(){this.sharingBlockTitle=n.Tag.render(d||(d=h`
			<div class="calendar-sharing-dialog-sharing-block-title">
				<div class="calendar-sharing-dialog-sharing-block-title-text">
					${0}
				</div>
			</div>
		`),n.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_TITLE"));n.Dom.append(this.createSharingHint(),this.sharingBlockTitle);return this.sharingBlockTitle}createSharingHint(){return BX.UI.Hint.createNode(n.Loc.getMessage("SHARING_DIALOG_SHARING_HINT"))}createSharingBlockLinks(){const t=n.Tag.render(u||(u=h`
			<div></div>
		`));this.links.forEach((e=>{n.Dom.append(this.createSharingBlockLink(e),t)}));return t}createSharingBlockLink(t){const i=n.Tag.render(p||(p=h`
			<div class="calendar-sharing-dialog-sharing-block-link-container"></div>
		`));const o=n.Tag.render(g||(g=h`
			<div class="calendar-sharing-dialog-controls-container"></div>
		`));const a=n.Tag.render(k||(k=h`
			<input
				type="text"
				class="calendar-sharing-dialog-controls-link-text"
				value="${0}"
				readonly
			>
		`),n.Text.encode(t.url));if(!this.isSharingOn){n.Dom.attr(a,"value",t.serverPath+"/...");n.Dom.addClass(i,"calendar-sharing-dialog-sharing-block-link-container-disabled");n.Dom.addClass(a,"calendar-sharing-dialog-controls-link-text-disabled");n.Dom.style(a,"width",a.value.length-3+"ch")}else{n.Dom.style(a,"width",a.value.length+"ch")}e.EventEmitter.subscribe("Calendar.Sharing.LinkTextContainer:onChange",(()=>{n.Dom.style(a,"width",a.value.length+"ch")}));t.linkContainerNode=i;t.linkInputNode=a;n.Dom.append(a,o);n.Dom.append(o,i);this.copyLinkButtonContainer=this.createCopyLinkButtonContainer();n.Dom.append(this.copyLinkButtonContainer,i);this.copyLinkButton=this.createCopyLinkButton(t.url);this.copyLinkButton.renderTo(this.copyLinkButtonContainer);return i}createCopyLinkButtonContainer(){const t=n.Tag.render(B||(B=h`<div></div>`));n.Event.bind(t,"mouseenter",(()=>this.handleCopyLinkButtonContainerMouseEnter()));n.Event.bind(t,"mouseleave",(()=>this.handleCopyLinkButtonContainerMouseLeave()));return t}handleCopyLinkButtonContainerMouseEnter(){var t;if((t=this.copyLinkButton)!=null&&t.disabled){e.EventEmitter.emit("Calendar.Sharing.copyLinkButtonContainer:onMouseEnter");this.showDisabledCopyLinkButtonInfoPopup()}}showDisabledCopyLinkButtonInfoPopup(){var t;if(!this.disabledCopyLinkButtonPopup){this.disabledCopyLinkButtonPopup=this.createDisabledCopyLinkButtonInfoPopup()}if(!((t=this.disabledCopyLinkButtonPopup)!=null&&t.isShown())){this.disabledCopyLinkButtonPopup.show()}}handleCopyLinkButtonContainerMouseLeave(){var t;if((t=this.copyLinkButton)!=null&&t.disabled){this.hideDisabledCopyLinkButtonInfoPopup()}}hideDisabledCopyLinkButtonInfoPopup(){var t;if((t=this.disabledCopyLinkButtonPopup)!=null&&t.isShown()){this.disabledCopyLinkButtonPopup.close()}}createDisabledCopyLinkButtonInfoPopup(){const t=200;return new BX.Main.Popup({bindElement:this.copyLinkButtonContainer,className:"calendar-clipboard-copy",content:n.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_DISABLED_COPY_LINK_BUTTON_POPUP"),offsetLeft:this.copyLinkButtonContainer.offsetWidth/2-t/2+40,width:t,darkMode:true,zIndex:1e3,angle:{position:"top",offset:90},cacheable:true})}createCopyLinkButton(t){const e=new BX.UI.Button({text:n.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"),round:true,icon:BX.UI.Button.Icon.COPY,size:BX.UI.Button.Size.EXTRA_SMALL,color:BX.UI.Button.Color.SUCCESS,onclick:e=>this.handleCopyLinkButtonClick(e,t)});e.setDisabled(!this.isSharingOn);return e}handleCopyLinkButtonClick(t,e){const i=this.copyLink(t,e);if(i){this.onSuccessfulCopyingLink()}}copyLink(t,e=false){return!(!e||!BX.clipboard.copy(this.makeLinkText(e)))}makeLinkText(t){return t}onSuccessfulCopyingLink(){var t,e;i.Util.showNotification(n.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));(t=this.copyLinkButton)==null?void 0:t.setText(n.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON_COPIED"));(e=this.copyLinkButton)==null?void 0:e.setIcon(BX.UI.Button.Icon.DONE);if(this.copyLinkButtonTimeoutId){clearTimeout(this.copyLinkButtonTimeoutId)}this.copyLinkButtonTimeoutId=setTimeout((()=>{var t,e;(t=this.copyLinkButton)==null?void 0:t.setIcon(BX.UI.Button.Icon.COPY);(e=this.copyLinkButton)==null?void 0:e.setText(n.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"))}),3e3)}createPreviewBlock(){this.previewBlock=this.createBlock();n.Dom.addClass(this.previewBlock,"calendar-sharing-dialog-block-preview-section");n.Dom.append(this.createPreviewBlockQr(),this.previewBlock);n.Dom.append(this.createPreviewBlockAnnotation(),this.previewBlock);return this.previewBlock}createPreviewBlockQr(){this.previewBlockQr=n.Tag.render(C||(C=h`
			<div class="calendar-sharing-dialog-preview-block-qr-container"></div>
		`));this.QRCode=new QRCode(this.previewBlockQr,{text:this.links[0].url,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});if(!this.isSharingOn){n.Dom.addClass(this.previewBlockQr,"calendar-sharing-dialog-preview-block-qr-container-blurred")}return this.previewBlockQr}createPreviewBlockAnnotation(){this.previewBlockAnnotation=n.Tag.render(w||(w=h`
			<div class="calendar-sharing-dialog-preview-block-annotation"></div>
		`));n.Dom.append(this.createPreviewBlockAnnotationItem(),this.previewBlockAnnotation);return this.previewBlockAnnotation}createPreviewBlockAnnotationItem(){const t=n.Tag.render(v||(v=h`
			<div class="calendar-sharing-dialog-preview-block-annotation-item"></div>
		`));const e='<a class="calendar-sharing-dialog-preview-block-annotation-link">'+n.Loc.getMessage("SHARING_DIALOG_PREVIEW_BLOCK_CONTENT_LINK")+"</a>";const i=n.Tag.render(L||(L=h`
			<span>${0}</span>
		`),n.Loc.getMessage("SHARING_DIALOG_PREVIEW_BLOCK_CONTENT",{"#LINK#":e}));n.Dom.append(i,t);this.previewBlockAnnotationLink=t.querySelector(".calendar-sharing-dialog-preview-block-annotation-link");if(this.previewBlockAnnotationLink){if(!this.isSharingOn){n.Dom.addClass(this.previewBlockAnnotationLink,"calendar-sharing-dialog-preview-block-annotation-link-disabled")}n.Event.bind(this.previewBlockAnnotationLink,"click",(()=>{this.openNewTab()}))}return t}enableLinks(){var t;(t=this.links)==null?void 0:t.forEach((t=>{t.active=true}))}openNewTab(){window.open(n.Text.encode(this.links[0].url),"_blank")}toggle(){this.popup.toggle()}}let I=t=>t,_,b,D,T,m,P,E;class f{constructor(t={}){this.HELP_DESK_CODE=17198666;this.wrap=t.wrap;this.userId=t.userId;this.subscribeToEvents()}subscribeToEvents(){e.EventEmitter.subscribe("Calendar.Sharing.copyLinkButtonContainer:onMouseEnter",(()=>this.handleCopyLinkButtonContainerMouseEnter()));e.EventEmitter.subscribe("Calendar.Sharing.Dialog:onClose",(()=>this.handleSharingDialogClose()))}show(){this.button=new BX.UI.Button({text:n.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:BX.UI.Button.Size.EXTRA_SMALL,color:BX.UI.Button.Color.LIGHT_BORDER,className:"ui-btn-themes calendar-sharing__btn",onclick:(t,e)=>{if(!this.switcher.getNode().contains(e.target)){this.handleSharingButtonClick()}},events:{mouseenter:()=>this.handleSharingButtonMouseEnter(),mouseleave:()=>this.handleSharingButtonMouseLeave()}});this.button.renderTo(this.wrap);this.renderSwitcher()}handleCopyLinkButtonContainerMouseEnter(){var t;if(!((t=this.switcher)!=null&&t.disabled)&&!this.switcherSpotlight){this.showSwitcherSpotlight()}}handleSharingDialogClose(){this.hideSwitcherSpotlight()}showSwitcherSpotlight(){this.switcherSpotlight=new BX.SpotLight({targetElement:this.switcherWrap,targetVertex:"middle-center",left:-17,top:-5,lightMode:true,events:{onTargetEnter:()=>{this.hideSwitcherSpotlight()}}});this.switcherSpotlight.show()}hideSwitcherSpotlight(){if(this.switcherSpotlight){this.switcherSpotlight.close();this.switcherSpotlight=null}}handleSharingButtonClick(){this.clearInfoPopupShowTimeOut();this.getSharingDialog().toggle()}handleSharingButtonMouseEnter(){var t;if(!((t=this.sharingDialog)!=null&&t.isShown())&&!this.switcher.isChecked()){this.infoPopupShowTimeout=setTimeout((()=>this.showInfoPopup()),1e3)}}handleSharingButtonMouseLeave(){this.clearInfoPopupShowTimeOut()}clearInfoPopupShowTimeOut(){if(this.infoPopupShowTimeout){clearTimeout(this.infoPopupShowTimeout);this.infoPopupShowTimeout=null}}showInfoPopup(){var t;if((t=this.sharingDialog)!=null&&t.isShown()){return}if(this.infoPopup){this.infoPopup.destroy()}const e=320;this.infoPopup=new BX.Main.Popup({bindElement:this.button.getContainer(),width:e,padding:15,autoHide:true,closeByEsc:true,closeIcon:true,content:this.getInfoPopupContent(),angle:{offset:e/2},offsetLeft:this.button.getContainer().offsetWidth/2-e/2.5});this.infoPopup.show()}getInfoPopupContent(){const t=n.Tag.render(_||(_=I`<div></div>`));const e=n.Tag.render(b||(b=I`
			<div class="calendar-sharing__info-popup_main-content">
				${0}
			</div>
		`),n.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_1"));n.Dom.append(e,t);const i=n.Tag.render(D||(D=I`
			<div class="calendar-sharing__info-popup_main-content">
				${0}
			</div>
		`),n.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_2"));n.Dom.append(i,t);const o=n.Tag.render(T||(T=I`
			<a class="calendar-sharing__info-popup_detail-link">
				${0}
			</a>
		`),n.Loc.getMessage("SHARING_DIALOG_MORE_DETAILED"));n.Event.bind(o,"click",(()=>this.handleDetailLinkClick()));n.Dom.append(o,t);return t}handleDetailLinkClick(){this.openHelpDesk()}openHelpDesk(){top.BX.Helper.show("redirect=detail&code="+this.HELP_DESK_CODE)}getSharingDialog(){if(!this.sharingDialog){this.sharingDialog=new S({bindElement:this.button.getContainer(),userId:this.userId,isSwitchCheckedOnStart:this.switcher.isChecked(),switcherNode:this.switcher.getNode()})}return this.sharingDialog}getSwitcherContainer(){const t=n.Tag.render(m||(m=I`
			<div class="calendar-sharing__switcher">
				
			</div>
		`));return t}getSwitcherDivider(){const t=n.Tag.render(P||(P=I`
			<div class="calendar-sharing__switcher_divider"></div>
		`));return t}renderSwitcher(){var t;n.Dom.append(this.getSwitcherDivider(),this.button.button);this.switcherWrap=n.Tag.render(E||(E=I`<div class="calendar-sharing__switcher-wrap"></div>`));n.Dom.append(this.switcherWrap,this.button.button);n.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:((t=i.Util.getSharingConfig())==null?void 0:t.isEnabled)==="true",color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(t){if(this.switcher.isChecked()){this.showWarningPopup();t.stopPropagation()}}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new BX.UI.Dialogs.MessageBox({title:n.Loc.getMessage("SHARING_WARNING_POPUP_TITLE"),message:n.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:true,closeIcon:true,minWidth:365,maxWidth:365}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new BX.UI.Button({size:BX.UI.Button.Size.MEDIUM,color:BX.UI.Button.Color.DANGER,text:n.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new BX.UI.Button({size:BX.UI.Button.Size.MEDIUM,color:BX.UI.Button.Color.LIGHT_BORDER,text:n.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}handleSwitcherToggled(){if(this.switcher.isChecked()){const t=this.getSharingDialog();if(!t.isShown()){t.toggle()}t.enableLinks();e.EventEmitter.emit("Calendar.Sharing.copyLinkButton:onSwitchToggled",this.switcher.isChecked())}else{BX.ajax.runAction("calendar.api.sharingajax.deleteUserLinks");this.getSharingDialog().destroy();this.sharingDialog=null;this.warningPopup.close()}BX.userOptions.save("calendar","sharing","isEnabled",this.switcher.isChecked())}}class O{constructor(t){this.buttonWrap=t.buttonWrap;this.userId=t.userId}showSharingButton(){this.sharingButton=new f({wrap:this.buttonWrap,userId:this.userId});this.sharingButton.show()}}t.Interface=O;t.SharingButton=f;t.Checkbox=r;t.Dialog=S})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.Event,BX.Calendar,BX);
//# sourceMappingURL=interface.bundle.map.js