this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,s,i,a,r,o,n,l,h,d,c,p,g){"use strict";let u=e=>e,_,T;var b=babelHelpers.classPrivateFieldLooseKey("popup");var E=babelHelpers.classPrivateFieldLooseKey("loader");var P=babelHelpers.classPrivateFieldLooseKey("layout");var N=babelHelpers.classPrivateFieldLooseKey("qrCode");var w=babelHelpers.classPrivateFieldLooseKey("context");class L{constructor(e){this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=null;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null;babelHelpers.classPrivateFieldLooseBase(this,P)[P]={qr:null};babelHelpers.classPrivateFieldLooseBase(this,N)[N]=null;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e.context;this.sharingUrl=e.sharingUrl}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new r.Popup({className:"calendar-sharing__qr",width:315,padding:0,content:this.getContent(),closeIcon:true,closeByEsc:true,autoHide:true,overlay:true,animation:"fading-slide"})}return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getLoader(){if(!babelHelpers.classPrivateFieldLooseBase(this,E)[E]){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new o.Loader({size:95})}return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}getNodeQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P].qr){babelHelpers.classPrivateFieldLooseBase(this,P)[P].qr=a.Tag.render(_||(_=u`
				<div class="calendar-sharing__qr-block"></div>
			`));this.getLoader().show(babelHelpers.classPrivateFieldLooseBase(this,P)[P].qr);this.showQr()}return babelHelpers.classPrivateFieldLooseBase(this,P)[P].qr}async showQr(){await this.initQrCode();this.QRCode=new QRCode(babelHelpers.classPrivateFieldLooseBase(this,P)[P].qr,{text:this.sharingUrl,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});await this.getLoader().hide()}async initQrCode(){await a.Runtime.loadExtension(["main.qrcode"])}getContent(){return a.Tag.render(T||(T=u`
			<div class="calendar-sharing__qr-content">
				<div class="calendar-sharing__qr-title">${0}</div>
				${0}
				<div class="calendar-sharing__qr-info">${0}</div>
				<a class="calendar-sharing__dialog-link" href="${0}" target="_blank">${0}</a>
			</div>
		`),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_QR_TITLE"),this.getNodeQr(),a.Loc.getMessage("SHARING_INFO_POPUP_QR_INFO"),this.sharingUrl,a.Loc.getMessage("SHARING_INFO_POPUP_QR_OPEN_LINK"))}isShown(){return this.getPopup().isShown()}close(){this.getPopup().close()}show(){this.getPopup().show()}destroy(){this.getPopup().destroy()}getPhraseDependsOnContext(e){return a.Loc.getMessage(e+"_"+babelHelpers.classPrivateFieldLooseBase(this,w)[w].toUpperCase())}}let v=e=>e,A,O,B,C;var F=babelHelpers.classPrivateFieldLooseKey("popup");var I=babelHelpers.classPrivateFieldLooseKey("layout");var H=babelHelpers.classPrivateFieldLooseKey("dialogQr");var S=babelHelpers.classPrivateFieldLooseKey("context");class f{constructor(e){this.HELP_DESK_CODE_CALENDAR=17198666;this.HELP_DESK_CODE_CRM=17502612;Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=null;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=null;babelHelpers.classPrivateFieldLooseBase(this,I)[I]={wrapper:null,contentTop:null,contentBody:null,contentBottom:null,buttonCopy:null};babelHelpers.classPrivateFieldLooseBase(this,S)[S]=e.context;this.bindElement=e.bindElement||null;this.sharingUrl=e.sharingUrl||null}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new r.Popup({bindElement:this.bindElement,className:"calendar-sharing__dialog",closeByEsc:true,autoHide:true,padding:0,width:470,angle:{offset:this.bindElement.offsetWidth/2+16},autoHideHandler:e=>this.autoHideHandler(e),content:this.getPopupWrapper(),animation:"fading-slide",events:{onPopupShow:()=>this.bindElement.classList.add("ui-btn-hover"),onPopupClose:()=>this.bindElement.classList.remove("ui-btn-hover")}})}return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}autoHideHandler(e){var t;return!babelHelpers.classPrivateFieldLooseBase(this,I)[I].wrapper.contains(e.target)&&!((t=babelHelpers.classPrivateFieldLooseBase(this,H)[H])!=null&&t.isShown())}getDialogQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H]){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new L({sharingUrl:this.sharingUrl,context:babelHelpers.classPrivateFieldLooseBase(this,S)[S]})}return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}getPopupWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I].wrapper){babelHelpers.classPrivateFieldLooseBase(this,I)[I].wrapper=a.Tag.render(A||(A=v`
				<div class="calendar-sharing__dialog-wrapper">
					${0}
					<div class="calendar-sharing__dialog-body">
						<div class="calendar-sharing__dialog-userpic"></div>
						<div class="calendar-sharing__dialog-notify">
							<div class="calendar-sharing__dialog-notify_content">
								${0}
							</div>
						</div>
					</div>
					${0}
				</div>
			`),this.getPopupContentTop(),a.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_4",{"#LINK#":this.sharingUrl}),this.getPopupContentBottom())}return babelHelpers.classPrivateFieldLooseBase(this,I)[I].wrapper}getPopupCopyLinkButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I].buttonCopy){babelHelpers.classPrivateFieldLooseBase(this,I)[I].buttonCopy=a.Tag.render(O||(O=v`
				<span onclick="${0}" class="ui-btn ui-btn-success ui-btn-round ui-btn-no-caps">${0}</span>
			`),this.adjustSave.bind(this),a.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"))}return babelHelpers.classPrivateFieldLooseBase(this,I)[I].buttonCopy}adjustSave(){if(this.copyLink()){this.onSuccessfulCopyingLink()}}copyLink(){let e=false;if(this.sharingUrl){e=BX.clipboard.copy(this.sharingUrl)}if(e){h.Util.showNotification(a.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));i.EventEmitter.emit("CalendarSharing:LinkCopied")}return e}onSuccessfulCopyingLink(){this.getPopup().close()}getPopupContentBottom(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentBottom){const e=()=>{this.getDialogQr().show()};babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentBottom=a.Tag.render(B||(B=v`
				<div class="calendar-sharing__dialog-bottom">
					${0}
					<span onclick="${0}" class="calendar-sharing__dialog-link">${0}</span>
				</div>
			`),this.getPopupCopyLinkButton(),e,a.Loc.getMessage("SHARING_INFO_POPUP_WHAT_SEE_USERS"))}return babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentBottom}getPopupContentTop(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentTop){const e=()=>{top.BX.Helper.show("redirect=detail&code="+this.getHelpDeskCodeDependsOnContext())};babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentTop=a.Tag.render(C||(C=v`
				<div class="calendar-sharing__dialog-top">
					<div class="calendar-sharing__dialog-title">
						<span>${0}</span>
						<span onclick="${0}" class="calendar-sharing__dialog-title-help"  title="${0}"></span>
					</div>
					<div class="calendar-sharing__dialog-info">${0}</div>
				</div>
			`),a.Loc.getMessage("SHARING_BUTTON_TITLE"),e,a.Loc.getMessage("SHARING_INFO_POPUP_HOW_IT_WORK"),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_CONTENT_3")+" ");const t=babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentTop.querySelector('[ data-role="calendar-sharing_popup-open-link"]');if(t){let e;let s;t.addEventListener("mouseenter",(()=>{s=setTimeout((()=>{if(!e){e=new r.Popup({bindElement:t,angle:{offset:t.offsetWidth/2+16},width:410,darkMode:true,content:a.Loc.getMessage("SHARING_INFO_POPUP_SLOT_DESC"),animation:"fading-slide"})}e.show()}),1e3)}));t.addEventListener("mouseleave",(()=>{clearTimeout(s);if(e){e.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,I)[I].contentTop}isShown(){return this.getPopup().isShown()}show(){if(!this.bindElement){console.warn('BX.Calendar.Sharing: "bindElement" is not defined');return}this.getPopup().show()}destroy(){this.getPopup().destroy();this.getDialogQr().destroy()}getPhraseDependsOnContext(e){return a.Loc.getMessage(e+"_"+babelHelpers.classPrivateFieldLooseBase(this,S)[S].toUpperCase())}getHelpDeskCodeDependsOnContext(){let e=0;switch(babelHelpers.classPrivateFieldLooseBase(this,S)[S]){case"calendar":{e=this.HELP_DESK_CODE_CALENDAR;break}case"crm":{e=this.HELP_DESK_CODE_CRM;break}}return e}}let R=e=>e,D,m,U;class y{constructor(e={}){var t;this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY=1e3;this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST="first-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_NEW="new-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND="remind-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_NEW,this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS=[...this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS,...this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS];this.wrap=e.wrap;this.userId=e.userId;this.sharingConfig=h.Util.getSharingConfig();this.sharingUrl=((t=this.sharingConfig)==null?void 0:t.url)||null;this.payAttentionToNewFeatureMode=e.payAttentionToNewFeature;this.sharingFeatureLimit=e.sharingFeatureLimit}show(){a.Dom.addClass(this.wrap,"calendar-sharing__btn-wrap");this.button=new t.Button({text:a.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:t.ButtonSize.EXTRA_SMALL,color:t.ButtonColor.LIGHT_BORDER,icon:this.sharingFeatureLimit?t.ButtonIcon.LOCK:null,className:"ui-btn-themes calendar-sharing__btn",onclick:(e,t)=>{if(!this.switcher.getNode().contains(t.target)){this.handleSharingButtonClick()}}});this.button.renderTo(this.wrap);this.renderSwitcher();if(this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS.includes(this.payAttentionToNewFeatureMode)){this.payAttentionToNewFeature(this.payAttentionToNewFeatureMode);BX.ajax.runAction("calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature")}}handleSharingButtonClick(){if(this.sharingFeatureLimit){top.BX.UI.InfoHelper.show("limit_office_calendar_free_slots");return}if(!this.isSharingEnabled()){this.switcher.toggle()}else{this.openDialog()}}getSwitcherContainer(){return a.Tag.render(D||(D=R`
			<div class="calendar-sharing__switcher"></div>
		`))}getSwitcherDivider(){return a.Tag.render(m||(m=R`
			<div class="calendar-sharing__switcher_divider"></div>
		`))}renderSwitcher(){a.Dom.append(this.getSwitcherDivider(),this.wrap);this.switcherWrap=a.Tag.render(U||(U=R`<div class="calendar-sharing__switcher-wrap"></div>`));a.Dom.append(this.switcherWrap,this.wrap);a.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:this.isSharingEnabled()&&!this.sharingFeatureLimit,color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(e){if(this.switcher.isChecked()){this.showWarningPopup();e.stopPropagation()}}handleSwitcherToggled(){if(this.sharingFeatureLimit&&this.switcher.isChecked()){top.BX.UI.InfoHelper.show("limit_office_calendar_free_slots");this.switcher.toggle();return}if(this.isToggledAfterErrorOccurred()){return}if(this.switcher.isChecked()){this.enableSharing()}else{this.disableSharing()}}isToggledAfterErrorOccurred(){return this.switcher.isChecked()===this.isSharingEnabled()}isSharingEnabled(){return a.Type.isString(this.sharingUrl)}enableSharing(){const e="calendar.api.sharingajax.enableUserSharing";const t="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction(e).then((e=>{this.sharingUrl=e.data.url;this.openDialog();i.EventEmitter.emit(t,{isChecked:this.switcher.isChecked(),url:e.data.url})})).catch((()=>{this.switcher.toggle()}))}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();a.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new f({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,context:"calendar"})}if(!this.newDialog.isShown()){this.newDialog.show();this.newDialog.copyLink()}}disableSharing(){const e="calendar.api.sharingajax.disableUserSharing";const t="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction(e).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}i.EventEmitter.emit(t,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new s.MessageBox({title:a.Loc.getMessage("SHARING_WARNING_POPUP_TITLE_1"),message:a.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT_1"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:365,minHeight:180}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new t.Button({size:t.ButtonSize.MEDIUM,color:t.ButtonColor.DANGER,text:a.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new t.Button({size:t.ButtonSize.MEDIUM,color:t.ButtonColor.LIGHT_BORDER,text:a.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}payAttentionToNewFeature(e){if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithoutText()}if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithText(e)}}payAttentionToNewFeatureWithoutText(){this.pulsar=this.getPulsar(this.wrap,false);this.pulsar.show();a.Event.bind(this.pulsar.container,"click",(()=>{this.handleSharingButtonClick()}));this.counterNode=new g.Counter({value:1,color:g.Counter.Color.DANGER,size:g.Counter.Size.MEDIUM,animation:false}).getContainer();a.Dom.addClass(this.counterNode,"calendar-sharing__new-feature-counter");a.Dom.append(this.counterNode,this.wrap)}payAttentionToNewFeatureWithText(e){let t=a.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TITLE");let s=a.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TEXT");if(e===this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND){t=a.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TITLE");s=a.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TEXT")}const i=this.getGuide(t,s);const r=this.getPulsar(this.wrap);setTimeout((()=>{i.showNextStep();i.getPopup().setAngle({offset:210});r.show()}),this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY)}getGuide(e,t){const s=new p.Guide({simpleMode:true,onEvents:true,steps:[{target:this.wrap,title:e,text:t,position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});const i=s.getPopup();a.Dom.addClass(i.popupContainer,"calendar-popup-ui-tour-animate");i.setWidth(400);i.getContentContainer().style.paddingRight=getComputedStyle(i.closeIcon)["width"];return s}getPulsar(e,t=true){const s=new BX.SpotLight({targetElement:e,targetVertex:"middle-center",lightMode:true});if(t){s.bindEvents({onTargetEnter:()=>s.close()})}return s}}class W{constructor(e){var t,s;this.buttonWrap=e.buttonWrap;this.userId=e.userId;this.payAttentionToNewFeature=(t=e.payAttentionToNewFeature)!=null?t:false;this.sharingFeatureLimit=(s=e.sharingFeatureLimit)!=null?s:false}showSharingButton(){this.sharingButton=new y({wrap:this.buttonWrap,userId:this.userId,payAttentionToNewFeature:this.payAttentionToNewFeature,sharingFeatureLimit:this.sharingFeatureLimit});this.sharingButton.show()}}e.Interface=W;e.SharingButton=y;e.DialogNew=f;e.DialogQr=L})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.UI,BX.UI.Dialogs,BX.Event,BX,BX.Main,BX,BX,BX,BX.Calendar,BX.UI,BX,BX.UI.Tour,BX.UI);
//# sourceMappingURL=interface.bundle.map.js