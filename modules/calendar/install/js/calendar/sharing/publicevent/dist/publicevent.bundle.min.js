this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(t,e,n,i,a,s){"use strict";const r={props:{eventInfo:Object,currentMeetingStatus:String,isDeclined:Boolean,isDeleted:Boolean,showHost:Boolean},data(){return{loc:{today:i.Loc.getMessage("CALENDAR_SHARING_EVENT_TODAY"),tomorrow:i.Loc.getMessage("CALENDAR_SHARING_EVENT_TOMORROW")}}},computed:{ownerStatusText(){const t="CALENDAR_SHARING_EVENT_OWNER_STATUS_"+this.currentMeetingStatus.toUpperCase();return i.Loc.getMessage(t)}},methods:{getEventWeekDayShort(){return n.DateTimeFormat.format("D",this.eventInfo.dateFrom.getTime()/1e3).toLowerCase()},getEventDate(){let t="";const e=s.Util.getDayMonthFormat();const i=new Date;const a=new Date(this.eventInfo.dateFrom.getFullYear(),this.eventInfo.dateFrom.getMonth(),this.eventInfo.dateFrom.getDate());if(i.getTime()>a.getTime()&&i.getTime()<a.getTime()+86e6){t=this.loc.today}else if(i.getTime()<a.getTime()&&i.getTime()>a.getTime()-86e6){t=this.loc.tomorrow}else{t=n.DateTimeFormat.format("l",this.eventInfo.dateFrom.getTime()/1e3).toLowerCase()}return n.DateTimeFormat.format(e,this.eventInfo.dateFrom.getTime()/1e3)+", "+t},getEventTime(){return s.Util.formatTimeInterval(this.eventInfo.dateFrom,this.eventInfo.dateTo)},downloadIcsFile(){this.$Bitrix.eventEmitter.emit("calendar:sharing:downloadIcsFile")}},template:`\n\t\t<div class="calendar-shared-event__head">\n\t\t\t<div class="calendar-shared-event__icon" :class="{'--cancel': this.isDeclined && !this.isDeleted}">\n\t\t\t\t<div\n\t\t\t\t\tclass="calendar-shared-event__icon_status" \n\t\t\t\t\t:class="\n\t\t\t\t\t{\n\t\t\t\t\t\t'--approved': this.currentMeetingStatus === 'Y',\n\t\t\t\t\t\t'--cancel': this.currentMeetingStatus === 'N',\n\t\t\t\t\t}"\n\t\t\t\t\tv-if="!isDeleted"\n\t\t\t\t></div>\n\t\t\t\t<div class="calendar-shared-event__icon_text">{{ this.getEventWeekDayShort() }}</div>\n\t\t\t\t<div class="calendar-shared-event__icon_num">{{ this.eventInfo.dateFrom.getDate() }}</div>\n\t\t\t</div>\n\t\t\t<div class="calendar-shared-event__head_data">\n\t\t\t\t<div class="calendar-shared-event_title">{{ eventInfo.name }}</div>\n\t\t\t\t<div class="calendar-shared-event_start">{{ this.getEventDate() }}</div>\n\t\t\t\t<div class="calendar-shared-event_time-container">\n\t\t\t\t\t<div class="calendar-shared-event_end">{{ this.getEventTime() }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-shared-event_timezone">{{ eventInfo.timezone }}</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="calendar-shared-event_owner-status"\n\t\t\t\t\t:class="\n\t\t\t\t\t{\n\t\t\t\t\t\t'--accepted': this.currentMeetingStatus === 'Y',\n\t\t\t\t\t\t'--declined': this.currentMeetingStatus === 'N',\n\t\t\t\t\t}"\n\t\t\t\t\tv-if="!isDeleted"\n\t\t\t\t>\n\t\t\t\t\t{{ ownerStatusText }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="calendar-shared-event_ics"\n\t\t\t\t\t@click="downloadIcsFile"\n\t\t\t\t\tv-if="!isDeclined && !isDeleted"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CALENDAR_SHARING_EVENT_ICS') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-shared-event-host-info calendar-shared-event__list_item calendar-shared-event__list_item&#45;&#45;extranet" v-if="showHost">\n\t\t\t\t\t<div class="ui-icon ui-icon-common-user ui-icon-common-user-sharing"><i></i></div>\n\t\t\t\t\t<a :href="'/company/personal/user/' + eventInfo.hostId + '/'" target="_blank" class="calendar-shared-event__list_name">{{ eventInfo.hostName }}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const o={template:`\n\t\t<div class="calendar-sharing-event__loader_box">\n\t\t\t<svg class="calendar-sharing-event_circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="calendar-sharing-event_path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t</div>\n\t`};let c=t=>t,l,d,u;const h={props:{link:Object,event:Object,owner:Object,ownerMeetingStatus:String,action:String,abuseLink:String},components:{EventInfo:r,Loader:o},data(){return{deleteButton:{text:i.Loc.getMessage("CALENDAR_SHARING_EVENT_DELETE_BUTTON"),disabled:false},conferenceButton:{text:i.Loc.getMessage("CALENDAR_SHARING_EVENT_CONFERENCE"),disabled:false},icsButton:{text:i.Loc.getMessage("CALENDAR_SHARING_EVENT_ICS"),disabled:false},returnButton:{text:i.Loc.getMessage("CALENDAR_SHARING_EVENT_RETURN_BUTTON"),disabled:false},acceptedMeetingStatuses:["Q","Y","N"],nowTimezoneOffset:(new Date).getTimezoneOffset()*6e4,nowTimeInUtc:new Date((new Date).getTime()+(new Date).getTimezoneOffset()*6e4),currentMeetingStatus:this.ownerMeetingStatus,currentTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,isDeleted:false,isDeclined:false,conferenceError:false,warningPopup:null,loadingProcess:false,eventInfo:{}}},created(){this.$Bitrix.eventEmitter.subscribe("calendar:sharing:downloadIcsFile",(()=>{this.downloadIcsFile()}));this.eventInfo={dateFrom:s.Util.getTimezoneDateFromTimestampUTC(parseInt(this.event.timestampFromUTC)*1e3,this.currentTimezone),dateTo:s.Util.getTimezoneDateFromTimestampUTC(parseInt(this.event.timestampToUTC)*1e3,this.currentTimezone),timezone:s.Util.getFormattedTimezone(this.currentTimezone),name:this.event.name,type:this.event.eventType};if(!this.acceptedMeetingStatuses.includes(this.currentMeetingStatus.toUpperCase())){this.currentMeetingStatus="Q"}if(this.currentMeetingStatus==="N"){this.isDeclined=true}if(this.action==="cancel"){this.showConfirmPopup()}if(this.action==="videoconference"){this.handleConferenceButtonClick()}if(this.action==="ics"){this.downloadIcsFile()}this.setPageVisualSettings()},methods:{async downloadIcsFile(){if(!this.icsFile){const t=await BX.ajax.runAction("calendar.api.sharingajax.getIcsFileContent",{data:{eventLinkHash:this.link.hash}});this.icsFile=t.data}s.Util.downloadIcsFile(this.icsFile,"event")},enableButton(t){t.disabled=false},disableButton(t){t.disabled=true},setPageVisualSettings(){const t=document.querySelector("html");const e=document.querySelector("body");if(!i.Dom.hasClass(t,"calendar-sharing--public-html")){i.Dom.addClass(t,"calendar-sharing--public-html")}if(!i.Dom.hasClass(e,"calendar-sharing--public-body")){i.Dom.addClass(e,"calendar-sharing--public-body")}if(this.isDeclined){i.Dom.addClass(t,"calendar-sharing--bg-red")}else{i.Dom.addClass(t,"calendar-sharing--bg-blue")}if(s.Util.isMobileBrowser()){if(!i.Dom.hasClass(e,"calendar-sharing--public-body-mobile")){i.Dom.addClass(e,"calendar-sharing--public-body-mobile")}if(!i.Dom.hasClass(t,"calendar-sharing--public-html-mobile")){i.Dom.addClass(t,"calendar-sharing--public-html-mobile")}}},showConfirmPopup(){if(!this.warningPopup){this.warningPopup=new a.Popup({content:this.getConfirmPopupContent(),width:351,lightShadow:true,animation:"fading-slide",contentBackground:"#fff",overlay:{opacity:50},zIndexAbsolute:3100,cacheable:false,closeByEsc:true,draggable:true,borderRadius:"20px",events:{onPopupClose:this.closePopup.bind(this)}})}this.warningPopup.show()},getConfirmPopupContent(){return i.Tag.render(l||(l=c`
				<div class="calendar-sharing-confirm-popup__container">
					<div class="calendar-sharing-confirm-popup__title">
						${0}
					</div>
					<div class="ui-btn-container ui-btn-container-center calendar-shared-event_btn-box">
						${0}
						${0}
					</div>
				</div>
			`),i.Loc.getMessage("CALENDAR_SHARING_EVENT_CONFIRM_MESSAGE"),this.getConfirmSubmitButton(),this.getConfirmCancelButton())},getConfirmSubmitButton(){if(!this.submitPopupButton){this.submitPopupButton=i.Tag.render(d||(d=c`
				<button class="ui-btn ui-btn-success ui-btn-round">
					${0}
				</button>
			`),i.Loc.getMessage("CALENDAR_SHARING_EVENT_CONFIRM_SUBMIT_BUTTON"));i.Event.bind(this.submitPopupButton,"click",this.handleDeleteButtonClick)}return this.submitPopupButton},getConfirmCancelButton(){if(!this.cancelPopupButton){this.cancelPopupButton=i.Tag.render(u||(u=c`
				<button class="ui-btn ui-btn-light-border ui-btn-round">
					${0}
				</button>
			`),i.Loc.getMessage("CALENDAR_SHARING_EVENT_CONFIRM_CANCEL_BUTTON"));i.Event.bind(this.cancelPopupButton,"click",this.closePopup)}return this.cancelPopupButton},closePopup(){if(this.warningPopup){this.warningPopup.destroy();this.warningPopup=null}},async handleDeleteButtonClick(){this.loadingProcess=true;if(this.warningPopup){this.warningPopup.close()}this.disableButton(this.deleteButton);const t=await this.deleteEvent();this.enableButton(this.deleteButton);this.loadingProcess=false;if(t){const t=document.querySelector("html");i.Dom.removeClass(t,"calendar-sharing--bg-blue");i.Dom.addClass(t,"calendar-sharing--bg-red");this.isDeleted=true}},async deleteEvent(){let t=null;try{t=await BX.ajax.runAction("calendar.api.sharingajax.deleteEvent",{data:{eventId:this.event.id,eventLinkHash:this.link.hash}})}catch(e){t=e}return t.errors.length===0},handleReturnButtonClick(){this.disableButton(this.returnButton);if(this.link.parentLinkHash){const t="/pub/calendar-sharing/";window.location.href=document.location.origin+t+this.link.parentLinkHash}this.enableButton(this.returnButton)},isSharedCrmEvent(){return this.eventInfo.type==="#shared_crm#"},async handleConferenceButtonClick(){this.disableButton(this.conferenceButton);const t=await this.connectToConference();this.enableButton(this.conferenceButton);if(t){window.location.href=t}else{this.conferenceError=true}},async connectToConference(){var t;let e=null;try{e=await BX.ajax.runAction("calendar.api.sharingajax.getConferenceLink",{data:{eventLinkHash:this.link.hash}})}catch(t){e=t}return((t=e.data)==null?void 0:t.conferenceLink)||null}},template:`\n\t\t<div class="calendar-shared-event-container" v-if="!isDeleted">\n\t\t\t<div>\n\t\t\t\t<EventInfo\n\t\t\t\t\t:event-info="eventInfo"\n\t\t\t\t\t:current-meeting-status="currentMeetingStatus"\n\t\t\t\t\t:is-declined="isDeclined"\n\t\t\t\t\t:is-deleted="isDeleted"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="calendar-shared-event__list">\n\t\t\t\t\t<div class="calendar-shared-event__list_inner">\n\t\t\t\t\t\t<div class="calendar-shared-event__list_invited">\n\t\t\t\t\t\t\t<div class="calendar-shared-event__list_title">{{ $Bitrix.Loc.getMessage('CALENDAR_SHARING_EVENT_YOU_INVITED') }}</div>\n\t\t\t\t\t\t\t<div class="calendar-shared-event__list_item">\n\t\t\t\t\t\t\t\t<div class="ui-icon ui-icon-common-user">\n\t\t\t\t\t\t\t\t\t<img class="calendar-shared-event__list_icon" :src="owner.photo" alt="" v-if="owner.photo">\n\t\t\t\t\t\t\t\t\t<i class="calendar-shared-event__list_icon" v-else></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-shared-event__list_name">\n\t\t\t\t\t\t\t\t\t{{ owner.name }} {{ owner.lastName}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\x3c!--\t\t\t\t\t\t<div class="calendar-shared-event__list_members">--\x3e\n\x3c!--\t\t\t\t\t\t\t<div class="calendar-shared-event__list_title">More members</div>--\x3e\n\x3c!--\t\t\t\t\t\t\t<div class="calendar-shared-event__list_item calendar-shared-event__list_item&#45;&#45;email">--\x3e\n\x3c!--\t\t\t\t\t\t\t\t<div class="calendar-shared-event__list_icon"></div>--\x3e\n\x3c!--\t\t\t\t\t\t\t\t<div class="calendar-shared-event__list_name">Konstantin Myasnikov</div>--\x3e\n\x3c!--\t\t\t\t\t\t\t</div>--\x3e\n\x3c!--\t\t\t\t\t\t\t<div class="calendar-shared-event__list_item calendar-shared-event__list_item&#45;&#45;sms">--\x3e\n\x3c!--\t\t\t\t\t\t\t\t<div class="calendar-shared-event__list_icon"></div>--\x3e\n\x3c!--\t\t\t\t\t\t\t\t<div class="calendar-shared-event__list_name">Konstantin Myasnikov</div>--\x3e\n\x3c!--\t\t\t\t\t\t\t</div>--\x3e\n\x3c!--\t\t\t\t\t\t</div>--\x3e\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="ui-btn-container ui-btn-container-center calendar-shared-event_btn-box">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-round"\n\t\t\t\t\t\t@click="handleConferenceButtonClick"\n\t\t\t\t\t\t:disabled="conferenceButton.disabled"\n\t\t\t\t\t\tv-if="!isDeclined"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ conferenceButton.text }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-round"\n\t\t\t\t\t\t@click="showConfirmPopup"\n\t\t\t\t\t\t:disabled="deleteButton.disabled"\n\t\t\t\t\t\tv-if="!isDeclined"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ deleteButton.text }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-round"\n\t\t\t\t\t\t@click="handleReturnButtonClick"\n\t\t\t\t\t\t:disabled="returnButton.disabled"\n\t\t\t\t\t\tv-if="isDeclined && !isSharedCrmEvent"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ returnButton.text }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="calendar-shared-event-container calendar-sharing--subtract calendar-sharing--error" v-else>\n\t\t\t<div class="calendar-shared-event_icon"></div>\n\t\t\t<div class="calendar-shared-event_deleted-title">{{ $Bitrix.Loc.getMessage('CALENDAR_SHARING_EVENT_IS_DELETED') }}</div>\n\t\t\t<EventInfo\n\t\t\t\t:event-info="eventInfo"\n\t\t\t\t:current-meeting-status="currentMeetingStatus"\n\t\t\t\t:is-declined="true"\n\t\t\t\t:is-deleted="isDeleted"\n\t\t\t/>\n\t\t\t<div class="calendar-shared-event__list_item">\n\t\t\t\t<div class="ui-icon ui-icon-common-user">\n\t\t\t\t\t<img class="calendar-shared-event__list_icon" :src="owner.photo" alt="" v-if="owner.photo">\n\t\t\t\t\t<i class="calendar-shared-event__list_icon" v-else></i>\t\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-shared-event__list_name">\n\t\t\t\t\t{{ owner.name }} {{ owner.lastName}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-btn-container ui-btn-container-center calendar-shared-event_btn-box">\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-round"\n\t\t\t\t\t@click="handleReturnButtonClick"\n\t\t\t\t\t:disabled="returnButton.disabled"\n\t\t\t\t\tv-if="!isSharedCrmEvent"\n\t\t\t\t>\n\t\t\t\t\t{{ returnButton.text }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="calendar-shared-event_link-abuse" v-if="!isDeleted"\n\t\t\t v-html="$Bitrix.Loc.getMessage('CALENDAR_SHARING_EVENT_LINK_ABUSE').replace('#LINK#', this.abuseLink)">\n\t\t</div>\n\t\t<Loader v-if="loadingProcess"/>\n\t`};const v={components:{SharedEvent:h},props:{link:Object,event:Object,owner:Object,ownerMeetingStatus:String,action:String},created(){},template:`\n\t\t<SharedEvent\n\t\t\t:link="link"\n\t\t\t:event="event"\n\t\t\t:owner="owner"\n\t\t\t:ownerMeetingStatus="ownerMeetingStatus"\n\t\t\t:action="action"\n\t\t/>\n\t`};class m{constructor(t){this.link=t.link;this.event=t.event;this.owner=t.owner;this.ownerMeetingStatus=t.ownerMeetingStatus;this.action=t.action;this.abuseLink=t.abuseLink;this.rootNode=BX("calendar-sharing-event-main");this.buildView()}buildView(){this.application=e.BitrixVue.createApp(v,{link:this.link,event:this.event,owner:this.owner,ownerMeetingStatus:this.ownerMeetingStatus,action:this.action,abuseLink:this.abuseLink}).mount(this.rootNode)}}t.PublicEvent=m;t.EventInfo=r})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.Vue3,BX.Main,BX,BX.Main,BX.Calendar);
//# sourceMappingURL=publicevent.bundle.map.js