this.BX=this.BX||{};(function(t,e,i,s,n,o,r,a,l,h){"use strict";class d extends i.DateTimeControl{create(){this.DOM.dateTimeWrap=this.DOM.outerContent.querySelector(`#${this.UID}_datetime_container`);this.DOM.fromDate=this.DOM.outerContent.querySelector(`#${this.UID}_date_from`);this.DOM.toDate=this.DOM.outerContent.querySelector(`#${this.UID}_date_to`);this.DOM.fromTime=this.DOM.outerContent.querySelector(`#${this.UID}_time_from`);this.DOM.toTime=this.DOM.outerContent.querySelector(`#${this.UID}_time_to`);this.fromTimeControl=new i.TimeSelector({input:this.DOM.fromTime,onChangeCallback:this.handleTimeFromChange.bind(this)});this.toTimeControl=new i.TimeSelector({input:this.DOM.toTime,onChangeCallback:this.handleTimeToChange.bind(this)});this.DOM.fullDay=this.DOM.outerContent.querySelector(`#${this.UID}_date_full_day`);this.DOM.defTimezoneWrap=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_default_wrap`);this.DOM.defTimezone=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_default`);this.DOM.fromTz=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_from`);this.DOM.toTz=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_to`);this.DOM.tzButton=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_btn`);this.DOM.tzOuterCont=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_wrap`);this.DOM.tzCont=this.DOM.outerContent.querySelector(`#${this.UID}_timezone_inner_wrap`);this.DOM.outerContent.querySelector(`#${this.UID}_timezone_hint`).title=e.Loc.getMessage("EC_EVENT_TZ_HINT");this.DOM.outerContent.querySelector(`#${this.UID}_timezone_default_hint`).title=e.Loc.getMessage("EC_EVENT_TZ_DEF_HINT");this.prepareModel();this.bindEventHandlers();if(BX.isAmPmMode()){this.DOM.fromTime.style.minWidth="8em";this.DOM.toTime.style.minWidth="8em"}else{this.DOM.fromTime.style.minWidth="6em";this.DOM.toTime.style.minWidth="6em"}}prepareModel(){e.Dom.adjust(this.DOM.fromDate,{props:{autocomplete:"off"}});e.Dom.adjust(this.DOM.toDate,{props:{autocomplete:"off"}});e.Dom.adjust(this.DOM.fromTime,{props:{autocomplete:"off"}});e.Dom.adjust(this.DOM.toTime,{props:{autocomplete:"off"}})}}let c=t=>t,u,m,p,f,y,D,g,C,E,S;class M{constructor(t={}){var i;this.DOM={};this.uid=null;this.sliderId="calendar:edit-entry-slider";this.zIndex=3100;this.denyClose=false;this.formType="slider_main";this.STATE={READY:1,REQUEST:2,ERROR:3};this.sections=[];this.sectionIndex={};this.trackingUsersList=[];this.userSettings={};this.prevUserList=[];this.loadedAccessibilityData={};this.name=t.name||"eventeditform";this.type=t.type||"user";this.isLocationCalendar=t.isLocationCalendar||false;this.locationAccess=t.locationAccess||false;this.locationCapacity=t.locationCapacity||0;this.dayOfWeekMonthFormat=t.dayOfWeekMonthFormat||false;this.roomsManager=t.roomsManager||null;this.userId=t.userId||parseInt(e.Loc.getMessage("USER_ID"));this.ownerId=t.ownerId;this.entryId=parseInt(t.entryId)||null;this.entry=t.entry||null;this.formDataValue=t.formDataValue||{};this.emitter=new r.EventEmitter;this.emitter.setEventNamespace("BX.Calendar.EventEditForm");this.BX=s.Util.getBX();this.context=(i=s.Util.getCalendarContext())!=null?i:t.calendarContext;if(!s.Util.getCalendarContext()){s.Util.setCalendarContext(this.context)}this.formSettings={pinnedFields:{}};if(!this.ownerId&&this.type==="user"){this.ownerId=this.userId}if(e.Type.isDate(t.entryDateFrom)&&!this.formDataValue.from){this.formDataValue.from=t.entryDateFrom;this.formDataValue.to=new Date(t.entryDateFrom.getTime()+3600)}this.participantsEntityList=e.Type.isArray(t.participantsEntityList)?t.participantsEntityList:[];this.participantsSelectorEntityList=e.Type.isArray(t.participantsSelectorEntityList)?t.participantsSelectorEntityList:[];if(t.entryName&&!this.entryId){this.formDataValue.name=t.entryName}if(t.entryDescription&&!this.entryId){this.formDataValue.description=t.entryDescription}this.refreshPlanner=e.Runtime.debounce(this.refreshPlannerState,100,this);this.state=this.STATE.READY;this.sliderOnClose=this.hide.bind(this);this.handlePullBind=this.handlePull.bind(this);this.keyHandlerBind=this.keyHandler.bind(this)}initInSlider(t,i){this.sliderId=t.getUrl();this.BX.addCustomEvent(t,"SidePanel.Slider:onLoad",this.onLoadSlider.bind(this));this.BX.addCustomEvent(t,"SidePanel.Slider:onClose",this.sliderOnClose);this.BX.addCustomEvent(t,"SidePanel.Slider:onBeforeCloseComplete",this.destroy.bind(this));this.setCurrentEntry(this.entry||null);this.createContent(t).then(function(t){if(e.Type.isFunction(i)){i(t)}}.bind(this));this.opened=true;this.bindEventHandlers()}show(t={}){this.setCurrentEntry(t.entry);if(t.formType){this.formType=t.formType}this.BX.SidePanel.Instance.open(this.sliderId,{contentCallback:this.createContent.bind(this),label:{text:e.Loc.getMessage("CALENDAR_EVENT"),bgColor:"#55D0E0"},events:{onClose:this.sliderOnClose,onCloseComplete:this.destroy.bind(this),onLoad:this.onLoadSlider.bind(this)}});this.opened=true;this.bindEventHandlers()}isOpened(){return this.opened}bindEventHandlers(){e.Event.bind(document,"keydown",this.keyHandlerBind);r.EventEmitter.subscribe("onPullEvent-calendar",this.handlePullBind);this.mouseUpNodeCheck=null;e.Event.bind(document,"mousedown",(t=>{this.mousedownTarget=t.target||t.srcElement}));e.Event.bind(document,"mouseup",(t=>{let e=t.target||t.srcElement;if(this.mousedownTarget!==e){this.mouseUpNodeCheck=false}setTimeout((()=>{this.mouseUpNodeCheck=null}),0)}));r.EventEmitter.subscribe("Calendar.LocationControl.onValueChange",(()=>{if(this.locationBusyAlert){e.Dom.remove(this.locationBusyAlert);this.locationBusyAlert=null}}));this.BX.addCustomEvent(window,"onCalendarControlChildPopupShown",this.BX.proxy(this.denySliderClose,this));this.BX.addCustomEvent(window,"onCalendarControlChildPopupClosed",this.BX.proxy(this.allowSliderClose,this))}onLoadSlider(t){this.slider=t.getSlider();this.DOM.content=this.slider.layout.content;this.sliderId=this.slider.getUrl();this.BX.html(this.slider.layout.content,this.slider.getData().get("sliderContent"));this.initControls(this.uid);this.setFormValues()}close(){if(!this.checkDenyClose()){this.state=this.STATE.READY;this.BX.SidePanel.Instance.close()}}save(t={}){var o,a;if(this.state===this.STATE.REQUEST){return false}t=e.Type.isPlainObject(t)?t:{};if(!this.entry.id&&this.hasExternalEmailUsers()&&s.Util.checkEmailLimitationPopup()&&!t.emailLimitationDialogShown){n.EntryManager.showEmailLimitationDialog({callback:()=>{t.emailLimitationDialogShown=true;this.save(t)}});return false}if(!this.userSettings.sendFromEmail&&this.hasExternalEmailUsers()){n.EntryManager.showConfirmedEmailDialog({callback:e=>{if(e.sendFromEmail){this.userSettings.sendFromEmail=e.sendFromEmail}this.save(t)}});return false}if(this.entry.id&&this.entry.isRecursive()&&!t.confirmed&&this.getFormDataChanges(["section","notify"]).length>0){n.EntryManager.showConfirmEditDialog({callback:t=>{this.save({recursionMode:this.entry.isFirstInstance()&&t.recursionMode==="next"?"all":t.recursionMode,confirmed:true})}});return false}if(this.entry.id&&this.entry.isMeeting()&&t.sendInvitesAgain===undefined&&this.getFormDataChanges().includes("date&time")&&this.entry.getAttendees().find((t=>t.STATUS==="N"))){n.EntryManager.showReInviteUsersDialog({callback:e=>{t.sendInvitesAgain=e.sendInvitesAgain;this.save(t)}});return false}if(this.entry.id&&this.entry.isRecursive()&&!t.confirmed&&this.getFormDataChanges().includes("section")){t.recursionMode=this.entry.isFirstInstance()?"all":"next"}e.Dom.addClass(this.DOM.saveBtn,this.BX.UI.Button.State.CLOCKING);e.Dom.addClass(this.DOM.closeBtn,this.BX.UI.Button.State.DISABLED);this.state=this.STATE.REQUEST;this.DOM.form.id.value=this.entry.id||0;this.DOM.form.location.value=this.locationSelector.getTextValue();if(this.editor){this.editor.SaveContent()}let l=this.getCurrentSection();if(l){if(l.COLOR.toLowerCase()!==this.colorSelector.getValue().toLowerCase()){this.DOM.form.color.value=this.colorSelector.getValue()}}this.DOM.form.current_date_from.value=t.recursionMode?s.Util.formatDate(this.entry.from):"";this.DOM.form.rec_edit_mode.value=t.recursionMode||"";if(t.sendInvitesAgain!==undefined){this.DOM.form.appendChild(e.Tag.render(u||(u=c`<input name="sendInvitesAgain" type="hidden" value="${0}">`),t.sendInvitesAgain?"Y":"N"))}if(!this.DOM.form.requestUid){this.DOM.requestUid=this.DOM.form.appendChild(e.Tag.render(m||(m=c`<input name="requestUid" type="hidden">`)))}if(!this.DOM.form.meeting_host){this.DOM.meeting_host=this.DOM.form.appendChild(e.Tag.render(p||(p=c`<input type="hidden" name="meeting_host" value="${0}">`),this.entry.data.MEETING_HOST||"0"))}if(!this.DOM.form.chat_id){this.DOM.chat_id=this.DOM.form.appendChild(e.Tag.render(f||(f=c`<input type="hidden" name="chat_id" value="${0}">`),this.entry.data.MEETING?this.entry.data.MEETING.CHAT_ID:0))}this.DOM.requestUid.value=s.Util.registerRequestId();const h=this.getUserSelectorEntityList();e.Dom.clean(this.DOM.userSelectorValueWarp);h.forEach(((t,i)=>{this.DOM.userSelectorValueWarp.appendChild(e.Tag.render(y||(y=c`
				<input type="hidden" name="attendeesEntityList[${0}][entityId]" value="${0}">
			`),i,t.entityId));this.DOM.userSelectorValueWarp.appendChild(e.Tag.render(D||(D=c`
				<input type="hidden" name="attendeesEntityList[${0}][id]" value="${0}">
			`),i,t.id))}));let d=!this.entry.id||this.checkCurrentUsersAccessibility();if(!d&&this.getFormDataChanges().includes("codes")){const t=this.entry.getAttendeesEntityList();h.forEach((i=>{if(!t.find((t=>i.entityId===t.entityId&&parseInt(i.id)===parseInt(t.id)))){if(i.entityId==="user"){this.DOM.userSelectorValueWarp.appendChild(e.Tag.render(g||(g=c`
							<input type="hidden" name="newAttendeesList[]" value="${0}">
						`),parseInt(i.id)))}else{d=true}}}))}this.DOM.userSelectorValueWarp.appendChild(e.Tag.render(C||(C=c`
			<input type="hidden" name="checkCurrentUsersAccessibility" value="${0}">
		`),d?"Y":"N"));this.BX.ajax.runAction("calendar.api.calendarentryajax.editEntry",{data:new FormData(this.DOM.form),analyticsLabel:{calendarAction:this.entry.id?"edit_event":"create_event",formType:"full",emailGuests:this.hasExternalEmailUsers()?"Y":"N",markView:s.Util.getCurrentView()||"outside",markCrm:(o=this.DOM.form)!=null&&o["UF_CRM_CAL_EVENT[]"]&&this.DOM.form["UF_CRM_CAL_EVENT[]"].value?"Y":"N",markRrule:(a=this.repeatSelector)==null?void 0:a.getType(),markMeeting:this.entry.isMeeting()?"Y":"N",markType:this.type}}).then((o=>{if(this.isLocationCalendar){this.roomsManager.unsetHiddenRoom(i.Location.parseStringValue(this.DOM.form.location.value).room_id)}const a=this.getCurrentSection();if(a&&this.context&&this.context.sectionManager){this.unsetHiddenSection(a,this.context.sectionManager)}this.state=this.STATE.READY;this.allowSliderClose();this.close();e.Dom.removeClass(this.DOM.closeBtn,this.BX.UI.Button.State.DISABLED);e.Dom.removeClass(this.DOM.saveBtn,this.BX.UI.Button.State.CLOCKING);if(o.data.entryId){if(this.entry.id){n.EntryManager.showEditEntryNotification(o.data.entryId)}else{n.EntryManager.showNewEntryNotification(o.data.entryId)}}if(o.data.countEventWithEmailGuestAmount){s.Util.setEventWithEmailGuestAmount(o.data.countEventWithEmailGuestAmount)}if(e.Type.isArray(o.data.eventList)&&o.data.eventList.length&&o.data.eventList[0].REMIND&&o.data.eventList[0].REMIND.length){n.EntryManager.setNewEntryReminders(o.data.eventList[0].DT_SKIP_TIME==="Y"?"fullDay":"withTime",o.data.eventList[0].REMIND)}this.emitter.emit("onSave",new r.BaseEvent({data:{responseData:o.data,options:t}}));r.EventEmitter.emit("BX.Calendar:onEntrySave",new r.BaseEvent({data:{sliderId:this.sliderId,responseData:o.data,options:t}}))}),(t=>{e.Dom.removeClass(this.DOM.saveBtn,this.BX.UI.Button.State.CLOCKING);e.Dom.removeClass(this.DOM.closeBtn,this.BX.UI.Button.State.DISABLED);if(t.data&&e.Type.isPlainObject(t.data.busyUsersList)){this.handleBusyUsersError(t.data.busyUsersList);let e=[];t.errors.forEach((t=>{if(t.code!=="edit_entry_user_busy"){e.push(t)}}));t.errors=e}if(t.errors&&t.errors.length){this.showError(t.errors)}this.state=this.STATE.ERROR}));return true}handleBusyUsersError(t){let e=[],s=[];for(let i in t){if(t.hasOwnProperty(i)){e.push(t[i]);s.push(i)}}this.busyUsersDialog=new i.BusyUsersDialog;this.busyUsersDialog.subscribe("onSaveWithout",(()=>{this.DOM.form.exclude_users.value=s.join(",");this.save()}));this.busyUsersDialog.show({users:e})}clientSideCheck(){}hide(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){if(this.checkDenyClose()){t.denyAction()}else{this.BX.removeCustomEvent("SidePanel.Slider::onClose",this.sliderOnClose);if(this.attendeesSelector){this.attendeesSelector.closeAll()}}}}destroy(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){this.BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}]);e.Event.unbind(document,"keydown",this.keyHandlerBind);r.EventEmitter.unsubscribe("onPullEvent-calendar",this.handlePullBind);this.BX.SidePanel.Instance.destroy(this.sliderId);if(i.Location){i.Location.setCurrentCapacity(0)}s.Util.closeAllPopups();this.planner=null;this.opened=false;s.Util.clearPlannerWatches()}}createContent(t){var i,n;let r=new this.BX.Promise;let a=this.getCurrentEntry();this.BX.ajax.runAction("calendar.api.calendarajax.getEditEventSlider",{data:{event_id:this.entryId||a.id,date_from:a?s.Util.formatDate(a.from):"",form_type:this.formType,type:(i=a.data["CAL_TYPE"])!=null?i:this.type,ownerId:(n=a.data["OWNER_ID"])!=null?n:this.ownerId,entityList:this.participantsEntityList}}).then((i=>{if(e.Type.isFunction(t.isOpen)&&t.isOpen()||t.isOpen===true){let n=this.BX.util.trim(i.data.html);t.getData().set("sliderContent",n);let l=i.data.additionalParams;this.updateEntryData(l.entry,{userSettings:this.userSettings,meetSection:l.meetSection});a=this.getCurrentEntry();this.uid=l.uniqueId;this.editorId=l.editorId;this.formSettings=this.getSettings(l.formSettings||[]);let h=this.formDataValue.attendeesEntityList||l.attendeesEntityList||[];if(!a.id&&this.participantsEntityList.length){h=this.participantsEntityList}if(e.Type.isArray(h)){h.forEach((t=>{if(t.entityId==="user"&&l.userIndex[t.id]){t.entityType=l.userIndex[t.id].EMAIL_USER?"email":"employee"}}))}this.setUserSelectorEntityList(h);this.attendeesPreselectedItems=this.getUserSelectorEntityList().map((t=>[t.entityId,t.id]));this.setUserSettings(l.userSettings);s.Util.setEventWithEmailGuestAmount(l.countEventWithEmailGuestAmount);s.Util.setEventWithEmailGuestLimit(l.eventWithEmailGuestLimit);this.handleSections(l.sections,l.trackingUsersList);this.handleLocationData(l.locationFeatureEnabled,l.locationList,l.iblockMeetingRoomList);this.locationAccess=l.locationAccess;this.dayOfWeekMonthFormat=l.dayOfWeekMonthFormat;this.plannerFeatureEnabled=!!l.plannerFeatureEnabled;if(this.planner&&!this.plannerFeatureEnabled){this.planner.lock()}if(!a.id&&!a.sectionId){this.setCurrentEntry()}if(this.userSettings.meetSection&&this.type==="user"){o.SectionManager.setNewEntrySectionId(this.userSettings.meetSection)}r.fulfill(n)}}),(t=>{}));return r}initControls(t){this.DOM.title=this.DOM.content.querySelector(`#${t}_title`);this.DOM.formWrap=this.DOM.content.querySelector(`#${t}_form_wrap`);this.DOM.form=this.DOM.content.querySelector(`#${t}_form`);this.DOM.buttonsWrap=this.DOM.content.querySelector(".calendar-form-buttons-fixed");this.DOM.saveBtn=this.DOM.buttonsWrap.querySelector(`#${t}_save`);this.DOM.closeBtn=this.DOM.buttonsWrap.querySelector(`#${t}_close`);e.Event.bind(this.DOM.saveBtn,"click",this.save.bind(this));e.Event.bind(this.DOM.closeBtn,"click",this.close.bind(this));this.initFormFieldManager(t);this.initDateTimeControl(t);this.initNameControl(t);this.initEditorControl(t);this.initAttendeesControl();this.initPlanner(t);this.initReminderControl(t);this.initSectionSelector(t);this.initLocationControl(t);this.initRepeatRuleControl(t);this.initColorControl(t);this.initCrmUfControl(t);this.initAdditionalControls(t);this.checkLastItemBorder();if(this.DOM.buttonsWrap){BX.ZIndexManager.register(this.DOM.buttonsWrap)}}updateEntryData(t,i={}){if(this.entry instanceof n.Entry){let s=i.userSettings||{};if(e.Type.isPlainObject(t)){this.entry.prepareData(t)}else{if(!this.entry.getTimezoneFrom()||this.entry.getTimezoneTo()){this.entry.setTimezone(s.timezoneName||s.timezoneDefaultName||null)}}if(!this.entry.id&&i.meetSection&&this.type===n.Entry.CAL_TYPES["user"]){this.entry.setSectionId(i.meetSection)}}}handleSections(t,i){this.sections=t;this.sectionIndex={};this.trackingUsersList=i||[];if(e.Type.isArray(t)){t.forEach(((t,e)=>{this.sectionIndex[parseInt(t.ID)]=e}),this)}const s=this.getCurrentSection();if(this.entry.id){this.getSectionsForEditEvent(this.sections,s)}}handleLocationData(t,s,n){this.locationFeatureEnabled=!!t;this.locationList=e.Type.isArray(s)?s.filter((t=>t.PERM.view_full)):[];this.iblockMeetingRoomList=n||[];i.Location.setLocationList(s);i.Location.setMeetingRoomList(n)}setUserSettings(t){this.userSettings=t;s.Util.setUserSettings(t)}setFormValues(){var t;let i=this.entry;this.dateTimeControl.setValue({from:this.formDataValue.from||i.from,to:this.formDataValue.to||i.to,fullDay:e.Type.isBoolean(this.formDataValue.fullDay)?this.formDataValue.fullDay:i.fullDay,timezoneFrom:i.getTimezoneFrom()||"",timezoneTo:i.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.DOM.entryName.value=this.formDataValue.name||i.getName();const n=this.getCurrentSection();if(this.formDataValue.section){i.sectionId=parseInt(this.formDataValue.section)}this.DOM.sectionInput.value=this.getCurrentSectionId();this.sectionSelector.updateValue();if(!this.fieldIsPinned("section")){if(n["CAL_TYPE"]!==this.type||n["CAL_TYPE"]===this.type&&parseInt(n["OWNER_ID"])!==this.ownerId){this.pinField("section")}}if(this.isSyncSection(n)&&i.id){this.sectionSelector.setViewMode(true)}this.colorSelector.setValue(this.formDataValue.color||i.getColor()||n.COLOR);this.remindersControl.setValue(this.formDataValue.reminder||i.getReminders(),true,false);(t=this.repeatSelector)==null?void 0:t.setValue(this.formDataValue.rrule||i.getRrule());if(this.DOM.accessibilityInput){this.DOM.accessibilityInput.value=i.accessibility}if(this.locationSelector){this.locationSelector.setValue(this.formDataValue.location||this.locationSelector.default||i.getLocation(),false);this.locationSelector.checkLocationAccessibility({from:this.formDataValue.from||i.from,to:this.formDataValue.to||i.to,fullDay:e.Type.isBoolean(this.formDataValue.fullDay)?this.formDataValue.fullDay:i.fullDay,currentEventId:this.entry.id})}if(this.DOM.privateEventCheckbox){this.DOM.privateEventCheckbox.checked=i.private}if(this.DOM.importantEventCheckbox){this.DOM.importantEventCheckbox.checked=i.important}if(this.DOM.form.meeting_notify){if(this.formDataValue.meetingNotify!==undefined){this.DOM.form.meeting_notify.checked=this.formDataValue.meetingNotify}if(this.entry.data&&this.entry.data.MEETING){this.DOM.form.meeting_notify.checked=this.entry.data.MEETING.NOTIFY}else{this.DOM.form.meeting_notify.checked=true}}if(this.DOM.form.hide_guests){if(this.formDataValue.hideGuests!==undefined){this.DOM.form.hide_guests.checked=this.formDataValue.hideGuests==="Y"}else if(this.entry.data&&this.entry.data.MEETING){this.DOM.form.hide_guests.checked=this.entry.data.MEETING.HIDE_GUESTS}else{this.DOM.form.hide_guests.checked=true}}if(this.DOM.form.allow_invite){if(this.entry.data){this.DOM.form.allow_invite.checked=this.entry.data.MEETING&&this.entry.data.MEETING.ALLOW_INVITE}else{this.DOM.form.allow_invite.checked=this.entry.allowInvite}}let o=this.dateTimeControl.getValue();this.planner.updateSelector(o.from,o.to,o.fullDay,{focus:true});this.loadPlannerData({entityList:this.getUserSelectorEntityList(),from:s.Util.formatDate(i.from.getTime()-s.Util.getDayLength()*3),to:s.Util.formatDate(i.to.getTime()+s.Util.getDayLength()*10),timezone:i.getTimezoneFrom(),location:this.locationSelector.getTextValue()}).then((()=>{if(this.hasExternalEmailUsers()){this.showHideGuestsOption()}else{this.hideHideGuestsOption()}}))}switchFullDay(t){t=!!this.DOM.fullDay.checked;if(t&&e.Type.isString(this.userSettings.timezoneName)&&(!this.DOM.fromTz.value||!this.DOM.toTz.value)){this.DOM.fromTz.value=this.userSettings.timezoneName;this.DOM.toTz.value=this.userSettings.timezoneName;this.DOM.defTimezone.value=this.userSettings.timezoneName}if(t){e.Dom.addClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}else{e.Dom.removeClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(this.remindersControl){this.remindersControl.setFullDayMode(t)}this.refreshPlanner()}switchTimezone(){if(e.Dom.hasClass(this.DOM.tzCont,"calendar-options-timezone-collapse")){e.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-expand");e.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}else{e.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-collapse");e.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-expand")}}initFormFieldManager(t){this.DOM.mainBlock=this.DOM.content.querySelector(`#${t}_main_block_wrap`);this.DOM.additionalBlockWrap=this.DOM.content.querySelector(`#${t}_additional_block_wrap`);this.DOM.additionalBlock=this.DOM.content.querySelector(`#${t}_additional_block`);this.DOM.pinnedNamesWrap=this.DOM.content.querySelector(`#${t}_additional_pinned_names`);this.DOM.additionalSwitch=this.DOM.content.querySelector(`#${t}_additional_switch`);if(this.isLocationCalendar&&!this.fieldIsPinned("location")){this.pinField("location")}e.Event.bind(this.DOM.additionalSwitch,"click",(()=>{e.Dom.toggleClass(this.DOM.additionalSwitch,"opened");e.Dom.toggleClass(this.DOM.additionalBlock,"invisible")}));e.Event.bind(this.DOM.formWrap,"click",(t=>{let e=t.target||t.srcElement;if(e&&e.getAttribute&&e.getAttribute("data-bx-fixfield")){let t=e.getAttribute("data-bx-fixfield");if(!this.fieldIsPinned(t)){this.pinField(t)}else{this.unPinField(t)}}}))}initDateTimeControl(t){this.dateTimeControl=new d(t,{showTimezone:true,outerContent:this.DOM.content});this.dateTimeControl.subscribe("onChange",(t=>{if(t instanceof r.BaseEvent){let e=t.getData().value;if(this.remindersControl){this.remindersControl.setFullDayMode(e.fullDay);if(!this.entry.id&&!this.remindersControl.wasChangedByUser()){const t=n.EntryManager.getNewEntryReminders(e.fullDay?"fullDay":"withTime");this.remindersControl.setValue(t,true,false)}}if(this.planner){this.planner.updateSelector(e.from,e.to,e.fullDay)}if(this.locationSelector){this.locationSelector.checkLocationAccessibility({from:e.from,to:e.to,fullDay:e.fullDay,currentEventId:this.entry.id})}}}))}initNameControl(t){this.DOM.entryName=this.DOM.content.querySelector(`#${t}_entry_name`);setTimeout((()=>{this.DOM.entryName.focus();this.DOM.entryName.select()}),500)}initReminderControl(t){const s=this.DOM.content.querySelector(`#${t}_reminder`);if(!s){return}this.reminderValues=[];this.DOM.reminderWrap=s;this.DOM.reminderInputsWrap=this.DOM.reminderWrap.appendChild(e.Tag.render(E||(E=c`<span></span>`)));this.remindersControl=new i.Reminder({wrap:this.DOM.reminderWrap,zIndex:this.zIndex});this.remindersControl.subscribe("onChange",(t=>{if(t instanceof r.BaseEvent){this.reminderValues=t.getData().values;e.Dom.clean(this.DOM.reminderInputsWrap);this.reminderValues.forEach((t=>{this.DOM.reminderInputsWrap.appendChild(e.Dom.create("INPUT",{props:{name:"reminder[]",type:"hidden"},attrs:{value:t}}))}))}}))}initSectionSelector(t){this.DOM.sectionInput=this.DOM.content.querySelector(`#${t}_section`);this.sectionSelector=new i.SectionSelector({outerWrap:this.DOM.content.querySelector(`#${t}_section_wrap`),defaultCalendarType:this.type,defaultOwnerId:this.ownerId,sectionList:this.sections,sectionGroupList:o.SectionManager.getSectionGroupList({type:this.type||"user",ownerId:this.ownerId||this.userId,userId:this.userId,trackingUsersList:this.trackingUsersList}),mode:"full",zIndex:this.zIndex,getCurrentSection:()=>{const t=this.getCurrentSection();if(t){return{id:t.ID,name:t.NAME,color:t.COLOR}}return false},selectCallback:t=>{if(t){this.DOM.sectionInput.value=t.id;if(this.colorSelector){this.colorSelector.setValue(t.color)}this.entry.setSectionId(t.id);o.SectionManager.saveDefaultSectionId(t.id,{calendarType:this.type,ownerId:this.ownerId,userId:this.userId,sections:this.sections})}}})}initEditorControl(t){if(!window["BXHtmlEditor"]){return setTimeout(BX.delegate(this.initEditorControl,this),50)}this.editor=null;if(window["BXHtmlEditor"]){this.editor=window["BXHtmlEditor"].Get(this.editorId)}if(!this.editor&&top["BXHtmlEditor"]&&top["BXHtmlEditor"]!==window["BXHtmlEditor"]){this.editor=top["BXHtmlEditor"].Get(this.editorId)}if(this.editor&&this.editor.IsShown()){this.customizeHtmlEditor();if(this.formDataValue.description){this.editor.SetContent(this.formDataValue.description)}}else{this.BX.addCustomEvent(window["BXHtmlEditor"],"OnEditorCreated",function(t){if(t.id===this.editorId){this.editor=t;this.customizeHtmlEditor();if(this.formDataValue.description){this.editor.SetContent(this.formDataValue.description)}}}.bind(this))}}customizeHtmlEditor(){let t=this.editor;if(t.toolbar&&t.toolbar.controls&&t.toolbar.controls.spoiler){e.Dom.remove(t.toolbar.controls.spoiler.pCont)}}initLocationControl(t){this.DOM.locationWrap=this.DOM.content.querySelector(`#${t}_location_wrap`);this.DOM.locationInput=this.DOM.content.querySelector(`#${t}_location`);this.locationSelector=new i.Location({inputName:"lo_cation",wrap:this.DOM.locationWrap,richLocationEnabled:this.locationFeatureEnabled,locationList:this.locationList||[],roomsManager:this.roomsManager||null,locationAccess:this.locationAccess||false,iblockMeetingRoomList:this.iblockMeetingRoomList,onChangeCallback:this.refreshPlanner})}initRepeatRuleControl(t){const e=this.DOM.content.querySelector(`#${t}_rrule_wrap`);if(!e){return}this.DOM.rruleWrap=e;this.repeatSelector=new i.RepeatSelector({wrap:this.DOM.rruleWrap,rruleType:this.DOM.content.querySelector(`#${t}_rrule_type`),getDate:function(){return this.dateTimeControl.getValue().from}.bind(this)});this.dateTimeControl.subscribe("onChange",(()=>{if(this.repeatSelector.getType()==="weekly"){this.repeatSelector.changeType(this.repeatSelector.getType())}}));this.planner.subscribe("onDateChange",(()=>{if(this.repeatSelector.getType()==="weekly"){this.repeatSelector.changeType(this.repeatSelector.getType())}}))}initAttendeesControl(){this.DOM.userSelectorWrap=this.DOM.content.querySelector(".calendar-attendees-selector-wrap");this.DOM.userSelectorValueWarp=this.DOM.userSelectorWrap.appendChild(e.Tag.render(S||(S=c`<div></div>`)));this.userTagSelector=new l.TagSelector({dialogOptions:{context:"CALENDAR",preselectedItems:this.attendeesPreselectedItems||[],zIndex:this.slider.zIndex,events:{"Item:onSelect":this.handleUserSelectorChanges.bind(this),"Item:onDeselect":this.handleUserSelectorChanges.bind(this)},entities:this.getParticipantsSelectorEntityList(),searchTabOptions:{stubOptions:{title:e.Loc.getMessage("EC_USER_DIALOG_404_TITLE"),subtitle:e.Loc.getMessage("EC_USER_DIALOG_404_SUBTITLE"),icon:"/bitrix/images/calendar/search-email.svg",iconOpacity:100,arrow:true}}}});this.userTagSelector.renderTo(this.DOM.userSelectorWrap);this.DOM.hideGuestsWrap=this.DOM.content.querySelector(".calendar-hide-members-wrap")}handleUserSelectorChanges(){if(this.planner){this.planner.show();this.planner.showLoader();const t=this.userTagSelector.getDialog().getSelectedItems();this.setUserSelectorEntityList(t.map((t=>({entityId:t.entityId,id:t.id,entityType:t.entityType}))));this.refreshPlanner()}}hasExternalEmailUsers(){return!!this.getUserSelectorEntityList().find((t=>t.entityType==="email"))}showHideGuestsOption(){this.DOM.hideGuestsWrap.style.display="";s.Util.initHintNode(this.DOM.hideGuestsWrap.querySelector(".calendar-hide-members-helper"))}hideHideGuestsOption(){this.DOM.hideGuestsWrap.style.display="none"}setHideGuestsValue(t=true){this.hideGuests=t}initPlanner(t){this.DOM.plannerOuterWrap=this.DOM.content.querySelector(`#${t}_planner_outer_wrap`);this.planner=new a.Planner({wrap:this.DOM.plannerOuterWrap,minWidth:parseInt(this.DOM.plannerOuterWrap.offsetWidth),dayOfWeekMonthFormat:this.dayOfWeekMonthFormat,locked:!this.plannerFeatureEnabled});this.planner.subscribe("onDateChange",this.handlePlannerSelectorChanges.bind(this));this.planner.subscribe("onExpandTimeline",this.handleExpandPlannerTimeline.bind(this));this.planner.subscribe("onDisplayAttendees",this.checkLocationForm.bind(this));this.planner.show();this.planner.showLoader()}loadPlannerData(t={}){this.planner.showLoader();return new Promise((i=>{this.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:{entryId:this.entry.id||0,entryLocation:this.entry.data.LOCATION||"",ownerId:this.ownerId,type:this.type,entityList:t.entityList||[],dateFrom:s.Util.formatDate(this.planner.scaleDateFrom),dateTo:s.Util.formatDate(this.planner.scaleDateTo),timezone:t.timezone||"",location:t.location||"",prevUserList:this.prevUserList}}).then((t=>{if(this.planner){for(let e in t.data.accessibility){if(t.data.accessibility.hasOwnProperty(e)){this.loadedAccessibilityData[e]=t.data.accessibility[e]}}if(e.Type.isArray(t.data.entries)){t.data.entries.forEach((t=>{if(t.type==="user"&&!this.prevUserList.includes(parseInt(t.id))){this.prevUserList.push(parseInt(t.id))}}))}this.planner.hideLoader();this.planner.update(t.data.entries,this.loadedAccessibilityData)}if(this.hasExternalEmailUsers()){this.showHideGuestsOption()}else{this.hideHideGuestsOption()}i(t)}),(t=>{i(t)}))}))}initAdditionalControls(t){this.DOM.accessibilityInput=this.DOM.content.querySelector(`#${t}_accessibility`);this.DOM.privateEventCheckbox=this.DOM.content.querySelector(`#${t}_private`);this.DOM.importantEventCheckbox=this.DOM.content.querySelector(`#${t}_important`)}initColorControl(t){this.DOM.colorWrap=this.DOM.content.querySelector(`#${t}_color_selector_wrap`);this.colorSelector=new i.ColorSelector({wrap:this.DOM.colorWrap})}initCrmUfControl(t){const i=BX(t+"-uf-crm-wrap");if(!i){return}this.DOM.crmUfWrap=i;if(this.DOM.crmUfWrap){let t=this.getCurrentEntry();let i=this.DOM.crmUfWrap.appendChild(e.Dom.adjust(s.Util.getLoader(50),{style:{height:"40px",width:"40px"}}));setTimeout(function(){this.BX.ajax.runAction("calendar.api.calendarajax.getCrmUserfield",{data:{event_id:t&&t.id?t.id:0}}).then(function(t){if(e.Type.isDomNode(this.DOM.crmUfWrap)){this.BX.html(this.DOM.crmUfWrap,t.data.html)}}.bind(this),function(t){e.Dom.remove(i)}.bind(this))}.bind(this),800)}}denySliderClose(){this.denyClose=true}allowSliderClose(){this.denyClose=false}checkDenyClose(){if(this.state===this.STATE.REQUEST){return true}if(!e.Type.isNull(this.mouseUpNodeCheck)){return!this.mouseUpNodeCheck}return this.denyClose}setCurrentEntry(t=null,e=null){this.entry=n.EntryManager.getEntryInstance(t,e,{type:this.type,ownerId:this.ownerId});n.EntryManager.registerEntrySlider(this.entry,this)}getCurrentEntry(){return this.entry}getCurrentSection(){let t=false,e=this.getCurrentSectionId();if(e&&this.sectionIndex[e]!==undefined&&this.sections[this.sectionIndex[e]]!==undefined){t=this.sections[this.sectionIndex[e]]}return t}getCurrentSectionId(){let t=0,e=this.getCurrentEntry();if(e instanceof n.Entry&&this.sections[this.sectionIndex[e.sectionId]]){t=parseInt(e.sectionId)}if(!t){if(this.type==="location"){t=h.RoomsManager.getNewEntrySectionId()}else{t=o.SectionManager.getNewEntrySectionId(this.type,this.ownerId)}if(!this.sectionIndex[t]){t=null}}if(!t&&this.sections[0]){t=parseInt(this.sections[0].ID)}return t}pinField(t){let[i,s]=this.getPlaceholders();let n=s[t],o=i[t],r=n.offsetHeight;n.style.height=r+"px";setTimeout((function(){e.Dom.addClass(n,"calendar-hide-field")}),0);o.style.height="0";if(t==="description"){setTimeout(function(){if(!this.DOM.descriptionAdditionalWrap){this.DOM.descriptionAdditionalWrap=this.DOM.additionalBlock.querySelector(".calendar-info-panel-description")}if(this.DOM.descriptionAdditionalWrap){while(this.DOM.descriptionAdditionalWrap.firstChild){o.appendChild(this.DOM.descriptionAdditionalWrap.firstChild)}}o.style.height=r+"px"}.bind(this),200);setTimeout(function(){e.Dom.removeClass(n,"calendar-hide-field");n.style.display="none";o.style.height="";this.pinnedFieldsIndex[t]=true;let i=window["BXHtmlEditor"].Get(this.editorId);if(i){i.CheckAndReInit()}this.saveSettings();this.updateAdditionalBlockState()}.bind(this),500)}else{setTimeout((function(){while(n.firstChild){o.appendChild(n.firstChild)}o.style.height=r+"px"}),200);setTimeout((()=>{e.Dom.removeClass(n,"calendar-hide-field");n.style.height="";o.style.height="";this.pinnedFieldsIndex[t]=true;this.saveSettings();this.updateAdditionalBlockState()}),300)}}unPinField(t){let[i,s]=this.getPlaceholders();let n=i[t],o=s[t],r=n.offsetHeight;n.style.height=r+"px";setTimeout((function(){e.Dom.addClass(n,"calendar-hide-field")}),0);o.style.height="0";if(t==="description"){setTimeout(function(){if(!this.DOM.descriptionAdditionalWrap){this.DOM.descriptionAdditionalWrap=this.DOM.additionalBlock.querySelector(".calendar-info-panel-description")}if(this.DOM.descriptionAdditionalWrap){while(n.firstChild){this.DOM.descriptionAdditionalWrap.appendChild(n.firstChild)}}o.style.display="";o.style.height=r+"px"}.bind(this),200);setTimeout(function(){e.Dom.removeClass(n,"calendar-hide-field");n.style.height="";o.style.height="";this.pinnedFieldsIndex[t]=false;let i=window["BXHtmlEditor"].Get(this.editorId);if(i){i.CheckAndReInit()}this.saveSettings();this.updateAdditionalBlockState()}.bind(this),300)}else{setTimeout((function(){while(n.firstChild){o.appendChild(n.firstChild)}o.style.height=r+"px"}),200);setTimeout(function(){e.Dom.removeClass(n,"calendar-hide-field");n.style.height="";o.style.height="";this.pinnedFieldsIndex[t]=false;this.saveSettings();this.updateAdditionalBlockState()}.bind(this),300)}}fieldIsPinned(t){return this.pinnedFieldsIndex[t]}getPlaceholders(){if(!this.placeHolders){this.placeHolders={};this.placeHoldersAdditional={};let t,e,i=this.DOM.formWrap.querySelectorAll(".calendar-field-additional-placeholder");for(t=0;t<i.length;t++){e=i[t].getAttribute("data-bx-block-placeholer");if(e){this.placeHoldersAdditional[e]=i[t]}}i=this.DOM.formWrap.querySelectorAll(".calendar-field-placeholder");for(t=0;t<i.length;t++){e=i[t].getAttribute("data-bx-block-placeholer");if(e){this.placeHolders[e]=i[t]}}}return[this.placeHolders,this.placeHoldersAdditional]}getSettings(t){this.pinnedFieldsIndex={};let e,i=[];for(e in t.pinnedFields){if(t.pinnedFields.hasOwnProperty(e)){i.push(t.pinnedFields[e]);this.pinnedFieldsIndex[t.pinnedFields[e]]=true}}t.pinnedFields=i;return t}saveSettings(){let t,e=[];for(t in this.pinnedFieldsIndex){if(this.pinnedFieldsIndex.hasOwnProperty(t)&&this.pinnedFieldsIndex[t]){e.push(t)}}this.formSettings.pinnedFields=e;this.BX.userOptions.save("calendar",this.formType,"pinnedFields",e)}updateAdditionalBlockState(t){if(t!==false){if(this.updateAdditionalBlockTimeout){clearTimeout(this.updateAdditionalBlockTimeout);this.updateAdditionalBlockTimeout=null}this.updateAdditionalBlockTimeout=setTimeout((()=>{this.updateAdditionalBlockState(false)}),300)}else{let t,i=this.DOM.additionalBlock.getElementsByClassName("js-calendar-field-name");e.Dom.clean(this.DOM.pinnedNamesWrap);for(t=0;t<i.length;t++){this.DOM.pinnedNamesWrap.appendChild(e.Dom.create("SPAN",{props:{className:"calendar-additional-alt-promo-text"},html:i[t].innerHTML}))}if(!i.length){e.Dom.addClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")}else if(e.Dom.hasClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")){e.Dom.removeClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")}this.checkLastItemBorder()}}checkLastItemBorder(){let t="no-border",i,s;s=this.DOM.mainBlock.querySelectorAll(".calendar-options-item-border");for(i=0;i<s.length;i++){if(i===s.length-1){e.Dom.addClass(s[i],t)}else{e.Dom.removeClass(s[i],t)}}s=this.DOM.additionalBlock.querySelectorAll(".calendar-options-item-border");for(i=0;i<s.length;i++){if(i===s.length-1){e.Dom.addClass(s[i],t)}else{e.Dom.removeClass(s[i],t)}}}handlePlannerSelectorChanges(t){if(t instanceof r.BaseEvent){let e=t.getData();this.dateTimeControl.setValue({from:e.dateFrom,to:e.dateTo});if(this.locationSelector){this.locationSelector.checkLocationAccessibility({from:e.dateFrom,to:e.dateTo,fullDay:e.fullDay,currentEventId:this.entry.id})}if(this.planner){let t=parseInt(e.dateFrom.getHours())+Math.floor(e.dateFrom.getMinutes()/60);let i=parseInt(e.dateTo.getHours())+Math.floor(e.dateTo.getMinutes()/60);if(t!==0&&t<=this.planner.shownScaleTimeFrom||i!==0&&i!==23&&i+1>=this.planner.shownScaleTimeTo){this.planner.updateSelector(e.dateFrom,e.dateTo,e.fullDay)}}}}handleExpandPlannerTimeline(t){if(t instanceof r.BaseEvent){let e=t.getData();if(e.reload){this.prevUserList=[];let t=this.dateTimeControl.getValue();this.loadPlannerData({entityList:this.getUserSelectorEntityList(),from:s.Util.formatDate(e.dateFrom),to:s.Util.formatDate(e.dateTo),timezone:t.timezoneFrom,location:this.locationSelector.getTextValue(),focusSelector:false})}}}getUserSelectorEntityList(){return this.selectorEntityList}setUserSelectorEntityList(t){this.selectorEntityList=t}refreshPlannerState(){let t=this.dateTimeControl.getValue();this.loadPlannerData({entityList:this.getUserSelectorEntityList(),from:s.Util.formatDate(t.from.getTime()-s.Util.getDayLength()*3),to:s.Util.formatDate(t.to.getTime()+s.Util.getDayLength()*10),timezone:t.timezoneFrom,location:this.locationSelector.getTextValue()})}checkLocationForm(t){if(t&&t instanceof r.BaseEvent){const e=t.getData();const s=e.usersCount;if(this.locationCapacity!==0){i.Location.setCurrentCapacity(this.locationCapacity);this.locationCapacity=0}let n=i.Location.getCurrentCapacity()||0;if(this.locationSelector.value.type===undefined){if(n){n=0;i.Location.setCurrentCapacity(0)}}if(n<s&&n!==0){this.locationSelector.addCapacityAlert()}else{this.locationSelector.removeCapacityAlert()}}}plannerIsShown(){return this.DOM.plannerWrap&&e.Dom.hasClass(this.DOM.plannerWrap,"calendar-edit-planner-wrap-shown")}keyHandler(t){if((t.ctrlKey||t.metaKey)&&!t.altKey&&t.keyCode===s.Util.getKeyCode("enter")&&this.checkTopSlider()){this.save()}}checkTopSlider(){const t=s.Util.getBX().SidePanel.Instance.getTopSlider();return t&&t.options.type==="calendar:slider"}showError(t){let i="";if(e.Type.isArray(t)){t.forEach((t=>{if(t.code==="edit_entry_location_busy"){this.locationBusyAlert=s.Util.showFieldError(t.message,this.DOM.locationWrap,{clearTimeout:1e4});return}i+=t.message+"\n"}))}if(i!==""){alert(i)}}getFormDataChanges(t=[]){const e=this.entry;let s=[];if(!t.includes("name")&&e.name!==this.DOM.form.name.value){s.push("name")}if(!t.includes("description")&&e.getDescription()!==this.DOM.form.desc.value){s.push("description")}if(!t.includes("location")&&this.locationSelector.getTextLocation(i.Location.parseStringValue(this.entry.getLocation()))!==this.locationSelector.getTextLocation(i.Location.parseStringValue(this.locationSelector.getTextValue()))){s.push("location")}const n=this.dateTimeControl.getValue();if(!t.includes("date&time")&&(e.isFullDay()!==n.fullDay||n.from.toString()!==e.from.toString()||n.to.toString()!==e.to.toString())){s.push("date&time")}if(!t.includes("section")&&parseInt(e.sectionId)!==parseInt(this.DOM.sectionInput.value)){s.push("section")}if(!t.includes("codes")&&this.getUserSelectorEntityList().map((t=>t.entityId+":"+t.id)).join("|")!==e.getAttendeesEntityList().map((t=>t.entityId+":"+t.id)).join("|")){s.push("codes")}return s}checkCurrentUsersAccessibility(){return this.getFormDataChanges().includes("date&time")}formDataChanged(){return this.getFormDataChanges().length>0}getUserCodes(){const t=[],e=this.DOM.attendeesWrap.querySelectorAll('input[name="EVENT_DESTINATION[]"]');for(let i=0;i<e.length;i++){if(!t.includes(e[i].value)){t.push(e[i].value)}}return t}handlePull(t){var i,s,n,o;if(!t instanceof r.BaseEvent){return}const a=t.getData();const l=a[0];const h=e.Type.isObjectLike(a[1])?a[1]:{};switch(l){case"edit_event":case"delete_event":case"set_meeting_status":const t=e.Type.isArray(h==null?void 0:(i=h.fields)==null?void 0:i.ATTENDEES)?h.fields.ATTENDEES:[];const r=(h==null?void 0:(s=h.fields)==null?void 0:s.CAL_TYPE)==="user"?parseInt(h==null?void 0:(n=h.fields)==null?void 0:n.OWNER_ID):parseInt(h==null?void 0:(o=h.fields)==null?void 0:o.CREATED_BY);if(!t.includes(r)){t.push(r)}this.clearAccessibilityData(t);this.refreshPlannerState();break}}clearAccessibilityData(t){if(e.Type.isArray(t)&&t.length&&this.prevUserList.length){this.prevUserList=this.prevUserList.filter((e=>!t.includes(e)))}}getParticipantsSelectorEntityList(){if(this.participantsSelectorEntityList&&this.participantsSelectorEntityList.length){return this.participantsSelectorEntityList}let t=[{id:"user",options:{inviteGuestLink:true,emailUsers:true}},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}];if(this.attendeesPreselectedItems){let e=null;this.attendeesPreselectedItems.forEach((t=>{const i=t[0];const s=t[1];if(i==="project-roles"){e=s}}));if(e){t=[{id:"user"},{id:"project-roles",options:{projectId:e.split("_")[0]},dynamicLoad:true}]}}return t}isSyncSection(t){return t.EXTERNAL_TYPE==="icloud"||t.EXTERNAL_TYPE==="google"||t.EXTERNAL_TYPE==="office365"||t.connectionLinks&&t.connectionLinks.length}getSectionsForEditEvent(t,i){const s=[];const n=i.CAL_TYPE;s.push(i);t.forEach((t=>{if(!this.isSyncSection(t)&&t.CAL_TYPE===n){s.push(t)}}));this.sections=s;this.sectionIndex=[];if(e.Type.isArray(this.sections)){this.sections.forEach(((t,e)=>{this.sectionIndex[parseInt(t.ID)]=e}),this)}}unsetHiddenSection(t,e){const i=parseInt(t.ID);if(!e.sectionIsShown(i)){let t=e.getHiddenSections();t=t.filter((t=>t!==i),this);e.setHiddenSections(t);e.saveHiddenSections()}}}t.EventEditForm=M})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar,BX.Event,BX.Calendar,BX.UI.EntitySelector,BX.Calendar);
//# sourceMappingURL=eventeditform.bundle.map.js