{"version":3,"file":"categorymanager.bundle.js","sources":["../src/category.js","../src/categorymanager.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport { CategoryManager } from './categorymanager';\n\nexport {\n\tCategoryManager\n}\n\nexport class Category\n{\n\tconstructor(data)\n\t{\n\t\tthis.updateData(data);\n\t\tthis.calendarContext = Util.getCalendarContext();\n\t\tthis.rooms = [];\n\t}\n\n\tupdateData(data)\n\t{\n\t\tthis.data = data || {};\n\t\tthis.id = parseInt(data.ID, 10);\n\t\tthis.name = data.NAME;\n\t}\n\n\taddRoom(room)\n\t{\n\t\tthis.rooms.push(room);\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetCheckboxStatus(checkboxStatus)\n\t{\n\t\tthis.checkboxStatus = checkboxStatus;\n\t}\n}","import { SectionManager } from 'calendar.sectionmanager';\nimport { Util } from 'calendar.util';\nimport { Event, Loc, Type } from 'main.core';\nimport {Category} from './category';\n\nexport class CategoryManager extends SectionManager\n{\n\tconstructor(data, config)\n\t{\n\t\tsuper(data, config);\n\t\tthis.setCategories(data.categories);\n\t\tthis.setConfig(config);\n\t\tthis.sortCategories();\n\t\tthis.permissions = config.perm;\n\t\tthis.locationContext = config.locationContext|| null;\n\t}\n\n\tsortCategories()\n\t{\n\t\tthis.categoryIndex = {};\n\t\tthis.categories = this.categories.sort((a, b) => {\n\t\t\tif (a.name.toLowerCase() > b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.name.toLowerCase() < b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\tthis.categories.forEach((category, i) => {\n\t\t\tthis.categoryIndex[category.getId()] = i;\n\t\t});\n\t}\n\n\tsetCategories(params = [])\n\t{\n\t\tthis.categories = [];\n\t\tthis.categoryIndex = {};\n\t\tparams.forEach((categoryData) => {\n\t\t\tlet category = new Category(categoryData);\n\t\t\tthis.categories.push(category);\n\t\t\tthis.categoryIndex[category.getId()] = this.categories.length - 1;\n\t\t});\n\t}\n\n\tgetCategories()\n\t{\n\t\treturn this.categories;\n\t}\n\n\tgetCategory(id)\n\t{\n\t\treturn this.categories[this.categoryIndex[id]];\n\t}\n\n\tcreateCategory(params)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tparams.name = this.checkName(params.name);\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.createCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\trooms: params.rooms\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:create',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { categoryList: categories }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t});\n\t}\n\n\tupdateCategory(params)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tparams.name = this.checkName(params.name);\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.updateCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: params.id,\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\trooms: {\n\t\t\t\t\t\t\ttoAddCategory: params.toAddCategory,\n\t\t\t\t\t\t\ttoRemoveCategory: params.toRemoveCategory,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:create'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tdeleteCategory(id)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.deleteCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tif (!categories.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:delete',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { categoryList: categories }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tcheckName(name)\n\t{\n\t\tif (typeof name === 'string')\n\t\t{\n\t\t\tname = name.trim();\n\t\t\tif (CategoryManager.isEmpty(name))\n\t\t\t{\n\t\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_CATEGORY');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_CATEGORY');\n\t\t}\n\t\treturn name;\n\t}\n\n\tstatic isEmpty(param)\n\t{\n\t\tif (Type.isArray(param))\n\t\t{\n\t\t\treturn !param.length;\n\t\t}\n\t\treturn param === null || param === undefined || param === '' || param === [] || param === {};\n\t}\n\n\tcanDo(action)\n\t{\n\t\t//actions:view|edit|access\n\t\treturn this.permissions[action];\n\t}\n\n\tunsetRooms()\n\t{\n\t\tthis.categories.map(category => category.rooms = []);\n\t}\n\n\thandlePullCategoryChanges(params)\n\t{\n\t\tif (params.command === 'delete_category')\n\t\t{\n\t\t\tconst categoryId = parseInt(params.ID, 10);\n\t\t\tif (this.categoryIndex[categoryId])\n\t\t\t{\n\t\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t'BX.Calendar.Rooms:pull-delete',\n\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: { categoryId }\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-delete');\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t\t}\n\t\t}\n\t\telse if (params.command === 'create_category')\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-create');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse if (params.command === 'update_category')\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-update');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t}\n\t}\n\n\treloadCategoriesFromDatabase()\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.getCategoryList')\n\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.setCategories(response.data.categories || []);\n\t\t\t\t\t\tthis.sortCategories();\n\t\t\t\t\t\tBX.Calendar.Controls.Location.setLocationList(response.data.rooms);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t// Failure\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tunsetCategoryRooms(categoryId)\n\t{\n\t\tthis.getCategory(categoryId).rooms = [];\n\t}\n\n\tgetCategoriesWithRooms(rooms)\n\t{\n\t\tthis.unsetRooms();\n\n\t\tconst categoriesWithRooms = {\n\t\t\t'default': [],\n\t\t\t'categories': this.getCategories(),\n\t\t};\n\n\t\tlet categoryIndexForRoom;\n\n\t\trooms.forEach((room) => {\n\t\t\tcategoryIndexForRoom = this.categoryIndex[room.categoryId];\n\n\t\t\tif(categoriesWithRooms['categories'][categoryIndexForRoom])\n\t\t\t{\n\t\t\t\tcategoriesWithRooms['categories'][categoryIndexForRoom].addRoom(room);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcategoriesWithRooms['default'].push(room);\n\t\t\t}\n\t\t}, this);\n\n\t\treturn categoriesWithRooms;\n\t}\n\n\tupdateLocationContext()\n\t{\n\t\tif(this.locationContext !== null && this.locationContext.roomsManagerFromDB !== null)\n\t\t{\n\t\t\tthis.locationContext.roomsManagerFromDB.reloadRoomsFromDatabase()\n\t\t\t\t.then(\n\t\t\t\t\tthis.locationContext.setValues.bind(this.locationContext)\n\t\t\t\t);\n\t\t}\n\t}\n\n\tgetCategoryRooms(category, rooms)\n\t{\n\t\tconst categoryRooms = [];\n\n\t\trooms.forEach((room) => {\n\t\t\tif(category.id === room.categoryId)\n\t\t\t{\n\t\t\t\tcategoryRooms.push(room);\n\t\t\t}\n\t\t});\n\n\t\treturn categoryRooms;\n\t}\n}"],"names":["Category","constructor","data","updateData","calendarContext","Util","getCalendarContext","rooms","id","parseInt","ID","name","NAME","addRoom","room","push","getId","setCheckboxStatus","checkboxStatus","CategoryManager","SectionManager","config","setCategories","categories","setConfig","sortCategories","permissions","perm","locationContext","categoryIndex","sort","a","b","toLowerCase","forEach","category","i","params","categoryData","length","getCategories","getCategory","createCategory","Promise","resolve","checkName","BX","ajax","runAction","then","response","getBX","Event","EventEmitter","emit","BaseEvent","categoryList","updateLocationContext","Calendar","displayError","errors","updateCategory","toAddCategory","toRemoveCategory","deleteCategory","reload","trim","isEmpty","Loc","getMessage","param","Type","isArray","undefined","canDo","action","unsetRooms","map","handlePullCategoryChanges","command","categoryId","reloadCategoriesFromDatabase","reloadDataDebounce","Controls","Location","setLocationList","unsetCategoryRooms","getCategoriesWithRooms","categoriesWithRooms","categoryIndexForRoom","roomsManagerFromDB","reloadRoomsFromDatabase","setValues","bind","getCategoryRooms","categoryRooms"],"mappings":"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"}