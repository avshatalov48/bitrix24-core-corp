{"version":3,"file":"counters.bundle.js","sources":["../src/counters.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { CounterPanel } from 'ui.counterpanel';\nimport { EventEmitter } from 'main.core.events';\n\nexport class Counters extends CounterPanel\n{\n\tconstructor(options)\n\t{\n\t\tsuper({\n\t\t\ttarget: options.countersWrap,\n\t\t\titems: Counters.getCountersValue(options.counters),\n\t\t\tmultiselect: false,\n\t\t});\n\t\t\n\t\tthis.search = options.search;\n\t\tthis.userId = options.userId;\n\t\tthis.counters = options.counters;\n\t\tthis.countersWrap = options.countersWrap;\n\t\t\n\t\tthis.bindEvents();\n\t\t\n\t}\n\t\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:activate', this.onActivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:deactivate', this.onDeactivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\t\n\tonActivateItem(event)\n\t{\n\t\tconst item = event.getData();\n\t\t\n\t\tif (item.id === 'invitation')\n\t\t{\n\t\t\tthis.search.filterApi.setFilter({\n\t\t\t\tpreset_id: \"filter_calendar_meeting_status_q\"\n\t\t\t});\n\t\t}\n\t}\n\t\n\tonDeactivateItem(event)\n\t{\n\t\tthis.search.resetFilter();\n\t}\n\t\n\trecalculateCounters()\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]) => {\n\t\t\tconst item = this.getItemById(code);\n\t\t\titem.updateValue(data.value);\n\t\t\titem.updateColor(data.color);\n\t\t})\n\t}\n\t\n\tmarkCounters()\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]) => {\n\t\t\tconst item = this.getItemById(code);\n\t\t\t\n\t\t\tif (item.id === 'invitation')\n\t\t\t{\n\t\t\t\tthis.fields['MEETING_STATUS'] === 'Q'\n\t\t\t\t\t? item.activate(false)\n\t\t\t\t\t: item.deactivate(false)\n\t\t\t\t;\n\t\t\t}\n\t\t})\n\t}\n\t\n\tsetCountersValue(counters)\n\t{\n\t\tthis.counters = counters;\n\t\tthis.recalculateCounters();\n\t}\n\t\n\tonFilterApply()\n\t{\n\t\tthis.fields = this.search.filter.getFilterFieldsValues();\n\t\tthis.markCounters();\n\t}\n\t\n\tstatic getCountersValue(counters)\n\t{\n\t\treturn Object.entries(counters).map(([code, item]) => {\n\t\t\treturn {\n\t\t\t\tid: code,\n\t\t\t\ttitle: Counters.getCountersName(code),\n\t\t\t\tvalue: item.value,\n\t\t\t\tcolor: item.color,\n\t\t\t};\n\t\t});\n\t}\n\n\tstatic getCountersName(type)\n\t{\n\t\tif (type === 'invitation')\n\t\t{\n\t\t\treturn Loc.getMessage('EC_COUNTER_INVITATION');\n\t\t}\n\t}\n}"],"names":["Counters","CounterPanel","constructor","options","target","countersWrap","items","getCountersValue","counters","multiselect","search","userId","bindEvents","EventEmitter","subscribe","onActivateItem","bind","onDeactivateItem","onFilterApply","event","item","getData","id","filterApi","setFilter","preset_id","resetFilter","recalculateCounters","Object","entries","forEach","code","data","getItemById","updateValue","value","updateColor","color","markCounters","fields","activate","deactivate","setCountersValue","filter","getFilterFieldsValues","map","title","getCountersName","type","Loc","getMessage"],"mappings":"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"}