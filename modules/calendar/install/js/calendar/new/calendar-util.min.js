(function(e){function t(e,t,i){this.calendar=e;this.config=t||{};if(!this.config.userSettings){this.config.userSettings={}}this.additionalParams=i;this.dayLength=864e5;this.type=this.config.type;this.userId=parseInt(this.config.userId);this.ownerId=parseInt(this.config.ownerId);this.accessNames={};if(this.config.accessNames){this.handleAccessNames(this.config.accessNames)}this.DATE_FORMAT_BX=BX.message("FORMAT_DATE");this.DATETIME_FORMAT_BX=BX.message("FORMAT_DATETIME");this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT_BX.substr(0,this.DATE_FORMAT_BX.length)==this.DATE_FORMAT_BX){this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));this.TIME_FORMAT_BX=BX.util.trim(this.DATETIME_FORMAT_BX.substr(this.DATE_FORMAT_BX.length))}else{this.TIME_FORMAT_BX=BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS";this.TIME_FORMAT=BX.date.convertBitrixFormat(BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS")}this.TIME_FORMAT_SHORT_BX=this.TIME_FORMAT_BX.replace(":SS","");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.KEY_CODES={backspace:8,enter:13,escape:27,space:32,delete:46,left:37,right:39,up:38,down:40,z:90,y:89,shift:16,ctrl:17,alt:18,cmd:91,cmdRight:93,pageUp:33,pageDown:34}}t.prototype={getEventPath:function(e){var t=this.config.path;t+=(t.indexOf("?")===-1?"?":"&")+"EVENT_ID="+e.id+"&EVENT_DATE="+this.formatDate(e.from);return t},getWeekDays:function(){return this.config.weekDays},getWeekStart:function(){return this.config.weekStart},getWeekEnd:function(){return{MO:"SU",TU:"MO",WE:"TU",TH:"WE",FR:"TH",SA:"FR",SU:"SA"}[this.config.weekStart]},getWeekDayOffset:function(e){if(!this.weekDayOffsetIndex){var t,i=this.getWeekDays();this.weekDayOffsetIndex={};for(t=0;t<i.length;t++)this.weekDayOffsetIndex[i[t][2]]=t}return this.weekDayOffsetIndex[e]},getWeekDayByInd:function(e){return["SU","MO","TU","WE","TH","FR","SA"][e]},isHoliday:function(e){var t;if(!this.weekHolidays){this.weekHolidays={};for(t in this.config.week_holidays){if(this.config.week_holidays.hasOwnProperty(t)){this.weekHolidays[this.config.week_holidays[t]]=true}}this.yearHolidays={};for(t in this.config.year_holidays){if(this.config.year_holidays.hasOwnProperty(t)){this.yearHolidays[this.config.year_holidays[t]]=true}}this.yearWorkdays={};for(t in this.config.year_workdays){if(this.config.year_workdays.hasOwnProperty(t)){this.yearWorkdays[this.config.year_workdays[t]]=true}}}var i=[6,0,1,2,3,4,5][e.getDay()],s=e.getDate(),n=e.getMonth();return(this.weekHolidays[i]||this.yearHolidays[s+"."+n])&&!this.yearWorkdays[s+"."+n]},isToday:function(e){var t=new Date;return t.getDate()==e.getDate()&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()},getWorkTime:function(){this.config.userWorkTime=this.config.userWorkTime||[];if(this.config.userSettings.work_time_start&&this.config.userSettings.work_time_end){this.workTime={start:Math.floor(parseFloat(this.config.userSettings.work_time_start||9)),end:Math.ceil(parseFloat(this.config.userSettings.work_time_end||18))}}else{this.workTime={start:Math.floor(parseFloat(this.config.userWorkTime[0]||9)),end:Math.ceil(parseFloat(this.config.userWorkTime[1]||18))}}this.getWorkTime=BX.proxy(function(){return this.workTime},this);return this.workTime},setWorkTime:function(e){this.workTime={start:Math.min(Math.max(e.start,0),24),end:Math.min(Math.max(e.end,e.start),24)};BX.userOptions.save("calendar","workTime","start",this.workTime.start);BX.userOptions.save("calendar","workTime","end",this.workTime.end);return this.workTime},formatTime:function(e,t,i){if(BX.type.isDate(e)){t=e.getMinutes();e=e.getHours()}var s="";if(i!==true||!BX.isAmPmMode())i=false;if(t==undefined){t="00"}else{t=parseInt(t,10);if(isNaN(t)){t="00"}else{if(t>59)t=59;t=t<10?"0"+t.toString():t.toString()}}e=parseInt(e,10);if(e>24){e=24}if(isNaN(e)){e=0}if(BX.isAmPmMode()){var n="am";if(e==0){e=12}else if(e==12){n="pm"}else if(e>12){n="pm";e-=12}if(i){s=e.toString()+" "+n}else{s=e.toString()+":"+t.toString()+" "+n}}else{s=e.toString()+":"+t.toString()}return s},formatDate:function(e){if(BX.type.isDate(e))e=e.getTime();return BX.date.format(this.DATE_FORMAT,e/1e3)},formatDateTime:function(e){if(BX.type.isDate(e))e=e.getTime();return BX.date.format(this.DATETIME_FORMAT,e/1e3)},formatDateUsable:function(e,t){var i=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));if(BX.message("LANGUAGE_ID")=="ru"||BX.message("LANGUAGE_ID")=="ua"){i="j F";if(e.getFullYear&&e.getFullYear()!=(new Date).getFullYear()&&t!==false){i+=" Y"}}return BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",i]],e)},parseTime:function(e){var t=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date)+" "+e,false);return t?{h:t.getHours(),m:t.getMinutes()}:t},parseDate:function(e,t,i){var s,n,r,a,o=false;if(!t)t=BX.message("FORMAT_DATETIME");e=BX.util.trim(e);if(i!==false)t=t.replace(":SS","");if(BX.type.isNotEmptyString(e)){a="";for(s=1;s<=12;s++){a=a+"|"+BX.message("MON_"+s)}var u=new RegExp("([0-9]+|[a-z]+"+a+")","ig"),f=e.match(u),l=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),c=[],h=[],g={};if(!f){return null}if(f.length>l.length){l=t.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(s=0,n=f.length;s<n;s++){if(BX.util.trim(f[s])!=""){c[c.length]=f[s]}}for(s=0,n=l.length;s<n;s++){if(BX.util.trim(l[s])!=""){h[h.length]=l[s]}}var d=BX.util.array_search("MMMM",h);if(d>0){c[d]=BX.getNumMonth(c[d]);h[d]="MM"}else{d=BX.util.array_search("M",h);if(d>0){c[d]=BX.getNumMonth(c[d]);h[d]="MM"}}for(s=0,n=h.length;s<n;s++){r=h[s].toUpperCase();g[r]=r=="T"||r=="TT"?c[s]:parseInt(c[s],10)}if(g["DD"]>0&&g["MM"]>0&&g["YYYY"]>0){var m=new Date;if(o){m.setUTCDate(1);m.setUTCFullYear(g["YYYY"]);m.setUTCMonth(g["MM"]-1);m.setUTCDate(g["DD"]);m.setUTCHours(0,0,0)}else{m.setDate(1);m.setFullYear(g["YYYY"]);m.setMonth(g["MM"]-1);m.setDate(g["DD"]);m.setHours(0,0,0)}if((!isNaN(g["HH"])||!isNaN(g["GG"])||!isNaN(g["H"])||!isNaN(g["G"]))&&!isNaN(g["MI"])){if(!isNaN(g["H"])||!isNaN(g["G"])){var p=(g["T"]||g["TT"]||"am").toUpperCase()=="PM";var T=parseInt(g["H"]||g["G"]||0,10);if(p){g["HH"]=T+(T==12?0:12)}else{g["HH"]=T<12?T:0}}else{g["HH"]=parseInt(g["HH"]||g["GG"]||0,10)}if(isNaN(g["SS"]))g["SS"]=0;if(o){m.setUTCHours(g["HH"],g["MI"],g["SS"])}else{m.setHours(g["HH"],g["MI"],g["SS"])}}return m}}return null},findTargetNode:function(e,t){if(e){var i=false,s="data-bx-calendar",n;if(!t)t=this.calendar.viewsCont;if(e.attributes&&e.attributes.length){for(n=0;n<e.attributes.length;n++){if(e.attributes[n].name&&e.attributes[n].name.substr(0,s.length)==s){i=e;break}}}if(!i){i=BX.findParent(e,function(e){var t;if(e.attributes&&e.attributes.length){for(t=0;t<e.attributes.length;t++){if(e.attributes[t].name&&e.attributes[t].name.substr(0,s.length)==s)return true}}return false},t)}}return i},getViewHeight:function(){var e=756,t=BX.GetWindowInnerSize(document).innerHeight-300;return Math.max(e,t)},showWeekNumber:function(){return this.getUserOption("showWeekNumbers","N")=="Y"},getWeekNumber:function(e){var t;if(this.getWeekStart()=="SU"){e+=this.dayLength*2}else if(this.getWeekStart()=="MO"){e+=this.dayLength}t=BX.date.format("W",e/1e3);return t},getScrollbarWidth:function(){var e=this.calendar.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-outer"}})),t=e.offsetWidth;e.style.overflow="scroll";var i=e.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-inner"}})),s=i.offsetWidth,n=t-s;BX.cleanNode(e,true);this.getScrollbarWidth=function(){return n};return n},getMessagePlural:function(e,t){var i,s;s=BX.message("LANGUAGE_ID")||"en";t=parseInt(t);if(t<0){t=-1*t}if(s){switch(s){case"de":case"en":i=t!==1?1:0;break;case"ru":case"ua":i=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break;default:i=1;break}}else{i=1}return BX.message(e+"_PLURAL_"+i)},getUserOption:function(e,t){if(this.config.userSettings[e]===undefined)return t;return this.config.userSettings[e]},setUserOption:function(e,t){if(this.config.userSettings[e]!==t){BX.userOptions.save("calendar","user_settings",e,t);this.config.userSettings[e]=t}},getKeyCodes:function(){return this.KEY_CODES},getMousePos:function(t){if(!t)t=e.event;var i=0,s=0;if(t.pageX||t.pageY){i=t.pageX;s=t.pageY}else if(t.clientX||t.clientY){i=t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;s=t.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}return{x:i,y:s}},getDayCode:function(e){return e.getFullYear()+"-"+("0"+~~(e.getMonth()+1)).substr(-2,2)+"-"+("0"+~~e.getDate()).substr(-2,2)},getTextColor:function(e){if(!e)return false;if(e.charAt(0)=="#")e=e.substring(1,7);var t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),n=(t*.8+i+s*.2)/510*100;return n<50},getTimeValue:function(e){return e.getHours()+Math.round(e.getMinutes()*100/60)/100},getTimeEx:function(e){return Math.round(e.getTime()/6e4)*6e4},getTimeByFraction:function(e,t){t=t||5;e=Math.min(Math.max(e,0),24);var i=true,s=Math.floor(e),n=i?Math.floor((e-s)*60/t)*t:Math.round((e-s)*60/t)*t;if(n==60){n=0;s++}if(s==24&&n==0){s=23;n=59}return{h:s,m:n}},getWeekNumberInMonthByDate:function(e){var t=new Date;t.setFullYear(e.getFullYear(),e.getMonth(),1);return parseInt(BX.date.format("W",e.getTime()/1e3))-parseInt(BX.date.format("W",t.getTime()/1e3))},getRemindersList:function(){if(!this.reminderList){this.reminderList=[{value:0,label:BX.message("EC_REMIND1_0"),shortLabel:BX.message("EC_REMIND1_SHORT_0")},{value:5,label:BX.message("EC_REMIND1_5"),shortLabel:BX.message("EC_REMIND1_SHORT_5")},{value:10,label:BX.message("EC_REMIND1_10"),shortLabel:BX.message("EC_REMIND1_SHORT_10")},{value:15,label:BX.message("EC_REMIND1_15"),shortLabel:BX.message("EC_REMIND1_SHORT_15")},{value:30,label:BX.message("EC_REMIND1_30"),shortLabel:BX.message("EC_REMIND1_SHORT_30")},{value:60,label:BX.message("EC_REMIND1_60"),shortLabel:BX.message("EC_REMIND1_SHORT_60")},{value:120,label:BX.message("EC_REMIND1_120"),shortLabel:BX.message("EC_REMIND1_SHORT_120")},{value:1440,label:BX.message("EC_REMIND1_1440"),shortLabel:BX.message("EC_REMIND1_SHORT_1440")},{value:2880,label:BX.message("EC_REMIND1_2880"),shortLabel:BX.message("EC_REMIND1_SHORT_2880")}]}return this.reminderList},getSimpleTimeList:function(){var e,t=[];for(e=0;e<24;e++){t.push({value:e*60,label:this.formatTime(e,0)});t.push({value:e*60+30,label:this.formatTime(e,30)})}this.getSimpleTimeList=function(){return t};return t},adaptTimeValue:function(e){e=parseInt(e.h*60)+parseInt(e.m);var t=this.getSimpleTimeList(),i=24*60,s=false,n;for(n=0;n<t.length;n++){if(Math.abs(t[n].value-e)<i){i=Math.abs(t[n].value-e);s=n;if(i<=15)break}}return t[s||0]},getMeetingRoomList:function(){return this.config.meetingRooms||[]},getLocationList:function(){return this.additionalParams.locationList||[]},setLocationList:function(e){this.additionalParams.locationList=e},mergeSocnetDestinationConfig:function(e){if(e.USERS){for(var t in e.USERS){if(e.USERS.hasOwnProperty(t)&&!this.additionalParams["socnetDestination"].USERS[t]){this.additionalParams["socnetDestination"].USERS[t]=e.USERS[t]}}}},getSocnetDestinationConfig:function(e){var t,i=this.additionalParams["socnetDestination"]||{};if(e=="items"){t={users:i.USERS||{},groups:i.EXTRANET_USER=="Y"||i.DENY_TOALL?{}:{UA:{id:"UA",name:i.DEPARTMENT?BX.message("EC_SOCNET_DESTINATION_4"):BX.message("EC_SOCNET_DESTINATION_3")}},sonetgroups:i.SONETGROUPS||{},department:i.DEPARTMENT||{},departmentRelation:i.DEPARTMENT_RELATION||{}}}else if(e=="itemsLast"&&i.LAST){t={users:i.LAST.USERS||{},groups:i.EXTRANET_USER=="Y"?{}:{UA:true},sonetgroups:i.LAST.SONETGROUPS||{},department:i.LAST.DEPARTMENT||{}}}else if(e=="itemsSelected"){t=i.SELECTED||{}}return t||{}},getActionUrl:function(){return this.config.actionUrl},getTimezoneList:function(){return this.additionalParams.timezoneList||[]},getDefaultColors:function(){return this.additionalParams.defaultColorsList},getFormSettings:function(e){return this.additionalParams.formSettings&&this.additionalParams.formSettings[e]?this.additionalParams.formSettings[e]:{}},saveFormSettings:function(e,t){if(e){BX.userOptions.save("calendar",e,"pinnedFields",t.pinnedFields)}},randomInt:function(e,t){return Math.round(e-.5+Math.random()*(t-e+1))},handleAccessNames:function(e){for(var t in e){if(e.hasOwnProperty(t)){this.accessNames[t]=e[t]}}},getAccessName:function(e){return this.accessNames[e]||e},setAccessName:function(e,t){this.accessNames[e]=t},getSectionAccessTasks:function(){return this.config.sectionAccessTasks},getTypeAccessTasks:function(){return this.config.typeAccessTasks},getDefaultTypeAccessTask:function(){var e,t=this.getTypeAccessTasks();for(e in t){if(t.hasOwnProperty(e)&&t[e].name=="calendar_type_view"){break}}this.getDefaultTypeAccessTask=function(){return e};return e},getDefaultSectionAccessTask:function(){var e,t=this.getSectionAccessTasks();for(e in t){if(t.hasOwnProperty(e)&&t[e].name=="calendar_view"){break}}this.getDefaultSectionAccessTask=function(){return e};return e},getSuperposedTrackedUsers:function(){return(this.config.trackingUsersList||[]).sort(function(e,t){if(!e.LAST_NAME)e.LAST_NAME="";if(!t.LAST_NAME)t.LAST_NAME="";return e.LAST_NAME.localeCompare(t.LAST_NAME)})},getSuperposedTrackedGroups:function(){return this.config.trackingGroupList||[]},isUserCalendar:function(){return this.type==="user"},isGroupCalendar:function(){return this.type==="group"},userIsOwner:function(){return this.isUserCalendar()&&this.userId===this.ownerId},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},hexToRgba:function(e,t){var i=this.hexToRgb(e);if(!i)i=this.hexToRgb("#9dcf00");return"rgba("+i.r+", "+i.g+", "+i.b+", "+t+")"},parseLocation:function(e){if(!e)e="";var t,i={type:false,value:false,str:e};if(e.length>5&&e.substr(0,5)=="ECMR_"){i.type="mr";t=e.split("_");if(t.length>=2){if(!isNaN(parseInt(t[1]))&&parseInt(t[1])>0){i.value=i.mrid=parseInt(t[1])}if(!isNaN(parseInt(t[2]))&&parseInt(t[2])>0){i.mrevid=parseInt(t[2])}}}else if(e.length>5&&e.substr(0,9)=="calendar_"){i.type="calendar";t=e.split("_");if(t.length>=2){if(!isNaN(parseInt(t[1]))&&parseInt(t[1])>0){i.value=i.room_id=parseInt(t[1])}if(!isNaN(parseInt(t[2]))&&parseInt(t[2])>0){i.room_event_id=parseInt(t[2])}}}return i},getTextLocation:function(e){var t=typeof e==="object"?e:this.parseLocation(e),i,s=t.str;if(t.type=="mr"){var n=this.calendar.util.getMeetingRoomList();for(i=0;i<n.length;i++){if(t.value==n[i].ID){s=n[i].NAME;break}}}if(t.type=="calendar"){var r=this.calendar.util.getLocationList();for(i=0;i<r.length;i++){if(t.value==r[i].ID){s=r[i].NAME;break}}}return s},getTextReminder:function(e){if(BX.util.in_array(e,[0,5,10,15,30,60,120,1440,2880])){return BX.message("EC_REMIND1_SHORT_"+e)}return""},getEditTaskPath:function(){return this.config.editTaskPath},getViewTaskPath:function(e){return this.config.viewTaskPath.replace("#task_id#",e)},readOnlyMode:function(){this.readOnly=this.config.readOnly;if(this.readOnly===undefined){var e=this.calendar.sectionController.getSectionListForEdit();if(!e||!e.length)this.readOnly=true}this.readOnlyMode=BX.proxy(function(){return this.readOnly},this);return this.readOnly},getLoader:function(e){return BX.create("DIV",{props:{className:"calendar-loader"},html:'<svg class="calendar-loader-circular"'+(e?'style="width: '+parseInt(e)+"px; height: "+parseInt(e)+'px;"':"")+' viewBox="25 25 50 50">'+'<circle class="calendar-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+'<circle class="calendar-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+"</svg>"})},applyHacksForPopupzIndex:function(){var e=3200;if(BX.PopupMenu&&BX.PopupMenu.Data){for(var t in BX.PopupMenu.Data){if(BX.PopupMenu.Data.hasOwnProperty(t)&&BX.PopupMenu.Data[t].popupWindow&&BX.PopupMenu.Data[t].popupWindow.isShown()){BX.PopupMenu.Data[t].popupWindow.params.zIndex=e;BX.PopupMenu.Data[t].popupWindow.popupContainer.style.zIndex=e}}}},applyHacksHandlersForPopupzIndex:function(){var e=this,t=3200;BX.addCustomEvent("onPopupShow",function(i){if(e.calendar.viewSlider&&e.calendar.viewSlider.isOpened()||e.calendar.editSlider&&e.calendar.editSlider.isOpened()){if(i.params.zIndex&&i.params.zIndex<t||i.popupContainer.style.zIndex&&t<t){i.params.zIndex=t;i.popupContainer.style.zIndex=t}}})},isFilterEnabled:function(){return this.userIsOwner()&&this.config.counters},getCalDavConnections:function(){return this.config.connections||[]},isRichLocationEnabled:function(){return!!this.config.locationFeatureEnabled},isDarkColor:function(e){e=e.toLowerCase();if({"#9dcf00":true,"#2FC6F6":true,"#56D1E0":true,"#FFA900":true,"#47E4C2":true,"#F87396":true,"#9985DD":true,"#A8ADB4":true,"#AF7E00":true}[e])return false;if(!e)return false;if(e.charAt(0)=="#")e=e.substring(1,7);var t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),n=(t*.8+i+s*.2)/510*100;return n<50},getAvilableViews:function(){return this.config.avilableViews||["day","week","month","list"]},getCustumViews:function(){var e=[];if(this.config.placementParams&&this.config.placementParams.gridPlacementList){e=this.config.placementParams.gridPlacementList}return e},isMeetingsEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},isAccessibilityEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},isPrivateEventsEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},useViewSlider:function(){return this.isMeetingsEnabled()},showEventDescriptionInSimplePopup:function(){return!this.isMeetingsEnabled()},doBxContextFix:function(){if(top!==e){Object.keys(e.BX.message).forEach(function(t){var i={};i[t]=e.BX.message[t];top.BX.message(i)});e.__BX=e.BX;e.BX=top.BX}},restoreBxContextFix:function(){if(e.__BX){e.BX=e.__BX;delete e.__BX}}};if(e.BXEventCalendar){e.BXEventCalendar.Util=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.Util=t})}})(window);
//# sourceMappingURL=calendar-util.map.js