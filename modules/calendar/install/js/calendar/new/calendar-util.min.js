(function(t){function e(t,e,i){this.calendar=t;this.config=e||{};if(!this.config.userSettings){this.config.userSettings={}}this.additionalParams=i;this.dayLength=864e5;this.type=this.config.type;this.userId=parseInt(this.config.userId);this.ownerId=parseInt(this.config.ownerId);this.accessNames={};if(this.config.accessNames){this.handleAccessNames(this.config.accessNames)}this.DATE_FORMAT_BX=BX.message("FORMAT_DATE");this.DATETIME_FORMAT_BX=BX.message("FORMAT_DATETIME");this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT_BX.substr(0,this.DATE_FORMAT_BX.length)===this.DATE_FORMAT_BX){this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));this.TIME_FORMAT_BX=BX.util.trim(this.DATETIME_FORMAT_BX.substr(this.DATE_FORMAT_BX.length))}else{this.TIME_FORMAT_BX=BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS";this.TIME_FORMAT=BX.date.convertBitrixFormat(BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS")}this.TIME_FORMAT_SHORT_BX=this.TIME_FORMAT_BX.replace(":SS","");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.KEY_CODES={backspace:8,enter:13,escape:27,space:32,delete:46,left:37,right:39,up:38,down:40,z:90,y:89,shift:16,ctrl:17,alt:18,cmd:91,cmdRight:93,pageUp:33,pageDown:34}}e.prototype={getWeekDays:function(){return this.config.weekDays},getWeekStart:function(){return this.config.weekStart},getWeekEnd:function(){return{MO:"SU",TU:"MO",WE:"TU",TH:"WE",FR:"TH",SA:"FR",SU:"SA"}[this.config.weekStart]},getWeekDayOffset:function(t){if(!this.weekDayOffsetIndex){var e,i=this.getWeekDays();this.weekDayOffsetIndex={};for(e=0;e<i.length;e++)this.weekDayOffsetIndex[i[e][2]]=e}return this.weekDayOffsetIndex[t]},getWeekDayByInd:function(t){return["SU","MO","TU","WE","TH","FR","SA"][t]},isHoliday:function(t){var e;if(!this.weekHolidays){this.weekHolidays={};for(e in this.config.week_holidays){if(this.config.week_holidays.hasOwnProperty(e)){this.weekHolidays[this.config.week_holidays[e]]=true}}this.yearHolidays={};for(e in this.config.year_holidays){if(this.config.year_holidays.hasOwnProperty(e)){this.yearHolidays[this.config.year_holidays[e]]=true}}this.yearWorkdays={};for(e in this.config.year_workdays){if(this.config.year_workdays.hasOwnProperty(e)){this.yearWorkdays[this.config.year_workdays[e]]=true}}}var i=[6,0,1,2,3,4,5][t.getDay()],n=t.getDate(),r=t.getMonth();return(this.weekHolidays[i]||this.yearHolidays[n+"."+r])&&!this.yearWorkdays[n+"."+r]},isToday:function(t){var e=new Date;return e.getDate()==t.getDate()&&e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()},getWorkTime:function(){this.config.userWorkTime=this.config.userWorkTime||[];if(this.config.userSettings.work_time_start&&this.config.userSettings.work_time_end){this.workTime={start:Math.floor(parseFloat(this.config.userSettings.work_time_start||9)),end:Math.ceil(parseFloat(this.config.userSettings.work_time_end||18))}}else{this.workTime={start:Math.floor(parseFloat(this.config.userWorkTime[0]||9)),end:Math.ceil(parseFloat(this.config.userWorkTime[1]||18))}}this.getWorkTime=BX.proxy((function(){return this.workTime}),this);return this.workTime},setWorkTime:function(t){this.workTime={start:Math.min(Math.max(t.start,0),24),end:Math.min(Math.max(t.end,t.start),24)};BX.userOptions.save("calendar","workTime","start",this.workTime.start);BX.userOptions.save("calendar","workTime","end",this.workTime.end);return this.workTime},formatTime:function(t,e,i){if(BX.type.isDate(t)){e=t.getMinutes();t=t.getHours()}var n="";if(i!==true||!BX.isAmPmMode())i=false;if(e==undefined){e="00"}else{e=parseInt(e,10);if(isNaN(e)){e="00"}else{if(e>59)e=59;e=e<10?"0"+e.toString():e.toString()}}t=parseInt(t,10);if(t>24){t=24}if(isNaN(t)){t=0}if(BX.isAmPmMode()){var r="am";if(t==0){t=12}else if(t==12){r="pm"}else if(t>12){r="pm";t-=12}if(i){n=t.toString()+" "+r}else{n=t.toString()+":"+e.toString()+" "+r}}else{n=t.toString()+":"+e.toString()}return n},formatDate:function(t){if(BX.type.isDate(t))t=t.getTime();return BX.date.format(this.DATE_FORMAT,t/1e3)},formatDateTime:function(t){if(BX.type.isDate(t))t=t.getTime();return BX.date.format(this.DATETIME_FORMAT,t/1e3)},formatDateUsable:function(t,e){var i=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));if(BX.message("LANGUAGE_ID")=="ru"||BX.message("LANGUAGE_ID")=="ua"){i="j F";if(t.getFullYear&&t.getFullYear()!=(new Date).getFullYear()&&e!==false){i+=" Y"}}return BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",i]],t)},parseTime:function(t){var e=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date)+" "+t,false);return e?{h:e.getHours(),m:e.getMinutes()}:e},parseDate:function(t,e,i){var n,r,s,a,o=false;if(!e)e=BX.message("FORMAT_DATETIME");t=BX.util.trim(t);if(i!==false)e=e.replace(":SS","");if(BX.type.isNotEmptyString(t)){a="";for(n=1;n<=12;n++){a=a+"|"+BX.message("MON_"+n)}var u=new RegExp("([0-9]+|[a-z]+"+a+")","ig"),c=t.match(u),f=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),l=[],g=[],h={};if(!c){return null}if(c.length>f.length){f=e.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(n=0,r=c.length;n<r;n++){if(BX.util.trim(c[n])!=""){l[l.length]=c[n]}}for(n=0,r=f.length;n<r;n++){if(BX.util.trim(f[n])!=""){g[g.length]=f[n]}}var d=BX.util.array_search("MMMM",g);if(d>0){l[d]=BX.getNumMonth(l[d]);g[d]="MM"}else{d=BX.util.array_search("M",g);if(d>0){l[d]=BX.getNumMonth(l[d]);g[d]="MM"}}for(n=0,r=g.length;n<r;n++){s=g[n].toUpperCase();h[s]=s=="T"||s=="TT"?l[n]:parseInt(l[n],10)}if(h["DD"]>0&&h["MM"]>0&&h["YYYY"]>0){var m=new Date;if(o){m.setUTCDate(1);m.setUTCFullYear(h["YYYY"]);m.setUTCMonth(h["MM"]-1);m.setUTCDate(h["DD"]);m.setUTCHours(0,0,0)}else{m.setDate(1);m.setFullYear(h["YYYY"]);m.setMonth(h["MM"]-1);m.setDate(h["DD"]);m.setHours(0,0,0)}if((!isNaN(h["HH"])||!isNaN(h["GG"])||!isNaN(h["H"])||!isNaN(h["G"]))&&!isNaN(h["MI"])){if(!isNaN(h["H"])||!isNaN(h["G"])){var T=(h["T"]||h["TT"]||"am").toUpperCase()=="PM";var p=parseInt(h["H"]||h["G"]||0,10);if(T){h["HH"]=p+(p==12?0:12)}else{h["HH"]=p<12?p:0}}else{h["HH"]=parseInt(h["HH"]||h["GG"]||0,10)}if(isNaN(h["SS"]))h["SS"]=0;if(o){m.setUTCHours(h["HH"],h["MI"],h["SS"])}else{m.setHours(h["HH"],h["MI"],h["SS"])}}return m}}return null},findTargetNode:function(t,e){if(t){var i=false,n="data-bx-calendar",r;if(!e)e=this.calendar.viewsCont;if(t.attributes&&t.attributes.length){for(r=0;r<t.attributes.length;r++){if(t.attributes[r].name&&t.attributes[r].name.substr(0,n.length)==n){i=t;break}}}if(!i){i=BX.findParent(t,(function(t){var e;if(t.attributes&&t.attributes.length){for(e=0;e<t.attributes.length;e++){if(t.attributes[e].name&&t.attributes[e].name.substr(0,n.length)==n)return true}}return false}),e)}}return i},getViewHeight:function(){var t=756,e=BX.GetWindowInnerSize(document).innerHeight-300;return Math.max(t,e)},showWeekNumber:function(){return this.getUserOption("showWeekNumbers","N")=="Y"},getWeekNumber:function(t){var e;if(this.getWeekStart()=="SU"){t+=this.dayLength*2}else if(this.getWeekStart()=="MO"){t+=this.dayLength}e=BX.date.format("W",t/1e3);return e},getScrollbarWidth:function(){if(BX.browser.IsMac()){r=17}else{var t=this.calendar.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-outer"}})),e=t.offsetWidth;t.style.overflow="scroll";var i=t.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-inner"}})),n=i.offsetWidth,r=e-n;BX.cleanNode(t,true)}this.getScrollbarWidth=function(){return r};return r},getMessagePlural:function(t,e){return BX.Loc.getMessagePlural(t,e)},getUserOption:function(t,e){if(this.config.userSettings[t]===undefined)return e;return this.config.userSettings[t]},setUserOption:function(t,e){if(this.config.userSettings[t]!==e){BX.userOptions.save("calendar","user_settings",t,e);this.config.userSettings[t]=e}},getKeyCodes:function(){return this.KEY_CODES},getMousePos:function(e){if(!e)e=t.event;var i=0,n=0;if(e.pageX||e.pageY){i=e.pageX;n=e.pageY}else if(e.clientX||e.clientY){i=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;n=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}return{x:i,y:n}},getDayCode:function(t){return t.getFullYear()+"-"+("0"+~~(t.getMonth()+1)).substr(-2,2)+"-"+("0"+~~t.getDate()).substr(-2,2)},getTextColor:function(t){if(!t)return false;if(t.charAt(0)=="#")t=t.substring(1,7);var e=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16),r=(e*.8+i+n*.2)/510*100;return r<50},getTimeValue:function(t){return t.getHours()+Math.round(t.getMinutes()*100/60)/100},getTimeEx:function(t){return Math.round(t.getTime()/6e4)*6e4},getTimeByInt:function(t){t=parseInt(t);var e=Math.floor(t/60),i=t-e*60;return{hour:e,min:i}},getTimeByFraction:function(t,e){e=e||5;t=Math.min(Math.max(t,0),24);var i=true,n=Math.floor(t),r=i?Math.floor((t-n)*60/e)*e:Math.round((t-n)*60/e)*e;if(r==60){r=0;n++}if(n==24&&r==0){n=23;r=59}return{h:n,m:r}},getWeekNumberInMonthByDate:function(t){var e=new Date;e.setFullYear(t.getFullYear(),t.getMonth(),1);return parseInt(BX.date.format("W",t.getTime()/1e3))-parseInt(BX.date.format("W",e.getTime()/1e3))},getSimpleTimeList:function(){var t,e=[];for(t=0;t<24;t++){e.push({value:t*60,label:this.formatTime(t,0)});e.push({value:t*60+30,label:this.formatTime(t,30)})}this.getSimpleTimeList=function(){return e};return e},adaptTimeValue:function(t){t=parseInt(t.h*60)+parseInt(t.m);var e=this.getSimpleTimeList(),i=24*60,n=false,r;for(r=0;r<e.length;r++){if(Math.abs(e[r].value-t)<i){i=Math.abs(e[r].value-t);n=r;if(i<=15)break}}return e[n||0]},getMeetingRoomList:function(){return this.config.meetingRooms||[]},mergeSocnetDestinationConfig:function(t){if(t.USERS){for(var e in t.USERS){if(t.USERS.hasOwnProperty(e)&&!this.additionalParams["socnetDestination"].USERS[e]){this.additionalParams["socnetDestination"].USERS[e]=t.USERS[e]}}}},getSocnetDestinationConfig:function(t){var e,i=this.additionalParams["socnetDestination"]||{};if(t=="items"){e={users:i.USERS||{},groups:i.EXTRANET_USER=="Y"||i.DENY_TOALL?{}:{UA:{id:"UA",name:i.DEPARTMENT?BX.message("EC_SOCNET_DESTINATION_4"):BX.message("EC_SOCNET_DESTINATION_3")}},sonetgroups:i.SONETGROUPS||{},department:i.DEPARTMENT||{},departmentRelation:i.DEPARTMENT_RELATION||{}}}else if(t=="itemsLast"&&i.LAST){e={users:i.LAST.USERS||{},groups:i.EXTRANET_USER=="Y"?{}:{UA:true},sonetgroups:i.LAST.SONETGROUPS||{},department:i.LAST.DEPARTMENT||{}}}else if(t=="itemsSelected"){e=i.SELECTED||{}}return e||{}},getActionUrl:function(){return this.config.actionUrl},getTimezoneList:function(){return this.additionalParams.timezoneList||[]},getDefaultColors:function(){return this.additionalParams.defaultColorsList},getFormSettings:function(t){return this.additionalParams.formSettings&&this.additionalParams.formSettings[t]?this.additionalParams.formSettings[t]:{}},saveFormSettings:function(t,e){if(t){BX.userOptions.save("calendar",t,"pinnedFields",e.pinnedFields)}},randomInt:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))},handleAccessNames:function(t){for(var e in t){if(t.hasOwnProperty(e)){this.accessNames[e]=t[e]}}},getAccessName:function(t){return this.accessNames[t]||t},setAccessName:function(t,e){this.accessNames[t]=e},getSectionAccessTasks:function(){return this.config.sectionAccessTasks},getTypeAccessTasks:function(){return this.config.typeAccessTasks},getDefaultTypeAccessTask:function(){var t,e=this.getTypeAccessTasks();for(t in e){if(e.hasOwnProperty(t)&&e[t].name=="calendar_type_view"){break}}this.getDefaultTypeAccessTask=function(){return t};return t},getDefaultSectionAccessTask:function(){var t,e=this.getSectionAccessTasks();for(t in e){if(e.hasOwnProperty(t)&&e[t].name==="calendar_view"){break}}this.getDefaultSectionAccessTask=function(){return t};return t},getSuperposedTrackedUsers:function(){return(this.config.trackingUsersList||[]).sort((function(t,e){if(!t.LAST_NAME)t.LAST_NAME="";if(!e.LAST_NAME)e.LAST_NAME="";return t.LAST_NAME.localeCompare(e.LAST_NAME)}))},getSuperposedTrackedGroups:function(){return this.config.trackingGroupList||[]},isUserCalendar:function(){return this.type==="user"},isCompanyCalendar:function(){return this.type==="company_calendar"||this.type==="calendar_company"||this.type==="company"},isGroupCalendar:function(){return this.type==="group"},userIsOwner:function(){return this.isUserCalendar()&&this.userId===this.ownerId},isExtranetUser:function(){return this.config.isExtranetUser},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},addOpacityToHex(t,e){return this.rgbaToHex(this.hexToRgba(t,e))},hexToRgba:function(t,e){var i=this.hexToRgb(t);if(!i)i=this.hexToRgb("#9dcf00");return"rgba("+i.r+", "+i.g+", "+i.b+", "+e+")"},rgbaToHex:function(t){return this.rgbToHex(this.rgbaToRgb(t))},rgbToHex:function(t){function e(t){const e=t.toString(16);return e.length===1?"0"+e:e}return"#"+e(t.r)+e(t.g)+e(t.b)},rgbaToRgb:function(t){if(t.r===undefined){t=this.rgbaFromString(t)}return{r:Math.round((t.a*(t.r/255)+(1-t.a))*255),g:Math.round((t.a*(t.g/255)+(1-t.a))*255),b:Math.round((t.a*(t.b/255)+(1-t.a))*255)}},rgbaFromString(t){const e=t.replace(/^rgba?\(|\s+|\)$/g,"").split(",").map((t=>parseFloat(t)));return{r:e[0],g:e[1],b:e[2],a:e[3]??255}},parseLocation:function(t){if(!t)t="";var e,i={type:false,value:false,str:t};if(t.length>5&&t.substr(0,5)=="ECMR_"){i.type="mr";e=t.split("_");if(e.length>=2){if(!isNaN(parseInt(e[1]))&&parseInt(e[1])>0){i.value=i.mrid=parseInt(e[1])}if(!isNaN(parseInt(e[2]))&&parseInt(e[2])>0){i.mrevid=parseInt(e[2])}}}else if(t.length>5&&t.substr(0,9)=="calendar_"){i.type="calendar";e=t.split("_");if(e.length>=2){if(!isNaN(parseInt(e[1]))&&parseInt(e[1])>0){i.value=i.room_id=parseInt(e[1])}if(!isNaN(parseInt(e[2]))&&parseInt(e[2])>0){i.room_event_id=parseInt(e[2])}}}return i},getTextLocation:function(t){var e=typeof t==="object"?t:this.parseLocation(t),i,n=e.str;if(e.type=="mr"){n=BX.message("EC_LOCATION_EMPTY");var r=this.calendar.util.getMeetingRoomList();for(i=0;i<r.length;i++){if(e.value==r[i].ID){n=r[i].NAME;break}}}if(e.type=="calendar"){n=BX.message("EC_LOCATION_EMPTY");var s=BX.Calendar.Controls.Location.getLocationList();for(i=0;i<s.length;i++){if(e.value==s[i].ID){n=s[i].NAME;break}}}return n},getTextReminder:function(t){if(BX.util.in_array(t,[0,5,10,15,30,60,120,1440,2880])){return BX.message("EC_REMIND1_SHORT_"+t)}return""},getEditTaskPath:function(){return this.config.editTaskPath},getViewTaskPath:function(t){return this.config.viewTaskPath.replace("#task_id#",t)},readOnlyMode:function(){this.readOnly=this.config.readOnly;if(this.readOnly===undefined){var t=this.calendar.sectionController.getSectionListForEdit();if(!t||!t.length)this.readOnly=true}this.readOnlyMode=BX.proxy((function(){return this.readOnly}),this);return this.readOnly},getLoader:function(t){return BX.create("DIV",{props:{className:"calendar-loader"},html:'<svg class="calendar-loader-circular"'+(t?'style="width: '+parseInt(t)+"px; height: "+parseInt(t)+'px;"':"")+' viewBox="25 25 50 50">'+'<circle class="calendar-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+'<circle class="calendar-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+"</svg>"})},isFilterEnabled:function(){return this.isUserCalendar()&&this.ownerId===this.userId||this.isCompanyCalendar()||this.isGroupCalendar()},getCounters:function(){return this.config.counters},getCalDavConnections:function(){return this.config.connections||[]},isRichLocationEnabled:function(){return!!this.config.locationFeatureEnabled},isDarkColor:function(t){t=t.toLowerCase();if({"#86b100":true,"#0092cc":true,"#00afc7":true,"#da9100":true,"#e89b06":true,"#00b38c":true,"#de2b24":true,"#bd7ac9":true,"#838fa0":true,"#ab7917":true,"#c3612c":true,"#e97090":true,"#9dcf00":true,"#2fc6f6":true,"#56d1e0":true,"#ffa900":true,"#47e4c2":true,"#f87396":true,"#9985dd":true,"#a8adb4":true,"#af7e00":true}[t]){return true}if(!t)return false;if(t.charAt(0)==="#")t=t.substring(1,7);var e=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16),r=(e*.8+i+n*.2)/510*100;return r<50},getAvilableViews:function(){return this.config.avilableViews||["day","week","month","list"]},getCustumViews:function(){var t=[];if(this.config.placementParams&&this.config.placementParams.gridPlacementList){t=this.config.placementParams.gridPlacementList}return t},isMeetingsEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},isAccessibilityEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},isPrivateEventsEnabled:function(){return this.config.bSocNet&&this.config.bIntranet},useViewSlider:function(){return this.isMeetingsEnabled()},showEventDescriptionInSimplePopup:function(){return!this.isMeetingsEnabled()},doBxContextFix:function(){if(t.top!==t){Object.keys(t.BX.message).forEach((function(e){var i={};i[e]=t.BX.message[e];t.top.BX.message(i)}));t.__BX=t.BX;if(t.BX.Access&&!t.top.BX.Access){t.top.BX.Access=t.BX.Access}if(t.BX.SocNetLogDestination&&!t.top.BX.SocNetLogDestination){t.top.BX.SocNetLogDestination=t.BX.SocNetLogDestination}t.BX=t.top.BX}},restoreBxContextFix:function(){if(t.__BX){t.BX=t.__BX;delete t.__BX}}};e.getSimpleTimeList=e.prototype.getSimpleTimeList;e.formatTime=e.prototype.formatTime;e.getTimeByInt=e.prototype.getTimeByInt;if(t.BXEventCalendar){t.BXEventCalendar.Util=e}else{BX.addCustomEvent(t,"onBXEventCalendarInit",(function(){t.BXEventCalendar.Util=e}))}})(window);
//# sourceMappingURL=calendar-util.map.js