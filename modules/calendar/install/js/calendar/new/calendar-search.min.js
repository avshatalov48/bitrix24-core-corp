(function(e){function t(e,t){this.calendar=e;this.util=this.calendar.util;this.filterId=t.filterId;this.minSearchStringLength=2;this.showCounters=false;this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION",value:t.counters.invitation||0}];this.filter=BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.applyFilter,this))}}t.prototype={getFilter:function(){return this.filter},updateCounters:function(){var e,t=this;this.showCounters=false;BX.cleanNode(this.calendar.countersCont);this.countersWrap=this.calendar.countersCont.appendChild(BX.create("DIV",{props:{className:"calendar-counter-title"}}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.showCounters=true;break}}if(this.showCounters){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-page-name"},text:BX.message("EC_COUNTER_TOTAL")+":"}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-container"+" "+this.counters[e].className},attrs:{"data-bx-counter":this.counters[e].id},html:'<span class="calendar-counter-inner">'+'<span class="calendar-counter-number">'+this.counters[e].value+"</span>"+'<span class="calendar-counter-text">'+this.util.getMessagePlural(this.counters[e].pluralMessageId,this.counters[e].value)+"</span>"+"</span>",events:{click:function(e){return function(){t.appplyCounterEntries(e.id)}}(this.counters[e])}}))}}}else{this.countersWrap.innerHTML=BX.message("EC_NO_COUNTERS")}},appplyCounterEntries:function(e){if(e=="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}},beforeFilterApply:function(){if(!this.isFilterEmpty()){}},applyFilter:function(e,t,i,s,n){if(n){n.autoResolve=false}if(this.isFilterEmpty()){if(this.calendar.getView().resetFilterMode){this.calendar.getView().resetFilterMode({resetSearchFilter:false})}if(s){s.fulfill()}}else{this.calendar.setView("list",{animation:false});setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode()},this),100);this.calendar.request({data:{action:"get_filter_data"},handler:BX.delegate(function(e){if(e&&e.entries){if(!this.calendar.getView().filterMode){setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode();this.displaySearchResult(e)},this),100)}else{this.displaySearchResult(e)}}if(s){s.fulfill()}},this)})}},displaySearchResult:function(t){var i,s=[];for(i=0;i<t.entries.length;i++){s.push(new e.BXEventCalendar.Entry(this.calendar,t.entries[i]))}this.calendar.getView().displayResult(s);if(BX.type.isPlainObject(t.counters)){for(i=0;i<this.counters.length;i++){if(t.counters[this.counters[i].id]!==undefined){this.counters[i].value=t.counters[this.counters[i].id]||0}}this.updateCounters()}},isFilterEmpty:function(){var e=this.filter.getSearch();return!e.getLastSquare()&&(!e.getSearchString()||e.getSearchString().length<this.minSearchStringLength)},searchInput:function(){},resetFilter:function(){this.filter.resetFilter()}};if(e.BXEventCalendar){e.BXEventCalendar.Search=t}else{BX.addCustomEvent(e,"OnBXEventCalendarInit",function(){e.BXEventCalendar.Search=t})}})(window);