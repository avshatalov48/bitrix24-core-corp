(function(e){function t(e,t){this.calendar=e;this.util=this.calendar.util;this.filterId=t.filterId;this.minSearchStringLength=2;this.showCounters=false;this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION",value:t.counters.invitation||0}];this.filter=BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.applyFilter,this))}}t.prototype={getFilter:function(){return this.filter},updateCounters:function(){var e,t=this;this.showCounters=false;BX.cleanNode(this.calendar.countersCont);this.countersWrap=this.calendar.countersCont.appendChild(BX.create("DIV",{props:{className:"calendar-counter-title"}}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.showCounters=true;break}}if(this.showCounters){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-page-name"},text:BX.message("EC_COUNTER_TOTAL")+":"}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-container"+" "+this.counters[e].className},attrs:{"data-bx-counter":this.counters[e].id},html:'<span class="calendar-counter-inner">'+'<span class="calendar-counter-number">'+this.counters[e].value+"</span>"+'<span class="calendar-counter-text">'+BX.Loc.getMessagePlural(this.counters[e].pluralMessageId,this.counters[e].value)+"</span>"+"</span>",events:{click:function(e){return function(){t.appplyCounterEntries(e.id)}}(this.counters[e])}}))}}}else{this.countersWrap.innerHTML=BX.message("EC_NO_COUNTERS")}},appplyCounterEntries:function(e){if(e==="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}},beforeFilterApply:function(){if(!this.isFilterEmpty()){}},applyFilter:function(e,t,i,n,s){return new Promise((function(e){if(s){s.autoResolve=false}if(this.isFilterEmpty()){if(this.calendar.getView().resetFilterMode){this.calendar.getView().resetFilterMode({resetSearchFilter:false})}if(n){n.fulfill()}}else{this.calendar.setView("list",{animation:false});this.calendar.getView().applyFilterMode();BX.ajax.runAction("calendar.api.calendarajax.getFilterData",{data:{ownerId:this.calendar.util.config.ownerId,userId:this.calendar.util.config.userId,type:this.calendar.util.config.type}}).then(function(t){if(t.data.entries){if(!this.calendar.getView().filterMode){this.calendar.getView().applyFilterMode();this.displaySearchResult(t.data)}else{this.displaySearchResult(t.data)}}if(n){n.fulfill()}e(t.data)}.bind(this),function(t){e(t.data)}.bind(this))}}))},displaySearchResult:function(t){var i,n=[];for(i=0;i<t.entries.length;i++){n.push(new e.BXEventCalendar.Entry(this.calendar,t.entries[i]))}this.calendar.getView().displayResult(n);this.setCountersValue(t.counters)},setCountersValue:function(e){if(BX.type.isPlainObject(e)){for(var t=0;t<this.counters.length;t++){if(e[this.counters[t].id]!==undefined){this.counters[t].value=e[this.counters[t].id]||0}}this.updateCounters()}},isFilterEmpty:function(){var e=this.filter.getSearch();return!e.getLastSquare()&&(!e.getSearchString()||e.getSearchString().length<this.minSearchStringLength)},searchInput:function(){},resetFilter:function(){this.filter.resetFilter()}};if(e.BXEventCalendar){e.BXEventCalendar.Search=t}else{BX.addCustomEvent(e,"OnBXEventCalendarInit",(function(){e.BXEventCalendar.Search=t}))}})(window);
//# sourceMappingURL=calendar-search.map.js