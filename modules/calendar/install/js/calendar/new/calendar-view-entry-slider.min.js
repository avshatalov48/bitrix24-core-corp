(function(t){function e(t){this.calendar=t;this.id="calendar_view_slider_"+Math.round(Math.random()*1e6);this.sliderId="calendar:view-entry-slider";this.zIndex=3100;this.DOM={}}e.prototype={show:function(t){this.entry=t.entry;this.formType=t.formType||"slider_main";this.calendar.util.doBxContextFix();BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.createContent,this),events:{onDestroy:function(){this.xhr.abort()}.bind(this),onClose:BX.proxy(this.hide,this),onCloseComplete:BX.proxy(this.destroy,this)},printable:true});this.calendar.disableKeyHandler();this.opened=true},hide:function(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){if(this.denyClose){t.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this))}}},destroy:function(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}]);BX.SidePanel.Instance.destroy(this.sliderId);this.calendar.enableKeyHandler();if(this.userListPopup)this.userListPopup.close();setTimeout(BX.delegate(function(){this.calendar.getView().deselectEntry()},this),300);this.opened=false;this.calendar.util.restoreBxContextFix()}},isOpened:function(){return this.opened},close:function(){BX.SidePanel.Instance.close()},createContent:function(t){top.BX.onCustomEvent(top,"onCalendarBeforeCustomSliderCreate");var e=new BX.Promise;this.xhr=BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_view_slider",unique_id:this.id,form_type:this.formType,sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",entry_id:this.entry.id,date_from:this.entry.data["~CURRENT_DATE"]||this.entry.data.DATE_FROM,section_name:this.entry.getSectionName(),date_from_offset:this.entry.data.TZ_OFFSET_FROM,reqId:Math.round(Math.random()*1e6)},BX.delegate(function(s){if(t.isDestroyed()){e.fulfill()}else{e.fulfill(BX.util.trim(s));this.initControls()}},this));return e},initControls:function(){this.DOM.buttonSet=BX(this.id+"_buttonset");if(!this.DOM.buttonSet){return}this.initPlannerControl();this.initUserListControl();this.DOM.editButton=BX(this.id+"_but_edit");this.DOM.delButton=BX(this.id+"_but_del");if(BX(this.id+"_time_inner_wrap").offsetHeight>50){BX.addClass(BX(this.id+"_time_wrap"),"calendar-slider-sidebar-head-long-time")}if(this.calendar.entryController.canDo(this.entry,"edit")){BX.bind(this.DOM.editButton,"click",BX.delegate(function(){BX.SidePanel.Instance.close(false,BX.delegate(function(){this.calendar.entryController.editEntry({entry:this.entry})},this))},this))}else{BX.remove(this.DOM.editButton)}if(this.calendar.entryController.canDo(this.entry,"delete")){BX.bind(this.DOM.delButton,"click",BX.delegate(function(){this.calendar.entryController.deleteEntry(this.entry)},this))}else{BX.remove(this.DOM.delButton)}BX.viewElementBind(this.id+"_"+this.entry.id+"_files_wrap",{showTitle:true},function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))});if(this.entry&&this.entry.getCurrentStatus()){this.initAcceptMeetingControll()}var t=BX(this.id+"_sidebar_inner");if(t){var e=t.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(e.length>=2){BX.removeClass(e[e.length-1],"calendar-slider-sidebar-border-bottom")}}this.DOM.copyButton=BX(this.id+"_copy_url_btn");if(this.DOM.copyButton){BX.bind(this.DOM.copyButton,"click",BX.proxy(this.copyEventUrl,this))}},initPlannerControl:function(){this.plannerId=this.id+"_view_slider_planner";this.DOM.plannerWrap=BX(this.id+"_view_planner_wrap");setTimeout(BX.delegate(function(){if(this.DOM.plannerWrap){BX.removeClass(this.DOM.plannerWrap,"hidden")}},this),500);setTimeout(BX.delegate(function(){if(this.DOM.plannerWrap&&this.DOM.plannerWrap.offsetWidth){BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:this.plannerId,timeoutCheck:true,width:this.DOM.plannerWrap.offsetWidth}])}},this),200);BX.bind(t,"resize",BX.delegate(function(){if(this.DOM.plannerWrap&&this.DOM.plannerWrap.offsetWidth){BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:this.plannerId,timeoutCheck:true,width:this.DOM.plannerWrap.offsetWidth}])}},this))},initUserListControl:function(){var t={y:[],i:[],q:[],n:[]};if(this.entry.isMeeting()){this.entry.getAttendees().forEach(function(e){if(e.STATUS==="H"){t.y.push(e)}else if(t[e.STATUS.toLowerCase()]){t[e.STATUS.toLowerCase()].push(e)}},this)}BX.bind(BX(this.id+"_attendees_y"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_y"),t.y)},this));BX.bind(BX(this.id+"_attendees_n"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_n"),t.n)},this));BX.bind(BX(this.id+"_attendees_q"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_q"),t.q)},this));BX.bind(BX(this.id+"_attendees_i"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_i"),t.i)},this))},showUserListPopup:function(t,e){if(this.userListPopup)this.userListPopup.close();if(!e||!e.length)return;this.DOM.userListPopupWrap=BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});e.forEach(function(t){var e=this.DOM.userListPopupWrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));e.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(BX.create("IMG",{props:{width:34,height:34,src:t.AVATAR}}));e.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(BX.create("A",{props:{href:t.URL?t.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:t.DISPLAY_NAME}))},this);this.userListPopup=BX.PopupWindowManager.create(this.calendar.id+"-user-list-popup",t,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:220,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup",zIndex:4e3});this.userListPopup.setAngle({offset:36});this.userListPopup.show();BX.addCustomEvent(this.userListPopup,"onPopupClose",BX.delegate(function(){this.userListPopup.destroy()},this))},initAcceptMeetingControll:function(){this.setStatus=new s({calendar:this.calendar,wrap:BX(this.id+"_status_buttonset"),currentStatus:BX(this.id+"_current_status").value||this.entry.getCurrentStatus(),changeStatusCallback:BX.delegate(function(t){return this.calendar.entryController.setMeetingStatus(this.entry,t)},this)})},copyEventUrl:function(){var t=this.calendar.util.getEventPath(this.entry);if(!BX.clipboard.copy(t)){return}this.timeoutIds=this.timeoutIds||[];var e={content:BX.message("CALENDAR_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20};var s=new BX.PopupWindow("calendar_clipboard_copy",this.DOM.copyButton,e);s.show();var i;while(i=this.timeoutIds.pop())clearTimeout(i);i=setTimeout(function(){s.close()},1500);this.timeoutIds.push(i)}};function s(t){this.calendar=t.calendar;this.wrap=t.wrap;this.id=this.calendar.id+"_set_status_button";this.status=t.currentStatus;this.changeStatusCallback=t.changeStatusCallback;this.zIndex=3100;this.create();this.updateStatus()}s.prototype={create:function(){this.selectorButton=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-transparent webform-small-button-dropdown"},events:{click:BX.proxy(this.showPopup,this)}}));this.selectorButtonText=this.selectorButton.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-text"}}));this.selectorButtonIcon=this.selectorButton.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-icon"}}));this.buttonY=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.proxy(function(){this.setStatus("Y")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_Y")}));this.buttonI=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-transparent"},style:{display:"none"},events:{click:BX.proxy(function(){this.setStatus("I")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_I")}));this.buttonN=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-link"},events:{click:BX.proxy(function(){this.setStatus("N")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_N")}))},updateStatus:function(){if(this.status==="Q"){this.selectorButton.style.display="none";this.buttonY.style.display="";this.buttonN.style.display=""}else{this.selectorButton.style.display="";this.selectorButtonText.innerHTML=BX.message("EC_VIEW_STATUS_BUT_"+this.status);this.buttonY.style.display="none";this.buttonI.style.display="none";this.buttonN.style.display="none"}},setStatus:function(t){this.status=t;if(this.menuPopup){this.menuPopup.close()}var e=true;if(BX.type.isFunction(this.changeStatusCallback)){e=this.changeStatusCallback(this.status)}if(e){this.updateStatus()}},showPopup:function(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}var t;if(this.status==="Y"||this.status==="H"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_N"),onclick:BX.proxy(function(){this.setStatus("N")},this)}]}else if(this.status==="N"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_Y"),onclick:BX.proxy(function(){this.setStatus("Y")},this)}]}else if(this.status==="I"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_Y"),onclick:BX.proxy(function(){this.setStatus("Y")},this)},{text:BX.message("EC_VIEW_DESIDE_BUT_N"),onclick:BX.proxy(function(){this.setStatus("N")},this)}]}this.menuPopup=BX.PopupMenu.create(this.id,this.selectorButtonIcon,t,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:15,offsetLeft:5,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",BX.delegate(function(){BX.PopupMenu.destroy(this.id);this.menuPopup=null},this))}};if(t.BXEventCalendar){t.BXEventCalendar.ViewEntrySlider=e}else{BX.addCustomEvent(t,"onBXEventCalendarInit",function(){t.BXEventCalendar.ViewEntrySlider=e})}})(window);
//# sourceMappingURL=calendar-view-entry-slider.map.js