(function(e){var t=e.BXEventCalendarView;function s(){t.apply(this,arguments);this.initConfig();this.preBuild()}s.prototype=Object.create(t.prototype);s.prototype.constructor=s;s.prototype.initConfig=function(){this.name="day";this.gridLineHeight=60;this.slotHeight=20;this.offHoursCollapsedHeight=15;this.title=BX.message("EC_VIEW_DAY");this.entryWidthOffset=2;this.lastEntryWidthOffset=8;this.hotkey="D";this.contClassName="calendar-day-view";this.gridWrapClass="calendar-grid-wrap";if(BX.isAmPmMode()){this.gridWrapClass+=" is-am-pm-mode"}this.fullDayContClass="calendar-grid-day-full-days-events-holder";this.fullDayContHolderClass="calendar-grid-week-full-days-events-holder-grid";this.topEntryHolderClass="calendar-grid-day-events-holder";this.outerGridClass="calendar-grid-day-container";this.gridClass="calendar-grid-day";this.gridClassCurrent="calendar-grid-day-current";this.gridClassNext="calendar-grid-day-left-slide";this.gridClassPrevious="calendar-grid-day-right-slide";this.changeNextClass="calendar-change-day-left-slide";this.changePreviousClass="calendar-change-day-right-slide";this.gridRowClass="calendar-grid-day-row";this.gridCellClass="calendar-grid-day-cell";this.gridTimelinesClass="calendar-grid-day-time-lines";this.gridTimelineHourClass="calendar-grid-day-time-line-hour";this.gridTimelineHourLabelClass="calendar-grid-day-time-line-hour-label";this.gridTimelineHourLabelClassInner="calendar-grid-week-time-line-hour-label-inner";this.gridNowTimeClass="calendar-grid-day-time-line-hour-now";this.gridNowTimeLabelClass="calendar-grid-day-time-line-hour-label";this.gridNowTimeLineClass="calendar-grid-day-time-line-hour-now-line";this.gridNowTimeDotClass="calendar-grid-day-time-line-hour-now-dot";this.gridTimeTranslucentClass="calendar-grid-time-line-translucent";this.offHoursClass="calendar-grid-off-hours";this.offHoursCollapseClass="calendar-grid-off-hours-collapse";this.offHoursAnimateClass="calendar-grid-off-hours-animate";this.offHoursFastAnimateClass="calendar-grid-off-hours-fast-animate";this.dayCount=1};s.prototype.preBuild=function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName},style:{display:"none"}})};s.prototype.build=function(){this.titleCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-week-row-days-week"}}));this.fullDayEventsCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:this.fullDayContClass}}));this.gridWrap=this.viewCont.appendChild(BX.create("DIV",{props:{className:this.gridWrapClass},style:{height:this.util.getViewHeight()+"px"}}));this.checkTimelineScroll();this.outerGrid=this.gridWrap.appendChild(BX.create("DIV",{props:{className:this.outerGridClass}}));this.grid=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassCurrent}}));BX.bind(this.gridWrap,"mousedown",BX.proxy(this.handleMousedown,this))};s.prototype.show=function(){t.prototype.show.apply(this,arguments);this.buildDaysGrid();this.showNavigationCalendar();BX.remove(this.calendar.additionalInfoOuter);this.loadEntries().then((e=>{this.entries=e;this.displayEntries()}))};s.prototype.hide=function(){t.prototype.hide.apply(this,arguments)};s.prototype.setFullDayHolderSize=function(e){this.fullDayEventsCont.style.height=e*(this.slotHeight+1)+"px"};s.prototype.increaseViewRangeDate=function(){this.changeViewRangeDate(this.dayCount);this.highlightAll();this.setTitle();if(this.gridWrap)this.gridWrap.style.overflowX="hidden";var e=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassNext+" "+this.animateClass}}));BX.addClass(this.grid,this.animateClass);this.buildDaysGrid({grid:e});this.preloadEntries();setTimeout(BX.delegate((function(){BX.addClass(this.outerGrid,this.changeNextClass);setTimeout(BX.delegate((function(){BX.removeClass(this.outerGrid,this.changeNextClass);BX.removeClass(e,this.gridClassNext);BX.addClass(e,this.gridClassCurrent);BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.gridWrap.style.overflowX="";this.loadEntries().then((e=>{this.entries=e;this.displayEntries()}))}),this),400)}),this),0)};s.prototype.decreaseViewRangeDate=function(){this.changeViewRangeDate(-this.dayCount);this.highlightAll();this.setTitle();this.gridWrap.style.overflowX="hidden";var e=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassPrevious+" "+this.animateClass}}));BX.addClass(this.grid,this.animateClass);this.buildDaysGrid({grid:e});setTimeout(BX.delegate((function(){BX.addClass(this.outerGrid,this.changePreviousClass);setTimeout(BX.delegate((function(){BX.removeClass(this.outerGrid,this.changePreviousClass);BX.removeClass(e,this.gridClassPrevious);BX.addClass(e,this.gridClassCurrent);BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.gridWrap.style.overflowX="";this.loadEntries().then((e=>{this.entries=e;this.displayEntries()}))}),this),400)}),this),0)};s.prototype.changeViewRangeDate=function(e){var t=this.calendar.getViewRangeDate(),s=new Date(t.getTime());s.setDate(s.getDate()+e);this.calendar.setViewRangeDate(s);return s};s.prototype.getViewRange=function(){var e=this.calendar.getViewRangeDate(),t=new Date(e.getTime());t.setDate(t.getDate()+this.dayCount);return{start:e,end:t}};s.prototype.getAdjustedDate=function(e,t){if(!e){e=new Date}if(t&&e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(t&&e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var s=false;if(e&&e.getTime){e.setHours(0,0,0,0);s=new Date(e.getTime())}return s};s.prototype.adjustViewRangeToDate=function(e,t){var s=this.calendar.getViewRangeDate(),i=false;if(e&&e.getTime){e.setHours(0,0,0,0);var a=(e.getTime()-s.getTime())/this.calendar.util.dayLength;if(a===this.dayCount){this.increaseViewRangeDate()}else if(a===-this.dayCount){this.decreaseViewRangeDate()}else{i=new Date(e.getTime());i.setHours(0,0,0,0);this.calendar.setViewRangeDate(i);if(t===false){this.show()}else{this.fadeAnimation(this.getContainer(),100,BX.delegate((function(){this.show();this.getContainer().style.opacity=0;this.showAnimation(this.getContainer(),300)}),this))}}}return i};s.prototype.buildDaysGrid=function(e){if(!e)e={};var t,s,i=e.grid||this.grid,a=this.calendar.getViewRangeDate(),r=new Date(a.getTime());var o=BX.clone(this.getViewRange(),true);if(this.dayCount>1){r=this.getAdjustedDate(r)}BX.cleanNode(i);BX.cleanNode(this.fullDayEventsCont);this.holderTitle=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-day-full-days-events-holder-title"},text:BX.message("EC_VIEW_DAY")}));this.fullDayEventsHolderCont=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:this.fullDayContHolderClass}}));this.topEntryHolder=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:this.topEntryHolderClass}}));this.gridRow=i.appendChild(BX.create("DIV",{props:{className:this.gridRowClass+" "+this.animateClass},style:{height:this.getDayGridHeight()+"px"}}));this.dayIndex={};this.days=[];if(this.titleCont){BX.cleanNode(this.titleCont)}this.gridRowShadow=BX.create("DIV",{props:{className:"calendar-grid-week-row-shadow"}});for(t=0;t<this.dayCount;t++){if(t===0){o.start=new Date(r.getTime());o.start.setHours(0,0,0,0)}else if(t===this.dayCount-1){o.end=new Date(r.getTime());o.end.setHours(0,0,0,0)}s=this.util.getDayCode(r);this.fullDayEventsHolderCont.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-week-day":s},props:{className:this.gridCellClass}}));this.buildDayCell({date:r,month:"previous",grid:i});if(this.dayCount>1){r.setDate(r.getDate()+1)}this.gridRowShadow.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-timeline-day":s},props:{className:"calendar-grid-week-cell"},html:'<span class="calendar-grid-cell-inner"></span>'}))}this.timeLinesCont=this.gridRow.appendChild(BX.create("DIV",{props:{className:this.gridTimelinesClass}}));this.timelineEntryHolder=this.gridRow.appendChild(BX.create("DIV",{props:{className:this.topEntryHolderClass}}));this.timeLinesIndex=[];for(t=0;t<=24;t++){this.timeLinesIndex[t]=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourClass},html:'<div class="'+this.gridTimelineHourLabelClass+'">'+this.calendar.util.formatTime(t,0,true)+"</div>",style:{top:t*this.gridLineHeight+"px"}}))}this.gridRow.appendChild(this.gridRowShadow);setTimeout(BX.delegate((function(){if(!this.gridWrap.scrollTop&&!this.isCollapsedOffHours){var e=this.util.getWorkTime();this.gridWrap.scrollTop=e.start*this.gridLineHeight-5}}),this),0);this.showOffHours();this.calendar.setDisplayedViewRange(o);this.showNowTime()};s.prototype.buildDayCell=function(e){var t=e.date,s="",i="",a=Math.round(t.getTime()/1e3)*1e3,r=t.getDay(),o=this.util.getDayCode(t),n=this.util.getWeekDayByInd(r);if(e.month==="previous"){i+=" calendar-grid-previous-month-day"}else if(e.month==="next"){i+=" calendar-grid-next-month-day"}if(this.util.isHoliday(t)){i+=" calendar-grid-holiday"}let l="";if(this.util.isToday(t)){s+=" calendar-grid-today";l="calendar-grid-today"}if(this.titleCont&&this.name==="week"){this.titleCont.appendChild(BX.create("DIV",{props:{className:this.gridCellClass+s},html:'<span class="calendar-grid-cell-inner" data-bx-calendar-date="'+a+'">'+BX.message("EC_WEEK_TITLE").replace("#DAY_OF_WEEK#",BX.date.format("D",a/1e3)).replace("#DATE#",t.getDate())+"</span>"}))}else if(this.titleCont){this.titleCont.appendChild(BX.create("DIV",{props:{className:this.gridCellClass+s},html:'<span class="calendar-grid-cell-inner" data-bx-calendar-date="'+a+'">'+'<span class="calendar-day-of-week-day">'+BX.date.format("l",a/1e3)+"</span>"+"</span>"}))}this.days.push({date:new Date(t.getTime()),dayOffset:this.util.getWeekDayOffset(n),node:this.gridRow.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-timeline-day":o},props:{className:this.gridCellClass+i+" a1"+" "+l},html:'<span class="calendar-grid-cell-inner"></span>'})),dayCode:o});this.dayIndex[this.days[this.days.length-1].dayCode]=this.days.length-1;this.calendar.dragDrop.registerTimelineDay(this.days[this.days.length-1])};s.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate(),s=e.getTime()/1e3;t.prototype.setTitle.apply(this,[BX.date.format(BX.Calendar.Util.getLongDateFormat(),s)])};s.prototype.setDraggedEntry=function(e){this.draggedEntry=this.getRealEntry(e);if(!this.draggedEntry){return null}for(const e in this.draggedEntry.parts){this.draggedEntry.parts[e].params.wrapNode.style.transition="none";this.draggedEntry.parts[e].params.wrapNode.style.opacity="0.3"}};s.prototype.setResizedEntry=function(e){if(!e){this.resizedEntry=null}else{this.resizedEntry=this.entries.find((t=>t.uid===e.uid))}};s.prototype.loadEntries=function(){return new Promise((e=>{const t=this.getViewRange();this.entryController.getList({showLoader:this.entries&&!this.entries.length,startDate:new Date(t.start.getFullYear(),t.start.getMonth(),1),finishDate:new Date(t.end.getFullYear(),t.end.getMonth()+1,1),viewRange:t}).then((t=>{e(t)}))}))};s.prototype.displayEntries=function(){if(this.draggedEntry||this.resizedEntry){return}this.entries=this.getUndeletedEntries();this.partsStorage=[];this.timelinePartsStorage=[];BX.cleanNode(this.topEntryHolder);BX.cleanNode(this.timelineEntryHolder);this.fullDayEventsCont.style.height="";this.days.forEach((function(e){e.slots=[];e.timelineMap={};if(e.collapsedWrap&&e.collapsedWrap.top){e.collapsedWrap.top.destroy()}if(e.collapsedWrap&&e.collapsedWrap.bottom){e.collapsedWrap.bottom.destroy()}e.collapsedWrap={top:null,bottom:null};e.entries={topList:[],started:[],timeline:[],hidden:[]}}));let e=0;if(this.entries&&this.entries.length){for(let t=0;t<this.entries.length;t++){const s=this.entries[t];this.entriesIndex[s.uid]=t;s.cleanParts();let i=false;let a;for(let t=this.dayIndex[s.startDayCode];t<this.days.length;t++){const r=this.days[t];if(!s.isLongWithTime()&&r.dayCode===s.startDayCode&&r.dayCode===s.endDayCode&&!s.fullDay){a=s.startPart({from:r,to:r,daysCount:0,fromTimeValue:this.util.getTimeValue(s.from),toTimeValue:this.util.getTimeValue(s.to)});r.entries.timeline.push({entry:s,part:a});this.timelinePartsStorage.push({part:a,entry:s});break}else{if(r.dayCode===s.startDayCode){i=true;a=s.startPart({from:r,daysCount:0});r.entries.started.push({entry:s,part:a})}if(i){r.entries.topList.push({entry:s,part:a});a.daysCount++;a.to=r;if(r.entries.topList.length>e)e=r.entries.topList.length;if(r.dayCode===s.endDayCode||r.dayOffset===this.dayCount-1||this.dayCount===1){this.partsStorage.push({part:a,entry:s});if(r.dayCode===s.endDayCode){break}}}}}}}if(this.entries&&this.entries.length){this.displayTopEntries();this.displayTimelineEntries();this.SLOTS_COUNT=10;this.arrangeTopEntries();this.arrangeTimelineEntries()}if(this.draggedEntry){this.draggedEntry=this.entries.find((e=>e.uid===this.draggedEntry.uid));for(const e in this.draggedEntry.parts){this.draggedEntry.parts[e].params.wrapNode.style.transition="none";this.draggedEntry.parts[e].params.wrapNode.style.opacity="0.3"}}this.setFullDayHolderSize(Math.min(Math.max(e,1),this.SLOTS_COUNT));for(const e of this.days){if(e.entries.topList.length>0){let t=false;for(let s=0;s<e.entries.topList.length;s++){if(e.entries.topList[s].part.params.wrapNode.style.display==="none"){t=true;break}}if(t){e.hiddenStorage=this.topEntryHolder.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-wrap calendar-event-more-btn-container"},attrs:{"data-bx-calendar-show-all-events":e.dayCode},style:{top:parseInt(this.fullDayEventsCont.style.height)-20+"px",left:this.dayCount===1?"0":"calc((100% / "+this.dayCount+") * ("+(e.dayOffset+1)+" - 1) + 2px)",width:"calc(100% / "+this.dayCount+" - 3px)"}}));e.hiddenStorageText=e.hiddenStorage.appendChild(BX.create("span",{props:{className:"calendar-event-more-btn"}}));e.hiddenStorage.style.display="block";e.hiddenStorageText.innerHTML=BX.message("EC_SHOW_ALL")+" "+e.entries.topList.length}else if(e.hiddenStorage){e.hiddenStorage.style.display="none"}}}BX.addClass(this.grid,"calendar-events-holder-show");BX.addClass(this.fullDayEventsCont,"calendar-events-holder-show");this.checkTimelineScroll()};s.prototype.arrangeTopEntries=function(){var e,t,s,i,a,r,o,n,l;for(a=0;a<this.days.length;a++){r=this.days[a];if(r.entries.started.length>0){r.entries.started.sort(this.calendar.entryController.sort);for(s=0;s<r.entries.started.length;s++){e=r.entries.started[s];if(e){o=e.entry;n=e.part;if(!o.checkPartIsRegistered(n))continue;l=false;for(i=0;i<this.SLOTS_COUNT;i++){if(r.slots[i]!==false){this.occupySlot({slotIndex:i,startIndex:a,endIndex:a+n.daysCount});l=true;o.getWrap(n.partIndex).style.top=i*this.slotHeight+"px";break}}if(!l){t=r.entries.started[s-1];if(t){r.entries.hidden.push(t);t.entry.getWrap(t.part.partIndex).style.display="none"}r.entries.hidden.push(e);o.getWrap(n.partIndex).style.display="none"}}if(r.hiddenStorage&&r.entries.hidden.length>0){r.hiddenStorageText.innerHTML=BX.message("EC_SHOW_ALL")+" ("+r.entries.topList.length+")"}}}}};s.prototype.arrangeTimelineEntries=function(){var e=30,t=33,s=20,i=40,a=6,r=2,o,n,l,d,h,p,f,c,u,m,y,g,C,w,T,H,v,B,x;function E(e){var t,s;for(t=e.timeFrom;t<e.timeTo;t++){if(!e.layers[t])e.layers[t]=[];s=e.day.layers[t][e.layerIndex]||{entries:[],start:[]};s.entries.push(e.entryIndex);if(t==e.timeFrom){s.start.push(e.entryIndex);e.entryPart.layerParallels=s.start.length}e.day.layers[t][e.layerIndex]=s}e.entryPart.layerIndex=e.layerIndex}function N(e,t){var s=f.layers[e][t];return s&&s.entries&&s.entries.length===s.start.length}function X(e){return!e}function b(e){var t,s,i,a=[],r={};for(t=e.timeFrom;t<e.timeTo;t++){if(e.layerIndex>0&&e.day.layers[t][e.layerIndex-1]){s=e.day.layers[t][e.layerIndex-1].entries;if(s.length>0){i=s[s.length-1];if(!r[i]){r[i]=true;a.push(i)}}}}return a}function D(t,s){if(!s)s=e;return t.getHours()*60+Math.floor(t.getMinutes()/s)*s}for(p=0;p<this.days.length;p++){f=this.days[p];f.entries.timeline.sort((function(e,t){if(e.part.fromTimeValue===t.part.fromTimeValue){return t.part.toTimeValue-t.part.fromTimeValue-(e.part.toTimeValue-e.part.fromTimeValue)}return e.part.fromTimeValue-t.part.fromTimeValue}));o=0;l="";n=0;g=0;f.layers=[];for(d=0;d<f.entries.timeline.length;d++){B=f.entries.timeline[d].entry;x=f.entries.timeline[d].part;m=D(B.from,1);y=D(B.to,1);if(m===y)y+=1;if(!f.layers)f.layers=[];C=0;while(true){if(!f.layers[m]||N(m,C)||X(f.layers[m][C])){E({day:f,timeFrom:m,timeTo:y,layers:f.layers,entryIndex:d,layerIndex:C,entryPart:x});break}C++}}for(d=0;d<f.entries.timeline.length;d++){if(f.entries.timeline[d]){B=f.entries.timeline[d].entry;x=f.entries.timeline[d].part;m=D(B.from,1);y=D(B.to,1);if(m===y)y+=1;if(!B.checkPartIsRegistered(x)||!f.layers[m]||!f.layers[m][x.layerIndex]){continue}u=f.layers[m][x.layerIndex].start;if(x.params&&x.params.wrapNode){x.params.wrapNode.style.zIndex=m}x.absoluteLeftOffset=r;if(x.layerIndex>0){v=b({day:f,entryIndex:d,layerIndex:x.layerIndex,timeFrom:m,timeTo:y});for(h=0;h<v.length;h++){w=f.entries.timeline[v[h]];if(w&&w.part&&w.part.params&&x.params.wrapNode){T=parseInt(x.params.wrapNode.style.top)-parseInt(w.part.params.wrapNode.style.top);if(T>t){x.offsetFractionLeft=w.part.offsetFractionWidth*.1}else{x.offsetFractionLeft=w.part.offsetFractionWidth*.45}x.offsetFractionLeftTotal=w.part.offsetFractionLeftTotal+x.offsetFractionLeft;x.offsetFractionWidth=1-x.offsetFractionLeftTotal;if(this.dayCount>1){x.offsetLeftRate=x.from.dayOffset+x.offsetFractionLeftTotal}else{x.offsetLeftRate=x.offsetFractionLeftTotal}x.absoluteLeftOffset=(w.absoluteLeftOffset||r)+a;H=1-x.offsetFractionLeftTotal;if(T<=t){if(T<s){w.part.params.timeNode.style.maxWidth="calc("+(1-x.offsetFractionWidth)*100+"% - 4px)";if(w.part.params.timeNode.offsetWidth<i){w.part.params.timeNode.style.textOverflow="clip";w.part.params.timeNode.style.maxWidth=i+"px"}}if(w.part.params.nameNode.offsetWidth<i){w.part.params.nameNode.style.textOverflow="clip";w.part.params.nameNode.style.maxWidth="calc("+(1-x.offsetFractionWidth)*100+"% + 5px)"}}else if(w.part.params.nameNode){w.part.params.nameNode.style.whiteSpace="nowrap";w.part.params.nameNode.style.lineHeight="11px";w.part.params.timeNode.style.lineHeight="11px"}x.params.wrapNode.style.left="calc((100% / "+this.dayCount+") * "+x.offsetLeftRate+")";x.params.wrapNode.style.width="calc(100% / ("+this.dayCount+") * "+x.offsetFractionWidth+" - "+this.lastEntryWidthOffset+"px)";BX.addClass(x.params.wrapNode,"calendar-bordered-block")}}}if(u.length>1){c=BX.util.array_search(d,f.layers[m][x.layerIndex].start);var O=this.entryWidthOffset;if(c==f.layers[m][x.layerIndex].start.length-1){O=this.lastEntryWidthOffset;if(x.absoluteLeftOffset>r){O+=x.absoluteLeftOffset/u.length+1}}x.params.wrapNode.style.zIndex=parseInt(x.params.wrapNode.style.zIndex)-c;if(this.dayCount>1){x.params.wrapNode.style.width="calc(100% / ("+this.dayCount+" * "+u.length+") - "+O+"px)";x.params.wrapNode.style.left="calc((100% / "+this.dayCount+") * "+x.from.dayOffset+" + 100% * "+c+"/ ("+this.dayCount+" * "+u.length+") + "+x.absoluteLeftOffset+"px)"}else{x.params.wrapNode.style.width="calc(100% / ("+this.dayCount+" * "+u.length+") - "+O+"px)";x.params.wrapNode.style.left="calc(100% * "+c+"/ "+u.length+" + "+x.absoluteLeftOffset+"px)"}}if(x.params&&x.params.wrapNode){this.updateCompactness(x.params.wrapNode)}}}}};s.prototype.fillTimelineMap=function(e,t,s){var i,a=t.from.getHours()*60+t.from.getMinutes(),r=t.to.getHours()*60+t.to.getMinutes();for(i=a;i<r;i++){if(!e[i])e[i]=[];e[i].push(s)}};s.prototype.displayTopEntry=function(e){var t,s=e.entry,i=e.part.from,a=e.part.daysCount,r,o,n,l,d,h,p,f="calendar-event-line-wrap",c=0,u,m;if(s.isFullDay()){f+=" calendar-event-line-fill"}else if(s.isLongWithTime()){f+=" calendar-event-line-border"}if(s.getCurrentStatus()==="N"){f+=" calendar-event-line-refused"}if(s.isInvited()){f+=" calendar-event-animate-counter-highlight"}let y=s.color;if(s.isFullDay()){y=this.calendar.util.addOpacityToHex(s.color,.3)}else if(s.isLongWithTime()){y=this.calendar.util.addOpacityToHex(s.color,.5)}if(this.util.getDayCode(s.from)!==this.util.getDayCode(i.date)){f+=" calendar-event-line-start-yesterday";c+=8;u=this.getArrow("left",y,s.isFullDay())}if(this.util.getDayCode(s.to)!==this.util.getDayCode(e.part.to.date)){f+=" calendar-event-line-finish-tomorrow";m=this.getArrow("right",y,s.isFullDay());c+=12}if(u&&!m){c+=4}if(c===0){c=5}r=BX.create("DIV",{attrs:{"data-bx-calendar-entry":s.uid},props:{className:f},style:{top:0,left:this.dayCount>1?"calc((100% / "+this.dayCount+") * ("+(i.dayOffset+1)+" - 1) + 2px)":"2px",width:"calc("+a+" * 100% / "+this.dayCount+" - "+c+"px)"}});if(u){r.appendChild(u);r.style.left="9px"}if(m){r.appendChild(m)}p=r.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));n=p.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));o=n.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-dot"}}));if(s.isFullDay()){n.style.maxWidth="calc(200% / "+a+" - "+this.lastEntryWidthOffset+"px)"}else if(s.isLongWithTime()){r.style.borderColor=s.color;n.style.maxWidth="calc(200% / "+a+" - "+this.lastEntryWidthOffset+"px)";if(e.part.partIndex===0){if(a>1){d=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(s.from.getHours(),s.from.getMinutes())}))}n.style.width="calc(100% / "+a+" - "+this.lastEntryWidthOffset+"px)"}if(!d&&a===1&&this.util.getDayCode(s.from)===e.part.from.dayCode){d=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(s.from.getHours(),s.from.getMinutes())}))}if(e.part.partIndex===s.parts.length-1){if(a>1&&s.parts.length>1){n.style.width="calc("+(a-1)+"00% / "+a+" - "+this.lastEntryWidthOffset+"px)"}if(a>1){h=n.appendChild(BX.create("SPAN",{props:{className:s.parts.length>1&&a===1?"calendar-event-line-time":"calendar-event-line-expired-time"},text:this.calendar.util.formatTime(s.to.getHours(),s.to.getMinutes())}))}}if(!h&&a===1&&this.util.getDayCode(s.to)===e.part.to.dayCode){h=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(s.to.getHours(),s.to.getMinutes())}))}}else{d=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(s.from.getHours(),s.from.getMinutes())}))}l=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},text:e.entry.name}));if(s.isFullDay()){p.style.backgroundColor=this.calendar.util.addOpacityToHex(s.color,.3);p.style.borderColor=this.calendar.util.addOpacityToHex(s.color,.3)}else{if(s.isLongWithTime()){p.style.borderColor=this.calendar.util.addOpacityToHex(s.color,.5)}o.style.backgroundColor=s.color}if(s.isInvited()&&this.isFirstVisibleRecursiveEntry(s)){n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-invite-counter"},text:"1"}))}(e.holder||this.topEntryHolder).appendChild(r);t={wrapNode:r,nameNode:l,innerNode:n,innerContainer:p,timeNode:d||false,endTimeNode:h||false,dotNode:o};if(!e.popupMode){e.entry.registerPartNode(e.part,t)}this.calendar.dragDrop.registerEntry(r,e);return t};s.prototype.displayTopEntries=function(){var e;for(e=0;e<this.partsStorage.length;e++){this.displayTopEntry(this.partsStorage[e])}};s.prototype.displayTimelineEntries=function(){this.zIndexTimeline=100;this.timelinePartsStorage.sort((function(e,t){if(e.part.fromTimeValue===t.part.fromTimeValue){return t.part.toTimeValue-t.part.fromTimeValue-(e.part.toTimeValue-e.part.fromTimeValue)}return e.part.fromTimeValue-t.part.fromTimeValue}));for(var e=0;e<this.timelinePartsStorage.length;e++){this.displayTimelineEntry(this.timelinePartsStorage[e])}};s.prototype.displayTimelineEntry=function(e){var t=false,s,i,a,r,o,n,l=this.util.getWorkTime(),d=e.entry,h=e.part.from,p=e.part.fromTimeValue,f=e.part.toTimeValue,c="calendar-event-block-wrap";if(d.hasEmailAttendees()||d.ownerIsEmailUser()||d.getCurrentStatus()==="N"||d.isSharingEvent()){c+=" calendar-event-wrap-icon"}if(d.isExpired()){c+=" calendar-event-block-wrap-past"}if(d.isSharingEvent()){c+=" calendar-event-block-wrap-sharing"}if(!this.isCollapsedOffHours||f>l.start&&p<l.end){if(this.isCollapsedOffHours){p=Math.max(e.part.fromTimeValue,l.start);f=Math.min(e.part.toTimeValue,l.end);s=(p-l.start)*this.gridLineHeight+1+"px"}else{s=p*this.gridLineHeight+1+"px"}i=BX.create("DIV",{attrs:{"data-bx-calendar-entry":d.uid},props:{className:c},style:{top:s,height:(f-p)*this.gridLineHeight-1+"px",left:this.dayCount>1?"calc((100% / "+this.dayCount+") * "+h.dayOffset+" + 2px)":"2px",width:"calc(100% / "+this.dayCount+" - "+this.lastEntryWidthOffset+"px)"}});a=i.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-inner"}}));const n=a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-title"}}));if(d.isInvited()){a.className+=" calendar-event-animate-counter-highlight";if(this.isFirstVisibleRecursiveEntry(d)){n.appendChild(BX.create("DIV",{props:{className:"calendar-event-invite-counter"},text:"1"}))}else{n.appendChild(BX.create("DIV",{props:{className:"calendar-event-invite-counter-dot"}}))}}else if(d.getCurrentStatus()==="N"){n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-icon-refused"}}))}else if(d.isSharingEvent()){n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-icon-sharing"}}))}else if(d.hasEmailAttendees()||d.ownerIsEmailUser()){n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-icon-mail"}}))}r=n.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-text"},text:e.entry.name}));if(!this.calendar.util.isDarkColor(d.color)){BX.Dom.addClass(a,"calendar-event-text-dark")}o=a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-time"},html:this.calendar.util.formatTime(d.from)+" &ndash; "+this.calendar.util.formatTime(d.to)}));a.style.backgroundColor=d.color;let u,m;if(this.calendar.util.type!=="location"&&this.calendar.entryController.canDo(d,"edit")){u=i.appendChild(BX.create("DIV",{props:{className:"calendar-event-resizer calendar-event-resizer-top"}}));m=i.appendChild(BX.create("DIV",{props:{className:"calendar-event-resizer calendar-event-resizer-bottom"}}))}this.timelineEntryHolder.appendChild(i);t={wrapNode:i,nameNode:r,innerNode:a,timeNode:o,blockBackgroundNode:a,resizerNodeTop:u,resizerNodeBottom:m};e.part.offsetFractionRate=1;//!!!!
e.part.offsetFractionLeft=0;e.part.offsetFractionWidth=1;e.part.offsetFractionLeftTotal=0;e.entry.registerPartNode(e.part,t);this.calendar.dragDrop.registerEntry(i,e)}else{this.addHiddenEntry({position:p<l.end?"top":"bottom",entry:d})}return t};s.prototype.addHiddenEntry=function(e){this.getCollapsedWrap({position:e.position,dayCode:this.util.getDayCode(e.entry.from)}).addEntry(e.entry)};s.prototype.getCollapsedWrap=function(e){if(this.dayIndex[e.dayCode]!==undefined&&this.days[this.dayIndex[e.dayCode]]){var t=this.days[this.dayIndex[e.dayCode]];if(!t.collapsedWrap[e.position]||!t.collapsedWrap[e.position].inited()){t.collapsedWrap[e.position]=new a({position:e.position,wrap:this.timelineEntryHolder,workTime:this.util.getWorkTime(),dayOffset:t.dayOffset,dayCount:this.dayCount,lastEntryWidthOffset:this.lastEntryWidthOffset,gridLineHeight:this.gridLineHeight,labelMessage:this.calendar.collapsedLabelMessage,clickHandler:e=>{if(this.isCollapsedOffHours){const t=e.target.closest(".calendar-event-block-wrap");const s=parseInt(t.style.top);if(s<0){this.switchOffHours(true,"top")}else{this.switchOffHours(true,"bottom")}}},mouseoverHandler:function(){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}.bind(this),mouseoutHandler:function(){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}.bind(this)})}return t.collapsedWrap[e.position]}return null};s.prototype.displayTimelineCollapsedEntry=function(e){};s.prototype.showNowTime=function(){this.nowTimeLabel=BX.create("DIV",{props:{className:this.gridNowTimeLabelClass}});this.nowTimeLine=BX.create("DIV",{props:{className:this.gridNowTimeLineClass}});this.nowTimeLine.append(this.nowTimeLabel);this.nowTimeCont=BX.create("DIV",{props:{className:this.gridNowTimeClass}});this.nowTimeCont.append(this.nowTimeLine);this.gridRow.append(this.nowTimeCont);if(this.nowTimeInterval){clearInterval(this.nowTimeInterval)}this.updateNowTime();this.nowTimeInterval=setInterval(BX.proxy(this.updateNowTime,this),15e3)};s.prototype.hideNowTime=function(){if(!this.nowTimeCont){return}BX.cleanNode(this.nowTimeCont,1);delete this.nowTimeCont;if(this.nowTimeInterval){clearInterval(this.nowTimeInterval)}};s.prototype.resetNowTime=function(){this.hideNowTime();this.showNowTime()};s.prototype.hideOffHoursNowTime=function(){const e=this.util.getWorkTime();const t=this.util.getTimeValue(new Date);if(t<e.start||t>e.end){this.hideNowTime()}};s.prototype.getUserTime=function(){const e=this.util.config.userSettings;const t=e.timezoneName;return new Date((new Date).toLocaleString("en-US",{timeZone:t}))};s.prototype.updateNowTime=function(){if(!this.nowTimeCont){return}const e=this.getUserTime();const t=this.util.getTimeValue(e);const s=document.querySelector("."+this.gridTimeTranslucentClass);if(s){BX.removeClass(s,this.gridTimeTranslucentClass)}const i=this.util.getWeekDayOffset(this.util.getWeekDayByInd(e.getDay()));const a=this.getViewRange();if(e.getTime()>a.start.getTime()&&e.getTime()<a.end.getTime()){if(this.dayCount>1){if(i===0){this.nowTimeLine.style.left=0}else{this.nowTimeLine.style.left="calc("+i+" * 100% / "+this.dayCount+" + 5px)"}}}else{this.hideNowTime();return}let r=this.calendar.util.formatTime(e.getHours(),e.getMinutes());if(BX.isAmPmMode()){r=r.replace(/(\sam|pm)/gi,"<small>$1<small>")}this.nowTimeLabel.innerHTML=r;this.nowTimeCont.style.marginTop="";this.nowTimeLine.classList.remove("calendar-hour-now-line-translucent");const o=this.util.getWorkTime();if(this.isCollapsedOffHours){if(t<o.start){this.nowTimeCont.style.top="-5px";this.nowTimeCont.style.marginTop="23px";this.nowTimeLine.classList.add("calendar-hour-now-line-translucent")}else if(t>o.end){this.nowTimeCont.style.top=(o.end-o.start)*this.gridLineHeight+4+"px";this.nowTimeCont.style.marginTop="22px";this.nowTimeLine.classList.add("calendar-hour-now-line-translucent")}else{this.nowTimeCont.style.top=(t-o.start)*this.gridLineHeight+this.timeLinesCont.offsetTop+"px"}}else{this.nowTimeCont.style.top=t*this.gridLineHeight+this.timeLinesCont.offsetTop+"px"}if(this.isCollapsedOffHours&&(i===0||this.dayCount===1)){if(t<o.start){BX.addClass(this.topOffHoursLabel,this.gridTimeTranslucentClass)}if(t>o.end){BX.addClass(this.bottomOffHoursLabel,this.gridTimeTranslucentClass)}}else{BX.removeClass(this.topOffHoursLabel,this.gridTimeTranslucentClass);BX.removeClass(this.bottomOffHoursLabel,this.gridTimeTranslucentClass)}const n=Math.round(t);const l=10;if((i===0||this.dayCount===1)&&Math.abs((n-t)*this.gridLineHeight)<l&&this.timeLinesIndex[n]){BX.addClass(this.timeLinesIndex[n],this.gridTimeTranslucentClass)}};s.prototype.getPosByTime=function(e){const t=this.getTimeByPos(0,1);const s=t.h*60+t.m;const i=e.h*60+e.m;let a=i-s+4;let r=this.getTimeByPos(a,5);while(a>=0&&r.h===e.h&&r.m===e.m){a--;r=this.getTimeByPos(a,5)}return a+1};s.prototype.getTimeByPos=function(e,t){var s=this.util.getWorkTime(),i=e/this.gridLineHeight,a=this.util.getTimeByFraction(i,t||10);if(this.isCollapsedOffHours){a.h+=s.start}return a};s.prototype.showOffHours=function(){var e=this.util.getWorkTime();this.topOffHours=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.offHoursClass+" "+this.offHoursAnimateClass},style:{top:0,height:e.start*this.gridLineHeight+1+"px"}}));this.topOffHoursLabel=this.topOffHours.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourLabelClass},html:"<span>"+this.calendar.util.formatTime(0,0,true)+"</span><span>"+this.calendar.util.formatTime(e.start,0,true)+"</span>",events:{click:()=>{this.switchOffHours(true,"top")},mouseover:()=>{BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover")},mouseout:()=>{BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover")}}}));this.timelineEntryHolder.addEventListener("mouseover",(e=>{if(e.target===this.timelineEntryHolder){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover")}}));this.timelineEntryHolder.addEventListener("mouseout",(e=>{if(e.target===this.timelineEntryHolder){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover")}}));this.topOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-active"},events:{click:()=>{this.switchOffHours(true,"top")},mouseover:BX.proxy((function(){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}),this),mouseout:BX.proxy((function(){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}),this)}}));this.topOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-drag-down"},attrs:{"data-bx-calendar-off-time-drag":"top"},events:{mousedown:BX.proxy(this.offHoursMousedown,this)}}));this.bottomOffHours=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.offHoursClass+" "+this.offHoursAnimateClass},style:{top:e.end*this.gridLineHeight+1+"px",height:(24-e.end)*this.gridLineHeight+1+"px"}}));this.bottomOffHoursLabel=this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourLabelClass},html:"<span>"+this.calendar.util.formatTime(e.end,0,true)+"</span><span>"+this.calendar.util.formatTime(24,0,true)+"</span>",events:{click:()=>{this.switchOffHours(true,"bottom")},mouseover:()=>{BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")},mouseout:()=>{BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}}}));this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-active"},events:{click:()=>{this.switchOffHours(true,"bottom")},mouseover:BX.proxy((function(){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}),this),mouseout:BX.proxy((function(){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")}),this)}}));this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-drag-up"},attrs:{"data-bx-calendar-off-time-drag":"bottom"},events:{mousedown:BX.proxy(this.offHoursMousedown,this)}}));BX.bind(this.topOffHours,"click",BX.proxy((function(){if(this.isCollapsedOffHours){this.switchOffHours(true,"top")}}),this));BX.bind(this.bottomOffHours,"click",BX.proxy((function(){if(this.isCollapsedOffHours){this.switchOffHours(true,"bottom")}}),this));if(this.isCollapsedOffHours){this.gridRow.style.height=this.gridLineHeight*(e.end-e.start)+30+"px";this.isCollapsedOffHours=!this.isCollapsedOffHours;this.switchOffHours(false);this.updateGridRowShadowHeight()}else{this.gridRow.style.height=this.gridLineHeight*24+40+"px";this.updateGridRowShadowHeight()}};s.prototype.offHoursMousedown=function(e){var t=e.target||e.srcElement;this.lastWorkTime=false;this.lastTopCount=false;if(t&&t.getAttribute){this.lastWorkTime=BX.clone(this.util.getWorkTime());BX.unbind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.bind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.bind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.removeClass(this.topOffHours,this.offHoursAnimateClass);BX.removeClass(this.bottomOffHours,this.offHoursAnimateClass);BX.addClass(this.topOffHours,this.offHoursFastAnimateClass);BX.addClass(this.bottomOffHours,this.offHoursFastAnimateClass);if(t.getAttribute("data-bx-calendar-off-time-drag")=="top"){this.offtimeTuneMode="top"}else{this.offtimeTuneMode="bottom"}this.offtimeTuneBaseZeroPos=BX.pos(this.timeLinesCont).top}};s.prototype.offHoursMousemove=function(e){if(this.offtimeTuneMode){var t=this.util.getMousePos(e),s=Math.max(Math.round((t.y-this.offtimeTuneBaseZeroPos)/this.gridLineHeight),0);if(this.lastTopCount!==s){this.preventSwichOffHours=true;if(this.offtimeTuneMode=="top"){s=Math.min(this.lastWorkTime.end-1,s);this.topOffHours.style.height=s*this.gridLineHeight+1+"px";this.lastWorkTime.start=s}else{s=Math.max(this.lastWorkTime.start+1,s);this.bottomOffHours.style.top=s*this.gridLineHeight+"px";this.bottomOffHours.style.height=(24-s)*this.gridLineHeight+1+"px";this.lastWorkTime.end=s}this.lastTopCount=s}}};s.prototype.offHoursMouseup=function(e){BX.unbind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.addClass(this.topOffHours,this.offHoursAnimateClass);BX.addClass(this.bottomOffHours,this.offHoursAnimateClass);BX.removeClass(this.topOffHours,this.offHoursFastAnimateClass);BX.removeClass(this.bottomOffHours,this.offHoursFastAnimateClass);var t=this.util.setWorkTime(this.lastWorkTime);this.topOffHoursLabel.innerHTML="<span>"+this.calendar.util.formatTime(0,0,true)+"</span><span>"+this.calendar.util.formatTime(t.start,0,true)+"</span>";this.bottomOffHoursLabel.innerHTML="<span>"+this.calendar.util.formatTime(t.end,0,true)+"</span><span>"+this.calendar.util.formatTime(24,0,true)+"</span>";this.offtimeTuneMode=false;delete this.lastWorkTime;delete this.lastTopCount;this.isCollapsedOffHours=false;if(!this.preventSwichOffHours){if(e.target.className==="calendar-grid-off-hours-drag-up"){this.switchOffHours(true,"bottom")}else{this.switchOffHours(true,"top")}}this.preventSwichOffHours=false};s.prototype.switchOffHours=function(e,t){if(this.denySwitch){return}this.denySwitch=true;this.removeOffHoursEntries();if(e){this.animateSwitchOffHours(t,this.isCollapsedOffHours)}else{this.setSwitchOffHours(this.isCollapsedOffHours)}this.isCollapsedOffHours=!this.isCollapsedOffHours};s.prototype.setSwitchOffHours=function(e){BX.removeClass(this.bottomOffHours,this.offHoursAnimateClass);BX.removeClass(this.topOffHours,this.offHoursAnimateClass);BX.removeClass(this.timeLinesCont,this.offHoursAnimateClass);this.switchOffHoursProps(e);if(e){this.showHourLines()}this.displayEntries();this.denySwitch=false;this.checkTimelineScroll()};s.prototype.animateSwitchOffHours=function(e,t){BX.addClass(this.bottomOffHours,this.offHoursAnimateClass);BX.addClass(this.topOffHours,this.offHoursAnimateClass);BX.addClass(this.timeLinesCont,this.offHoursAnimateClass);this.switchOffHoursProps(t);this.hideOffHoursNowTime();let s,i;if(t){s=this.offHoursCollapsedHeight;i=0}else{s=0;i=this.offHoursCollapsedHeight}const a=BX.create("DIV",{style:{position:"absolute",width:1+"px",height:s+"px",top:this.gridWrap.clientHeight+this.topOffHours.clientHeight+"px",transition:"400ms all ease"}});this.timelineEntryHolder.append(a);a.style.top=this.gridWrap.clientHeight+this.topOffHours.clientHeight-i*2+"px";a.style.height=i+"px";const r=this.topOffHours.clientHeight;const o=this.gridWrap.scrollTop;const n=[...this.timelineEntryHolder.childNodes].filter((e=>e!==a));new BX.easing({duration:400,start:{},finish:{},step:()=>{let s=this.topOffHours.clientHeight-a.clientHeight;if(!t){s-=r}this.gridWrap.scrollTop=o+s;if(t&&e==="top"){this.gridWrap.scrollTop=o}this.timelineEntryHolder.style.transform=`translateY(${s}px)`;if(this.nowTimeCont){this.nowTimeCont.style.transform=`translateY(${s}px)`}this.cutEntryNodesByGrid(n,s);this.checkTimelineScroll()},complete:()=>{a.remove();this.timelineEntryHolder.style.transform="none";this.resetNowTime();if(t){this.showHourLines()}this.displayEntries();this.denySwitch=false;this.checkTimelineScroll()}}).animate()};s.prototype.cutEntryNodesByGrid=function(e,t){for(const s of e){const e=parseInt(s.offsetTop)+t;const i=e+s.offsetHeight;const a=parseInt(this.bottomOffHours.offsetTop)+this.bottomOffHours.offsetHeight-this.offHoursCollapsedHeight;if(i>a){const e=s.offsetHeight-(i-a);if(e>0){s.style.height=e+"px"}else{s.remove()}}if(e<0&&s.querySelector(".calendar-event-block-text")){const t=s.offsetHeight+e;s.style.top=parseInt(s.style.top)-e+"px";if(t>0){s.style.height=t+"px"}else{s.remove()}}}};s.prototype.switchOffHoursProps=function(e){const t=this.util.getWorkTime();if(e){this.toggleOffHoursClasses(this.offHoursCollapseClass,this.offHoursClass);this.setExpandedOffHoursHeight(t);this.displayOffHourLines(t);this.util.setUserOption("collapseOffHours","N")}else{this.toggleOffHoursClasses(this.offHoursClass,this.offHoursCollapseClass);this.setCollapsedOffHoursHeight(t);this.hideOffHourLines(t);this.util.setUserOption("collapseOffHours","Y")}};s.prototype.toggleOffHoursClasses=function(e,t){this.topOffHours.classList.add(t);this.bottomOffHours.classList.add(t);this.topOffHours.classList.remove(e);this.bottomOffHours.classList.remove(e)};s.prototype.setExpandedOffHoursHeight=function(e){this.gridRow.style.height=this.gridLineHeight*24+40+"px";this.topOffHours.style.height=this.gridLineHeight*e.start+1+"px";this.bottomOffHours.style.height=this.gridLineHeight*(24-e.end)+1+"px";this.bottomOffHours.style.top=this.gridLineHeight*e.end+"px";this.updateGridRowShadowHeight()};s.prototype.setCollapsedOffHoursHeight=function(e){this.gridRow.style.height=this.gridLineHeight*(e.end-e.start)+30+"px";this.topOffHours.style.height=this.offHoursCollapsedHeight+"px";this.bottomOffHours.style.height=this.offHoursCollapsedHeight+"px";this.bottomOffHours.style.top=(e.end-e.start)*this.gridLineHeight+9+"px";this.updateGridRowShadowHeight()};s.prototype.displayOffHourLines=function(e){for(let t in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(t)){if(t<e.start||t>e.end){this.timeLinesIndex[t].style.display="block";this.timeLinesIndex[t].style.opacity=1}this.timeLinesIndex[t].style.top=t*this.gridLineHeight+"px"}}};s.prototype.hideOffHourLines=function(e){for(let t in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(t)){if(t<=e.start||t>=e.end){this.timeLinesIndex[t].style.opacity=0;this.timeLinesIndex[t].style.pointerEvents="none"}if(t>=e.end){this.timeLinesIndex[t].style.top=(e.end-e.start)*this.gridLineHeight+"px"}else{this.timeLinesIndex[t].style.top=(t-e.start)*this.gridLineHeight+"px"}}}};s.prototype.showHourLines=function(){for(const e in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(e)){this.timeLinesIndex[e].style.opacity="";this.timeLinesIndex[e].style.display=""}}};s.prototype.removeOffHoursEntries=function(){const e=this.util.getWorkTime();for(const t of this.entries){if(!t.fullDay&&(t.from.getHours()>=e.end||t.to.getHours()<=e.start)&&t.parts[0]&&t.parts[0].params){t.parts[0].params.wrapNode.style.minHeight=0+"px"}}this.days.forEach((e=>{if(e.collapsedWrap&&e.collapsedWrap.top){e.collapsedWrap.top.destroy()}if(e.collapsedWrap&&e.collapsedWrap.bottom){e.collapsedWrap.bottom.destroy()}}))};s.prototype.checkTimelineScroll=function(){if(!this.scrollbarWidth){this.scrollbarWidth=this.util.getScrollbarWidth()}const e=this.gridWrap.scrollHeight>this.gridWrap.offsetHeight?this.scrollbarWidth:0;if(this.titleCont){this.titleCont.style.paddingRight=e+"px"}if(this.fullDayEventsHolderCont&&this.topEntryHolder&&parseInt(this.topEntryHolder.style.right)!==parseInt(e)){this.gridWrap.style.width="100%";this.topEntryHolder.style.right=e+"px";this.fullDayEventsHolderCont.style.paddingRight=e+"px"}};s.prototype.getDayGridHeight=function(){return 756};s.prototype.updateGridRowShadowHeight=function(){if(this.isCollapsedOffHours){this.gridRowShadow.style.height=parseInt(this.gridRow.style.height)-38+"px";BX.removeClass(this.gridRowShadow,"calendar-grid-week-row-shadow-off-hours")}else{this.gridRowShadow.style.height=parseInt(this.gridRow.style.height)-40+"px";BX.addClass(this.gridRowShadow,"calendar-grid-week-row-shadow-off-hours")}};s.prototype.handleClick=function(e){if(this.isActive()){if(!e)e={};var t,s;if(e.specialTarget&&(s=e.specialTarget.getAttribute("data-bx-calendar-entry"))){this.handleEntryClick({uid:s,specialTarget:e.specialTarget,target:e.target,e:e.e})}else if(e.specialTarget&&(t=e.specialTarget.getAttribute("data-bx-calendar-show-all-events"))){this.deselectEntry();if(this.dayIndex[t]!==undefined&&this.days[this.dayIndex[t]]){this.showAllEventsInPopup({day:this.days[this.dayIndex[t]],entrieList:this.days[this.dayIndex[t]].entries.topList})}}else if(!this.calendar.util.readOnlyMode()&&this.entryController.canDo(true,"add_event")&&(t=e.specialTarget&&e.specialTarget.getAttribute("data-bx-calendar-week-day"))){this.deselectEntry();this.showCompactEditFormForNewEntry({entry:this.buildTopNewEntryWrap({dayFrom:this.days[this.dayIndex[t]],holder:this.topEntryHolder})})}}};s.prototype.getEvents=function(e){const t=this.name==="week"?this.days[e.dayOffset].entries.timeline:this.days[0].entries.timeline;const s=t.map((e=>e.entry));return s.filter((e=>{let t=false;if(e.parts[0].params){t=e.parts[0].params.wrapNode.style.opacity==="0"}return e.accessibility!=="free"&&e!==this.draggedEntry&&!t}))};s.prototype.correctDuration=function(e){let t=false;let s=new Date(e.dayFrom.date.getTime());let i=new Date(e.dayFrom.date.getTime());s.setHours(e.timeFrom.h,e.timeFrom.m,0,0);i.setHours(e.timeTo.h,e.timeTo.m,0,0);const a=new Date(s.getTime());const r=new Date(i.getTime());const o=this.name==="week"?this.days[e.dayFrom.dayOffset].entries.timeline:this.days[0].entries.timeline;for(var n=0;n<o.length;n++){if(o[n].entry.accessibility==="free"){continue}if(s<o[n].entry.to&&s>=o[n].entry.from){s=o[n].entry.to;if(!t){i.setHours(s.getHours()+1);i.setMinutes(s.getMinutes())}}if(i>o[n].entry.from&&s<=o[n].entry.from){t=true;i=o[n].entry.from}}const l=(s-a)/6e4;if(l>=30){e.timeFrom.h=a.getHours();e.timeFrom.m=a.getMinutes();e.timeTo.h=r.getHours();e.timeTo.m=r.getMinutes()}else{e.timeFrom.h=s.getHours();e.timeFrom.m=s.getMinutes();e.timeTo.h=i.getHours();e.timeTo.m=i.getMinutes()}};s.prototype.correctEntryWrap=function(e){var t=e.timeFrom.h+e.timeFrom.m/60;var s=e.timeTo.h+e.timeTo.m/60;e.entryNode.style.height=(s-t)*this.gridLineHeight-3+"px";var i=this.util.getWorkTime();if(this.isCollapsedOffHours){t=Math.max(t,i.start);this.startMousePos=this.offtimeTuneBaseZeroPos+((t-i.start)*this.gridLineHeight+1)}else{this.startMousePos=this.offtimeTuneBaseZeroPos+(t*this.gridLineHeight+1)}};s.prototype.getDayByCode=function(e){return this.days[this.dayIndex[e]]};s.prototype.handleMousedown=function(e){if(!this.isActive()){return}var t=BX.Calendar.EntryManager.getCompactViewForm(false);if(t&&t.isShown()){return}var s;var i=this.calendar.util.findTargetNode(e.target||e.srcElement);if((this.calendar.util.type==="location"||!this.calendar.util.readOnlyMode())&&this.entryController.canDo(true,"add_event")&&(s=i&&i.getAttribute("data-bx-calendar-timeline-day"))){BX.unbind(document,"mousemove",BX.proxy(this.handleMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.handleMouseup,this));BX.bind(document,"mousemove",BX.proxy(this.handleMousemove,this));BX.bind(document,"mouseup",BX.proxy(this.handleMouseup,this));BX.addCustomEvent(this.calendar,"keyup",BX.proxy(this.checkKeyup,this));this.canMoveOnCreate=false;setTimeout((()=>{this.canMoveOnCreate=true}),100);this.createEntryMode=true;this.offtimeTuneBaseZeroPos=BX.pos(this.timeLinesCont).top;this.startMousePos=Math.max(this.offtimeTuneBaseZeroPos+this.gridWrap.scrollTop,this.calendar.util.getMousePos(e).y);this.newEntry=this.buildTimelineNewEntryWrap({dayFrom:this.days[this.dayIndex[s]],holder:this.timelineEntryHolder});this.newEntry.dayFrom=this.days[this.dayIndex[s]];this.newEntry.timeFrom=this.getTimeByPos(this.startMousePos-this.offtimeTuneBaseZeroPos,30,true);var a=this.util.getWorkTime();var r=this.newEntry.timeFrom.h+this.newEntry.timeFrom.m/60;if(this.isCollapsedOffHours){r=Math.max(r,a.start);this.startMousePos=this.offtimeTuneBaseZeroPos+((r-a.start)*this.gridLineHeight+1)}else{this.startMousePos=this.offtimeTuneBaseZeroPos+(r*this.gridLineHeight+1)}if(this.newEntry.timeFrom.h===23){this.newEntry.timeTo={h:23,m:59}}else{this.newEntry.timeTo={h:this.newEntry.timeFrom.h+1,m:this.newEntry.timeFrom.m}}this.correctDuration(this.newEntry);this.correctEntryWrap(this.newEntry);this.updateCompactness(this.newEntry.entryNode);this.newEntry.changeTimeCallback(this.newEntry.timeFrom,this.newEntry.timeTo);this.newEntry.entryNode.style.top=this.startMousePos-BX.pos(this.outerGrid).top+"px"}};s.prototype.handleMousemove=function(e){if(this.createEntryMode&&this.canMoveOnCreate){var t=this.isCollapsedOffHours?9:20;var s=this.calendar.util.getMousePos(e).y;var i=Math.min(Math.max(s-this.startMousePos,10),parseInt(this.gridRow.style.height)-parseInt(this.newEntry.entryNode.style.top)-t);this.newEntry.entryNode.style.height=i+"px";this.updateCompactness(this.newEntry.entryNode);this.newEntry.timeTo=this.getTimeByPos(i+this.startMousePos-this.offtimeTuneBaseZeroPos);this.newEntry.changeTimeCallback(this.newEntry.timeFrom,this.newEntry.timeTo)}};s.prototype.handleMouseup=function(e){BX.removeCustomEvent(this.calendar,"keyup",BX.proxy(this.checkKeyup,this));if(this.createEntryMode){var t=new Date(this.newEntry.dayFrom.date.getTime()),s=new Date(this.newEntry.dayFrom.date.getTime());t.setHours(this.newEntry.timeFrom.h,this.newEntry.timeFrom.m,0,0);s.setHours(this.newEntry.timeTo.h,this.newEntry.timeTo.m,0,0);this.deselectEntry();this.showCompactEditFormForNewEntry({entry:this.newEntry,entryTime:{from:t,to:s}});this.createEntryMode=false}};s.prototype.checkKeyup=function(e){var t=this.util.getKeyCodes();if(e.keyCode===t["escape"]&&this.createEntryMode&&this.newEntry){BX.remove(this.newEntry.entryNode);this.createEntryMode=false;this.handleMouseup()}};s.prototype.buildTopNewEntryWrap=function(e){var t=this,s,i,a,r,o,n="calendar-event-line-wrap",l=0,d=e.dayFrom,h,p,f=1,c=BX.Calendar.SectionManager.getNewEntrySectionId(),u=this.calendar.sectionManager.getSection(c)||this.calendar.roomsManager.getRoom(c),m=u.color;s=this.entryController.getTimeForNewEntry(d.date);i=this.entryController.getDefaultEntryName();a=e.holder.appendChild(BX.create("DIV",{props:{className:n},style:{top:0,left:this.dayCount>1?"calc((100% / "+this.dayCount+") * ("+(d.dayOffset+1)+" - 1) + 2px)":"2px",width:"calc("+f+" * 100% / "+this.dayCount+" - "+l+"px)"}}));o=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));r=o.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(s.from.getHours(),s.from.getMinutes())}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},text:i}));a.style.backgroundColor=m;a.style.borderColor=m;a.style.opacity=0;var y=BX.adjust(this.fullDayEventsCont.appendChild(a.cloneNode(true)),{props:{className:"calendar-event-line-clone"},style:{width:a.offsetWidth-4+"px",height:a.offsetHeight+"px",top:3+"px",left:a.offsetLeft+43+"px",opacity:1}});this.updateCompactness(y);if(a){BX.remove(a,true)}p=y.querySelector(".calendar-event-line-text");h=y.querySelector(".calendar-event-line-time");r=y.querySelector(".calendar-event-line-inner");var g={entryNode:y,innerNode:r,section:u,entryName:i,entryTime:s,changeTimeCallback:function(e,s){if(e.getHours&&s.getHours){h.innerHTML=t.calendar.util.formatTime(e.getHours(),e.getMinutes())}else{h.innerHTML=t.calendar.util.formatTime(e.h,e.m)}},changeNameCallback:function(e){p.innerHTML=BX.util.htmlspecialchars(e)}};this.selectEntryPart(g,m,false);return g};s.prototype.buildTimelineNewEntryWrap=function(e){var t=this,s,i,a,r,o="calendar-event-block-wrap",n=e.dayFrom,l,d,h,p,f=BX.Calendar.SectionManager.getNewEntrySectionId(),c=this.calendar.sectionManager.getSection(f)||this.calendar.roomsManager.getRoom(f),u=c.color;s=this.entryController.getTimeForNewEntry(n.date);i=this.entryController.getDefaultEntryName();a=e.holder.appendChild(BX.create("DIV",{props:{className:o},style:{height:this.gridLineHeight+"px",minHeight:"20px",left:this.dayCount>1?"calc((100% / "+this.dayCount+") * "+n.dayOffset+" + 2px)":"2px",width:"calc(100% / "+this.dayCount+" - "+this.lastEntryWidthOffset+"px)"}}));r=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-inner"}}));l=this.calendar.util.formatTime(s.from.getHours(),s.from.getMinutes())+" &ndash; "+this.calendar.util.formatTime(s.to.getHours(),s.to.getMinutes());r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-text"},style:{color:"#fff"},text:i}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-time"},style:{color:"#fff"},html:l}));r.style.backgroundColor=u;var m=BX.adjust(this.outerGrid.appendChild(a.cloneNode(true)),{props:{className:"calendar-event-line-clone calendar-event-block-wrap active"},style:{width:a.offsetWidth-3+"px",height:a.offsetHeight+"px",left:a.offsetLeft+42+"px",opacity:1}});if(a){BX.remove(a,true)}h=m.querySelector(".calendar-event-block-text");d=m.querySelector(".calendar-event-block-time");r=m.querySelector(".calendar-event-block-inner");p=m.appendChild(BX.create("DIV",{props:{className:"calendar-event-bind-node"}}));if(this.dayCount===1)p.style.right="10%";else p.style.left="0";var y={entryNode:m,innerNode:r,section:c,entryName:i,bindNode:p,blockBackgroundNode:r,changeTimeCallback:function(e,s){var i;if(e.getHours&&s.getHours){i=t.calendar.util.formatTime(e.getHours(),e.getMinutes())+" &ndash; "+t.calendar.util.formatTime(s.getHours(),s.getMinutes())}else{i=t.calendar.util.formatTime(e.h,e.m)+" &ndash; "+t.calendar.util.formatTime(s.h,s.m)}d.innerHTML=i},changeNameCallback:function(e){h.innerHTML=BX.util.htmlspecialchars(e)}};this.selectEntryPart(y,u,false);return y};s.prototype.updateCompactness=function(t){const s=t.querySelector(".calendar-event-block-inner");const i=t.querySelector(".calendar-event-block-text");const a=t.querySelector(".calendar-event-block-time");if(!i||!a||!s){return}BX.removeClass(t,"calendar-event-block-compact");BX.removeClass(t,"calendar-event-block-super-compact");i.style.overflow="visible";if(i.offsetHeight+a.offsetHeight>s.offsetHeight-10){const r=parseInt(e.getComputedStyle(i).lineHeight);const o=s.offsetHeight-a.offsetHeight-10;const n=Math.floor(o/r);if(n<=1){BX.addClass(t,"calendar-event-block-compact");BX.addClass(t,"calendar-event-block-super-compact")}}i.style.overflow=""};s.prototype.showCompactEditFormForNewEntry=function(e){this.showCompactEditForm({entryNode:e.entry.entryNode,bindNode:e.entry.bindNode,section:e.entry.section,entryTime:e.entryTime||e.entry.entryTime,entryName:e.entry.entryName,changeTimeCallback:e.entry.changeTimeCallback,changeNameCallback:e.entry.changeNameCallback,closeCallback:BX.delegate((function(){BX.remove(e.entry.entryNode)}),this)});BX.Event.EventEmitter.unsubscribeAll("BX.Calendar.CompactEventForm:onChange");BX.Event.EventEmitter.subscribe("BX.Calendar.CompactEventForm:onChange",function(e){if(e instanceof BX.Event.BaseEvent){var t=e.getData();var s=t.form.dateTimeControl.getValue()}}.bind(this))};s.prototype.showAllEventsInPopup=function(e){var t=e.entrieList||e.day.entries.list,s,i;s=BX.create("DIV",{props:{className:"calendar-all-events-popup calendar-custom-scroll"},events:{click:BX.proxy(this.calendar.handleViewsClick,this.calendar)}});t.sort(this.calendar.entryController.sort);var a,r;t.forEach((function(e){if(e.entry){if(e.entry.isTask()){if(!a){s.appendChild(BX.create("DIV",{props:{className:"calendar-event-title"},text:BX.message("EC_ENTRIES_TASKS")}));a=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayTopEntry({entry:e.entry,part:e.part,holder:a,popupMode:true})}else{if(!r){s.appendChild(BX.create("DIV",{props:{className:"calendar-event-title"},text:BX.message("EC_ENTRIES_EVENTS")}));r=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayTopEntry({entry:e.entry,part:e.part,holder:r,popupMode:true})}}}),this);i=BX.PopupWindowManager.create(this.calendar.id+"-all-events-popup",e.day.hiddenStorageText,{autoHide:true,closeByEsc:true,offsetTop:-2,offsetLeft:-50,lightShadow:true,content:s});i.setAngle({offset:118});i.show(true);this.allEventsPopup=i;BX.addCustomEvent(i,"onPopupClose",(function(){i.destroy()}))};function i(){t.apply(this,arguments);this.initConfig();this.preBuild()}i.prototype=Object.create(s.prototype);i.prototype.constructor=i;i.prototype.show=function(){t.prototype.show.apply(this,arguments);this.buildDaysGrid();if(this.calendar.navCalendar)this.calendar.navCalendar.hide();this.loadEntries().then((e=>{this.entries=e;this.displayEntries()}));this.calendar.initialViewShow=false};i.prototype.initConfig=function(){s.prototype.initConfig.apply(this,arguments);this.name="week";this.title=BX.message("EC_VIEW_WEEK");this.contClassName="calendar-week-view";this.hotkey="W";this.gridWrapClass="calendar-grid-wrap";if(BX.isAmPmMode()){this.gridWrapClass+=" is-am-pm-mode"}this.fullDayContClass="calendar-grid-week-full-days-events-holder";this.outerGridClass="calendar-grid-week-container";this.gridClass="calendar-grid-week";this.gridClassCurrent="calendar-grid-week-current";this.gridClassNext="calendar-grid-week-left-slide";this.gridClassPrevious="calendar-grid-week-right-slide";this.changeNextClass="calendar-change-week-left-slide";this.changePreviousClass="calendar-change-week-right-slide";this.gridRowClass="calendar-grid-week-row";this.gridCellClass="calendar-grid-week-cell";this.gridTimelinesClass="calendar-grid-week-time-lines";this.gridTimelineHourClass="calendar-grid-week-time-line-hour";this.gridTimelineHourLabelClass="calendar-grid-week-time-line-hour-label";this.topEntryHolderClass="calendar-grid-week-events-holder";this.gridNowTimeClass="calendar-grid-week-time-line-hour-now";this.gridNowTimeLabelClass="calendar-grid-week-time-line-hour-label";this.gridNowTimeLineClass="calendar-grid-week-time-line-hour-now-line";this.gridNowTimeDotClass="calendar-grid-week-time-line-hour-now-dot";this.dayCount=7};i.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate(),s=e.getTime(),i=new Date(e.getTime()+this.dayCount*this.calendar.util.dayLength);if(e.getMonth()!==i.getMonth()){t.prototype.setTitle.apply(this,[BX.date.format("f",s/1e3)+" - "+BX.date.format("f",i.getTime()/1e3)+(this.util.showWeekNumber()?", #GRAY_START#"+BX.message("EC_DATE_WEEK_NUMBER").replace("#WEEK_NUMBER#",this.util.getWeekNumber(s))+"#GRAY_END#":"")])}else{t.prototype.setTitle.apply(this,[BX.date.format("f",s/1e3)+(this.util.showWeekNumber()?", #GRAY_START#"+BX.message("EC_DATE_WEEK_NUMBER").replace("#WEEK_NUMBER#",this.util.getWeekNumber(s))+"#GRAY_END#":"")])}};i.prototype.getAdjustedDate=function(e,t,i){if(!e){e=new Date}if(t&&e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(t&&e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var a=this.util.getWeekStart();while(this.util.getWeekDayByInd(e.getDay())!=a){e.setDate(e.getDate()-1)}if(i){t.start.setDate(e.getTime());t.end.setDate(e.getTime()+this.calendar.util.dayLength*this.dayCount)}return s.prototype.getAdjustedDate.apply(this,[e,t])};i.prototype.adjustViewRangeToDate=function(e){var t=this.util.getWeekStart();while(this.util.getWeekDayByInd(e.getDay())!=t){e.setDate(e.getDate()-1)}return s.prototype.adjustViewRangeToDate.apply(this,[e])};if(e.BXEventCalendar){e.BXEventCalendar.CalendarDayView=s;e.BXEventCalendar.CalendarWeekView=i}else{BX.addCustomEvent(e,"onBXEventCalendarInit",(function(){e.BXEventCalendar.CalendarDayView=s;e.BXEventCalendar.CalendarWeekView=i}))}function a(e){this.position=e.position;this.outerWrap=e.wrap;this.workTime=e.workTime;this.dayOffset=e.dayOffset;this.dayCount=e.dayCount;this.lastEntryWidthOffset=e.lastEntryWidthOffset;this.gridLineHeight=e.gridLineHeight;this.labelMessage=e.labelMessage;this.clickHandler=e.clickHandler;this.mouseoutHandler=e.mouseoutHandler;this.mouseoverHandler=e.mouseoverHandler;this.isInited=false;this.entryCount=0;this.create()}a.prototype={create:function(){this.wrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-wrap calendar-event-block-wrap-more"},style:{top:this.position==="bottom"?(this.workTime.end-this.workTime.start)*this.gridLineHeight+"px":"-9px",left:this.dayCount>1?"calc((100% / "+this.dayCount+") * "+this.dayOffset+" + 2px)":"2px",width:"calc(100% / "+this.dayCount+" - "+this.lastEntryWidthOffset+"px)"}})).appendChild(BX.create("DIV",{props:{className:"calendar-event-block-inner"},html:'<div class="calendar-event-block-background" style="background-color: #808080;"></div>'}));if(BX.type.isFunction(this.clickHandler)){BX.bind(this.wrap,"click",this.clickHandler)}if(BX.type.isFunction(this.mouseoverHandler)){BX.bind(this.wrap,"mouseover",this.mouseoverHandler)}if(BX.type.isFunction(this.mouseoutHandler)){BX.bind(this.wrap,"mouseout",this.mouseoutHandler)}this.countContainer=this.wrap.appendChild(BX.create("span",{props:{className:"calendar-event-block-text"},html:'<span class="calendar-event-block-text-subtitle">'+this.labelMessage+"</span>"})).appendChild(BX.create("span",{props:{className:"calendar-event-block-text-total"}}));this.isInited=true},inited:function(){return this.isInited&&BX.isNodeInDom(this.wrap)},destroy:function(){BX.remove(this.wrap);this.isInited=false},addEntry:function(e){this.entryCount++;this.countContainer.innerHTML=this.entryCount}}})(window);
//# sourceMappingURL=calendar-view-day-week.map.js