(function(){"use strict";BX.namespace("BX.Calendar.UserField");function e(e){this.params=e;this.complexFields={};this.userFieldParams=null;this.id="resbook-settings-popup-"+Math.round(Math.random()*1e5);this.params.settings.data=this.settingsData=this.getSettingsData(this.params.settings.data);this.DOM={innerWrap:this.params.innerWrap,settingsWrap:this.params.innerWrap.appendChild(BX.create("div",{attrs:{"data-bx-resource-field-settings":"Y"}})),captionNode:this.params.captionNode,settingsInputs:{}}}BX.Calendar.UserField.CrmFormResourceBookingField=e;e.prototype={init:function(){this.showFieldLoader();BX.Calendar.UserField.getUserFieldParams({fieldName:this.params.entityName,selectedUsers:this.getSelectedUsers()}).then(BX.delegate(function(e){this.hideFieldLoader();this.userFieldParams=e;this.fieldLayout=new BX.Calendar.UserField.ResourceBookingFieldViewLayout({wrap:this.DOM.innerWrap,displayTitle:false,title:this.getCaption(),settings:this.getSettings()});this.fieldLayout.build();this.updateSettingsDataInputs()},this))},showSettingsPopup:function(){BX.Calendar.UserField.getUserFieldParams({fieldName:this.params.entityName,selectedUsers:this.getSelectedUsers()}).then(BX.delegate(function(e){this.userFieldParams=e;this.settingsPopupId="calendar-resourcebooking-settings-popup-"+Math.round(Math.random()*1e5);this.settingsPopup=new BX.PopupWindow(this.settingsPopupId,null,{content:this.getSettingsContentNode(),className:"calendar-resbook-webform-settings-popup-window",autoHide:false,lightShadow:true,closeByEsc:true,overlay:{backgroundColor:"black",opacity:500},zIndex:-400,titleBar:BX.message("WEBF_RES_SETTINGS"),closeIcon:true,buttons:[new BX.PopupWindowButton({})]});var t=this.settingsPopup.buttons[0].buttonNode.parentNode;BX.remove(this.settingsPopup.buttons[0].buttonNode);this.settingsPopup.buttons[0].buttonNode=t.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-success"},events:{click:BX.proxy(function(){this.settingsPopup.close()},this)},text:BX.message("WEBF_RES_CLOSE_SETTINGS_POPUP")}));BX.removeClass(this.settingsPopup.buttons[0].buttonNode,"popup-window-button");this.settingsPopup.show();BX.addCustomEvent(this.settingsPopup,"onPopupClose",BX.delegate(function(e){this.destroyControls();this.settingsPopup.destroy(this.id);this.settingsPopup=null;if(this.previewFieldLayout){this.previewFieldLayout.destroy()}},this))},this))},getSettingsContentNode:function(){var e=BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup"}});var t=e.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-inner"}}));this.buildSettingsForm({wrap:t});var s=e.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-preview"}}));this.previewFieldLayout=new BX.Calendar.UserField.ResourceBookingFieldPreviewLayout({wrap:s,title:this.getCaption(),settings:this.getSettings()});this.previewFieldLayout.build();BX.addCustomEvent("ResourceBooking.webformSettings:onChanged",BX.proxy(this.handleWebformSettingsChanges,this));return e},buildSettingsForm:function(e){var t=this.getSettings(),s=e.wrap,i="title-"+this.id;this.DOM.captionWrap=s.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-title"},html:'<label for="'+i+'" class="calendar-resbook-webform-settings-popup-label">'+BX.message("WEBF_RES_NAME_LABEL")+"</label>"}));this.DOM.captionInput=this.DOM.captionWrap.appendChild(BX.create("input",{attrs:{id:i,className:"calendar-resbook-webform-settings-popup-input",type:"text",value:this.getCaption()},events:{change:BX.proxy(this.updateCaption,this),blur:BX.proxy(this.updateCaption,this),keyup:BX.proxy(this.updateCaption,this)}}));this.updateCaption();this.DOM.fieldsOuterWrap=s.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-content"},html:'<div class="calendar-resbook-webform-settings-popup-head">'+'<div class="calendar-resbook-webform-settings-popup-head-inner">'+'<span class="calendar-resbook-webform-settings-popup-head-text">'+BX.message("WEBF_RES_FIELD_NAME")+"</span>"+'<span class="calendar-resbook-webform-settings-popup-head-decs">'+BX.message("WEBF_RES_FIELD_NAME_IN_FORM")+"</span>"+"</div>"+'<div class="calendar-resbook-webform-settings-popup-head-inner">'+'<span class="calendar-resbook-webform-settings-popup-head-text">'+BX.message("WEBF_RES_FIELD_SHOW_IN_FORM")+"</span>"+"</div>"+"</div>"}));this.DOM.fieldsWrap=this.DOM.fieldsOuterWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-list"}}));if(t.userfieldSettings.useUsers){this.buildComplexField("users",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.users,config:{users:t.userfieldSettings.users,selected:t.data.users.value}});BX.addCustomEvent("ResourceBooking.settingsUserSelector:onChanged",BX.proxy(this.checkBitrix24Limitation,this))}if(t.userfieldSettings.useResources){this.buildComplexField("resources",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.resources,config:{resources:t.userfieldSettings.resources,selected:t.data.resources.value}})}if(t.userfieldSettings.useServices){this.buildComplexField("services",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.services,config:{services:t.userfieldSettings.services,selected:t.data.services.value}})}else{this.buildComplexField("duration",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.duration})}this.buildComplexField("date",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.date});if(!t.userfieldSettings.fullDay){this.buildComplexField("time",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:t.data.time})}this.DOM.fieldsWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-item"},html:'<div class="calendar-resbook-webform-settings-popup-decs">'+BX.message("WEBF_RES_BOOKING_SETTINGS_HELP").replace("#START_LINK#",'<a href="javascript:void(0);"'+" onclick=\"if (top.BX.Helper){top.BX.Helper.show('redirect=detail&code=8366733');}\">").replace("#END_LINK#","</a>")+"</div>"}))},destroyControls:function(){for(var e in this.complexFields){if(this.complexFields.hasOwnProperty(e)&&BX.type.isFunction(this.complexFields[e].destroy)){this.complexFields[e].destroy()}}},handleWebformSettingsChanges:function(){if(this.refreshLayoutTimeout){this.refreshLayoutTimeout=clearTimeout(this.refreshLayoutTimeout)}this.refreshLayoutTimeout=setTimeout(BX.delegate(function(){for(var e in this.complexFields){if(this.complexFields.hasOwnProperty(e)&&BX.type.isFunction(this.complexFields[e].getValue)){this.settingsData[e]=this.complexFields[e].getValue()}}this.updateSettingsDataInputs();this.previewFieldLayout.refreshLayout(this.settingsData);this.fieldLayout.refreshLayout(this.settingsData);this.previewFieldLayout.getOuterWrap().style.maxHeight=Math.round(this.previewFieldLayout.getInnerWrap().offsetHeight*.73)+"px"},this),100)},buildComplexField:function(e,t){switch(e){case"users":this.complexFields[e]=new s;break;case"resources":this.complexFields[e]=new i;break;case"services":this.complexFields[e]=new a;break;case"duration":this.complexFields[e]=new o;break;case"date":this.complexFields[e]=new n;break;case"time":this.complexFields[e]=new p;break}this.complexFields[e].build(t)},getSettingsData:function(e){var t,s,i=BX.clone(this.getDefaultSettingsData(),true);if(BX.type.isPlainObject(e)){for(t in e){if(e.hasOwnProperty(t)&&i[t]){if(BX.type.isPlainObject(e[t])){for(s in e[t]){if(e[t].hasOwnProperty(s)){i[t][s]=e[t][s]}}}else{i[t]=e[t]}}}}return i},getDefaultSettingsData:function(){return{users:{show:"Y",label:BX.message("WEBF_RES_USERS_LABEL"),defaultMode:"auto",value:null},resources:{show:"Y",label:BX.message("WEBF_RES_RESOURCES_LABEL"),defaultMode:"auto",multiple:"N",value:null},services:{show:"Y",label:BX.message("WEBF_RES_SERVICE_LABEL"),value:null},duration:{show:"Y",label:BX.message("WEBF_RES_DURATION_LABEL"),defaultValue:60,manualInput:"N"},date:{label:BX.message("WEBF_RES_DATE_LABEL"),style:"line",start:"today"},time:{label:BX.message("WEBF_RES_TIME_LABEL"),style:"slots",showOnlyFree:"Y",showFinishTime:"N",scale:60}}},getSelectedUsers:function(){return this.settingsData&&this.settingsData.users&&BX.type.isString(this.settingsData.users.value)?this.settingsData.users.value.split("|"):[]},updateSettingsDataInputs:function(){var e,t;for(e in this.settingsData){if(this.settingsData.hasOwnProperty(e)){if(BX.type.isPlainObject(this.settingsData[e])){for(t in this.settingsData[e]){if(this.settingsData[e].hasOwnProperty(t)){this.updateSettingsInputValue([e,t],this.settingsData[e][t])}}}else{this.updateSettingsInputValue([e],this.settingsData[e])}}}},updateSettingsInputValue:function(e,t){var s=e.join("-");if(!this.DOM.settingsInputs[s]){this.DOM.settingsInputs[s]=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[SETTINGS_DATA]["+e.join("][")+"]"}}))}if(BX.type.isArray(t)){t=t.join("|")}this.DOM.settingsInputs[s].value=t},showFieldLoader:function(){if(this.DOM.innerWrap){this.hideFieldLoader();this.DOM.fieldLoader=this.DOM.innerWrap.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(100))}},hideFieldLoader:function(){BX.remove(this.DOM.fieldLoader)},getSettings:function(){if(!this.params.settings.userfieldSettings){this.params.settings.userfieldSettings={resources:this.userFieldParams.SETTINGS.SELECTED_RESOURCES,users:this.userFieldParams.SETTINGS.SELECTED_USERS,services:this.userFieldParams.SETTINGS.SERVICE_LIST,fullDay:this.userFieldParams.SETTINGS.FULL_DAY==="Y",useResources:this.userFieldParams.SETTINGS.USE_RESOURCES==="Y"&&this.userFieldParams.SETTINGS.SELECTED_RESOURCES.length,useUsers:this.userFieldParams.SETTINGS.USE_USERS==="Y",useServices:this.userFieldParams.SETTINGS.USE_SERVICES==="Y",resourceLimit:this.userFieldParams.SETTINGS.RESOURCE_LIMIT,userIndex:this.userFieldParams.SETTINGS.USER_INDEX}}return this.params.settings},updateSettings:function(e){},getCaption:function(){return this.params.settings.caption},updateCaption:function(){var e=this.DOM.captionInput.value;if(this.params.settings.caption!==e||!this.DOM.settingsInputs.caption){this.params.settings.caption=e;if(this.previewFieldLayout){this.previewFieldLayout.updateTitle(this.params.settings.caption)}if(!this.DOM.settingsInputs.caption){this.DOM.settingsInputs.caption=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[CAPTION]"}}))}this.DOM.settingsInputs.caption.value=this.params.settings.caption;if(this.DOM.captionNode){BX.adjust(this.DOM.captionNode,{text:this.params.settings.caption})}}},isRequired:function(){return this.params.settings.required==="Y"},updateRequiredValue:function(){this.params.settings.required=this.DOM.requiredCheckbox.checked?"Y":"N";if(!this.DOM.settingsInputs.required){this.DOM.settingsInputs.required=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[REQUIRED]"}}))}this.DOM.settingsInputs.required.value=this.params.settings.required},checkBitrix24Limitation:function(){var e=0,t=this.getSettings();if(BX.type.isArray(this.params.settings.userfieldSettings.resources)){e+=this.params.settings.userfieldSettings.resources.length}if(t.userfieldSettings.useUsers&&this.complexFields.users){var s=this.complexFields.users.getValue();if(s&&BX.type.isArray(s.value)){e+=s.value.length}}if(t.userfieldSettings.resourceLimit>0&&e>t.userfieldSettings.resourceLimit){BX.Calendar.UserField.ResourceBooking.showLimitationPopup()}}};function t(){this.label="";this.formLabel="";this.displayed=false;this.displayCheckboxDisabled=false;this.DOM={}}t.prototype={build:function(e){this.updateConfig(e.params);this.DOM.fieldWrap=BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-item"}});this.DOM.labelWrap=this.DOM.fieldWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-field"}}));this.DOM.labelNode=this.DOM.labelWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-title"},text:this.getLabel()}));this.DOM.formTitleWrap=this.DOM.labelWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-subtitle"+(this.isDisplayed()?" show":"")}}));this.DOM.formTitleLabel=this.DOM.formTitleWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-subtitle-text"},text:this.getFormLabel(),events:{click:BX.proxy(this.enableFormTitleEditMode,this)}}));this.DOM.formTitleEditIcon=this.DOM.formTitleWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-edit"},events:{click:BX.proxy(this.enableFormTitleEditMode,this)}}));this.DOM.checkboxNode=this.DOM.fieldWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-checkbox-container"}})).appendChild(BX.create("input",{attrs:{type:"checkbox",value:"Y",checked:this.isDisplayed(),disabled:this.displayCheckboxDisabled},events:{click:BX.delegate(this.checkDisplayMode,this)}}));this.buildStatePopup({wrap:this.DOM.fieldWrap,config:e.config||{}});this.buildValuePopup({wrap:this.DOM.fieldWrap,config:e.config||{}});if(BX.type.isFunction(e.changeSettingsCallback)){this.changeSettingsCallback=e.changeSettingsCallback}e.wrap.appendChild(this.DOM.fieldWrap)},destroy:function(){if(this.valuePopup&&BX.type.isFunction(this.valuePopup.closePopup)){this.valuePopup.closePopup()}if(this.statePopup&&BX.type.isFunction(this.statePopup.closePopup)){this.statePopup.closePopup()}},updateConfig:function(e){this.setFormLabel(e.label||this.formLabel);if(e.show){this.displayed=e.show!=="N"}},buildStatePopup:function(e){},buildValuePopup:function(e){},getLabel:function(){return this.label},getFormLabel:function(){return this.formLabel},setFormLabel:function(e){this.formLabel=e||""},isDisplayed:function(){return this.displayed},checkDisplayMode:function(){this.displayed=!!this.DOM.checkboxNode.checked;if(this.displayed){this.displayInForm()}else{this.hideInForm()}},displayInForm:function(){BX.addClass(this.DOM.formTitleWrap,"show");this.triggerChangeRefresh()},hideInForm:function(){BX.removeClass(this.DOM.formTitleWrap,"show");this.triggerChangeRefresh()},enableFormTitleEditMode:function(){if(!this.DOM.formTitleInputNode){this.DOM.formTitleInputNode=this.DOM.formTitleWrap.appendChild(BX.create("input",{attrs:{type:"text",className:"calendar-resbook-webform-settings-popup-field-subtitle-text"},events:{blur:BX.proxy(this.finishFormTitleEditMode,this)}}))}this.DOM.formTitleInputNode.value=this.getFormLabel();this.DOM.formTitleInputNode.style.display="";this.DOM.formTitleLabel.style.display="none";this.DOM.formTitleEditIcon.style.display="none";this.DOM.formTitleInputNode.focus()},finishFormTitleEditMode:function(){this.setFormLabel(this.DOM.formTitleInputNode.value);BX.adjust(this.DOM.formTitleLabel,{text:this.getFormLabel()});this.DOM.formTitleLabel.style.display="";this.DOM.formTitleEditIcon.style.display="";this.DOM.formTitleInputNode.style.display="none";this.triggerChangeRefresh()},getSettingsValue:function(){},triggerChangeRefresh:function(){setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)}};function s(){s.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_USERS");this.formLabel=BX.message("WEBF_RES_USERS_LABEL");this.displayed=true}BX.extend(s,t);s.prototype.updateConfig=function(e){s.superclass.updateConfig.apply(this,arguments);this.defaultMode=e.defaultMode};s.prototype.buildStatePopup=function(e){e.isDisplayed=BX.proxy(this.isDisplayed,this);e.defaultMode=e.defaultMode||this.defaultMode;this.statePopup=new l(e)};s.prototype.buildValuePopup=function(e){this.valuePopup=new g(e)};s.prototype.displayInForm=function(){s.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setEnabled()};s.prototype.hideInForm=function(){s.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setDisabled()};s.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultMode:this.statePopup.getDefaultMode(),value:this.valuePopup.getSelectedValues()}};function i(){i.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_RESOURCES");this.formLabel=BX.message("WEBF_RES_RESOURCES_LABEL");this.displayed=true}BX.extend(i,t);i.prototype.updateConfig=function(e){i.superclass.updateConfig.apply(this,arguments);this.defaultMode=e.defaultMode;this.multiple=e.multiple==="Y"};i.prototype.buildStatePopup=function(e){e.isDisplayed=BX.proxy(this.isDisplayed,this);e.defaultMode=e.defaultMode||this.defaultMode;e.multiple=e.multiple==null?this.multiple:e.multiple;this.statePopup=new u(e)};i.prototype.buildValuePopup=function(e){this.valuePopup=new y(e)};i.prototype.displayInForm=function(){i.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setEnabled()};i.prototype.hideInForm=function(){i.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setDisabled()};i.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultMode:this.statePopup.getDefaultMode(),multiple:this.statePopup.getMultiple()?"Y":"N",value:this.valuePopup.getSelectedId()}};function a(){a.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_SERVICES");this.formLabel=BX.message("WEBF_RES_SERVICE_LABEL");this.displayed=true}BX.extend(a,t);a.prototype.buildStatePopup=function(e){if(e&&BX.type.isDomNode(e.wrap)){e.wrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select disabled"},html:'<span class="calendar-resbook-webform-settings-popup-select-value">'+BX.message("WEBF_RES_FROM_LIST")+"</span>"}))}};a.prototype.buildValuePopup=function(e){this.valuePopup=new B(e)};a.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),value:this.valuePopup.getSelectedValues()}};function o(){o.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_DURATION");this.formLabel=BX.message("WEBF_RES_DURATION_LABEL")}BX.extend(o,t);o.prototype.updateConfig=function(e){o.superclass.updateConfig.apply(this,arguments);this.defaultValue=e.defaultValue;this.manualInput=e.manualInput==="Y"};o.prototype.buildStatePopup=function(e){e.isDisplayed=BX.proxy(this.isDisplayed,this);e.defaultValue=this.defaultValue;e.manualInput=this.manualInput;this.statePopup=new h(e)};o.prototype.displayInForm=function(){o.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges()};o.prototype.hideInForm=function(){o.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges()};o.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultValue:this.statePopup.getDefaultValue(),manualInput:this.statePopup.getManualInput()?"Y":"N"}};function n(){n.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_DATE");this.formLabel=BX.message("WEBF_RES_DATE_LABEL");this.displayed=true;this.displayCheckboxDisabled=true}BX.extend(n,t);n.prototype.updateConfig=function(e){n.superclass.updateConfig.apply(this,arguments);this.style=e.style;this.start=e.start};n.prototype.buildStatePopup=function(e){e.style=e.style||this.style;e.start=e.start||this.start;this.statePopup=new d(e)};n.prototype.getValue=function(){return{label:this.getFormLabel(),style:this.statePopup.getStyle(),start:this.statePopup.getStart()}};function p(){p.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_TIME");this.formLabel=BX.message("WEBF_RES_TIME_LABEL");this.displayed=true;this.displayCheckboxDisabled=true}BX.extend(p,t);p.prototype.updateConfig=function(e){p.superclass.updateConfig.apply(this,arguments);this.style=e.style;this.showOnlyFree=e.showOnlyFree==="Y";this.showFinishTime=e.showFinishTime==="Y";this.scale=parseInt(e.scale)};p.prototype.buildStatePopup=function(e){e.style=e.style||this.style;e.showOnlyFree=this.showOnlyFree;e.showFinishTime=this.showFinishTime;e.scale=this.scale;this.statePopup=new c(e)};p.prototype.getValue=function(){return{label:this.getFormLabel(),style:this.statePopup.getStyle(),showFinishTime:this.statePopup.getShowFinishTime(),showOnlyFree:this.statePopup.getShowOnlyFree(),scale:this.statePopup.getScale()}};function r(e){this.id="resourcebooking-settings-popup-"+Math.round(Math.random()*1e5);this.menuItems=[];this.DOM={outerWrap:e.wrap}}r.prototype={build:function(){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select"}}));this.DOM.currentStateLink=this.DOM.innerWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-select-value"},text:this.getCurrentModeState(),events:{click:BX.delegate(this.showPopup,this)}}))},showPopup:function(){if(this.isPopupShown()||this.disabled){return this.closePopup()}this.menuItems=this.getMenuItems();this.popup=BX.PopupMenu.create(this.id,this.DOM.currentStateLink,this.menuItems,{className:"popup-window-resource-select",closeByEsc:true,autoHide:false,offsetTop:0,offsetLeft:0});this.popup.popupWindow.setAngle({offset:30,position:"top"});this.popup.show(true);this.popupContainer=this.popup.popupWindow.popupContainer;BX.addCustomEvent(this.popup.popupWindow,"onPopupClose",BX.proxy(function(){BX.PopupMenu.destroy(this.id);this.popup=null},this));this.popup.menuItems.forEach(function(e){var t=false,s,i,a="";if(e.dataset&&e.dataset.type){i=e.dataset.checked;var o="menu-popup-item";if(e.dataset.type==="radio"){t="radio";s="menu-popup-item-resource-radio";if(e.dataset.inputName){a=' name="'+e.dataset.inputName+'" '}}else if(e.dataset.type==="checkbox"){t="checkbox";s="menu-popup-item-resource-checkbox"}var n='<div class="menu-popup-item-inner">';if(e.dataset.type==="submenu-list"){o+=" menu-popup-item-submenu";n+='<div class="menu-popup-item-resource menu-popup-item-resource-wide">'+'<span class="menu-popup-item-text">'+"<span>"+e.text+"</span>"+'<span class="menu-popup-item-resource-subvalue">'+(e.dataset.textValue||e.dataset.value)+"</span>"+"</span>"+"</div>"}else if(t){n+='<div class="menu-popup-item-resource">';if(t){n+='<input class="'+s+'" type="'+t+'"'+(i?'checked="checked"':"")+' id="'+e.id+'" '+a+">"+'<label class="menu-popup-item-text"  for="'+e.id+'">'+e.text+"</label>"}n+="</div>"}n+="</div>";e.layout.item.className=o;e.layout.item.innerHTML=n}},this);setTimeout(BX.delegate(function(){BX.bind(document,"click",BX.proxy(this.handleClick,this))},this),50)},closePopup:function(){if(this.isPopupShown()){this.popup.close();this.popupContainer.style.maxHeight="";BX.unbind(document,"click",BX.proxy(this.handleClick,this))}},isPopupShown:function(){return this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown&&this.popup.popupWindow.isShown()&&this.popup.popupWindow.popupContainer&&BX.isNodeInDom(this.popup.popupWindow.popupContainer)},getCurrentModeState:function(){return""},getPopupContent:function(){this.DOM.innerWrap=BX.create("div",{props:{className:""}});return this.DOM.innerWrap},handlePopupClick:function(e){var t=e.target||e.srcElement;if(t.hasAttribute("data-bx-resbook-control-node")||BX.findParent(t,{attribute:"data-bx-resbook-control-node"},this.DOM.innerWrap)){this.handleControlChanges()}},handleControlChanges:function(){if(this.changesTimeout){this.changesTimeout=clearTimeout(this.changesTimeout)}this.changesTimeout=setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)},menuItemClick:function(e,t){},handleClick:function(e){var t=e.target||e.srcElement;if(this.isPopupShown()&&!BX.isParentForNode(this.popupContainer,t)){return this.closePopup({animation:true})}},setDisabled:function(){this.disabled=true;if(this.isPopupShown()){this.closePopup()}BX.addClass(this.DOM.innerWrap,"disabled")},setEnabled:function(){this.disabled=false;BX.removeClass(this.DOM.innerWrap,"disabled")}};function l(e){l.superclass.constructor.apply(this,arguments);this.name="usersStatePopup";this.inputName="user-select-mode";this.id="users-state-"+Math.round(Math.random()*1e3);this.defaultMode=e.defaultMode==="none"?"none":"auto";this.isDisplayed=BX.type.isFunction(e.isDisplayed)?e.isDisplayed:BX.DoNothing;this.build()}BX.extend(l,r);l.prototype.build=function(){l.superclass.build.apply(this,arguments);this.handleControlChanges()};l.prototype.getMenuItems=function(){return[new BX.Main.Popup.MenuItem({text:BX.message("WEBF_RES_SELECT_DEFAULT_TITLE"),delimiter:true}),{id:"users-state-list",text:BX.message("WEBF_RES_SELECT_DEFAULT_EMPTY"),dataset:{type:"radio",value:"none",inputName:this.inputName,checked:this.defaultMode==="none"},onclick:BX.proxy(this.menuItemClick,this)},{id:"users-state-auto",text:BX.message("WEBF_RES_SELECT_DEFAULT_FREE_USER"),dataset:{type:"radio",value:"auto",inputName:this.inputName,checked:this.defaultMode==="auto"},onclick:BX.proxy(this.menuItemClick,this)}]};l.prototype.menuItemClick=function(e,t){var s=e.target||e.srcElement;if(BX.type.isDomNode(s)&&s.nodeName.toLowerCase()==="input"&&t.dataset&&t.dataset.inputName===this.inputName){this.defaultMode=t.dataset.value}this.handleControlChanges();setTimeout(BX.delegate(this.closePopup,this),50)};l.prototype.getCurrentModeState=function(){return this.isDisplayed()?BX.message("WEBF_RES_SELECT_USER_FROM_LIST_SHORT")+(this.defaultMode==="none"?"":",<br>"+BX.message("WEBF_RES_AUTO_SELECT_USER_SHORT")):BX.message("WEBF_RES_SELECT_USER_FROM_LIST_AUTO")};l.prototype.handleControlChanges=function(){l.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};l.prototype.getDefaultMode=function(){return this.defaultMode};function u(e){u.superclass.constructor.apply(this,arguments);this.name="resourcesStatePopup";this.inputName="resource-select-mode";this.defaultMode=e.defaultMode==="none"?"none":"auto";this.multiple=!!e.multiple;this.isDisplayed=BX.type.isFunction(e.isDisplayed)?e.isDisplayed:BX.DoNothing;this.build()}BX.extend(u,r);u.prototype.build=function(){l.superclass.build.apply(this,arguments);this.handleControlChanges()};u.prototype.getMenuItems=function(){return[new BX.Main.Popup.MenuItem({text:BX.message("WEBF_RES_SELECT_DEFAULT_TITLE"),delimiter:true}),{id:"resources-state-list",text:BX.message("WEBF_RES_SELECT_DEFAULT_EMPTY"),dataset:{type:"radio",value:"none",inputName:this.inputName,checked:this.defaultMode==="none"},onclick:BX.proxy(this.menuItemClick,this)},{id:"resources-state-auto",text:BX.message("WEBF_RES_AUTO_SELECT_RES"),dataset:{type:"radio",value:"auto",inputName:this.inputName,checked:this.defaultMode==="auto"},onclick:BX.proxy(this.menuItemClick,this)},{delimiter:true},{id:"resources-state-multiple",text:BX.message("WEBF_RES_MULTIPLE"),dataset:{type:"checkbox",value:"Y",checked:this.multiple},onclick:BX.proxy(this.menuItemClick,this)}]};u.prototype.getCurrentModeState=function(){return this.isDisplayed()?BX.message("WEBF_RES_SELECT_RES_FROM_LIST_SHORT")+(this.defaultMode==="none"?"":",<br>"+BX.message("WEBF_RES_AUTO_SELECT_RES_SHORT")):BX.message("WEBF_RES_SELECT_RES_FROM_LIST_AUTO")};u.prototype.handleControlChanges=function(){u.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};u.prototype.menuItemClick=function(e,t){var s=e.target||e.srcElement;if(BX.type.isDomNode(s)&&s.nodeName.toLowerCase()==="input"&&t.dataset){if(t.dataset.inputName===this.inputName){this.defaultMode=t.dataset.value}else if(t.id==="resources-state-multiple"){this.multiple=!!s.checked}}this.handleControlChanges()};u.prototype.getDefaultMode=function(){return this.defaultMode};u.prototype.getMultiple=function(){return this.multiple};function h(e){h.superclass.constructor.apply(this,arguments);this.name="durationStatePopup";this.inputName="duration-select-mode";this.manualInput=!!e.manualInput;this.defaultValue=e.defaultValue||60;this.isDisplayed=BX.type.isFunction(e.isDisplayed)?e.isDisplayed:BX.DoNothing;this.durationList=BX.Calendar.UserField.ResourceBooking.getDurationList(e.fullDay);this.build()}BX.extend(h,r);h.prototype.build=function(){l.superclass.build.apply(this,arguments);this.handleControlChanges()};h.prototype.getMenuItems=function(){return[{id:"duration-default-value",text:BX.message("WEBF_RES_SELECT_DURATION_AUTO"),dataset:{type:"submenu-list",value:this.defaultValue,textValue:this.getDurationLabelByValue(this.defaultValue)},items:this.getDefaultMenuItems()}].concat(this.isDisplayed()?[{delimiter:true},{id:"duration-manual-input",text:BX.message("WEBF_RES_SELECT_MANUAL_INPUT"),dataset:{type:"checkbox",value:"Y",checked:this.manualInput},onclick:BX.proxy(this.menuItemClick,this)}]:[])};h.prototype.getDefaultMenuItems=function(){var e=[];if(BX.type.isArray(this.durationList)){this.durationList.forEach(function(t){e.push({id:"duration-"+t.value,dataset:{type:"duration",value:t.value},text:t.label,onclick:BX.proxy(this.menuItemClick,this)})},this)}return e};h.prototype.getDurationLabelByValue=function(e){var t=this.durationList.find(function(t){return parseInt(t.value)===parseInt(e)});return t?t.label:null};h.prototype.getCurrentModeState=function(){return this.isDisplayed()?BX.message("WEBF_RES_SELECT_DURATION_FROM_LIST_SHORT")+(",<br>"+BX.message("WEBF_RES_SELECT_DURATION_BY_DEFAULT")+" "+this.getDurationLabelByValue(this.defaultValue)):BX.message("WEBF_RES_SELECT_DURATION_AUTO")+" "+this.getDurationLabelByValue(this.defaultValue)};h.prototype.handleControlChanges=function(){h.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};h.prototype.menuItemClick=function(e,t){var s=e.target||e.srcElement;if(BX.type.isDomNode(s)&&s.nodeName.toLowerCase()==="input"&&t.dataset){if(t.id==="duration-manual-input"){this.manualInput=!!s.checked}}else if(t.dataset&&t.dataset.type==="duration"){this.defaultValue=parseInt(t.dataset.value)}this.handleControlChanges()};h.prototype.getManualInput=function(){return this.manualInput};h.prototype.getDefaultValue=function(){return this.defaultValue};function d(e){d.superclass.constructor.apply(this,arguments);this.name="dateStatePopup";this.styleInputName="date-select-style";this.startInputName="date-select-start";this.style=e.style==="popup"?"popup":"line";this.start=e.start==="today"?"today":"free";this.build()}BX.extend(d,r);d.prototype.getMenuItems=function(){return[new BX.Main.Popup.MenuItem({text:BX.message("WEBF_RES_CALENDAR_STYLE"),delimiter:true}),{id:"date-state-style-popup",text:BX.message("WEBF_RES_CALENDAR_STYLE_POPUP"),dataset:{type:"radio",value:"popup",inputName:this.styleInputName,checked:this.style==="popup"},onclick:BX.proxy(this.menuItemClick,this)},{id:"date-state-style-line",text:BX.message("WEBF_RES_CALENDAR_STYLE_LINE"),dataset:{type:"radio",value:"line",inputName:this.styleInputName,checked:this.style==="line"},onclick:BX.proxy(this.menuItemClick,this)},new BX.Main.Popup.MenuItem({text:BX.message("WEBF_RES_CALENDAR_START_FROM"),delimiter:true}),{id:"date-state-start-from-today",text:BX.message("WEBF_RES_CALENDAR_START_FROM_TODAY"),dataset:{type:"radio",value:"today",inputName:this.startInputName,checked:this.start==="today"},onclick:BX.proxy(this.menuItemClick,this)},{id:"date-state-start-from-free",text:BX.message("WEBF_RES_CALENDAR_START_FROM_FREE"),dataset:{type:"radio",value:"free",inputName:this.startInputName,checked:this.start==="free"},onclick:BX.proxy(this.menuItemClick,this)}]};d.prototype.getCurrentModeState=function(){return(this.style==="popup"?BX.message("WEBF_RES_CALENDAR_STYLE_POPUP"):BX.message("WEBF_RES_CALENDAR_STYLE_LINE"))+", "+(this.start==="today"?BX.message("WEBF_RES_CALENDAR_START_FROM_TODAY_SHORT"):BX.message("WEBF_RES_CALENDAR_START_FROM_FREE_SHORT"))};d.prototype.handleControlChanges=function(){d.superclass.handleControlChanges.apply(this,arguments);BX.adjust(this.DOM.currentStateLink,{text:this.getCurrentModeState()})};d.prototype.menuItemClick=function(e,t){var s=e.target||e.srcElement;if(BX.type.isDomNode(s)&&s.nodeName.toLowerCase()==="input"&&t.dataset){if(t.dataset.inputName===this.styleInputName){this.style=t.dataset.value}else if(t.dataset.inputName===this.startInputName){this.start=t.dataset.value}}this.handleControlChanges()};d.prototype.getStyle=function(){return this.style};d.prototype.getStart=function(){return this.start};function c(e){c.superclass.constructor.apply(this,arguments);this.name="timeStatePopup";this.styleInputName="date-select-style";this.showOnlyFree=e.showOnlyFree;this.showFinishTime=e.showFinishTime;this.scale=e.scale;this.stateShowFreeId="time-state-show-free";this.stateShowFinishId="time-state-show-finish";this.style=e.style==="select"?"select":"slots";this.build()}BX.extend(c,r);c.prototype.build=function(){c.superclass.build.apply(this,arguments);this.handleControlChanges()};c.prototype.getMenuItems=function(){return[new BX.Main.Popup.MenuItem({text:BX.message("WEBF_RES_TIME_STYLE"),delimiter:true}),{id:"time-state-style-select",text:BX.message("WEBF_RES_TIME_STYLE_SELECT"),dataset:{type:"radio",value:"select",inputName:this.styleInputName,checked:this.style==="select"},onclick:BX.proxy(this.menuItemClick,this)},{id:"time-state-style-slots",text:BX.message("WEBF_RES_TIME_STYLE_SLOT"),dataset:{type:"radio",value:"slots",inputName:this.styleInputName,checked:this.style==="slots"},onclick:BX.proxy(this.menuItemClick,this)},{delimiter:true},{id:"time-state-scale",text:BX.message("WEBF_RES_TIME_BOOKING_SIZE"),dataset:{type:"submenu-list",value:this.scale,textValue:this.getDurationLabelByValue(this.scale)},items:this.getDurationMenuItems()},{delimiter:true},{id:this.stateShowFreeId,text:BX.message("WEBF_RES_TIME_SHOW_FREE_ONLY"),dataset:{type:"checkbox",value:"Y",checked:this.showOnlyFree},onclick:BX.proxy(this.menuItemClick,this)},{id:this.stateShowFinishId,text:BX.message("WEBF_RES_TIME_SHOW_FINISH_TIME"),dataset:{type:"checkbox",value:"Y",checked:this.showFinishTime},onclick:BX.proxy(this.menuItemClick,this)}]};c.prototype.getCurrentModeState=function(){return(this.style==="select"?BX.message("WEBF_RES_TIME_STYLE_SELECT"):BX.message("WEBF_RES_TIME_STYLE_SLOT"))+",<br>"+BX.message("WEBF_RES_TIME_BOOKING_SIZE")+": "+this.getDurationLabelByValue(this.scale)};c.prototype.handleControlChanges=function(){c.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState()};c.prototype.menuItemClick=function(e,t){var s=e.target||e.srcElement;if(BX.type.isDomNode(s)&&s.nodeName.toLowerCase()==="input"&&t.dataset){if(t.dataset.inputName===this.styleInputName){this.style=t.dataset.value}else if(t.id===this.stateShowFreeId){this.showOnlyFree=!!s.checked}else if(t.id===this.stateShowFinishId){this.showFinishTime=!!s.checked}}else if(t.dataset&&t.dataset.type==="scale"){this.scale=parseInt(t.dataset.value)}this.handleControlChanges()};c.prototype.getDurationMenuItems=function(){var e=this.getDurationList(),t=[];e.forEach(function(e){t.push({id:"duration-"+e.value,dataset:{type:"scale",value:e.value},text:e.label,onclick:BX.proxy(this.menuItemClick,this)})},this);return t};c.prototype.getDurationList=function(){if(!this.durationList){this.durationList=BX.Calendar.UserField.ResourceBooking.getDurationList(false);this.durationList=this.durationList.filter(function(e){return e.value&&e.value>=15&&e.value<=240})}return this.durationList};c.prototype.getDurationLabelByValue=function(e){var t=this.getDurationList().find(function(t){return t.value===e});return t?t.label:null};c.prototype.getStyle=function(){return this.style};c.prototype.getScale=function(){return this.scale};c.prototype.getShowOnlyFree=function(){return this.showOnlyFree?"Y":"N"};c.prototype.getShowFinishTime=function(){return this.showFinishTime?"Y":"N"};function m(e){this.id="resourcebooking-settings-value-popup-"+Math.round(Math.random()*1e5);this.DOM={outerWrap:e.wrap}}m.prototype={build:function(){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select-result"}}));this.DOM.valueLink=this.DOM.innerWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-select-value"},text:this.getCurrentValueState(),events:{click:BX.delegate(this.showPopup,this),mouseover:BX.delegate(this.showHoverPopup,this),mouseout:BX.delegate(this.hideHoverPopup,this)}}))},showPopup:function(){if(this.popup&&this.popup.isShown()){return this.popup.close()}this.popup=new BX.PopupWindow(this.id,this.DOM.valueLink,{autoHide:true,loseByEsc:true,offsetTop:0,offsetLeft:0,width:this.getPopupWidth(),lightShadow:true,content:this.getPopupContent()});this.popup.setAngle({offset:60,position:"top"});this.popup.show(true);BX.unbind(this.DOM.innerWrap,"click",BX.proxy(this.handlePopupClick,this));BX.bind(this.DOM.innerWrap,"click",BX.proxy(this.handlePopupClick,this));BX.addCustomEvent(this.popup,"onPopupClose",BX.delegate(function(){this.handlePopupCloose();this.popup.destroy(this.id);this.popup=null},this))},closePopup:function(){if(this.isPopupShown()){this.popup.close()}},isPopupShown:function(){return this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown&&this.popup.popupWindow.isShown()&&this.popup.popupWindow.popupContainer&&BX.isNodeInDom(this.popup.popupWindow.popupContainer)},showHoverPopup:function(){},hideHoverPopup:function(){},handlePopupCloose:function(){},getCurrentValueState:function(){return BX.message("WEBF_RES_NO_VALUE")},getPopupContent:function(){this.DOM.innerWrap=BX.create("div",{props:{className:""}});this.DOM.innerWrap.style.minWidth="500px";this.DOM.innerWrap.style.minHeight="30px";return this.DOM.innerWrap},getPopupWidth:function(){return null},handlePopupClick:function(e){var t=e.target||e.srcElement;if(t.hasAttribute("data-bx-resbook-control-node")||BX.findParent(t,{attribute:"data-bx-resbook-control-node"},this.DOM.innerWrap)){this.handleControlChanges()}},handleControlChanges:function(){setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)},showPopupLoader:function(){if(this.DOM.innerWrap){this.hidePopupLoader();this.DOM.popupLoader=this.DOM.innerWrap.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(50))}},hidePopupLoader:function(){BX.remove(this.DOM.popupLoader)}};function f(e){f.superclass.constructor.apply(this,arguments);this.id="resourcebooking-settings-multiple-checknox-"+Math.round(Math.random()*1e5)}BX.extend(f,m);f.prototype.showPopup=function(){if(this.isPopupShown()){return this.closePopup()}var e=[];this.values.forEach(function(t){e.push({id:t.id,text:BX.util.htmlspecialchars(t.title),dataset:t.dataset,onclick:BX.proxy(this.menuItemClick,this)})},this);if(e.length>1){this.selectAllMessage=this.selectAllMessage||"select all";e.push({text:this.selectAllMessage,onclick:BX.proxy(this.selectAllItemClick,this)})}this.popup=BX.PopupMenu.create(this.id,this.DOM.valueLink,e,{className:"popup-window-resource-select",closeByEsc:true,autoHide:false,offsetTop:0,offsetLeft:0});this.popup.popupWindow.setAngle({offset:60,position:"top"});this.popup.show(true);this.popupContainer=this.popup.popupWindow.popupContainer;BX.addCustomEvent(this.popup.popupWindow,"onPopupClose",BX.proxy(function(){this.handlePopupCloose();BX.PopupMenu.destroy(this.id);this.popup=null},this));this.popup.menuItems.forEach(function(e){var t;if(e.dataset&&e.dataset.id){t=this.selectedValues.find(function(t){return t===e.id});e.layout.item.className="menu-popup-item";e.layout.item.innerHTML='<div class="menu-popup-item-inner">'+'<div class="menu-popup-item-resource">'+'<input class="menu-popup-item-resource-checkbox" type="checkbox"'+(t?'checked="checked"':"")+' id="'+e.id+'">'+'<label class="menu-popup-item-text" for="'+e.id+'">'+e.text+"</label>"+"</div>"+"</div>"}else{this.selectAllChecked=!this.values.find(function(e){return!this.selectedValues.find(function(t){return t===e.id})},this);e.layout.item.className="menu-popup-item menu-popup-item-resource-all";e.layout.item.innerHTML='<div class="menu-popup-item-inner">'+'<div class="menu-popup-item-resource">'+'<input class="menu-popup-item-resource-checkbox menu-popup-item-all-resources-checkbox" type="checkbox"'+(this.selectAllChecked?'checked="checked"':"")+' id="'+e.id+'">'+'<label class="menu-popup-item-text" for="'+e.id+'">'+e.text+"</label>"+"</div>"+"</div>"}},this);setTimeout(BX.delegate(function(){BX.bind(document,"click",BX.proxy(this.handleClick,this))},this),50)};f.prototype.menuItemClick=function(e,t){var s,i=e.target||e.srcElement,a=t.layout.item.querySelector(".menu-popup-item-resource-checkbox"),o=this.values.find(function(e){return e.id===t.id});if(o){if(i&&(BX.hasClass(i,"menu-popup-item")||BX.hasClass(i,"menu-popup-item-resource-checkbox")||BX.hasClass(i,"menu-popup-item-inner"))){if(!BX.hasClass(i,"menu-popup-item-resource-checkbox")){a.checked=!a.checked}if(a.checked){this.selectItem(o)}else{this.deselectItem(o);s=this.popupContainer.querySelector(".menu-popup-item-all-resources-checkbox");this.selectAllChecked=false;if(s){s.checked=false}}}this.handleControlChanges()}};f.prototype.selectItem=function(e){if(!BX.util.in_array(e.id,this.selectedValues)){this.selectedValues.push(e.id)}};f.prototype.deselectItem=function(e){var t=BX.util.array_search(e.id,this.selectedValues);if(t>=0){this.selectedValues=BX.util.deleteFromArray(this.selectedValues,t)}};f.prototype.selectAllItemClick=function(e,t){var s=e.target||e.srcElement;if(s&&(BX.hasClass(s,"menu-popup-item")||BX.hasClass(s,"menu-popup-item-resource-checkbox"))){var i=t.layout.item.querySelector(".menu-popup-item-resource-checkbox");if(BX.hasClass(s,"menu-popup-item")){i.checked=!i.checked}var a,o=this.popupContainer.querySelectorAll("input.menu-popup-item-resource-checkbox");this.selectAllChecked=i.checked;for(a=0;a<o.length;a++){o[a].checked=this.selectAllChecked}this.selectedValues=[];if(this.selectAllChecked){this.values.forEach(function(e){this.selectedValues.push(e.id)},this)}this.handleControlChanges()}};f.prototype.handleClick=function(e){var t=e.target||e.srcElement;if(this.isPopupShown()&&!BX.isParentForNode(this.popupContainer,t)){this.closePopup({animation:true})}this.handleControlChanges()};f.prototype.closePopup=function(){if(this.isPopupShown()){this.popup.close();this.popupContainer.style.maxHeight="";BX.unbind(document,"click",BX.proxy(this.handleClick,this))}};f.prototype.getSelectedValues=function(){return this.selectedValues};function g(e){g.superclass.constructor.apply(this,arguments);this.name="usersValuePopup";this.values=[];this.selectedValues=[];this.selectedCodes=[];var t,s={},i=e.config.selected===null;t=BX.type.isArray(e.config.selected)?e.config.selected:e.config.selected.split("|");if(BX.type.isArray(t)){for(var a=0;a<t.length;a++){s[t[a]]=true;this.selectedValues.push(t[a]);this.selectedCodes.push("U"+t[a])}}if(BX.type.isArray(e.config.users)&&i){e.config.users.forEach(function(e){if(!s[e]){this.selectedValues.push(e);this.selectedCodes.push("U"+e)}},this)}this.config={};this.build()}BX.extend(g,m);g.prototype.getPopupContent=function(){g.superclass.getPopupContent.apply(this);var e=new BX.Promise;e.then(BX.delegate(this.buildUserSelector,this));if(!this.config.socnetDestination){this.showPopupLoader();BX.ajax.runAction("calendar.api.resourcebookingajax.getuserselectordata",{data:{selectedUserList:this.selectedValues}}).then(BX.delegate(function(t){this.hidePopupLoader();this.config.socnetDestination=t.data;e.fulfill()},this),function(e){})}else{e.fulfill()}return this.DOM.innerWrap};g.prototype.showPopupLoader=function(){if(this.DOM.innerWrap){this.hidePopupLoader();this.DOM.popupLoader=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-popup-loader-wrap"}}));this.DOM.popupLoader.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(38))}};g.prototype.getPopupWidth=function(){return 680};g.prototype.buildUserSelector=function(){this.DOM.userCurrentvalueWrap=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-content-block-control custom-field-item"}}));this.DOM.userSelectorWrap=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-pseudo-popup-wrap"}}));this.userSelector=new C({wrapNode:this.DOM.userCurrentvalueWrap,socnetDestination:this.config.socnetDestination,itemsSelected:this.selectedCodes,addMessage:BX.message("USER_TYPE_RESOURCE_SELECT_USER"),externalWrap:this.DOM.userSelectorWrap});this.userSelectorId=this.userSelector.getId();BX.addCustomEvent("OnResourceBookDestinationAddNewItem",BX.proxy(this.triggerUserSelectorUpdate,this));BX.addCustomEvent("OnResourceBookDestinationUnselect",BX.proxy(this.triggerUserSelectorUpdate,this))};g.prototype.getSelectedValues=function(){return this.selectedValues};g.prototype.triggerUserSelectorUpdate=function(e,t,s){if(t===this.userSelectorId){if(this.selectorUpdateTimeout){this.selectorUpdateTimeout=clearTimeout(this.selectorUpdateTimeout)}if(s!==false){this.selectorUpdateTimeout=setTimeout(BX.proxy(function(){this.triggerUserSelectorUpdate(e,t,false)},this),300);return}this.selectedValues=[];this.selectedCodes=this.userSelector.getAttendeesCodesList();this.selectedCodes.forEach(function(e){if(e.substr(0,1)==="U"){this.selectedValues.push(parseInt(e.substr(1)))}},this);this.handleControlChanges()}};g.prototype.getCurrentValueState=function(){var e=this.selectedValues.length;return e?e+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_USER",e):BX.message("WEBF_RES_NO_VALUE")};g.prototype.handleControlChanges=function(){BX.onCustomEvent("ResourceBooking.settingsUserSelector:onChanged");g.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};function y(e){y.superclass.constructor.apply(this,arguments);this.name="resourcesValuePopup";this.selectAllMessage=BX.message("USER_TYPE_RESOURCE_SELECT_ALL");var t,s={},i=e.config.selected===null;if(BX.type.isArray(e.config.selected)){t=e.config.selected}else if(BX.type.isString(e.config.selected)){t=e.config.selected.split("|")}if(BX.type.isArray(t)){for(var a=0;a<t.length;a++){s[t[a]]=true}}this.values=[];this.selectedValues=[];if(BX.type.isArray(e.config.resources)){e.config.resources.forEach(function(e){var t=this.prepareValueId(e);this.values.push({id:t,title:e.title,dataset:e});if(i||s[e.id]){this.selectedValues.push(t)}},this)}this.build()}BX.extend(y,f);y.prototype.handleControlChanges=function(){y.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};y.prototype.getCurrentValueState=function(){var e=this.selectedValues.length;return e?e+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_RESOURCE",e):BX.message("WEBF_RES_NO_VALUE")};y.prototype.prepareValueId=function(e){return e.type+"|"+e.id};y.prototype.getSelectedId=function(){var e=[];this.getSelectedValues().forEach(function(t){var s=t.split("|");if(s&&s[1]){e.push(parseInt(s[1]))}});return e};function B(e){B.superclass.constructor.apply(this,arguments);this.name="ServiceValuePopup";this.selectAllMessage=BX.message("WEBF_RES_SELECT_ALL_SERVICES");var t=e.config.selected===null||e.config.selected===""||e.config.selected===undefined;this.values=[];this.selectedValues=[];var s,i={};if(BX.type.isArray(e.config.selected)){s=e.config.selected}else if(BX.type.isString(e.config.selected)){s=e.config.selected.split("|")}if(BX.type.isArray(s)){for(var a=0;a<s.length;a++){i[this.prepareServiceId(s[a])]=true}}if(BX.type.isArray(e.config.services)){e.config.services.forEach(function(e){e.id=this.prepareServiceId(e.name);this.values.push({id:e.id,title:e.name+" - "+BX.Calendar.UserField.ResourceBooking.getDurationLabel(e.duration),dataset:e});if(t||i[this.prepareServiceId(e.name)]){this.selectedValues.push(e.id)}},this)}this.config={};this.build()}BX.extend(B,f);B.prototype.handleControlChanges=function(){B.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};B.prototype.getSelectedValues=function(){return this.selectedValues.length?this.selectedValues:"#EMPTY-SERVICE-LIST#"};B.prototype.getCurrentValueState=function(){var e=this.selectedValues.length;return e?e+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_SERVICE",e):BX.message("WEBF_RES_NO_VALUE")};B.prototype.prepareServiceId=function(e){return BX.translit(e).replace(/[^a-z0-9_]/gi,"_")};function C(e){C.superclass.constructor.apply(this,arguments);this.DOM.externalWrap=e.externalWrap;this.closeDialogDelayFlag=false;this.finalShowClassName="calendar-resbook-socnet-dest-custom-wrap-appearing"}BX.extend(C,BX.Calendar.UserField.ResourceBooking.UserSelector);C.prototype.openDialogCallback=function(){C.superclass.openDialogCallback.apply(this,arguments);BX.cleanNode(this.DOM.externalWrap);var e=!this.closeDialogDelayFlag;if(this.popupContent&&BX.hasClass(this.popupContent,this.finalShowClassName)||this.popupSearchContent&&BX.hasClass(this.popupSearchContent,this.finalShowClassName)){e=false}if(BX.SocNetLogDestination.popupWindow){this.popupContent=this.DOM.externalWrap.appendChild(BX.SocNetLogDestination.popupWindow.contentContainer);BX.addClass(BX.SocNetLogDestination.popupWindow.popupContainer,"calendar-resbook-socnet-dest-popup-hide");if(e){BX.addClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap");BX.defer(function(){BX.addClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap-show");setTimeout(BX.delegate(function(){BX.addClass(this.popupContent,this.finalShowClassName)},this),200)},this)()}else{BX.addClass(this.popupContent,this.finalShowClassName)}}if(BX.SocNetLogDestination.popupSearchWindow){this.popupSearchContent=this.DOM.externalWrap.appendChild(BX.SocNetLogDestination.popupSearchWindow.contentContainer);BX.addClass(this.popupSearchContent,this.finalShowClassName);BX.addClass(BX.SocNetLogDestination.popupSearchWindow.popupContainer,"calendar-resbook-socnet-dest-popup-hide")}};C.prototype.closeDialogCallback=function(){C.superclass.closeDialogCallback.apply(this,arguments);this.closeDialogDelayFlag=true;setTimeout(BX.delegate(function(){this.closeDialogDelayFlag=false},this),10);if(this.popupContent){BX.removeClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap");BX.removeClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap-show");BX.removeClass(this.popupContent,this.finalShowClassName)}}})();
//# sourceMappingURL=resourcebooking-webform-settings.map.js