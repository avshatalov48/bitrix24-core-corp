(function(e){function t(e,t){if(!e){e={}}this.config=e;this.id=e.id;this.userId=e.userId||BX.message("USER_ID");this.shown=false;this.built=false;this.dayLength=864e5;this.shownScaleTimeFrom=24;this.shownScaleTimeTo=0;this.timelineCellWidthOrig=false;this.proposeTimeLimit=60;this.expandTimelineDelay=600;this.limitScaleSizeMode=false;this.globalAnimation=true;this.checkTimeCache={};this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));else this.TIME_FORMAT=BX.date.convertBitrixFormat(this.bAMPM?"H:MI:SS T":"HH:MI:SS");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.SCALE_TIME_FORMAT=BX.isAmPmMode()?"g a":"G";this.entryStatusMap={h:"user-status-h",y:"user-status-y",q:"user-status-q",n:"user-status-n"};this.SetConfig(e);this.SetLoadedDataLimits(this.scaleDateFrom,this.scaleDateTo);BX.addCustomEvent("OnCalendarPlannerDoUpdate",BX.proxy(this.DoUpdate,this));BX.addCustomEvent("OnCalendarPlannerDoExpand",BX.proxy(this.DoExpand,this));BX.addCustomEvent("OnCalendarPlannerDoResize",BX.proxy(this.DoResize,this));BX.addCustomEvent("OnCalendarPlannerDoSetConfig",BX.proxy(this.DoSetConfig,this));BX.addCustomEvent("OnCalendarPlannerDoUninstall",BX.proxy(this.DoUninstall,this));if(t){t.plannerId=this.id;if(t.selector){if(t.selector.from&&!t.selector.from.getTime){t.selector.from=BX.parseDate(t.selector.from)}if(t.selector.to&&!t.selector.to.getTime){t.selector.to=BX.parseDate(t.selector.to)}}this.globalAnimation=false;this.DoUpdate(t);setTimeout(BX.delegate((function(){this.globalAnimation=true}),this),2e3)}}t.prototype={Show:function(e){if(!this.compactMode||this.globalAnimation===false)e=false;if(this.hideAnimation){this.hideAnimation.stop();this.hideAnimation=null}this.outerWrap=BX(this.id);if(!this.outerWrap)return;if(!this.built){this.build();this.BindEventHandlers()}else{this.ResizePlannerWidth(this.width)}this.HideSelector();this.BuildTimeline();if(this.adjustWidth){this.ResizePlannerWidth(this.timelineInnerWrap.offsetWidth)}this.outerWrap.style.display="";if(this.readonly)BX.addClass(this.mainContWrap,"calendar-planner-readonly");else BX.removeClass(this.mainContWrap,"calendar-planner-readonly");if(this.compactMode)BX.addClass(this.mainContWrap,"calendar-planner-compact");else BX.removeClass(this.mainContWrap,"calendar-planner-compact");this.entriesListOuterWrap.style.display=this.compactMode?"none":"";if(e){var t=this;if(this.showAnimation){this.showAnimation.stop();this.showAnimation=null}this.showAnimation=new BX.easing({duration:300,start:{height:0},finish:{height:this.height},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){t.outerWrap.style.height=e.height+"px"},complete:BX.proxy((function(){if(parseInt(t.outerWrap.style.height)<t.height)t.outerWrap.style.height=this.height+"px";this.showAnimation=null}),this)});this.showAnimation.animate()}else{if(parseInt(this.outerWrap.style.height)<this.height)this.outerWrap.style.height=this.height+"px";this.AdjustPlannerHeight()}this.shown=true},Hide:function(e){if(this.showAnimation){this.showAnimation.stop();this.showAnimation=null}if(this.shown){this.shown=false;if(e){if(this.hideAnimation){this.hideAnimation.stop();this.hideAnimation=null}var t=this;this.hideAnimation=new BX.easing({duration:300,start:{height:this.height},finish:{height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){t.outerWrap.style.height=e.height+"px"},complete:BX.proxy((function(){this.hideAnimation=null;this.Hide(false)}),this)});this.hideAnimation.animate()}else{this.outerWrap.style.display="none";if(this.timelineScaleCont)BX.cleanNode(this.timelineScaleCont);this.timelineInnerWrap.removeAttribute("style");this.outerWrap.removeAttribute("style");this.mainContWrap.removeAttribute("style");this.entriesListOuterWrap.removeAttribute("style")}}},SetConfig:function(e){if(e.scaleType&&{"15min":1,"30min":1,"1hour":1,"2hour":1,"1day":1}[e.scaleType]){this.scaleType=e.scaleType}if(!this.scaleType){this.scaleType="1hour"}this.SetScaleType(this.scaleType);if(e.showTimelineDayTitle!==undefined)this.showTimelineDayTitle=!!e.showTimelineDayTitle;else if(this.showTimelineDayTitle===undefined)this.showTimelineDayTitle=true;if(e.compactMode!==undefined)this.compactMode=!!e.compactMode;else if(this.compactMode===undefined)this.compactMode=false;if(e.readonly!==undefined)this.readonly=!!e.readonly;else if(this.readonly===undefined)this.readonly=false;if(this.compactMode){var t=50;if(this.showTimelineDayTitle&&this.scaleType!="1day")t+=20;this.height=this.minHeight=t}if(e.selectEntriesMode!==undefined)this.selectMode=!!e.selectEntriesMode;else if(this.selectMode===undefined)this.selectMode=false;this.scaleLimitOffsetLeft=parseInt(e.scaleLimitOffsetLeft)||this.scaleLimitOffsetLeft||3;this.scaleLimitOffsetRight=parseInt(e.scaleLimitOffsetRight)||this.scaleLimitOffsetRight||5;this.maxTimelineSize=parseInt(e.maxTimelineSize)||this.maxTimelineSize||20;this.minEntryRows=parseInt(e.minEntryRows)||this.minEntryRows||3;this.maxEntryRows=parseInt(e.maxEntryRows)||this.maxEntryRows||30;this.width=parseInt(e.width)||this.width||700;this.height=parseInt(e.height)||this.height||84;this.minWidth=parseInt(e.minWidth)||this.minWidth||700;this.minHeight=parseInt(e.minHeight)||this.minHeight||84;if(this.width<this.minWidth)this.width=this.minWidth;if(this.height<this.minHeight)this.height=this.minHeight;this.workTime=e.workTime||this.workTime||[9,18];this.ExtendScaleTime(this.workTime[0],this.workTime[1]);this.weekHolidays=e.weekHolidays||this.weekHolidays||[];this.yearHolidays=e.yearHolidays||this.yearHolidays||[];this.accuracy=e.accuracy||this.accuracy||300;this.clickSelectorScaleAccuracy=e.clickSelectorScaleAccuracy||this.accuracy;this.selectorAccuracy=parseInt(e.selectorAccuracy)||this.selectorAccuracy||300;this.entriesListWidth=parseInt(e.entriesListWidth)||this.entriesListWidth||200;this.timelineCellWidth=e.timelineCellWidth||this.timelineCellWidth||40;this.showEntiesHeader=e.showEntiesHeader===undefined?true:!!e.showEntiesHeader;this.showEntryName=e.showEntryName===undefined?true:!!e.showEntryName;if(this.scaleType=="1day"&&this.timelineCellWidth<100){this.timelineCellWidthOrig=this.timelineCellWidth;this.timelineCellWidth=100}else if(this.timelineCellWidthOrig&&this.scaleType!="1day"){this.timelineCellWidth=this.timelineCellWidthOrig;this.timelineCellWidthOrig=false}if(this.adjustCellWidth===undefined||e.adjustCellWidth!==undefined)this.adjustCellWidth=this.readonly&&this.compactMode&&e.adjustCellWidth!==false;this.AdjustCellWidth();if(e.scaleDateFrom!==undefined){this.scaleDateFrom=typeof e.scaleDateFrom=="string"?BX.parseDate(e.scaleDateFrom):e.scaleDateFrom}else if(!this.scaleDateFrom){if(this.compactMode&&this.readonly){this.scaleDateFrom=new Date}else{this.scaleDateFrom=new Date((new Date).getTime()-this.dayLength*this.scaleLimitOffsetLeft)}}this.scaleDateFrom.setHours(this.scaleType=="1day"?0:this.shownScaleTimeFrom,0,0,0);if(e.scaleDateTo!==undefined){this.scaleDateTo=BX.type.isString(e.scaleDateTo)?BX.parseDate(e.scaleDateTo):e.scaleDateTo}else if(!this.scaleDateTo){if(this.compactMode&&this.readonly){this.scaleDateTo=new Date}else{this.scaleDateTo=new Date((new Date).getTime()+this.dayLength*this.scaleLimitOffsetRight)}}this.scaleDateTo.setHours(this.scaleType==="1day"?0:this.shownScaleTimeTo,0,0,0)},SetLoadedDataLimits:function(e,t){if(e)this.loadedDataFrom=e.getTime?e:BX.parseDate(e);if(t)this.loadedDataTo=t.getTime?t:BX.parseDate(t)},ExtendScaleTime:function(e,t){if(e!==false&&!isNaN(parseInt(e))){this.shownScaleTimeFrom=Math.min(parseInt(e),this.shownScaleTimeFrom,23);this.shownScaleTimeFrom=Math.max(this.shownScaleTimeFrom,0);if(this.scaleDateFrom)this.scaleDateFrom.setHours(this.shownScaleTimeFrom,0,0,0)}if(t!==false&&!isNaN(parseInt(t))){this.shownScaleTimeTo=Math.max(parseInt(t),this.shownScaleTimeTo,1);this.shownScaleTimeTo=Math.min(this.shownScaleTimeTo,24);if(this.scaleDateTo)this.scaleDateTo.setHours(this.shownScaleTimeTo,0,0,0)}this.checkSelectorPosition=this.shownScaleTimeFrom!==0||this.shownScaleTimeTo!==24},AdjustCellWidth:function(){if(this.adjustCellWidth){this.timelineCellWidth=Math.round(this.width/((this.shownScaleTimeTo-this.shownScaleTimeFrom)*3600/this.scaleSize))}},build:function(){this.outerWrap.style.width=this.width+"px";var e=this.compactMode?0:this.entriesListWidth;this.mainContWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-main-container calendar-planner-main-container-resource"},style:{minHeight:this.minHeight+"px",height:this.height+"px",width:this.width+"px"}}));if(!this.showEntryName){BX.addClass(this.mainContWrap,"calendar-planner-entry-icons-only")}if(this.readonly){BX.addClass(this.mainContWrap,"calendar-planner-readonly")}this.entriesListOuterWrap=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user-container"},style:{width:e+"px",height:this.height+"px"}}));this.PreventSelection(this.entriesListOuterWrap);if(this.compactMode){BX.addClass(this.mainContWrap,"calendar-planner-compact");this.entriesListOuterWrap.style.display="none"}if(this.scaleType==="1day"){BX.addClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}else{BX.removeClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}if(this.showEntiesHeader!==false){this.entriesListHeader=this.entriesListOuterWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-header"}})).appendChild(BX.create("DIV",{props:{className:"calendar-planner-general-info"}})).appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-header"}}));this.entriesListTitleCounter=this.entriesListHeader.appendChild(BX.create("span",{props:{className:"calendar-planner-users-item"},text:BX.message("EC_PL_ATTENDEES_TITLE")+" "})).appendChild(BX.create("span"))}this.entriesListWrap=this.entriesListOuterWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user-container-inner"}}));this.timelineFixedWrap=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-wrapper"},style:{height:this.height+"px"}}));this.timelineInnerWrap=this.timelineFixedWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-inner-wrapper"}}));this.timelineInnerWrap.setAttribute("data-bx-planner-meta","timeline");this.timelineScaleCont=this.timelineInnerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time"}}));this.PreventSelection(this.timelineScaleCont);this.timelineDataCont=this.timelineInnerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-container"},style:{height:this.height+"px"}}));this.accessibilityWrap=this.timelineDataCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-acc-wrap"}}));this.selector=this.buildSelector();this.selectorTitle=this.selector.selectorTitle;this.selectorProposeIcon=this.selector.selectorProposeIcon;if(this.selectMode){this.selectedEntriesWrap=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-select-entries-wrap"}}));this.hoverRow=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-hover-row"},style:{top:0,width:parseInt(this.mainContWrap.offsetWidth)+"px"}}));BX.unbind(document,"mousemove",BX.proxy(this.mouseMoveHandler,this));BX.bind(document,"mousemove",BX.proxy(this.mouseMoveHandler,this))}if(!this.compactMode){this.settingsButton=this.mainContWrap.appendChild(BX.create("div",{props:{className:"calendar-planner-settings-icon-container",title:BX.message("EC_PL_SETTINGS_SCALE")},html:'<span class="calendar-planner-settings-title">'+BX.message("EC_PL_SETTINGS_SCALE")+'</span><span class="calendar-planner-settings-icon"></span>'}));BX.bind(this.settingsButton,"click",BX.proxy(this.ShowSettingsPopup,this))}this.built=true},buildSelector:function(){var e,t=this.timelineDataCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-selector"},html:'<span data-bx-planner-meta="selector-resize-left" class="calendar-planner-timeline-drag-left"></span><span class="calendar-planner-timeline-selector-grip"></span><span data-bx-planner-meta="selector-resize-right" class="calendar-planner-timeline-drag-right"></span>'}));t.setAttribute("data-bx-planner-meta","selector");t.ondrag=BX.False;t.ondragstart=BX.False;var i=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-selector-notice"},style:{display:"none"}}));e={wrap:t,selectorTitle:i};if(this.selectMode){e.controlWrap=t.appendChild(BX.create("DIV",{props:{className:"calendar-planner-selector-control"}}))}return e},BuildTimeline:function(){if(this.timelineScaleCont){BX.cleanNode(this.timelineScaleCont)}this.GetScaleData();var e,t,i=this.timelineScaleCont;for(var s=0;s<this.scaleData.length;s++){if(this.showTimelineDayTitle&&this.scaleType!=="1day"){if(this.scaleDayTitles[this.scaleData[s].daystamp]){i=this.scaleDayTitles[this.scaleData[s].daystamp]}else{e=this.timelineScaleCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day-outer"}}));t=e.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day-title"},html:"<span>"+BX.date.format("d F, l",this.scaleData[s].timestamp/1e3)+"</span>"+'<div class="calendar-planner-time-day-border"></div>'}));i=e.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day"}}));this.scaleDayTitles[this.scaleData[s].daystamp]=i}}var a="calendar-planner-time-hour-item"+(this.scaleData[s].dayStart?" calendar-planner-day-start":"");if((this.scaleType=="15min"||this.scaleType=="30min")&&this.scaleData[s].title!==""){a+=" calendar-planner-time-hour-bold"}this.scaleData[s].cell=i.appendChild(BX.create("DIV",{props:{className:a},style:{width:this.timelineCellWidth+"px",minWidth:this.timelineCellWidth+"px"},html:this.scaleData[s].title!=""?"<i>"+this.scaleData[s].title+"</i>":this.scaleData[s].title}));if(this.scaleType!=="1day"&&this.scaleData[s+1]&&this.scaleData[s+1].dayStart){i.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-border"}}))}}var r=this.MapDatePos();this.datePosMap=r.datePosMap;this.posDateMap=r.posDateMap;var n=this.timelineScaleCont.offsetWidth;this.timelineInnerWrap.style.width=n+"px";this.entriesListWrap.style.top=parseInt(this.timelineDataCont.offsetTop)+10+"px";this.CheckRebuildTimeout(n)},CheckRebuildTimeout:function(e,t){var i=this;if(!t)t=200;if(!this._checkRebuildTimeoutCount)this._checkRebuildTimeoutCount=0;if(this.rebuildTimeout)this.rebuildTimeout=!!clearTimeout(this.rebuildTimeout);if(this._checkRebuildTimeoutCount<=5){this._checkRebuildTimeoutCount++;this.rebuildTimeout=setTimeout((function(){if(e!==i.timelineScaleCont.offsetWidth){if(i.rebuildTimeout)i.rebuildTimeout=!!clearTimeout(i.rebuildTimeout);i.RebuildPlanner();i.FocusSelector(true,200)}else{i.CheckRebuildTimeout(e,t)}}),t)}else{delete this._checkRebuildTimeoutCount}},RebuildPlanner:function(e){if(!e||typeof e!="object")e={};this.BuildTimeline();this.ClearAccessibilityData();this.UpdateData({accessibility:this.accessibility,entries:this.entries});this.AdjustPlannerHeight();this.ResizePlannerWidth(this.width);if(e.updateSelector!==false){this.UpdateSelector(e.selectorParams||false)}this.clearCacheTime()},GetScaleData:function(){this.scaleData=[];this.scaleDayTitles={};var e,t,i,s,a,r,n=false,l=this.scaleType==="1day"?0:parseInt(this.shownScaleTimeFrom),o=this.scaleType==="1day"?0:parseInt(this.shownScaleTimeTo);this.scaleDateFrom.setHours(l,0,0,0);this.scaleDateTo.setHours(o,0,0,0);t=this.scaleDateFrom.getTime();i=this.scaleDateTo.getTime();for(e=t;e<i;e+=this.scaleSize*1e3){s=parseFloat(BX.date.format("H.i",e/1e3));if(this.scaleType=="1day")r=BX.date.format("d F, D",e/1e3);else r=BX.date.format("i",e/1e3)=="00"?BX.date.format(this.SCALE_TIME_FORMAT,e/1e3):"";if(this.scaleType=="1day"||s>=l&&s<o){a=BX.date.format("d.m.Y",e/1e3);this.scaleData.push({daystamp:a,timestamp:e,value:e,title:r,dayStart:n!==a});n=a}}return this.scaleData},UpdateData:function(e){if(!e.accessibility){e.accessibility={}}this.accessibility=e.accessibility;this.entries=e.entries;var t,i,s,a,r=this.userId;if(this.compactMode){var n=[];for(i in e.accessibility){if(e.accessibility.hasOwnProperty(i)&&e.accessibility[i]&&e.accessibility[i].length>0){for(t=0;t<e.accessibility[i].length;t++){n.push(this.HandleAccessibilityEntry(e.accessibility[i][t]))}}}this.compactRowWrap=this.accessibilityWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-space"},style:{}}));this.currentData=[n];for(t=0;t<n.length;t++){this.DisplayAccessibilityEntry(n[t],this.compactRowWrap)}}else{if(e.entries&&e.entries.length){e.entries.sort((function(e,t){if(t.status==="h"||t.id==r&&e.status!=="h"){return 1}if(e.status==="h"||e.id==r&&t.status!=="h"){return-1}return 0}));if(this.selectedEntriesWrap){BX.cleanNode(this.selectedEntriesWrap);if(this.selector&&this.selector.controlWrap){BX.cleanNode(this.selector.controlWrap)}}var l=[],o=0,h=0,c=0,d=[];for(t=0;t<e.entries.length;t++){s=e.entries[t];a=e.accessibility[s.id]||[];s.uid=this.getEntryUniqueId(s);if(s.type==="user")o++;if(this.minEntryRows&&(t<this.minEntryRows||e.entries.length===this.minEntryRows+1)){c++;this.displayEntryRow(s,a)}else{h++;d.push(s.name);if(a.length>0){for(i=0;i<a.length;i++){l.push(this.HandleAccessibilityEntry(a[i]))}}}}if(this.entriesListTitleCounter){this.entriesListTitleCounter.innerHTML=o>this.maxEntryRows?"("+o+")":""}if(h>0){if(c===this.maxEntryRows){this.displayEntryRow({name:BX.message("EC_PL_ATTENDEES_LAST")+" ("+h+")",type:"lastUsers",title:d.join(", ")},l)}else{this.displayEntryRow({name:BX.message("EC_PL_ATTENDEES_SHOW_MORE")+" ("+h+")",type:"moreLink"},l)}}}}this.AdjustPlannerHeight();BX.onCustomEvent("OnCalendarPlannerUpdated",[this,{plannerId:this.id,entries:this.entries}])},ClearAccessibilityData:function(){BX.cleanNode(this.entriesListWrap);BX.cleanNode(this.accessibilityWrap)},HandleAccessibilityEntry:function(e){if(!e.from){e.from=BX.parseDate(e.dateFrom);e.from.setSeconds(0,0);e.fromTimestamp=e.from.getTime()}if(!e.to){e.to=BX.parseDate(e.dateTo);e.to.setSeconds(0,0);e.toTimestamp=e.to.getTime()}if(!e.toReal){if((e.toTimestamp-e.fromTimestamp)%this.dayLength===0&&BX.date.format("H:i",e.toTimestamp/1e3)==="00:00"){e.toReal=new Date(e.to.getTime()+this.dayLength);e.toReal.setSeconds(0,0);e.toTimestampReal=e.toReal.getTime()}else{e.toReal=e.to;e.toTimestampReal=e.toTimestamp}}return e},DisplayAccessibilityEntry:function(e,t){var i,s,a=false,r=e.fromTimestamp,n=e.toTimestampReal||e.toTimestamp,l=this.scaleType==="1day"?0:this.shownScaleTimeFrom,o=this.scaleType==="1day"?24:this.shownScaleTimeTo,h=new Date(r),c=new Date(n);i=parseInt(h.getHours())+h.getMinutes()/60;s=parseInt(c.getHours())+c.getMinutes()/60;if(i>o){h=new Date(h.getTime()+this.dayLength-1);h.setHours(l,0,0,0);if(h.getTime()>=c.getTime())a=true}if(!a&&i<l){h.setHours(l,0,0,0);if(h.getTime()>=c.getTime())a=true}if(!a&&s>o){c.setHours(o,0,0,0);if(h.getTime()>=c.getTime())a=true}if(!a&&s<l){c=new Date(c.getTime()-this.dayLength+1);c.setHours(o,0,0,0);if(h.getTime()>=c.getTime())a=true}if(!a){var d=this.GetPosByDate(h),p=this.GetPosByDate(c);e.node=t.appendChild(BX.create("DIV",{props:{className:"calendar-planner-acc-entry"+(e.type&&e.type==="hr"?" calendar-planner-acc-entry-hr":"")},style:{left:d+"px",width:Math.max(p-d,3)+"px"}}));if(e.title){e.node.title=e.title}}},displayEntryRow:function(e,t){if(e.type==="moreLink"){e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user"}}));if(this.showEntryName){this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users",title:e.title||""},text:e.name,events:{click:BX.proxy(this.ShowMoreUsers,this)}}))}else{this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-more",title:e.name},html:'<span class="calendar-planner-users-more-btn"></span>',events:{click:BX.proxy(this.ShowMoreUsers,this)}}))}}else if(e.type==="lastUsers"){e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user"}}));if(this.showEntryName){this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users calendar-planner-last-users",title:e.title||""},text:e.name}))}else{this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-more",title:e.title||e.name},html:'<span class="calendar-planner-users-last-btn"></span>'}))}}else if(e.id&&e.type==="user"){e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{attrs:{"data-bx-planner-entry":e.uid,className:"calendar-planner-user"+(e.emailUser?" calendar-planner-email-user":"")}}));if(e.status&&this.entryStatusMap[e.status]){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-status-icon "+this.entryStatusMap[e.status],title:BX.message("EC_PL_STATUS_"+e.status.toUpperCase())}}))}e.rowWrap.appendChild(this.getEntryAvatarNode(e));if(this.showEntryName){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-name"}})).appendChild(BX.create("span",{props:{className:"calendar-planner-entry-name"},attrs:{"bx-tooltip-user-id":e.id,"bx-tooltip-classname":"calendar-planner-user-tooltip"},style:{width:this.entriesListWidth-42+"px"},text:e.name}))}}else if(e.id&&e.type==="room"){e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user"}}));if(this.showEntryName){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-name"}})).appendChild(BX.create("A",{props:{href:e.url?e.url:"#",className:"calendar-planner-entry-name"},style:{width:this.entriesListWidth-20+"px"},text:e.name}))}else{e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-location-image-icon",title:e.name}}))}}else if(e.type==="resource"){if(!this.entriesResourceListWrap||!BX.isNodeInDom(this.entriesResourceListWrap)){this.entriesResourceListWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-container-resource"},html:'<div class="calendar-planner-resource-header"><span class="calendar-planner-users-item">'+BX.message("EC_PL_RESOURCE_TITLE")+"</span></div>"}))}e.rowWrap=this.entriesResourceListWrap.appendChild(BX.create("DIV",{attrs:{"data-bx-planner-entry":e.uid,className:"calendar-planner-user"}}));if(this.showEntryName){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-name"}})).appendChild(BX.create("span",{props:{className:"calendar-planner-entry-name"},style:{width:this.entriesListWidth-20+"px"},text:e.name}))}else{e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-location-image-icon",title:e.name}}))}}else{e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user"}}));e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users"},text:e.name}))}for(i=0;i<t.length;i++){t[i]=this.HandleAccessibilityEntry(t[i])}var i,s=e.rowWrap.offsetTop+13;e.dataRowWrap=this.accessibilityWrap.appendChild(BX.create("DIV",{attrs:{"data-bx-planner-entry":e.uid,className:"calendar-planner-timeline-space"},style:{top:s+"px"}}));for(i=0;i<t.length;i++){this.DisplayAccessibilityEntry(t[i],e.dataRowWrap)}if(this.selectMode){e.selectorControlWrap=this.selector.controlWrap.appendChild(BX.create("DIV",{attrs:{"data-bx-planner-entry":e.uid,className:"calendar-planner-selector-control-row"},style:{top:s-4+"px"}}));if(e.selected){this.selectEntryRow(e)}}},getEntryAvatarNode:function(e){var t;var i=e.avatar;if(!i||i==="/bitrix/images/1.gif"){let i="ui-icon-common-user";if(e.emailUser){i="ui-icon-common-user-mail"}if(e.sharingUser){i+=" ui-icon-common-user-sharing"}t=BX.create("DIV",{props:{className:"ui-icon calendar-planner-user-image-icon "+i},attrs:{"bx-tooltip-user-id":e.id,"bx-tooltip-classname":"calendar-planner-user-tooltip",title:BX.Text.encode(e.name)},html:"<i></i>"})}else{t=BX.create("DIV",{props:{className:"ui-icon calendar-planner-user-image-icon"},attrs:{"bx-tooltip-user-id":e.id,"bx-tooltip-classname":"calendar-planner-user-tooltip",title:BX.Text.encode(e.name)},html:"<i style=\"background-image: url('"+encodeURI(e.avatar)+"')\"></i>"})}return t},selectEntryRow:function(e){if(BX.type.isPlainObject(e)){var t=parseInt(e.dataRowWrap.offsetTop);if(!e.selectWrap||!BX.isParentForNode(this.selectedEntriesWrap,e.selectWrap)){e.selectWrap=this.selectedEntriesWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-selected"}}))}e.selectWrap.style.display="";e.selectWrap.style.top=t+36+"px";e.selectWrap.style.width=parseInt(this.mainContWrap.offsetWidth)+5+"px";BX.addClass(e.selectorControlWrap,"active");e.selected=true;this.clearCacheTime()}},isEntrySelected:function(e){return e&&e.selected},deSelectEntryRow:function(e){if(BX.type.isPlainObject(e)){if(e.selectWrap){e.selectWrap.style.display="none"}if(e.selectorControlWrap){BX.removeClass(e.selectorControlWrap,"active")}e.selected=false;this.clearCacheTime()}},getEntryUniqueId:function(e){return e.type+"-"+e.id},getEntryByUniqueId:function(e){if(BX.type.isArray(this.entries)){return this.entries.find((function(t){return t.uid==e}))}return null},UpdateSelector:function(e){if(!e)e={};e.updateScaleType=!!e.updateScaleType;e.updateScaleLimits=!!e.updateScaleLimits;e.animation=!!e.animation;var t=this,i=false,s,a,r;s=(e.from&&e.from.getTime?e.from:BX.parseDate(e.from))||this.currentSelectorDateFrom;a=(e.to&&e.to.getTime?e.to:BX.parseDate(e.to))||this.currentSelectorDateTo;r=e.fullDay!==undefined?e.fullDay:this.currentSelectorFullDay;if(a&&a.getTime()&&s&&s.getTime()){this.currentSelectorDateFrom=s;this.currentSelectorDateTo=a;this.currentSelectorFullDay=r;this.SetFullDayMode(r);if(r){a=new Date(a.getTime()+this.dayLength);s.setHours(0,0,0,0);a.setHours(0,0,0,0);if(this.scaleType!=="1day"){this.SetScaleType("1day");i=true}}if(e.updateScaleLimits&&this.scaleType!=="1day"){var n=parseInt(s.getHours())+Math.floor(s.getMinutes()/60);var l=parseInt(a.getHours())+Math.ceil(a.getMinutes()/60);if(this.FormatDate(s)!==this.FormatDate(a)){this.ExtendScaleTime(0,24);i=true}else{if(n<this.shownScaleTimeFrom){this.ExtendScaleTime(n,false);i=true}if(l>this.shownScaleTimeTo){this.ExtendScaleTime(false,l);i=true}if(i){this.AdjustCellWidth()}}}if(i){this.RebuildPlanner({updateSelector:false})}t.ShowSelector({dateFrom:s,dateTo:a,animation:e.animation,focus:e.focus})}},ShowSelector:function(e){var t=e.selector||this.selector.wrap,i=e.dateFrom,s=e.dateTo,a=e.animation&&this.globalAnimation!==false,r=e.focus;t.style.display="block";if(i&&s){var n=this.GetPosByDate(i),l=this.GetPosByDate(s);t.style.width=l-n+"px";if(this.fullDayMode)a=false;if(a&&t.style.left){this.TransitSelector({toX:n,triggerChangeEvents:false,focus:r===true})}else{t.style.left=n+"px";t.style.width=l-n+"px";if(r===true){this.FocusSelector(false,200,true)}this.CheckSelectorStatus(n)}}},HideSelector:function(){if(this.selector&&this.selector.wrap){this.selector.wrap.style.display="none"}},StartMovingSelector:function(){this.selectorIsDraged=true;this.selectorRoundedPos=false;this.selectorStartLeft=parseInt(this.selector.wrap.style.left);this.selectorStartScrollLeft=this.timelineFixedWrap.scrollLeft;if(this.currentSelectorInstances){for(var e=0;e<this.currentSelectorInstances.length;e++){this.currentSelectorInstances[e].selectorStartLeft=parseInt(this.currentSelectorInstances[e].selector.style.left)}}BX.addClass(document.body,"calendar-planner-unselectable")},MoveSelector:function(e){var t=parseInt(this.selector.wrap.style.width),i=this.selectorStartLeft+e;i-=this.selectorStartScrollLeft-this.timelineFixedWrap.scrollLeft;if(this.posDateMap[i]){this.selectorRoundedPos=i}else{var s=this.RoundPos(i);if(this.posDateMap[s]){this.selectorRoundedPos=s}}var a=this.CheckSelectorPosition(this.selectorRoundedPos);if(a!==this.selectorRoundedPos){this.selectorRoundedPos=a;i=a}this.selector.wrap.style.left=i+"px";this.ShowSelectorTitle({fromPos:i,toPos:this.selectorRoundedPos+t});if(this.currentSelectorInstances){var r,n,l=i-this.selectorStartLeft,o;for(r=0;r<this.currentSelectorInstances.length;r++){o=this.currentSelectorInstances[r].selector;n=this.currentSelectorInstances[r].selectorStartLeft+l;o.style.left=n+"px";this.ShowSelectorTitle({fromPos:n,toPos:n+t,selector:o,selectorTitle:this.currentSelectorInstances[r].selectorTitle})}}this.CheckSelectorStatus(this.selectorRoundedPos,true)},EndMovingSelector:function(){if(this.selectorRoundedPos){this.selector.wrap.style.left=this.selectorRoundedPos+"px";this.selectorRoundedPos=false;this.HideSelectorTitle();this.OnSelectorChanged(this.selectorRoundedPos);if(this.currentSelectorInstances){for(var e=0;e<this.currentSelectorInstances.length;e++){this.HideSelectorTitle({selectorTitle:this.currentSelectorInstances[e].selectorTitle,selectorIndex:e})}}}this.selectorIsDraged=false},StartResizeSelector:function(){this.selectorIsResized=true;this.selectorRoundedPos=false;this.selectorStartLeft=parseInt(this.selector.wrap.style.left);this.selectorStartWidth=parseInt(this.selector.wrap.style.width);this.selectorStartScrollLeft=this.timelineFixedWrap.scrollLeft;if(this.currentSelectorInstances){for(var e=0;e<this.currentSelectorInstances.length;e++){this.currentSelectorInstances[e].selectorStartLeft=parseInt(this.currentSelectorInstances[e].selector.style.left);this.currentSelectorInstances[e].selectorStartWidth=parseInt(this.currentSelectorInstances[e].selector.style.width)}}},ResizeSelector:function(e){var t,i,s=this.selectorStartWidth+e;s-=this.selectorStartScrollLeft-this.timelineFixedWrap.scrollLeft;var a=this.selectorStartLeft+s;if(a>parseInt(this.timelineInnerWrap.style.width))a=parseInt(this.timelineInnerWrap.style.width);t=this.GetDateByPos(a,true);if(this.fullDayMode){i=parseInt(t.getHours())+Math.round(t.getMinutes()/60*10)/10;t.setHours(0,0,0,0);if(i>12){t=new Date(t.getTime()+this.dayLength);t.setHours(0,0,0,0)}a=this.GetPosByDate(t);s=a-this.selectorStartLeft;if(s<=10){t=this.GetDateByPos(this.selectorStartLeft);t=new Date(t.getTime()+this.dayLength);t.setHours(0,0,0,0);s=this.GetPosByDate(t)-this.selectorStartLeft;a=this.selectorStartLeft+s}}else if(this.shownScaleTimeFrom!=0||this.shownScaleTimeTo!=24){var r=this.GetDateByPos(this.selectorStartLeft);if(t&&r&&this.FormatDate(r)!=this.FormatDate(t)){t=new Date(r.getTime());t.setHours(this.shownScaleTimeTo,0,0,0);a=this.GetPosByDate(t);s=a-this.selectorStartLeft}}if(this.posDateMap[a]){this.selectorRoundedRightPos=a}else{var n=this.RoundPos(a);if(this.posDateMap[n]){this.selectorRoundedRightPos=n}}this.selector.wrap.style.width=s+"px";this.ShowSelectorTitle({fromPos:this.selectorStartLeft,toPos:this.selectorRoundedRightPos});if(this.currentSelectorInstances){var l,o,h;for(l=0;l<this.currentSelectorInstances.length;l++){h=this.currentSelectorInstances[l].selector;o=this.currentSelectorInstances[l].selectorStartLeft;h.style.width=s+"px";this.ShowSelectorTitle({fromPos:o,toPos:o+s,selector:h,selectorTitle:this.currentSelectorInstances[l].selectorTitle})}}this.CheckSelectorStatus(this.selectorStartLeft,true)},EndResizeSelector:function(){if(this.selectorRoundedRightPos){this.selector.wrap.style.width=this.selectorRoundedPos-parseInt(this.selector.wrap.style.left)+"px";this.selectorRoundedRightPos=false;this.HideSelectorTitle();this.OnSelectorChanged();if(this.currentSelectorInstances){for(var e=0;e<this.currentSelectorInstances.length;e++){this.HideSelectorTitle({selectorTitle:this.currentSelectorInstances[e].selectorTitle,selectorIndex:e})}}}this.selectorIsResized=false},CheckSelectorStatus:function(e,t){t=t===true;if(this.config.useSolidBlueSelector){BX.removeClass(this.selector.wrap,"calendar-planner-timeline-selector-warning");BX.removeClass(this.mainContWrap,"calendar-planner-selector-warning");BX.addClass(this.selector.wrap,"solid")}else{if(!e){e=this.RoundPos(this.selector.wrap.style.left)}var i,s,a,r,n,l;if(t||!this.currentSelectorDateFrom){var o=parseInt(this.selector.wrap.style.width),h=parseInt(e),c=h+o;if(!h&&!c&&!o&&this.selector.lastFromDate){i=this.selector.lastFromDate;s=this.selector.lastToDate}else{i=this.GetDateByPos(h);s=this.GetDateByPos(c,true);this.selector.lastFromDate=i;this.selector.lastToDate=s}}else{i=this.currentSelectorDateFrom;s=this.currentSelectorDateTo}if(i&&s){r=this.checkTimePeriod(i,s)===true;if(this.currentSelectorInstances&&r){for(a=0;a<this.currentSelectorInstances.length;a++){e=this.RoundPos(this.currentSelectorInstances[a].selector.style.left);h=parseInt(e);c=h+o;n=this.GetDateByPos(h);l=this.GetDateByPos(c,true);n.setHours(i.getHours(),i.getMinutes(),0,0);l.setHours(s.getHours(),s.getMinutes(),0,0);r=this.checkTimePeriod(n,l)===true;if(!r){break}}}if(this.selectorIsFree!==r){this.selectorIsFree=r;if(this.selectorIsFree){BX.removeClass(this.selector.wrap,"calendar-planner-timeline-selector-warning");BX.removeClass(this.mainContWrap,"calendar-planner-selector-warning");if(this.currentSelectorInstances){for(a=0;a<this.currentSelectorInstances.length;a++){BX.removeClass(this.currentSelectorInstances[a].selector,"calendar-planner-timeline-selector-warning")}}this.HideProposeControl()}else{BX.addClass(this.selector.wrap,"calendar-planner-timeline-selector-warning");BX.addClass(this.mainContWrap,"calendar-planner-selector-warning");if(this.currentSelectorInstances){for(a=0;a<this.currentSelectorInstances.length;a++){BX.addClass(this.currentSelectorInstances[a].selector,"calendar-planner-timeline-selector-warning")}}this.ShowProposeControl()}BX.onCustomEvent("OnCalendarPlannerSelectorStatusOnChange",[{plannerId:this.id,status:this.selectorIsFree?"free":"busy"}])}}}},OnSelectorChanged:function(e,t){if(!e)e=parseInt(this.selector.wrap.style.left);if(e<0)e=0;if(!t)t=parseInt(this.selector.wrap.style.width);if(e+t>parseInt(this.timelineInnerWrap.style.width)){e=parseInt(this.timelineInnerWrap.style.width)-t}var i=this.GetDateByPos(e),s=this.GetDateByPos(e+t,true);if(i&&s){this.currentSelectorDateFrom=i;this.currentSelectorDateTo=s;if(this.fullDayMode){s=new Date(s.getTime()-this.dayLength)}this.currentSelectorFullDay=this.fullDayMode;BX.onCustomEvent("OnCalendarPlannerSelectorChanged",[{plannerId:this.id,dateFrom:i,dateTo:s,fullDay:this.fullDayMode,planner:this}])}},CheckSelectorPosition:function(e,t,i){if(this.checkSelectorPosition&&(this.scaleType!="1day"||this.fullDayMode)){if(!e)e=parseInt(this.selector.wrap.style.left);if(!t)t=parseInt(this.selector.wrap.style.width);if(!i)i=e+t;if(i>parseInt(this.timelineInnerWrap.style.width)){e=parseInt(this.timelineInnerWrap.style.width)-t}else{var s=this.GetDateByPos(e),a=this.GetDateByPos(i,true),r,n,l=parseInt(this.shownScaleTimeFrom),o=parseInt(this.shownScaleTimeTo);if(s&&a){if(this.fullDayMode){r=parseInt(s.getHours())+Math.round(s.getMinutes()/60*10)/10;s.setHours(0,0,0,0);if(r>12){s=new Date(s.getTime()+this.dayLength);s.setHours(0,0,0,0)}e=this.GetPosByDate(s)}else if(s.getDay()!=a.getDay()){r=parseInt(s.getHours())+Math.round(s.getMinutes()/60*10)/10;n=parseInt(a.getHours())+Math.round(a.getMinutes()/60*10)/10;if(Math.abs(o-r)>Math.abs(l-n)){s.setHours(this.shownScaleTimeTo,0,0,0);e=this.GetPosByDate(s)-t}else{a.setHours(this.shownScaleTimeFrom,0,0,0);e=this.GetPosByDate(a)}}}}}return e},TransitSelector:function(e){var t=e.fromX||false,i=e.toX||false,s=e.triggerChangeEvents!==false,a=e.focus;var r=this;i=this.RoundPos(i);if(!t)t=parseInt(this.selector.wrap.style.left);var n=parseInt(this.selector.wrap.offsetWidth);if(i>t+n&&s){i-=n}if(t!=i){if(this.animation){this.animation.stop()}this.animation=new BX.easing({duration:300,start:{left:t},finish:{left:i},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){r.selector.wrap.style.left=e.left+"px"},complete:BX.proxy((function(){this.animation=null;var e=parseInt(this.selector.wrap.style.left),t=this.CheckSelectorPosition(e);if(t!==e){this.selector.wrap.style.left=t+"px"}if(s){this.OnSelectorChanged(t)}setTimeout(BX.delegate((function(){this.ShowSelector({dateFrom:this.currentSelectorDateFrom,dateTo:this.currentSelectorDateTo,animation:false,focus:a===true})}),this),200);this.CheckSelectorStatus(t)}),this)});this.animation.animate()}else{if(s){this.OnSelectorChanged()}if(a===true){this.FocusSelector(true,300)}this.CheckSelectorStatus()}},ShowSelectorTitle:function(e){var t=e.fromPos,i=e.toPos,s=e.selectorTitle||this.selectorTitle,a=e.selectorTitle||this.selector.wrap,r=this,n,l;if(t&&i){if(i>parseInt(this.timelineInnerWrap.style.width)){t=parseInt(this.timelineInnerWrap.style.width)-parseInt(a.style.width);i=parseInt(this.timelineInnerWrap.style.width)}n=this.GetDateByPos(t);l=this.GetDateByPos(i,true);if(n&&l){if(this.fullDayMode){if(Math.abs(l.getTime()-n.getTime()-this.dayLength)<1e3){s.innerHTML=BX.date.format("d F, D",n.getTime()/1e3)}else{s.innerHTML=BX.date.format("d F",n.getTime()/1e3)+" - "+BX.date.format("d F",l.getTime()/1e3)}}else{s.removeAttribute("style");s.innerHTML=this.FormatTime(n)+" - "+this.FormatTime(l)}if(this.selectMode&&this.lastTouchedEntry){var o=this.compactMode?0:this.entriesListWidth,h=parseInt(a.style.left)-this.timelineFixedWrap.scrollLeft+o+parseInt(a.style.width)/2,c=parseInt(this.timelineDataCont.offsetTop)+parseInt(this.lastTouchedEntry.style.top)-12;s.style.top=c+"px";s.style.left=h+"px"}else{a.appendChild(s)}}}if(s==this.selectorTitle){if(s.style.display=="none"||this.selectorHideTimeout){this.selectorHideTimeout=clearTimeout(this.selectorHideTimeout);this.selectorTitle.style.display="";this.selectorTitle.style.opacity=0;new BX.easing({duration:400,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){r.selectorTitle.style.opacity=e.opacity/100},complete:function(){r.selectorTitle.removeAttribute("style")}}).animate()}}else{s.removeAttribute("style")}},HideSelectorTitle:function(e){if(!e||typeof e!=="object")e={};var t=e.selectorIndex===undefined?"selectorHideTimeout":"selectorHideTimeout_"+e.selectorIndex,i=e.selectorTitle||this.selectorTitle,s=this;if(this[t])this[t]=clearTimeout(this[t]);if(e.timeout!==false){this[t]=setTimeout((function(){e.timeout=false;s.HideSelectorTitle(e)}),700)}else{i.style.display="";i.style.opacity=1;new BX.easing({duration:400,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){i.style.opacity=e.opacity/100},complete:function(){i.removeAttribute("style");i.style.display="none"}}).animate()}},BindEventHandlers:function(){BX.bind(this.outerWrap,"click",BX.proxy(this.Click,this));BX.bind(this.outerWrap,"mousedown",BX.proxy(this.Mousedown,this));BX.bind(document,"mousemove",BX.proxy(this.MouseMove,this));BX.bind(document,"mouseup",BX.proxy(this.MouseUp,this));if("onwheel"in document)BX.bind(this.timelineFixedWrap,"wheel",BX.proxy(this.MousewheelTimelineHandler,this));else BX.bind(this.timelineFixedWrap,"mousewheel",BX.proxy(this.MousewheelTimelineHandler,this))},Click:function(t){if(!t){t=e.event}this.clickMousePos=this.GetMousePos(t);var i=t.target||t.srcElement,s=5;if(this.selectMode&&BX.hasClass(i,"calendar-planner-selector-control-row")){var a=this.getEntryByUniqueId(i.getAttribute("data-bx-planner-entry"));if(a){if(!this.isEntrySelected(a)){this.selectEntryRow(a)}else{this.deSelectEntryRow(a)}this.CheckSelectorStatus();BX.onCustomEvent("OnCalendarPlannerSelectedEntriesOnChange",[{plannerId:this.id,entries:this.entries}])}return}if(!this.readonly&&!this.currentSelectorInstances){var r=this.FindTarget(i,"timeline"),n=this.FindTarget(i,"selector");if(r&&!n&&Math.abs(this.clickMousePos.x-this.mouseDownMousePos.x)<s&&Math.abs(this.clickMousePos.y-this.mouseDownMousePos.y)<s){var l=this.clickMousePos.x-BX.pos(this.timelineFixedWrap).left+this.timelineFixedWrap.scrollLeft;if(this.clickSelectorScaleAccuracy!==this.accuracy){var o=this.MapDatePos(this.clickSelectorScaleAccuracy);var h=this.GetDateByPos(l,false,o.posDateMap);l=this.GetPosByDate(h)}this.TransitSelector({toX:l})}}},Mousedown:function(t){if(!t)t=e.event;var i=t.target||t.srcElement;this.mouseDownMousePos=this.GetMousePos(t);this.mouseDown=true;if(!this.readonly){var s=this.FindTarget(i,"selector");this.startMousePos=this.mouseDownMousePos;if(s){if(this.FindTarget(i,"selector-resize-right")){this.StartResizeSelector()}else{this.StartMovingSelector()}}else if(this.FindTarget(i,"timeline")){this.StartScrollTimeline()}}},MouseUp:function(){if(this.selectorIsDraged){this.EndMovingSelector()}if(this.selectorIsResized){this.EndResizeSelector()}if(this.timelineIsDraged){this.EndScrollTimeline()}if(this.shown&&!this.readonly&&this.mouseDown){this.CheckTimelineScroll()}this.mouseDown=false;BX.removeClass(document.body,"calendar-planner-unselectable")},MouseMove:function(e){var t,i=e.target||e.srcElement;if(this.selectMode&&i&&i.getAttribute&&i.getAttribute("data-bx-planner-entry")){this.lastTouchedEntry=i}if(this.selectorIsDraged){t=this.GetMousePos(e);this.MoveSelector(t.x-this.startMousePos.x)}if(this.selectorIsResized){t=this.GetMousePos(e);this.ResizeSelector(t.x-this.startMousePos.x)}if(this.timelineIsDraged){t=this.GetMousePos(e);this.ScrollTimeline(t.x-this.startMousePos.x)}},MousewheelTimelineHandler:function(t){t=t||e.event;if(this.shown&&!this.readonly){var i=t.deltaY||t.detail||t.wheelDelta;if(Math.abs(i)>0){if(!BX.browser.IsMac()){i=i*5}var s=this.timelineFixedWrap.scrollLeft+i;this.timelineFixedWrap.scrollLeft=Math.max(s,0);this.CheckTimelineScroll();return BX.PreventDefault(t)}}},CheckTimelineScroll:function(){var e=this.GelTimelineScrollOffset(),t=this.timelineFixedWrap.scrollWidth-this.timelineFixedWrap.offsetWidth-this.GelTimelineScrollOffset();if(this.timelineFixedWrap.offsetWidth>0){if(this.timelineFixedWrap.scrollLeft<=e){this.ExpandTimeline("left")}else if(this.timelineFixedWrap.scrollLeft>=t){this.ExpandTimeline("right")}}},StartScrollTimeline:function(){this.timelineIsDraged=true;this.timelineStartScrollLeft=this.timelineFixedWrap.scrollLeft},ScrollTimeline:function(e){this.timelineFixedWrap.scrollLeft=Math.max(this.timelineStartScrollLeft-e,0)},EndScrollTimeline:function(){this.timelineIsDraged=false},FindTarget:function(e,t,i){if(!i)i=this.mainContWrap;var s=e&&e.getAttribute?e.getAttribute("data-bx-planner-meta"):null;if(s!==t){if(e){e=BX.findParent(e,(function(e){return e.getAttribute&&e.getAttribute("data-bx-planner-meta")===t}),i)}else{e=null}}return e},GetMousePos:function(t){if(!t)t=e.event;var i=0,s=0;if(t.pageX||t.pageY){i=t.pageX;s=t.pageY}else if(t.clientX||t.clientY){i=t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;s=t.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}return{x:i,y:s}},FormatDate:function(e){return BX.date.format(this.DATE_FORMAT,e.getTime()/1e3)},FormatTime:function(e,t){var i=e&&typeof e==="object"?e.getTime():e;return BX.date.format(t===true?this.TIME_FORMAT:this.TIME_FORMAT_SHORT,i/1e3)},FormatDateTime:function(e){return BX.date.format(this.DATETIME_FORMAT,e.getTime()/1e3)},SetScaleType:function(e){this.scaleType=e;this.scaleSize=this.GetScaleSize(e);if(this.scaleType=="1day"&&this.timelineCellWidth<100){this.timelineCellWidthOrig=this.timelineCellWidth;this.timelineCellWidth=100}else if(this.timelineCellWidthOrig&&this.scaleType!="1day"){this.timelineCellWidth=this.timelineCellWidthOrig;this.timelineCellWidthOrig=false}if(this.scaleType=="1day"){BX.addClass(this.mainContWrap,"calendar-planner-fulldaymode");if(this.entriesListOuterWrap){BX.addClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}}else{BX.removeClass(this.mainContWrap,"calendar-planner-fulldaymode");if(this.entriesListOuterWrap){BX.removeClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}}},GetScaleSize:function(e){var t=3600,i={"15min":Math.round(t/4),"30min":Math.round(t/2),"1hour":t,"2hour":t*2,"1day":t*24};return i[e]||t},MapDatePos:function(e){if(!e){e=this.accuracy}var t={};var i={};var s,a,r,n,l,o,h;this.substeps=Math.round(this.scaleSize/e);this.posAccuracy=this.timelineCellWidth/this.substeps;e=e*1e3;var c=this.scaleData[1].timestamp-this.scaleData[0].timestamp;for(s=0;s<this.scaleData.length;s++){r=this.scaleData[s].timestamp;n=parseInt(this.scaleData[s].cell.offsetLeft);h=parseInt(this.scaleData[s].cell.offsetWidth);if(!t[r]){t[r]=n}i[n]=r;for(a=1;a<=h;a++){l=r+Math.round(a*c/h/e)*e;o=n+a;if(!t[r]){t[l]=o}i[o]=l;if(a==h&&(!this.scaleData[s+1]||this.scaleData[s+1].dayStart)){t[o+"_end"]=l}}}return{datePosMap:t,posDateMap:i}},GetPosByDate:function(e){var t=0;if(e&&typeof e!=="object"){e=BX.parseDate(e)}if(e&&typeof e==="object"){var i,s=0,a=e.getTime();for(i=0;i<this.scaleData.length;i++){if(a>=this.scaleData[i].timestamp){s=i}else{break}}if(this.scaleData[s]&&this.scaleData[s].cell){t=this.scaleData[s].cell.offsetLeft;var r=this.scaleData[s].cell.offsetWidth,n=Math.round((a-this.scaleData[s].timestamp)/1e3);if(n>0){t+=Math.round(n*10/this.scaleSize*r)/10}}}return t},GetDateByPos:function(e,t,i){if(!i){i=this.posDateMap}var s,a=t&&i[e+"_end"]?i[e+"_end"]:i[e];if(!a){e=Math.round(e);a=t&&i[e+"_end"]?i[e+"_end"]:i[e]}if(a){s=new Date(a)}return s},RoundPos:function(e){return Math.round(parseFloat(e))},ShowMoreUsers:function(){this.minEntryRows=this.maxEntryRows;this.ClearAccessibilityData();this.UpdateData({accessibility:this.accessibility,entries:this.entries})},AdjustPlannerHeight:function(){var e=this.entriesListWrap.offsetHeight+this.entriesListWrap.offsetTop+30,t=parseInt(this.outerWrap.style.height)||this.height;if(this.compactMode&&t<e||!this.compactMode){this.ResizePlannerHeight(e,Math.abs(e-t)>10)}},ResizePlannerHeight:function(e,t){this.height=e;if(t){if(this.resizeAnimation){this.resizeAnimation.stop();this.resizeAnimation=null}var i=parseInt(this.outerWrap.style.height),s=this;this.resizeAnimation=new BX.easing({duration:800,start:{height:i},finish:{height:e},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.ResizePlannerHeight(e.height,false)},complete:BX.proxy((function(){this.resizeAnimation=null}),this)});this.resizeAnimation.animate()}else{this.outerWrap.style.height=e+"px";this.mainContWrap.style.height=e+"px";this.timelineFixedWrap.style.height=e+"px";var a=this.entriesListWrap.offsetHeight+3;this.timelineDataCont.style.height=a+"px";this.selector.wrap.style.height=a+10+"px";this.entriesListOuterWrap.style.height=e+"px";if(this.proposeTimeButton&&this.proposeTimeButton.style.display!="none"){this.proposeTimeButton.style.top=this.timelineDataCont.offsetTop+a/2-16+"px"}}},ResizePlannerWidth:function(e,t){if(!t&&this.outerWrap&&this.mainContWrap){this.outerWrap.style.width=e+"px";var i=this.compactMode?0:this.entriesListWidth;this.mainContWrap.style.width=e+"px";this.entriesListOuterWrap.style.width=i+"px"}},ExpandFromCompactMode:function(){this.readonly=false;this.compactMode=false;this.showTimelineDayTitle=true;BX.removeClass(this.mainContWrap,"calendar-planner-readonly");BX.removeClass(this.mainContWrap,"calendar-planner-compact");this.entriesListOuterWrap.style.display="";if(this.scaleDateFrom&&this.scaleDateFrom.getTime)this.scaleDateFrom=new Date(this.scaleDateFrom.getTime()-this.dayLength*this.scaleLimitOffsetLeft);if(this.scaleDateTo&&this.scaleDateTo.getTime)this.scaleDateTo=new Date(this.scaleDateTo.getTime()+this.dayLength*this.scaleLimitOffsetRight);this.RebuildPlanner();this.FocusSelector(false,300)},FocusSelector:function(e,t,i){var s=this;i=i===true;if(this.focusSelectorTimeout)this.focusSelectorTimeout=!!clearTimeout(this.focusSelectorTimeout);if(this.globalAnimation===false)e=false;if(t){this.focusSelectorTimeout=setTimeout((function(){s.FocusSelector(e,false,i)}),t)}else{var a=parseInt(this.selector.wrap.style.left),r=parseInt(this.selector.wrap.style.width),n=10,l=this.timelineFixedWrap.offsetWidth,o=this.timelineFixedWrap.scrollLeft,h=o+l,c=o;if(a<o+n||a>h-n||i){if(r<=l){c=Math.max(Math.round(a-(l-r)/2),n)}else{c=Math.max(Math.round(a-n),n)}}if(c!=o){if(e===false){this.timelineFixedWrap.scrollLeft=c}else{new BX.easing({duration:300,start:{scrollLeft:this.timelineFixedWrap.scrollLeft},finish:{scrollLeft:c},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){s.timelineFixedWrap.scrollLeft=e.scrollLeft},complete:function(){}}).animate()}}}},ExpandTimeline:function(e,t,i,s){if(this.loadDataLock){this.lastExpandparams={direction:e,loadedDataFrom:t,loadedDataTo:i,focusSelector:s};return}this.lastExpandparams=false;var a,r=3,n=3,l,o=this;if(!t)t=this.loadedDataFrom||this.scaleDateFrom;if(!i)i=this.loadedDataTo||this.scaleDateTo;if(e=="left"){var h=new Date(this.scaleDateFrom.getTime());this.scaleDateFrom=t=new Date(t-this.dayLength*r);a=(this.scaleDateTo.getTime()-this.scaleDateFrom.getTime())/this.dayLength;if(a>this.maxTimelineSize){this.scaleDateTo=new Date(this.scaleDateFrom.getTime()+this.dayLength*this.maxTimelineSize);this.loadedDataFrom=this.scaleDateFrom;this.loadedDataTo=this.scaleDateTo;i=this.loadedDataTo;this.limitScaleSizeMode=true}this.RebuildPlanner();l=this.GetPosByDate(h)}else if(e=="right"){var c=this.scaleDateTo;l=o.timelineFixedWrap.scrollLeft;this.scaleDateTo=i=new Date(i.getTime()+this.dayLength*n);a=(this.scaleDateTo.getTime()-this.scaleDateFrom.getTime())/this.dayLength;if(a>this.maxTimelineSize){this.scaleDateFrom=new Date(this.scaleDateTo.getTime()-this.dayLength*this.maxTimelineSize);this.loadedDataFrom=this.scaleDateFrom;this.loadedDataTo=this.scaleDateTo;t=this.loadedDataFrom;l=this.GetPosByDate(c)-this.timelineFixedWrap.offsetWidth;setTimeout((function(){o.timelineFixedWrap.scrollLeft=o.GetPosByDate(c)-o.timelineFixedWrap.offsetWidth}),1);this.limitScaleSizeMode=true}this.scaleDateTo=i;this.RebuildPlanner()}else{t=new Date(t-this.dayLength*r);i=new Date(i.getTime()+this.dayLength*n);this.scaleDateFrom=t;this.scaleDateTo=i;this.RebuildPlanner()}if(l!==undefined)o.timelineFixedWrap.scrollLeft=l;var d,p,m=[];if(!BX.type.isArray(this.entries))this.entries=[];for(d=0;d<this.entries.length;d++){p=this.entries[d];m.push(p.id)}this.loadDataLock=true;BX.onCustomEvent("OnCalendarPlannerScaleChanged",[{from:this.FormatDate(t),to:this.FormatDate(i),entrieIds:m,entries:this.entries,focusSelector:s===true}])},GelTimelineScrollOffset:function(){return 10},DoUpdate:function(e){if(this.id===e.plannerId){var t=false;if(e.selector&&e.selector.fullDay){this.SetFullDayMode(e.selector.fullDay)}if(e.config){if(this.fullDayMode&&e.config.changeFromFullDay){e.config.scaleType=e.config.changeFromFullDay.scaleType;e.config.timelineCellWidth=e.config.changeFromFullDay.timelineCellWidth;delete e.config.changeFromFullDay}if(e.config.scaleDateFrom&&e.config.scaleDateFrom!==this.scaleDateFrom)t=true;if(!t&&e.config.scaleDateTo&&e.config.scaleDateTo!==this.scaleDateTo)t=true;if(!t&&e.config.scaleType&&e.config.scaleType!==this.scaleType)t=true;if(e.config.shownScaleTimeFrom&&e.config.shownScaleTimeFrom!==this.shownScaleTimeFrom){this.shownScaleTimeFrom=e.config.shownScaleTimeFrom;t=true}if(e.config.shownScaleTimeTo&&e.config.shownScaleTimeTo!==this.shownScaleTimeTo){this.shownScaleTimeTo=e.config.shownScaleTimeTo;t=true}this.SetConfig(e.config)}if(!this.shown&&e.show){this.Show(true)}else if(t){this.RebuildPlanner({updateSelector:false})}if(e.hide&&this.shown){this.Hide(e.hideAnimation!==false)}if(this.shown){if(e.data!==undefined&&e.data!==false){this.ClearAccessibilityData();this.UpdateData(e.data);this.SetLoadedDataLimits(e.loadedDataFrom,e.loadedDataTo)}if(e.selector!==undefined&&e.selector.from&&e.selector.to){e.selector.focus=e.focusSelector===true;e.selector.updateScaleType=false;if(e.selector.to.getTime()>this.loadedDataTo.getTime()&&!this.limitScaleSizeMode){this.ExpandTimeline("right",false,e.selector.to,true)}else if(e.selector.from.getTime()<this.loadedDataFrom.getTime()&&!this.limitScaleSizeMode){this.ExpandTimeline("left",e.selector.from,false,true)}else{if(!this.readonly){this.scaleDateFrom=this.loadedDataFrom;this.scaleDateTo=this.loadedDataTo}this.RebuildPlanner({updateSelector:true,selectorParams:e.selector})}}if(!this.compactMode&&this.loadedDataTo!==this.scaleDateTo){this.CheckTimelineScroll()}}if(e.params&&e.params.callback){e.params.callback()}if(this.expandTimeLineTimeout)this.expandTimeLineTimeout=!!clearTimeout(this.expandTimeLineTimeout);var i=this;this.expandTimeLineTimeout=setTimeout((function(){i.loadDataLock=false;if(i.lastExpandparams){var e=i.lastExpandparams;i.ExpandTimeline(e.direction,e.loadedDataFrom,e.loadedDataTo,e.focusSelector)}}),this.expandTimelineDelay);this.limitScaleSizeMode=false;BX.onCustomEvent("OnCalendarPlannerUpdated",[this,{plannerId:this.id,entries:this.entries}])}},DoExpand:function(e){if(this.id==e.plannerId){if(this.compactMode){if(e.config){this.SetConfig(e.config)}this.ExpandFromCompactMode()}}},DoSetConfig:function(e){if(this.id==e.plannerId&&e.config){this.SetConfig(e.config)}},DoResize:function(e){if(this.id==e.plannerId){var t=this;if(e.width)e.width=parseInt(e.width)||this.width;e.width=Math.max(e.width,this.minWidth);this.width=e.width;this.AdjustCellWidth();this.ResizePlannerWidth(e.width,false);if(this.resizeRebuildTimeout)this.resizeRebuildTimeout=clearTimeout(this.resizeRebuildTimeout);this.resizeRebuildTimeout=setTimeout((function(){t.RebuildPlanner()}),200)}},DoUninstall:function(e){if(e&&this.id==e.plannerId){BX.cleanNode(this.outerWrap,1);BX.removeCustomEvent("OnCalendarPlannerDoUpdate",BX.proxy(this.DoUpdate,this));BX.removeCustomEvent("OnCalendarPlannerDoExpand",BX.proxy(this.DoExpand,this));BX.removeCustomEvent("OnCalendarPlannerDoResize",BX.proxy(this.DoResize,this));BX.removeCustomEvent("OnCalendarPlannerDoSetConfig",BX.proxy(this.DoSetConfig,this));BX.removeCustomEvent("OnCalendarPlannerDoUninstall",BX.proxy(this.DoUninstall,this));if(this.settingsPopup){this.settingsPopup.close()}}},ProposeTime:function(e){if(!e||typeof e!=="object"||e.target)e={};var t=this,i,s,a=Math.round((this.currentSelectorDateTo-this.currentSelectorDateFrom)/1e3)*1e3,r=[],n,l;if(this.fullDayMode)a+=this.dayLength;i=Math.round(this.currentSelectorDateFrom.getTime()/(this.accuracy*1e3))*this.accuracy*1e3;s=new Date(i);s.setSeconds(0,0);i=s.getTime();for(n in this.accessibility){if(this.accessibility.hasOwnProperty(n)&&this.accessibility[n]&&this.accessibility[n].length>0){for(l=0;l<this.accessibility[n].length;l++){if(this.accessibility[n][l].toTimestampReal>=i)r.push(this.HandleAccessibilityEntry(this.accessibility[n][l]))}}}r.sort((function(e,t){return e.fromTimestamp-t.fromTimestamp}));var o=i,h,c,d,p,m;while(true){c=new Date(o);d=new Date(o+a);if(this.scaleType!=="1day"){m=parseInt(c.getHours())+c.getMinutes()/60;p=parseInt(d.getHours())+d.getMinutes()/60;if(m<=this.shownScaleTimeFrom){c.setHours(this.shownScaleTimeFrom,0,0,0);o=c.getTime();d=new Date(o+a)}if(p>=this.shownScaleTimeTo){c=new Date(o+this.dayLength-1e3);c.setHours(this.shownScaleTimeFrom,0,0,0);o=c.getTime();d=new Date(o+a)}}if(this.fullDayMode){c.setHours(0,0,0,0);d.setHours(0,0,0,0)}h=this.checkTimePeriod(c,d,r);if(h===true){if(d.getTime()>this.loadedDataTo.getTime()){if(d.getTime()-this.loadedDataTo.getTime()>this.proposeTimeLimit*this.dayLength||e.checkedFuture===true){this.ShowNoResultNotification()}else if(e.checkedFuture!==true){var u=this.timelineFixedWrap.scrollLeft;var f=new Date(this.loadedDataTo.getTime()+this.dayLength*this.proposeTimeLimit);this.scaleDateTo=f;this.RebuildPlanner();this.timelineFixedWrap.scrollLeft=u;var y,T=[];for(l=0;l<this.entries.length;l++){y=this.entries[l];T.push(y.id)}BX.onCustomEvent("OnCalendarPlannerScaleChanged",[{from:this.FormatDate(this.loadedDataFrom),to:this.FormatDate(f),entrieIds:T,entries:this.entries,focusSelector:true,params:{callback:function(){t.ProposeTime({checkedFuture:true})}}}])}}else{if(this.fullDayMode)d=new Date(d.getTime()-this.dayLength);this.UpdateSelector({from:c,to:d,updateScaleType:false,updateScaleLimits:true,animation:true,focus:true});BX.onCustomEvent("OnCalendarPlannerSelectorChanged",[{plannerId:this.id,dateFrom:c,dateTo:d,fullDay:this.fullDayMode}])}break}else if(h&&h.toTimestampReal){o=h.toTimestampReal;if(this.fullDayMode){var g=new Date(o+this.dayLength-1e3);g.setHours(0,0,0,0);o=g.getTime()}}}},checkTimePeriod:function(e,t,i){var s=true,a,r=e.getTime(),n=t.getTime(),l=r+"_"+n,o=60*1e3,h,c;if(BX.type.isArray(i)){for(c=0;c<i.length;c++){h=i[c];if(h.type&&h.type==="hr")continue;if(h.fromTimestamp+o<=n&&(h.toTimestampReal||h.toTimestamp)-o>=r){s=h;break}}}else if(BX.type.isArray(this.entries)){var d={},p=this.selectorAccuracy*1e3,m;if(this.checkTimeCache[l]!==undefined){s=this.checkTimeCache[l]}else{for(m in this.accessibility){if(this.accessibility.hasOwnProperty(m)){if(this.selectMode){a=this.entries.find((function(e){return parseInt(e.id)===parseInt(m)}));if(a&&!a.selected){continue}}d[m]=true;if(BX.type.isArray(this.accessibility[m])){for(c=0;c<this.accessibility[m].length;c++){h=this.accessibility[m][c];if(h.type&&h.type==="hr"){continue}if(h.fromTimestamp+p<=n&&(h.toTimestampReal||h.toTimestamp)-p>=r){d[m]=false;s=h;break}}}}}for(c=0;c<this.entries.length;c++){if(d[this.entries[c].id]!==undefined){this.entries[c].currentStatus=!!d[this.entries[c].id]}else{this.entries[c].currentStatus=true}}this.checkTimeCache[l]=s}}return s},clearCacheTime:function(){this.checkTimeCache={}},checkEntryTimePeriod:function(e,t,i){var s=[],a;if(e&&e.id&&BX.type.isArray(this.accessibility[e.id])){for(a=0;a<this.accessibility[e.id].length;a++){s.push(this.HandleAccessibilityEntry(this.accessibility[e.id][a]))}}return this.checkTimePeriod(t,i,s)===true},ShowSettingsPopup:function(){var e=this,t,i=["15min","30min","1hour","2hour","1day"],s=BX.create("DIV",{props:{className:"calendar-planner-settings-popup"}}),a=s.appendChild(BX.create("DIV",{props:{className:"calendar-planner-settings-row"},html:"<i>"+BX.message("EC_PL_SETTINGS_SCALE")+":</i>"})),r=a.appendChild(BX.create("span",{props:{className:"calendar-planner-option-container"}}));if(this.fullDayMode){a.title=BX.message("EC_PL_SETTINGS_SCALE_READONLY_TITLE");BX.addClass(a,"calendar-planner-option-container-disabled")}for(t=0;t<i.length;t++){r.appendChild(BX.create("span",{props:{className:"calendar-planner-option-tab"+(i[t]===this.scaleType?" calendar-planner-option-tab-active":"")},attrs:{"data-bx-planner-scale":i[t]},text:BX.message("EC_PL_SETTINGS_SCALE_"+i[t].toUpperCase())}))}var n=BX.PopupWindowManager.create(this.id+"-settings-popup",this.settingsButton,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:7,lightShadow:true,content:s,zIndex:4e3,angle:{postion:"top"}});n.show(true);BX.bind(r,"click",BX.proxy((function(e){if(!this.fullDayMode){var t=e.target||e.srcElement,i=t&&t.getAttribute&&t.getAttribute("data-bx-planner-scale");if(i){this.ChangeScaleType(i);n.close()}}}),this));function l(){if(n&&n.destroy){BX.removeCustomEvent(n,"onPopupClose",l);n.destroy();n=null;e.settingsPopup=null}}BX.addCustomEvent(n,"onPopupClose",l);this.settingsPopup=n},ChangeScaleType:function(e){if(e!==this.scaleType){this.SetScaleType(e);this.RebuildPlanner();this.FocusSelector(true,300)}},SetFullDayMode:function(e){this.fullDayMode=e},PreventSelection:function(e){e.ondrag=BX.False;e.ondragstart=BX.False;e.onselectstart=BX.False},ShowNoResultNotification:function(){alert(BX.message("EC_PL_PROPOSE_NO_RESULT"))},HandleRecursion:function(e){if(!e.instances)e.instances=[];var t=new Date;t.setFullYear(2016,6,2);t.setHours(0,0,0,0);e.instances.push({date:t});t=new Date;t.setFullYear(2016,6,3);t.setHours(0,0,0,0);e.instances.push({date:t});var i,s;for(i=0;i<e.instances.length;i++){s=this.buildSelector();e.instances[i].selector=s.wrap;e.instances[i].selectorTitle=s.selectorTitle;var a=new Date(e.instances[i].date.getTime());a.setHours(12,0,0,0);var r=new Date(e.instances[i].date.getTime());r.setHours(13,0,0,0);this.ShowSelector({selector:e.instances[i].selector,dateFrom:a,dateTo:r,focus:false,animation:false})}this.currentSelectorInstances=e.instances},ShowProposeControl:function(){if(!this.proposeTimeButton){this.proposeTimeButton=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-arrow-right"},html:'<span class="calendar-planner-time-arrow-right-text">'+BX.message("EC_PL_PROPOSE")+'</span><span class="calendar-planner-time-arrow-right-item"></span>'}));BX.bind(this.proposeTimeButton,"click",BX.proxy(this.ProposeTime,this))}this.proposeTimeButton.style.display="block";this.proposeTimeButton.style.top=this.timelineDataCont.offsetTop+this.timelineDataCont.offsetHeight/2-16+"px"},HideProposeControl:function(){if(this.proposeTimeButton)this.proposeTimeButton.style.display="none"},mouseMoveHandler:function(e){var t,i,s,a,r,n=this.mainContWrap,l=e.target||e.srcElement;s=l.getAttribute("data-bx-planner-entry");if(!s){a=BX.findParent(l,(function(e){if(e==n||e.getAttribute&&e.getAttribute("data-bx-planner-entry")){return true}}),n);if(a){s=l.getAttribute("data-bx-planner-entry")}else{BX.removeClass(this.hoverRow,"show");i=this.selector.controlWrap.querySelectorAll(".calendar-planner-selector-control-row.hover");for(t=0;t<i.length;t++){BX.removeClass(i[t],"hover")}r=this.getEntryByUniqueId(this.howerEntryId);if(r&&r.selectWrap){r.selectWrap.style.opacity=1}}}if(s){if(this.howerEntryId!==s){this.howerEntryId=s;var o=this.getEntryByUniqueId(s);if(o){var h=parseInt(o.dataRowWrap.offsetTop);BX.addClass(this.hoverRow,"show");this.hoverRow.style.top=h+36+"px";this.hoverRow.style.width=parseInt(this.mainContWrap.offsetWidth)+5+"px";if(o.selectorControlWrap){i=this.selector.controlWrap.querySelectorAll(".calendar-planner-selector-control-row.hover");for(t=0;t<i.length;t++){BX.removeClass(i[t],"hover")}BX.addClass(o.selectorControlWrap,"hover")}}}}}};e.CalendarPlanner=t;if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var i=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var s=arguments[1];var a=0;while(a<i){var r=t[a];if(e.call(s,r,a,t)){return r}a++}return undefined}})}})(window);
//# sourceMappingURL=planner.map.js