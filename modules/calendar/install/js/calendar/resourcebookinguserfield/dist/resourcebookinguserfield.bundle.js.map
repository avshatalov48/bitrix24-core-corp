{"version":3,"file":"resourcebookinguserfield.bundle.js","sources":["../src/formfieldtunnerabstract.js","../src/formfieldtunnerpopupabstract.js","../src/formfieldtunnervaluepopupabstract.js","../src/controls/userselectorfieldtunner.js","../src/controls/resourceselectorfieldtunner.js","../src/controls/serviceselectorfieldtunner.js","../src/controls/durationselectorfieldtunner.js","../src/controls/dateselectorfieldtunner.js","../src/controls/timeselectorfieldtunner.js","../src/adjustfieldcontroller.js","../src/controls/userselectorfieldeditcontrol.js","../src/controls/resourceselectorfieldeditcontrol.js","../src/controls/plannerpopup.js","../src/editfieldcontroller.js","../src/controls/serviceselector.js","../src/controls/timezoneselector.js","../src/controls/modeselector.js","../src/customizecrmentityeditor.js","../src/calendarviewsettingsslider.js","../src/adminsettingsviewer.js","../src/resourcebookinguserfield.js"],"sourcesContent":["import {Dom, Type} from \"calendar.resourcebooking\";\n\nexport class FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tthis.label = '';\n\t\tthis.formLabel = '';\n\t\tthis.displayed = false;\n\t\tthis.valuePopup = null;\n\t\tthis.statePopup = null;\n\t\tthis.displayCheckboxDisabled = false;\n\t\tthis.DOM = {};\n\t}\n\n\tbuild(params)\n\t{\n\t\tthis.updateConfig(params.params);\n\n\t\tthis.DOM.fieldWrap = Dom.create(\"div\", {props: {className: 'calendar-resbook-webform-settings-popup-item'}});\n\n\t\tthis.DOM.labelWrap = this.DOM.fieldWrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-settings-popup-field'}\n\t\t}));\n\t\tthis.DOM.labelNode = this.DOM.labelWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-settings-popup-field-title'}, text: this.getLabel()\n\t\t}));\n\n\t\t// Label in form\n\t\tthis.DOM.formTitleWrap = this.DOM.labelWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {\n\t\t\t\tclassName: 'calendar-resbook-webform-settings-popup-field-subtitle' + (this.isDisplayed() ? ' show' : '')\n\t\t\t}\n\t\t}));\n\t\tthis.DOM.formTitleLabel = this.DOM.formTitleWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-settings-popup-field-subtitle-text'},\n\t\t\ttext: this.getFormLabel(),\n\t\t\tevents: {click: this.enableFormTitleEditMode.bind(this)}\n\t\t}));\n\t\tthis.DOM.formTitleEditIcon = this.DOM.formTitleWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-settings-popup-field-edit'},\n\t\t\tevents: {click: this.enableFormTitleEditMode.bind(this)}\n\t\t}));\n\n\t\t// Display checkbox\n\t\tthis.DOM.checkboxNode = this.DOM.fieldWrap.appendChild(Dom.create(\"div\", {props: {className: 'calendar-resbook-webform-settings-popup-checkbox-container'}})).appendChild(Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"checkbox\", value: 'Y', checked: this.isDisplayed(), disabled: this.displayCheckboxDisabled\n\t\t\t}, events: {\n\t\t\t\tclick: this.checkDisplayMode.bind(this)\n\t\t\t}\n\t\t}));\n\n\t\t// State popup\n\t\tthis.buildStatePopup({\n\t\t\twrap: this.DOM.fieldWrap, config: params.config || {}\n\t\t});\n\n\t\t// Value popup\n\t\tthis.buildValuePopup({\n\t\t\twrap: this.DOM.fieldWrap,\n\t\t\tconfig: params.config || {}\n\t\t});\n\n\t\tif (Type.isFunction(params.changeSettingsCallback))\n\t\t{\n\t\t\tthis.changeSettingsCallback = params.changeSettingsCallback;\n\t\t}\n\n\t\tparams.wrap.appendChild(this.DOM.fieldWrap);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.valuePopup && Type.isFunction(this.valuePopup.closePopup))\n\t\t{\n\t\t\tthis.valuePopup.closePopup();\n\t\t}\n\t\tif (this.statePopup && Type.isFunction(this.statePopup.closePopup))\n\t\t{\n\t\t\tthis.statePopup.closePopup();\n\t\t}\n\t}\n\n\tupdateConfig(params = {})\n\t{\n\t\tthis.setFormLabel(params.label || this.formLabel);\n\t\tif (params.show)\n\t\t{\n\t\t\tthis.displayed = params.show !== 'N';\n\t\t}\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t}\n\n\tbuildValuePopup(params)\n\t{\n\t}\n\n\tgetLabel()\n\t{\n\t\treturn this.label;\n\t}\n\n\tgetFormLabel()\n\t{\n\t\treturn this.formLabel;\n\t}\n\n\tsetFormLabel(formLabel)\n\t{\n\t\tthis.formLabel = formLabel || '';\n\t}\n\n\tisDisplayed()\n\t{\n\t\treturn this.displayed;\n\t}\n\n\tcheckDisplayMode()\n\t{\n\t\tthis.displayed = !!this.DOM.checkboxNode.checked;\n\t\tif (this.displayed)\n\t\t{\n\t\t\tthis.displayInForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideInForm();\n\t\t}\n\t}\n\n\tdisplayInForm()\n\t{\n\t\tDom.addClass(this.DOM.formTitleWrap, 'show');\n\t\tthis.triggerChangeRefresh();\n\t}\n\n\thideInForm ()\n\t{\n\t\tDom.removeClass(this.DOM.formTitleWrap, 'show');\n\t\tthis.triggerChangeRefresh();\n\t}\n\n\tenableFormTitleEditMode()\n\t{\n\t\tif (!this.DOM.formTitleInputNode)\n\t\t{\n\t\t\tthis.DOM.formTitleInputNode = this.DOM.formTitleWrap.appendChild(Dom.create(\"input\", {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tclassName: 'calendar-resbook-webform-settings-popup-field-subtitle-text'\n\t\t\t\t},\n\t\t\t\tevents: {blur: this.finishFormTitleEditMode.bind(this)}\n\t\t\t}));\n\t\t}\n\n\t\tthis.DOM.formTitleInputNode.value = this.getFormLabel();\n\t\tthis.DOM.formTitleInputNode.style.display = '';\n\t\tthis.DOM.formTitleLabel.style.display = 'none';\n\t\tthis.DOM.formTitleEditIcon.style.display = 'none';\n\t\tthis.DOM.formTitleInputNode.focus();\n\t}\n\n\tfinishFormTitleEditMode()\n\t{\n\t\tthis.setFormLabel(this.DOM.formTitleInputNode.value);\n\t\tDom.adjust(this.DOM.formTitleLabel, {text: this.getFormLabel()});\n\t\tthis.DOM.formTitleLabel.style.display = '';\n\t\tthis.DOM.formTitleEditIcon.style.display = '';\n\t\tthis.DOM.formTitleInputNode.style.display = 'none';\n\t\tthis.triggerChangeRefresh();\n\t}\n\n\tgetSettingsValue()\n\t{\n\n\t}\n\n\ttriggerChangeRefresh()\n\t{\n\t\tsetTimeout(function(){BX.onCustomEvent('ResourceBooking.webformSettings:onChanged');}.bind(this), 50);\n\t}\n}\n\n\n\n\n","import {Dom, Event} from \"main.core\";\n\nexport class FormFieldTunnerPopupAbstract {\n\tconstructor(params)\n\t{\n\t\tthis.id = 'resourcebooking-settings-popup-' + Math.round(Math.random() * 100000);\n\t\tthis.menuItems = [];\n\t\tthis.DOM = {\n\t\t\touterWrap: params.wrap\n\t\t};\n\t\tthis.handleClickFunc = this.handleClick.bind(this);\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.innerWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props:{className:'calendar-resbook-webform-settings-popup-select'}}));\n\n\t\tthis.DOM.currentStateLink = this.DOM.innerWrap.appendChild(\n\t\t\tDom.create(\"span\",\n\t\t\t\t{\n\t\t\t\t\tprops : { className : 'calendar-resbook-webform-settings-popup-select-value'},\n\t\t\t\t\ttext: this.getCurrentModeState(),\n\t\t\t\t\tevents: {click: this.showPopup.bind(this)}\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.isPopupShown() || this.disabled)\n\t\t{\n\t\t\treturn this.closePopup();\n\t\t}\n\n\t\tthis.menuItems = this.getMenuItems();\n\n\t\tEvent.unbind(document, 'click', this.handleClickFunc);\n\t\tthis.popup = BX.PopupMenu.create(\n\t\t\tthis.id,\n\t\t\tthis.DOM.currentStateLink,\n\t\t\tthis.menuItems,\n\t\t\t{\n\t\t\t\tclassName: 'popup-window-resource-select',\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tcacheable: false\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.popupWindow.setAngle({offset: 30, position: 'top'});\n\t\tthis.popup.show(true);\n\t\tthis.popupContainer = this.popup.popupWindow.popupContainer;\n\n\t\t//this.popupContainer.style.width = parseInt(this.DOM.blocksWrap.offsetWidth) + 'px';\n\n\t\t// BX.addCustomEvent(this.popup.popupWindow, 'onPopupClose', function()\n\t\t// {\n\t\t// \tBX.PopupMenu.destroy(this.id);\n\t\t// \tthis.popup = null;\n\t\t// }.bind(this));\n\n\t\tthis.popup.menuItems.forEach(function(menuItem)\n\t\t{\n\t\t\tlet inputType = false, className, checked, inputNameStr = '';\n\t\t\tif (menuItem.dataset && menuItem.dataset.type)\n\t\t\t{\n\t\t\t\tchecked = menuItem.dataset.checked;\n\n\t\t\t\tlet menuItemClassName = 'menu-popup-item';\n\t\t\t\tif (menuItem.dataset.type === 'radio')\n\t\t\t\t{\n\t\t\t\t\tinputType = 'radio';\n\t\t\t\t\tclassName = 'menu-popup-item-resource-radio';\n\t\t\t\t\tif (menuItem.dataset.inputName)\n\t\t\t\t\t{\n\t\t\t\t\t\tinputNameStr = ' name=\"' + menuItem.dataset.inputName + '\" ';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (menuItem.dataset.type === 'checkbox')\n\t\t\t\t{\n\t\t\t\t\tinputType = 'checkbox';\n\t\t\t\t\tclassName = 'menu-popup-item-resource-checkbox';\n\t\t\t\t}\n\n\t\t\t\tlet innerHtml = '<div class=\"menu-popup-item-inner\">';\n\t\t\t\tif (menuItem.dataset.type === 'submenu-list')\n\t\t\t\t{\n\t\t\t\t\tmenuItemClassName += ' menu-popup-item-submenu';\n\t\t\t\t\tinnerHtml += '<div class=\"menu-popup-item-resource menu-popup-item-resource-wide\">' +\n\t\t\t\t\t\t'<span class=\"menu-popup-item-text\">' +\n\t\t\t\t\t\t'<span>' + menuItem.text + '</span>' +\n\t\t\t\t\t\t'<span class=\"menu-popup-item-resource-subvalue\">' + (menuItem.dataset.textValue || menuItem.dataset.value) + '</span>' +\n\t\t\t\t\t\t'</span>' +\n\t\t\t\t\t\t'</div>';\n\t\t\t\t}\n\t\t\t\telse if (inputType)\n\t\t\t\t{\n\t\t\t\t\tinnerHtml += '<div class=\"menu-popup-item-resource\">';\n\t\t\t\t\tif (inputType)\n\t\t\t\t\t{\n\t\t\t\t\t\tinnerHtml += '<input class=\"' + className + '\" type=\"' + inputType + '\"' + (checked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\" ' + inputNameStr + '>' +\n\t\t\t\t\t\t\t'<label class=\"menu-popup-item-text\"  for=\"' + menuItem.id + '\">' + menuItem.text + '</label>';\n\t\t\t\t\t}\n\t\t\t\t\tinnerHtml += '</div>';\n\t\t\t\t}\n\n\t\t\t\tinnerHtml += '</div>';\n\n\t\t\t\tmenuItem.layout.item.className = menuItemClassName;\n\t\t\t\tmenuItem.layout.item.innerHTML = innerHtml;\n\t\t\t}\n\t\t}, this);\n\n\t\tsetTimeout(()=>{Event.bind(document, 'click', this.handleClickFunc);}, 50);\n\t}\n\n\tclosePopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.popupContainer.style.maxHeight = '';\n\t\t}\n\t}\n\n\tisPopupShown()\n\t{\n\t\treturn this.popup && this.popup.popupWindow &&\n\t\t\tthis.popup.popupWindow.isShown && this.popup.popupWindow.isShown() &&\n\t\t\tthis.popup.popupWindow.popupContainer &&\n\t\t\tBX.isNodeInDom(this.popup.popupWindow.popupContainer)\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn '';\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [];\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tthis.DOM.innerWrap = Dom.create(\"div\", {props : {className : ''}});\n\t\treturn this.DOM.innerWrap;\n\t}\n\n\thandlePopupClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (target.hasAttribute('data-bx-resbook-control-node') ||\n\t\t\tBX.findParent(target, {attribute: 'data-bx-resbook-control-node'}, this.DOM.innerWrap)\n\t\t)\n\t\t{\n\t\t\tthis.handleControlChanges();\n\t\t}\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tif (this.changesTimeout)\n\t\t{\n\t\t\tthis.changesTimeout = clearTimeout(this.changesTimeout);\n\t\t}\n\t\tthis.changesTimeout = setTimeout(BX.delegate(function(){BX.onCustomEvent('ResourceBooking.webformSettings:onChanged');}, this), 50);\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (this.isPopupShown() && !BX.isParentForNode(this.popupContainer, target))\n\t\t{\n\t\t\treturn this.closePopup({animation: true});\n\t\t}\n\t}\n\n\tsetDisabled()\n\t{\n\t\tthis.disabled = true;\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\tthis.closePopup();\n\t\t}\n\t\tDom.addClass(this.DOM.innerWrap, 'disabled');\n\t}\n\n\tsetEnabled()\n\t{\n\t\tthis.disabled = false;\n\t\tDom.removeClass(this.DOM.innerWrap, 'disabled');\n\t}\n}","import {BookingUtil, Dom} from \"calendar.resourcebooking\";\n\nexport class FormFieldTunnerValuePopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tthis.id = 'resourcebooking-settings-value-popup-' + Math.round(Math.random() * 100000);\n\t\tthis.selectedValues = [];\n\t\tthis.DOM = {\n\t\t\touterWrap: params.wrap\n\t\t};\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.innerWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props: {className: 'calendar-resbook-webform-settings-popup-select-result'}}));\n\n\t\tthis.DOM.valueLink = this.DOM.innerWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-settings-popup-select-value'},\n\t\t\ttext: this.getCurrentValueState(),\n\t\t\tevents: {\n\t\t\t\tclick: this.showPopup.bind(this),\n\t\t\t\tmouseover: this.showHoverPopup.bind(this),\n\t\t\t\tmouseout: this.hideHoverPopup.bind(this)\n\t\t\t}\n\t\t}));\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.popup && this.popup.isShown())\n\t\t{\n\t\t\treturn this.popup.close();\n\t\t}\n\n\t\tthis.popup = new BX.PopupWindow(\n\t\t\tthis.id,\n\t\t\tthis.DOM.valueLink,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tloseByEsc: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\twidth: this.getPopupWidth(),\n\t\t\t\tlightShadow: true,\n\t\t\t\tcontent: this.getPopupContent()\n\t\t\t});\n\t\tthis.popup.setAngle({offset: 60, position: 'top'});\n\t\tthis.popup.show(true);\n\n\t\tBX.unbind(this.DOM.innerWrap, 'click', BX.proxy(this.handlePopupClick, this));\n\t\tBX.bind(this.DOM.innerWrap, 'click', BX.proxy(this.handlePopupClick, this));\n\n\t\tBX.addCustomEvent(this.popup, 'onPopupClose', BX.delegate(function ()\n\t\t{\n\t\t\tthis.handlePopupCloose();\n\t\t\tthis.popup.destroy(this.id);\n\t\t\tthis.popup = null;\n\t\t}, this));\n\t}\n\n\tclosePopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tisPopupShown()\n\t{\n\t\treturn this.popup && this.popup.popupWindow &&\n\t\t\tthis.popup.popupWindow.isShown && this.popup.popupWindow.isShown() &&\n\t\t\tthis.popup.popupWindow.popupContainer &&\n\t\t\tBX.isNodeInDom(this.popup.popupWindow.popupContainer)\n\t}\n\n\tshowHoverPopup()\n\t{\n\t}\n\n\thideHoverPopup()\n\t{\n\t}\n\n\thandlePopupCloose()\n\t{\n\t}\n\n\tgetCurrentValueState()\n\t{\n\t\treturn BX.message('WEBF_RES_NO_VALUE');\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tthis.DOM.innerWrap = Dom.create(\"div\", {props: {className: ''}});\n\n\t\tthis.DOM.innerWrap.style.minWidth = '500px';\n\t\tthis.DOM.innerWrap.style.minHeight = '30px';\n\t\treturn this.DOM.innerWrap;\n\t}\n\n\tgetPopupWidth()\n\t{\n\t\treturn null;\n\t}\n\n\thandlePopupClick(e)\n\t{\n\t\tvar target = e.target || e.srcElement;\n\t\tif (target.hasAttribute('data-bx-resbook-control-node') || BX.findParent(target, {attribute: 'data-bx-resbook-control-node'}, this.DOM.innerWrap))\n\t\t{\n\t\t\tthis.handleControlChanges();\n\t\t}\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsetTimeout(BX.delegate(function(){BX.onCustomEvent('ResourceBooking.webformSettings:onChanged');}, this), 50);\n\t}\n\n\tshowPopupLoader()\n\t{\n\t\tif (this.DOM.innerWrap)\n\t\t{\n\t\t\tthis.hidePopupLoader();\n\t\t\tthis.DOM.popupLoader = this.DOM.innerWrap.appendChild(BookingUtil.getLoader(50));\n\t\t}\n\t}\n\n\thidePopupLoader()\n\t{\n\t\tDom.remove(this.DOM.popupLoader);\n\t}\n}\n\n\texport class FormFieldTunnerMultipleChecknoxPopupAbstract extends FormFieldTunnerValuePopupAbstract{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.id = 'resourcebooking-settings-multiple-checknox-' + Math.round(Math.random() * 100000);\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\treturn this.closePopup();\n\t\t}\n\n\t\tvar menuItems = [];\n\n\t\tthis.values.forEach(function(item)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: item.id,\n\t\t\t\ttext: BX.util.htmlspecialchars(item.title),\n\t\t\t\tdataset: item.dataset,\n\t\t\t\tonclick: BX.proxy(this.menuItemClick, this)\n\t\t\t});\n\t\t}, this);\n\n\t\tif (menuItems.length > 1)\n\t\t{\n\t\t\tthis.selectAllMessage = this.selectAllMessage || 'select all';\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this.selectAllMessage,\n\t\t\t\tonclick: BX.proxy(this.selectAllItemClick, this)\n\t\t\t});\n\t\t}\n\n\t\tthis.popup = BX.PopupMenu.create(\n\t\t\tthis.id,\n\t\t\tthis.DOM.valueLink,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tclassName: 'popup-window-resource-select',\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.popupWindow.setAngle({offset: 60, position: 'top'});\n\t\tthis.popup.show(true);\n\t\tthis.popupContainer = this.popup.popupWindow.popupContainer;\n\n\t\tBX.addCustomEvent(this.popup.popupWindow, 'onPopupClose', BX.proxy(function()\n\t\t{\n\t\t\tthis.handlePopupCloose();\n\t\t\tBX.PopupMenu.destroy(this.id);\n\t\t\tthis.popup = null;\n\t\t}, this));\n\n\t\tthis.popup.menuItems.forEach(function(menuItem)\n\t\t{\n\t\t\tvar checked;\n\t\t\tif (menuItem.dataset && menuItem.dataset.id)\n\t\t\t{\n\t\t\t\tchecked = this.selectedValues.find(function(itemId){return itemId === menuItem.id});\n\n\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item';\n\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox\" type=\"checkbox\"' + (checked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + menuItem.text + '</label>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectAllChecked = !this.values.find(function(value){\n\t\t\t\t\treturn !this.selectedValues.find(function(itemId){return itemId === value.id});\n\t\t\t\t},this);\n\n\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item menu-popup-item-resource-all';\n\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox menu-popup-item-all-resources-checkbox\" type=\"checkbox\"' + (this.selectAllChecked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + menuItem.text + '</label>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>';\n\t\t\t}\n\t\t}, this);\n\n\t\tsetTimeout(BX.delegate(function(){\n\t\t\tBX.bind(document, 'click', BX.proxy(this.handleClick, this));\n\t\t}, this), 50);\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tvar\n\t\t\tselectAllcheckbox,\n\t\t\ttarget = e.target || e.srcElement,\n\t\t\tcheckbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox'),\n\t\t\tfoundValue = this.values.find(function(value){return value.id === menuItem.id;});\n\n\t\tif (foundValue)\n\t\t{\n\t\t\tif (target && (Dom.hasClass(target, \"menu-popup-item\") || Dom.hasClass(target, \"menu-popup-item-resource-checkbox\") || Dom.hasClass(target, \"menu-popup-item-inner\") ))\n\t\t\t{\n\t\t\t\tif (!Dom.hasClass(target, \"menu-popup-item-resource-checkbox\"))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t\t}\n\n\t\t\t\tif (checkbox.checked)\n\t\t\t\t{\n\t\t\t\t\tthis.selectItem(foundValue);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.deselectItem(foundValue);\n\t\t\t\t\tselectAllcheckbox = this.popupContainer.querySelector('.menu-popup-item-all-resources-checkbox');\n\t\t\t\t\tthis.selectAllChecked = false;\n\t\t\t\t\tif (selectAllcheckbox)\n\t\t\t\t\t{\n\t\t\t\t\t\tselectAllcheckbox.checked = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.handleControlChanges();\n\t\t}\n\t}\n\n\tselectItem(value)\n\t{\n\t\tif (!BX.util.in_array(value.id, this.selectedValues))\n\t\t{\n\t\t\tthis.selectedValues.push(value.id);\n\t\t}\n\t}\n\tdeselectItem(value)\n\t{\n\t\tvar index = BX.util.array_search(value.id, this.selectedValues);\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis.selectedValues = BX.util.deleteFromArray(this.selectedValues, index);\n\t\t}\n\t}\n\n\tselectAllItemClick(e, menuItem)\n\t{\n\t\tvar target = e.target || e.srcElement;\n\t\tif (target && (Dom.hasClass(target, \"menu-popup-item\") || Dom.hasClass(target, \"menu-popup-item-resource-checkbox\")))\n\t\t{\n\t\t\tvar checkbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox');\n\n\t\t\tif (Dom.hasClass(target, \"menu-popup-item\"))\n\t\t\t{\n\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t}\n\n\t\t\tvar i, checkboxes = this.popupContainer.querySelectorAll('input.menu-popup-item-resource-checkbox');\n\t\t\tthis.selectAllChecked = checkbox.checked;\n\n\t\t\tfor (i = 0; i < checkboxes.length; i++)\n\t\t\t{\n\t\t\t\tcheckboxes[i].checked = this.selectAllChecked;\n\t\t\t}\n\t\t\tthis.selectedValues = [];\n\t\t\tif (this.selectAllChecked)\n\t\t\t{\n\t\t\t\tthis.values.forEach(function(value){this.selectedValues.push(value.id);}, this);\n\t\t\t}\n\t\t\tthis.handleControlChanges();\n\t\t}\n\t}\n\n\thandleClick(e)\n\t{\n\t\tvar target = e.target || e.srcElement;\n\t\tif (this.isPopupShown() && !BX.isParentForNode(this.popupContainer, target))\n\t\t{\n\t\t\tthis.closePopup({animation: true});\n\t\t}\n\n\t\tthis.handleControlChanges();\n\t}\n\n\tclosePopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.popupContainer.style.maxHeight = '';\n\t\t\tBX.unbind(document, 'click', BX.proxy(this.handleClick, this));\n\t\t}\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\treturn this.selectedValues;\n\t}\n}","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerPopupAbstract} from \"../formfieldtunnerpopupabstract\";\nimport {FormFieldTunnerValuePopupAbstract} from \"../formfieldtunnervaluepopupabstract\";\nimport {ResourcebookingUserfield} from \"../resourcebookinguserfield\";\nimport {BookingUtil} from \"calendar.resourcebooking\";\nimport {Loc, Type, Dom, Tag, Text} from \"main.core\";\nimport {MenuItem} from \"main.popup\";\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\nimport {EventEmitter} from 'main.core.events';\n\n\nexport class UserSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_USERS');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_USERS_LABEL');\n\t\tthis.displayed = true;\n\t\tthis.selectedUsers = [];\n\t}\n\n\tupdateConfig(params)\n\t{\n\t\tsuper.updateConfig(params);\n\t\tthis.defaultMode = params.defaultMode;\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tparams.isDisplayed = this.isDisplayed.bind(this);\n\t\tparams.defaultMode = params.defaultMode || this.defaultMode;\n\t\tthis.statePopup = new UsersStatePopup(params);\n\t}\n\n\tbuildValuePopup(params)\n\t{\n\t\tthis.selectedUsers = Type.isArray(params.config.selected)\n\t\t\t? params.config.selected\n\t\t\t: params.config.selected.split('|');\n\n\t\tthis.DOM.valueWrap = params.wrap;\n\n\t\tthis.DOM.valueWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-resbook-webform-settings-popup-select-result\">\n\t\t\t\t\t${this.DOM.usersValueLink = Tag.render`\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"calendar-resbook-webform-settings-popup-select-value\"\n\t\t\t\t\t\t\tonclick=\"${this.showUserSelectorDialog.bind(this)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${this.getCurrentUsersValueText()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`}\n\t\t\t\t</div>\n\t\t\t`\n\t\t);\n\t}\n\n\tgetCurrentUsersValueText()\n\t{\n\t\tconst count = this.selectedUsers.length;\n\t\treturn count\n\t\t\t? (count + ' ' + ResourcebookingUserfield.getPluralMessage('WEBF_RES_USER', count))\n\t\t\t: Loc.getMessage('WEBF_RES_NO_VALUE');\n\t}\n\n\tshowUserSelectorDialog()\n\t{\n\t\tif (!(this.userSelectorDialog instanceof EntitySelectorDialog))\n\t\t{\n\t\t\tthis.userSelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.usersValueLink,\n\t\t\t\tcontext: 'RESOURCEBOOKING',\n\t\t\t\tpreselectedItems: this.selectedUsers.map((userId) => {return ['user', userId]}),\n\t\t\t\tenableSearch: true,\n\t\t\t\tzIndex: this.zIndex + 10,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleUserSelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleUserSelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tthis.userSelectorDialog.show();\n\t}\n\n\thandleUserSelectorChanges()\n\t{\n\t\tthis.selectedUsers = [];\n\n\t\tthis.userSelectorDialog.getSelectedItems().forEach((item) => {\n\t\t\tif (item.entityId === \"user\")\n\t\t\t{\n\t\t\t\tthis.selectedUsers.push(item.id);\n\t\t\t}\n\t\t});\n\n\t\tthis.DOM.usersValueLink.innerHTML = this.getCurrentUsersValueText();\n\n\t\tEventEmitter.emit('ResourceBooking.settingsUserSelector:onChanged');\n\t\tsetTimeout(() => {EventEmitter.emit('ResourceBooking.webformSettings:onChanged')}, 50);\n\t}\n\n\tdisplayInForm()\n\t{\n\t\tsuper.displayInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t\tthis.statePopup.setEnabled();\n\t}\n\n\thideInForm()\n\t{\n\t\tsuper.hideInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t\tthis.statePopup.setDisabled();\n\t}\n\n\tgetValue()\n\t{\n\t\treturn {\n\t\t\tshow: this.isDisplayed() ? 'Y' : 'N',\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tdefaultMode: this.statePopup.getDefaultMode(),\n\t\t\tvalue: this.selectedUsers\n\t\t};\n\t}\n}\n\nclass UsersStatePopup extends FormFieldTunnerPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'usersStatePopup';\n\t\tthis.inputName = 'user-select-mode';\n\t\tthis.id = 'users-state-' + Math.round(Math.random() * 1000);\n\t\tthis.defaultMode = params.defaultMode === 'none' ? 'none' : 'auto';\n\t\tthis.isDisplayed = Type.isFunction(params.isDisplayed) ? params.isDisplayed : function(){return false};\n\t\tthis.build();\n\t}\n\n\tbuild()\n\t{\n\t\tsuper.build();\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [\n\t\t\tnew MenuItem({\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DEFAULT_TITLE'),\n\t\t\t\tdelimiter: true\n\t\t\t}),\n\t\t\t{\n\t\t\t\tid: 'users-state-list',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DEFAULT_EMPTY'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'none',\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tchecked: this.defaultMode === 'none'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'users-state-auto',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DEFAULT_FREE_USER'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'auto',\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tchecked: this.defaultMode === 'auto'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t}\n\t\t];\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tvar target = e.target || e.srcElement;\n\t\tif (Type.isDomNode(target) && target.nodeName.toLowerCase() === 'input'\n\t\t\t&& menuItem.dataset && menuItem.dataset.inputName === this.inputName\n\t\t)\n\t\t{\n\t\t\tthis.defaultMode = menuItem.dataset.value;\n\t\t}\n\t\tthis.handleControlChanges();\n\t\tsetTimeout(this.closePopup.bind(this), 50);\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn this.isDisplayed()\n\t\t\t?\n\t\t\t(Loc.getMessage('WEBF_RES_SELECT_USER_FROM_LIST_SHORT') +\n\t\t\t\t(this.defaultMode === 'none'\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: (',<br>' + Loc.getMessage('WEBF_RES_AUTO_SELECT_USER_SHORT'))\n\t\t\t\t))\n\t\t\t:\n\t\t\tLoc.getMessage('WEBF_RES_SELECT_USER_FROM_LIST_AUTO');\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tthis.DOM.currentStateLink.innerHTML = this.getCurrentModeState();\n\t\tBX.onCustomEvent(this, \"ResourceBooking.userSettingsField:onControlChanged\", []);\n\t}\n\n\tgetDefaultMode()\n\t{\n\t\treturn this.defaultMode;\n\t}\n}","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerPopupAbstract} from \"../formfieldtunnerpopupabstract\";\nimport {FormFieldTunnerMultipleChecknoxPopupAbstract} from \"../formfieldtunnervaluepopupabstract\";\nimport {ResourcebookingUserfield} from \"../resourcebookinguserfield\";\nimport {Loc, Type, Dom} from \"main.core\";\nimport {MenuItem} from \"main.popup\";\n\nexport class ResourceSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_RESOURCES');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_RESOURCES_LABEL');\n\t\tthis.displayed = true;\n\t}\n\n\tupdateConfig(params)\n\t{\n\t\tsuper.updateConfig(params);\n\t\tthis.defaultMode = params.defaultMode;\n\t\tthis.multiple = params.multiple === 'Y';\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tparams.isDisplayed = this.isDisplayed.bind(this);\n\t\tparams.defaultMode = params.defaultMode || this.defaultMode;\n\t\tparams.multiple = params.multiple == null ? this.multiple : params.multiple;\n\t\tthis.statePopup = new ResourcesStatePopup(params);\n\t}\n\n\tbuildValuePopup (params)\n\t{\n\t\tthis.valuePopup = new ResourcesValuePopup(params);\n\t}\n\n\tdisplayInForm ()\n\t{\n\t\tsuper.displayInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t\tthis.statePopup.setEnabled();\n\t}\n\n\thideInForm ()\n\t{\n\t\tsuper.hideInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t\tthis.statePopup.setDisabled();\n\t}\n\n\tgetValue ()\n\t{\n\t\treturn {\n\t\t\tshow: this.isDisplayed() ? 'Y' : 'N',\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tdefaultMode: this.statePopup.getDefaultMode(),\n\t\t\tmultiple: this.statePopup.getMultiple() ? 'Y' : 'N',\n\t\t\tvalue: this.valuePopup.getSelectedId()\n\t\t};\n\t}\n}\n\n\nclass ResourcesStatePopup extends FormFieldTunnerPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'resourcesStatePopup';\n\t\tthis.inputName = 'resource-select-mode';\n\t\tthis.defaultMode = params.defaultMode === 'none' ? 'none' : 'auto';\n\t\tthis.multiple = !!params.multiple;\n\t\tthis.isDisplayed = Type.isFunction(params.isDisplayed) ? params.isDisplayed : function(){return false;};\n\t\tthis.build();\n\t}\n\n\tbuild()\n\t{\n\t\tsuper.build();\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [\n\t\t\tnew MenuItem({\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DEFAULT_TITLE'),\n\t\t\t\tdelimiter: true\n\t\t\t}),\n\t\t\t{\n\t\t\t\tid: 'resources-state-list',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DEFAULT_EMPTY'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'none',\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tchecked: this.defaultMode === 'none'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'resources-state-auto',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_AUTO_SELECT_RES'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'auto',\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tchecked: this.defaultMode === 'auto'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tdelimiter: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'resources-state-multiple',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_MULTIPLE'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\tvalue: 'Y',\n\t\t\t\t\tchecked: this.multiple\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t}\n\t\t];\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn this.isDisplayed()\n\t\t\t?\n\t\t\t(Loc.getMessage('WEBF_RES_SELECT_RES_FROM_LIST_SHORT') +\n\t\t\t\t(this.defaultMode === 'none'\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: (',<br>' + Loc.getMessage('WEBF_RES_AUTO_SELECT_RES_SHORT'))\n\t\t\t\t))\n\t\t\t:\n\t\t\tLoc.getMessage('WEBF_RES_SELECT_RES_FROM_LIST_AUTO');\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tthis.DOM.currentStateLink.innerHTML = this.getCurrentModeState();\n\t\tBX.onCustomEvent(this, \"ResourceBooking.userSettingsField:onControlChanged\", []);\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Type.isDomNode(target) && target.nodeName.toLowerCase() === 'input'\n\t\t\t&& menuItem.dataset)\n\t\t{\n\t\t\tif (menuItem.dataset.inputName === this.inputName)\n\t\t\t{\n\t\t\t\tthis.defaultMode = menuItem.dataset.value;\n\t\t\t}\n\t\t\telse if (menuItem.id === 'resources-state-multiple')\n\t\t\t{\n\t\t\t\tthis.multiple = !!target.checked;\n\t\t\t}\n\t\t}\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetDefaultMode()\n\t{\n\t\treturn this.defaultMode;\n\t}\n\n\tgetMultiple()\n\t{\n\t\treturn this.multiple;\n\t}\n}\n\n\nclass ResourcesValuePopup extends FormFieldTunnerMultipleChecknoxPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'resourcesValuePopup';\n\t\tthis.selectAllMessage = Loc.getMessage('USER_TYPE_RESOURCE_SELECT_ALL');\n\n\t\tlet\n\t\t\tselectedItems, selectedIndex = {},\n\t\t\tselectAll = params.config.selected === null;\n\n\t\tif (Type.isArray(params.config.selected))\n\t\t{\n\t\t\tselectedItems = params.config.selected;\n\t\t}\n\t\telse if (Type.isString(params.config.selected))\n\t\t{\n\t\t\tselectedItems = params.config.selected.split('|');\n\t\t}\n\n\t\tif (Type.isArray(selectedItems))\n\t\t{\n\t\t\tfor(let i = 0; i < selectedItems.length; i++)\n\t\t\t{\n\t\t\t\tselectedIndex[selectedItems[i]] = true;\n\t\t\t}\n\t\t}\n\n\t\tthis.values = [];\n\t\tthis.selectedValues = [];\n\t\tif (Type.isArray(params.config.resources))\n\t\t{\n\t\t\tparams.config.resources.forEach(function(resource)\n\t\t\t{\n\t\t\t\tlet valueId = this.prepareValueId(resource);\n\t\t\t\tthis.values.push({\n\t\t\t\t\tid: valueId,\n\t\t\t\t\ttitle: resource.title,\n\t\t\t\t\tdataset: resource\n\t\t\t\t});\n\n\t\t\t\tif (selectAll || selectedIndex[resource.id])\n\t\t\t\t{\n\t\t\t\t\tthis.selectedValues.push(valueId);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tthis.build();\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tDom.adjust(this.DOM.valueLink, {text: this.getCurrentValueState()});\n\t}\n\n\tgetCurrentValueState()\n\t{\n\t\tlet count = this.selectedValues.length;\n\t\treturn count ? (count + ' ' + ResourcebookingUserfield.getPluralMessage('WEBF_RES_RESOURCE', count)) : Loc.getMessage('WEBF_RES_NO_VALUE');\n\t}\n\n\tprepareValueId(resource)\n\t{\n\t\treturn resource.type + '|' + resource.id;\n\t}\n\n\tgetSelectedId()\n\t{\n\t\tlet result = [];\n\t\tthis.getSelectedValues().forEach(function(value)\n\t\t{\n\t\t\tlet val = value.split('|');\n\t\t\tif (val && val[1])\n\t\t\t{\n\t\t\t\tresult.push(parseInt(val[1]));\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n}\n\n\n\n\n","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerMultipleChecknoxPopupAbstract} from \"../formfieldtunnervaluepopupabstract\";\nimport {ResourcebookingUserfield} from \"../resourcebookinguserfield\";\nimport {BookingUtil} from \"calendar.resourcebooking\";\nimport {Loc, Type, Dom} from \"main.core\";\n\nexport class ServiceSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_SERVICES');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_SERVICE_LABEL');\n\t\tthis.displayed = true;\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tif (params && Type.isDomNode(params.wrap))\n\t\t{\n\t\t\tparams.wrap.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className:'calendar-resbook-webform-settings-popup-select disabled'},\n\t\t\t\thtml: '<span class=\"calendar-resbook-webform-settings-popup-select-value\">' + Loc.getMessage('WEBF_RES_FROM_LIST') + '</span>'\n\t\t\t}));\n\t\t}\n\t}\n\n\tbuildValuePopup (params)\n\t{\n\t\tthis.valuePopup = new ServiceValuePopup(params);\n\t}\n\n\tgetValue ()\n\t{\n\t\treturn {\n\t\t\tshow: this.isDisplayed() ? 'Y' : 'N',\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tvalue: this.valuePopup.getSelectedValues()\n\t\t};\n\t}\n}\n\n\nclass ServiceValuePopup extends FormFieldTunnerMultipleChecknoxPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'ServiceValuePopup';\n\t\tthis.selectAllMessage = Loc.getMessage('WEBF_RES_SELECT_ALL_SERVICES');\n\n\t\tlet selectAll = params.config.selected === null || params.config.selected === '' || params.config.selected === undefined;\n\t\tthis.values = [];\n\t\tthis.selectedValues = [];\n\n\t\tlet selectedItems, selectedIndex = {};\n\t\tif (Type.isArray(params.config.selected))\n\t\t{\n\t\t\tselectedItems = params.config.selected;\n\t\t}\n\t\telse if (Type.isString(params.config.selected))\n\t\t{\n\t\t\tselectedItems = params.config.selected.split('|');\n\t\t}\n\n\t\tif (Type.isArray(selectedItems))\n\t\t{\n\t\t\tfor(let i = 0; i < selectedItems.length; i++)\n\t\t\t{\n\t\t\t\tselectedIndex[BookingUtil.translit(selectedItems[i])] = true;\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isArray(params.config.services))\n\t\t{\n\t\t\tparams.config.services.forEach(function(service)\n\t\t\t{\n\t\t\t\tservice.id = BookingUtil.translit(service.name);\n\t\t\t\tif (service.id !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.values.push({\n\t\t\t\t\t\tid: service.id,\n\t\t\t\t\t\ttitle: service.name + ' - ' + BookingUtil.getDurationLabel(service.duration),\n\t\t\t\t\t\tdataset: service\n\t\t\t\t\t});\n\n\t\t\t\t\tif (selectAll || selectedIndex[BookingUtil.translit(service.name)])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectedValues.push(service.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tthis.config = {};\n\t\tthis.build();\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tDom.adjust(this.DOM.valueLink, {text: this.getCurrentValueState()});\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\treturn this.selectedValues.length ? this.selectedValues : '#EMPTY-SERVICE-LIST#';\n\t}\n\n\tgetCurrentValueState()\n\t{\n\t\tlet count = this.selectedValues.length;\n\t\treturn count ? (count + ' ' + ResourcebookingUserfield.getPluralMessage('WEBF_RES_SERVICE', count)) : Loc.getMessage('WEBF_RES_NO_VALUE');\n\t}\n}\n\n\n","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerPopupAbstract} from \"../formfieldtunnerpopupabstract\";\nimport {BookingUtil} from \"calendar.resourcebooking\";\nimport {Loc, Type} from \"main.core\";\n\nexport class DurationSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_DURATION');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_DURATION_LABEL');\n\t}\n\n\tupdateConfig(params)\n\t{\n\t\tsuper.updateConfig();\n\t\tthis.defaultValue = params.defaultValue;\n\t\tthis.manualInput = params.manualInput === 'Y';\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tparams.isDisplayed = this.isDisplayed.bind(this);\n\t\tparams.defaultValue = this.defaultValue;\n\t\tparams.manualInput = this.manualInput;\n\t\tthis.statePopup = new DurationStatePopup(params);\n\t}\n\n\tdisplayInForm ()\n\t{\n\t\tsuper.displayInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t}\n\n\thideInForm ()\n\t{\n\t\tsuper.hideInForm();\n\t\tthis.statePopup.handleControlChanges();\n\t}\n\n\tgetValue ()\n\t{\n\t\treturn {\n\t\t\tshow: this.isDisplayed() ? 'Y' : 'N',\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tdefaultValue: this.statePopup.getDefaultValue(),\n\t\t\tmanualInput: this.statePopup.getManualInput() ? 'Y' : 'N'\n\t\t};\n\t}\n}\n\n\nclass DurationStatePopup extends FormFieldTunnerPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'durationStatePopup';\n\t\tthis.inputName = 'duration-select-mode';\n\t\tthis.manualInput = !!params.manualInput;\n\t\tthis.defaultValue = params.defaultValue || 60;\n\t\tthis.isDisplayed = Type.isFunction(params.isDisplayed) ? params.isDisplayed : function(){return false;};\n\t\tthis.durationList = BookingUtil.getDurationList(params.fullDay);\n\t\tthis.build();\n\t}\n\n\tbuild()\n\t{\n\t\tsuper.build();\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'duration-default-value',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_DURATION_AUTO'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'submenu-list',\n\t\t\t\t\tvalue: this.defaultValue,\n\t\t\t\t\ttextValue: this.getDurationLabelByValue(this.defaultValue)\n\t\t\t\t},\n\t\t\t\titems: this.getDefaultMenuItems()\n\t\t\t}].concat((this.isDisplayed()\n\t\t\t? [\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'duration-manual-input',\n\t\t\t\t\ttext: Loc.getMessage('WEBF_RES_SELECT_MANUAL_INPUT'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\tvalue: 'Y',\n\t\t\t\t\t\tchecked: this.manualInput\n\t\t\t\t\t},\n\t\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t\t}\n\t\t\t]\n\t\t\t: []));\n\t}\n\n\tgetDefaultMenuItems()\n\t{\n\t\tlet menuItems = [];\n\n\t\tif (Type.isArray(this.durationList))\n\t\t{\n\t\t\tthis.durationList.forEach(function(item)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tid: 'duration-' + item.value,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\ttype: 'duration',\n\t\t\t\t\t\tvalue: item.value\n\t\t\t\t\t},\n\t\t\t\t\ttext: item.label,\n\t\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t\t});\n\t\t\t}, this);\n\t\t}\n\n\t\treturn menuItems;\n\t}\n\n\tgetDurationLabelByValue(duration)\n\t{\n\t\tlet foundDuration = this.durationList.find(function(item){return parseInt(item.value) === parseInt(duration)});\n\t\treturn foundDuration ? foundDuration.label : null;\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn this.isDisplayed()\n\t\t\t?\n\t\t\t(Loc.getMessage('WEBF_RES_SELECT_DURATION_FROM_LIST_SHORT')\n\t\t\t\t+ (',<br>' + Loc.getMessage('WEBF_RES_SELECT_DURATION_BY_DEFAULT') + ' ' + this.getDurationLabelByValue(this.defaultValue)))\n\t\t\t:\n\t\t\tLoc.getMessage('WEBF_RES_SELECT_DURATION_AUTO') + ' ' + this.getDurationLabelByValue(this.defaultValue);\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tthis.DOM.currentStateLink.innerHTML = this.getCurrentModeState();\n\t\tBX.onCustomEvent(this, \"ResourceBooking.userSettingsField:onControlChanged\", []);\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Type.isDomNode(target) && target.nodeName.toLowerCase() === 'input'\n\t\t\t&& menuItem.dataset)\n\t\t{\n\t\t\tif (menuItem.id === 'duration-manual-input')\n\t\t\t{\n\t\t\t\tthis.manualInput = !!target.checked;\n\t\t\t}\n\t\t}\n\t\telse if (menuItem.dataset && menuItem.dataset.type === 'duration')\n\t\t{\n\t\t\tthis.defaultValue = parseInt(menuItem.dataset.value);\n\t\t}\n\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetManualInput()\n\t{\n\t\treturn this.manualInput;\n\t}\n\n\tgetDefaultValue()\n\t{\n\t\treturn this.defaultValue;\n\t}\n}","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerPopupAbstract} from \"../formfieldtunnerpopupabstract\";\nimport {Loc, Type, Dom} from \"main.core\";\nimport { MenuItem } from 'main.popup';\n\nexport class DateSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_DATE');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_DATE_LABEL');\n\t\tthis.displayed = true;\n\t\tthis.displayCheckboxDisabled = true;\n\t}\n\n\tupdateConfig(params)\n\t{\n\t\tsuper.updateConfig();\n\t\tthis.style = params.style;\n\t\tthis.start = params.start;\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tparams.style = params.style || this.style;\n\t\tparams.start = params.start || this.start;\n\t\tthis.statePopup = new DateStatePopup(params);\n\t}\n\n\tgetValue ()\n\t{\n\t\treturn {\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tstyle: this.statePopup.getStyle(),\n\t\t\tstart: this.statePopup.getStart()\n\t\t};\n\t}\n}\n\n\nclass DateStatePopup extends FormFieldTunnerPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'dateStatePopup';\n\t\tthis.styleInputName = 'date-select-style';\n\t\tthis.startInputName = 'date-select-start';\n\t\tthis.style = params.style === 'popup' ? 'popup' : 'line'; // popup|line\n\t\tthis.start = params.start === 'today' ? 'today' : 'free'; // today|free\n\t\tthis.build();\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [\n\t\t\tnew MenuItem({\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_STYLE'),\n\t\t\t\tdelimiter: true\n\t\t\t}),\n\t\t\t{\n\t\t\t\tid: 'date-state-style-popup',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_STYLE_POPUP'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'popup',\n\t\t\t\t\tinputName: this.styleInputName,\n\t\t\t\t\tchecked: this.style === 'popup'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'date-state-style-line',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_STYLE_LINE'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'line',\n\t\t\t\t\tinputName: this.styleInputName,\n\t\t\t\t\tchecked: this.style === 'line'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\tnew MenuItem({\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_START_FROM'),\n\t\t\t\tdelimiter: true\n\t\t\t}),\n\t\t\t{\n\t\t\t\tid: 'date-state-start-from-today',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_START_FROM_TODAY'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'today',\n\t\t\t\t\tinputName: this.startInputName,\n\t\t\t\t\tchecked: this.start === 'today'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'date-state-start-from-free',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_CALENDAR_START_FROM_FREE'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'free',\n\t\t\t\t\tinputName: this.startInputName,\n\t\t\t\t\tchecked: this.start === 'free'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t}\n\t\t];\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn (this.style === 'popup'\n\t\t\t? Loc.getMessage('WEBF_RES_CALENDAR_STYLE_POPUP')\n\t\t\t: Loc.getMessage('WEBF_RES_CALENDAR_STYLE_LINE'))\n\t\t\t+ ', '\n\t\t\t+ (this.start === 'today'\n\t\t\t\t? Loc.getMessage('WEBF_RES_CALENDAR_START_FROM_TODAY_SHORT')\n\t\t\t\t: Loc.getMessage('WEBF_RES_CALENDAR_START_FROM_FREE_SHORT'));\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tDom.adjust(this.DOM.currentStateLink, {text: this.getCurrentModeState()});\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Type.isDomNode(target) && target.nodeName.toLowerCase() === 'input'\n\t\t\t&& menuItem.dataset)\n\t\t{\n\t\t\tif (menuItem.dataset.inputName === this.styleInputName)\n\t\t\t{\n\t\t\t\tthis.style = menuItem.dataset.value;\n\t\t\t}\n\t\t\telse if (menuItem.dataset.inputName === this.startInputName)\n\t\t\t{\n\t\t\t\tthis.start = menuItem.dataset.value;\n\t\t\t}\n\t\t}\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetStyle()\n\t{\n\t\treturn this.style;\n\t}\n\n\tgetStart()\n\t{\n\t\treturn this.start;\n\t}\n}\n\n","import {FormFieldTunnerAbstract} from \"../formfieldtunnerabstract\";\nimport {FormFieldTunnerPopupAbstract} from \"../formfieldtunnerpopupabstract\";\nimport {BookingUtil} from \"calendar.resourcebooking\";\nimport {Loc, Type} from \"main.core\";\nimport {MenuItem} from \"main.popup\";\n\nexport class TimeSelectorFieldTunner extends FormFieldTunnerAbstract {\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.label = Loc.getMessage('WEBF_RES_TIME');\n\t\tthis.formLabel = Loc.getMessage('WEBF_RES_TIME_LABEL');\n\t\tthis.displayed = true;\n\t\tthis.displayCheckboxDisabled = true;\n\t}\n\n\tupdateConfig(params)\n\t{\n\t\tsuper.updateConfig();\n\t\tthis.style = params.style;\n\t\tthis.showOnlyFree = params.showOnlyFree === 'Y';\n\t\tthis.showFinishTime = params.showFinishTime === 'Y';\n\t\tthis.scale = parseInt(params.scale);\n\t}\n\n\tbuildStatePopup(params)\n\t{\n\t\tparams.style = params.style || this.style;\n\t\tparams.showOnlyFree = this.showOnlyFree;\n\t\tparams.showFinishTime = this.showFinishTime;\n\t\tparams.scale = this.scale;\n\t\tthis.statePopup = new TimeStatePopup(params);\n\t}\n\n\tgetValue()\n\t{\n\t\treturn {\n\t\t\tlabel: this.getFormLabel(),\n\t\t\tstyle: this.statePopup.getStyle(),\n\t\t\tshowFinishTime: this.statePopup.getShowFinishTime(),\n\t\t\tshowOnlyFree: this.statePopup.getShowOnlyFree(),\n\t\t\tscale: this.statePopup.getScale()\n\t\t};\n\t}\n}\n\n\nclass TimeStatePopup extends FormFieldTunnerPopupAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'timeStatePopup';\n\t\tthis.styleInputName = 'date-select-style';\n\n\t\tthis.showOnlyFree = params.showOnlyFree;\n\t\tthis.showFinishTime = params.showFinishTime;\n\t\tthis.scale = params.scale;\n\t\tthis.stateShowFreeId = 'time-state-show-free';\n\t\tthis.stateShowFinishId = 'time-state-show-finish';\n\t\tthis.style = params.style === 'select' ? 'select' : 'slots'; // select|slots\n\n\t\tthis.build();\n\t}\n\n\tbuild()\n\t{\n\t\tsuper.build();\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetMenuItems()\n\t{\n\t\treturn [\n\t\t\tnew MenuItem({\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_STYLE'),\n\t\t\t\tdelimiter: true\n\t\t\t}),\n\t\t\t{\n\t\t\t\tid: 'time-state-style-select',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_STYLE_SELECT'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'select',\n\t\t\t\t\tinputName: this.styleInputName,\n\t\t\t\t\tchecked: this.style === 'select'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'time-state-style-slots',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_STYLE_SLOT'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\tvalue: 'slots',\n\t\t\t\t\tinputName: this.styleInputName,\n\t\t\t\t\tchecked: this.style === 'slots'\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tdelimiter: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'time-state-scale',\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_BOOKING_SIZE'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'submenu-list',\n\t\t\t\t\tvalue: this.scale,\n\t\t\t\t\ttextValue: this.getDurationLabelByValue(this.scale)\n\t\t\t\t},\n\t\t\t\titems: this.getDurationMenuItems()\n\t\t\t},\n\t\t\t{\n\t\t\t\tdelimiter: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: this.stateShowFreeId,\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_SHOW_FREE_ONLY'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\tvalue: 'Y',\n\t\t\t\t\tchecked: this.showOnlyFree\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: this.stateShowFinishId,\n\t\t\t\ttext: Loc.getMessage('WEBF_RES_TIME_SHOW_FINISH_TIME'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\tvalue: 'Y',\n\t\t\t\t\tchecked: this.showFinishTime\n\t\t\t\t},\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t}\n\t\t];\n\t}\n\n\tgetCurrentModeState()\n\t{\n\t\treturn (this.style === 'select'\n\t\t\t? Loc.getMessage('WEBF_RES_TIME_STYLE_SELECT')\n\t\t\t: Loc.getMessage('WEBF_RES_TIME_STYLE_SLOT'))\n\t\t\t+ ',<br>'\n\t\t\t+ Loc.getMessage('WEBF_RES_TIME_BOOKING_SIZE') + ': '\n\t\t\t+ this.getDurationLabelByValue(this.scale);\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tsuper.handleControlChanges();\n\t\tthis.DOM.currentStateLink.innerHTML = this.getCurrentModeState();\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Type.isDomNode(target) && target.nodeName.toLowerCase() === 'input'\n\t\t\t&& menuItem.dataset)\n\t\t{\n\t\t\tif (menuItem.dataset.inputName === this.styleInputName)\n\t\t\t{\n\t\t\t\tthis.style = menuItem.dataset.value;\n\t\t\t}\n\t\t\telse if (menuItem.id === this.stateShowFreeId)\n\t\t\t{\n\t\t\t\tthis.showOnlyFree = !!target.checked;\n\t\t\t}\n\t\t\telse if (menuItem.id === this.stateShowFinishId)\n\t\t\t{\n\t\t\t\tthis.showFinishTime = !!target.checked;\n\t\t\t}\n\t\t}\n\t\telse if (menuItem.dataset && menuItem.dataset.type === 'scale')\n\t\t{\n\t\t\tthis.scale = parseInt(menuItem.dataset.value);\n\t\t}\n\n\t\tthis.handleControlChanges();\n\t}\n\n\n\tgetDurationMenuItems()\n\t{\n\t\tlet\n\t\t\tdurationList = this.getDurationList(),\n\t\t\tmenuItems = [];\n\n\t\tdurationList.forEach(function(duration){\n\t\t\tmenuItems.push({\n\t\t\t\tid: 'duration-' + duration.value,\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'scale',\n\t\t\t\t\tvalue: duration.value\n\t\t\t\t},\n\t\t\t\ttext: duration.label,\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t});\n\t\t}, this);\n\n\t\treturn menuItems;\n\t}\n\n\n\tgetDurationList()\n\t{\n\t\tif (!this.durationList)\n\t\t{\n\t\t\tthis.durationList = BookingUtil.getDurationList(false);\n\t\t\tthis.durationList = this.durationList.filter(function(duration)\n\t\t\t{\n\t\t\t\treturn duration.value && duration.value >= 15 && duration.value <= 240;\n\t\t\t});\n\t\t}\n\t\treturn this.durationList;\n\t}\n\n\tgetDurationLabelByValue(duration)\n\t{\n\t\tlet foundDuration = this.getDurationList().find(function(item){return item.value === duration});\n\t\treturn foundDuration ? foundDuration.label : null;\n\t}\n\n\tgetStyle()\n\t{\n\t\treturn this.style;\n\t}\n\n\tgetScale()\n\t{\n\t\treturn this.scale;\n\t}\n\n\tgetShowOnlyFree()\n\t{\n\t\treturn this.showOnlyFree ? 'Y' : 'N';\n\t}\n\n\tgetShowFinishTime()\n\t{\n\t\treturn this.showFinishTime ? 'Y' : 'N';\n\t}\n}\n\n\n","import {BookingUtil, FieldViewControllerEdit, FieldViewControllerPreview, Dom, Loc, Type, BaseEvent, EventEmitter, Runtime} from \"calendar.resourcebooking\";\nimport {ResourcebookingUserfield} from \"./resourcebookinguserfield\";\nimport {UserSelectorFieldTunner} from \"./controls/userselectorfieldtunner\";\nimport {ResourceSelectorFieldTunner} from \"./controls/resourceselectorfieldtunner\";\nimport {ServiceSelectorFieldTunner} from \"./controls/serviceselectorfieldtunner\";\nimport {DurationSelectorFieldTunner} from \"./controls/durationselectorfieldtunner\";\nimport {DateSelectorFieldTunner} from \"./controls/dateselectorfieldtunner\";\nimport {TimeSelectorFieldTunner} from \"./controls/timeselectorfieldtunner\";\nimport 'helper';\n\nexport class AdjustFieldController extends EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Calendar.ResourcebookingUserfield.AdjustFieldController');\n\n\t\tthis.params = params;\n\t\tthis.complexFields = {};\n\t\tthis.userFieldParams = null;\n\t\tthis.id = 'resbook-settings-popup-' + Math.round(Math.random() * 100000);\n\n\t\tthis.settingsData = AdjustFieldController.getSettingsData(this.params.settings.data);\n\t\tthis.params.settings.data = this.settingsData;\n\n\t\tthis.DOM = {\n\t\t\tinnerWrap: this.params.innerWrap,\n\t\t\tsettingsWrap: this.params.innerWrap.appendChild(Dom.create(\"div\", {attrs: {'data-bx-resource-field-settings': 'Y'}})),\n\t\t\tcaptionNode: this.params.captionNode,\n\t\t\tsettingsInputs: {}\n\t\t};\n\t}\n\n\tinit()\n\t{\n\t\t// Request field params\n\t\tthis.showFieldLoader();\n\n\t\tResourcebookingUserfield.getUserFieldParams({\n\t\t\tfieldName: this.params.entityName,\n\t\t\tselectedUsers: this.getSelectedUsers()\n\t\t}).then(\n\t\t\t(fieldParams) => {\n\t\t\t\tthis.hideFieldLoader();\n\t\t\t\tthis.userFieldParams = fieldParams;\n\n\t\t\t\tthis.fieldLayout = new FieldViewControllerEdit({\n\t\t\t\t\twrap: this.DOM.innerWrap,\n\t\t\t\t\tdisplayTitle: false,\n\t\t\t\t\ttitle: this.getCaption(),\n\t\t\t\t\tsettings: this.getSettings()\n\t\t\t\t});\n\t\t\t\tthis.fieldLayout.build();\n\t\t\t\tthis.updateSettingsDataInputs();\n\n\t\t\t\tthis.emit('afterInit', new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfieldName: this.params.entityName,\n\t\t\t\t\t\tsettings: this.getSettings()\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t);\n\t}\n\n\tshowSettingsPopup()\n\t{\n\t\tResourcebookingUserfield.getUserFieldParams(\n\t\t{\n\t\t\tfieldName: this.params.entityName,\n\t\t\tselectedUsers: this.getSelectedUsers()\n\t\t}).then(\n\t\t\tfunction(fieldParams)\n\t\t\t{\n\t\t\t\tthis.userFieldParams = fieldParams;\n\t\t\t\tthis.settingsPopupId = 'calendar-resourcebooking-settings-popup-' + Math.round(Math.random() * 100000);\n\t\t\t\tthis.settingsPopup = new BX.PopupWindow(\n\t\t\t\t\tthis.settingsPopupId,\n\t\t\t\t\tnull,\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent: this.getSettingsContentNode(),\n\t\t\t\t\t\tclassName: 'calendar-resbook-webform-settings-popup-window',\n\t\t\t\t\t\tautoHide: false,\n\t\t\t\t\t\tlightShadow: true,\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\toverlay: {backgroundColor: 'black', opacity: 500},\n\t\t\t\t\t\tzIndex: -400,\n\t\t\t\t\t\ttitleBar: Loc.getMessage('WEBF_RES_SETTINGS'),\n\t\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\t\tbuttons : [new BX.PopupWindowButton({})]\n\t\t\t\t\t});\n\n\t\t\t\tlet buttonNodeWrap = this.settingsPopup.buttons[0].buttonNode.parentNode;\n\t\t\t\tDom.remove(this.settingsPopup.buttons[0].buttonNode);\n\t\t\t\tthis.settingsPopup.buttons[0].buttonNode = buttonNodeWrap.appendChild(Dom.create(\n\t\t\t\t\t\"button\",\n\t\t\t\t\t{\n\t\t\t\t\t\tprops : { className : 'ui-btn ui-btn-success'},\n\t\t\t\t\t\tevents: {click: function(){this.settingsPopup.close();}.bind(this)},\n\t\t\t\t\t\ttext : Loc.getMessage('WEBF_RES_CLOSE_SETTINGS_POPUP')\n\t\t\t\t\t}\n\t\t\t\t));\n\n\t\t\t\tBX.removeClass(this.settingsPopup.buttons[0].buttonNode, 'popup-window-button');\n\t\t\t\tthis.settingsPopup.show();\n\n\t\t\t\tBX.addCustomEvent(this.settingsPopup, 'onPopupClose', function(popup)\n\t\t\t\t{\n\t\t\t\t\tthis.destroyControls();\n\t\t\t\t\tthis.settingsPopup.destroy(this.id);\n\t\t\t\t\tthis.settingsPopup = null;\n\t\t\t\t\tif (this.previewFieldLayout)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.previewFieldLayout.destroy();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this)\n\t\t);\n\t}\n\n\tgetSettingsContentNode()\n\t{\n\t\tlet outerWrap = Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-settings-popup'}});\n\n\t\tlet leftWrap = outerWrap.appendChild(Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-settings-popup-inner'}}));\n\t\tthis.buildSettingsForm({wrap: leftWrap});\n\n\t\tlet previewWrap = outerWrap.appendChild(Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-settings-popup-preview'}}));\n\n\t\tthis.previewFieldLayout = new FieldViewControllerPreview({\n\t\t\twrap: previewWrap,\n\t\t\ttitle: this.getCaption(),\n\t\t\tsettings: this.getSettings()\n\t\t});\n\t\tthis.previewFieldLayout.build();\n\n\t\tBX.addCustomEvent('ResourceBooking.webformSettings:onChanged', this.handleWebformSettingsChanges.bind(this));\n\n\t\treturn outerWrap;\n\t}\n\n\tbuildSettingsForm(params)\n\t{\n\t\tlet\n\t\t\tsettings = this.getSettings(),\n\t\t\twrap = params.wrap,\n\t\t\ttitleId = 'title-' + this.id;\n\n\t\tthis.DOM.captionWrap = wrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops : { className : 'calendar-resbook-webform-settings-popup-title'},\n\t\t\thtml: '<label for=\"' + titleId + '\" class=\"calendar-resbook-webform-settings-popup-label\">' + Loc.getMessage('WEBF_RES_NAME_LABEL') + '</label>'\n\t\t}));\n\t\tthis.DOM.captionInput = this.DOM.captionWrap.appendChild(Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\tid: titleId,\n\t\t\t\tclassName: 'calendar-resbook-webform-settings-popup-input',\n\t\t\t\ttype: 'text',\n\t\t\t\tvalue: this.getCaption()\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tchange: this.updateCaption.bind(this),\n\t\t\t\tblur: this.updateCaption.bind(this),\n\t\t\t\tkeyup: this.updateCaption.bind(this)\n\t\t\t}\n\t\t}));\n\t\tthis.updateCaption();\n\n\t\tthis.DOM.fieldsOuterWrap = wrap.appendChild(Dom.create('div', {\n\t\t\tprops : { className : 'calendar-resbook-webform-settings-popup-content'},\n\t\t\thtml: '<div class=\"calendar-resbook-webform-settings-popup-head\">' +\n\t\t\t\t'<div class=\"calendar-resbook-webform-settings-popup-head-inner\">' +\n\t\t\t\t'<span class=\"calendar-resbook-webform-settings-popup-head-text\">' + Loc.getMessage('WEBF_RES_FIELD_NAME') + '</span>' +\n\t\t\t\t'<span class=\"calendar-resbook-webform-settings-popup-head-decs\">' + Loc.getMessage('WEBF_RES_FIELD_NAME_IN_FORM') + '</span>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'<div class=\"calendar-resbook-webform-settings-popup-head-inner\">' +\n\t\t\t\t'<span class=\"calendar-resbook-webform-settings-popup-head-text\">' + Loc.getMessage('WEBF_RES_FIELD_SHOW_IN_FORM') + '</span>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t}));\n\n\t\tthis.DOM.fieldsWrap = this.DOM.fieldsOuterWrap.appendChild(Dom.create('div', {\n\t\t\tprops : { className : 'calendar-resbook-webform-settings-popup-list'}\n\t\t}));\n\n\t\tif (settings.userfieldSettings.useUsers)\n\t\t{\n\t\t\tthis.buildComplexField('users', {\n\t\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\t\tparams: settings.data.users,\n\t\t\t\tconfig: {\n\t\t\t\t\tusers: settings.userfieldSettings.users,\n\t\t\t\t\tselected: settings.data.users.value\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tBX.addCustomEvent('ResourceBooking.settingsUserSelector:onChanged', this.checkBitrix24Limitation.bind(this));\n\t\t}\n\n\t\tif (settings.userfieldSettings.useResources)\n\t\t{\n\t\t\tthis.buildComplexField('resources', {\n\t\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\t\tparams: settings.data.resources,\n\t\t\t\tconfig: {\n\t\t\t\t\tresources: settings.userfieldSettings.resources,\n\t\t\t\t\tselected: settings.data.resources.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (settings.userfieldSettings.useServices)\n\t\t{\n\t\t\tthis.buildComplexField('services', {\n\t\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\t\tparams: settings.data.services,\n\t\t\t\tconfig: {\n\t\t\t\t\tservices: settings.userfieldSettings.services,\n\t\t\t\t\tselected: settings.data.services.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buildComplexField('duration', {\n\t\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\t\tparams: settings.data.duration\n\t\t\t});\n\t\t}\n\n\t\tthis.buildComplexField('date', {\n\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\tparams: settings.data.date\n\t\t});\n\n\t\tif (!settings.userfieldSettings.fullDay)\n\t\t{\n\t\t\tthis.buildComplexField('time', {\n\t\t\t\twrap: this.DOM.fieldsWrap,\n\t\t\t\tchangeSettingsCallback: this.updateSettings.bind(this),\n\t\t\t\tparams: settings.data.time\n\t\t\t});\n\t\t}\n\n\t\tthis.DOM.fieldsWrap.appendChild(Dom.create('div', {\n\t\t\tprops : { className : 'calendar-resbook-webform-settings-popup-item'},\n\t\t\thtml: '<div class=\"calendar-resbook-webform-settings-popup-decs\">' +\n\t\t\t\t(Loc.getMessage('WEBF_RES_BOOKING_SETTINGS_HELP')\n\t\t\t\t\t.replace('#START_LINK#', '<a href=\"javascript:void(0);\"' +\n\t\t\t\t\t\t' onclick=\"if (top.BX.Helper){top.BX.Helper.show(\\'redirect=detail&code=8366733\\');}\">')\n\t\t\t\t\t.replace('#END_LINK#', '</a>')) +\n\t\t\t\t'</div>'\n\t\t}));\n\t}\n\n\tdestroyControls()\n\t{\n\t\tfor (let k in this.complexFields)\n\t\t{\n\t\t\tif (this.complexFields.hasOwnProperty(k) && Type.isFunction(this.complexFields[k].destroy))\n\t\t\t{\n\t\t\t\tthis.complexFields[k].destroy();\n\t\t\t}\n\t\t}\n\t}\n\n\thandleWebformSettingsChanges()\n\t{\n\t\tif (this.refreshLayoutTimeout)\n\t\t{\n\t\t\tthis.refreshLayoutTimeout = clearTimeout(this.refreshLayoutTimeout);\n\t\t}\n\n\t\tthis.refreshLayoutTimeout = setTimeout(function()\n\t\t{\n\t\t\t// Update settings and inputs\n\t\t\tfor (let k in this.complexFields)\n\t\t\t{\n\t\t\t\tif (this.complexFields.hasOwnProperty(k) && Type.isFunction(this.complexFields[k].getValue))\n\t\t\t\t{\n\t\t\t\t\tthis.settingsData[k] = this.complexFields[k].getValue();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.updateSettingsDataInputs();\n\n\t\t\t// Refresh preview\n\t\t\tthis.previewFieldLayout.refreshLayout(this.settingsData);\n\t\t\t// Refresh form layout (behind the settings popup)\n\t\t\tthis.fieldLayout.refreshLayout(this.settingsData);\n\n\t\t\t// Small Hack to make form look better - height adjusment\n\t\t\tthis.previewFieldLayout.getOuterWrap().style.maxHeight = Math.round(this.previewFieldLayout.getInnerWrap().offsetHeight * 0.73) + 'px';\n\t\t}.bind(this), 100);\n\t}\n\n\tbuildComplexField(type, params)\n\t{\n\t\tswitch(type)\n\t\t{\n\t\t\tcase 'users':\n\t\t\t\tthis.complexFields[type] = new UserSelectorFieldTunner();\n\t\t\t\tbreak;\n\t\t\tcase 'resources':\n\t\t\t\tthis.complexFields[type] = new ResourceSelectorFieldTunner();\n\t\t\t\tbreak;\n\t\t\tcase 'services':\n\t\t\t\tthis.complexFields[type] = new ServiceSelectorFieldTunner();\n\t\t\t\tbreak;\n\t\t\tcase 'duration':\n\t\t\t\tthis.complexFields[type] = new DurationSelectorFieldTunner();\n\t\t\t\tbreak;\n\t\t\tcase 'date':\n\t\t\t \tthis.complexFields[type] = new DateSelectorFieldTunner();\n\t\t\t \tbreak;\n\t\t\tcase 'time':\n\t\t\t\tthis.complexFields[type] = new TimeSelectorFieldTunner();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (Type.isObject(this.complexFields[type]))\n\t\t{\n\t\t\tthis.complexFields[type].build(params);\n\t\t}\n\t}\n\n\tstatic getSettingsData(data)\n\t{\n\t\tlet\n\t\t\tfield, option,\n\t\t\tsettingsData = BX.clone(AdjustFieldController.getDefaultSettingsData(), true);\n\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tfor (field in data)\n\t\t\t{\n\t\t\t\tif (data.hasOwnProperty(field) && settingsData[field])\n\t\t\t\t{\n\t\t\t\t\tif (Type.isPlainObject(data[field]))\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (option in data[field])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (data[field].hasOwnProperty(option))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsettingsData[field][option] = data[field][option];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tsettingsData[field] = data[field];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn settingsData;\n\t}\n\n\tstatic getDefaultSettingsData()\n\t{\n\t\treturn {\n\t\t\tusers : {\n\t\t\t\tshow: 'Y',\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_USERS_LABEL'),\n\t\t\t\tdefaultMode: 'auto', // none|auto\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tresources: {\n\t\t\t\tshow: 'Y',\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_RESOURCES_LABEL'),\n\t\t\t\tdefaultMode: 'auto', // none|auto\n\t\t\t\tmultiple: 'N',\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tservices: {\n\t\t\t\tshow: 'Y',\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_SERVICE_LABEL'),\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tduration: {\n\t\t\t\tshow: 'Y',\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_DURATION_LABEL'),\n\t\t\t\tdefaultValue: 60,\n\t\t\t\tmanualInput: 'N'\n\t\t\t},\n\t\t\tdate: {\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_DATE_LABEL'),\n\t\t\t\tstyle: 'line', // line|popup\n\t\t\t\tstart: 'today'\n\t\t\t},\n\t\t\ttime: {\n\t\t\t\tlabel: Loc.getMessage('WEBF_RES_TIME_LABEL'),\n\t\t\t\tstyle: 'slots',\n\t\t\t\tshowOnlyFree: 'Y',\n\t\t\t\tshowFinishTime: 'N',\n\t\t\t\tscale: 60\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedUsers()\n\t{\n\t\treturn this.settingsData && this.settingsData.users && Type.isString(this.settingsData.users.value) ? this.settingsData.users.value.split('|') : [];\n\t}\n\n\tupdateSettingsDataInputs()\n\t{\n\t\tlet field, option;\n\t\tfor (field in this.settingsData)\n\t\t{\n\t\t\tif (this.settingsData.hasOwnProperty(field))\n\t\t\t{\n\t\t\t\tif (Type.isPlainObject(this.settingsData[field]))\n\t\t\t\t{\n\t\t\t\t\tfor (option in this.settingsData[field])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.settingsData[field].hasOwnProperty(option))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.updateSettingsInputValue([field, option], this.settingsData[field][option]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.updateSettingsInputValue([field], this.settingsData[field]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateSettingsInputValue(key, value)\n\t{\n\t\tlet uniKey = key.join('-');\n\t\tif (!this.DOM.settingsInputs[uniKey])\n\t\t{\n\t\t\tthis.DOM.settingsInputs[uniKey] = this.DOM.settingsWrap.appendChild(Dom.create('input', {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\tname: this.params.formName + '[SETTINGS_DATA][' + key.join('][') + ']'\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\tvalue = value.join('|');\n\t\t}\n\n\t\tthis.DOM.settingsInputs[uniKey].value = value;\n\t}\n\n\tshowFieldLoader()\n\t{\n\t\tif (this.DOM.innerWrap)\n\t\t{\n\t\t\tthis.hideFieldLoader();\n\t\t\tthis.DOM.fieldLoader = this.DOM.innerWrap.appendChild(BookingUtil.getLoader(100));\n\t\t}\n\t}\n\n\thideFieldLoader()\n\t{\n\t\tDom.remove(this.DOM.fieldLoader);\n\t}\n\n\tgetSettings()\n\t{\n\t\tif (!this.params.settings.userfieldSettings)\n\t\t{\n\t\t\tthis.params.settings.userfieldSettings = {\n\t\t\t\tresources: this.userFieldParams.SETTINGS.SELECTED_RESOURCES,\n\t\t\t\tusers: this.userFieldParams.SETTINGS.SELECTED_USERS,\n\t\t\t\tservices: this.userFieldParams.SETTINGS.SERVICE_LIST,\n\t\t\t\tfullDay: this.userFieldParams.SETTINGS.FULL_DAY === 'Y',\n\t\t\t\tuseResources: this.userFieldParams.SETTINGS.USE_RESOURCES === 'Y'\n\t\t\t\t\t&& this.userFieldParams.SETTINGS.SELECTED_RESOURCES.length,\n\t\t\t\tuseUsers: this.userFieldParams.SETTINGS.USE_USERS === 'Y',\n\t\t\t\tuseServices: this.userFieldParams.SETTINGS.USE_SERVICES === 'Y',\n\t\t\t\tresourceLimit: this.userFieldParams.SETTINGS.RESOURCE_LIMIT,\n\t\t\t\tuserIndex: this.userFieldParams.SETTINGS.USER_INDEX\n\t\t\t}\n\t\t}\n\n\t\treturn this.params.settings;\n\t}\n\n\tupdateSettings(settings)\n\t{\n\t}\n\n\tgetCaption()\n\t{\n\t\treturn this.params.settings.caption;\n\t}\n\n\tupdateCaption()\n\t{\n\t\tlet caption = this.DOM.captionInput.value;\n\t\tif (this.params.settings.caption !== caption || !this.DOM.settingsInputs.caption)\n\t\t{\n\t\t\tthis.params.settings.caption = caption;\n\t\t\tif (this.previewFieldLayout)\n\t\t\t{\n\t\t\t\tthis.previewFieldLayout.updateTitle(this.params.settings.caption);\n\t\t\t}\n\n\t\t\t// Update title\n\t\t\tif (!this.DOM.settingsInputs.caption)\n\t\t\t{\n\t\t\t\tthis.DOM.settingsInputs.caption = this.DOM.settingsWrap.appendChild(Dom.create(\"input\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\ttype: \"hidden\",\n\t\t\t\t\t\tname: this.params.formName + '[CAPTION]'\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.DOM.settingsInputs.caption.value = this.params.settings.caption;\n\n\t\t\tif (this.DOM.captionNode)\n\t\t\t{\n\t\t\t\tDom.adjust(this.DOM.captionNode, {text: this.params.settings.caption});\n\t\t\t}\n\t\t}\n\t}\n\n\tisRequired()\n\t{\n\t\treturn this.params.settings.required === 'Y';\n\t}\n\n\tupdateRequiredValue()\n\t{\n\t\tthis.params.settings.required = this.DOM.requiredCheckbox.checked ? 'Y' : 'N';\n\t\tif (!this.DOM.settingsInputs.required)\n\t\t{\n\t\t\tthis.DOM.settingsInputs.required = this.DOM.settingsWrap.appendChild(Dom.create(\"input\", {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: \"hidden\",\n\t\t\t\t\tname: this.params.formName + '[REQUIRED]'\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tthis.DOM.settingsInputs.required.value = this.params.settings.required;\n\t}\n\n\tcheckBitrix24Limitation()\n\t{\n\t\tlet\n\t\t\tcount = 0,\n\t\t\tsettings = this.getSettings();\n\n\t\tif (Type.isArray(this.params.settings.userfieldSettings.resources))\n\t\t{\n\t\t\tcount += this.params.settings.userfieldSettings.resources.length;\n\t\t}\n\n\t\tif (settings.userfieldSettings.useUsers && this.complexFields.users)\n\t\t{\n\t\t\tlet usersValue = this.complexFields.users.getValue();\n\t\t\tif (usersValue && Type.isArray(usersValue.value))\n\t\t\t{\n\t\t\t\tcount += usersValue.value.length;\n\t\t\t}\n\t\t}\n\n\t\tif (settings.userfieldSettings.resourceLimit > 0 && count > settings.userfieldSettings.resourceLimit)\n\t\t{\n\t\t\tBookingUtil.showLimitationPopup();\n\t\t}\n\t}\n}","import { BookingUtil, Event, Loc, Dom } from 'calendar.resourcebooking';\n\nexport class UserSelectorFieldEditControl\n{\n\tconstructor(params)\n\t{\n\t\tthis.params = params || {};\n\t\tthis.id = this.params.id || 'user-selector-' + Math.round(Math.random() * 100000);\n\t\tthis.wrapNode = this.params.wrapNode;\n\t\tthis.destinationInputName = this.params.inputName || 'EVENT_DESTINATION';\n\t\tthis.params.selectGroups = false;\n\t\tthis.addMessage = this.params.addMessage || BX.message('USER_TYPE_RESOURCE_ADD_USER');\n\t\tthis.checkLimit = BX.type.isFunction(params.checkLimitCallback) ? params.checkLimitCallback : false;\n\n\t\tif (!this.params.itemsSelected)\n\t\t{\n\t\t\tthis.params.itemsSelected = this.getSocnetDestinationConfig('itemsSelected');\n\t\t}\n\n\t\tthis.DOM = {\n\t\t\touterWrap: this.params.outerWrap,\n\t\t\twrapNode: this.params.wrapNode\n\t\t};\n\n\t\tthis.create();\n\t}\n\n\tcreate ()\n\t{\n\t\tif (this.DOM.outerWrap)\n\t\t{\n\t\t\tDom.addClass(this.DOM.outerWrap, 'calendar-resourcebook-folding-block' + (this.params.shown !== false ? ' shown' : ''));\n\t\t}\n\n\t\tlet id = this.id;\n\n\t\tBX.bind(this.wrapNode, 'click', BX.delegate(function (e)\n\t\t{\n\t\t\tlet target = e.target || e.srcElement;\n\t\t\tif (target.className === 'calendar-resourcebook-content-block-control-delete') // Delete button\n\t\t\t{\n\t\t\t\tBX.SocNetLogDestination.deleteItem(target.getAttribute('data-item-id'), target.getAttribute('data-item-type'), id);\n\t\t\t\tlet block = BX.findParent(target, {className: 'calendar-resourcebook-content-block-control-inner'});\n\t\t\t\tif (block && BX.hasClass(block, 'shown'))\n\t\t\t\t{\n\t\t\t\t\tBX.removeClass(block, 'shown');\n\t\t\t\t\tsetTimeout(function(){BX.remove(block);}, 300);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.SocNetLogDestination.openDialog(id);\n\t\t\t}\n\t\t}, this));\n\n\t\tthis.socnetDestinationInputWrap = this.wrapNode.appendChild(BX.create('SPAN', {props: {className: 'calendar-resourcebook-destination-input-box'}}));\n\t\tthis.socnetDestinationInput = this.socnetDestinationInputWrap.appendChild(BX.create('INPUT', {\n\t\t\tprops: {\n\t\t\t\tid: id + '-inp',\n\t\t\t\tclassName: 'calendar-resourcebook-destination-input'\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tvalue: '',\n\t\t\t\ttype: 'text'\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tkeydown: function (e)\n\t\t\t\t{\n\t\t\t\t\treturn BX.SocNetLogDestination.searchBeforeHandler(e, {\n\t\t\t\t\t\tformName: id, inputId: id + '-inp'\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tkeyup: function (e)\n\t\t\t\t{\n\t\t\t\t\treturn BX.SocNetLogDestination.searchHandler(e, {\n\t\t\t\t\t\tformName: id,\n\t\t\t\t\t\tinputId: id + '-inp',\n\t\t\t\t\t\tlinkId: 'event-grid-dest-add-link',\n\t\t\t\t\t\tsendAjax: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis.socnetDestinationLink = this.wrapNode.appendChild(BX.create('DIV', {\n\t\t\tprops: {className: 'calendar-resourcebook-content-block-control-text calendar-resourcebook-content-block-control-text-add'},\n\t\t\ttext: this.addMessage\n\t\t}));\n\n\t\tthis.init();\n\t}\n\n\tshow ()\n\t{\n\t\tif (this.DOM.outerWrap)\n\t\t{\n\t\t\tDom.addClass(this.DOM.outerWrap, 'shown');\n\t\t}\n\t}\n\n\thide ()\n\t{\n\t\tif (this.DOM.outerWrap)\n\t\t{\n\t\t\tBX.removeClass(this.DOM.outerWrap, 'shown');\n\t\t}\n\t}\n\n\tisShown ()\n\t{\n\t\tif (this.DOM.outerWrap)\n\t\t{\n\t\t\treturn BX.hasClass(this.DOM.outerWrap, 'shown');\n\t\t}\n\t}\n\n\tinit ()\n\t{\n\t\tif (!this.socnetDestinationInput || !this.wrapNode)\n\t\t\treturn;\n\n\t\tlet _this = this;\n\n\t\tthis.params.items = this.getSocnetDestinationConfig('items');\n\t\tthis.params.itemsLast = this.getSocnetDestinationConfig('itemsLast');\n\n\t\tif (this.params.selectGroups === false)\n\t\t{\n\t\t\tthis.params.items.groups = {};\n\t\t\tthis.params.items.department = {};\n\t\t\tthis.params.items.sonetgroups = {};\n\t\t}\n\n\t\tBX.SocNetLogDestination.init({\n\t\t\tname: this.id,\n\t\t\tsearchInput: this.socnetDestinationInput,\n\t\t\textranetUser: false,\n\t\t\tuserSearchArea: 'I',\n\t\t\tbindMainPopup: {\n\t\t\t\tnode: this.wrapNode, offsetTop: '5px', offsetLeft: '15px'\n\t\t\t},\n\t\t\tbindSearchPopup: {\n\t\t\t\tnode: this.wrapNode, offsetTop: '5px', offsetLeft: '15px'\n\t\t\t},\n\t\t\tcallback: {\n\t\t\t\tselect: BX.proxy(this.selectCallback, this),\n\t\t\t\tunSelect: BX.proxy(this.unSelectCallback, this),\n\t\t\t\topenDialog: BX.proxy(this.openDialogCallback, this),\n\t\t\t\tcloseDialog: BX.proxy(this.closeDialogCallback, this),\n\t\t\t\topenSearch: BX.proxy(this.openDialogCallback, this),\n\t\t\t\tcloseSearch: function ()\n\t\t\t\t{\n\t\t\t\t\t_this.closeDialogCallback(true);\n\t\t\t\t}\n\t\t\t},\n\t\t\titems: this.params.items,\n\t\t\titemsLast: this.params.itemsLast,\n\t\t\titemsSelected: this.params.itemsSelected,\n\t\t\tdepartmentSelectDisable: this.params.selectGroups === false\n\t\t});\n\t}\n\n\tcloseAll ()\n\t{\n\t\tif (BX.SocNetLogDestination.isOpenDialog())\n\t\t{\n\t\t\tBX.SocNetLogDestination.closeDialog();\n\t\t}\n\t\tBX.SocNetLogDestination.closeSearch();\n\t}\n\n\tselectCallback(item, type)\n\t{\n\t\tif (type === 'users')\n\t\t{\n\t\t\tthis.addUserBlock(item);\n\t\t\tBX.onCustomEvent('OnResourceBookDestinationAddNewItem', [item, this.id]);\n\t\t\tthis.socnetDestinationInput.value = '';\n\t\t}\n\t}\n\n\taddUserBlock(item, animation)\n\t{\n\t\tif (this.checkLimit && !this.checkLimit())\n\t\t{\n\t\t\treturn BookingUtil.showLimitationPopup();\n\t\t}\n\n\t\tif (this.getAttendeesCodesList().includes(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst blocks = this.wrapNode.querySelectorAll(`calendar-resourcebook-content-block-control-inner[data-id='${item.id}']`);\n\t\tfor (let i = 0; i < blocks.length; i++)\n\t\t{\n\t\t\tBX.remove(blocks[i]);\n\t\t}\n\n\t\tconst itemWrap = this.wrapNode.appendChild(BX.create(\"DIV\", {\n\t\t\tattrs: {\n\t\t\t\t'data-id': item.id, className: \"calendar-resourcebook-content-block-control-inner green\"\n\t\t\t},\n\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-control-text\">' + item.name + '</div>' + '<div data-item-id=\"' + item.id + '\" data-item-type=\"users\" class=\"calendar-resourcebook-content-block-control-delete\"></div>' + '<input type=\"hidden\" name=\"' + this.destinationInputName + '[U][]' + '\" value=\"' + item.id + '\">'\n\t\t}));\n\n\t\tif (animation !== false)\n\t\t{\n\t\t\tsetTimeout(BX.delegate(function (){Dom.addClass(itemWrap, 'shown');}, this), 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(itemWrap, 'shown');\n\t\t}\n\n\t\tthis.wrapNode.appendChild(this.socnetDestinationInputWrap);\n\t\tthis.wrapNode.appendChild(this.socnetDestinationLink);\n\t}\n\n\tunSelectCallback(item)\n\t{\n\t\tlet elements = BX.findChildren(this.wrapNode, {attribute: {'data-id': item.id}}, true);\n\t\tif (elements != null)\n\t\t{\n\t\t\tfor (let j = 0; j < elements.length; j++)\n\t\t\t{\n\t\t\t\tBX.remove(elements[j]);\n\t\t\t}\n\t\t}\n\n\t\tBX.onCustomEvent('OnResourceBookDestinationUnselect', [item, this.id]);\n\t\tthis.socnetDestinationInput.value = '';\n\t\tthis.socnetDestinationLink.innerHTML = this.addMessage;\n\t}\n\n\topenDialogCallback ()\n\t{\n\t\tBX.style(this.socnetDestinationInputWrap, 'display', 'inline-block');\n\t\tBX.style(this.socnetDestinationLink, 'display', 'none');\n\t\tBX.focus(this.socnetDestinationInput);\n\t}\n\n\tcloseDialogCallback(cleanInputValue)\n\t{\n\t\tif (!BX.SocNetLogDestination.isOpenSearch() && this.socnetDestinationInput.value.length <= 0)\n\t\t{\n\t\t\tBX.style(this.socnetDestinationInputWrap, 'display', 'none');\n\t\t\tBX.style(this.socnetDestinationLink, 'display', 'inline-block');\n\t\t\tif (cleanInputValue === true)\n\t\t\t\tthis.socnetDestinationInput.value = '';\n\n\t\t\t// Disable backspace\n\t\t\tif (BX.SocNetLogDestination.backspaceDisable || BX.SocNetLogDestination.backspaceDisable != null)\n\t\t\t\tBX.unbind(window, 'keydown', BX.SocNetLogDestination.backspaceDisable);\n\n\t\t\tBX.bind(window, 'keydown', BX.SocNetLogDestination.backspaceDisable = function(e)\n\t\t\t{\n\t\t\t\tif (e.keyCode === 8)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsetTimeout(function()\n\t\t\t{\n\t\t\t\tBX.unbind(window, 'keydown', BX.SocNetLogDestination.backspaceDisable);\n\t\t\t\tBX.SocNetLogDestination.backspaceDisable = null;\n\t\t\t}, 5000);\n\t\t}\n\t}\n\n\tgetCodes()\n\t{\n\t\tlet\n\t\t\tinputsList = this.wrapNode.getElementsByTagName('INPUT'),\n\t\t\tcodes = [], i, value;\n\n\t\tfor (i = 0; i < inputsList.length; i++)\n\t\t{\n\t\t\tvalue = BX.util.trim(inputsList[i].value);\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tcodes.push(inputsList[i].value);\n\t\t\t}\n\t\t}\n\t\treturn codes;\n\t}\n\n\tgetAttendeesCodes()\n\t{\n\t\tlet\n\t\t\tinputsList = this.wrapNode.getElementsByTagName('INPUT'),\n\t\t\tvalues = [],\n\t\t\ti;\n\n\t\tfor (i = 0; i < inputsList.length; i++)\n\t\t{\n\t\t\tvalues.push(inputsList[i].value);\n\t\t}\n\n\t\treturn this.convertAttendeesCodes(values);\n\t}\n\n\tconvertAttendeesCodes(values)\n\t{\n\t\tlet attendeesCodes = {};\n\n\t\tif (BX.type.isArray(values))\n\t\t{\n\t\t\tvalues.forEach(function(code){\n\t\t\t\tif (code.substr(0, 2) === 'DR')\n\t\t\t\t{\n\t\t\t\t\tattendeesCodes[code] = \"department\";\n\t\t\t\t}\n\t\t\t\telse if (code.substr(0, 2) === 'UA')\n\t\t\t\t{\n\t\t\t\t\tattendeesCodes[code] = \"groups\";\n\t\t\t\t}\n\t\t\t\telse if (code.substr(0, 2) === 'SG')\n\t\t\t\t{\n\t\t\t\t\tattendeesCodes[code] = \"sonetgroups\";\n\t\t\t\t}\n\t\t\t\telse if (code.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tattendeesCodes[code] = \"users\";\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn attendeesCodes;\n\t}\n\n\tgetAttendeesCodesList(codes)\n\t{\n\t\tlet result = [];\n\t\tif (!codes)\n\t\t\tcodes = this.getAttendeesCodes();\n\t\tfor (let i in codes)\n\t\t{\n\t\t\tif (codes.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tresult.push(i);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSocnetDestinationConfig(key)\n\t{\n\t\tlet\n\t\t\tres,\n\t\t\tsocnetDestination = this.params.socnetDestination || {};\n\n\t\tif (key === 'items')\n\t\t{\n\t\t\tres = {\n\t\t\t\tusers: socnetDestination.USERS || {},\n\t\t\t\tgroups: socnetDestination.EXTRANET_USER === 'Y' || socnetDestination.DENY_TOALL\n\t\t\t\t\t? {}\n\t\t\t\t\t: {UA: {id: 'UA', name: BX.message('USER_TYPE_RESOURCE_TO_ALL_USERS')}},\n\t\t\t\tsonetgroups: socnetDestination.SONETGROUPS || {},\n\t\t\t\tdepartment: socnetDestination.DEPARTMENT || {},\n\t\t\t\tdepartmentRelation: socnetDestination.DEPARTMENT_RELATION || {}\n\t\t\t};\n\t\t}\n\t\telse if (key === 'itemsLast' && socnetDestination.LAST)\n\t\t{\n\t\t\tres = {\n\t\t\t\tusers: socnetDestination.LAST.USERS || {},\n\t\t\t\tgroups: socnetDestination.EXTRANET_USER === 'Y' ? {} : {UA: true},\n\t\t\t\tsonetgroups: socnetDestination.LAST.SONETGROUPS || {},\n\t\t\t\tdepartment: socnetDestination.LAST.DEPARTMENT || {}\n\t\t\t};\n\t\t}\n\t\telse if (key === 'itemsSelected')\n\t\t{\n\t\t\tres = socnetDestination.SELECTED || {};\n\t\t}\n\t\treturn res || {};\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\tlet\n\t\t\tresult = [], i,\n\t\t\tinputs = this.wrapNode.querySelectorAll('input');\n\n\t\tfor (i = 0; i < inputs.length; i++)\n\t\t{\n\t\t\tif (inputs[i].type === 'hidden' && inputs[i].value)\n\t\t\t{\n\t\t\t\tif (inputs[i].value.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tresult.push(parseInt(inputs[i].value.substr(1)));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetValues(userList, trigerOnChange)\n\t{\n\t\tlet i, user;\n\t\tconst blocks = this.wrapNode.querySelectorAll('.calendar-resourcebook-content-block-control-inner');\n\t\tfor (i = 0; i < blocks.length; i++)\n\t\t{\n\t\t\tBX.remove(blocks[i]);\n\t\t}\n\n\t\tfor (i = 0; i < userList.length; i++)\n\t\t{\n\t\t\tif (BX.SocNetLogDestination.obItems[this.id]['users'])\n\t\t\t{\n\t\t\t\tuser = BX.SocNetLogDestination.obItems[this.id]['users']['U' + userList[i]];\n\t\t\t\tif (user)\n\t\t\t\t{\n\t\t\t\t\tthis.addUserBlock({\n\t\t\t\t\t\tid: 'U' + userList[i],\n\t\t\t\t\t\tname: user.name\n\t\t\t\t\t}, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (trigerOnChange !== false && this.onChangeCallback && BX.type.isFunction(this.onChangeCallback))\n\t\t{\n\t\t\tsetTimeout(BX.proxy(this.onChangeCallback, this), 100);\n\t\t}\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n}","import {BookingUtil} from \"calendar.resourcebooking\";\n\nexport class ResourceSelectorFieldEditControl\n{\n\tconstructor(params)\n\t{\n\t\tthis.params = params || {};\n\t\tthis.editMode = !!this.params.editMode;\n\t\tthis.id = this.params.id || 'resource-selector-' + Math.round(Math.random() * 100000);\n\t\tthis.resourceList = BX.type.isArray(params.resourceList) ? params.resourceList : [];\n\t\tthis.checkLimit = BX.type.isFunction(params.checkLimitCallback) ? params.checkLimitCallback : false;\n\t\tthis.checkLimitForNew = BX.type.isFunction(params.checkLimitCallbackForNew) ? params.checkLimitCallbackForNew : false;\n\n\t\tthis.selectedValues = [];\n\t\tthis.selectedValuesIndex = {};\n\n\t\tthis.selectedBlocks = [];\n\t\tthis.newValues = [];\n\n\t\tthis.DOM = {\n\t\t\touterWrap: this.params.outerWrap,\n\t\t\tblocksWrap: this.params.blocksWrap || false,\n\t\t\tlistWrap: this.params.listWrap\n\t\t};\n\n\t\tif (this.editMode)\n\t\t{\n\t\t\tthis.DOM.controlsWrap = this.params.controlsWrap;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.DOM.arrowNode = BX.create(\"span\", {props: {className: \"calendar-resourcebook-content-block-detail-icon calendar-resourcebook-content-block-detail-icon-arrow\"}});\n\t\t}\n\n\t\tthis.onChangeCallback = this.params.onChangeCallback || null;\n\n\t\tthis.create();\n\t\tthis.setValues(params.values);\n\t}\n\n\n\tcreate ()\n\t{\n\t\tBX.addClass(this.DOM.outerWrap, 'calendar-resourcebook-resource-list-wrap calendar-resourcebook-folding-block' + (this.params.shown !== false ? ' shown' : ''));\n\n\t\tif (this.editMode)\n\t\t{\n\t\t\tthis.DOM.addButton = this.DOM.controlsWrap.appendChild(BX.create(\"span\", {\n\t\t\t\tprops: {className: \"calendar-resource-content-block-add-link\"},\n\t\t\t\ttext: BX.message('USER_TYPE_RESOURCE_ADD'),\n\t\t\t\tevents: {click: BX.delegate(this.addResourceBlock, this)}\n\t\t\t}));\n\n\t\t\tif (this.resourceList.length > 0)\n\t\t\t{\n\t\t\t\tthis.DOM.selectButton = this.DOM.controlsWrap.appendChild(BX.create(\"span\", {\n\t\t\t\t\tprops: {className: \"calendar-resource-content-block-add-link\"},\n\t\t\t\t\ttext: BX.message('USER_TYPE_RESOURCE_SELECT'),\n\t\t\t\t\tevents: {click: BX.delegate(this.openResourcesPopup, this)}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.bind(this.DOM.blocksWrap, 'click', BX.delegate(this.handleBlockClick, this));\n\t\t}\n\t}\n\n\tshow ()\n\t{\n\t\tBX.addClass(this.DOM.outerWrap, 'shown');\n\t}\n\n\thide ()\n\t{\n\t\tthis.DOM.outerWrap.style.maxHeight = '';\n\t\tBX.removeClass(this.DOM.outerWrap, 'shown');\n\t}\n\n\tisShown ()\n\t{\n\t\treturn BX.hasClass(this.DOM.outerWrap, 'shown');\n\t}\n\n\thandleBlockClick (e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\n\t\tif (target)\n\t\t{\n\t\t\tlet blockValue = target.getAttribute('data-bx-remove-block');\n\t\t\tif (blockValue)\n\t\t\t{\n\t\t\t\t// Remove from blocks\n\t\t\t\tthis.selectedBlocks.find(function(element, index)\n\t\t\t\t{\n\t\t\t\t\tif (element.value === blockValue)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.removeClass(element.wrap, 'shown');\n\t\t\t\t\t\tsetTimeout(BX.delegate(function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.remove(element.wrap)\n\t\t\t\t\t\t}, this), 300);\n\n\t\t\t\t\t\tthis.selectedBlocks = BX.util.deleteFromArray(this.selectedBlocks, index);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\t// Remove from values\n\t\t\t\tthis.selectedValues.find(function(element, index)\n\t\t\t\t{\n\t\t\t\t\tif (element.title === blockValue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectedValues = BX.util.deleteFromArray(this.selectedValues, index);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\tif (BX.type.isFunction(this.onChangeCallback))\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(BX.proxy(this.onChangeCallback, this), 100);\n\t\t\t\t}\n\n\t\t\t\tthis.checkBlockWrapState();\n\t\t\t}\n\n\t\t\tif (!blockValue)\n\t\t\t{\n\t\t\t\tthis.openResourcesPopup();\n\t\t\t}\n\t\t}\n\t}\n\n\topenResourcesPopup ()\n\t{\n\t\tif (!this.resourceList.length)\n\t\t{\n\t\t\treturn this.addResourceBlock();\n\t\t}\n\n\t\tif (this.isResourcesPopupShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menuItems = [];\n\n\t\tthis.resourceList.forEach(function(resource)\n\t\t{\n\t\t\tif (resource.deleted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.util.htmlspecialchars(resource.title),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: resource.type,\n\t\t\t\t\tid: resource.id,\n\t\t\t\t\ttitle: resource.title\n\t\t\t\t},\n\t\t\t\tonclick: BX.delegate(function(e, menuItem)\n\t\t\t\t{\n\t\t\t\t\tlet\n\t\t\t\t\t\tselectAllcheckbox,\n\t\t\t\t\t\ttarget = e.target || e.srcElement,\n\t\t\t\t\t\tcheckbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox'),\n\t\t\t\t\t\tfoundResource = this.resourceList.find(function(resource)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn parseInt(resource.id) === parseInt(menuItem.dataset.id)\n\t\t\t\t\t\t\t\t&& resource.type === menuItem.dataset.type;\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\tif (foundResource)\n\t\t\t\t\t{\n\t\t\t\t\t\t// Complete removing of the resource\n\t\t\t\t\t\tif (target && BX.hasClass(target, \"calendar-resourcebook-content-block-control-delete\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.removeResourceBlock({\n\t\t\t\t\t\t\t\tresource: foundResource,\n\t\t\t\t\t\t\t\ttrigerOnChange: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.selectedValues = this.getSelectedValues();\n\t\t\t\t\t\t\tthis.checkResourceInputs();\n\n\t\t\t\t\t\t\tselectAllcheckbox = this.popupContainer.querySelector('.menu-popup-item-all-resources-checkbox');\n\t\t\t\t\t\t\tthis.selectAllChecked = false;\n\t\t\t\t\t\t\tif (selectAllcheckbox)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tselectAllcheckbox.checked = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet menuItemNode = BX.findParent(target, {className: 'menu-popup-item'});\n\t\t\t\t\t\t\tif (menuItemNode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.addClass(menuItemNode, 'menu-popup-item-resource-remove-loader');\n\n\t\t\t\t\t\t\t\tmenuItemNode.appendChild(BookingUtil.getLoader(25));\n\t\t\t\t\t\t\t\tlet textNode = menuItemNode.querySelector('.menu-popup-item-text');\n\t\t\t\t\t\t\t\tif (textNode)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttextNode.innerHTML = BX.message('USER_TYPE_RESOURCE_DELETING');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfoundResource.deleted = true;\n\t\t\t\t\t\t\tsetTimeout(BX.delegate(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (menuItemNode)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmenuItemNode.style.maxHeight = '0';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (!this.resourceList.find(function(resource){return !resource.deleted;}))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tBX.PopupMenu.destroy(this.id);\n\t\t\t\t\t\t\t\t\tthis.DOM.selectButton.style.opacity = 0;\n\n\t\t\t\t\t\t\t\t\tsetTimeout(BX.delegate(function(){BX.remove(this.DOM.selectButton);}, this), 500);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, this), 500);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (target && (BX.hasClass(target, \"menu-popup-item\") || BX.hasClass(target, \"menu-popup-item-resource-checkbox\") || BX.hasClass(target, \"menu-popup-item-inner\") ))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!BX.hasClass(target, \"menu-popup-item-resource-checkbox\"))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (checkbox.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.addResourceBlock({\n\t\t\t\t\t\t\t\t\tresource: foundResource,\n\t\t\t\t\t\t\t\t\tvalue: foundResource.title,\n\t\t\t\t\t\t\t\t\ttrigerOnChange: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.selectedValues = this.getSelectedValues();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.removeResourceBlock({\n\t\t\t\t\t\t\t\t\tresource: foundResource,\n\t\t\t\t\t\t\t\t\ttrigerOnChange: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.selectedValues = this.getSelectedValues();\n\t\t\t\t\t\t\t\tthis.checkResourceInputs();\n\n\t\t\t\t\t\t\t\tselectAllcheckbox = this.popupContainer.querySelector('.menu-popup-item-all-resources-checkbox');\n\t\t\t\t\t\t\t\tthis.selectAllChecked = false;\n\t\t\t\t\t\t\t\tif (selectAllcheckbox)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselectAllcheckbox.checked = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, this)\n\t\t\t});\n\t\t}, this);\n\n\t\tif (menuItems.length > 1)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.message('USER_TYPE_RESOURCE_SELECT_ALL'),\n\t\t\t\tonclick: BX.delegate(function(e, menuItem)\n\t\t\t\t{\n\t\t\t\t\tlet target = e.target || e.srcElement;\n\t\t\t\t\tif (target && (BX.hasClass(target, \"menu-popup-item\") || BX.hasClass(target, \"menu-popup-item-resource-checkbox\")))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet checkbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox');\n\n\t\t\t\t\t\tif (BX.hasClass(target, \"menu-popup-item\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet i, checkboxes = this.popupContainer.querySelectorAll('input.menu-popup-item-resource-checkbox');\n\t\t\t\t\t\tthis.selectAllChecked = checkbox.checked;\n\n\t\t\t\t\t\tfor (i = 0; i < checkboxes.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcheckboxes[i].checked = this.selectAllChecked;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.resourceList.forEach(function(resource){\n\t\t\t\t\t\t\tif (resource.deleted)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.selectAllChecked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.addResourceBlock({\n\t\t\t\t\t\t\t\t\tresource: resource,\n\t\t\t\t\t\t\t\t\tvalue: resource.title,\n\t\t\t\t\t\t\t\t\ttrigerOnChange: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.removeResourceBlock({\n\t\t\t\t\t\t\t\t\tresource: resource,\n\t\t\t\t\t\t\t\t\ttrigerOnChange: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\t\tthis.selectedValues = this.getSelectedValues();\n\t\t\t\t\t\tthis.checkResourceInputs();\n\t\t\t\t\t}\n\t\t\t\t}, this)\n\t\t\t});\n\t\t}\n\n\t\tthis.popup = BX.PopupMenu.create(\n\t\t\tthis.id,\n\t\t\tthis.DOM.selectButton || this.DOM.blocksWrap,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tclassName: 'popup-window-resource-select',\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.show(true);\n\t\tthis.popupContainer = this.popup.popupWindow.popupContainer;\n\t\tif (!this.editMode)\n\t\t{\n\t\t\tthis.popupContainer.style.width = parseInt(this.DOM.blocksWrap.offsetWidth) + 'px';\n\t\t}\n\n\t\tBX.addCustomEvent(this.popup.popupWindow, 'onPopupClose', BX.proxy(function(){BX.PopupMenu.destroy(this.id);}, this));\n\n\t\tthis.popup.menuItems.forEach(function(menuItem)\n\t\t{\n\t\t\tlet checked;\n\t\t\tif (menuItem.dataset && menuItem.dataset.type)\n\t\t\t{\n\t\t\t\tchecked = this.selectedValues.find(function(item)\n\t\t\t\t{\n\t\t\t\t\treturn parseInt(item.id) === parseInt(menuItem.dataset.id)\n\t\t\t\t\t\t&& item.type === menuItem.dataset.type;\n\t\t\t\t});\n\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item';\n\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox\" type=\"checkbox\"' + (checked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + BX.util.htmlspecialchars(menuItem.dataset.title) + '</label>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t(this.editMode ? '<div class=\"calendar-resourcebook-content-block-control-delete\"></div>' : '') +\n\t\t\t\t\t'</div>';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectAllChecked = !this.resourceList.find(function(resource){\n\t\t\t\t\treturn !this.selectedValues.find(function(item)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn parseInt(item.id) === parseInt(resource.id)\n\t\t\t\t\t\t\t&& item.type === resource.type\n\t\t\t\t\t});\n\t\t\t\t},this);\n\n\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item menu-popup-item-resource-all';\n\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox menu-popup-item-all-resources-checkbox\" type=\"checkbox\"' + (this.selectAllChecked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + BX.message('USER_TYPE_RESOURCE_SELECT_ALL') + '</label>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>';\n\t\t\t}\n\t\t}, this);\n\n\t\tsetTimeout(BX.delegate(function(){\n\t\t\tBX.bind(document, 'click', BX.proxy(this.handleClick, this));\n\t\t}, this), 50);\n\t}\n\n\taddResourceBlock(params)\n\t{\n\t\tif (!BX.type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif ((params.resource && (this.checkLimit && !this.checkLimit() && window.B24))\n\t\t\t||\n\t\t\t(!params.resource && (this.checkLimitForNew && !this.checkLimitForNew() && window.B24)))\n\t\t{\n\t\t\treturn BookingUtil.showLimitationPopup();\n\t\t}\n\n\t\tlet\n\t\t\t_this = this,\n\t\t\tblockEntry;\n\n\t\tif (this.editMode)\n\t\t{\n\t\t\tif (params.resource && this.selectedValues.find(function(val)\n\t\t\t{\n\t\t\t\treturn val.id && parseInt(val.id) === parseInt(params.resource.id)\n\t\t\t\t\t&& val.type === params.resource.type;\n\t\t\t}))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!params.value)\n\t\t\t{\n\t\t\t\tparams.value = '';\n\t\t\t}\n\n\t\t\tblockEntry = {\n\t\t\t\tvalue: params.value,\n\t\t\t\twrap : this.DOM.listWrap\n\t\t\t\t\t.appendChild(BX.create(\"div\", {props:{className: \"calendar-resourcebook-content-block-detail calendar-resourcebook-outer-resource-wrap\"}}))\n\t\t\t\t\t.appendChild(BX.create(\"div\", {props:{className: \"calendar-resourcebook-content-block-detail-resource\"}}))\n\t\t\t\t\t.appendChild(BX.create(\"div\", {props:{className: \"calendar-resourcebook-content-block-detail-resource-inner calendar-resourcebook-content-block-detail-resource-inner-wide\"}}))\n\t\t\t};\n\n\t\t\tblockEntry.input = blockEntry.wrap.appendChild(BX.create(\"input\", {\n\t\t\t\tprops:{\n\t\t\t\t\tclassName: \"calendar-resourcebook-content-input\",\n\t\t\t\t\tvalue: params.value,\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tplaceholder: BX.message('USER_TYPE_RESOURCE_NAME')\n\t\t\t\t},\n\t\t\t\tdataset: {\n\t\t\t\t\tresourceType: params.resource ? params.resource.type : '',\n\t\t\t\t\tresourceId: params.resource ? params.resource.id : ''\n\t\t\t\t}\n\t\t\t}));\n\t\t\tblockEntry.delButton = blockEntry.wrap.appendChild(BX.create(\"div\", {\n\t\t\t\tprops:{className: \"calendar-resourcebook-content-block-control-delete\"},\n\t\t\t\tevents: {click(){\n\t\t\t\t\t\tBX.remove(BX.findParent(this, {className: 'calendar-resourcebook-outer-resource-wrap'}));\n\t\t\t\t\t\t_this.selectedValues = _this.getSelectedValues();\n\t\t\t\t\t\t_this.checkResourceInputs();\n\t\t\t\t\t}}\n\t\t\t}));\n\n\t\t\tif (params.focusInput !== false)\n\t\t\t{\n\t\t\t\tBX.focus(blockEntry.input);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (params.value && this.selectedBlocks.find(function(val){return val.value && val.value === params.value;}))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tblockEntry = {\n\t\t\t\tvalue: params.value,\n\t\t\t\tresource: params.resource || false,\n\t\t\t\twrap : this.DOM.blocksWrap.appendChild(BX.create(\"div\", {\n\t\t\t\t\tprops:{\n\t\t\t\t\t\tclassName: \"calendar-resourcebook-content-block-control-inner\"\n\t\t\t\t\t\t\t+ (params.animation ? '' : ' shown')\n\t\t\t\t\t\t\t+ (params.transparent ? ' transparent' : '')\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-control-text\"},\n\t\t\t\t\t\t\ttext: params.value || ''\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tattrs: {'data-bx-remove-block': params.value},\n\t\t\t\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-control-delete\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}))\n\t\t\t};\n\n\t\t\tthis.selectedBlocks.push(blockEntry);\n\n\t\t\t// Show it with animation\n\t\t\tif (params.animation)\n\t\t\t{\n\t\t\t\tsetTimeout(BX.delegate(function ()\n\t\t\t\t{\n\t\t\t\t\tBX.addClass(blockEntry.wrap, 'shown');\n\t\t\t\t}, this), 1);\n\t\t\t}\n\n\t\t\tif (params.trigerOnChange !== false && this.onChangeCallback && BX.type.isFunction(this.onChangeCallback))\n\t\t\t{\n\t\t\t\tsetTimeout(BX.proxy(this.onChangeCallback, this), 100);\n\t\t\t}\n\n\t\t\tthis.checkBlockWrapState();\n\t\t}\n\n\t\t// Adjust outer wrap max height\n\t\tif (this.DOM.listWrap && this.DOM.outerWrap)\n\t\t{\n\t\t\tif (BX.hasClass(this.DOM.outerWrap, 'shown'))\n\t\t\t{\n\t\t\t\tthis.DOM.outerWrap.style.maxHeight = Math.max(10000, this.DOM.listWrap.childNodes.length * 45 + 100) + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.outerWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}\n\n\t\treturn blockEntry;\n\t}\n\n\tremoveResourceBlock(params)\n\t{\n\t\tif (this.editMode)\n\t\t{\n\t\t\tlet\n\t\t\t\tresourceType, resourceId,\n\t\t\t\ti, inputs = this.DOM.listWrap.querySelectorAll('.calendar-resourcebook-content-input');\n\n\t\t\tfor (i = 0; i < inputs.length; i++)\n\t\t\t{\n\t\t\t\tresourceType = inputs[i].getAttribute('data-resource-type');\n\t\t\t\tresourceId = inputs[i].getAttribute('data-resource-id');\n\t\t\t\tif (resourceType === params.resource.type && parseInt(resourceId) === parseInt(params.resource.id))\n\t\t\t\t{\n\t\t\t\t\tBX.remove(BX.findParent(inputs[i], {className: 'calendar-resourcebook-outer-resource-wrap'}));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (params.resource)\n\t\t\t{\n\t\t\t\tthis.selectedBlocks.find(function(element, index)\n\t\t\t\t{\n\t\t\t\t\tif (element.value === params.resource.title)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.removeClass(element.wrap, 'shown');\n\t\t\t\t\t\tsetTimeout(BX.delegate(function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.remove(element.wrap)\n\t\t\t\t\t\t}, this), 300);\n\n\t\t\t\t\t\tthis.selectedBlocks = BX.util.deleteFromArray(this.selectedBlocks, index);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t}\n\t\t\tthis.checkBlockWrapState();\n\n\t\t\tif (params.trigerOnChange !== false && this.onChangeCallback && BX.type.isFunction(this.onChangeCallback))\n\t\t\t{\n\t\t\t\tsetTimeout(BX.proxy(this.onChangeCallback, this), 100);\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckResourceInputs()\n\t{\n\t\tif (this.editMode)\n\t\t{\n\t\t\tif (!this.selectedValues.length)\n\t\t\t{\n\t\t\t\tthis.addResourceBlock({animation: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckBlockWrapState()\n\t{\n\t\tif (!this.editMode)\n\t\t{\n\t\t\tif (!this.selectedBlocks.length)\n\t\t\t{\n\t\t\t\tif (!this.DOM.emptyPlaceholder)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.emptyPlaceholder = this.DOM.blocksWrap.appendChild(\n\t\t\t\t\t\tBX.create(\"DIV\", {\n\t\t\t\t\t\t\tprops : {className : \"calendar-resourcebook-content-block-control-empty\"},\n\t\t\t\t\t\t\thtml: '<span class=\"calendar-resourcebook-content-block-control-text\">' + BX.message('USER_TYPE_RESOURCE_LIST_PLACEHOLDER') + '</span>'\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.emptyPlaceholder.className = \"calendar-resourcebook-content-block-control-empty\";\n\t\t\t\t\tthis.DOM.blocksWrap.appendChild(this.DOM.emptyPlaceholder);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(BX.delegate(function(){\n\t\t\t\t\tif (BX.isNodeInDom(this.DOM.emptyPlaceholder))\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.addClass(this.DOM.emptyPlaceholder, 'show');\n\t\t\t\t\t}\n\t\t\t\t}, this), 50);\n\t\t\t}\n\t\t\telse if (this.DOM.emptyPlaceholder)\n\t\t\t{\n\t\t\t\tBX.remove(this.DOM.emptyPlaceholder);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (this.isResourcesPopupShown() && !BX.isParentForNode(this.popupContainer, target)\n\t\t)\n\t\t{\n\t\t\tthis.closeResourcesPopup({animation: true});\n\t\t}\n\t}\n\n\tisResourcesPopupShown()\n\t{\n\t\treturn this.popup && this.popup.popupWindow &&\n\t\t\tthis.popup.popupWindow.isShown && this.popup.popupWindow.isShown() &&\n\t\t\tthis.popup.popupWindow.popupContainer &&\n\t\t\tBX.isNodeInDom(this.popup.popupWindow.popupContainer)\n\t}\n\n\tcloseResourcesPopup(params)\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.popupContainer.style.maxHeight = '';\n\t\t\tBX.unbind(document, 'click', BX.proxy(this.handleClick, this));\n\t\t}\n\t}\n\n\tgetValues()\n\t{\n\t\treturn this.resourceList;\n\t}\n\n\taddToSelectedValues(value)\n\t{\n\t\tif (!this.selectedValues.find(function(val){return parseInt(val.id) === parseInt(value.id) && val.type === value.type;}))\n\t\t{\n\t\t\tthis.selectedValues.push(value);\n\t\t}\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\tthis.selectedValues = [];\n\t\tif (this.editMode)\n\t\t{\n\t\t\tlet\n\t\t\t\tresourceType, resourceId, i,\n\t\t\t\tinputs = this.DOM.listWrap.querySelectorAll('.calendar-resourcebook-content-input');\n\n\t\t\tfor (i = 0; i < inputs.length; i++)\n\t\t\t{\n\t\t\t\tresourceType = inputs[i].getAttribute('data-resource-type');\n\t\t\t\tresourceId = inputs[i].getAttribute('data-resource-id');\n\t\t\t\tif (resourceType && resourceId)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedValues.push({type: resourceType, id: resourceId, title: inputs[i].value});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.selectedValues.push({type: 'resource', title: inputs[i].value});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectedBlocks.forEach(function(element){\n\t\t\t\tthis.selectedValues.push({type: element.resource.type, id: element.resource.id});\n\t\t\t}, this);\n\t\t}\n\n\t\treturn this.selectedValues;\n\t}\n\n\tgetDeletedValues()\n\t{\n\t\treturn this.resourceList.filter(function(resource){return resource.deleted;});\n\t}\n\n\tsetValues(values, trigerOnChange)\n\t{\n\t\tthis.selectedBlocks.forEach(function(element){BX.remove(element.wrap);});\n\t\tthis.selectedBlocks = [];\n\t\ttrigerOnChange = trigerOnChange !== false;\n\n\t\tif (BX.type.isArray(values))\n\t\t{\n\t\t\tvalues.forEach(function(value)\n\t\t\t{\n\t\t\t\tlet foundResource = this.resourceList.find(function(resource)\n\t\t\t\t{\n\t\t\t\t\treturn parseInt(resource.id) === parseInt(value.id) && resource.type === value.type;\n\t\t\t\t}, this);\n\n\t\t\t\tif (foundResource)\n\t\t\t\t{\n\t\t\t\t\tthis.addResourceBlock({\n\t\t\t\t\t\tresource: foundResource,\n\t\t\t\t\t\tvalue: foundResource.title,\n\t\t\t\t\t\ttrigerOnChange: trigerOnChange\n\t\t\t\t\t});\n\t\t\t\t\tthis.addToSelectedValues(foundResource);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tif (this.editMode)\n\t\t{\n\t\t\tthis.selectedValues = this.getSelectedValues();\n\t\t\tthis.checkResourceInputs();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.DOM.arrowNode)\n\t\t\t{\n\t\t\t\tthis.DOM.blocksWrap.appendChild(this.DOM.arrowNode);\n\t\t\t}\n\t\t}\n\n\t\tthis.checkBlockWrapState();\n\t}\n}","import { Type, Dom, Event, BookingUtil } from \"calendar.resourcebooking\";\nimport { Popup } from 'main.popup';\n\nexport class PlannerPopup\n{\n\tconstructor(params)\n\t{\n\t}\n\n\tshow(params)\n\t{\n\t\tif (!params)\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tthis.params = params;\n\t\tthis.bindNode = params.bindNode;\n\t\tthis.plannerId = this.params.plannerId;\n\t\tthis.config = this.params.plannerConfig;\n\n\t\tif (this.isShown() || !this.bindNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.lastPlannerIdShown && this.lastPlannerIdShown !== this.plannerId)\n\t\t{\n\t\t\tthis.close({animation: false});\n\t\t}\n\n\t\tthis.currentEntries = [];\n\n\t\tthis.plannerWrap = Dom.create('DIV', {\n\t\t\tattrs: {\n\t\t\t\tid: this.plannerId,\n\t\t\t\tclassName: 'calendar-planner-wrapper'\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.popup = new Popup(this.plannerId + \"_popup\",\n\t\t\tthis.bindNode,\n\t\t\t{\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toffsetTop: - parseInt(this.bindNode.offsetHeight) - 20,\n\t\t\t\toffsetLeft: this.bindNode.offsetWidth + 38,\n\t\t\t\tlightShadow: true,\n\t\t\t\tcontent: this.plannerWrap\n\t\t\t})\n\n\t\tthis.popup.setAngle({offset: 100, position: 'left'});\n\t\tthis.popup.show();\n\t\t\n\t\tthis.lastPlannerIdShown = this.plannerId;\n\n\t\tlet\n\t\t\tbindPos = BX.pos(this.bindNode),\n\t\t\twinSize = BX.GetWindowSize();\n\n\t\tthis.plannerWidth = winSize.innerWidth - bindPos.right - 160;\n\t\tthis.config.width = this.plannerWidth;\n\t\t\n\t\tif (this.popup && this.popup.popupContainer)\n\t\t{\n\t\t\tDom.addClass(this.popup.popupContainer, 'calendar-resbook-planner-popup');\n\t\t\tDom.addClass(this.popup.popupContainer, 'show');\n\t\t\tthis.popup.popupContainer.style.width = (this.plannerWidth + 40) + 'px';\n\t\t\tEvent.bind(document, 'click', this.handleClick.bind(this));\n\t\t}\n\t\tthis.showPlanner();\n\n\t\tBX.addCustomEvent(this.popup, 'onPopupClose', this.close.bind(this));\n\t}\n\n\tupdate(params, refreshParams)\n\t{\n\t\tif (!this.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet\n\t\t\tcodes = [], i, k, code,\n\t\t\tcodeIndex = {},\n\t\t\tplannerConfig = BX.clone(this.config, true),\n\t\t\tfromTimestamp, toTimestamp,\n\t\t\tdateFrom, dateTo;\n\n\t\tif (Type.isPlainObject(this.lastUpdateParams) && Type.isPlainObject(params) && refreshParams !== true)\n\t\t{\n\t\t\tfor (k in params)\n\t\t\t{\n\t\t\t\tif (params.hasOwnProperty(k))\n\t\t\t\t{\n\t\t\t\t\tthis.lastUpdateParams[k] = params[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\tparams = this.lastUpdateParams;\n\t\t}\n\n\t\t// Save selector information\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.lastUpdateParams = params;\n\t\t}\n\n\t\tparams.focusSelector = params.focusSelector !== false;\n\n\t\tif (params.from && params.to)\n\t\t{\n\t\t\tdateFrom = BookingUtil.parseDate(params.from);\n\t\t\tdateTo = BookingUtil.parseDate(params.to);\n\t\t\tfromTimestamp = dateFrom.getTime();\n\t\t\ttoTimestamp = dateTo.getTime();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (params.selector.fullDay)\n\t\t\t{\n\t\t\t\tfromTimestamp = params.selector.from.getTime() - BookingUtil.getDayLength() * 12;\n\t\t\t\ttoTimestamp = params.selector.from.getTime() + BookingUtil.getDayLength() * 14;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfromTimestamp = params.selector.from.getTime() - BookingUtil.getDayLength() * 3;\n\t\t\t\ttoTimestamp = params.selector.from.getTime() + BookingUtil.getDayLength() * 5;\n\t\t\t}\n\n\t\t\tdateFrom = new Date(fromTimestamp);\n\t\t\tdateTo = new Date(toTimestamp);\n\n\t\t\tplannerConfig.scaleDateFrom = dateFrom;\n\t\t\tplannerConfig.scaleDateTo = dateTo;\n\t\t}\n\n\t\tif (Type.isArray(params.userList))\n\t\t{\n\t\t\tfor (i = 0; i < params.userList.length; i++)\n\t\t\t{\n\t\t\t\tcode = 'U' + params.userList[i].id;\n\t\t\t\tif (!codeIndex[code])\n\t\t\t\t{\n\t\t\t\t\tcodes.push(code);\n\t\t\t\t\tcodeIndex[code] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isArray(params.selectedUsers))\n\t\t{\n\t\t\tfor (i = 0; i < params.selectedUsers.length; i++)\n\t\t\t{\n\t\t\t\tcode = 'U' + params.selectedUsers[i];\n\t\t\t\tif (!codeIndex[code])\n\t\t\t\t{\n\t\t\t\t\tcodes.push(code);\n\t\t\t\t\tcodeIndex[code] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet requestData = {\n\t\t\tcodes: codes,\n\t\t\tresources: params.resourceList,\n\t\t\tfrom: BookingUtil.formatDate(null, fromTimestamp / 1000),\n\t\t\tto: BookingUtil.formatDate(null, toTimestamp / 1000),\n\t\t\tcurrentEventList: this.params.currentEventList || []\n\t\t};\n\n\t\tif (this.checkUpdateParams(requestData) && this.isShown())\n\t\t{\n\t\t\tthis.showPlannerLoader();\n\t\t\tBX.ajax.runAction('calendar.api.resourcebookingajax.getplannerdata', {\n\t\t\t\tdata: requestData\n\t\t\t}).then(function (response)\n\t\t\t\t{\n\t\t\t\t\tthis.hidePlannerLoader();\n\n\t\t\t\t\tif (this.lastRequestData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.lastRequestData.response = response;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.currentEntries = response.data.entries;\n\t\t\t\t\tthis.currentAccessibility = response.data.accessibility;\n\t\t\t\t\tthis.currentLoadedDataFrom = dateFrom;\n\t\t\t\t\tthis.currentLoadedDataTo = dateTo;\n\n\t\t\t\t\tif (Type.isArray(response.data.entries))\n\t\t\t\t\t{\n\t\t\t\t\t\tresponse.data.entries.forEach(function(entry)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentry.selected = ((entry.type === 'user'\n\t\t\t\t\t\t\t\t&& params.selectedUsers.find(function(userId){return parseInt(entry.id) === parseInt(userId);}))\n\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\t(entry.type === 'resource'\n\t\t\t\t\t\t\t\t\t&& params.selectedResources.find(function(item){return entry.type === item.type && parseInt(entry.id) === parseInt(item.id);}))\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isShown())\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.onCustomEvent('OnCalendarPlannerDoUpdate', [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tplannerId: this.plannerId,\n\t\t\t\t\t\t\t\tconfig: plannerConfig,\n\t\t\t\t\t\t\t\tfocusSelector: params.focusSelector,\n\t\t\t\t\t\t\t\tselector: {\n\t\t\t\t\t\t\t\t\tfrom: params.selector.from,\n\t\t\t\t\t\t\t\t\tto: params.selector.to,\n\t\t\t\t\t\t\t\t\tfullDay: params.selector.fullDay,\n\t\t\t\t\t\t\t\t\tanimation: params.focusSelector,\n\t\t\t\t\t\t\t\t\tupdateScaleLimits: params.focusSelector\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tentries: response.data.entries,\n\t\t\t\t\t\t\t\t\taccessibility: response.data.accessibility\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tloadedDataFrom: dateFrom,\n\t\t\t\t\t\t\t\tloadedDataTo: dateTo,\n\t\t\t\t\t\t\t\tshow: false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t}\n\t\telse if (Type.isPlainObject(this.lastRequestData.response))\n\t\t{\n\t\t\tlet response = this.lastRequestData.response;\n\t\t\tthis.currentEntries = response.data.entries;\n\t\t\tthis.currentAccessibility = response.data.accessibility;\n\t\t\tthis.currentLoadedDataFrom = dateFrom;\n\t\t\tthis.currentLoadedDataTo = dateTo;\n\n\t\t\tif (Type.isArray(response.data.entries))\n\t\t\t{\n\t\t\t\tresponse.data.entries.forEach(function(entry)\n\t\t\t\t{\n\t\t\t\t\tentry.selected = ((entry.type === 'user'\n\t\t\t\t\t\t&& params.selectedUsers.find(function(userId){return parseInt(entry.id) === parseInt(userId);}))\n\t\t\t\t\t\t||\n\t\t\t\t\t\t(entry.type === 'resource'\n\t\t\t\t\t\t\t&& params.selectedResources.find(function(item){return entry.type === item.type && parseInt(entry.id) === parseInt(item.id);}))\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.isShown())\n\t\t\t{\n\t\t\t\tBX.onCustomEvent('OnCalendarPlannerDoUpdate', [\n\t\t\t\t\t{\n\t\t\t\t\t\tplannerId: this.plannerId,\n\t\t\t\t\t\tconfig: plannerConfig,\n\t\t\t\t\t\tfocusSelector: params.focusSelector,\n\t\t\t\t\t\tselector: {\n\t\t\t\t\t\t\tfrom: params.selector.from,\n\t\t\t\t\t\t\tto: params.selector.to,\n\t\t\t\t\t\t\tfullDay: params.selector.fullDay,\n\t\t\t\t\t\t\tanimation: params.focusSelector,\n\t\t\t\t\t\t\tupdateScaleLimits: params.focusSelector\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tentries: response.data.entries,\n\t\t\t\t\t\t\taccessibility: response.data.accessibility\n\t\t\t\t\t\t},\n\t\t\t\t\t\tloadedDataFrom: dateFrom,\n\t\t\t\t\t\tloadedDataTo: dateTo,\n\t\t\t\t\t\tshow: false\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckUpdateParams (requestData)\n\t{\n\t\tlet requestPlannerUpdate = false;\n\t\tif (!this.lastRequestData || this.lastRequestPlannerId !== this.plannerId)\n\t\t{\n\t\t\trequestPlannerUpdate = true;\n\t\t}\n\n\t\t// 1. Compare dates\n\t\tif (!requestPlannerUpdate && requestData.from !== this.lastRequestData.from)\n\t\t{\n\t\t\trequestPlannerUpdate = true;\n\t\t}\n\t\t// 2. Compare users\n\t\tif (\n\t\t\t!requestPlannerUpdate\n\t\t\t&& Type.isArray(requestData.codes) && Type.isArray(this.lastRequestData.codes)\n\t\t\t&& BX.util.array_diff(requestData.codes, this.lastRequestData.codes).length > 0\n\t\t)\n\t\t{\n\t\t\trequestPlannerUpdate = true;\n\t\t}\n\n\t\t// 3. Compare resources\n\t\tif (!requestPlannerUpdate && Type.isArray(requestData.resources) && Type.isArray(this.lastRequestData.resources))\n\t\t{\n\t\t\tif (requestData.resources.length !== this.lastRequestData.resources.length)\n\t\t\t{\n\t\t\t\trequestPlannerUpdate = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet resIndex = {};\n\t\t\t\trequestData.resources.forEach(function (res)\n\t\t\t\t{\n\t\t\t\t\tresIndex[res.type + '_' + res.id] = true\n\t\t\t\t});\n\n\t\t\t\tthis.lastRequestData.resources.forEach(function(res)\n\t\t\t\t{\n\t\t\t\t\tif (!resIndex[res.type + '_' + res.id])\n\t\t\t\t\t{\n\t\t\t\t\t\trequestPlannerUpdate = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Save request data for future comparing\n\t\tif (requestPlannerUpdate)\n\t\t{\n\t\t\tthis.lastRequestData = requestData;\n\t\t\tthis.lastRequestPlannerId = this.plannerId;\n\t\t}\n\n\t\treturn requestPlannerUpdate;\n\t}\n\n\tshowPlanner()\n\t{\n\t\tthis.planner = new CalendarPlanner(\n\t\t\tthis.params.plannerConfig,\n\t\t\t{\n\t\t\t\tconfig: this.config,\n\t\t\t\tdata: {\n\t\t\t\t\taccessibility: this.currentAccessibility || {},\n\t\t\t\t\tentries: this.currentEntries\n\t\t\t\t},\n\t\t\t\tselector: {\n\t\t\t\t\tfrom: this.params.selector.from,\n\t\t\t\t\tto: this.params.selector.to,\n\t\t\t\t\tfullDay: this.params.selector.fullDay,\n\t\t\t\t\tupdateScaleLimits: true,\n\t\t\t\t\tupdateScaleType: false,\n\t\t\t\t\tfocus: true,\n\t\t\t\t\tRRULE: false,\n\t\t\t\t\tanimation: false\n\t\t\t\t},\n\t\t\t\tloadedDataFrom: this.currentLoadedDataFrom,\n\t\t\t\tloadedDataTo: this.currentLoadedDataTo,\n\t\t\t\tfocusSelector: true,\n\t\t\t\tplannerId: this.plannerId,\n\t\t\t\tshow: true\n\t\t\t}\n\t\t);\n\n\t\t// planner events\n\t\tif (Type.isFunction(this.params.selectorOnChangeCallback))\n\t\t{\n\t\t\tBX.addCustomEvent('OnCalendarPlannerSelectorChanged', this.params.selectorOnChangeCallback);\n\t\t}\n\t\tif (Type.isFunction(this.params.selectEntriesOnChangeCallback))\n\t\t{\n\t\t\tBX.addCustomEvent('OnCalendarPlannerSelectedEntriesOnChange', this.params.selectEntriesOnChangeCallback);\n\t\t}\n\t\tif (Type.isFunction(this.params.checkSelectorStatusCallback))\n\t\t{\n\t\t\tBX.addCustomEvent('OnCalendarPlannerSelectorStatusOnChange', this.params.checkSelectorStatusCallback);\n\t\t}\n\n\t\tBX.addCustomEvent('OnCalendarPlannerScaleChanged', BX.proxy(function(params)\n\t\t{\n\t\t\tthis.update({\n\t\t\t\tfrom: params.from,\n\t\t\t\tto: params.to,\n\t\t\t\tfocusSelector: params.focusSelector === true\n\t\t\t});\n\t\t}, this));\n\n\t}\n\n\tshowPlannerLoader()\n\t{\n\t\tif (this.planner && this.planner.outerWrap)\n\t\t{\n\t\t\tif (this.loader)\n\t\t\t{\n\t\t\t\tDom.remove(this.loader);\n\t\t\t}\n\t\t\tthis.loader = this.planner.outerWrap.appendChild(BookingUtil.getLoader(150));\n\t\t}\n\t}\n\n\thidePlannerLoader()\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tDom.remove(this.loader);\n\t\t\tthis.loader = false;\n\t\t}\n\t}\n\n\tclose(params)\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tif (params && params.animation)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.popup.popupContainer, 'show');\n\t\t\t\tsetTimeout(BX.delegate(function()\n\t\t\t\t{\n\t\t\t\t\tparams.animation = false;\n\t\t\t\t\tthis.close(params);\n\t\t\t\t}, this), 300);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.unbind(document, 'click', BX.proxy(this.handleClick, this));\n\t\t\t\tBX.removeCustomEvent(this.popup, 'onPopupClose', BX.proxy(this.close, this));\n\t\t\t\tthis.popup.destroy();\n\t\t\t\tthis.planner = null;\n\t\t\t\tthis.popup = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.lastPlannerIdShown === this.plannerId\n\t\t\t&& this.popup\n\t\t\t&& this.popup.isShown()\n\t\t;\n\t}\n\n\tgetPlannerId()\n\t{\n\t\tif (typeof this.plannerId === 'undefined')\n\t\t{\n\t\t\tthis.plannerId = 'calendar-planner-' + Math.round(Math.random() * 100000);\n\t\t}\n\t\treturn this.plannerId;\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (\n\t\t\tthis.isShown()\n\t\t\t&& !BX.isParentForNode(this.bindNode, target)\n\t\t\t&& !BX.isParentForNode(BX('BXSocNetLogDestination'), target)\n\t\t\t&& !BX.isParentForNode(this.popup.popupContainer, target)\n\t\t\t&& !Dom.hasClass(target, 'calendar-resourcebook-content-block-control-delete')\n\t\t)\n\t\t{\n\t\t\tif (!document.querySelector('div.popup-window-resource-select'))\n\t\t\t{\n\t\t\t\tthis.close({animation: true});\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n\n\n","import {BookingUtil, Dom, Loc, Event, Type, SelectInput} from \"calendar.resourcebooking\";\nimport {UserSelectorFieldEditControl} from \"./controls/userselectorfieldeditcontrol\";\nimport {ResourceSelectorFieldEditControl} from \"./controls/resourceselectorfieldeditcontrol\";\nimport {ResourcebookingUserfield} from \"calendar.resourcebookinguserfield\";\nimport {PlannerPopup} from \"./controls/plannerpopup\";\n\nexport class EditFieldController\n{\n\tconstructor(params)\n\t{\n\t\tthis.params = params;\n\t\tthis.plannerPopup = null;\n\n\t\tthis.DOM = {\n\t\t\touterWrap: BX(params.controlId),\n\t\t\tvalueInputs: []\n\t\t};\n\n\t\tthis.isNew = !this.params.value || !this.params.value.DATE_FROM;\n\n\t\tif (this.params.socnetDestination)\n\t\t{\n\t\t\tResourcebookingUserfield.setSocnetDestination(this.params.socnetDestination);\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.buildUserfieldWrap();\n\t\tthis.createEventHandlers();\n\t\tthis.setControlValues();\n\t}\n\n\tbuildUserfieldWrap()\n\t{\n\t\tthis.buildDateControl();\n\t\tthis.buildTimeControl();\n\t\tthis.buildServiceControl();\n\t\tthis.buildDurationControl();\n\t\tthis.buildUserSelectorControl();\n\t\tthis.buildResourceSelectorControl();\n\t}\n\n\tcreateEventHandlers()\n\t{\n\t\tEvent.bind(this.DOM.outerWrap, 'click',this.showPlannerPopup.bind(this));\n\t\tEvent.bind(this.DOM.fromInput, 'focus',this.showPlannerPopup.bind(this));\n\t\tEvent.bind(this.DOM.durationInput, 'focus',this.showPlannerPopup.bind(this));\n\n\t\tsetTimeout(function(){\n\t\t\tBX.onCustomEvent(window, 'onCrmEntityEditorUserFieldSetValidator',\n\t\t\t[\n\t\t\t\tthis.params.controlId,\n\t\t\t\tfunction(result)\n\t\t\t\t{\n\t\t\t\t\tif (!this.params.allowOverbooking && this.isOverbooked())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (result && result.addError && BX.Crm && BX.Crm.EntityValidationError)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}.bind(this)\n\t\t\t]);\n\t\t}.bind(this), 100);\n\n\t\tsetTimeout(this.onChangeValues.bind(this), 100);\n\t}\n\n\tsetControlValues()\n\t{\n\t\tthis.allValuesValue = null;\n\n\t\tlet\n\t\t\tdateFrom,\n\t\t\tduration,\n\t\t\tdefaultDuration = this.params.fullDay ? 1440 : 60, // One day or one hour as default\n\t\t\tdateTo;\n\n\t\tif (this.isNew)\n\t\t{\n\t\t\tlet params = ResourcebookingUserfield.getParamsFromHash(this.params.userfieldId);\n\t\t\tif (params && params.length > 1)\n\t\t\t{\n\t\t\t\tdateFrom = BX.parseDate(params[0]);\n\t\t\t\tdateTo = BX.parseDate(params[1]);\n\t\t\t\tif (dateFrom && dateTo)\n\t\t\t\t{\n\t\t\t\t\tduration = Math.round(Math.max((dateTo.getTime() - dateFrom.getTime()) / 60000, 0));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!dateFrom)\n\t\t\t{\n\t\t\t\tdateFrom = new Date();\n\t\t\t\tlet\n\t\t\t\t\troundMin = 30,\n\t\t\t\t\tr = (roundMin || 10) * 60 * 1000,\n\t\t\t\t\ttimestamp = Math.ceil(dateFrom.getTime() / r) * r;\n\t\t\t\tdateFrom = new Date(timestamp);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdateFrom = BX.parseDate(this.params.value.DATE_FROM);\n\t\t\tdateTo = BX.parseDate(this.params.value.DATE_TO);\n\t\t\tduration = Math.round(Math.max((dateTo.getTime() - dateFrom.getTime()) / 60000, 0));\n\t\t}\n\n\t\tif (!duration)\n\t\t{\n\t\t\tduration = defaultDuration;\n\t\t}\n\n\t\tthis.DOM.fromInput.value = BookingUtil.formatDate(BookingUtil.getDateFormat(), dateFrom);\n\t\tif (this.DOM.timeFromInput)\n\t\t{\n\t\t\tthis.DOM.timeFromInput.value = BookingUtil.formatDate(BookingUtil.getTimeFormatShort(), dateFrom);\n\t\t}\n\n\t\tif (this.durationList)\n\t\t{\n\t\t\tthis.durationList.setValue(duration);\n\t\t}\n\n\t\tif (this.serviceList)\n\t\t{\n\t\t\tthis.serviceList.setValue(this.params.value.SERVICE_NAME || '');\n\t\t}\n\n\t\tlet selectedUsers = [];\n\t\tlet selectedResources = [];\n\t\tif (this.params.value && Type.isArray(this.params.value.ENTRIES))\n\t\t{\n\t\t\tthis.params.value.ENTRIES.forEach(function(entry)\n\t\t\t{\n\t\t\t\tif (entry.TYPE === 'user')\n\t\t\t\t{\n\t\t\t\t\tselectedUsers.push(parseInt(entry.RESOURCE_ID));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tselectedResources.push({\n\t\t\t\t\t\tid: parseInt(entry.RESOURCE_ID),\n\t\t\t\t\t\ttype: entry.TYPE\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.resourceSelector)\n\t\t{\n\t\t\tthis.resourceSelector.setValues(selectedResources, false);\n\t\t}\n\n\t\tif (this.userSelector)\n\t\t{\n\t\t\tthis.userSelector.setValues(selectedUsers, false);\n\t\t}\n\t}\n\n\tbuildDateControl()\n\t{\n\t\tthis.DOM.dateTimeWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-detail-wrap calendar-resourcebook-content-block-detail-wrap-flex\"}}));\n\n\t\tthis.DOM.dateWrap = this.DOM.dateTimeWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-detail-inner calendar-resourcebook-content-block-detail-wrap-down\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: { className: \"calendar-resourcebook-content-block-detail\"},\n\t\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-title\"><span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_DATE_LABEL') + '</span></div>'\n\t\t\t}));\n\n\t\tthis.DOM.fromInput = this.DOM.dateWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs: {\n\t\t\t\tvalue: '',\n\t\t\t\tplaceholder: Loc.getMessage('USER_TYPE_RESOURCE_DATE_LABEL'),\n\t\t\t\ttype: 'text'\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: EditFieldController.showCalendarPicker,\n\t\t\t\tchange: this.triggerUpdatePlanner.bind(this)\n\t\t\t},\n\t\t\tprops: {className: 'calendar-resbook-date-input calendar-resbook-field-datetime'}\n\t\t}));\n\n\t\tthis.DOM.emptyInput = this.DOM.dateWrap.appendChild(Dom.create('INPUT', {attrs: {value: '',type: 'text'}, props: {className: 'calendar-resbook-empty-input'}}));\n\t}\n\n\tbuildTimeControl()\n\t{\n\t\tif (!this.params.fullDay)\n\t\t{\n\t\t\tthis.DOM.timeWrap = this.DOM.dateTimeWrap\n\t\t\t\t.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-detail-inner calendar-resourcebook-content-block-detail-wrap-down\"}}))\n\t\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-detail\"},\n\t\t\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-title\"><span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_TIME_LABEL') + '</span></div>'\n\t\t\t\t}));\n\n\t\t\tthis.DOM.timeFromInput = this.DOM.timeWrap.appendChild(Dom.create('INPUT', {\n\t\t\t\tattrs: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t\tplaceholder: Loc.getMessage('USER_TYPE_RESOURCE_TIME_LABEL'),\n\t\t\t\t\ttype: 'text'\n\t\t\t\t},\n\t\t\t\tstyle: {width: '100px'},\n\t\t\t\tprops: {className: 'calendar-resbook-date-input calendar-resbook-field-datetime-menu'}\n\t\t\t}));\n\n\t\t\tthis.fromTime = new SelectInput({\n\t\t\t\tinput: this.DOM.timeFromInput,\n\t\t\t\tvalues: BookingUtil.getSimpleTimeList(),\n\t\t\t\tonChangeCallback: this.triggerUpdatePlanner.bind(this),\n\t\t\t\tonAfterMenuOpen: (ind, popupMenu) => {\n\t\t\t\t\tif (!ind && popupMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst formatDatetime = BX.isAmPmMode()\n\t\t\t\t\t\t\t? Loc.getMessage(\"FORMAT_DATETIME\").replace(':SS', '')\n\t\t\t\t\t\t\t: Loc.getMessage(\"FORMAT_DATETIME\");\n\t\t\t\t\t\tconst dateFrom = BookingUtil.parseDate(\n\t\t\t\t\t\t\tthis.DOM.fromInput.value + ' ' + this.DOM.timeFromInput.value,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tformatDatetime\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlet i, menuItem;\n\t\t\t\t\t\tconst nearestTimeValue = BookingUtil.adaptTimeValue({\n\t\t\t\t\t\t\th: dateFrom.getHours(),\n\t\t\t\t\t\t\tm: dateFrom.getMinutes()\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (nearestTimeValue && nearestTimeValue.label)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (i = 0; i < popupMenu.menuItems.length; i++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmenuItem = popupMenu.menuItems[i];\n\t\t\t\t\t\t\t\tif (menuItem\n\t\t\t\t\t\t\t\t\t&& nearestTimeValue.label === menuItem.text\n\t\t\t\t\t\t\t\t\t&& menuItem.layout)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tpopupMenu.layout.menuContainer.scrollTop = menuItem.layout.item.offsetTop - 2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tbuildServiceControl()\n\t{\n\t\tif (this.params.useServices && Type.isArray(this.params.serviceList) && this.params.serviceList.length > 0)\n\t\t{\n\t\t\tif (this.params.fullDay)\n\t\t\t{\n\t\t\t\tthis.DOM.durationWrap = this.DOM.dateTimeWrap;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.durationWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail-wrap calendar-resourcebook-content-block-detail-wrap-flex\"}}));\n\t\t\t}\n\n\t\t\tthis.DOM.servicesWrap = this.DOM.durationWrap\n\t\t\t\t.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-detail-inner calendar-resourcebook-content-block-detail-wrap-down\"}}))\n\t\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block-detail\"},\n\t\t\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-title\"><span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_SERVICE_LABEL') + '</span></div>'\n\t\t\t\t}));\n\n\t\t\tthis.DOM.serviceInput = this.DOM.servicesWrap.appendChild(Dom.create('INPUT', {\n\t\t\t\tattrs: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t\t//value: this.params.value.SERVICE_NAME || '',\n\t\t\t\t\tplaceholder: Loc.getMessage('USER_TYPE_RESOURCE_SERVICE_LABEL'),\n\t\t\t\t\ttype: 'text'\n\t\t\t\t},\n\t\t\t\tstyle: {width: '200px'},\n\t\t\t\tprops: {className: 'calendar-resbook-date-input calendar-resbook-field-datetime-menu'}\n\t\t\t}));\n\n\t\t\tlet serviceListValues = [];\n\t\t\tthis.params.serviceList.forEach(function(service)\n\t\t\t{\n\t\t\t\tif (service.name !== '')\n\t\t\t\t{\n\t\t\t\t\tserviceListValues.push({value: service.duration, label: service.name});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.isNew && serviceListValues.length >= 1)\n\t\t\t{\n\t\t\t\tthis.DOM.serviceInput.value = serviceListValues[0].label;\n\t\t\t\t//duration = parseInt(serviceListValues[0].value);\n\t\t\t}\n\n\t\t\tthis.serviceList = new SelectInput({\n\t\t\t\tinput: this.DOM.serviceInput,\n\t\t\t\tvalues: serviceListValues,\n\t\t\t\tonChangeCallback: function(state)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isPlainObject(state) && state.realValue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.durationList.setValue(parseInt(state.realValue));\n\t\t\t\t\t\tthis.duration = BookingUtil.parseDuration(this.DOM.durationInput.value);\n\t\t\t\t\t\tthis.triggerUpdatePlanner();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t});\n\t\t}\n\t}\n\n\tbuildDurationControl()\n\t{\n\t\tif (!this.DOM.durationWrap)\n\t\t{\n\t\t\tthis.DOM.durationWrap = this.DOM.dateTimeWrap;\n\t\t}\n\n\t\t// region Duration\n\t\tthis.DOM.durationControlWrap = this.DOM.durationWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-detail-inner calendar-resourcebook-content-block-detail-wrap-down\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: { className: \"calendar-resourcebook-content-block-detail\"},\n\t\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-title\"><span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_DURATION_LABEL') + '</span></div>'\n\t\t\t}));\n\n\t\tthis.DOM.durationInput = this.DOM.durationControlWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs: {\n\t\t\t\t//value: duration,\n\t\t\t\tplaceholder: Loc.getMessage('USER_TYPE_RESOURCE_DURATION_LABEL'),\n\t\t\t\ttype: 'text'\n\t\t\t},\n\t\t\tstyle: {width: '90px'},\n\t\t\tprops: {className: 'calendar-resbook-date-input calendar-resbook-field-datetime-menu'}\n\t\t}));\n\n\t\t//this.duration = parseInt(duration);\n\t\tthis.durationList = new SelectInput({\n\t\t\tinput: this.DOM.durationInput,\n\t\t\tvalues: BookingUtil.getDurationList(this.params.fullDay),\n\t\t\t//value: duration,\n\t\t\tonChangeCallback: function()\n\t\t\t{\n\t\t\t\tthis.duration = BookingUtil.parseDuration(this.DOM.durationInput.value);\n\t\t\t\tthis.triggerUpdatePlanner();\n\t\t\t}.bind(this)\n\t\t});\n\t}\n\n\tbuildUserSelectorControl()\n\t{\n\t\tif (this.params.useUsers)\n\t\t{\n\t\t\tthis.DOM.userSelectorWrap = this.DOM.outerWrap.appendChild(Dom.create('DIV', {\n\t\t\t\tprops: {className: 'calendar-resbook-users-selector-wrap'}\n\t\t\t}));\n\n\t\t\tthis.DOM.userSelectorWrap = this.DOM.outerWrap.appendChild(Dom.create('DIV', {props: {className: 'calendar-resourcebook-content-block-control-field'}}));\n\t\t\t\n\t\t\tlet userSelectorTitle = Loc.getMessage('USER_TYPE_RESOURCE_USERS_CONTROL_DEFAULT_NAME');\n\t\t\tthis.DOM.userSelectorWrap\n\t\t\t\t.appendChild(Dom.create('DIV', {props: {className: 'calendar-resourcebook-content-block-title'}}))\n\t\t\t\t.appendChild(Dom.create('SPAN', {props: {className: 'calendar-resourcebook-content-block-title-text'}, text: userSelectorTitle}));\n\t\t\tthis.DOM.userListWrap = this.DOM.userSelectorWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-control custom-field-item\"}}));\n\n\t\t\tlet itemsSelected = {};\n\t\t\tif (this.params.value && Type.isArray(this.params.value.ENTRIES))\n\t\t\t{\n\t\t\t\tthis.params.value.ENTRIES.forEach(function(entry)\n\t\t\t\t{\n\t\t\t\t\tif (entry.TYPE === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst userKey = 'U' + parseInt(entry.RESOURCE_ID);\n\t\t\t\t\t\titemsSelected[userKey] = 'users';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.userSelector = new UserSelectorFieldEditControl({\n\t\t\t\twrapNode: this.DOM.userListWrap,\n\t\t\t\tsocnetDestination: ResourcebookingUserfield.getSocnetDestination(),\n\t\t\t\taddMessage: Loc.getMessage('USER_TYPE_RESOURCE_SELECT_USER'),\n\t\t\t\tcheckLimitCallback: this.checkResourceCountLimit.bind(this),\n\t\t\t\titemsSelected: itemsSelected,\n\t\t\t});\n\n\t\t\tBX.addCustomEvent('OnResourceBookDestinationAddNewItem', this.triggerUpdatePlanner.bind(this));\n\t\t\tBX.addCustomEvent('OnResourceBookDestinationUnselect', this.triggerUpdatePlanner.bind(this));\n\t\t}\n\t}\n\n\tbuildResourceSelectorControl()\n\t{\n\t\tif (this.params.useResources)\n\t\t{\n\t\t\tthis.DOM.resourcesWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\" }}));\n\n\t\t\tlet resSelectorTitle = Loc.getMessage('USER_TYPE_RESOURCE_RESOURCE_CONTROL_DEFAULT_NAME');\n\t\t\tthis.DOM.resourcesWrap\n\t\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: resSelectorTitle}));\n\t\t\tthis.DOM.resourcesListWrap = this.DOM.resourcesWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-control custom-field-item\"}}));\n\n\t\t\tthis.resourceSelector = new ResourceSelectorFieldEditControl({\n\t\t\t\touterWrap: this.DOM.resourcesWrap,\n\t\t\t\tblocksWrap: this.DOM.resourcesListWrap,\n\t\t\t\tvalues: [],\n\t\t\t\tresourceList: this.params.resourceList,\n\t\t\t\tonChangeCallback: this.triggerUpdatePlanner.bind(this),\n\t\t\t\tcheckLimitCallback: this.checkResourceCountLimit.bind(this)\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic showCalendarPicker(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tBX.calendar({node: target, field: target, bTime: false});\n\t\tBX.focus(target);\n\t}\n\n\tonChangeValues()\n\t{\n\t\tthis.duration = this.duration || BookingUtil.parseDuration(this.DOM.durationInput.value);\n\t\tconst duration = this.duration * 60;\n\t\tlet\n\t\t\tallValuesValue = '',\n\t\t\tformatDatetime = BX.isAmPmMode() ? Loc.getMessage(\"FORMAT_DATETIME\").replace(':SS', '') : Loc.getMessage(\"FORMAT_DATETIME\"),\n\t\t\tdateFrom,\n\t\t\tdateFromValue = '',\n\t\t\tserviceName = this.DOM.serviceInput ? this.DOM.serviceInput.value : '',\n\t\t\tentries = [];\n\n\t\tdateFrom = this.params.fullDay ? BookingUtil.parseDate(this.DOM.fromInput.value) : BookingUtil.parseDate(this.DOM.fromInput.value + ' ' + this.DOM.timeFromInput.value, false, false, formatDatetime);\n\n\t\tif (Type.isDate(dateFrom))\n\t\t{\n\t\t\tif (this.params.useResources)\n\t\t\t{\n\t\t\t\tentries = entries.concat(this.getSelectedResourceList());\n\t\t\t}\n\n\t\t\tif (this.params.useUsers)\n\t\t\t{\n\t\t\t\tentries = entries.concat(this.getSelectedUserList());\n\t\t\t}\n\t\t\tdateFromValue = BookingUtil.formatDate(BookingUtil.getDateTimeFormat(), dateFrom.getTime() / 1000);\n\t\t}\n\n\t\t// Clear inputs\n\t\tthis.DOM.valueInputs.forEach(function(input){BX.remove(input);});\n\t\tthis.DOM.valueInputs = [];\n\n\t\tentries.forEach(function(entry)\n\t\t{\n\t\t\tlet value = entry.type + '|' + entry.id + '|' + dateFromValue + '|' + duration + '|' + serviceName;\n\t\t\tallValuesValue += value + '#';\n\n\t\t\tthis.DOM.valueInputs.push(this.DOM.outerWrap.appendChild(\n\t\t\t\tDom.create('INPUT', {\n\t\t\t\t\tattrs:{\n\t\t\t\t\t\tname: this.params.inputName,\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\ttype: 'hidden'\n\t\t\t\t\t}})));\n\t\t}, this);\n\n\n\t\tif (!entries.length)\n\t\t{\n\t\t\tthis.DOM.valueInputs.push(this.DOM.outerWrap.appendChild(\n\t\t\t\tDom.create('INPUT', {\n\t\t\t\t\tattrs:{\n\t\t\t\t\t\tname: this.params.inputName,\n\t\t\t\t\t\tvalue: 'empty',\n\t\t\t\t\t\ttype: 'hidden'\n\t\t\t\t\t}})));\n\t\t}\n\n\t\tif (this.allValuesValue !== null && this.allValuesValue !== allValuesValue)\n\t\t{\n\t\t\tBX.onCustomEvent(window, 'onCrmEntityEditorUserFieldExternalChanged', [this.params.controlId]);\n\t\t\tBX.fireEvent(this.DOM.emptyInput, 'change');\n\t\t}\n\t\tthis.allValuesValue = allValuesValue;\n\t}\n\n\tshowPlannerPopup()\n\t{\n\t\tlet currentEventList = [];\n\t\tif (this.params.value && Type.isArray(this.params.value.ENTRIES))\n\t\t{\n\t\t\tthis.params.value.ENTRIES.forEach(function(entry)\n\t\t\t{\n\t\t\t\tcurrentEventList.push(entry.EVENT_ID);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isNull(this.plannerPopup))\n\t\t{\n\t\t\tthis.plannerPopup = new PlannerPopup();\n\t\t}\n\n\t\tthis.plannerPopup.show({\n\t\t\tplannerId: this.params.plannerId,\n\t\t\tbindNode: this.DOM.outerWrap,\n\t\t\tplannerConfig: this.getPlannerConfig(),\n\t\t\tselector: this.getSelectorData(),\n\t\t\tselectorOnChangeCallback: this.plannerSelectorOnChange.bind(this),\n\t\t\tselectEntriesOnChangeCallback: this.plannerSelectedEntriesOnChange.bind(this),\n\t\t\tcheckSelectorStatusCallback: this.checkSelectorStatusCallback.bind(this),\n\t\t\tcurrentEventList: currentEventList\n\t\t});\n\n\t\tthis.triggerUpdatePlanner();\n\t}\n\n\ttriggerUpdatePlanner()\n\t{\n\t\tif (!Type.isNull(this.plannerPopup)\n\t\t\t&& this.plannerPopup.plannerId === this.params.plannerId\n\t\t\t&& this.plannerPopup.isShown())\n\t\t{\n\t\t\tthis.plannerPopup.update({\n\t\t\t\tplannerId: this.params.plannerId,\n\t\t\t\tplannerConfig: this.getPlannerConfig(),\n\t\t\t\tselector: this.getSelectorData(),\n\t\t\t\tresourceList: this.getResourceList(),\n\t\t\t\tselectedResources: this.resourceSelector ? this.resourceSelector.getSelectedValues() : false,\n\t\t\t\tuserList: this.getUserList(),\n\t\t\t\tselectedUsers: this.userSelector ? this.userSelector.getSelectedValues() : false\n\t\t\t},\n\t\t\ttrue);\n\t\t}\n\n\t\tthis.onChangeValues();\n\t}\n\n\tgetPlannerConfig()\n\t{\n\t\tif (!this.params.plannerConfig)\n\t\t{\n\t\t\tthis.params.plannerConfig = {\n\t\t\t\tid: this.params.plannerId,\n\t\t\t\tselectEntriesMode: true,\n\t\t\t\tscaleLimitOffsetLeft: 2,\n\t\t\t\tscaleLimitOffsetRight: 2,\n\t\t\t\tmaxTimelineSize: 300,\n\t\t\t\tminEntryRows: 300,\n\t\t\t\tentriesListWidth: 120,\n\t\t\t\ttimelineCellWidth: 49,\n\t\t\t\tminWidth: 300,\n\t\t\t\taccuracy: 300,\n\t\t\t\tworkTime: [parseInt(this.params.workTime[0]), parseInt(this.params.workTime[1])]\n\t\t\t};\n\t\t}\n\n\t\tthis.params.plannerConfig.clickSelectorScaleAccuracy = Math.max((this.duration * 60) || 300, 3600);\n\n\t\treturn this.params.plannerConfig;\n\t}\n\n\tplannerSelectorOnChange(params)\n\t{\n\t\tif (params.plannerId === this.params.plannerId\n\t\t\t&& Type.isDate(params.dateFrom)\n\t\t\t&& Type.isDate(params.dateTo)\n\t\t)\n\t\t{\n\t\t\tlet\n\t\t\t\tdateFrom = params.dateFrom,\n\t\t\t\tdateTo = params.dateTo;\n\n\t\t\tthis.DOM.fromInput.value =  BookingUtil.formatDate(BookingUtil.getDateFormat(), dateFrom);\n\n\t\t\tif (this.DOM.timeFromInput)\n\t\t\t{\n\t\t\t\tthis.DOM.timeFromInput.value = BookingUtil.formatDate(BookingUtil.getTimeFormatShort(), dateFrom);\n\t\t\t}\n\n\t\t\t// Duration in minutes\n\t\t\tthis.duration = (dateTo.getTime() - dateFrom.getTime() + (this.params.fullDay ? BookingUtil.getDayLength() : 0)) / 60000;\n\t\t\tthis.duration = Math.round(Math.max(this.duration, 0));\n\t\t\tthis.durationList.setValue(this.duration);\n\n\t\t\tthis.onChangeValues();\n\t\t}\n\t}\n\n\tplannerSelectedEntriesOnChange(params)\n\t{\n\t\tif (params.plannerId === this.params.plannerId && Type.isArray(params.entries))\n\t\t{\n\t\t\tlet\n\t\t\t\tselectedResources = [],\n\t\t\t\tselectedUsers = [];\n\n\t\t\tparams.entries.forEach(function(entry)\n\t\t\t{\n\t\t\t\tif (entry.selected)\n\t\t\t\t{\n\t\t\t\t\tif (entry.type === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedUsers.push(entry.id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedResources.push({\n\t\t\t\t\t\t\tid: entry.id,\n\t\t\t\t\t\t\ttype: entry.type\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.resourceSelector)\n\t\t\t{\n\t\t\t\tthis.resourceSelector.setValues(selectedResources, false);\n\t\t\t}\n\t\t\tif (this.userSelector)\n\t\t\t{\n\t\t\t\tthis.userSelector.setValues(selectedUsers, false);\n\t\t\t}\n\n\t\t\tthis.onChangeValues();\n\t\t}\n\t}\n\n\tcheckSelectorStatusCallback(params)\n\t{\n\t\tif (params.plannerId === this.params.plannerId && !this.params.allowOverbooking)\n\t\t{\n\t\t\tlet errorClass = 'calendar-resbook-error';\n\t\t\tthis.overbooked = params.status === 'busy';\n\n\t\t\tif (this.overbooked)\n\t\t\t{\n\t\t\t\tif (!this.DOM.errorNode)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.errorNode = this.DOM.dateTimeWrap.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"calendar-resbook-content-error-text\"},\n\t\t\t\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_BOOKED_ERROR')\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tif (this.DOM.fromInput)\n\t\t\t\t{\n\t\t\t\t\tBX.addClass(this.DOM.fromInput, errorClass);\n\t\t\t\t}\n\t\t\t\tif (this.DOM.timeFromInput)\n\t\t\t\t{\n\t\t\t\t\tBX.addClass(this.DOM.timeFromInput, errorClass);\n\t\t\t\t}\n\t\t\t\tsetTimeout(BX.delegate(function(){BX.focus(this.DOM.fromInput)}, this), 50);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.DOM.errorNode)\n\t\t\t\t{\n\t\t\t\t\tBX.remove(this.DOM.errorNode);\n\t\t\t\t\tthis.DOM.errorNode = null;\n\t\t\t\t}\n\n\t\t\t\tif (this.DOM.fromInput)\n\t\t\t\t{\n\t\t\t\t\tBX.removeClass(this.DOM.fromInput, errorClass);\n\t\t\t\t}\n\t\t\t\tif (this.DOM.timeFromInput)\n\t\t\t\t{\n\t\t\t\t\tBX.removeClass(this.DOM.timeFromInput, errorClass);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectorData()\n\t{\n\t\tlet\n\t\t\tformatDatetime = BX.isAmPmMode() ? Loc.getMessage(\"FORMAT_DATETIME\").replace(':SS', '') : Loc.getMessage(\"FORMAT_DATETIME\"),\n\t\t\tselector, dateTo,\n\t\t\tduration = this.duration,\n\t\t\tdateFrom = BookingUtil.parseDate(this.DOM.fromInput.value + (this.DOM.timeFromInput ? ' ' + this.DOM.timeFromInput.value : ''), false, false, formatDatetime);\n\n\t\tif (!duration)\n\t\t{\n\t\t\tduration = this.params.fullDay ? 1440 : 60;\n\t\t}\n\n\t\tif (!Type.isDate(dateFrom))\n\t\t{\n\t\t\tdateFrom = new Date();\n\t\t}\n\n\t\tdateTo = new Date(dateFrom.getTime() + duration * 60000 - (this.params.fullDay ? BookingUtil.getDayLength() : 0));\n\n\t\tselector = {\n\t\t\tfrom: dateFrom,\n\t\t\tto: dateTo,\n\t\t\tfullDay: this.params.fullDay,\n\t\t\tupdateScaleLimits: true\n\t\t};\n\n\t\treturn selector;\n\t}\n\n\tgetResourceList()\n\t{\n\t\tlet entries = [];\n\t\tif (this.resourceSelector)\n\t\t{\n\t\t\tthis.resourceSelector.getValues().forEach(function(value)\n\t\t\t{\n\t\t\t\tentries.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: parseInt(value.id),\n\t\t\t\t\t\ttype : value.type,\n\t\t\t\t\t\tname : value.title\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn entries;\n\t}\n\tgetSelectedResourceList()\n\t{\n\t\tlet entries = [];\n\t\tif (this.resourceSelector)\n\t\t{\n\t\t\tthis.resourceSelector.getSelectedValues().forEach(function(value)\n\t\t\t{\n\t\t\t\tentries.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: parseInt(value.id),\n\t\t\t\t\t\ttype : value.type,\n\t\t\t\t\t\tname : value.title\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn entries;\n\t}\n\n\tgetUserList()\n\t{\n\t\tlet entries = [], index = {}, userId;\n\t\tif (this.userSelector)\n\t\t{\n\t\t\tif (Type.isArray(this.params.userList))\n\t\t\t{\n\t\t\t\tthis.params.userList.forEach(function(userId){\n\t\t\t\t\tif (!index[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tentries.push({id: userId, type : 'user'});\n\t\t\t\t\t\tindex[userId] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.userSelector.getAttendeesCodesList().forEach(function(code)\n\t\t\t{\n\t\t\t\tif (code.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tuserId = parseInt(code.substr(1));\n\t\t\t\t\tif (!index[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tentries.push({id: userId, type : 'user'});\n\t\t\t\t\t\tindex[userId] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn entries;\n\t}\n\n\tgetSelectedUserList()\n\t{\n\t\tlet entries = [];\n\t\tif (this.userSelector)\n\t\t{\n\t\t\tthis.userSelector.getAttendeesCodesList().forEach(function(code)\n\t\t\t{\n\t\t\t\tif (code.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tentries.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: parseInt(code.substr(1)),\n\t\t\t\t\t\t\ttype : 'user'\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn entries;\n\t}\n\n\tcheckResourceCountLimit()\n\t{\n\t\treturn this.params.resourceLimit <= 0 || this.getTotalResourceCount() <= this.params.resourceLimit;\n\t}\n\n\tgetTotalResourceCount()\n\t{\n\t\tlet result = 0;\n\t\tif (this.params.useResources && this.resourceSelector)\n\t\t{\n\t\t\tresult += this.resourceSelector.getValues().length;\n\t\t}\n\n\t\tif (this.params.useUsers)\n\t\t{\n\t\t\tresult += this.getSelectedUserList().length;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisOverbooked()\n\t{\n\t\treturn this.overbooked;\n\t}\n}\n","import {BookingUtil, Type, Dom, Loc, SelectInput} from \"calendar.resourcebooking\";\n\nexport class ServiceSelector\n{\n\tconstructor(params)\n\t{\n\t\tthis.params = Type.isPlainObject(params) ? params : {};\n\t\tthis.outerCont = this.params.outerCont;\n\t\tthis.fieldSettings = this.params.fieldSettings || {};\n\t\tthis.create();\n\t}\n\n\tcreate()\n\t{\n\t\tthis.serviceListOuterWrap = this.outerCont.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail-wrap calendar-resourcebook-service-list-wrap\"}}));\n\n\t\tthis.durationTitleId = 'duration-title-wrap-' + Math.round(Math.random() * 100000);\n\t\tthis.servicesTitleWrap = this.serviceListOuterWrap\n\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-detail-inner\"},\n\t\t\t\thtml: '<div class=\"calendar-resourcebook-content-block-detail-resource\">' +\n\t\t\t\t\t'<div class=\"calendar-resourcebook-content-block-title\">' +\n\t\t\t\t\t'<span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_SERVICE_LABEL') + '</span>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div id=\"' + this.durationTitleId + '\" class=\"calendar-resourcebook-content-block-title calendar-resourcebook-content-block-duration-title\">' +\n\t\t\t\t\t'<span class=\"calendar-resourcebook-content-block-title-text\">' + Loc.getMessage('USER_TYPE_RESOURCE_DURATION_LABEL') + '</span>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>'\n\t\t\t}));\n\n\t\tthis.serviceListRowsWrap = this.serviceListOuterWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail-inner\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail\"}}));\n\n\t\tBX.bind(this.serviceListRowsWrap, 'click', this.handlePopupClick.bind(this));\n\t\tif (Type.isArray(this.fieldSettings.SERVICE_LIST) && this.fieldSettings.SERVICE_LIST.length > 0)\n\t\t{\n\t\t\tthis.fieldSettings.SERVICE_LIST.forEach(function(service)\n\t\t\t{\n\t\t\t\tthis.addRow(service, false);\n\t\t\t}, this);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRow(false, false);\n\t\t}\n\n\t\tthis.serviceListAddWrap = this.serviceListOuterWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resource-content-block-add-field\"}}));\n\n\t\tthis.serviceAddButton = this.serviceListAddWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops: {className: \"calendar-resource-content-block-add-link calendar-resource-content-block-add-link-icon\"},\n\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_ADD_SERVICE'),\n\t\t\tevents: {click: this.addRow.bind(this)}\n\t\t}));\n\t\tBX.bind(window, 'resize', this.checkDurationTitlePosition.bind(this));\n\t\tthis.checkDurationTitlePosition();\n\n\t\tthis.show(this.fieldSettings.USE_SERVICES === 'Y');\n\t}\n\n\tshow(show)\n\t{\n\t\tif (show)\n\t\t{\n\t\t\tthis.serviceListOuterWrap.style.display = '';\n\t\t\tDom.addClass(this.serviceListOuterWrap, 'show');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.serviceListOuterWrap.style.display = 'none';\n\t\t\tDom.removeClass(this.serviceListOuterWrap, 'show');\n\t\t}\n\t}\n\n\taddRow(row, animation)\n\t{\n\t\tanimation = animation !== false;\n\n\t\tif (!Type.isPlainObject(row))\n\t\t{\n\t\t\trow = {name: '', duration: this.getDefaultDuration()}\n\t\t}\n\n\t\tlet service = {\n\t\t\touterWrap: this.serviceListRowsWrap\n\t\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail-resource calendar-resourcebook-service-row\"}}))\n\t\t};\n\n\t\tif (animation)\n\t\t{\n\t\t\tsetTimeout(function(){\n\t\t\t\tDom.addClass(service.outerWrap, 'show');\n\t\t\t}, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(service.outerWrap, 'show');\n\t\t}\n\n\t\tservice.wrap = service.outerWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-detail-resource-inner\"}}));\n\n\t\tservice.nameInput = service.wrap.appendChild(Dom.create(\"input\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"calendar-resourcebook-content-input calendar-resourcebook-service-input\",\n\t\t\t\tplaceholder: Loc.getMessage('USER_TYPE_RESOURCE_SERVICE_PLACEHOLDER'),\n\t\t\t\ttype: \"text\",\n\t\t\t\tvalue: row.name\n\t\t\t},\n\t\t\tattrs: {}\n\t\t}));\n\n\t\tservice.durationInput = service.wrap.appendChild(Dom.create(\"input\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"calendar-resbook-duration-input calendar-resbook-field-datetime-menu\",\n\t\t\t\ttype: \"text\",\n\t\t\t\tvalue: row.duration\n\t\t\t},\n\t\t\tattrs: {}\n\t\t}));\n\n\t\tservice.durationList = new SelectInput({\n\t\t\tinput: service.durationInput,\n\t\t\tgetValues: function(){\n\t\t\t\tlet fullday = false;\n\t\t\t\tif (Type.isFunction(this.params.getFullDayValue))\n\t\t\t\t{\n\t\t\t\t\tfullday = this.params.getFullDayValue();\n\t\t\t\t}\n\t\t\t\treturn BookingUtil.getDurationList(fullday);\n\t\t\t}.bind(this),\n\t\t\tvalue: row.duration\n\t\t});\n\n\t\tservice.deleteWrap = service.wrap.appendChild(Dom.create(\"DIV\", {\n\t\t\tprops: {className: \"calendar-resourcebook-content-block-detail-delete\"},\n\t\t\thtml: '<span class=\"calendar-resourcebook-content-block-control-delete calendar-resourcebook-content-block-control-delete-detail\"></span>'\n\t\t}));\n\n\t\t// Adjust outer wrap max height\n\t\tthis.serviceListOuterWrap.style.maxHeight = Math.max(500, this.serviceListRowsWrap.childNodes.length * 45 + 100) + 'px';\n\t}\n\n\tcheckDurationTitlePosition(timeout)\n\t{\n\t\tif (timeout !== false)\n\t\t{\n\t\t\tif (this.checkDurationTitlePositionTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.checkDurationTitlePositionTimeout);\n\t\t\t}\n\n\t\t\tthis.checkDurationTitlePositionTimeout = setTimeout(function(){\n\n\t\t\t\tthis.checkDurationTitlePosition(false);\n\t\t\t}.bind(this), 100);\n\t\t\treturn;\n\t\t}\n\n\t\tlet durationInput = this.serviceListOuterWrap.querySelector('input.calendar-resbook-duration-input');\n\t\tif (this.durationTitleId && BX(this.durationTitleId) && durationInput)\n\t\t{\n\t\t\tBX(this.durationTitleId).style.left = (durationInput.offsetLeft + 15) + 'px';\n\t\t}\n\t}\n\n\tgetDefaultDuration()\n\t{\n\t\tlet fullday = false;\n\t\tif (Type.isFunction(this.params.getFullDayValue))\n\t\t{\n\t\t\tfullday = this.params.getFullDayValue();\n\t\t}\n\t\treturn fullday ? 1440 : 30;\n\t}\n\n\tclickHandler(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Dom.hasClass(target, 'calendar-resourcebook-content-block-control-delete')\n\t\t\t|| Dom.hasClass(target, 'calendar-resourcebook-content-block-detail-delete')) // Delete button\n\t\t{\n\t\t\tlet resWrap = BX.findParent(target, {className: 'calendar-resourcebook-service-row'});\n\t\t\tif (resWrap)\n\t\t\t{\n\t\t\t\tDom.removeClass(resWrap, 'show');\n\t\t\t\tsetTimeout(function(){Dom.remove(resWrap);}, 500);\n\t\t\t\tthis.checkRows();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetValues(e)\n\t{\n\t\tlet\n\t\t\tserviceList = [],\n\t\t\tnameInput, durationInput,\n\t\t\ti, rows = this.serviceListRowsWrap.querySelectorAll('.calendar-resourcebook-service-row');\n\n\t\tfor (i = 0; i < rows.length; i++)\n\t\t{\n\t\t\tif (Dom.hasClass(rows[i], 'show'))\n\t\t\t{\n\t\t\t\tnameInput = rows[i].querySelector('input.calendar-resourcebook-service-input');\n\t\t\t\tdurationInput = rows[i].querySelector('input.calendar-resbook-duration-input');\n\n\t\t\t\tif (nameInput && durationInput)\n\t\t\t\t{\n\t\t\t\t\tserviceList.push({\n\t\t\t\t\t\tname: nameInput.value,\n\t\t\t\t\t\tduration: BookingUtil.parseDuration(durationInput.value)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn serviceList;\n\t}\n\n\tcheckRows()\n\t{\n\t\tlet serviceList = this.getValues();\n\t\tif (!serviceList.length)\n\t\t{\n\t\t\tthis.show(false);\n\t\t\tif (Type.isFunction(this.params.onFullClearHandler))\n\t\t\t{\n\t\t\t\tthis.params.onFullClearHandler();\n\t\t\t}\n\t\t\tthis.addRow(false, false);\n\t\t}\n\t}\n\n\n\thandlePopupClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (Dom.hasClass(target, 'calendar-resourcebook-content-block-control-delete')\n\t\t\t|| Dom.hasClass(target, 'calendar-resourcebook-content-block-detail-delete')) // Delete button\n\t\t{\n\t\t\tlet resWrap = BX.findParent(target, {className: 'calendar-resourcebook-service-row'});\n\t\t\tif (resWrap)\n\t\t\t{\n\t\t\t\tBX.removeClass(resWrap, 'show');\n\t\t\t\tsetTimeout(function(){BX.remove(resWrap);}, 500);\n\t\t\t\tthis.checkRows();\n\t\t\t}\n\t\t}\n\t}\n}","import {Type, Dom, Loc} from \"calendar.resourcebooking\";\nexport class TimezoneSelector\n{\n\tstatic timezoneList;\n\n\tconstructor(params)\n\t{\n\t\tthis.params = Type.isPlainObject(params) ? params : {};\n\t\tthis.DOM = {\n\t\t\touterWrap: this.params.outerWrap\n\t\t};\n\t\tDom.addClass(this.DOM.outerWrap, 'fields enumeration field-item');\n\t\tthis.create();\n\t}\n\n\tcreate()\n\t{\n\t\tthis.DOM.select = this.DOM.outerWrap.appendChild(Dom.create('select'));\n\t\tthis.DOM.select.options.add(\n\t\t\tnew Option(\n\t\t\t\tLoc.getMessage('USER_TYPE_LOADING_TIMEZONE_LIST'),\n\t\t\t\tthis.params.selectedValue || '',\n\t\t\t\ttrue,\n\t\t\t\ttrue)\n\t\t);\n\n\t\tthis.getTimezoneList().then(\n\t\t\tfunction(timezoneList)\n\t\t\t{\n\t\t\t\tDom.remove(this.DOM.select.options[0]);\n\t\t\t\ttimezoneList.forEach(function(timezone)\n\t\t\t\t{\n\t\t\t\t\tlet selected = this.params.selectedValue ? this.params.selectedValue === timezone.value : timezone.selected;\n\n\t\t\t\t\tthis.DOM.select.options.add(\n\t\t\t\t\t\tnew Option(\n\t\t\t\t\t\t\ttimezone.label,\n\t\t\t\t\t\t\ttimezone.value,\n\t\t\t\t\t\t\tselected,\n\t\t\t\t\t\t\tselected));\n\t\t\t\t}, this);\n\t\t\t}.bind(this)\n\t\t);\n\t}\n\n\tgetTimezoneList(params)\n\t{\n\t\tparams = params || {};\n\n\t\treturn new Promise((resolve) => {\n\t\t\tif (!TimezoneSelector.timezoneList || params.clearCache)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.getTimezoneList')\n\t\t\t\t\t.then(function (response)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tTimezoneSelector.timezoneList = [];\n\t\t\t\t\t\t\tfor (let key in response.data)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (response.data.hasOwnProperty(key))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tTimezoneSelector.timezoneList.push({\n\t\t\t\t\t\t\t\t\t\tvalue: response.data[key].timezone_id,\n\t\t\t\t\t\t\t\t\t\tlabel: response.data[key].title,\n\t\t\t\t\t\t\t\t\t\tselected: response.data[key].default\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresolve(TimezoneSelector.timezoneList);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\tfunction (response)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(TimezoneSelector.timezoneList);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.DOM.select.value;\n\t}\n}\n\n\n\n\n\n\n\n","import {Type, Dom, Loc, Event} from \"calendar.resourcebooking\";\n\nexport class ModeSelector\n{\n\tconstructor(params)\n\t{\n\t\tthis.params = params;\n\t\tthis.outerWrap = this.create();\n\t}\n\n\tcreate()\n\t{\n\t\tlet\n\t\t\twrapNode = Dom.create(\"span\",\n\t\t\t\t{\n\t\t\t\t\tprops:{className: \"calendar-resourcebook-content-block-select calendar-resourcebook-mode-selector\"}\n\t\t\t\t}\n\t\t\t),\n\t\t\tmenuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_RESOURCES'),\n\t\t\t\t\tonclick: function(e, item){\n\t\t\t\t\t\tif (Type.isFunction(this.params.showResources))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.params.showResources();\n\t\t\t\t\t\t}\n\t\t\t\t\t\twrapNode.innerHTML = item.text;\n\t\t\t\t\t\tthis.modeSwitcherPopup.close();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_USERS'),\n\t\t\t\t\tonclick: function(e, item){\n\t\t\t\t\t\tif (Type.isFunction(this.params.showUsers))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.params.showUsers();\n\t\t\t\t\t\t}\n\t\t\t\t\t\twrapNode.innerHTML = item.text;\n\t\t\t\t\t\tthis.modeSwitcherPopup.close();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_RESOURCES_AND_USERS'),\n\t\t\t\t\tonclick: function(e, item){\n\t\t\t\t\t\tif (Type.isFunction(this.params.showResourcesAndUsers))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.params.showResourcesAndUsers();\n\t\t\t\t\t\t}\n\t\t\t\t\t\twrapNode.innerHTML = item.text;\n\t\t\t\t\t\tthis.modeSwitcherPopup.close();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t],\n\t\t\tswitcherId = 'mode-switcher-' + Math.round(Math.random() * 100000);\n\n\n\t\tEvent.bind(wrapNode, 'click', function(){\n\t\t\tif (this.modeSwitcherPopup && this.modeSwitcherPopup.popupWindow && this.modeSwitcherPopup.popupWindow.isShown())\n\t\t\t{\n\t\t\t\treturn this.modeSwitcherPopup.close();\n\t\t\t}\n\n\t\t\tthis.modeSwitcherPopup = BX.PopupMenu.create(\n\t\t\t\tswitcherId,\n\t\t\t\twrapNode,\n\t\t\t\tmenuItems,\n\t\t\t\t{\n\t\t\t\t\tcloseByEsc : true,\n\t\t\t\t\tautoHide : true,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\toffsetLeft: 20,\n\t\t\t\t\tangle: true\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.modeSwitcherPopup.show();\n\n\t\t\tBX.addCustomEvent(this.modeSwitcherPopup.popupWindow, 'onPopupClose', function()\n\t\t\t{\n\t\t\t\tBX.PopupMenu.destroy(switcherId);\n\t\t\t\tthis.modeSwitcherPopup = null;\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\n\t\tif (this.params.useUsers && !this.params.useResources)\n\t\t{\n\t\t\twrapNode.innerHTML = Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_USERS');\n\t\t}\n\t\telse if (this.params.useUsers && this.params.useResources)\n\t\t{\n\t\t\twrapNode.innerHTML = Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_RESOURCES_AND_USERS');\n\t\t}\n\t\telse\n\t\t{\n\t\t\twrapNode.innerHTML = Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE_RESOURCES');\n\t\t}\n\n\t\treturn wrapNode;\n\t}\n\n\tgetOuterWrap()\n\t{\n\t\treturn this.outerWrap;\n\t}\n}\n","import {BookingUtil} from \"calendar.resourcebooking\";\nimport {ServiceSelector} from \"./controls/serviceselector\"\nimport {UserSelectorFieldEditControl} from \"./controls/userselectorfieldeditcontrol\";\nimport {ResourceSelectorFieldEditControl} from \"./controls/resourceselectorfieldeditcontrol\";\nimport {TimezoneSelector} from \"./controls/timezoneselector\";\nimport {ModeSelector} from \"./controls/modeselector\";\nimport {ResourcebookingUserfield} from \"calendar.resourcebookinguserfield\";\n\nexport let customizeCrmEntityEditor = function(CrmConfigurator)\n{\n\tlet Configurator = function()\n\t{\n\t\tConfigurator.superclass.constructor.apply(this);\n\t};\n\tBX.extend(Configurator, CrmConfigurator);\n\n\tConfigurator.create = function(id, settings)\n\t{\n\t\tlet self = new Configurator();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t};\n\n\tConfigurator.prototype.layout = function(options, params)\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!BX.type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {}\n\t\t}\n\n\t\tif(this._mode === BX.Crm.EntityEditorMode.view)\n\t\t{\n\t\t\tthrow \"EntityEditorUserFieldConfigurator. View mode is not supported by this control type.\";\n\t\t}\n\n\t\tthis.getBitrix24Limitation({\n\t\t\tcallback: BX.delegate(function(limit)\n\t\t\t{\n\t\t\t\tthis.RESOURCE_LIMIT = limit;\n\t\t\t}, this)\n\t\t});\n\n\t\tif(this._field)\n\t\t{\n\t\t\tthis.fieldInfo = this._field.getFieldInfo();\n\t\t}\n\t\telse if (!params.settings)\n\t\t{\n\t\t\treturn this.getDefaultUserfieldSettings({\n\t\t\t\tdisplayCallback: BX.delegate(function(settings)\n\t\t\t\t{\n\t\t\t\t\tthis.layout(options, {settings: settings});\n\t\t\t\t}, this)\n\t\t\t});\n\t\t}\n\n\t\tthis._wrapper = BX.create(\"div\", {props: {className: \"calendar-resourcebook-content\"}});\n\t\tthis._innerWrapper = this._wrapper\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-wrap\"}}))\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-inner\"}}));\n\n\t\tvar\n\t\t\tfieldSettings = this.fieldInfo ? this.fieldInfo.SETTINGS : params.settings,\n\t\t\tresourceList = [],\n\t\t\tselectedResourceList = [],\n\t\t\tisNew = this._field === null,\n\t\t\ttitle = this.getMessage(\"labelField\"),\n\t\t\tmanager = this._editor.getUserFieldManager(),\n\t\t\tlabel = this._field ? this._field.getTitle() : manager.getDefaultFieldLabel(this._typeId);\n\n\t\tthis.RESOURCE_LIMIT = fieldSettings.RESOURCE_LIMIT || 0;\n\n\t\t// region Field Title\n\t\tthis._labelInput = BX.create(\"input\",\n\t\t\t{\n\t\t\t\tattrs:\n\t\t\t\t\t{\n\t\t\t\t\t\tclassName: \"crm-entity-widget-content-input\",\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: label\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._innerWrapper.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"div\",\n\t\t\t\t{\n\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block\" },\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t// Title\n\t\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\t\"div\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprops: { className: \"crm-entity-widget-content-block-title\" },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\t\t\t\t\"span\",\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tattrs: { className: \"crm-entity-widget-content-block-title-text\" },\n\t\t\t\t\t\t\t\t\t\t\t\ttext: title\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t// Input\n\t\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\t\"div\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block-field\" },\n\t\t\t\t\t\t\t\t\tchildren: [ this._labelInput ]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t// Hr\n\t\t\t\t\t\t\tBX.create(\"hr\", { props: { className: \"crm-entity-widget-hr\" } })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t// endregion\n\n\t\t// region Users&Resources Mode selector\n\t\tthis._innerWrapper.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"div\",\n\t\t\t\t{\n\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block\" },\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\t\"span\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-title-text\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message('USER_TYPE_RESOURCE_CHOOSE')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tnew ModeSelector({\n\t\t\t\t\t\t\t\tuseResources: fieldSettings.USE_RESOURCES === 'Y',\n\t\t\t\t\t\t\t\tuseUsers: fieldSettings.USE_USERS === 'Y',\n\t\t\t\t\t\t\t\tshowUsers: function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.resourceList.hide();\n\t\t\t\t\t\t\t\t\tthis.userList.show();\n\t\t\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t\t\tshowResources: function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.resourceList.show();\n\t\t\t\t\t\t\t\t\tthis.userList.hide();\n\t\t\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t\t\tshowResourcesAndUsers: function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.resourceList.show();\n\t\t\t\t\t\t\t\t\tthis.userList.show();\n\t\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t\t}).getOuterWrap()\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t// endregion\n\n\t\tvar optionWrapper = this._innerWrapper.appendChild(BX.create(\n\t\t\t\"div\",\n\t\t\t{\n\t\t\t\tprops: { className: \"calendar-resourcebook-content-block\" }\n\t\t\t}\n\t\t));\n\n\t\t// region Use Resources Option\n\t\tthis.resourcesWrap = optionWrapper.appendChild(BX.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\"}}));\n\n\t\tthis.resourcesTitleWrap = this.resourcesWrap\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: BX.message('USER_TYPE_RESOURCE_RESOURCE_CONTROL_DEFAULT_NAME') + ':'}));\n\n\t\tthis.resourcesListWrap = this.resourcesWrap.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-new-entries-wrap calendar-resourcebook-content-block-detail-inner\"}}));\n\n\t\tthis.resourcesListLowControls = this.resourcesWrap.appendChild(BX.create(\"div\", {props: {className: \"calendar-resource-content-block-add-field\"}}));\n\n\t\tif (fieldSettings.RESOURCES\n\t\t\t&& BX.type.isPlainObject(fieldSettings.RESOURCES['resource'])\n\t\t\t&& BX.type.isArray(fieldSettings.RESOURCES['resource'].SECTIONS))\n\t\t{\n\t\t\tfieldSettings.RESOURCES['resource'].SECTIONS.forEach(function(resource)\n\t\t\t{\n\t\t\t\tresourceList.push({\n\t\t\t\t\tid: resource.ID,\n\t\t\t\t\ttitle: resource.NAME,\n\t\t\t\t\ttype: resource.CAL_TYPE\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (BX.type.isArray(fieldSettings.SELECTED_RESOURCES))\n\t\t{\n\t\t\tfieldSettings.SELECTED_RESOURCES.forEach(function(resource)\n\t\t\t{\n\t\t\t\tselectedResourceList.push({\n\t\t\t\t\tid: resource.id,\n\t\t\t\t\ttype: resource.type\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.resourceList = new ResourceSelectorFieldEditControl({\n\t\t\tshown: fieldSettings.USE_RESOURCES === 'Y',\n\t\t\teditMode: true,\n\t\t\touterWrap: this.resourcesWrap,\n\t\t\tlistWrap: this.resourcesListWrap,\n\t\t\tcontrolsWrap: this.resourcesListLowControls,\n\t\t\tvalues: selectedResourceList,\n\t\t\tresourceList: resourceList,\n\t\t\tcheckLimitCallback: this.checkResourceCountLimit.bind(this),\n\t\t\tcheckLimitCallbackForNew: this.checkResourceCountLimitForNewEntries.bind(this)\n\t\t});\n\t\t// endregion\n\n\t\t// region Users Selector\n\t\tthis.userSelectorWrap = optionWrapper.appendChild(BX.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\"}}));\n\n\t\tthis.usersTitleWrap = this.userSelectorWrap\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: BX.message('USER_TYPE_RESOURCE_USERS_CONTROL_DEFAULT_NAME') + ':'}));\n\n\t\tthis.usersListWrap = this.userSelectorWrap.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-control\"}}));\n\n\t\tvar itemsSelected = [];\n\t\tif (BX.type.isArray(fieldSettings.SELECTED_USERS))\n\t\t{\n\t\t\tfieldSettings.SELECTED_USERS.forEach(function(user)\n\t\t\t{\n\t\t\t\titemsSelected.push('U' + parseInt(user));\n\t\t\t});\n\t\t}\n\n\t\tthis.userList = new UserSelectorFieldEditControl({\n\t\t\tshown: fieldSettings.USE_USERS === 'Y',\n\t\t\touterWrap: this.userSelectorWrap,\n\t\t\twrapNode: this.usersListWrap,\n\t\t\tsocnetDestination: ResourcebookingUserfield.getSocnetDestination(),\n\t\t\titemsSelected: itemsSelected,\n\t\t\tcheckLimitCallback: this.checkResourceCountLimit.bind(this)\n\t\t});\n\t\t// endregion\n\n\t\t// Region Data, Time and services\n\t\toptionWrapper.appendChild(\n\t\t\tBX.create(\"hr\", { props: { className: \"crm-entity-widget-hr\" } })\n\t\t);\n\n\t\tthis.datetimeOptionsWrap = optionWrapper.appendChild(BX.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\" }}));\n\n\t\tthis.datetimeOptionsWrap.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}})).appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: BX.message('USER_TYPE_RESOURCE_DATETIME_BLOCK_TITLE') + ':'}));\n\n\t\tthis.datetimeOptionsInnerWrap = this.datetimeOptionsWrap.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-options\"}}));\n\n\t\tthis.timezoneSettingsWrap = optionWrapper.appendChild(\n\t\t\tBX.create(\"div\", {props: {\n\t\t\t\t\tclassName: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-options\" },\n\t\t\t\tstyle: {display: fieldSettings.FULL_DAY === 'Y' ? 'none' : ''}\n\t\t\t}));\n\n\t\tthis.timezoneSettingsWrap.appendChild(BX.create(\"hr\", {props: {className: \"crm-entity-widget-hr\"}}));\n\t\tthis.timezoneSettingsWrap\n\t\t\t.appendChild(BX.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t.appendChild(BX.create(\"span\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: BX.message('USER_TYPE_RESOURCE_TIMEZONE_SETTINGS_TITLE') + ':'}));\n\n\t\tthis.timezoneSelectorWrap = this.timezoneSettingsWrap.appendChild(BX.create(\"div\", {\n\t\t\tstyle: {display: fieldSettings.USE_USER_TIMEZONE === 'Y' ? 'none' : ''}\n\t\t}));\n\n\t\tthis.timezoneSelectWrap = this.timezoneSelectorWrap\n\t\t\t.appendChild(BX.create(\n\t\t\t\t\"div\",\n\t\t\t\t{\n\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block-field\" }\n\t\t\t\t}\n\t\t\t));\n\n\n\t\tthis.timezoneSelector = new TimezoneSelector({\n\t\t\touterWrap: this.timezoneSelectWrap,\n\t\t\tselectedValue: fieldSettings.TIMEZONE\n\t\t});\n\n\t\tthis.useUserTimezoneCheckBox = BX.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tchecked: fieldSettings.USE_USER_TIMEZONE === 'Y'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.timezoneSettingsWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis.useUserTimezoneCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: BX.message('USER_TYPE_RESOURCE_USE_USER_TIMEZONE') })\n\t\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: BX.proxy(this.handleUserTimezoneCheckbox, this)\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\t// endregion\n\n\t\t//region Checkbox \"Full day\"\n\t\tthis._fulldayCheckBox = BX.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tchecked: fieldSettings.FULL_DAY === 'Y'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: BX.proxy(this.handleFullDayMode, this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.datetimeOptionsInnerWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis._fulldayCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: BX.message('USER_TYPE_RESOURCE_FULL_DAY') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\n\t\t//region Checkbox \"Add services\"\n\t\tthis._servicesCheckBox = BX.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tchecked: fieldSettings.USE_SERVICES === 'Y'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick : BX.delegate(function(){\n\t\t\t\t\t\tif (this.serviceList)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.serviceList.show(this._servicesCheckBox.checked);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.datetimeOptionsInnerWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis._servicesCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: BX.message('USER_TYPE_RESOURCE_ADD_SERVICES') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tthis.serviceList = new ServiceSelector({\n\t\t\touterCont: this.datetimeOptionsInnerWrap,\n\t\t\tonFullClearHandler: function()\n\t\t\t{\n\t\t\t\tthis._servicesCheckBox.checked = false;\n\t\t\t}.bind(this),\n\t\t\tfieldSettings: fieldSettings,\n\t\t\tgetFullDayValue: function(){return this._fulldayCheckBox.checked}.bind(this)\n\t\t});\n\n\t\toptionWrapper.appendChild(\n\t\t\tBX.create(\"hr\", { props: { className: \"crm-entity-widget-hr\" } })\n\t\t);\n\n\t\t//region Checkbox \"Is Required\"\n\t\tthis.additionaOptionsWrap = optionWrapper.appendChild(BX.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-options\"}}));\n\n\t\tthis._isRequiredCheckBox = BX.create(\n\t\t\t\"input\",\n\t\t\t{ props: { type: \"checkbox\", checked: this._field && this._field.isRequired() } }\n\t\t);\n\n\t\tthis.additionaOptionsWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis._isRequiredCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: this.getMessage(\"isRequiredField\") })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\n\t\t//region Checkbox \"Show Always\"\n\t\tthis._showAlwaysCheckBox = BX.create(\"input\", { props: { type: \"checkbox\" } });\n\t\tif(isNew)\n\t\t{\n\t\t\tthis._showAlwaysCheckBox.checked = BX.prop.getBoolean(this._settings, \"showAlways\", true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._showAlwaysCheckBox.checked = this._field.checkOptionFlag(\n\t\t\t\tBX.Crm.EntityEditorControlOptions.showAlways\n\t\t\t);\n\t\t}\n\t\tthis.additionaOptionsWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis._showAlwaysCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: this.getMessage(\"showAlways\") })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\n\t\t//region Checkbox \"Overbooking\"\n\t\tthis._overbookingCheckBox = BX.create(\n\t\t\t\"input\",\n\t\t\t{ props: { type: \"checkbox\", checked: fieldSettings.ALLOW_OVERBOOKING === 'Y'} }\n\t\t);\n\n\t\tthis.additionaOptionsWrap.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis._overbookingCheckBox,\n\t\t\t\t\t\t\tBX.create(\"span\", { text: BX.message('USER_TYPE_RESOURCE_OVERBOOKING') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\n\t\tthis._innerWrapper.appendChild(\n\t\t\tBX.create(\n\t\t\t\t\"div\",\n\t\t\t\t{\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"calendar-resourcebook-content-block-btn-container\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create(\"hr\", { props: { className: \"crm-entity-widget-hr\" } }),\n\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\"button\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprops: {type: \"button\", className: \"ui-btn ui-btn-sm ui-btn-primary\"},\n\t\t\t\t\t\t\t\ttext: BX.message(\"CRM_EDITOR_SAVE\"),\n\t\t\t\t\t\t\t\tevents: {  click: BX.delegate(this.onSaveButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t\tBX.create(\n\t\t\t\t\t\t\t\"button\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprops: {type: \"button\", className: \"ui-btn ui-btn-sm ui-btn-light-border\" },\n\t\t\t\t\t\t\t\ttext: BX.message(\"CRM_EDITOR_CANCEL\"),\n\t\t\t\t\t\t\t\tevents: {  click: BX.delegate(this.onCancelButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tthis.fieldSettings = fieldSettings;\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t};\n\n\tConfigurator.prototype.getDefaultUserfieldSettings = function(params)\n\t{\n\t\tBX.ajax.runAction('calendar.api.resourcebookingajax.getdefaultuserfieldsettings', {\n\t\t\tdata: {}\n\t\t}).then(function (response)\n\t\t\t{\n\t\t\t\tif (params && BX.type.isFunction(params.displayCallback))\n\t\t\t\t{\n\t\t\t\t\tparams.displayCallback(response.data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfunction (response) {\n\t\t\t\t/**\n\t\t\t\t {\n\t\t\t\t\t\t \"status\": \"error\",\n\t\t\t\t\t\t \"errors\": [...]\n\t\t\t\t\t }\n\t\t\t\t **/\n\t\t\t});\n\t};\n\n\tConfigurator.prototype.getBitrix24Limitation = function(params)\n\t{\n\t\tBX.ajax.runAction('calendar.api.resourcebookingajax.getbitrix24limitation', {\n\t\t\tdata: {}\n\t\t}).then(function (response)\n\t\t\t{\n\t\t\t\tif (params && BX.type.isFunction(params.callback))\n\t\t\t\t{\n\t\t\t\t\tparams.callback(response.data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfunction (response) {\n\t\t\t\t/**\n\t\t\t\t {\n\t\t\t\t\t\t \"status\": \"error\",\n\t\t\t\t\t\t \"errors\": [...]\n\t\t\t\t\t }\n\t\t\t\t **/\n\t\t\t});\n\t};\n\n\tConfigurator.prototype.onSaveButtonClick = function()\n\t{\n\t\tif(this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.RESOURCE_LIMIT > 0 && this.getTotalResourceCount() > this.RESOURCE_LIMIT)\n\t\t{\n\t\t\tBookingUtil.showLimitationPopup();\n\t\t\treturn;\n\t\t}\n\n\t\tvar params =\n\t\t\t{\n\t\t\t\ttypeId: this._typeId,\n\t\t\t\tlabel: this._labelInput.value,\n\t\t\t\tmandatory: this._isRequiredCheckBox.checked,\n\t\t\t\tshowAlways: this._showAlwaysCheckBox.checked,\n\t\t\t\tmultiple: true\n\t\t\t};\n\n\t\tif(this._field)\n\t\t{\n\t\t\tparams[\"field\"] = this._field;\n\t\t}\n\n\t\tthis.fieldSettings.USE_RESOURCES = this.resourceList.isShown() ? 'Y' : 'N';\n\t\tthis.fieldSettings.USE_USERS = this.userList.isShown() ? 'Y' : 'N';\n\n\t\tif (this.fieldSettings\n\t\t\t&& BX.type.isPlainObject(this.fieldSettings.RESOURCES)\n\t\t\t&& BX.type.isPlainObject(this.fieldSettings.RESOURCES['resource']))\n\t\t{\n\t\t\tthis.fieldSettings.SELECTED_RESOURCES = [];\n\n\t\t\tthis.resourceList.getSelectedValues().forEach(function(value)\n\t\t\t{\n\t\t\t\tthis.fieldSettings.SELECTED_RESOURCES.push(value);\n\t\t\t}, this);\n\n\t\t\tthis.resourceList.getDeletedValues().forEach(function(value)\n\t\t\t{\n\t\t\t\tthis.fieldSettings.SELECTED_RESOURCES.push(value);\n\t\t\t}, this);\n\t\t}\n\n\n\t\tif (this.fieldSettings && this.userList)\n\t\t{\n\t\t\tthis.fieldSettings.SELECTED_USERS = [0];\n\t\t\tthis.userList.getAttendeesCodesList().forEach(function(code)\n\t\t\t{\n\t\t\t\tif (code.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tthis.fieldSettings.SELECTED_USERS.push(parseInt(code.substr(1)));\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tthis.fieldSettings.USE_SERVICES = this._servicesCheckBox.checked ? 'Y' : 'N';\n\t\tthis.fieldSettings.SERVICE_LIST = [];\n\t\tif (this._servicesCheckBox.checked && this.serviceList)\n\t\t{\n\t\t\tthis.fieldSettings.SERVICE_LIST = this.serviceList.getValues();\n\t\t}\n\n\t\tthis.fieldSettings.FULL_DAY = this._fulldayCheckBox.checked ? 'Y' : 'N';\n\t\tthis.fieldSettings.ALLOW_OVERBOOKING = this._overbookingCheckBox.checked ? 'Y' : 'N';\n\n\t\tif (this.fieldSettings.FULL_DAY === 'N')\n\t\t{\n\t\t\tthis.fieldSettings.TIMEZONE = this.timezoneSelector.getValue();\n\t\t\tthis.fieldSettings.USE_USER_TIMEZONE = this.useUserTimezoneCheckBox.checked ? 'Y' : 'N';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fieldSettings.TIMEZONE = '';\n\t\t\tthis.fieldSettings.USE_USER_TIMEZONE = 'N';\n\t\t}\n\n\t\tparams[\"settings\"] = this.fieldSettings;\n\n\t\tBX.onCustomEvent(this, \"onSave\", [ this, params]);\n\t};\n\n\tConfigurator.prototype.getTotalResourceCount = function()\n\t{\n\t\tvar result = 0;\n\n\t\tif (this.fieldSettings)\n\t\t{\n\t\t\tif (BX.type.isPlainObject(this.fieldSettings.RESOURCES)\n\t\t\t\t&& BX.type.isPlainObject(this.fieldSettings.RESOURCES.resource)\n\t\t\t\t&& BX.type.isArray(this.fieldSettings.RESOURCES.resource.SECTIONS)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult += this.fieldSettings.RESOURCES.resource.SECTIONS.length;\n\t\t\t}\n\n\t\t\tresult -= this.resourceList.getDeletedValues().length;\n\n\t\t\tthis.resourceList.getSelectedValues().forEach(function(value)\n\t\t\t{\n\t\t\t\tif (!value.id && value.title !== '')\n\t\t\t\t{\n\t\t\t\t\tresult++;\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tif (this.userList)\n\t\t\t{\n\t\t\t\tresult += this.userList.getAttendeesCodesList().length;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tConfigurator.prototype.checkResourceCountLimitForNewEntries = function()\n\t{\n\t\treturn this.RESOURCE_LIMIT <= 0 || this.getTotalResourceCount() < this.RESOURCE_LIMIT;\n\t};\n\n\tConfigurator.prototype.checkResourceCountLimit = function()\n\t{\n\t\treturn this.RESOURCE_LIMIT <= 0 || this.getTotalResourceCount() <= this.RESOURCE_LIMIT;\n\t};\n\n\tConfigurator.prototype.handleFullDayMode = function()\n\t{\n\t\tthis.timezoneSettingsWrap.style.display = this._fulldayCheckBox.checked ? 'none' : '';\n\t};\n\n\tConfigurator.prototype.handleUserTimezoneCheckbox = function()\n\t{\n\t\tthis.timezoneSelectorWrap.style.display = this.useUserTimezoneCheckBox.checked ? 'none' : '';\n\t};\n\n\n\treturn Configurator;\n};","export class CalendarViewSettingsSlider\n{\n\tconstructor(params)\n\t{\n\t\tthis.id = 'calendar_custom_settings_' + Math.round(Math.random() * 1000000);\n\t\tthis.zIndex = 3100;\n\t\tthis.sliderId = \"calendar:resbook-settings-slider\";\n\n\t\tthis.SLIDER_WIDTH = 400;\n\t\tthis.SLIDER_DURATION = 80;\n\t\tthis.DOM = {};\n\n\t\tthis.params = params;\n\t}\n\n\tshow()\n\t{\n\t\tBX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: BX.delegate(this.create, this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION\n\t\t});\n\n\t\tthis.hideHandler = this.hide.bind(this);\n\t\tthis.destroyHandler = this.destroy.bind(this);\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onClose\", this.hideHandler);\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onCloseComplete\", );\n\t}\n\n\tclose()\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSliderPage && event.getSliderPage().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// if (this.denyClose)\n\t\t\t// {\n\t\t\t// \tevent.denyAction();\n\t\t\t// }\n\t\t\t// else\n\t\t\t// {\n\t\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", this.hideHandler);\n\t\t\t//}\n\t\t}\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSliderPage && event.getSliderPage().getUrl() === this.sliderId)\n\t\t{\n\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", this.destroyHandler);\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tlet promise = new BX.Promise();\n\n\t\tlet html = '<div class=\"webform-buttons calendar-form-buttons-fixed\">' +\n\t\t\t'<span id=\"' + this.id + '_save\" class=\"webform-small-button webform-small-button-blue\">' + BX.message('USER_TYPE_RESOURCE_SAVE') + '</span>' +\n\t\t\t'<span id=\"' + this.id + '_close\" class=\"webform-button-link\">' + BX.message('USER_TYPE_RESOURCE_CLOSE') + '</span>' +\n\t\t\t'</div>' +\n\t\t\t'<div class=\"calendar-slider-calendar-wrap\">' +\n\t\t\t'<div class=\"calendar-slider-header\"><div class=\"calendar-head-area\"><div class=\"calendar-head-area-inner\"><div class=\"calendar-head-area-title\">' +\n\t\t\t'<span class=\"calendar-head-area-name\">' + BX.message('USER_TYPE_RESOURCE_SETTINGS') + \t\t\t'</span>' +\n\t\t\t'</div></div></div></div>' +\n\t\t\t'<div class=\"resource-booking-slider-workarea\"><div class=\"resource-booking-slider-content\"><div id=\"' + this.id + '_content\" class=\"resource-booking-settings\"></div></div></div></div>';\n\n\t\tpromise.fulfill(html);\n\t\tsetTimeout(this.initControls.bind(this), 100);\n\n\t\treturn promise;\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.content = BX(this.id + '_content');\n\n\t\tBX.bind(BX(this.id + '_save'), 'click', this.save.bind(this));\n\t\tBX.bind(BX(this.id + '_close'), 'click', this.close.bind(this));\n\n\t\t// 1. Field\n\t\tif (this.params && BX.type.isArray(this.params.filterSelectValues))\n\t\t{\n\t\t\tthis.DOM.fieldOuterWrap = this.DOM.content.appendChild(BX.create('DIV', {attrs: {className: 'calendar-settings-control'}}));\n\t\t\tthis.DOM.fieldOuterWrap.appendChild(BX.create('DIV', {\n\t\t\t\tattrs: {className: 'calendar-settings-control-name'},\n\t\t\t\ttext: BX.message('USER_TYPE_RESOURCE_FILTER_NAME')\n\t\t\t}));\n\n\t\t\tthis.DOM.fieldSelect = this.DOM.fieldOuterWrap.appendChild(BX.create('DIV', {attrs: {className: 'calendar-field-container calendar-field-container-select'}}))\n\t\t\t\t.appendChild(BX.create('DIV', {attrs: {className: 'calendar-field-block'}}))\n\t\t\t\t.appendChild(BX.create('select', {attrs: {className: 'calendar-field calendar-field-select'}}));\n\n\t\t\tthis.params.filterSelectValues.forEach(function(value){\n\t\t\t\tthis.DOM.fieldSelect.options.add(\n\t\t\t\t\tnew Option(value.TEXT, value.VALUE, this.params.filterSelect === value.VALUE, this.params.filterSelect === value.VALUE));\n\t\t\t}, this);\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tlet entityType = this.params.entityType || 'none';\n\t\tBX.userOptions.save('calendar', 'resourceBooking', entityType, this.DOM.fieldSelect.value);\n\t\tthis.close();\n\t\tBX.reload();\n\t}\n}\n\n\n\n","import {Event, Dom, Loc, Type} from \"calendar.resourcebooking\";\nimport {ServiceSelector} from \"./controls/serviceselector\"\nimport {UserSelectorFieldEditControl} from \"./controls/userselectorfieldeditcontrol\";\nimport {ModeSelector} from \"./controls/modeselector\";\nimport {ResourceSelectorFieldEditControl} from \"./controls/resourceselectorfieldeditcontrol\";\n\nexport class AdminSettingsViewer\n{\n\tconstructor(params = {})\n\t{\n\t\tthis.params = Type.isPlainObject(params) ? params : {};\n\t\tthis.fieldSettings = Type.isPlainObject(this.params.settings) ? this.params.settings : {};\n\n\t\tthis.DOM = {\n\t\t\touterWrap: document.getElementById(this.params.outerWrapId),\n\t\t\tform: document.forms[this.params.formName]\n\t\t};\n\t}\n\n\tshowLayout()\n\t{\n\t\tif (!this.DOM.outerWrap || !this.DOM.form)\n\t\t\treturn;\n\n\t\tEvent.bind(this.DOM.form, 'submit', this.onSubmit.bind(this));\n\n\t\tDom.addClass(this.DOM.outerWrap, 'calendar-resourcebook-content calendar-resourcebook-content-admin-settings');\n\n\t\tthis.DOM.innerWrap = this.DOM.outerWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-wrap\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-inner\"}}));\n\n\t\tlet\n\t\t\tresourceList = [],\n\t\t\tselectedResourceList = [];\n\n\t\tthis.DOM.innerWrap.appendChild(\n\t\t\tDom.create(\n\t\t\t\t\"div\",\n\t\t\t\t{\n\t\t\t\t\tprops: { className: \"calendar-resourcebook-content-block\" },\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t\t\"span\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprops: {className: \"calendar-resourcebook-content-block-title-text\"},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('USER_TYPE_RESOURCE_CHOOSE')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tnew ModeSelector({\n\t\t\t\t\t\t\t\tuseResources: this.fieldSettings.USE_RESOURCES === 'Y',\n\t\t\t\t\t\t\t\tuseUsers: this.fieldSettings.USE_USERS === 'Y',\n\t\t\t\t\t\t\t\tshowUsers: function(){\n\t\t\t\t\t\t\t\t\tthis.resourceList.hide();\n\t\t\t\t\t\t\t\t\tthis.userList.show();\n\t\t\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t\t\tshowResources: function(){\n\t\t\t\t\t\t\t\t\tthis.resourceList.show();\n\t\t\t\t\t\t\t\t\tthis.userList.hide();\n\t\t\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t\t\tshowResourcesAndUsers: function(){\n\t\t\t\t\t\t\t\t\tthis.resourceList.show();\n\t\t\t\t\t\t\t\t\tthis.userList.show();\n\t\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t\t}).getOuterWrap()\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tthis.DOM.optionWrap = this.DOM.innerWrap.appendChild(Dom.create(\n\t\t\t\"div\",\n\t\t\t{\n\t\t\t\tprops: { className: \"calendar-resourcebook-content-block\" }\n\t\t\t}\n\t\t));\n\n\t\t// region Use Resources Option\n\t\tthis.resourcesWrap = this.DOM.optionWrap.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\"}}));\n\n\t\tthis.resourcesTitleWrap = this.resourcesWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: Loc.getMessage('USER_TYPE_RESOURCE_RESOURCE_CONTROL_DEFAULT_NAME') + ':'}));\n\n\t\tthis.resourcesListWrap = this.resourcesWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-new-entries-wrap calendar-resourcebook-content-block-detail-inner\"}}));\n\n\t\tthis.resourcesListLowControls = this.resourcesWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resource-content-block-add-field\"}}));\n\n\t\tif (this.fieldSettings.RESOURCES\n\t\t\t&& Type.isPlainObject(this.fieldSettings.RESOURCES['resource'])\n\t\t\t&& Type.isArray(this.fieldSettings.RESOURCES['resource'].SECTIONS))\n\t\t{\n\t\t\tthis.fieldSettings.RESOURCES['resource'].SECTIONS.forEach(function(resource)\n\t\t\t{\n\t\t\t\tresourceList.push({\n\t\t\t\t\tid: resource.ID,\n\t\t\t\t\ttitle: resource.NAME,\n\t\t\t\t\ttype: resource.CAL_TYPE\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isArray(this.fieldSettings.SELECTED_RESOURCES))\n\t\t{\n\t\t\tthis.fieldSettings.SELECTED_RESOURCES.forEach(function(resource)\n\t\t\t{\n\t\t\t\tselectedResourceList.push({\n\t\t\t\t\tid: resource.id,\n\t\t\t\t\ttype: resource.type\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.resourceList = new ResourceSelectorFieldEditControl({\n\t\t\tshown: this.fieldSettings.USE_RESOURCES === 'Y',\n\t\t\teditMode: true,\n\t\t\touterWrap: this.resourcesWrap,\n\t\t\tlistWrap: this.resourcesListWrap,\n\t\t\tcontrolsWrap: this.resourcesListLowControls,\n\t\t\tvalues: selectedResourceList,\n\t\t\tresourceList: resourceList,\n\t\t\tcheckLimitCallback: this.checkResourceCountLimit.bind(this)\n\t\t});\n\n\t\tthis.userSelectorWrap = this.DOM.optionWrap.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\"}}));\n\n\t\tthis.usersTitleWrap = this.userSelectorWrap\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}}))\n\t\t\t.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: Loc.getMessage('USER_TYPE_RESOURCE_USERS_CONTROL_DEFAULT_NAME') + ':'}));\n\n\t\tthis.usersListWrap = this.userSelectorWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-control custom-field-item\"}}));\n\n\t\tlet itemsSelected = [];\n\t\tif (Type.isArray(this.fieldSettings.SELECTED_USERS))\n\t\t{\n\t\t\tthis.fieldSettings.SELECTED_USERS.forEach(function(user)\n\t\t\t{\n\t\t\t\titemsSelected.push('U' + parseInt(user));\n\t\t\t});\n\t\t}\n\n\t\tthis.userList = new UserSelectorFieldEditControl({\n\t\t\tshown: this.fieldSettings.USE_USERS === 'Y',\n\t\t\touterWrap: this.userSelectorWrap,\n\t\t\twrapNode: this.usersListWrap,\n\t\t\tsocnetDestination: this.params.socnetDestination,\n\t\t\titemsSelected: itemsSelected\n\t\t});\n\n\t\t// Region Data, Time and services\n\t\tthis.DOM.optionWrap.appendChild(\n\t\t\tDom.create(\"hr\", { props: { className: \"calendar-resbook-hr\"}})\n\t\t);\n\n\t\tthis.datetimeOptionsWrap = this.DOM.optionWrap.appendChild(Dom.create(\"div\", {props: { className: \"calendar-resourcebook-content-block-control-field calendar-resourcebook-content-block-control-field-add\" }}));\n\n\t\tthis.datetimeOptionsWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title\"}})).appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-title-text\"}, text: Loc.getMessage('USER_TYPE_RESOURCE_DATETIME_BLOCK_TITLE') + ':'}));\n\n\t\tthis.datetimeOptionsInnerWrap = this.datetimeOptionsWrap.appendChild(Dom.create(\"div\", {props: {className: \"calendar-resourcebook-content-block-options\"}}));\n\t\t// endregion\n\n\t\t//region Checkbox \"Full day\"\n\t\tthis.DOM.fulldayCheckBox = Dom.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tprops: { type: \"checkbox\", checked: this.fieldSettings.FULL_DAY === 'Y'}\n\t\t\t}\n\t\t);\n\n\t\tthis.datetimeOptionsInnerWrap.appendChild(\n\t\t\tDom.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis.DOM.fulldayCheckBox,\n\t\t\t\t\t\t\tDom.create(\"span\", { text: Loc.getMessage('USER_TYPE_RESOURCE_FULL_DAY') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\n\t\t//region Checkbox \"Add services\"\n\t\tthis.DOM.useServicedayCheckBox = Dom.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tchecked: this.fieldSettings.USE_SERVICES === 'Y'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'click' : function(){\n\t\t\t\t\t\tif (this.serviceList)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.serviceList.show(this.DOM.useServicedayCheckBox.checked);\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.datetimeOptionsInnerWrap.appendChild(\n\t\t\tDom.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis.DOM.useServicedayCheckBox,\n\t\t\t\t\t\t\tDom.create(\"span\", { text: Loc.getMessage('USER_TYPE_RESOURCE_ADD_SERVICES') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tthis.serviceList = new ServiceSelector({\n\t\t\touterCont: this.datetimeOptionsInnerWrap,\n\t\t\tfieldSettings: this.fieldSettings,\n\t\t\tgetFullDayValue: function(){return this.DOM.fulldayCheckBox.checked}.bind(this)\n\t\t});\n\n\t\tthis.DOM.optionWrap.appendChild(\n\t\t\tDom.create(\"hr\", { props: { className: \"calendar-resbook-hr\"}})\n\t\t);\n\n\t\tthis.DOM.overbookingCheckbox = Dom.create(\"input\", {props: {type: \"checkbox\", checked: this.fieldSettings.ALLOW_OVERBOOKING === 'Y'}});\n\n\t\tthis.DOM.optionWrap.appendChild(\n\t\t\tDom.create(\n\t\t\t\t\"label\",\n\t\t\t\t{\n\t\t\t\t\tprops: {className: 'calendar-resourcebook-content-block-option'},\n\t\t\t\t\tchildren:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tthis.DOM.overbookingCheckbox,\n\t\t\t\t\t\t\tDom.create(\"span\", { text: Loc.getMessage('USER_TYPE_RESOURCE_OVERBOOKING') })\n\t\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\t//endregion\n\t}\n\n\tonSubmit(e)\n\t{\n\t\tif (!this.DOM.inputsWrap)\n\t\t{\n\t\t\tthis.DOM.inputsWrap = this.DOM.outerWrap.appendChild(Dom.create(\"DIV\"));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.DOM.inputsWrap);\n\t\t}\n\n\t\tlet inputName = this.params.htmlControl.NAME;\n\t\tthis.DOM.inputsWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs:{\n\t\t\t\tname: inputName + '[USE_USERS]',\n\t\t\t\tvalue: this.userList.isShown() ? 'Y' : 'N',\n\t\t\t\ttype: 'hidden'\n\t\t\t}}));\n\n\t\tthis.DOM.inputsWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs:{\n\t\t\t\tname: inputName + '[USE_RESOURCES]',\n\t\t\t\tvalue: this.resourceList.isShown() ? 'Y' : 'N',\n\t\t\t\ttype: 'hidden'\n\t\t\t}}));\n\n\t\tthis.DOM.inputsWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs:{\n\t\t\t\tname: inputName + '[USE_SERVICES]',\n\t\t\t\tvalue: this.DOM.useServicedayCheckBox.checked ? 'Y' : 'N',\n\t\t\t\ttype: 'hidden'\n\t\t\t}}));\n\n\t\tthis.DOM.inputsWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs:{\n\t\t\t\tname: inputName + '[FULL_DAY]',\n\t\t\t\tvalue: this.DOM.fulldayCheckBox.checked ? 'Y' : 'N',\n\t\t\t\ttype: 'hidden'\n\t\t\t}}));\n\n\t\tthis.DOM.inputsWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs:{\n\t\t\t\tname: inputName + '[ALLOW_OVERBOOKING]',\n\t\t\t\tvalue: this.DOM.overbookingCheckbox.checked ? 'Y' : 'N',\n\t\t\t\ttype: 'hidden'\n\t\t\t}}));\n\n\t\t// Selected resources\n\t\tif (this.resourceList)\n\t\t{\n\t\t\tthis.prepareFormDataInputs(this.DOM.inputsWrap, this.resourceList.getSelectedValues().concat(this.resourceList.getDeletedValues()), inputName + '[SELECTED_RESOURCES]');\n\t\t}\n\n\t\t// // Selected users\n\t\tif (this.userList)\n\t\t{\n\t\t\tlet SELECTED_USERS = [];\n\t\t\tthis.userList.getAttendeesCodesList().forEach(function(code)\n\t\t\t{\n\t\t\t\tif (code.substr(0, 1) === 'U')\n\t\t\t\t{\n\t\t\t\t\tSELECTED_USERS.push(parseInt(code.substr(1)));\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tthis.prepareFormDataInputs(this.DOM.inputsWrap, SELECTED_USERS, inputName + '[SELECTED_USERS]');\n\t\t}\n\n\t\tif (this.DOM.useServicedayCheckBox.checked && this.serviceList)\n\t\t{\n\t\t\tthis.prepareFormDataInputs(this.DOM.inputsWrap, this.serviceList.getValues(), inputName + '[SERVICE_LIST]');\n\t\t}\n\t}\n\n\tprepareFormDataInputs(wrap, data, inputName)\n\t{\n\t\tdata.forEach(function(value, ind)\n\t\t{\n\t\t\tif (Type.isPlainObject(value))\n\t\t\t{\n\t\t\t\tlet k;\n\t\t\t\tfor (k in value)\n\t\t\t\t{\n\t\t\t\t\tif (value.hasOwnProperty(k))\n\t\t\t\t\t{\n\t\t\t\t\t\twrap.appendChild(Dom.create('INPUT', {\n\t\t\t\t\t\t\tattrs:{\n\t\t\t\t\t\t\t\tname: inputName + '[' + ind + '][' + k + ']',\n\t\t\t\t\t\t\t\tvalue: value[k],\n\t\t\t\t\t\t\t\ttype: 'hidden'\n\t\t\t\t\t\t\t}}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twrap.appendChild(Dom.create('INPUT', {\n\t\t\t\t\tattrs:{\n\t\t\t\t\t\tname: inputName + '[' + ind + ']',\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\ttype: 'hidden'\n\t\t\t\t\t}}));\n\t\t\t}\n\t\t}, this);\n\t}\n\n\tgetTotalResourceCount()\n\t{\n\t\tlet result = 0;\n\n\t\tif (this.fieldSettings)\n\t\t{\n\t\t\tif (Type.isPlainObject(this.fieldSettings.RESOURCES)\n\t\t\t\t&& Type.isPlainObject(this.fieldSettings.RESOURCES.resource)\n\t\t\t\t&& Type.isArray(this.fieldSettings.RESOURCES.resource.SECTIONS)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult += this.fieldSettings.RESOURCES.resource.SECTIONS.length;\n\t\t\t}\n\n\t\t\tif (this.resourceList)\n\t\t\t{\n\t\t\t\tresult -= this.resourceList.getDeletedValues().length;\n\n\t\t\t\tthis.resourceList.getSelectedValues().forEach(function(value)\n\t\t\t\t{\n\t\t\t\t\tif (!value.id && value.title !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tresult++;\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tif (this.userList)\n\t\t\t{\n\t\t\t\tresult += this.userList.getAttendeesCodesList().length;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tcheckResourceCountLimitForNewEntries()\n\t{\n\t\treturn this.RESOURCE_LIMIT <= 0 || this.getTotalResourceCount() < this.RESOURCE_LIMIT;\n\t}\n\n\tcheckResourceCountLimit()\n\t{\n\t\treturn this.RESOURCE_LIMIT <= 0 || this.getTotalResourceCount() <= this.RESOURCE_LIMIT;\n\t}\n}","import {AdjustFieldController} from \"./adjustfieldcontroller\";\nimport {EditFieldController} from \"./editfieldcontroller\";\nimport {Type} from \"main.core\";\nimport {Resourcebooking, BookingUtil} from \"calendar.resourcebooking\";\nimport {customizeCrmEntityEditor} from \"./customizecrmentityeditor\"\nimport {CalendarViewSettingsSlider} from \"./calendarviewsettingsslider\"\nimport {AdminSettingsViewer} from \"./adminsettingsviewer\"\n\nexport {Resourcebooking, BookingUtil, AdminSettingsViewer};\nexport class ResourcebookingUserfield\n{\n\tstatic fieldParamsCache = {};\n\tstatic socnetDestination = null;\n\n\t/**\n\t * Creates instance of Resourcebooking field for crm form edit interface (not for live form)\n\t * and initialize it with given field params\n\t * Used in CRM webform module to display and adjust resourcebooking field\n\t *\n\t * @param {array} params - incoming data params\n\t */\n\tstatic initCrmFormFieldController(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {\n\t\t\t\tfield:{}\n\t\t\t};\n\t\t}\n\n\t\tlet bookingFieldParams = {};\n\t\tif (Type.isDomNode(params.field.node))\n\t\t{\n\t\t\tbookingFieldParams.outerWrap = params.field.node;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"The argument \\\"params.field.node\\\" must be a DOM node.\");\n\t\t}\n\n\t\tbookingFieldParams.innerWrap = bookingFieldParams.outerWrap.querySelector('.crm-webform-resourcebooking-wrap');\n\t\tif (!bookingFieldParams.innerWrap)\n\t\t{\n\t\t\tthrow new Error(\"Can't find necessary DOM node \\\"div.crm-webform-resourcebooking-wrap\\\"\");\n\t\t}\n\n\t\tbookingFieldParams.name = params.field.name;\n\t\tbookingFieldParams.formName = 'FIELD[' + params.field.name + ']';\n\t\tbookingFieldParams.captionNode = params.field.lblCaption;\n\t\tbookingFieldParams.entityFieldName = params.field.entity_field_name;\n\t\tbookingFieldParams.entityName = params.field.dict.entity_field_name;\n\n\t\tbookingFieldParams.settings = {\n\t\t\tcaption: params.field.captionValue || params.field.dict.caption,\n\t\t\trequired: params.field.isRequired || params.field.dict.required,\n\t\t\tdata: (Type.isPlainObject(params.field.booking) && Type.isPlainObject(params.field.booking.settings_data))\n\t\t\t\t? params.field.booking.settings_data\n\t\t\t\t: (params.field.settingsData || [])\n\t\t};\n\n\t\tlet adjustFieldController = new AdjustFieldController(bookingFieldParams);\n\t\tadjustFieldController.init();\n\n\t\treturn adjustFieldController;\n\t}\n\n\tstatic initEditFieldController(params)\n\t{\n\t\tlet editFieldController = new EditFieldController(params);\n\t\teditFieldController.init();\n\n\t\treturn editFieldController;\n\t}\n\n\tstatic getCrmFieldConfigurator(id, settings)\n\t{\n\t\tif(window.BX && BX.Crm && Type.isFunction(BX.Crm.EntityEditorUserFieldConfigurator))\n\t\t{\n\t\t\treturn customizeCrmEntityEditor(BX.Crm.EntityEditorUserFieldConfigurator).create(id, settings);\n\t\t}\n\t}\n\n\tstatic getUserFieldParams(params = {})\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tlet fieldName = params.fieldName || '';\n\n\t\t\tif (params.clearCache || !ResourcebookingUserfield.fieldParamsCache[params.fieldName])\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.resourcebookingajax.getfieldparams', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfieldname: params.fieldName,\n\t\t\t\t\t\tselectedUsers: params.selectedUsers || []\n\t\t\t\t\t}\n\t\t\t\t}).then((response) => {\n\t\t\t\t\t\tResourcebookingUserfield.fieldParamsCache[fieldName] = response.data;\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(ResourcebookingUserfield.fieldParamsCache[fieldName]);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getPluralMessage(messageId, number)\n\t{\n\t\tlet pluralForm, langId;\n\n\t\tlangId = BX.message('LANGUAGE_ID') || 'en';\n\t\tnumber = parseInt(number);\n\n\t\tif (number < 0)\n\t\t{\n\t\t\tnumber = -1*number;\n\t\t}\n\n\t\tif (langId)\n\t\t{\n\t\t\tswitch (langId)\n\t\t\t{\n\t\t\t\tcase 'ru':\n\t\t\t\tcase 'ua':\n\n\t\t\t\t\tif ((number % 10 === 1) && (number % 100 !== 11))\n\t\t\t\t\t{\n\t\t\t\t\t\tpluralForm = 0;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tpluralForm = ((number%10 >= 2) && (number%10 <= 4) && ((number%100 < 10) || (number%100 >= 20)))\n\t\t\t\t\t\t\t? 1\n\t\t\t\t\t\t\t: 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pl':\n\t\t\t\t\tif (number <= 4)\n\t\t\t\t\t{\n\t\t\t\t\t\tpluralForm = number === 1 ? 0 : 1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tpluralForm = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: // en, de and other languages\n\t\t\t\t\tpluralForm = (number !== 1) ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpluralForm = 1;\n\t\t}\n\n\t\treturn BX.message(messageId + '_PLURAL_' + pluralForm);\n\t}\n\n\tstatic getParamsFromHash(userfieldId)\n\t{\n\t\tlet\n\t\t\tparams, regRes,\n\t\t\thash = unescape(window.location.hash);\n\n\t\tif (hash)\n\t\t{\n\t\t\tregRes = new RegExp('#calendar:' + userfieldId + '\\\\|(.*)', 'ig').exec(hash);\n\t\t\tif (regRes && regRes.length > 1)\n\t\t\t{\n\t\t\t\tparams = regRes[1].split('|');\n\t\t\t}\n\t\t}\n\t\treturn params;\n\t}\n\n\tstatic openExternalSettingsSlider(params)\n\t{\n\t\tlet settingsSlider = new CalendarViewSettingsSlider(params);\n\t\tsettingsSlider.show();\n\t}\n\n\tstatic setSocnetDestination(socnetDestination)\n\t{\n\t\tResourcebookingUserfield.socnetDestination = socnetDestination;\n\t}\n\n\tstatic getSocnetDestination()\n\t{\n\t\treturn ResourcebookingUserfield.socnetDestination;\n\t}\n}"],"names":["FormFieldTunnerAbstract","constructor","label","formLabel","displayed","valuePopup","statePopup","displayCheckboxDisabled","DOM","build","params","updateConfig","fieldWrap","Dom","create","props","className","labelWrap","appendChild","labelNode","text","getLabel","formTitleWrap","isDisplayed","formTitleLabel","getFormLabel","events","click","enableFormTitleEditMode","bind","formTitleEditIcon","checkboxNode","attrs","type","value","checked","disabled","checkDisplayMode","buildStatePopup","wrap","config","buildValuePopup","Type","isFunction","changeSettingsCallback","destroy","closePopup","setFormLabel","show","displayInForm","hideInForm","addClass","triggerChangeRefresh","removeClass","formTitleInputNode","blur","finishFormTitleEditMode","style","display","focus","adjust","getSettingsValue","setTimeout","BX","onCustomEvent","FormFieldTunnerPopupAbstract","id","Math","round","random","menuItems","outerWrap","handleClickFunc","handleClick","innerWrap","currentStateLink","getCurrentModeState","showPopup","isPopupShown","getMenuItems","Event","unbind","document","popup","PopupMenu","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","popupWindow","setAngle","offset","position","popupContainer","forEach","menuItem","inputType","inputNameStr","dataset","menuItemClassName","inputName","innerHtml","textValue","layout","item","innerHTML","close","maxHeight","isShown","isNodeInDom","getPopupContent","handlePopupClick","e","target","srcElement","hasAttribute","findParent","attribute","handleControlChanges","changesTimeout","clearTimeout","delegate","menuItemClick","isParentForNode","animation","setDisabled","setEnabled","FormFieldTunnerValuePopupAbstract","selectedValues","valueLink","getCurrentValueState","mouseover","showHoverPopup","mouseout","hideHoverPopup","PopupWindow","loseByEsc","width","getPopupWidth","lightShadow","content","proxy","addCustomEvent","handlePopupCloose","message","minWidth","minHeight","showPopupLoader","hidePopupLoader","popupLoader","BookingUtil","getLoader","remove","FormFieldTunnerMultipleChecknoxPopupAbstract","values","push","util","htmlspecialchars","title","onclick","length","selectAllMessage","selectAllItemClick","find","itemId","selectAllChecked","selectAllcheckbox","checkbox","querySelector","foundValue","hasClass","selectItem","deselectItem","in_array","index","array_search","deleteFromArray","i","checkboxes","querySelectorAll","getSelectedValues","UserSelectorFieldTunner","Loc","getMessage","selectedUsers","defaultMode","UsersStatePopup","isArray","selected","split","valueWrap","Tag","render","usersValueLink","showUserSelectorDialog","getCurrentUsersValueText","count","ResourcebookingUserfield","getPluralMessage","userSelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","map","userId","enableSearch","zIndex","handleUserSelectorChanges","entities","options","inviteGuestLink","emailUsers","getSelectedItems","entityId","EventEmitter","emit","getValue","getDefaultMode","name","MenuItem","delimiter","isDomNode","nodeName","toLowerCase","ResourceSelectorFieldTunner","multiple","ResourcesStatePopup","ResourcesValuePopup","getMultiple","getSelectedId","selectedItems","selectedIndex","selectAll","isString","resources","resource","valueId","prepareValueId","result","val","parseInt","ServiceSelectorFieldTunner","html","ServiceValuePopup","undefined","translit","services","service","getDurationLabel","duration","DurationSelectorFieldTunner","defaultValue","manualInput","DurationStatePopup","getDefaultValue","getManualInput","durationList","getDurationList","fullDay","getDurationLabelByValue","items","getDefaultMenuItems","concat","foundDuration","DateSelectorFieldTunner","start","DateStatePopup","getStyle","getStart","styleInputName","startInputName","TimeSelectorFieldTunner","showOnlyFree","showFinishTime","scale","TimeStatePopup","getShowFinishTime","getShowOnlyFree","getScale","stateShowFreeId","stateShowFinishId","getDurationMenuItems","filter","AdjustFieldController","setEventNamespace","complexFields","userFieldParams","settingsData","getSettingsData","settings","data","settingsWrap","captionNode","settingsInputs","init","showFieldLoader","getUserFieldParams","fieldName","entityName","getSelectedUsers","then","fieldParams","hideFieldLoader","fieldLayout","FieldViewControllerEdit","displayTitle","getCaption","getSettings","updateSettingsDataInputs","BaseEvent","showSettingsPopup","settingsPopupId","settingsPopup","getSettingsContentNode","overlay","backgroundColor","opacity","titleBar","closeIcon","buttons","PopupWindowButton","buttonNodeWrap","buttonNode","parentNode","destroyControls","previewFieldLayout","leftWrap","buildSettingsForm","previewWrap","FieldViewControllerPreview","handleWebformSettingsChanges","titleId","captionWrap","captionInput","change","updateCaption","keyup","fieldsOuterWrap","fieldsWrap","userfieldSettings","useUsers","buildComplexField","updateSettings","users","checkBitrix24Limitation","useResources","useServices","date","time","replace","k","hasOwnProperty","refreshLayoutTimeout","refreshLayout","getOuterWrap","getInnerWrap","offsetHeight","isObject","field","option","clone","getDefaultSettingsData","isPlainObject","updateSettingsInputValue","key","uniKey","join","formName","fieldLoader","SETTINGS","SELECTED_RESOURCES","SELECTED_USERS","SERVICE_LIST","FULL_DAY","USE_RESOURCES","USE_USERS","USE_SERVICES","resourceLimit","RESOURCE_LIMIT","userIndex","USER_INDEX","caption","updateTitle","isRequired","required","updateRequiredValue","requiredCheckbox","usersValue","showLimitationPopup","UserSelectorFieldEditControl","wrapNode","destinationInputName","selectGroups","addMessage","checkLimit","checkLimitCallback","itemsSelected","getSocnetDestinationConfig","shown","SocNetLogDestination","deleteItem","getAttribute","block","openDialog","socnetDestinationInputWrap","socnetDestinationInput","keydown","searchBeforeHandler","inputId","searchHandler","linkId","sendAjax","socnetDestinationLink","hide","_this","itemsLast","groups","department","sonetgroups","searchInput","extranetUser","userSearchArea","bindMainPopup","node","bindSearchPopup","callback","select","selectCallback","unSelect","unSelectCallback","openDialogCallback","closeDialog","closeDialogCallback","openSearch","closeSearch","departmentSelectDisable","closeAll","isOpenDialog","addUserBlock","getAttendeesCodesList","includes","blocks","itemWrap","elements","findChildren","j","cleanInputValue","isOpenSearch","backspaceDisable","window","keyCode","preventDefault","getCodes","inputsList","getElementsByTagName","codes","trim","getAttendeesCodes","convertAttendeesCodes","attendeesCodes","code","substr","res","socnetDestination","USERS","EXTRANET_USER","DENY_TOALL","UA","SONETGROUPS","DEPARTMENT","departmentRelation","DEPARTMENT_RELATION","LAST","SELECTED","inputs","setValues","userList","trigerOnChange","user","obItems","onChangeCallback","getId","ResourceSelectorFieldEditControl","editMode","resourceList","checkLimitForNew","checkLimitCallbackForNew","selectedValuesIndex","selectedBlocks","newValues","blocksWrap","listWrap","controlsWrap","arrowNode","addButton","addResourceBlock","selectButton","openResourcesPopup","handleBlockClick","blockValue","element","checkBlockWrapState","isResourcesPopupShown","deleted","foundResource","removeResourceBlock","checkResourceInputs","menuItemNode","textNode","offsetWidth","B24","blockEntry","input","placeholder","resourceType","resourceId","delButton","focusInput","transparent","children","max","childNodes","emptyPlaceholder","closeResourcesPopup","getValues","addToSelectedValues","getDeletedValues","PlannerPopup","bindNode","plannerId","plannerConfig","lastPlannerIdShown","currentEntries","plannerWrap","Popup","bindPos","pos","winSize","GetWindowSize","plannerWidth","innerWidth","right","showPlanner","update","refreshParams","codeIndex","fromTimestamp","toTimestamp","dateFrom","dateTo","lastUpdateParams","focusSelector","from","to","parseDate","getTime","selector","getDayLength","Date","scaleDateFrom","scaleDateTo","requestData","formatDate","currentEventList","checkUpdateParams","showPlannerLoader","ajax","runAction","response","hidePlannerLoader","lastRequestData","entries","currentAccessibility","accessibility","currentLoadedDataFrom","currentLoadedDataTo","entry","selectedResources","updateScaleLimits","loadedDataFrom","loadedDataTo","requestPlannerUpdate","lastRequestPlannerId","array_diff","resIndex","planner","CalendarPlanner","updateScaleType","RRULE","selectorOnChangeCallback","selectEntriesOnChangeCallback","checkSelectorStatusCallback","loader","removeCustomEvent","getPlannerId","EditFieldController","plannerPopup","controlId","valueInputs","isNew","DATE_FROM","setSocnetDestination","buildUserfieldWrap","createEventHandlers","setControlValues","buildDateControl","buildTimeControl","buildServiceControl","buildDurationControl","buildUserSelectorControl","buildResourceSelectorControl","showPlannerPopup","fromInput","durationInput","allowOverbooking","isOverbooked","addError","Crm","EntityValidationError","Promise","resolve","onChangeValues","allValuesValue","defaultDuration","getParamsFromHash","userfieldId","roundMin","r","timestamp","ceil","DATE_TO","getDateFormat","timeFromInput","getTimeFormatShort","setValue","serviceList","SERVICE_NAME","ENTRIES","TYPE","RESOURCE_ID","resourceSelector","userSelector","dateTimeWrap","dateWrap","showCalendarPicker","triggerUpdatePlanner","emptyInput","timeWrap","fromTime","SelectInput","getSimpleTimeList","onAfterMenuOpen","ind","popupMenu","formatDatetime","isAmPmMode","nearestTimeValue","adaptTimeValue","h","getHours","m","getMinutes","menuContainer","scrollTop","durationWrap","servicesWrap","serviceInput","serviceListValues","state","realValue","parseDuration","durationControlWrap","userSelectorWrap","userSelectorTitle","userListWrap","userKey","getSocnetDestination","checkResourceCountLimit","resourcesWrap","resSelectorTitle","resourcesListWrap","calendar","bTime","dateFromValue","serviceName","isDate","getSelectedResourceList","getSelectedUserList","getDateTimeFormat","fireEvent","EVENT_ID","isNull","getPlannerConfig","getSelectorData","plannerSelectorOnChange","plannerSelectedEntriesOnChange","getResourceList","getUserList","selectEntriesMode","scaleLimitOffsetLeft","scaleLimitOffsetRight","maxTimelineSize","minEntryRows","entriesListWidth","timelineCellWidth","accuracy","workTime","clickSelectorScaleAccuracy","errorClass","overbooked","status","errorNode","getTotalResourceCount","ServiceSelector","outerCont","fieldSettings","serviceListOuterWrap","durationTitleId","servicesTitleWrap","serviceListRowsWrap","addRow","serviceListAddWrap","serviceAddButton","checkDurationTitlePosition","row","getDefaultDuration","nameInput","fullday","getFullDayValue","deleteWrap","timeout","checkDurationTitlePositionTimeout","left","clickHandler","resWrap","checkRows","rows","onFullClearHandler","TimezoneSelector","add","Option","selectedValue","getTimezoneList","timezoneList","timezone","clearCache","timezone_id","default","ModeSelector","showResources","modeSwitcherPopup","showUsers","showResourcesAndUsers","switcherId","angle","customizeCrmEntityEditor","CrmConfigurator","Configurator","superclass","apply","extend","self","initialize","prototype","_hasLayout","_mode","EntityEditorMode","view","getBitrix24Limitation","limit","_field","fieldInfo","getFieldInfo","getDefaultUserfieldSettings","displayCallback","_wrapper","_innerWrapper","selectedResourceList","manager","_editor","getUserFieldManager","getTitle","getDefaultFieldLabel","_typeId","_labelInput","optionWrapper","resourcesTitleWrap","resourcesListLowControls","RESOURCES","SECTIONS","ID","NAME","CAL_TYPE","checkResourceCountLimitForNewEntries","usersTitleWrap","usersListWrap","datetimeOptionsWrap","datetimeOptionsInnerWrap","timezoneSettingsWrap","timezoneSelectorWrap","USE_USER_TIMEZONE","timezoneSelectWrap","timezoneSelector","TIMEZONE","useUserTimezoneCheckBox","handleUserTimezoneCheckbox","_fulldayCheckBox","handleFullDayMode","_servicesCheckBox","additionaOptionsWrap","_isRequiredCheckBox","_showAlwaysCheckBox","prop","getBoolean","_settings","checkOptionFlag","EntityEditorControlOptions","showAlways","_overbookingCheckBox","ALLOW_OVERBOOKING","onSaveButtonClick","onCancelButtonClick","registerLayout","_isLocked","typeId","mandatory","CalendarViewSettingsSlider","sliderId","SLIDER_WIDTH","SLIDER_DURATION","SidePanel","Instance","open","contentCallback","animationDuration","hideHandler","destroyHandler","event","getSliderPage","getUrl","promise","fulfill","initControls","save","filterSelectValues","fieldOuterWrap","fieldSelect","TEXT","VALUE","filterSelect","entityType","userOptions","reload","AdminSettingsViewer","getElementById","outerWrapId","form","forms","showLayout","onSubmit","optionWrap","fulldayCheckBox","useServicedayCheckBox","overbookingCheckbox","inputsWrap","clean","htmlControl","prepareFormDataInputs","initCrmFormFieldController","bookingFieldParams","Error","lblCaption","entityFieldName","entity_field_name","dict","captionValue","booking","settings_data","adjustFieldController","initEditFieldController","editFieldController","getCrmFieldConfigurator","EntityEditorUserFieldConfigurator","fieldParamsCache","fieldname","messageId","number","pluralForm","langId","regRes","hash","unescape","location","RegExp","exec","openExternalSettingsSlider","settingsSlider"],"mappings":"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"}