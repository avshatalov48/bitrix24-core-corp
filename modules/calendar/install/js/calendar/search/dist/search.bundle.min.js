this.BX=this.BX||{};(function(e,t,i,s,r){"use strict";let l=e=>e,a;class n{constructor(e){this.PRESET_INVITED="filter_calendar_meeting_status_q";this.EMPTY_RESULT_POPUP_WIDTH=466;this.MIN_QUERY_LENGTH=3;this.SHOW_LOADER_DELAY=500;this.MIN_LOADER_DURATION=1e3;this.BX=BX;this.filterId=e;this.filter=this.BX.Main.filterManager.getById(this.filterId);this.filterApi=this.filter.getApi();this.isActive=false;this.isInvitationEnabled=false;this.DOM={filterWrap:this.filter.popupBindElement,filterInput:this.filter.popupBindElement.querySelector("input")};this.updateActive();this.DOM.filterInput.removeEventListener("input",this.updateActive.bind(this));this.DOM.filterInput.addEventListener("input",this.updateActive.bind(this));i.EventEmitter.unsubscribe("BX.Filter.Search:input",this.updateActive.bind(this));i.EventEmitter.unsubscribe("BX.Main.Filter:beforeApply",this.beforeApplyFilterHandler.bind(this));i.EventEmitter.unsubscribe("BX.Main.Filter:apply",this.applyFilterHandler.bind(this));i.EventEmitter.subscribe("BX.Filter.Search:input",this.updateActive.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:beforeApply",this.beforeApplyFilterHandler.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:apply",this.applyFilterHandler.bind(this))}getFilter(){return this.filter}beforeApplyFilterHandler(){const e=t.Util.getCalendarContext();this.filterDataLoaderStartTime=false;this.filterDataRequestSent=true;clearTimeout(this.showLoaderTimeout);this.showLoaderTimeout=setTimeout((()=>{if(this.filterDataRequestSent){this.filterDataLoaderStartTime=(new Date).getTime();e.showLoader()}}),this.SHOW_LOADER_DELAY);this.updateActive()}applyFilterHandler(){this.isInvitationEnabled=false;this.applyFilter()}applyFilter(){const e=t.Util.getCalendarContext();if(this.isFilterEmpty()){if(e.getView().resetFilterMode){e.getView().resetFilterMode({resetSearchFilter:false})}this.filterDataRequestSent=false;e.hideLoader();return}BX.ajax.runAction("calendar.api.calendarajax.getFilterData",{data:{ownerId:e.util.config.ownerId,userId:e.util.config.userId,type:e.util.config.type}}).then((t=>{this.filterDataRequestSent=false;if(this.filterDataLoaderStartTime){const i=(new Date).getTime()-this.filterDataLoaderStartTime;const s=this.MIN_LOADER_DURATION-i;if(s>0){setTimeout((()=>{e.hideLoader();this.displaySearchResult(e,t.data.entries)}),s)}else{e.hideLoader();this.displaySearchResult(e,t.data.entries)}}else{this.displaySearchResult(e,t.data.entries)}}),(t=>{console.error(t);e.hideLoader()}))}displaySearchResult(e,t){if(!t){return}if(!this.isInvitationPresetEnabled()&&t.length===0){this.showEmptyResultPopup();return}e.viewNameBeforeFilter=e.getView().name;if(e.getView().getViewRange){e.dateBeforeFilter=e.getView().getViewRange().start}e.setView("list",{animation:true});e.getView().applyFilterMode();this.displayFilterResult(t)}displayFilterResult(e){const i=t.Util.getCalendarContext();const s=[];for(const t of e){s.push(new window.BXEventCalendar.Entry(i,t))}i.getView().displayResult(s)}showEmptyResultPopup(){const e=this.EMPTY_RESULT_POPUP_WIDTH;if(!this.emptyResultPopup){this.emptyResultPopup=new r.Popup({className:"calendar-search-no-result-popup",content:this.getEmptyResultPopupContent(),bindElement:this.DOM.filterWrap,offsetTop:5,offsetLeft:this.DOM.filterWrap.offsetWidth/2-e/2,width:e,closeIcon:true,overlay:{opacity:0},autoHide:true,closeByEsc:true,animation:"fading-slide",angle:{position:"top",offset:e/2-10}})}this.emptyResultPopup.show()}getEmptyResultPopupContent(){return s.Tag.render(a||(a=l`<div class="calendar-search-no-result-popup-container">
			<div class="calendar-search-no-result-popup-title">${0}</div>
			<div class="calendar-search-no-result-popup-text">${0}</div>
		</div>`),s.Loc.getMessage("EC_CALENDAR_EMPTY_SEARCH_RESULT_TITLE"),s.Loc.getMessage("EC_CALENDAR_EMPTY_SEARCH_RESULT_TEXT"))}isFilterEmpty(){return this.arePresetsEmpty()&&this.isSearchEmpty()}arePresetsEmpty(){const e=this.filter.getSearch();return!e.getLastSquare()}isSearchEmpty(){const e=this.getSearchQuery();return!e||e.length<this.MIN_QUERY_LENGTH}getSearchQuery(){return this.filter.getSearch().getSearchString()}setPresetInvitation(){this.isInvitationEnabled=true;this.filterApi.setFilter({preset_id:this.PRESET_INVITED})}resetPreset(){this.filterApi.setFilter({preset_id:"default_filter"})}resetFilter(){this.filter.resetFilter()}isInvitationPresetEnabled(){const e=this.filter.getFilterFieldsValues();return this.getFilterPreset()===this.PRESET_INVITED||e.MEETING_STATUS==="Q"}updateActive(){if(this.emptyResultPopup){this.emptyResultPopup.close()}this.setActive(this.isFilterActive())}isFilterActive(){if(this.isInvitationEnabled&&!this.isActive){return false}const e=!["default_filter","tmp_filter"].includes(this.getFilterPreset());const t=this.filter.getSearch().getSearchString()==="";return e||!t||this.hasFilledFields()}hasFilledFields(){const e=this.filter.getFilterFieldsValues();for(const t in e){const i=e[t];const s=this.isArrayFieldFilled(i)||this.isStringFieldFilled(i);if(s){return true}}return false}isArrayFieldFilled(e){return BX.Type.isArrayFilled(e)}isStringFieldFilled(e){return e!=="NONE"&&BX.Type.isStringFilled(e)}getFilterPreset(){return this.filter.getPreset().getCurrentPresetId()}setActive(e){this.isActive=e;if(this.isActive){BX.removeClass(this.DOM.filterWrap,"main-ui-filter-default-applied");BX.addClass(this.DOM.filterWrap,"main-ui-filter-search--showed")}else{BX.removeClass(this.DOM.filterWrap,"main-ui-filter-search--showed");BX.addClass(this.DOM.filterWrap,"main-ui-filter-default-applied")}}}e.Search=n})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar,BX.Event,BX,BX.Main);
//# sourceMappingURL=search.bundle.map.js