this.BX=this.BX||{};(function(t,e,n,r){"use strict";var a,i,l;function s(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=o(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var r=0;var a=function t(){};return{s:a,n:function e(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function t(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,l=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();i=e.done;return e},e:function t(e){l=true;s=e},f:function t(){try{if(!i&&n["return"]!=null)n["return"]()}finally{if(l)throw s}}}}function o(t,e){if(!t)return;if(typeof t==="string")return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}function u(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}var c=function(){function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";babelHelpers.classCallCheck(this,t);this.BX=BX;this.filterId=e;this.minSearchStringLength=2;if(n){this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION_PLURAL_",value:n.invitation||0}]}this.filter=this.BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();this.applyFilterBinded=this.applyFilter.bind(this);r.EventEmitter.subscribe("BX.Main.Filter:apply",this.applyFilterBinded)}}babelHelpers.createClass(t,[{key:"getFilter",value:function t(){return this.filter}},{key:"updateCounters",value:function t(){var r=this;this.showCounters=false;var o=n.Util.getCalendarContext();this.BX.cleanNode(o.countersCont);this.countersWrap=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="calendar-counter-title"></div>'])));e.Dom.append(this.countersWrap,o.countersCont);var u=s(this.counters),c;try{for(u.s();!(c=u.n()).done;){var f=c.value;if(f&&f.value>0){this.showCounters=true;break}}}catch(t){u.e(t)}finally{u.f()}if(this.showCounters){this.countersPage=e.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<span class="calendar-counter-page-name">',"</span>"])),e.Loc.getMessage("EC_COUNTER_TOTAL"));e.Dom.append(this.countersPage,this.countersWrap);var d=s(this.counters),p;try{var h=function t(){var n=p.value;if(n&&n.value>0){var a=e.Loc.getPluralForm(n.value);r.countersContainer=e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-counter-container ','" data-bx-counter="','">\n\t\t\t\t\t\t<span class="calendar-counter-inner">\n\t\t\t\t\t\t\t<span class="calendar-counter-number">','</span>\n\t\t\t\t\t\t\t<span class="calendar-counter-text">\n\t\t\t\t\t\t\t\t ',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>"])),n.className,n.id,n.value,e.Loc.getMessage(n.pluralMessageId+a));e.Dom.append(r.countersContainer,r.countersWrap);e.Event.bind(r.countersContainer,"click",(function(){r.applyCounterEntries(n.id)}))}};for(d.s();!(p=d.n()).done;){h()}}catch(t){d.e(t)}finally{d.f()}}else{this.countersWrap.innerHTML=e.Loc.getMessage("EC_NO_COUNTERS")}}},{key:"setCountersValue",value:function t(n){if(e.Type.isPlainObject(n)){var r=s(this.counters),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(!e.Type.isUndefined(n[i.id])){i.value=n[i.id]||0}}}catch(t){r.e(t)}finally{r.f()}this.updateCounters()}}},{key:"displaySearchResult",value:function t(e){var r=n.Util.getCalendarContext();var a=[];var i=s(e.entries),l;try{for(i.s();!(l=i.n()).done;){var o=l.value;a.push(new window.BXEventCalendar.Entry(r,o))}}catch(t){i.e(t)}finally{i.f()}r.getView().displayResult(a);if(e.counters){this.setCountersValue(e.counters)}}},{key:"applyCounterEntries",value:function t(e){if(e==="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}}},{key:"applyFilter",value:function t(e,n,r,a,i){if(i){i.autoResolve=false}this.applyFilterHandler(a).then((function(){}))}},{key:"applyFilterHandler",value:function t(e){var r=this;return new Promise((function(t){var a=n.Util.getCalendarContext();if(r.isFilterEmpty()){if(a.getView().resetFilterMode){a.getView().resetFilterMode({resetSearchFilter:false})}if(e){e.fulfill()}}else{a.setView("list",{animation:false});a.getView().applyFilterMode();BX.ajax.runAction("calendar.api.calendarajax.getFilterData",{data:{ownerId:a.util.config.ownerId,userId:a.util.config.userId,type:a.util.config.type}}).then((function(n){if(n.data.entries){if(!a.getView().filterMode){a.getView().applyFilterMode();r.displaySearchResult(n.data)}else{r.displaySearchResult(n.data)}}if(e){e.fulfill()}t(n.data)}),(function(e){t(e.data)}))}}))}},{key:"isFilterEmpty",value:function t(){var e=this.filter.getSearch();return!e.getLastSquare()&&(!e.getSearchString()||e.getSearchString().length<this.minSearchStringLength)}},{key:"resetFilter",value:function t(){this.filter.resetFilter()}}]);return t}();t.Search=c})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Calendar,BX.Event);
//# sourceMappingURL=search.bundle.map.js