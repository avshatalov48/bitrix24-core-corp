this.BX=this.BX||{};(function(t,e,i,s,r){"use strict";let l=t=>t,a;class n{constructor(t){this.PRESET_INVITED="filter_calendar_meeting_status_q";this.EMPTY_RESULT_POPUP_WIDTH=466;this.MIN_QUERY_LENGTH=3;this.SHOW_LOADER_DELAY=500;this.MIN_LOADER_DURATION=1e3;this.BX=BX;this.filterId=t;this.filter=this.BX.Main.filterManager.getById(this.filterId);this.filterApi=this.filter.getApi();this.isActive=false;this.isInvitationEnabled=false;this.DOM={filterWrap:this.filter.popupBindElement,filterInput:this.filter.popupBindElement.querySelector("input")};this.updateActive();this.DOM.filterInput.removeEventListener("input",this.updateActive.bind(this));this.DOM.filterInput.addEventListener("input",this.updateActive.bind(this));i.EventEmitter.unsubscribe("BX.Filter.Search:input",this.updateActive.bind(this));i.EventEmitter.unsubscribe("BX.Main.Filter:beforeApply",this.beforeApplyFilterHandler.bind(this));i.EventEmitter.unsubscribe("BX.Main.Filter:apply",this.applyFilterHandler.bind(this));i.EventEmitter.subscribe("BX.Filter.Search:input",this.updateActive.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:beforeApply",this.beforeApplyFilterHandler.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:apply",this.applyFilterHandler.bind(this))}getFilter(){return this.filter}beforeApplyFilterHandler(){const t=e.Util.getCalendarContext();this.filterDataLoaderStartTime=false;this.filterDataRequestSent=true;clearTimeout(this.showLoaderTimeout);this.showLoaderTimeout=setTimeout((()=>{if(this.filterDataRequestSent){this.filterDataLoaderStartTime=(new Date).getTime();t.showLoader()}}),this.SHOW_LOADER_DELAY);this.updateActive()}applyFilterHandler(){this.isInvitationEnabled=false;this.applyFilter()}applyFilter(){const t=e.Util.getCalendarContext();if(this.isFilterEmpty()){if(t.getView().resetFilterMode){t.getView().resetFilterMode({resetSearchFilter:false})}this.filterDataRequestSent=false;t.hideLoader();return}BX.ajax.runAction("calendar.api.calendarajax.getFilterData",{data:{ownerId:t.util.config.ownerId,userId:t.util.config.userId,type:t.util.config.type}}).then((e=>{this.filterDataRequestSent=false;if(this.filterDataLoaderStartTime){const i=(new Date).getTime()-this.filterDataLoaderStartTime;const s=this.MIN_LOADER_DURATION-i;if(s>0){setTimeout((()=>{t.hideLoader();this.displaySearchResult(t,e.data.entries)}),s)}else{t.hideLoader();this.displaySearchResult(t,e.data.entries)}}else{this.displaySearchResult(t,e.data.entries)}}),(e=>{console.error(e);t.hideLoader()}))}displaySearchResult(t,e){if(!e||this.isFilterEmpty()){return}if(!this.isInvitationPresetEnabled()&&e.length===0){this.showEmptyResultPopup();return}t.viewNameBeforeFilter=t.getView().name;if(t.getView().getViewRange){t.dateBeforeFilter=t.getView().getViewRange().start}t.setView("list",{animation:true});t.getView().applyFilterMode();this.displayFilterResult(e)}displayFilterResult(t){const i=e.Util.getCalendarContext();const s=[];for(const e of t){s.push(new window.BXEventCalendar.Entry(i,e))}i.getView().displayResult(s)}showEmptyResultPopup(){const t=this.EMPTY_RESULT_POPUP_WIDTH;if(!this.emptyResultPopup){this.emptyResultPopup=new r.Popup({className:"calendar-search-no-result-popup",content:this.getEmptyResultPopupContent(),bindElement:this.DOM.filterWrap,offsetTop:5,offsetLeft:this.DOM.filterWrap.offsetWidth/2-t/2,width:t,closeIcon:true,overlay:{opacity:0},autoHide:true,closeByEsc:true,animation:"fading-slide",angle:{position:"top",offset:t/2-10}})}this.emptyResultPopup.show()}getEmptyResultPopupContent(){return s.Tag.render(a||(a=l`<div class="calendar-search-no-result-popup-container">
			<div class="calendar-search-no-result-popup-title">${0}</div>
			<div class="calendar-search-no-result-popup-text">${0}</div>
		</div>`),s.Loc.getMessage("EC_CALENDAR_EMPTY_SEARCH_RESULT_TITLE"),s.Loc.getMessage("EC_CALENDAR_EMPTY_SEARCH_RESULT_TEXT"))}isFilterEmpty(){return this.arePresetsEmpty()&&this.isSearchEmpty()}arePresetsEmpty(){const t=this.filter.getSearch();return!t.getLastSquare()}isSearchEmpty(){const t=this.getSearchQuery();return!t||t.length<this.MIN_QUERY_LENGTH}getSearchQuery(){return this.filter.getSearch().getSearchString()}setPresetInvitation(){this.isInvitationEnabled=true;this.filterApi.setFilter({preset_id:this.PRESET_INVITED})}resetPreset(){this.filterApi.setFilter({preset_id:"default_filter"})}resetFilter(){this.filter.resetFilter()}isInvitationPresetEnabled(){const t=this.filter.getFilterFieldsValues();return this.getFilterPreset()===this.PRESET_INVITED||t.MEETING_STATUS==="Q"}updateActive(){if(this.emptyResultPopup){this.emptyResultPopup.close()}this.setActive(this.isFilterActive())}isFilterActive(){if(this.isInvitationEnabled&&!this.isActive){return false}const t=!["default_filter","tmp_filter"].includes(this.getFilterPreset());const e=this.filter.getSearch().getSearchString()==="";return t||!e||this.hasFilledFields()}hasFilledFields(){const t=this.filter.getFilterFieldsValues();for(const e in t){const i=t[e];const s=this.isArrayFieldFilled(i)||this.isStringFieldFilled(i);if(s){return true}}return false}isArrayFieldFilled(t){return BX.Type.isArrayFilled(t)}isStringFieldFilled(t){return t!=="NONE"&&BX.Type.isStringFilled(t)}getFilterPreset(){return this.filter.getPreset().getCurrentPresetId()}setActive(t){this.isActive=t;if(this.isActive){BX.removeClass(this.DOM.filterWrap,"main-ui-filter-default-applied");BX.addClass(this.DOM.filterWrap,"main-ui-filter-search--showed")}else{BX.removeClass(this.DOM.filterWrap,"main-ui-filter-search--showed");BX.addClass(this.DOM.filterWrap,"main-ui-filter-default-applied")}}}t.Search=n})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar,BX.Event,BX,BX.Main);
//# sourceMappingURL=search.bundle.map.js