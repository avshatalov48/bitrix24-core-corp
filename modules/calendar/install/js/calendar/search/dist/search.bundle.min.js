this.BX=this.BX||{};(function(e,t,i,s){"use strict";let a=e=>e,r,n,l;class o{constructor(e,t=""){this.BX=BX;this.filterId=e;this.minSearchStringLength=2;if(t){this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION_PLURAL_",value:t.invitation||0}]}this.filter=this.BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();this.applyFilterBinded=this.applyFilter.bind(this);s.EventEmitter.subscribe("BX.Main.Filter:apply",this.applyFilterBinded)}}getFilter(){return this.filter}updateCounters(){this.showCounters=false;const e=i.Util.getCalendarContext();this.BX.cleanNode(e.countersCont);this.countersWrap=t.Tag.render(r||(r=a`<div class="calendar-counter-title"></div>`));t.Dom.append(this.countersWrap,e.countersCont);for(const e of this.counters){if(e&&e.value>0){this.showCounters=true;break}}if(this.showCounters){this.countersPage=t.Tag.render(n||(n=a`<span class="calendar-counter-page-name">${0}</span>`),t.Loc.getMessage("EC_COUNTER_TOTAL"));t.Dom.append(this.countersPage,this.countersWrap);for(const e of this.counters){if(e&&e.value>0){const i=t.Loc.getPluralForm(e.value);this.countersContainer=t.Tag.render(l||(l=a`
					<span class="calendar-counter-container ${0}" data-bx-counter="${0}">
						<span class="calendar-counter-inner">
							<span class="calendar-counter-number">${0}</span>
							<span class="calendar-counter-text">
								 ${0}
							</span>
						</span>
					</span>`),e.className,e.id,e.value,t.Loc.getMessage(e.pluralMessageId+i));t.Dom.append(this.countersContainer,this.countersWrap);t.Event.bind(this.countersContainer,"click",(()=>{this.applyCounterEntries(e.id)}))}}}else{this.countersWrap.innerHTML=t.Loc.getMessage("EC_NO_COUNTERS")}}setCountersValue(e){if(t.Type.isPlainObject(e)){for(const i of this.counters){if(!t.Type.isUndefined(e[i.id])){i.value=e[i.id]||0}}this.updateCounters()}}displaySearchResult(e){const t=i.Util.getCalendarContext();const s=[];for(const i of e.entries){s.push(new window.BXEventCalendar.Entry(t,i))}t.getView().displayResult(s);if(e.counters){this.setCountersValue(e.counters)}}applyCounterEntries(e){if(e==="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}}applyFilter(e,t,i,s,a){if(a){a.autoResolve=false}this.applyFilterHandler(s).then((()=>{}))}applyFilterHandler(e){return new Promise((t=>{const s=i.Util.getCalendarContext();if(this.isFilterEmpty()){if(s.getView().resetFilterMode){s.getView().resetFilterMode({resetSearchFilter:false})}if(e){e.fulfill()}}else{s.setView("list",{animation:false});s.getView().applyFilterMode();BX.ajax.runAction("calendar.api.calendarajax.getFilterData",{data:{ownerId:s.util.config.ownerId,userId:s.util.config.userId,type:s.util.config.type}}).then((i=>{if(i.data.entries){if(!s.getView().filterMode){s.getView().applyFilterMode();this.displaySearchResult(i.data)}else{this.displaySearchResult(i.data)}}if(e){e.fulfill()}t(i.data)}),(e=>{t(e.data)}))}}))}isFilterEmpty(){const e=this.filter.getSearch();return!e.getLastSquare()&&(!e.getSearchString()||e.getSearchString().length<this.minSearchStringLength)}resetFilter(){this.filter.resetFilter()}}e.Search=o})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Calendar,BX.Event);
//# sourceMappingURL=search.bundle.map.js