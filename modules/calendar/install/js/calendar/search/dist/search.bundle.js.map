{"version":3,"file":"search.bundle.js","sources":["../src/search.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport { EventEmitter } from 'main.core.events';\n\nexport class Search\n{\n\tconstructor(filterId)\n\t{\n\t\tthis.BX = BX; // for calendar in slider\n\t\tthis.filterId = filterId;\n\t\tthis.minSearchStringLength = 2;\n\t\tthis.filter = this.BX.Main.filterManager.getById(this.filterId);\n\t\tthis.filterApi = this.filter.getApi();\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.applyFilter.bind(this));\n\t}\n\t\n\tgetFilter()\n\t{\n\t\treturn this.filter;\n\t}\n\t\n\tdisplaySearchResult(response)\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tconst entries = [];\n\t\t\n\t\tfor (const entry of response.entries)\n\t\t{\n\t\t\tentries.push(new window.BXEventCalendar.Entry(calendarContext, entry));\n\t\t}\n\t\t\n\t\tcalendarContext.getView().displayResult(entries);\n\t}\n\t\n\tapplyFilter(id, data, ctx, promise, params)\n\t{\n\t\tif (params)\n\t\t{\n\t\t\tparams.autoResolve = false;\n\t\t}\n\t\tthis.applyFilterHandler(promise)\n\t\t.then(() => {});\n\t}\n\t\n\tapplyFilterHandler(promise)\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tconst calendarContext = Util.getCalendarContext();\n\t\t\t\n\t\t\tif (this.isFilterEmpty())\n\t\t\t{\n\t\t\t\tif (calendarContext.getView().resetFilterMode)\n\t\t\t\t{\n\t\t\t\t\tcalendarContext.getView().resetFilterMode({resetSearchFilter: false});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (promise)\n\t\t\t\t{\n\t\t\t\t\tpromise.fulfill();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcalendarContext.setView('list', {animation: false});\n\t\t\t\tcalendarContext.getView().applyFilterMode();\n\t\t\t\t\n\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.getFilterData', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\townerId: calendarContext.util.config.ownerId,\n\t\t\t\t\t\tuserId: calendarContext.util.config.userId,\n\t\t\t\t\t\ttype: calendarContext.util.config.type,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (response.data.entries)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!calendarContext.getView().filterMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcalendarContext.getView().applyFilterMode();\n\t\t\t\t\t\t\t\tthis.displaySearchResult(response.data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.displaySearchResult(response.data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (promise)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpromise.fulfill();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t})\n\t}\n\t\n\tisFilterEmpty()\n\t{\n\t\tconst searchField = this.filter.getSearch();\n\t\treturn !searchField.getLastSquare()\n\t\t\t&& (!searchField.getSearchString()\n\t\t\t|| searchField.getSearchString().length < this.minSearchStringLength\n\t\t);\n\t}\n\t\n\tresetFilter()\n\t{\n\t\tthis.filter.resetFilter();\n\t}\n}"],"names":["Search","constructor","filterId","BX","minSearchStringLength","filter","Main","filterManager","getById","filterApi","getApi","EventEmitter","subscribe","applyFilter","bind","getFilter","displaySearchResult","response","calendarContext","Util","getCalendarContext","entries","entry","push","window","BXEventCalendar","Entry","getView","displayResult","id","data","ctx","promise","params","autoResolve","applyFilterHandler","then","Promise","resolve","isFilterEmpty","resetFilterMode","resetSearchFilter","fulfill","setView","animation","applyFilterMode","ajax","runAction","ownerId","util","config","userId","type","filterMode","searchField","getSearch","getLastSquare","getSearchString","length","resetFilter"],"mappings":"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"}