this.BX=this.BX||{};(function(e,t,n,i,a,s,r,o,l){"use strict";var d,c,u,h,f,p,g,y,m,v,E,D,C,M,b,T,I,S,O,w,L,k,_,N,P,B,V,A,U,R;var F=function(e){babelHelpers.inherits(F,e);function F(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,F);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(F).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"STATE",{READY:1,REQUEST:2,ERROR:3});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"zIndex",1200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"Z_INDEX_OFFSET",-1e3);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"userSettings","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"displayed",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"sections",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"sectionIndex",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"trackingUsersList",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"checkDataBeforeCloseMode",true);e.setEventNamespace("BX.Calendar.CompactEventForm");e.userId=n.userId||i.Util.getCurrentUserId();e.type=n.type||"user";e.isLocationCalendar=n.isLocationCalendar||false;e.calendarContext=n.calendarContext||null;e.ownerId=n.ownerId||e.userId;e.BX=i.Util.getBX();e.checkForChanges=t.Runtime.debounce(e.checkForChangesImmediately,300,babelHelpers.assertThisInitialized(e));e.checkOutsideClickClose=e.checkOutsideClickClose.bind(babelHelpers.assertThisInitialized(e));e.outsideMouseDownClose=e.outsideMouseDownClose.bind(babelHelpers.assertThisInitialized(e));e.keyHandler=e.handleKeyPress.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(F,[{key:"show",value:function e(){var n=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.EDIT_MODE;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.setParams(s);this.setMode(a);this.state=this.STATE.READY;this.popupId="compact-event-form-"+Math.round(Math.random()*1e5);if(this.popup){this.popup.destroy()}this.popup=this.getPopup(s);t.Dom.addClass(this.popup.titleBar,"calendar-add-popup-titlebar");t.Dom.removeClass(this.popup.popupContainer,"popup-window-with-titlebar");t.Dom.removeClass(this.popup.closeIcon,"popup-window-titlebar-close-icon");t.Event.bind(document,"mousedown",this.outsideMouseDownClose);t.Event.bind(document,"mouseup",this.checkOutsideClickClose);t.Event.bind(document,"keydown",this.keyHandler);t.Event.bind(this.popup.popupContainer,"transitionend",(function(){t.Dom.removeClass(n.popup.popupContainer,"calendar-simple-view-popup-show")}));if(this.getMode()===F.EDIT_MODE){r.EntryManager.doDelayedActions()}this.prepareData().then((function(){if(n.checkLocationView()){n.setFormValuesLocation()}else{n.setFormValues()}n.popup.show();n.checkDataBeforeCloseMode=true;if(n.canDo("edit")&&n.DOM.titleInput&&a===F.EDIT_MODE){n.DOM.titleInput.focus();n.DOM.titleInput.select()}n.displayed=true;if(n.getMode()===F.VIEW_MODE){i.Util.sendAnalyticLabel({calendarAction:"view_event",formType:"compact"});n.popup.getButtons()[0].button.focus()}if(n.getMode()===F.EDIT_MODE&&!n.userPlannerSelector.isPlannerDisplayed()){n.userPlannerSelector.checkBusyTime()}}))}},{key:"checkLocationView",value:function e(){return this.getMode()===F.VIEW_MODE&&this.type==="location"}},{key:"getPopup",value:function e(t){return new a.Popup(this.popupId,t.bindNode,{zIndex:this.zIndex+this.Z_INDEX_OFFSET,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup calendar-simple-view-popup-show",cacheable:false,content:this.checkLocationView()?this.getPopupContentLocation():this.getPopupContentCalendar(),buttons:this.getButtons(),events:{onPopupClose:this.close.bind(this)}})}},{key:"isShown",value:function e(){return this.displayed}},{key:"close",value:function e(){var n=this;if(this.getMode()===F.EDIT_MODE&&this.formDataChanged()&&this.checkDataBeforeCloseMode&&!confirm(t.Loc.getMessage("EC_SAVE_ENTRY_CONFIRM"))){if(this.popup){this.popup.destroyed=true;setTimeout((function(){n.popup.destroyed=false}),0)}return}this.displayed=false;this.emit("onClose");t.Event.unbind(document,"mousedown",this.outsideMouseDownClose);t.Event.unbind(document,"mouseup",this.checkOutsideClickClose);t.Event.unbind(document,"keydown",this.keyHandler);if(this.userPlannerSelector){this.userPlannerSelector.destroy()}if(this.popup){this.popup.destroy()}if(s.Location){s.Location.setCurrentCapacity(0)}i.Util.clearPlannerWatches();i.Util.closeAllPopups()}},{key:"getPopupContentCalendar",value:function e(){this.DOM.wrap=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="calendar-add-popup-wrap">\n\t\t\t','\n\t\t\t<div class="calendar-field-container calendar-field-container-choice">\n\t\t\t\t',"\n\t\t\t</div>\n\n\t\t\t","\n\n\t\t\t",'\n\n\t\t\t<div class="calendar-field-container calendar-field-container-info">\n\t\t\t\t',"\n\n\t\t\t\t\t","\n\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.DOM.titleOuterWrap=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string-select">\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>"])),this.getTitleControl(),this.getColorControl()),this.getSectionControl(),this.getDateTimeControl(),this.getUserPlannerSelector(),this.getTypeInfoControl(),this.getLocationControl(),this.DOM.remindersOuterWrap=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t\t","\n\t\t\t\t</div>"])),t.Loc.getMessage("EC_REMIND_LABEL"),this.createRemindersControl()),this.getRRuleInfoControl());return this.DOM.wrap}},{key:"getPopupContentLocation",value:function e(){this.DOM.wrap=t.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="calendar-add-popup-wrap">\n\t\t\t','\n\t\t\t<div class="calendar-field-container calendar-field-container-choice">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t","\n\t\t\t\n\t\t</div>"])),this.DOM.titleOuterWrap=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string-select">\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>"])),this.getTitleControlLocation(),this.getColorControlsLocationView()),this.getLocationSectionControls(),this.getDateTimeControl());if(this.entry.id!==this.entry.parentId){this.DOM.wrap.appendChild(t.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t","\n\t\t\t"])),this.getHostControl()))}return this.DOM.wrap}},{key:"getButtons",value:function e(){var i=this;var a=[];var s=this.getMode();if(s===F.EDIT_MODE){a.push(new BX.UI.Button({name:"save",text:this.isNewEntry()?t.Loc.getMessage("CALENDAR_EVENT_DO_ADD"):t.Loc.getMessage("CALENDAR_EVENT_DO_SAVE"),className:"ui-btn ui-btn-primary",events:{click:function e(){i.checkDataBeforeCloseMode=false;i.save()}}}));if(t.Type.isElementNode(a[0].button)){a[0].button.setAttribute("data-role","saveButton")}a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function e(){if(i.isNewEntry()){i.checkDataBeforeCloseMode=false;i.close()}else{i.setFormValues();if(i.userPlannerSelector){i.userPlannerSelector.destroy()}i.setMode(F.VIEW_MODE);i.popup.setButtons(i.getButtons())}}}}));a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_FULL_FORM"),className:"ui-btn calendar-full-form-btn",events:{click:this.editEntryInSlider.bind(this)}}))}else if(s===F.VIEW_MODE){if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"){a.push(new BX.UI.Button({className:"ui-btn ui-btn-primary",text:t.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function e(){r.EntryManager.setMeetingStatus(i.entry,"Y").then(i.refreshMeetingStatus.bind(i))}}}));a.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function e(){r.EntryManager.setMeetingStatus(i.entry,"N").then((function(){if(i.isShown()){i.close()}}))}}}))}if(this.checkLocationView()){if(this.entry.id!==this.entry.parentId){a.push(new BX.UI.Button({className:"ui-btn ".concat(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"?"ui-btn-link":"ui-btn-primary"),text:t.Loc.getMessage("CALENDAR_EVENT_DO_OPEN_PARENT"),events:{click:function e(){i.checkDataBeforeCloseMode=false;BX.Calendar.EntryManager.openViewSlider(i.entry.parentId,{userId:i.userId,from:i.entry.from,timezoneOffset:i.entry&&i.entry.data?i.entry.data.TZ_OFFSET_FROM:null});i.close()}}}))}else{a.push(new BX.UI.Button({className:"ui-btn ui-btn-disabled",text:t.Loc.getMessage("CALENDAR_UPDATE_PROGRESS")}))}}else{a.push(new BX.UI.Button({className:"ui-btn ".concat(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"?"ui-btn-link":"ui-btn-primary"),text:t.Loc.getMessage("CALENDAR_EVENT_DO_OPEN"),events:{click:function e(){i.checkDataBeforeCloseMode=false;BX.Calendar.EntryManager.openViewSlider(i.entry.id,{entry:i.entry,calendarContext:i.calendarContext,type:i.type,ownerId:i.ownerId,userId:i.userId,from:i.entry.from,timezoneOffset:i.entry&&i.entry.data?i.entry.data.TZ_OFFSET_FROM:null});i.close()}}}))}if(t.Type.isElementNode(a[a.length-1].button)){a[a.length-1].button.setAttribute("data-role","openButton")}if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="N"){a.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function e(){r.EntryManager.setMeetingStatus(i.entry,"Y").then(i.refreshMeetingStatus.bind(i))}}}))}if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Y"){a.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function e(){r.EntryManager.setMeetingStatus(i.entry,"N").then(i.refreshMeetingStatus.bind(i))}}}))}if(!this.isNewEntry()&&this.canDo("edit")&&this.type!=="location"){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_EDIT"),className:"ui-btn ui-btn-link",events:{click:this.editEntryInSlider.bind(this)}}))}if(!this.isNewEntry()&&this.canDo("delete")&&this.entry.getCurrentStatus()==="H"&&!this.checkLocationView()){if(!this.entry.isMeeting()||!this.entry.getCurrentStatus()||this.entry.getCurrentStatus()==="H"){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_DELETE"),className:"ui-btn ui-btn-link",events:{click:function e(){n.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(function(){i.checkDataBeforeCloseMode=false;i.close()}));r.EntryManager.deleteEntry(i.entry);if(!i.entry.wasEverRecursive()){i.close()}}}}))}}}if(a.length>2){a[1].button.className="ui-btn ui-btn-light-border"}return a}},{key:"freezePopup",value:function e(){if(this.popup){this.popup.buttons.forEach((function(e){var t;if((e===null||e===void 0?void 0:(t=e.options)===null||t===void 0?void 0:t.name)==="save"){e.setClocking(true)}else{e.setDisabled(true)}}))}}},{key:"unfreezePopup",value:function e(){if(this.popup){this.popup.buttons.forEach((function(e){e.setClocking(false);e.setDisabled(false)}))}}},{key:"refreshMeetingStatus",value:function e(){this.emit("doRefresh");this.popup.setButtons(this.getButtons());if(this.userPlannerSelector){this.userPlannerSelector.displayAttendees(this.entry.getAttendees())}}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader);this.DOM.loader=null}}},{key:"showInEditMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(F.EDIT_MODE,t)}},{key:"showInViewMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(F.VIEW_MODE,t)}},{key:"setMode",value:function e(t){if(t==="edit"||t==="view"){this.mode=t}}},{key:"getMode",value:function e(){return this.mode}},{key:"checkForChangesImmediately",value:function e(){if(!this.isNewEntry()&&this.getMode()===F.VIEW_MODE&&this.formDataChanged()){this.setMode(F.EDIT_MODE);this.popup.setButtons(this.getButtons())}else if(!this.isNewEntry()&&this.getMode()===F.EDIT_MODE&&!this.formDataChanged()){this.setMode(F.VIEW_MODE);this.popup.setButtons(this.getButtons())}this.emitOnChange()}},{key:"checkLocationForm",value:function e(t){if(t&&t instanceof n.BaseEvent){var i=t.getData();var a=i.usersCount;var r=s.Location.getCurrentCapacity()||0;if(this.locationSelector.value.type===undefined){if(r){r=0;s.Location.setCurrentCapacity(0)}}if(r<a&&r!==0){this.locationSelector.addCapacityAlert()}else{this.locationSelector.removeCapacityAlert()}}}},{key:"getFormDataChanges",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=this.entry;var i=[];if(!t.includes("name")&&n.name!==this.DOM.titleInput.value){i.push("name")}if(!t.includes("location")&&this.locationSelector.getTextLocation(s.Location.parseStringValue(n.getLocation()))!==this.locationSelector.getTextLocation(s.Location.parseStringValue(this.locationSelector.getTextValue()))){i.push("location")}var a=this.dateTimeControl.getValue();if(!t.includes("date&time")&&(n.isFullDay()!==a.fullDay||a.from.toString()!==n.from.toString()||a.to.toString()!==n.to.toString())){i.push("date&time")}if(!t.includes("notify")&&(!n.isMeeting()||n.getMeetingNotify())!==this.userPlannerSelector.getInformValue()){i.push("notify")}if(!t.includes("section")&&parseInt(n.sectionId)!==parseInt(this.sectionValue)){i.push("section")}if(!t.includes("codes")&&this.userPlannerSelector.getEntityList().map((function(e){return e.entityId+":"+e.id})).join("|")!==n.getAttendeesEntityList().map((function(e){return e.entityId+":"+e.id})).join("|")){i.push("codes")}return i}},{key:"formDataChanged",value:function e(){return this.getFormDataChanges().length>0}},{key:"setParams",value:function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.userId=n.userId||i.Util.getCurrentUserId();this.type=n.type||"user";this.isLocationCalendar=n.isLocationCalendar||false;this.locationAccess=n.locationAccess||false;this.dayOfWeekMonthFormat=n.dayOfWeekMonthFormat||false;this.calendarContext=n.calendarContext||null;this.ownerId=n.ownerId?n.ownerId:0;if(this.type==="user"&&!this.ownerId){this.ownerId=this.userId}this.entry=r.EntryManager.getEntryInstance(n.entry,n.userIndex,{type:this.type,ownerId:this.ownerId});this.sectionValue=null;if(!this.entry.id&&t.Type.isPlainObject(n.entryTime)&&t.Type.isDate(n.entryTime.from)&&t.Type.isDate(n.entryTime.to)){this.entry.setDateTimeValue(n.entryTime)}if(t.Type.isPlainObject(n.userSettings)){this.userSettings=n.userSettings}this.locationFeatureEnabled=!!n.locationFeatureEnabled;this.locationList=n.locationList||[];this.roomsManager=n.roomsManager||null;this.iblockMeetingRoomList=n.iblockMeetingRoomList||[];this.plannerFeatureEnabled=!!n.plannerFeatureEnabled;this.setSections(n.sections,n.trackingUserList)}},{key:"setSections",value:function e(n){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];this.sections=n;this.sectionIndex={};this.trackingUsersList=a||[];if(t.Type.isArray(n)){n.forEach((function(e,t){var n=parseInt(e.ID||e.id);if(n>0){i.sectionIndex[n]=t}}),this)}}},{key:"prepareData",value:function e(){var t=this;return new Promise((function(e){var n=t.getCurrentSection();if(n&&n.canDo){e()}else{t.BX.ajax.runAction("calendar.api.calendarajax.getCompactFormData",{data:{entryId:t.entry.id,loadSectionId:t.entry.sectionId}}).then((function(n){if(n&&n.data&&n.data.section){t.sections.push(new window.BXEventCalendar.Section(i.Util.getCalendarContext(),n.data.section));t.setSections(t.sections);e()}}))}}))}},{key:"getTitleControl",value:function e(){this.DOM.titleInput=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="calendar-field calendar-field-string"\n\t\t\t\tvalue=""\n\t\t\t\tplaceholder="','"\n\t\t\t\ttype="text"\n\t\t\t/>\n\t\t'])),t.Loc.getMessage("EC_ENTRY_NAME"));t.Event.bind(this.DOM.titleInput,"keyup",this.checkForChanges);t.Event.bind(this.DOM.titleInput,"change",this.checkForChanges);return this.DOM.titleInput}},{key:"getTitleControlLocation",value:function e(){this.DOM.titleInput=t.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="calendar-field calendar-field-string"\n\t\t\t\tvalue=""\n\t\t\t\tplaceholder="','"\n\t\t\t\ttype="text"\n\t\t\t\treadonly\n\t\t\t/>\n\t\t'])),t.Loc.getMessage("EC_ENTRY_NAME"));return this.DOM.titleInput}},{key:"getHostControl",value:function e(){var n=this.entry.data.CREATED_BY;var i=F.USER_URL.replace("#USER_ID#",n);var a=this.BX.Calendar.EntryManager.userIndex[n]?this.BX.Calendar.EntryManager.userIndex[n].AVATAR:"";this.DOM.hostBar=t.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-slider-detail-option-without-border">\n\t\t\t\t<div class="calendar-slider-detail-option-block">\n\t\t\t\t\t<div class="calendar-field-value">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="calendar-field-location-host-img">\n\t\t\t\t\t\t<a href="','">\n\t\t\t\t\t\t\t<img class="calendar-field-location-host-img-value" src="','">\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="calendar-slider-detail-option-value">\n\t\t\t\t\t\t<a href="','" class="calendar-slider-sidebar-user-info-name calendar-slider-sidebar-user-info-name-padding">',"</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("EC_HOST")+": ",i,a,i,BX.util.htmlspecialchars(this.entry.name));return this.DOM.hostBar}},{key:"getColorControl",value:function e(){var i=this;this.DOM.colorSelect=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field calendar-field-select calendar-field-tiny"></div>'])));this.colorSelector=new s.ColorSelector({wrap:this.DOM.colorSelect,mode:"selector"});this.colorSelector.subscribe("onChange",(function(e){if(e instanceof n.BaseEvent){var t=e.getData().value;if(!i.isNewEntry()&&(i.canDo("edit")||i.entry.getCurrentStatus()!==false)){i.BX.ajax.runAction("calendar.api.calendarajax.updateColor",{data:{entryId:i.entry.id,userId:i.userId,color:t}});i.entry.data.COLOR=t;i.emit("doRefresh");i.emitOnChange()}}}));return this.DOM.colorSelect}},{key:"getColorControlsLocationView",value:function e(){this.DOM.colorSelect=t.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field calendar-field-select calendar-colorpicker-readonly calendar-field-tiny"></div>'])));this.colorSelector=new s.ColorSelector({wrap:this.DOM.colorSelect,mode:"view"});return this.DOM.colorSelect}},{key:"getSectionControl",value:function e(){var n=this;this.DOM.sectionSelectWrap=t.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-choice-calendar"></div>'])));this.sectionSelector=new s.SectionSelector({outerWrap:this.DOM.sectionSelectWrap,defaultCalendarType:this.type,defaultOwnerId:this.ownerId,sectionList:this.sections,sectionGroupList:o.SectionManager.getSectionGroupList({type:this.type,ownerId:this.ownerId,userId:this.userId,trackingUsersList:this.trackingUsersList}),mode:"textselect",zIndex:this.zIndex,getCurrentSection:function e(){var t=n.getCurrentSection();if(t){return{id:t.id,name:t.name,color:t.color}}return false},selectCallback:function e(t){if(t){if(n.colorSelector){n.colorSelector.setValue(t.color)}n.sectionValue=t.id;n.checkForChanges();o.SectionManager.saveDefaultSectionId(n.sectionValue)}}});return this.DOM.sectionSelectWrap}},{key:"getLocationSectionControls",value:function e(){var n=this;this.DOM.sectionSelectWrap=t.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-choice-calendar"></div>'])));this.sectionSelector=new s.SectionSelector({outerWrap:this.DOM.sectionSelectWrap,defaultCalendarType:this.type,defaultOwnerId:this.ownerId,sectionList:this.sections,sectionGroupList:o.SectionManager.getSectionGroupList({type:this.type,ownerId:this.ownerId,userId:this.userId,trackingUsersList:this.trackingUsersList}),mode:"location",zIndex:this.zIndex,getCurrentSection:function e(){var t=n.getCurrentSection();if(t){return{id:t.id,name:t.name,color:t.color}}return false}});return this.DOM.sectionSelectWrap}},{key:"getDateTimeControl",value:function e(){var i=this;this.DOM.dateTimeWrap=t.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-container calendar-field-container-datetime"></div>'])));this.dateTimeControl=new s.DateTimeControl(null,{showTimezone:false,outerWrap:this.DOM.dateTimeWrap,inlineEditMode:true});this.dateTimeControl.subscribe("onChange",(function(e){if(e instanceof n.BaseEvent){var t=e.getData().value;if(i.remindersControl){i.remindersControl.setFullDayMode(t.fullDay);if(i.isNewEntry()&&!i.remindersControl.wasChangedByUser()){var a=r.EntryManager.getNewEntryReminders(t.fullDay?"fullDay":"withTime");i.remindersControl.setValue(a,false)}}if(i.userPlannerSelector){if(!i.userPlannerSelector.isPlannerDisplayed()){i.userPlannerSelector.showPlanner()}i.userPlannerSelector.setLocationValue(i.locationSelector.getTextValue());i.userPlannerSelector.setDateTime(t,true);i.userPlannerSelector.refreshPlanner()}if(i.locationSelector){i.locationSelector.checkLocationAccessibility({from:e.getData().value.from,to:e.getData().value.to,fullDay:e.getData().value.fullDay,currentEventId:i.entry.id})}i.checkForChanges()}}));return this.DOM.dateTimeWrap}},{key:"getUserPlannerSelector",value:function e(){this.DOM.userPlannerSelectorOuterWrap=t.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-field-container calendar-field-container-members">\n\t\t\t\t','\n\t\t\t\t<span class="calendar-videocall-wrap calendar-videocall-hidden"></span>\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="calendar-user-selector-wrap"></div>\n\t\t\t<div class="calendar-add-popup-planner-wrap calendar-add-popup-show-planner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t","\n\t\t<div>"])),this.DOM.userSelectorWrap=t.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-members-selected">\n\t\t\t\t\t\t<span class="calendar-attendees-label"></span>\n\t\t\t\t\t\t<span class="calendar-attendees-list"></span>\n\t\t\t\t\t\t<span class="calendar-members-more">','</span>\n\t\t\t\t\t\t<span class="calendar-members-change-link">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"])),t.Loc.getMessage("EC_ATTENDEES_MORE"),t.Loc.getMessage("EC_SEC_SLIDER_CHANGE")),this.DOM.informWrap=t.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-container-inform">\n\t\t\t\t\t<span class="calendar-field-container-inform-text">',"</span>\n\t\t\t\t</div>"])),t.Loc.getMessage("EC_NOTIFY_OPTION")),this.DOM.plannerOuterWrap=t.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-planner-wrapper" style="height: 0">\n\t\t\t\t</div>']))),this.DOM.hideGuestsWrap=t.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-hide-members-container" style="display: none;">\n\t\t\t\t<div class="calendar-hide-members-container-inner">\n\t\t\t\t\t<div class="calendar-hide-members-icon-hidden"></div>\n\t\t\t\t\t<div class="calendar-hide-members-text">','</div>\n\t\t\t\t\t<span class="calendar-hide-members-helper" data-hint="','"></span>\n\t\t\t\t</div>\n\t\t\t</div>'])),t.Loc.getMessage("EC_HIDE_GUEST_NAMES"),t.Loc.getMessage("EC_HIDE_GUEST_NAMES_HINT")));this.userPlannerSelector=new s.UserPlannerSelector({outerWrap:this.DOM.userPlannerSelectorOuterWrap,wrap:this.DOM.userSelectorWrap,informWrap:this.DOM.informWrap,plannerOuterWrap:this.DOM.plannerOuterWrap,hideGuestsWrap:this.DOM.hideGuestsWrap,readOnlyMode:false,userId:this.userId,type:this.type,ownerId:this.ownerId,zIndex:this.zIndex+10,plannerFeatureEnabled:this.plannerFeatureEnabled,dayOfWeekMonthFormat:this.dayOfWeekMonthFormat});this.userPlannerSelector.subscribe("onDateChange",this.handlePlannerSelectorChanges.bind(this));this.userPlannerSelector.subscribe("onNotifyChange",this.checkForChanges);this.userPlannerSelector.subscribe("onUserCodesChange",this.checkForChanges);return this.DOM.userPlannerSelectorOuterWrap}},{key:"getLocationControl",value:function e(){var n=this;this.DOM.locationWrap=t.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-place"></div>'])));this.DOM.locationOuterWrap=t.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block">\n\t\t\t<div class="calendar-field-title calendar-field-title-align-top">',":</div>\n\t\t\t","\n\t\t</div>"])),t.Loc.getMessage("EC_LOCATION_LABEL"),this.DOM.locationWrap);this.locationSelector=new s.Location({wrap:this.DOM.locationWrap,richLocationEnabled:this.locationFeatureEnabled,locationList:this.locationList||[],roomsManager:this.roomsManager||null,locationAccess:this.locationAccess||false,iblockMeetingRoomList:this.iblockMeetingRoomList||[],inlineEditModeEnabled:!this.isLocationCalendar,onChangeCallback:function e(){if(n.userPlannerSelector){n.userPlannerSelector.setLocationValue(n.locationSelector.getTextValue());if(n.locationSelector.getValue().type!==undefined&&!n.userPlannerSelector.isPlannerDisplayed()){n.userPlannerSelector.showPlanner()}n.userPlannerSelector.refreshPlanner()}n.checkForChanges()}});if(this.userPlannerSelector){this.userPlannerSelector.subscribe("onDisplayAttendees",this.checkLocationForm.bind(this))}return this.DOM.locationOuterWrap}},{key:"createRemindersControl",value:function e(){var i=this;this.reminderValues=[];this.DOM.remindersWrap=t.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>'])));this.remindersControl=new s.Reminder({wrap:this.DOM.remindersWrap,zIndex:this.zIndex});this.remindersControl.subscribe("onChange",(function(e){if(e instanceof n.BaseEvent){i.reminderValues=e.getData().values;if(!i.isNewEntry()&&(i.canDo("edit")||i.entry.getCurrentStatus()!==false)){i.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:i.entry.id,userId:i.userId,reminders:i.reminderValues}}).then((function(e){i.entry.data.REMIND=e.data.REMIND}))}}}));return this.DOM.remindersWrap}},{key:"getTypeInfoControl",value:function e(){this.DOM.typeInfoTitle=t.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-title"></div>'])));this.DOM.typeInfoLink=t.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-link"></div>'])));this.DOM.typeInfoWrap=t.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.DOM.typeInfoTitle,this.DOM.typeInfoLink);return this.DOM.typeInfoWrap}},{key:"getRRuleInfoControl",value:function e(){this.DOM.rruleInfo=t.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>'])));this.DOM.rruleInfoWrap=t.Tag.render(V||(V=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("EC_REPEAT"),this.DOM.rruleInfo);return this.DOM.rruleInfoWrap}},{key:"getTimezoneInfoControl",value:function e(){this.DOM.timezoneInfo=t.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>'])));this.DOM.timezoneInfoWrap=t.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("EC_TIMEZONE"),this.DOM.timezoneInfo);return this.DOM.timezoneInfoWrap}},{key:"isNewEntry",value:function e(){return!this.entry.id}},{key:"canDo",value:function e(t){var n=this.getCurrentSection();if(t==="edit"||t==="delete"){if(this.entry.isMeeting()&&this.entry.id!==this.entry.parentId){return false}if(this.entry.isResourcebooking()){return false}return n.canDo("edit")}if(t==="view"){return n.canDo("view_time")}if(t==="viewFull"){return n.canDo("view_full")}return true}},{key:"setFormValues",value:function e(){var n=this.entry,a=this.getCurrentSection(),s=!this.canDo("edit");this.dateTimeControl.setValue({from:i.Util.adjustDateForTimezoneOffset(n.from,n.userTimezoneOffsetFrom,n.fullDay),to:i.Util.adjustDateForTimezoneOffset(n.to,n.userTimezoneOffsetTo,n.fullDay),fullDay:n.fullDay,timezoneFrom:n.getTimezoneFrom()||"",timezoneTo:n.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.dateTimeControl.setInlineEditMode(this.isNewEntry()?"edit":"view");this.dateTimeControl.setViewMode(s);this.DOM.titleInput.value=n.getName();if(s){if(this.entry.getCurrentStatus()===false){this.DOM.titleInput.type="hidden";this.DOM.titleLabel=this.DOM.titleInput.parentNode.insertBefore(t.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field calendar-field-string">',"</span>"])),t.Text.encode(n.getName())),this.DOM.titleInput);t.Dom.addClass(this.DOM.titleOuterWrap,"calendar-field-container-view")}else{this.DOM.titleInput.disabled=true}}this.colorSelector.setValue(n.getColor()||a.color,false);this.colorSelector.setViewMode(s&&this.entry.getCurrentStatus()===false);this.sectionValue=this.getCurrentSectionId();this.sectionSelector.updateValue();this.sectionSelector.setViewMode(s);this.remindersControl.setValue(n.getReminders(),false);this.remindersControl.setViewMode(s&&this.entry.getCurrentStatus()===false);if(s&&this.entry.getCurrentStatus()===false){this.DOM.remindersOuterWrap.style.display="none"}if(n.isRecursive()){this.DOM.rruleInfoWrap.style="";t.Dom.adjust(this.DOM.rruleInfo,{text:n.getRRuleDescription()})}var r=n.getLocation();if(s&&!r){this.DOM.locationOuterWrap.style.display="none"}else{this.locationSelector.setViewMode(s);if(this.isLocationCalendar){this.locationSelector.setValue(this.locationSelector["default"]);r=this.locationSelector["default"]}else{this.DOM.locationOuterWrap.style.display="";this.locationSelector.setValue(n.getLocation())}}if(this.locationSelector){this.locationSelector.checkLocationAccessibility({from:this.dateTimeControl.getValue().from,to:this.dateTimeControl.getValue().to,fullDay:this.dateTimeControl.getValue().fullDay,currentEventId:this.entry.id})}if(this.userPlannerSelector&&(this.canDo("viewFull")||n.getCurrentStatus()!==false)){this.userPlannerSelector.setValue({attendeesEntityList:n.getAttendeesEntityList(),location:r,attendees:n.getAttendees(),notify:!n.isMeeting()||n.getMeetingNotify(),viewMode:this.getMode()===F.VIEW_MODE,entry:n,hideGuests:n.getHideGuests()});this.userPlannerSelector.setDateTime(this.dateTimeControl.getValue());this.userPlannerSelector.setViewMode(s);if(this.isLocationCalendar){this.userPlannerSelector.showPlanner()}}else{t.Dom.remove(this.DOM.userPlannerSelectorOuterWrap)}var o=true;this.DOM.infoContainer=this.DOM.wrap.querySelector(".calendar-field-container-info");for(var l=0;l<=this.DOM.infoContainer.childNodes.length;l++){if(t.Type.isElementNode(this.DOM.infoContainer.childNodes[l])&&this.DOM.infoContainer.childNodes[l].style.display!=="none"){o=false}}if(o){this.DOM.infoContainer.style.display="none"}}},{key:"setFormValuesLocation",value:function e(){var n=this.entry,a=this.getCurrentSection(),s=true;this.dateTimeControl.setValue({from:i.Util.adjustDateForTimezoneOffset(n.from,n.userTimezoneOffsetFrom,n.fullDay),to:i.Util.adjustDateForTimezoneOffset(n.to,n.userTimezoneOffsetTo,n.fullDay),fullDay:n.fullDay,timezoneFrom:n.getTimezoneFrom()||"",timezoneTo:n.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.dateTimeControl.setInlineEditMode(this.isNewEntry()?"edit":"view");this.dateTimeControl.setViewMode(s);if(this.entry.id!==this.entry.parentId){this.DOM.titleInput.value=a.name+": "+BX.util.htmlspecialchars(n.getName())}else{this.DOM.titleInput.value=t.Loc.getMessage("CALENDAR_UPDATE")}this.colorSelector.setValue(n.getColor()||a.color,false);this.colorSelector.setViewMode(!s);this.sectionValue=this.getCurrentSectionId();this.sectionSelector.updateValue();this.sectionSelector.setViewMode(s)}},{key:"save",value:function e(){var a=this;var o=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.state===this.STATE.REQUEST)return false;var d=this.getCurrentEntry();o=t.Type.isPlainObject(o)?o:{};if(this.isNewEntry()&&this.userPlannerSelector.hasExternalEmailUsers()&&i.Util.checkEmailLimitationPopup()&&!o.emailLimitationDialogShown){r.EntryManager.showEmailLimitationDialog({callback:function e(t){o.emailLimitationDialogShown=true;a.save(o)}});return false}if(!this.userSettings.sendFromEmail&&this.userPlannerSelector.hasExternalEmailUsers()){r.EntryManager.showConfirmedEmailDialog({callback:function e(t){a.save(o)}});return false}if(!this.isNewEntry()&&d.isRecursive()&&!o.confirmed&&this.getFormDataChanges(["section","notify"]).length>0){r.EntryManager.showConfirmEditDialog({callback:function e(t){o.recursionMode=t.recursionMode;o.confirmed=true;a.save(o)}});return false}if(!this.isNewEntry()&&d.isMeeting()&&o.sendInvitesAgain===undefined&&this.getFormDataChanges().includes("date&time")&&d.getAttendees().find((function(e){return e.STATUS==="N"}))){r.EntryManager.showReInviteUsersDialog({callback:function e(t){o.sendInvitesAgain=t.sendInvitesAgain;a.save(o)}});return false}var c=this.dateTimeControl.getValue();var u={id:d.id,section:this.sectionValue,name:this.DOM.titleInput.value,desc:d.getDescription(),reminder:this.remindersControl.getSelectedValues(),date_from:c.fromDate,date_to:c.toDate,skip_time:c.fullDay?"Y":"N",time_from:i.Util.formatTime(i.Util.adjustDateForTimezoneOffset(c.from,-d.userTimezoneOffsetFrom,c.fullDay)),time_to:i.Util.formatTime(i.Util.adjustDateForTimezoneOffset(c.to,-d.userTimezoneOffsetTo,c.fullDay)),location:this.locationSelector.getTextValue(),tz_from:d.getTimezoneFrom(),tz_to:d.getTimezoneTo(),meeting_notify:this.userPlannerSelector.getInformValue()?"Y":"N",meeting_host:d.data.MEETING_HOST||"0",chat_id:d.data.MEETING?d.data.MEETING.CHAT_ID:0,exclude_users:this.excludeUsers||[],attendeesEntityList:this.userPlannerSelector.getEntityList(),sendInvitesAgain:o.sendInvitesAgain?"Y":"N",hide_guests:this.userPlannerSelector.hideGuests?"Y":"N",requestUid:BX.Calendar.Util.registerRequestId()};var h=!d.id||this.checkCurrentUsersAccessibility();if(!h&&this.getFormDataChanges().includes("codes")){var f=d.getAttendeesEntityList();var p=[];u.attendeesEntityList.forEach((function(e){if(!f.find((function(t){return e.entityId===t.entityId&&parseInt(e.id)===parseInt(t.id)}))){if(e.entityId==="user"){p.push(e.id)}else{h=true}}}));u.newAttendeesList=p}u.checkCurrentUsersAccessibility=h?"Y":"N";if(d.id&&d.isRecursive()){u.EVENT_RRULE=d.data.RRULE}if(o.recursionMode){u.rec_edit_mode=o.recursionMode;u.current_date_from=i.Util.formatDate(d.from)}if(this.getCurrentSection().color.toLowerCase()!==this.colorSelector.getValue().toLowerCase()){u.color=this.colorSelector.getValue()}this.state=this.STATE.REQUEST;this.freezePopup();this.BX.ajax.runAction("calendar.api.calendarentryajax.editEntry",{data:u,analyticsLabel:{calendarAction:this.isNewEntry()?"create_event":"edit_event",formType:"compact",emailGuests:this.userPlannerSelector.hasExternalEmailUsers()?"Y":"N",markView:i.Util.getCurrentView()||"outside",markCrm:"N",markRrule:"NONE",markMeeting:this.entry.isMeeting()?"Y":"N",markType:this.type}}).then((function(e){if(a.isLocationCalendar){a.roomsManager.unsetHiddenRoom(s.Location.parseStringValue(u.location).room_id)}a.unfreezePopup();a.state=a.STATE.READY;if(e.data.entryId){if(d.id){r.EntryManager.showEditEntryNotification(e.data.entryId)}else{r.EntryManager.showNewEntryNotification(e.data.entryId)}}a.emit("onSave",new n.BaseEvent({data:{responseData:e.data,options:o}}));a.close();if(e.data.displayMobileBanner){(new l.MobileSyncBanner).showInPopup()}if(e.data.countEventWithEmailGuestAmount){i.Util.setEventWithEmailGuestAmount(e.data.countEventWithEmailGuestAmount)}if(t.Type.isArray(e.data.eventList)&&e.data.eventList.length&&e.data.eventList[0].REMIND){r.EntryManager.setNewEntryReminders(c.fullDay?"fullDay":"withTime",e.data.eventList[0].REMIND)}}),(function(e){a.unfreezePopup();if(e.data&&t.Type.isPlainObject(e.data.busyUsersList)){a.handleBusyUsersError(e.data.busyUsersList);var n=[];e.errors.forEach((function(e){if(e.code!=="edit_entry_user_busy"){n.push(e)}}));e.errors=n}if(e.errors&&e.errors.length){a.showError(e.errors)}a.state=a.STATE.ERROR}));return true}},{key:"handleBusyUsersError",value:function e(t){var n=this;var i=[],a=[];for(var r in t){if(t.hasOwnProperty(r)){i.push(t[r]);a.push(r)}}this.busyUsersDialog=new s.BusyUsersDialog;this.busyUsersDialog.subscribe("onSaveWithout",(function(){n.excludeUsers=a.join(",");n.save()}));this.busyUsersDialog.show({users:i})}},{key:"handleKeyPress",value:function e(a){var s=this;if(this.getMode()===F.EDIT_MODE&&a.keyCode===i.Util.getKeyCode("enter")&&this.checkTopSlider()){this.checkDataBeforeCloseMode=false;this.save()}else if(this.checkTopSlider()&&a.keyCode===i.Util.getKeyCode("escape")&&this.couldBeClosedByEsc()){this.close()}else if(a.keyCode===i.Util.getKeyCode("delete")&&!this.isNewEntry()&&this.canDo("delete")&&this.checkTopSlider()){var o=event.target||event.srcElement;var l=t.Type.isElementNode(o)?o.tagName.toLowerCase():null;if(l&&!["input","textarea"].includes(l)){n.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(function(){s.checkDataBeforeCloseMode=false;s.close()}));r.EntryManager.deleteEntry(this.entry)}}}},{key:"getCurrentEntry",value:function e(){return this.entry}},{key:"getCurrentSection",value:function e(){var t=false;var n=this.getCurrentSectionId();if(n&&this.sectionIndex[n]!==undefined&&this.sections[this.sectionIndex[n]]!==undefined){t=this.sections[this.sectionIndex[n]]}return t}},{key:"getCurrentSectionId",value:function e(){var t=0;if(this.sectionValue){t=this.sectionValue}else{var n=this.getCurrentEntry();if(n instanceof r.Entry){t=parseInt(n.sectionId)}if(!t&&this.sections[0]){t=parseInt(this.sections[0].id)}}return t}},{key:"handlePlannerSelectorChanges",value:function e(t){if(t instanceof n.BaseEvent){var i=this.dateTimeControl.getValue();i.from=t.getData().dateFrom;i.to=t.getData().dateTo;this.dateTimeControl.setValue(i);this.userPlannerSelector.setDateTime(this.dateTimeControl.getValue());if(this.locationSelector){this.locationSelector.checkLocationAccessibility({from:t.getData().dateFrom,to:t.getData().dateTo,fullDay:t.getData().fullDay,currentEventId:this.entry.id})}}}},{key:"editEntryInSlider",value:function e(){this.checkDataBeforeCloseMode=false;var t=this.dateTimeControl.getValue();BX.Calendar.EntryManager.openEditSlider({entry:this.entry,type:this.type,isLocationCalendar:this.isLocationCalendar,locationAccess:this.locationAccess,dayOfWeekMonthFormat:this.dayOfWeekMonthFormat,roomsManager:this.roomsManager,locationCapacity:s.Location.getCurrentCapacity(),ownerId:this.ownerId,userId:this.userId,formDataValue:{section:this.sectionValue,name:this.DOM.titleInput.value,reminder:this.remindersControl.getSelectedRawValues(),color:this.colorSelector.getValue(),from:i.Util.adjustDateForTimezoneOffset(t.from,-this.entry.userTimezoneOffsetFrom,t.fullDay),to:i.Util.adjustDateForTimezoneOffset(t.to,-this.entry.userTimezoneOffsetTo,t.fullDay),fullDay:t.fullDay,location:this.locationSelector.getTextValue(),meetingNotify:this.userPlannerSelector.getInformValue()?"Y":"N",hideGuests:this.userPlannerSelector.hideGuests?"Y":"N",attendeesEntityList:this.userPlannerSelector.getEntityList()}});this.close()}},{key:"outsideMouseDownClose",value:function e(t){if(this.checkTopSlider()){var n=t.target||t.srcElement;this.outsideMouseDown=!n.closest("div.popup-window")}}},{key:"checkTopSlider",value:function e(){return!i.Util.getBX().SidePanel.Instance.getTopSlider()}},{key:"checkOutsideClickClose",value:function e(t){var n=t.target||t.srcElement;this.outsideMouseUp=!n.closest("div.popup-window");if(this.couldBeClosedByEsc()&&this.outsideMouseDown&&this.outsideMouseUp&&(this.getMode()===F.VIEW_MODE||!this.formDataChanged()||this.isNewEntry())){setTimeout(this.close.bind(this),0)}}},{key:"couldBeClosedByEsc",value:function e(){var t=this;return!a.PopupManager._popups.find((function(e){return e&&e.getId()!==t.popupId&&e.isShown()}))}},{key:"emitOnChange",value:function e(){this.emit("onChange",new n.BaseEvent({data:{form:this,entry:this.entry}}))}},{key:"showError",value:function e(n){var i="";if(t.Type.isArray(n)){n.forEach((function(e){i+=e.message+"\n"}))}if(i!==""){alert(i)}}},{key:"reloadEntryData",value:function e(){if(this.isShown()&&!this.isNewEntry()&&this.getMode()===F.VIEW_MODE){var t=i.Util.getCalendarContext();if(t){this.entry=r.EntryManager.getEntryInstance(t.getView().getEntryById(this.entry.getUniqueId()));this.setFormValues()}}}},{key:"checkCurrentUsersAccessibility",value:function e(){return this.getFormDataChanges().includes("date&time")}},{key:"handlePull",value:function e(n){var i,a,s,r=this;if(this.userPlannerSelector&&(i=this.userPlannerSelector)!==null&&i!==void 0&&(a=i.planner)!==null&&a!==void 0&&a.isShown()){var o,l,d,c;var u=t.Type.isArray(n===null||n===void 0?void 0:(o=n.fields)===null||o===void 0?void 0:o.ATTENDEES)?n.fields.ATTENDEES:[];var h=(n===null||n===void 0?void 0:(l=n.fields)===null||l===void 0?void 0:l.CAL_TYPE)==="user"?parseInt(n===null||n===void 0?void 0:(d=n.fields)===null||d===void 0?void 0:d.OWNER_ID):parseInt(n===null||n===void 0?void 0:(c=n.fields)===null||c===void 0?void 0:c.CREATED_BY);if(!u.includes(h)){u.push(h)}this.userPlannerSelector.clearAccessibilityData(u);this.userPlannerSelector.refreshPlannerState()}var f=this.getCurrentEntry();if(!this.isNewEntry()&&f&&f.parentId===parseInt(n===null||n===void 0?void 0:(s=n.fields)===null||s===void 0?void 0:s.PARENT_ID)){var p;if(n.command==="delete_event"&&f.getType()===(n===null||n===void 0?void 0:(p=n.fields)===null||p===void 0?void 0:p.CAL_TYPE)){this.close()}else{var g=function e(){r.reloadEntryData();BX.Event.EventEmitter.unsubscribe("BX.Calendar:onEntryListReload",e)};BX.Event.EventEmitter.subscribe("BX.Calendar:onEntryListReload",g)}}}}]);return F}(n.EventEmitter);babelHelpers.defineProperty(F,"VIEW_MODE","view");babelHelpers.defineProperty(F,"EDIT_MODE","edit");babelHelpers.defineProperty(F,"USER_URL","/company/personal/user/#USER_ID#/");e.CompactEventForm=F})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Event,BX.Calendar,BX.Main,BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar.Sync.Interface);
//# sourceMappingURL=compacteventform.bundle.map.js