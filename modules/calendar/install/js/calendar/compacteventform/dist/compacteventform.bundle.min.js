this.BX=this.BX||{};(function(e,t,i,a,n,s,r){"use strict";function l(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-notification-btn-container calendar-notification-btn-add"><span class="calendar-notification-icon"></span></span>']);l=function t(){return e};return e}function o(){var e=babelHelpers.taggedTemplateLiteral(["<span></span>"]);o=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-container-text">',":</div>\n\t\t"]);d=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-datetime" style="display: flex;"/>\n\t\t']);c=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="calendar-field calendar-field-string" \n\t\t\t\tvalue="" \n\t\t\t\tplaceholder="','" \n\t\t\t\ttype="text" \n\t\t\t/>\n\t\t']);h=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-compact-event-form"></div>']);p=function t(){return e};return e}var u=function(e){babelHelpers.inherits(i,e);function i(){var e;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"zIndex",1100);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"width",550);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.CompactEventForm");e.userId=t.userId||a.Util.getCurrentUserId();e.type=t.type||"user";e.ownerId=t.ownerId||e.userId;return e}babelHelpers.createClass(i,[{key:"show",value:function e(){var i=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return;this.setParams(s);this.setMode(a);this.popupId="compact-event-form-"+Math.round(Math.random()*1e5);this.popup=new n.Popup(this.popupId,s.bindNode,{width:this.width,zIndex:this.zIndex,autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup",cacheable:false,content:this.getPopupContent(),buttons:this.getButtons()});t.Dom.addClass(this.popup.titleBar,"calendar-add-popup-titlebar");t.Dom.removeClass(this.popup.popupContainer,"popup-window-with-titlebar");t.Dom.removeClass(this.popup.closeIcon,"popup-window-titlebar-close-icon");this.prepareData().then(function(){i.hideLoader();i.setFormValues()});this.popup.show()}},{key:"getPopupContent",value:function e(){this.DOM.wrap=t.Tag.render(p());this.createTitleControl();this.createColorControl();this.createSectionControl();this.createDateTimeControl();this.createUserSelectorControl();this.createPlannerControl();this.createLocationControl();this.createRemindersControl();return this.DOM.wrap}},{key:"setFormValues",value:function e(){var t=this.entry;this.DOM.titleInput.value=t.getName();return;this.dateTimeControl.setValue({from:t.from,to:t.to,fullDay:t.fullDay,timezoneFrom:t.getTimezoneFrom()||"",timezoneTo:t.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.DOM.sectionInput.value=this.getCurrentSectionId();this.sectionSelector.updateValue();if(!this.fieldIsPinned("section")){var i=this.getCurrentSection();if(i["CAL_TYPE"]!==this.type||i["CAL_TYPE"]===this.type&&parseInt(i["OWNER_ID"])!==this.ownerId){this.pinField("section")}}this.colorSelector.setValue(t.getColor()||this.getCurrentSection().COLOR);this.reminderControl.setValue(t.getReminders());this.repeatSelector.setValue(t.getRrule());if(this.DOM.accessibilityInput){this.DOM.accessibilityInput.value=t.accessibility}this.locationSelector.setValue(t.getLocation());if(this.DOM.privateEventCheckbox){this.DOM.privateEventCheckbox.checked=t.private}if(this.DOM.importantEventCheckbox){this.DOM.importantEventCheckbox.checked=t.important}if(this.userSelector){this.userSelector.setValue(t.getAttendeesCodes())}this.loadPlannerData({codes:t.getAttendeesCodes(),from:a.Util.formatDate(t.from.getTime()-a.Util.getDayLength()*3),to:a.Util.formatDate(t.to.getTime()+a.Util.getDayLength()*10),timezone:t.getTimezoneFrom(),location:this.locationSelector.getTextValue()})}},{key:"getButtons",value:function e(){var a=[];var n=this.getMode();if(n===i.EDIT_MODE){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_SAVE")+" (Enter)",className:"popup-window-button-accept"}));if(!this.isNewEntry()&&this.canDo("delete")){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_DELETE")}))}}else if(n===i.VIEW_MODE_MODE){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_OPEN")}));if(!this.isNewEntry()&&this.canDo("edit")){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_EDIT")}))}if(!this.isNewEntry()&&this.canDo("delete")){a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_DELETE")}))}}a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL")}));a.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_FULL_FORM")}));return a}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader);this.DOM.loader=null}}},{key:"showInEditMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(i.EDIT_MODE,t)}},{key:"showInViewMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(i.VIEW_MODE,t)}},{key:"setMode",value:function e(t){if(t==="edit"||t==="view"){this.mode=t}}},{key:"getMode",value:function e(){return this.mode}},{key:"setParams",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.userId=t.userId||a.Util.getCurrentUserId();this.type=t.type||"user";this.ownerId=t.ownerId||this.userId;this.entry=r.EntryManager.getEntryInstance(t.entry,t.userIndex)}},{key:"prepareData",value:function e(){return new Promise(function(e){setTimeout(function(){e()},0)})}},{key:"createTitleControl",value:function e(){this.DOM.titleInput=this.DOM.wrap.appendChild(t.Tag.render(h(),t.Loc.getMessage("EC_ENTRY_NAME")))}},{key:"createColorControl",value:function e(){}},{key:"createSectionControl",value:function e(){}},{key:"createDateTimeControl",value:function e(){this.DOM.dateTimeWrap=this.DOM.wrap.appendChild(t.Tag.render(c()));this.dateTimeSelector=new s.DateTimeControl(null,{showTimezone:false,outerWrap:this.DOM.dateTimeWrap})}},{key:"createUserSelectorControl",value:function e(){}},{key:"createPlannerControl",value:function e(){return;this.plannerId=this.calendar.id+"-simple-planner";this.plannerShown=false;this.plannerWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-planner-wrap"}}));BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.addCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(!this.requestPlanner){this.requestPlanner=true;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_planner",sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",reqId:Math.round(Math.random()*1e6),planner_id:this.plannerId},BX.delegate(function(e){if(this.loader)BX.remove(this.loader);e=BX.util.trim(e);this.plannerWrap.innerHTML=e;this.requestPlanner=false;this.checkPlannerState()},this))}}},{key:"createLocationControl",value:function e(){}},{key:"createRemindersControl",value:function e(){this.DOM.remindersWrap=this.DOM.wrap.appendChild(t.Tag.render(d(),t.Loc.getMessage("EC_REMIND_LABEL")));this.remindersControl=new s.Reminder({valuesContainerNode:this.DOM.remindersWrap.appendChild(t.Tag.render(o())),addButtonNode:this.DOM.remindersWrap.appendChild(t.Tag.render(l()))});this.remindersControl.subscribe("onChange",function(e){})}},{key:"isNewEntry",value:function e(){return true}},{key:"canDo",value:function e(t){return true}},{key:"showEdit",value:function e(t){this.params=t;this.entryTime=t.entryTime;this.attendees=[];this.attendeesCodesList=false;this.attendeesIndex={};this.attendeesCodes={};this.allowInvite=true;this.notify=true;this.secondSlideIsOpened=false;this.checkDataBeforeCloseMode=true;this.displayed=false;if(this.calendar.ownerUser){this.attendees.push(this.calendar.ownerUser);this.attendeesIndex[this.calendar.ownerUser.id]=true;this.attendeesCodes["U"+this.calendar.ownerUser.id]="users"}this.attendees.push(this.calendar.currentUser);this.attendeesIndex[this.calendar.currentUser.id]=true;this.attendeesCodes["U"+this.calendar.currentUser.id]="users";this.initiateAttendees=[];this.attendees.forEach(function(e){this.initiateAttendees.push(e.id)},this);var i,a,n=-152,s=390,r=420,l=8,o=BX.pos(t.entryNode),d=BX.GetWindowSize();if(o.right+s+l<d.innerWidth){i="left";a=o.width+l}else{i="right";a=-s-l}if(d.scrollTop+d.innerHeight-(o.bottom+r+n)<-35){i=false}var c=new BX.PopupWindow(this.calendar.id+"-simple-add-popup",t.bindNode||t.entryNode,{offsetTop:n,offsetLeft:a,closeIcon:true,width:s,titleBar:true,draggable:true,resizable:false,lightShadow:true,content:this.createContent(),overlay:{opacity:1},buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_SAVE")+" (ENTER)",className:"popup-window-button-accept",events:{click:BX.delegate(this.save,this)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CANCEL"),events:{click:BX.delegate(this.close,this)}})]});if(i!==false){c.setAngle({offset:130,position:i})}BX.addClass(c.titleBar,"calendar-add-popup-titlebar");BX.removeClass(c.popupContainer,"popup-window-with-titlebar");BX.removeClass(c.closeIcon,"popup-window-titlebar-close-icon");c.show(true);this.popup=c;if(c.overlay&&c.overlay.element){this.overlay=c.overlay.element;BX.addClass(c.overlay.element,"calendar-popup-overlay");setTimeout(BX.delegate(function(){BX.addClass(c.overlay.element,"calendar-popup-overlay-dark");c.overlay=null},this),1)}this.popupButtonsContainer=c.buttonsContainer;BX.addClass(c.contentContainer,"calendar-add-popup-wrap");c.popupContainer.style.minHeight=c.popupContainer.offsetHeight-20+"px";this.nameField.input.focus();this.nameField.input.select();BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent(c,"onPopupClose",BX.proxy(this.close,this));BX.bind(this.overlay,"click",BX.proxy(this.close,this));this.calendar.disableKeyHandler();setTimeout(BX.delegate(function(){this.calendar.disableKeyHandler()},this),100);this.displayed=true}},{key:"save",value:function e(t){t=t||{};if(t.checkBusyUsers!==false&&this.calendar.util.isMeetingsEnabled()){var i=this.getBusyUserList();if(i&&i.length>0){if(!this.busyUsersDialog)this.busyUsersDialog=new window.BXEventCalendar.BusyUsersDialog(this.calendar);this.busyUsersDialog.show({users:i,saveCallback:BX.delegate(function(){var e,a=[];for(e=0;e<i.length;e++){a.push(i[e].id)}this.excludeUsers=a.join(",");t.checkBusyUsers=false;this.save(t)},this)});return}}if(this.params.section.id){var a=this.calendar.sectionController.getSection(this.params.section.id);if(a){a.show()}}this.calendar.entryController.saveEntry(this.getPopupData());if(BX.type.isFunction(this.params.saveCallback)){this.params.saveCallback()}this.checkDataBeforeCloseMode=false;this.close()}},{key:"close",value:function e(){if(this.checkDataBeforeCloseMode&&!this.checkBeforeClose()&&!confirm(BX.message("EC_SAVE_ENTRY_CONFIRM"))){return}this.calendar.enableKeyHandler();if(this.popup){BX.removeCustomEvent(this.popup,"onPopupClose",BX.proxy(this.close,this));this.popup.destroy()}if(this.overlay){BX.removeClass(this.overlay,"calendar-popup-overlay-dark");setTimeout(BX.delegate(function(){BX.remove(this.overlay)},this),300)}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(this.plannerId){BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}])}if(BX.type.isFunction(this.params.closeCallback)){this.params.closeCallback()}BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this));BX.unbind(this.overlay,"click",BX.proxy(this.close,this));this.displayed=false}},{key:"isShown",value:function e(){return this.displayed}},{key:"couldBeClosedByEsc",value:function e(){return!(this.dateTimeField.fromTime&&this.dateTimeField.fromTime.shown||this.dateTimeField.toTime&&this.dateTimeField.toTime.shown||this.secondSlideIsOpened||this.reminderField&&this.reminderField.reminder&&this.reminderField.reminder.reminderMenu||this.sectionSelector&&this.sectionSelector.sectionMenu||this.locationSelector&&this.locationSelector.selectContol&&this.locationSelector.selectContol.popupMenu||BX.PopupWindowManager.getCurrentPopup())}},{key:"createContent",value:function e(){this.mainSlide=BX.create("DIV",{props:{className:"calendar-add-popup-main-slide"}});this.secondSlide=false;this.createSectionSelector();this.createDateTimeField();this.createReminderField();this.createlocationField();if(this.calendar.util.isMeetingsEnabled()){this.createPlannerField()}this.fullFormField=this.createField("container-text",this.mainSlide);this.fullFormField.link=this.fullFormField.innerWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-text-link"},text:BX.message("EC_FULL_FORM_LABEL"),events:{click:function(){this.checkDataBeforeCloseMode=false;if(BX.type.isFunction(this.params.fullFormCallback)){this.params.fullFormCallback()}}.bind(this)}}));this.mainSlide.appendChild(BX.create("HR",{props:{className:"calendar-filed-separator"}}));this.sliderContainer=BX.create("DIV",{props:{className:"calendar-add-popup-slider-container"},children:[this.mainSlide]});return this.sliderContainer}},{key:"prepareSecondSlide",value:function e(t){this.closeSecondSlideCallback=t.closeCallback||null;if(this.secondSlide){BX.cleanNode(this.secondSlide)}else{this.secondSlide=this.sliderContainer.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide"}}))}this.backButton=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide-header"}})).appendChild(BX.create("SPAN",{props:{className:"calendar-add-popup-second-slide-back-btn"},html:BX.message("EC_SIMPLE_FORM_BACK")}));BX.bind(this.backButton,"click",BX.proxy(this.closeSecondSlide,this));BX.bind(document,"keyup",BX.proxy(this.secondSlideEscHandler,this));this.popupButtonsContainer.style.display="none";this.resizeSecondSlide();setTimeout(BX.delegate(function(){BX.addClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active")},this),0);this.secondSlideIsOpened=true}},{key:"secondSlideEscHandler",value:function e(t){if(t.keyCode===this.calendar.util.KEY_CODES["escape"]){this.closeSecondSlide()}}},{key:"closeSecondSlide",value:function e(){if(this.closeSecondSlideCallback){this.closeSecondSlideCallback()}BX.unbind(document,"keyup",BX.proxy(this.secondSlideEscHandler,this));BX.removeClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active");this.popupButtonsContainer.style.display="";this.clearSecondSlideHeight();if(this.resizeTimeout){this.resizeTimeout=clearTimeout(this.resizeTimeout)}BX.cleanNode(this.secondSlide);this.secondSlideIsOpened=false}},{key:"resizeSecondSlide",value:function e(){if(this.secondSlide){var t=this.secondSlide.scrollHeight;if(t!=parseInt(this.popup.contentContainer.style.minHeight)){this.secondSlide.style.minHeight=t+"px";this.sliderContainer.style.minHeight=t+"px"}this.resizeTimeout=setTimeout(BX.proxy(this.resizeSecondSlide,this),100)}}},{key:"clearSecondSlideHeight",value:function e(){if(this.secondSlide)this.secondSlide.style.minHeight="";if(this.sliderContainer)this.sliderContainer.style.minHeight=""}},{key:"createField",value:function e(t,i){if(!t)t="string";var a=BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-"+t}}),n=a.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));if(i)i.appendChild(a);return{outerWrap:a,innerWrap:n}}},{key:"createSectionSelector",value:function e(){this.sectionSelector=new window.BXEventCalendar.SectionSelector({outerWrap:this.nameField.innerWrap,sectionList:this.calendar.sectionController.getSectionListForEdit(),sectionGroupList:this.calendar.sectionController.getSectionGroupList(),mode:"compact",getCurrentSection:BX.delegate(function(){return this.params.section},this),selectCallback:BX.delegate(function(e){if(e){this.params.section=this.calendar.sectionController.getSection(e.id);if(BX.type.isFunction(this.params.changeSectionCallback)){this.params.changeSectionCallback(e)}}},this),openPopupCallback:BX.delegate(function(){this.popup.setAutoHide(false)},this),closePopupCallback:BX.delegate(function(){this.popup.setAutoHide(true)},this)})}},{key:"createDateTimeField",value:function e(){var t=this;this.initiateTimeFrom=this.calendar.util.formatTime(this.entryTime.from.getHours(),this.entryTime.from.getMinutes());this.initiateTimeTo=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes());this.dateTimeField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-datetime"}}))};this.dateTimeField.dateWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-prefix"},text:this.calendar.util.formatDateUsable(this.entryTime.from,false)}));this.dateTimeField.fromTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-left"}}));this.dateTimeField.fromTimeInput=this.dateTimeField.fromTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:this.initiateTimeFrom,placeholder:BX.message("EC_TIME_FROM_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this._fromDateValue=this.entryTime.from;this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-between"}}));this.dateTimeField.toTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-right"}}));this.dateTimeField.toTimeInput=this.dateTimeField.toTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:this.initiateTimeTo,placeholder:BX.message("EC_TIME_TO_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this.dateTimeField.fromTime=new window.BXEventCalendar.SelectInput({input:this.dateTimeField.fromTimeInput,value:this.calendar.util.adaptTimeValue(t.calendar.util.parseTime(t.dateTimeField.fromTimeInput.value)),values:this.calendar.util.getSimpleTimeList(),onChangeCallback:BX.proxy(function(){var e=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),t=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),i=new Date(this.entryTime.from.getTime()),a=new Date(this.entryTime.from.getTime());i.setHours(e.h,e.m,0);a.setHours(t.h,t.m,0);if(this._fromDateValue){this.entryTime.to=new Date(i.getTime()+(a.getTime()-this._fromDateValue.getTime()||36e5));this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes())}this.entryTime.from=i;this._fromDateValue=i;if(this.params.timeNode){this.params.timeNode.innerHTML=this.calendar.util.formatTime(e.h,e.m)}if(BX.type.isFunction(this.params.changeTimeCallback)){this.params.changeTimeCallback(e,t)}},this)});this.dateTimeField.toTime=new window.BXEventCalendar.SelectInput({input:this.dateTimeField.toTimeInput,value:this.calendar.util.adaptTimeValue(this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value)),values:this.calendar.util.getSimpleTimeList()});if(!this.calendar.util.getUserOption("timezoneName")){this.timezoneField=this.createField("container-string",this.mainSlide);this.timezoneField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-timezone-label"},text:BX.message("EC_ASK_TZ")}));this.timezoneField.select=this.timezoneField.innerWrap.appendChild(BX.create("SELECT",{props:{className:"calendar-field calendar-field-select"},events:{change:function e(){t.calendar.util.setUserOption("timezoneName",t.timezoneField.select.value)}}}));var i,a=this.calendar.util.getTimezoneList();for(i in a){if(a.hasOwnProperty(i))this.timezoneField.select.options.add(new Option(a[i].title,i,false,false))}this.timezoneField.select.value=this.calendar.util.getUserOption("timezoneDefaultName")||"";this.timezoneField.innerWrap.appendChild(BX.create("SPAN",{props:{title:BX.message("EC_EVENT_TZ_DEF_HINT"),className:"calendar-event-quest"},html:"?"}));BX.addClass(this.timezoneField.innerWrap,"calendar-field-timezone")}}},{key:"setDateTimeValues",value:function e(t,i){if(t&&i&&this.dateTimeField&&this.dateTimeField.dateWrap){this.dateTimeField.dateWrap.innerHTML=this.calendar.util.formatDateUsable(t);this.dateTimeField.fromTimeInput.value=this.calendar.util.formatTime(t.getHours(),t.getMinutes());this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(i.getHours(),i.getMinutes());this.entryTime.from=t;this.entryTime.to=i;this._fromDateValue=t;if(this.params.timeNode)this.params.timeNode.innerHTML=this.dateTimeField.fromTimeInput.value}}},{key:"createReminderField",value:function e(){}},{key:"createlocationField",value:function e(){this.locationField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-select"}}))};this.locationSelector=new window.BXEventCalendar.LocationSelector(this.calendar.id+"-simple-slider-location",{value:this.entry?this.entry.location:"",wrapNode:this.locationField.outerWrap,getControlContentCallback:BX.delegate(function(){this.prepareSecondSlide({closeCallback:BX.proxy(this.locationSelector.saveValues,this.locationSelector)});this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-title-text"},text:BX.message("EC_MEETING_ROOM_LIST_TITLE")}));return this.secondSlide},this)},this.calendar)}},{key:"createPlannerField",value:function e(){this.plannerField=this.createField("container-members",this.mainSlide);this.plannerField.innerWrapAttendeesWrap=this.plannerField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-members-selected"},html:"<span>"+BX.message("EC_ATTENDEES_LABEL")+":</span>"}));this.plannerField.currentAttendeesWrap=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-attendees-list"}}));this.showAttendees();this.plannerField.plannerLink=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-members-change-link"},html:BX.message("EC_ATTENDEES_EDIT"),events:{click:BX.delegate(this.showPlannerSlide,this)}}))}},{key:"showAttendees",value:function e(){BX.cleanNode(this.plannerField.currentAttendeesWrap);var t,i,a=3,n=this.attendees.length,s=5;if(n>0){if(n>s){n=a}for(t=0;t<n;t++){i=this.attendees[t]||{};this.plannerField.currentAttendeesWrap.appendChild(BX.create("IMG",{attrs:{id:"simple_popup_"+i.id,src:i.smallAvatar||"","bx-tooltip-user-id":i.id},props:{className:"calendar-member"}}))}if(n<this.attendees.length){this.plannerField.currentAttendeesWrap.appendChild(BX.create("SPAN",{text:BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",this.attendees.length-n)}))}}}},{key:"showPlannerSlide",value:function e(){if(this.popup){this.popup.setAutoHide(false)}this.prepareSecondSlide({closeCallback:BX.proxy(this.hidePlannerSlide,this)});this.attendeesSelector=new window.BXEventCalendar.DestinationSelector(this.calendar.id+"-simple-popup-destination",{wrapNode:this.secondSlide,itemsSelected:this.attendeesCodes||this.calendar.util.getSocnetDestinationConfig("itemsSelected"),calendar:this.calendar});this.loader=BX.adjust(this.calendar.util.getLoader(),{style:{height:"180px"}});this.secondSlide.appendChild(this.loader);this.initPlannerControl();this.meetingOptionsWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-meeting-options-wrap"},style:{display:"none"}}));this.notifyField=this.createField("container-checkbox",this.meetingOptionsWrap);this.notifyField.label=this.notifyField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-field-checkbox-label"},html:BX.message("EC_NOTIFY_STATUS_LABEL")}));this.notifyField.checkbox=this.notifyField.label.appendChild(BX.create("INPUT",{attrs:{type:"checkbox"},props:{className:"calendar-field-checkbox"}}));this.notifyField.checkbox.checked=this.notify}},{key:"hidePlannerSlide",value:function e(){if(this.popup){this.popup.setAutoHide(true)}if(this.allowInviteField){this.allowInvite=!!this.allowInviteField.checkbox.checked}if(this.notifyField){this.notify=!!this.notifyField.checkbox.checked}this.destroyDestinationControls()}},{key:"entryNameChanged",value:function e(){var t=this.nameField.input.value||BX.message("EC_ENTRY_NAME");if(this.params.nameNode){this.params.nameNode.innerHTML=BX.util.htmlspecialchars(t)}if(BX.type.isFunction(this.params.changeNameCallback)){this.params.changeNameCallback(t)}}},{key:"initPlannerControl",value:function e(){}},{key:"onCalendarPlannerSelectorChanged",value:function e(t){if(this.calendar.util.getDayCode(this.entryTime.from)!==this.calendar.util.getDayCode(t.dateFrom)&&this.params.changeDateCallback){this.params.changeDateCallback(t.dateFrom);if(this.popup.angle){this.popup.setAngle(false)}}this.setDateTimeValues(t.dateFrom,t.dateTo)}},{key:"destroyDestinationControls",value:function e(){if(BX.SocNetLogDestination){if(BX.SocNetLogDestination.isOpenDialog())BX.SocNetLogDestination.closeDialog();if(BX.SocNetLogDestination.popupWindow)BX.SocNetLogDestination.popupWindow.close();BX.SocNetLogDestination.closeSearch()}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this))}},{key:"plannerIsShown",value:function e(){return this.plannerWrap&&BX.hasClass(this.plannerWrap,"calendar-add-popup-show-planner")}},{key:"checkPlannerState",value:function e(){var t={codes:this.attendeesSelector.getCodes(),from:this.calendar.util.formatDate(this.entryTime.from.getTime()-this.calendar.util.dayLength*3),to:this.calendar.util.formatDate(this.entryTime.from.getTime()+this.calendar.util.dayLength*10),location:this.locationSelector.getTextValue()};this.attendeesCodes=this.attendeesSelector.getAttendeesCodes();this.attendeesCodesList=this.attendeesSelector.getAttendeesCodesList(this.attendeesCodes);this.updatePlanner(t)}},{key:"updatePlanner",value:function e(t){if(!t)t={};this.plannerLoadedlocation=t.location||"";var i=this,a=0;this.calendar.request({data:{action:"update_planner",codes:t.codes||[],cur_event_id:a,date_from:t.dateFrom||t.from||"",date_to:t.dateTo||t.to||"",timezone:this.timezoneField&&this.timezoneField.select?this.timezoneField.select.value:this.calendar.util.getUserOption("timezoneName"),location:this.plannerLoadedlocation,entries:t.entrieIds||false,add_cur_user_to_list:"N"},handler:function e(a){var n,s=[],r={},l=false,o=!!(t.entries||a.entries&&a.entries.length>0);for(n=0;n<a.entries.length;n++){if(a.entries[n].type==="user"){s.push({id:a.entries[n].id,name:a.entries[n].name,avatar:a.entries[n].avatar,smallAvatar:a.entries[n].smallAvatar||a.entries[n].avatar,url:a.entries[n].url});r[a.entries[n].id]=true;if(!i.attendeesIndex[a.entries[n].id])l=true}}if(!l){for(var d in i.attendeesIndex){if(i.attendeesIndex.hasOwnProperty(d)&&!r[d]){l=true;break}}}if(l){i.attendees=s;i.showAttendees()}if(o){var c={show:o&&!i.plannerIsShown()};if(t.entries){a.entries=t.entries;c.scaleFrom=t.from;c.scaleTo=t.to}c.loadedDataFrom=t.from;c.loadedDataTo=t.to;c.data={entries:a.entries,accessibility:a.accessibility};c.focusSelector=t.focusSelector==undefined?false:t.focusSelector;i.refreshPlannerState(c)}else if(!o&&i.plannerIsShown()){i.hidePlanner()}}})}},{key:"refreshPlannerState",value:function e(t){if(!t||babelHelpers.typeof(t)!=="object")t={};this.plannerData=t.data;var i=this.calendar.util.getWorkTime(),a={changeFromFullDay:{scaleType:"1hour",timelineCellWidth:40},shownScaleTimeFrom:i.start,shownScaleTimeTo:i.end,width:this.plannerWrap.offsetWidth||400,minWidth:this.plannerWrap.offsetWidth||400,entriesListWidth:50,showEntiesHeader:false,showEntryName:false},n=this.plannerIsShown();if(t.focusSelector==undefined){t.focusSelector=true}if(!n&&!t.data){this.checkPlannerState()}else{if(t.show){BX.addClass(this.plannerWrap,"calendar-add-popup-show-planner");this.meetingOptionsWrap.style.display="";if(!n&&t.show){t.focusSelector=true}}var s=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),r=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),l=new Date(this.entryTime.from.getTime()),o=new Date(this.entryTime.from.getTime());l.setHours(s.h,s.m,0);o.setHours(r.h,r.m,0);BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:a,focusSelector:t.focusSelector,selector:{from:l,to:o,fullDay:false,animation:true,updateScaleLimits:true},data:t.data||false,loadedDataFrom:t.loadedDataFrom,loadedDataTo:t.loadedDataTo,show:!!t.show}])}}},{key:"getBusyUserList",value:function e(){var t,i=[];if(this.plannerData){for(t in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(t)&&this.plannerData.entries[t].id&&this.plannerData.entries[t].status!=="h"&&parseInt(this.plannerData.entries[t].strictStatus)&&!this.plannerData.entries[t].currentStatus){i.push(this.plannerData.entries[t])}}}return i}},{key:"hidePlanner",value:function e(){this.meetingOptionsWrap.style.display="none";this.plannerWrap.style.opacity=0;this.plannerWrap.style.height=0;this.plannerWrap.style.overflow="hidden";BX.removeClass(this.plannerWrap,"calendar-add-popup-show-planner")}},{key:"keyHandler",value:function e(t){if(t.keyCode===this.calendar.util.KEY_CODES["enter"]){this.save()}else if(t.keyCode===this.calendar.util.KEY_CODES["escape"]&&this.couldBeClosedByEsc()){this.close()}}},{key:"checkBeforeClose",value:function e(){var t=this.getPopupData();return!(this.params.entryName!==t.name||t.location||this.initiateAttendees.join(",")!==t.attendees.join(",")||this.initiateTimeFrom!==this.dateTimeField.fromTimeInput.value||this.initiateTimeTo!==this.dateTimeField.toTimeInput.value)}}]);return i}(i.EventEmitter);babelHelpers.defineProperty(u,"VIEW_MODE","view");babelHelpers.defineProperty(u,"EDIT_MODE","edit");e.CompactEventForm=u})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Event,BX.Calendar,BX.Main,BX.Calendar.Controls,BX.Calendar);
//# sourceMappingURL=compacteventform.bundle.map.js