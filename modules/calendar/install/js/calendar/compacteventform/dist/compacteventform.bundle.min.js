this.BX=this.BX||{};(function(e,t,n,i,r,s,a,o,l){"use strict";function u(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field calendar-field-string">',"</span>"]);u=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);d=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);c=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);h=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);f=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);p=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-link"></div>']);g=function t(){return e};return e}function y(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-title"></div>']);y=function t(){return e};return e}function m(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);m=function t(){return e};return e}function v(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block">\n\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t","\n\t\t</div>"]);v=function t(){return e};return e}function E(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-place"></div>']);E=function t(){return e};return e}function D(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-hide-members-container" style="display: none;">\n\t\t\t\t<div class="calendar-hide-members-container-inner">\n\t\t\t\t\t<div class="calendar-hide-members-icon-hidden"></div>\n\t\t\t\t\t<div class="calendar-hide-members-text">','</div>\n\t\t\t\t\t<span class="calendar-hide-members-helper" data-hint="','"></span>\n\t\t\t\t</div>\n\t\t\t</div>']);D=function t(){return e};return e}function M(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-planner-wrapper" style="height: 0">\n\t\t\t\t</div>']);M=function t(){return e};return e}function b(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-container-inform">\n\t\t\t\t\t<span class="calendar-field-container-inform-text">',"</span>\n\t\t\t\t</div>"]);b=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-members-selected">\n\t\t\t\t\t\t<span class="calendar-attendees-label"></span>\n\t\t\t\t\t\t<span class="calendar-attendees-list"></span>\n\t\t\t\t\t\t<span class="calendar-members-more">','</span>\n\t\t\t\t\t\t<span class="calendar-members-change-link">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);C=function t(){return e};return e}function I(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-field-container calendar-field-container-members">\n\t\t\t\t','\n\t\t\t\t<span class="calendar-videocall-wrap calendar-videocall-hidden"></span>\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="calendar-user-selector-wrap"></div>\n\t\t\t<div class="calendar-add-popup-planner-wrap calendar-add-popup-show-planner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t","\n\t\t<div>"]);I=function t(){return e};return e}function T(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-container calendar-field-container-datetime"></div>']);T=function t(){return e};return e}function S(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-choice-calendar"></div>']);S=function t(){return e};return e}function O(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field calendar-field-select calendar-field-tiny"></div>']);O=function t(){return e};return e}function w(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="calendar-field calendar-field-string" \n\t\t\t\tvalue="" \n\t\t\t\tplaceholder="','" \n\t\t\t\ttype="text" \n\t\t\t/>\n\t\t']);w=function t(){return e};return e}function k(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t\t","\n\t\t\t\t</div>"]);k=function t(){return e};return e}function L(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string-select">\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>"]);L=function t(){return e};return e}function _(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-add-popup-wrap">\n\t\t\t','\n\t\t\t<div class="calendar-field-container calendar-field-container-choice">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t\n\t\t\t","\n\t\t\t\n\t\t\t",'\n\t\t\t\n\t\t\t<div class="calendar-field-container calendar-field-container-info">\n\t\t\t\t',"\n\t\t\t\t\n\t\t\t\t\t","\n\t\t\t\t\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"]);_=function t(){return e};return e}var N=function(e){babelHelpers.inherits(N,e);function N(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,N);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(N).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"STATE",{READY:1,REQUEST:2,ERROR:3});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"zIndex",1200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"Z_INDEX_OFFSET",-1e3);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"userSettings","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"displayed",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"sections",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"sectionIndex",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"trackingUsersList",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"checkDataBeforeCloseMode",true);e.setEventNamespace("BX.Calendar.CompactEventForm");e.userId=n.userId||i.Util.getCurrentUserId();e.type=n.type||"user";e.ownerId=n.ownerId||e.userId;e.BX=i.Util.getBX();e.checkForChanges=t.Runtime.debounce(e.checkForChangesImmediately,300,babelHelpers.assertThisInitialized(e));e.checkOutsideClickClose=e.checkOutsideClickClose.bind(babelHelpers.assertThisInitialized(e));e.outsideMouseDownClose=e.outsideMouseDownClose.bind(babelHelpers.assertThisInitialized(e));e.keyHandler=e.handleKeyPress.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(N,[{key:"show",value:function e(){var n=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:N.EDIT_MODE;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.setParams(s);this.setMode(r);this.state=this.STATE.READY;this.popupId="compact-event-form-"+Math.round(Math.random()*1e5);if(this.popup){this.popup.destroy()}this.popup=this.getPopup(s);t.Dom.addClass(this.popup.titleBar,"calendar-add-popup-titlebar");t.Dom.removeClass(this.popup.popupContainer,"popup-window-with-titlebar");t.Dom.removeClass(this.popup.closeIcon,"popup-window-titlebar-close-icon");t.Event.bind(document,"mousedown",this.outsideMouseDownClose);t.Event.bind(document,"mouseup",this.checkOutsideClickClose);t.Event.bind(document,"keydown",this.keyHandler);t.Event.bind(this.popup.popupContainer,"transitionend",function(){t.Dom.removeClass(n.popup.popupContainer,"calendar-simple-view-popup-show")});if(this.getMode()===N.EDIT_MODE){a.EntryManager.doDelayedActions()}this.prepareData().then(function(){n.setFormValues();n.popup.show();n.checkDataBeforeCloseMode=true;if(n.canDo("edit")&&n.DOM.titleInput&&r===N.EDIT_MODE){n.DOM.titleInput.focus();n.DOM.titleInput.select()}n.displayed=true;if(n.getMode()===N.VIEW_MODE){i.Util.sendAnalyticLabel({calendarAction:"view_event",formType:"compact"});n.popup.getButtons()[0].button.focus()}if(!n.userPlannerSelector.isPlannerDisplayed()&&n.getMode()===N.EDIT_MODE){n.userPlannerSelector.checkBusyTime()}})}},{key:"getPopup",value:function e(t){return new r.Popup(this.popupId,t.bindNode,{zIndex:this.zIndex+this.Z_INDEX_OFFSET,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup calendar-simple-view-popup-show",cacheable:false,content:this.getPopupContent(),buttons:this.getButtons(),events:{onPopupClose:this.close.bind(this)}})}},{key:"isShown",value:function e(){return this.displayed}},{key:"close",value:function e(){if(this.getMode()===N.EDIT_MODE&&this.formDataChanged()&&this.checkDataBeforeCloseMode&&!confirm(BX.message("EC_SAVE_ENTRY_CONFIRM"))){return}this.displayed=false;this.emit("onClose");t.Event.unbind(document,"mousedown",this.outsideMouseDownClose);t.Event.unbind(document,"mouseup",this.checkOutsideClickClose);t.Event.unbind(document,"keydown",this.keyHandler);if(this.userPlannerSelector){this.userPlannerSelector.destroy()}if(this.popup){this.popup.destroy()}i.Util.clearPlannerWatches();i.Util.closeAllPopups()}},{key:"getPopupContent",value:function e(){this.DOM.wrap=t.Tag.render(_(),this.DOM.titleOuterWrap=t.Tag.render(L(),this.getTitleControl(),this.getColorControl()),this.getSectionControl(),this.getDateTimeControl(),this.getUserPlannerSelector(),this.getTypeInfoControl(),this.getLocationControl(),this.DOM.remindersOuterWrap=t.Tag.render(k(),t.Loc.getMessage("EC_REMIND_LABEL"),this.createRemindersControl()),this.getRRuleInfoControl());return this.DOM.wrap}},{key:"getButtons",value:function e(){var i=this;var r=[];var s=this.getMode();if(s===N.EDIT_MODE){r.push(new BX.UI.Button({name:"save",text:this.isNewEntry()?t.Loc.getMessage("CALENDAR_EVENT_DO_ADD"):t.Loc.getMessage("CALENDAR_EVENT_DO_SAVE"),className:"ui-btn ui-btn-primary",events:{click:function e(){i.checkDataBeforeCloseMode=false;i.save()}}}));r.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function e(){if(i.isNewEntry()){i.checkDataBeforeCloseMode=false;i.close()}else{i.setFormValues();if(i.userPlannerSelector){i.userPlannerSelector.destroy()}i.setMode(N.VIEW_MODE);i.popup.setButtons(i.getButtons())}}}}));r.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_FULL_FORM"),className:"ui-btn calendar-full-form-btn",events:{click:this.editEntryInSlider.bind(this)}}))}else if(s===N.VIEW_MODE){if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"){r.push(new BX.UI.Button({className:"ui-btn ui-btn-primary",text:t.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function e(){a.EntryManager.setMeetingStatus(i.entry,"Y").then(i.refreshMeetingStatus.bind(i))}}}));r.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function e(){a.EntryManager.setMeetingStatus(i.entry,"N").then(function(){if(i.isShown()){i.close()}})}}}))}r.push(new BX.UI.Button({className:"ui-btn ".concat(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"?"ui-btn-link":"ui-btn-primary"),text:t.Loc.getMessage("CALENDAR_EVENT_DO_OPEN"),events:{click:function e(){i.checkDataBeforeCloseMode=false;BX.Calendar.EntryManager.openViewSlider(i.entry.id,{entry:i.entry,type:i.type,ownerId:i.ownerId,userId:i.userId,from:i.entry.from,timezoneOffset:i.entry&&i.entry.data?i.entry.data.TZ_OFFSET_FROM:null});i.close()}}}));if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="N"){r.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function e(){a.EntryManager.setMeetingStatus(i.entry,"Y").then(i.refreshMeetingStatus.bind(i))}}}))}if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Y"){r.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:t.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function e(){a.EntryManager.setMeetingStatus(i.entry,"N").then(i.refreshMeetingStatus.bind(i))}}}))}if(!this.isNewEntry()&&this.canDo("edit")){r.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_EDIT"),className:"ui-btn ui-btn-link",events:{click:this.editEntryInSlider.bind(this)}}))}if(!this.isNewEntry()&&this.canDo("delete")){if(!this.entry.isMeeting()||!this.entry.getCurrentStatus()||this.entry.getCurrentStatus()==="H"){r.push(new BX.UI.Button({text:t.Loc.getMessage("CALENDAR_EVENT_DO_DELETE"),className:"ui-btn ui-btn-link",events:{click:function e(){n.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",function(){i.checkDataBeforeCloseMode=false;i.close()});a.EntryManager.deleteEntry(i.entry);if(!i.entry.wasEverRecursive()){i.close()}}}}))}}}if(r.length>2){r[1].button.className="ui-btn ui-btn-light-border"}return r}},{key:"freezePopup",value:function e(){if(this.popup){this.popup.buttons.forEach(function(e){var t;if((e===null||e===void 0?void 0:(t=e.options)===null||t===void 0?void 0:t.name)==="save"){e.setClocking(true)}else{e.setDisabled(true)}})}}},{key:"unfreezePopup",value:function e(){if(this.popup){this.popup.buttons.forEach(function(e){e.setClocking(false);e.setDisabled(false)})}}},{key:"refreshMeetingStatus",value:function e(){this.emit("doRefresh");this.popup.setButtons(this.getButtons());if(this.userPlannerSelector){this.userPlannerSelector.displayAttendees(this.entry.getAttendees())}}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader);this.DOM.loader=null}}},{key:"showInEditMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(N.EDIT_MODE,t)}},{key:"showInViewMode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(N.VIEW_MODE,t)}},{key:"setMode",value:function e(t){if(t==="edit"||t==="view"){this.mode=t}}},{key:"getMode",value:function e(){return this.mode}},{key:"checkForChangesImmediately",value:function e(){if(!this.isNewEntry()&&this.getMode()===N.VIEW_MODE&&this.formDataChanged()){this.setMode(N.EDIT_MODE);this.popup.setButtons(this.getButtons())}else if(!this.isNewEntry()&&this.getMode()===N.EDIT_MODE&&!this.formDataChanged()){this.setMode(N.VIEW_MODE);this.popup.setButtons(this.getButtons())}this.emitOnChange()}},{key:"updateSetMeetingButtons",value:function e(){var t=this.getCurrentEntry();if(t.isMeeting());}},{key:"getformDataChanges",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=this.entry;var i=[];if(!t.includes("name")&&n.name!==this.DOM.titleInput.value){i.push("name")}if(!t.includes("location")&&this.locationSelector.getTextLocation(s.Location.parseStringValue(n.getLocation()))!==this.locationSelector.getTextLocation(s.Location.parseStringValue(this.locationSelector.getTextValue()))){i.push("location")}var r=this.dateTimeControl.getValue();if(!t.includes("date&time")&&(n.isFullDay()!==r.fullDay||r.from.toString()!==n.from.toString()||r.to.toString()!==n.to.toString())){i.push("date&time")}if(!t.includes("notify")&&(!n.isMeeting()||n.getMeetingNotify())!==this.userPlannerSelector.getInformValue()){i.push("notify")}if(!t.includes("section")&&parseInt(n.sectionId)!==parseInt(this.sectionValue)){i.push("section")}if(!t.includes("codes")&&this.userPlannerSelector.getEntityList().map(function(e){return e.entityId+":"+e.id}).join("|")!==n.getAttendeesEntityList().map(function(e){return e.entityId+":"+e.id}).join("|")){i.push("codes")}return i}},{key:"formDataChanged",value:function e(){return this.getformDataChanges().length>0}},{key:"setParams",value:function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.userId=n.userId||i.Util.getCurrentUserId();this.type=n.type||"user";this.ownerId=n.ownerId?n.ownerId:0;if(this.type==="user"&&!this.ownerId){this.ownerId=this.userId}this.entry=a.EntryManager.getEntryInstance(n.entry,n.userIndex,{type:this.type,ownerId:this.ownerId});this.sectionValue=null;if(!this.entry.id&&t.Type.isPlainObject(n.entryTime)&&t.Type.isDate(n.entryTime.from)&&t.Type.isDate(n.entryTime.to)){this.entry.setDateTimeValue(n.entryTime)}if(t.Type.isPlainObject(n.userSettings)){this.userSettings=n.userSettings}this.locationFeatureEnabled=!!n.locationFeatureEnabled;this.locationList=n.locationList||[];this.iblockMeetingRoomList=n.iblockMeetingRoomList||[];this.setSections(n.sections,n.trackingUserList)}},{key:"setSections",value:function e(n){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];this.sections=n;this.sectionIndex={};this.trackingUsersList=r||[];if(t.Type.isArray(n)){n.forEach(function(e,t){var n=parseInt(e.ID||e.id);if(n>0){i.sectionIndex[n]=t}},this)}}},{key:"prepareData",value:function e(){var t=this;return new Promise(function(e){var n=t.getCurrentSection();if(n&&n.canDo){e()}else{t.BX.ajax.runAction("calendar.api.calendarajax.getCompactFormData",{data:{entryId:t.entry.id,loadSectionId:t.entry.sectionId}}).then(function(n){if(n&&n.data&&n.data.section){t.sections.push(new window.BXEventCalendar.Section(i.Util.getCalendarContext(),n.data.section));t.setSections(t.sections);e()}})}})}},{key:"getTitleControl",value:function e(){this.DOM.titleInput=t.Tag.render(w(),t.Loc.getMessage("EC_ENTRY_NAME"));t.Event.bind(this.DOM.titleInput,"keyup",this.checkForChanges);t.Event.bind(this.DOM.titleInput,"change",this.checkForChanges);return this.DOM.titleInput}},{key:"getColorControl",value:function e(){var i=this;this.DOM.colorSelect=t.Tag.render(O());this.colorSelector=new s.ColorSelector({wrap:this.DOM.colorSelect,mode:"selector"});this.colorSelector.subscribe("onChange",function(e){if(e instanceof n.BaseEvent){var t=e.getData().value;if(!i.isNewEntry()&&(i.canDo("edit")||i.entry.getCurrentStatus()!==false)){i.BX.ajax.runAction("calendar.api.calendarajax.updateColor",{data:{entryId:i.entry.id,userId:i.userId,color:t}});i.entry.data.COLOR=t;i.emit("doRefresh");i.emitOnChange()}}});return this.DOM.colorSelect}},{key:"getSectionControl",value:function e(){var n=this;this.DOM.sectionSelectWrap=t.Tag.render(S());this.sectionSelector=new s.SectionSelector({outerWrap:this.DOM.sectionSelectWrap,defaultCalendarType:this.type,defaultOwnerId:this.ownerId,sectionList:this.sections,sectionGroupList:o.SectionManager.getSectionGroupList({type:this.type,ownerId:this.ownerId,userId:this.userId,trackingUsersList:this.trackingUsersList}),mode:"textselect",zIndex:this.zIndex,getCurrentSection:function e(){var t=n.getCurrentSection();if(t){return{id:t.id,name:t.name,color:t.color}}return false},selectCallback:function e(t){if(t){if(n.colorSelector){n.colorSelector.setValue(t.color)}n.sectionValue=t.id;n.checkForChanges();o.SectionManager.saveDefaultSectionId(n.sectionValue)}}});return this.DOM.sectionSelectWrap}},{key:"getDateTimeControl",value:function e(){var i=this;this.DOM.dateTimeWrap=t.Tag.render(T());this.dateTimeControl=new s.DateTimeControl(null,{showTimezone:false,outerWrap:this.DOM.dateTimeWrap,inlineEditMode:true});this.dateTimeControl.subscribe("onChange",function(e){if(e instanceof n.BaseEvent){var t=e.getData().value;if(i.remindersControl){i.remindersControl.setFullDayMode(t.fullDay);if(i.isNewEntry()&&!i.remindersControl.wasChangedByUser()){var r=a.EntryManager.getNewEntryReminders(t.fullDay?"fullDay":"withTime");i.remindersControl.setValue(r,false)}}if(i.userPlannerSelector){if(!i.userPlannerSelector.isPlannerDisplayed()){i.userPlannerSelector.showPlanner()}i.userPlannerSelector.setLocationValue(i.locationSelector.getTextValue());i.userPlannerSelector.setDateTime(t,true);i.userPlannerSelector.refreshPlanner()}i.checkForChanges()}});return this.DOM.dateTimeWrap}},{key:"getUserPlannerSelector",value:function e(){this.DOM.userPlannerSelectorOuterWrap=t.Tag.render(I(),this.DOM.userSelectorWrap=t.Tag.render(C(),t.Loc.getMessage("EC_ATTENDEES_MORE"),t.Loc.getMessage("EC_SEC_SLIDER_CHANGE")),this.DOM.informWrap=t.Tag.render(b(),t.Loc.getMessage("EC_NOTIFY_OPTION")),this.DOM.plannerOuterWrap=t.Tag.render(M()),this.DOM.hideGuestsWrap=t.Tag.render(D(),t.Loc.getMessage("EC_HIDE_GUEST_NAMES"),t.Loc.getMessage("EC_HIDE_GUEST_NAMES_HINT")));this.userPlannerSelector=new s.UserPlannerSelector({outerWrap:this.DOM.userPlannerSelectorOuterWrap,wrap:this.DOM.userSelectorWrap,informWrap:this.DOM.informWrap,plannerOuterWrap:this.DOM.plannerOuterWrap,hideGuestsWrap:this.DOM.hideGuestsWrap,readOnlyMode:false,userId:this.userId,type:this.type,ownerId:this.ownerId,zIndex:this.zIndex+10});this.userPlannerSelector.subscribe("onDateChange",this.handlePlannerSelectorChanges.bind(this));this.userPlannerSelector.subscribe("onNotifyChange",this.checkForChanges);this.userPlannerSelector.subscribe("onUserCodesChange",this.checkForChanges);return this.DOM.userPlannerSelectorOuterWrap}},{key:"getLocationControl",value:function e(){var n=this;this.DOM.locationWrap=t.Tag.render(E());this.DOM.locationOuterWrap=t.Tag.render(v(),t.Loc.getMessage("EC_LOCATION_LABEL"),this.DOM.locationWrap);this.locationSelector=new s.Location({wrap:this.DOM.locationWrap,richLocationEnabled:this.locationFeatureEnabled,locationList:this.locationList||[],iblockMeetingRoomList:this.iblockMeetingRoomList||[],inlineEditModeEnabled:true,onChangeCallback:function e(){if(n.userPlannerSelector){n.userPlannerSelector.setLocationValue(n.locationSelector.getTextValue());if(n.locationSelector.getValue().type!==undefined&&!n.userPlannerSelector.isPlannerDisplayed()){n.userPlannerSelector.showPlanner()}n.userPlannerSelector.refreshPlanner()}n.checkForChanges()}});return this.DOM.locationOuterWrap}},{key:"createRemindersControl",value:function e(){var i=this;this.reminderValues=[];this.DOM.remindersWrap=t.Tag.render(m());this.remindersControl=new s.Reminder({wrap:this.DOM.remindersWrap,zIndex:this.zIndex});this.remindersControl.subscribe("onChange",function(e){if(e instanceof n.BaseEvent){i.reminderValues=e.getData().values;if(!i.isNewEntry()&&(i.canDo("edit")||i.entry.getCurrentStatus()!==false)){i.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:i.entry.id,userId:i.userId,reminders:i.reminderValues}}).then(function(e){i.entry.data.REMIND=e.data.REMIND})}}});return this.DOM.remindersWrap}},{key:"getTypeInfoControl",value:function e(){this.DOM.typeInfoTitle=t.Tag.render(y());this.DOM.typeInfoLink=t.Tag.render(g());this.DOM.typeInfoWrap=t.Tag.render(p(),this.DOM.typeInfoTitle,this.DOM.typeInfoLink);return this.DOM.typeInfoWrap}},{key:"getRRuleInfoControl",value:function e(){this.DOM.rruleInfo=t.Tag.render(f());this.DOM.rruleInfoWrap=t.Tag.render(h(),t.Loc.getMessage("EC_REPEAT"),this.DOM.rruleInfo);return this.DOM.rruleInfoWrap}},{key:"getTimezoneInfoControl",value:function e(){this.DOM.timezoneInfo=t.Tag.render(c());this.DOM.timezoneInfoWrap=t.Tag.render(d(),t.Loc.getMessage("EC_TIMEZONE"),this.DOM.timezoneInfo);return this.DOM.timezoneInfoWrap}},{key:"isNewEntry",value:function e(){return!this.entry.id}},{key:"canDo",value:function e(t){var n=this.getCurrentSection();if(t==="edit"||t==="delete"){if(this.entry.isMeeting()&&this.entry.id!==this.entry.parentId){return false}if(this.entry.isResourcebooking()){return false}return n.canDo("edit")}if(t==="view"){return n.canDo("view_time")}if(t==="viewFull"){return n.canDo("view_full")}return true}},{key:"setFormValues",value:function e(){var n=this.entry,r=this.getCurrentSection(),s=!this.canDo("edit");this.dateTimeControl.setValue({from:i.Util.adjustDateForTimezoneOffset(n.from,n.userTimezoneOffsetFrom,n.fullDay),to:i.Util.adjustDateForTimezoneOffset(n.to,n.userTimezoneOffsetTo,n.fullDay),fullDay:n.fullDay,timezoneFrom:n.getTimezoneFrom()||"",timezoneTo:n.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.dateTimeControl.setInlineEditMode(this.isNewEntry()?"edit":"view");this.dateTimeControl.setViewMode(s);this.DOM.titleInput.value=n.getName();if(s){if(this.entry.getCurrentStatus()===false){this.DOM.titleInput.type="hidden";this.DOM.titleLabel=this.DOM.titleInput.parentNode.insertBefore(t.Tag.render(u(),t.Text.encode(n.getName())),this.DOM.titleInput);t.Dom.addClass(this.DOM.titleOuterWrap,"calendar-field-container-view")}else{this.DOM.titleInput.disabled=true}}this.colorSelector.setValue(n.getColor()||r.color,false);this.colorSelector.setViewMode(s&&this.entry.getCurrentStatus()===false);this.sectionValue=this.getCurrentSectionId();this.sectionSelector.updateValue();this.sectionSelector.setViewMode(s);this.remindersControl.setValue(n.getReminders(),false);this.remindersControl.setViewMode(s&&this.entry.getCurrentStatus()===false);if(s&&this.entry.getCurrentStatus()===false){this.DOM.remindersOuterWrap.style.display="none"}if(n.isRecursive()){this.DOM.rruleInfoWrap.style="";t.Dom.adjust(this.DOM.rruleInfo,{text:n.getRRuleDescription()})}var a=n.getLocation();if(s&&!a){this.DOM.locationOuterWrap.style.display="none"}else{this.DOM.locationOuterWrap.style.display="";this.locationSelector.setValue(n.getLocation())}if(this.userPlannerSelector&&(this.canDo("viewFull")||n.getCurrentStatus()!==false)){this.userPlannerSelector.setValue({attendeesEntityList:n.getAttendeesEntityList(),location:a,attendees:n.getAttendees(),notify:!n.isMeeting()||n.getMeetingNotify(),viewMode:this.getMode()===N.VIEW_MODE,entry:n,hideGuests:n.getHideGuests()});this.userPlannerSelector.setDateTime(this.dateTimeControl.getValue());this.userPlannerSelector.setViewMode(s)}else{t.Dom.remove(this.DOM.userPlannerSelectorOuterWrap)}this.updateSetMeetingButtons();var o=true;this.DOM.infoContainer=this.DOM.wrap.querySelector(".calendar-field-container-info");for(var l=0;l<=this.DOM.infoContainer.childNodes.length;l++){if(t.Type.isElementNode(this.DOM.infoContainer.childNodes[l])&&this.DOM.infoContainer.childNodes[l].style.display!=="none"){o=false}}if(o){this.DOM.infoContainer.style.display="none"}}},{key:"save",value:function e(){var r=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.state===this.STATE.REQUEST)return false;var o=this.getCurrentEntry();s=t.Type.isPlainObject(s)?s:{};if(this.isNewEntry()&&this.userPlannerSelector.hasExternalEmailUsers()&&i.Util.checkEmailLimitationPopup()&&!s.emailLimitationDialogShown){a.EntryManager.showEmailLimitationDialog({callback:function e(t){s.emailLimitationDialogShown=true;r.save(s)}});return false}if(!this.userSettings.sendFromEmail&&this.userPlannerSelector.hasExternalEmailUsers()){a.EntryManager.showConfirmedEmailDialog({callback:function e(t){r.save(s)}});return false}if(!this.isNewEntry()&&o.isRecursive()&&!s.confirmed&&this.getformDataChanges(["section","notify"]).length>0){a.EntryManager.showConfirmEditDialog({callback:function e(t){s.recursionMode=t.recursionMode;s.confirmed=true;r.save(s)}});return false}if(!this.isNewEntry()&&o.isMeeting()&&s.sendInvitesAgain===undefined&&this.getformDataChanges().includes("date&time")&&o.getAttendees().find(function(e){return e.STATUS==="N"})){a.EntryManager.showReInviteUsersDialog({callback:function e(t){s.sendInvitesAgain=t.sendInvitesAgain;r.save(s)}});return false}var u=this.dateTimeControl.getValue();var d={id:o.id,section:this.sectionValue,name:this.DOM.titleInput.value,desc:o.getDescription(),reminder:this.remindersControl.getSelectedValues(),date_from:u.fromDate,date_to:u.toDate,skip_time:u.fullDay?"Y":"N",time_from:i.Util.formatTime(i.Util.adjustDateForTimezoneOffset(u.from,-o.userTimezoneOffsetFrom,u.fullDay)),time_to:i.Util.formatTime(i.Util.adjustDateForTimezoneOffset(u.to,-o.userTimezoneOffsetTo,u.fullDay)),location:this.locationSelector.getTextValue(),tz_from:o.getTimezoneFrom(),tz_to:o.getTimezoneTo(),meeting_notify:this.userPlannerSelector.getInformValue()?"Y":"N",exclude_users:this.excludeUsers||[],attendeesEntityList:this.userPlannerSelector.getEntityList(),sendInvitesAgain:s.sendInvitesAgain?"Y":"N",hide_guests:this.userPlannerSelector.hideGuests?"Y":"N",requestUid:BX.Calendar.Util.registerRequestId()};if(o.id&&o.isRecursive()){d.EVENT_RRULE=o.data.RRULE}if(s.recursionMode){d.rec_edit_mode=s.recursionMode;d.current_date_from=i.Util.formatDate(o.from)}if(this.getCurrentSection().color.toLowerCase()!==this.colorSelector.getValue().toLowerCase()){d.color=this.colorSelector.getValue()}this.state=this.STATE.REQUEST;this.freezePopup();this.BX.ajax.runAction("calendar.api.calendarajax.editEntry",{data:d,analyticsLabel:{calendarAction:this.isNewEntry()?"create_event":"edit_event",formType:"compact",emailGuests:this.userPlannerSelector.hasExternalEmailUsers()?"Y":"N",markView:i.Util.getCurrentView()||"outside",markCrm:"N",markRrule:"NONE",markMeeting:this.entry.isMeeting()?"Y":"N",markType:this.type}}).then(function(e){r.unfreezePopup();r.state=r.STATE.READY;if(e.data.entryId){if(o.id){a.EntryManager.showEditEntryNotification(e.data.entryId)}else{a.EntryManager.showNewEntryNotification(e.data.entryId)}}r.emit("onSave",new n.BaseEvent({data:{responseData:e.data,options:s}}));r.close();if(e.data.displayMobileBanner){(new l.MobileSyncBanner).showInPopup()}if(e.data.countEventWithEmailGuestAmount){i.Util.setEventWithEmailGuestAmount(e.data.countEventWithEmailGuestAmount)}if(t.Type.isArray(e.data.eventList)&&e.data.eventList.length&&e.data.eventList[0].REMIND&&e.data.eventList[0].REMIND.length){a.EntryManager.setNewEntryReminders(u.fullDay?"fullDay":"withTime",e.data.eventList[0].REMIND)}},function(e){r.unfreezePopup();if(e.data&&t.Type.isPlainObject(e.data.busyUsersList)){r.handleBusyUsersError(e.data.busyUsersList);var n=[];e.errors.forEach(function(e){if(e.code!=="edit_entry_user_busy"){n.push(e)}});e.errors=n}if(e.errors&&e.errors.length){r.showError(e.errors)}r.state=r.STATE.ERROR});return true}},{key:"handleBusyUsersError",value:function e(t){var n=this;var i=[],r=[];for(var a in t){if(t.hasOwnProperty(a)){i.push(t[a]);r.push(a)}}this.busyUsersDialog=new s.BusyUsersDialog;this.busyUsersDialog.subscribe("onSaveWithout",function(){n.excludeUsers=r.join(",");n.save()});this.busyUsersDialog.show({users:i})}},{key:"handleKeyPress",value:function e(r){var s=this;if(this.getMode()===N.EDIT_MODE&&r.keyCode===i.Util.getKeyCode("enter")){this.save()}else if(r.keyCode===i.Util.getKeyCode("escape")&&this.couldBeClosedByEsc()){this.close()}else if(r.keyCode===i.Util.getKeyCode("delete")&&!this.isNewEntry()&&this.canDo("delete")){var o=event.target||event.srcElement;var l=t.Type.isElementNode(o)?o.tagName.toLowerCase():null;if(l&&!["input","textarea"].includes(l)){n.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",function(){s.checkDataBeforeCloseMode=false;s.close()});a.EntryManager.deleteEntry(this.entry)}}}},{key:"getCurrentEntry",value:function e(){return this.entry}},{key:"getCurrentSection",value:function e(){var t=false;var n=this.getCurrentSectionId();if(n&&this.sectionIndex[n]!==undefined&&this.sections[this.sectionIndex[n]]!==undefined){t=this.sections[this.sectionIndex[n]]}return t}},{key:"getCurrentSectionId",value:function e(){var t=0;if(this.sectionValue){t=this.sectionValue}else{var n=this.getCurrentEntry();if(n instanceof a.Entry){t=parseInt(n.sectionId)}if(!t&&this.sections[0]){t=parseInt(this.sections[0].id)}}return t}},{key:"handlePlannerSelectorChanges",value:function e(t){if(t instanceof n.BaseEvent){var i=this.dateTimeControl.getValue();i.from=t.getData().dateFrom;i.to=t.getData().dateTo;this.dateTimeControl.setValue(i);this.userPlannerSelector.setDateTime(this.dateTimeControl.getValue())}}},{key:"editEntryInSlider",value:function e(){this.checkDataBeforeCloseMode=false;var t=this.dateTimeControl.getValue();BX.Calendar.EntryManager.openEditSlider({entry:this.entry,type:this.type,ownerId:this.ownerId,userId:this.userId,formDataValue:{section:this.sectionValue,name:this.DOM.titleInput.value,reminder:this.remindersControl.getSelectedRawValues(),color:this.colorSelector.getValue(),from:i.Util.adjustDateForTimezoneOffset(t.from,-this.entry.userTimezoneOffsetFrom,t.fullDay),to:i.Util.adjustDateForTimezoneOffset(t.to,-this.entry.userTimezoneOffsetTo,t.fullDay),fullDay:t.fullDay,location:this.locationSelector.getTextValue(),meetingNotify:this.userPlannerSelector.getInformValue()?"Y":"N",hideGuests:this.userPlannerSelector.hideGuests?"Y":"N",attendeesEntityList:this.userPlannerSelector.getEntityList()}});this.close()}},{key:"outsideMouseDownClose",value:function e(t){var n=t.target||t.srcElement;this.outsideMouseDown=!n.closest("div.popup-window")}},{key:"checkOutsideClickClose",value:function e(t){var n=t.target||t.srcElement;this.outsideMouseUp=!n.closest("div.popup-window");if(this.couldBeClosedByEsc()&&this.outsideMouseDown&&this.outsideMouseUp&&(this.getMode()===N.VIEW_MODE||!this.formDataChanged()||this.isNewEntry())){setTimeout(this.close.bind(this),0)}}},{key:"couldBeClosedByEsc",value:function e(){var t=this;return!r.PopupManager._popups.find(function(e){return e&&e.getId()!==t.popupId&&e.isShown()})}},{key:"emitOnChange",value:function e(){this.emit("onChange",new n.BaseEvent({data:{form:this,entry:this.entry}}))}},{key:"showError",value:function e(n){var i="";if(t.Type.isArray(n)){n.forEach(function(e){i+=e.message+"\n"})}if(i!==""){alert(i)}}},{key:"reloadEntryData",value:function e(){if(this.isShown()&&!this.isNewEntry()&&this.getMode()===N.VIEW_MODE){var t=i.Util.getCalendarContext();if(t){this.entry=a.EntryManager.getEntryInstance(t.getView().getEntryById(this.entry.getUniqueId()));this.setFormValues()}}}}]);return N}(n.EventEmitter);babelHelpers.defineProperty(N,"VIEW_MODE","view");babelHelpers.defineProperty(N,"EDIT_MODE","edit");e.CompactEventForm=N})(this.BX.Calendar=this.BX.Calendar||{},BX,BX.Event,BX.Calendar,BX.Main,BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar.Sync.Interface);
//# sourceMappingURL=compacteventform.bundle.map.js