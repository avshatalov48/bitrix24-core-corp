this.BX=this.BX||{};(function(e,t,s,i,a,n){"use strict";var r,o,c,l;var d=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"isCreated",false);e.setEventNamespace("BX.Calendar.SectionInterface.EditForm");e.DOM.outerWrap=s.wrap;e.sectionAccessTasks=s.sectionAccessTasks;e.sectionManager=s.sectionManager;e.closeCallback=s.closeCallback;e.BX=n.Util.getBX();e.keyHandlerBinded=e.keyHandler.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.section=t.section;this.create();this.showAccess=t.showAccess!==false;if(this.showAccess){this.DOM.accessLink.style.display="";this.DOM.accessWrap.style.display=""}else{this.DOM.accessLink.style.display="none";this.DOM.accessWrap.style.display="none"}a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(t.section){if(t.section.color){this.setColor(t.section.color)}this.setAccess(t.section.access||t.section.data.ACCESS||{});if(t.section.name){this.DOM.sectionTitleInput.value=t.section.name}}BX.focus(this.DOM.sectionTitleInput);if(this.DOM.sectionTitleInput.value!==""){this.DOM.sectionTitleInput.select()}this.isOpenedState=true}},{key:"close",value:function e(){this.isOpenedState=false;a.Event.unbind(document,"keydown",this.keyHandlerBinded);a.Dom.removeClass(this.DOM.outerWrap,"show");if(a.Type.isFunction(this.closeCallback)){this.closeCallback()}}},{key:"isOpened",value:function e(){return this.isOpenedState}},{key:"create",value:function e(){this.wrap=this.DOM.outerWrap.querySelector(".calendar-form-content");if(this.wrap){a.Dom.clean(this.wrap)}else{this.wrap=this.DOM.outerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-form-content"}}))}this.DOM.formFieldsWrap=this.wrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}}));this.DOM.sectionTitleInput=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(a.Dom.create("INPUT",{attrs:{type:"text",placeholder:a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE")},props:{className:"calendar-field calendar-field-string"}}));this.DOM.optionsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.initSectionColorSelector();this.initAccessController();this.buttonsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.save.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap);new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(this.buttonsWrap);this.isCreated=true}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.checkClose()}else if(t.keyCode===n.Util.getKeyCode("enter")){this.save()}}},{key:"checkClose",value:function e(){this.close()}},{key:"save",value:function e(){var t=this;this.saveBtn.setWaiting(true);this.sectionManager.saveSection(this.DOM.sectionTitleInput.value,this.color,this.access,{section:this.section}).then((function(){t.saveBtn.setWaiting(false);t.close()}))}},{key:"initSectionColorSelector",value:function e(){this.DOM.colorContWrap=this.DOM.optionsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-color"},html:a.Loc.getMessage("EC_SEC_SLIDER_COLOR")}));this.colorIcon=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-selected"}}));this.colorChangeLink=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-change"},html:a.Loc.getMessage("EC_SEC_SLIDER_CHANGE")}));a.Event.bind(this.colorIcon,"click",this.showSimplePicker.bind(this));a.Event.bind(this.colorChangeLink,"click",this.showSimplePicker.bind(this))}},{key:"showSimplePicker",value:function e(t){var s=a.Runtime.clone(n.Util.getDefaultColorList(),true);var i=a.Dom.create("DIV",{props:{className:"calendar-simple-color-wrap calendar-field-container-colorpicker-square"}});var r=i.appendChild(a.Dom.create("DIV",{events:{click:BX.delegate(this.simplePickerClick,this)}}));var o=i.appendChild(a.Dom.create("DIV",{props:{className:"calendar-simple-color-more-link-wrap"}}));var c=o.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-simple-color-more-link"},html:a.Loc.getMessage("EC_COLOR"),events:{click:BX.delegate(this.showFullPicker,this)}}));this.simplePickerColorWrap=r;this.colors=[];if(!s.includes(this.color)){s.push(this.color)}for(var l=0;l<s.length;l++){this.colors.push({color:s[l],node:r.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:s[l]},attrs:{"data-bx-calendar-color":s[l]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.lastActiveNode=this.colors[BX.util.array_search(this.color,s)||0].node;a.Dom.addClass(this.lastActiveNode,"active");this.simpleColorPopup=BX.PopupWindowManager.create("simple-color-popup-"+n.Util.getRandomInt(),this.colorIcon,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:9,lightShadow:true,content:i,cacheable:false});this.simpleColorPopup.setAngle({offset:10});this.simpleColorPopup.show(true)}},{key:"simplePickerClick",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(a.Type.isElementNode(s)){var i=s.getAttribute("data-bx-calendar-color");if(i!==null){if(this.lastActiveNode){a.Dom.removeClass(this.lastActiveNode,"active")}a.Dom.addClass(s,"active");this.lastActiveNode=s;this.setColor(i)}}}},{key:"showFullPicker",value:function e(){if(this.simpleColorPopup){this.simpleColorPopup.close()}if(!this.fullColorPicker){this.fullColorPicker=new BX.ColorPicker({bindElement:this.colorIcon,onColorSelected:BX.delegate((function(e){this.setColor(e)}),this),popupOptions:{cacheable:false,zIndex:this.zIndex,events:{onPopupClose:BX.delegate((function(){}),this)}}})}this.fullColorPicker.open()}},{key:"setColor",value:function e(t){this.colorIcon.style.backgroundColor=t;this.color=t}},{key:"setAccess",value:function e(t){var s=0;for(var i in t){if(t.hasOwnProperty(i)){s++}}this.accessRowsCount=s;this.access=t;for(var a in t){if(t.hasOwnProperty(a)){this.insertAccessRow(n.Util.getAccessName(a),a,t[a])}}this.checkAccessTableHeight()}},{key:"initAccessController",value:function e(){this.buildAccessController();if(this.sectionManager&&this.sectionManager.calendarType==="group"){this.initDialogGroup()}else{this.initDialogStandard()}this.initAccessSelectorPopup()}},{key:"initAccessSelectorPopup",value:function e(){var t=this;a.Event.bind(this.DOM.accessWrap,"click",(function(e){var s=n.Util.findTargetNode(e.target||e.srcElement,t.DOM.outerWrap);if(a.Type.isElementNode(s)){if(s.getAttribute("data-bx-calendar-access-selector")!==null){var i=s.getAttribute("data-bx-calendar-access-selector");if(t.accessControls[i]){t.showAccessSelectorPopup({node:t.accessControls[i].removeIcon,setValueCallback:function e(s){if(t.accessTasks[s]&&t.accessControls[i]){t.accessControls[i].valueNode.innerHTML=a.Text.encode(t.accessTasks[s].title);t.access[i]=s}}})}}else if(s.getAttribute("data-bx-calendar-access-remove")!==null){var r=s.getAttribute("data-bx-calendar-access-remove");if(t.accessControls[r]){a.Dom.remove(t.accessControls[r].rowNode);t.accessControls[r]=null;delete t.access[r]}}}}))}},{key:"buildAccessController",value:function e(){var t=this;this.DOM.accessLink=this.DOM.optionsWrap.appendChild(a.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-new-calendar-option-more">',"</div>"])),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS")));this.DOM.accessWrap=this.DOM.formFieldsWrap.appendChild(a.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-access-container">\n\t\t\t\t\t<div class="calendar-list-slider-access-inner-wrap">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-list-slider-new-calendar-options-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"])),this.DOM.accessTable=a.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<table class="calendar-section-slider-access-table"></table>\n\t\t\t\t\t\t']))),this.DOM.accessButton=a.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="calendar-list-slider-new-calendar-option-add">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>"])),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS_ADD"))));this.accessControls={};this.accessTasks=this.sectionAccessTasks;a.Event.bind(this.DOM.accessLink,"click",(function(){if(a.Dom.hasClass(t.DOM.accessWrap,"shown")){a.Dom.removeClass(t.DOM.accessWrap,"shown")}else{a.Dom.addClass(t.DOM.accessWrap,"shown")}t.checkAccessTableHeight()}))}},{key:"initDialogStandard",value:function e(){var t=this;a.Event.bind(this.DOM.accessButton,"click",(function(){t.entitySelectorDialog=new i.Dialog({targetNode:t.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":t.handleEntitySelectorChanges.bind(t),"Item:onDeselect":t.handleEntitySelectorChanges.bind(t)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}]});t.entitySelectorDialog.show()}))}},{key:"initDialogGroup",value:function e(){var t=this;a.Event.bind(this.DOM.accessButton,"click",(function(){t.entitySelectorDialog=new i.Dialog({targetNode:t.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":t.handleEntitySelectorChanges.bind(t),"Item:onDeselect":t.handleEntitySelectorChanges.bind(t)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],tabs:[{id:"groupAccess",title:t.sectionManager.ownerName}],items:[{id:"SG"+t.sectionManager.ownerId+"_"+"A",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_ADMIN")},{id:"SG"+t.sectionManager.ownerId+"_"+"E",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MODERATORS")},{id:"SG"+t.sectionManager.ownerId+"_"+"K",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MEMBERS")}]});t.entitySelectorDialog.show()}))}},{key:"handleEntitySelectorChanges",value:function e(){var t=this;var s=this.entitySelectorDialog.getSelectedItems();this.entitySelectorDialog.hide();if(a.Type.isArray(s)){s.forEach((function(e){var s;if(e.entityId==="group"){s=t.sectionManager.ownerName+": "+e.title.text}else{s=e.title.text}var i=n.Util.convertEntityToAccessCode(e);n.Util.setAccessName(i,s);t.insertAccessRow(s,i)}))}a.Runtime.debounce((function(){t.entitySelectorDialog.destroy()}),400)()}},{key:"insertAccessRow",value:function e(t,s,i){if(!this.accessControls[s]){if(i===undefined){for(var n in this.sectionAccessTasks){if(this.sectionAccessTasks.hasOwnProperty(n)&&this.sectionAccessTasks[n].name==="calendar_view"){i=n;break}}}var r=a.Dom.adjust(this.DOM.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),o=a.Dom.adjust(r.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+a.Text.encode(t)+":</span>"}),c=a.Dom.adjust(r.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":s}}),l=c.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-container"}})),d=l.appendChild(a.Dom.create("SPAN",{text:this.accessTasks[i]?this.accessTasks[i].title:"",props:{className:"calendar-section-slider-access-value"}})),p=l.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":s}}));this.access[s]=i;this.accessControls[s]={rowNode:r,titleNode:o,valueNode:d,removeIcon:p}}}},{key:"checkAccessTableHeight",value:function e(){var t=this;if(this.checkTableTimeout){this.checkTableTimeout=clearTimeout(this.checkTableTimeout)}this.checkTableTimeout=setTimeout((function(){if(a.Dom.hasClass(t.DOM.accessWrap,"shown")){if(t.DOM.accessWrap.offsetHeight-t.DOM.accessTable.offsetHeight<36){t.DOM.accessWrap.style.maxHeight=parseInt(t.DOM.accessTable.offsetHeight)+100+"px"}}else{t.DOM.accessWrap.style.maxHeight=""}}),300)}},{key:"showAccessSelectorPopup",value:function e(t){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}var s=this;var i=[];for(var a in this.accessTasks){if(this.accessTasks.hasOwnProperty(a)){i.push({text:this.accessTasks[a].title,onclick:function(e){return function(){t.setValueCallback(e);s.accessPopupMenu.close()}}(a)})}}this.accessPopupMenu=this.BX.PopupMenu.create("section-access-popup"+n.Util.randomInt(),t.node,i,{closeByEsc:true,autoHide:true,offsetTop:-5,offsetLeft:0,angle:true,cacheable:false});this.accessPopupMenu.show()}}]);return t}(s.EventEmitter);var p,h,u,g,f,m,C,S,v;var b=function(){function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"DOM",{});babelHelpers.defineProperty(this,"isCreated",false);this.interfaceType="users";this.DOM.outerWrap=s.wrap;this.trackingUsers=s.trackingUsers||[];this.trackingUserIdList=this.trackingUsers.map((function(e){return parseInt(e.ID)}));this.CHECKED_CLASS="calendar-list-slider-item-checkbox-checked";this.selectorId="add-tracking"+n.Util.getRandomInt();this.closeCallback=s.closeCallback;this.superposedSections=a.Type.isArray(s.superposedSections)?s.superposedSections:[];this.selected={};this.superposedSections.forEach((function(e){t.selected[e.id]=true}),this);this.isCreated=false;this.keyHandlerBinded=this.keyHandler.bind(this)}babelHelpers.createClass(e,[{key:"show",value:function e(){if(!this.isCreated){this.create()}a.Dom.addClass(this.DOM.outerWrap,"show");this.checkInnerWrapHeight();a.Event.bind(document,"keydown",this.keyHandlerBinded);this.updateSectionList();this.firstTrackingUserIdList=a.Runtime.clone(this.trackingUserIdList);this.isOpenedState=true}},{key:"close",value:function e(){a.Event.unbind(document,"keydown",this.keyHandlerBinded);this.isOpenedState=false;a.Dom.removeClass(this.DOM.outerWrap,"show");this.DOM.outerWrap.style.cssText="";if(a.Type.isFunction(this.closeCallback)){this.closeCallback()}}},{key:"isOpened",value:function e(){return this.isOpenedState}},{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(["<div></div>"]))))}this.selectorWrap=this.DOM.innerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-selector-wrap"}}));this.userTagSelector=new i.TagSelector({dialogOptions:{context:"CALENDAR",preselectedItems:this.trackingUsers.map((function(e){return["user",parseInt(e.ID)]})),events:{"Item:onSelect":this.handleUserSelectorChanges.bind(this),"Item:onDeselect":this.handleUserSelectorChanges.bind(this)},entities:[{id:"user"}]}});this.userTagSelector.renderTo(this.selectorWrap);this.sectionsWrap=this.DOM.innerWrap.appendChild(a.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']))));this.createButtons();this.isCreated=true}},{key:"createButtons",value:function e(){this.DOM.innerWrap.appendChild(a.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-btn-container">\n\t\t\t\t<button \n\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-primary"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>','</button>\n\t\t\t\t<button \n\t\t\t\t\tclass="ui-btn ui-btn-link"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>',"</button>\n\t\t\t</div>"])),this.save.bind(this),a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),this.close.bind(this),a.Loc.getMessage("EC_SEC_SLIDER_CANCEL")))}},{key:"handleUserSelectorChanges",value:function e(){var t=this;var s=this.userTagSelector.getDialog().getSelectedItems();this.trackingUserIdList=[];s.forEach((function(e){if(e.entityId==="user"){t.trackingUserIdList.push(e.id)}}));this.updateSectionList()}},{key:"save",value:function e(){BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{userIdList:this.trackingUserIdList,sections:this.prepareTrackingSections(),type:this.interfaceType}}).then((function(e){location.reload()}),(function(e){n.Util.displayError(e.errors)}));this.close()}},{key:"prepareTrackingSections",value:function e(){var t=this;var s=[];this.superposedSections.forEach((function(e){s.push(parseInt(e.id))}),this);var i=function e(i){if(t.sectionIndex.hasOwnProperty(i)&&t.sectionIndex[i].checkbox){if(a.Dom.hasClass(t.sectionIndex[i].checkbox,t.CHECKED_CLASS)){if(!s.includes(parseInt(i))){s.push(parseInt(i))}}else if(s.includes(parseInt(i))){s=s.filter((function(e){return parseInt(e)!==parseInt(i)}))}}};for(var n in this.sectionIndex){i(n)}return s}},{key:"updateSectionList",value:function e(t){var s=this;if(this.updateSectionLoader){a.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(a.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}if(t!==false){this.updateSectionTimeout=setTimeout((function(){s.updateSectionList(false)}),300);return}this.checkInnerWrapHeight();BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{userIdList:this.trackingUserIdList,type:"users"}}).then((function(e){a.Dom.clean(s.sectionsWrap);s.sectionIndex={};s.checkInnerWrapHeight();e.data.users.forEach((function(t){var i=e.data.sections.filter((function(e){return parseInt(e.OWNER_ID)===parseInt(t.ID)}));s.sectionsWrap.appendChild(a.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),a.Text.encode(t.FORMATTED_NAME)));if(i.length>0){s.createSectionBlock({sectionList:i,wrap:s.sectionsWrap})}else{s.sectionsWrap.appendChild(a.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_NO_SECTIONS")))}}))}),(function(e){n.Util.displayError(e.errors)}))}},{key:"createSectionBlock",value:function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=false;if(a.Type.isArray(s.sectionList)&&s.sectionList.length&&a.Type.isElementNode(s.wrap)){var n;s.wrap.appendChild(a.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-widget-content">\n\t\t\t\t\t<div class="calendar-list-slider-widget-content-block">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),n=a.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<ul class="calendar-list-slider-container"></ul>'])))));a.Event.bind(n,"click",this.sectionClick.bind(this));s.sectionList.forEach((function(e){var s=e.ID.toString();var i;var r=n.appendChild(a.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<li class="calendar-list-slider-item" data-bx-calendar-section="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="calendar-list-slider-item-name">',"</div>\n\t\t\t\t\t</li>\n\t\t\t\t"])),s,i=a.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="calendar-list-slider-item-checkbox" style="background: ','"></div>\n\t\t\t\t\t\t'])),e.COLOR),a.Text.encode(e.NAME)));t.sectionIndex[s]={item:r,checkbox:i};if(t.selected[s]||!a.Type.isArray(t.firstTrackingUserIdList)||!t.firstTrackingUserIdList.includes(parseInt(e.OWNER_ID))){a.Dom.addClass(i,t.CHECKED_CLASS)}}))}return i}},{key:"sectionClick",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(a.Type.isElementNode(s)){if(s.getAttribute("data-bx-calendar-section")!==null){var i=s.getAttribute("data-bx-calendar-section");if(this.sectionIndex[i]&&this.sectionIndex[i].checkbox){if(a.Dom.hasClass(this.sectionIndex[i].checkbox,this.CHECKED_CLASS)){a.Dom.removeClass(this.sectionIndex[i].checkbox,this.CHECKED_CLASS)}else{a.Dom.addClass(this.sectionIndex[i].checkbox,this.CHECKED_CLASS)}}}}}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.close()}else if(t.keyCode===n.Util.getKeyCode("enter")){this.save()}}},{key:"checkInnerWrapHeight",value:function e(){var t=this;if(this.checkHeightTimeout){this.checkHeightTimeout=clearTimeout(this.checkHeightTimeout)}this.checkHeightTimeout=setTimeout((function(){if(a.Dom.hasClass(t.DOM.outerWrap,"show")){if(t.DOM.outerWrap.offsetHeight-t.DOM.innerWrap.offsetHeight<36){t.DOM.outerWrap.style.maxHeight=parseInt(t.DOM.innerWrap.offsetHeight)+200+"px"}}else{t.DOM.outerWrap.style.maxHeight=""}}),300)}}]);return e}();var D,k;var E=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.interfaceType="groups";e.trackingGroupIdList=s.trackingGroups||[];return e}babelHelpers.createClass(t,[{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(a.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(["<div></div>"]))))}this.selectorWrap=this.DOM.innerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-selector-wrap"}}));this.groupTagSelector=new i.TagSelector({dialogOptions:{context:"CALENDAR",preselectedItems:this.trackingGroupIdList.map((function(e){return["project",e]})),events:{"Item:onSelect":this.handleGroupSelectorChanges.bind(this),"Item:onDeselect":this.handleGroupSelectorChanges.bind(this)},entities:[{id:"project"}]}});this.groupTagSelector.renderTo(this.selectorWrap);this.sectionsWrap=this.DOM.innerWrap.appendChild(a.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']))));this.createButtons();this.isCreated=true}},{key:"handleGroupSelectorChanges",value:function e(){var t=this;var s=this.groupTagSelector.getDialog().getSelectedItems();this.trackingGroupIdList=[];s.forEach((function(e){if(e.entityId==="project"){t.trackingGroupIdList.push(e.id)}}));this.updateSectionList()}},{key:"updateSectionList",value:function e(){var t=this;if(this.updateSectionLoader){a.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(a.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}this.checkInnerWrapHeight();BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{groupIdList:this.trackingGroupIdList,type:"groups"}}).then((function(e){a.Dom.clean(t.sectionsWrap);t.sectionIndex={};t.checkInnerWrapHeight();t.createSectionBlock({sectionList:e.data.sections,wrap:t.sectionsWrap})}),(function(e){n.Util.displayError(e.errors)}))}}]);return t}(b);var y,M,T;var I=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.trackingGroups=s.trackingGroups||[];e.selectGroups=true;e.selectUsers=false;e.addLinkMessage=a.Loc.getMessage("EC_SEC_SLIDER_SELECT_GROUPS");return e}babelHelpers.createClass(t,[{key:"show",value:function e(){if(!this.isCreated){this.create()}this.updateSectionList();this.isOpenedState=true;a.Dom.addClass(this.DOM.outerWrap,"show")}},{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(a.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(["<div></div>"]))))}this.sectionsWrap=this.DOM.innerWrap.appendChild(a.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']))));this.createButtons();this.isCreated=true}},{key:"updateSectionList",value:function e(){var t=this;if(this.updateSectionLoader){a.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(a.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{type:"company"}}).then((function(e){a.Dom.clean(t.sectionsWrap);t.sectionIndex={};t.checkInnerWrapHeight();if(a.Type.isArray(e.data.sections)&&e.data.sections.length){t.createSectionBlock({sectionList:e.data.sections,wrap:t.sectionsWrap})}else{t.sectionsWrap.appendChild(a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_NO_SECTIONS")))}}),(function(e){n.Util.displayError(e.errors)}));this.checkInnerWrapHeight()}},{key:"save",value:function e(){BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{sections:this.prepareTrackingSections()}}).then((function(e){location.reload()}),(function(e){n.Util.displayError(e.errors)}));this.close()}}]);return t}(b);var L,O,_,w,A,x;function B(e,t){var s=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=N(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var i=0;var a=function e(){};return{s:a,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,r=false,o;return{s:function t(){s=s.call(e)},n:function e(){var t=s.next();n=t.done;return t},e:function e(t){r=true;o=t},f:function e(){try{if(!n&&s["return"]!=null)s["return"]()}finally{if(r)throw o}}}}function N(e,t){if(!e)return;if(typeof e==="string")return H(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return H(e,t)}function H(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,i=new Array(t);s<t;s++){i[s]=e[s]}return i}var W=function(e){babelHelpers.inherits(s,e);function s(e){var t;var i=e.calendarContext,a=e.readonly,r=e.sectionManager;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"name","sectioninterface");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"uid",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"SLIDER_WIDTH",400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"SLIDER_DURATION",80);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"sliderId","calendar:section-slider");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"denyClose",false);t.setEventNamespace("BX.Calendar.SectionInterface");t.sectionManager=r;t.calendarContext=i;t.readonly=a;t.BX=n.Util.getBX();t.deleteSectionHandlerBinded=t.deleteSectionHandler.bind(babelHelpers.assertThisInitialized(t));t.refreshSectionListBinded=t.refreshSectionList.bind(babelHelpers.assertThisInitialized(t));if(t.calendarContext!==null){if(t.calendarContext.util.config.accessNames){var o,c,l;n.Util.setAccessNames((o=t.calendarContext)===null||o===void 0?void 0:(c=o.util)===null||c===void 0?void 0:(l=c.config)===null||l===void 0?void 0:l.accessNames)}}return t}babelHelpers.createClass(s,[{key:"show",value:function e(){this.BX.SidePanel.Instance.open(this.sliderId,{contentCallback:this.createContent.bind(this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION,events:{onCloseByEsc:this.escHide.bind(this),onClose:this.hide.bind(this),onCloseComplete:this.destroy.bind(this),onLoad:this.onLoadSlider.bind(this)}});this.addEventEmitterSubscriptions()}},{key:"addEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:edit",this.refreshSectionListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:pull-edit",this.refreshSectionListBinded)}},{key:"destroyEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:edit",this.refreshSectionListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-edit",this.refreshSectionListBinded)}},{key:"escHide",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId&&this.denyClose){t.denyAction()}}},{key:"hide",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){this.closeForms();this.destroyEventEmitterSubscriptions()}}},{key:"close",value:function e(){BX.SidePanel.Instance.close()}},{key:"destroy",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){this.destroyEventEmitterSubscriptions();n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);delete this.DOM.sectionListWrap;if(this.sectionActionMenu){this.sectionActionMenu.close()}if(this.trackingTypesForm){delete this.trackingTypesForm}if(this.trackingUsersForm){delete this.trackingUsersForm}if(this.trackingGroupsForm){delete this.trackingGroupsForm}}}},{key:"createContent",value:function e(){this.DOM.outerWrap=a.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-list-slider-wrap"></div>\n\t\t'])));this.DOM.titleWrap=this.DOM.outerWrap.appendChild(a.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-title-container">\n\t\t\t\t\t<div class="calendar-list-slider-title"> \n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),a.Loc.getMessage("EC_SECTION_BUTTON")));var t=this.calendarContext||n.Util.getCalendarContext();if(t&&!this.readonly){this.DOM.sectionFormWrap=this.DOM.outerWrap.appendChild(a.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_NEW_SECTION")))}if(t&&!this.readonly&&(!t.util.isUserCalendar()||t.util.userIsOwner())){this.createAddButton();this.DOM.trackingGroupsFormWrap=this.DOM.outerWrap.appendChild(a.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP")));this.DOM.trackingUsersFormWrap=this.DOM.outerWrap.appendChild(a.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_USER")));this.DOM.trackingTypesFormWrap=this.DOM.outerWrap.appendChild(a.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP")))}this.createSectionList();return this.DOM.outerWrap}},{key:"onLoadSlider",value:function e(t){this.slider=t.getSlider();this.sliderId=this.slider.getUrl();this.DOM.content=this.slider.layout.content}},{key:"createSectionList",value:function e(){var t=this;var s;this.sliderSections=this.sectionManager.getSections();var i=this.sectionManager.calendarType;if(i==="user"){s=a.Loc.getMessage("EC_SEC_SLIDER_MY_CALENDARS_LIST")}else if(i==="group"){s=a.Loc.getMessage("EC_SEC_SLIDER_GROUP_CALENDARS_LIST")}else{s=a.Loc.getMessage("EC_SEC_SLIDER_TYPE_CALENDARS_LIST")}if(this.DOM.sectionListWrap){a.Dom.clean(this.DOM.sectionListWrap);a.Dom.adjust(this.DOM.sectionListWrap,{props:{className:"calendar-list-slider-card-widget"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(s,"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")})}else{this.DOM.sectionListWrap=this.DOM.outerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-card-widget"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(s,"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")}))}this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:this.sliderSections.filter((function(e){return e.belongsToView()||e.isPseudo()}))});var n=this.sliderSections.filter((function(e){return e.isCompanyCalendar()&&!e.belongsToView()}));if(n.length>0){this.DOM.sectionListWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+a.Loc.getMessage("EC_SEC_SLIDER_TITLE_COMP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:this.sliderSections.filter((function(e){return e.isCompanyCalendar()}))})}this.calendarContext.util.getSuperposedTrackedUsers().forEach((function(e){var s=t.sliderSections.filter((function(t){return!t.belongsToView()&&t.type==="user"&&t.data.OWNER_ID===e.ID}));if(s.length>0){t.DOM.sectionListWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.util.htmlspecialchars(e.FORMATTED_NAME)+"</span>"}));t.createSectionBlock({wrap:t.DOM.sectionListWrap,sectionList:s})}}),this);n=this.sliderSections.filter((function(e){return!e.belongsToView()&&e.type==="group"}));if(n.length>0){this.DOM.sectionListWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+a.Loc.getMessage("EC_SEC_SLIDER_TITLE_GROUP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:n})}}},{key:"createAddButton",value:function e(){if(this.calendarContext.util.config.perm&&this.calendarContext.util.config.perm.edit_section){var t=this.DOM.titleWrap.appendChild(a.Dom.create("SPAN",{props:{className:"ui-btn-split ui-btn-light-border"},style:{marginRight:0}}));this.DOM.addButton=t.appendChild(a.Dom.create("SPAN",{props:{className:"ui-btn-main"},text:a.Loc.getMessage("EC_ADD")}));this.DOM.addButtonMore=t.appendChild(a.Dom.create("SPAN",{props:{className:"ui-btn-extra"}}));a.Event.bind(this.DOM.addButtonMore,"click",this.showAddButtonPopup.bind(this));a.Event.bind(this.DOM.addButton,"click",this.showEditSectionForm.bind(this))}}},{key:"showAddButtonPopup",value:function e(){var s=this;if(this.addBtnMenu&&this.addBtnMenu.popupWindow&&this.addBtnMenu.popupWindow.isShown()){return this.addBtnMenu.close()}var i=[new t.MenuItem({text:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_NEW_TITLE"),delimiter:true}),{html:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_NEW_MENU"),onclick:function e(){s.addBtnMenu.close();s.showEditSectionForm()}},new t.MenuItem({text:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_EXIST_TITLE"),delimiter:true}),{html:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP"),onclick:function e(){s.addBtnMenu.close();s.showTrackingTypesForm()}},{html:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_USER"),onclick:function e(){s.addBtnMenu.close();s.showTrackingUsersForm()}},{html:a.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP"),onclick:function e(){s.addBtnMenu.close();s.showTrackingGroupsForm()}}];this.addBtnMenu=this.BX.PopupMenu.create("add-btn-"+n.Util.getRandomInt(),this.DOM.addButtonMore,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true,cacheable:false});this.addBtnMenu.show()}},{key:"createSectionBlock",value:function e(t){var s=t.sectionList,i=t.wrap;if(a.Type.isArray(s)){var n=i.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}})).appendChild(a.Dom.create("UL",{props:{className:"calendar-list-slider-container"}}));a.Event.bind(n,"click",this.sectionClickHandler.bind(this));s.forEach((function(e){if(!e.DOM){e.DOM={}}var t=e.id.toString();var s=n.appendChild(a.Dom.create("LI",{props:{className:"calendar-list-slider-item"},attrs:{"data-bx-calendar-section":t}}));var i=s.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-item-checkbox"+(e.isShown()?" calendar-list-slider-item-checkbox-checked":"")},style:{backgroundColor:e.color}}));var r=s.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-item-name",title:e.name},text:e.name}));e.DOM.item=s;e.DOM.checkbox=i;e.DOM.title=r;e.DOM.actionCont=s.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-item-actions-container"},attrs:{"data-bx-calendar-section-menu":t},html:'<span class="calendar-list-slider-item-context-menu"></span>'}))}))}}},{key:"sectionClickHandler",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(s&&s.getAttribute){if(s.getAttribute("data-bx-calendar-section-menu")!==null){var i=s.getAttribute("data-bx-calendar-section-menu");i=i==="tasks"?i:parseInt(i);this.showSectionMenu(this.sectionManager.getSection(i),s)}else if(s.getAttribute("data-bx-calendar-section")!==null){this.switchSection(this.sectionManager.getSection(s.getAttribute("data-bx-calendar-section")))}}}},{key:"findCheckBoxNodes",value:function e(t){return this.DOM.sectionListWrap.querySelectorAll(".calendar-list-slider-item[data-bx-calendar-section='"+t+"'] .calendar-list-slider-item-checkbox")}},{key:"switchSection",value:function e(t){var s=this.findCheckBoxNodes(t.id);for(var i=0;i<s.length;i++){if(t.isShown()){a.Dom.removeClass(s[i],"calendar-list-slider-item-checkbox-checked")}else{a.Dom.addClass(s[i],"calendar-list-slider-item-checkbox-checked")}}if(t.isShown()){t.hide()}else{t.show()}this.calendarContext.reload()}},{key:"switchOnSection",value:function e(t){var s=this.findCheckBoxNodes(t.id);for(var i=0;i<s.length;i++){if(!t.isShown()){a.Dom.addClass(s[i],"calendar-list-slider-item-checkbox-checked")}}if(!t.isShown()){t.show()}}},{key:"switchOffSection",value:function e(t){var s=this.findCheckBoxNodes(t.id);for(var i=0;i<s.length;i++){if(t.isShown()){a.Dom.removeClass(s[i],"calendar-list-slider-item-checkbox-checked")}}if(t.isShown()){t.hide()}}},{key:"showSectionMenu",value:function e(t,s){var i=this;var r=[];var o=s.closest("[data-bx-calendar-section]");if(a.Type.isElementNode(o)){a.Dom.addClass(o,"active")}if(t.canDo("view_time")){r.push({text:a.Loc.getMessage("EC_SEC_LEAVE_ONE"),onclick:function e(){i.sectionActionMenu.close();i.showOnlyOneSection(t,i.sectionManager.sections)}})}if(!t.isPseudo()&&t.getLink()&&!t.belongsToView()){r.push({text:a.Loc.getMessage("EC_SEC_OPEN_LINK"),href:t.getLink()})}if(!this.readonly&&t.canDo("edit_section")&&!t.isPseudo()){r.push({text:a.Loc.getMessage("EC_SEC_EDIT"),onclick:function e(){i.sectionActionMenu.close();i.showEditSectionForm({section:t})}})}if(t.isSuperposed()&&!t.belongsToView()){r.push({text:a.Loc.getMessage("EC_SEC_HIDE"),onclick:function e(){i.hideSuperposedHandler(t);i.sectionActionMenu.close()}})}if(t.canBeConnectedToOutlook()){r.push({text:a.Loc.getMessage("EC_SEC_CONNECT_TO_OUTLOOK"),onclick:function e(){i.sectionActionMenu.close();t.connectToOutlook();i.close()}})}if(!t.isPseudo()&&t.data.EXPORT&&t.data.EXPORT.LINK){r.push({text:a.Loc.getMessage("EC_ACTION_EXPORT"),onclick:function e(){i.sectionActionMenu.close();var s={sectionLink:t.data.EXPORT.LINK,calendarPath:i.calendarContext.util.config.path};if(BX.Calendar.Sync.Interface.IcalSyncPopup.checkPathes(s)){BX.Calendar.Sync.Interface.IcalSyncPopup.createInstance(s).show()}else{BX.Calendar.Sync.Interface.IcalSyncPopup.showPopupWithPathesError()}}})}var c=undefined;var l=undefined;if(t.data.CAL_DAV_CON){var d=this.calendarContext.syncInterface.getProviderById(t.data.CAL_DAV_CON);var p=babelHelpers.slicedToArray(d,2);c=p[0];l=p[1]}if(t.canDo("edit_section")&&t.belongsToView()&&!t.isPseudo()&&(!t.isGoogle()&&!l||t.data["EXTERNAL_TYPE"]==="local"||!l)){r.push({text:a.Loc.getMessage("EC_SEC_DELETE"),onclick:function e(){i.sectionActionMenu.close();t.remove()}})}if((t.isGoogle()||t.isCalDav())&&t.canDo("edit_section")){r.push({text:a.Loc.getMessage("EC_ACTION_REFRESH"),onclick:function e(){i.sectionActionMenu.close();i.calendarContext.reload({syncGoogle:true});i.close()}});if((t.isGoogle()||t.isCalDav())&&t.canDo("edit_section")&&l){r.push({text:a.Loc.getMessage("EC_ACTION_EXTERNAL_ADJUST"),onclick:function e(){i.sectionActionMenu.close();if(c){c.openActiveConnectionSlider(l)}}})}if(t.data["EXTERNAL_TYPE"]!=="local"&&l){r.push({text:a.Loc.getMessage("EC_ACTION_HIDE"),onclick:function e(){i.sectionActionMenu.close();t.hideGoogle()}})}}if(t.isPseudo()){r.push({text:a.Loc.getMessage("EC_SEC_EDIT"),onclick:function e(){i.sectionActionMenu.close();i.showEditSectionForm({section:t})}});r.push({text:a.Loc.getMessage("EC_SEC_TASK_HIDE"),onclick:function e(){i.sectionActionMenu.close();BX.userOptions.save("calendar","user_settings","showTasks","N");a.Dom.addClass(t.DOM.item,"calendar-list-slider-item-disappearing");setTimeout((function(){a.Dom.clean(t.DOM.item,true);BX.reload()}),300)}})}if(r&&r.length>0){this.sectionActionMenu=top.BX.PopupMenu.create("section-menu-"+n.Util.getRandomInt(),s,r,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});this.sectionActionMenu.show();this.sectionActionMenu.popupWindow.subscribe("onClose",(function(){if(a.Type.isElementNode(o)){a.Dom.removeClass(o,"active")}i.allowSliderClose()}));this.denySliderClose()}}},{key:"denySliderClose",value:function e(){this.denyClose=true}},{key:"allowSliderClose",value:function e(){this.denyClose=false}},{key:"closeForms",value:function e(){if(this.addBtnMenu){this.addBtnMenu.close()}if(this.editSectionForm){this.editSectionForm.close()}if(this.trackingUsersForm){this.trackingUsersForm.close()}if(this.trackingGroupsForm){this.trackingGroupsForm.close()}if(this.trackingTypesForm){this.trackingTypesForm.close()}}},{key:"showEditSectionForm",value:function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.closeForms();var i=this.DOM.sectionFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new d({wrap:this.DOM.sectionFormWrap,sectionAccessTasks:this.sectionManager.getSectionAccessTasks(),sectionManager:this.sectionManager,closeCallback:function e(){t.allowSliderClose()}});var r=true;if(s.section&&(!s.section.belongsToView()||s.section.isPseudo())){i.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION_PERSONAL");r=false}else if(s.section&&s.section.id){i.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION");r=s.section.canDo("access")}else{i.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_NEW_SECTION")}this.editSectionForm.show({showAccess:r,section:s.section||{color:n.Util.getRandomColor(),access:this.sectionManager.getDefaultSectionAccess()}});this.denySliderClose()}},{key:"showTrackingTypesForm",value:function e(){var t=this;this.closeForms();if(!this.trackingTypesForm){this.trackingTypesForm=new I({wrap:this.DOM.trackingTypesFormWrap,superposedSections:this.sectionManager.getSuperposedSectionList(),closeCallback:function e(){t.allowSliderClose()}})}this.trackingTypesForm.show();this.denySliderClose()}},{key:"showTrackingUsersForm",value:function e(){var t=this;this.closeForms();if(!this.trackingUsersForm){this.trackingUsersForm=new b({wrap:this.DOM.trackingUsersFormWrap,trackingUsers:this.calendarContext.util.getSuperposedTrackedUsers(),superposedSections:this.sectionManager.getSuperposedSectionList(),closeCallback:function e(){t.allowSliderClose()}})}this.trackingUsersForm.show();this.denySliderClose()}},{key:"showTrackingGroupsForm",value:function e(){var t=this;this.closeForms();if(!this.trackingGroupsForm){var s=this.sectionManager.getSuperposedSectionList();var i=this.calendarContext.util.getSuperposedTrackedGroups();s.forEach((function(e){if(e.getType()==="group"&&!i.includes(e.getOwnerId())){i.push(e.getOwnerId())}}));this.trackingGroupsForm=new E({wrap:this.DOM.trackingGroupsFormWrap,trackingGroups:i,superposedSections:s,closeCallback:function e(){t.allowSliderClose()}})}this.trackingGroupsForm.show();this.denySliderClose()}},{key:"deleteSectionHandler",value:function e(t){var s=this;if(t&&t instanceof n.Util.getBX().Event.BaseEvent){var i=t.getData();var r=parseInt(i.sectionId,10);this.sliderSections.forEach((function(e,t){if(parseInt(e.id)===r&&e.DOM&&e.DOM.item){a.Dom.addClass(e.DOM.item,"calendar-list-slider-item-disappearing");setTimeout((function(){a.Dom.clean(e.DOM.item,true);s.sliderSections=BX.util.deleteFromArray(s.sliderSections,t)}),300)}}),this);this.closeForms()}}},{key:"hideSuperposedHandler",value:function e(t){var s=this.sectionManager.getSuperposedSectionList();var i=[];var a;for(a=0;a<s.length;a++){if(parseInt(t.id)!==parseInt(s[a].id)){i.push(parseInt(s[a].id))}}BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{sections:i}}).then((function(e){BX.reload()}),(function(e){n.Util.displayError(e.errors)}))}},{key:"refreshSectionList",value:function e(){this.createSectionList()}},{key:"showOnlyOneSection",value:function e(t,s){var i=B(s),a;try{for(i.s();!(a=i.n()).done;){var n=a.value;if(n.id===t.id){this.switchOnSection(n)}else{this.switchOffSection(n)}}}catch(e){i.e(e)}finally{i.f()}this.calendarContext.reload()}}]);return s}(s.EventEmitter);e.SectionInterface=W})(this.BX.Calendar=this.BX.Calendar||{},BX.Main,BX.Event,BX.UI.EntitySelector,BX,BX.Calendar);
//# sourceMappingURL=sectioninterface.bundle.map.js