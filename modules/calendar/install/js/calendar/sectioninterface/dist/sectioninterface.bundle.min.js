this.BX=this.BX||{};(function(e,t,s,i,n){"use strict";function a(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="calendar-list-slider-new-calendar-option-add">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>"]);a=function t(){return e};return e}function r(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<table class="calendar-section-slider-access-table"></table>\n\t\t\t\t\t\t']);r=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-access-container">\n\t\t\t\t\t<div class="calendar-list-slider-access-inner-wrap">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-list-slider-new-calendar-options-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);c=function t(){return e};return e}function o(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-new-calendar-option-more">',"</div>"]);o=function t(){return e};return e}var l=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"isCreated",false);e.setEventNamespace("BX.Calendar.SectionInterface.EditForm");e.DOM.outerWrap=s.wrap;e.sectionAccessTasks=s.sectionAccessTasks;e.sectionManager=s.sectionManager;e.closeCallback=s.closeCallback;e.BX=n.Util.getBX();e.keyHandlerBinded=e.keyHandler.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.create();this.showAccess=t.showAccess!==false;if(this.showAccess){this.DOM.accessLink.style.display="";this.DOM.accessWrap.style.display=""}else{this.DOM.accessLink.style.display="none";this.DOM.accessWrap.style.display="none"}i.Event.bind(document,"keydown",this.keyHandlerBinded);i.Dom.addClass(this.DOM.outerWrap,"show");this.section=t.section;if(t.section){if(t.section.color){this.setColor(t.section.color)}this.setAccess(t.section.access||t.section.data.ACCESS||{});if(t.section.name){this.DOM.sectionTitleInput.value=t.section.name}}BX.focus(this.DOM.sectionTitleInput);if(this.DOM.sectionTitleInput.value!==""){this.DOM.sectionTitleInput.select()}this.isOpenedState=true}},{key:"close",value:function e(){this.isOpenedState=false;i.Event.unbind(document,"keydown",this.keyHandlerBinded);i.Dom.removeClass(this.DOM.outerWrap,"show");if(i.Type.isFunction(this.closeCallback)){this.closeCallback()}}},{key:"isOpened",value:function e(){return this.isOpenedState}},{key:"create",value:function e(){this.wrap=this.DOM.outerWrap.querySelector(".calendar-form-content");if(this.wrap){i.Dom.clean(this.wrap)}else{this.wrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-form-content"}}))}this.DOM.formFieldsWrap=this.wrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}}));this.DOM.sectionTitleInput=this.DOM.formFieldsWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}})).appendChild(i.Dom.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(i.Dom.create("INPUT",{attrs:{type:"text",placeholder:i.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE")},props:{className:"calendar-field calendar-field-string"}}));this.DOM.optionsWrap=this.DOM.formFieldsWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.initSectionColorSelector();this.initAccessController();this.buttonsWrap=this.DOM.formFieldsWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=new BX.UI.Button({text:i.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.save.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap);new BX.UI.Button({text:i.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(this.buttonsWrap);this.isCreated=true}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.checkClose()}else if(t.keyCode===n.Util.getKeyCode("enter")){this.save()}}},{key:"checkClose",value:function e(){this.close()}},{key:"save",value:function e(){var t=this;this.saveBtn.setWaiting(true);this.sectionManager.saveSection(this.DOM.sectionTitleInput.value,this.color,this.access,{section:this.section}).then(function(){t.saveBtn.setWaiting(false);t.close()})}},{key:"initSectionColorSelector",value:function e(){this.DOM.colorContWrap=this.DOM.optionsWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-color"},html:i.Loc.getMessage("EC_SEC_SLIDER_COLOR")}));this.colorIcon=this.DOM.colorContWrap.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-selected"}}));this.colorChangeLink=this.DOM.colorContWrap.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-change"},html:i.Loc.getMessage("EC_SEC_SLIDER_CHANGE")}));i.Event.bind(this.colorIcon,"click",this.showSimplePicker.bind(this));i.Event.bind(this.colorChangeLink,"click",this.showSimplePicker.bind(this))}},{key:"showSimplePicker",value:function e(t){var s=i.Runtime.clone(n.Util.getDefaultColorList(),true);var a=i.Dom.create("DIV",{props:{className:"calendar-simple-color-wrap calendar-field-container-colorpicker-square"}});var r=a.appendChild(i.Dom.create("DIV",{events:{click:BX.delegate(this.simplePickerClick,this)}}));var c=a.appendChild(i.Dom.create("DIV",{props:{className:"calendar-simple-color-more-link-wrap"}}));var o=c.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-simple-color-more-link"},html:i.Loc.getMessage("EC_COLOR"),events:{click:BX.delegate(this.showFullPicker,this)}}));this.simplePickerColorWrap=r;this.colors=[];if(!s.includes(this.color)){s.push(this.color)}for(var l=0;l<s.length;l++){this.colors.push({color:s[l],node:r.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:s[l]},attrs:{"data-bx-calendar-color":s[l]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.lastActiveNode=this.colors[BX.util.array_search(this.color,s)||0].node;i.Dom.addClass(this.lastActiveNode,"active");this.simpleColorPopup=BX.PopupWindowManager.create("simple-color-popup-"+n.Util.getRandomInt(),this.colorIcon,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:9,lightShadow:true,content:a,cacheable:false});this.simpleColorPopup.setAngle({offset:10});this.simpleColorPopup.show(true)}},{key:"simplePickerClick",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(i.Type.isElementNode(s)){var a=s.getAttribute("data-bx-calendar-color");if(a!==null){if(this.lastActiveNode){i.Dom.removeClass(this.lastActiveNode,"active")}i.Dom.addClass(s,"active");this.lastActiveNode=s;this.setColor(a)}}}},{key:"showFullPicker",value:function e(){if(this.simpleColorPopup){this.simpleColorPopup.close()}if(!this.fullColorPicker){this.fullColorPicker=new BX.ColorPicker({bindElement:this.colorIcon,onColorSelected:BX.delegate(function(e){this.setColor(e)},this),popupOptions:{cacheable:false,zIndex:this.zIndex,events:{onPopupClose:BX.delegate(function(){},this)}}})}this.fullColorPicker.open()}},{key:"setColor",value:function e(t){this.colorIcon.style.backgroundColor=t;this.color=t}},{key:"setAccess",value:function e(t){var s=0;for(var i in t){if(t.hasOwnProperty(i)){s++}}this.accessRowsCount=s;this.access=t;for(var a in t){if(t.hasOwnProperty(a)){this.insertAccessRow(n.Util.getAccessName(a),a,t[a])}}this.checkAccessTableHeight()}},{key:"initAccessController",value:function e(){var t=this;this.DOM.accessLink=this.DOM.optionsWrap.appendChild(i.Tag.render(o(),i.Loc.getMessage("EC_SEC_SLIDER_ACCESS")));this.DOM.accessWrap=this.DOM.formFieldsWrap.appendChild(i.Tag.render(c(),this.DOM.accessTable=i.Tag.render(r()),this.DOM.accessButton=i.Tag.render(a(),i.Loc.getMessage("EC_SEC_SLIDER_ACCESS_ADD"))));this.accessControls={};this.accessTasks=this.sectionAccessTasks;i.Event.bind(this.DOM.accessLink,"click",function(){if(i.Dom.hasClass(t.DOM.accessWrap,"shown")){i.Dom.removeClass(t.DOM.accessWrap,"shown")}else{i.Dom.addClass(t.DOM.accessWrap,"shown")}t.checkAccessTableHeight()});i.Event.bind(this.DOM.accessButton,"click",function(){t.entitySelectorDialog=new s.Dialog({targetNode:t.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":t.handleEntitySelectorChanges.bind(t),"Item:onDeselect":t.handleEntitySelectorChanges.bind(t)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}]});t.entitySelectorDialog.show()});i.Event.bind(this.DOM.accessWrap,"click",function(e){var s=n.Util.findTargetNode(e.target||e.srcElement,t.DOM.outerWrap);if(i.Type.isElementNode(s)){if(s.getAttribute("data-bx-calendar-access-selector")!==null){var a=s.getAttribute("data-bx-calendar-access-selector");if(t.accessControls[a]){t.showAccessSelectorPopup({node:t.accessControls[a].removeIcon,setValueCallback:function e(s){if(t.accessTasks[s]&&t.accessControls[a]){t.accessControls[a].valueNode.innerHTML=i.Text.encode(t.accessTasks[s].title);t.access[a]=s}}})}}else if(s.getAttribute("data-bx-calendar-access-remove")!==null){var r=s.getAttribute("data-bx-calendar-access-remove");if(t.accessControls[r]){i.Dom.remove(t.accessControls[r].rowNode);t.accessControls[r]=null;delete t.access[r]}}}})}},{key:"handleEntitySelectorChanges",value:function e(){var t=this;var s=this.entitySelectorDialog.getSelectedItems();this.entitySelectorDialog.hide();if(i.Type.isArray(s)){s.forEach(function(e){var s=e.title.text;var i=n.Util.convertEntityToAccessCode(e);n.Util.setAccessName(i,s);t.insertAccessRow(s,i)})}i.Runtime.debounce(function(){t.entitySelectorDialog.destroy()},400)()}},{key:"insertAccessRow",value:function e(t,s,n){if(!this.accessControls[s]){if(n===undefined){for(var a in this.sectionAccessTasks){if(this.sectionAccessTasks.hasOwnProperty(a)&&this.sectionAccessTasks[a].name==="calendar_view"){n=a;break}}}var r=i.Dom.adjust(this.DOM.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),c=i.Dom.adjust(r.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+i.Text.encode(t)+":</span>"}),o=i.Dom.adjust(r.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":s}}),l=o.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-container"}})),d=l.appendChild(i.Dom.create("SPAN",{text:this.accessTasks[n]?this.accessTasks[n].title:"",props:{className:"calendar-section-slider-access-value"}})),p=l.appendChild(i.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":s}}));this.access[s]=n;this.accessControls[s]={rowNode:r,titleNode:c,valueNode:d,removeIcon:p}}}},{key:"checkAccessTableHeight",value:function e(){var t=this;if(this.checkTableTimeout){this.checkTableTimeout=clearTimeout(this.checkTableTimeout)}this.checkTableTimeout=setTimeout(function(){if(i.Dom.hasClass(t.DOM.accessWrap,"shown")){if(t.DOM.accessWrap.offsetHeight-t.DOM.accessTable.offsetHeight<36){t.DOM.accessWrap.style.maxHeight=parseInt(t.DOM.accessTable.offsetHeight)+100+"px"}}else{t.DOM.accessWrap.style.maxHeight=""}},300)}},{key:"showAccessSelectorPopup",value:function e(t){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}var s=this;var i=[];for(var a in this.accessTasks){if(this.accessTasks.hasOwnProperty(a)){i.push({text:this.accessTasks[a].title,onclick:function(e){return function(){t.setValueCallback(e);s.accessPopupMenu.close()}}(a)})}}this.accessPopupMenu=this.BX.PopupMenu.create("section-access-popup"+n.Util.randomInt(),t.node,i,{closeByEsc:true,autoHide:true,offsetTop:-5,offsetLeft:0,angle:true,cacheable:false});this.accessPopupMenu.show()}}]);return t}(t.EventEmitter);function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="calendar-list-slider-item-checkbox" style="background: ','"></div>\n\t\t\t\t\t\t']);d=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<li class="calendar-list-slider-item" data-bx-calendar-section="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="calendar-list-slider-item-name">',"</div>\n\t\t\t\t\t</li>\n\t\t\t\t"]);p=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['<ul class="calendar-list-slider-container"></ul>']);h=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-widget-content">\n\t\t\t\t\t<div class="calendar-list-slider-widget-content-block">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);u=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"]);g=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"]);f=function t(){return e};return e}function m(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-btn-container">\n\t\t\t\t<button \n\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-primary"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>','</button>\n\t\t\t\t<button \n\t\t\t\t\tclass="ui-btn ui-btn-link"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>',"</button>\n\t\t\t</div>"]);m=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']);C=function t(){return e};return e}function v(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);v=function t(){return e};return e}var S=function(){function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"DOM",{});babelHelpers.defineProperty(this,"isCreated",false);this.DOM.outerWrap=s.wrap;this.trackingUsers=s.trackingUsers||[];this.trackingUserIdList=this.trackingUsers.map(function(e){return parseInt(e.ID)});this.CHECKED_CLASS="calendar-list-slider-item-checkbox-checked";this.selectorId="add-tracking"+n.Util.getRandomInt();this.closeCallback=s.closeCallback;this.superposedSections=i.Type.isArray(s.superposedSections)?s.superposedSections:[];this.selected={};this.superposedSections.forEach(function(e){t.selected[e.id]=true},this);this.isCreated=false;this.keyHandlerBinded=this.keyHandler.bind(this)}babelHelpers.createClass(e,[{key:"show",value:function e(){if(!this.isCreated){this.create()}i.Dom.addClass(this.DOM.outerWrap,"show");this.checkInnerWrapHeight();i.Event.bind(document,"keydown",this.keyHandlerBinded);this.updateSectionList();this.firstTrackingUserIdList=i.Runtime.clone(this.trackingUserIdList);this.isOpenedState=true}},{key:"close",value:function e(){i.Event.unbind(document,"keydown",this.keyHandlerBinded);this.isOpenedState=false;i.Dom.removeClass(this.DOM.outerWrap,"show");this.DOM.outerWrap.style.cssText="";if(i.Type.isFunction(this.closeCallback)){this.closeCallback()}}},{key:"isOpened",value:function e(){return this.isOpenedState}},{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(i.Tag.render(v()))}this.selectorWrap=this.DOM.innerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-selector-wrap"}}));this.userTagSelector=new s.TagSelector({dialogOptions:{context:"CALENDAR",preselectedItems:this.trackingUsers.map(function(e){return["user",parseInt(e.ID)]}),events:{"Item:onSelect":this.handleUserSelectorChanges.bind(this),"Item:onDeselect":this.handleUserSelectorChanges.bind(this)},entities:[{id:"user"}]}});this.userTagSelector.renderTo(this.selectorWrap);this.sectionsWrap=this.DOM.innerWrap.appendChild(i.Tag.render(C()));this.createButtons();this.isCreated=true}},{key:"createButtons",value:function e(){this.DOM.innerWrap.appendChild(i.Tag.render(m(),this.save.bind(this),i.Loc.getMessage("EC_SEC_SLIDER_SAVE"),this.close.bind(this),i.Loc.getMessage("EC_SEC_SLIDER_CANCEL")))}},{key:"handleUserSelectorChanges",value:function e(){var t=this;var s=this.userTagSelector.getDialog().getSelectedItems();this.trackingUserIdList=[];s.forEach(function(e){if(e.entityId==="user"){t.trackingUserIdList.push(e.id)}});this.updateSectionList()}},{key:"save",value:function e(){BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{userIdList:this.trackingUserIdList,sections:this.prepareTrackingSections(),type:"users"}}).then(function(e){location.reload()},function(e){n.Util.displayError(e.errors)});this.close()}},{key:"prepareTrackingSections",value:function e(){var t=this;var s=[];this.superposedSections.forEach(function(e){s.push(parseInt(e.id))},this);var n=function e(n){if(t.sectionIndex.hasOwnProperty(n)&&t.sectionIndex[n].checkbox){if(i.Dom.hasClass(t.sectionIndex[n].checkbox,t.CHECKED_CLASS)){if(!s.includes(parseInt(n))){s.push(parseInt(n))}}else if(s.includes(parseInt(n))){s=s.filter(function(e){return parseInt(e)!==parseInt(n)})}}};for(var a in this.sectionIndex){n(a)}return s}},{key:"updateSectionList",value:function e(t){var s=this;if(this.updateSectionLoader){i.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(i.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}if(t!==false){this.updateSectionTimeout=setTimeout(function(){s.updateSectionList(false)},300);return}this.checkInnerWrapHeight();BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{userIdList:this.trackingUserIdList,type:"users"}}).then(function(e){i.Dom.clean(s.sectionsWrap);s.sectionIndex={};s.checkInnerWrapHeight();e.data.users.forEach(function(t){var n=e.data.sections.filter(function(e){return parseInt(e.OWNER_ID)===parseInt(t.ID)});s.sectionsWrap.appendChild(i.Tag.render(f(),i.Text.encode(t.FORMATTED_NAME)));if(n.length>0){s.createSectionBlock({sectionList:n,wrap:s.sectionsWrap})}else{s.sectionsWrap.appendChild(i.Tag.render(g(),i.Loc.getMessage("EC_SEC_SLIDER_NO_SECTIONS")))}})},function(e){n.Util.displayError(e.errors)})}},{key:"createSectionBlock",value:function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=false;if(i.Type.isArray(s.sectionList)&&s.sectionList.length&&i.Type.isElementNode(s.wrap)){var a;s.wrap.appendChild(i.Tag.render(u(),a=i.Tag.render(h())));i.Event.bind(a,"click",this.sectionClick.bind(this));s.sectionList.forEach(function(e){var s=e.ID.toString();var n;var r=a.appendChild(i.Tag.render(p(),s,n=i.Tag.render(d(),e.COLOR),i.Text.encode(e.NAME)));t.sectionIndex[s]={item:r,checkbox:n};if(t.selected[s]||!i.Type.isArray(t.firstTrackingUserIdList)||!t.firstTrackingUserIdList.includes(parseInt(e.OWNER_ID))){i.Dom.addClass(n,t.CHECKED_CLASS)}})}return n}},{key:"sectionClick",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(i.Type.isElementNode(s)){if(s.getAttribute("data-bx-calendar-section")!==null){var a=s.getAttribute("data-bx-calendar-section");if(this.sectionIndex[a]&&this.sectionIndex[a].checkbox){if(i.Dom.hasClass(this.sectionIndex[a].checkbox,this.CHECKED_CLASS)){i.Dom.removeClass(this.sectionIndex[a].checkbox,this.CHECKED_CLASS)}else{i.Dom.addClass(this.sectionIndex[a].checkbox,this.CHECKED_CLASS)}}}}}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.close()}else if(t.keyCode===n.Util.getKeyCode("enter")){this.save()}}},{key:"checkInnerWrapHeight",value:function e(){var t=this;if(this.checkHeightTimeout){this.checkHeightTimeout=clearTimeout(this.checkHeightTimeout)}this.checkHeightTimeout=setTimeout(function(){if(i.Dom.hasClass(t.DOM.outerWrap,"show")){if(t.DOM.outerWrap.offsetHeight-t.DOM.innerWrap.offsetHeight<36){t.DOM.outerWrap.style.maxHeight=parseInt(t.DOM.innerWrap.offsetHeight)+200+"px"}}else{t.DOM.outerWrap.style.maxHeight=""}},300)}}]);return e}();function D(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']);D=function t(){return e};return e}function b(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);b=function t(){return e};return e}var k=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.trackingGroupIdList=s.trackingGroups||[];return e}babelHelpers.createClass(t,[{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(i.Tag.render(b()))}this.selectorWrap=this.DOM.innerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-selector-wrap"}}));this.groupTagSelector=new s.TagSelector({dialogOptions:{context:"CALENDAR",preselectedItems:this.trackingGroupIdList.map(function(e){return["project",e]}),events:{"Item:onSelect":this.handleGroupSelectorChanges.bind(this),"Item:onDeselect":this.handleGroupSelectorChanges.bind(this)},entities:[{id:"project"}]}});this.groupTagSelector.renderTo(this.selectorWrap);this.sectionsWrap=this.DOM.innerWrap.appendChild(i.Tag.render(D()));this.createButtons();this.isCreated=true}},{key:"handleGroupSelectorChanges",value:function e(){var t=this;var s=this.groupTagSelector.getDialog().getSelectedItems();this.trackingGroupIdList=[];s.forEach(function(e){if(e.entityId==="project"){t.trackingGroupIdList.push(e.id)}});this.updateSectionList()}},{key:"updateSectionList",value:function e(){var t=this;if(this.updateSectionLoader){i.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(i.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}this.checkInnerWrapHeight();BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{groupIdList:this.trackingGroupIdList,type:"groups"}}).then(function(e){i.Dom.clean(t.sectionsWrap);t.sectionIndex={};t.checkInnerWrapHeight();t.createSectionBlock({sectionList:e.data.sections,wrap:t.sectionsWrap})},function(e){n.Util.displayError(e.errors)})}}]);return t}(S);function E(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<span class="calendar-list-slider-card-section-title-text">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"]);E=function t(){return e};return e}function M(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-sections-wrap"></div>']);M=function t(){return e};return e}function T(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);T=function t(){return e};return e}var I=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.trackingGroups=s.trackingGroups||[];e.selectGroups=true;e.selectUsers=false;e.addLinkMessage=i.Loc.getMessage("EC_SEC_SLIDER_SELECT_GROUPS");return e}babelHelpers.createClass(t,[{key:"show",value:function e(){if(!this.isCreated){this.create()}this.updateSectionList();this.isOpenedState=true;i.Dom.addClass(this.DOM.outerWrap,"show")}},{key:"create",value:function e(){if(!this.DOM.innerWrap){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(i.Tag.render(T()))}this.sectionsWrap=this.DOM.innerWrap.appendChild(i.Tag.render(M()));this.createButtons();this.isCreated=true}},{key:"updateSectionList",value:function e(){var t=this;if(this.updateSectionLoader){i.Dom.remove(this.updateSectionLoader)}this.updateSectionLoader=this.sectionsWrap.appendChild(i.Dom.adjust(n.Util.getLoader(),{style:{height:"140px"}}));if(this.updateSectionTimeout){this.updateSectionTimeout=clearTimeout(this.updateSectionTimeout)}BX.ajax.runAction("calendar.api.calendarajax.getTrackingSections",{data:{type:"company"}}).then(function(e){i.Dom.clean(t.sectionsWrap);t.sectionIndex={};t.checkInnerWrapHeight();if(i.Type.isArray(e.data.sections)&&e.data.sections.length){t.createSectionBlock({sectionList:e.data.sections,wrap:t.sectionsWrap})}else{t.sectionsWrap.appendChild(i.Tag.render(E(),i.Loc.getMessage("EC_SEC_SLIDER_NO_SECTIONS")))}},function(e){n.Util.displayError(e.errors)});this.checkInnerWrapHeight()}},{key:"save",value:function e(){BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{sections:this.prepareTrackingSections()}}).then(function(e){location.reload()},function(e){n.Util.displayError(e.errors)});this.close()}}]);return t}(S);function y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"]);y=function t(){return e};return e}var L=function(e){babelHelpers.inherits(t,e);function t(e){var s;var i=e.calendarContext,a=e.readonly,r=e.sectionManager;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"name","sectioninterface");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"uid",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"SLIDER_WIDTH",400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"SLIDER_DURATION",80);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"sliderId","calendar:section-slider");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"denyClose",false);s.setEventNamespace("BX.Calendar.SectionInterface");s.sectionManager=r;s.calendarContext=i;s.readonly=a;s.BX=n.Util.getBX();s.deleteSectionHandlerBinded=s.deleteSectionHandler.bind(babelHelpers.assertThisInitialized(s));s.refreshSectionListBinded=s.refreshSectionList.bind(babelHelpers.assertThisInitialized(s));if(s.calendarContext.util.config.accessNames){var c,o,l;n.Util.setAccessNames((c=s.calendarContext)===null||c===void 0?void 0:(o=c.util)===null||o===void 0?void 0:(l=o.config)===null||l===void 0?void 0:l.accessNames)}return s}babelHelpers.createClass(t,[{key:"show",value:function e(){this.BX.SidePanel.Instance.open(this.sliderId,{contentCallback:this.createContent.bind(this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION,events:{onCloseByEsc:this.escHide.bind(this),onClose:this.hide.bind(this),onCloseComplete:this.destroy.bind(this),onLoad:this.onLoadSlider.bind(this)}});this.addEventEmitterSubscriptions()}},{key:"addEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:edit",this.refreshSectionListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Section:pull-edit",this.refreshSectionListBinded)}},{key:"destroyEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:edit",this.refreshSectionListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-edit",this.refreshSectionListBinded)}},{key:"escHide",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId&&this.denyClose){t.denyAction()}}},{key:"hide",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){this.closeForms();this.destroyEventEmitterSubscriptions()}}},{key:"close",value:function e(){BX.SidePanel.Instance.close()}},{key:"destroy",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){this.destroyEventEmitterSubscriptions();n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:delete",this.deleteSectionHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Section:pull-delete",this.deleteSectionHandlerBinded);BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);delete this.DOM.sectionListWrap;if(this.sectionActionMenu){this.sectionActionMenu.close()}}}},{key:"createContent",value:function e(){this.DOM.outerWrap=i.Dom.create("DIV",{props:{className:"calendar-list-slider-wrap"}});this.DOM.titleWrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-title-container"},html:'<div class="calendar-list-slider-title">'+i.Loc.getMessage("EC_SECTION_BUTTON")+"</div>"}));var t=this.calendarContext||n.Util.getCalendarContext();if(t&&!this.readonly&&(!t.util.isUserCalendar()||t.util.userIsOwner())){this.createAddButton();this.DOM.sectionFormWrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(i.Loc.getMessage("EC_SEC_SLIDER_NEW_SECTION"),"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")}));this.DOM.trackingCompanyFormWrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP"),"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")}));this.DOM.trackingUsersFormWrap=this.DOM.outerWrap.appendChild(i.Tag.render(y(),i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP")));this.DOM.trackingGroupsFormWrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP"),"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>")}))}this.createSectionList();return this.DOM.outerWrap}},{key:"onLoadSlider",value:function e(t){this.slider=t.getSlider();this.sliderId=this.slider.getUrl();this.DOM.content=this.slider.layout.content}},{key:"createSectionList",value:function e(){var t=this;var s;this.sliderSections=this.sectionManager.getSections();var n=this.sectionManager.calendarType;if(n==="user"){s=i.Loc.getMessage("EC_SEC_SLIDER_MY_CALENDARS_LIST")}else if(n==="group"){s=i.Loc.getMessage("EC_SEC_SLIDER_GROUP_CALENDARS_LIST")}else{s=i.Loc.getMessage("EC_SEC_SLIDER_TYPE_CALENDARS_LIST")}if(this.DOM.sectionListWrap){i.Dom.clean(this.DOM.sectionListWrap);i.Dom.adjust(this.DOM.sectionListWrap,{props:{className:"calendar-list-slider-card-widget"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(s,"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")})}else{this.DOM.sectionListWrap=this.DOM.outerWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-widget"},html:'\n\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t'.concat(s,"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t")}))}this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:this.sliderSections.filter(function(e){return e.belongsToView()||e.isPseudo()})});var a=this.sliderSections.filter(function(e){return e.isCompanyCalendar()&&!e.belongsToView()});if(a.length>0){this.DOM.sectionListWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+i.Loc.getMessage("EC_SEC_SLIDER_TITLE_COMP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:this.sliderSections.filter(function(e){return e.isCompanyCalendar()})})}this.calendarContext.util.getSuperposedTrackedUsers().forEach(function(e){var s=t.sliderSections.filter(function(t){return!t.belongsToView()&&t.type==="user"&&t.data.OWNER_ID===e.ID});if(s.length>0){t.DOM.sectionListWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.util.htmlspecialchars(e.FORMATTED_NAME)+"</span>"}));t.createSectionBlock({wrap:t.DOM.sectionListWrap,sectionList:s})}},this);a=this.sliderSections.filter(function(e){return!e.belongsToView()&&e.type==="group"});if(a.length>0){this.DOM.sectionListWrap.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+i.Loc.getMessage("EC_SEC_SLIDER_TITLE_GROUP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.DOM.sectionListWrap,sectionList:a})}}},{key:"createAddButton",value:function e(){if(this.calendarContext.util.config.perm&&this.calendarContext.util.config.perm.edit_section){var t=this.DOM.titleWrap.appendChild(i.Dom.create("SPAN",{props:{className:"ui-btn-split ui-btn-light-border"},style:{marginRight:0}}));this.DOM.addButton=t.appendChild(i.Dom.create("SPAN",{props:{className:"ui-btn-main"},text:i.Loc.getMessage("EC_ADD")}));this.DOM.addButtonMore=t.appendChild(i.Dom.create("SPAN",{props:{className:"ui-btn-extra"}}));i.Event.bind(this.DOM.addButtonMore,"click",this.showAddButtonPopup.bind(this));i.Event.bind(this.DOM.addButton,"click",this.showEditSectionForm.bind(this))}}},{key:"showAddButtonPopup",value:function e(){var t=this;if(this.addBtnMenu&&this.addBtnMenu.popupWindow&&this.addBtnMenu.popupWindow.isShown()){return this.addBtnMenu.close()}var s="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";var a=[{html:"<span>"+i.Loc.getMessage("EC_SEC_SLIDER_POPUP_NEW_TITLE")+"</span>",className:s},{html:i.Loc.getMessage("EC_SEC_SLIDER_POPUP_NEW_MENU"),onclick:function e(){t.addBtnMenu.close();t.showEditSectionForm()}},{html:"<span>"+i.Loc.getMessage("EC_SEC_SLIDER_POPUP_EXIST_TITLE")+"</span>",className:s},{html:i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP"),onclick:function e(){t.addBtnMenu.close();t.showTrackingTypesForm()}},{html:i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_USER"),onclick:function e(){t.addBtnMenu.close();t.showTrackingUsersForm()}},{html:i.Loc.getMessage("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP"),onclick:function e(){t.addBtnMenu.close();t.showTrackingGroupsForm()}}];this.addBtnMenu=this.BX.PopupMenu.create("add-btn-"+n.Util.getRandomInt(),this.DOM.addButtonMore,a,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true,cacheable:false});this.addBtnMenu.show()}},{key:"createSectionBlock",value:function e(t){var s=t.sectionList,n=t.wrap;if(i.Type.isArray(s)){var a=n.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}})).appendChild(i.Dom.create("UL",{props:{className:"calendar-list-slider-container"}}));i.Event.bind(a,"click",this.sectionClickHandler.bind(this));s.forEach(function(e){if(!e.DOM){e.DOM={}}var t=e.id.toString();var s=a.appendChild(i.Dom.create("LI",{props:{className:"calendar-list-slider-item"},attrs:{"data-bx-calendar-section":t}}));var n=s.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-item-checkbox"+(e.isShown()?" calendar-list-slider-item-checkbox-checked":"")},style:{backgroundColor:e.color}}));var r=s.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-item-name",title:e.name},text:e.name}));e.DOM.item=s;e.DOM.checkbox=n;e.DOM.title=r;e.DOM.actionCont=s.appendChild(i.Dom.create("DIV",{props:{className:"calendar-list-slider-item-actions-container"},attrs:{"data-bx-calendar-section-menu":t},html:'<span class="calendar-list-slider-item-context-menu"></span>'}))})}}},{key:"sectionClickHandler",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(s&&s.getAttribute){if(s.getAttribute("data-bx-calendar-section-menu")!==null){var i=s.getAttribute("data-bx-calendar-section-menu");i=i==="tasks"?i:parseInt(i);this.showSectionMenu(this.sectionManager.getSection(i),s)}else if(s.getAttribute("data-bx-calendar-section")!==null){this.switchSection(this.sectionManager.getSection(s.getAttribute("data-bx-calendar-section")))}}}},{key:"switchSection",value:function e(t){var s=this.DOM.sectionListWrap.querySelectorAll(".calendar-list-slider-item[data-bx-calendar-section='"+t.id+"'] .calendar-list-slider-item-checkbox");for(var n=0;n<s.length;n++){if(t.isShown()){i.Dom.removeClass(s[n],"calendar-list-slider-item-checkbox-checked")}else{i.Dom.addClass(s[n],"calendar-list-slider-item-checkbox-checked")}}if(t.isShown()){t.hide()}else{t.show()}this.calendarContext.reload()}},{key:"showSectionMenu",value:function e(t,s){var a=this;var r=[];var c=s.closest("[data-bx-calendar-section]");if(i.Type.isElementNode(c)){i.Dom.addClass(c,"active")}if(!t.isPseudo()&&t.getLink()&&!t.belongsToView()){r.push({text:i.Loc.getMessage("EC_SEC_OPEN_LINK"),href:t.getLink()})}if(!this.readonly&&t.canDo("edit_section")&&!t.isPseudo()){r.push({text:i.Loc.getMessage("EC_SEC_EDIT"),onclick:function e(){a.sectionActionMenu.close();a.showEditSectionForm({section:t})}})}if(t.isSuperposed()&&!t.belongsToView()){r.push({text:i.Loc.getMessage("EC_SEC_HIDE"),onclick:function e(){a.hideSuperposedHandler(t);a.sectionActionMenu.close()}})}if(t.canBeConnectedToOutlook()){r.push({text:i.Loc.getMessage("EC_SEC_CONNECT_TO_OUTLOOK"),onclick:function e(){a.sectionActionMenu.close();t.connectToOutlook();a.close()}})}if(!t.isPseudo()&&t.data.EXPORT&&t.data.EXPORT.LINK){r.push({text:i.Loc.getMessage("EC_ACTION_EXPORT"),onclick:function e(){a.sectionActionMenu.close();var s={sectionLink:t.data.EXPORT.LINK,calendarPath:a.calendarContext.util.config.path};if(BX.Calendar.Sync.Interface.IcalSyncPopup.checkPathes(s)){BX.Calendar.Sync.Interface.IcalSyncPopup.createInstance(s).show()}else{BX.Calendar.Sync.Interface.IcalSyncPopup.showPopupWithPathesError()}}})}if(t.canDo("edit_section")&&t.belongsToView()&&!t.isPseudo()){r.push({text:i.Loc.getMessage("EC_SEC_DELETE"),onclick:function e(){a.sectionActionMenu.close();t.remove()}})}if((t.isGoogle()||t.isCalDav())&&t.canDo("edit_section")){r.push({text:i.Loc.getMessage("EC_ACTION_REFRESH"),onclick:function e(){a.sectionActionMenu.close();a.calendarContext.reload({syncGoogle:true});a.close()}});if((t.isGoogle()||t.isCalDav())&&t.canDo("edit_section")){r.push({text:i.Loc.getMessage("EC_ACTION_EXTERNAL_ADJUST"),onclick:function e(){a.sectionActionMenu.close();var s=a.calendarContext.syncInterface.getProviderById(t.data.CAL_DAV_CON),i=babelHelpers.slicedToArray(s,2),n=i[0],r=i[1];if(n){n.openActiveConnectionSlider(r)}}})}r.push({text:i.Loc.getMessage("EC_ACTION_HIDE"),onclick:function e(){a.sectionActionMenu.close();t.hideGoogle()}})}if(t.isPseudo()){r.push({text:i.Loc.getMessage("EC_SEC_EDIT"),onclick:function e(){a.sectionActionMenu.close();a.showEditSectionForm({section:t})}});r.push({text:i.Loc.getMessage("EC_SEC_TASK_HIDE"),onclick:function e(){a.sectionActionMenu.close();BX.userOptions.save("calendar","user_settings","showTasks","N");i.Dom.addClass(t.DOM.item,"calendar-list-slider-item-disappearing");setTimeout(function(){i.Dom.clean(t.DOM.item,true);BX.reload()},300)}})}if(r&&r.length>0){this.sectionActionMenu=top.BX.PopupMenu.create("section-menu-"+n.Util.getRandomInt(),s,r,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});this.sectionActionMenu.show();this.sectionActionMenu.popupWindow.subscribe("onClose",function(){if(i.Type.isElementNode(c)){i.Dom.removeClass(c,"active")}a.allowSliderClose()});this.denySliderClose()}}},{key:"denySliderClose",value:function e(){this.denyClose=true}},{key:"allowSliderClose",value:function e(){this.denyClose=false}},{key:"closeForms",value:function e(){if(this.addBtnMenu){this.addBtnMenu.close()}if(this.editSectionForm){this.editSectionForm.close()}if(this.trackingUsersForm){this.trackingUsersForm.close()}if(this.trackingGroupsForm){this.trackingGroupsForm.close()}if(this.trackingTypesForm){this.trackingTypesForm.close()}}},{key:"showEditSectionForm",value:function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.closeForms();var a=this.DOM.sectionFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new l({wrap:this.DOM.sectionFormWrap,sectionAccessTasks:this.sectionManager.getSectionAccessTasks(),sectionManager:this.sectionManager,closeCallback:function e(){t.allowSliderClose()}});var r=true;if(s.section&&(!s.section.belongsToView()||s.section.isPseudo())){a.innerHTML=i.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION_PERSONAL");r=false}else if(s.section&&s.section.id){a.innerHTML=i.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION");r=s.section.canDo("access")}else{a.innerHTML=i.Loc.getMessage("EC_SEC_SLIDER_NEW_SECTION")}this.editSectionForm.show({showAccess:r,section:s.section||{color:n.Util.getRandomColor(),access:this.sectionManager.getDefaultSectionAccess()}});this.denySliderClose()}},{key:"showTrackingTypesForm",value:function e(){var t=this;this.closeForms();if(!this.trackingTypesForm){this.trackingTypesForm=new I({wrap:this.DOM.trackingCompanyFormWrap,superposedSections:this.sectionManager.getSuperposedSectionList(),closeCallback:function e(){t.allowSliderClose()}})}this.trackingTypesForm.show();this.denySliderClose()}},{key:"showTrackingUsersForm",value:function e(){var t=this;this.closeForms();if(!this.trackingUsersForm){this.trackingUsersForm=new S({wrap:this.DOM.trackingUsersFormWrap,trackingUsers:this.calendarContext.util.getSuperposedTrackedUsers(),superposedSections:this.sectionManager.getSuperposedSectionList(),closeCallback:function e(){t.allowSliderClose()}})}this.trackingUsersForm.show();this.denySliderClose()}},{key:"showTrackingGroupsForm",value:function e(){var t=this;this.closeForms();if(!this.trackingGroupsForm){var s=this.sectionManager.getSuperposedSectionList();var i=this.calendarContext.util.getSuperposedTrackedGroups();s.forEach(function(e){if(e.getType()==="group"&&!i.includes(e.getOwnerId())){i.push(e.getOwnerId())}});this.trackingGroupsForm=new k({wrap:this.DOM.trackingGroupsFormWrap,trackingGroups:i,superposedSections:s,closeCallback:function e(){t.allowSliderClose()}})}this.trackingGroupsForm.show();this.denySliderClose()}},{key:"deleteSectionHandler",value:function e(t){var s=this;if(t&&t instanceof n.Util.getBX().Event.BaseEvent){var a=t.getData();var r=parseInt(a.sectionId,10);this.sliderSections.forEach(function(e,t){if(parseInt(e.id)===r&&e.DOM&&e.DOM.item){i.Dom.addClass(e.DOM.item,"calendar-list-slider-item-disappearing");setTimeout(function(){i.Dom.clean(e.DOM.item,true);s.sliderSections=BX.util.deleteFromArray(s.sliderSections,t)},300)}},this)}}},{key:"hideSuperposedHandler",value:function e(t){var s=this.sectionManager.getSuperposedSectionList();var i=[];var a;for(a=0;a<s.length;a++){if(parseInt(t.id)!==parseInt(s[a].id)){i.push(parseInt(s[a].id))}}BX.ajax.runAction("calendar.api.calendarajax.setTrackingSections",{data:{sections:i}}).then(function(e){BX.reload()},function(e){n.Util.displayError(e.errors)})}},{key:"refreshSectionList",value:function e(){this.createSectionList()}}]);return t}(t.EventEmitter);e.SectionInterface=L})(this.BX.Calendar=this.BX.Calendar||{},BX.Event,BX.UI.EntitySelector,BX,BX.Calendar);
//# sourceMappingURL=sectioninterface.bundle.map.js