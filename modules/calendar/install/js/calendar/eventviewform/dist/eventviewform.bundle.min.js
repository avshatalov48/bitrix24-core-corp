this.BX=this.BX||{};(function(e,t,i,n,s,r){"use strict";var o=function(){function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"permissions",{});babelHelpers.defineProperty(this,"name","eventviewform");babelHelpers.defineProperty(this,"uid",null);babelHelpers.defineProperty(this,"DOM",{});this.type=i.type||"user";this.ownerId=i.ownerId||0;this.userId=i.userId||0;this.sliderId="calendar:view-entry-slider";this.zIndex=3100;this.entryId=i.entryId||null;this.entryDateFrom=i.entryDateFrom||null;this.timezoneOffset=i.timezoneOffset||null;this.BX=t.Util.getBX();this.sliderOnClose=this.hide.bind(this);this.sliderOnLoad=this.onLoadSlider.bind(this)}babelHelpers.createClass(e,[{key:"initInSlider",value:function e(t,n){this.BX.addCustomEvent(t,"SidePanel.Slider:onLoad",this.sliderOnLoad);this.BX.addCustomEvent(t,"SidePanel.Slider:onClose",this.sliderOnClose);this.BX.addCustomEvent(t,"SidePanel.Slider:onCloseComplete",this.BX.proxy(this.destroy,this));this.createContent(t).then(function(e){if(i.Type.isFunction(n)){n(e)}}.bind(this));this.opened=true}},{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(t.entryId){this.entryId=t.entryId}this.BX.SidePanel.Instance.open(this.sliderId,{contentCallback:this.createContent.bind(this),label:{text:i.Loc.getMessage("CALENDAR_EVENT"),bgColor:"#55D0E0"},events:{onClose:this.sliderOnClose,onCloseComplete:this.destroy.bind(this),onLoad:this.sliderOnLoad}});this.opened=true}},{key:"isOpened",value:function e(){return this.opened}},{key:"hide",value:function e(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){this.BX.removeCustomEvent("SidePanel.Slider::onClose",this.sliderOnClose)}}},{key:"destroy",value:function e(n){this.BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",this.BX.proxy(this.destroy,this));i.Event.unbind(document,"click",t.Util.applyHacksForPopupzIndex);this.BX.SidePanel.Instance.destroy(this.sliderId);t.Util.closeAllPopups();this.opened=false}},{key:"onLoadSlider",value:function e(t){var i=t.getSlider();this.DOM.content=i.layout.content;this.BX.html(i.layout.content,i.getData().get("sliderContent"));this.initControls(this.uid);this.setFormValues()}},{key:"createContent",value:function e(n){var s=this;return new Promise(function(e){s.BX.ajax.runAction("calendar.api.calendarajax.getViewEventSlider",{data:{entryId:s.entryId,dateFrom:t.Util.formatDate(s.entryDateFrom),timezoneOffset:s.timezoneOffset}}).then(function(t){var s="";if(i.Type.isFunction(n.isOpen)&&n.isOpen()||n.isOpen===true){s=this.BX.util.trim(t.data.html);n.getData().set("sliderContent",s);var r=t.data.additionalParams;this.uid=r.uniqueId;this.entryUrl=r.entryUrl;this.handleEntryData(r.entry,r.userIndex,r.section)}e(s)}.bind(s),function(t){this.displayError(t.errors);e(t)}.bind(s))})}},{key:"initControls",value:function e(o){var a=this;this.DOM.title=this.DOM.content.querySelector("#".concat(o,"_title"));this.DOM.formWrap=this.DOM.content.querySelector("#".concat(o,"_form_wrap"));this.DOM.form=this.DOM.content.querySelector("#".concat(o,"_form"));this.DOM.buttonSet=this.DOM.content.querySelector("#".concat(o,"_buttonset"));this.DOM.editButton=this.DOM.content.querySelector("#".concat(o,"_but_edit"));this.DOM.delButton=this.DOM.content.querySelector("#".concat(o,"_but_del"));this.DOM.sidebarInner=this.DOM.content.querySelector("#".concat(o,"_sidebar_inner"));if(this.DOM.buttonSet){this.initPlannerControl(o);this.initUserListControl(o)}if(this.DOM.content.querySelector("#".concat(o,"_time_inner_wrap")).offsetHeight>50){this.BX.addClass(this.DOM.content.querySelector("#".concat(o,"_time_wrap")),"calendar-slider-sidebar-head-long-time")}if(this.canDo(this.entry,"edit")&&this.DOM.editButton){i.Event.bind(this.DOM.editButton,"click",function(){a.BX.SidePanel.Instance.close(false,function(){n.EntryManager.openEditSlider({entry:this.entry,type:this.type,ownerId:this.ownerId,userId:this.userId})}.bind(a))})}else{this.BX.remove(this.DOM.editButton)}if(this.DOM.sidebarInner){this.DOM.reminderWrap=this.DOM.sidebarInner.querySelector(".calendar-slider-sidebar-remind-wrap");if(i.Type.isDomNode(this.DOM.reminderWrap)){var d=!this.canDo(this.entry,"edit")&&this.entry.getCurrentStatus()===false;this.reminderControl=new s.Reminder({wrap:this.DOM.reminderWrap,zIndex:this.zIndex,viewMode:d});this.reminderControl.setValue(this.entry.getReminders());if(!d){this.reminderControl.subscribe("onChange",function(e){if(e instanceof r.BaseEvent){this.reminderValues=e.getData().values;this.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:this.entry.id,userId:this.userId,reminders:this.reminderValues}}).then(function(e){}.bind(this),function(e){}.bind(this))}}.bind(this))}}var l=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(l.length>=2){this.BX.removeClass(l[l.length-1],"calendar-slider-sidebar-border-bottom")}}if(this.canDo(this.entry,"delete")){i.Event.bind(this.DOM.delButton,"click",function(){n.EntryManager.deleteEntry(this.entry)}.bind(this))}else{this.BX.remove(this.DOM.delButton)}this.BX.viewElementBind(o+"_"+this.entry.id+"_files_wrap",{showTitle:true},function(e){return i.Type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))});if(this.entry&&this.entry.isMeeting()){this.initAcceptMeetingControl(o)}if(this.DOM.sidebarInner){var h=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(h.length>=2){this.BX.removeClass(h[h.length-1],"calendar-slider-sidebar-border-bottom")}}this.DOM.copyButton=this.DOM.content.querySelector("#".concat(o,"_copy_url_btn"));if(this.DOM.copyButton){i.Event.bind(this.DOM.copyButton,"click",this.copyEventUrl.bind(this))}i.Event.unbind(document,"click",t.Util.applyHacksForPopupzIndex);i.Event.bind(document,"click",t.Util.applyHacksForPopupzIndex)}},{key:"setFormValues",value:function e(){}},{key:"handleEntryData",value:function e(t,s,r){this.entry=new n.Entry({data:t,userIndex:s});if(i.Type.isPlainObject(r)){this.permissions=r.PERM}}},{key:"initPlannerControl",value:function e(t){var n=this;this.plannerId=t+"_view_slider_planner";this.DOM.plannerWrap=this.DOM.content.querySelector("#".concat(t,"_view_planner_wrap"));setTimeout(function(){if(this.DOM.plannerWrap){this.BX.removeClass(this.DOM.plannerWrap,"hidden")}}.bind(this),500);setTimeout(function(){if(n.DOM.plannerWrap&&n.DOM.plannerWrap.offsetWidth){n.BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:n.plannerId,timeoutCheck:true,width:n.DOM.plannerWrap.offsetWidth}])}},200);i.Event.bind(window,"resize",function(){if(n.DOM.plannerWrap&&n.DOM.plannerWrap.offsetWidth){n.BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:n.plannerId,timeoutCheck:true,width:n.DOM.plannerWrap.offsetWidth}])}})}},{key:"initUserListControl",value:function e(t){var n=this;var s={y:[],i:[],q:[],n:[]};if(this.entry.isMeeting()){this.entry.getAttendees().forEach(function(e){if(e.STATUS==="H"){s.y.push(e)}else if(s[e.STATUS.toLowerCase()]){s[e.STATUS.toLowerCase()].push(e)}},this)}this.DOM.attendeesListY=this.DOM.content.querySelector("#".concat(t,"_attendees_y"));this.DOM.attendeesListN=this.DOM.content.querySelector("#".concat(t,"_attendees_n"));this.DOM.attendeesListQ=this.DOM.content.querySelector("#".concat(t,"_attendees_q"));this.DOM.attendeesListI=this.DOM.content.querySelector("#".concat(t,"_attendees_i"));i.Event.bind(this.DOM.attendeesListY,"click",function(){n.showUserListPopup(n.DOM.attendeesListY,s.y)});i.Event.bind(this.DOM.attendeesListN,"click",function(){n.showUserListPopup(n.DOM.attendeesListN,s.n)});i.Event.bind(this.DOM.attendeesListQ,"click",function(){n.showUserListPopup(n.DOM.attendeesListQ,s.q)});i.Event.bind(this.DOM.attendeesListI,"click",function(){n.showUserListPopup(n.DOM.attendeesListI,s.i)})}},{key:"showUserListPopup",value:function e(t,i){var n=this;if(this.userListPopup){this.userListPopup.close()}if(i&&i.length){this.DOM.userListPopupWrap=this.BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});i.forEach(function(e){var t=this.DOM.userListPopupWrap.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));t.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(this.BX.create("IMG",{props:{width:34,height:34,src:e.AVATAR}}));t.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(this.BX.create("A",{props:{href:e.URL?e.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:e.DISPLAY_NAME}))},this);this.userListPopup=this.BX.PopupWindowManager.create("user-list-popup-"+Math.random(),t,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:220,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup",zIndex:4e3});this.userListPopup.setAngle({offset:36});this.userListPopup.show();this.BX.addCustomEvent(this.userListPopup,"onPopupClose",function(){n.userListPopup.destroy()})}}},{key:"initAcceptMeetingControl",value:function e(t){this.DOM.statusButtonset=this.DOM.content.querySelector("#".concat(t,"_status_buttonset"));if(this.entry.getCurrentStatus()==="H"){i.Dom.remove(this.DOM.statusButtonset)}else{this.setStatus=new s.MeetingStatusControl({wrap:this.DOM.statusButtonset,currentStatus:this.DOM.content.querySelector("#".concat(t,"_current_status")).value||this.entry.getCurrentStatus()});this.setStatus.subscribe("onSetStatus",function(e){if(e instanceof r.BaseEvent){var t=e.getData();n.EntryManager.setMeetingStatus(this.entry,t.status)}}.bind(this))}}},{key:"copyEventUrl",value:function e(){if(!this.entryUrl||!this.BX.clipboard.copy(this.entryUrl)){return}this.timeoutIds=this.timeoutIds||[];var t=new this.BX.PopupWindow("calendar_clipboard_copy",this.DOM.copyButton,{content:i.Loc.getMessage("CALENDAR_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,cachable:false});t.show();var n;while(n=this.timeoutIds.pop()){clearTimeout(n)}this.timeoutIds.push(setTimeout(function(){t.close()},1500))}},{key:"displayError",value:function e(){}},{key:"canDo",value:function e(t,i){if(i==="edit"||i==="delete"){if(t.isMeeting()&&t.id!==t.parentId||t.isResourcebooking()){return false}return this.permissions.edit}if(i==="view"){return this.permissions.view_full}return false}}]);return e}();e.EventViewForm=o})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar,BX,BX.Calendar,BX.Calendar.Controls,BX.Event);
//# sourceMappingURL=eventviewform.bundle.map.js