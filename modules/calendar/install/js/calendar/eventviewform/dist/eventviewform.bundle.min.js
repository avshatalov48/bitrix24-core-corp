this.BX=this.BX||{};(function(t,e,i,s,a,n,r,d,l,o){"use strict";const c={name:"ViewEventSlider",props:["params","reloadPlannerCallback","showUserListPopupCallback"],data(){return{id:this.params.id,eventId:parseInt(this.params.eventId),name:this.params.name,description:this.params.description,timezoneHint:this.params.timezoneHint,timezone:this.params.userTimezone,fromToHtml:this.params.fromToHtml,isMeeting:this.params.isMeeting,meetingHostUrl:this.params.meetingHostUrl,meetingHostDisplayName:this.params.meetingHostDisplayName,meetingHostWorkPosition:this.params.meetingHostWorkPosition,meetingHostAvatar:this.params.meetingHostAvatar,avatarSize:this.params.avatarSize,attendees:this.params.attendees,userList:{y:[],i:[],q:[],n:[]},curUserStatus:this.params.curUserStatus,meetingHostId:this.params.meetingHostId,meetingCreatorUrl:this.params.meetingCreatorUrl,meetingCreatorDisplayName:this.params.meetingCreatorDisplayName,isRemind:this.params.isRemind,isWebdavEvent:this.params.isWebdavEvent,isCrmEvent:this.params.isCrmEvent,isHighImportance:this.params.isHighImportance,isRrule:this.params.isRrule,rruleDescription:this.params.rruleDescription,detailFilesTemplate:this.params.detailFilesTemplate,accessibility:this.params.accessibility,isIntranetEnabled:this.params.isIntranetEnabled,isPrivate:this.params.isPrivate,location:this.params.location,canEditCalendar:this.params.canEditCalendar,showComments:this.params.showComments,filesView:this.getComponentHTML(this.params.filesView),crmView:this.getComponentHTML(this.params.crmView),entry:new r.Entry({data:this.params.entry,userIndex:this.params.userIndex}),updateParamsDebounce:d.Runtime.debounce(this.updateParams,500,this),hasPulls:false,backgroundPullEvent:null}},mounted(){if(this.params.eventExists){this.updateUserList();if(this.showComments){this.loadCommentsView()}if(this.isWebdavEvent){this.executeScripts(this.$refs.filesView)}d.Event.bind(document,"visibilitychange",this.handleBackgroundPulls)}},beforeMount(){if(this.params.eventExists){l.EventEmitter.subscribe("onPullEvent-calendar",this.handlePullEvent)}},beforeUnmount(){if(this.params.eventExists){l.EventEmitter.unsubscribe("onPullEvent-calendar",this.handlePullEvent)}},methods:{getComponentHTML(t){if(!t){return""}return JSON.parse(t).data.html},loadCommentsView(){BX.ajax.runAction("calendar.api.calendareventviewform.getCommentsView",{data:{signedEvent:this.params.signedEvent}}).then((t=>{const e=document.createElement("div");e.innerHTML=t.data.html;this.$refs.commentsView.appendChild(e);this.executeScripts(this.$refs.commentsView)}))},executeScripts(t){if(!t){return}const e=t.querySelectorAll("script");for(const t of e){const e=document.createElement("script");e.innerHTML=t.innerHTML;t.parentNode.appendChild(e);t.remove()}},updateUserList(){this.userList={y:[],i:[],q:[],n:[]};if(this.entry.isMeeting()){this.entry.getAttendees().forEach((function(t){if(t.STATUS==="H"){this.userList.y.push(t)}else if(this.userList[t.STATUS.toLowerCase()]){this.userList[t.STATUS.toLowerCase()].push(t)}}),this)}},reloadPlanner(){const t={entryId:this.entry.id||0,entryLocation:this.entry.data.LOCATION||"",ownerId:0,hostId:this.entry.getMeetingHost(),type:"user",entityList:this.entry.getAttendeesEntityList(),dateFrom:n.Util.formatDate(this.entry.from.getTime()-n.Util.getDayLength()*3),dateTo:n.Util.formatDate(this.entry.to.getTime()+n.Util.getDayLength()*10),timezone:this.timezone,location:this.entry.getLocation(),entry:this.entry};this.reloadPlannerCallback(t)},handleBackgroundPulls(){if(this.hasPulls){this.updateParamsDebounce(this.backgroundPullEvent);this.hasPulls=false}},handlePullEvent(t){if(t.data[1].fields.CAL_TYPE==="location"){return}if(BX.Calendar.Util.documentIsDisplayingNow()){this.updateParamsDebounce(t)}else{this.hasPulls=true;this.backgroundPullEvent=t}},updateParams(t){if(parseInt(t.data[1].fields.PARENT_ID)!==parseInt(this.params.parentId)){this.reloadPlanner();return}const e=t.data[1].fields;this.name=e.NAME;this.accessibility=e.ACCESSIBILITY;BX.ajax.runAction("calendar.api.calendareventviewform.getCalendarViewSliderParams",{data:{entryId:this.eventId,dateFrom:n.Util.formatDate(e.DATE_FROM),timezoneOffset:e.TZ_OFFSET_FROM}}).then((t=>{const e=t.data;this.description=e.description;this.isMeeting=e.isMeeting;this.timezone=e.userTimezone;this.timezoneHint=e.timezoneHint;this.fromToHtml=e.fromToHtml;this.meetingHostUrl=e.meetingHostUrl;this.meetingHostDisplayName=e.meetingHostDisplayName;this.meetingHostWorkPosition=e.meetingHostWorkPosition;this.meetingHostAvatar=e.meetingHostAvatar;this.avatarSize=e.avatarSize;this.attendees=e.attendees;this.meetingHostId=e.meetingHostId;this.meetingCreatorUrl=e.meetingCreatorUrl;this.meetingCreatorDisplayName=e.meetingCreatorDisplayName;this.isRemind=e.isRemind;this.isWebdavEvent=e.isWebdavEvent;this.isCrmEvent=e.isCrmEvent;this.isHighImportance=e.isHighImportance;this.isRrule=e.isRrule;this.rruleDescription=e.rruleDescription;this.detailFilesTemplate=e.detailFilesTemplate;this.isIntranetEnabled=e.isIntranetEnabled;this.isPrivate=e.isPrivate;this.location=e.location;this.canEditCalendar=e.canEditCalendar;this.showComments=e.showComments;this.filesView=this.getComponentHTML(e.filesView);if(this.filesView){setTimeout((()=>{this.executeScripts(this.$refs.filesView)}),1e3)}this.crmView=this.getComponentHTML(e.crmView);this.entry=new r.Entry({data:e.entry,userIndex:e.userIndex});this.updateUserList();this.reloadPlanner()}))},highlightChange(t){if(!t){return}const e=t.style.opacity;const i=t.style.transition;t.style.opacity="0.2";setTimeout((()=>{t.style.transition="1s";t.style.opacity=e;setTimeout((()=>{t.style.transition=i}),1e3)}),100)}},watch:{name:{handler(t,e){this.highlightChange(this.$refs.highlightName)}},fromToHtml:{handler(t,e){this.highlightChange(this.$refs.highlightFromTo)}},description:{handler(t,e){this.highlightChange(this.$refs.highlightDescription)}},crmView:{handler(t,e){this.highlightChange(this.$refs.highlightCrmView)}},location:{handler(t,e){this.highlightChange(this.$refs.highlightLocation)}},accessibility:{handler(t,e){this.highlightChange(this.$refs.highlightAccessibility)}}},template:`\n\t\t<div class="ui-alert ui-alert-danger ui-alert-icon-danger ui-alert-text-center" v-if="!params.eventExists">\n\t\t\t<span class="ui-alert-message">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_EVENT_NOT_FOUND')}}</span>\n\t\t</div>\n\t\t<div class="calendar-slider-calendar-wrap" v-else>\n\t\t\t<div class="calendar-slider-header">\n\t\t\t\t<div class="calendar-head-area">\n\t\t\t\t\t<div class="calendar-head-area-inner">\n\t\t\t\t\t\t<div class="calendar-head-area-title">\n\t\t\t\t\t\t\t<span :id="id + '_title'" class="calendar-head-area-title-name" ref="highlightName">{{name}}</span>\n\t\t\t\t\t\t\t<span :id="id + '_copy_url_btn'" class="calendar-page-link-btn" :title="$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COPY_LINK')"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="calendar-slider-workarea">\n\t\t\t\t<div class="calendar-slider-sidebar">\n\t\t\t\t\t<div :id="id + '_time_wrap'" class="calendar-slider-sidebar-head" :title="timezoneHint" ref="highlightFromTo">\n\t\t\t\t\t\t<div :id="id + '_time_inner_wrap'" class="calendar-slider-sidebar-head-title">{{fromToHtml}}\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-head-timezone" :title="timezoneHint" v-if="timezoneHint">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-head-timezone-icon"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :id="id + '_sidebar_inner'" class="calendar-slider-sidebar-inner">\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-videocall" style="display: none;"></div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout calendar-slider-sidebar-user">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-top calendar-slider-sidebar-user-top calendar-slider-sidebar-border-bottom">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-left-side">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-name">\n\t\t\t\t\t\t\t\t\t\t<span v-if="isMeeting">{{$Bitrix.Loc.getMessage('EC_VIEW_ATTENDEES_TITLE')}}</span>\n\t\t\t\t\t\t\t\t\t\t<span v-else>{{$Bitrix.Loc.getMessage('EC_VIEW_HOST')}}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-right-side" :id="id + '_add_link'" style="display: none;">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-property calendar-slider-sidebar-link-user">\n\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_ATTENDEES_ADD')}}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-main">\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block">\n\t\t\t\t\t\t\t\t<div v-if="isMeeting">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar">\n\t\t\t\t\t\t\t\t\t\t\t<a :href="meetingHostUrl">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-top"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-item">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img :src="encodeURI(meetingHostAvatar)" :width="avatarSize" :height="avatarSize"/>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container" v-for="att in attendees.y.slice(0,10)">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar" v-if="meetingHostId != att.ID">\n\t\t\t\t\t\t\t\t\t\t\t<a :href="att.URL">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-item">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img :src="encodeURI(att.AVATAR)" :width="avatarSize" :height="avatarSize"/>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-row calendar-slider-sidebar-border-bottom" v-if="meetingCreatorUrl">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_VIEW_CREATED_BY')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-value">\n\t\t\t\t\t\t\t\t\t\t\t<a :href="meetingCreatorUrl" class="calendar-slider-sidebar-user-info-name">{{meetingCreatorDisplayName}}</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card" v-else>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar">\n\t\t\t\t\t\t\t\t\t\t<a :href="meetingHostUrl">\n\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-item">\n\t\t\t\t\t\t\t\t\t\t\t\t<img :src="encodeURI(meetingHostAvatar)" :width="avatarSize" :height="avatarSize" alt="host"/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-info">\n\t\t\t\t\t\t\t\t\t\t<a :href="meetingHostUrl" class="calendar-slider-sidebar-user-info-name">{{meetingHostDisplayName}}</a>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-info-status" v-if="meetingHostWorkPosition">{{meetingHostWorkPosition}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social calendar-slider-sidebar-border-bottom" v-if="isMeeting">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-left">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesY"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesY, userList.y)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.y.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_Y')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesQ"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesQ, userList.q)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.q.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_Q')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-right">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" style="visibility: hidden;" ref="attendeesI"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesI, userList.i)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.i.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_I')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesN"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesN, userList.n)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.n.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_N')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-main calendar-slider-sidebar-border-bottom calendar-slider-sidebar-remind" v-if="isRemind">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-row">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_VIEW_REMINDERS')}}:</div>\n\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-remind-link calendar-slider-sidebar-string-value" :id="id + '_add_reminder_link'" style="display: none;">\n\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-remind-link-name">{{$Bitrix.Loc.getMessage('EC_VIEW_REMINDER_ADD')}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-remind-wrap"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-row calendar-slider-sidebar-border-bottom" v-if="isRrule">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_T_REPEAT')}}:</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-value">{{rruleDescription}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-slider-sidebar-copy" style="display: none;">\n\t\t\t\t\t\t<span class="calendar-slider-sidebar-copy-link">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COPY_LINK')}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-slider-content">\n\t\t\t\t\t<div class="calendar-slider-detail calendar-slider-detail-panel">\n\t\t\t\t\t\t<div class="calendar-slider-detail-info">\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-header">\n\t\t\t\t\t\t\t\t<div id="calendar-slider-detail-important-button" class="calendar-slider-info-panel-important mutable" v-if="isHighImportance">\n\t\t\t\t\t\t\t\t\t<span class="if-not-no">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_IMPORTANT_EVENT')}}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-subtitle-status" style="visibility: hidden">\n\t\t\t\t\t\t\t\t\t#calendar-slider-detail-subtitle-status#\n\t\t\t\t\t\t\t\t\t<span class="calendar-slider-detail-status-below-name"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-content">\n\t\t\t\t\t\t\t\t<div id="calendar-slider-detail-description" class="calendar-slider-detail-description" v-if="description"\n\t\t\t\t\t\t\t\t\t ref="highlightDescription" v-html="description">\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-files" :id="id + '_' + eventId + '_files_wrap'" v-if="isWebdavEvent">\n\t\t\t\t\t\t\t\t\t<div v-html="filesView" ref="filesView"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-timeline hidden" :id="id + '_view_planner_wrap'">\n\t\t\t\t\t\t\t\t\t<div class="calendar-view-planner-wrap"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="isCrmEvent" ref="highlightCrmView">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_CRM_TITLE')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value calendar-slider-detail-option-crm">\n\t\t\t\t\t\t\t\t\t\t\t<div v-html="crmView"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="accessibility && isIntranetEnabled" ref="highlightAccessibility">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_ACCESSIBILITY_TITLE')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value">{{$Bitrix.Loc.getMessage('EC_ACCESSIBILITY_' + accessibility.toUpperCase())}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="isPrivate && isIntranetEnabled">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_EDDIV_SPECIAL_NOTES')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value">{{$Bitrix.Loc.getMessage('EC_PRIVATE_EVENT')}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place" v-if="location" ref="highlightLocation">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place-title">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_LOCATION')}}</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place-name">{{location}}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-buttons">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-view-buttonset calendar-slider-view-button-more-right">\n\t\t\t\t\t\t\t\t\t<div :id="id + '_buttonset'" class="calendar-slider-view-buttonset-inner">\n\t\t\t\t\t\t\t\t\t\t<input type="hidden" :id="id + '_current_status'" :value="curUserStatus"/>\n\t\t\t\t\t\t\t\t\t\t<span :id="id + '_status_buttonset'"></span>\n\n\t\t\t\t\t\t\t\t\t\t<div v-if="canEditCalendar">\n\t\t\t\t\t\t\t\t\t\t\t<button :id="id + '_but_edit'" class="ui-btn ui-btn-light-border">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_EDIT')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t<button :id="id + '_but_del'" class="ui-btn ui-btn-light-border">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_DEL')}}</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="calendar-slider-comments" v-if="showComments">\n\t\t\t\t\t\t\t<div class="calendar-slider-comments-title">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COMMENTS')}}</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-comments-main" :id="id + 'comments-cont'" style="opacity: 1;">\n\t\t\t\t\t\t\t\t<div ref="commentsView"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};class h{constructor(t={}){this.permissions={};this.name="eventviewform";this.uid=null;this.DOM={};this.RELOAD_REQUESTED="RELOAD_REQUESTED";this.RELOAD_FINISHED="RELOAD_FINISHED";this.reloadStatus=null;this.entityChanged=false;this.LOAD_DELAY=500;this.app=null;this.type=t.type||"user";this.ownerId=t.ownerId||0;this.userId=t.userId||0;this.zIndex=3100;this.entryId=t.entryId||null;this.calendarContext=t.calendarContext||null;this.entryDateFrom=t.entryDateFrom||null;this.timezoneOffset=t.timezoneOffset||null;this.BX=n.Util.getBX();this.sliderOnLoad=this.onLoadSlider.bind(this);this.showUserListPopupBind=this.showUserListPopup.bind(this);this.keyHandlerBind=this.keyHandler.bind(this);this.destroyBind=this.destroy.bind(this);this.loadPlannerDataDebounce=d.Runtime.debounce(this.loadPlannerData,this.LOAD_DELAY,this);this.pullEventList=new Set}initInSlider(t,e){this.slider=t;l.EventEmitter.subscribe(t,"SidePanel.Slider:onLoad",this.sliderOnLoad);l.EventEmitter.subscribe(t,"SidePanel.Slider:onCloseComplete",this.destroyBind);d.Event.bind(document,"keydown",this.keyHandlerBind);this.createContent(t).then(function(t){if(d.Type.isFunction(e)){e(t)}}.bind(this));this.opened=true}isOpened(){return this.opened}destroy(){l.EventEmitter.unsubscribe(this.slider,"SidePanel.Slider:onLoad",this.sliderOnLoad);l.EventEmitter.unsubscribe(this.slider,"SidePanel.Slider:onCloseComplete",this.destroyBind);d.Event.unbind(document,"keydown",this.keyHandlerBind);this.app.unmount();if(this.intranetControllButton&&this.intranetControllButton.destroy){this.intranetControllButton.destroy()}n.Util.closeAllPopups();this.opened=false}onLoadSlider(t){var e;if(!t instanceof l.BaseEvent){return}const i=t.getData();const s=(e=i[0])==null?void 0:e.slider;this.DOM.content=s.layout.content;this.BX.html(s.layout.content,s.getData().get("sliderContent"));if(!d.Type.isNull(this.uid)){this.initControls(this.uid)}this.reloadStatus=this.RELOAD_FINISHED}loadComponentAssets(t){if(!t){return}let e=JSON.parse(t).data.assets;let i=new Promise((function(t,i){let s=e.css;BX.load(s,(function(){BX.loadScript(e.js,t)}))}));i.then((function(){let t=e.string;let i=t.join("\n");BX.html(document.head,i,{useAdjacentHTML:true})}))}createContent(t){return new Promise((e=>{this.BX.ajax.runAction("calendar.api.calendareventviewform.getCalendarViewSliderParams",{analyticsLabel:{calendarAction:"view_event",formType:"full"},data:{entryId:this.entryId,dateFrom:n.Util.formatDate(this.entryDateFrom),timezoneOffset:this.timezoneOffset}}).then((i=>{const s=document.createElement("div");if(d.Type.isFunction(t.isOpen)&&t.isOpen()||t.isOpen===true){let e=i.data;e.eventExists=!!e.entry.ID;if(e.filesView){this.loadComponentAssets(e.filesView)}if(e.crmView){this.loadComponentAssets(e.crmView);this.BX.ajax.runAction("calendar.api.calendareventviewform.getCrmView",{data:{signedEvent:e.signedEvent}})}this.app=a.BitrixVue.createApp(c,{params:e,reloadPlannerCallback:this.loadPlannerDataDebounce,showUserListPopupCallback:this.showUserListPopupBind});this.app.mount(s);t.sliderContent=s;this.userId=e.userId;this.uid=e.id;this.entryUrl=e.entryUrl;this.userTimezone=e.userTimezone;this.dayOfWeekMonthFormat=e.dayOfWeekMonthFormat;this.plannerFeatureEnabled=!!e.plannerFeatureEnabled;if(this.planner&&!this.plannerFeatureEnabled){this.planner.lock()}this.handleEntryData(e.entry,e.userIndex,e.section)}e(s)}),(i=>{if(i.errors&&i.errors.length){t.getData().set("sliderContent",'<div class="calendar-slider-alert">'+'<div class="calendar-slider-alert-inner">'+'<div class="calendar-slider-alert-img"></div>'+'<h1 class="calendar-slider-alert-text">'+d.Text.encode(i.errors[0].message)+"</h1>"+"</div>"+"</div>")}this.displayError(i.errors);e(i)}))}))}initControls(t){var e,i;this.DOM.title=this.DOM.content.querySelector(`#${t}_title`);this.DOM.buttonSet=this.DOM.content.querySelector(`#${t}_buttonset`);this.DOM.editButton=this.DOM.content.querySelector(`#${t}_but_edit`);this.DOM.delButton=this.DOM.content.querySelector(`#${t}_but_del`);this.DOM.sidebarInner=this.DOM.content.querySelector(`#${t}_sidebar_inner`);if(this.DOM.buttonSet){this.initPlannerControl(t)}const a=this.DOM.content.querySelector(`#${t}_time_inner_wrap`);if(d.Type.isElementNode(a)&&a.offsetHeight>50){d.Dom.addClass(this.DOM.content.querySelector(`#${t}_time_wrap`),"calendar-slider-sidebar-head-long-time")}if(this.canDo(this.entry,"edit")&&this.DOM.editButton){d.Event.bind(this.DOM.editButton,"click",(()=>{this.BX.SidePanel.Instance.close(false,function(){r.EntryManager.openEditSlider({entry:this.entry,type:this.type,ownerId:this.ownerId,userId:this.userId})}.bind(this))}))}else{this.BX.remove(this.DOM.editButton)}if(this.DOM.sidebarInner){this.DOM.reminderWrap=this.DOM.sidebarInner.querySelector(".calendar-slider-sidebar-remind-wrap");if(d.Type.isDomNode(this.DOM.reminderWrap)){d.Dom.clean(this.DOM.reminderWrap);let t=!this.canDo(this.entry,"edit")&&this.entry.getCurrentStatus()===false;this.reminderControl=new this.BX.Calendar.Controls.Reminder({wrap:this.DOM.reminderWrap,zIndex:this.zIndex,viewMode:t});this.reminderControl.setValue(this.entry.getReminders());if(!t){this.reminderControl.subscribe("onChange",(t=>{if(t instanceof l.BaseEvent){this.handleEntityChanges();this.reminderValues=t.getData().values;this.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:this.entry.id,userId:this.userId,reminders:this.reminderValues}})}}))}}let t=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(t.length>=2){this.BX.removeClass(t[t.length-1],"calendar-slider-sidebar-border-bottom")}}if(this.canDo(this.entry,"delete")){d.Event.bind(this.DOM.delButton,"click",(()=>{l.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(()=>{this.BX.SidePanel.Instance.close()}));r.EntryManager.deleteEntry(this.entry,this.calendarContext)}))}else{this.BX.remove(this.DOM.delButton)}this.BX.viewElementBind(t+"_"+this.entry.id+"_files_wrap",{showTitle:true},(function(t){return d.Type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}));if(this.entry&&this.entry.isMeeting()){this.initAcceptMeetingControl(t)}if(this.DOM.sidebarInner){let t=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(t.length>=2){this.BX.removeClass(t[t.length-1],"calendar-slider-sidebar-border-bottom")}}this.DOM.copyButton=this.DOM.content.querySelector(`#${t}_copy_url_btn`);if(this.DOM.copyButton){d.Event.bind(this.DOM.copyButton,"click",this.copyEventUrl.bind(this))}this.DOM.videoCall=this.DOM.sidebarInner.querySelector(".calendar-slider-sidebar-videocall");d.Dom.clean(this.DOM.videoCall);if((e=BX)!=null&&(i=e.Intranet)!=null&&i.ControlButton&&d.Type.isElementNode(this.DOM.videoCall)&&this.entry.getCurrentStatus()!==false){this.DOM.videoCall.style.display="";this.intranetControllButton=new s.ControlButton({container:this.DOM.videoCall,entityType:"calendar_event",entityId:this.entry.parentId,entityData:{dateFrom:n.Util.formatDate(this.entry.from),parentId:this.entry.parentId},analyticsLabel:{formType:"full"}})}else{this.DOM.videoCall.style.display="none"}}handleEntryData(t,e,i){this.entry=new r.Entry({data:t,userIndex:e});this.section=new o.CalendarSection(i);if(d.Type.isPlainObject(i)){this.permissions=i.PERM}r.EntryManager.registerEntrySlider(this.entry,this)}initPlannerControl(t){this.plannerId=t+"_view_slider_planner";this.DOM.plannerWrapOuter=this.DOM.content.querySelector(`.calendar-slider-detail-timeline`);this.DOM.plannerWrap=this.DOM.plannerWrapOuter.querySelector(`.calendar-view-planner-wrap`);d.Dom.clean(this.DOM.plannerWrap);this.planner=new i.Planner({wrap:this.DOM.plannerWrap,minWidth:parseInt(this.DOM.plannerWrap.offsetWidth),solidStatus:true,readonly:true,locked:!this.plannerFeatureEnabled,dayOfWeekMonthFormat:this.dayOfWeekMonthFormat});this.planner.show();this.planner.showLoader();setTimeout((()=>{if(this.DOM.plannerWrapOuter){d.Dom.removeClass(this.DOM.plannerWrapOuter,"hidden")}}),500);const e={entryId:this.entry.id||0,entryLocation:this.entry.data.LOCATION||"",ownerId:this.ownerId,hostId:this.entry.getMeetingHost(),type:this.type,entityList:this.entry.getAttendeesEntityList(),dateFrom:n.Util.formatDate(this.entry.from.getTime()-n.Util.getDayLength()*3),dateTo:n.Util.formatDate(this.entry.to.getTime()+n.Util.getDayLength()*10),timezone:this.userTimezone,location:this.entry.getLocation(),entry:this.entry};this.loadPlannerDataDebounce(e)}showUserListPopup(t,e){if(this.userListPopup){this.userListPopup.close()}if(e&&e.length){this.DOM.userListPopupWrap=this.BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});e.forEach((function(t){let e=this.DOM.userListPopupWrap.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));e.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(this.BX.create("IMG",{props:{width:34,height:34,src:t.AVATAR}}));e.appendChild(this.BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(this.BX.create("A",{props:{href:t.URL?t.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:t.DISPLAY_NAME}))}),this);this.userListPopup=this.BX.PopupWindowManager.create("user-list-popup-"+Math.random(),t,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup",zIndex:4e3});this.userListPopup.setAngle({offset:36});this.userListPopup.show();this.BX.addCustomEvent(this.userListPopup,"onPopupClose",(()=>{this.userListPopup.destroy()}))}}initAcceptMeetingControl(t){this.DOM.statusButtonset=this.DOM.content.querySelector(`#${t}_status_buttonset`);this.DOM.statusButtonset.style.marginRight="12px";if(this.entry.getCurrentStatus()==="H"||this.entry.getCurrentStatus()===false){d.Dom.remove(this.DOM.statusButtonset)}else{this.statusControl=new e.MeetingStatusControl({wrap:this.DOM.statusButtonset,currentStatus:this.DOM.content.querySelector(`#${t}_current_status`).value||this.entry.getCurrentStatus()});this.statusControl.subscribe("onSetStatus",(t=>{if(t instanceof l.BaseEvent){this.handleEntityChanges();r.EntryManager.setMeetingStatus(this.entry,t.getData().status).then((()=>{this.statusControl.setStatus(this.entry.getCurrentStatus(),false);this.statusControl.updateStatus()}))}}))}}copyEventUrl(){if(!this.entryUrl||!this.BX.clipboard.copy(this.entryUrl)){return}this.timeoutIds=this.timeoutIds||[];let t=new this.BX.PopupWindow("calendar_clipboard_copy",this.DOM.copyButton,{content:d.Loc.getMessage("CALENDAR_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,cachable:false});t.show();let e;while(e=this.timeoutIds.pop()){clearTimeout(e)}this.timeoutIds.push(setTimeout((function(){t.close()}),1500))}displayError(t=[]){}canDo(t,e){if(e==="edit"||e==="delete"){if(t.isResourcebooking()){return false}return this.section.canDo("edit")}if(e==="view"){return this.permissions.view_full}return false}plannerIsShown(){return this.DOM.plannerWrap&&d.Dom.hasClass(this.DOM.plannerWrap,"calendar-edit-planner-wrap-shown")}loadPlannerData(t){return new Promise((e=>{this.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:t}).then((i=>{this.planner.hideLoader();this.planner.update(i.data.entries,i.data.accessibility);this.planner.updateSelector(n.Util.adjustDateForTimezoneOffset(t.entry.from,t.entry.userTimezoneOffsetFrom,t.entry.fullDay),n.Util.adjustDateForTimezoneOffset(t.entry.to,t.entry.userTimezoneOffsetTo,t.entry.fullDay),t.entry.fullDay);e(i)}),(t=>{e(t)}))}))}keyHandler(t){if(t.keyCode===n.Util.getKeyCode("delete")&&this.canDo(this.entry,"delete")){const t=event.target||event.srcElement;const e=d.Type.isElementNode(t)?t.tagName.toLowerCase():null;if(e&&!["input","textarea"].includes(e)){l.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(()=>{this.BX.SidePanel.Instance.close()}));r.EntryManager.deleteEntry(this.entry,this.calendarContext)}}}handleEntityChanges(){this.entityChanged=true}}t.EventViewForm=h})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar.Controls,BX.Calendar,BX.Intranet,BX.Vue3,BX.Calendar,BX.Calendar,BX,BX.Event,BX.Calendar);
//# sourceMappingURL=eventviewform.bundle.map.js