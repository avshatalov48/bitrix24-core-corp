this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,i,s,a,n,o,l,r,h,d,c,u,p,m){"use strict";class f{constructor(e){this.Z_INDEX=4e3;this.valueList=[];this.DOM={wrap:e.wrap,input:e.input};for(let e=0;e<24;e++){this.valueList.push({value:e*60,label:m.Util.formatTime(e,0)});this.valueList.push({value:e*60+30,label:m.Util.formatTime(e,30)})}this.onChangeCallback=p.Type.isFunction(e.onChangeCallback)?e.onChangeCallback:null;this.selectContol=new c.SelectInput({input:this.DOM.input,zIndex:this.Z_INDEX,values:this.valueList,onChangeCallback:e=>{if(this.onChangeCallback){this.onChangeCallback(this.selectContol.getInputValue(),e.dataValue)}},onPopupShowCallback:()=>p.Dom.addClass(this.DOM.input.parentNode,"active"),onPopupCloseCallback:()=>p.Dom.removeClass(this.DOM.input.parentNode,"active")})}highlightValue(e){this.valueList.forEach((e=>e.selected=false));const t=e.getHours()*60+e.getMinutes();this.selectContol.setValue({value:t});let i=this.valueList.find((e=>e.value===t));if(!i){return}i.selected=true;this.selectContol.setValueList(this.valueList)}updateDurationHints(e,t,i,s){const a=m.Util.parseTime(e);const n=m.Util.parseTime(t);const o=m.Util.parseDate(i);const l=m.Util.parseDate(s);const r=a.h*60+a.m;const h=n.h*60+n.m;const d=i===s;const c=d?this.approximate(r+15,15):0;const u=this.approximate(r+60+15/2,30);this.valueList=[];if(i===s){this.valueList.push(this.getValueElement(r,r,h,o,l))}for(let e=c;e<=24*60;e+=d&&e<u?15:30){this.valueList.push(this.getValueElement(r,e,h,o,l))}this.selectContol.setValueList(this.valueList)}getValueElement(e,t,i,s,a){const n=Math.floor(t/60);const o=t%60;const l=m.Util.formatTime(n,o);const r=this.getStyledDurationHint(e,t,s,a);const h=t===i;return{value:t,label:l,hint:r,selected:h}}getStyledDurationHint(e,t,i,s){const a=this.getDurationHint(e,t,i,s);if(a!==""){return`<div class="menu-popup-item-hint">${a}</div>`}return""}getDurationHint(e,t,i,s){const a=new Date(i.getTime()+e*60*1e3);const n=new Date(s.getTime()+t*60*1e3);const o=n.getTime()-a.getTime();const l=this.approximateFloor(o/(1e3*60*60*24),1);const r=this.approximate(o/(1e3*60*60),.5);const h=this.approximate(o/(1e3*60),1);const d=this.approximate(h,15);if(l>=1){return""}if(h>=60){const e=h!==d?"~":"";return`${e}${this.formatDecimal(r)} ${p.Loc.getMessage("EC_HOUR_SHORT")}`}return`${this.formatDecimal(h)} ${p.Loc.getMessage("EC_MINUTE_SHORT")}`}formatDecimal(e){return`${e}`.replace(".",",")}approximateFloor(e,t){return Math.floor(e/t)*t}approximate(e,t){return Math.round(e/t)*t}}let g=e=>e,D,M,C,E,T,v,O,y;class I extends h.EventEmitter{constructor(e){super();this.defaultReminderTime=540;this.fullDayMode=false;this.extendedMode=true;this.selectedValues=[];this.controlList={};this.viewMode=false;this.DOM={};this.changedByUser=false;this.setEventNamespace("BX.Calendar.Controls.Reminder");this.values=this.getValues();this.id=e.id||"reminder-"+Math.round(Math.random()*1e6);this.zIndex=e.zIndex||3200;this.rawValuesMap=new Map;this.viewMode=e.viewMode===true;this.changeCallack=e.changeCallack;this.showPopupCallBack=e.showPopupCallBack;this.hidePopupCallBack=e.hidePopupCallBack;this.create(e);this.setValue(e.selectedValues||[]);this.bindEventHandlers()}create(e){if(p.Type.isElementNode(e.wrap)){this.DOM.wrap=e.wrap}if(!p.Type.isElementNode(this.DOM.wrap)){return}p.Dom.addClass(this.DOM.wrap,"calendar-notification-values");if(!this.viewMode){this.DOM.addButton=this.DOM.wrap.appendChild(p.Tag.render(D||(D=g`
				<span class="calendar-notification-add-btn-wrap">
					<span class="calendar-notification-text">${0}</span>
					<span class="calendar-notification-btn-container calendar-notification-btn-add">
						<span class="calendar-notification-icon"></span>
					</span>
				</span>`),p.Loc.getMessage("EC_REMIND1_ADD")))}}bindEventHandlers(){if(p.Type.isDomNode(this.DOM.addButton)){p.Event.bind(this.DOM.addButton,"click",this.showPopup.bind(this))}if(p.Type.isDomNode(this.DOM.wrap)){p.Event.bind(this.DOM.wrap,"click",this.handleClick.bind(this))}}getValues(){let e=[];if(!this.fullDayMode){e=e.concat([{value:0,label:p.Loc.getMessage("EC_REMIND1_0"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_0")},{value:5,label:p.Loc.getMessage("EC_REMIND1_5"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_5")},{value:10,label:p.Loc.getMessage("EC_REMIND1_10"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_10")},{value:15,label:p.Loc.getMessage("EC_REMIND1_15"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_15")},{value:20,label:p.Loc.getMessage("EC_REMIND1_20"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_20")},{value:30,label:p.Loc.getMessage("EC_REMIND1_30"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_30")},{value:60,label:p.Loc.getMessage("EC_REMIND1_60"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_60")},{value:120,label:p.Loc.getMessage("EC_REMIND1_120"),shortLabel:p.Loc.getMessage("EC_REMIND1_SHORT_120")}])}if(this.extendedMode){e=e.concat([{id:"time-menu-day-0",label:p.Loc.getMessage("EC_REMIND1_DAY_0"),dataset:{mode:"time-menu",daysBefore:0,time:this.defaultReminderTime}},{id:"time-menu-day-1",label:p.Loc.getMessage("EC_REMIND1_DAY_1"),dataset:{mode:"time-menu",daysBefore:1,time:this.defaultReminderTime}},{id:"time-menu-day-2",label:p.Loc.getMessage("EC_REMIND1_DAY_2"),dataset:{mode:"time-menu",daysBefore:2,time:this.defaultReminderTime}},{id:"custom",label:p.Loc.getMessage("EC_REMIND1_CUSTOM"),dataset:{mode:"custom"}}])}return e}setValue(e,t=true,i=true){this.selectedValues.forEach((e=>{this.removeValue(e,t)}));if(p.Type.isArray(e)){e.forEach((e=>{this.addValue(e,t,i)}),this)}}getSelectedValues(){return this.selectedValues}getSelectedRawValues(){let e=[];this.selectedValues.forEach((t=>{e.push(this.rawValuesMap.get(t)||t)}));return e}setFullDayMode(e){if(e!==this.fullDayMode){this.fullDayMode=e;this.values=this.getValues()}}showPopup(e={}){const t=this;const i=[];this.values.forEach((s=>{if(s.mode==="time-menu"||s.mode==="custom"||!BX.util.in_array(s.value,this.selectedValues)){let a={};if(s.dataset&&s.dataset.mode==="time-menu"){a.id=s.id;let i=m.Util.getTimeByInt(this.defaultReminderTime);a.text=s.label.replace("#TIME#",m.Util.formatTime(i.hour,i.min));a.dataset=BX.util.objectMerge({type:"submenu-list",value:this.defaultReminderTime},s.dataset);a.items=this.getSubmenuTimeValues(a,s.label,e);a.onclick=function(){return function(){t.addValue({before:s.dataset.daysBefore,time:s.dataset.time});BX.defer((function(){t.reminderMenu.close()}),t)();if(p.Type.isFunction(e.addValueCallback)){e.addValueCallback()}}}()}else if(s.dataset&&s.dataset.mode==="custom"){a.id="custom";a.text=s.label;a.items=[{id:"tmp",text:"tmp"}]}else{a.text=s.label;a.onclick=function(i,s){return()=>{t.addValue(i);t.reminderMenu.close();if(p.Type.isFunction(e.addValueCallback)){e.addValueCallback()}}}(s.value,s.mode)}i.push(a)}}),this);this.reminderMenu=d.MenuManager.create(this.id,e.bindTarget||this.DOM.addButton,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});let s=this.adjustSubmenuPopup.bind(this);let a=this.closeSubmenuPopup.bind(this);h.EventEmitter.subscribe("BX.Main.Popup:onShow",s);h.EventEmitter.subscribe("BX.Main.Popup:onClose",a);this.reminderMenu.popupWindow.subscribe("onClose",(()=>{h.EventEmitter.unsubscribe("BX.Main.Popup:onShow",s);h.EventEmitter.unsubscribe("BX.Main.Popup:onClose",a)}));this.reminderMenu.show()}getSubmenuTimeValues(e,t,i){let s=[];I.getTimeValueList(60).forEach((function(a){s.push({id:"time-"+a.value,dataset:{value:a.value,daysBefore:e.dataset.daysBefore},text:a.label,onclick:function(s,a){let n=m.Util.getTimeByInt(a.dataset.value);let o=this.reminderMenu.getMenuItem(e.id);if(o){o.setText(t.replace("#TIME#",m.Util.formatTime(n.hour,n.min)))}this.addValue({time:a.dataset.value,before:a.dataset.daysBefore});BX.defer((function(){this.reminderMenu.close()}),this)();if(p.Type.isFunction(i.addValueCallback)){i.addValueCallback()}}.bind(this)})}),this);return s}addValue(e,t=true,i=true){let s;const a=I.formatValue(e);if(p.Type.isPlainObject(e)&&e.count){e=parseInt(a)}if(p.Type.isPlainObject(e)&&!this.selectedValues.includes(a)){if(p.Type.isInteger(parseInt(e.before))&&p.Type.isInteger(parseInt(e.time))){s=this.DOM.wrap.appendChild(p.Tag.render(M||(M=g`
					<span class="calendar-reminder-item">
						<span class="calendar-reminder-item-title">
							${0}
						</span>
					</span>`),I.getReminderLabel(e)));if(!this.viewMode){s.appendChild(p.Tag.render(C||(C=g`<span class="calendar-reminder-clear-icon" data-bxc-value="${0}"/>`),a))}}else if(e.type==="date"&&p.Type.isDate(e.value)){s=this.DOM.wrap.appendChild(p.Tag.render(E||(E=g`<span class="calendar-reminder-item">
					<span class="calendar-reminder-item-title">
						${0}
					</span>
				</span>`),m.Util.formatDateUsable(e.value)+" "+m.Util.formatTime(e.value)));if(!this.viewMode){s.appendChild(p.Tag.render(T||(T=g`<span class="calendar-reminder-clear-icon" data-bxc-value="${0}"/>`),a))}}this.selectedValues.push(a);this.controlList[a]=s;this.rawValuesMap.set(a,e)}else if(parseInt(e)>=0&&!this.selectedValues.includes(a)){for(let t=0;t<this.values.length;t++){if(this.values[t].value===parseInt(e)){s=this.DOM.wrap.appendChild(p.Tag.render(v||(v=g`
					<span class="calendar-reminder-item">
						<span class="calendar-reminder-item-title">
							${0}
						</span>
					</span>`),this.values[t].shortLabel||this.values[t].label));if(!this.viewMode){s.appendChild(p.Tag.render(O||(O=g`<span class="calendar-reminder-clear-icon" data-bxc-value="${0}"/>`),a))}this.selectedValues.push(a);this.controlList[a]=s;this.rawValuesMap.set(a,e);break}}if(s===undefined){s=this.DOM.wrap.appendChild(p.Dom.create("SPAN",{props:{className:"calendar-reminder-item"},text:I.getText(e)}));if(!this.viewMode){s.appendChild(p.Dom.create("SPAN",{props:{className:"calendar-reminder-clear-icon"},events:{click:function(){this.removeValue(e)}.bind(this)}}))}this.selectedValues.push(e);this.controlList[e]=s;this.rawValuesMap.set(e,e)}}if(this.changeCallack){this.changeCallack(this.selectedValues)}if(t){this.emit("onChange",new h.BaseEvent({data:{values:this.selectedValues}}))}this.changedByUser=t&&i;if(p.Type.isElementNode(this.DOM.addButton)){this.DOM.wrap.appendChild(this.DOM.addButton)}}removeValue(e,t=true){if(this.controlList[e]&&p.Type.isDomNode(this.controlList[e])){p.Dom.remove(this.controlList[e])}this.selectedValues=BX.util.deleteFromArray(this.selectedValues,BX.util.array_search(e,this.selectedValues));if(this.changeCallack){this.changeCallack(this.selectedValues)}if(t){this.emit("onChange",new h.BaseEvent({data:{values:this.selectedValues}}));this.changedByUser=true}}static getTimeValueList(e=30){if(!I.timeValueList){I.timeValueList=[];let t;for(t=0;t<24;t++){I.timeValueList.push({value:t*60,label:m.Util.formatTime(t,0)});if(e<=30){I.timeValueList.push({value:t*60+30,label:m.Util.formatTime(t,30)})}}}return I.timeValueList}handleClick(e){let t=e.target||e.srcElement;let i=t.getAttribute("data-bxc-value");if(!p.Type.isNull(i)&&this.selectedValues.includes(i)){this.removeValue(i)}if(p.Dom.hasClass(t,"calendar-reminder-item-title")){this.showPopup({bindTarget:t,addValueCallback:()=>{const e=t.parentNode.querySelector(".calendar-reminder-clear-icon");if(p.Type.isElementNode(e)&&!p.Type.isNull(e.getAttribute("data-bxc-value"))){this.removeValue(e.getAttribute("data-bxc-value"))}}})}}static inputCalendarClosePopupHandler(e){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}static getReminderLabel(e){let t="";e.before=parseInt(e.before);e.time=parseInt(e.time);if(p.Type.isInteger(e.before)&&p.Type.isInteger(e.time)&&[0,1,2].includes(e.before)){let i=m.Util.getTimeByInt(e.time);t=p.Loc.getMessage("EC_REMIND1_DAY_"+e.before+"_SHORT").replace("#TIME#",m.Util.formatTime(i.hour,i.min))}return t}adjustSubmenuPopup(e){if(e instanceof h.BaseEvent){let t=e.getTarget();if(t instanceof d.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(t.getId())){this.adjustTimeSubmenuPopup(t)}else if(/^menu-popup-popup-submenu-custom$/.test(t.getId())){this.adjustCalendarSubmenuPopup(t)}}}}closeSubmenuPopup(e){if(e instanceof h.BaseEvent){let t=e.getTarget();if(t instanceof d.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(t.getId()));else if(/^menu-popup-popup-submenu-custom$/.test(t.getId())){let e=t.bindElement;let i=e.querySelector(".menu-popup-item-text");if(p.Type.isDomNode(i)){p.Dom.clean(i);i.innerHTML=p.Loc.getMessage("EC_REMIND1_CUSTOM")}}}}}adjustTimeSubmenuPopup(e){let t=e.getContentContainer().querySelector('span[data-value="'+this.defaultReminderTime+'"]');if(p.Type.isDomNode(t)){setTimeout((()=>{e.getContentContainer().scrollTop=parseInt(t.offsetTop)-10;p.Dom.addClass(t,"menu-popup-item-open")}),50)}}adjustCalendarSubmenuPopup(e){let t=e.bindElement;let i=t.querySelector(".menu-popup-item-text");if(p.Type.isDomNode(i)){p.Dom.clean(i);const t=i.appendChild(p.Tag.render(y||(y=g`<input id="inp-${0}" type="text" class="calendar-field calendar-field-datetime" value="" autocomplete="off" placeholder="${0}"/>`),Math.round(Math.random()*1e5),p.Loc.getMessage("EC_REMIND1_CUSTOM_PLACEHOLDER")));const s=BX.calendar.get();if(s.popup){s.popup.destroy();s.popup=null;s._current_layer=null;s._layers={}}if(s.popup_month){s.popup_month.destroy();s.popup_month=null}if(s.popup_year){s.popup_year.destroy();s.popup_year=null}s.Show({node:t,value:m.Util.formatDateTime(m.Util.getUsableDateTime(new Date)),field:t,bTime:true,bHideTime:false});let a=s.popup;a.cacheable=false;if(a&&a.popupContainer){let t=a.popupContainer.querySelector(".bx-calendar");if(p.Type.isDomNode(t)){e.contentContainer.appendChild(t)}a.close();d.MenuManager.destroy(a.uniquePopupId)}p.Event.bind(t,"change",(()=>{let e=t.value,i=m.Util.parseDate(e);if(p.Type.isDate(i)){this.addValue({type:"date",value:i});this.reminderMenu.close()}}))}}setViewMode(e){this.viewMode=e;if(this.viewMode){p.Dom.addClass(this.DOM.wrap,"calendar-reminder-readonly");if(p.Type.isElementNode(this.DOM.addButton)){this.DOM.addButton.style.display="none"}}else{p.Dom.removeClass(this.DOM.wrap,"calendar-reminder-readonly")}}wasChangedByUser(){return this.changedByUser}static getText(e){let t=e,i=[60,24],s=["EC_REMIND1_MIN_COUNT","EC_REMIND1_HOUR_COUNT","EC_REMIND1_DAY_COUNT"],a="";for(let e=0;e<s.length;e++){if(t<i[e]||e===i.length){a=p.Loc.getMessage(s[e]).toString();a=a.replace("#COUNT#",t.toString());break}else{t=Math.ceil(t/i[e])}}return a}static formatValue(e){if(p.Type.isPlainObject(e)&&p.Type.isInteger(parseInt(e.before))&&p.Type.isInteger(parseInt(e.time))){return"daybefore|"+e.before+"|"+e.time}else if(p.Type.isPlainObject(e)&&p.Type.isDate(e.value)){return"date|"+m.Util.formatDateTime(e.value)}else if(p.Type.isPlainObject(e)&&e.type){if(e.type==="min"){return e.count.toString()}if(e.type==="hour"){return(parseInt(e.count)*60).toString()}if(e.type==="day"){return(parseInt(e.count)*60*24).toString()}}return e.toString()}}I.timeValueList=null;let b=e=>e,L,w,_,N,B,S,x;class k{constructor(e){this.datesRange=[];this.viewMode=false;this.params=e;this.id=e.id||"location-"+Math.round(Math.random()*1e6);this.zIndex=e.zIndex||3100;this.DOM={wrapNode:e.wrap};this.roomsManager=e.roomsManager||null;this.locationAccess=e.locationAccess||false;this.disabled=!e.richLocationEnabled;this.value={type:"",text:"",value:""};this.inlineEditModeEnabled=e.inlineEditModeEnabled;this.meetingRooms=e.iblockMeetingRoomList||[];k.setMeetingRoomList(e.iblockMeetingRoomList);k.setLocationList(e.locationList);if(!this.disabled){this.default=this.setDefaultRoom(e.locationList)||""}this.create();this.setViewMode(e.viewMode===true);this.processValue();this.setCategoryManager();this.setValuesDebounced=BX.debounce(this.setValues.bind(this),100)}create(){this.DOM.wrapNode.style.display="flex";this.DOM.inputWrap=this.DOM.wrapNode.appendChild(p.Tag.render(L||(L=b`
			<div class="calendar-field-block"></div>
		`)));this.DOM.alertIconLocation=p.Tag.render(w||(w=b`
			<div class="ui-alert-icon-danger calendar-location-alert-icon" data-hint-no-icon="Y" data-hint="${0}">
			<i></i>
			</div>
		`),p.Loc.getMessage("EC_LOCATION_OVERFLOW"));if(this.inlineEditModeEnabled){this.DOM.inlineEditLinkWrap=this.DOM.wrapNode.appendChild(p.Tag.render(_||(_=b`
				<div class="calendar-field-place-link calendar-location-readonly">${0}
				</div>`),this.DOM.inlineEditLink=p.Tag.render(N||(N=b`
					<span class="calendar-text-link">${0}</span>`),p.Loc.getMessage("EC_REMIND1_ADD"))));this.DOM.inputWrap.style.display="none";p.Event.bind(this.DOM.inlineEditLinkWrap,"click",(()=>{this.displayInlineEditControls();this.selectContol.showPopup()}))}this.DOM.inputWrapInner=this.DOM.inputWrap.appendChild(p.Tag.render(B||(B=b`
				<div class="calendar-event-location-input-wrap-inner">
				</div>`)));this.DOM.input=this.DOM.inputWrapInner.appendChild(p.Dom.create("INPUT",{attrs:{name:this.params.inputName||"",placeholder:this.disabled?p.Loc.getMessage("EC_LOCATION_PLACEHOLDER_LOCKED"):p.Loc.getMessage("EC_LOCATION_PLACEHOLDER"),type:"text",autocomplete:this.disabled?"on":"off"},props:{className:"calendar-field calendar-field-select"},style:{paddingRight:25+"px",minWidth:300+"px",maxWidth:300+"px"}}));if(this.disabled){p.Dom.addClass(this.DOM.wrapNode,"locked");this.DOM.lockIcon=p.Tag.render(S||(S=b`
				<div class="calendar-lock-icon"></div>
			`));p.Event.bind(this.DOM.lockIcon,"click",(()=>{top.BX.UI.InfoHelper.show("limit_office_calendar_location")}));p.Dom.append(this.DOM.lockIcon,this.DOM.inputWrapInner)}}setValues(){var e;this.addLocationRemoveButton();if(!this.categoryManagerFromDB){this.setValuesDebounced();return}this.prohibitClick();let t=[],i=false,s=k.getMeetingRoomList(),a=k.getLocationList();const n=this.createRoomList(a);this.categoriesWithRooms=this==null?void 0:(e=this.categoryManagerFromDB)==null?void 0:e.getCategoriesWithRooms(n);if(p.Type.isArray(s)){s.forEach((function(e){e.ID=parseInt(e.ID);t.push({ID:e.ID,label:e.NAME,labelRaw:e.NAME,value:e.ID,capacity:0,type:"mr"});if(this.value.type==="mr"&&parseInt(this.value.value)===e.ID){i=t.length-1}}),this);if(t.length>0){t.push({delimiter:true})}}const o=e=>{e.id=parseInt(e.id);e.location_id=parseInt(e.location_id);t.push({ID:e.id,LOCATION_ID:e.location_id,label:e.name,capacity:parseInt(e.capacity)||0,color:e.color,reserved:e.reserved||false,labelRaw:e.name,labelCapacity:this.getCapacityMessage(e.capacity),value:e.id,type:"calendar"});if(this.value.type==="calendar"&&parseInt(this.value.value)===parseInt(e.id)){i=t.length-1}};if(p.Type.isObject(this.categoriesWithRooms)){if(this.categoriesWithRooms.categories.length||this.categoriesWithRooms.default.length){this.categoriesWithRooms.categories.forEach((e=>{if(e.rooms.length){t.push({text:e.name,delimiter:true});e.rooms.forEach((e=>o(e)),this)}}));if(this.categoriesWithRooms.default.length){t.push({text:"\0",className:"calendar-popup-window-delimiter-default-category",delimiter:true});this.categoriesWithRooms.default.forEach((e=>o(e)),this)}if(this.locationAccess){this.loadRoomSlider();t.push({delimiter:true});t.push({label:p.Loc.getMessage("EC_LOCATION_MEETING_ROOM_SET"),callback:this.openRoomsSlider.bind(this)})}}else{if(this.locationAccess){this.loadRoomSlider();t.push({label:p.Loc.getMessage("EC_ADD_LOCATION"),callback:this.openRoomsSlider.bind(this)})}}}if(this.selectContol){this.selectContol.destroy()}let l=this.disabled;if(!t.length){l=true}this.processValue();this.selectContol=new c.SelectInput({input:this.DOM.input,values:t,valueIndex:i,zIndex:this.zIndex,disabled:l,minWidth:300,onChangeCallback:()=>{h.EventEmitter.emit("Calendar.LocationControl.onValueChange");let e,i=this.DOM.input.value;this.value={text:i};for(e=0;e<t.length;e++){if(t[e].labelRaw===i){this.value.type=t[e].type;this.value.value=t[e].value;k.setCurrentCapacity(t[e].capacity);break}}if(p.Type.isFunction(this.params.onChangeCallback)){this.params.onChangeCallback()}if(this.value.text===""){this.removeLocationRemoveButton()}this.addLocationRemoveButton();this.allowClick()}});this.allowClick()}processValue(){if(this.value){this.DOM.input.value=this.value.str||"";if(this.value.type&&(this.value.str===this.getTextLocation(this.value)||this.getTextLocation(this.value)===p.Loc.getMessage("EC_LOCATION_EMPTY"))){this.DOM.input.value="";this.value=""}for(const e of k.locationList){if(parseInt(e.ID)===this.value.room_id){k.setCurrentCapacity(parseInt(e.CAPACITY));break}}}}setValuesDebounce(){this.setValuesDebounced()}removeValue(){this.setValue(false,false);this.selectContol.onChangeCallback();this.removeLocationRemoveButton()}removeLocationRemoveButton(){if(this.DOM.inputWrap.contains(this.DOM.removeLocationButton)){this.DOM.inputWrap.removeChild(this.DOM.removeLocationButton)}else if(this.DOM.wrapNode.contains(this.DOM.removeLocationButton)){this.DOM.wrapNode.removeChild(this.DOM.removeLocationButton)}this.DOM.removeLocationButton=null;if(p.Type.isDomNode(this.DOM.inlineEditLink)){this.displayInlineEditControls()}}addLocationRemoveButton(){var e,t;let i=this.DOM.inputWrap;if(((e=this.DOM)==null?void 0:(t=e.inlineEditLinkWrap)==null?void 0:t.style.display)===""){i=this.DOM.wrapNode}if((this.value.value||this.value.str||this.value.text)&&!this.viewMode&&!this.DOM.removeLocationButton&&this.value.text!==""){this.DOM.removeLocationButton=i.appendChild(p.Tag.render(x||(x=b`
				<span class="calendar-location-clear-btn-wrap calendar-location-readonly">
					<span class="calendar-location-clear-btn-text">${0}</span>
				</span>`),p.Loc.getMessage("EC_LOCATION_CLEAR_INPUT")));p.Event.bind(this.DOM.removeLocationButton,"click",this.removeValue.bind(this))}}setViewMode(e){this.viewMode=e;if(this.viewMode){p.Dom.addClass(this.DOM.wrapNode,"calendar-location-readonly")}else{p.Dom.removeClass(this.DOM.wrapNode,"calendar-location-readonly")}}addCapacityAlert(){if(!p.Dom.hasClass(this.DOM.input,"calendar-field-location-select-border")){p.Dom.addClass(this.DOM.input,"calendar-field-location-select-border")}if(p.Type.isDomNode(this.DOM.alertIconLocation)){m.Util.initHintNode(this.DOM.alertIconLocation)}setTimeout((()=>{this.DOM.inputWrapInner.after(this.DOM.alertIconLocation)}),200)}removeCapacityAlert(){if(p.Dom.hasClass(this.DOM.input,"calendar-field-location-select-border")){p.Dom.removeClass(this.DOM.input,"calendar-field-location-select-border")}if(this.DOM.alertIconLocation.parentNode===this.DOM.inputWrap){p.Dom.remove(this.DOM.alertIconLocation)}}getCapacityMessage(e){let t;if(e%100>10&&e%100<20){t=5}else{t=e%10}return p.Loc.getMessage("EC_LOCATION_CAPACITY_"+t,{"#NUM#":e})}checkLocationAccessibility(e){this.getLocationAccessibility(e.from,e.to).then((()=>{const t=e.timezone&&e.timezone!==""?e.timezone:m.Util.getUserSettings().timezoneName;const i=m.Util.getTimeZoneOffset(t)*60*1e3;const s=new Date(e.from.getTime()+i).getTime();let a=new Date(e.to.getTime()+i).getTime();if(e.fullDay){a+=k.DAY_LENGTH}for(const t in k.locationList){k.locationList[t].reserved=false;let i=k.locationList[t].ID;for(const n of this.datesRange){if(p.Type.isUndefined(k.accessibility[n])||!p.Type.isArrayFilled(k.accessibility[n][i])){continue}for(const o of k.accessibility[n][i]){if(parseInt(o.PARENT_ID)===parseInt(e.currentEventId)){continue}let i=0;if(o.DT_SKIP_TIME==="N"){i=m.Util.getTimeZoneOffset(o.TZ_FROM)*60*1e3}const n=new Date(m.Util.parseDate(o.DATE_FROM).getTime()+i).getTime();let l=new Date(m.Util.parseDate(o.DATE_TO).getTime()+i).getTime();if(o.DT_SKIP_TIME==="Y"){l+=k.DAY_LENGTH}if(n<a&&l>s){k.locationList[t].reserved=true;break}}if(k.locationList[t].reserved){break}}}this.setValuesDebounce()}))}getLocationAccessibility(e,t){return new Promise((i=>{this.datesRange=k.getDatesRange(e,t);let s=true;for(let e of this.datesRange){if(p.Type.isUndefined(k.accessibility[e])){s=false;break}}if(!s){BX.ajax.runAction("calendar.api.locationajax.getLocationAccessibility",{data:{datesRange:this.datesRange,locationList:k.locationList}}).then((e=>{for(let t of this.datesRange){k.accessibility[t]=e.data[t]}i(k.accessibility,this.datesRange)}),(e=>{i(e.errors)}))}else{i(k.accessibility,this.datesRange)}}))}static handlePull(e){if(!e.fields.DATE_FROM||!e.fields.DATE_TO){return}let t=m.Util.parseDate(e.fields.DATE_FROM);let i=m.Util.parseDate(e.fields.DATE_TO);let s=k.getDatesRange(t,i);for(let e of s){if(k.accessibility[e]){delete k.accessibility[e]}}}loadRoomSlider(){this.setRoomsManager()}openRoomsSlider(){this.getRoomsInterface().then(function(e){if(!this.roomsInterface){this.roomsInterface=new e({calendarContext:null,readonly:false,roomsManager:this.roomsManagerFromDB,categoryManager:this.categoryManagerFromDB,isConfigureList:true})}this.roomsInterface.show()}.bind(this))}getTextValue(e){if(!e){e=this.value}let t=e.str||e.text||"";if(e&&e.type==="mr"){t="ECMR_"+e.value+(e.mrevid?"_"+e.mrevid:"")}else if(e&&e.type==="calendar"){t="calendar_"+e.value+(e.room_event_id?"_"+e.room_event_id:"")}return t}getValue(){return this.value}setValue(e,t=true){if(p.Type.isPlainObject(e)){this.value.text=e.text||"";this.value.type=e.type||"";this.value.value=e.value||""}else{this.value=k.parseStringValue(e)}if(t){this.setValuesDebounce()}else{this.setValues()}if(this.inlineEditModeEnabled){let e=this.getTextLocation(this.value);this.DOM.inlineEditLink.innerHTML=p.Text.encode(e||p.Loc.getMessage("EC_REMIND1_ADD"));if(e){this.addLocationRemoveButton()}}}static parseStringValue(e){if(!p.Type.isString(e)){e=""}let t={type:false,value:false,str:e};if(e.substr(0,5)==="ECMR_"){t.type="mr";let i=e.split("_");if(i.length>=2){if(!isNaN(parseInt(i[1]))&&parseInt(i[1])>0){t.value=t.mrid=parseInt(i[1])}if(!isNaN(parseInt(i[2]))&&parseInt(i[2])>0){t.mrevid=parseInt(i[2])}}}else if(e.substr(0,9)==="calendar_"){t.type="calendar";let i=e.split("_");if(i.length>=2){if(!isNaN(parseInt(i[1]))&&parseInt(i[1])>0){t.value=t.room_id=parseInt(i[1])}if(!isNaN(parseInt(i[2]))&&parseInt(i[2])>0){t.room_event_id=parseInt(i[2])}}}return t}getTextLocation(e){let t=p.Type.isPlainObject(e)?e:k.parseStringValue(e),i,s=t.str;if(p.Type.isArray(this.meetingRooms)&&t.type==="mr"){s=p.Loc.getMessage("EC_LOCATION_EMPTY");for(i=0;i<this.meetingRooms.length;i++){if(parseInt(t.value)===parseInt(this.meetingRooms[i].ID)){s=this.meetingRooms[i].NAME;break}}}if(p.Type.isArray(k.locationList)&&t.type==="calendar"){s=p.Loc.getMessage("EC_LOCATION_EMPTY");for(i=0;i<k.locationList.length;i++){if(parseInt(t.value)===parseInt(k.locationList[i].ID)){s=k.locationList[i].NAME;break}}}return s}static setLocationList(e){if(p.Type.isArray(e)){k.locationList=e;this.sortLocationList()}}static sortLocationList(){k.locationList.sort(((e,t)=>{if(e.NAME.toLowerCase()>t.NAME.toLowerCase()){return 1}if(e.NAME.toLowerCase()<t.NAME.toLowerCase()){return-1}return 0}))}static getLocationList(){return k.locationList}static setMeetingRoomList(e){if(p.Type.isArray(e)){k.meetingRoomList=e}}static getMeetingRoomList(){return k.meetingRoomList}static setLocationAccessibility(e){k.accessibility=e}static getLocationAccessibility(){return k.accessibility}static setCurrentCapacity(e){k.currentRoomCapacity=e}static getCurrentCapacity(){return k.currentRoomCapacity||0}displayInlineEditControls(){this.DOM.inlineEditLinkWrap.style.display="none";this.DOM.inputWrap.style.display="";this.addLocationRemoveButton()}setDefaultRoom(e){if(this.roomsManager&&!t.RoomsManager.isEmpty(e)){this.activeRooms=this.roomsManager.getRoomsInfo().active;if(!t.RoomsManager.isEmpty(this.activeRooms)){const t=this.activeRooms[0];for(const i of e){if(parseInt(i.ID)===t){k.setCurrentCapacity(parseInt(i.CAPACITY));return"calendar_"+t}}}else{k.setCurrentCapacity(parseInt(e[0].CAPACITY));return"calendar_"+e[0].ID}}else{return""}}getRoomsInterface(){return new Promise((e=>{const t=BX.Calendar.Util.getBX();const i="calendar.rooms";t.Runtime.loadExtension(i).then((()=>{if(t.Calendar.Rooms.RoomsInterface){e(t.Calendar.Rooms.RoomsInterface)}else{console.error("Extension "+i+" not found");e(t.Calendar.Rooms.RoomsInterface)}}))}))}getRoomsManager(){return new Promise((e=>{const t=BX.Calendar.Util.getBX();const i="calendar.roomsmanager";t.Runtime.loadExtension(i).then((()=>{if(t.Calendar.RoomsManager){e(t.Calendar.RoomsManager)}else{console.error("Extension "+i+" not found");e(t.Calendar.RoomsManager)}}))}))}getRoomsManagerData(){return new Promise((e=>{BX.ajax.runAction("calendar.api.locationajax.getRoomsManagerData").then((i=>{this.roomsManagerFromDB=new t.RoomsManager({sections:i.data.sections,rooms:i.data.rooms},{locationAccess:i.data.config.locationAccess,hiddenSections:i.data.config.hiddenSections,type:i.data.config.type,ownerId:i.data.config.ownerId,userId:i.data.config.userId,new_section_access:i.data.config.defaultSectionAccess,sectionAccessTasks:i.data.config.sectionAccessTasks,showTasks:i.data.config.showTasks,locationContext:this,accessNames:i.data.config.accessNames});e(i.data)}),(t=>{console.error("Extension not found");e(t.data)}))}))}createRoomList(e){return e.map((e=>new t.RoomsSection(e)))}setRoomsManager(){if(!this.roomsManagerFromDB){this.getRoomsManager().then(this.getRoomsManagerData())}}getCategoryManager(){return new Promise((e=>{const t=BX.Calendar.Util.getBX();const i="calendar.categorymanager";t.Runtime.loadExtension(i).then((()=>{if(t.Calendar.CategoryManager){e(t.Calendar.CategoryManager)}else{console.error("Extension "+i+" not found");e(t.Calendar.CategoryManager)}}))}))}getCategoryManagerData(){return new Promise((e=>{BX.ajax.runAction("calendar.api.locationajax.getCategoryManagerData").then((t=>{this.categoryManagerFromDB=new i.CategoryManager({categories:t.data.categories},{perm:t.data.permissions,locationContext:this});e(t.data)}),(t=>{console.error("Extension not found");e(t.data)}))}))}setCategoryManager(){if(!this.categoryManagerFromDB){this.getCategoryManager().then(this.getCategoryManagerData())}}prohibitClick(){if(this.DOM.inlineEditLinkWrap&&!p.Dom.hasClass(this.DOM.inlineEditLinkWrap,"calendar-location-readonly")){p.Dom.addClass(this.DOM.inlineEditLinkWrap,"calendar-location-readonly")}if(this.DOM.removeLocationButton&&!p.Dom.hasClass(this.DOM.removeLocationButton,"calendar-location-readonly")){p.Dom.addClass(this.DOM.removeLocationButton,"calendar-location-readonly")}}allowClick(){if(this.DOM.inlineEditLinkWrap&&p.Dom.hasClass(this.DOM.inlineEditLinkWrap,"calendar-location-readonly")){p.Dom.removeClass(this.DOM.inlineEditLinkWrap,"calendar-location-readonly")}if(this.DOM.removeLocationButton&&p.Dom.hasClass(this.DOM.removeLocationButton,"calendar-location-readonly")){p.Dom.removeClass(this.DOM.removeLocationButton,"calendar-location-readonly")}}static getDateInFormat(e){return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()}static getDatesRange(e,t){const i=new Date(e.getTime()-m.Util.getDayLength());const s=new Date(t.getTime()+m.Util.getDayLength());let a=i.setHours(0,0,0,0);let n=s.setHours(0,0,0,0);let o=[];while(a<=n){o.push(k.getDateInFormat(new Date(a)));a+=k.DAY_LENGTH}return o}}k.locationList=[];k.meetingRoomList=[];k.currentRoomCapacity=0;k.accessibility=[];k.DAY_LENGTH=864e5;class A{constructor(e={}){this.params=e;this.id=e.id||"user_selector_"+Math.round(Math.random()*1e6);this.zIndex=e.zIndex||3100;this.DOM={wrapNode:e.wrapNode};this.destinationInputName=e.inputName||"EVENT_DESTINATION";if(p.Type.isArray(this.params.itemsSelected)&&this.params.itemsSelected.length){this.params.itemsSelected=this.convertAttendeesCodes(this.params.itemsSelected)}this.create()}create(){let e=this.id;this.DOM.socnetDestinationWrap=this.DOM.wrapNode.appendChild(p.Dom.create("DIV",{props:{className:"event-grid-dest-wrap"},events:{click:t=>{BX.SocNetLogDestination.openDialog(e)}}}));this.socnetDestinationItems=this.DOM.socnetDestinationWrap.appendChild(p.Dom.create("SPAN",{props:{className:""},events:{click:function(t){var i=t.target||t.srcElement;if(i.className==="feed-event-del-but"){top.BX.SocNetLogDestination.deleteItem(i.getAttribute("data-item-id"),i.getAttribute("data-item-type"),e);t.preventDefault();t.stopPropagation()}},mouseover:function(e){var t=e.target||e.srcElement;if(t.className==="feed-event-del-but")BX.addClass(t.parentNode,"event-grid-dest-hover")},mouseout:function(e){var t=e.target||e.srcElement;if(t.className==="feed-event-del-but")BX.removeClass(t.parentNode,"event-grid-dest-hover")}}}));this.socnetDestinationInputWrap=this.DOM.socnetDestinationWrap.appendChild(p.Dom.create("SPAN",{props:{className:"feed-add-destination-input-box"}}));this.socnetDestinationInput=this.socnetDestinationInputWrap.appendChild(p.Dom.create("INPUT",{props:{id:e+"-inp",className:"feed-add-destination-inp"},attrs:{value:"",type:"text"},events:{keydown:function(t){return top.BX.SocNetLogDestination.searchBeforeHandler(t,{formName:e,inputId:e+"-inp"})},keyup:function(t){return top.BX.SocNetLogDestination.searchHandler(t,{formName:e,inputId:e+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.socnetDestinationLink=this.DOM.socnetDestinationWrap.appendChild(p.Dom.create("SPAN",{html:this.params.addLinkMessage||BX.message("EC_DESTINATION_ADD_USERS"),props:{id:e+"-link",className:"feed-add-destination-link"},events:{keydown:function(t){return top.BX.SocNetLogDestination.searchBeforeHandler(t,{formName:e,inputId:e+"-inp"})},keyup:function(t){return top.BX.SocNetLogDestination.searchHandler(t,{formName:e,inputId:e+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.init()}init(){if(!this.socnetDestinationInput||!this.DOM.socnetDestinationWrap||!this.params.items){return}if(this.params.selectGroups===false){this.params.items.groups={};this.params.items.department={};this.params.items.sonetgroups={}}if(this.params.selectUsers===false){this.params.items.users={};this.params.items.groups={};this.params.items.department={}}BX.SocNetLogDestination.init({name:this.id,searchInput:this.socnetDestinationInput,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},callback:{select:this.selectCallback.bind(this),unSelect:this.unSelectCallback.bind(this),openDialog:this.openDialogCallback.bind(this),closeDialog:this.closeDialogCallback.bind(this),openSearch:this.openDialogCallback.bind(this),closeSearch:()=>{this.closeDialogCallback(true)}},items:this.params.items,itemsLast:this.params.itemsLast,itemsSelected:this.params.itemsSelected,departmentSelectDisable:this.params.selectGroups===false})}closeAll(){if(top.BX.SocNetLogDestination.isOpenDialog()){top.BX.SocNetLogDestination.closeDialog()}top.BX.SocNetLogDestination.closeSearch()}selectCallback(e,t){var i=t,s="S";if(t==="sonetgroups"){s="SG"}else if(t==="groups"){s="UA";i="all-users"}else if(t==="users"){s="U"}else if(t==="department"){s="DR"}this.socnetDestinationItems.appendChild(p.Dom.create("span",{attrs:{"data-id":e.id},props:{className:"event-grid-dest event-grid-dest-"+i},children:[p.Dom.create("input",{attrs:{type:"hidden",name:this.destinationInputName+"["+s+"][]",value:e.id}}),p.Dom.create("span",{props:{className:"event-grid-dest-text"},html:e.name}),p.Dom.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":e.id,"data-item-type":t}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[e]);this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}unSelectCallback(e,t,i){var s=BX.findChildren(this.socnetDestinationItems,{attribute:{"data-id":e.id}},true);if(s!=null){for(var a=0;a<s.length;a++){BX.remove(s[a])}}BX.onCustomEvent("OnDestinationUnselect");this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}openDialogCallback(){BX.style(this.socnetDestinationInputWrap,"display","inline-block");BX.style(this.socnetDestinationLink,"display","none");BX.focus(this.socnetDestinationInput)}closeDialogCallback(e){if(!top.BX.SocNetLogDestination.isOpenSearch()&&this.socnetDestinationInput.value.length<=0){BX.style(this.socnetDestinationInputWrap,"display","none");BX.style(this.socnetDestinationLink,"display","inline-block");if(e===true)this.socnetDestinationInput.value="";if(top.BX.SocNetLogDestination.backspaceDisable||top.BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable);BX.bind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode===8){e.preventDefault();return false}});setTimeout((function(){BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable);top.BX.SocNetLogDestination.backspaceDisable=null}),5e3)}}getCodes(){var e=this.socnetDestinationItems.getElementsByTagName("INPUT"),t=[],i;for(i=0;i<e.length;i++){t.push(e[i].value)}return t}getAttendeesCodes(){var e=this.socnetDestinationItems.getElementsByTagName("INPUT"),t=[],i;for(i=0;i<e.length;i++){t.push(e[i].value)}return this.convertAttendeesCodes(t)}convertAttendeesCodes(e){let t={};if(p.Type.isArray(e)){e.forEach((function(e){if(e.substr(0,2)==="DR"){t[e]="department"}else if(e.substr(0,2)==="UA"){t[e]="groups"}else if(e.substr(0,2)==="SG"){t[e]="sonetgroups"}else if(e.substr(0,1)==="U"){t[e]="users"}}))}return t}getAttendeesCodesList(e){let t=[];if(!e)e=this.getAttendeesCodes();for(let i in e){if(e.hasOwnProperty(i)){t.push(i)}}return t}setValue(e){if(this.socnetDestinationItems){p.Dom.clean(this.socnetDestinationItems)}if(p.Type.isArray(e)){this.params.itemsSelected=this.convertAttendeesCodes(e)}this.init()}}let R=e=>e,V,P,U,W,X;class H extends h.EventEmitter{constructor(e){super();this.LINE_MODE="line";this.SELECTOR_MODE="selector";this.VIEW_MODE="view";this.setEventNamespace("BX.Calendar.Controls.ColorSelector");this.id=e.id||"color-select-"+Math.round(Math.random()*1e6);this.defaultColors=m.Util.getDefaultColorList();this.colors=[];this.zIndex=3100;this.mode=e.mode||this.LINE_MODE;this.DOM={wrap:e.wrap};this.create();this.setViewMode(e.viewMode||false)}create(){if(this.mode===this.LINE_MODE){for(let e=0;e<this.defaultColors.length;e++){this.colors.push({color:this.defaultColors[e],node:this.DOM.wrap.appendChild(p.Tag.render(V||(V=R`
						<li class="calendar-field-colorpicker-color-item" data-bx-calendar-color="${0}" style="background-color: ${0}">
							<span class="calendar-field-colorpicker-color"></span>
						</li>
					`),this.defaultColors[e],this.defaultColors[e]))})}this.DOM.customColorNode=this.DOM.wrap.appendChild(p.Tag.render(P||(P=R`
				<li class="calendar-field-colorpicker-color-item" style="background-color: transparent; width: 0">
					<span class="calendar-field-colorpicker-color"></span>
				</li>`)));this.DOM.customColorLink=this.DOM.wrap.appendChild(p.Tag.render(U||(U=R`
				<li class="calendar-field-colorpicker-color-item-more">
					<span class="calendar-field-colorpicker-color-item-more-link">${0}</span>
				</li>
			`),p.Loc.getMessage("EC_COLOR")));p.Event.bind(this.DOM.customColorLink,"click",(()=>{if(!this.colorPickerPopup){this.colorPickerPopup=new BX.ColorPicker({bindElement:this.DOM.customColorLink,onColorSelected:this.setValue.bind(this),popupOptions:{zIndex:this.zIndex}})}this.colorPickerPopup.open()}));p.Event.bind(this.DOM.wrap,"click",this.handleColorClick.bind(this))}else if(this.mode===this.SELECTOR_MODE){this.DOM.colorIcon=this.DOM.wrap.appendChild(p.Tag.render(W||(W=R`
				<div style="background-color: #000;" class="calendar-field-select-icon"></div>
			`)));p.Event.bind(this.DOM.wrap,"click",this.openPopup.bind(this))}else if(this.mode===this.VIEW_MODE){this.DOM.colorIcon=this.DOM.wrap.appendChild(p.Tag.render(X||(X=R`
				<div style="background-color: #000;" class="calendar-field-select-icon"></div>
			`)))}}handleColorClick(e){if(this.viewMode){return}let t=m.Util.findTargetNode(e.target||e.srcElement,this.DOM.wrap);if(t&&t.getAttribute){let e=t.getAttribute("data-bx-calendar-color");if(e!==null){this.setValue(e)}}}setValue(e,t=true){if(this.viewMode){return}this.activeColor=e;if(this.mode===this.LINE_MODE){if(this.DOM.activeColorNode){p.Dom.removeClass(this.DOM.activeColorNode,"active")}if(!BX.util.in_array(this.activeColor,this.defaultColors)&&this.activeColor){p.Dom.attr(this.DOM.customColorNode,"data-bx-calendar-color",this.activeColor);this.DOM.customColorNode.style.backgroundColor=this.activeColor;this.DOM.customColorNode.style.width="";this.DOM.activeColorNode=this.DOM.customColorNode;p.Dom.addClass(this.DOM.activeColorNode,"active")}let e;for(e=0;e<this.colors.length;e++){if(this.colors[e].color===this.activeColor){this.DOM.activeColorNode=this.colors[e].node;p.Dom.addClass(this.DOM.activeColorNode,"active");break}}}else if(this.mode===this.SELECTOR_MODE||this.mode===this.VIEW_MODE){if(this.DOM.colorIcon){this.DOM.colorIcon.style.backgroundColor=this.activeColor}if(this.viewMode){this.DOM.wrap.style.backgroundColor=this.activeColor}}if(t){this.emit("onChange",new h.BaseEvent({data:{value:this.activeColor}}))}}getValue(){return this.activeColor}openPopup(){if(this.viewMode){return}if(this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown()){return this.popup.close()}let e,t=[],i;this.defaultColors.forEach((e=>{t.push({text:e,color:e,className:"calendar-add-popup-color-menu-item",onclick:(e=>()=>{this.setValue(e);this.popup.close()})(e)})}));this.popup=d.MenuManager.create(this.id,this.DOM.colorIcon,t,{className:"calendar-color-popup-wrap",width:162,closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:52,angle:true,cacheable:false});this.popup.show();for(e=0;e<this.popup.menuItems.length;e++){if(this.popup.menuItems[e].layout.item){i=this.popup.menuItems[e].layout.item.querySelector(".menu-popup-item-icon");if(p.Type.isDomNode(i)){i.style.backgroundColor=this.popup.menuItems[e].color}}}this.popup.popupWindow.angle.element.style.left="6px"}setViewMode(e){this.viewMode=e;if(this.viewMode){p.Dom.addClass(this.DOM.wrap,"calendar-colorpicker-readonly");p.Event.unbind(this.DOM.wrap,"click",this.openPopup.bind(this))}}}let z=e=>e,F,$,Y,G,j,q,K,Z,Q,J,ee;class te{constructor(e){this.id=e.id||"section-select-"+Math.round(Math.random()*1e6);this.sectionList=e.sectionList;this.sectionGroupList=e.sectionGroupList;this.selectCallback=e.selectCallback;this.openPopupCallback=e.openPopupCallback;this.closePopupCallback=e.closePopupCallback;this.getCurrentSection=e.getCurrentSection;this.defaultCalendarType=e.defaultCalendarType;this.defaultOwnerId=parseInt(e.defaultOwnerId)||0;this.zIndex=e.zIndex||3200;this.mode=e.mode;this.DOM={outerWrap:e.outerWrap};this.create();this.initEventHandlers()}create(){if(this.mode==="textselect"){this.DOM.select=this.DOM.outerWrap;this.DOM.selectImageWrap=this.DOM.select.appendChild(p.Tag.render(F||(F=z`<span class="calendar-field-choice-calendar-img"></span>`)));this.DOM.selectInnerText=this.DOM.select.appendChild(p.Tag.render($||($=z`<span class="calendar-field-choice-calendar-name">${0}</span>`),p.Text.encode(p.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle())))}else if(this.mode==="location"){this.DOM.select=this.DOM.outerWrap;this.DOM.selectImageWrap=this.DOM.select.appendChild(p.Tag.render(Y||(Y=z`<span class="calendar-field-choice-calendar-img"></span>`)));this.DOM.selectInnerText=this.DOM.select.appendChild(p.Tag.render(G||(G=z`<span class="calendar-field-choice-calendar-name calendar-field-choice-calendar-name-location">${0}</span>`),p.Text.encode(p.Loc.getMessage("EC_CALENDAR_LOCATION_TITLE")+" "+this.getCurrentTitle())))}else{this.DOM.select=this.DOM.outerWrap.appendChild(p.Tag.render(j||(j=z`<div class="calendar-field calendar-field-select"></div>`)));this.DOM.innerValue=this.DOM.select.appendChild(p.Tag.render(q||(q=z`
				<div class="calendar-field-select-icon" style="background-color: ${0}"></div>`),this.getCurrentColor()));if(this.mode==="full"){this.DOM.selectInnerText=this.DOM.select.appendChild(p.Tag.render(K||(K=z`<span>${0}</span>`),p.Text.encode(this.getCurrentTitle())))}}}initEventHandlers(){p.Event.bind(this.DOM.select,"click",this.openPopup.bind(this))}openPopup(){if(this.viewMode){return false}if(this.sectionMenu&&this.sectionMenu.popupWindow&&this.sectionMenu.popupWindow.isShown()){return this.sectionMenu.close()}const e=[];const t=[];const i=this.getSectionList();let s;if(p.Type.isArray(this.sectionGroupList)){this.sectionGroupList.forEach((s=>{let a;if(s.belongsToView){a=i.filter((e=>te.getSectionType(e)===this.defaultCalendarType&&te.getSectionOwner(e)===this.defaultOwnerId),this)}else if(s.type==="user"||s.type==="location"){a=i.filter((e=>te.getSectionType(e)==="user"&&te.getSectionOwner(e)===s.ownerId))}else if(s.type==="company"){a=i.filter((e=>te.getSectionType(e)==="company_calendar"||te.getSectionType(e)==="calendar_company"||te.getSectionType(e)===s.type))}else{a=i.filter((e=>te.getSectionType(e)===s.type))}a=a.filter((e=>{const i=parseInt(e.id||e.ID);if(t.includes(i))return false;t.push(i);return true}));if(a.length>0){e.push(new d.MenuItem({text:s.title,delimiter:true}));for(let t=0;t<a.length;t++){e.push(this.getMenuItem(a[t]))}}}))}else{for(s=0;s<i.length;s++){e.push(this.getMenuItem(i[s]))}}let a=0;if(this.mode==="compact"){a=40}else if(this.mode==="textselect"||this.mode==="location"){a=0}this.sectionMenu=d.MenuManager.create(this.id,this.DOM.select,e,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:a,angle:this.mode==="compact"});this.sectionMenu.popupWindow.contentContainer.style.overflow="auto";this.sectionMenu.popupWindow.contentContainer.style.maxHeight="400px";if(this.mode==="full"){this.sectionMenu.popupWindow.setWidth(this.DOM.select.offsetWidth-2);this.sectionMenu.popupWindow.contentContainer.style.overflowX="hidden"}this.sectionMenu.show();for(s=0;s<this.sectionMenu.menuItems.length;s++){if(this.sectionMenu.menuItems[s].layout.item){let e=this.sectionMenu.menuItems[s].layout.item.querySelector(".menu-popup-item-icon");if(e){e.style.backgroundColor=this.sectionMenu.menuItems[s].color}}}p.Dom.addClass(this.DOM.select,"active");if(p.Type.isFunction(this.openPopupCallback)){this.openPopupCallback(this)}BX.addCustomEvent(this.sectionMenu.popupWindow,"onPopupClose",BX.delegate((function(){if(p.Type.isFunction(this.openPopupCallback)){this.closePopupCallback()}p.Dom.removeClass(this.DOM.select,"active");d.MenuManager.destroy(this.id);this.sectionMenu=null}),this))}getCurrentColor(){return(this.getCurrentSection()||{}).color||false}getCurrentTitle(){return(this.getCurrentSection()||{}).name||""}getSectionList(){return this.sectionList.filter((e=>e.PERM&&e.PERM.edit||p.Type.isFunction(e.canDo)&&e.canDo("edit")))}updateSectionImageNode(e){if(!p.Type.isElementNode(this.DOM.selectImageWrap)){return}if(e===undefined){e=this.sectionList.find((e=>parseInt(e.id)===parseInt(this.getCurrentSection().id)))}if(e&&e.type){const t=te.getSectionImage(e);let i;if(t){i=p.Tag.render(Z||(Z=z`<img class="calendar-field-choice-calendar-img-value" src="${0}">`),encodeURI(t))}else if(e.type==="group"){i=p.Tag.render(Q||(Q=z`<div class="ui-icon ui-icon-common-user-group"><i></i></div>`))}else if(e.type==="user"){i=p.Tag.render(J||(J=z`<div class="ui-icon ui-icon-common-user"><i></i></div>`))}else{i=p.Tag.render(ee||(ee=z`<div class="ui-icon ui-icon-common-bitrix24"><i></i></div>`))}p.Dom.clean(this.DOM.selectImageWrap);this.DOM.selectImageWrap.appendChild(i)}}getPopup(){return this.sectionMenu}getMenuItem(e){return{html:BX.util.htmlspecialchars(e.name||e.NAME),color:e.color||e.COLOR,className:"calendar-add-popup-section-menu-item"+(this.mode==="full"?" section-menu-item-full":""),onclick:(t=>()=>{if(p.Type.isDomNode(this.DOM.innerValue)){this.DOM.innerValue.style.backgroundColor=t.color||e.COLOR}this.updateSectionImageNode(t);if(p.Type.isFunction(this.selectCallback)){if(!t.color&&e.COLOR){t.color=e.COLOR}if(!t.id&&e.ID){t.id=e.ID}this.selectCallback(t)}this.sectionMenu.close();this.updateValue()})(e)}}static getSectionType(e){return e.type||e.CAL_TYPE}static getSectionImage(e={}){return e.data?e.data.IMAGE:e.IMAGE||""}static getSectionOwner(e){return parseInt(e.OWNER_ID||e.data.OWNER_ID)}updateValue(){if(p.Type.isDomNode(this.DOM.innerValue)){this.DOM.innerValue.style.backgroundColor=this.getCurrentColor()}if(this.mode==="full"){this.DOM.select.appendChild(p.Dom.adjust(this.DOM.selectInnerText,{text:this.getCurrentTitle(),props:{title:this.getCurrentTitle()}}))}else if(this.mode==="textselect"){this.updateSectionImageNode();this.DOM.select.appendChild(p.Dom.adjust(this.DOM.selectInnerText,{props:{title:p.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()},text:p.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()}))}else if(this.mode==="location"){this.updateSectionImageNode();this.DOM.select.appendChild(p.Dom.adjust(this.DOM.selectInnerText,{props:{title:p.Loc.getMessage("EC_CALENDAR_LOCATION_TITLE")+" "+this.getCurrentTitle()},text:p.Loc.getMessage("EC_CALENDAR_LOCATION_TITLE")+" "+this.getCurrentTitle()}))}}setViewMode(e){this.viewMode=e;if(this.viewMode){p.Dom.addClass(this.DOM.outerWrap,"calendar-section-selector-readonly");if(this.DOM.outerWrap!==this.DOM.select){p.Dom.removeClass(this.DOM.select,"calendar-field-select");p.Dom.addClass(this.DOM.select,"calendar-section-selector-readonly")}}else{p.Dom.removeClass(this.DOM.outerWrap,"calendar-section-selector-readonly")}}}class ie{constructor(e){let t=e.rruleType.form.elements;this.getDate=e.getDate;this.previousDate=null;this.DOM={formElements:t,wrap:e.wrap,rruleType:e.rruleType,interval:t["EVENT_RRULE[INTERVAL]"],rruleEndsOn:{never:t["rrule_endson"][0],count:t["rrule_endson"][1],until:t["rrule_endson"][2]},count:t["EVENT_RRULE[COUNT]"],until:t["EVENT_RRULE[UNTIL]"]};this.viewMode=false;this.create()}create(){BX.bind(this.DOM.rruleType,"change",(()=>{this.changeType(this.DOM.rruleType.value)}));BX.bind(this.DOM.until,"click",(e=>{c.DateTimeControl.showInputCalendar(e);this.DOM.rruleEndsOn.until.checked=true}));BX.bind(this.DOM.count,"click",(()=>{this.DOM.rruleEndsOn.count.checked=true}))}changeType(e){this.DOM.rruleType.value=e?e.toUpperCase():"NONE";let t=this.DOM.rruleType.value.toLowerCase();this.DOM.wrap.className="calendar-rrule-type-"+t;if(t==="weekly"&&BX.type.isFunction(this.getDate)){let e=this.getDate();if(BX.type.isDate(e)){let t=m.Util.getWeekDayByInd(e.getDay());this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach((function(e){if(e.checked&&this.previousDay===e.value&&this.previousDay!==t){e.checked=false}else{e.checked=e.checked||e.value===t}}),this);this.previousDay=t}}}setValue(e={}){if(p.Type.isNil(e)){e={}}this.changeType(e.FREQ);this.DOM.interval.value=e.INTERVAL||1;if(e.COUNT){this.DOM.rruleEndsOn.count.checked="checked";this.DOM.count.value=e.COUNT}else if(e["~UNTIL"]){this.DOM.rruleEndsOn.until.checked="checked";this.DOM.until.value=e["~UNTIL"]}else{this.DOM.rruleEndsOn.never.checked="checked"}if(BX.type.isPlainObject(e.BYDAY)){this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach((function(t){t.checked=e.BYDAY.hasOwnProperty(t.value)}),this)}}getType(){return this.DOM.rruleType.value.toLowerCase()}setViewMode(e){if(!p.Type.isStringFilled(e)){e=this.DOM.rruleType.options[this.DOM.rruleType.options.selectedIndex].innerText}p.Dom.clean(this.DOM.wrap);this.DOM.wrap.innerText=e.toLowerCase();p.Dom.addClass(this.DOM.wrap,"calendar-field calendar-repeat-selector-readonly")}}class se{constructor(e){this.id=e.id||"bx-select-input-"+Math.round(Math.random()*1e6);this.values=e.values||false;this.input=e.input;this.defaultValue=e.defaultValue||"";this.openTitle=e.openTitle||"";this.className=e.className||"";this.onChangeCallback=p.Type.isFunction(e.onChangeCallback)?e.onChangeCallback:()=>{};this.onPopupShowCallback=p.Type.isFunction(e.onPopupShowCallback)?e.onPopupShowCallback:()=>{};this.onPopupCloseCallback=p.Type.isFunction(e.onPopupCloseCallback)?e.onPopupCloseCallback:()=>{};this.zIndex=e.zIndex||1200;this.disabled=e.disabled;this.setValue({value:e.value,valueIndex:e.valueIndex});this.curInd=false;this.eventHandlers={click:this.onClick.bind(this),focus:this.onFocus.bind(this),blur:this.onBlur.bind(this),keydown:this.onKeydown.bind(this),change:this.onChangeCallback};this.bindEventHandlers(this.eventHandlers)}bindEventHandlers(e){for(const[t,i]of Object.entries(e)){p.Event.bind(this.input,t,i)}}unbindEventHandlers(e){for(const[t,i]of Object.entries(e)){p.Event.unbind(this.input,t,i)}}setValue(e){this.currentValue={value:e.value};this.currentValueIndex=e.valueIndex;if(this.currentValueIndex!==undefined&&this.values[this.currentValueIndex]){this.input.value=this.values[this.currentValueIndex].label}}setValueList(e){this.values=e}getInputValue(){return this.input.value}showPopup(){if(this.shown||this.disabled){return}let e=0,t=0,i=[],s;for(s=0;s<this.values.length;s++){if(this.values[s].delimiter){i.push(this.values[s])}else{if(this.currentValue&&this.values[s]&&s>0&&this.currentValue.value>=this.values[s-1].value&&this.currentValue.value<=this.values[s].value){e=t}let a;if(this.values[s].reserved){a=`\n\t\t\t\t\t\t<span class="calendar-menu-item-title-with-status">\n\t\t\t\t\t\t\t${BX.util.htmlspecialchars(this.values[s].label)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="calendar-menu-item-status --red">\n\t\t\t\t\t\t\t${p.Loc.getMessage("EC_LOCATION_RESERVED")}\n\t\t\t\t\t\t</span>`}else if(this.values[s].capacity){a=`\n\t\t\t\t\t\t<span class="calendar-menu-item-title-with-status">\n\t\t\t\t\t    \t${BX.util.htmlspecialchars(this.values[s].label)}\n\t\t\t\t     \t</span>\n\t\t\t\t     \t<span class="calendar-menu-item-capacity">\n\t\t\t\t\t    \t${BX.util.htmlspecialchars(this.values[s].labelCapacity)}\n\t\t\t\t    \t</span>`}else{a=`\n\t\t\t\t\t\t<span class="calendar-menu-item-title">\n\t\t\t\t\t\t\t${BX.util.htmlspecialchars(this.values[s].label)}\n\t\t\t\t\t\t</span>`}if(this.values[s].color){i.push({id:this.values[s].value,title:this.values[s].label,className:"menu-popup-display-flex calendar-location-popup-menu-item",html:a,color:this.values[s].color,onclick:this.values[s].callback||((e,t)=>()=>{this.input.value=t;this.popupMenu.close();this.onChange()})(this.values[s].value,this.values[s].labelRaw||this.values[s].label)})}else{const e=this.values[s].hint?" "+this.values[s].hint:"";i.push({id:this.values[s].value,html:this.values[s].label+e,title:this.values[s].label,className:"menu-popup-no-icon"+(this.values[s].selected?" calendar-menu-popup-time-selected":""),onclick:this.values[s].callback||((e,t)=>()=>{this.input.value=t;this.popupMenu.close();this.onChange(e)})(this.values[s].value,this.values[s].labelRaw||this.values[s].label)})}t++}}this.popupMenu=d.MenuManager.create(this.id,this.input,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:-1});if(!BX.browser.IsFirefox()){this.popupMenu.popupWindow.setMinWidth(this.input.offsetWidth+2)}this.popupMenu.popupWindow.setMaxWidth(300);let a=this.popupMenu.getPopupWindow().getContentContainer();p.Dom.addClass(this.popupMenu.layout.menuContainer,"calendar-select-popup");this.popupMenu.show();let n=this.popupMenu.menuItems[e];if(n&&n.layout){a.scrollTop=n.layout.item.offsetTop-n.layout.item.offsetHeight-36*3}let o=this.popupMenu.menuItems;for(s=0;s<o.length;s++){if(o[s].layout.item){let e=o[s].layout.item.querySelector(".menu-popup-item-icon");if(e){e.style.backgroundColor=o[s].color}}}BX.addCustomEvent(this.popupMenu.popupWindow,"onPopupClose",(()=>{d.MenuManager.destroy(this.id);this.shown=false;this.popupMenu=null}));this.input.select();this.shown=true;this.onPopupShowCallback()}closePopup(){d.MenuManager.destroy(this.id);this.popupMenu=null;this.shown=false;this.onPopupCloseCallback()}onFocus(){setTimeout(function(){if(!this.shown){this.showPopup()}}.bind(this),200)}onClick(){if(this.shown){this.closePopup()}else{this.showPopup()}}onBlur(){this.onPopupCloseCallback();setTimeout(BX.delegate(this.closePopup,this),200)}onKeydown(){this.onPopupCloseCallback();setTimeout(BX.delegate(this.closePopup,this),50)}onChange(e){const t=this.input.value;BX.onCustomEvent(this,"onSelectInputChanged",[this,t]);this.onChangeCallback({value:t,dataValue:e})}destroy(){this.unbindEventHandlers(this.eventHandlers);if(this.popupMenu){this.popupMenu.close()}d.MenuManager.destroy(this.id);this.popupMenu=null;this.shown=false}}class ae{constructor(e={}){this.id=e.id||"popup-dialog-"+Math.random();this.zIndex=e.zIndex||3200;this.DOM={};this.title=""}create(){this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:this.getTitle(),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:this.getButtons(),content:this.getContent(),events:{}})}getTitle(){return this.title}getContent(){this.DOM.content=BX.create("DIV");return this.DOM.content}getButtons(){this.buttons=[];return this.buttons}show(e){if(!this.dialog){this.create()}this.dialog.show()}close(){if(this.dialog){this.dialog.close()}}}let ne=e=>e,oe,le,re,he,de;class ce extends h.EventEmitter{constructor(e={}){super();this.views=[];this.created=false;this.currentValue=null;this.currentViewMode=null;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ViewSelector");if(p.Type.isArray(e.views)){this.views=e.views}this.zIndex=e.zIndex||3200;this.popupId=e.id||"view-selector-"+Math.round(Math.random()*1e4);this.create();if(e.currentView){this.setValue(e.currentView)}if(e.currentViewMode){this.setViewMode(e.currentViewMode)}}create(){this.DOM.wrap=p.Tag.render(oe||(oe=ne`<div class="calendar-view-switcher-selector"></div>`));this.DOM.selectorText=p.Tag.render(le||(le=ne`<div class="calendar-view-switcher-text"></div>`));this.DOM.selectorTextInner=this.DOM.selectorText.appendChild(p.Tag.render(re||(re=ne`<div class="calendar-view-switcher-text-inner"></div>`)));this.DOM.wrap.appendChild(this.DOM.selectorText);this.DOM.wrap.appendChild(p.Tag.render(he||(he=ne`<div class="calendar-view-switcher-dropdown"></div>`)));p.Event.bind(this.DOM.wrap,"click",this.showPopup.bind(this));this.DOM.viewModeTextInner=this.DOM.selectorText.appendChild(p.Tag.render(de||(de=ne`<div class="calendar-view-switcher-text-mode-inner" style="display: none;"></div>`)));this.created=true}getOuterWrap(){if(!this.created){this.create()}return this.DOM.wrap}setValue(e){this.currentValue=this.views.find((function(t){return e.name===t.name}),this);if(this.currentValue){p.Dom.adjust(this.DOM.selectorTextInner,{text:this.currentValue.text})}}setViewMode(e){if(e){this.currentViewMode=this.views.find((function(t){return e===t.name&&t.type==="additional"}),this);if(this.currentViewMode){p.Dom.adjust(this.DOM.viewModeTextInner,{text:"("+this.currentViewMode.text+")"})}this.DOM.viewModeTextInner.style.display=this.currentViewMode?"":"block"}}getMenuItems(){let e=[];this.views.forEach((function(t){if(t.type==="base"){e.push({html:"<span>"+t.text+"</span>"+(t.hotkey?'<span class="calendar-item-hotkey">'+t.hotkey+"</span>":""),className:this.currentValue.name===t.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:t.name,type:t.type,dataset:t.dataset});this.menuPopup.close()}.bind(this)})}}),this);if(e.length<this.views.length){e.push({html:"<span>"+p.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach((function(t){if(t.type==="additional"){e.push({text:t.text,className:this.currentViewMode.name===t.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:t.name,type:t.type,dataset:t.dataset});this.menuPopup.close()}.bind(this)})}}),this)}return e}showPopup(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=d.MenuManager.create(this.popupId,this.DOM.selectorText,this.getMenuItems(),{className:"calendar-view-switcher-popup",closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:-3,offsetLeft:this.DOM.selectorText.offsetWidth-6,angle:true,cacheable:false});this.menuPopup.show()}closePopup(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}show(){this.DOM.wrap.style.display=""}hide(){this.DOM.wrap.style.display="none"}}let ue=e=>e,pe,me;class fe extends h.EventEmitter{constructor(e={}){super();this.views=[];this.created=false;this.currentValue=null;this.currentViewMode=null;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.LineViewSelector");if(p.Type.isArray(e.views)){this.views=e.views}this.viewsMap=new WeakMap;this.zIndex=e.zIndex||3200;this.popupId=e.id||"view-selector-"+Math.round(Math.random()*1e4);this.create();if(e.currentView){this.setValue(e.currentView)}}create(){this.DOM.wrap=p.Tag.render(pe||(pe=ue`<div class="calendar-view-switcher-list"></div>`));this.views.forEach((e=>{if(e.type==="base"){this.viewsMap.set(e,{wrap:this.DOM.wrap.appendChild(p.Tag.render(me||(me=ue`<span 
						class="calendar-view-switcher-list-item"
						onclick="${0}"
					>${0}</span>`),(()=>{this.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset})}),e.text))})}}));this.created=true}getOuterWrap(){if(!this.created){this.create()}return this.DOM.wrap}setValue(e){this.currentValue=this.views.find((function(t){return e.name===t.name}),this);if(this.currentValue){let e=this.viewsMap.get(this.currentValue);let t=this.DOM.wrap.querySelector(".calendar-view-switcher-list-item-active");if(p.Type.isDomNode(t)){p.Dom.removeClass(t,"calendar-view-switcher-list-item-active")}if(p.Type.isDomNode(e.wrap)){p.Dom.addClass(e.wrap,"calendar-view-switcher-list-item-active")}}}setViewMode(e){if(e){this.currentViewMode=this.views.find((function(t){return e===t.name&&t.type==="additional"}),this)}}getMenuItems(){let e=[];this.views.forEach((t=>{if(t.type==="base"){e.push({html:"<span>"+t.text+"</span>"+(t.hotkey?'<span class="calendar-item-hotkey">'+t.hotkey+"</span>":""),className:this.currentValue.name===t.name?"menu-popup-item-accept":" ",onclick:()=>{this.emit("onChange",{name:t.name,type:t.type,dataset:t.dataset});this.menuPopup.close()}})}}));if(e.length<this.views.length){e.push({html:"<span>"+p.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach((function(t){if(t.type==="additional"){e.push({text:t.text,className:this.currentViewMode.name===t.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:t.name,type:t.type,dataset:t.dataset});this.menuPopup.close()}.bind(this)})}}),this)}return e}}class ge extends h.EventEmitter{constructor(e={}){super();this.showTasks=false;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.AddButton");this.zIndex=e.zIndex||3200;this.popupId=e.id||"add-button-"+Math.round(Math.random()*1e4);this.showTasks=e.showTasks;this.addEntryHandler=p.Type.isFunction(e.addEntry)?e.addEntry:null;this.addTaskHandler=p.Type.isFunction(e.addTask)?e.addTask:null;this.create()}create(){this.menuItems=[{text:p.Loc.getMessage("EC_EVENT_BUTTON"),onclick:this.addEntry.bind(this)}];if(this.addTaskHandler){this.menuItems.push({text:p.Loc.getMessage("EC_TASK_BUTTON"),onclick:this.addTask.bind(this)})}if(this.menuItems.length>1){this.DOM.wrap=p.Dom.create("span",{props:{className:"ui-btn-split ui-btn-success"},children:[p.Dom.create("button",{props:{className:"ui-btn-main",type:"button"},html:p.Loc.getMessage("EC_CREATE"),events:{click:this.addEntry.bind(this)}})]});this.DOM.addButtonExtra=p.Dom.create("span",{props:{className:"ui-btn-extra"},events:{click:this.showPopup.bind(this)}});this.DOM.wrap.appendChild(this.DOM.addButtonExtra)}else{this.DOM.wrap=p.Dom.create("button",{props:{className:"ui-btn ui-btn-success",type:"button"},html:p.Loc.getMessage("EC_CREATE"),events:{click:this.addEntry.bind(this)}})}this.DOM.wrap.setAttribute("data-role","addButton")}getWrap(){return this.DOM.wrap}showPopup(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=BX.PopupMenu.create(this.popupId,this.DOM.addButtonExtra,this.menuItems,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(this.popupId);this.menuPopup=null;this.addBtnMenu=null}.bind(this))}addEntry(){if(this.addEntryHandler){this.addEntryHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}addTask(){if(this.addTaskHandler){this.addTaskHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}}class De extends p.Event.EventEmitter{constructor(e={}){super();this.showTasks=false;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.MeetingStatusControl");this.BX=m.Util.getBX();if(e.wrap&&p.Type.isDomNode(e.wrap)){this.DOM.wrap=e.wrap}else{throw new Error('The argument "params.wrap" must be a DOM node.')}this.id=e.id||"meeting-status-control-"+Math.round(Math.random()*1e4);this.zIndex=3100;this.create();this.status=e.currentStatus||null;if(this.status){this.updateStatus()}}create(){this.acceptBtn=new BX.UI.Button({text:p.Loc.getMessage("EC_VIEW_DESIDE_BUT_Y"),className:"ui-btn ui-btn-primary",events:{click:this.accept.bind(this)}});this.acceptBtn.renderTo(this.DOM.wrap);this.declineBtn=new BX.UI.Button({text:p.Loc.getMessage("EC_VIEW_DESIDE_BUT_N"),className:"ui-btn ui-btn-light-border",events:{click:this.decline.bind(this)}});this.declineBtn.renderTo(this.DOM.wrap)}updateStatus(){if(this.status==="H"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display="";this.declineBtn.setText(p.Loc.getMessage("EC_VIEW_DESIDE_BUT_OWNER_N"))}else{if(this.status==="Y"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display=""}else if(this.status==="N"){this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display="none"}else{this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display=""}}}accept(){this.setStatus("Y")}decline(){this.setStatus("N")}setStatus(e,t=true){this.status=e;if(this.menuPopup){this.menuPopup.close()}if(t){this.emit("onSetStatus",new p.Event.BaseEvent({data:{status:e}}))}}}let Me=e=>e,Ce;class Ee extends h.EventEmitter{constructor(){super();this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");this.zIndex=3200;this.id="confirm-status-dialog-"+Math.round(Math.random()*1e4)}show(){this.dialog=new d.Popup({id:this.id,titleBar:p.Loc.getMessage("EC_DECLINE_REC_EVENT"),content:this.getContent(),className:"calendar__confirm-dialog",lightShadow:true,maxWidth:700,minHeight:120,autoHide:true,closeByEsc:true,draggable:true,closeIcon:true,animation:"fading-slide",contentBackground:"#fff",overlay:{opacity:15},cacheable:false});this.dialog.show()}getContent(){const e=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_DECLINE_ONLY_THIS"),events:{click:()=>{this.onDeclineHandler();this.emit("onDecline",new h.BaseEvent({data:{recursionMode:"this"}}))}}});const t=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_DECLINE_NEXT"),events:{click:()=>{this.onDeclineHandler();this.emit("onDecline",new h.BaseEvent({data:{recursionMode:"next"}}))}}});const i=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_DECLINE_ALL"),events:{click:()=>{this.onDeclineHandler();this.emit("onDecline",new h.BaseEvent({data:{recursionMode:"all"}}))}}});return p.Tag.render(Ce||(Ce=Me`
			<div class="calendar__confirm-dialog-content">
				${0}
				${0}
				${0}
			</div>
		`),e.render(),t.render(),i.render())}close(){if(this.dialog){this.dialog.close()}}onDeclineHandler(){this.close();const e=a.EntryManager.getCompactViewForm();if(e&&e.isShown()){e.close()}}}let Te=e=>e,ve;class Oe extends h.EventEmitter{constructor(){super();this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ConfirmEditDialog");this.zIndex=3200;this.id="confirm-edit-dialog-"+Math.round(Math.random()*1e4)}show(){this.dialog=new d.Popup({titleBar:p.Loc.getMessage("EC_EDIT_REC_EVENT"),content:this.getContent(),className:"calendar__confirm-dialog",lightShadow:true,maxWidth:700,minHeight:120,autoHide:true,closeByEsc:true,draggable:true,closeIcon:true,animation:"fading-slide",contentBackground:"#fff",overlay:{opacity:15},cacheable:false});this.dialog.show()}getContent(){const e=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:()=>{this.emit("onEdit",new h.BaseEvent({data:{recursionMode:"this"}}));this.close()}}});const t=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_NEXT"),events:{click:()=>{this.emit("onEdit",new h.BaseEvent({data:{recursionMode:"next"}}));this.close()}}});const i=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_ALL"),events:{click:()=>{this.emit("onEdit",new h.BaseEvent({data:{recursionMode:"all"}}));this.close()}}});return p.Tag.render(ve||(ve=Te`
			<div class="calendar__confirm-dialog-content">
				${0}
				${0}
				${0}
			</div>
		`),e.render(),t.render(),i.render())}close(){if(this.dialog){this.dialog.close()}}}let ye=e=>e,Ie;class be{constructor(e={}){this.entry=e.entry}show(){this.dialog=new d.Popup({titleBar:p.Loc.getMessage("EC_DEL_REC_EVENT"),content:this.getContent(),className:"calendar__confirm-dialog",lightShadow:true,maxWidth:700,minHeight:120,autoHide:true,closeByEsc:true,draggable:true,closeIcon:true,animation:"fading-slide",contentBackground:"#fff",overlay:{opacity:15},cacheable:false});this.dialog.show()}getContent(){const e=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:()=>{this.entry.deleteThis();this.close()}}});const t=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_NEXT"),events:{click:()=>{this.entry.deleteNext();this.close()}}});const i=new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:p.Loc.getMessage("EC_REC_EV_ALL"),events:{click:()=>{this.entry.deleteAll();this.close()}}});return p.Tag.render(Ie||(Ie=ye`
			<div class="calendar__confirm-dialog-content">
				${0}
				${0}
				${0}
			</div>
		`),e.render(),t.render(),i.render())}close(){if(this.dialog){this.dialog.close()}}}let Le=e=>e,we,_e,Ne,Be,Se,xe,ke,Ae,Re,Ve,Pe,Ue,We,Xe;class He extends h.EventEmitter{constructor(e,t={showTimezone:true}){super();this.DATE_INPUT_WIDTH=110;this.TIME_INPUT_WIDTH=90;this.zIndex=4200;this.from=null;this.to=null;this.setEventNamespace("BX.Calendar.Controls.DateTimeControl");this.showTimezone=t.showTimezone;this.inlineEditMode=!!t.inlineEditMode;this.currentInlineEditMode=t.currentInlineEditMode||"view";this.UID=e||"date-time-"+Math.round(Math.random()*1e5);this.DOM={outerWrap:t.outerWrap||null,outerContent:t.outerContent||null};this.create()}create(){if(p.Type.isDomNode(this.DOM.outerWrap)){if(this.inlineEditMode){p.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}this.DOM.leftInnerWrap=this.DOM.outerWrap.appendChild(p.Tag.render(we||(we=Le`<div class="calendar-field-block calendar-field-block-left"></div>`)));this.DOM.fromDate=this.DOM.leftInnerWrap.appendChild(p.Tag.render(_e||(_e=Le`
				<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ${0}px;"/>
			`),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromDateText=this.DOM.leftInnerWrap.appendChild(p.Tag.render(Ne||(Ne=Le`<span class="calendar-field-value calendar-field-value-date"></span>`)))}this.DOM.fromTime=this.DOM.leftInnerWrap.appendChild(p.Tag.render(Be||(Be=Le`
				<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ${0}px; max-width: ${0}px;"/>
			`),this.TIME_INPUT_WIDTH,this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromTimeText=this.DOM.leftInnerWrap.appendChild(p.Tag.render(Se||(Se=Le`<span class="calendar-field-value calendar-field-value-time"></span>`)))}this.DOM.betweenSpacer=this.DOM.outerWrap.appendChild(p.Tag.render(xe||(xe=Le`<div class="calendar-field-block calendar-field-block-between" />`)));this.DOM.rightInnerWrap=this.DOM.outerWrap.appendChild(p.Tag.render(ke||(ke=Le`<div class="calendar-field-block calendar-field-block-right"></div>`)));this.DOM.toTime=this.DOM.rightInnerWrap.appendChild(p.Tag.render(Ae||(Ae=Le`
				<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ${0}px; max-width: ${0}px;"/>
			`),this.TIME_INPUT_WIDTH,this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toTimeText=this.DOM.rightInnerWrap.appendChild(p.Tag.render(Re||(Re=Le`<span class="calendar-field-value calendar-field-value-time"></span>`)))}this.DOM.toDate=this.DOM.rightInnerWrap.appendChild(p.Tag.render(Ve||(Ve=Le`
				<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ${0}px;"/>`),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toDateText=this.DOM.rightInnerWrap.appendChild(p.Tag.render(Pe||(Pe=Le`<span class="calendar-field-value calendar-field-value-date"></span>`)))}this.fromTimeControl=new f({input:this.DOM.fromTime,onChangeCallback:this.handleTimeFromChange.bind(this)});this.toTimeControl=new f({input:this.DOM.toTime,onChangeCallback:this.handleTimeToChange.bind(this)});let e=this.DOM.outerWrap.appendChild(p.Tag.render(Ue||(Ue=Le`
				<span class="calendar-event-full-day"></span>
			`)));this.DOM.fullDay=e.appendChild(p.Tag.render(We||(We=Le`
				<input value="Y" type="checkbox" id="{this.UID}"/>
			`)));e.appendChild(p.Tag.render(Xe||(Xe=Le`<label for="{this.UID}">${0}</label>`),p.Loc.getMessage("EC_ALL_DAY")))}if(this.showTimezone);this.bindEventHandlers()}setValue(e={}){this.DOM.fromDate.value=m.Util.formatDate(e.from);this.DOM.toDate.value=m.Util.formatDate(e.to);this.DOM.fromTime.value=m.Util.formatTime(e.from);this.DOM.toTime.value=m.Util.formatTime(e.to);const t=m.Util.parseTime(this.DOM.fromTime.value);const i=m.Util.parseTime(this.DOM.toTime.value);this.fromMinutes=t.h*60+t.m;this.toMinutes=i.h*60+i.m;this.updateTimePeriod();if(this.inlineEditMode){this.DOM.fromDateText.innerHTML=m.Util.formatDateUsable(e.from,true,true);this.DOM.toDateText.innerHTML=m.Util.formatDateUsable(e.to,true,true);this.DOM.toDateText.style.display=this.DOM.fromDate.value===this.DOM.toDate.value?"none":"";if(e.fullDay){if(this.DOM.fromDate.value===this.DOM.toDate.value){this.DOM.toTimeText.innerHTML=p.Loc.getMessage("EC_ALL_DAY");this.DOM.toTimeText.style.display="";this.DOM.fromTimeText.style.display="none";this.DOM.fromTimeText.innerHTML=""}else{this.DOM.betweenSpacer.style.display="";this.DOM.fromTimeText.style.display="none";this.DOM.toTimeText.style.display="none"}}else{this.DOM.fromTimeText.innerHTML=this.DOM.fromTime.value;this.DOM.toTimeText.innerHTML=this.DOM.toTime.value;this.DOM.betweenSpacer.style.display="";this.DOM.fromTimeText.style.display="";this.DOM.toTimeText.style.display=""}}if(e.fullDay!==undefined){this.DOM.fullDay.checked=e.fullDay}if(this.showTimezone){e.timezoneFrom=e.timezoneFrom||e.timezoneName;e.timezoneTo=e.timezoneTo||e.timezoneName;if(e.timezoneFrom!==undefined&&p.Type.isDomNode(this.DOM.fromTz)){this.DOM.fromTz.value=e.timezoneFrom}if(e.timezoneTo!==undefined&&p.Type.isDomNode(this.DOM.toTz)){this.DOM.toTz.value=e.timezoneTo}if(e.timezoneName!==undefined&&(e.timezoneName!==e.timezoneFrom||e.timezoneName!==e.timezoneTo)){this.switchTimezone(true)}}this.value=e;this.handleFullDayChange();this.emit("onSetValue")}updateTimePeriod(){this.from=this.getFrom();this.to=this.getTo();this.fromTimeControl.highlightValue(this.from);this.toTimeControl.highlightValue(this.to);this.updateToTimeDurationHints()}getFrom(){return this.getDateWithTime(this.DOM.fromDate.value,this.fromMinutes)}getTo(){return this.getDateWithTime(this.DOM.toDate.value,this.toMinutes)}getDateWithTime(e,t){const i=m.Util.parseDate(e);if(!i){return null}return new Date(i.getTime()+t*60*1e3)}getValue(){let e={fullDay:this.DOM.fullDay.checked,fromDate:this.DOM.fromDate.value,toDate:this.DOM.toDate.value,fromTime:this.DOM.fromTime.value,toTime:this.DOM.toTime.value,timezoneFrom:this.DOM.fromTz?this.DOM.fromTz.value:this.value.timezoneFrom||this.value.timezoneName||null,timezoneTo:this.DOM.toTz?this.DOM.toTz.value:this.value.timezoneTo||this.value.timezoneName||null};e.from=m.Util.parseDate(e.fromDate);if(p.Type.isDate(e.from)){e.to=m.Util.parseDate(e.toDate);if(!p.Type.isDate(e.to)){e.to=e.from}if(e.fullDay){e.from.setHours(0,0,0);e.to.setHours(0,0,0)}else{let t=m.Util.parseTime(e.fromTime),i=m.Util.parseTime(e.toTime)||t;if(t&&i){e.from.setHours(t.h,t.m,0);e.to.setHours(i.h,i.m,0)}}}return e}bindEventHandlers(){p.Event.bind(this.DOM.fromDate,"click",He.showInputCalendar);p.Event.bind(this.DOM.fromDate,"change",this.handleDateFromChange.bind(this));p.Event.bind(this.DOM.toDate,"click",He.showInputCalendar);p.Event.bind(this.DOM.toDate,"change",this.handleDateToChange.bind(this));p.Event.bind(this.DOM.fromTime,"input",this.handleTimeInput.bind(this));p.Event.bind(this.DOM.toTime,"input",this.handleTimeInput.bind(this));p.Event.bind(this.DOM.fromTz,"change",this.handleValueChange.bind(this));p.Event.bind(this.DOM.toTz,"change",this.handleValueChange.bind(this));p.Event.bind(this.DOM.fullDay,"click",(()=>{this.handleFullDayChange();this.handleValueChange()}));if(this.inlineEditMode){p.Event.bind(this.DOM.outerWrap,"click",this.changeInlineEditMode.bind(this))}if(p.Type.isDomNode(this.DOM.defTimezone)){p.Event.bind(this.DOM.defTimezone,"change",BX.delegate((function(){if(this.bindFromToDefaultTimezones){this.DOM.fromTz.value=this.DOM.toTz.value=this.DOM.defTimezone.value}}),this))}if(this.showTimezone){if(p.Type.isDomNode(this.DOM.tzButton)){p.Event.bind(this.DOM.tzButton,"click",this.switchTimezone.bind(this))}p.Event.bind(this.DOM.fromTz,"change",function(){if(this.bindTimezones){this.DOM.toTz.value=this.DOM.fromTz.value}this.bindFromToDefaultTimezones=false}.bind(this));p.Event.bind(this.DOM.toTz,"change",function(){this.bindTimezones=false;this.bindFromToDefaultTimezones=false}.bind(this));this.bindTimezones=this.DOM.fromTz.value===this.DOM.toTz.value;this.bindFromToDefaultTimezones=this.bindTimezones&&this.DOM.fromTz.value===this.DOM.toTz.value&&this.DOM.fromTz.value===this.DOM.defTimezone.value}}static showInputCalendar(e){let t=e.target||e.srcElement;if(p.Type.isDomNode(t)&&t.nodeName.toLowerCase()==="input"){const e=BX.calendar.get();if(e.popup){e.popup.destroy();e.popup=null;e._current_layer=null;e._layers={}}if(e.popup_month){e.popup_month.destroy();e.popup_month=null}if(e.popup_year){e.popup_year.destroy();e.popup_year=null}e.Show({node:t.parentNode,field:t,bTime:false});BX.onCustomEvent(window,"onCalendarControlChildPopupShown");const i=e.popup;if(i){BX.removeCustomEvent(i,"onPopupClose",He.inputCalendarClosePopupHandler);BX.addCustomEvent(i,"onPopupClose",He.inputCalendarClosePopupHandler)}}}static inputCalendarClosePopupHandler(){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}handleDateFromChange(){if(!this.getFrom()){this.DOM.fromDate.value=m.Util.formatDate(this.from.getTime());return}this.DOM.fromDate.value=m.Util.formatDate(this.getFrom());const e=this.getFrom().getTime()-this.from.getTime();this.DOM.toDate.value=m.Util.formatDate(this.to.getTime()+e);this.handleValueChange()}handleDateToChange(){if(!this.getTo()){this.DOM.toDate.value=m.Util.formatDate(this.to.getTime());return}this.DOM.toDate.value=m.Util.formatDate(this.getTo());const e=Math.abs(this.to.getTime()-this.getTo().getTime());const t=1e3*60*60*24*300;if(e>t){const e=this.to.getTime()-this.from.getTime();const t=m.Util.parseDate(this.DOM.toDate.value);t.setHours(this.to.getHours(),this.to.getMinutes(),0,0);const i=new Date(t.getTime()-e);this.DOM.fromDate.value=m.Util.formatDate(i)}if(this.getTo()<this.getFrom()){this.DOM.toDate.value=this.DOM.fromDate.value;this.DOM.toTime.value=this.DOM.fromTime.value;this.toMinutes=this.getMinutesFromFormattedTime(this.DOM.toTime.value)}this.handleValueChange()}handleTimeFromChange(e,t){this.handleTimeChange(this.DOM.fromTime);if(this.isIncorrectTimeValue(this.DOM.fromTime.value)){this.DOM.fromTime.value=m.Util.formatTime(this.from)}else{this.fromMinutes=t!=null?t:this.getMinutesFromFormattedTime(this.DOM.fromTime.value);this.DOM.fromTime.value=m.Util.formatTime(this.getFrom())}if(this.getTo()){const e=this.getFrom().getTime()-this.from.getTime();this.toMinutes=this.toMinutes+e/(60*1e3)}this.handleValueChange()}handleTimeToChange(e,t){this.handleTimeChange(this.DOM.toTime);if(this.isIncorrectTimeValue(this.DOM.toTime.value)){this.DOM.toTime.value=m.Util.formatTime(this.to)}else{this.toMinutes=t!=null?t:this.getMinutesFromFormattedTime(this.DOM.toTime.value);this.DOM.toTime.value=m.Util.formatTime(this.getTo())}if(this.getTo()<this.getFrom()){const e=this.getTo().getTime()-this.to.getTime();this.fromMinutes=this.fromMinutes+e/(60*1e3);const t=new Date(this.from.getTime()+e);this.DOM.fromTime.value=m.Util.formatTime(t);this.DOM.fromDate.value=m.Util.formatDate(t)}this.handleValueChange()}isIncorrectTimeValue(e){if(BX.isAmPmMode()){return e===""}return e===""||e[0]!=="0"&&m.Util.parseTime(e).h===0}handleTimeChange(e){if(e.value===""){return}let t=this.getMaskedTime(e.value);t=this.beautifyTime(t);if(BX.isAmPmMode()){var i;let s=((i=e.value.toLowerCase().match(/[ap]/g))!=null?i:[]).pop();if(!s){const e=parseInt(this.getMinutesAndHours(t).hours);if(8<=e&&e<=11){s="a"}else{s="p"}}if(s==="a"){t+=" am"}if(s==="p"){t+=" pm"}}e.value=t}handleTimeInput(e){e.target.value=this.getMaskedTime(e.target.value,e.data,e.inputType==="deleteContentBackward")}getMaskedTime(e,t,i=false){if(i){return e}let s="";const{hours:a,minutes:n}=this.getMinutesAndHours(e,t);if(a&&!n){s=`${a}`;if(e.length-s.length===1||e.indexOf(":")!==-1){s+=":"}}if(a&&n){s=`${a}:${n}`}if(BX.isAmPmMode()&&this.clearTimeString(s)!==""){var o;const t=((o=e.toLowerCase().match(/[ap]/g))!=null?o:[]).pop();if(t==="a"){s=this.beautifyTime(s)+" am"}if(t==="p"){s=this.beautifyTime(s)+" pm"}}return s}getMinutesAndHours(e,t){let i=this.clearTimeString(e,t);let s,a;if(i.indexOf(":")!==-1){s=i.match(/[\d]*:/g)[0].slice(0,-1);a=i.match(/:[\d]*/g)[0].slice(1)}else{var n;const e=((n=i.match(/\d/g))!=null?n:[]).splice(0,4).map((e=>parseInt(e)));if(e.length===4&&e[0]>this.getMaxHours()/10){e.pop()}if(e.length===1){s=`${e[0]}`}if(e.length===2){s=`${e[0]}${e[1]}`;if(parseInt(s)>this.getMaxHours()){s=`${e[0]}`;a=`${e[1]}`}}if(e.length===3){if(BX.isAmPmMode()){if(e[0]>=1){s=`${e[0]}`;a=`${e[1]}${e[2]}`}else{s=`${e[0]}${e[1]}`;a=`${e[2]}`}}else{if(parseInt(`${e[0]}${e[1]}`)<24){s=`${e[0]}${e[1]}`;a=`${e[2]}`}else{s=`${e[0]}`;a=`${e[1]}${e[2]}`}}}if(e.length===4){s=`${e[0]}${e[1]}`;a=`${e[2]}${e[3]}`}}if(s){s=this.formatHours(s)}if(a){a=this.formatMinutes(a)}return{hours:s,minutes:a}}clearTimeString(e,t){let i=e.replace(/[ap]/g,"").replace(/\D/g,":");i=i.replace(/:*/,"");const s=i.indexOf(":");i=i.substr(0,s+1)+i.slice(s+1).replaceAll(":","");if(s!==-1){const e=this.formatHours(i.match(/[\d]*:/g)[0].slice(0,-1));const s=i.match(/:[\d]*/g)[0].slice(1).slice(0,3);if(e.length===1&&s.length===3&&!isNaN(parseInt(t))&&this.areTimeDigitsCorrect(`${e}${s}`)){return`${e}${s}`}return`${e}:${s}`}return i.slice(0,4)}areTimeDigitsCorrect(e){const t=e.slice(0,2);const i=e.slice(2);return this.formatHours(t)===t&&this.formatMinutes(i)===i}formatHours(e){const t=e[0];if(parseInt(t)>this.getMaxHours()/10){return`0${t}`}if(parseInt(e)<=this.getMaxHours()){var i;return`${t}${(i=e[1])!=null?i:""}`}return`${t}`}formatMinutes(e){var t;const i=e[0];if(i>=6){return`0${i}`}return`${i}${(t=e[1])!=null?t:""}`}beautifyTime(e){if(this.clearTimeString(e)===""){return""}if(e.indexOf(":")===-1){e+=":00"}if(e.indexOf(":")===e.length-1){e+="00"}let{hours:t,minutes:i}=this.getMinutesAndHours(e);t=`0${t}`.slice(-2);i=`0${i}`.slice(-2);return`${t}:${i}`}getMaxHours(){return BX.isAmPmMode()?12:24}handleFullDayChange(){let e=this.getFullDayValue();if(e){if(p.Type.isDomNode(this.DOM.dateTimeWrap)){p.Dom.addClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(p.Type.isDomNode(this.DOM.outerWrap)){p.Dom.addClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}else{if(p.Type.isDomNode(this.DOM.dateTimeWrap)){p.Dom.removeClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(p.Type.isDomNode(this.DOM.outerWrap)){p.Dom.removeClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}}handleValueChange(){this.setValue({from:this.getFrom(),to:this.getTo()});this.emit("onChange",new h.BaseEvent({data:{value:this.getValue()}}))}updateToTimeDurationHints(){this.toTimeControl.updateDurationHints(this.DOM.fromTime.value,this.DOM.toTime.value,this.DOM.fromDate.value,this.DOM.toDate.value)}getFullDayValue(){return!!this.DOM.fullDay.checked}getMinutesFromFormattedTime(e){const t=m.Util.parseTime(e);return t.h*60+t.m}switchTimezone(e){if(!p.Type.isBoolean(e)){e=BX.hasClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}if(e){p.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-expand");p.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}else{p.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-collapse");p.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-expand")}}changeInlineEditMode(){if(!this.viewMode){this.setInlineEditMode("edit")}}setViewMode(e){this.viewMode=e;if(this.viewMode&&this.currentInlineEditMode==="edit"){this.setInlineEditMode("view")}}setInlineEditMode(e){if(this.inlineEditMode){this.currentInlineEditMode=e;if(this.currentInlineEditMode==="edit"){p.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");p.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}else{p.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");p.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}}}}class ze extends h.EventEmitter{constructor(){super();this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");this.zIndex=3200;this.id="busy-user-dialog-"+Math.round(Math.random()*1e4)}show(e={}){this.plural=e.users.length>1;const t=[];e.users.forEach((e=>{t.push(e.DISPLAY_NAME)}));const i=t.join(", ");const s=this.plural?p.Loc.getMessage("EC_BUSY_USERS_PLURAL").replace("#USER_LIST#",i):p.Loc.getMessage("EC_BUSY_USERS_SINGLE").replace("#USER_NAME#",e.users[0].DISPLAY_NAME);this.dialog=new n.MessageBox({title:p.Loc.getMessage("EC_BUSY_USERS_TITLE"),message:p.Text.encode(s),buttons:this.getButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,maxWidth:700,minHeight:150,animation:"fading-slide"}});this.dialog.show()}getButtons(){return[new o.Button({size:o.ButtonSize.SMALL,color:o.ButtonColor.PRIMARY,text:p.Loc.getMessage("EC_BUSY_USERS_BACK2EDIT"),events:{click:()=>{this.emit("onContinueEditing");this.close()}}}),new o.Button({size:o.ButtonSize.SMALL,color:o.ButtonColor.LIGHT_BORDER,text:this.plural?p.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_PLURAL"):p.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_SINGLE"),events:{click:()=>{this.emit("onSaveWithout");this.close()}}})]}close(){if(this.dialog){this.dialog.close()}}isShown(){if(this.dialog){return this.dialog.getPopupWindow().isShown()}return false}}let Fe=e=>e,$e,Ye,Ge;class je extends h.EventEmitter{constructor(e={}){super();this.zIndex=4200;this.readOnlyMode=true;this.meetingNotifyValue=true;this.userSelectorDialog=null;this.attendeesEntityList=[];this.inlineEditMode=je.VIEW_MODE;this.prevUserList=[];this.loadedAccessibilityData={};this.REFRESH_PLANNER_DELAY=500;this.setEventNamespace("BX.Calendar.Controls.UserPlannerSelector");this.selectorId=e.id||"user-selector-"+Math.round(Math.random()*1e4);this.BX=m.Util.getBX();this.DOM={outerWrap:e.outerWrap,wrap:e.wrap,informWrap:e.informWrap,informWrapText:e.informWrap.querySelector(".calendar-field-container-inform-text"),moreLink:e.outerWrap.querySelector(".calendar-members-more"),changeLink:e.outerWrap.querySelector(".calendar-members-change-link"),attendeesLabel:e.outerWrap.querySelector(".calendar-attendees-label"),attendeesList:e.outerWrap.querySelector(".calendar-attendees-list"),userSelectorWrap:e.outerWrap.querySelector(".calendar-user-selector-wrap"),plannerOuterWrap:e.plannerOuterWrap,videocallWrap:e.outerWrap.querySelector(".calendar-videocall-wrap"),hideGuestsWrap:e.hideGuestsWrap,hideGuestsIcon:e.hideGuestsWrap.querySelector(".calendar-hide-members-icon-hidden")};this.refreshPlannerStateDebounce=p.Runtime.debounce(this.refreshPlannerState,this.REFRESH_PLANNER_DELAY,this);if(p.Type.isBoolean(e.readOnlyMode)){this.readOnlyMode=e.readOnlyMode}this.userId=e.userId;this.type=e.type;this.ownerId=e.ownerId;this.zIndex=e.zIndex||this.zIndex;this.dayOfWeekMonthFormat=e.dayOfWeekMonthFormat;this.plannerFeatureEnabled=!!e.plannerFeatureEnabled;this.isEditableSharingEvent=!!e.isEditableSharingEvent;this.openEditFormCallback=e.openEditFormCallback;this.create()}create(){if(this.DOM.changeLink&&!this.isReadOnly()){let e;if(!this.isEditableSharingEvent){e=()=>{if(!this.userSelectorDialog){this.userSelectorDialog=new r.Dialog({targetNode:this.DOM.changeLink,context:"CALENDAR",preselectedItems:this.attendeesPreselectedItems,enableSearch:true,zIndex:this.zIndex+10,events:{"Item:onSelect":this.handleUserSelectorChanges.bind(this),"Item:onDeselect":this.handleUserSelectorChanges.bind(this)},entities:[{id:"user",options:{inviteGuestLink:true,emailUsers:true}},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],searchTabOptions:{stubOptions:{title:p.Loc.getMessage("EC_USER_DIALOG_404_TITLE"),subtitle:p.Loc.getMessage("EC_USER_DIALOG_404_SUBTITLE"),icon:"/bitrix/images/calendar/search-email.svg",iconOpacity:100,arrow:true}}})}this.userSelectorDialog.show()};p.Event.bind(this.DOM.changeLink,"click",e)}}if(this.DOM.moreLink){p.Event.bind(this.DOM.moreLink,"click",this.showMoreAttendeesPopup.bind(this))}this.planner=new l.Planner({wrap:this.DOM.plannerOuterWrap,minWidth:je.PLANNER_WIDTH,width:je.PLANNER_WIDTH,showEntryName:false,locked:!this.plannerFeatureEnabled,dayOfWeekMonthFormat:this.dayOfWeekMonthFormat});p.Event.bind(this.DOM.informWrap,"click",(()=>{this.setInformValue(!this.meetingNotifyValue);this.emit("onNotifyChange")}));this.DOM.attendeesLabel.innerHTML=p.Text.encode(p.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"));this.planner.subscribe("onDateChange",(e=>{this.emit("onDateChange",e)}));this.planner.subscribe("onExpandTimeline",this.handleExpandPlannerTimeline.bind(this));if(this.DOM.hideGuestsWrap&&!this.isReadOnly()){p.Event.bind(this.DOM.hideGuestsWrap,"click",(()=>{this.setHideGuestsValue(!this.hideGuests)}))}}setValue({attendeesEntityList:e,attendees:t,location:i,notify:s,hideGuests:a,viewMode:n,entry:o}){var l,r;this.attendeesEntityList=p.Type.isArray(e)?e:[];this.attendeesPreselectedItems=this.attendeesEntityList.map((e=>[e.entityId,e.id]));this.entry=o;this.entryId=this.entry.id;this.setEntityList(this.attendeesEntityList);this.setInformValue(s);this.setLocationValue(i);if(p.Type.isArray(t)){this.displayAttendees(t)}this.refreshPlannerStateDebounce();let h=this.getDateTime();if(h){this.planner.updateSelector(h.from,h.to,h.fullDay)}if(this.entryId&&this.entry&&this.entry.data["PARENT_ID"]&&(this.entry.data["EVENT_TYPE"]==="#shared#"||this.entry.data["EVENT_TYPE"]==="#shared_crm#")&&this.entry.getCurrentStatus()!==false){p.Dom.clean(this.DOM.videocallWrap);p.Dom.removeClass(this.DOM.videocallWrap,"calendar-videocall-hidden");this.conferenceButton=p.Tag.render($e||($e=Fe`
				<div class="calendar-text-link --gray">${0}</div>
			`),p.Loc.getMessage("EC_CONFERENCE_START"));p.Event.bind(this.conferenceButton,"click",this.handleVideoconferenceButtonClick.bind(this));p.Dom.append(this.conferenceButton,this.DOM.videocallWrap)}else if((l=BX)!=null&&(r=l.Intranet)!=null&&r.ControlButton&&this.DOM.videocallWrap&&this.entryId&&this.entry.getCurrentStatus()!==false){p.Dom.clean(this.DOM.videocallWrap);p.Dom.removeClass(this.DOM.videocallWrap,"calendar-videocall-hidden");this.intranetControllButton=new c.IntranetButton({intranetControlButtonParams:{container:this.DOM.videocallWrap,entityType:"calendar_event",entityId:this.entry.parentId,mainItem:"chat",entityData:{dateFrom:m.Util.formatDate(this.entry.from),parentId:this.entry.parentId},analyticsLabel:{formType:"compact"}},callbacks:{getUsersCount:()=>this.attendeeList.accepted.length+this.attendeeList.requested.length,hasChat:()=>{var e,t;return((e=this.entry.data)==null?void 0:(t=e.MEETING)==null?void 0:t.CHAT_ID)>0}}})}else if(this.DOM.videocallWrap){p.Dom.addClass(this.DOM.videocallWrap,"calendar-videocall-hidden")}this.setHideGuestsValue(a)}handleUserSelectorChanges(){this.showPlanner();const e=this.getDateTime();this.planner.updateSelector(e.from,e.to,e.fullDay);this.setEntityList(this.userSelectorDialog.getSelectedItems().map((e=>({entityId:e.entityId,id:e.id,entityType:e.entityType}))));this.refreshPlannerStateDebounce();this.emit("onUserCodesChange")}getEntityList(){return this.selectorEntityList}setEntityList(e){if(this.type==="user"&&this.userId!==this.ownerId){e.push({entityId:"user",id:this.ownerId})}this.selectorEntityList=e}isReadOnly(){return this.readOnlyMode}getUserSelector(){return BX.UI.SelectorManager.instances[this.selectorId]}showPlanner(){if(!this.isPlannerDisplayed()){p.Dom.addClass(this.DOM.outerWrap,"user-selector-edit-mode");this.planner.show();this.planner.showLoader();if(this.entry.isFullDay()){this.planner.updateSelector(this.planner.currentFromDate,this.planner.currentToDate,true)}}}checkBusyTime(){const e=this.getDateTime();const t=this.getEntityList();this.planner.updateScaleLimitsFromEntry(e.from,e.to);this.runPlannerDataRequest({entityList:t,timezone:e.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId}).then((t=>{for(let e in t.data.accessibility){if(t.data.accessibility.hasOwnProperty(e)){this.loadedAccessibilityData[e]=t.data.accessibility[e]}}if(p.Type.isArray(t.data.entries)){t.data.entries.forEach((e=>{if(e.type==="user"&&!this.prevUserList.includes(parseInt(e.id))){this.prevUserList.push(parseInt(e.id))}}))}if(p.Type.isArray(t.data.accessibility[this.ownerId])){const i=this.getDateTime().from;const s=this.getDateTime().to;const a=this.preparedDataAccessibility(t.data.accessibility[this.ownerId]);if(!this.planner.currentFromDate){this.planner.currentFromDate=i}if(!this.planner.currentToDate){this.planner.currentToDate=s}const n=this.planner.checkTimePeriod(i,s,a);if(p.Type.isObject(n)&&p.Type.isArray(t.data.entries)){this.showPlanner();this.planner.update(t.data.entries,t.data.accessibility);this.planner.updateSelector(e.from,e.to,e.fullDay);this.planner.hideLoader();this.displayAttendees(this.prepareAttendeesForDisplay(t.data.entries))}}}))}prepareAttendeesForDisplay(e){return e.filter((e=>e.type==="user")).map((e=>({ID:e.id,AVATAR:e.avatar,DISPLAY_NAME:e.name,EMAIL_USER:e.emailUser,SHARING_USER:e.sharingUser,STATUS:(e.status||"").toUpperCase(),URL:e.url})))}refreshPlannerState(){if(this.planner&&this.planner.isShown()){let e=this.getDateTime();this.loadPlannerData({entityList:this.getEntityList(),timezone:e.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId,prevUserList:this.prevUserList})}}loadPlannerData(e={}){this.planner.showLoader();return new Promise((t=>{this.runPlannerDataRequest(e).then((e=>{for(let t in e.data.accessibility){if(e.data.accessibility.hasOwnProperty(t)){this.loadedAccessibilityData[t]=e.data.accessibility[t]}}if(p.Type.isArray(e.data.entries)){e.data.entries.forEach((e=>{if(e.type==="user"&&!this.prevUserList.includes(parseInt(e.id))){this.prevUserList.push(parseInt(e.id))}}))}this.planner.hideLoader();this.planner.update(e.data.entries,this.loadedAccessibilityData);t(e)}),(e=>{t(e)}))}))}runPlannerDataRequest(e){return this.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:{entryId:e.entryId||0,entryLocation:this.entry.data.LOCATION||"",ownerId:this.ownerId,hostId:this.entry.data.MEETING_HOST||null,type:this.type,entityList:e.entityList||[],dateFrom:m.Util.formatDate(this.planner.scaleDateFrom),dateTo:m.Util.formatDate(this.planner.scaleDateTo),timezone:e.timezone||"",location:e.location||"",entries:e.entrieIds||false,prevUserList:e.prevUserList||[]}})}setDateTime(e,t=false){this.dateTime=e;this.planner.currentFromDate=e.from;this.planner.currentToDate=e.to;if(this.planner&&t){this.planner.updateSelector(e.from,e.to,e.fullDay)}else if(this.planner){let t=parseInt(e.from.getHours())+Math.floor(e.from.getMinutes()/60);let i=parseInt(e.to.getHours())+Math.floor(e.to.getMinutes()/60);if(t!==0&&t<=this.planner.shownScaleTimeFrom||i!==0&&i!==23&&i+1>=this.planner.shownScaleTimeTo){this.planner.updateSelector(e.from,e.to,e.fullDay)}}}getDateTime(){return this.dateTime}setLocationValue(e){this.location=e}getLocationValue(){return this.location}displayAttendees(e=[]){p.Dom.clean(this.DOM.attendeesList);this.attendeeList=c.AttendeesList.sortAttendees(e);const t=this.attendeeList.accepted.length+this.attendeeList.requested.length;this.emit("onDisplayAttendees",new h.BaseEvent({data:{usersCount:t}}));const i=Math.min(this.attendeeList.accepted.length,je.MAX_USER_COUNT_DISPLAY);if(i>0){for(let e=0;e<i;e++){this.attendeeList.accepted[e].shown=true;this.DOM.attendeesList.appendChild(je.getUserAvatarNode(this.attendeeList.accepted[e]))}}this.DOM.attendeesLabel.innerHTML=p.Text.encode(p.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"));if(e.length>1){this.DOM.moreLink.innerHTML=p.Text.encode(p.Loc.getMessage("EC_ATTENDEES_ALL_COUNT").replace("#COUNT#",e.length));p.Dom.show(this.DOM.moreLink)}else{p.Dom.hide(this.DOM.moreLink)}if(this.hasExternalEmailUsers(e)&&this.isPlannerDisplayed()&&!this.isReadOnly()){this.showHideGuestsOption()}else{this.hideHideGuestsOption()}}static getUserAvatarNode(e){let t,i=e.AVATAR||e.SMALL_AVATAR;if(!i||i==="/bitrix/images/1.gif"){let i="ui-icon-common-user";if(e.EMAIL_USER){i="ui-icon-common-user-mail"}if(e.SHARING_USER){i+=" ui-icon-common-user-sharing"}t=p.Tag.render(Ye||(Ye=Fe`<div title="${0}" class="ui-icon ${0}"><i></i></div>`),p.Text.encode(e.DISPLAY_NAME),i)}else{t=p.Tag.render(Ge||(Ge=Fe`
			<img
				title="${0}"
				class="calendar-member"
				id="simple_popup_${0}"
				src="${0}"
			>`),p.Text.encode(e.DISPLAY_NAME),parseInt(e.ID),encodeURI(i))}return t}showMoreAttendeesPopup(){new c.AttendeesList(this.DOM.moreLink,this.attendeeList).showPopup()}setInformValue(e){if(p.Type.isBoolean(e)){const t="calendar-field-container-inform-off";this.meetingNotifyValue=e;if(this.meetingNotifyValue){p.Dom.removeClass(this.DOM.informWrap,t);this.DOM.informWrap.title=p.Loc.getMessage("EC_NOTIFY_OPTION_ON_TITLE");this.DOM.informWrapText.innerHTML=p.Loc.getMessage("EC_NOTIFY_OPTION")}else{p.Dom.addClass(this.DOM.informWrap,t);this.DOM.informWrap.title=p.Loc.getMessage("EC_NOTIFY_OPTION_OFF_TITLE");this.DOM.informWrapText.innerHTML=p.Loc.getMessage("EC_DONT_NOTIFY_OPTION")}}}getInformValue(e){return this.meetingNotifyValue}setViewMode(e){this.readOnlyMode=e;if(this.readOnlyMode){p.Dom.addClass(this.DOM.outerWrap,"calendar-userselector-readonly")}else{p.Dom.removeClass(this.DOM.outerWrap,"calendar-userselector-readonly")}}isPlannerDisplayed(){return this.planner.isShown()}hasExternalEmailUsers(e=[]){return!!e.find((e=>e.EMAIL_USER))||!!this.getEntityList().find((e=>e.entityType==="email"))}destroy(){if(this.userSelectorDialog&&this.userSelectorDialog.destroy){this.userSelectorDialog.destroy();this.userSelectorDialog=null}if(this.intranetControllButton&&this.intranetControllButton.destroy){this.intranetControllButton.destroy();this.intranetControllButton=null}}showHideGuestsOption(){this.DOM.hideGuestsWrap.style.display="";m.Util.initHintNode(this.DOM.hideGuestsWrap.querySelector(".calendar-hide-members-helper"))}hideHideGuestsOption(){this.DOM.hideGuestsWrap.style.display="none"}setHideGuestsValue(e=true){this.hideGuests=e;if(p.Type.isElementNode(this.DOM.hideGuestsIcon)){this.DOM.hideGuestsIcon.className=this.hideGuests?"calendar-hide-members-icon-hidden":"calendar-hide-members-icon-visible"}const t=this.DOM.hideGuestsWrap.querySelector(".calendar-hide-members-text");if(p.Type.isElementNode(t)){t.innerHTML=this.hideGuests?p.Loc.getMessage("EC_HIDE_GUEST_NAMES"):p.Loc.getMessage("EC_SHOW_GUEST_NAMES")}}preparedDataAccessibility(e){return e.map((e=>l.Planner.prepareAccessibilityItem(e)))}clearAccessibilityData(e){if(p.Type.isArray(e)&&e.length&&this.prevUserList.length){this.prevUserList=this.prevUserList.filter((t=>!e.includes(t)))}}handleExpandPlannerTimeline(e){if(e&&e.getData){let t=e.getData();if(t.reload){const e=this.getDateTime();this.loadPlannerData({entityList:this.getEntityList(),timezone:e.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId,focusSelector:false})}}}handleVideoconferenceButtonClick(){this.getConferenceChatId()}getConferenceChatId(){return this.BX.ajax.runAction("calendar.api.calendarajax.getConferenceChatId",{data:{eventId:this.entry.data["PARENT_ID"]}}).then((e=>{if(top.window.BXIM&&e.data&&e.data.chatId){top.BXIM.openMessenger("chat"+parseInt(e.data.chatId));return null}alert(p.Loc.getMessage("EC_CONFERENCE_ERROR"));return null}),(e=>{alert(p.Loc.getMessage("EC_CONFERENCE_ERROR"));return null}))}setEditableSharingEventMode(){p.Dom.style(this.DOM.changeLink,"display","inline-block");const e=()=>{if(p.Type.isFunction(this.openEditFormCallback())){this.openEditFormCallback()}};p.Event.bind(this.DOM.changeLink,"click",e);if(this.attendeesPreselectedItems.length<=2){const e=new BX.PopupWindow("ui-hint-popup-"+ +new Date,this.DOM.changeLink,{darkMode:true,content:p.Loc.getMessage("EC_EDIT_SHARING_EVENTS_FEATURE_POPUP_CONTENT"),angle:{position:"top",offset:50},autoHide:true,animation:{showClassName:"calendar-edit-sharing-events-feature-popup-animation-open",closeClassName:"calendar-edit-sharing-events-feature-popup-animation-close",closeAnimationType:"animation"}});setTimeout((()=>e.show()),500);setTimeout((()=>e.close()),5e3)}}}je.VIEW_MODE="view";je.EDIT_MODE="edit";je.MAX_USER_COUNT_DISPLAY=8;je.PLANNER_WIDTH=550;class qe extends h.EventEmitter{constructor(){super();this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ReinviteUserDialog");this.zIndex=3200;this.id="reinvite-dialog-"+Math.round(Math.random()*1e4)}show(){const e=p.Dom.create("DIV");this.close();this.dialog=new d.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:p.Loc.getMessage("EC_REINVITE_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"reinvite-popup-window",content:e,events:{},cacheable:false});new BX.UI.Button({text:p.Loc.getMessage("EC_REINVITE_YES"),className:"ui-btn ui-btn-primary",events:{click:()=>{this.emit("onSelect",new h.BaseEvent({data:{sendInvitesAgain:true}}));this.close()}}}).renderTo(e);new BX.UI.Button({text:p.Loc.getMessage("EC_REINVITE_NO"),className:"ui-btn ui-btn-light-border",events:{click:()=>{this.emit("onSelect",new h.BaseEvent({data:{sendInvitesAgain:false}}));this.close()}}}).renderTo(e);this.dialog.show()}close(){if(this.dialog){this.dialog.close()}}}let Ke=e=>e,Ze;class Qe extends h.EventEmitter{constructor(e){super();this.DOM={};this.CONFIRM_POPUP_ID="add_from_email";this.setEventNamespace("BX.Calendar.Controls.EmailSelectorControl");this.DOM.select=e.selectNode;this.mailboxList=p.Type.isArray(e.mailboxList)?e.mailboxList:[];this.DOM.componentWrap=this.DOM.select.parentNode.appendChild(p.Tag.render(Ze||(Ze=Ke`<div style="display: none;"></div>`)));this.allowAddNewEmail=e.allowAddNewEmail;this.checkValueDebounce=p.Runtime.debounce(this.checkValue,50,this);this.create()}create(){this.setSelectValues();p.Event.bind(this.DOM.select,"change",this.checkValueDebounce);p.Event.bind(this.DOM.select,"click",this.checkValueDebounce)}checkValue(){if(this.DOM.select.value==="add"){this.showAdd();this.setValue("")}}getValue(){return this.DOM.select.value}setValue(e){if(this.mailboxList.length&&this.mailboxList.find((t=>t.email===e))){this.DOM.select.value=e}else{this.DOM.select.value=""}this.emit("onSetValue",{value:this.DOM.select.value})}setSelectValues(){p.Dom.clean(this.DOM.select);this.DOM.select.options.add(new Option(p.Loc.getMessage("EC_NO_VALUE"),""));if(this.mailboxList.length){this.mailboxList.forEach((e=>{this.DOM.select.options.add(new Option(e.formatted,e.email))}),this)}if(this.allowAddNewEmail){this.DOM.select.options.add(new Option(p.Loc.getMessage("EC_ADD_NEW"),"add"))}}onClick(e){this.input.value=e.sender;this.mailbox.textContent=e.sender}showAdd(){if(window.BXMainMailConfirm){window.BXMainMailConfirm.showForm(this.onAdd.bind(this))}const e=d.PopupManager.getPopupById(this.CONFIRM_POPUP_ID);if(e){e.subscribe("onClose",(()=>{this.reloadMailboxList()}))}}onAdd(e){this.reloadMailboxList().then((()=>{setTimeout((()=>{this.setValue(e.email)}),0)}))}getMenuItem(e){return{id:e.id,text:BX.util.htmlspecialchars(e.sender),onclick:this.onClick.bind(this,e)}}loadMailboxData(){return new Promise((e=>{BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxData").then((t=>{BX.html(this.DOM.componentWrap,t.data.html);this.mailboxList=t.data.additionalParams.mailboxList;this.checkBXMainMailConfirmLoaded(e)}))}))}checkBXMainMailConfirmLoaded(e){if(window.BXMainMailConfirm){this.setSelectValues();e()}else{setTimeout((()=>{this.checkBXMainMailConfirmLoaded(e)}),200)}}reloadMailboxList(){return new Promise((e=>{BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxList").then((t=>{this.mailboxList=t.data.mailboxList;this.setSelectValues();e()}))}))}}let Je=e=>e,et;class tt extends h.EventEmitter{constructor(){super();this.Z_INDEX=3200;this.SLIDER_Z_INDEX=4400;this.WIDTH=400;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.ConfirmedEmailDialog");this.id="confirm-email-dialog-"+Math.round(Math.random()*1e4)}show(){this.DOM.content=p.Tag.render(et||(et=Je`<div>
			<div class="calendar-confirm-email-text">${0}</div>
			<div class="calendar-confirm-email-text"><a class="calendar-confirm-email-help-link" href="javascript:void(0);">${0}</a></div>
			<div class="calendar-field-block">
				<select class="calendar-field calendar-field-select ui-btn ui-btn ui-btn-light-border ui-btn-clock"></select>
			</div>
		</div>`),p.Loc.getMessage("EC_CONFIRMED_EMAIL_TEXT_1"),p.Loc.getMessage("EC_CONFIRMED_EMAIL_HELP_LINK"));this.dialog=new d.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:p.Loc.getMessage("EC_CONFIRMED_EMAIL_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"confirmemail-popup-window",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:p.Loc.getMessage("EC_CONFIRMED_EMAIL_SEND"),className:`ui-btn ui-btn-primary ${BX.UI.Button.State.DISABLED}`,events:{click:()=>{if(this.DOM.select.value&&this.DOM.select.value!=="add"){const e=m.Util.getUserSettings();e.sendFromEmail=this.emailSelectorControl.getValue();m.Util.setUserSettings(e);BX.userOptions.save("calendar","user_settings","sendFromEmail",e.sendFromEmail);this.emit("onSelect",new h.BaseEvent({data:{sendFromEmail:e.sendFromEmail}}));this.close()}}}}),new BX.UI.Button({text:p.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-light-border",events:{click:this.close.bind(this)}})]});this.DOM.processButton=this.dialog.buttons[0].button;this.DOM.select=this.DOM.content.querySelector("select.calendar-field-select");p.Dom.addClass(this.DOM.select,BX.UI.Button.State.CLOCKING);this.DOM.select.disabled=true;this.emailSelectorControl=new c.EmailSelectorControl({selectNode:this.DOM.select,allowAddNewEmail:true});p.Event.bind(this.DOM.select,"change",this.handleSelectChanges.bind(this));this.emailSelectorControl.subscribe("onSetValue",this.handleSelectChanges.bind(this));this.emailSelectorControl.loadMailboxData().then((()=>{this.emailSelectorControl.setValue(m.Util.getUserSettings().sendFromEmail);this.DOM.select.disabled=false;this.DOM.select.className="calendar-field calendar-field-select"}));this.DOM.helpLinlk=this.DOM.content.querySelector(".calendar-confirm-email-help-link");p.Event.bind(this.DOM.helpLinlk,"click",this.openHelpSlider.bind(this));this.dialog.show()}close(){if(this.dialog){this.dialog.close()}}handleSelectChanges(){if(this.DOM.select.value&&this.DOM.select.value!=="add"){p.Dom.removeClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}else{p.Dom.addClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}}openHelpSlider(){if(BX.Helper){BX.Helper.show("redirect=detail&code=12070142",{zIndex:this.SLIDER_Z_INDEX})}}}let it=e=>e,st;class at extends h.EventEmitter{constructor(){super();this.Z_INDEX=3200;this.EXPAND_LICENSE_URL="/settings/license_all.php";this.WIDTH=480;this.DOM={};this.setEventNamespace("BX.Calendar.Controls.EmailLimitationDialog");this.id="email-limitation-dialog-"+Math.round(Math.random()*1e4)}show(){const e=m.Util.getEventWithEmailGuestAmount();const t=m.Util.isEventWithEmailGuestAllowed();if(e===4){this.text=p.Loc.getMessage("EC_EMAIL_LIMIT_5")}else if(e===8){this.text=p.Loc.getMessage("EC_EMAIL_LIMIT_9")}else{this.text=p.Loc.getMessage("EC_EMAIL_LIMIT_DENY")}this.subText=p.Loc.getMessage("EC_EMAIL_LIMIT_SUBTEXT");this.DOM.content=p.Tag.render(st||(st=it`<div>
			<div class="calendar-email-limit-text">${0}</div>
			<div class="calendar-email-limit-subtext">${0}</div>
		</div>`),this.text,this.subText);this.dialog=this.getDialogPopup();this.dialog.subscribe("onClose",(()=>{this.emit("onClose")}));this.dialog.show()}getDialogPopup(){return new d.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:p.Loc.getMessage("EC_EMAIL_LIMIT_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"email-limit-popup",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:p.Loc.getMessage("EC_EMAIL_LIMIT_EXPAND_PLAN"),className:`ui-btn ui-btn-primary ui-btn-icon-plan`,events:{click:()=>{window.open(this.EXPAND_LICENSE_URL,"_blank")}}}),new BX.UI.Button({text:m.Util.isEventWithEmailGuestAllowed()?p.Loc.getMessage("EC_SEC_SLIDER_CLOSE"):p.Loc.getMessage("EC_EMAIL_LIMIT_SAVE_WITHOUT"),className:`ui-btn ui-btn-link`,events:{click:this.close.bind(this)}})]})}close(){if(this.dialog){this.dialog.close()}}}class nt{constructor(e,t={}){this.attendeesList=t;this.node=e}setAttendeesList(e){this.attendeesList=e;return this}showPopup(){if(this.popup){this.popup.destroy()}const e=this.getMenuItems();this.popup=this.getPopup(e);this.popup.show();this.addAvatarToMenuItems()}addAvatarToMenuItems(){this.popup.menuItems.forEach((e=>{const t=e.layout.item.querySelector(".menu-popup-item-icon");if(p.Type.isPlainObject(e.dataset)){t.appendChild(c.UserPlannerSelector.getUserAvatarNode(e.dataset.user))}}))}getPopup(e){return d.MenuManager.create("compact-event-form-attendees"+Math.round(Math.random()*1e5),this.node,e,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true,cacheable:false,className:"calendar-popup-user-menu"})}getMenuItems(){const e=[];[{code:"accepted",title:p.Loc.getMessage("EC_ATTENDEES_Y_NUM")},{code:"requested",title:p.Loc.getMessage("EC_ATTENDEES_Q_NUM")},{code:"declined",title:p.Loc.getMessage("EC_ATTENDEES_N_NUM")}].forEach((t=>{let i=this.attendeesList[t.code];if(i.length>0){e.push(new d.MenuItem({text:t.title.replace("#COUNT#",i.length),delimiter:true}));i.forEach((t=>{t.toString=()=>t.ID;e.push({text:BX.util.htmlspecialchars(t.DISPLAY_NAME),dataset:{user:t},className:"calendar-add-popup-user-menu-item",onclick:()=>{BX.SidePanel.Instance.open(t.URL,{loader:"intranet:profile",cacheable:false,allowChangeHistory:false,contentClassName:"bitrix24-profile-slider-content",width:1100})}})}))}}));return e}static sortAttendees(e){return{accepted:e.filter((e=>["H","Y"].includes(e.STATUS))),requested:e.filter((e=>e.STATUS==="Q"||e.STATUS==="")),declined:e.filter((e=>e.STATUS==="N"))}}}class ot{constructor(e={}){this.intranetControllButton=new u.ControlButton(e.intranetControlButtonParams);this.hasChat=e.callbacks.hasChat;this.getUsersCount=e.callbacks.getUsersCount;if(p.Type.isElementNode(this.intranetControllButton.button)){this.openChat=this.intranetControllButton.openChat.bind(this.intranetControllButton);this.intranetControllButton.openChat=this.openChatWithConfirm.bind(this);this.startVideoCall=this.intranetControllButton.startVideoCall.bind(this.intranetControllButton);this.intranetControllButton.startVideoCall=this.startVideoCallWithConfirm.bind(this);const t=this.intranetControllButton.button.querySelector("button.ui-btn-main");if(e.intranetControlButtonParams.mainItem==="chat"){this.setClickListener(t,this.openChatWithConfirm.bind(this))}else{this.setClickListener(t,this.startVideoCallWithConfirm.bind(this))}this.intranetControllButton.button.setAttribute("data-role","videocallButton")}}openChatWithConfirm(){if(this.shouldNotConfirmOpenChat()){this.openChat();return}m.Util.showConfirmPopup(this.openChat,p.Loc.getMessage("EC_CREATE_CHAT_CONFIRM_QUESTION"),{okCaption:p.Loc.getMessage("EC_CREATE_CHAT_OK"),minWidth:350,maxWidth:350})}startVideoCallWithConfirm(){if(this.shouldNotConfirmOpenChat()){this.startVideoCall();return}m.Util.showConfirmPopup(this.startVideoCall,p.Loc.getMessage("EC_START_VIDEOCONFERENCE_CONFIRM_QUESTION"),{okCaption:p.Loc.getMessage("EC_START_VIDEOCONFERENCE_OK"),minWidth:350,maxWidth:350})}shouldNotConfirmOpenChat(){return this.hasChat()||this.getUsersCount()<10}setClickListener(e,t){const i=e.cloneNode(true);p.Event.bind(i,"click",t);e.parentNode.replaceChild(i,e)}destroy(){if(this.intranetControllButton&&this.intranetControllButton.destroy){this.intranetControllButton.destroy();this.intranetControllButton=null}}}e.Reminder=I;e.Location=k;e.UserSelector=A;e.ColorSelector=H;e.SectionSelector=te;e.RepeatSelector=ie;e.TimeSelector=f;e.SelectInput=se;e.PopupDialog=ae;e.ViewSelector=ce;e.LineViewSelector=fe;e.AddButton=ge;e.MeetingStatusControl=De;e.ConfirmStatusDialog=Ee;e.ConfirmEditDialog=Oe;e.ConfirmDeleteDialog=be;e.DateTimeControl=He;e.BusyUsersDialog=ze;e.UserPlannerSelector=je;e.ReinviteUserDialog=qe;e.EmailSelectorControl=Qe;e.ConfirmedEmailDialog=tt;e.EmailLimitationDialog=at;e.AttendeesList=nt;e.IntranetButton=ot})(this.BX.Calendar.Controls=this.BX.Calendar.Controls||{},BX.Calendar,BX.Calendar,BX,BX.Calendar,BX.UI.Dialogs,BX.UI,BX.Calendar,BX.UI.EntitySelector,BX.Event,BX.Main,BX.Calendar.Controls,BX.Intranet,BX,BX.Calendar);
//# sourceMappingURL=controls.bundle.map.js