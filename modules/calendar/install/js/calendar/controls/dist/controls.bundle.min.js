this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,i,a,n,s,l,o,r,u,d){"use strict";var c=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"Z_INDEX",4e3);babelHelpers.defineProperty(this,"MIN_WIDTH",102);this.DOM={wrap:t.wrap,input:t.input};this.onChangeCallback=l.Type.isFunction(t.onChangeCallback)?t.onChangeCallback:null;this.create()}babelHelpers.createClass(e,[{key:"create",value:function t(){var i=this;this.selectContol=new BX.Calendar.Controls.SelectInput({input:this.DOM.input,zIndex:this.Z_INDEX,values:e.getValueList(),minWidth:this.MIN_WIDTH,onChangeCallback:function e(){if(i.onChangeCallback){i.onChangeCallback(i.selectContol.getInputValue())}}})}},{key:"setValue",value:function t(i){var a;if(l.Type.isDate(i)){a={h:i.getHours(),m:i.getMinutes()}}else{a=d.Util.parseTime(i)}var n=e.adaptTimeValue(a);this.selectContol.setValue({value:n.value});var s=Math.floor(n.value/60);var o=n.value-s*60;this.DOM.input.value=d.Util.formatTime(s,o)}}],[{key:"adaptTimeValue",value:function t(i){i=parseInt(i.h*60)+parseInt(i.m);var a=e.getValueList(),n=24*60,s=false,l;for(l=0;l<a.length;l++){if(Math.abs(a[l].value-i)<n){n=Math.abs(a[l].value-i);s=l;if(n<=15){break}}}return a[s||0]}},{key:"getValueList",value:function t(){if(!e.valueList){e.valueList=[];var i;for(i=0;i<24;i++){e.valueList.push({value:i*60,label:d.Util.formatTime(i,0)});e.valueList.push({value:i*60+30,label:d.Util.formatTime(i,30)})}}return e.valueList}}]);return e}();babelHelpers.defineProperty(c,"valueList",null);function p(){var e=babelHelpers.taggedTemplateLiteral(['<input id="inp-','" type="text" class="calendar-field calendar-field-datetime" value="" autocomplete="off" placeholder="','"/>']);p=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);h=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-reminder-item">\n\t\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>"]);f=function t(){return e};return e}function m(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);m=function t(){return e};return e}function v(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-item">\n\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</span>"]);v=function t(){return e};return e}function b(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);b=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-reminder-item">\n\t\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>"]);g=function t(){return e};return e}function D(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="calendar-notification-add-btn-wrap">\n\t\t\t\t\t<span class="calendar-notification-text">','</span>\n\t\t\t\t\t<span class="calendar-notification-btn-container calendar-notification-btn-add">\n\t\t\t\t\t\t<span class="calendar-notification-icon"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</span>']);D=function t(){return e};return e}var M=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"defaultReminderTime",540);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"fullDayMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"extendedMode",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"selectedValues",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"controlList",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"viewMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"changedByUser",false);i.setEventNamespace("BX.Calendar.Controls.Reminder");i.values=i.getValues();i.id=e.id||"reminder-"+Math.round(Math.random()*1e6);i.zIndex=e.zIndex||3200;i.rawValuesMap=new Map;i.viewMode=e.viewMode===true;i.changeCallack=e.changeCallack;i.showPopupCallBack=e.showPopupCallBack;i.hidePopupCallBack=e.hidePopupCallBack;i.create(e);i.setValue(e.selectedValues||[]);i.bindEventHandlers();return i}babelHelpers.createClass(t,[{key:"create",value:function e(t){if(l.Type.isElementNode(t.wrap)){this.DOM.wrap=t.wrap}if(!l.Type.isElementNode(this.DOM.wrap)){return}l.Dom.addClass(this.DOM.wrap,"calendar-notification-values");if(!this.viewMode){this.DOM.addButton=this.DOM.wrap.appendChild(l.Tag.render(D(),l.Loc.getMessage("EC_REMIND1_ADD")))}}},{key:"bindEventHandlers",value:function e(){if(l.Type.isDomNode(this.DOM.addButton)){l.Event.bind(this.DOM.addButton,"click",this.showPopup.bind(this))}if(l.Type.isDomNode(this.DOM.wrap)){l.Event.bind(this.DOM.wrap,"click",this.handleClick.bind(this))}}},{key:"getValues",value:function e(){var t=[];if(!this.fullDayMode){t=t.concat([{value:0,label:l.Loc.getMessage("EC_REMIND1_0"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_0")},{value:5,label:l.Loc.getMessage("EC_REMIND1_5"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_5")},{value:10,label:l.Loc.getMessage("EC_REMIND1_10"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_10")},{value:15,label:l.Loc.getMessage("EC_REMIND1_15"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_15")},{value:20,label:l.Loc.getMessage("EC_REMIND1_20"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_20")},{value:30,label:l.Loc.getMessage("EC_REMIND1_30"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_30")},{value:60,label:l.Loc.getMessage("EC_REMIND1_60"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_60")},{value:120,label:l.Loc.getMessage("EC_REMIND1_120"),shortLabel:l.Loc.getMessage("EC_REMIND1_SHORT_120")}])}if(this.extendedMode){t=t.concat([{id:"time-menu-day-0",label:l.Loc.getMessage("EC_REMIND1_DAY_0"),dataset:{mode:"time-menu",daysBefore:0,time:this.defaultReminderTime}},{id:"time-menu-day-1",label:l.Loc.getMessage("EC_REMIND1_DAY_1"),dataset:{mode:"time-menu",daysBefore:1,time:this.defaultReminderTime}},{id:"time-menu-day-2",label:l.Loc.getMessage("EC_REMIND1_DAY_2"),dataset:{mode:"time-menu",daysBefore:2,time:this.defaultReminderTime}},{id:"custom",label:l.Loc.getMessage("EC_REMIND1_CUSTOM"),dataset:{mode:"custom"}}])}return t}},{key:"setValue",value:function e(t){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.selectedValues.forEach(function(e){i.removeValue(e,a)});if(l.Type.isArray(t)){t.forEach(function(e){i.addValue(e,a,n)},this)}}},{key:"getSelectedValues",value:function e(){return this.selectedValues}},{key:"getSelectedRawValues",value:function e(){var t=this;var i=[];this.selectedValues.forEach(function(e){i.push(t.rawValuesMap.get(e)||e)});return i}},{key:"setFullDayMode",value:function e(t){if(t!==this.fullDayMode){this.fullDayMode=t;this.values=this.getValues()}}},{key:"showPopup",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=this;var n=[];this.values.forEach(function(e){if(e.mode==="time-menu"||e.mode==="custom"||!BX.util.in_array(e.value,t.selectedValues)){var s={};if(e.dataset&&e.dataset.mode==="time-menu"){s.id=e.id;var o=d.Util.getTimeByInt(t.defaultReminderTime);s.text=e.label.replace("#TIME#",d.Util.formatTime(o.hour,o.min));s.dataset=BX.util.objectMerge({type:"submenu-list",value:t.defaultReminderTime},e.dataset);s.items=t.getSubmenuTimeValues(s,e.label,i);s.onclick=function(){return function(){a.addValue({before:e.dataset.daysBefore,time:e.dataset.time});BX.defer(function(){a.reminderMenu.close()},a)();if(l.Type.isFunction(i.addValueCallback)){i.addValueCallback()}}}()}else if(e.dataset&&e.dataset.mode==="custom"){s.id="custom";s.text=e.label;s.items=[{id:"tmp",text:"tmp"}]}else{s.text=e.label;s.onclick=function(e,t){return function(){a.addValue(e);a.reminderMenu.close();if(l.Type.isFunction(i.addValueCallback)){i.addValueCallback()}}}(e.value,e.mode)}n.push(s)}},this);this.reminderMenu=r.MenuManager.create(this.id,i.bindTarget||this.DOM.addButton,n,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});var s=this.adjustSubmenuPopup.bind(this);var u=this.closeSubmenuPopup.bind(this);o.EventEmitter.subscribe("BX.Main.Popup:onShow",s);o.EventEmitter.subscribe("BX.Main.Popup:onClose",u);this.reminderMenu.popupWindow.subscribe("onClose",function(){o.EventEmitter.unsubscribe("BX.Main.Popup:onShow",s);o.EventEmitter.unsubscribe("BX.Main.Popup:onClose",u)});this.reminderMenu.show()}},{key:"getSubmenuTimeValues",value:function e(i,a,n){var s=[];t.getTimeValueList(60).forEach(function(e){s.push({id:"time-"+e.value,dataset:{value:e.value,daysBefore:i.dataset.daysBefore},text:e.label,onclick:function(e,t){var s=d.Util.getTimeByInt(t.dataset.value);var o=this.reminderMenu.getMenuItem(i.id);if(o){o.setText(a.replace("#TIME#",d.Util.formatTime(s.hour,s.min)))}this.addValue({time:t.dataset.value,before:t.dataset.daysBefore});BX.defer(function(){this.reminderMenu.close()},this)();if(l.Type.isFunction(n.addValueCallback)){n.addValueCallback()}}.bind(this)})},this);return s}},{key:"addValue",value:function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var s;var r=t.formatValue(i);if(l.Type.isPlainObject(i)&&i.count){i=parseInt(r)}if(l.Type.isPlainObject(i)&&!this.selectedValues.includes(r)){if(l.Type.isInteger(parseInt(i.before))&&l.Type.isInteger(parseInt(i.time))){s=this.DOM.wrap.appendChild(l.Tag.render(g(),t.getReminderLabel(i)));if(!this.viewMode){s.appendChild(l.Tag.render(b(),r))}}else if(i.type==="date"&&l.Type.isDate(i.value)){s=this.DOM.wrap.appendChild(l.Tag.render(v(),d.Util.formatDateUsable(i.value)+" "+d.Util.formatTime(i.value)));if(!this.viewMode){s.appendChild(l.Tag.render(m(),r))}}this.selectedValues.push(r);this.controlList[r]=s;this.rawValuesMap.set(r,i)}else if(parseInt(i)>=0&&!this.selectedValues.includes(r)){for(var u=0;u<this.values.length;u++){if(this.values[u].value===parseInt(i)){s=this.DOM.wrap.appendChild(l.Tag.render(f(),this.values[u].shortLabel||this.values[u].label));if(!this.viewMode){s.appendChild(l.Tag.render(h(),r))}this.selectedValues.push(r);this.controlList[r]=s;this.rawValuesMap.set(r,i);break}}if(s===undefined){s=this.DOM.wrap.appendChild(l.Dom.create("SPAN",{props:{className:"calendar-reminder-item"},text:t.getText(i)}));if(!this.viewMode){s.appendChild(l.Dom.create("SPAN",{props:{className:"calendar-reminder-clear-icon"},events:{click:function(){this.removeValue(i)}.bind(this)}}))}this.selectedValues.push(i);this.controlList[i]=s;this.rawValuesMap.set(i,i)}}if(this.changeCallack){this.changeCallack(this.selectedValues)}if(a){this.emit("onChange",new o.BaseEvent({data:{values:this.selectedValues}}))}this.changedByUser=a&&n;if(l.Type.isElementNode(this.DOM.addButton)){this.DOM.wrap.appendChild(this.DOM.addButton)}}},{key:"removeValue",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.controlList[t]&&l.Type.isDomNode(this.controlList[t])){l.Dom.remove(this.controlList[t])}this.selectedValues=BX.util.deleteFromArray(this.selectedValues,BX.util.array_search(t,this.selectedValues));if(this.changeCallack){this.changeCallack(this.selectedValues)}if(i){this.emit("onChange",new o.BaseEvent({data:{values:this.selectedValues}}));this.changedByUser=true}}},{key:"handleClick",value:function e(t){var i=this;var a=t.target||t.srcElement;var n=a.getAttribute("data-bxc-value");if(!l.Type.isNull(n)&&this.selectedValues.includes(n)){this.removeValue(n)}if(l.Dom.hasClass(a,"calendar-reminder-item-title")){this.showPopup({bindTarget:a,addValueCallback:function e(){var t=a.parentNode.querySelector(".calendar-reminder-clear-icon");if(l.Type.isElementNode(t)&&!l.Type.isNull(t.getAttribute("data-bxc-value"))){i.removeValue(t.getAttribute("data-bxc-value"))}}})}}},{key:"adjustSubmenuPopup",value:function e(t){if(t instanceof o.BaseEvent){var i=t.getTarget();if(i instanceof r.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(i.getId())){this.adjustTimeSubmenuPopup(i)}else if(/^menu-popup-popup-submenu-custom$/.test(i.getId())){this.adjustCalendarSubmenuPopup(i)}}}}},{key:"closeSubmenuPopup",value:function e(t){if(t instanceof o.BaseEvent){var i=t.getTarget();if(i instanceof r.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(i.getId()));else if(/^menu-popup-popup-submenu-custom$/.test(i.getId())){var a=i.bindElement;var n=a.querySelector(".menu-popup-item-text");if(l.Type.isDomNode(n)){l.Dom.clean(n);n.innerHTML=l.Loc.getMessage("EC_REMIND1_CUSTOM")}}}}}},{key:"adjustTimeSubmenuPopup",value:function e(t){var i=t.getContentContainer().querySelector('span[data-value="'+this.defaultReminderTime+'"]');if(l.Type.isDomNode(i)){setTimeout(function(){t.getContentContainer().scrollTop=parseInt(i.offsetTop)-10;l.Dom.addClass(i,"menu-popup-item-open")},50)}}},{key:"adjustCalendarSubmenuPopup",value:function e(t){var i=this;var a=t.bindElement;var n=a.querySelector(".menu-popup-item-text");if(l.Type.isDomNode(n)){l.Dom.clean(n);var s=n.appendChild(l.Tag.render(p(),Math.round(Math.random()*1e5),l.Loc.getMessage("EC_REMIND1_CUSTOM_PLACEHOLDER")));var o=BX.calendar.get();o.popup=null;o._current_layer=null;o._layers={};o.Show({node:s,value:d.Util.formatDateTime(d.Util.getUsableDateTime(new Date)),field:s,bTime:true,bHideTime:false});var u=o.popup;u.cacheable=false;if(u&&u.popupContainer){var c=u.popupContainer.querySelector(".bx-calendar");if(l.Type.isDomNode(c)){t.contentContainer.appendChild(c)}u.close();r.MenuManager.destroy(u.uniquePopupId)}l.Event.bind(s,"change",function(){var e=s.value,t=d.Util.parseDate(e);if(l.Type.isDate(t)){i.addValue({type:"date",value:t});i.reminderMenu.close()}})}}},{key:"setViewMode",value:function e(t){this.viewMode=t;if(this.viewMode){l.Dom.addClass(this.DOM.wrap,"calendar-reminder-readonly");if(l.Type.isElementNode(this.DOM.addButton)){this.DOM.addButton.style.display="none"}}else{l.Dom.removeClass(this.DOM.wrap,"calendar-reminder-readonly")}}},{key:"wasChangedByUser",value:function e(){return this.changedByUser}}],[{key:"getTimeValueList",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:30;if(!t.timeValueList){t.timeValueList=[];var a;for(a=0;a<24;a++){t.timeValueList.push({value:a*60,label:d.Util.formatTime(a,0)});if(i<=30){t.timeValueList.push({value:a*60+30,label:d.Util.formatTime(a,30)})}}}return t.timeValueList}},{key:"inputCalendarClosePopupHandler",value:function e(t){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}},{key:"getReminderLabel",value:function e(t){var i="";t.before=parseInt(t.before);t.time=parseInt(t.time);if(l.Type.isInteger(t.before)&&l.Type.isInteger(t.time)&&[0,1,2].includes(t.before)){var a=d.Util.getTimeByInt(t.time);i=l.Loc.getMessage("EC_REMIND1_DAY_"+t.before+"_SHORT").replace("#TIME#",d.Util.formatTime(a.hour,a.min))}return i}},{key:"getText",value:function e(t){var i=t,a=[60,24],n=["EC_REMIND1_MIN_COUNT","EC_REMIND1_HOUR_COUNT","EC_REMIND1_DAY_COUNT"],s="";for(var o=0;o<n.length;o++){if(i<a[o]||o===a.length){s=l.Loc.getMessage(n[o]).toString();s=s.replace("#COUNT#",i.toString());break}else{i=Math.ceil(i/a[o])}}return s}},{key:"formatValue",value:function e(t){if(l.Type.isPlainObject(t)&&l.Type.isInteger(parseInt(t.before))&&l.Type.isInteger(parseInt(t.time))){return"daybefore|"+t.before+"|"+t.time}else if(l.Type.isPlainObject(t)&&l.Type.isDate(t.value)){return"date|"+d.Util.formatDateTime(t.value)}else if(l.Type.isPlainObject(t)&&t.type){if(t.type==="min"){return t.count.toString()}if(t.type==="hour"){return(parseInt(t.count)*60).toString()}if(t.type==="day"){return(parseInt(t.count)*60*24).toString()}}return t.toString()}}]);return t}(o.EventEmitter);babelHelpers.defineProperty(M,"timeValueList",null);function y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-text-link">',"</span>"]);y=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-place-link">',"\n\t\t\t\t</div>"]);C=function t(){return e};return e}var T=function(){function e(t){babelHelpers.classCallCheck(this,e);this.params=t;this.id=t.id||"location-"+Math.round(Math.random()*1e6);this.zIndex=t.zIndex||3100;this.DOM={wrapNode:t.wrap};this.disabled=!t.richLocationEnabled;this.value={type:"",text:"",value:""};this.inlineEditModeEnabled=t.inlineEditModeEnabled;this.meetingRooms=t.iblockMeetingRoomList||[];e.setMeetingRoomList(t.iblockMeetingRoomList);e.setLocationList(t.locationList);this.create()}babelHelpers.createClass(e,[{key:"create",value:function e(){this.DOM.inputWrap=this.DOM.wrapNode.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-block"}}));if(this.inlineEditModeEnabled){this.DOM.inlineEditLinkWrap=this.DOM.wrapNode.appendChild(l.Tag.render(C(),this.DOM.inlineEditLink=l.Tag.render(y(),l.Loc.getMessage("EC_REMIND1_ADD"))));this.DOM.inputWrap.style.display="none";l.Event.bind(this.DOM.inlineEditLinkWrap,"click",this.displayInlineEditControls.bind(this))}if(this.disabled){BX.addClass(this.DOM.wrapNode,"locked");this.DOM.inputWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-lock-icon"},events:{click:function e(){B24.licenseInfoPopup.show("calendar_location",l.Loc.getMessage("EC_B24_LOCATION_LIMITATION_TITLE"),l.Loc.getMessage("EC_B24_LOCATION_LIMITATION"))}}}))}this.DOM.input=this.DOM.inputWrap.appendChild(l.Dom.create("INPUT",{attrs:{name:this.params.inputName||"",placeholder:l.Loc.getMessage("EC_LOCATION_LABEL"),type:"text",autocomplete:this.disabled?"on":"off"},props:{className:"calendar-field calendar-field-select"}}))}},{key:"setValues",value:function t(){var i=[],a=false,n=e.getMeetingRoomList(),s=e.getLocationList();if(l.Type.isArray(n)){n.forEach(function(e){e.ID=parseInt(e.ID);i.push({ID:e.ID,label:BX.util.htmlspecialchars(e.NAME),labelRaw:e.NAME,value:e.ID,type:"mr"});if(this.value.type==="mr"&&parseInt(this.value.value)===e.ID){a=i.length-1}},this);if(i.length>0){i.push({delimiter:true})}}if(l.Type.isArray(s)){if(s.length){s.forEach(function(e){e.ID=parseInt(e.ID);i.push({ID:e.ID,label:BX.util.htmlspecialchars(e.NAME),labelRaw:e.NAME,value:e.ID,type:"calendar"});if(this.value.type==="calendar"&&parseInt(this.value.value)===parseInt(e.ID)){a=i.length-1}},this);i.push({delimiter:true});i.push({label:l.Loc.getMessage("EC_LOCATION_MEETING_ROOM_SET"),callback:this.editMeetingRooms.bind(this)})}else{i.push({label:l.Loc.getMessage("EC_ADD_LOCATION"),callback:this.editMeetingRooms.bind(this)})}}if(this.value){this.DOM.input.value=this.value.str||"";if(this.value.type&&this.value.str===this.getTextLocation(this.value)){this.DOM.input.value=l.Loc.getMessage("EC_LOCATION_404")}}if(this.selectContol){this.selectContol.destroy()}this.selectContol=new BX.Calendar.Controls.SelectInput({input:this.DOM.input,values:i,valueIndex:a,zIndex:this.zIndex,disabled:this.disabled,onChangeCallback:BX.delegate(function(){var e,t=this.DOM.input.value;this.value={text:t};for(e=0;e<i.length;e++){if(i[e].labelRaw===t){this.value.type=i[e].type;this.value.value=i[e].value;break}}if(l.Type.isFunction(this.params.onChangeCallback)){this.params.onChangeCallback()}},this)})}},{key:"editMeetingRooms",value:function e(){var t={};if(this.params.getControlContentCallback){t.wrap=this.params.getControlContentCallback()}if(!t.wrap){t.wrap=this.showEditMeetingRooms()}this.buildLocationEditControl(t)}},{key:"showEditMeetingRooms",value:function e(){if(this.editDialog){this.editDialog.destroy()}this.editDialogContent=l.Dom.create("DIV",{props:{className:"bxec-location-wrap"}});this.editDialog=new BX.PopupWindow(this.id+"_popup",null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_MEETING_ROOM_LIST_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:l.Loc.getMessage("EC_SEC_SLIDER_SAVE"),events:{click:BX.delegate(function(){this.saveValues();if(this.editDialog){this.editDialog.close()}},this)}}),new BX.PopupWindowButtonLink({text:l.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(function(){if(this.editDialog){this.editDialog.close()}},this)}})],content:this.editDialogContent,events:{}});this.editDialog.show();return this.editDialogContent}},{key:"buildLocationEditControl",value:function t(i){var a;this.locationEditControlShown=true;this.editDialogWrap=i.wrap;this.locationRoomList=[];this.addNewButtonField=false;if(l.Type.isArray(e.locationList)){e.locationList.forEach(function(e){if(e.NAME!==""&&e.ID){this.locationRoomList.push({id:parseInt(e.ID),name:e.NAME})}},this)}if(!this.locationRoomList.length){this.locationRoomList.push({id:0,name:""})}for(a=0;a<this.locationRoomList.length;a++){this.addRoomField(this.locationRoomList[a],i.wrap)}this.addNewButtonField={outerWrap:i.wrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-container-text"}}))};this.addNewButtonField.innerWrap=this.addNewButtonField.outerWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-block"}}));this.addNewButtonField.innerCont=this.addNewButtonField.innerWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-text"},html:'<span class="calendar-text-link">'+l.Loc.getMessage("EC_MEETING_ROOM_ADD")+"</span>",events:{click:BX.delegate(function(){var e=this.locationRoomList[this.locationRoomList.length-1];if(e.id||e.deleted||BX.util.trim(e.field.input.value)){this.locationRoomList.push(this.addRoomField({id:0},i.wrap))}},this)}}));i.wrap.appendChild(this.addNewButtonField.outerWrap)}},{key:"addRoomField",value:function t(i){i.field={outerWrap:this.editDialogWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}}))};i.field.innerWrap=i.field.outerWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-block"}}));i.field.innerWrap.style.paddingRight="40px";i.field.input=i.field.innerWrap.appendChild(l.Dom.create("INPUT",{props:{className:"calendar-field calendar-field-string"},attrs:{value:i.name||"",placeholder:l.Loc.getMessage("EC_MEETING_ROOM_PLACEHOLDER"),type:"text"},events:{keyup:BX.delegate(function(e){if(parseInt(e.keyCode)===13){this.editRoom(i)}},this)}}));i.field.delRoomEntry=i.field.innerWrap.appendChild(l.Dom.create("SPAN",{props:{className:"calendar-remove-filed"},events:{click:BX.delegate(function(){e.deleteField(i)},this)}}));if(this.addNewButtonField){this.editDialogWrap.appendChild(this.addNewButtonField.outerWrap)}if(!i.id){i.field.input.focus()}return i}},{key:"editRoom",value:function e(t){if(!this.locationEditControlShown)return;t.field.input.value=BX.util.trim(t.field.input.value);if(!t.id){if(t.field.input.value&&BX.util.trim(t.field.input.value)!==BX.util.trim(t.name)){t.name=t.field.input.value;this.locationRoomList.push(this.addRoomField({id:0}))}}else{if(BX.util.trim(t.field.input.value)!==t.name){t.name=t.field.input.value;t.changed=true}}}},{key:"saveValues",value:function t(){var i=this;var a,n=[];for(a=0;a<this.locationRoomList.length;a++){if(this.locationRoomList[a].field&&this.locationRoomList[a].field.input){if(this.locationRoomList[a].name!==this.locationRoomList[a].field.input.value&&this.locationRoomList[a].id){this.locationRoomList[a].changed=true}this.locationRoomList[a].name=this.locationRoomList[a].field.input.value}if(!this.locationRoomList[a].deleted&&this.locationRoomList[a].name||this.locationRoomList[a].id){n.push({id:this.locationRoomList[a].id||0,name:this.locationRoomList[a].name||"",changed:this.locationRoomList[a].changed||!this.locationRoomList[a].id?"Y":"N",deleted:this.locationRoomList[a].deleted||!this.locationRoomList[a].name?"Y":"N"})}}BX.ajax.runAction("calendar.api.calendarajax.saveLocationList",{data:{locationList:n}}).then(function(t){e.setLocationList(t.data.locationList);i.setValues()},function(e){});this.locationEditControlShown=false}},{key:"getTextValue",value:function e(t){if(!t){t=this.value}var i=t.str||t.text||"";if(t&&t.type==="mr"){i="ECMR_"+t.value+(t.mrevid?"_"+t.mrevid:"")}else if(t&&t.type==="calendar"){i="calendar_"+t.value+(t.room_event_id?"_"+t.room_event_id:"")}return i}},{key:"getValue",value:function e(){return this.value}},{key:"setValue",value:function t(i){if(l.Type.isPlainObject(i)){this.value.text=i.text||"";this.value.type=i.type||"";this.value.value=i.value||""}else{this.value=e.parseStringValue(i)}this.setValues();if(this.inlineEditModeEnabled){var a=this.getTextLocation(this.value);this.DOM.inlineEditLink.innerHTML=l.Text.encode(a||l.Loc.getMessage("EC_REMIND1_ADD"))}}},{key:"getTextLocation",value:function t(i){var a=l.Type.isPlainObject(i)?i:e.parseStringValue(i),n,s=a.str;if(l.Type.isArray(this.meetingRooms)&&a.type==="mr"){for(n=0;n<this.meetingRooms.length;n++){if(parseInt(a.value)===parseInt(this.meetingRooms[n].ID)){s=this.meetingRooms[n].NAME;break}}}if(l.Type.isArray(e.locationList)&&a.type==="calendar"){for(n=0;n<e.locationList.length;n++){if(parseInt(a.value)===parseInt(e.locationList[n].ID)){s=e.locationList[n].NAME;break}}}return s}},{key:"displayInlineEditControls",value:function e(){this.DOM.inlineEditLinkWrap.style.display="none";this.DOM.inputWrap.style.display=""}}],[{key:"deleteField",value:function e(t){BX.remove(t.field.outerWrap,true);t.deleted=true;t.changed=true}},{key:"parseStringValue",value:function e(t){if(!l.Type.isString(t)){t=""}var i={type:false,value:false,str:t};if(t.substr(0,5)==="ECMR_"){i.type="mr";var a=t.split("_");if(a.length>=2){if(!isNaN(parseInt(a[1]))&&parseInt(a[1])>0){i.value=i.mrid=parseInt(a[1])}if(!isNaN(parseInt(a[2]))&&parseInt(a[2])>0){i.mrevid=parseInt(a[2])}}}else if(t.substr(0,9)==="calendar_"){i.type="calendar";var n=t.split("_");if(n.length>=2){if(!isNaN(parseInt(n[1]))&&parseInt(n[1])>0){i.value=i.room_id=parseInt(n[1])}if(!isNaN(parseInt(n[2]))&&parseInt(n[2])>0){i.room_event_id=parseInt(n[2])}}}return i}},{key:"setLocationList",value:function t(i){if(l.Type.isArray(i)){e.locationList=i}}},{key:"getLocationList",value:function t(){return e.locationList}},{key:"setMeetingRoomList",value:function t(i){if(l.Type.isArray(i)){e.meetingRoomList=i}}},{key:"getMeetingRoomList",value:function t(){return e.meetingRoomList}}]);return e}();babelHelpers.defineProperty(T,"locationList",[]);babelHelpers.defineProperty(T,"meetingRoomList",[]);var E=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.params=t;this.id=t.id||"user_selector_"+Math.round(Math.random()*1e6);this.zIndex=t.zIndex||3100;this.DOM={wrapNode:t.wrapNode};this.destinationInputName=t.inputName||"EVENT_DESTINATION";if(l.Type.isArray(this.params.itemsSelected)&&this.params.itemsSelected.length){this.params.itemsSelected=this.convertAttendeesCodes(this.params.itemsSelected)}this.create()}babelHelpers.createClass(e,[{key:"create",value:function e(){var t=this.id;this.DOM.socnetDestinationWrap=this.DOM.wrapNode.appendChild(l.Dom.create("DIV",{props:{className:"event-grid-dest-wrap"},events:{click:function e(i){BX.SocNetLogDestination.openDialog(t)}}}));this.socnetDestinationItems=this.DOM.socnetDestinationWrap.appendChild(l.Dom.create("SPAN",{props:{className:""},events:{click:function e(i){var a=i.target||i.srcElement;if(a.className==="feed-event-del-but"){top.BX.SocNetLogDestination.deleteItem(a.getAttribute("data-item-id"),a.getAttribute("data-item-type"),t);i.preventDefault();i.stopPropagation()}},mouseover:function e(t){var i=t.target||t.srcElement;if(i.className==="feed-event-del-but")BX.addClass(i.parentNode,"event-grid-dest-hover")},mouseout:function e(t){var i=t.target||t.srcElement;if(i.className==="feed-event-del-but")BX.removeClass(i.parentNode,"event-grid-dest-hover")}}}));this.socnetDestinationInputWrap=this.DOM.socnetDestinationWrap.appendChild(l.Dom.create("SPAN",{props:{className:"feed-add-destination-input-box"}}));this.socnetDestinationInput=this.socnetDestinationInputWrap.appendChild(l.Dom.create("INPUT",{props:{id:t+"-inp",className:"feed-add-destination-inp"},attrs:{value:"",type:"text"},events:{keydown:function e(i){return top.BX.SocNetLogDestination.searchBeforeHandler(i,{formName:t,inputId:t+"-inp"})},keyup:function e(i){return top.BX.SocNetLogDestination.searchHandler(i,{formName:t,inputId:t+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.socnetDestinationLink=this.DOM.socnetDestinationWrap.appendChild(l.Dom.create("SPAN",{html:this.params.addLinkMessage||BX.message("EC_DESTINATION_ADD_USERS"),props:{id:t+"-link",className:"feed-add-destination-link"},events:{keydown:function e(i){return top.BX.SocNetLogDestination.searchBeforeHandler(i,{formName:t,inputId:t+"-inp"})},keyup:function e(i){return top.BX.SocNetLogDestination.searchHandler(i,{formName:t,inputId:t+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.init()}},{key:"init",value:function e(){var t=this;if(!this.socnetDestinationInput||!this.DOM.socnetDestinationWrap||!this.params.items){return}if(this.params.selectGroups===false){this.params.items.groups={};this.params.items.department={};this.params.items.sonetgroups={}}if(this.params.selectUsers===false){this.params.items.users={};this.params.items.groups={};this.params.items.department={}}BX.SocNetLogDestination.init({name:this.id,searchInput:this.socnetDestinationInput,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},callback:{select:this.selectCallback.bind(this),unSelect:this.unSelectCallback.bind(this),openDialog:this.openDialogCallback.bind(this),closeDialog:this.closeDialogCallback.bind(this),openSearch:this.openDialogCallback.bind(this),closeSearch:function e(){t.closeDialogCallback(true)}},items:this.params.items,itemsLast:this.params.itemsLast,itemsSelected:this.params.itemsSelected,departmentSelectDisable:this.params.selectGroups===false})}},{key:"closeAll",value:function e(){if(top.BX.SocNetLogDestination.isOpenDialog()){top.BX.SocNetLogDestination.closeDialog()}top.BX.SocNetLogDestination.closeSearch()}},{key:"selectCallback",value:function e(t,i){var a=i,n="S";if(i==="sonetgroups"){n="SG"}else if(i==="groups"){n="UA";a="all-users"}else if(i==="users"){n="U"}else if(i==="department"){n="DR"}this.socnetDestinationItems.appendChild(l.Dom.create("span",{attrs:{"data-id":t.id},props:{className:"event-grid-dest event-grid-dest-"+a},children:[l.Dom.create("input",{attrs:{type:"hidden",name:this.destinationInputName+"["+n+"][]",value:t.id}}),l.Dom.create("span",{props:{className:"event-grid-dest-text"},html:t.name}),l.Dom.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":t.id,"data-item-type":i}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[t]);this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}},{key:"unSelectCallback",value:function e(t,i,a){var n=BX.findChildren(this.socnetDestinationItems,{attribute:{"data-id":t.id}},true);if(n!=null){for(var s=0;s<n.length;s++){BX.remove(n[s])}}BX.onCustomEvent("OnDestinationUnselect");this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}},{key:"openDialogCallback",value:function e(){BX.style(this.socnetDestinationInputWrap,"display","inline-block");BX.style(this.socnetDestinationLink,"display","none");BX.focus(this.socnetDestinationInput)}},{key:"closeDialogCallback",value:function e(t){if(!top.BX.SocNetLogDestination.isOpenSearch()&&this.socnetDestinationInput.value.length<=0){BX.style(this.socnetDestinationInputWrap,"display","none");BX.style(this.socnetDestinationLink,"display","inline-block");if(t===true)this.socnetDestinationInput.value="";if(top.BX.SocNetLogDestination.backspaceDisable||top.BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable);BX.bind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode===8){e.preventDefault();return false}});setTimeout(function(){BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable);top.BX.SocNetLogDestination.backspaceDisable=null},5e3)}}},{key:"getCodes",value:function e(){var t=this.socnetDestinationItems.getElementsByTagName("INPUT"),i=[],a;for(a=0;a<t.length;a++){i.push(t[a].value)}return i}},{key:"getAttendeesCodes",value:function e(){var t=this.socnetDestinationItems.getElementsByTagName("INPUT"),i=[],a;for(a=0;a<t.length;a++){i.push(t[a].value)}return this.convertAttendeesCodes(i)}},{key:"convertAttendeesCodes",value:function e(t){var i={};if(l.Type.isArray(t)){t.forEach(function(e){if(e.substr(0,2)==="DR"){i[e]="department"}else if(e.substr(0,2)==="UA"){i[e]="groups"}else if(e.substr(0,2)==="SG"){i[e]="sonetgroups"}else if(e.substr(0,1)==="U"){i[e]="users"}})}return i}},{key:"getAttendeesCodesList",value:function e(t){var i=[];if(!t)t=this.getAttendeesCodes();for(var a in t){if(t.hasOwnProperty(a)){i.push(a)}}return i}},{key:"setValue",value:function e(t){if(this.socnetDestinationItems){l.Dom.clean(this.socnetDestinationItems)}if(l.Type.isArray(t)){this.params.itemsSelected=this.convertAttendeesCodes(t)}this.init()}}]);return e}();function I(){var e=babelHelpers.taggedTemplateLiteral(['<div style="background-color: #000;" class="calendar-field-select-icon"></div>']);I=function t(){return e};return e}var O=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"LINE_MODE","line");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"SELECTOR_MODE","selector");i.setEventNamespace("BX.Calendar.Controls.ColorSelector");i.id=e.id||"color-select-"+Math.round(Math.random()*1e6);i.defaultColors=d.Util.getDefaultColorList();i.colors=[];i.zIndex=3100;i.mode=e.mode||i.LINE_MODE;i.DOM={wrap:e.wrap};i.create();i.setViewMode(e.viewMode||false);return i}babelHelpers.createClass(t,[{key:"create",value:function e(){var t=this;if(this.mode===this.LINE_MODE){for(var i=0;i<this.defaultColors.length;i++){this.colors.push({color:this.defaultColors[i],node:this.DOM.wrap.appendChild(l.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},attrs:{"data-bx-calendar-color":this.defaultColors[i]},style:{backgroundColor:this.defaultColors[i]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.DOM.customColorNode=this.DOM.wrap.appendChild(l.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:"transparent",width:0},html:'<span class="calendar-field-colorpicker-color"></span>'}));this.DOM.customColorLink=this.DOM.wrap.appendChild(l.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item-more"},html:'<span class="calendar-field-colorpicker-color-item-more-link">'+l.Loc.getMessage("EC_COLOR")+"</span>",events:{click:function e(){if(!t.colorPickerPopup){t.colorPickerPopup=new BX.ColorPicker({bindElement:t.DOM.customColorLink,onColorSelected:t.setValue.bind(t),popupOptions:{zIndex:t.zIndex}})}t.colorPickerPopup.open()}}}));l.Event.bind(this.DOM.wrap,"click",this.handleColorClick.bind(this))}else if(this.mode===this.SELECTOR_MODE){this.DOM.colorIcon=this.DOM.wrap.appendChild(l.Tag.render(I()));l.Event.bind(this.DOM.wrap,"click",this.openPopup.bind(this))}}},{key:"handleColorClick",value:function e(t){if(this.viewMode){return}var i=d.Util.findTargetNode(t.target||t.srcElement,this.DOM.wrap);if(i&&i.getAttribute){var a=i.getAttribute("data-bx-calendar-color");if(a!==null){this.setValue(a)}}}},{key:"setValue",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.viewMode){return}this.activeColor=t;if(this.mode===this.LINE_MODE){if(this.DOM.activeColorNode){BX.removeClass(this.DOM.activeColorNode,"active")}if(!BX.util.in_array(this.activeColor,this.defaultColors)&&this.activeColor){this.DOM.customColorNode.style.backgroundColor=this.activeColor;this.DOM.customColorNode.style.width="";this.DOM.activeColorNode=this.DOM.customColorNode;BX.addClass(this.DOM.activeColorNode,"active")}var a;for(a=0;a<this.colors.length;a++){if(this.colors[a].color===this.activeColor){this.DOM.activeColorNode=this.colors[a].node;BX.addClass(this.DOM.activeColorNode,"active");break}}}else if(this.mode===this.SELECTOR_MODE){if(this.DOM.colorIcon){this.DOM.colorIcon.style.backgroundColor=this.activeColor}if(this.viewMode){this.DOM.wrap.style.backgroundColor=this.activeColor}}if(i){this.emit("onChange",new o.BaseEvent({data:{value:this.activeColor}}))}}},{key:"getValue",value:function e(){return this.activeColor}},{key:"openPopup",value:function e(){var t=this;if(this.viewMode){return}if(this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown()){return this.popup.close()}var i,a=[],n;this.defaultColors.forEach(function(e){a.push({text:e,color:e,className:"calendar-add-popup-color-menu-item",onclick:function(e){return function(){t.setValue(e);t.popup.close()}}(e)})});this.popup=r.MenuManager.create(this.id,this.DOM.colorIcon,a,{className:"calendar-color-popup-wrap",width:162,closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:52,angle:true,cacheable:false});this.popup.show();for(i=0;i<this.popup.menuItems.length;i++){if(this.popup.menuItems[i].layout.item){n=this.popup.menuItems[i].layout.item.querySelector(".menu-popup-item-icon");if(l.Type.isDomNode(n)){n.style.backgroundColor=this.popup.menuItems[i].color}}}this.popup.popupWindow.angle.element.style.left="6px"}},{key:"setViewMode",value:function e(t){this.viewMode=t;if(this.viewMode){l.Dom.clean(this.DOM.wrap);this.DOM.wrap.className="calendar-field-select-icon";this.DOM.wrap.style.backgroundColor=this.activeColor}}}]);return t}(o.EventEmitter);function L(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-bitrix24"><i></i></div>']);L=function t(){return e};return e}function k(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user"><i></i></div>']);k=function t(){return e};return e}function w(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user-group"><i></i></div>']);w=function t(){return e};return e}function N(){var e=babelHelpers.taggedTemplateLiteral(['<img class="calendar-field-choice-calendar-img-value" src="','">']);N=function t(){return e};return e}function _(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-choice-calendar-name">',"</span>"]);_=function t(){return e};return e}function B(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-choice-calendar-img"></span>']);B=function t(){return e};return e}var H=function(){function e(t){babelHelpers.classCallCheck(this,e);this.id=t.id||"section-select-"+Math.round(Math.random()*1e6);this.sectionList=t.sectionList;this.sectionGroupList=t.sectionGroupList;this.selectCallback=t.selectCallback;this.openPopupCallback=t.openPopupCallback;this.closePopupCallback=t.closePopupCallback;this.getCurrentSection=t.getCurrentSection;this.defaultCalendarType=t.defaultCalendarType;this.defaultOwnerId=parseInt(t.defaultOwnerId)||0;this.zIndex=t.zIndex||3200;this.mode=t.mode;this.DOM={outerWrap:t.outerWrap};this.create();this.initEventHandlers()}babelHelpers.createClass(e,[{key:"create",value:function e(){if(this.mode==="textselect"){this.DOM.select=this.DOM.outerWrap;this.DOM.selectImageWrap=this.DOM.select.appendChild(l.Tag.render(B()));this.DOM.selectInnerText=this.DOM.select.appendChild(l.Tag.render(_(),l.Text.encode(l.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle())))}else{this.DOM.select=this.DOM.outerWrap.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field calendar-field-select"+(this.mode==="compact"?" calendar-field-tiny":"")}}));this.DOM.innerValue=this.DOM.select.appendChild(l.Dom.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:this.getCurrentColor()}}));if(this.mode==="full"){this.DOM.selectInnerText=this.DOM.select.appendChild(l.Dom.create("SPAN",{text:this.getCurrentTitle()}))}}}},{key:"initEventHandlers",value:function e(){l.Event.bind(this.DOM.select,"click",BX.delegate(this.openPopup,this))}},{key:"openPopup",value:function t(){var i=this;if(this.viewMode){return false}if(this.sectionMenu&&this.sectionMenu.popupWindow&&this.sectionMenu.popupWindow.isShown()){return this.sectionMenu.close()}var a="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";var n=[];var s=[];var o=this.getSectionList();var u;if(l.Type.isArray(this.sectionGroupList)){this.sectionGroupList.forEach(function(t){var l;if(t.belongsToView){l=o.filter(function(t){return e.getSectionType(t)===i.defaultCalendarType&&e.getSectionOwner(t)===i.defaultOwnerId},i)}else if(t.type==="user"){l=o.filter(function(i){return e.getSectionType(i)==="user"&&e.getSectionOwner(i)===t.ownerId})}else if(t.type==="company"){l=o.filter(function(i){return e.getSectionType(i)==="company_calendar"||e.getSectionType(i)===t.type})}else{l=o.filter(function(i){return e.getSectionType(i)===t.type})}l=l.filter(function(e){var t=parseInt(e.id||e.ID);if(s.includes(t))return false;s.push(t);return true});if(l.length>0){n.push({html:"<span>"+t.title+"</span>",className:a});for(var r=0;r<l.length;r++){n.push(i.getMenuItem(l[r]))}}})}else{for(u=0;u<o.length;u++){n.push(this.getMenuItem(o[u]))}}var d=0;if(this.mode==="compact"){d=40}else if(this.mode==="textselect"){d=0}this.sectionMenu=r.MenuManager.create(this.id,this.DOM.select,n,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:d,angle:this.mode==="compact"});this.sectionMenu.popupWindow.contentContainer.style.overflow="auto";this.sectionMenu.popupWindow.contentContainer.style.maxHeight="400px";if(this.mode==="full"){this.sectionMenu.popupWindow.setWidth(this.DOM.select.offsetWidth-2);this.sectionMenu.popupWindow.contentContainer.style.overflowX="hidden"}this.sectionMenu.show();for(u=0;u<this.sectionMenu.menuItems.length;u++){if(this.sectionMenu.menuItems[u].layout.item){var c=this.sectionMenu.menuItems[u].layout.item.querySelector(".menu-popup-item-icon");if(c){c.style.backgroundColor=this.sectionMenu.menuItems[u].color}}}BX.addClass(this.DOM.select,"active");if(l.Type.isFunction(this.openPopupCallback)){this.openPopupCallback(this)}BX.addCustomEvent(this.sectionMenu.popupWindow,"onPopupClose",BX.delegate(function(){if(l.Type.isFunction(this.openPopupCallback)){this.closePopupCallback()}BX.removeClass(this.DOM.select,"active");BX.PopupMenu.destroy(this.id);this.sectionMenu=null},this))}},{key:"getCurrentColor",value:function e(){return(this.getCurrentSection()||{}).color||false}},{key:"getCurrentTitle",value:function e(){return(this.getCurrentSection()||{}).name||""}},{key:"getSectionList",value:function e(){return this.sectionList.filter(function(e){return e.PERM&&e.PERM.edit||l.Type.isFunction(e.canDo)&&e.canDo("edit")})}},{key:"updateSectionImageNode",value:function t(i){var a=this;if(!l.Type.isElementNode(this.DOM.selectImageWrap)){return}if(i===undefined){i=this.sectionList.find(function(e){return parseInt(e.id)===parseInt(a.getCurrentSection().id)})}if(i&&i.type){var n=e.getSectionImage(i);var s;if(n){s=l.Tag.render(N(),n)}else if(i.type==="group"){s=l.Tag.render(w())}else if(i.type==="user"){s=l.Tag.render(k())}else{s=l.Tag.render(L())}l.Dom.clean(this.DOM.selectImageWrap);this.DOM.selectImageWrap.appendChild(s)}}},{key:"getPopup",value:function e(){return this.sectionMenu}},{key:"getMenuItem",value:function e(t){var i=this;return{html:BX.util.htmlspecialchars(t.name||t.NAME),color:t.color||t.COLOR,className:"calendar-add-popup-section-menu-item"+(this.mode==="full"?" section-menu-item-full":""),onclick:function(e){return function(){if(l.Type.isDomNode(i.DOM.innerValue)){i.DOM.innerValue.style.backgroundColor=e.color||t.COLOR}i.updateSectionImageNode(e);if(l.Type.isFunction(i.selectCallback)){if(!e.color&&t.COLOR){e.color=t.COLOR}if(!e.id&&t.ID){e.id=t.ID}i.selectCallback(e)}i.sectionMenu.close();i.updateValue()}}(t)}}},{key:"updateValue",value:function e(){if(l.Type.isDomNode(this.DOM.innerValue)){this.DOM.innerValue.style.backgroundColor=this.getCurrentColor()}if(this.mode==="full"){this.DOM.select.appendChild(l.Dom.adjust(this.DOM.selectInnerText,{text:this.getCurrentTitle(),props:{title:this.getCurrentTitle()}}))}else if(this.mode==="textselect"){this.updateSectionImageNode();this.DOM.select.appendChild(l.Dom.adjust(this.DOM.selectInnerText,{props:{title:l.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()},text:l.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()}))}}},{key:"setViewMode",value:function e(t){this.viewMode=t;if(this.viewMode){l.Dom.addClass(this.DOM.outerWrap,"calendar-section-selector-readonly")}else{l.Dom.removeClass(this.DOM.outerWrap,"calendar-section-selector-readonly")}}}],[{key:"getSectionType",value:function e(t){return t.type||t.CAL_TYPE}},{key:"getSectionImage",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return t.data?t.data.IMAGE:t.IMAGE||""}},{key:"getSectionOwner",value:function e(t){return parseInt(t.OWNER_ID||t.data.OWNER_ID)}}]);return e}();var S=function(){function e(t){babelHelpers.classCallCheck(this,e);var i=t.rruleType.form.elements;this.getDate=t.getDate;this.DOM={formElements:i,wrap:t.wrap,rruleType:t.rruleType,interval:i["EVENT_RRULE[INTERVAL]"],rruleEndsOn:{never:i["rrule_endson"][0],count:i["rrule_endson"][1],until:i["rrule_endson"][2]},count:i["EVENT_RRULE[COUNT]"],until:i["EVENT_RRULE[UNTIL]"]};this.create()}babelHelpers.createClass(e,[{key:"create",value:function e(){BX.bind(this.DOM.rruleType,"change",BX.delegate(function(){this.changeType(this.DOM.rruleType.value)},this));BX.bind(this.DOM.until,"click",BX.proxy(function(){BX.calendar({node:this.DOM.until,field:this.DOM.until,bTime:false});BX.focus(this.DOM.until);this.DOM.rruleEndsOn.until.checked=true},this));BX.bind(this.DOM.count,"click",BX.proxy(function(){this.DOM.rruleEndsOn.count.checked=true},this))}},{key:"changeType",value:function e(t){this.DOM.rruleType.value=t?t.toUpperCase():"NONE";var i=this.DOM.rruleType.value.toLowerCase();this.DOM.wrap.className="calendar-rrule-type-"+i;if(i==="weekly"&&BX.type.isFunction(this.getDate)){var a=this.getDate();if(BX.type.isDate(a)){var n=d.Util.getWeekDayByInd(a.getDay());this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach(function(e){e.checked=e.checked||e.value===n},this)}}}},{key:"setValue",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.changeType(t.FREQ);this.DOM.interval.value=t.INTERVAL||1;if(t.COUNT){this.DOM.rruleEndsOn.count.checked="checked";this.DOM.count.value=t.COUNT}else if(t["~UNTIL"]){this.DOM.rruleEndsOn.until.checked="checked";this.DOM.until.value=t["~UNTIL"]}else{this.DOM.rruleEndsOn.never.checked="checked"}if(BX.type.isPlainObject(t.BYDAY)){this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach(function(e){e.checked=t.BYDAY.hasOwnProperty(e.value)},this)}}},{key:"getType",value:function e(){return this.DOM.rruleType.value.toLowerCase()}}]);return e}();var x=function(){function e(t){babelHelpers.classCallCheck(this,e);this.id=t.id||"bx-select-input-"+Math.round(Math.random()*1e6);this.values=t.values||false;this.input=t.input;this.defaultValue=t.defaultValue||"";this.openTitle=t.openTitle||"";this.className=t.className||"";this.onChangeCallback=t.onChangeCallback||null;this.zIndex=t.zIndex||1200;this.disabled=t.disabled;this.minWidth=t.minWidth||0;this.setValue({value:t.value,valueIndex:t.valueIndex});this.curInd=false;this.bindEventHandlers()}babelHelpers.createClass(e,[{key:"bindEventHandlers",value:function e(){if(this.onChangeCallback){BX.bind(this.input,"change",this.onChangeCallback);BX.bind(this.input,"keyup",this.onChangeCallback)}if(this.values){BX.bind(this.input,"click",BX.proxy(this.onClick,this));BX.bind(this.input,"focus",BX.proxy(this.onFocus,this));BX.bind(this.input,"blur",BX.proxy(this.onBlur,this));BX.bind(this.input,"keyup",BX.proxy(this.onKeyup,this))}}},{key:"setValue",value:function e(t){this.currentValue={value:t.value};this.currentValueIndex=t.valueIndex;if(this.currentValueIndex!==undefined&&this.values[this.currentValueIndex]){this.input.value=this.values[this.currentValueIndex].label}}},{key:"getInputValue",value:function e(){return this.input.value}},{key:"showPopup",value:function e(){if(this.shown||this.disabled)return;var t=0,i=0,a=[],n,s=this;for(n=0;n<this.values.length;n++){if(this.values[n].delimiter){a.push(this.values[n])}else{if(this.currentValue&&this.values[n]&&this.values[n].value===this.currentValue.value){t=i}a.push({id:this.values[n].value,text:this.values[n].label,onclick:this.values[n].callback||function(e,t){return function(){s.input.value=t;s.popupMenu.close();s.onChange()}}(this.values[n].value,this.values[n].labelRaw||this.values[n].label)});i++}}this.popupMenu=BX.PopupMenu.create(this.id,this.input,a,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:-1});this.popupMenu.popupWindow.setWidth(Math.max(this.input.offsetWidth+2,this.minWidth));var l=this.popupMenu.layout.menuContainer;BX.addClass(this.popupMenu.layout.menuContainer,"calendar-select-popup");this.popupMenu.show();var o=this.popupMenu.menuItems[t];if(o&&o.layout){l.scrollTop=o.layout.item.offsetTop-o.layout.item.offsetHeight}BX.addCustomEvent(this.popupMenu.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(this.id);this.shown=false;this.popupMenu=null}.bind(this));this.input.select();this.shown=true}},{key:"closePopup",value:function e(){BX.PopupMenu.destroy(this.id);this.popupMenu=null;this.shown=false}},{key:"onFocus",value:function e(){setTimeout(function(){if(!this.shown){this.showPopup()}}.bind(this),200)}},{key:"onClick",value:function e(){if(this.shown){this.closePopup()}else{this.showPopup()}}},{key:"onBlur",value:function e(){setTimeout(BX.delegate(this.closePopup,this),200)}},{key:"onKeyup",value:function e(){setTimeout(BX.delegate(this.closePopup,this),50)}},{key:"onChange",value:function e(){var t=this.input.value;BX.onCustomEvent(this,"onSelectInputChanged",[this,t]);if(BX.type.isFunction(this.onChangeCallback)){this.onChangeCallback({value:t})}}},{key:"destroy",value:function e(){if(this.onChangeCallback){BX.unbind(this.input,"change",this.onChangeCallback);BX.unbind(this.input,"keyup",this.onChangeCallback)}BX.unbind(this.input,"click",BX.proxy(this.onClick,this));BX.unbind(this.input,"focus",BX.proxy(this.onFocus,this));BX.unbind(this.input,"blur",BX.proxy(this.onBlur,this));BX.unbind(this.input,"keyup",BX.proxy(this.onKeyup,this));if(this.popupMenu){this.popupMenu.close()}BX.PopupMenu.destroy(this.id);this.popupMenu=null;this.shown=false}}]);return e}();var P=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.id=t.id||"popup-dialog-"+Math.random();this.zIndex=t.zIndex||3200;this.DOM={};this.title=""}babelHelpers.createClass(e,[{key:"create",value:function e(){this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:this.getTitle(),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:this.getButtons(),content:this.getContent(),events:{}})}},{key:"getTitle",value:function e(){return this.title}},{key:"getContent",value:function e(){this.DOM.content=BX.create("DIV");return this.DOM.content}},{key:"getButtons",value:function e(){this.buttons=[];return this.buttons}},{key:"show",value:function e(t){if(!this.dialog){this.create()}this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}}]);return e}();function V(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text-mode-inner" style="display: none;"></div>']);V=function t(){return e};return e}function R(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-dropdown"></div>']);R=function t(){return e};return e}function X(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text-inner"></div>']);X=function t(){return e};return e}function A(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text"></div>']);A=function t(){return e};return e}function W(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-selector"></div>']);W=function t(){return e};return e}var U=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"views",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"created",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"currentValue",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"currentViewMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ViewSelector");if(l.Type.isArray(i.views)){e.views=i.views}e.zIndex=i.zIndex||3200;e.popupId=i.id||"view-selector-"+Math.round(Math.random()*1e4);e.create();if(i.currentView){e.setValue(i.currentView)}if(i.currentViewMode){e.setViewMode(i.currentViewMode)}return e}babelHelpers.createClass(t,[{key:"create",value:function e(){this.DOM.wrap=l.Tag.render(W());this.DOM.selectorText=l.Tag.render(A());this.DOM.selectorTextInner=this.DOM.selectorText.appendChild(l.Tag.render(X()));this.DOM.wrap.appendChild(this.DOM.selectorText);this.DOM.wrap.appendChild(l.Tag.render(R()));l.Event.bind(this.DOM.wrap,"click",this.showPopup.bind(this));this.DOM.viewModeTextInner=this.DOM.selectorText.appendChild(l.Tag.render(V()));this.created=true}},{key:"getOuterWrap",value:function e(){if(!this.created){this.create()}return this.DOM.wrap}},{key:"setValue",value:function e(t){this.currentValue=this.views.find(function(e){return t.name===e.name},this);if(this.currentValue){l.Dom.adjust(this.DOM.selectorTextInner,{text:this.currentValue.text})}}},{key:"setViewMode",value:function e(t){if(t){this.currentViewMode=this.views.find(function(e){return t===e.name&&e.type==="additional"},this);if(this.currentViewMode){l.Dom.adjust(this.DOM.viewModeTextInner,{text:"("+this.currentViewMode.text+")"})}this.DOM.viewModeTextInner.style.display=this.currentViewMode?"":"block"}}},{key:"getMenuItems",value:function e(){var t=[];this.views.forEach(function(e){if(e.type==="base"){t.push({html:"<span>"+e.text+"</span>"+(e.hotkey?'<span class="calendar-item-hotkey">'+e.hotkey+"</span>":""),className:this.currentValue.name===e.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset});this.menuPopup.close()}.bind(this)})}},this);if(t.length<this.views.length){t.push({html:"<span>"+l.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach(function(e){if(e.type==="additional"){t.push({text:e.text,className:this.currentViewMode.name===e.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset});this.menuPopup.close()}.bind(this)})}},this)}return t}},{key:"showPopup",value:function e(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=r.MenuManager.create(this.popupId,this.DOM.selectorText,this.getMenuItems(),{className:"calendar-view-switcher-popup",closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:-3,offsetLeft:this.DOM.selectorText.offsetWidth-6,angle:true,cacheable:false});this.menuPopup.show()}},{key:"closePopup",value:function e(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}}]);return t}(o.EventEmitter);function z(){var e=babelHelpers.taggedTemplateLiteral(['<span \n\t\t\t\t\t\tclass="calendar-view-switcher-list-item"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</span>"]);z=function t(){return e};return e}function F(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-list"></div>']);F=function t(){return e};return e}var G=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"views",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"created",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"currentValue",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"currentViewMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.LineViewSelector");if(l.Type.isArray(i.views)){e.views=i.views}e.viewsMap=new WeakMap;e.zIndex=i.zIndex||3200;e.popupId=i.id||"view-selector-"+Math.round(Math.random()*1e4);e.create();if(i.currentView){e.setValue(i.currentView)}return e}babelHelpers.createClass(t,[{key:"create",value:function e(){var t=this;this.DOM.wrap=l.Tag.render(F());this.views.forEach(function(e){if(e.type==="base"){t.viewsMap.set(e,{wrap:t.DOM.wrap.appendChild(l.Tag.render(z(),function(){t.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset})},e.text))})}});this.created=true}},{key:"getOuterWrap",value:function e(){if(!this.created){this.create()}return this.DOM.wrap}},{key:"setValue",value:function e(t){this.currentValue=this.views.find(function(e){return t.name===e.name},this);if(this.currentValue){var i=this.viewsMap.get(this.currentValue);var a=this.DOM.wrap.querySelector(".calendar-view-switcher-list-item-active");if(l.Type.isDomNode(a)){l.Dom.removeClass(a,"calendar-view-switcher-list-item-active")}if(l.Type.isDomNode(i.wrap)){l.Dom.addClass(i.wrap,"calendar-view-switcher-list-item-active")}}}},{key:"setViewMode",value:function e(t){if(t){this.currentViewMode=this.views.find(function(e){return t===e.name&&e.type==="additional"},this)}}},{key:"getMenuItems",value:function e(){var t=this;var i=[];this.views.forEach(function(e){if(e.type==="base"){i.push({html:"<span>"+e.text+"</span>"+(e.hotkey?'<span class="calendar-item-hotkey">'+e.hotkey+"</span>":""),className:t.currentValue.name===e.name?"menu-popup-item-accept":" ",onclick:function i(){t.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset});t.menuPopup.close()}})}});if(i.length<this.views.length){i.push({html:"<span>"+l.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach(function(e){if(e.type==="additional"){i.push({text:e.text,className:this.currentViewMode.name===e.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:e.name,type:e.type,dataset:e.dataset});this.menuPopup.close()}.bind(this)})}},this)}return i}}]);return t}(o.EventEmitter);var Y=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"showTasks",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.AddButton");e.zIndex=i.zIndex||3200;e.popupId=i.id||"add-button-"+Math.round(Math.random()*1e4);e.showTasks=i.showTasks;e.addEntryHandler=l.Type.isFunction(i.addEntry)?i.addEntry:null;e.addTaskHandler=l.Type.isFunction(i.addTask)?i.addTask:null;e.create();return e}babelHelpers.createClass(t,[{key:"create",value:function e(){this.menuItems=[{text:l.Loc.getMessage("EC_ADD_EVENT"),onclick:this.addEntry.bind(this)}];if(this.addTaskHandler){this.menuItems.push({text:l.Loc.getMessage("EC_ADD_TASK"),onclick:this.addTask.bind(this)})}if(this.menuItems.length>1){this.DOM.wrap=l.Dom.create("span",{props:{className:"ui-btn-split ui-btn-success"},children:[l.Dom.create("button",{props:{className:"ui-btn-main",type:"button"},html:l.Loc.getMessage("EC_ADD"),events:{click:this.addEntry.bind(this)}})]});this.DOM.addButtonExtra=l.Dom.create("span",{props:{className:"ui-btn-extra"},events:{click:this.showPopup.bind(this)}});this.DOM.wrap.appendChild(this.DOM.addButtonExtra)}else{this.DOM.wrap=l.Dom.create("button",{props:{className:"ui-btn ui-btn-success",type:"button"},html:l.Loc.getMessage("EC_ADD"),events:{click:this.addEntry.bind(this)}})}}},{key:"getWrap",value:function e(){return this.DOM.wrap}},{key:"showPopup",value:function e(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=BX.PopupMenu.create(this.popupId,this.DOM.addButtonExtra,this.menuItems,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(this.popupId);this.menuPopup=null;this.addBtnMenu=null}.bind(this))}},{key:"addEntry",value:function e(){if(this.addEntryHandler){this.addEntryHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}},{key:"addTask",value:function e(){if(this.addTaskHandler){this.addTaskHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}}]);return t}(o.EventEmitter);var j=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"showTasks",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.MeetingStatusControl");e.BX=d.Util.getBX();if(i.wrap&&l.Type.isDomNode(i.wrap)){e.DOM.wrap=i.wrap}else{throw new Error('The argument "params.wrap" must be a DOM node.')}e.id=i.id||"meeting-status-control-"+Math.round(Math.random()*1e4);e.zIndex=3100;e.create();e.status=i.currentStatus||null;if(e.status){e.updateStatus()}return e}babelHelpers.createClass(t,[{key:"create",value:function e(){this.acceptBtn=new BX.UI.Button({text:l.Loc.getMessage("EC_VIEW_DESIDE_BUT_Y"),className:"ui-btn ui-btn-primary",events:{click:this.accept.bind(this)}});this.acceptBtn.renderTo(this.DOM.wrap);this.declineBtn=new BX.UI.Button({text:l.Loc.getMessage("EC_VIEW_DESIDE_BUT_N"),className:"ui-btn ui-btn-light-border",events:{click:this.decline.bind(this)}});this.declineBtn.renderTo(this.DOM.wrap)}},{key:"updateStatus",value:function e(){if(this.status==="H"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display="";this.declineBtn.setText(l.Loc.getMessage("EC_VIEW_DESIDE_BUT_OWNER_N"))}else{if(this.status==="Y"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display=""}else if(this.status==="N"){this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display="none"}else{this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display=""}}}},{key:"accept",value:function e(){this.setStatus("Y")}},{key:"decline",value:function e(){this.setStatus("N")}},{key:"setStatus",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.status=t;if(this.menuPopup){this.menuPopup.close()}if(i){this.emit("onSetStatus",new l.Event.BaseEvent({data:{status:t}}))}}}]);return t}(l.Event.EventEmitter);var q=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");e.zIndex=3200;e.id="confirm-status-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;var i=l.Dom.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_DECLINE_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:l.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})],content:i,events:{}});i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_DECLINE_ONLY_THIS"),events:{click:function e(){t.onDeclineHandler();t.emit("onDecline",new o.BaseEvent({data:{recursionMode:"this"}}))}}}).buttonNode);i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_DECLINE_NEXT"),events:{click:function e(){t.onDeclineHandler();t.emit("onDecline",new o.BaseEvent({data:{recursionMode:"next"}}))}}}).buttonNode);i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_DECLINE_ALL"),events:{click:function e(){t.onDeclineHandler();t.emit("onDecline",new o.BaseEvent({data:{recursionMode:"all"}}))}}}).buttonNode);this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}},{key:"onDeclineHandler",value:function e(){this.close();var t=i.EntryManager.getCompactViewForm();if(t&&t.isShown()){t.close()}}}]);return t}(o.EventEmitter);var Z=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ConfirmEditDialog");e.zIndex=3200;e.id="confirm-status-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;var i=l.Dom.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_EDIT_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:l.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})],content:i,events:{},cacheable:false});i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:function e(){t.emit("onEdit",new o.BaseEvent({data:{recursionMode:"this"}}));t.close()}}}).buttonNode);i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_REC_EV_NEXT"),events:{click:function e(){t.emit("onEdit",new o.BaseEvent({data:{recursionMode:"next"}}));t.close()}}}).buttonNode);i.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_REC_EV_ALL"),events:{click:function e(){t.emit("onEdit",new o.BaseEvent({data:{recursionMode:"all"}}));t.close()}}}).buttonNode);this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}}]);return t}(o.EventEmitter);var K=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,i));e.title=BX.message("EC_DEL_REC_EVENT");e.entry=i.entry;return e}babelHelpers.createClass(t,[{key:"getContent",value:function e(){this.DOM.content=BX.create("DIV");this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:function(){this.entry.deleteThis();this.close()}.bind(this)}}).buttonNode);this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_NEXT"),events:{click:function(){this.entry.deleteNext();this.close()}.bind(this)}}).buttonNode);this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ALL"),events:{click:function(){this.entry.deleteAll();this.close()}.bind(this)}}).buttonNode);return this.DOM.content}},{key:"getButtons",value:function e(){return[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})]}}]);return t}(P);function $(){var e=babelHelpers.taggedTemplateLiteral(['<label for="{this.UID}">',"</label>"]);$=function t(){return e};return e}function Q(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input value="Y" type="checkbox" id="{this.UID}"/>\n\t\t\t']);Q=function t(){return e};return e}function J(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="calendar-event-full-day"></span>\n\t\t\t']);J=function t(){return e};return e}function ee(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-date"></span>']);ee=function t(){return e};return e}function te(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ','px;"/>']);te=function t(){return e};return e}function ie(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-time"></span>']);ie=function t(){return e};return e}function ae(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);ae=function t(){return e};return e}function ne(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-right"></div>']);ne=function t(){return e};return e}function se(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-between" />']);se=function t(){return e};return e}function le(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-time"></span>']);le=function t(){return e};return e}function oe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);oe=function t(){return e};return e}function re(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-date"></span>']);re=function t(){return e};return e}function ue(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);ue=function t(){return e};return e}function de(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-left"></div>']);de=function t(){return e};return e}var ce=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{showTimezone:true};babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"DATE_INPUT_WIDTH",110);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"TIME_INPUT_WIDTH",70);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"MODIFIED_TIME_INPUT_WIDTH",80);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"zIndex",4200);i.setEventNamespace("BX.Calendar.Controls.DateTimeControl");i.showTimezone=a.showTimezone;i.inlineEditMode=!!a.inlineEditMode;i.currentInlineEditMode=a.currentInlineEditMode||"view";i.UID=e||"date-time-"+Math.round(Math.random()*1e5);i.DOM={outerWrap:a.outerWrap||null,outerContent:a.outerContent||null};i.create();return i}babelHelpers.createClass(t,[{key:"create",value:function e(){if(l.Type.isDomNode(this.DOM.outerWrap)){if(this.inlineEditMode){l.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}this.DOM.leftInnerWrap=this.DOM.outerWrap.appendChild(l.Tag.render(de()));this.DOM.fromDate=this.DOM.leftInnerWrap.appendChild(l.Tag.render(ue(),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromDateText=this.DOM.leftInnerWrap.appendChild(l.Tag.render(re()))}this.DOM.fromTime=this.DOM.leftInnerWrap.appendChild(l.Tag.render(oe(),this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromTimeText=this.DOM.leftInnerWrap.appendChild(l.Tag.render(le()))}this.DOM.betweenSpacer=this.DOM.outerWrap.appendChild(l.Tag.render(se()));this.DOM.rightInnerWrap=this.DOM.outerWrap.appendChild(l.Tag.render(ne()));this.DOM.toTime=this.DOM.rightInnerWrap.appendChild(l.Tag.render(ae(),this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toTimeText=this.DOM.rightInnerWrap.appendChild(l.Tag.render(ie()))}this.DOM.toDate=this.DOM.rightInnerWrap.appendChild(l.Tag.render(te(),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toDateText=this.DOM.rightInnerWrap.appendChild(l.Tag.render(ee()))}this.fromTimeControl=new c({input:this.DOM.fromTime,onChangeCallback:this.handleTimeFromChange.bind(this)});this.toTimeControl=new c({input:this.DOM.toTime,onChangeCallback:this.handleTimeToChange.bind(this)});var t=this.DOM.outerWrap.appendChild(l.Tag.render(J()));this.DOM.fullDay=t.appendChild(l.Tag.render(Q()));t.appendChild(l.Tag.render($(),l.Loc.getMessage("EC_ALL_DAY")))}if(this.showTimezone);this.bindEventHandlers()}},{key:"setValue",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.DOM.fromDate.value=d.Util.formatDate(t.from);this.DOM.toDate.value=d.Util.formatDate(t.to);this.lastDateValue=t.from;this.fromTimeControl.setValue(t.from);this.toTimeControl.setValue(t.to);this.DOM.fromTime.value=d.Util.formatTime(t.from);this.DOM.toTime.value=d.Util.formatTime(t.to);if(this.inlineEditMode){this.DOM.fromDateText.innerHTML=d.Util.formatDateUsable(t.from,true,true);this.DOM.toDateText.innerHTML=d.Util.formatDateUsable(t.to,true,true);this.DOM.toDateText.style.display=this.DOM.fromDate.value===this.DOM.toDate.value?"none":"";if(t.fullDay){if(this.DOM.fromDate.value===this.DOM.toDate.value){this.DOM.toTimeText.innerHTML=l.Loc.getMessage("EC_ALL_DAY");this.DOM.toTimeText.style.display="";this.DOM.fromTimeText.style.display="none";this.DOM.fromTimeText.innerHTML=""}else{this.DOM.betweenSpacer.style.display="";this.DOM.fromTimeText.style.display="none";this.DOM.toTimeText.style.display="none"}}else{this.DOM.fromTimeText.innerHTML=this.DOM.fromTime.value;this.DOM.toTimeText.innerHTML=this.DOM.toTime.value;this.DOM.betweenSpacer.style.display="";this.DOM.fromTimeText.style.display="";this.DOM.toTimeText.style.display=""}}if(t.fullDay!==undefined){this.DOM.fullDay.checked=t.fullDay}if(this.showTimezone){t.timezoneFrom=t.timezoneFrom||t.timezoneName;t.timezoneTo=t.timezoneTo||t.timezoneName;if(t.timezoneFrom!==undefined&&l.Type.isDomNode(this.DOM.fromTz)){this.DOM.fromTz.value=t.timezoneFrom}if(t.timezoneTo!==undefined&&l.Type.isDomNode(this.DOM.toTz)){this.DOM.toTz.value=t.timezoneTo}if(t.timezoneName!==undefined&&(t.timezoneName!==t.timezoneFrom||t.timezoneName!==t.timezoneTo)){this.switchTimezone(true)}}this.value=t;this.handleFullDayChange()}},{key:"getValue",value:function e(){var t={fullDay:this.DOM.fullDay.checked,fromDate:this.DOM.fromDate.value,toDate:this.DOM.toDate.value,fromTime:this.DOM.fromTime.value,toTime:this.DOM.toTime.value,timezoneFrom:this.DOM.fromTz?this.DOM.fromTz.value:this.value.timezoneFrom||this.value.timezoneName||null,timezoneTo:this.DOM.toTz?this.DOM.toTz.value:this.value.timezoneTo||this.value.timezoneName||null};t.from=d.Util.parseDate(t.fromDate);if(l.Type.isDate(t.from)){t.to=d.Util.parseDate(t.toDate);if(!l.Type.isDate(t.to)){t.to=t.from}if(t.fullDay){t.from.setHours(0,0,0);t.to.setHours(0,0,0)}else{var i=d.Util.parseTime(t.fromTime),a=d.Util.parseTime(t.toTime)||i;if(i&&a){t.from.setHours(i.h,i.m,0);t.to.setHours(a.h,a.m,0)}}}return t}},{key:"bindEventHandlers",value:function e(){var i=this;l.Event.bind(this.DOM.fromDate,"click",t.showInputCalendar);l.Event.bind(this.DOM.fromDate,"change",this.handleDateFromChange.bind(this));l.Event.bind(this.DOM.toDate,"click",t.showInputCalendar);l.Event.bind(this.DOM.toDate,"change",this.handleDateToChange.bind(this));l.Event.bind(this.DOM.fullDay,"click",function(){i.handleFullDayChange();i.handleValueChange()});if(this.inlineEditMode){l.Event.bind(this.DOM.outerWrap,"click",this.changeInlineEditMode.bind(this))}if(l.Type.isDomNode(this.DOM.defTimezone)){l.Event.bind(this.DOM.defTimezone,"change",BX.delegate(function(){if(this.bindFromToDefaultTimezones){this.DOM.fromTz.value=this.DOM.toTz.value=this.DOM.defTimezone.value}},this))}if(this.showTimezone){if(l.Type.isDomNode(this.DOM.tzButton)){l.Event.bind(this.DOM.tzButton,"click",this.switchTimezone.bind(this))}l.Event.bind(this.DOM.fromTz,"change",function(){if(this.bindTimezones){this.DOM.toTz.value=this.DOM.fromTz.value}this.bindFromToDefaultTimezones=false}.bind(this));l.Event.bind(this.DOM.toTz,"change",function(){this.bindTimezones=false;this.bindFromToDefaultTimezones=false}.bind(this));this.bindTimezones=this.DOM.fromTz.value===this.DOM.toTz.value;this.bindFromToDefaultTimezones=this.bindTimezones&&this.DOM.fromTz.value===this.DOM.toTz.value&&this.DOM.fromTz.value===this.DOM.defTimezone.value}}},{key:"handleDateFromChange",value:function e(){var t=d.Util.parseTime(this.DOM.fromTime.value),i=d.Util.parseTime(this.DOM.toTime.value),a=d.Util.parseDate(this.DOM.fromDate.value),n=d.Util.parseDate(this.DOM.toDate.value);if(this.lastDateValue){if(this.DOM.fullDay.checked&&this.lastDateValue){this.lastDateValue.setHours(0,0,0)}else{if(a&&t){a.setHours(t.h,t.m,0)}if(n&&i){n.setHours(i.h,i.m,0)}}if(a&&this.lastDateValue){n=new Date(a.getTime()+(n.getTime()-this.lastDateValue.getTime()||36e5));if(n){this.DOM.toDate.value=d.Util.formatDate(n)}}}this.lastDateValue=a;this.handleValueChange()}},{key:"handleTimeFromChange",value:function e(){var t=d.Util.parseTime(this.DOM.fromTime.value),i=d.Util.parseTime(this.DOM.toTime.value),a=d.Util.parseDate(this.DOM.fromDate.value),n=d.Util.parseDate(this.DOM.toDate.value);if(a&&t){a.setHours(t.h,t.m,0)}if(n&&i){n.setHours(i.h,i.m,0)}if(this.lastDateValue){var s=new Date(d.Util.getTimeRounded(a)+d.Util.getTimeRounded(n)-d.Util.getTimeRounded(this.lastDateValue));this.DOM.toTime.value=d.Util.formatTime(s);this.DOM.toDate.value=d.Util.formatDate(s)}this.lastDateValue=a;this.handleValueChange()}},{key:"handleDateToChange",value:function e(){this.handleValueChange()}},{key:"handleTimeToChange",value:function e(){this.handleValueChange()}},{key:"handleFullDayChange",value:function e(){var t=this.getFullDayValue();if(t){if(l.Type.isDomNode(this.DOM.dateTimeWrap)){l.Dom.addClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(l.Type.isDomNode(this.DOM.outerWrap)){l.Dom.addClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}else{if(l.Type.isDomNode(this.DOM.dateTimeWrap)){l.Dom.removeClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(l.Type.isDomNode(this.DOM.outerWrap)){l.Dom.removeClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}}},{key:"handleValueChange",value:function e(){this.emit("onChange",new o.BaseEvent({data:{value:this.getValue()}}))}},{key:"getFullDayValue",value:function e(){return!!this.DOM.fullDay.checked}},{key:"switchTimezone",value:function e(t){if(!l.Type.isBoolean(t)){t=BX.hasClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}if(t){l.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-expand");l.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}else{l.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-collapse");l.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-expand")}}},{key:"changeInlineEditMode",value:function e(){if(!this.viewMode){this.setInlineEditMode("edit")}}},{key:"setViewMode",value:function e(t){this.viewMode=t;if(this.viewMode&&this.currentInlineEditMode==="edit"){this.setInlineEditMode("view")}}},{key:"setInlineEditMode",value:function e(t){if(this.inlineEditMode){this.currentInlineEditMode=t;if(this.currentInlineEditMode==="edit"){l.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");l.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}else{l.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");l.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}}}}],[{key:"showInputCalendar",value:function e(i){var a=i.target||i.srcElement;if(l.Type.isDomNode(a)&&a.nodeName.toLowerCase()==="input"){var n=BX.calendar.get();if(n.popup){n.popup.destroy();n.popup=null;n._current_layer=null;n._layers={}}n.Show({node:a.parentNode,field:a,bTime:false});BX.onCustomEvent(window,"onCalendarControlChildPopupShown");var s=n.popup;if(s){BX.removeCustomEvent(s,"onPopupClose",t.inputCalendarClosePopupHandler);BX.addCustomEvent(s,"onPopupClose",t.inputCalendarClosePopupHandler)}}}},{key:"inputCalendarClosePopupHandler",value:function e(t){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}}]);return t}(o.EventEmitter);var pe=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");e.zIndex=3200;e.id="confirm-status-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.plural=i.users.length>1;var a,n=[];for(a=0;a<i.users.length;a++){n.push(i.users[a].DISPLAY_NAME)}n=n.join(", ");var s=BX.create("DIV",{props:{className:"calendar-busy-users-content-wrap"},html:'<div class="calendar-busy-users-content">'+BX.util.htmlspecialchars(this.plural?l.Loc.getMessage("EC_BUSY_USERS_PLURAL").replace("#USER_LIST#",n):l.Loc.getMessage("EC_BUSY_USERS_SINGLE").replace("#USER_NAME#",i.users[0].DISPLAY_NAME))+"</div>"});this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_BUSY_USERS_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",content:s,events:{}});s.appendChild(new BX.PopupWindowButton({text:l.Loc.getMessage("EC_BUSY_USERS_BACK2EDIT"),events:{click:function e(){t.close()}}}).buttonNode);s.appendChild(new BX.PopupWindowButton({text:this.plural?l.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_PLURAL"):l.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_SINGLE"),events:{click:function e(){t.emit("onSaveWithout");t.close()}}}).buttonNode);this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}}]);return t}(o.EventEmitter);function he(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<img \n\t\t\t\ttitle="','" \n\t\t\t\tclass="calendar-member" \n\t\t\t\tid="simple_popup_','"\n\t\t\t\tsrc="','"\n\t\t\t>']);he=function t(){return e};return e}function fe(){var e=babelHelpers.taggedTemplateLiteral(['<div title="','" class="ui-icon ','"><i></i></div>']);fe=function t(){return e};return e}var me=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"zIndex",4200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"readOnlyMode",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"meetingNotifyValue",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"userSelectorDialog",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"attendeesEntityList",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"inlineEditMode",t.VIEW_MODE);e.setEventNamespace("BX.Calendar.Controls.UserPlannerSelector");e.selectorId=i.id||"user-selector-"+Math.round(Math.random()*1e4);e.BX=d.Util.getBX();e.DOM={outerWrap:i.outerWrap,wrap:i.wrap,informWrap:i.informWrap,informWrapText:i.informWrap.querySelector(".calendar-field-container-inform-text"),moreLink:i.outerWrap.querySelector(".calendar-members-more"),changeLink:i.outerWrap.querySelector(".calendar-members-change-link"),attendeesLabel:i.outerWrap.querySelector(".calendar-attendees-label"),attendeesList:i.outerWrap.querySelector(".calendar-attendees-list"),userSelectorWrap:i.outerWrap.querySelector(".calendar-user-selector-wrap"),plannerOuterWrap:i.plannerOuterWrap,videocallWrap:i.outerWrap.querySelector(".calendar-videocall-wrap"),hideGuestsWrap:i.hideGuestsWrap,hideGuestsIcon:i.hideGuestsWrap.querySelector(".calendar-hide-members-icon-hidden")};e.refreshPlanner=l.Runtime.debounce(e.refreshPlannerState,100,babelHelpers.assertThisInitialized(e));if(l.Type.isBoolean(i.readOnlyMode)){e.readOnlyMode=i.readOnlyMode}e.userId=i.userId;e.type=i.type;e.ownerId=i.ownerId;e.zIndex=i.zIndex||e.zIndex;e.create();return e}babelHelpers.createClass(t,[{key:"create",value:function e(){var i=this;if(this.DOM.changeLink&&!this.isReadOnly()){l.Event.bind(this.DOM.changeLink,"click",function(){if(!i.userSelectorDialog){i.userSelectorDialog=new n.Dialog({targetNode:i.DOM.changeLink,context:"CALENDAR",preselectedItems:i.attendeesPreselectedItems,enableSearch:true,zIndex:i.zIndex+10,events:{"Item:onSelect":i.handleUserSelectorChanges.bind(i),"Item:onDeselect":i.handleUserSelectorChanges.bind(i)},entities:[{id:"user",options:{inviteGuestLink:true,emailUsers:true}},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],searchTabOptions:{stubOptions:{title:l.Loc.getMessage("EC_USER_DIALOG_404_TITLE"),subtitle:l.Loc.getMessage("EC_USER_DIALOG_404_SUBTITLE"),icon:"/bitrix/images/calendar/search-email.svg",iconOpacity:100,arrow:true}}})}i.userSelectorDialog.show()})}if(this.DOM.moreLink){l.Event.bind(this.DOM.moreLink,"click",this.showMoreAttendeesPopup.bind(this))}this.planner=new a.Planner({wrap:this.DOM.plannerOuterWrap,minWidth:t.PLANNER_WIDTH,width:t.PLANNER_WIDTH,showEntryName:false});l.Event.bind(this.DOM.informWrap,"click",function(){i.setInformValue(!i.meetingNotifyValue);i.emit("onNotifyChange")});this.DOM.attendeesLabel.innerHTML=l.Text.encode(l.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"));this.planner.subscribe("onDateChange",function(e){i.emit("onDateChange",e)});if(this.DOM.hideGuestsWrap&&!this.isReadOnly()){l.Event.bind(this.DOM.hideGuestsWrap,"click",function(){i.setHideGuestsValue(!i.hideGuests)})}}},{key:"setValue",value:function e(t){var i,a;var n=t.attendeesEntityList,o=t.attendees,r=t.location,u=t.notify,c=t.hideGuests,p=t.viewMode,h=t.entry;this.attendeesEntityList=l.Type.isArray(n)?n:[];this.attendeesPreselectedItems=this.attendeesEntityList.map(function(e){return[e.entityId,e.id]});this.entry=h;this.entryId=this.entry.id;if(this.attendeesEntityList.length>1&&!p){this.showPlanner()}this.setEntityList(this.attendeesEntityList);this.setInformValue(u);this.setLocationValue(r);if(l.Type.isArray(o)){this.displayAttendees(o)}this.refreshPlanner();if(((i=BX)===null||i===void 0?void 0:(a=i.Intranet)===null||a===void 0?void 0:a.ControlButton)&&this.DOM.videocallWrap&&this.entryId&&this.entry.getCurrentStatus()!==false){l.Dom.clean(this.DOM.videocallWrap);l.Dom.removeClass(this.DOM.videocallWrap,"calendar-videocall-hidden");this.intranetControllButton=new s.ControlButton({container:this.DOM.videocallWrap,entityType:"calendar_event",entityId:this.entryId,mainItem:"chat",entityData:{dateFrom:d.Util.formatDate(this.entry.from),parentId:this.entry.parentId},analyticsLabel:{formType:"compact"}})}else if(this.DOM.videocallWrap){l.Dom.addClass(this.DOM.videocallWrap,"calendar-videocall-hidden")}this.setHideGuestsValue(c)}},{key:"handleUserSelectorChanges",value:function e(){this.showPlanner();this.setEntityList(this.userSelectorDialog.getSelectedItems().map(function(e){return{entityId:e.entityId,id:e.id,entityType:e.entityType}}));this.refreshPlanner();this.emit("onUserCodesChange")}},{key:"getEntityList",value:function e(){return this.selectorEntityList}},{key:"setEntityList",value:function e(t){if(this.type==="user"&&this.userId!==this.ownerId){t.push({entityId:"user",id:this.ownerId})}else{t.push({entityId:"user",id:this.userId})}this.selectorEntityList=t}},{key:"isReadOnly",value:function e(){return this.readOnlyMode}},{key:"getUserSelector",value:function e(){return BX.UI.SelectorManager.instances[this.selectorId]}},{key:"showPlanner",value:function e(){if(!this.isPlannerDisplayed()){l.Dom.addClass(this.DOM.outerWrap,"user-selector-edit-mode");this.planner.show();this.planner.showLoader()}}},{key:"checkBusyTime",value:function e(){var t=this;var i=this.getDateTime();this.runPlannerDataRequest({entityList:this.getEntityList(),from:d.Util.formatDate(i.from.getTime()-d.Util.getDayLength()*3),to:d.Util.formatDate(i.to.getTime()+d.Util.getDayLength()*10),timezone:i.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId}).then(function(e){if(l.Type.isArray(e.data.accessibility[t.ownerId])){var a=t.getDateTime().from;var n=t.getDateTime().to;var s=t.preparedDataAccessibility(e.data.accessibility[t.ownerId]);var o=t.planner.checkTimePeriod(a,n,s);if(l.Type.isObject(o)&&l.Type.isArray(e.data.entries)){t.showPlanner();t.planner.update(e.data.entries,e.data.accessibility);t.planner.updateSelector(i.from,i.to,i.fullDay);t.planner.hideLoader();t.displayAttendees(t.prepareAttendeesForDisplay(e.data.entries))}}})}},{key:"prepareAttendeesForDisplay",value:function e(t){return t.filter(function(e){return e.type==="user"}).map(function(e){return{ID:e.id,AVATAR:e.avatar,DISPLAY_NAME:e.name,EMAIL_USER:e.emailUser,STATUS:(e.status||"").toUpperCase(),URL:e.url}})}},{key:"refreshPlannerState",value:function e(){var t=this;if(this.planner&&this.planner.isShown()){var i=this.getDateTime();this.loadPlannerData({entityList:this.getEntityList(),from:d.Util.formatDate(i.from.getTime()-d.Util.getDayLength()*3),to:d.Util.formatDate(i.to.getTime()+d.Util.getDayLength()*10),timezone:i.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId}).then(function(e){t.displayAttendees(t.prepareAttendeesForDisplay(e.data.entries||[]))})}}},{key:"loadPlannerData",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.planner.showLoader();return new Promise(function(e){t.runPlannerDataRequest(i).then(function(i){t.planner.hideLoader();var a=t.getDateTime();t.planner.update(i.data.entries,i.data.accessibility);t.planner.updateSelector(a.from,a.to,a.fullDay);e(i)},function(t){e(t)})})}},{key:"runPlannerDataRequest",value:function e(t){return this.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:{entryId:t.entryId||0,ownerId:this.ownerId,type:this.type,entityList:t.entityList||[],dateFrom:t.from||"",dateTo:t.to||"",timezone:t.timezone||"",location:t.location||"",entries:t.entrieIds||false}})}},{key:"setDateTime",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.dateTime=t;if(this.planner&&i){this.planner.updateSelector(t.from,t.to,t.fullDay)}}},{key:"getDateTime",value:function e(){return this.dateTime}},{key:"setLocationValue",value:function e(t){this.location=t}},{key:"getLocationValue",value:function e(){return this.location}},{key:"displayAttendees",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];l.Dom.clean(this.DOM.attendeesList);this.attendeeList={accepted:i.filter(function(e){return["H","Y"].includes(e.STATUS)}),requested:i.filter(function(e){return e.STATUS==="Q"||e.STATUS===""}),declined:i.filter(function(e){return e.STATUS==="N"})};var a=this.attendeeList.accepted.length;if(a>0){if(a>t.MAX_USER_COUNT_DISPLAY){a=t.MAX_USER_COUNT}for(var n=0;n<a;n++){this.attendeeList.accepted[n].shown=true;this.DOM.attendeesList.appendChild(t.getUserAvatarNode(this.attendeeList.accepted[n]))}}if(a>1){this.DOM.attendeesLabel.innerHTML=l.Text.encode(l.Loc.getMessage("EC_ATTENDEES_LABEL_NUM")).replace("#COUNT#","<span>(</span>".concat(this.attendeeList.accepted.length,"<span>)</span>"))}else{this.DOM.attendeesLabel.innerHTML=l.Text.encode(l.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"))}if(a<i.length){if(a===1){this.DOM.moreLink.innerHTML=l.Text.encode(l.Loc.getMessage("EC_ATTENDEES_ALL_COUNT").replace("#COUNT#",i.length))}else{this.DOM.moreLink.innerHTML=l.Text.encode(l.Loc.getMessage("EC_ATTENDEES_ALL"))}l.Dom.show(this.DOM.moreLink)}else{l.Dom.hide(this.DOM.moreLink)}if(this.hasExternalEmailUsers(i)&&this.isPlannerDisplayed()&&!this.isReadOnly()){this.showHideGuestsOption()}else{this.hideHideGuestsOption()}}},{key:"showMoreAttendeesPopup",value:function e(){var i=this;if(this.morePopup){this.morePopup.destroy()}var a="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";var n=[];[{code:"accepted",title:l.Loc.getMessage("EC_ATTENDEES_Y_NUM")},{code:"requested",title:l.Loc.getMessage("EC_ATTENDEES_Q_NUM")},{code:"declined",title:l.Loc.getMessage("EC_ATTENDEES_N_NUM")}].forEach(function(e){var t=i.attendeeList[e.code];if(t.length>0){n.push({html:"<span>"+e.title.replace("#COUNT#",t.length)+"</span>",className:a});t.forEach(function(e){e.toString=function(){return e.ID};n.push({text:BX.util.htmlspecialchars(e.DISPLAY_NAME),dataset:{user:e},className:"calendar-add-popup-user-menu-item",onclick:function t(){if(!e.EMAIL_USER){BX.SidePanel.Instance.open(e.URL,{loader:"intranet:profile",cacheable:false,allowChangeHistory:false,contentClassName:"bitrix24-profile-slider-content",width:1100});i.morePopup.close()}}})})}});this.morePopup=r.MenuManager.create("compact-event-form-attendees"+Math.round(Math.random()*1e5),this.DOM.moreLink,n,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true,cacheable:false,className:"calendar-popup-user-menu"});this.morePopup.show();this.morePopup.menuItems.forEach(function(e){var i=e.layout.item.querySelector(".menu-popup-item-icon");if(l.Type.isPlainObject(e.dataset)){i.appendChild(t.getUserAvatarNode(e.dataset.user))}})}},{key:"setInformValue",value:function e(t){if(l.Type.isBoolean(t)){var i="calendar-field-container-inform-off";this.meetingNotifyValue=t;if(this.meetingNotifyValue){l.Dom.removeClass(this.DOM.informWrap,i);this.DOM.informWrap.title=l.Loc.getMessage("EC_NOTIFY_OPTION_ON_TITLE");this.DOM.informWrapText.innerHTML=l.Loc.getMessage("EC_NOTIFY_OPTION")}else{l.Dom.addClass(this.DOM.informWrap,i);this.DOM.informWrap.title=l.Loc.getMessage("EC_NOTIFY_OPTION_OFF_TITLE");this.DOM.informWrapText.innerHTML=l.Loc.getMessage("EC_DONT_NOTIFY_OPTION")}}}},{key:"getInformValue",value:function e(t){return this.meetingNotifyValue}},{key:"setViewMode",value:function e(t){this.readOnlyMode=t;if(this.readOnlyMode){l.Dom.addClass(this.DOM.outerWrap,"calendar-userselector-readonly")}else{l.Dom.removeClass(this.DOM.outerWrap,"calendar-userselector-readonly")}}},{key:"isPlannerDisplayed",value:function e(){return this.planner.isShown()}},{key:"hasExternalEmailUsers",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return!!t.find(function(e){return e.EMAIL_USER})||!!this.getEntityList().find(function(e){return e.entityType==="email"})}},{key:"destroy",value:function e(){if(this.userSelectorDialog&&this.userSelectorDialog.destroy){this.userSelectorDialog.destroy();this.userSelectorDialog=null}if(this.intranetControllButton&&this.intranetControllButton.destroy){this.intranetControllButton.destroy();this.intranetControllButton=null}}},{key:"showHideGuestsOption",value:function e(){this.DOM.hideGuestsWrap.style.display="";var t=this.DOM.hideGuestsWrap.querySelector(".calendar-hide-members-helper");if(l.Type.isElementNode(t)){BX.UI.Hint.initNode(t)}}},{key:"hideHideGuestsOption",value:function e(){this.DOM.hideGuestsWrap.style.display="none"}},{key:"setHideGuestsValue",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.hideGuests=t;if(l.Type.isElementNode(this.DOM.hideGuestsIcon)){this.DOM.hideGuestsIcon.className=this.hideGuests?"calendar-hide-members-icon-hidden":"calendar-hide-members-icon-visible"}var i=this.DOM.hideGuestsWrap.querySelector(".calendar-hide-members-text");if(l.Type.isElementNode(i)){i.innerHTML=this.hideGuests?l.Loc.getMessage("EC_HIDE_GUEST_NAMES"):l.Loc.getMessage("EC_SHOW_GUEST_NAMES")}}},{key:"preparedDataAccessibility",value:function e(t){return t.map(function(e){return a.Planner.prepareAccessibilityItem(e)})}}],[{key:"getUserAvatarNode",value:function e(t){var i,a=t.AVATAR||t.SMALL_AVATAR;if(!a||a==="/bitrix/images/1.gif"){i=l.Tag.render(fe(),l.Text.encode(t.DISPLAY_NAME),t.EMAIL_USER?"ui-icon-common-user-mail":"ui-icon-common-user")}else{i=l.Tag.render(he(),l.Text.encode(t.DISPLAY_NAME),parseInt(t.ID),a)}return i}}]);return t}(o.EventEmitter);babelHelpers.defineProperty(me,"VIEW_MODE","view");babelHelpers.defineProperty(me,"EDIT_MODE","edit");babelHelpers.defineProperty(me,"MAX_USER_COUNT",8);babelHelpers.defineProperty(me,"MAX_USER_COUNT_DISPLAY",10);babelHelpers.defineProperty(me,"PLANNER_WIDTH",450);var ve=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ReinviteUserDialog");e.zIndex=3200;e.id="reinvite-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;var i=l.Dom.create("DIV");this.dialog=new r.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_REINVITE_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"reinvite-popup-window",content:i,events:{},cacheable:false});new BX.UI.Button({text:l.Loc.getMessage("EC_REINVITE_YES"),className:"ui-btn ui-btn-primary",events:{click:function e(){t.emit("onSelect",new o.BaseEvent({data:{sendInvitesAgain:true}}));t.close()}}}).renderTo(i);new BX.UI.Button({text:l.Loc.getMessage("EC_REINVITE_NO"),className:"ui-btn ui-btn-light-border",events:{click:function e(){t.emit("onSelect",new o.BaseEvent({data:{sendInvitesAgain:false}}));t.close()}}}).renderTo(i);this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}}]);return t}(o.EventEmitter);function be(){var e=babelHelpers.taggedTemplateLiteral(['<div style="display: none;"></div>']);be=function t(){return e};return e}var ge=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"CONFIRM_POPUP_ID","add_from_email");i.setEventNamespace("BX.Calendar.Controls.EmailSelectorControl");i.DOM.select=e.selectNode;i.mailboxList=l.Type.isArray(e.mailboxList)?e.mailboxList:[];i.DOM.componentWrap=i.DOM.select.parentNode.appendChild(l.Tag.render(be()));i.allowAddNewEmail=e.allowAddNewEmail;i.checkValueDebounce=l.Runtime.debounce(i.checkValue,50,babelHelpers.assertThisInitialized(i));i.create();return i}babelHelpers.createClass(t,[{key:"create",value:function e(){this.setSelectValues();l.Event.bind(this.DOM.select,"change",this.checkValueDebounce);l.Event.bind(this.DOM.select,"click",this.checkValueDebounce)}},{key:"checkValue",value:function e(){if(this.DOM.select.value==="add"){this.showAdd();this.setValue("")}}},{key:"getValue",value:function e(){return this.DOM.select.value}},{key:"setValue",value:function e(t){if(this.mailboxList.length&&this.mailboxList.find(function(e){return e.email===t})){this.DOM.select.value=t}else{this.DOM.select.value=""}this.emit("onSetValue",{value:this.DOM.select.value})}},{key:"setSelectValues",value:function e(){var t=this;l.Dom.clean(this.DOM.select);this.DOM.select.options.add(new Option(l.Loc.getMessage("EC_NO_VALUE"),""));if(this.mailboxList.length){this.mailboxList.forEach(function(e){t.DOM.select.options.add(new Option(e.formatted,e.email))},this)}if(this.allowAddNewEmail){this.DOM.select.options.add(new Option(l.Loc.getMessage("EC_ADD_NEW"),"add"))}}},{key:"onClick",value:function e(t){this.input.value=t.sender;this.mailbox.textContent=t.sender}},{key:"showAdd",value:function e(){var t=this;if(window.BXMainMailConfirm){window.BXMainMailConfirm.showForm(this.onAdd.bind(this))}var i=r.PopupManager.getPopupById(this.CONFIRM_POPUP_ID);if(i){i.subscribe("onClose",function(){t.reloadMailboxList()})}}},{key:"onAdd",value:function e(t){var i=this;this.reloadMailboxList().then(function(){setTimeout(function(){i.setValue(t.email)},0)})}},{key:"getMenuItem",value:function e(t){return{id:t.id,text:BX.util.htmlspecialchars(t.sender),onclick:this.onClick.bind(this,t)}}},{key:"loadMailboxData",value:function e(){var t=this;return new Promise(function(e){BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxData").then(function(i){BX.html(t.DOM.componentWrap,i.data.html);t.mailboxList=i.data.additionalParams.mailboxList;t.checkBXMainMailConfirmLoaded(e)})})}},{key:"checkBXMainMailConfirmLoaded",value:function e(t){var i=this;if(window.BXMainMailConfirm){this.setSelectValues();t()}else{setTimeout(function(){i.checkBXMainMailConfirmLoaded(t)},200)}}},{key:"reloadMailboxList",value:function e(){var t=this;return new Promise(function(e){BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxList").then(function(i){t.mailboxList=i.data.mailboxList;t.setSelectValues();e()})})}}]);return t}(o.EventEmitter);function De(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-confirm-email-text">','</div>\n\t\t\t<div class="calendar-confirm-email-text"><a class="calendar-confirm-email-help-link" href="javascript:void(0);">','</a></div>\n\t\t\t<div class="calendar-field-block">\n\t\t\t\t<select class="calendar-field calendar-field-select ui-btn ui-btn ui-btn-light-border ui-btn-clock"></select>\n\t\t\t</div>\n\t\t</div>']);De=function t(){return e};return e}var Me=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"Z_INDEX",3200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"SLIDER_Z_INDEX",4400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"WIDTH",400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.ConfirmedEmailDialog");e.id="confirm-email-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;this.DOM.content=l.Tag.render(De(),l.Loc.getMessage("EC_CONFIRMED_EMAIL_TEXT_1"),l.Loc.getMessage("EC_CONFIRMED_EMAIL_HELP_LINK"));this.dialog=new r.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_CONFIRMED_EMAIL_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"confirmemail-popup-window",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:l.Loc.getMessage("EC_CONFIRMED_EMAIL_SEND"),className:"ui-btn ui-btn-primary ".concat(BX.UI.Button.State.DISABLED),events:{click:function e(){if(t.DOM.select.value&&t.DOM.select.value!=="add"){var i=d.Util.getUserSettings();i.sendFromEmail=t.emailSelectorControl.getValue();d.Util.setUserSettings(i);BX.userOptions.save("calendar","user_settings","sendFromEmail",i.sendFromEmail);t.emit("onSelect",new o.BaseEvent({data:{sendFromEmail:i.sendFromEmail}}));t.close()}}}}),new BX.UI.Button({text:l.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-light-border",events:{click:this.close.bind(this)}})]});this.DOM.processButton=this.dialog.buttons[0].button;this.DOM.select=this.DOM.content.querySelector("select.calendar-field-select");l.Dom.addClass(this.DOM.select,BX.UI.Button.State.CLOCKING);this.DOM.select.disabled=true;this.emailSelectorControl=new u.EmailSelectorControl({selectNode:this.DOM.select,allowAddNewEmail:true});l.Event.bind(this.DOM.select,"change",this.handleSelectChanges.bind(this));this.emailSelectorControl.subscribe("onSetValue",this.handleSelectChanges.bind(this));this.emailSelectorControl.loadMailboxData().then(function(){t.emailSelectorControl.setValue(d.Util.getUserSettings().sendFromEmail);t.DOM.select.disabled=false;t.DOM.select.className="calendar-field calendar-field-select"});this.DOM.helpLinlk=this.DOM.content.querySelector(".calendar-confirm-email-help-link");l.Event.bind(this.DOM.helpLinlk,"click",this.openHelpSlider.bind(this));this.dialog.show()}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}},{key:"handleSelectChanges",value:function e(){if(this.DOM.select.value&&this.DOM.select.value!=="add"){l.Dom.removeClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}else{l.Dom.addClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}}},{key:"openHelpSlider",value:function e(){if(BX.Helper){BX.Helper.show("redirect=detail&code=12070142",{zIndex:this.SLIDER_Z_INDEX})}}}]);return t}(o.EventEmitter);function ye(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-email-limit-text">','</div>\n\t\t\t<div class="calendar-email-limit-subtext">',"</div>\n\t\t</div>"]);ye=function t(){return e};return e}var Ce=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"Z_INDEX",3200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"EXPAND_LICENSE_URL","/settings/license_all.php");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"WIDTH",480);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});e.setEventNamespace("BX.Calendar.Controls.EmailLimitationDialog");e.id="email-limitation-dialog-"+Math.round(Math.random()*1e4);return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;var i=d.Util.getEventWithEmailGuestAmount();var a=d.Util.isEventWithEmailGuestAllowed();if(i===4){this.text=l.Loc.getMessage("EC_EMAIL_LIMIT_5")}else if(i===8){this.text=l.Loc.getMessage("EC_EMAIL_LIMIT_9")}else{this.text=l.Loc.getMessage("EC_EMAIL_LIMIT_DENY")}this.subText=l.Loc.getMessage("EC_EMAIL_LIMIT_SUBTEXT");this.DOM.content=l.Tag.render(ye(),this.text,this.subText);this.dialog=this.getDialogPopup();this.dialog.subscribe("onClose",function(){t.emit("onClose")});this.dialog.show()}},{key:"getDialogPopup",value:function e(){var t=this;return new r.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:l.Loc.getMessage("EC_EMAIL_LIMIT_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"email-limit-popup",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:l.Loc.getMessage("EC_EMAIL_LIMIT_EXPAND_PLAN"),className:"ui-btn ui-btn-primary ui-btn-icon-plan",events:{click:function e(){window.open(t.EXPAND_LICENSE_URL,"_blank")}}}),new BX.UI.Button({text:d.Util.isEventWithEmailGuestAllowed()?l.Loc.getMessage("EC_SEC_SLIDER_CLOSE"):l.Loc.getMessage("EC_EMAIL_LIMIT_SAVE_WITHOUT"),className:"ui-btn ui-btn-link",events:{click:this.close.bind(this)}})]})}},{key:"close",value:function e(){if(this.dialog){this.dialog.close()}}}]);return t}(o.EventEmitter);e.Reminder=M;e.Location=T;e.UserSelector=E;e.ColorSelector=O;e.SectionSelector=H;e.RepeatSelector=S;e.TimeSelector=c;e.SelectInput=x;e.PopupDialog=P;e.ViewSelector=U;e.LineViewSelector=G;e.AddButton=Y;e.MeetingStatusControl=j;e.ConfirmStatusDialog=q;e.ConfirmEditDialog=Z;e.ConfirmDeleteDialog=K;e.DateTimeControl=ce;e.BusyUsersDialog=pe;e.UserPlannerSelector=me;e.ReinviteUserDialog=ve;e.EmailSelectorControl=ge;e.ConfirmedEmailDialog=Me;e.EmailLimitationDialog=Ce})(this.BX.Calendar.Controls=this.BX.Calendar.Controls||{},BX,BX.Calendar,BX.Calendar,BX.UI.EntitySelector,BX.Intranet,BX,BX.Event,BX.Main,BX.Calendar.Controls,BX.Calendar);
//# sourceMappingURL=controls.bundle.map.js