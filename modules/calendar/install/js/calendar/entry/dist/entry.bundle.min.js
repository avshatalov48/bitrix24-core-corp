this.BX=this.BX||{};(function(t,e,i,a,s,n,r,o,l,d,c){"use strict";class h{static getNewEntry(t){const e={};const n=h.getNewEntryTime(new Date);const r=s.Util.getUserSettings();const o=s.Util.getCurrentUserId();e.ID=null;e.NAME=h.getNewEntryName();e.dateFrom=n.from;e.dateTo=n.to;if(t.type==="location"){e.SECT_ID=d.RoomsManager.getNewEntrySectionId(t.type,parseInt(t.ownerId))}else{e.SECT_ID=a.SectionManager.getNewEntrySectionId(t.type,parseInt(t.ownerId))}e.REMIND=h.getNewEntryReminders();e.attendeesEntityList=[{entityId:"user",id:o}];e.ATTENDEE_LIST=[{id:s.Util.getCurrentUserId(),status:"H"}];if(t.type==="user"&&o!==t.ownerId){e.attendeesEntityList.push({entityId:"user",id:t.ownerId});e.ATTENDEE_LIST=[{id:t.ownerId,status:"H"},{id:s.Util.getCurrentUserId(),status:"Y"}]}else if(t.type==="group"){e.attendeesEntityList.push({entityId:"project",id:t.ownerId})}e.TZ_FROM=r.timezoneName||r.timezoneDefaultName||"";e.TZ_TO=r.timezoneName||r.timezoneDefaultName||"";return new i.Entry({data:e})}static getNewEntryTime(t,e){t=s.Util.getUsableDateTime(t);const i=s.Util.getCalendarContext();if(i){const e=i.getDisplayedViewRange();if(c.Type.isDate(e==null?void 0:e.start)){const a=t.getTime();if(a<e.start.getTime()||a>e.end.getTime()){const a=new Date(e.start.getTime());const n=i.util.getWorkTime();a.setHours(n.start,0,0,0);t=s.Util.getUsableDateTime(a)}}}return{from:t,to:new Date(t.getTime()+(e||3600)*1e3)}}static getNewEntryName(){return h.newEntryName||c.Loc.getMessage("CALENDAR_DEFAULT_ENTRY_NAME")}static setNewEntryName(t){h.newEntryName=t}static showEditEntryNotification(t){s.Util.showNotification(c.Loc.getMessage("CALENDAR_SAVE_EVENT_NOTIFICATION"),[{title:c.Loc.getMessage("CALENDAR_EVENT_DO_VIEW"),events:{click:function(e,i,a){h.openViewSlider(t);i.close()}}}])}static showNewEntryNotification(t){s.Util.showNotification(c.Loc.getMessage("CALENDAR_NEW_EVENT_NOTIFICATION"),[{title:c.Loc.getMessage("CALENDAR_EVENT_DO_VIEW"),events:{click:(e,i,a)=>{h.openViewSlider(t);i.close()}}}])}static showDeleteEntryNotification(t){if(t&&t instanceof i.Entry){BX.UI.Notification.Center.notify({id:"calendar"+t.getUniqueId(),content:c.Loc.getMessage("CALENDAR_DELETE_EVENT_NOTIFICATION"),actions:[{title:c.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL"),events:{click:(e,i,a)=>{t.cancelDelete();i.close()}}}]})}}static showReleaseLocationNotification(){BX.UI.Notification.Center.notify({content:c.Loc.getMessage("CALENDAR_RELEASE_LOCATION_NOTIFICATION")})}static closeDeleteNotificationBalloon(t){if(t&&t instanceof i.Entry){const e=BX.UI.Notification.Center.getBalloonById("calendar"+t.getUniqueId());if(e){e.close()}}}static openEditSlider(t={}){const e=s.Util.getBX();if(e.Calendar&&e.Calendar.SliderLoader){new e.Calendar.SliderLoader(t.entry?"EDIT"+t.entry.id:"NEW",{calendarContext:t.calendarContext,entry:t.entry||null,type:t.type,isLocationCalendar:t.isLocationCalendar||false,roomsManager:t.roomsManager||null,locationAccess:t.locationAccess||false,dayOfWeekMonthFormat:t.dayOfWeekMonthFormat||false,locationCapacity:t.locationCapacity||0,ownerId:t.ownerId,userId:t.userId,formDataValue:t.formDataValue||null}).show()}}static openViewSlider(t=null,e={}){if(!c.Type.isNull(t)){const i=s.Util.getBX();if(i.Calendar&&i.Calendar.SliderLoader){new i.Calendar.SliderLoader(t,{entryDateFrom:e.from,timezoneOffset:e.timezoneOffset,dayOfWeekMonthFormat:e.dayOfWeekMonthFormat||false,calendarContext:e.calendarContext||null}).show()}}}static deleteEntry(t,e=null){if(t instanceof i.Entry){const i=s.Util.getBX().SidePanel.Instance.getTopSlider();const a=()=>{if(i&&i.options.type==="calendar:slider"){s.Util.getBX().SidePanel.Instance.close()}};n.EventEmitter.subscribe("BX.Calendar.Entry:beforeDelete",a);const r=()=>{const t=s.Util.getCalendarContext();if(!t&&!e){return s.Util.getBX().reload()}if(t){t.reload()}else if(e){e.reload()}n.EventEmitter.unsubscribe("BX.Calendar.Entry:delete",r);n.EventEmitter.unsubscribe("BX.Calendar.Entry:beforeDelete",a)};n.EventEmitter.subscribe("BX.Calendar.Entry:delete",r);t.delete()}}static setMeetingStatus(t,e,a={}){return new Promise((n=>{if(!c.Type.isPlainObject(a)){a={}}a.recursionMode=a.recursionMode||false;if(e==="N"&&!a.confirmed){if(t.isRecursive()){this.showConfirmStatusDialog(t,n);return false}}BX.ajax.runAction("calendar.api.calendarajax.setMeetingStatus",{data:{entryId:t.id,entryParentId:t.parentId,status:e,recursionMode:a.recursionMode,currentDateFrom:s.Util.formatDate(t.from)}}).then((s=>{BX.Event.EventEmitter.emit("BX.Calendar.Entry:onChangeMeetingStatus",new c.Event.BaseEvent({data:{entry:t,status:e,recursionMode:a.recursionMode,currentDateFrom:t.from,counters:s.data.counters}}));if(t instanceof i.Entry){t.setCurrentStatus(e)}n({entry:t,status:e,recursionMode:a.recursionMode,currentDateFrom:t.from})}))}))}static showConfirmStatusDialog(t,e=null){if(!this.confirmDeclineDialog){const t=s.Util.getBX();this.confirmDeclineDialog=new t.Calendar.Controls.ConfirmStatusDialog}this.confirmDeclineDialog.show();this.confirmDeclineDialog.unsubscribeAll("onDecline");this.confirmDeclineDialog.subscribe("onDecline",(function(i){if(i&&c.Type.isFunction(i.getData)){h.setMeetingStatus(t,"N",{recursionMode:i.getData().recursionMode,confirmed:true}).then((()=>{if(c.Type.isFunction(e)){e()}}))}}))}static showConfirmEditDialog(t){if(!this.confirmEditDialog){const t=s.Util.getBX();this.confirmEditDialog=new t.Calendar.Controls.ConfirmEditDialog}this.confirmEditDialog.show();if(c.Type.isFunction(t.callback)){this.confirmEditDialog.unsubscribeAll("onEdit");this.confirmEditDialog.subscribe("onEdit",(e=>{if(e&&c.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}static showReInviteUsersDialog(t){if(!this.reinviteUsersDialog){const t=s.Util.getBX();this.reinviteUsersDialog=new t.Calendar.Controls.ReinviteUserDialog}this.reinviteUsersDialog.show();if(c.Type.isFunction(t.callback)){this.reinviteUsersDialog.unsubscribeAll("onSelect");this.reinviteUsersDialog.subscribe("onSelect",(function(e){if(e&&c.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}static showConfirmedEmailDialog(t={}){if(!this.confirmedEmailDialog){const t=s.Util.getBX();this.confirmedEmailDialog=new t.Calendar.Controls.ConfirmedEmailDialog}this.confirmedEmailDialog.show();if(c.Type.isFunction(t.callback)){this.confirmedEmailDialog.unsubscribeAll("onSelect");this.confirmedEmailDialog.subscribe("onSelect",(function(e){if(e&&c.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}static showEmailLimitationDialog(t={}){if(!this.limitationEmailDialog){const t=s.Util.getBX();this.limitationEmailDialog=new t.Calendar.Controls.EmailLimitationDialog}this.limitationEmailDialog.subscribe("onClose",(()=>{if(c.Type.isFunction(t.callback)){t.callback()}}));this.limitationEmailDialog.show()}static getCompactViewForm(t=true){if(!h.compactEntryForm&&t){h.compactEntryForm=new r.CompactEventForm}return h.compactEntryForm}static openCompactViewForm(t={}){const e=h.getCompactViewForm();if(!e.isShown()){e.unsubscribeAll("onClose");if(c.Type.isFunction(t.closeCallback)){e.subscribe("onClose",t.closeCallback)}e.showInViewMode(t)}}static openCompactEditForm(t={}){const e=h.getCompactViewForm();if(!e.isShown()){e.unsubscribeAll("onClose");if(c.Type.isFunction(t.closeCallback)){e.subscribe("onClose",t.closeCallback)}e.showInEditMode(t)}}static getEntryInstance(t,e,a={}){let s=null;if(t instanceof i.Entry){s=t}else{if(c.Type.isObject(t)&&c.Type.isObject(t.data)){s=new i.Entry({data:t.data,userIndex:e})}else if(c.Type.isObject(t)){s=new i.Entry({data:t,userIndex:e})}else{s=h.getNewEntry(a)}}return s}static getUserIndex(t={}){return h.userIndex}static setUserIndex(t){h.userIndex=t}handlePullChanges(t){var e;if(!BX.Calendar.Util.checkRequestId(t.requestUid)){return}const i=h.getCompactViewForm();if(i&&i.isShown()){i.handlePull(t)}BX.SidePanel.Instance.getOpenSliders().forEach((e=>{var i;const a=h.slidersMap.get(e);if(a&&a.entry&&a.entry.parentId===parseInt(t==null?void 0:(i=t.fields)==null?void 0:i.PARENT_ID)){var s;if(t.command==="delete_event"&&a.entry.getType()===(t==null?void 0:(s=t.fields)==null?void 0:s.CAL_TYPE)){e.close()}}}));if(t.command==="set_meeting_status"){top.BX.Event.EventEmitter.emit("BX.Calendar:doReloadCounters")}else if(t.command==="delete_event"||t.command==="edit_event"){var a,n,r,o,l;if(!t.fields||t!=null&&(a=t.fields)!=null&&a.IS_MEETING&&(t==null?void 0:(n=t.fields)==null?void 0:n.MEETING_STATUS)==="Q"){top.BX.Event.EventEmitter.emit("BX.Calendar:doReloadCounters")}if((t==null?void 0:(r=t.fields)==null?void 0:r.CAL_TYPE)==="location"&&(o=top.BX.Calendar)!=null&&(l=o.Controls)!=null&&l.Location){top.BX.Calendar.Controls.Location.handlePull(t)}}const d=s.Util.getCalendarContext();const E=parseInt(t==null?void 0:(e=t.fields)==null?void 0:e.SECTION_ID);let u=c.Type.isArray(t.sections)&&t.sections.find((t=>t.id===E&&t.isShown()));let T=t!=null&&t.fields?h.getEntryInstance(d.getView().getEntryById(h.getEntryUniqueId(t.fields))):null;if((u||T)&&d){d.reloadDebounce()}}static registerDeleteTimeout(t){h.delayedActionList.push(t)}static unregisterDeleteTimeout({action:t,data:e}){h.delayedActionList=h.delayedActionList.filter((i=>i.action!==t||i.data.entryId!==e.entryId||i.data.recursionMode!==e.recursionMode||i.data.excludeDate!==e.excludeDate))}static doDelayedActions(){let t=[];return new Promise((e=>{if(!h.delayedActionList.length){e()}h.delayedActionList.forEach((({action:i,data:a,params:s})=>{const n=parseInt(a.requestUid);t.push(a.requestUid);if(s.entry){h.closeDeleteNotificationBalloon(s.entry)}BX.ajax.runAction(`calendar.api.calendarajax.${i}`,{data:a}).then((()=>{c.Type.isFunction(s.callback);{s.callback()}t=t.filter((t=>t!==n));if(!t.length){e()}}),(()=>{t=t.filter((t=>t!==n));if(!t.length){e()}}));h.unregisterDeleteTimeout({action:i,data:a,params:s})}))}))}static getEntryUniqueId(t,e){let i=t.PARENT_ID||t.ID;if(t.RRULE){i+="|"+(e?s.Util.formatDate(e.from):s.Util.formatDate(BX.parseDate(t.DATE_FROM)))}if(t["~TYPE"]==="tasks"){i+="|"+"task"}return i}static registerEntrySlider(t,e){const i=s.Util.getBX().SidePanel.Instance.getTopSlider();if(i){h.slidersMap.set(i,{entry:t,control:e})}}static getNewEntryReminders(t="withTime"){const e=s.Util.getUserSettings();if(c.Type.isObjectLike(e.defaultReminders)&&c.Type.isArray(e.defaultReminders[t])&&e.defaultReminders[t].length){return e.defaultReminders[t]}return t==="withTime"?[{type:"min",count:15}]:[{type:"daybefore",before:0,time:480}]}static setNewEntryReminders(t="withTime",e){const i=s.Util.getUserSettings();if(c.Type.isObjectLike(i.defaultReminders)){i.defaultReminders[t]=e}s.Util.setUserSettings(i)}}h.newEntryName="";h.userIndex={};h.delayedActionList=[];h.DELETE_DELAY_TIMEOUT=4e3;h.slidersMap=new WeakMap;class E{constructor(t={}){this.FULL_DAY_LENGTH=86400;this.prepareData(t.data);this.parts=[];if(t.userIndex){this.setUserIndex(t.userIndex)}this.delayTimeoutMap=new Map}prepareData(t){this.data=t;this.id=parseInt(this.data.ID||0);this.parentId=parseInt(this.data.PARENT_ID||0);if(!this.data.DT_SKIP_TIME){this.data.DT_SKIP_TIME=this.data.SKIP_TIME?"Y":"N"}this.fullDay=this.data.DT_SKIP_TIME==="Y";this.accessibility=this.data.ACCESSIBILITY||"busy";this.important=this.data.IMPORTANCE==="high";this.private=!!this.data.PRIVATE_EVENT;this.setSectionId(this.data.SECT_ID);this.name=this.data.NAME;this.userTimezoneOffsetFrom=parseInt(this.data["~USER_OFFSET_FROM"])||0;this.userTimezoneOffsetTo=parseInt(this.data["~USER_OFFSET_TO"])||this.userTimezoneOffsetFrom;if(!this.data.DT_LENGTH){this.data.DT_LENGTH=this.data.DURATION||0}if(this.fullDay&&!this.data.DT_LENGTH){this.data.DT_LENGTH=this.FULL_DAY_LENGTH}if(!c.Type.isString(this.data.DATE_FROM)&&!c.Type.isString(this.data.DATE_TO)&&c.Type.isDate(this.data.dateFrom)&&c.Type.isDate(this.data.dateTo)){this.from=this.data.dateFrom;this.to=this.data.dateTo;this.data.DT_LENGTH=Math.round((this.to.getTime()-this.from.getTime())/1e3);this.data.DURATION=this.data.DT_LENGTH;if(this.fullDay){this.data.DATE_FROM=s.Util.formatDate(this.from.getTime());this.data.DATE_TO=s.Util.formatDate(this.to.getTime())}else{this.from=new Date(this.from.getTime()-(parseInt(this.data["~USER_OFFSET_FROM"])||0)*1e3);this.to=new Date(this.to.getTime()-(parseInt(this.data["~USER_OFFSET_TO"])||0)*1e3)}}else{if(this.isTask()){this.from=BX.parseDate(this.data.DATE_FROM)||new Date;this.to=BX.parseDate(this.data.DATE_TO)||this.from}else{this.from=BX.parseDate(this.data.DATE_FROM)||new Date;this.to=BX.parseDate(this.data.DATE_TO)||this.from}}if(this.fullDay){this.from.setHours(0,0,0,0);this.to.setHours(0,0,0,0)}if(!this.data.ATTENDEES_CODES&&!this.isTask()){if(this.data.CAL_TYPE==="user"&&this.data.OWNER_ID){this.data.ATTENDEES_CODES=["U"+this.data.OWNER_ID]}else if(this.data.CREATED_BY){this.data.ATTENDEES_CODES=["U"+this.data.CREATED_BY]}}this.startDayCode=this.from;this.endDayCode=this.to;if(!c.Type.isArray(this.data.REMIND)&&c.Type.isArray(this.data.remind)){this.data.REMIND=[];this.data.remind.forEach((function(t){this.data.REMIND.push({type:"min",count:t})}),this);delete this.data.remind}}getAttendeesCodes(){return this.data.ATTENDEES_CODES||[]}getAttendeesEntityList(){return this.data.attendeesEntityList||[]}getAttendees(){if(!this.attendeeList){this.attendeeList=[];if(c.Type.isArray(this.data["ATTENDEE_LIST"])){const t=this.getUserIndex();this.data["ATTENDEE_LIST"].forEach((e=>{if(t[e.id]){let i=BX.clone(t[e.id]);i.STATUS=e.status;i.ENTRY_ID=e.entryId||false;this.attendeeList.push(i)}}))}}return this.attendeeList}setUserIndex(t){this.userIndex=t}getUserIndex(){return this.userIndex||h.getUserIndex()}cleanParts(){this.parts=[]}startPart(t){t.partIndex=this.parts.length;this.parts.push(t);return this.parts[t.partIndex]}registerPartNode(t,e){t.params=e}checkPartIsRegistered(t){return c.Type.isPlainObject(t.params)}getPart(t){return this.parts[t]||false}getWrap(t){return this.parts[t||0].params.wrapNode}getSectionName(){}getDescription(){return this.data.DESCRIPTION||""}applyViewRange(t){let e=t.start.getTime(),i=t.end.getTime(),a=this.from.getTime(),s=this.to.getTime();if(s<e||a>i)return false;if(a<e){this.displayFrom=t.start;this.startDayCode=this.displayFrom}if(s>i){this.displayTo=t.end;this.endDayCode=this.displayTo}return true}isPersonal(){}isMeeting(){return!!this.data.IS_MEETING}isPrivate(){return this.private}isResourcebooking(){return this.data.EVENT_TYPE==="#resourcebooking#"}isTask(){return this.data["~TYPE"]==="tasks"}isLocation(){return this.getType()==="location"}isFullDay(){return this.fullDay}isLongWithTime(){return!this.fullDay&&s.Util.getDayCode(this.from)!==s.Util.getDayCode(this.to)}isExpired(){return this.to.getTime()<(new Date).getTime()}hasEmailAttendees(){if(this.emailAttendeesCache===undefined){const t=h.getUserIndex();for(let e=0;e<this.data["ATTENDEE_LIST"].length;e++){let i=this.data["ATTENDEE_LIST"][e];if((i.status==="Y"||i.status==="Q")&&t[i.id]&&t[i.id].EMAIL_USER){this.emailAttendeesCache=true;break}}}return this.emailAttendeesCache}ownerIsEmailUser(){if(this.ownerIsEmailUserCache===undefined){const t=h.getUserIndex();this.ownerIsEmailUserCache=t[parseInt(this.data.MEETING_HOST)]&&t[parseInt(this.data.MEETING_HOST)].EMAIL_USER}return this.ownerIsEmailUserCache}isSelected(){return!!this.selected}isCrm(){return!!this.data.UF_CRM_CAL_EVENT}isFirstReccurentEntry(){return(this.data.DATE_FROM_TS_UTC===Math.floor(BX.parseDate(this.data["~DATE_FROM"]).getTime()/1e3)*1e3||BX.parseDate(this.data["DATE_FROM"]).getTime()===BX.parseDate(this.data["~DATE_FROM"]).getTime())&&!this.data.RECURRENCE_ID}isRecursive(){return!!this.data.RRULE}isFirstInstance(){return this.data.RRULE&&this.data.RINDEX===0}getMeetingHost(){return parseInt(this.data.MEETING_HOST)}getMeetingNotify(){return this.data.MEETING.NOTIFY}getHideGuests(){return this.data.MEETING&&BX.Type.isBoolean(this.data.MEETING.HIDE_GUESTS)?this.data.MEETING.HIDE_GUESTS:true}getRrule(){return this.data.RRULE}getRRuleDescription(){return this.data["~RRULE_DESCRIPTION"]}hasRecurrenceId(){return this.data.RECURRENCE_ID}wasEverRecursive(){return this.data.RRULE||this.data.RECURRENCE_ID}deselect(){this.selected=false}select(){this.selected=true}deleteParts(t){const e=s.Util.getCalendarContext();if(e){const i=e.getView().getContainer();if(t==="all"){e.getView().entries.forEach((t=>{if(parseInt(t.id)===this.id||parseInt(t.data.RECURRENCE_ID)===this.id||parseInt(t.data.RECURRENCE_ID)===parseInt(this.data.RECURRENCE_ID)||parseInt(t.id)===parseInt(this.data.RECURRENCE_ID)){const e=i.querySelector('div[data-bx-calendar-entry="'+t.uid+'"]');if(e){e.style.opacity=0;setTimeout((()=>{e.style.display="none"}),200)}}}))}else if(t==="next"){e.getView().entries.forEach((t=>{if((parseInt(t.id)===this.id||parseInt(t.data.RECURRENCE_ID)===this.id||parseInt(t.data.RECURRENCE_ID)===parseInt(this.data.RECURRENCE_ID)||parseInt(t.id)===parseInt(this.data.RECURRENCE_ID))&&t.from.getTime()>this.from.getTime()){const e=i.querySelector('div[data-bx-calendar-entry="'+t.uid+'"]');if(e){e.style.opacity=0;setTimeout((()=>{e.style.display="none"}),200)}}}))}else if(t==="this"||!t){const t=i.querySelectorAll('div[data-bx-calendar-entry="'+this.getUniqueId()+'"]');t.forEach((t=>{t.style.opacity=0;setTimeout((()=>{t.style.display="none"}),200)}))}}}getUniqueId(){return h.getEntryUniqueId(this.data,this)}getCurrentStatus(){let t=s.Util.getCurrentUserId(),e=false,i,a;if(this.isMeeting()){if(t===parseInt(this.data.CREATED_BY)){e=this.data.MEETING_STATUS||"Q"}else if(t===parseInt(this.data.MEETING_HOST)){e="H"}else if(c.Type.isArray(this.data["ATTENDEE_LIST"])){for(i=0;i<this.data["ATTENDEE_LIST"].length;i++){a=this.data["ATTENDEE_LIST"][i];if(parseInt(a.id)===t){e=a.status;break}}}}else if(t===parseInt(this.data.CREATED_BY)){e=this.data.MEETING_STATUS||"H"}return s.Util.getMeetingStatusList().includes(e)?e:false}setCurrentStatus(t){if(this.isMeeting()&&s.Util.getMeetingStatusList().includes(t)){this.data.MEETING_STATUS=t;const e=s.Util.getCurrentUserId();if(c.Type.isArray(this.data["ATTENDEE_LIST"])){for(let i=0;i<this.data["ATTENDEE_LIST"].length;i++){if(parseInt(this.data["ATTENDEE_LIST"][i].id)===e){this.data["ATTENDEE_LIST"][i].status=t;this.attendeeList=null;break}}}}}getReminders(){let t=[];if(this.data&&this.data.REMIND){this.data.REMIND.forEach((function(e){switch(e.type){case"min":t.push(e.count);break;case"hour":t.push(parseInt(e.count)*60);break;case"day":t.push(parseInt(e.count)*60*24);break;case"daybefore":t.push(e);break;case"date":if(!c.Type.isDate(e.value)){e.value=s.Util.parseDate(e.value)}if(c.Type.isDate(e.value)){t.push(e)}break}}))}return t}getLengthInDays(){let t=new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate(),0,0,0),e=new Date(this.to.getFullYear(),this.to.getMonth(),this.to.getDate(),0,0,0);return Math.round((e.getTime()-t.getTime())/s.Util.getDayLength())+1}getName(){return this.name||this.defaultNewName}getColor(){return this.data.COLOR}getType(){return this.data.CAL_TYPE}getOwnerId(){return this.data.OWNER_ID}delete(t){t=c.Type.isPlainObject(t)?t:{};let e=t.recursionMode||false;if(this.wasEverRecursive()&&!t.confirmed){return this.showConfirmDeleteDialog({entry:this})}else{BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:e,entryData:this.data}]);h.showDeleteEntryNotification(this);this.deleteParts(e);const i="deleteCalendarEntry";const a={entryId:this.id,recursionMode:t.recursionMode||false,requestUid:s.Util.registerRequestId()};h.registerDeleteTimeout({action:i,data:a,params:{entry:this,callback:()=>{BX.onCustomEvent("BX.Calendar.Entry:delete",[{entryId:this.id,recursionMode:e}])}}});this.deleteTimeout=setTimeout(h.doDelayedActions,h.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:i,data:a})}}deleteThis(){let t="this";if(this.isRecursive()){BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:t,entryData:this.data}]);h.showDeleteEntryNotification(this);this.deleteParts(t);const e="excludeRecursionDate";const i={entryId:this.id,recursionMode:t,excludeDate:this.data.DATE_FROM};h.registerDeleteTimeout({action:e,data:i,params:{entry:this,callback:()=>{BX.onCustomEvent("BX.Calendar.Entry:delete",[i])}}});this.deleteTimeout=setTimeout(h.doDelayedActions,h.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:e,data:i})}else if(this.hasRecurrenceId()){this.delete({confirmed:true,recursionMode:"this"})}}deleteNext(){let t="next";if(this.isRecursive()&&this.isFirstReccurentEntry()){this.deleteAll()}else{BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:t}]);h.showDeleteEntryNotification(this);this.deleteParts(t);const e=s.Util.getCalendarContext();const i="changeRecurciveEntryUntil";const a={entryId:this.id,recursionMode:t,untilDate:s.Util.formatDate(this.from.getTime()-s.Util.getDayLength())};h.registerDeleteTimeout({action:i,data:a,params:{entry:this,callback:()=>{BX.onCustomEvent("BX.Calendar.Entry:delete",[a])}}});this.deleteTimeout=setTimeout(h.doDelayedActions,h.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:i,data:a})}}deleteAll(){return this.delete({confirmed:true,recursionMode:"all"})}cancelDelete(){if(this.deleteTimeout){const t=this.delayTimeoutMap.get(this.deleteTimeout);if(t){h.unregisterDeleteTimeout(t);BX.onCustomEvent("BX.Calendar.Entry:cancelDelete",[{entryId:this.id,entryData:this.data}]);this.delayTimeoutMap.delete(this.delayTimeoutMap)}clearTimeout(this.deleteTimeout);this.deleteTimeout=null}const t=s.Util.getCalendarContext();if(t){t.reload()}}showConfirmDeleteDialog(t){if(!this.confirmDeleteDialog){this.confirmDeleteDialog=new(window.BX||window.top.BX).Calendar.Controls.ConfirmDeleteDialog({entry:t.entry})}this.confirmDeleteDialog.show()}save(){}getLocation(){return this.data.LOCATION}setTimezone(t,e=null){if(c.Type.isString(t)){this.data.TZ_FROM=t;if(c.Type.isNull(e)){this.data.TZ_TO=t}}if(c.Type.isString(e)){this.data.TZ_TO=e}}getTimezoneFrom(){return this.data.TZ_FROM||""}getTimezoneTo(){return this.data.TZ_TO||""}setSectionId(t){this.data.SECT_ID=this.sectionId=this.isTask()?"tasks":parseInt(t)}setDateTimeValue({from:t,to:e}){if(c.Type.isDate(t)&&c.Type.isDate(e)){this.from=this.data.dateFrom=t;this.to=this.data.dateTo=e;this.data.DT_LENGTH=Math.round((this.to.getTime()-this.from.getTime())/1e3);this.data.DURATION=this.data.DT_LENGTH;if(this.fullDay){this.data.DATE_FROM=s.Util.formatDate(this.from.getTime());this.data.DATE_TO=s.Util.formatDate(this.to.getTime())}else{this.data.DATE_FROM=s.Util.formatDateTime(this.from.getTime());this.data.DATE_TO=s.Util.formatDateTime(this.to.getTime())}}}}t.EntryManager=h;t.Entry=E})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar,BX.Event,BX.Calendar,BX,BX.Calendar,BX.Calendar,BX);
//# sourceMappingURL=entry.bundle.map.js