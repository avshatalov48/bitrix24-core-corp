this.BX=this.BX||{};(function(e,t,i,a,n,s,r,o,l,d,u){"use strict";var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"handlePullChanges",value:function t(i){var a;var s=e.getCompactViewForm();if(s&&s.isShown()){s.handlePull(i)}BX.SidePanel.Instance.getOpenSliders().forEach((function(t){var a;var n=e.slidersMap.get(t);if(n&&n.entry&&n.entry.parentId===parseInt(i===null||i===void 0?void 0:(a=i.fields)===null||a===void 0?void 0:a.PARENT_ID)){var s;if(i.command==="delete_event"&&n.entry.getType()===(i===null||i===void 0?void 0:(s=i.fields)===null||s===void 0?void 0:s.CAL_TYPE)){t.close()}else if(n.control instanceof l.EventViewForm){n.control.reloadSlider(i)}}}));if(i.command==="set_meeting_status"){top.BX.Event.EventEmitter.emit("BX.Calendar:doReloadCounters")}else if(i.command==="delete_event"||i.command==="edit_event"){var r,o,d,c,f;if(!i.fields||i!==null&&i!==void 0&&(r=i.fields)!==null&&r!==void 0&&r.IS_MEETING&&(i===null||i===void 0?void 0:(o=i.fields)===null||o===void 0?void 0:o.MEETING_STATUS)==="Q"){top.BX.Event.EventEmitter.emit("BX.Calendar:doReloadCounters")}if((i===null||i===void 0?void 0:(d=i.fields)===null||d===void 0?void 0:d.CAL_TYPE)==="location"&&(c=top.BX.Calendar)!==null&&c!==void 0&&(f=c.Controls)!==null&&f!==void 0&&f.Location){top.BX.Calendar.Controls.Location.handlePull(i)}}var h=n.Util.getCalendarContext();var E=parseInt(i===null||i===void 0?void 0:(a=i.fields)===null||a===void 0?void 0:a.SECTION_ID);var T=u.Type.isArray(i.sections)&&i.sections.find((function(e){return e.id===E&&e.isShown()}));var y=e.getEntryInstance(h.getView().getEntryById(e.getEntryUniqueId(i===null||i===void 0?void 0:i.fields)));if((T||y)&&h){h.reload()}}}],[{key:"getNewEntry",value:function t(s){var r={};var o=e.getNewEntryTime(new Date);var l=n.Util.getUserSettings();var u=n.Util.getCurrentUserId();r.ID=null;r.NAME=e.getNewEntryName();r.dateFrom=o.from;r.dateTo=o.to;if(s.type==="location"){r.SECT_ID=d.RoomsManager.getNewEntrySectionId(s.type,parseInt(s.ownerId))}else{r.SECT_ID=a.SectionManager.getNewEntrySectionId(s.type,parseInt(s.ownerId))}r.REMIND=e.getNewEntryReminders();r.attendeesEntityList=[{entityId:"user",id:u}];r.ATTENDEE_LIST=[{id:n.Util.getCurrentUserId(),status:"H"}];if(s.type==="user"&&u!==s.ownerId){r.attendeesEntityList.push({entityId:"user",id:s.ownerId});r.ATTENDEE_LIST=[{id:s.ownerId,status:"H"},{id:n.Util.getCurrentUserId(),status:"Y"}]}else if(s.type==="group"){r.attendeesEntityList.push({entityId:"project",id:s.ownerId})}r.TZ_FROM=l.timezoneName||l.timezoneDefaultName||"";r.TZ_TO=l.timezoneName||l.timezoneDefaultName||"";return new i.Entry({data:r})}},{key:"getNewEntryTime",value:function e(t,i){t=n.Util.getUsableDateTime(t);var a=n.Util.getCalendarContext();if(a){var s=a.getDisplayedViewRange();if(u.Type.isDate(s===null||s===void 0?void 0:s.start)){var r=t.getTime();if(r<s.start.getTime()||r>s.end.getTime()){t=n.Util.getUsableDateTime(s.start)}}}return{from:t,to:new Date(t.getTime()+(i||3600)*1e3)}}},{key:"getNewEntryName",value:function t(){return e.newEntryName||u.Loc.getMessage("CALENDAR_DEFAULT_ENTRY_NAME")}},{key:"setNewEntryName",value:function t(i){e.newEntryName=i}},{key:"showEditEntryNotification",value:function t(i){n.Util.showNotification(u.Loc.getMessage("CALENDAR_SAVE_EVENT_NOTIFICATION"),[{title:u.Loc.getMessage("CALENDAR_EVENT_DO_VIEW"),events:{click:function t(a,n,s){e.openViewSlider(i);n.close()}}}])}},{key:"showNewEntryNotification",value:function t(i){n.Util.showNotification(u.Loc.getMessage("CALENDAR_NEW_EVENT_NOTIFICATION"),[{title:u.Loc.getMessage("CALENDAR_EVENT_DO_VIEW"),events:{click:function t(a,n,s){e.openViewSlider(i);n.close()}}}])}},{key:"showDeleteEntryNotification",value:function e(t){if(t&&t instanceof i.Entry){BX.UI.Notification.Center.notify({id:"calendar"+t.getUniqueId(),content:u.Loc.getMessage("CALENDAR_DELETE_EVENT_NOTIFICATION"),actions:[{title:u.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL"),events:{click:function e(i,a,n){t.cancelDelete();a.close()}}}]})}}},{key:"closeDeleteNotificationBalloon",value:function e(t){if(t&&t instanceof i.Entry){var a=BX.UI.Notification.Center.getBalloonById("calendar"+t.getUniqueId());if(a){a.close()}}}},{key:"openEditSlider",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=n.Util.getBX();if(i.Calendar&&i.Calendar.SliderLoader){new i.Calendar.SliderLoader(t.entry?"EDIT"+t.entry.id:"NEW",{entry:t.entry||null,type:t.type,isLocationCalendar:t.isLocationCalendar||false,roomsManager:t.roomsManager||null,locationAccess:t.locationAccess||false,dayOfWeekMonthFormat:t.dayOfWeekMonthFormat||false,locationCapacity:t.locationCapacity||0,ownerId:t.ownerId,userId:t.userId,formDataValue:t.formDataValue||null}).show()}}},{key:"openViewSlider",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!u.Type.isNull(t)){var a=n.Util.getBX();if(a.Calendar&&a.Calendar.SliderLoader){new a.Calendar.SliderLoader(t,{entryDateFrom:i.from,timezoneOffset:i.timezoneOffset,dayOfWeekMonthFormat:i.dayOfWeekMonthFormat||false,calendarContext:i.calendarContext||null}).show()}}}},{key:"deleteEntry",value:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(t instanceof i.Entry){var r=n.Util.getBX().SidePanel.Instance.getTopSlider();var o=function e(){if(r&&r.options.type==="calendar:slider"){n.Util.getBX().SidePanel.Instance.close()}};s.EventEmitter.subscribe("BX.Calendar.Entry:beforeDelete",o);var l=function e(){var t=n.Util.getCalendarContext();if(!t&&!a){return n.Util.getBX().reload()}if(t){t.reload()}else if(a){a.reload()}s.EventEmitter.unsubscribe("BX.Calendar.Entry:delete",e);s.EventEmitter.unsubscribe("BX.Calendar.Entry:beforeDelete",o)};s.EventEmitter.subscribe("BX.Calendar.Entry:delete",l);t["delete"]()}}},{key:"setMeetingStatus",value:function e(t,a){var s=this;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise((function(e){if(!u.Type.isPlainObject(r)){r={}}r.recursionMode=r.recursionMode||false;if(a==="N"&&!r.confirmed){if(t.isRecursive()){s.showConfirmStatusDialog(t,e);return false}}BX.ajax.runAction("calendar.api.calendarajax.setMeetingStatus",{data:{entryId:t.id,entryParentId:t.parentId,status:a,recursionMode:r.recursionMode,currentDateFrom:n.Util.formatDate(t.from)}}).then((function(n){BX.Event.EventEmitter.emit("BX.Calendar.Entry:onChangeMeetingStatus",new u.Event.BaseEvent({data:{entry:t,status:a,recursionMode:r.recursionMode,currentDateFrom:t.from,counters:n.data.counters}}));if(t instanceof i.Entry){t.setCurrentStatus(a)}e({entry:t,status:a,recursionMode:r.recursionMode,currentDateFrom:t.from})}))}))}},{key:"showConfirmStatusDialog",value:function t(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this.confirmDeclineDialog){var s=n.Util.getBX();this.confirmDeclineDialog=new s.Calendar.Controls.ConfirmStatusDialog}this.confirmDeclineDialog.show();this.confirmDeclineDialog.unsubscribeAll("onDecline");this.confirmDeclineDialog.subscribe("onDecline",(function(t){if(t&&u.Type.isFunction(t.getData)){e.setMeetingStatus(i,"N",{recursionMode:t.getData().recursionMode,confirmed:true}).then((function(){if(u.Type.isFunction(a)){a()}}))}}))}},{key:"showConfirmEditDialog",value:function e(t){if(!this.confirmEditDialog){var i=n.Util.getBX();this.confirmEditDialog=new i.Calendar.Controls.ConfirmEditDialog}this.confirmEditDialog.show();if(u.Type.isFunction(t.callback)){this.confirmEditDialog.unsubscribeAll("onEdit");this.confirmEditDialog.subscribe("onEdit",(function(e){if(e&&u.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}},{key:"showReInviteUsersDialog",value:function e(t){if(!this.reinviteUsersDialog){var i=n.Util.getBX();this.reinviteUsersDialog=new i.Calendar.Controls.ReinviteUserDialog}this.reinviteUsersDialog.show();if(u.Type.isFunction(t.callback)){this.reinviteUsersDialog.unsubscribeAll("onSelect");this.reinviteUsersDialog.subscribe("onSelect",(function(e){if(e&&u.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}},{key:"showConfirmedEmailDialog",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.confirmedEmailDialog){var i=n.Util.getBX();this.confirmedEmailDialog=new i.Calendar.Controls.ConfirmedEmailDialog}this.confirmedEmailDialog.show();if(u.Type.isFunction(t.callback)){this.confirmedEmailDialog.unsubscribeAll("onSelect");this.confirmedEmailDialog.subscribe("onSelect",(function(e){if(e&&u.Type.isFunction(e.getData)){t.callback(e.getData())}}))}}},{key:"showEmailLimitationDialog",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.limitationEmailDialog){var i=n.Util.getBX();this.limitationEmailDialog=new i.Calendar.Controls.EmailLimitationDialog}this.limitationEmailDialog.subscribe("onClose",(function(){if(u.Type.isFunction(t.callback)){t.callback()}}));this.limitationEmailDialog.show()}},{key:"getCompactViewForm",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!e.compactEntryForm&&i){e.compactEntryForm=new r.CompactEventForm}return e.compactEntryForm}},{key:"openCompactViewForm",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=e.getCompactViewForm();if(!a.isShown()){a.unsubscribeAll("onClose");if(u.Type.isFunction(i.closeCallback)){a.subscribe("onClose",i.closeCallback)}a.showInViewMode(i)}}},{key:"openCompactEditForm",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=e.getCompactViewForm();if(!a.isShown()){a.unsubscribeAll("onClose");if(u.Type.isFunction(i.closeCallback)){a.subscribe("onClose",i.closeCallback)}a.showInEditMode(i)}}},{key:"getEntryInstance",value:function t(a,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=null;if(a instanceof i.Entry){r=a}else{if(u.Type.isObject(a)&&u.Type.isObject(a.data)){r=new i.Entry({data:a.data,userIndex:n})}else if(u.Type.isObject(a)){r=new i.Entry({data:a,userIndex:n})}else{r=e.getNewEntry(s)}}return r}},{key:"getUserIndex",value:function t(){return e.userIndex}},{key:"setUserIndex",value:function t(i){e.userIndex=i}},{key:"registerDeleteTimeout",value:function t(i){e.delayedActionList.push(i)}},{key:"unregisterDeleteTimeout",value:function t(i){var a=i.action,n=i.data;e.delayedActionList=e.delayedActionList.filter((function(e){return e.action!==a||e.data.entryId!==n.entryId||e.data.recursionMode!==n.recursionMode||e.data.excludeDate!==n.excludeDate}))}},{key:"doDelayedActions",value:function t(){var i=[];return new Promise((function(t){if(!e.delayedActionList.length){t()}e.delayedActionList.forEach((function(a){var n=a.action,s=a.data,r=a.params;var o=parseInt(s.requestUid);i.push(s.requestUid);if(r.entry){e.closeDeleteNotificationBalloon(r.entry)}BX.ajax.runAction("calendar.api.calendarajax.".concat(n),{data:s}).then((function(){u.Type.isFunction(r.callback);{r.callback()}i=i.filter((function(e){return e!==o}));if(!i.length){t()}}),(function(){i=i.filter((function(e){return e!==o}));if(!i.length){t()}}));e.unregisterDeleteTimeout({action:n,data:s,params:r})}))}))}},{key:"getEntryUniqueId",value:function e(t,i){var a=t.PARENT_ID||t.ID;if(t.RRULE){a+="|"+(i?n.Util.formatDate(i.from):n.Util.formatDate(BX.parseDate(t.DATE_FROM)))}if(t["~TYPE"]==="tasks"){a+="|"+"task"}return a}},{key:"registerEntrySlider",value:function t(i,a){var s=n.Util.getBX().SidePanel.Instance.getTopSlider();if(s){e.slidersMap.set(s,{entry:i,control:a})}}},{key:"getNewEntryReminders",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"withTime";var i=n.Util.getUserSettings();if(u.Type.isObjectLike(i.defaultReminders)&&u.Type.isArray(i.defaultReminders[t])&&i.defaultReminders[t].length){return i.defaultReminders[t]}return t==="withTime"?[{type:"min",count:15}]:[{type:"daybefore",before:0,time:480}]}},{key:"setNewEntryReminders",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"withTime";var i=arguments.length>1?arguments[1]:undefined;var a=n.Util.getUserSettings();if(u.Type.isObjectLike(a.defaultReminders)){a.defaultReminders[t]=i}n.Util.setUserSettings(a)}}]);return e}();babelHelpers.defineProperty(c,"newEntryName","");babelHelpers.defineProperty(c,"userIndex",{});babelHelpers.defineProperty(c,"delayedActionList",[]);babelHelpers.defineProperty(c,"DELETE_DELAY_TIMEOUT",4e3);babelHelpers.defineProperty(c,"slidersMap",new WeakMap);var f=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"FULL_DAY_LENGTH",86400);this.prepareData(t.data);this.parts=[];if(t.userIndex){this.setUserIndex(t.userIndex)}this.delayTimeoutMap=new Map}babelHelpers.createClass(e,[{key:"prepareData",value:function e(t){this.data=t;this.id=parseInt(this.data.ID||0);this.parentId=parseInt(this.data.PARENT_ID||0);if(!this.data.DT_SKIP_TIME){this.data.DT_SKIP_TIME=this.data.SKIP_TIME?"Y":"N"}this.fullDay=this.data.DT_SKIP_TIME==="Y";this.accessibility=this.data.ACCESSIBILITY||"busy";this.important=this.data.IMPORTANCE==="high";this["private"]=!!this.data.PRIVATE_EVENT;this.setSectionId(this.data.SECT_ID);this.name=this.data.NAME;this.userTimezoneOffsetFrom=parseInt(this.data["~USER_OFFSET_FROM"])||0;this.userTimezoneOffsetTo=parseInt(this.data["~USER_OFFSET_TO"])||this.userTimezoneOffsetFrom;if(!this.data.DT_LENGTH){this.data.DT_LENGTH=this.data.DURATION||0}if(this.fullDay&&!this.data.DT_LENGTH){this.data.DT_LENGTH=this.FULL_DAY_LENGTH}if(!u.Type.isString(this.data.DATE_FROM)&&!u.Type.isString(this.data.DATE_TO)&&u.Type.isDate(this.data.dateFrom)&&u.Type.isDate(this.data.dateTo)){this.from=this.data.dateFrom;this.to=this.data.dateTo;this.data.DT_LENGTH=Math.round((this.to.getTime()-this.from.getTime())/1e3);this.data.DURATION=this.data.DT_LENGTH;if(this.fullDay){this.data.DATE_FROM=n.Util.formatDate(this.from.getTime());this.data.DATE_TO=n.Util.formatDate(this.to.getTime())}else{this.from=new Date(this.from.getTime()-(parseInt(this.data["~USER_OFFSET_FROM"])||0)*1e3);this.to=new Date(this.from.getTime()+(this.data.DT_LENGTH-(this.fullDay?1:0))*1e3)}}else{if(this.isTask()){this.from=BX.parseDate(this.data.DATE_FROM)||new Date;this.to=BX.parseDate(this.data.DATE_TO)||this.from}else{this.from=BX.parseDate(this.data.DATE_FROM)||new Date;this.to=new Date(this.from.getTime()+(this.data.DT_LENGTH-(this.fullDay?1:0))*1e3)}}if(this.fullDay){this.from.setHours(0,0,0,0);this.to.setHours(0,0,0,0)}if(!this.data.ATTENDEES_CODES&&!this.isTask()){if(this.data.CAL_TYPE==="user"&&this.data.OWNER_ID){this.data.ATTENDEES_CODES=["U"+this.data.OWNER_ID]}else if(this.data.CREATED_BY){this.data.ATTENDEES_CODES=["U"+this.data.CREATED_BY]}}this.startDayCode=this.from;this.endDayCode=this.to;if(!u.Type.isArray(this.data.REMIND)&&u.Type.isArray(this.data.remind)){this.data.REMIND=[];this.data.remind.forEach((function(e){this.data.REMIND.push({type:"min",count:e})}),this);delete this.data.remind}}},{key:"getAttendeesCodes",value:function e(){return this.data.ATTENDEES_CODES||[]}},{key:"getAttendeesEntityList",value:function e(){return this.data.attendeesEntityList||[]}},{key:"getAttendees",value:function e(){var t=this;if(!this.attendeeList){this.attendeeList=[];if(u.Type.isArray(this.data["ATTENDEE_LIST"])){var i=this.getUserIndex();this.data["ATTENDEE_LIST"].forEach((function(e){if(i[e.id]){var a=BX.clone(i[e.id]);a.STATUS=e.status;a.ENTRY_ID=e.entryId||false;t.attendeeList.push(a)}}))}}return this.attendeeList}},{key:"setUserIndex",value:function e(t){this.userIndex=t}},{key:"getUserIndex",value:function e(){return this.userIndex||c.getUserIndex()}},{key:"cleanParts",value:function e(){this.parts=[]}},{key:"startPart",value:function e(t){t.partIndex=this.parts.length;this.parts.push(t);return this.parts[t.partIndex]}},{key:"registerPartNode",value:function e(t,i){t.params=i}},{key:"checkPartIsRegistered",value:function e(t){return u.Type.isPlainObject(t.params)}},{key:"getPart",value:function e(t){return this.parts[t]||false}},{key:"getWrap",value:function e(t){return this.parts[t||0].params.wrapNode}},{key:"getSectionName",value:function e(){}},{key:"getDescription",value:function e(){return this.data.DESCRIPTION||""}},{key:"applyViewRange",value:function e(t){var i=t.start.getTime(),a=t.end.getTime(),n=this.from.getTime(),s=this.to.getTime();if(s<i||n>a)return false;if(n<i){this.displayFrom=t.start;this.startDayCode=this.displayFrom}if(s>a){this.displayTo=t.end;this.endDayCode=this.displayTo}return true}},{key:"isPersonal",value:function e(){}},{key:"isMeeting",value:function e(){return!!this.data.IS_MEETING}},{key:"isResourcebooking",value:function e(){return this.data.EVENT_TYPE==="#resourcebooking#"}},{key:"isTask",value:function e(){return this.data["~TYPE"]==="tasks"}},{key:"isLocation",value:function e(){return this.getType()==="location"}},{key:"isFullDay",value:function e(){return this.fullDay}},{key:"isLongWithTime",value:function e(){return!this.fullDay&&n.Util.getDayCode(this.from)!==n.Util.getDayCode(this.to)}},{key:"isExpired",value:function e(){return this.to.getTime()<(new Date).getTime()}},{key:"hasEmailAttendees",value:function e(){if(this.emailAttendeesCache===undefined){var t=c.getUserIndex();for(var i=0;i<this.data["ATTENDEE_LIST"].length;i++){var a=this.data["ATTENDEE_LIST"][i];if((a.status==="Y"||a.status==="Q")&&t[a.id]&&t[a.id].EMAIL_USER){this.emailAttendeesCache=true;break}}}return this.emailAttendeesCache}},{key:"ownerIsEmailUser",value:function e(){if(this.ownerIsEmailUserCache===undefined){var t=c.getUserIndex();this.ownerIsEmailUserCache=t[parseInt(this.data.MEETING_HOST)]&&t[parseInt(this.data.MEETING_HOST)].EMAIL_USER}return this.ownerIsEmailUserCache}},{key:"isSelected",value:function e(){return!!this.selected}},{key:"isCrm",value:function e(){return!!this.data.UF_CRM_CAL_EVENT}},{key:"isFirstReccurentEntry",value:function e(){return(this.data.DATE_FROM_TS_UTC===Math.floor(BX.parseDate(this.data["~DATE_FROM"]).getTime()/1e3)*1e3||BX.parseDate(this.data["DATE_FROM"]).getTime()===BX.parseDate(this.data["~DATE_FROM"]).getTime())&&!this.data.RECURRENCE_ID}},{key:"isRecursive",value:function e(){return!!this.data.RRULE}},{key:"getMeetingHost",value:function e(){return parseInt(this.data.MEETING_HOST)}},{key:"getMeetingNotify",value:function e(){return this.data.MEETING.NOTIFY}},{key:"getHideGuests",value:function e(){return this.data.MEETING&&BX.Type.isBoolean(this.data.MEETING.HIDE_GUESTS)?this.data.MEETING.HIDE_GUESTS:true}},{key:"getRrule",value:function e(){return this.data.RRULE}},{key:"getRRuleDescription",value:function e(){return this.data["~RRULE_DESCRIPTION"]}},{key:"hasRecurrenceId",value:function e(){return this.data.RECURRENCE_ID}},{key:"wasEverRecursive",value:function e(){return this.data.RRULE||this.data.RECURRENCE_ID}},{key:"deselect",value:function e(){this.selected=false}},{key:"select",value:function e(){this.selected=true}},{key:"deleteParts",value:function e(t){var i=this;var a=n.Util.getCalendarContext();if(a){var s=a.getView().getContainer();if(t==="all"){a.getView().entries.forEach((function(e){if(parseInt(e.id)===i.id||parseInt(e.data.RECURRENCE_ID)===i.id||parseInt(e.data.RECURRENCE_ID)===parseInt(i.data.RECURRENCE_ID)||parseInt(e.id)===parseInt(i.data.RECURRENCE_ID)){var t=s.querySelector('div[data-bx-calendar-entry="'+e.uid+'"]');if(t){t.style.opacity=0;setTimeout((function(){t.style.display="none"}),200)}}}))}else if(t==="next"){a.getView().entries.forEach((function(e){if((parseInt(e.id)===i.id||parseInt(e.data.RECURRENCE_ID)===i.id||parseInt(e.data.RECURRENCE_ID)===parseInt(i.data.RECURRENCE_ID)||parseInt(e.id)===parseInt(i.data.RECURRENCE_ID))&&e.from.getTime()>i.from.getTime()){var t=s.querySelector('div[data-bx-calendar-entry="'+e.uid+'"]');if(t){t.style.opacity=0;setTimeout((function(){t.style.display="none"}),200)}}}))}else if(t==="this"||!t){var r=s.querySelectorAll('div[data-bx-calendar-entry="'+this.getUniqueId()+'"]');r.forEach((function(e){e.style.opacity=0;setTimeout((function(){e.style.display="none"}),200)}))}}}},{key:"getUniqueId",value:function e(){return c.getEntryUniqueId(this.data,this)}},{key:"getCurrentStatus",value:function e(){var t=n.Util.getCurrentUserId(),i=false,a,s;if(this.isMeeting()){if(t===parseInt(this.data.CREATED_BY)){i=this.data.MEETING_STATUS||"Q"}else if(t===parseInt(this.data.MEETING_HOST)){i="H"}else if(u.Type.isArray(this.data["ATTENDEE_LIST"])){for(a=0;a<this.data["ATTENDEE_LIST"].length;a++){s=this.data["ATTENDEE_LIST"][a];if(parseInt(s.id)===t){i=s.status;break}}}}else if(t===parseInt(this.data.CREATED_BY)){i=this.data.MEETING_STATUS||"H"}return n.Util.getMeetingStatusList().includes(i)?i:false}},{key:"setCurrentStatus",value:function e(t){if(this.isMeeting()&&n.Util.getMeetingStatusList().includes(t)){this.data.MEETING_STATUS=t;var i=n.Util.getCurrentUserId();if(u.Type.isArray(this.data["ATTENDEE_LIST"])){for(var a=0;a<this.data["ATTENDEE_LIST"].length;a++){if(parseInt(this.data["ATTENDEE_LIST"][a].id)===i){this.data["ATTENDEE_LIST"][a].status=t;this.attendeeList=null;break}}}}}},{key:"getReminders",value:function e(){var t=[];if(this.data&&this.data.REMIND){this.data.REMIND.forEach((function(e){switch(e.type){case"min":t.push(e.count);break;case"hour":t.push(parseInt(e.count)*60);break;case"day":t.push(parseInt(e.count)*60*24);break;case"daybefore":t.push(e);break;case"date":if(!u.Type.isDate(e.value)){e.value=n.Util.parseDate(e.value)}if(u.Type.isDate(e.value)){t.push(e)}break}}))}return t}},{key:"getLengthInDays",value:function e(){var t=new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate(),0,0,0),i=new Date(this.to.getFullYear(),this.to.getMonth(),this.to.getDate(),0,0,0);return Math.round((i.getTime()-t.getTime())/n.Util.getDayLength())+1}},{key:"getName",value:function e(){return this.name||this.defaultNewName}},{key:"getColor",value:function e(){return this.data.COLOR}},{key:"getType",value:function e(){return this.data.CAL_TYPE}},{key:"getOwnerId",value:function e(){return this.data.OWNER_ID}},{key:"delete",value:function e(t){var i=this;t=u.Type.isPlainObject(t)?t:{};var a=t.recursionMode||false;if(this.wasEverRecursive()&&!t.confirmed){return this.showConfirmDeleteDialog({entry:this})}else{BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:a}]);c.showDeleteEntryNotification(this);this.deleteParts(a);var s="deleteCalendarEntry";var r={entryId:this.id,recursionMode:t.recursionMode||false,requestUid:n.Util.registerRequestId()};c.registerDeleteTimeout({action:s,data:r,params:{entry:this,callback:function e(){BX.onCustomEvent("BX.Calendar.Entry:delete",[{entryId:i.id,recursionMode:a}])}}});this.deleteTimeout=setTimeout(c.doDelayedActions,c.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:s,data:r})}}},{key:"deleteThis",value:function e(){var t="this";if(this.isRecursive()){BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:t}]);c.showDeleteEntryNotification(this);this.deleteParts(t);var i="excludeRecursionDate";var a={entryId:this.id,recursionMode:t,excludeDate:this.data.DATE_FROM};c.registerDeleteTimeout({action:i,data:a,params:{entry:this,callback:function e(){BX.onCustomEvent("BX.Calendar.Entry:delete",[a])}}});this.deleteTimeout=setTimeout(c.doDelayedActions,c.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:i,data:a})}else if(this.hasRecurrenceId()){this["delete"]({confirmed:true,recursionMode:"this"})}}},{key:"deleteNext",value:function e(){var t="next";if(this.isRecursive()&&this.isFirstReccurentEntry()){this.deleteAll()}else{BX.onCustomEvent("BX.Calendar.Entry:beforeDelete",[{entryId:this.id,recursionMode:t}]);c.showDeleteEntryNotification(this);this.deleteParts(t);var i=n.Util.getCalendarContext();var a="changeRecurciveEntryUntil";var s={entryId:this.id,recursionMode:t,untilDate:n.Util.formatDate(this.from.getTime()-n.Util.getDayLength())};c.registerDeleteTimeout({action:a,data:s,params:{entry:this,callback:function e(){BX.onCustomEvent("BX.Calendar.Entry:delete",[s])}}});this.deleteTimeout=setTimeout(c.doDelayedActions,c.DELETE_DELAY_TIMEOUT);this.delayTimeoutMap.set(this.deleteTimeout,{action:a,data:s})}}},{key:"deleteAll",value:function e(){return this["delete"]({confirmed:true,recursionMode:"all"})}},{key:"cancelDelete",value:function e(){if(this.deleteTimeout){var t=this.delayTimeoutMap.get(this.deleteTimeout);if(t){c.unregisterDeleteTimeout(t);this.delayTimeoutMap["delete"](this.delayTimeoutMap)}clearTimeout(this.deleteTimeout);this.deleteTimeout=null}var i=n.Util.getCalendarContext();if(i){i.reload()}}},{key:"showConfirmDeleteDialog",value:function e(t){if(!this.confirmDeleteDialog){this.confirmDeleteDialog=new(window.BX||window.top.BX).Calendar.Controls.ConfirmDeleteDialog({entry:t.entry})}this.confirmDeleteDialog.show()}},{key:"save",value:function e(){}},{key:"getLocation",value:function e(){return this.data.LOCATION}},{key:"setTimezone",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(u.Type.isString(t)){this.data.TZ_FROM=t;if(u.Type.isNull(i)){this.data.TZ_TO=t}}if(u.Type.isString(i)){this.data.TZ_TO=i}}},{key:"getTimezoneFrom",value:function e(){return this.data.TZ_FROM||""}},{key:"getTimezoneTo",value:function e(){return this.data.TZ_TO||""}},{key:"setSectionId",value:function e(t){this.data.SECT_ID=this.sectionId=this.isTask()?"tasks":parseInt(t)}},{key:"setDateTimeValue",value:function e(t){var i=t.from,a=t.to;if(u.Type.isDate(i)&&u.Type.isDate(a)){this.from=this.data.dateFrom=i;this.to=this.data.dateTo=a;this.data.DT_LENGTH=Math.round((this.to.getTime()-this.from.getTime())/1e3);this.data.DURATION=this.data.DT_LENGTH;if(this.fullDay){this.data.DATE_FROM=n.Util.formatDate(this.from.getTime());this.data.DATE_TO=n.Util.formatDate(this.to.getTime())}else{this.data.DATE_FROM=n.Util.formatDateTime(this.from.getTime());this.data.DATE_TO=n.Util.formatDateTime(this.to.getTime())}}}}]);return e}();e.EntryManager=c;e.Entry=f})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar,BX.Event,BX.Calendar,BX,BX.Calendar,BX.Calendar,BX);
//# sourceMappingURL=entry.bundle.map.js