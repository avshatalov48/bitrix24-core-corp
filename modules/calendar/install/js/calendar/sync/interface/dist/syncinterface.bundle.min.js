this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};this.BX.Calendar.Sync=this.BX.Calendar.Sync||{};(function(t,e,n,a,s,i,r,l,c){"use strict";var o=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.options=t;return n}babelHelpers.createClass(e,[{key:"getContent",value:function t(){if(this.options.className){var e=c.Reflection.getClass(this.options.className);if(c.Type.isFunction(e)){var n=new e(this.options);return n.getInnerContent()}return""}}}]);return e}(BX.TileGrid.Item);function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-form-btn"></div>\n\t\t']);d=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="edit-connect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">',"</button>\n\t\t"]);u=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="disconnect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">',"</button>\n\t\t"]);p=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="connect-button" class="ui-btn ui-btn-light-border">',"</button>\n\t\t"]);h=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form class="calendar-sync-slider-form" action="">\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="server" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="user_name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="password" class="ui-ctl-element" name="password" placeholder="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t'],['\n\t\t\t<form class="calendar-sync-slider-form" action="">\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="server" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="user_name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="password" class="ui-ctl-element" name="password" placeholder=\\"','\\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t']);g=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-form"></div>\n\t\t']);v=function e(){return t};return t}var C=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"userName",null);babelHelpers.defineProperty(this,"server",null);babelHelpers.defineProperty(this,"connectionName",null);this.addButtonText=c.Loc.getMessage("CAL_UPPER_CONNECT");this.removeButtonText=c.Loc.getMessage("CAL_UPPER_DISCONNECT");this.saveButtonText=c.Loc.getMessage("CAL_UPPER_SAVE");if(e!==null){this.userName=BX.util.htmlspecialchars(e.userName);this.server=BX.util.htmlspecialchars(e.server);this.connectionName=BX.util.htmlspecialchars(e.connectionName)}}babelHelpers.createClass(t,[{key:"getWrapper",value:function t(){return c.Tag.render(v())}},{key:"getForm",value:function t(){return c.Tag.render(g(),c.Loc.getMessage("CAL_TEXT_NAME"),this.connectionName||"",c.Loc.getMessage("CAL_TEXT_SERVER_ADDRESS"),this.server||"",c.Loc.getMessage("CAL_TEXT_USER_NAME"),this.userName||"",c.Loc.getMessage("CAL_TEXT_PASSWORD"))}},{key:"getAddButton",value:function t(){return c.Tag.render(h(),this.addButtonText)}},{key:"getDisconnectButton",value:function t(){return c.Tag.render(p(),this.removeButtonText)}},{key:"getSaveButton",value:function t(){return c.Tag.render(u(),this.saveButtonText)}},{key:"getButtonWrapper",value:function t(){return c.Tag.render(d())}}]);return t}();function f(){var t=babelHelpers.taggedTemplateLiteral(['<span class="calendar-notice-mobile-banner" data-hint="','" data-hint-no-icon="Y"></span>']);f=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-qr-popup-content">\n\t\t\t\t<div class="calendar-sync-qr-popup-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-content">\n\t\t\t\t\t<img class="calendar-sync-slider-phone-img" src="/bitrix/images/calendar/sync/qr-background.svg" alt="">\n\t\t\t\t\t<div class="calendar-sync-slider-qr">\n\t\t\t\t\t\t<div class="','">','</div>\n\t\t\t\t\t\t<span class="calendar-sync-slider-logo"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-sync-slider-instruction">\n\t\t\t\t\t\t\x3c!--<div class="calendar-sync-slider-instruction-subtitle"></div>--\x3e\n\t\t\t\t\t\t<div class="calendar-sync-slider-instruction-title">'," ",'</div>\n\t\t\t\t\t\t<div class="calendar-sync-slider-instruction-notice">','</div>\n\t\t\t\t\t\t<a href="javascript:void(0);" \n\t\t\t\t\t\t\t\tonclick="BX.Helper.show(\'redirect=detail&code=\' + ',',{zIndex:3100,}); event.preventDefault();" \n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-round">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);b=function e(){return t};return t}var y=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"zIndex",3100);babelHelpers.defineProperty(this,"DOM",{});babelHelpers.defineProperty(this,"QRCODE_SIZE",186);babelHelpers.defineProperty(this,"QRCODE_COLOR_LIGHT","#ffffff");babelHelpers.defineProperty(this,"QRCODE_COLOR_DARK","#000000");babelHelpers.defineProperty(this,"QRCODE_WRAP_CLASS","calendar-sync-slider-qr-container");babelHelpers.defineProperty(this,"QRC",null);this.type=e.type;this.helpDeskCode=e.helpDeskCode||"11828176"}babelHelpers.createClass(t,[{key:"show",value:function t(){}},{key:"showInPopup",value:function t(){this.popup=new l.Popup({className:"calendar-sync-qr-popup",draggable:true,content:this.getContainer(),width:580,zIndexAbsolute:this.zIndex,cacheable:false,closeByEsc:true,closeIcon:true});this.popup.show();this.initQrCode().then(this.drawQRCode.bind(this))}},{key:"close",value:function t(){this.popup.close()}},{key:"getContainer",value:function t(){this.DOM.container=c.Tag.render(b(),this.getSliderContentInfoBlock,this.getTitle(),this.QRCODE_WRAP_CLASS,a.Util.getLoader(this.QRCODE_SIZE),c.Loc.getMessage("SYNC_MOBILE_NOTICE_HOW_TO"),this.type!=="iphone"?c.Tag.render(f(),c.Loc.getMessage("CAL_ANDROID_QR_CODE_HINT")):"",c.Loc.getMessage("SYNC_MOBILE_NOTICE"),this.getHelpdeskCode(),c.Loc.getMessage("SYNC_MOBILE_ABOUT_BTN"));this.DOM.mobileHintIcon=this.DOM.container.querySelector(".calendar-notice-mobile-banner");if(this.DOM.mobileHintIcon&&BX.UI.Hint){BX.UI.Hint.initNode(this.DOM.mobileHintIcon)}return this.DOM.container}},{key:"getInnerContainer",value:function t(){return this.DOM.container.querySelector("."+this.QRCODE_WRAP_CLASS)}},{key:"initQrCode",value:function t(){return new Promise(function(t){c.Runtime.loadExtension(["main.qrcode"]).then(function(e){if(e&&e.QRCode){t()}})})}},{key:"drawQRCode",value:function t(e){var n=this;if(!c.Type.isDomNode(e)){e=this.getInnerContainer()}this.getMobileSyncUrl().then(function(t){c.Dom.clean(e);n.QRC=new QRCode(e,{text:t,width:n.getSize(),height:n.getSize(),colorDark:n.QRCODE_COLOR_DARK,colorLight:n.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H})})}},{key:"getTitle",value:function t(){return c.Loc.getMessage("SYNC_BANNER_MOBILE_TITLE")}},{key:"getMobileSyncUrl",value:function t(){var e=this;return new Promise(function(t,n){BX.ajax.runAction("calendar.api.calendarajax.getAuthLink",{data:{type:e.type?"slider":"banner"}}).then(function(e){t(e.data.link)},n)})}},{key:"getSize",value:function t(){return this.QRCODE_SIZE}},{key:"getDetailHelpUrl",value:function t(){return"https://helpdesk.bitrix24.ru/open/"+this.getHelpdeskCode()}},{key:"getHelpdeskCode",value:function t(){return this.helpDeskCode}}]);return t}();function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-status-subtitle">\n\t\t\t\t\t<span data-hint=""></span>\n\t\t\t\t\t<span class="calendar-sync-status-text">',":</span>\n\t\t\t\t</div>"]);T=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-status-block" id="calendar-sync-status-block">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);L=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-primary calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);_=function e(){return t};return t}function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-danger calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);A=function e(){return t};return t}function E(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-success calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);E=function e(){return t};return t}var m=function(){function t(e){babelHelpers.classCallCheck(this,t);this.status=e.status;this.connections=e.connections;this.withStatusLabel=e.withStatusLabel;this.popupWithUpdateButton=e.popupWithUpdateButton;this.popupId=e.popupId}babelHelpers.createClass(t,[{key:"setStatus",value:function t(e){this.status=e;return this}},{key:"setConnections",value:function t(e){this.connections=e;return this}},{key:"getContent",value:function t(){var e=this;var n;if(this.status==="success"){n=c.Tag.render(E(),c.Loc.getMessage("SYNC_STATUS_SUCCESS"))}else if(this.status==="failed"){n=c.Tag.render(A(),c.Loc.getMessage("SYNC_STATUS_ALERT"))}else{n=c.Tag.render(_(),c.Loc.getMessage("SYNC_STATUS_NOT_CONNECTED"))}n.addEventListener("mouseenter",function(){e.handlerMouseEnter(n)});n.addEventListener("mouseleave",function(){e.handlerMouseLeave()});this.statusBlock=c.Tag.render(L(),this.getStatusTextLabel(),n);return this.statusBlock}},{key:"getStatusTextLabel",value:function t(){return this.withStatusLabel?c.Tag.render(T(),c.Loc.getMessage("LABEL_STATUS_INFO")):""}},{key:"handlerMouseEnter",value:function t(e){var n=this;clearTimeout(this.statusBlockEnterTimeout);this.buttonEnterTimeout=setTimeout(function(){n.statusBlockEnterTimeout=null;n.showPopup(e)},500)}},{key:"handlerMouseLeave",value:function t(){var e=this;if(this.statusBlockEnterTimeout!==null){clearTimeout(this.statusBlockEnterTimeout);this.statusBlockEnterTimeout=null;return}this.statusBlockLeaveTimeout=setTimeout(function(){e.hidePopup()},500)}},{key:"showPopup",value:function t(e){if(this.status!=="not_connected"){this.popup=this.getPopup(e);this.popup.show();this.addPopupHandlers()}}},{key:"hidePopup",value:function t(){if(this.popup){this.popup.hide()}}},{key:"addPopupHandlers",value:function t(){var e=this;this.popup.getPopup().getPopupContainer().addEventListener("mouseenter",function(){clearTimeout(e.statusBlockEnterTimeout);clearTimeout(e.statusBlockLeaveTimeout)});this.popup.getPopup().getPopupContainer().addEventListener("mouseleave",function(){e.hidePopup()})}},{key:"getPopup",value:function t(e){return s.SyncStatusPopup.createInstance({connections:this.connections,withUpdateButton:this.popupWithUpdateButton,node:e,id:this.popupId})}},{key:"refresh",value:function t(e,n){this.status=e;this.connections=n;return this}}],[{key:"createInstance",value:function t(e){return new this(e)}}]);return t}();function I(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);I=function e(){return t};return t}function H(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);H=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);k=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-header">\n\t\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);N=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);S=function e(){return t};return t}function B(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-header">\n\t\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);B=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap calendar-sync-wrap-detail">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}function O(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap calendar-sync-wrap-detail">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);O=function e(){return t};return t}var M=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"sliderWidth",840);n.setEventNamespace("BX.Calendar.Sync.Interface.InterfaceTemplate");n.title=t.title;n.helpdeskCode=t.helpDeskCode;n.titleInfoHeader=t.titleInfoHeader;n.descriptionInfoHeader=t.descriptionInfoHeader;n.titleActiveHeader=t.titleActiveHeader;n.descriptionActiveHeader=t.descriptionActiveHeader;n.sliderIconClass=t.sliderIconClass;n.iconPath=t.iconPath;n.color=t.color;n.provider=t.provider;n.connection=t.connection;n.popupWithUpdateButton=t.popupWithUpdateButton;return n}babelHelpers.createClass(e,[{key:"getInfoConnectionContent",value:function t(){return c.Tag.render(O(),this.getContentInfoHeader(),this.getContentInfoBody())}},{key:"getActiveConnectionContent",value:function t(){return c.Tag.render(D(),this.getContentActiveHeader(),this.getContentActiveBody())}},{key:"getContentInfoHeader",value:function t(){this.statusBlock=m.createInstance({status:"not_connected",connections:[this.connection],withStatusLabel:false,popupWithUpdateButton:this.popupWithUpdateButton,popupId:"calendar-interfaceTemplate-status"});return c.Tag.render(B(),this.getHeaderTitle(),this.statusBlock.getContent())}},{key:"getContentInfoBody",value:function t(){return c.Tag.render(S(),this.getContentInfoBodyHeader())}},{key:"getContentActiveHeader",value:function t(){this.statusBlock=m.createInstance({status:this.connection.getStatus(),connections:[this.connection],withStatusLabel:false,popupWithUpdateButton:this.popupWithUpdateButton,popupId:"calendar-interfaceTemplate-status"});return c.Tag.render(N(),this.getHeaderTitle(),this.statusBlock.getContent())}},{key:"getContentActiveBody",value:function t(){return c.Tag.render(k(),this.getContentActiveBodyHeader())}},{key:"showHelp",value:function t(){if(BX.Helper){BX.Helper.show("redirect=detail&code="+this.helpdeskCode);event.preventDefault()}}},{key:"getHelpdeskLink",value:function t(){return"https://helpdesk.bitrix24.ru/open/"+this.helpdeskCode}},{key:"getHeaderTitle",value:function t(){return this.title}},{key:"getContentInfoBodyHeader",value:function t(){return c.Tag.render(H(),this.sliderIconClass,this.titleInfoHeader,this.descriptionInfoHeader,this.showHelp.bind(this),c.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"getContentActiveBodyHeader",value:function t(){return c.Tag.render(I(),this.sliderIconClass,this.titleActiveHeader,this.descriptionActiveHeader,this.showHelp.bind(this),c.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"setProvider",value:function t(e){this.provider=e}},{key:"sendRequestRemoveConnection",value:function t(e){BX.ajax.runAction("calendar.api.calendarajax.removeConnection",{data:{connectionId:e}}).then(function(){BX.reload()})}},{key:"runUpdateInfo",value:function t(){var e=this;c.ajax.runAction("calendar.api.calendarajax.setSectionStatus",{data:{sectionStatus:this.sectionStatusObject}}).then(function(t){e.emit("reDrawCalendarGrid",{})})}},{key:"refresh",value:function t(e){this.connection=e;this.statusBlock.setStatus(this.connection.getStatus()).setConnections([this.connection]);c.Dom.replace(document.getElementById("status-info-block"),this.statusBlock.getContent())}}],[{key:"createInstance",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new this(e,n)}}]);return e}(e.EventEmitter);babelHelpers.defineProperty(M,"SLIDER_WIDTH",606);babelHelpers.defineProperty(M,"SLIDER_PREFIX","calendar:connection-sync-");function R(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);R=function e(){return t};return t}function P(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);P=function e(){return t};return t}var x=function(t){babelHelpers.inherits(e,t);function e(t){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t))}babelHelpers.createClass(e,[{key:"getContentInfoBody",value:function t(){var e=this;var n=new C;var a=n.getWrapper();var s=n.getForm();var i=n.getAddButton();var r=n.getButtonWrapper();var l=this.getContentInfoBodyHeader();i.addEventListener("click",function(t){BX.ajax.runAction("calendar.api.calendarajax.analytical",{analyticsLabel:{click_to_connection_button:"Y",connection_type:e.provider.getType()}});c.Dom.addClass(i,["ui-btn-clock","ui-btn-disabled"]);t.preventDefault();e.sendRequestAddConnection(s)});c.Dom.append(i,r);c.Dom.append(r,s);c.Dom.append(s,a);return c.Tag.render(P(),l,a)}},{key:"getContentActiveBody",value:function t(){var e=this;var n=new C({server:this.connection.addParams.server,userName:this.connection.addParams.userName,connectionName:this.connection.connectionName});var a=n.getWrapper();var s=n.getForm();var i=n.getDisconnectButton();var r=n.getButtonWrapper();var l=this.getContentActiveBodyHeader();i.addEventListener("click",function(t){c.Dom.addClass(i,["ui-btn-clock","ui-btn-disabled"]);t.preventDefault();e.sendRequestRemoveConnection(e.connection.getId())});c.Dom.append(i,r);c.Dom.append(r,s);c.Dom.append(s,a);return c.Tag.render(R(),l,a)}},{key:"sendRequestEditConnection",value:function t(e,n){BX.ajax.runAction("calendar.api.calendarajax.editConnection",{data:{form:new FormData(e),connectionId:n.connectionId}}).then(function(){BX.reload()})}},{key:"sendRequestAddConnection",value:function t(e){var n=this;var a=new FormData(e);BX.ajax.runAction("calendar.api.calendarajax.addConnection",{data:{name:a.get("name"),server:a.get("server"),userName:a.get("user_name"),pass:a.get("password")}}).then(function(t){BX.reload()},function(t){var a=e.querySelector("#connect-button");n.showAlertPopup(t.errors[0],a)})}},{key:"showAlertPopup",value:function t(e,n){var a="";if(e.code==="incorrect_parameters"){a=c.Loc.getMessage("CAL_TEXT_ALERT_INCORRECT_PARAMETERS")}else if(e.code==="tech_problem"){a=c.Loc.getMessage("CAL_TEXT_ALERT_TECH_PROBLEM")}else{a=c.Loc.getMessage("CAL_TEXT_ALERT_DEFAULT")}var s=new BX.UI.Dialogs.MessageBox({message:a,title:e.message,buttons:BX.UI.Dialogs.MessageBoxButtons.OK,okCaption:c.Loc.getMessage("CAL_TEXT_BUTTON_RETURN_TO_SETTINGS"),minWidth:358,mediumButtonSize:false,popupOptions:{zIndex:3021,height:166,width:358,className:"calendar-alert-popup-connection"},onOk:function t(){c.Dom.removeClass(n,["ui-btn-clock","ui-btn-disabled"]);return true}});s.show()}}]);return e}(M);var w=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_CALDAV"),helpDeskCode:"5697365",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_CALDAV_CALENDAR"),descriptionInfoHeader:c.Loc.getMessage("CAL_CALDAV_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_CALDAV_CALENDAR_IS_CONNECT"),descriptionActiveHeader:c.Loc.getMessage("CAL_CALDAV_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-caldav",iconPath:"/bitrix/images/calendar/sync/caldav.svg",color:"#1eae43",provider:t,connection:n,popupWithUpdateButton:true}))}return e}(x);var X=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_EXCHANGE"),helpDeskCode:"11864622",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_EXCHANGE_CALENDAR_TITLE"),descriptionInfoHeader:c.Loc.getMessage("CAL_EXCHANGE_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_SYNC_CONNECTED_EXCHANGE_TITLE"),descriptionActiveHeader:c.Loc.getMessage("CAL_EXCHANGE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-office",iconPath:"/bitrix/images/calendar/sync/exchange.svg",color:"#54d0df",provider:t,connection:n,popupWithUpdateButton:true}))}return e}(M);function U(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<li class="calendar-sync-slider-item">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" value="','" onclick="','" ','>\n\t\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t\t</label>\n\t\t\t\t</li>\n\t\t\t"]);U=function e(){return t};return t}function W(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-col">\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t\t<div class="calendar-sync-slider-subtitle">','</div>\n\t\t\t\t</div>\n\t\t\t\t<ul class="calendar-sync-slider-list">\n\t\t\t\t\t',"\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t"]);W=function e(){return t};return t}function G(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon calendar-sync-slider-header-icon-google"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t\t<div class="calendar-sync-slider-title">','</div>\n\t\t\t\t\t<span class="calendar-sync-slider-account">\n\t\t\t\t\t\t<span class="calendar-sync-slider-account-avatar"></span>\n\t\t\t\t\t\t<span class="calendar-sync-slider-account-email">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"]);G=function e(){return t};return t}function Y(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);Y=function e(){return t};return t}function j(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);j=function e(){return t};return t}var Q=function(t){babelHelpers.inherits(e,t);function e(t){var n;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_GOOGLE"),helpDeskCode:"6030429",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_GOOGLE_CALENDAR"),descriptionInfoHeader:c.Loc.getMessage("CAL_GOOGLE_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_GOOGLE_CALENDAR_IS_CONNECT"),descriptionActiveHeader:c.Loc.getMessage("CAL_GOOGLE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-google",iconPath:"/bitrix/images/calendar/sync/google.svg",color:"#387ced",provider:t,connection:a,popupWithUpdateButton:true}));n.sectionStatusObject={};return n}babelHelpers.createClass(e,[{key:"createConnection",value:function t(){BX.ajax.runAction("calendar.api.calendarajax.analytical",{analyticsLabel:{click_to_connection_button:"Y",connection_type:"google"}});BX.util.popup(this.provider.getSyncLink(),500,600)}},{key:"getContentInfoBody",value:function t(){var e=this;var n=new C;var a=n.getAddButton();var s=n.getButtonWrapper();var i=this.getContentInfoBodyHeader();var r=i.querySelector(".calendar-sync-slider-header");if(this.provider.hasSetSyncCaldavSettings()){a.addEventListener("click",function(){e.createConnection()})}else{a.addEventListener("click",function(){e.showAlertPopup()})}c.Dom.append(a,s);c.Dom.append(s,r);return c.Tag.render(j(),i)}},{key:"getContentActiveBody",value:function t(){return c.Tag.render(Y(),this.getContentActiveBodyHeader(),this.getContentActiveBodySectionsManager())}},{key:"getContentActiveBodyHeader",value:function t(){var e=this;var n=new C;var a=n.getDisconnectButton();a.addEventListener("click",function(t){t.preventDefault();e.sendRequestRemoveConnection(e.connection.getId())});return c.Tag.render(G(),c.Loc.getMessage("CAL_GOOGLE_CALENDAR_IS_CONNECT"),BX.util.htmlspecialchars(this.connection.getConnectionName()),this.showHelp.bind(this),c.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"),a)}},{key:"getContentActiveBodySectionsManager",value:function t(){return c.Tag.render(W(),c.Loc.getMessage("CAL_AVAILABLE_CALENDAR"),this.getContentActiveBodySections(this.connection.getId()))}},{key:"getContentActiveBodySections",value:function t(e){var n=this;var a=[];this.provider.getConnection().getSections().forEach(function(t){a.push(c.Tag.render(U(),BX.util.htmlspecialchars(t["ID"]),n.onClickCheckSection.bind(n),t["ACTIVE"]==="Y"?"checked":"",BX.util.htmlspecialchars(t["NAME"])))});return a}},{key:"onClickCheckSection",value:function t(e){this.sectionStatusObject[e.target.value]=e.target.checked;this.runUpdateInfo()}},{key:"showAlertPopup",value:function t(){var e=new n.MessageBox({className:this.id,message:c.Loc.getMessage("GOOGLE_IS_NOT_CALDAV_SETTINGS_WARNING_MESSAGE"),width:500,offsetLeft:60,offsetTop:5,padding:7,onOk:function t(){e.close()},okCaption:"OK",buttons:BX.UI.Dialogs.MessageBoxButtons.OK,popupOptions:{zIndexAbsolute:4020,autoHide:true}});e.show()}}]);return e}(M);function q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-col">\n\t\t\t\t<div class="calendar-sync-slider-header calendar-sync-slider-header-divide">\n\t\t\t\t\t<div class="calendar-sync-slider-subtitle">','</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">',':</span>\n\t\t\t\t\t<ol class="calendar-sync-slider-info-list">\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ol>\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);q=function e(){return t};return t}function V(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);V=function e(){return t};return t}function z(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);z=function e(){return t};return t}var F=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:c.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:c.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:t,connection:n,popupWithUpdateButton:false}))}babelHelpers.createClass(e,[{key:"getPortalAddress",value:function t(){return this.portalAddress}},{key:"getContentInfoBody",value:function t(){return c.Tag.render(z(),this.getContentInfoBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBody",value:function t(){return c.Tag.render(V(),this.getContentActiveBodyHeader(),this.getContentBodyConnect())}},{key:"getContentBodyConnect",value:function t(){return c.Tag.render(q(),c.Loc.getMessage("CAL_MAC_INSTRUCTION_HEADER"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_DESCRIPTION"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIRST"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SECOND"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_THIRD"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FOURTH"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIFTH").replace(/#PORTAL_ADDRESS#/gi,this.provider.getPortalAddress()),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SIXTH"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SEVENTH"),c.Loc.getMessage("CAL_MAC_INSTRUCTION_CONCLUSION"))}}]);return e}(M);var K=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:c.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:c.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:t,connection:n,popupWithUpdateButton:false}))}return e}(M);var J=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_YANDEX"),helpDeskCode:"10930170",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_YANDEX_CALENDAR"),descriptionInfoHeader:c.Loc.getMessage("CAL_YANDEX_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_YANDEX_CALENDAR_IS_CONNECT"),descriptionActiveHeader:c.Loc.getMessage("CAL_YANDEX_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-yandex",iconPath:"/bitrix/images/calendar/sync/yandex.svg",color:"#f9c500",provider:t,connection:n,popupWithUpdateButton:true}))}return e}(x);function Z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">','</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t<span class="calendar-sync-slider-info-time">','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-desc">','</div>\n\t\t\t\t\t<a class="calendar-sync-slider-link" href="javascript:void(0);" onclick="','">',"</a>\n\t\t\t\t</div>\n\t\t\t</div>"]);Z=function e(){return t};return t}function $(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-banner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);$=function e(){return t};return t}function tt(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-banner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);tt=function e(){return t};return t}var et=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.banner=new y({type:n.provider.getType(),helpDeskCode:t.helpDeskCode});if(n.status){n.syncDate=c.Type.isDate(n.data.syncDate)?n.data.syncDate:a.Util.parseDate(n.data.syncDate)}return n}babelHelpers.createClass(e,[{key:"getContentInfoBody",value:function t(){return c.Tag.render(tt(),this.getContentInfoBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBody",value:function t(){return c.Tag.render($(),this.getContentActiveBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBodyHeader",value:function t(){return c.Tag.render(Z(),this.sliderIconClass,this.titleActiveHeader,c.Loc.getMessage("CAL_SYNC_LAST_SYNC_DATE"),a.Util.formatDateUsable(this.connection.getSyncTimestamp())+" "+BX.date.format(a.Util.getTimeFormatShort(),this.connection.getSyncTimestamp()),c.Loc.getMessage("CAL_SYNC_DISABLE"),this.showHelp.bind(this),c.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"getContentBodyConnect",value:function t(){this.banner.initQrCode().then(this.banner.drawQRCode.bind(this.banner));return this.banner.getContainer()}}]);return e}(M);var nt=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_ANDROID"),helpDeskCode:"5686179",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_ANDROID_CALENDAR_TITLE"),descriptionInfoHeader:c.Loc.getMessage("CAL_ANDROID_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_SYNC_CONNECTED_ANDROID_TITLE"),descriptionActiveHeader:c.Loc.getMessage("CAL_ANDROID_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-android",iconPath:"/bitrix/images/calendar/sync/android.svg",color:"#9ece03",provider:t,connection:n,popupWithUpdateButton:false}))}return e}(et);var at=function(t){babelHelpers.inherits(e,t);function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{title:c.Loc.getMessage("CALENDAR_TITLE_IPHONE"),helpDeskCode:"5686207",titleInfoHeader:c.Loc.getMessage("CAL_CONNECT_IPHONE_CALENDAR_TITLE"),descriptionInfoHeader:c.Loc.getMessage("CAL_IPHONE_CONNECT_DESCRIPTION"),titleActiveHeader:c.Loc.getMessage("CAL_SYNC_CONNECTED_IPHONE_TITLE"),descriptionActiveHeader:c.Loc.getMessage("CAL_IPHONE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-iphone",iconPath:"/bitrix/images/calendar/sync/iphone.svg",color:"#2fc6f6",provider:t,connection:n,popupWithUpdateButton:false}))}return e}(et);function st(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-title">',"</div>\n\t\t"]);st=function e(){return t};return t}function it(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-title">',"</div>\n\t\t\t"]);it=function e(){return t};return t}function rt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="calendar-sync-web" class="calendar-sync-web"></div>\n\t\t\t']);rt=function e(){return t};return t}function lt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="calendar-sync-mobile" class="calendar-sync-mobile"></div>\n\t\t']);lt=function e(){return t};return t}function ct(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t\t"]);ct=function e(){return t};return t}function ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-header">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);ot=function e(){return t};return t}function dt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);dt=function e(){return t};return t}var ut=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"MAIN_SYNC_SLIDER_NAME","calendar:sync-slider");babelHelpers.defineProperty(this,"SLIDER_WIDTH",684);babelHelpers.defineProperty(this,"LOADER_NAME","calendar:loader");babelHelpers.defineProperty(this,"cache",new c.Cache.MemoryCache);this.status=e.status;this.connectionsProviders=e.connectionsProviders;this.userId=e.userId;this.statusBlockEnterTimeout=null;this.statusBlockLeaveTimeout=null}babelHelpers.createClass(t,[{key:"openSlider",value:function t(){var e=this;BX.SidePanel.Instance.open(this.MAIN_SYNC_SLIDER_NAME,{contentCallback:function t(n){return new Promise(function(t,n){t(e.getContent())})},allowChangeHistory:false,events:{onLoad:function t(){e.setGridContent()}},cacheable:false,width:this.SLIDER_WIDTH,loader:this.LOADER_NAME})}},{key:"getContent",value:function t(){return c.Tag.render(dt(),this.getHeader(),this.getMobileHeader(),this.getMobileContentWrapper(),this.getWebHeader(),this.getWebContentWrapper())}},{key:"getHeader",value:function t(){return c.Tag.render(ot(),this.getMainHeader(),this.getStatusBlockContent(this.getConnections()))}},{key:"getMainHeader",value:function t(){return this.cache.remember("calendar-syncPanel-mainHeader",function(){return c.Tag.render(ct(),c.Loc.getMessage("SYNC_CALENDAR_HEADER"))})}},{key:"getMobileContentWrapper",value:function t(){return this.cache.remember("calendar-syncPanel-mobileContentWrapper",function(){return c.Tag.render(lt())})}},{key:"getWebContentWrapper",value:function t(){return this.cache.remember("calendar-syncPanel-webContentWrapper",function(){return c.Tag.render(rt())})}},{key:"getMobileHeader",value:function t(){return this.cache.remember("calendar-syncPanel-mobileHeader",function(){return c.Tag.render(it(),c.Loc.getMessage("SYNC_MOBILE_HEADER"))})}},{key:"getWebHeader",value:function t(){return this.cache.remember("calendar-syncPanel-webHeader",function(){return c.Tag.render(st(),c.Loc.getMessage("SYNC_WEB_HEADER"))})}},{key:"getStatusBlockContent",value:function t(e){this.statusBlock=m.createInstance({status:this.status,connections:e,withStatusLabel:true,popupWithUpdateButton:true,popupId:"calendar-syncPanel-status"});this.statusBlockContent=this.statusBlock.getContent();return this.statusBlockContent}},{key:"getConnections",value:function t(){var e=[];var n=Object.values(this.connectionsProviders);n.forEach(function(t){var n=t.getConnections();if(n.length>0){n.forEach(function(t){if(s.ConnectionItem.isConnectionItem(t)&&t.getConnectStatus()===true){e.push(t)}})}});return e}},{key:"setGridContent",value:function t(){var e=Object.values(this.connectionsProviders);var n=e.filter(function(t){return t.getViewClassification()==="mobile"});var a=e.filter(function(t){return t.getViewClassification()==="web"});this.showWebGridContent(a);this.showMobileGridContent(n)}},{key:"showWebGridContent",value:function t(e){var n=this.getWebContentWrapper();c.Dom.clean(n);var a=new BX.TileGrid.Grid({id:"calendar_sync",items:e,container:n,sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit",userId:this.userId});a.draw()}},{key:"showMobileGridContent",value:function t(e){var n=this.getMobileContentWrapper();c.Dom.clean(n);var a=new BX.TileGrid.Grid({id:"calendar_sync",items:e,container:n,sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit"});a.draw()}},{key:"refresh",value:function t(e,n){this.status=e;this.connectionsProviders=n;this.blockStatusContent=this.statusBlock.refresh(e,this.getConnections()).getContent();c.Dom.replace(document.querySelector("#calendar-sync-status-block"),this.blockStatusContent);this.setGridContent()}}]);return t}();function pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-item-status"></div>\n\t\t\t']);pt=function e(){return t};return t}function ht(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-item-image">\n\t\t\t\t<div class="calendar-sync-item-image-item" style="background-image: ','"></div>\n\t\t\t</div>']);ht=function e(){return t};return t}function gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-item-title">',"</div>"]);gt=function e(){return t};return t}function vt(){var t=babelHelpers.taggedTemplateLiteral(['<div class="calendar-sync-item ','" style="','">\n\t\t\t<div class="calendar-item-content">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"]);vt=function e(){return t};return t}var Ct=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,{id:t.type}));n.item=t;return n}babelHelpers.createClass(e,[{key:"getContent",value:function t(){this.gridUnit=c.Tag.render(vt(),this.getAdditionalContentClass(),this.getContentStyles(),this.getImage(),this.getTitle(),this.isActive()?this.getStatus():"");this.gridUnit.addEventListener("click",this.onClick.bind(this));return this.gridUnit}},{key:"getTitle",value:function t(){if(!this.layout.title){this.layout.title=c.Tag.render(gt(),BX.util.htmlspecialchars(this.item.getGridTitle()))}return this.layout.title}},{key:"getImage",value:function t(){return c.Tag.render(ht(),"url("+this.item.getGridIcon()+")")}},{key:"getStatus",value:function t(){if(this.isActive()){return c.Tag.render(pt())}return""}},{key:"isActive",value:function t(){return this.item.getConnectStatus()}},{key:"getAdditionalContentClass",value:function t(){if(this.isActive()){if(this.item.getSyncStatus()){return"calendar-sync-item-selected"}else{return"calendar-sync-item-failed"}}else{return""}}},{key:"getContentStyles",value:function t(){if(this.isActive()){return"background-color:"+this.item.getGridColor()+";"}else{return""}}},{key:"onClick",value:function t(){BX.ajax.runAction("calendar.api.calendarajax.analytical",{analyticsLabel:{open_connection_slider:"Y",sync_connection_type:this.item.getType(),sync_connection_status:this.item.getSyncStatus()?"Y":"N"}});if(this.item.hasMenu()){this.item.showMenu(this.gridUnit)}else if(this.item.getConnectStatus()){this.item.openActiveConnectionSlider(this.item.getConnection())}else{this.item.openInfoConnectionSlider()}}}]);return e}(BX.TileGrid.Item);function ft(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-ical-popup-link-block">\n\t\t\t\t\t<a class="ui-link ui-link-primary " target="_blank" href="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t"]);ft=function e(){return t};return t}function bt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-ical-popup-wrapper">\n\t\t\t\t<h3>','</h3>\n\t\t\t\t<div class="calendar-ical-popup-label-text"><span>',"</span></div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);bt=function e(){return t};return t}var yt=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"LINK_LENGTH",112);this.link=this.getIcalLink(e)}babelHelpers.createClass(t,[{key:"show",value:function t(){this.createPopup().show();this.startSync()}},{key:"startSync",value:function t(){var e=this;BX.ajax.get(this.link+"&check=Y","",function(t){setTimeout(function(){if(!t||t.length<=0||t.toUpperCase().indexOf("BEGIN:VCALENDAR")===-1){e.showPopupWithSyncDataError()}},300)})}},{key:"getContent",value:function t(){return c.Tag.render(bt(),c.Loc.getMessage("EC_JS_EXPORT_TILE"),c.Loc.getMessage("EC_EXP_TEXT"),this.getLinkBlock())}},{key:"createPopup",value:function t(){var e=this;return this.popup=new l.Popup({width:400,zIndexOptions:4e3,autoHide:false,closeByEsc:true,draggable:true,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",content:this.getContent(),buttons:[new BX.UI.Button({text:c.Loc.getMessage("EC_JS_ICAL_COPY_ICAL_SYNC_LINK"),color:BX.UI.Button.Color.PRIMARY,onclick:function t(){e.copyLink(event)}}),new BX.UI.Button({text:c.Loc.getMessage("EC_SEC_SLIDER_CLOSE"),color:BX.UI.Button.Color.LINK,onclick:function t(){e.popup.close()}})]})}},{key:"getIcalLink",value:function t(e){return e.calendarPath+(e.calendarPath.indexOf("?")>=0?"&":"?")+"action=export"+e.sectionLink}},{key:"getLinkBlock",value:function t(){return c.Tag.render(ft(),BX.util.htmlspecialchars(this.link),BX.util.htmlspecialchars(this.getShortenLink(this.link)))}},{key:"showPopupWithSyncDataError",value:function t(){BX.UI.Dialogs.MessageBox.alert(c.Loc.getMessage("EC_EDEV_EXP_WARN"))}},{key:"copyLink",value:function t(e){window.BX.clipboard.copy(this.link);e.preventDefault();e.stopPropagation()}},{key:"getShortenLink",value:function t(e){return e.length<this.LINK_LENGTH?e:e.substr(0,105)+"..."+e.slice(-7)}}],[{key:"createInstance",value:function t(e){return new this(e)}},{key:"checkPathes",value:function t(e){return!!e.sectionLink||!!e.calendarPath}},{key:"showPopupWithPathesError",value:function t(){BX.UI.Dialogs.MessageBox.alert(c.Loc.getMessage("EC_JS_ICAL_ERROR_WITH_PATHES"))}}]);return t}();t.SyncPanelItem=o;t.ConnectionControls=C;t.MobileSyncBanner=y;t.SyncPanel=ut;t.GridUnit=Ct;t.YandexTemplate=J;t.CaldavTemplate=w;t.MacTemplate=F;t.ExchangeTemplate=X;t.GoogleTemplate=Q;t.OutlookTemplate=K;t.IphoneTemplate=at;t.AndroidTemplate=nt;t.IcalSyncPopup=yt})(this.BX.Calendar.Sync.Interface=this.BX.Calendar.Sync.Interface||{},BX.Event,BX.UI.Dialogs,BX.Calendar,BX.Calendar.Sync.Manager,BX,BX,BX.Main,BX);
//# sourceMappingURL=syncinterface.bundle.map.js