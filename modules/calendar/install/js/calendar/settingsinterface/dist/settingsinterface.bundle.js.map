{"version":3,"file":"settingsinterface.bundle.js","sources":["../src/settingsinterface.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport {EmailSelectorControl} from 'calendar.controls';\nimport { Type, Event, Loc, Tag, Dom, Text, Runtime } from 'main.core';\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\n\ntype SettingsInterfaceOptions = {\n\tname: string;\n\tcalendarContext: any,\n\tshowPersonalSettings: boolean,\n\tshowGeneralSettings: boolean,\n\tshowAccessControl: boolean,\n\tsettings: any\n};\n\nexport class SettingsInterface\n{\n\tsliderId: string = \"calendar:settings-slider\";\n\tname: string = 'SettingsInterface';\n\tSLIDER_WIDTH: number = 500;\n\tSLIDER_DURATION: number = 80;\n\tDOM: any = {};\n\n\tconstructor(options: SettingsInterfaceOptions)\n\t{\n\t\tthis.calendarContext = options.calendarContext;\n\t\tthis.showPersonalSettings = options.showPersonalSettings;\n\t\tthis.showGeneralSettings = options.showGeneralSettings;\n\t\tthis.showAccessControl = options.showAccessControl !== false\n\t\t\t&& Type.isObjectLike(this.calendarContext.util.config.TYPE_ACCESS);\n\n\t\tthis.settings = options.settings;\n\t\tthis.BX = Util.getBX();\n\t}\n\n\tshow()\n\t{\n\t\tthis.BX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: this.createContent.bind(this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION,\n\t\t\tevents: {\n\t\t\t\tonCloseByEsc: this.escHide.bind(this),\n\t\t\t\tonClose: this.hide.bind(this),\n\t\t\t\tonCloseComplete: this.destroy.bind(this),\n\t\t\t\tonLoad: this.onLoadSlider.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\n\tescHide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId && this.denyClose)\n\t\t{\n\t\t\tevent.denyAction();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.isOpenedState = false;\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisOpened()\n\t{\n\t\treturn this.isOpenedState;\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\tif (this.denyClose)\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", BX.proxy(this.hide, this));\n\t\t\t}\n\t\t}\n\t}\n\n\tdenySliderClose()\n\t{\n\t\tthis.denyClose = true;\n\t}\n\n\tallowSliderClose()\n\t{\n\t\tthis.denyClose = false;\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// this.destroyEventEmitterSubscriptions();\n\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:delete', this.deleteSectionHandlerBinded);\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:pull-delete', this.deleteSectionHandlerBinded);\n\n\t\t\t// BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", BX.proxy(this.destroy, this));\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t\tdelete this.DOM.sectionListWrap;\n\t\t}\n\t}\n\n\tcreateContent(slider: BX.Intranet.Bitrix24.Slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\ttop.BX.ajax.runAction('calendar.api.calendarajax.getSettingsSlider', {\n\t\t\t\tdata: {\n\t\t\t\t\tshowPersonalSettings: this.showPersonalSettings ? 'Y' : 'N',\n\t\t\t\t\tshowGeneralSettings: this.showGeneralSettings ? 'Y' : 'N',\n\t\t\t\t\tshowAccessControl: this.showAccessControl ? 'Y' : 'N',\n\t\t\t\t\tuid: this.uid\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response: any) => {\n\t\t\t\t\tslider.getData().set(\"sliderContent\", response.data.html);\n\t\t\t\t\tconst params = response.data.additionalParams;\n\n\t\t\t\t\tthis.mailboxList = params.mailboxList;\n\t\t\t\t\tthis.uid = params.uid;\n\n\t\t\t\t\tresolve(response.data.html);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tonLoadSlider(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tthis.DOM.content = slider.layout.content;\n\t\tthis.sliderId = slider.getUrl();\n\n\t\t// Used to execute javasctipt and attach CSS from ajax responce\n\t\tBX.html(slider.layout.content, slider.getData().get(\"sliderContent\"));\n\t\tthis.initControls();\n\t\tthis.setControlsValue();\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.buttonsWrap = this.DOM.content.querySelector('.calendar-form-buttons-fixed');\n\t\tBX.ZIndexManager.register(this.DOM.buttonsWrap);\n\n\t\tthis.DOM.saveBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"save_btn\"]');\n\t\tthis.DOM.closeBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"close_btn\"]');\n\n\t\tBX.Event.bind(this.DOM.saveBtn, 'click', this.save.bind(this));\n\t\tBX.Event.bind(this.DOM.closeBtn, 'click', this.close.bind(this));\n\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation = this.DOM.content.querySelector('[data-role=\"deny_busy_invitation\"]');\n\t\t\tthis.DOM.showWeekNumbers = this.DOM.content.querySelector('[data-role=\"show_week_numbers\"]');\n\n\t\t\tthis.DOM.meetSectionSelect = this.DOM.content.querySelector('[data-role=\"meet_section\"]');\n\t\t\tthis.DOM.crmSelect = this.DOM.content.querySelector('[data-role=\"crm_section\"]');\n\t\t\tthis.DOM.showDeclined = this.DOM.content.querySelector('[data-role=\"show_declined\"]');\n\t\t\tthis.DOM.showTasks = this.DOM.content.querySelector('[data-role=\"show_tasks\"]');\n\t\t\tthis.DOM.syncTasks = this.DOM.content.querySelector('[data-role=\"sync_tasks\"]');\n\t\t\tthis.DOM.showCompletedTasks = this.DOM.content.querySelector('[data-role=\"show_completed_tasks\"]');\n\t\t\tthis.DOM.timezoneSelect = this.DOM.content.querySelector('[data-role=\"set_tz_sel\"]');\n\t\t\tthis.DOM.syncPeriodPast = this.DOM.content.querySelector('[data-role=\"sync_period_past\"]');\n\t\t\tthis.DOM.syncPeriodFuture = this.DOM.content.querySelector('[data-role=\"sync_period_future\"]');\n\t\t\tthis.DOM.sendFromEmailSelect = this.DOM.content.querySelector('[data-role=\"send_from_email\"]');\n\n\t\t\tif (this.BX.Type.isElementNode(this.DOM.sendFromEmailSelect))\n\t\t\t{\n\t\t\t\tthis.emailSelectorControl = new EmailSelectorControl({\n\t\t\t\t\tselectNode: this.DOM.sendFromEmailSelect,\n\t\t\t\t\tallowAddNewEmail: true,\n\t\t\t\t\tmailboxList: this.mailboxList\n\t\t\t\t});\n\n\t\t\t\tthis.DOM.emailHelpIcon = this.DOM.content.querySelector('.calendar-settings-question');\n\n\t\t\t\tif(this.DOM.emailHelpIcon && BX.Helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.emailHelpIcon,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() =>{\n\t\t\t\t\t\t\tBX.Helper.show(\"redirect=detail&code=12070142\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tUtil.initHintNode(this.DOM.emailHelpIcon);\n\t\t\t\t}\n\n\t\t\t\tthis.emailSelectorControl.setValue(this.calendarContext.util.getUserOption('sendFromEmail'));\n\n\t\t\t\tthis.DOM.emailWrap = this.DOM.content.querySelector('.calendar-settings-email-wrap')\n\t\t\t\tif (BX.Calendar.Util.isEventWithEmailGuestAllowed())\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = true;\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.sendFromEmailSelect.parentNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tBX.UI.InfoHelper.show('limit_calendar_invitation_by_mail');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// General settings\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\tthis.DOM.workTimeStart = this.DOM.content.querySelector('[data-role=\"work_time_start\"]');\n\t\t\tthis.DOM.workTimeEnd = this.DOM.content.querySelector('[data-role=\"work_time_end\"]');\n\t\t\tthis.DOM.weekHolidays = this.DOM.content.querySelector('[data-role=\"week_holidays\"]');\n\t\t\tthis.DOM.yearHolidays = this.DOM.content.querySelector('[data-role=\"year_holidays\"]');\n\t\t\tthis.DOM.yearWorkdays = this.DOM.content.querySelector('[data-role=\"year_workdays\"]');\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tthis.DOM.accessOuterWrap = this.DOM.content.querySelector('[data-role=\"type-access-values-cont\"]');\n\t\t\tif (Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t\t{\n\t\t\t\tthis.initAccessController();\n\t\t\t}\n\t\t}\n\t}\n\n\tsetControlsValue()\n\t{\n\t\t// Set personal user settings\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.meetSectionSelect.options.length = 0;\n\n\t\t\tconst sections = this.calendarContext.sectionManager.getSectionListForEdit();\n\t\t\tlet crmSection = parseInt(this.calendarContext.util.getUserOption('crmSection'));\n\t\t\tlet meetSection = parseInt(this.calendarContext.util.getUserOption('meetSection'));\n\t\t\tlet section;\n\t\t\tlet selected;\n\n\t\t\tfor (let i = 0; i < sections.length; i++)\n\t\t\t{\n\t\t\t\tsection = sections[i];\n\t\t\t\tif (section.belongsToOwner())\n\t\t\t\t{\n\t\t\t\t\tif (!meetSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmeetSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = meetSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.meetSectionSelect.options.add(new Option(section.name, section.id, selected, selected));\n\n\t\t\t\t\tif (!crmSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = crmSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.crmSelect.options.add(new Option(section.name, section.id, selected, selected));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(this.DOM.showDeclined)\n\t\t{\n\t\t\tthis.DOM.showDeclined.checked = this.calendarContext.util.getUserOption('showDeclined');\n\t\t}\n\n\t\tvar showTasks = this.calendarContext.util.getUserOption('showTasks') === 'Y';\n\t\tif(this.DOM.showTasks)\n\t\t{\n\t\t\tthis.DOM.showTasks.checked = showTasks;\n\t\t\tBX.Event.bind(this.DOM.showTasks, 'click', function(){\n\t\t\t\tif(this.DOM.showCompletedTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.showCompletedTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.showCompletedTasks.checked = this.DOM.showCompletedTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t\tif(this.DOM.syncTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.syncTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.syncTasks.checked = this.DOM.syncTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tif(this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tthis.DOM.showCompletedTasks.checked = this.calendarContext.util.getUserOption('showCompletedTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.showCompletedTasks.disabled = !showTasks;\n\t\t}\n\t\tif(this.DOM.syncTasks)\n\t\t{\n\t\t\tthis.DOM.syncTasks.checked = this.calendarContext.util.getUserOption('syncTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.syncTasks.disabled = !showTasks;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation.checked = this.calendarContext.util.getUserOption('denyBusyInvitation');\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tthis.DOM.showWeekNumbers.checked = this.calendarContext.util.showWeekNumber();\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tthis.DOM.timezoneSelect.value = this.calendarContext.util.getUserOption('timezoneName') || '';\n\t\t}\n\n\t\tif(this.DOM.syncPeriodPast)\n\t\t{\n\t\t\tthis.DOM.syncPeriodPast.value = this.calendarContext.util.getUserOption('syncPeriodPast') || 3;\n\t\t}\n\t\tif(this.DOM.syncPeriodFuture)\n\t\t{\n\t\t\tthis.DOM.syncPeriodFuture.value = this.calendarContext.util.getUserOption('syncPeriodFuture') || 12;\n\t\t}\n\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\t// Set access for calendar type\n\t\t\tthis.DOM.workTimeStart.value = this.settings.work_time_start;\n\t\t\tthis.DOM.workTimeEnd.value = this.settings.work_time_end;\n\n\t\t\tif (this.DOM.weekHolidays)\n\t\t\t{\n\t\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.weekHolidays.options[i].selected =\n\t\t\t\t\t\tthis.settings.week_holidays.includes(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.DOM.yearHolidays.value = this.settings.year_holidays;\n\t\t\tthis.DOM.yearWorkdays.value = this.settings.year_workdays;\n\t\t}\n\n\t\t// Access\n\t\tif (this.showAccessControl\n\t\t\t&& Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t{\n\t\t\tconst typeAccess = this.calendarContext.util.config.TYPE_ACCESS;\n\t\t\tfor (let code in typeAccess)\n\t\t\t{\n\t\t\t\tif (typeAccess.hasOwnProperty(code))\n\t\t\t\t{\n\t\t\t\t\tthis.insertAccessRow(\n\t\t\t\t\t\tthis.calendarContext.util.getAccessName(code),\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\ttypeAccess[code]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst userSettings = this.calendarContext.util.config.userSettings;\n\n\t\t// Save user settings\n\t\tif (this.DOM.showDeclined)\n\t\t{\n\t\t\tuserSettings.showDeclined = this.DOM.showDeclined.checked ? 1 : 0;\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tuserSettings.showWeekNumbers = this.DOM.showWeekNumbers.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.showTasks)\n\t\t{\n\t\t\tuserSettings.showTasks = this.DOM.showTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.syncTasks)\n\t\t{\n\t\t\tuserSettings.syncTasks = this.DOM.syncTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tuserSettings.showCompletedTasks = this.DOM.showCompletedTasks.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.meetSectionSelect)\n\t\t{\n\t\t\tuserSettings.meetSection = this.DOM.meetSectionSelect.value;\n\t\t}\n\t\tif (this.DOM.crmSelect)\n\t\t{\n\t\t\tuserSettings.crmSection = this.DOM.crmSelect.value;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tuserSettings.denyBusyInvitation = this.DOM.denyBusyInvitation.checked ? 1 : 0;\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tuserSettings.userTimezoneName = this.DOM.timezoneSelect.value;\n\t\t}\n\n\t\tif(this.DOM.syncPeriodPast)\n\t\t{\n\t\t\tuserSettings.syncPeriodPast = this.DOM.syncPeriodPast.value;\n\t\t}\n\n\t\tif(this.DOM.syncPeriodFuture)\n\t\t{\n\t\t\tuserSettings.syncPeriodFuture = this.DOM.syncPeriodFuture.value;\n\t\t}\n\n\t\tif(this.emailSelectorControl)\n\t\t{\n\t\t\tuserSettings.sendFromEmail = this.emailSelectorControl.getValue();\n\t\t}\n\n\t\tconst data = {\n\t\t\ttype: this.calendarContext.util.config.type,\n\t\t\tuser_settings: userSettings,\n\t\t\tuser_timezone_name: userSettings.userTimezoneName,\n\t\t};\n\n\t\tif (this.showGeneralSettings && this.DOM.workTimeStart)\n\t\t{\n\t\t\tdata.settings = {\n\t\t\t\twork_time_start: this.DOM.workTimeStart.value,\n\t\t\t\twork_time_end: this.DOM.workTimeEnd.value,\n\t\t\t\tweek_holidays: [],\n\t\t\t\tyear_holidays: this.DOM.yearHolidays.value,\n\t\t\t\tyear_workdays: this.DOM.yearWorkdays.value\n\t\t\t};\n\n\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t{\n\t\t\t\tif (this.DOM.weekHolidays.options[i].selected)\n\t\t\t\t{\n\t\t\t\t\tdata.settings.week_holidays.push(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tdata.type_access = this.access;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'calendar.api.calendarajax.saveSettings',\n\t\t\t{\n\t\t\t \tdata: data\n\t\t\t})\n\t\t\t.then(() => {BX.reload();});\n\n\t\tthis.close();\n\t}\n\n\tinitAccessController()\n\t{\n\t\tthis.DOM.accessWrap = this.DOM.accessOuterWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-list-slider-access-container shown\">\n\t\t\t\t\t<div class=\"calendar-list-slider-access-inner-wrap\">\n\t\t\t\t\t\t${this.DOM.accessTable = Tag.render`\n\t\t\t\t\t\t\t<table class=\"calendar-section-slider-access-table\" />\n\t\t\t\t\t\t`}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-list-slider-new-calendar-options-container\">\n\t\t\t\t\t\t${this.DOM.accessButton = Tag.render `\n\t\t\t\t\t\t\t<span class=\"calendar-list-slider-new-calendar-option-add\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('EC_SEC_SLIDER_ACCESS_ADD')}\n\t\t\t\t\t\t\t</span>`\n\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\n\t\tthis.access = {};\n\t\tthis.accessControls = {};\n\t\tthis.accessTasks = this.calendarContext?.util?.getTypeAccessTasks();\n\n\t\tif (this.calendarContext?.util?.config?.accessNames)\n\t\t{\n\t\t\tUtil.setAccessNames(this.calendarContext.util.config.accessNames);\n\t\t}\n\n\t\tEvent.bind(this.DOM.accessButton, 'click', () => {\n\t\t\tthis.entitySelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.accessButton,\n\t\t\t\tcontext: 'CALENDAR',\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\ttargetContainer: document.body\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {selectMode: 'usersAndDepartments'}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.entitySelectorDialog.show();\n\t\t\tthis.entitySelectorDialog.subscribe('onHide', this.allowSliderClose.bind(this));\n\t\t\tthis.denySliderClose();\n\t\t});\n\n\t\tEvent.bind(this.DOM.accessWrap, 'click', (e) => {\n\t\t\tconst target = Util.findTargetNode(e.target || e.srcElement, this.DOM.outerWrap);\n\t\t\tif (Type.isElementNode(target))\n\t\t\t{\n\t\t\t\tif(target.getAttribute('data-bx-calendar-access-selector') !== null)\n\t\t\t\t{\n\t\t\t\t\t// show selector\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-selector');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showAccessSelectorPopup({\n\t\t\t\t\t\t\t\tnode: this.accessControls[code].removeIcon,\n\t\t\t\t\t\t\t\tsetValueCallback: (value) => {\n\t\t\t\t\t\t\t\t\tif (this.accessTasks[value] && this.accessControls[code])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.accessControls[code].valueNode.innerHTML =\n\t\t\t\t\t\t\t\t\t\t\tText.encode(this.accessTasks[value].title);\n\t\t\t\t\t\t\t\t\t\tthis.access[code] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(target.getAttribute('data-bx-calendar-access-remove') !== null)\n\t\t\t\t{\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-remove');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(this.accessControls[code].rowNode)\n\t\t\t\t\t\tthis.accessControls[code] = null;\n\t\t\t\t\t\tdelete this.access[code];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleEntitySelectorChanges()\n\t{\n\t\tconst entityList = this.entitySelectorDialog.getSelectedItems();\n\t\tthis.entitySelectorDialog.hide();\n\t\tif (Type.isArray(entityList))\n\t\t{\n\t\t\tentityList.forEach((entity) => {\n\t\t\t\tconst title = entity.title.text;\n\t\t\t\tconst code = Util.convertEntityToAccessCode(entity);\n\t\t\t\tUtil.setAccessName(code, title);\n\t\t\t\tthis.insertAccessRow(title, code);\n\t\t\t});\n\t\t}\n\n\t\tRuntime.debounce(() => {\n\t\t\tthis.entitySelectorDialog.destroy();\n\t\t}, 400)();\n\t}\n\n\tinsertAccessRow(title, code, value)\n\t{\n\t\tif (!this.accessControls[code])\n\t\t{\n\t\t\tif (value === undefined)\n\t\t\t{\n\t\t\t\tfor(let taskId in this.accessTasks)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.accessTasks.hasOwnProperty(taskId)\n\t\t\t\t\t\t&& this.accessTasks[taskId].name === 'calendar_type_edit'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = taskId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rowNode = Dom.adjust(\n\t\t\t\t\tthis.DOM.accessTable.insertRow(-1),\n\t\t\t\t\t{props : {className: 'calendar-section-slider-access-table-row'}}\n\t\t\t\t);\n\t\t\tconst titleNode = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\thtml: '<span class=\"calendar-section-slider-access-title\">' + Text.encode(title) + ':</span>'});\n\t\t\tconst valueCell = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-selector': code}\n\t\t\t\t});\n\t\t\tconst selectNode = valueCell.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-container'}\n\t\t\t\t}));\n\t\t\tconst valueNode = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\ttext: this.accessTasks[value] ? this.accessTasks[value].title : '',\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-value'}\n\t\t\t\t}));\n\t\t\tconst removeIcon = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-remove'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-remove': code}\n\t\t\t\t}));\n\n\t\t\tthis.access[code] = value;\n\n\t\t\tthis.accessControls[code] = {\n\t\t\t\trowNode: rowNode,\n\t\t\t\ttitleNode: titleNode,\n\t\t\t\tvalueNode: valueNode,\n\t\t\t\tremoveIcon: removeIcon\n\t\t\t};\n\t\t}\n\t}\n\n\tcheckAccessTableHeight()\n\t{\n\t\tif (this.checkTableTimeout)\n\t\t{\n\t\t\tthis.checkTableTimeout = clearTimeout(this.checkTableTimeout);\n\t\t}\n\n\t\tthis.checkTableTimeout = setTimeout(() => {\n\t\t\tif (Dom.hasClass(this.DOM.accessWrap, 'shown'))\n\t\t\t{\n\t\t\t\tif (this.DOM.accessWrap.offsetHeight - this.DOM.accessTable.offsetHeight < 36)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.accessWrap.style.maxHeight = parseInt(this.DOM.accessTable.offsetHeight) + 100 + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.accessWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\tshowAccessSelectorPopup(params)\n\t{\n\t\tif (\n\t\t\tthis.accessPopupMenu\n\t\t\t&& this.accessPopupMenu.popupWindow\n\t\t\t&& this.accessPopupMenu.popupWindow.isShown()\n\t\t)\n\t\t{\n\t\t\treturn this.accessPopupMenu.close();\n\t\t}\n\n\t\tconst _this = this;\n\t\tconst menuItems = [];\n\n\t\tfor(let taskId in this.accessTasks)\n\t\t{\n\t\t\tif (this.accessTasks.hasOwnProperty(taskId))\n\t\t\t{\n\t\t\t\tmenuItems.push(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.accessTasks[taskId].title,\n\t\t\t\t\t\tonclick: (function (value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tparams.setValueCallback(value);\n\t\t\t\t\t\t\t\t_this.accessPopupMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(taskId)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.accessPopupMenu = this.BX.PopupMenu.create(\n\t\t\t'section-access-popup' + Util.randomInt(),\n\t\t\tparams.node,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t{\n\t\t\t\t\tonPopupClose : this.allowSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.accessPopupMenu.show();\n\t\tthis.denySliderClose();\n\t}\n}"],"names":["SettingsInterface","options","calendarContext","showPersonalSettings","showGeneralSettings","showAccessControl","Type","isObjectLike","util","config","TYPE_ACCESS","settings","BX","Util","getBX","SidePanel","Instance","open","sliderId","contentCallback","createContent","bind","width","SLIDER_WIDTH","animationDuration","SLIDER_DURATION","events","onCloseByEsc","escHide","onClose","hide","onCloseComplete","destroy","onLoad","onLoadSlider","event","getSlider","getUrl","denyClose","denyAction","isOpenedState","close","removeCustomEvent","proxy","DOM","sectionListWrap","slider","Promise","resolve","top","ajax","runAction","data","uid","then","response","getData","set","html","params","additionalParams","mailboxList","content","layout","get","initControls","setControlsValue","buttonsWrap","querySelector","ZIndexManager","register","saveBtn","closeBtn","Event","save","denyBusyInvitation","showWeekNumbers","meetSectionSelect","crmSelect","showDeclined","showTasks","syncTasks","showCompletedTasks","timezoneSelect","syncPeriodPast","syncPeriodFuture","sendFromEmailSelect","isElementNode","emailSelectorControl","EmailSelectorControl","selectNode","allowAddNewEmail","emailHelpIcon","Helper","show","initHintNode","setValue","getUserOption","emailWrap","Calendar","isEventWithEmailGuestAllowed","Dom","removeClass","disabled","addClass","parentNode","UI","InfoHelper","workTimeStart","workTimeEnd","weekHolidays","yearHolidays","yearWorkdays","accessOuterWrap","initAccessController","length","sections","sectionManager","getSectionListForEdit","crmSection","parseInt","meetSection","section","selected","i","belongsToOwner","id","add","Option","name","checked","showWeekNumber","value","work_time_start","work_time_end","week_holidays","includes","year_holidays","year_workdays","typeAccess","code","hasOwnProperty","insertAccessRow","getAccessName","userSettings","userTimezoneName","sendFromEmail","getValue","type","user_settings","user_timezone_name","push","type_access","access","reload","accessWrap","appendChild","Tag","render","accessTable","accessButton","Loc","getMessage","accessControls","accessTasks","getTypeAccessTasks","accessNames","setAccessNames","entitySelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","enableSearch","handleEntitySelectorChanges","popupOptions","targetContainer","document","body","entities","selectMode","subscribe","allowSliderClose","denySliderClose","e","target","findTargetNode","srcElement","outerWrap","getAttribute","showAccessSelectorPopup","node","removeIcon","setValueCallback","valueNode","innerHTML","Text","encode","title","remove","rowNode","entityList","getSelectedItems","isArray","forEach","entity","text","convertEntityToAccessCode","setAccessName","Runtime","debounce","undefined","taskId","adjust","insertRow","props","className","titleNode","insertCell","valueCell","attrs","create","checkTableTimeout","clearTimeout","setTimeout","hasClass","offsetHeight","style","maxHeight","accessPopupMenu","popupWindow","isShown","_this","menuItems","onclick","PopupMenu","randomInt","closeByEsc","autoHide","offsetTop","offsetLeft","angle","cacheable","onPopupClose"],"mappings":"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"}