{"version":3,"file":"settingsinterface.bundle.js","sources":["../src/settingsinterface.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport {EmailSelectorControl} from 'calendar.controls';\nimport { Type, Event, Loc, Tag, Dom, Text, Runtime } from 'main.core';\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageCard } from 'ui.messagecard';\n\ntype SettingsInterfaceOptions = {\n\tname: string;\n\tcalendarContext: any,\n\tshowPersonalSettings: boolean,\n\tshowGeneralSettings: boolean,\n\tshowAccessControl: boolean,\n\tsettings: any\n};\n\nexport class SettingsInterface\n{\n\tsliderId: string = \"calendar:settings-slider\";\n\tname: string = 'SettingsInterface';\n\tSLIDER_WIDTH: number = 500;\n\tSLIDER_DURATION: number = 80;\n\tDOM: any = {};\n\n\tconstructor(options: SettingsInterfaceOptions)\n\t{\n\t\tthis.calendarContext = options.calendarContext;\n\t\tthis.showPersonalSettings = options.showPersonalSettings;\n\t\tthis.showGeneralSettings = options.showGeneralSettings;\n\t\tthis.showAccessControl = options.showAccessControl !== false\n\t\t\t&& Type.isObjectLike(this.calendarContext.util.config.TYPE_ACCESS);\n\n\t\tthis.settings = options.settings;\n\t\tthis.BX = Util.getBX();\n\t\tthis.hideMessageBinded = this.hideMessage.bind(this);\n\t}\n\n\tshow()\n\t{\n\t\tthis.BX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: this.createContent.bind(this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION,\n\t\t\tevents: {\n\t\t\t\tonCloseByEsc: this.escHide.bind(this),\n\t\t\t\tonClose: this.hide.bind(this),\n\t\t\t\tonCloseComplete: this.destroy.bind(this),\n\t\t\t\tonLoad: this.onLoadSlider.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\n\tescHide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId && this.denyClose)\n\t\t{\n\t\t\tevent.denyAction();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.isOpenedState = false;\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisOpened()\n\t{\n\t\treturn this.isOpenedState;\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\tif (this.denyClose)\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", BX.proxy(this.hide, this));\n\t\t\t}\n\t\t}\n\t}\n\n\tdenySliderClose()\n\t{\n\t\tthis.denyClose = true;\n\t}\n\n\tallowSliderClose()\n\t{\n\t\tthis.denyClose = false;\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// this.destroyEventEmitterSubscriptions();\n\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:delete', this.deleteSectionHandlerBinded);\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:pull-delete', this.deleteSectionHandlerBinded);\n\n\t\t\t// BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", BX.proxy(this.destroy, this));\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t\tdelete this.DOM.sectionListWrap;\n\t\t}\n\t}\n\n\tcreateContent(slider: BX.Intranet.Bitrix24.Slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\ttop.BX.ajax.runAction('calendar.api.calendarajax.getSettingsSlider', {\n\t\t\t\tdata: {\n\t\t\t\t\tshowPersonalSettings: this.showPersonalSettings ? 'Y' : 'N',\n\t\t\t\t\tshowGeneralSettings: this.showGeneralSettings ? 'Y' : 'N',\n\t\t\t\t\tshowAccessControl: this.showAccessControl ? 'Y' : 'N',\n\t\t\t\t\tuid: this.uid\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response: any) => {\n\t\t\t\t\tslider.getData().set(\"sliderContent\", response.data.html);\n\t\t\t\t\tconst params = response.data.additionalParams;\n\n\t\t\t\t\tthis.mailboxList = params.mailboxList;\n\t\t\t\t\tthis.uid = params.uid;\n\n\t\t\t\t\tresolve(response.data.html);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tonLoadSlider(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tthis.DOM.content = slider.layout.content;\n\t\tthis.sliderId = slider.getUrl();\n\n\t\t// Used to execute javasctipt and attach CSS from ajax responce\n\t\tBX.html(slider.layout.content, slider.getData().get(\"sliderContent\"));\n\t\tthis.initControls();\n\t\tthis.setControlsValue();\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.buttonsWrap = this.DOM.content.querySelector('.calendar-form-buttons-fixed');\n\t\tBX.ZIndexManager.register(this.DOM.buttonsWrap);\n\n\t\tthis.DOM.saveBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"save_btn\"]');\n\t\tthis.DOM.closeBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"close_btn\"]');\n\n\t\tBX.Event.bind(this.DOM.saveBtn, 'click', this.save.bind(this));\n\t\tBX.Event.bind(this.DOM.closeBtn, 'click', this.close.bind(this));\n\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation = this.DOM.content.querySelector('[data-role=\"deny_busy_invitation\"]');\n\t\t\tthis.DOM.showWeekNumbers = this.DOM.content.querySelector('[data-role=\"show_week_numbers\"]');\n\n\t\t\tthis.DOM.meetSectionSelect = this.DOM.content.querySelector('[data-role=\"meet_section\"]');\n\t\t\tthis.DOM.crmSelect = this.DOM.content.querySelector('[data-role=\"crm_section\"]');\n\t\t\tthis.DOM.showDeclined = this.DOM.content.querySelector('[data-role=\"show_declined\"]');\n\t\t\tthis.DOM.showTasks = this.DOM.content.querySelector('[data-role=\"show_tasks\"]');\n\t\t\tthis.DOM.syncTasks = this.DOM.content.querySelector('[data-role=\"sync_tasks\"]');\n\t\t\tthis.DOM.showCompletedTasks = this.DOM.content.querySelector('[data-role=\"show_completed_tasks\"]');\n\t\t\tthis.DOM.timezoneSelect = this.DOM.content.querySelector('[data-role=\"set_tz_sel\"]');\n\t\t\tthis.DOM.sendFromEmailSelect = this.DOM.content.querySelector('[data-role=\"send_from_email\"]');\n\n\t\t\tif (this.BX.Type.isElementNode(this.DOM.sendFromEmailSelect))\n\t\t\t{\n\t\t\t\tthis.emailSelectorControl = new EmailSelectorControl({\n\t\t\t\t\tselectNode: this.DOM.sendFromEmailSelect,\n\t\t\t\t\tallowAddNewEmail: true,\n\t\t\t\t\tmailboxList: this.mailboxList\n\t\t\t\t});\n\n\t\t\t\tthis.DOM.emailHelpIcon = this.DOM.content.querySelector('.calendar-settings-question');\n\n\t\t\t\tif(this.DOM.emailHelpIcon && BX.Helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.emailHelpIcon,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() =>{\n\t\t\t\t\t\t\tBX.Helper.show(\"redirect=detail&code=12070142\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tUtil.initHintNode(this.DOM.emailHelpIcon);\n\t\t\t\t}\n\n\t\t\t\tthis.emailSelectorControl.setValue(this.calendarContext.util.getUserOption('sendFromEmail'));\n\n\t\t\t\tthis.DOM.emailWrap = this.DOM.content.querySelector('.calendar-settings-email-wrap')\n\t\t\t\tif (BX.Calendar.Util.isEventWithEmailGuestAllowed())\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = true;\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.sendFromEmailSelect.parentNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tBX.UI.InfoHelper.show('limit_calendar_invitation_by_mail');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// General settings\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\tthis.DOM.workTimeStart = this.DOM.content.querySelector('[data-role=\"work_time_start\"]');\n\t\t\tthis.DOM.workTimeEnd = this.DOM.content.querySelector('[data-role=\"work_time_end\"]');\n\t\t\tthis.DOM.weekHolidays = this.DOM.content.querySelector('[data-role=\"week_holidays\"]');\n\t\t\tthis.DOM.yearHolidays = this.DOM.content.querySelector('[data-role=\"year_holidays\"]');\n\t\t\tthis.DOM.yearWorkdays = this.DOM.content.querySelector('[data-role=\"year_workdays\"]');\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap = this.DOM.content.querySelector('[data-role=\"type-access-message-card\"]');\n\t\t\tthis.DOM.accessOuterWrap = this.DOM.content.querySelector('[data-role=\"type-access-values-cont\"]');\n\t\t\tthis.DOM.accessHelpIcon = this.DOM.content.querySelector('.calendar-settings-access-hint');\n\t\t\tif(Type.isElementNode(this.DOM.accessHelpIcon) && this.calendarContext.util.type === 'location')\n\t\t\t{\n\t\t\t\tthis.initMessageControl();\n\t\t\t}\n\t\t\telse if(Type.isElementNode(this.DOM.accessHelpIcon))\n\t\t\t{\n\t\t\t\tthis.DOM.accessHelpIcon.remove();\n\t\t\t}\n\t\t\tif (Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t\t{\n\t\t\t\tthis.initAccessController();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitMessageControl()\n\t{\n\t\tconst moreMessageButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-primary\">${Loc.getMessage('EC_LOCATION_SETTINGS_MORE_INFO')}</a>\n\t\t`;\n\t\tEvent.bind(moreMessageButton, 'click', this.openHelpDesk);\n\t\tconst header = \"\";\n\t\tconst description = Loc.getMessage('EC_LOCATION_SETTINGS_MESSAGE_DESCRIPTION')\n\n\t\tthis.message = new MessageCard({\n\t\t\tid: 'locationSettingsInfo',\n\t\t\theader,\n\t\t\tdescription,\n\t\t\tangle: false,\n\t\t\thidden: true,\n\t\t\tactionElements: [moreMessageButton]\n\t\t})\n\t\tEventEmitter.subscribe(this.message, 'onClose', this.hideMessageBinded);\n\t\tEvent.bind(this.DOM.accessHelpIcon, 'click', () => {\n\t\t\tthis.onClickHint();\n\t\t});\n\n\t\tif(this.DOM.accessMessageWrap)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap.appendChild(this.message.getLayout());\n\t\t\tthis.DOM.accessMessageWrap.firstChild.childNodes[1].remove();\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tthis.showMessage();\n\t\t\t}\n\t\t}\n\t}\n\n\tonClickHint()\n\t{\n\t\tif (!this.message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.message.isShown())\n\t\t{\n\t\t\tthis.hideMessage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showMessage();\n\t\t}\n\t}\n\n\tsetControlsValue()\n\t{\n\t\t// Set personal user settings\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.meetSectionSelect.options.length = 0;\n\n\t\t\tconst sections = this.calendarContext.sectionManager.getSectionListForEdit();\n\t\t\tlet crmSection = parseInt(this.calendarContext.util.getUserOption('crmSection'));\n\t\t\tlet meetSection = parseInt(this.calendarContext.util.getUserOption('meetSection'));\n\t\t\tlet section;\n\t\t\tlet selected;\n\n\t\t\tfor (let i = 0; i < sections.length; i++)\n\t\t\t{\n\t\t\t\tsection = sections[i];\n\t\t\t\tif (section.belongsToOwner())\n\t\t\t\t{\n\t\t\t\t\tif (!meetSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmeetSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = meetSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.meetSectionSelect.options.add(new Option(section.name, section.id, selected, selected));\n\n\t\t\t\t\tif (!crmSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = crmSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.crmSelect.options.add(new Option(section.name, section.id, selected, selected));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(this.DOM.showDeclined)\n\t\t{\n\t\t\tthis.DOM.showDeclined.checked = this.calendarContext.util.getUserOption('showDeclined');\n\t\t}\n\n\t\tvar showTasks = this.calendarContext.util.getUserOption('showTasks') === 'Y';\n\t\tif(this.DOM.showTasks)\n\t\t{\n\t\t\tthis.DOM.showTasks.checked = showTasks;\n\t\t\tBX.Event.bind(this.DOM.showTasks, 'click', function(){\n\t\t\t\tif(this.DOM.showCompletedTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.showCompletedTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.showCompletedTasks.checked = this.DOM.showCompletedTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t\tif(this.DOM.syncTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.syncTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.syncTasks.checked = this.DOM.syncTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tif(this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tthis.DOM.showCompletedTasks.checked = this.calendarContext.util.getUserOption('showCompletedTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.showCompletedTasks.disabled = !showTasks;\n\t\t}\n\t\tif(this.DOM.syncTasks)\n\t\t{\n\t\t\tthis.DOM.syncTasks.checked = this.calendarContext.util.getUserOption('syncTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.syncTasks.disabled = !showTasks;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation.checked = this.calendarContext.util.getUserOption('denyBusyInvitation');\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tthis.DOM.showWeekNumbers.checked = this.calendarContext.util.showWeekNumber();\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tthis.DOM.timezoneSelect.value = this.calendarContext.util.getUserOption('timezoneName') || '';\n\t\t}\n\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\t// Set access for calendar type\n\t\t\tthis.DOM.workTimeStart.value = this.settings.work_time_start;\n\t\t\tthis.DOM.workTimeEnd.value = this.settings.work_time_end;\n\n\t\t\tif (this.DOM.weekHolidays)\n\t\t\t{\n\t\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.weekHolidays.options[i].selected =\n\t\t\t\t\t\tthis.settings.week_holidays.includes(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.DOM.yearHolidays.value = this.settings.year_holidays;\n\t\t\tthis.DOM.yearWorkdays.value = this.settings.year_workdays;\n\t\t}\n\n\t\t// Access\n\t\tif (this.showAccessControl\n\t\t\t&& Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t{\n\t\t\tconst typeAccess = this.calendarContext.util.config.TYPE_ACCESS;\n\t\t\tfor (let code in typeAccess)\n\t\t\t{\n\t\t\t\tif (typeAccess.hasOwnProperty(code))\n\t\t\t\t{\n\t\t\t\t\tthis.insertAccessRow(\n\t\t\t\t\t\tthis.calendarContext.util.getAccessName(code),\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\ttypeAccess[code]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst userSettings = this.calendarContext.util.config.userSettings;\n\n\t\t// Save user settings\n\t\tif (this.DOM.showDeclined)\n\t\t{\n\t\t\tuserSettings.showDeclined = this.DOM.showDeclined.checked ? 1 : 0;\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tuserSettings.showWeekNumbers = this.DOM.showWeekNumbers.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.showTasks)\n\t\t{\n\t\t\tuserSettings.showTasks = this.DOM.showTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.syncTasks)\n\t\t{\n\t\t\tuserSettings.syncTasks = this.DOM.syncTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tuserSettings.showCompletedTasks = this.DOM.showCompletedTasks.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.meetSectionSelect)\n\t\t{\n\t\t\tuserSettings.meetSection = this.DOM.meetSectionSelect.value;\n\t\t}\n\t\tif (this.DOM.crmSelect)\n\t\t{\n\t\t\tuserSettings.crmSection = this.DOM.crmSelect.value;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tuserSettings.denyBusyInvitation = this.DOM.denyBusyInvitation.checked ? 1 : 0;\n\t\t}\n\n\t\tuserSettings.userTimezoneName = this.DOM.timezoneSelect\n\t\t\t? this.DOM.timezoneSelect.value\n\t\t\t: userSettings.timezoneName;\n\n\t\tif (this.emailSelectorControl)\n\t\t{\n\t\t\tuserSettings.sendFromEmail = this.emailSelectorControl.getValue();\n\t\t}\n\n\t\tconst data = {\n\t\t\ttype: this.calendarContext.util.config.type,\n\t\t\tuser_settings: userSettings,\n\t\t\tuser_timezone_name: userSettings.userTimezoneName,\n\t\t};\n\n\t\tif (this.showGeneralSettings && this.DOM.workTimeStart)\n\t\t{\n\t\t\tdata.settings = {\n\t\t\t\twork_time_start: this.DOM.workTimeStart.value,\n\t\t\t\twork_time_end: this.DOM.workTimeEnd.value,\n\t\t\t\tweek_holidays: [],\n\t\t\t\tyear_holidays: this.DOM.yearHolidays.value,\n\t\t\t\tyear_workdays: this.DOM.yearWorkdays.value\n\t\t\t};\n\n\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t{\n\t\t\t\tif (this.DOM.weekHolidays.options[i].selected)\n\t\t\t\t{\n\t\t\t\t\tdata.settings.week_holidays.push(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tdata.type_access = this.access;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'calendar.api.calendarajax.saveSettings',\n\t\t\t{\n\t\t\t \tdata: data\n\t\t\t})\n\t\t\t.then(() => {BX.reload();});\n\n\t\tthis.close();\n\t}\n\n\tinitAccessController()\n\t{\n\t\tthis.DOM.accessWrap = this.DOM.accessOuterWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-list-slider-access-container shown\">\n\t\t\t\t\t<div class=\"calendar-list-slider-access-inner-wrap\">\n\t\t\t\t\t\t${this.DOM.accessTable = Tag.render`\n\t\t\t\t\t\t\t<table class=\"calendar-section-slider-access-table\" />\n\t\t\t\t\t\t`}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-list-slider-new-calendar-options-container\">\n\t\t\t\t\t\t${this.DOM.accessButton = Tag.render `\n\t\t\t\t\t\t\t<span class=\"calendar-list-slider-new-calendar-option-add\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('EC_SEC_SLIDER_ACCESS_ADD')}\n\t\t\t\t\t\t\t</span>`\n\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\n\t\tthis.access = {};\n\t\tthis.accessControls = {};\n\t\tthis.accessTasks = this.calendarContext?.util?.getTypeAccessTasks();\n\n\t\tif (this.calendarContext?.util?.config?.accessNames)\n\t\t{\n\t\t\tUtil.setAccessNames(this.calendarContext.util.config.accessNames);\n\t\t}\n\n\t\tEvent.bind(this.DOM.accessButton, 'click', () => {\n\t\t\tthis.entitySelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.accessButton,\n\t\t\t\tcontext: 'CALENDAR',\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\ttargetContainer: document.body\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {selectMode: 'usersAndDepartments'}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.entitySelectorDialog.show();\n\t\t\tthis.entitySelectorDialog.subscribe('onHide', this.allowSliderClose.bind(this));\n\t\t\tthis.denySliderClose();\n\t\t});\n\n\t\tEvent.bind(this.DOM.accessWrap, 'click', (e) => {\n\t\t\tconst target = Util.findTargetNode(e.target || e.srcElement, this.DOM.outerWrap);\n\t\t\tif (Type.isElementNode(target))\n\t\t\t{\n\t\t\t\tif(target.getAttribute('data-bx-calendar-access-selector') !== null)\n\t\t\t\t{\n\t\t\t\t\t// show selector\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-selector');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showAccessSelectorPopup({\n\t\t\t\t\t\t\t\tnode: this.accessControls[code].removeIcon,\n\t\t\t\t\t\t\t\tsetValueCallback: (value) => {\n\t\t\t\t\t\t\t\t\tif (this.accessTasks[value] && this.accessControls[code])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.accessControls[code].valueNode.innerHTML =\n\t\t\t\t\t\t\t\t\t\t\tText.encode(this.accessTasks[value].title);\n\t\t\t\t\t\t\t\t\t\tthis.access[code] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(target.getAttribute('data-bx-calendar-access-remove') !== null)\n\t\t\t\t{\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-remove');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(this.accessControls[code].rowNode)\n\t\t\t\t\t\tthis.accessControls[code] = null;\n\t\t\t\t\t\tdelete this.access[code];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleEntitySelectorChanges()\n\t{\n\t\tconst entityList = this.entitySelectorDialog.getSelectedItems();\n\t\tthis.entitySelectorDialog.hide();\n\t\tif (Type.isArray(entityList))\n\t\t{\n\t\t\tentityList.forEach((entity) => {\n\t\t\t\tconst title = entity.title.text;\n\t\t\t\tconst code = Util.convertEntityToAccessCode(entity);\n\t\t\t\tUtil.setAccessName(code, title);\n\t\t\t\tthis.insertAccessRow(title, code);\n\t\t\t});\n\t\t}\n\n\t\tRuntime.debounce(() => {\n\t\t\tthis.entitySelectorDialog.destroy();\n\t\t}, 400)();\n\t}\n\n\tinsertAccessRow(title, code, value)\n\t{\n\t\tif (!this.accessControls[code])\n\t\t{\n\t\t\tif (value === undefined)\n\t\t\t{\n\t\t\t\tfor(let taskId in this.accessTasks)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.accessTasks.hasOwnProperty(taskId)\n\t\t\t\t\t\t&& this.accessTasks[taskId].name === 'calendar_type_edit'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = taskId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rowNode = Dom.adjust(\n\t\t\t\t\tthis.DOM.accessTable.insertRow(-1),\n\t\t\t\t\t{props : {className: 'calendar-section-slider-access-table-row'}}\n\t\t\t\t);\n\t\t\tconst titleNode = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\thtml: '<span class=\"calendar-section-slider-access-title\">' + Text.encode(title) + ':</span>'});\n\t\t\tconst valueCell = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-selector': code}\n\t\t\t\t});\n\t\t\tconst selectNode = valueCell.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-container'}\n\t\t\t\t}));\n\t\t\tconst valueNode = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\ttext: this.accessTasks[value] ? this.accessTasks[value].title : '',\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-value'}\n\t\t\t\t}));\n\t\t\tconst removeIcon = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-remove'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-remove': code}\n\t\t\t\t}));\n\n\t\t\tthis.access[code] = value;\n\n\t\t\tthis.accessControls[code] = {\n\t\t\t\trowNode: rowNode,\n\t\t\t\ttitleNode: titleNode,\n\t\t\t\tvalueNode: valueNode,\n\t\t\t\tremoveIcon: removeIcon\n\t\t\t};\n\t\t}\n\t}\n\n\tcheckAccessTableHeight()\n\t{\n\t\tif (this.checkTableTimeout)\n\t\t{\n\t\t\tthis.checkTableTimeout = clearTimeout(this.checkTableTimeout);\n\t\t}\n\n\t\tthis.checkTableTimeout = setTimeout(() => {\n\t\t\tif (Dom.hasClass(this.DOM.accessWrap, 'shown'))\n\t\t\t{\n\t\t\t\tif (this.DOM.accessWrap.offsetHeight - this.DOM.accessTable.offsetHeight < 36)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.accessWrap.style.maxHeight = parseInt(this.DOM.accessTable.offsetHeight) + 100 + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.accessWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\tshowAccessSelectorPopup(params)\n\t{\n\t\tif (\n\t\t\tthis.accessPopupMenu\n\t\t\t&& this.accessPopupMenu.popupWindow\n\t\t\t&& this.accessPopupMenu.popupWindow.isShown()\n\t\t)\n\t\t{\n\t\t\treturn this.accessPopupMenu.close();\n\t\t}\n\n\t\tconst _this = this;\n\t\tconst menuItems = [];\n\n\t\tfor(let taskId in this.accessTasks)\n\t\t{\n\t\t\tif (this.accessTasks.hasOwnProperty(taskId))\n\t\t\t{\n\t\t\t\tmenuItems.push(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.accessTasks[taskId].title,\n\t\t\t\t\t\tonclick: (function (value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tparams.setValueCallback(value);\n\t\t\t\t\t\t\t\t_this.accessPopupMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(taskId)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.accessPopupMenu = this.BX.PopupMenu.create(\n\t\t\t'section-access-popup' + Util.randomInt(),\n\t\t\tparams.node,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t{\n\t\t\t\t\tonPopupClose : this.allowSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.accessPopupMenu.show();\n\t\tthis.denySliderClose();\n\t}\n\n\topenHelpDesk()\n\t{\n\t\tlet helpDeskCode = 14326208;\n\t\ttop.BX.Helper.show('redirect=detail&code=' + helpDeskCode);\n\t}\n\n\tshowMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tthis.message.show();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 300 + \"px\";\n\t\t\tDom.addClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t}\n\t}\n\n\thideMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tDom.removeClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t\tthis.message.hide();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 0;\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.locationajax.hideSettingsHintLocation',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tvalue: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["SettingsInterface","constructor","options","sliderId","name","SLIDER_WIDTH","SLIDER_DURATION","DOM","calendarContext","showPersonalSettings","showGeneralSettings","showAccessControl","Type","isObjectLike","util","config","TYPE_ACCESS","settings","BX","Util","getBX","hideMessageBinded","hideMessage","bind","show","SidePanel","Instance","open","contentCallback","createContent","width","animationDuration","events","onCloseByEsc","escHide","onClose","hide","onCloseComplete","destroy","onLoad","onLoadSlider","event","getSlider","getUrl","denyClose","denyAction","close","isOpenedState","isOpened","removeCustomEvent","proxy","denySliderClose","allowSliderClose","sectionListWrap","slider","Promise","resolve","top","ajax","runAction","data","uid","then","response","getData","set","html","params","additionalParams","mailboxList","content","layout","get","initControls","setControlsValue","buttonsWrap","querySelector","ZIndexManager","register","saveBtn","closeBtn","Event","save","denyBusyInvitation","showWeekNumbers","meetSectionSelect","crmSelect","showDeclined","showTasks","syncTasks","showCompletedTasks","timezoneSelect","sendFromEmailSelect","isElementNode","emailSelectorControl","EmailSelectorControl","selectNode","allowAddNewEmail","emailHelpIcon","Helper","initHintNode","setValue","getUserOption","emailWrap","Calendar","isEventWithEmailGuestAllowed","Dom","removeClass","disabled","addClass","parentNode","UI","InfoHelper","workTimeStart","workTimeEnd","weekHolidays","yearHolidays","yearWorkdays","accessMessageWrap","accessOuterWrap","accessHelpIcon","type","initMessageControl","remove","initAccessController","moreMessageButton","Tag","render","Loc","getMessage","openHelpDesk","header","description","message","MessageCard","id","angle","hidden","actionElements","EventEmitter","subscribe","onClickHint","appendChild","getLayout","firstChild","childNodes","hideSettingsHintLocation","showMessage","isShown","length","sections","sectionManager","getSectionListForEdit","crmSection","parseInt","meetSection","section","selected","i","belongsToOwner","add","Option","checked","showWeekNumber","value","work_time_start","work_time_end","week_holidays","includes","year_holidays","year_workdays","typeAccess","code","hasOwnProperty","insertAccessRow","getAccessName","userSettings","userTimezoneName","timezoneName","sendFromEmail","getValue","user_settings","user_timezone_name","push","type_access","access","reload","accessWrap","accessTable","accessButton","accessControls","accessTasks","getTypeAccessTasks","accessNames","setAccessNames","entitySelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","enableSearch","handleEntitySelectorChanges","popupOptions","targetContainer","document","body","entities","selectMode","e","target","findTargetNode","srcElement","outerWrap","getAttribute","showAccessSelectorPopup","node","removeIcon","setValueCallback","valueNode","innerHTML","Text","encode","title","rowNode","entityList","getSelectedItems","isArray","forEach","entity","text","convertEntityToAccessCode","setAccessName","Runtime","debounce","undefined","taskId","adjust","insertRow","props","className","titleNode","insertCell","valueCell","attrs","create","checkAccessTableHeight","checkTableTimeout","clearTimeout","setTimeout","hasClass","offsetHeight","style","maxHeight","accessPopupMenu","popupWindow","_this","menuItems","onclick","PopupMenu","randomInt","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","onPopupClose","helpDeskCode"],"mappings":";;;;;;;;;CAgBO,MAAMA,iBAAN,CACP;CAOCC,EAAAA,WAAW,CAACC,OAAD,EACX;CAAA,SAPAC,QAOA,GAPmB,0BAOnB;CAAA,SANAC,IAMA,GANe,mBAMf;CAAA,SALAC,YAKA,GALuB,GAKvB;CAAA,SAJAC,eAIA,GAJ0B,EAI1B;CAAA,SAHAC,GAGA,GAHW,EAGX;CACC,SAAKC,eAAL,GAAuBN,OAAO,CAACM,eAA/B;CACA,SAAKC,oBAAL,GAA4BP,OAAO,CAACO,oBAApC;CACA,SAAKC,mBAAL,GAA2BR,OAAO,CAACQ,mBAAnC;CACA,SAAKC,iBAAL,GAAyBT,OAAO,CAACS,iBAAR,KAA8B,KAA9B,IACrBC,cAAI,CAACC,YAAL,CAAkB,KAAKL,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCC,WAAnD,CADJ;CAGA,SAAKC,QAAL,GAAgBf,OAAO,CAACe,QAAxB;CACA,SAAKC,EAAL,GAAUC,kBAAI,CAACC,KAAL,EAAV;CACA,SAAKC,iBAAL,GAAyB,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAzB;CACA;;CAEDC,EAAAA,IAAI,GACJ;CACC,SAAKN,EAAL,CAAQO,SAAR,CAAkBC,QAAlB,CAA2BC,IAA3B,CAAgC,KAAKxB,QAArC,EAA+C;CAC9CyB,MAAAA,eAAe,EAAE,KAAKC,aAAL,CAAmBN,IAAnB,CAAwB,IAAxB,CAD6B;CAE9CO,MAAAA,KAAK,EAAE,KAAKzB,YAFkC;CAG9C0B,MAAAA,iBAAiB,EAAE,KAAKzB,eAHsB;CAI9C0B,MAAAA,MAAM,EAAE;CACPC,QAAAA,YAAY,EAAE,KAAKC,OAAL,CAAaX,IAAb,CAAkB,IAAlB,CADP;CAEPY,QAAAA,OAAO,EAAE,KAAKC,IAAL,CAAUb,IAAV,CAAe,IAAf,CAFF;CAGPc,QAAAA,eAAe,EAAE,KAAKC,OAAL,CAAaf,IAAb,CAAkB,IAAlB,CAHV;CAIPgB,QAAAA,MAAM,EAAE,KAAKC,YAAL,CAAkBjB,IAAlB,CAAuB,IAAvB;CAJD;CAJsC,KAA/C;CAWA;;CAEDW,EAAAA,OAAO,CAACO,KAAD,EACP;CACC,QAAIA,KAAK,IAAIA,KAAK,CAACC,SAAf,IAA4BD,KAAK,CAACC,SAAN,GAAkBC,MAAlB,OAA+B,KAAKxC,QAAhE,IAA4E,KAAKyC,SAArF,EACA;CACCH,MAAAA,KAAK,CAACI,UAAN;CACA;CACD;;CAEDC,EAAAA,KAAK,GACL;CACC,SAAKC,aAAL,GAAqB,KAArB;CACA7B,IAAAA,EAAE,CAACO,SAAH,CAAaC,QAAb,CAAsBoB,KAAtB;CACA;;CAEDE,EAAAA,QAAQ,GACR;CACC,WAAO,KAAKD,aAAZ;CACA;;CAEDX,EAAAA,IAAI,CAACK,KAAD,EACJ;CACC,QAAIA,KAAK,IAAIA,KAAK,CAACC,SAAf,IAA4BD,KAAK,CAACC,SAAN,GAAkBC,MAAlB,OAA+B,KAAKxC,QAApE,EACA;CACC,UAAI,KAAKyC,SAAT,EACA;CACCH,QAAAA,KAAK,CAACI,UAAN;CACA,OAHD,MAKA;CACC3B,QAAAA,EAAE,CAAC+B,iBAAH,CAAqB,0BAArB,EAAiD/B,EAAE,CAACgC,KAAH,CAAS,KAAKd,IAAd,EAAoB,IAApB,CAAjD;CACA;CACD;CACD;;CAEDe,EAAAA,eAAe,GACf;CACC,SAAKP,SAAL,GAAiB,IAAjB;CACA;;CAEDQ,EAAAA,gBAAgB,GAChB;CACC,SAAKR,SAAL,GAAiB,KAAjB;CACA;;CAEDN,EAAAA,OAAO,CAACG,KAAD,EACP;CACC,QAAIA,KAAK,IAAIA,KAAK,CAACC,SAAf,IAA4BD,KAAK,CAACC,SAAN,GAAkBC,MAAlB,OAA+B,KAAKxC,QAApE,EACA;CACC;CAEA;CACA;CAEA;CACAe,MAAAA,EAAE,CAACO,SAAH,CAAaC,QAAb,CAAsBY,OAAtB,CAA8B,KAAKnC,QAAnC;CACA,aAAO,KAAKI,GAAL,CAAS8C,eAAhB;CACA;CACD;;CAEDxB,EAAAA,aAAa,CAACyB,MAAD,EACb;CACC,WAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;CAC/BC,MAAAA,GAAG,CAACvC,EAAJ,CAAOwC,IAAP,CAAYC,SAAZ,CAAsB,6CAAtB,EAAqE;CACpEC,QAAAA,IAAI,EAAE;CACLnD,UAAAA,oBAAoB,EAAE,KAAKA,oBAAL,GAA4B,GAA5B,GAAkC,GADnD;CAELC,UAAAA,mBAAmB,EAAE,KAAKA,mBAAL,GAA2B,GAA3B,GAAiC,GAFjD;CAGLC,UAAAA,iBAAiB,EAAE,KAAKA,iBAAL,GAAyB,GAAzB,GAA+B,GAH7C;CAILkD,UAAAA,GAAG,EAAE,KAAKA;CAJL;CAD8D,OAArE,EAOGC,IAPH,CAQEC,QAAD,IAAmB;CAClBT,QAAAA,MAAM,CAACU,OAAP,GAAiBC,GAAjB,CAAqB,eAArB,EAAsCF,QAAQ,CAACH,IAAT,CAAcM,IAApD;CACA,cAAMC,MAAM,GAAGJ,QAAQ,CAACH,IAAT,CAAcQ,gBAA7B;CAEA,aAAKC,WAAL,GAAmBF,MAAM,CAACE,WAA1B;CACA,aAAKR,GAAL,GAAWM,MAAM,CAACN,GAAlB;CAEAL,QAAAA,OAAO,CAACO,QAAQ,CAACH,IAAT,CAAcM,IAAf,CAAP;CACA,OAhBF;CAkBA,KAnBM,CAAP;CAoBA;;CAED1B,EAAAA,YAAY,CAACC,KAAD,EACZ;CACC,UAAMa,MAAM,GAAGb,KAAK,CAACC,SAAN,EAAf;CACA,SAAKnC,GAAL,CAAS+D,OAAT,GAAmBhB,MAAM,CAACiB,MAAP,CAAcD,OAAjC;CACA,SAAKnE,QAAL,GAAgBmD,MAAM,CAACX,MAAP,EAAhB,CAHD;;CAMCzB,IAAAA,EAAE,CAACgD,IAAH,CAAQZ,MAAM,CAACiB,MAAP,CAAcD,OAAtB,EAA+BhB,MAAM,CAACU,OAAP,GAAiBQ,GAAjB,CAAqB,eAArB,CAA/B;CACA,SAAKC,YAAL;CACA,SAAKC,gBAAL;CACA;;CAEDD,EAAAA,YAAY,GACZ;CACC,SAAKlE,GAAL,CAASoE,WAAT,GAAuB,KAAKpE,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,8BAA/B,CAAvB;CACA1D,IAAAA,EAAE,CAAC2D,aAAH,CAAiBC,QAAjB,CAA0B,KAAKvE,GAAL,CAASoE,WAAnC;CAEA,SAAKpE,GAAL,CAASwE,OAAT,GAAmB,KAAKxE,GAAL,CAASoE,WAAT,CAAqBC,aAArB,CAAmC,wBAAnC,CAAnB;CACA,SAAKrE,GAAL,CAASyE,QAAT,GAAoB,KAAKzE,GAAL,CAASoE,WAAT,CAAqBC,aAArB,CAAmC,yBAAnC,CAApB;CAEA1D,IAAAA,EAAE,CAAC+D,KAAH,CAAS1D,IAAT,CAAc,KAAKhB,GAAL,CAASwE,OAAvB,EAAgC,OAAhC,EAAyC,KAAKG,IAAL,CAAU3D,IAAV,CAAe,IAAf,CAAzC;CACAL,IAAAA,EAAE,CAAC+D,KAAH,CAAS1D,IAAT,CAAc,KAAKhB,GAAL,CAASyE,QAAvB,EAAiC,OAAjC,EAA0C,KAAKlC,KAAL,CAAWvB,IAAX,CAAgB,IAAhB,CAA1C;;CAEA,QAAI,KAAKd,oBAAT,EACA;CACC,WAAKF,GAAL,CAAS4E,kBAAT,GAA8B,KAAK5E,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,oCAA/B,CAA9B;CACA,WAAKrE,GAAL,CAAS6E,eAAT,GAA2B,KAAK7E,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,iCAA/B,CAA3B;CAEA,WAAKrE,GAAL,CAAS8E,iBAAT,GAA6B,KAAK9E,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,4BAA/B,CAA7B;CACA,WAAKrE,GAAL,CAAS+E,SAAT,GAAqB,KAAK/E,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,2BAA/B,CAArB;CACA,WAAKrE,GAAL,CAASgF,YAAT,GAAwB,KAAKhF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAxB;CACA,WAAKrE,GAAL,CAASiF,SAAT,GAAqB,KAAKjF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,0BAA/B,CAArB;CACA,WAAKrE,GAAL,CAASkF,SAAT,GAAqB,KAAKlF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,0BAA/B,CAArB;CACA,WAAKrE,GAAL,CAASmF,kBAAT,GAA8B,KAAKnF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,oCAA/B,CAA9B;CACA,WAAKrE,GAAL,CAASoF,cAAT,GAA0B,KAAKpF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,0BAA/B,CAA1B;CACA,WAAKrE,GAAL,CAASqF,mBAAT,GAA+B,KAAKrF,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,+BAA/B,CAA/B;;CAEA,UAAI,KAAK1D,EAAL,CAAQN,IAAR,CAAaiF,aAAb,CAA2B,KAAKtF,GAAL,CAASqF,mBAApC,CAAJ,EACA;CACC,aAAKE,oBAAL,GAA4B,IAAIC,sCAAJ,CAAyB;CACpDC,UAAAA,UAAU,EAAE,KAAKzF,GAAL,CAASqF,mBAD+B;CAEpDK,UAAAA,gBAAgB,EAAE,IAFkC;CAGpD5B,UAAAA,WAAW,EAAE,KAAKA;CAHkC,SAAzB,CAA5B;CAMA,aAAK9D,GAAL,CAAS2F,aAAT,GAAyB,KAAK3F,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAzB;;CAEA,YAAG,KAAKrE,GAAL,CAAS2F,aAAT,IAA0BhF,EAAE,CAACiF,MAAhC,EACA;CACCjF,UAAAA,EAAE,CAAC+D,KAAH,CAAS1D,IAAT,CACC,KAAKhB,GAAL,CAAS2F,aADV,EAEC,OAFD,EAGC,MAAK;CACJhF,YAAAA,EAAE,CAACiF,MAAH,CAAU3E,IAAV,CAAe,+BAAf;CACA,WALF;CAQAL,UAAAA,kBAAI,CAACiF,YAAL,CAAkB,KAAK7F,GAAL,CAAS2F,aAA3B;CACA;;CAED,aAAKJ,oBAAL,CAA0BO,QAA1B,CAAmC,KAAK7F,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,eAAxC,CAAnC;CAEA,aAAK/F,GAAL,CAASgG,SAAT,GAAqB,KAAKhG,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,+BAA/B,CAArB;;CACA,YAAI1D,EAAE,CAACsF,QAAH,CAAYrF,IAAZ,CAAiBsF,4BAAjB,EAAJ,EACA;CACCvF,UAAAA,EAAE,CAACwF,GAAH,CAAOC,WAAP,CAAmB,KAAKpG,GAAL,CAASgG,SAA5B,EAAuC,MAAvC;CACA,eAAKhG,GAAL,CAASqF,mBAAT,CAA6BgB,QAA7B,GAAwC,KAAxC;CACA,SAJD,MAMA;CACC1F,UAAAA,EAAE,CAACwF,GAAH,CAAOG,QAAP,CAAgB,KAAKtG,GAAL,CAASgG,SAAzB,EAAoC,MAApC;CACA,eAAKhG,GAAL,CAASqF,mBAAT,CAA6BgB,QAA7B,GAAwC,IAAxC;CACA1F,UAAAA,EAAE,CAAC+D,KAAH,CAAS1D,IAAT,CACC,KAAKhB,GAAL,CAASqF,mBAAT,CAA6BkB,UAD9B,EAEC,OAFD,EAGC,MAAM;CACL5F,YAAAA,EAAE,CAAC6F,EAAH,CAAMC,UAAN,CAAiBxF,IAAjB,CAAsB,mCAAtB;CACA,WALF;CAOA;CACD;CACD,KApEF;;;CAuEC,QAAI,KAAKd,mBAAT,EACA;CACC,WAAKH,GAAL,CAAS0G,aAAT,GAAyB,KAAK1G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,+BAA/B,CAAzB;CACA,WAAKrE,GAAL,CAAS2G,WAAT,GAAuB,KAAK3G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAvB;CACA,WAAKrE,GAAL,CAAS4G,YAAT,GAAwB,KAAK5G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAxB;CACA,WAAKrE,GAAL,CAAS6G,YAAT,GAAwB,KAAK7G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAxB;CACA,WAAKrE,GAAL,CAAS8G,YAAT,GAAwB,KAAK9G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,6BAA/B,CAAxB;CACA;;CAED,QAAI,KAAKjE,iBAAT,EACA;CACC,WAAKJ,GAAL,CAAS+G,iBAAT,GAA6B,KAAK/G,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,wCAA/B,CAA7B;CACA,WAAKrE,GAAL,CAASgH,eAAT,GAA2B,KAAKhH,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,uCAA/B,CAA3B;CACA,WAAKrE,GAAL,CAASiH,cAAT,GAA0B,KAAKjH,GAAL,CAAS+D,OAAT,CAAiBM,aAAjB,CAA+B,gCAA/B,CAA1B;;CACA,UAAGhE,cAAI,CAACiF,aAAL,CAAmB,KAAKtF,GAAL,CAASiH,cAA5B,KAA+C,KAAKhH,eAAL,CAAqBM,IAArB,CAA0B2G,IAA1B,KAAmC,UAArF,EACA;CACC,aAAKC,kBAAL;CACA,OAHD,MAIK,IAAG9G,cAAI,CAACiF,aAAL,CAAmB,KAAKtF,GAAL,CAASiH,cAA5B,CAAH,EACL;CACC,aAAKjH,GAAL,CAASiH,cAAT,CAAwBG,MAAxB;CACA;;CACD,UAAI/G,cAAI,CAACiF,aAAL,CAAmB,KAAKtF,GAAL,CAASgH,eAA5B,CAAJ,EACA;CACC,aAAKK,oBAAL;CACA;CACD;CACD;;CAEDF,EAAAA,kBAAkB,GAClB;CACC,UAAMG,iBAAiB,GAAGC,aAAG,CAACC,MAAP,cAAc;sCAAd,CAC8D;GAD9D,GACaC,aAAG,CAACC,UAAJ,CAAe,gCAAf,CADb,CAAvB;CAGAhD,IAAAA,eAAK,CAAC1D,IAAN,CAAWsG,iBAAX,EAA8B,OAA9B,EAAuC,KAAKK,YAA5C;CACA,UAAMC,MAAM,GAAG,EAAf;CACA,UAAMC,WAAW,GAAGJ,aAAG,CAACC,UAAJ,CAAe,0CAAf,CAApB;CAEA,SAAKI,OAAL,GAAe,IAAIC,0BAAJ,CAAgB;CAC9BC,MAAAA,EAAE,EAAE,sBAD0B;CAE9BJ,MAAAA,MAF8B;CAG9BC,MAAAA,WAH8B;CAI9BI,MAAAA,KAAK,EAAE,KAJuB;CAK9BC,MAAAA,MAAM,EAAE,IALsB;CAM9BC,MAAAA,cAAc,EAAE,CAACb,iBAAD;CANc,KAAhB,CAAf;CAQAc,IAAAA,6BAAY,CAACC,SAAb,CAAuB,KAAKP,OAA5B,EAAqC,SAArC,EAAgD,KAAKhH,iBAArD;CACA4D,IAAAA,eAAK,CAAC1D,IAAN,CAAW,KAAKhB,GAAL,CAASiH,cAApB,EAAoC,OAApC,EAA6C,MAAM;CAClD,WAAKqB,WAAL;CACA,KAFD;;CAIA,QAAG,KAAKtI,GAAL,CAAS+G,iBAAZ,EACA;CACC,WAAK/G,GAAL,CAAS+G,iBAAT,CAA2BwB,WAA3B,CAAuC,KAAKT,OAAL,CAAaU,SAAb,EAAvC;CACA,WAAKxI,GAAL,CAAS+G,iBAAT,CAA2B0B,UAA3B,CAAsCC,UAAtC,CAAiD,CAAjD,EAAoDtB,MAApD;;CACA,UAAG,CAAC,KAAKnH,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCmI,wBAArC,EACA;CACC,aAAKC,WAAL;CACA;CACD;CACD;;CAEDN,EAAAA,WAAW,GACX;CACC,QAAI,CAAC,KAAKR,OAAV,EACA;CACC;CACA;;CACD,QAAI,KAAKA,OAAL,CAAae,OAAb,EAAJ,EACA;CACC,WAAK9H,WAAL;CACA,KAHD,MAKA;CACC,WAAK6H,WAAL;CACA;CACD;;CAEDzE,EAAAA,gBAAgB,GAChB;CACC;CACA,QAAI,KAAKjE,oBAAT,EACA;CACC,WAAKF,GAAL,CAAS8E,iBAAT,CAA2BnF,OAA3B,CAAmCmJ,MAAnC,GAA4C,CAA5C;CAEA,YAAMC,QAAQ,GAAG,KAAK9I,eAAL,CAAqB+I,cAArB,CAAoCC,qBAApC,EAAjB;CACA,UAAIC,UAAU,GAAGC,QAAQ,CAAC,KAAKlJ,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,YAAxC,CAAD,CAAzB;CACA,UAAIqD,WAAW,GAAGD,QAAQ,CAAC,KAAKlJ,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,aAAxC,CAAD,CAA1B;CACA,UAAIsD,OAAJ;CACA,UAAIC,QAAJ;;CAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,QAAQ,CAACD,MAA7B,EAAqCS,CAAC,EAAtC,EACA;CACCF,QAAAA,OAAO,GAAGN,QAAQ,CAACQ,CAAD,CAAlB;;CACA,YAAIF,OAAO,CAACG,cAAR,EAAJ,EACA;CACC,cAAI,CAACJ,WAAL,EACA;CACCA,YAAAA,WAAW,GAAGC,OAAO,CAACrB,EAAtB;CACA;;CACDsB,UAAAA,QAAQ,GAAGF,WAAW,KAAKD,QAAQ,CAACE,OAAO,CAACrB,EAAT,CAAnC;CACA,eAAKhI,GAAL,CAAS8E,iBAAT,CAA2BnF,OAA3B,CAAmC8J,GAAnC,CAAuC,IAAIC,MAAJ,CAAWL,OAAO,CAACxJ,IAAnB,EAAyBwJ,OAAO,CAACrB,EAAjC,EAAqCsB,QAArC,EAA+CA,QAA/C,CAAvC;;CAEA,cAAI,CAACJ,UAAL,EACA;CACCA,YAAAA,UAAU,GAAGG,OAAO,CAACrB,EAArB;CACA;;CACDsB,UAAAA,QAAQ,GAAGJ,UAAU,KAAKC,QAAQ,CAACE,OAAO,CAACrB,EAAT,CAAlC;CACA,eAAKhI,GAAL,CAAS+E,SAAT,CAAmBpF,OAAnB,CAA2B8J,GAA3B,CAA+B,IAAIC,MAAJ,CAAWL,OAAO,CAACxJ,IAAnB,EAAyBwJ,OAAO,CAACrB,EAAjC,EAAqCsB,QAArC,EAA+CA,QAA/C,CAA/B;CACA;CACD;CACD;;CAED,QAAG,KAAKtJ,GAAL,CAASgF,YAAZ,EACA;CACC,WAAKhF,GAAL,CAASgF,YAAT,CAAsB2E,OAAtB,GAAgC,KAAK1J,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,cAAxC,CAAhC;CACA;;CAED,QAAId,SAAS,GAAG,KAAKhF,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,WAAxC,MAAyD,GAAzE;;CACA,QAAG,KAAK/F,GAAL,CAASiF,SAAZ,EACA;CACC,WAAKjF,GAAL,CAASiF,SAAT,CAAmB0E,OAAnB,GAA6B1E,SAA7B;CACAtE,MAAAA,EAAE,CAAC+D,KAAH,CAAS1D,IAAT,CAAc,KAAKhB,GAAL,CAASiF,SAAvB,EAAkC,OAAlC,EAA2C,YAAU;CACpD,YAAG,KAAKjF,GAAL,CAASmF,kBAAZ,EACA;CACC,eAAKnF,GAAL,CAASmF,kBAAT,CAA4BkB,QAA5B,GAAuC,CAAC,KAAKrG,GAAL,CAASiF,SAAT,CAAmB0E,OAA3D;CACA,eAAK3J,GAAL,CAASmF,kBAAT,CAA4BwE,OAA5B,GAAsC,KAAK3J,GAAL,CAASmF,kBAAT,CAA4BwE,OAA5B,IAAuC,KAAK3J,GAAL,CAASiF,SAAT,CAAmB0E,OAAhG;CACA;;CACD,YAAG,KAAK3J,GAAL,CAASkF,SAAZ,EACA;CACC,eAAKlF,GAAL,CAASkF,SAAT,CAAmBmB,QAAnB,GAA8B,CAAC,KAAKrG,GAAL,CAASiF,SAAT,CAAmB0E,OAAlD;CACA,eAAK3J,GAAL,CAASkF,SAAT,CAAmByE,OAAnB,GAA6B,KAAK3J,GAAL,CAASkF,SAAT,CAAmByE,OAAnB,IAA8B,KAAK3J,GAAL,CAASiF,SAAT,CAAmB0E,OAA9E;CACA;CACD,OAX0C,CAWzC3I,IAXyC,CAWpC,IAXoC,CAA3C;CAYA;;CACD,QAAG,KAAKhB,GAAL,CAASmF,kBAAZ,EACA;CACC,WAAKnF,GAAL,CAASmF,kBAAT,CAA4BwE,OAA5B,GAAsC,KAAK1J,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,oBAAxC,MAAkE,GAAlE,IAAyE,KAAK/F,GAAL,CAASiF,SAAT,CAAmB0E,OAAlI;CACA,WAAK3J,GAAL,CAASmF,kBAAT,CAA4BkB,QAA5B,GAAuC,CAACpB,SAAxC;CACA;;CACD,QAAG,KAAKjF,GAAL,CAASkF,SAAZ,EACA;CACC,WAAKlF,GAAL,CAASkF,SAAT,CAAmByE,OAAnB,GAA6B,KAAK1J,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,WAAxC,MAAyD,GAAzD,IAAgE,KAAK/F,GAAL,CAASiF,SAAT,CAAmB0E,OAAhH;CACA,WAAK3J,GAAL,CAASkF,SAAT,CAAmBmB,QAAnB,GAA8B,CAACpB,SAA/B;CACA;;CAED,QAAI,KAAKjF,GAAL,CAAS4E,kBAAb,EACA;CACC,WAAK5E,GAAL,CAAS4E,kBAAT,CAA4B+E,OAA5B,GAAsC,KAAK1J,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,oBAAxC,CAAtC;CACA;;CAED,QAAI,KAAK/F,GAAL,CAAS6E,eAAb,EACA;CACC,WAAK7E,GAAL,CAAS6E,eAAT,CAAyB8E,OAAzB,GAAmC,KAAK1J,eAAL,CAAqBM,IAArB,CAA0BqJ,cAA1B,EAAnC;CACA;;CAED,QAAG,KAAK5J,GAAL,CAASoF,cAAZ,EACA;CACC,WAAKpF,GAAL,CAASoF,cAAT,CAAwByE,KAAxB,GAAgC,KAAK5J,eAAL,CAAqBM,IAArB,CAA0BwF,aAA1B,CAAwC,cAAxC,KAA2D,EAA3F;CACA;;CAED,QAAI,KAAK5F,mBAAT,EACA;CACC;CACA,WAAKH,GAAL,CAAS0G,aAAT,CAAuBmD,KAAvB,GAA+B,KAAKnJ,QAAL,CAAcoJ,eAA7C;CACA,WAAK9J,GAAL,CAAS2G,WAAT,CAAqBkD,KAArB,GAA6B,KAAKnJ,QAAL,CAAcqJ,aAA3C;;CAEA,UAAI,KAAK/J,GAAL,CAAS4G,YAAb,EACA;CACC,aAAI,IAAI2C,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKvJ,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8BmJ,MAAjD,EAAyDS,CAAC,EAA1D,EACA;CACC,eAAKvJ,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8B4J,CAA9B,EAAiCD,QAAjC,GACC,KAAK5I,QAAL,CAAcsJ,aAAd,CAA4BC,QAA5B,CAAqC,KAAKjK,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8B4J,CAA9B,EAAiCM,KAAtE,CADD;CAEA;CACD;;CAED,WAAK7J,GAAL,CAAS6G,YAAT,CAAsBgD,KAAtB,GAA8B,KAAKnJ,QAAL,CAAcwJ,aAA5C;CACA,WAAKlK,GAAL,CAAS8G,YAAT,CAAsB+C,KAAtB,GAA8B,KAAKnJ,QAAL,CAAcyJ,aAA5C;CACA,KAnGF;;;CAsGC,QAAI,KAAK/J,iBAAL,IACAC,cAAI,CAACiF,aAAL,CAAmB,KAAKtF,GAAL,CAASgH,eAA5B,CADJ,EAEA;CACC,YAAMoD,UAAU,GAAG,KAAKnK,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCC,WAApD;;CACA,WAAK,IAAI4J,IAAT,IAAiBD,UAAjB,EACA;CACC,YAAIA,UAAU,CAACE,cAAX,CAA0BD,IAA1B,CAAJ,EACA;CACC,eAAKE,eAAL,CACC,KAAKtK,eAAL,CAAqBM,IAArB,CAA0BiK,aAA1B,CAAwCH,IAAxC,CADD,EAECA,IAFD,EAGCD,UAAU,CAACC,IAAD,CAHX;CAKA;CACD;CACD;CACD;;CAED1F,EAAAA,IAAI,GACJ;CACC,UAAM8F,YAAY,GAAG,KAAKxK,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCiK,YAAtD,CADD;;CAIC,QAAI,KAAKzK,GAAL,CAASgF,YAAb,EACA;CACCyF,MAAAA,YAAY,CAACzF,YAAb,GAA4B,KAAKhF,GAAL,CAASgF,YAAT,CAAsB2E,OAAtB,GAAgC,CAAhC,GAAoC,CAAhE;CACA;;CAED,QAAI,KAAK3J,GAAL,CAAS6E,eAAb,EACA;CACC4F,MAAAA,YAAY,CAAC5F,eAAb,GAA+B,KAAK7E,GAAL,CAAS6E,eAAT,CAAyB8E,OAAzB,GAAmC,GAAnC,GAAyC,GAAxE;CACA;;CAED,QAAI,KAAK3J,GAAL,CAASiF,SAAb,EACA;CACCwF,MAAAA,YAAY,CAACxF,SAAb,GAAyB,KAAKjF,GAAL,CAASiF,SAAT,CAAmB0E,OAAnB,GAA6B,GAA7B,GAAmC,GAA5D;CACA;;CACD,QAAI,KAAK3J,GAAL,CAASkF,SAAb,EACA;CACCuF,MAAAA,YAAY,CAACvF,SAAb,GAAyB,KAAKlF,GAAL,CAASkF,SAAT,CAAmByE,OAAnB,GAA6B,GAA7B,GAAmC,GAA5D;CACA;;CACD,QAAI,KAAK3J,GAAL,CAASmF,kBAAb,EACA;CACCsF,MAAAA,YAAY,CAACtF,kBAAb,GAAkC,KAAKnF,GAAL,CAASmF,kBAAT,CAA4BwE,OAA5B,GAAsC,GAAtC,GAA4C,GAA9E;CACA;;CAED,QAAI,KAAK3J,GAAL,CAAS8E,iBAAb,EACA;CACC2F,MAAAA,YAAY,CAACrB,WAAb,GAA2B,KAAKpJ,GAAL,CAAS8E,iBAAT,CAA2B+E,KAAtD;CACA;;CACD,QAAI,KAAK7J,GAAL,CAAS+E,SAAb,EACA;CACC0F,MAAAA,YAAY,CAACvB,UAAb,GAA0B,KAAKlJ,GAAL,CAAS+E,SAAT,CAAmB8E,KAA7C;CACA;;CAED,QAAI,KAAK7J,GAAL,CAAS4E,kBAAb,EACA;CACC6F,MAAAA,YAAY,CAAC7F,kBAAb,GAAkC,KAAK5E,GAAL,CAAS4E,kBAAT,CAA4B+E,OAA5B,GAAsC,CAAtC,GAA0C,CAA5E;CACA;;CAEDc,IAAAA,YAAY,CAACC,gBAAb,GAAgC,KAAK1K,GAAL,CAASoF,cAAT,GAC7B,KAAKpF,GAAL,CAASoF,cAAT,CAAwByE,KADK,GAE7BY,YAAY,CAACE,YAFhB;;CAIA,QAAI,KAAKpF,oBAAT,EACA;CACCkF,MAAAA,YAAY,CAACG,aAAb,GAA6B,KAAKrF,oBAAL,CAA0BsF,QAA1B,EAA7B;CACA;;CAED,UAAMxH,IAAI,GAAG;CACZ6D,MAAAA,IAAI,EAAE,KAAKjH,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiC0G,IAD3B;CAEZ4D,MAAAA,aAAa,EAAEL,YAFH;CAGZM,MAAAA,kBAAkB,EAAEN,YAAY,CAACC;CAHrB,KAAb;;CAMA,QAAI,KAAKvK,mBAAL,IAA4B,KAAKH,GAAL,CAAS0G,aAAzC,EACA;CACCrD,MAAAA,IAAI,CAAC3C,QAAL,GAAgB;CACfoJ,QAAAA,eAAe,EAAE,KAAK9J,GAAL,CAAS0G,aAAT,CAAuBmD,KADzB;CAEfE,QAAAA,aAAa,EAAE,KAAK/J,GAAL,CAAS2G,WAAT,CAAqBkD,KAFrB;CAGfG,QAAAA,aAAa,EAAE,EAHA;CAIfE,QAAAA,aAAa,EAAE,KAAKlK,GAAL,CAAS6G,YAAT,CAAsBgD,KAJtB;CAKfM,QAAAA,aAAa,EAAE,KAAKnK,GAAL,CAAS8G,YAAT,CAAsB+C;CALtB,OAAhB;;CAQA,WAAI,IAAIN,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKvJ,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8BmJ,MAAjD,EAAyDS,CAAC,EAA1D,EACA;CACC,YAAI,KAAKvJ,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8B4J,CAA9B,EAAiCD,QAArC,EACA;CACCjG,UAAAA,IAAI,CAAC3C,QAAL,CAAcsJ,aAAd,CAA4BgB,IAA5B,CAAiC,KAAKhL,GAAL,CAAS4G,YAAT,CAAsBjH,OAAtB,CAA8B4J,CAA9B,EAAiCM,KAAlE;CACA;CACD;CACD;;CAED,QAAI,KAAKzJ,iBAAT,EACA;CACCiD,MAAAA,IAAI,CAAC4H,WAAL,GAAmB,KAAKC,MAAxB;CACA;;CAEDvK,IAAAA,EAAE,CAACwC,IAAH,CAAQC,SAAR,CACC,wCADD,EAEC;CACEC,MAAAA,IAAI,EAAEA;CADR,KAFD,EAKEE,IALF,CAKO,MAAM;CAAC5C,MAAAA,EAAE,CAACwK,MAAH;CAAa,KAL3B;CAOA,SAAK5I,KAAL;CACA;;CAED8E,EAAAA,oBAAoB,GACpB;CAAA;;CACC,SAAKrH,GAAL,CAASoL,UAAT,GAAsB,KAAKpL,GAAL,CAASgH,eAAT,CAAyBuB,WAAzB,CACrBhB,aAAG,CAACC,MADiB,gBACV;;;QADU,CAMhB;;;QANgB,CAapB;;WAboB,GAIhB,KAAKxH,GAAL,CAASqL,WAAT,GAAuB9D,aAAG,CAACC,MAA3B,gBAAkC;;OAAlC,EAJgB,EAShB,KAAKxH,GAAL,CAASsL,YAAT,GAAwB/D,aAAG,CAACC,MAA5B,gBAAoC;;UAApC,CAE6C;eAF7C,GAEEC,aAAG,CAACC,UAAJ,CAAe,0BAAf,CAFF,CATgB,EAAtB;CAkBA,SAAKwD,MAAL,GAAc,EAAd;CACA,SAAKK,cAAL,GAAsB,EAAtB;CACA,SAAKC,WAAL,4BAAmB,KAAKvL,eAAxB,+CAAmB,sBAAsBM,IAAzC,qBAAmB,uBAA4BkL,kBAA5B,EAAnB;;CAEA,kCAAI,KAAKxL,eAAT,uCAAI,uBAAsBM,IAA1B,uCAAI,uBAA4BC,MAAhC,aAAI,uBAAoCkL,WAAxC,EACA;CACC9K,MAAAA,kBAAI,CAAC+K,cAAL,CAAoB,KAAK1L,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCkL,WAArD;CACA;;CAEDhH,IAAAA,eAAK,CAAC1D,IAAN,CAAW,KAAKhB,GAAL,CAASsL,YAApB,EAAkC,OAAlC,EAA2C,MAAM;CAChD,WAAKM,oBAAL,GAA4B,IAAIC,wBAAJ,CAAyB;CACpDC,QAAAA,UAAU,EAAE,KAAK9L,GAAL,CAASsL,YAD+B;CAEpDS,QAAAA,OAAO,EAAE,UAF2C;CAGpDC,QAAAA,gBAAgB,EAAE,EAHkC;CAIpDC,QAAAA,YAAY,EAAE,IAJsC;CAKpDxK,QAAAA,MAAM,EAAE;CACP,2BAAiB,KAAKyK,2BAAL,CAAiClL,IAAjC,CAAsC,IAAtC,CADV;CAEP,6BAAmB,KAAKkL,2BAAL,CAAiClL,IAAjC,CAAsC,IAAtC;CAFZ,SAL4C;CASpDmL,QAAAA,YAAY,EAAE;CACbC,UAAAA,eAAe,EAAEC,QAAQ,CAACC;CADb,SATsC;CAYpDC,QAAAA,QAAQ,EAAE,CACT;CACCvE,UAAAA,EAAE,EAAE;CADL,SADS,EAIT;CACCA,UAAAA,EAAE,EAAE;CADL,SAJS,EAOT;CACCA,UAAAA,EAAE,EAAE,YADL;CAECrI,UAAAA,OAAO,EAAE;CAAC6M,YAAAA,UAAU,EAAE;CAAb;CAFV,SAPS,EAWT;CACCxE,UAAAA,EAAE,EAAE,WADL;CAECrI,UAAAA,OAAO,EAAE;CAAE,yBAAa;CAAf;CAFV,SAXS;CAZ0C,OAAzB,CAA5B;CA6BA,WAAKiM,oBAAL,CAA0B3K,IAA1B;CACA,WAAK2K,oBAAL,CAA0BvD,SAA1B,CAAoC,QAApC,EAA8C,KAAKxF,gBAAL,CAAsB7B,IAAtB,CAA2B,IAA3B,CAA9C;CACA,WAAK4B,eAAL;CACA,KAjCD;CAmCA8B,IAAAA,eAAK,CAAC1D,IAAN,CAAW,KAAKhB,GAAL,CAASoL,UAApB,EAAgC,OAAhC,EAA0CqB,CAAD,IAAO;CAC/C,YAAMC,MAAM,GAAG9L,kBAAI,CAAC+L,cAAL,CAAoBF,CAAC,CAACC,MAAF,IAAYD,CAAC,CAACG,UAAlC,EAA8C,KAAK5M,GAAL,CAAS6M,SAAvD,CAAf;;CACA,UAAIxM,cAAI,CAACiF,aAAL,CAAmBoH,MAAnB,CAAJ,EACA;CACC,YAAGA,MAAM,CAACI,YAAP,CAAoB,kCAApB,MAA4D,IAA/D,EACA;CACC;CACA,gBAAMzC,IAAI,GAAGqC,MAAM,CAACI,YAAP,CAAoB,kCAApB,CAAb;;CACA,cAAI,KAAKvB,cAAL,CAAoBlB,IAApB,CAAJ,EACA;CACC,iBAAK0C,uBAAL,CAA6B;CAC3BC,cAAAA,IAAI,EAAE,KAAKzB,cAAL,CAAoBlB,IAApB,EAA0B4C,UADL;CAE3BC,cAAAA,gBAAgB,EAAGrD,KAAD,IAAW;CAC5B,oBAAI,KAAK2B,WAAL,CAAiB3B,KAAjB,KAA2B,KAAK0B,cAAL,CAAoBlB,IAApB,CAA/B,EACA;CACC,uBAAKkB,cAAL,CAAoBlB,IAApB,EAA0B8C,SAA1B,CAAoCC,SAApC,GACCC,cAAI,CAACC,MAAL,CAAY,KAAK9B,WAAL,CAAiB3B,KAAjB,EAAwB0D,KAApC,CADD;CAEA,uBAAKrC,MAAL,CAAYb,IAAZ,IAAoBR,KAApB;CACA;CACD;CAT0B,aAA7B;CAYA;CACD,SAnBD,MAoBK,IAAG6C,MAAM,CAACI,YAAP,CAAoB,gCAApB,MAA0D,IAA7D,EACL;CACC,gBAAMzC,IAAI,GAAGqC,MAAM,CAACI,YAAP,CAAoB,gCAApB,CAAb;;CACA,cAAI,KAAKvB,cAAL,CAAoBlB,IAApB,CAAJ,EACA;CACClE,YAAAA,aAAG,CAACiB,MAAJ,CAAW,KAAKmE,cAAL,CAAoBlB,IAApB,EAA0BmD,OAArC;CACA,iBAAKjC,cAAL,CAAoBlB,IAApB,IAA4B,IAA5B;CACA,mBAAO,KAAKa,MAAL,CAAYb,IAAZ,CAAP;CACA;CACD;CACD;CACD,KAnCD;CAoCA;;CAED6B,EAAAA,2BAA2B,GAC3B;CACC,UAAMuB,UAAU,GAAG,KAAK7B,oBAAL,CAA0B8B,gBAA1B,EAAnB;CACA,SAAK9B,oBAAL,CAA0B/J,IAA1B;;CACA,QAAIxB,cAAI,CAACsN,OAAL,CAAaF,UAAb,CAAJ,EACA;CACCA,MAAAA,UAAU,CAACG,OAAX,CAAoBC,MAAD,IAAY;CAC9B,cAAMN,KAAK,GAAGM,MAAM,CAACN,KAAP,CAAaO,IAA3B;CACA,cAAMzD,IAAI,GAAGzJ,kBAAI,CAACmN,yBAAL,CAA+BF,MAA/B,CAAb;CACAjN,QAAAA,kBAAI,CAACoN,aAAL,CAAmB3D,IAAnB,EAAyBkD,KAAzB;CACA,aAAKhD,eAAL,CAAqBgD,KAArB,EAA4BlD,IAA5B;CACA,OALD;CAMA;;CAED4D,IAAAA,iBAAO,CAACC,QAAR,CAAiB,MAAM;CACtB,WAAKtC,oBAAL,CAA0B7J,OAA1B;CACA,KAFD,EAEG,GAFH;CAGA;;CAEDwI,EAAAA,eAAe,CAACgD,KAAD,EAAQlD,IAAR,EAAcR,KAAd,EACf;CACC,QAAI,CAAC,KAAK0B,cAAL,CAAoBlB,IAApB,CAAL,EACA;CACC,UAAIR,KAAK,KAAKsE,SAAd,EACA;CACC,aAAI,IAAIC,MAAR,IAAkB,KAAK5C,WAAvB,EACA;CACC,cACC,KAAKA,WAAL,CAAiBlB,cAAjB,CAAgC8D,MAAhC,KACG,KAAK5C,WAAL,CAAiB4C,MAAjB,EAAyBvO,IAAzB,KAAkC,oBAFtC,EAIA;CACCgK,YAAAA,KAAK,GAAGuE,MAAR;CACA;CACA;CACD;CACD;;CAED,YAAMZ,OAAO,GAAGrH,aAAG,CAACkI,MAAJ,CACd,KAAKrO,GAAL,CAASqL,WAAT,CAAqBiD,SAArB,CAA+B,CAAC,CAAhC,CADc,EAEd;CAACC,QAAAA,KAAK,EAAG;CAACC,UAAAA,SAAS,EAAE;CAAZ;CAAT,OAFc,CAAhB;CAIA,YAAMC,SAAS,GAAGtI,aAAG,CAACkI,MAAJ,CAAWb,OAAO,CAACkB,UAAR,CAAmB,CAAC,CAApB,CAAX,EAAmC;CACnDH,QAAAA,KAAK,EAAG;CAACC,UAAAA,SAAS,EAAE;CAAZ,SAD2C;CAEnD7K,QAAAA,IAAI,EAAE,wDAAwD0J,cAAI,CAACC,MAAL,CAAYC,KAAZ,CAAxD,GAA6E;CAFhC,OAAnC,CAAlB;CAGA,YAAMoB,SAAS,GAAGxI,aAAG,CAACkI,MAAJ,CAAWb,OAAO,CAACkB,UAAR,CAAmB,CAAC,CAApB,CAAX,EAAmC;CACnDH,QAAAA,KAAK,EAAG;CAACC,UAAAA,SAAS,EAAE;CAAZ,SAD2C;CAEnDI,QAAAA,KAAK,EAAE;CAAC,8CAAoCvE;CAArC;CAF4C,OAAnC,CAAlB;CAIA,YAAM5E,UAAU,GAAGkJ,SAAS,CAACpG,WAAV,CAAsBpC,aAAG,CAAC0I,MAAJ,CAAW,MAAX,EAAmB;CAC1DN,QAAAA,KAAK,EAAE;CAACC,UAAAA,SAAS,EAAE;CAAZ;CADmD,OAAnB,CAAtB,CAAnB;CAGA,YAAMrB,SAAS,GAAG1H,UAAU,CAAC8C,WAAX,CAAuBpC,aAAG,CAAC0I,MAAJ,CAAW,MAAX,EAAmB;CAC1Df,QAAAA,IAAI,EAAE,KAAKtC,WAAL,CAAiB3B,KAAjB,IAA0B,KAAK2B,WAAL,CAAiB3B,KAAjB,EAAwB0D,KAAlD,GAA0D,EADN;CAE1DgB,QAAAA,KAAK,EAAE;CAACC,UAAAA,SAAS,EAAE;CAAZ;CAFmD,OAAnB,CAAvB,CAAlB;CAIA,YAAMvB,UAAU,GAAGxH,UAAU,CAAC8C,WAAX,CAAuBpC,aAAG,CAAC0I,MAAJ,CAAW,MAAX,EAAmB;CAC3DN,QAAAA,KAAK,EAAE;CAACC,UAAAA,SAAS,EAAE;CAAZ,SADoD;CAE3DI,QAAAA,KAAK,EAAE;CAAC,4CAAkCvE;CAAnC;CAFoD,OAAnB,CAAvB,CAAnB;CAKA,WAAKa,MAAL,CAAYb,IAAZ,IAAoBR,KAApB;CAEA,WAAK0B,cAAL,CAAoBlB,IAApB,IAA4B;CAC3BmD,QAAAA,OAAO,EAAEA,OADkB;CAE3BiB,QAAAA,SAAS,EAAEA,SAFgB;CAG3BtB,QAAAA,SAAS,EAAEA,SAHgB;CAI3BF,QAAAA,UAAU,EAAEA;CAJe,OAA5B;CAMA;CACD;;CAED6B,EAAAA,sBAAsB,GACtB;CACC,QAAI,KAAKC,iBAAT,EACA;CACC,WAAKA,iBAAL,GAAyBC,YAAY,CAAC,KAAKD,iBAAN,CAArC;CACA;;CAED,SAAKA,iBAAL,GAAyBE,UAAU,CAAC,MAAM;CACzC,UAAI9I,aAAG,CAAC+I,QAAJ,CAAa,KAAKlP,GAAL,CAASoL,UAAtB,EAAkC,OAAlC,CAAJ,EACA;CACC,YAAI,KAAKpL,GAAL,CAASoL,UAAT,CAAoB+D,YAApB,GAAmC,KAAKnP,GAAL,CAASqL,WAAT,CAAqB8D,YAAxD,GAAuE,EAA3E,EACA;CACC,eAAKnP,GAAL,CAASoL,UAAT,CAAoBgE,KAApB,CAA0BC,SAA1B,GAAsClG,QAAQ,CAAC,KAAKnJ,GAAL,CAASqL,WAAT,CAAqB8D,YAAtB,CAAR,GAA8C,GAA9C,GAAoD,IAA1F;CACA;CACD,OAND,MAQA;CACC,aAAKnP,GAAL,CAASoL,UAAT,CAAoBgE,KAApB,CAA0BC,SAA1B,GAAsC,EAAtC;CACA;CACD,KAZkC,EAYhC,GAZgC,CAAnC;CAaA;;CAEDtC,EAAAA,uBAAuB,CAACnJ,MAAD,EACvB;CACC,QACC,KAAK0L,eAAL,IACG,KAAKA,eAAL,CAAqBC,WADxB,IAEG,KAAKD,eAAL,CAAqBC,WAArB,CAAiC1G,OAAjC,EAHJ,EAKA;CACC,aAAO,KAAKyG,eAAL,CAAqB/M,KAArB,EAAP;CACA;;CAED,UAAMiN,KAAK,GAAG,IAAd;;CACA,UAAMC,SAAS,GAAG,EAAlB;;CAEA,SAAI,IAAIrB,MAAR,IAAkB,KAAK5C,WAAvB,EACA;CACC,UAAI,KAAKA,WAAL,CAAiBlB,cAAjB,CAAgC8D,MAAhC,CAAJ,EACA;CACCqB,QAAAA,SAAS,CAACzE,IAAV,CACC;CACC8C,UAAAA,IAAI,EAAE,KAAKtC,WAAL,CAAiB4C,MAAjB,EAAyBb,KADhC;CAECmC,UAAAA,OAAO,EAAG,UAAU7F,KAAV,EACV;CACC,mBAAO,YACP;CACCjG,cAAAA,MAAM,CAACsJ,gBAAP,CAAwBrD,KAAxB;;CACA2F,cAAAA,KAAK,CAACF,eAAN,CAAsB/M,KAAtB;CACA,aAJD;CAKA,WAPQ,CAON6L,MAPM;CAFV,SADD;CAaA;CACD;;CAED,SAAKkB,eAAL,GAAuB,KAAK3O,EAAL,CAAQgP,SAAR,CAAkBd,MAAlB,CACtB,yBAAyBjO,kBAAI,CAACgP,SAAL,EADH,EAEtBhM,MAAM,CAACoJ,IAFe,EAGtByC,SAHsB,EAItB;CACCI,MAAAA,UAAU,EAAG,IADd;CAECC,MAAAA,QAAQ,EAAG,IAFZ;CAGCC,MAAAA,SAAS,EAAE,CAAC,CAHb;CAICC,MAAAA,UAAU,EAAE,CAJb;CAKC/H,MAAAA,KAAK,EAAE,IALR;CAMCgI,MAAAA,SAAS,EAAE,KANZ;CAOCxO,MAAAA,MAAM,EACN;CACCyO,QAAAA,YAAY,EAAG,KAAKrN,gBAAL,CAAsB7B,IAAtB,CAA2B,IAA3B;CADhB;CARD,KAJsB,CAAvB;CAkBA,SAAKsO,eAAL,CAAqBrO,IAArB;CACA,SAAK2B,eAAL;CACA;;CAED+E,EAAAA,YAAY,GACZ;CACC,QAAIwI,YAAY,GAAG,QAAnB;CACAjN,IAAAA,GAAG,CAACvC,EAAJ,CAAOiF,MAAP,CAAc3E,IAAd,CAAmB,0BAA0BkP,YAA7C;CACA;;CAEDvH,EAAAA,WAAW,GACX;CACC,QAAI,KAAKd,OAAT,EACA;CACC,WAAKA,OAAL,CAAa7G,IAAb;CACA,WAAKjB,GAAL,CAAS+G,iBAAT,CAA2BqI,KAA3B,CAAiCC,SAAjC,GAA6C,MAAM,IAAnD;CACAlJ,MAAAA,aAAG,CAACG,QAAJ,CAAa,KAAKtG,GAAL,CAASiH,cAAtB,EAAsC,wCAAtC;CACA;CACD;;CAEDlG,EAAAA,WAAW,GACX;CACC,QAAI,KAAK+G,OAAT,EACA;CACC3B,MAAAA,aAAG,CAACC,WAAJ,CAAgB,KAAKpG,GAAL,CAASiH,cAAzB,EAAyC,wCAAzC;CACA,WAAKa,OAAL,CAAajG,IAAb;CACA,WAAK7B,GAAL,CAAS+G,iBAAT,CAA2BqI,KAA3B,CAAiCC,SAAjC,GAA6C,CAA7C;;CACA,UAAG,CAAC,KAAKpP,eAAL,CAAqBM,IAArB,CAA0BC,MAA1B,CAAiCmI,wBAArC,EACA;CACChI,QAAAA,EAAE,CAACwC,IAAH,CAAQC,SAAR,CAAkB,oDAAlB,EACE;CACCC,UAAAA,IAAI,EAAE;CACLwG,YAAAA,KAAK,EAAE;CADF;CADP,SADF,EAMEtG,IANF,CAMO,MAAM,EANb;CAOA;CACD;CACD;;CA1wBF;;;;;;;;"}