{"version":3,"file":"settingsinterface.bundle.js","sources":["../src/settingsinterface.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport {EmailSelectorControl} from 'calendar.controls';\nimport { Type, Event, Loc, Tag, Dom, Text, Runtime } from 'main.core';\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageCard } from 'ui.messagecard';\n\ntype SettingsInterfaceOptions = {\n\tname: string;\n\tcalendarContext: any,\n\tshowPersonalSettings: boolean,\n\tshowGeneralSettings: boolean,\n\tshowAccessControl: boolean,\n\tsettings: any\n};\n\nexport class SettingsInterface\n{\n\tsliderId: string = \"calendar:settings-slider\";\n\tname: string = 'SettingsInterface';\n\tSLIDER_WIDTH: number = 500;\n\tSLIDER_DURATION: number = 80;\n\tDOM: any = {};\n\n\tconstructor(options: SettingsInterfaceOptions)\n\t{\n\t\tthis.calendarContext = options.calendarContext;\n\t\tthis.showPersonalSettings = options.showPersonalSettings;\n\t\tthis.showGeneralSettings = options.showGeneralSettings;\n\t\tthis.showAccessControl = options.showAccessControl !== false\n\t\t\t&& Type.isObjectLike(this.calendarContext.util.config.TYPE_ACCESS);\n\n\t\tthis.settings = options.settings;\n\t\tthis.BX = Util.getBX();\n\t\tthis.hideMessageBinded = this.hideMessage.bind(this);\n\t}\n\n\tshow()\n\t{\n\t\tthis.BX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: this.createContent.bind(this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION,\n\t\t\tevents: {\n\t\t\t\tonCloseByEsc: this.escHide.bind(this),\n\t\t\t\tonClose: this.hide.bind(this),\n\t\t\t\tonCloseComplete: this.destroy.bind(this),\n\t\t\t\tonLoad: this.onLoadSlider.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\n\tescHide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId && this.denyClose)\n\t\t{\n\t\t\tevent.denyAction();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.isOpenedState = false;\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisOpened()\n\t{\n\t\treturn this.isOpenedState;\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\tif (this.denyClose)\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", BX.proxy(this.hide, this));\n\t\t\t}\n\t\t}\n\t}\n\n\tdenySliderClose()\n\t{\n\t\tthis.denyClose = true;\n\t}\n\n\tallowSliderClose()\n\t{\n\t\tthis.denyClose = false;\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// this.destroyEventEmitterSubscriptions();\n\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:delete', this.deleteSectionHandlerBinded);\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:pull-delete', this.deleteSectionHandlerBinded);\n\n\t\t\t// BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", BX.proxy(this.destroy, this));\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t\tdelete this.DOM.sectionListWrap;\n\t\t}\n\t}\n\n\tcreateContent(slider: BX.Intranet.Bitrix24.Slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\ttop.BX.ajax.runAction('calendar.api.calendarajax.getSettingsSlider', {\n\t\t\t\tdata: {\n\t\t\t\t\tshowPersonalSettings: this.showPersonalSettings ? 'Y' : 'N',\n\t\t\t\t\tshowGeneralSettings: this.showGeneralSettings ? 'Y' : 'N',\n\t\t\t\t\tshowAccessControl: this.showAccessControl ? 'Y' : 'N',\n\t\t\t\t\tuid: this.uid\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response: any) => {\n\t\t\t\t\tslider.getData().set(\"sliderContent\", response.data.html);\n\t\t\t\t\tconst params = response.data.additionalParams;\n\n\t\t\t\t\tthis.mailboxList = params.mailboxList;\n\t\t\t\t\tthis.uid = params.uid;\n\n\t\t\t\t\tresolve(response.data.html);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tonLoadSlider(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tthis.DOM.content = slider.layout.content;\n\t\tthis.sliderId = slider.getUrl();\n\n\t\t// Used to execute javasctipt and attach CSS from ajax responce\n\t\tBX.html(slider.layout.content, slider.getData().get(\"sliderContent\"));\n\t\tthis.initControls();\n\t\tthis.setControlsValue();\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.buttonsWrap = this.DOM.content.querySelector('.calendar-form-buttons-fixed');\n\t\tBX.ZIndexManager.register(this.DOM.buttonsWrap);\n\n\t\tthis.DOM.saveBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"save_btn\"]');\n\t\tthis.DOM.closeBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"close_btn\"]');\n\n\t\tBX.Event.bind(this.DOM.saveBtn, 'click', this.save.bind(this));\n\t\tBX.Event.bind(this.DOM.closeBtn, 'click', this.close.bind(this));\n\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation = this.DOM.content.querySelector('[data-role=\"deny_busy_invitation\"]');\n\t\t\tthis.DOM.showWeekNumbers = this.DOM.content.querySelector('[data-role=\"show_week_numbers\"]');\n\n\t\t\tthis.DOM.meetSectionSelect = this.DOM.content.querySelector('[data-role=\"meet_section\"]');\n\t\t\tthis.DOM.crmSelect = this.DOM.content.querySelector('[data-role=\"crm_section\"]');\n\t\t\tthis.DOM.showDeclined = this.DOM.content.querySelector('[data-role=\"show_declined\"]');\n\t\t\tthis.DOM.showTasks = this.DOM.content.querySelector('[data-role=\"show_tasks\"]');\n\t\t\tthis.DOM.syncTasks = this.DOM.content.querySelector('[data-role=\"sync_tasks\"]');\n\t\t\tthis.DOM.showCompletedTasks = this.DOM.content.querySelector('[data-role=\"show_completed_tasks\"]');\n\t\t\tthis.DOM.timezoneSelect = this.DOM.content.querySelector('[data-role=\"set_tz_sel\"]');\n\t\t\tthis.DOM.sendFromEmailSelect = this.DOM.content.querySelector('[data-role=\"send_from_email\"]');\n\n\t\t\tif (this.BX.Type.isElementNode(this.DOM.sendFromEmailSelect))\n\t\t\t{\n\t\t\t\tthis.emailSelectorControl = new EmailSelectorControl({\n\t\t\t\t\tselectNode: this.DOM.sendFromEmailSelect,\n\t\t\t\t\tallowAddNewEmail: true,\n\t\t\t\t\tmailboxList: this.mailboxList\n\t\t\t\t});\n\n\t\t\t\tthis.DOM.emailHelpIcon = this.DOM.content.querySelector('.calendar-settings-question');\n\n\t\t\t\tif(this.DOM.emailHelpIcon && BX.Helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.emailHelpIcon,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() =>{\n\t\t\t\t\t\t\tBX.Helper.show(\"redirect=detail&code=12070142\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tUtil.initHintNode(this.DOM.emailHelpIcon);\n\t\t\t\t}\n\n\t\t\t\tthis.emailSelectorControl.setValue(this.calendarContext.util.getUserOption('sendFromEmail'));\n\n\t\t\t\tthis.DOM.emailWrap = this.DOM.content.querySelector('.calendar-settings-email-wrap')\n\t\t\t\tif (BX.Calendar.Util.isEventWithEmailGuestAllowed())\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = true;\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.sendFromEmailSelect.parentNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tBX.UI.InfoHelper.show('limit_calendar_invitation_by_mail');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// General settings\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\tthis.DOM.workTimeStart = this.DOM.content.querySelector('[data-role=\"work_time_start\"]');\n\t\t\tthis.DOM.workTimeEnd = this.DOM.content.querySelector('[data-role=\"work_time_end\"]');\n\t\t\tthis.DOM.weekHolidays = this.DOM.content.querySelector('[data-role=\"week_holidays\"]');\n\t\t\tthis.DOM.yearHolidays = this.DOM.content.querySelector('[data-role=\"year_holidays\"]');\n\t\t\tthis.DOM.yearWorkdays = this.DOM.content.querySelector('[data-role=\"year_workdays\"]');\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap = this.DOM.content.querySelector('[data-role=\"type-access-message-card\"]');\n\t\t\tthis.DOM.accessOuterWrap = this.DOM.content.querySelector('[data-role=\"type-access-values-cont\"]');\n\t\t\tthis.DOM.accessHelpIcon = this.DOM.content.querySelector('.calendar-settings-access-hint');\n\t\t\tif(Type.isElementNode(this.DOM.accessHelpIcon) && this.calendarContext.util.type === 'location')\n\t\t\t{\n\t\t\t\tthis.initMessageControl();\n\t\t\t}\n\t\t\telse if(Type.isElementNode(this.DOM.accessHelpIcon))\n\t\t\t{\n\t\t\t\tthis.DOM.accessHelpIcon.remove();\n\t\t\t}\n\t\t\tif (Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t\t{\n\t\t\t\tthis.initAccessController();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitMessageControl()\n\t{\n\t\tconst moreMessageButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-primary\">${Loc.getMessage('EC_LOCATION_SETTINGS_MORE_INFO')}</a>\n\t\t`;\n\t\tEvent.bind(moreMessageButton, 'click', this.openHelpDesk);\n\t\tconst header = \"\";\n\t\tconst description = Loc.getMessage('EC_LOCATION_SETTINGS_MESSAGE_DESCRIPTION')\n\n\t\tthis.message = new MessageCard({\n\t\t\tid: 'locationSettingsInfo',\n\t\t\theader,\n\t\t\tdescription,\n\t\t\tangle: false,\n\t\t\thidden: true,\n\t\t\tactionElements: [moreMessageButton]\n\t\t})\n\t\tEventEmitter.subscribe(this.message, 'onClose', this.hideMessageBinded);\n\t\tEvent.bind(this.DOM.accessHelpIcon, 'click', () => {\n\t\t\tthis.onClickHint();\n\t\t});\n\n\t\tif(this.DOM.accessMessageWrap)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap.appendChild(this.message.getLayout());\n\t\t\tthis.DOM.accessMessageWrap.firstChild.childNodes[1].remove();\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tthis.showMessage();\n\t\t\t}\n\t\t}\n\t}\n\n\tonClickHint()\n\t{\n\t\tif (!this.message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.message.isShown())\n\t\t{\n\t\t\tthis.hideMessage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showMessage();\n\t\t}\n\t}\n\n\tsetControlsValue()\n\t{\n\t\t// Set personal user settings\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.meetSectionSelect.options.length = 0;\n\n\t\t\tconst sections = this.calendarContext.sectionManager.getSectionListForEdit();\n\t\t\tlet crmSection = parseInt(this.calendarContext.util.getUserOption('crmSection'));\n\t\t\tlet meetSection = parseInt(this.calendarContext.util.getUserOption('meetSection'));\n\t\t\tlet section;\n\t\t\tlet selected;\n\n\t\t\tfor (let i = 0; i < sections.length; i++)\n\t\t\t{\n\t\t\t\tsection = sections[i];\n\t\t\t\tif (section.belongsToOwner())\n\t\t\t\t{\n\t\t\t\t\tif (!meetSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmeetSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = meetSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.meetSectionSelect.options.add(new Option(section.name, section.id, selected, selected));\n\n\t\t\t\t\tif (!crmSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = crmSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.crmSelect.options.add(new Option(section.name, section.id, selected, selected));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(this.DOM.showDeclined)\n\t\t{\n\t\t\tthis.DOM.showDeclined.checked = this.calendarContext.util.getUserOption('showDeclined');\n\t\t}\n\n\t\tvar showTasks = this.calendarContext.util.getUserOption('showTasks') === 'Y';\n\t\tif(this.DOM.showTasks)\n\t\t{\n\t\t\tthis.DOM.showTasks.checked = showTasks;\n\t\t\tBX.Event.bind(this.DOM.showTasks, 'click', function(){\n\t\t\t\tif(this.DOM.showCompletedTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.showCompletedTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.showCompletedTasks.checked = this.DOM.showCompletedTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t\tif(this.DOM.syncTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.syncTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.syncTasks.checked = this.DOM.syncTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tif(this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tthis.DOM.showCompletedTasks.checked = this.calendarContext.util.getUserOption('showCompletedTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.showCompletedTasks.disabled = !showTasks;\n\t\t}\n\t\tif(this.DOM.syncTasks)\n\t\t{\n\t\t\tthis.DOM.syncTasks.checked = this.calendarContext.util.getUserOption('syncTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.syncTasks.disabled = !showTasks;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation.checked = this.calendarContext.util.getUserOption('denyBusyInvitation');\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tthis.DOM.showWeekNumbers.checked = this.calendarContext.util.showWeekNumber();\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tthis.DOM.timezoneSelect.value = this.calendarContext.util.getUserOption('timezoneName') || '';\n\t\t}\n\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\t// Set access for calendar type\n\t\t\tthis.DOM.workTimeStart.value = this.settings.work_time_start;\n\t\t\tthis.DOM.workTimeEnd.value = this.settings.work_time_end;\n\n\t\t\tif (this.DOM.weekHolidays)\n\t\t\t{\n\t\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.weekHolidays.options[i].selected =\n\t\t\t\t\t\tthis.settings.week_holidays.includes(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.DOM.yearHolidays.value = this.settings.year_holidays;\n\t\t\tthis.DOM.yearWorkdays.value = this.settings.year_workdays;\n\t\t}\n\n\t\t// Access\n\t\tif (this.showAccessControl\n\t\t\t&& Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t{\n\t\t\tconst typeAccess = this.calendarContext.util.config.TYPE_ACCESS;\n\t\t\tfor (let code in typeAccess)\n\t\t\t{\n\t\t\t\tif (typeAccess.hasOwnProperty(code))\n\t\t\t\t{\n\t\t\t\t\tthis.insertAccessRow(\n\t\t\t\t\t\tthis.calendarContext.util.getAccessName(code),\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\ttypeAccess[code]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst userSettings = this.calendarContext.util.config.userSettings;\n\n\t\t// Save user settings\n\t\tif (this.DOM.showDeclined)\n\t\t{\n\t\t\tuserSettings.showDeclined = this.DOM.showDeclined.checked ? 1 : 0;\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tuserSettings.showWeekNumbers = this.DOM.showWeekNumbers.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.showTasks)\n\t\t{\n\t\t\tuserSettings.showTasks = this.DOM.showTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.syncTasks)\n\t\t{\n\t\t\tuserSettings.syncTasks = this.DOM.syncTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tuserSettings.showCompletedTasks = this.DOM.showCompletedTasks.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.meetSectionSelect)\n\t\t{\n\t\t\tuserSettings.meetSection = this.DOM.meetSectionSelect.value;\n\t\t}\n\t\tif (this.DOM.crmSelect)\n\t\t{\n\t\t\tuserSettings.crmSection = this.DOM.crmSelect.value;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tuserSettings.denyBusyInvitation = this.DOM.denyBusyInvitation.checked ? 1 : 0;\n\t\t}\n\n\t\tuserSettings.userTimezoneName = this.DOM.timezoneSelect\n\t\t\t? this.DOM.timezoneSelect.value\n\t\t\t: userSettings.timezoneName;\n\n\t\tif (this.emailSelectorControl)\n\t\t{\n\t\t\tuserSettings.sendFromEmail = this.emailSelectorControl.getValue();\n\t\t}\n\n\t\tconst data = {\n\t\t\ttype: this.calendarContext.util.config.type,\n\t\t\tuser_settings: userSettings,\n\t\t\tuser_timezone_name: userSettings.userTimezoneName,\n\t\t};\n\n\t\tif (this.showGeneralSettings && this.DOM.workTimeStart)\n\t\t{\n\t\t\tdata.settings = {\n\t\t\t\twork_time_start: this.DOM.workTimeStart.value,\n\t\t\t\twork_time_end: this.DOM.workTimeEnd.value,\n\t\t\t\tweek_holidays: [],\n\t\t\t\tyear_holidays: this.DOM.yearHolidays.value,\n\t\t\t\tyear_workdays: this.DOM.yearWorkdays.value\n\t\t\t};\n\n\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t{\n\t\t\t\tif (this.DOM.weekHolidays.options[i].selected)\n\t\t\t\t{\n\t\t\t\t\tdata.settings.week_holidays.push(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tdata.type_access = this.access;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'calendar.api.calendarajax.saveSettings',\n\t\t\t{\n\t\t\t \tdata: data\n\t\t\t})\n\t\t\t.then(() => {BX.reload();});\n\n\t\tthis.close();\n\t}\n\n\tinitAccessController()\n\t{\n\t\tthis.DOM.accessWrap = this.DOM.accessOuterWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-list-slider-access-container shown\">\n\t\t\t\t\t<div class=\"calendar-list-slider-access-inner-wrap\">\n\t\t\t\t\t\t${this.DOM.accessTable = Tag.render`\n\t\t\t\t\t\t\t<table class=\"calendar-section-slider-access-table\" />\n\t\t\t\t\t\t`}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-list-slider-new-calendar-options-container\">\n\t\t\t\t\t\t${this.DOM.accessButton = Tag.render `\n\t\t\t\t\t\t\t<span class=\"calendar-list-slider-new-calendar-option-add\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('EC_SEC_SLIDER_ACCESS_ADD')}\n\t\t\t\t\t\t\t</span>`\n\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\n\t\tthis.access = {};\n\t\tthis.accessControls = {};\n\t\tthis.accessTasks = this.calendarContext?.util?.getTypeAccessTasks();\n\n\t\tif (this.calendarContext?.util?.config?.accessNames)\n\t\t{\n\t\t\tUtil.setAccessNames(this.calendarContext.util.config.accessNames);\n\t\t}\n\n\t\tEvent.bind(this.DOM.accessButton, 'click', () => {\n\t\t\tthis.entitySelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.accessButton,\n\t\t\t\tcontext: 'CALENDAR',\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\ttargetContainer: document.body\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {selectMode: 'usersAndDepartments'}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.entitySelectorDialog.show();\n\t\t\tthis.entitySelectorDialog.subscribe('onHide', this.allowSliderClose.bind(this));\n\t\t\tthis.denySliderClose();\n\t\t});\n\n\t\tEvent.bind(this.DOM.accessWrap, 'click', (e) => {\n\t\t\tconst target = Util.findTargetNode(e.target || e.srcElement, this.DOM.outerWrap);\n\t\t\tif (Type.isElementNode(target))\n\t\t\t{\n\t\t\t\tif(target.getAttribute('data-bx-calendar-access-selector') !== null)\n\t\t\t\t{\n\t\t\t\t\t// show selector\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-selector');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showAccessSelectorPopup({\n\t\t\t\t\t\t\t\tnode: this.accessControls[code].removeIcon,\n\t\t\t\t\t\t\t\tsetValueCallback: (value) => {\n\t\t\t\t\t\t\t\t\tif (this.accessTasks[value] && this.accessControls[code])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.accessControls[code].valueNode.innerHTML =\n\t\t\t\t\t\t\t\t\t\t\tText.encode(this.accessTasks[value].title);\n\t\t\t\t\t\t\t\t\t\tthis.access[code] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(target.getAttribute('data-bx-calendar-access-remove') !== null)\n\t\t\t\t{\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-remove');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(this.accessControls[code].rowNode)\n\t\t\t\t\t\tthis.accessControls[code] = null;\n\t\t\t\t\t\tdelete this.access[code];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleEntitySelectorChanges()\n\t{\n\t\tconst entityList = this.entitySelectorDialog.getSelectedItems();\n\t\tthis.entitySelectorDialog.hide();\n\t\tif (Type.isArray(entityList))\n\t\t{\n\t\t\tentityList.forEach((entity) => {\n\t\t\t\tconst title = entity.title.text;\n\t\t\t\tconst code = Util.convertEntityToAccessCode(entity);\n\t\t\t\tUtil.setAccessName(code, title);\n\t\t\t\tthis.insertAccessRow(title, code);\n\t\t\t});\n\t\t}\n\n\t\tRuntime.debounce(() => {\n\t\t\tthis.entitySelectorDialog.destroy();\n\t\t}, 400)();\n\t}\n\n\tinsertAccessRow(title, code, value)\n\t{\n\t\tif (!this.accessControls[code])\n\t\t{\n\t\t\tif (value === undefined)\n\t\t\t{\n\t\t\t\tfor(let taskId in this.accessTasks)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.accessTasks.hasOwnProperty(taskId)\n\t\t\t\t\t\t&& this.accessTasks[taskId].name === 'calendar_type_edit'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = taskId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rowNode = Dom.adjust(\n\t\t\t\t\tthis.DOM.accessTable.insertRow(-1),\n\t\t\t\t\t{props : {className: 'calendar-section-slider-access-table-row'}}\n\t\t\t\t);\n\t\t\tconst titleNode = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\thtml: '<span class=\"calendar-section-slider-access-title\">' + Text.encode(title) + ':</span>'});\n\t\t\tconst valueCell = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-selector': code}\n\t\t\t\t});\n\t\t\tconst selectNode = valueCell.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-container'}\n\t\t\t\t}));\n\t\t\tconst valueNode = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\ttext: this.accessTasks[value] ? this.accessTasks[value].title : '',\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-value'}\n\t\t\t\t}));\n\t\t\tconst removeIcon = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-remove'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-remove': code}\n\t\t\t\t}));\n\n\t\t\tthis.access[code] = value;\n\n\t\t\tthis.accessControls[code] = {\n\t\t\t\trowNode: rowNode,\n\t\t\t\ttitleNode: titleNode,\n\t\t\t\tvalueNode: valueNode,\n\t\t\t\tremoveIcon: removeIcon\n\t\t\t};\n\t\t}\n\t}\n\n\tcheckAccessTableHeight()\n\t{\n\t\tif (this.checkTableTimeout)\n\t\t{\n\t\t\tthis.checkTableTimeout = clearTimeout(this.checkTableTimeout);\n\t\t}\n\n\t\tthis.checkTableTimeout = setTimeout(() => {\n\t\t\tif (Dom.hasClass(this.DOM.accessWrap, 'shown'))\n\t\t\t{\n\t\t\t\tif (this.DOM.accessWrap.offsetHeight - this.DOM.accessTable.offsetHeight < 36)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.accessWrap.style.maxHeight = parseInt(this.DOM.accessTable.offsetHeight) + 100 + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.accessWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\tshowAccessSelectorPopup(params)\n\t{\n\t\tif (\n\t\t\tthis.accessPopupMenu\n\t\t\t&& this.accessPopupMenu.popupWindow\n\t\t\t&& this.accessPopupMenu.popupWindow.isShown()\n\t\t)\n\t\t{\n\t\t\treturn this.accessPopupMenu.close();\n\t\t}\n\n\t\tconst _this = this;\n\t\tconst menuItems = [];\n\n\t\tfor(let taskId in this.accessTasks)\n\t\t{\n\t\t\tif (this.accessTasks.hasOwnProperty(taskId))\n\t\t\t{\n\t\t\t\tmenuItems.push(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.accessTasks[taskId].title,\n\t\t\t\t\t\tonclick: (function (value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tparams.setValueCallback(value);\n\t\t\t\t\t\t\t\t_this.accessPopupMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(taskId)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.accessPopupMenu = this.BX.PopupMenu.create(\n\t\t\t'section-access-popup' + Util.randomInt(),\n\t\t\tparams.node,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t{\n\t\t\t\t\tonPopupClose : this.allowSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.accessPopupMenu.show();\n\t\tthis.denySliderClose();\n\t}\n\n\topenHelpDesk()\n\t{\n\t\tlet helpDeskCode = 14326208;\n\t\ttop.BX.Helper.show('redirect=detail&code=' + helpDeskCode);\n\t}\n\n\tshowMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tthis.message.show();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 300 + \"px\";\n\t\t\tDom.addClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t}\n\t}\n\n\thideMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tDom.removeClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t\tthis.message.hide();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 0;\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.locationajax.hideSettingsHintLocation',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tvalue: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["SettingsInterface","constructor","options","sliderId","name","SLIDER_WIDTH","SLIDER_DURATION","DOM","calendarContext","showPersonalSettings","showGeneralSettings","showAccessControl","Type","isObjectLike","util","config","TYPE_ACCESS","settings","BX","Util","getBX","hideMessageBinded","hideMessage","bind","show","SidePanel","Instance","open","contentCallback","createContent","width","animationDuration","events","onCloseByEsc","escHide","onClose","hide","onCloseComplete","destroy","onLoad","onLoadSlider","event","getSlider","getUrl","denyClose","denyAction","close","isOpenedState","isOpened","removeCustomEvent","proxy","denySliderClose","allowSliderClose","sectionListWrap","slider","Promise","resolve","top","ajax","runAction","data","uid","then","response","getData","set","html","params","additionalParams","mailboxList","content","layout","get","initControls","setControlsValue","buttonsWrap","querySelector","ZIndexManager","register","saveBtn","closeBtn","Event","save","denyBusyInvitation","showWeekNumbers","meetSectionSelect","crmSelect","showDeclined","showTasks","syncTasks","showCompletedTasks","timezoneSelect","sendFromEmailSelect","isElementNode","emailSelectorControl","EmailSelectorControl","selectNode","allowAddNewEmail","emailHelpIcon","Helper","initHintNode","setValue","getUserOption","emailWrap","Calendar","isEventWithEmailGuestAllowed","Dom","removeClass","disabled","addClass","parentNode","UI","InfoHelper","workTimeStart","workTimeEnd","weekHolidays","yearHolidays","yearWorkdays","accessMessageWrap","accessOuterWrap","accessHelpIcon","type","initMessageControl","remove","initAccessController","moreMessageButton","Tag","render","Loc","getMessage","openHelpDesk","header","description","message","MessageCard","id","angle","hidden","actionElements","EventEmitter","subscribe","onClickHint","appendChild","getLayout","firstChild","childNodes","hideSettingsHintLocation","showMessage","isShown","length","sections","sectionManager","getSectionListForEdit","crmSection","parseInt","meetSection","section","selected","i","belongsToOwner","add","Option","checked","showWeekNumber","value","work_time_start","work_time_end","week_holidays","includes","year_holidays","year_workdays","typeAccess","code","hasOwnProperty","insertAccessRow","getAccessName","userSettings","userTimezoneName","timezoneName","sendFromEmail","getValue","user_settings","user_timezone_name","push","type_access","access","reload","accessWrap","accessTable","accessButton","accessControls","accessTasks","getTypeAccessTasks","accessNames","setAccessNames","entitySelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","enableSearch","handleEntitySelectorChanges","popupOptions","targetContainer","document","body","entities","selectMode","e","target","findTargetNode","srcElement","outerWrap","getAttribute","showAccessSelectorPopup","node","removeIcon","setValueCallback","valueNode","innerHTML","Text","encode","title","rowNode","entityList","getSelectedItems","isArray","forEach","entity","text","convertEntityToAccessCode","setAccessName","Runtime","debounce","undefined","taskId","adjust","insertRow","props","className","titleNode","insertCell","valueCell","attrs","create","checkAccessTableHeight","checkTableTimeout","clearTimeout","setTimeout","hasClass","offsetHeight","style","maxHeight","accessPopupMenu","popupWindow","_this","menuItems","onclick","PopupMenu","randomInt","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","onPopupClose","helpDeskCode"],"mappings":"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"}