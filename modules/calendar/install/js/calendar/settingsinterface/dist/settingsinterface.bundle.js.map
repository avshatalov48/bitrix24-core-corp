{"version":3,"file":"settingsinterface.bundle.js","sources":["../src/settingsinterface.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport {EmailSelectorControl, DateTimeControl} from 'calendar.controls';\nimport { Type, Event, Loc, Tag, Dom, Text, Runtime } from 'main.core';\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageCard } from 'ui.messagecard';\n\ntype SettingsInterfaceOptions = {\n\tname: string;\n\tcalendarContext: any,\n\tshowPersonalSettings: boolean,\n\tshowGeneralSettings: boolean,\n\tshowAccessControl: boolean,\n\tsettings: any\n};\n\nexport class SettingsInterface\n{\n\tsliderId: string = \"calendar:settings-slider\";\n\tname: string = 'SettingsInterface';\n\tSLIDER_WIDTH: number = 500;\n\tSLIDER_DURATION: number = 80;\n\tDOM: any = {};\n\tHELP_DESK_CODE = 7218351;\n\tHELP_DESK_CODE_LOCATION = 14326208;\n\n\tconstructor(options: SettingsInterfaceOptions)\n\t{\n\t\tthis.calendarContext = options.calendarContext;\n\t\tthis.showPersonalSettings = options.showPersonalSettings;\n\t\tthis.showGeneralSettings = options.showGeneralSettings;\n\t\tthis.showAccessControl = options.showAccessControl !== false\n\t\t\t&& Type.isObjectLike(this.calendarContext.util.config.TYPE_ACCESS);\n\n\t\tthis.settings = options.settings;\n\t\tthis.BX = Util.getBX();\n\t\tthis.hideMessageBinded = this.hideMessage.bind(this);\n\t}\n\n\tshow()\n\t{\n\t\tthis.BX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: this.createContent.bind(this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION,\n\t\t\tevents: {\n\t\t\t\tonCloseByEsc: this.escHide.bind(this),\n\t\t\t\tonClose: this.hide.bind(this),\n\t\t\t\tonCloseComplete: this.destroy.bind(this),\n\t\t\t\tonLoad: this.onLoadSlider.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\n\tescHide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId && this.denyClose)\n\t\t{\n\t\t\tevent.denyAction();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.isOpenedState = false;\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisOpened()\n\t{\n\t\treturn this.isOpenedState;\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", BX.proxy(this.hide, this));\n\t\t}\n\t}\n\n\tdenySliderClose()\n\t{\n\t\tthis.denyClose = true;\n\t}\n\n\tallowSliderClose()\n\t{\n\t\tthis.denyClose = false;\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// this.destroyEventEmitterSubscriptions();\n\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:delete', this.deleteSectionHandlerBinded);\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:pull-delete', this.deleteSectionHandlerBinded);\n\n\t\t\t// BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", BX.proxy(this.destroy, this));\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t\tdelete this.DOM.sectionListWrap;\n\t\t}\n\t}\n\n\tcreateContent(slider: BX.Intranet.Bitrix24.Slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\ttop.BX.ajax.runAction('calendar.api.calendarajax.getSettingsSlider', {\n\t\t\t\tdata: {\n\t\t\t\t\tshowPersonalSettings: this.showPersonalSettings ? 'Y' : 'N',\n\t\t\t\t\tshowGeneralSettings: this.showGeneralSettings ? 'Y' : 'N',\n\t\t\t\t\tshowAccessControl: this.showAccessControl ? 'Y' : 'N',\n\t\t\t\t\tuid: this.uid\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response: any) => {\n\t\t\t\t\tslider.getData().set(\"sliderContent\", response.data.html);\n\t\t\t\t\tconst params = response.data.additionalParams;\n\n\t\t\t\t\tthis.mailboxList = params.mailboxList;\n\t\t\t\t\tthis.uid = params.uid;\n\n\t\t\t\t\tresolve(response.data.html);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tonLoadSlider(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tthis.DOM.content = slider.layout.content;\n\t\tthis.sliderId = slider.getUrl();\n\n\t\t// Used to execute javasctipt and attach CSS from ajax responce\n\t\tBX.html(slider.layout.content, slider.getData().get(\"sliderContent\"));\n\t\tthis.initControls();\n\t\tthis.setControlsValue();\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.buttonsWrap = this.DOM.content.querySelector('.calendar-form-buttons-fixed');\n\t\tBX.ZIndexManager.register(this.DOM.buttonsWrap);\n\n\t\tthis.DOM.saveBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"save_btn\"]');\n\t\tthis.DOM.closeBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"close_btn\"]');\n\n\t\tBX.Event.bind(this.DOM.saveBtn, 'click', this.save.bind(this));\n\t\tBX.Event.bind(this.DOM.closeBtn, 'click', this.close.bind(this));\n\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation = this.DOM.content.querySelector('[data-role=\"deny_busy_invitation\"]');\n\t\t\tthis.DOM.showWeekNumbers = this.DOM.content.querySelector('[data-role=\"show_week_numbers\"]');\n\n\t\t\tthis.DOM.meetSectionSelect = this.DOM.content.querySelector('[data-role=\"meet_section\"]');\n\t\t\tthis.DOM.crmSelect = this.DOM.content.querySelector('[data-role=\"crm_section\"]');\n\t\t\tthis.DOM.showDeclined = this.DOM.content.querySelector('[data-role=\"show_declined\"]');\n\t\t\tthis.DOM.showTasks = this.DOM.content.querySelector('[data-role=\"show_tasks\"]');\n\t\t\tthis.DOM.syncTasks = this.DOM.content.querySelector('[data-role=\"sync_tasks\"]');\n\t\t\tthis.DOM.showCompletedTasks = this.DOM.content.querySelector('[data-role=\"show_completed_tasks\"]');\n\t\t\tthis.DOM.timezoneSelect = this.DOM.content.querySelector('[data-role=\"set_tz_sel\"]');\n\t\t\tthis.DOM.sendFromEmailSelect = this.DOM.content.querySelector('[data-role=\"send_from_email\"]');\n\n\t\t\t// this.DOM.enableLunchTime = this.DOM.content.querySelector('[data-role=\"enable_lunch_time\"]');\n\t\t\t// this.DOM.lunchTimeSettingContainer = this.DOM.content.querySelector('#ec_lunch_time');\n\t\t\t// this.lunchTimeControl = this.initLunchTimeControl(this.DOM.lunchTimeSettingContainer);\n\n\t\t\tif (this.BX.Type.isElementNode(this.DOM.sendFromEmailSelect))\n\t\t\t{\n\t\t\t\tthis.emailSelectorControl = new EmailSelectorControl({\n\t\t\t\t\tselectNode: this.DOM.sendFromEmailSelect,\n\t\t\t\t\tallowAddNewEmail: true,\n\t\t\t\t\tmailboxList: this.mailboxList\n\t\t\t\t});\n\n\t\t\t\tthis.DOM.emailHelpIcon = this.DOM.content.querySelector('.calendar-settings-question');\n\n\t\t\t\tif(this.DOM.emailHelpIcon && BX.Helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.emailHelpIcon,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() =>{\n\t\t\t\t\t\t\tBX.Helper.show(\"redirect=detail&code=12070142\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tUtil.initHintNode(this.DOM.emailHelpIcon);\n\t\t\t\t}\n\n\t\t\t\tthis.emailSelectorControl.setValue(this.calendarContext.util.getUserOption('sendFromEmail'));\n\n\t\t\t\tthis.DOM.emailWrap = this.DOM.content.querySelector('.calendar-settings-email-wrap')\n\t\t\t\tif (BX.Calendar.Util.isEventWithEmailGuestAllowed())\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = true;\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.sendFromEmailSelect.parentNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tBX.UI.InfoHelper.show('limit_calendar_invitation_by_mail');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// General settings\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\tthis.DOM.workTimeStart = this.DOM.content.querySelector('[data-role=\"work_time_start\"]');\n\t\t\tthis.DOM.workTimeEnd = this.DOM.content.querySelector('[data-role=\"work_time_end\"]');\n\t\t\tthis.DOM.weekHolidays = this.DOM.content.querySelector('[data-role=\"week_holidays\"]');\n\t\t\tthis.DOM.yearHolidays = this.DOM.content.querySelector('[data-role=\"year_holidays\"]');\n\t\t\tthis.DOM.yearWorkdays = this.DOM.content.querySelector('[data-role=\"year_workdays\"]');\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap = this.DOM.content.querySelector('[data-role=\"type-access-message-card\"]');\n\t\t\tthis.DOM.accessOuterWrap = this.DOM.content.querySelector('[data-role=\"type-access-values-cont\"]');\n\t\t\tthis.DOM.accessHelpIcon = this.DOM.content.querySelector('.calendar-settings-access-hint');\n\t\t\tif(Type.isElementNode(this.DOM.accessHelpIcon) && this.calendarContext.util.type === 'location')\n\t\t\t{\n\t\t\t\tthis.initMessageControl();\n\t\t\t}\n\t\t\telse if(Type.isElementNode(this.DOM.accessHelpIcon))\n\t\t\t{\n\t\t\t\tthis.DOM.accessHelpIcon.remove();\n\t\t\t\tDom.replace(this.DOM.accessMessageWrap, Tag.render`\n\t\t\t\t\t<span onclick=\"${() => this.openHelpDesk(this.HELP_DESK_CODE)}\" class=\"ui-hint\" title=\"${Loc.getMessage('EC_CALENDAR_HOW_DOES_IT_WORK')}\">\n\t\t\t\t\t\t<span class=\"ui-hint-icon\"></span>\n\t\t\t\t\t</span>\n\t\t\t\t`);\n\t\t\t}\n\t\t\tif (Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t\t{\n\t\t\t\tthis.initAccessController();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitMessageControl()\n\t{\n\t\tconst moreMessageButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-primary\">${Loc.getMessage('EC_LOCATION_SETTINGS_MORE_INFO')}</a>\n\t\t`;\n\t\tEvent.bind(moreMessageButton, 'click', () => this.openHelpDesk(this.HELP_DESK_CODE_LOCATION));\n\t\tconst header = \"\";\n\t\tconst description = Loc.getMessage('EC_LOCATION_SETTINGS_MESSAGE_DESCRIPTION')\n\n\t\tthis.message = new MessageCard({\n\t\t\tid: 'locationSettingsInfo',\n\t\t\theader,\n\t\t\tdescription,\n\t\t\tangle: false,\n\t\t\thidden: true,\n\t\t\tactionElements: [moreMessageButton]\n\t\t})\n\t\tEventEmitter.subscribe(this.message, 'onClose', this.hideMessageBinded);\n\t\tEvent.bind(this.DOM.accessHelpIcon, 'click', () => {\n\t\t\tthis.onClickHint();\n\t\t});\n\n\t\tif(this.DOM.accessMessageWrap)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap.appendChild(this.message.getLayout());\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tthis.showMessage();\n\t\t\t}\n\t\t}\n\t}\n\n\t// initLunchTimeControl(container)\n\t// {\n\t// \tEvent.bind(this.DOM.enableLunchTime, 'change', () => {\n\t// \t\tthis.updateEnabledLunchTime();\n\t// \t});\n\t//\n\t// \tconst lunchTimeContainer = Tag.render`<div class=\"calendar-field-container calendar-field-container-datetime\"></div>`;\n\t// \tcontainer.append(lunchTimeContainer);\n\t//\n\t// \tconst lunchTimeControl = new DateTimeControl(null, {\n\t// \t\tshowTimezone: false,\n\t// \t\touterWrap: lunchTimeContainer,\n\t// \t\tinlineEditMode: true\n\t// \t});\n\t// \tlunchTimeControl.DOM.fromDate.style.display = 'none';\n\t// \tlunchTimeControl.DOM.toDate.style.display = 'none';\n\t// \tlunchTimeControl.DOM.outerWrap.querySelector('.calendar-event-full-day').style.display = 'none';\n\t// \tlunchTimeControl.setValue({\n\t// \t\tfrom: new Date(),\n\t// \t\tto: new Date(),\n\t// \t\tfullDay: false,\n\t// \t\ttimezoneFrom: '',\n\t// \t\ttimezoneTo: '',\n\t// \t});\n\t// \tlunchTimeControl.setInlineEditMode('edit');\n\t// \tlunchTimeControl.setViewMode(false);\n\t//\n\t// \treturn lunchTimeControl;\n\t// }\n\t//\n\t// setLunchTimeValue()\n\t// {\n\t// \tconst settingEnableLunchTime = this.calendarContext.util.getUserOption('enableLunchTime', 'N') === 'Y';\n\t// \tconst settingLunchStart = this.calendarContext.util.getUserOption('lunchStart', '13:00');\n\t// \tconst settingLunchEnd = this.calendarContext.util.getUserOption('lunchEnd', '14:00');\n\t//\n\t// \tthis.DOM.enableLunchTime.checked = settingEnableLunchTime;\n\t// \tthis.updateEnabledLunchTime();\n\t//\n\t// \tconst date = new Date().toDateString();\n\t// \tconst lunchStart = new Date(`${date} ${settingLunchStart}`);\n\t// \tconst lunchEnd = new Date(`${date} ${settingLunchEnd}`);\n\t//\n\t// \tthis.lunchTimeControl.setValue({\n\t// \t\tfrom: lunchStart,\n\t// \t\tto: lunchEnd,\n\t// \t});\n\t// }\n\t//\n\t// updateEnabledLunchTime()\n\t// {\n\t// \tif (this.DOM.enableLunchTime.checked)\n\t// \t{\n\t// \t\tDom.removeClass(this.DOM.lunchTimeSettingContainer, '--disabled');\n\t// \t}\n\t// \telse\n\t// \t{\n\t// \t\tDom.addClass(this.DOM.lunchTimeSettingContainer, '--disabled');\n\t// \t}\n\t// }\n\n\tonClickHint()\n\t{\n\t\tif (!this.message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.message.isShown())\n\t\t{\n\t\t\tthis.hideMessage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showMessage();\n\t\t}\n\t}\n\n\tsetControlsValue()\n\t{\n\t\t// Set personal user settings\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.meetSectionSelect.options.length = 0;\n\n\t\t\tconst sections = this.calendarContext.sectionManager.getSectionListForEdit();\n\t\t\tlet crmSection = parseInt(this.calendarContext.util.getUserOption('crmSection'));\n\t\t\tlet meetSection = parseInt(this.calendarContext.util.getUserOption('meetSection'));\n\t\t\tlet section;\n\t\t\tlet selected;\n\n\t\t\tfor (let i = 0; i < sections.length; i++)\n\t\t\t{\n\t\t\t\tsection = sections[i];\n\t\t\t\tif (section.belongsToOwner())\n\t\t\t\t{\n\t\t\t\t\tif (!meetSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmeetSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = meetSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.meetSectionSelect.options.add(new Option(section.name, section.id, selected, selected));\n\n\t\t\t\t\tif (!crmSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = crmSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.crmSelect.options.add(new Option(section.name, section.id, selected, selected));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// this.setLunchTimeValue();\n\t\t}\n\n\t\tif(this.DOM.showDeclined)\n\t\t{\n\t\t\tthis.DOM.showDeclined.checked = this.calendarContext.util.getUserOption('showDeclined');\n\t\t}\n\n\t\tvar showTasks = this.calendarContext.util.getUserOption('showTasks') === 'Y';\n\t\tif(this.DOM.showTasks)\n\t\t{\n\t\t\tthis.DOM.showTasks.checked = showTasks;\n\t\t\tBX.Event.bind(this.DOM.showTasks, 'click', function(){\n\t\t\t\tif(this.DOM.showCompletedTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.showCompletedTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.showCompletedTasks.checked = this.DOM.showCompletedTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t\tif(this.DOM.syncTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.syncTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.syncTasks.checked = this.DOM.syncTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tif(this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tthis.DOM.showCompletedTasks.checked = this.calendarContext.util.getUserOption('showCompletedTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.showCompletedTasks.disabled = !showTasks;\n\t\t}\n\t\tif(this.DOM.syncTasks)\n\t\t{\n\t\t\tthis.DOM.syncTasks.checked = this.calendarContext.util.getUserOption('syncTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.syncTasks.disabled = !showTasks;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation.checked = this.calendarContext.util.getUserOption('denyBusyInvitation');\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tthis.DOM.showWeekNumbers.checked = this.calendarContext.util.showWeekNumber();\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tthis.DOM.timezoneSelect.value = this.calendarContext.util.getUserOption('timezoneName') || '';\n\t\t}\n\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\t// Set access for calendar type\n\t\t\tthis.DOM.workTimeStart.value = this.settings.work_time_start;\n\t\t\tthis.DOM.workTimeEnd.value = this.settings.work_time_end;\n\n\t\t\tif (this.DOM.weekHolidays)\n\t\t\t{\n\t\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.weekHolidays.options[i].selected =\n\t\t\t\t\t\tthis.settings.week_holidays.includes(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.DOM.yearHolidays.value = this.settings.year_holidays;\n\t\t\tthis.DOM.yearWorkdays.value = this.settings.year_workdays;\n\t\t}\n\n\t\t// Access\n\t\tif (this.showAccessControl\n\t\t\t&& Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t{\n\t\t\tconst typeAccess = this.calendarContext.util.config.TYPE_ACCESS;\n\t\t\tfor (let code in typeAccess)\n\t\t\t{\n\t\t\t\tif (typeAccess.hasOwnProperty(code))\n\t\t\t\t{\n\t\t\t\t\tthis.insertAccessRow(\n\t\t\t\t\t\tthis.calendarContext.util.getAccessName(code),\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\ttypeAccess[code]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst userSettings = this.calendarContext.util.config.userSettings;\n\n\t\t// Save user settings\n\t\tif (this.DOM.showDeclined)\n\t\t{\n\t\t\tuserSettings.showDeclined = this.DOM.showDeclined.checked ? 1 : 0;\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tuserSettings.showWeekNumbers = this.DOM.showWeekNumbers.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.showTasks)\n\t\t{\n\t\t\tuserSettings.showTasks = this.DOM.showTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.syncTasks)\n\t\t{\n\t\t\tuserSettings.syncTasks = this.DOM.syncTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tuserSettings.showCompletedTasks = this.DOM.showCompletedTasks.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.meetSectionSelect)\n\t\t{\n\t\t\tuserSettings.meetSection = this.DOM.meetSectionSelect.value;\n\t\t}\n\t\tif (this.DOM.crmSelect)\n\t\t{\n\t\t\tuserSettings.crmSection = this.DOM.crmSelect.value;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tuserSettings.denyBusyInvitation = this.DOM.denyBusyInvitation.checked ? 1 : 0;\n\t\t}\n\n\t\tuserSettings.userTimezoneName = this.DOM.timezoneSelect\n\t\t\t? this.DOM.timezoneSelect.value\n\t\t\t: userSettings.timezoneName;\n\n\t\tif (this.emailSelectorControl)\n\t\t{\n\t\t\tuserSettings.sendFromEmail = this.emailSelectorControl.getValue();\n\t\t}\n\n\t\t// const lunchTime = this.lunchTimeControl.getValue();\n\t\t// userSettings.enableLunchTime = this.DOM.enableLunchTime.checked ? 'Y' : 'N';\n\t\t// userSettings.lunchStart = Util.formatTime(lunchTime.from);\n\t\t// userSettings.lunchEnd = Util.formatTime(lunchTime.to);\n\n\t\tconst data = {\n\t\t\ttype: this.calendarContext.util.config.type,\n\t\t\tuser_settings: userSettings,\n\t\t\tuser_timezone_name: userSettings.userTimezoneName,\n\t\t};\n\n\t\tif (this.showGeneralSettings && this.DOM.workTimeStart)\n\t\t{\n\t\t\tdata.settings = {\n\t\t\t\twork_time_start: this.DOM.workTimeStart.value,\n\t\t\t\twork_time_end: this.DOM.workTimeEnd.value,\n\t\t\t\tweek_holidays: [],\n\t\t\t\tyear_holidays: this.DOM.yearHolidays.value,\n\t\t\t\tyear_workdays: this.DOM.yearWorkdays.value\n\t\t\t};\n\n\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t{\n\t\t\t\tif (this.DOM.weekHolidays.options[i].selected)\n\t\t\t\t{\n\t\t\t\t\tdata.settings.week_holidays.push(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tdata.type_access = this.access;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'calendar.api.calendarajax.saveSettings',\n\t\t\t{\n\t\t\t \tdata: data\n\t\t\t})\n\t\t\t.then(() => {BX.reload();});\n\n\t\tthis.close();\n\t}\n\n\tinitAccessController()\n\t{\n\t\tthis.DOM.accessWrap = this.DOM.accessOuterWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-list-slider-access-container shown\">\n\t\t\t\t\t<div class=\"calendar-list-slider-access-inner-wrap\">\n\t\t\t\t\t\t${this.DOM.accessTable = Tag.render`\n\t\t\t\t\t\t\t<table class=\"calendar-section-slider-access-table\" />\n\t\t\t\t\t\t`}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-list-slider-new-calendar-options-container\">\n\t\t\t\t\t\t${this.DOM.accessButton = Tag.render `\n\t\t\t\t\t\t\t<span class=\"calendar-list-slider-new-calendar-option-add\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('EC_SEC_SLIDER_ACCESS_ADD')}\n\t\t\t\t\t\t\t</span>`\n\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\n\t\tthis.access = {};\n\t\tthis.accessControls = {};\n\t\tthis.accessTasks = this.calendarContext?.util?.getTypeAccessTasks();\n\n\t\tif (this.calendarContext?.util?.config?.accessNames)\n\t\t{\n\t\t\tUtil.setAccessNames(this.calendarContext.util.config.accessNames);\n\t\t}\n\n\t\tEvent.bind(this.DOM.accessButton, 'click', () => {\n\t\t\tthis.entitySelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.accessButton,\n\t\t\t\tcontext: 'CALENDAR',\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\ttargetContainer: document.body\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {selectMode: 'usersAndDepartments'}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.entitySelectorDialog.show();\n\t\t\tthis.entitySelectorDialog.subscribe('onHide', this.allowSliderClose.bind(this));\n\t\t\tthis.denySliderClose();\n\t\t});\n\n\t\tEvent.bind(this.DOM.accessWrap, 'click', (e) => {\n\t\t\tconst target = Util.findTargetNode(e.target || e.srcElement, this.DOM.outerWrap);\n\t\t\tif (Type.isElementNode(target))\n\t\t\t{\n\t\t\t\tif(target.getAttribute('data-bx-calendar-access-selector') !== null)\n\t\t\t\t{\n\t\t\t\t\t// show selector\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-selector');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showAccessSelectorPopup({\n\t\t\t\t\t\t\t\tnode: this.accessControls[code].removeIcon,\n\t\t\t\t\t\t\t\tsetValueCallback: (value) => {\n\t\t\t\t\t\t\t\t\tif (this.accessTasks[value] && this.accessControls[code])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.accessControls[code].valueNode.innerHTML =\n\t\t\t\t\t\t\t\t\t\t\tText.encode(this.accessTasks[value].title);\n\t\t\t\t\t\t\t\t\t\tthis.access[code] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(target.getAttribute('data-bx-calendar-access-remove') !== null)\n\t\t\t\t{\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-remove');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(this.accessControls[code].rowNode)\n\t\t\t\t\t\tthis.accessControls[code] = null;\n\t\t\t\t\t\tdelete this.access[code];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleEntitySelectorChanges()\n\t{\n\t\tconst entityList = this.entitySelectorDialog.getSelectedItems();\n\t\tthis.entitySelectorDialog.hide();\n\t\tif (Type.isArray(entityList))\n\t\t{\n\t\t\tentityList.forEach((entity) => {\n\t\t\t\tconst title = entity.title.text;\n\t\t\t\tconst code = Util.convertEntityToAccessCode(entity);\n\t\t\t\tUtil.setAccessName(code, title);\n\t\t\t\tthis.insertAccessRow(title, code);\n\t\t\t});\n\t\t}\n\n\t\tRuntime.debounce(() => {\n\t\t\tthis.entitySelectorDialog.destroy();\n\t\t}, 400)();\n\t}\n\n\tinsertAccessRow(title, code, value)\n\t{\n\t\tif (!this.accessControls[code])\n\t\t{\n\t\t\tif (value === undefined)\n\t\t\t{\n\t\t\t\tfor(let taskId in this.accessTasks)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.accessTasks.hasOwnProperty(taskId)\n\t\t\t\t\t\t&& this.accessTasks[taskId].name === 'calendar_type_edit'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = taskId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rowNode = Dom.adjust(\n\t\t\t\t\tthis.DOM.accessTable.insertRow(-1),\n\t\t\t\t\t{props : {className: 'calendar-section-slider-access-table-row'}}\n\t\t\t\t);\n\t\t\tconst titleNode = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\thtml: `<span class=\"calendar-section-slider-access-title\" title=\"${Text.encode(title)}\">${Text.encode(title)}:</span>`});\n\t\t\tconst valueCell = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-selector': code}\n\t\t\t\t});\n\t\t\tconst selectNode = valueCell.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-container'}\n\t\t\t\t}));\n\t\t\tconst valueNode = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\ttext: this.accessTasks[value] ? this.accessTasks[value].title : '',\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-value'}\n\t\t\t\t}));\n\t\t\tconst removeIcon = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-remove'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-remove': code}\n\t\t\t\t}));\n\n\t\t\tthis.access[code] = value;\n\n\t\t\tthis.accessControls[code] = {\n\t\t\t\trowNode: rowNode,\n\t\t\t\ttitleNode: titleNode,\n\t\t\t\tvalueNode: valueNode,\n\t\t\t\tremoveIcon: removeIcon\n\t\t\t};\n\t\t}\n\t}\n\n\tcheckAccessTableHeight()\n\t{\n\t\tif (this.checkTableTimeout)\n\t\t{\n\t\t\tthis.checkTableTimeout = clearTimeout(this.checkTableTimeout);\n\t\t}\n\n\t\tthis.checkTableTimeout = setTimeout(() => {\n\t\t\tif (Dom.hasClass(this.DOM.accessWrap, 'shown'))\n\t\t\t{\n\t\t\t\tif (this.DOM.accessWrap.offsetHeight - this.DOM.accessTable.offsetHeight < 36)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.accessWrap.style.maxHeight = parseInt(this.DOM.accessTable.offsetHeight) + 100 + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.accessWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\tshowAccessSelectorPopup(params)\n\t{\n\t\tif (\n\t\t\tthis.accessPopupMenu\n\t\t\t&& this.accessPopupMenu.popupWindow\n\t\t\t&& this.accessPopupMenu.popupWindow.getContentContainer()?.offsetWidth > 0\n\t\t\t&& this.accessPopupMenu.popupWindow.isShown()\n\t\t)\n\t\t{\n\t\t\treturn this.accessPopupMenu.close();\n\t\t}\n\n\t\tthis.accessPopupMenu?.destroy();\n\n\t\tconst _this = this;\n\t\tconst menuItems = [];\n\n\t\tfor(let taskId in this.accessTasks)\n\t\t{\n\t\t\tif (this.accessTasks.hasOwnProperty(taskId))\n\t\t\t{\n\t\t\t\tmenuItems.push(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.accessTasks[taskId].title,\n\t\t\t\t\t\tonclick: (function (value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tparams.setValueCallback(value);\n\t\t\t\t\t\t\t\t_this.accessPopupMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(taskId)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.accessPopupMenu = this.BX.PopupMenu.create(\n\t\t\t'section-access-popup' + Util.randomInt(),\n\t\t\tparams.node,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t}\n\t\t);\n\n\t\tthis.accessPopupMenu.show();\n\t}\n\n\topenHelpDesk(helpDeskCode)\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=' + helpDeskCode);\n\t\t}\n\t}\n\n\tshowMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tthis.message.show();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 300 + \"px\";\n\t\t\tDom.addClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t}\n\t}\n\n\thideMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tDom.removeClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t\tthis.message.hide();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 0;\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.locationajax.hideSettingsHintLocation',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tvalue: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["SettingsInterface","constructor","options","sliderId","name","SLIDER_WIDTH","SLIDER_DURATION","DOM","HELP_DESK_CODE","HELP_DESK_CODE_LOCATION","calendarContext","showPersonalSettings","showGeneralSettings","showAccessControl","Type","isObjectLike","util","config","TYPE_ACCESS","settings","BX","Util","getBX","hideMessageBinded","hideMessage","bind","show","SidePanel","Instance","open","contentCallback","createContent","width","animationDuration","events","onCloseByEsc","escHide","onClose","hide","onCloseComplete","destroy","onLoad","onLoadSlider","event","getSlider","getUrl","denyClose","denyAction","close","isOpenedState","isOpened","removeCustomEvent","proxy","denySliderClose","allowSliderClose","sectionListWrap","slider","Promise","resolve","top","ajax","runAction","data","uid","then","response","getData","set","html","params","additionalParams","mailboxList","content","layout","get","initControls","setControlsValue","buttonsWrap","querySelector","ZIndexManager","register","saveBtn","closeBtn","Event","save","denyBusyInvitation","showWeekNumbers","meetSectionSelect","crmSelect","showDeclined","showTasks","syncTasks","showCompletedTasks","timezoneSelect","sendFromEmailSelect","isElementNode","emailSelectorControl","EmailSelectorControl","selectNode","allowAddNewEmail","emailHelpIcon","Helper","initHintNode","setValue","getUserOption","emailWrap","Calendar","isEventWithEmailGuestAllowed","Dom","removeClass","disabled","addClass","parentNode","UI","InfoHelper","workTimeStart","workTimeEnd","weekHolidays","yearHolidays","yearWorkdays","accessMessageWrap","accessOuterWrap","accessHelpIcon","type","initMessageControl","remove","replace","Tag","render","openHelpDesk","Loc","getMessage","initAccessController","moreMessageButton","header","description","message","MessageCard","id","angle","hidden","actionElements","EventEmitter","subscribe","onClickHint","appendChild","getLayout","hideSettingsHintLocation","showMessage","isShown","length","sections","sectionManager","getSectionListForEdit","crmSection","parseInt","meetSection","section","selected","i","belongsToOwner","add","Option","checked","showWeekNumber","value","work_time_start","work_time_end","week_holidays","includes","year_holidays","year_workdays","typeAccess","code","hasOwnProperty","insertAccessRow","getAccessName","userSettings","userTimezoneName","timezoneName","sendFromEmail","getValue","user_settings","user_timezone_name","push","type_access","access","reload","accessWrap","accessTable","accessButton","accessControls","accessTasks","getTypeAccessTasks","accessNames","setAccessNames","entitySelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","enableSearch","handleEntitySelectorChanges","popupOptions","targetContainer","document","body","entities","selectMode","e","target","findTargetNode","srcElement","outerWrap","getAttribute","showAccessSelectorPopup","node","removeIcon","setValueCallback","valueNode","innerHTML","Text","encode","title","rowNode","entityList","getSelectedItems","isArray","forEach","entity","text","convertEntityToAccessCode","setAccessName","Runtime","debounce","undefined","taskId","adjust","insertRow","props","className","titleNode","insertCell","valueCell","attrs","create","checkAccessTableHeight","checkTableTimeout","clearTimeout","setTimeout","hasClass","offsetHeight","style","maxHeight","accessPopupMenu","popupWindow","getContentContainer","offsetWidth","_this","menuItems","onclick","PopupMenu","randomInt","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","helpDeskCode"],"mappings":"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"}