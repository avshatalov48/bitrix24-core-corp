{"version":3,"file":"settingsinterface.bundle.js","sources":["../src/settingsinterface.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport {EmailSelectorControl} from 'calendar.controls';\nimport { Type, Event, Loc, Tag, Dom, Text, Runtime } from 'main.core';\nimport { Dialog as EntitySelectorDialog } from 'ui.entity-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageCard } from 'ui.messagecard';\n\ntype SettingsInterfaceOptions = {\n\tname: string;\n\tcalendarContext: any,\n\tshowPersonalSettings: boolean,\n\tshowGeneralSettings: boolean,\n\tshowAccessControl: boolean,\n\tsettings: any\n};\n\nexport class SettingsInterface\n{\n\tsliderId: string = \"calendar:settings-slider\";\n\tname: string = 'SettingsInterface';\n\tSLIDER_WIDTH: number = 500;\n\tSLIDER_DURATION: number = 80;\n\tDOM: any = {};\n\n\tconstructor(options: SettingsInterfaceOptions)\n\t{\n\t\tthis.calendarContext = options.calendarContext;\n\t\tthis.showPersonalSettings = options.showPersonalSettings;\n\t\tthis.showGeneralSettings = options.showGeneralSettings;\n\t\tthis.showAccessControl = options.showAccessControl !== false\n\t\t\t&& Type.isObjectLike(this.calendarContext.util.config.TYPE_ACCESS);\n\n\t\tthis.settings = options.settings;\n\t\tthis.BX = Util.getBX();\n\t\tthis.hideMessageBinded = this.hideMessage.bind(this);\n\t}\n\n\tshow()\n\t{\n\t\tthis.BX.SidePanel.Instance.open(this.sliderId, {\n\t\t\tcontentCallback: this.createContent.bind(this),\n\t\t\twidth: this.SLIDER_WIDTH,\n\t\t\tanimationDuration: this.SLIDER_DURATION,\n\t\t\tevents: {\n\t\t\t\tonCloseByEsc: this.escHide.bind(this),\n\t\t\t\tonClose: this.hide.bind(this),\n\t\t\t\tonCloseComplete: this.destroy.bind(this),\n\t\t\t\tonLoad: this.onLoadSlider.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\n\tescHide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId && this.denyClose)\n\t\t{\n\t\t\tevent.denyAction();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.isOpenedState = false;\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tisOpened()\n\t{\n\t\treturn this.isOpenedState;\n\t}\n\n\thide(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\tif (this.denyClose)\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\"SidePanel.Slider:onClose\", BX.proxy(this.hide, this));\n\t\t\t}\n\t\t}\n\t}\n\n\tdenySliderClose()\n\t{\n\t\tthis.denyClose = true;\n\t}\n\n\tallowSliderClose()\n\t{\n\t\tthis.denyClose = false;\n\t}\n\n\tdestroy(event)\n\t{\n\t\tif (event && event.getSlider && event.getSlider().getUrl() === this.sliderId)\n\t\t{\n\t\t\t// this.destroyEventEmitterSubscriptions();\n\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:delete', this.deleteSectionHandlerBinded);\n\t\t\t// Util.getBX().Event.EventEmitter.unsubscribe('BX.Calendar.Section:pull-delete', this.deleteSectionHandlerBinded);\n\n\t\t\t// BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", BX.proxy(this.destroy, this));\n\t\t\tBX.SidePanel.Instance.destroy(this.sliderId);\n\t\t\tdelete this.DOM.sectionListWrap;\n\t\t}\n\t}\n\n\tcreateContent(slider: BX.Intranet.Bitrix24.Slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\ttop.BX.ajax.runAction('calendar.api.calendarajax.getSettingsSlider', {\n\t\t\t\tdata: {\n\t\t\t\t\tshowPersonalSettings: this.showPersonalSettings ? 'Y' : 'N',\n\t\t\t\t\tshowGeneralSettings: this.showGeneralSettings ? 'Y' : 'N',\n\t\t\t\t\tshowAccessControl: this.showAccessControl ? 'Y' : 'N',\n\t\t\t\t\tuid: this.uid\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response: any) => {\n\t\t\t\t\tslider.getData().set(\"sliderContent\", response.data.html);\n\t\t\t\t\tconst params = response.data.additionalParams;\n\n\t\t\t\t\tthis.mailboxList = params.mailboxList;\n\t\t\t\t\tthis.uid = params.uid;\n\n\t\t\t\t\tresolve(response.data.html);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tonLoadSlider(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tthis.DOM.content = slider.layout.content;\n\t\tthis.sliderId = slider.getUrl();\n\n\t\t// Used to execute javasctipt and attach CSS from ajax responce\n\t\tBX.html(slider.layout.content, slider.getData().get(\"sliderContent\"));\n\t\tthis.initControls();\n\t\tthis.setControlsValue();\n\t}\n\n\tinitControls()\n\t{\n\t\tthis.DOM.buttonsWrap = this.DOM.content.querySelector('.calendar-form-buttons-fixed');\n\t\tBX.ZIndexManager.register(this.DOM.buttonsWrap);\n\n\t\tthis.DOM.saveBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"save_btn\"]');\n\t\tthis.DOM.closeBtn = this.DOM.buttonsWrap.querySelector('[data-role=\"close_btn\"]');\n\n\t\tBX.Event.bind(this.DOM.saveBtn, 'click', this.save.bind(this));\n\t\tBX.Event.bind(this.DOM.closeBtn, 'click', this.close.bind(this));\n\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation = this.DOM.content.querySelector('[data-role=\"deny_busy_invitation\"]');\n\t\t\tthis.DOM.showWeekNumbers = this.DOM.content.querySelector('[data-role=\"show_week_numbers\"]');\n\n\t\t\tthis.DOM.meetSectionSelect = this.DOM.content.querySelector('[data-role=\"meet_section\"]');\n\t\t\tthis.DOM.crmSelect = this.DOM.content.querySelector('[data-role=\"crm_section\"]');\n\t\t\tthis.DOM.showDeclined = this.DOM.content.querySelector('[data-role=\"show_declined\"]');\n\t\t\tthis.DOM.showTasks = this.DOM.content.querySelector('[data-role=\"show_tasks\"]');\n\t\t\tthis.DOM.syncTasks = this.DOM.content.querySelector('[data-role=\"sync_tasks\"]');\n\t\t\tthis.DOM.showCompletedTasks = this.DOM.content.querySelector('[data-role=\"show_completed_tasks\"]');\n\t\t\tthis.DOM.timezoneSelect = this.DOM.content.querySelector('[data-role=\"set_tz_sel\"]');\n\t\t\tthis.DOM.sendFromEmailSelect = this.DOM.content.querySelector('[data-role=\"send_from_email\"]');\n\n\t\t\tif (this.BX.Type.isElementNode(this.DOM.sendFromEmailSelect))\n\t\t\t{\n\t\t\t\tthis.emailSelectorControl = new EmailSelectorControl({\n\t\t\t\t\tselectNode: this.DOM.sendFromEmailSelect,\n\t\t\t\t\tallowAddNewEmail: true,\n\t\t\t\t\tmailboxList: this.mailboxList\n\t\t\t\t});\n\n\t\t\t\tthis.DOM.emailHelpIcon = this.DOM.content.querySelector('.calendar-settings-question');\n\n\t\t\t\tif(this.DOM.emailHelpIcon && BX.Helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.emailHelpIcon,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() =>{\n\t\t\t\t\t\t\tBX.Helper.show(\"redirect=detail&code=12070142\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tUtil.initHintNode(this.DOM.emailHelpIcon);\n\t\t\t\t}\n\n\t\t\t\tthis.emailSelectorControl.setValue(this.calendarContext.util.getUserOption('sendFromEmail'));\n\n\t\t\t\tthis.DOM.emailWrap = this.DOM.content.querySelector('.calendar-settings-email-wrap')\n\t\t\t\tif (BX.Calendar.Util.isEventWithEmailGuestAllowed())\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.DOM.emailWrap, 'lock');\n\t\t\t\t\tthis.DOM.sendFromEmailSelect.disabled = true;\n\t\t\t\t\tBX.Event.bind(\n\t\t\t\t\t\tthis.DOM.sendFromEmailSelect.parentNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tBX.UI.InfoHelper.show('limit_calendar_invitation_by_mail');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// General settings\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\tthis.DOM.workTimeStart = this.DOM.content.querySelector('[data-role=\"work_time_start\"]');\n\t\t\tthis.DOM.workTimeEnd = this.DOM.content.querySelector('[data-role=\"work_time_end\"]');\n\t\t\tthis.DOM.weekHolidays = this.DOM.content.querySelector('[data-role=\"week_holidays\"]');\n\t\t\tthis.DOM.yearHolidays = this.DOM.content.querySelector('[data-role=\"year_holidays\"]');\n\t\t\tthis.DOM.yearWorkdays = this.DOM.content.querySelector('[data-role=\"year_workdays\"]');\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap = this.DOM.content.querySelector('[data-role=\"type-access-message-card\"]');\n\t\t\tthis.DOM.accessOuterWrap = this.DOM.content.querySelector('[data-role=\"type-access-values-cont\"]');\n\t\t\tthis.DOM.accessHelpIcon = this.DOM.content.querySelector('.calendar-settings-access-hint');\n\t\t\tif(Type.isElementNode(this.DOM.accessHelpIcon) && this.calendarContext.util.type === 'location')\n\t\t\t{\n\t\t\t\tthis.initMessageControl();\n\t\t\t}\n\t\t\telse if(Type.isElementNode(this.DOM.accessHelpIcon))\n\t\t\t{\n\t\t\t\tthis.DOM.accessHelpIcon.remove();\n\t\t\t}\n\t\t\tif (Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t\t{\n\t\t\t\tthis.initAccessController();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitMessageControl()\n\t{\n\t\tconst moreMessageButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-primary\">${Loc.getMessage('EC_LOCATION_SETTINGS_MORE_INFO')}</a>\n\t\t`;\n\t\tEvent.bind(moreMessageButton, 'click', this.openHelpDesk);\n\t\tconst header = \"\";\n\t\tconst description = Loc.getMessage('EC_LOCATION_SETTINGS_MESSAGE_DESCRIPTION')\n\n\t\tthis.message = new MessageCard({\n\t\t\tid: 'locationSettingsInfo',\n\t\t\theader,\n\t\t\tdescription,\n\t\t\tangle: false,\n\t\t\thidden: true,\n\t\t\tactionElements: [moreMessageButton]\n\t\t})\n\t\tEventEmitter.subscribe(this.message, 'onClose', this.hideMessageBinded);\n\t\tEvent.bind(this.DOM.accessHelpIcon, 'click', () => {\n\t\t\tthis.onClickHint();\n\t\t});\n\n\t\tif(this.DOM.accessMessageWrap)\n\t\t{\n\t\t\tthis.DOM.accessMessageWrap.appendChild(this.message.getLayout());\n\t\t\tthis.DOM.accessMessageWrap.firstChild.childNodes[1].remove();\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tthis.showMessage();\n\t\t\t}\n\t\t}\n\t}\n\n\tonClickHint()\n\t{\n\t\tif (!this.message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.message.isShown())\n\t\t{\n\t\t\tthis.hideMessage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showMessage();\n\t\t}\n\t}\n\n\tsetControlsValue()\n\t{\n\t\t// Set personal user settings\n\t\tif (this.showPersonalSettings)\n\t\t{\n\t\t\tthis.DOM.meetSectionSelect.options.length = 0;\n\n\t\t\tconst sections = this.calendarContext.sectionManager.getSectionListForEdit();\n\t\t\tlet crmSection = parseInt(this.calendarContext.util.getUserOption('crmSection'));\n\t\t\tlet meetSection = parseInt(this.calendarContext.util.getUserOption('meetSection'));\n\t\t\tlet section;\n\t\t\tlet selected;\n\n\t\t\tfor (let i = 0; i < sections.length; i++)\n\t\t\t{\n\t\t\t\tsection = sections[i];\n\t\t\t\tif (section.belongsToOwner())\n\t\t\t\t{\n\t\t\t\t\tif (!meetSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tmeetSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = meetSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.meetSectionSelect.options.add(new Option(section.name, section.id, selected, selected));\n\n\t\t\t\t\tif (!crmSection)\n\t\t\t\t\t{\n\t\t\t\t\t\tcrmSection = section.id;\n\t\t\t\t\t}\n\t\t\t\t\tselected = crmSection === parseInt(section.id);\n\t\t\t\t\tthis.DOM.crmSelect.options.add(new Option(section.name, section.id, selected, selected));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(this.DOM.showDeclined)\n\t\t{\n\t\t\tthis.DOM.showDeclined.checked = this.calendarContext.util.getUserOption('showDeclined');\n\t\t}\n\n\t\tvar showTasks = this.calendarContext.util.getUserOption('showTasks') === 'Y';\n\t\tif(this.DOM.showTasks)\n\t\t{\n\t\t\tthis.DOM.showTasks.checked = showTasks;\n\t\t\tBX.Event.bind(this.DOM.showTasks, 'click', function(){\n\t\t\t\tif(this.DOM.showCompletedTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.showCompletedTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.showCompletedTasks.checked = this.DOM.showCompletedTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t\tif(this.DOM.syncTasks)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.syncTasks.disabled = !this.DOM.showTasks.checked;\n\t\t\t\t\tthis.DOM.syncTasks.checked = this.DOM.syncTasks.checked && this.DOM.showTasks.checked;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tif(this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tthis.DOM.showCompletedTasks.checked = this.calendarContext.util.getUserOption('showCompletedTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.showCompletedTasks.disabled = !showTasks;\n\t\t}\n\t\tif(this.DOM.syncTasks)\n\t\t{\n\t\t\tthis.DOM.syncTasks.checked = this.calendarContext.util.getUserOption('syncTasks') === 'Y' && this.DOM.showTasks.checked;\n\t\t\tthis.DOM.syncTasks.disabled = !showTasks;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tthis.DOM.denyBusyInvitation.checked = this.calendarContext.util.getUserOption('denyBusyInvitation');\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tthis.DOM.showWeekNumbers.checked = this.calendarContext.util.showWeekNumber();\n\t\t}\n\n\t\tif(this.DOM.timezoneSelect)\n\t\t{\n\t\t\tthis.DOM.timezoneSelect.value = this.calendarContext.util.getUserOption('timezoneName') || '';\n\t\t}\n\n\t\tif (this.showGeneralSettings)\n\t\t{\n\t\t\t// Set access for calendar type\n\t\t\tthis.DOM.workTimeStart.value = this.settings.work_time_start;\n\t\t\tthis.DOM.workTimeEnd.value = this.settings.work_time_end;\n\n\t\t\tif (this.DOM.weekHolidays)\n\t\t\t{\n\t\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.weekHolidays.options[i].selected =\n\t\t\t\t\t\tthis.settings.week_holidays.includes(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.DOM.yearHolidays.value = this.settings.year_holidays;\n\t\t\tthis.DOM.yearWorkdays.value = this.settings.year_workdays;\n\t\t}\n\n\t\t// Access\n\t\tif (this.showAccessControl\n\t\t\t&& Type.isElementNode(this.DOM.accessOuterWrap))\n\t\t{\n\t\t\tconst typeAccess = this.calendarContext.util.config.TYPE_ACCESS;\n\t\t\tfor (let code in typeAccess)\n\t\t\t{\n\t\t\t\tif (typeAccess.hasOwnProperty(code))\n\t\t\t\t{\n\t\t\t\t\tthis.insertAccessRow(\n\t\t\t\t\t\tthis.calendarContext.util.getAccessName(code),\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\ttypeAccess[code]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst userSettings = this.calendarContext.util.config.userSettings;\n\n\t\t// Save user settings\n\t\tif (this.DOM.showDeclined)\n\t\t{\n\t\t\tuserSettings.showDeclined = this.DOM.showDeclined.checked ? 1 : 0;\n\t\t}\n\n\t\tif (this.DOM.showWeekNumbers)\n\t\t{\n\t\t\tuserSettings.showWeekNumbers = this.DOM.showWeekNumbers.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.showTasks)\n\t\t{\n\t\t\tuserSettings.showTasks = this.DOM.showTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.syncTasks)\n\t\t{\n\t\t\tuserSettings.syncTasks = this.DOM.syncTasks.checked ? 'Y' : 'N';\n\t\t}\n\t\tif (this.DOM.showCompletedTasks)\n\t\t{\n\t\t\tuserSettings.showCompletedTasks = this.DOM.showCompletedTasks.checked ? 'Y' : 'N';\n\t\t}\n\n\t\tif (this.DOM.meetSectionSelect)\n\t\t{\n\t\t\tuserSettings.meetSection = this.DOM.meetSectionSelect.value;\n\t\t}\n\t\tif (this.DOM.crmSelect)\n\t\t{\n\t\t\tuserSettings.crmSection = this.DOM.crmSelect.value;\n\t\t}\n\n\t\tif (this.DOM.denyBusyInvitation)\n\t\t{\n\t\t\tuserSettings.denyBusyInvitation = this.DOM.denyBusyInvitation.checked ? 1 : 0;\n\t\t}\n\n\t\tuserSettings.userTimezoneName = this.DOM.timezoneSelect\n\t\t\t? this.DOM.timezoneSelect.value\n\t\t\t: userSettings.timezoneName;\n\n\t\tif (this.emailSelectorControl)\n\t\t{\n\t\t\tuserSettings.sendFromEmail = this.emailSelectorControl.getValue();\n\t\t}\n\n\t\tconst data = {\n\t\t\ttype: this.calendarContext.util.config.type,\n\t\t\tuser_settings: userSettings,\n\t\t\tuser_timezone_name: userSettings.userTimezoneName,\n\t\t};\n\n\t\tif (this.showGeneralSettings && this.DOM.workTimeStart)\n\t\t{\n\t\t\tdata.settings = {\n\t\t\t\twork_time_start: this.DOM.workTimeStart.value,\n\t\t\t\twork_time_end: this.DOM.workTimeEnd.value,\n\t\t\t\tweek_holidays: [],\n\t\t\t\tyear_holidays: this.DOM.yearHolidays.value,\n\t\t\t\tyear_workdays: this.DOM.yearWorkdays.value\n\t\t\t};\n\n\t\t\tfor(let i = 0; i < this.DOM.weekHolidays.options.length; i++)\n\t\t\t{\n\t\t\t\tif (this.DOM.weekHolidays.options[i].selected)\n\t\t\t\t{\n\t\t\t\t\tdata.settings.week_holidays.push(this.DOM.weekHolidays.options[i].value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.showAccessControl)\n\t\t{\n\t\t\tdata.type_access = this.access;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'calendar.api.calendarajax.saveSettings',\n\t\t\t{\n\t\t\t \tdata: data\n\t\t\t})\n\t\t\t.then(() => {BX.reload();});\n\n\t\tthis.close();\n\t}\n\n\tinitAccessController()\n\t{\n\t\tthis.DOM.accessWrap = this.DOM.accessOuterWrap.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"calendar-list-slider-access-container shown\">\n\t\t\t\t\t<div class=\"calendar-list-slider-access-inner-wrap\">\n\t\t\t\t\t\t${this.DOM.accessTable = Tag.render`\n\t\t\t\t\t\t\t<table class=\"calendar-section-slider-access-table\" />\n\t\t\t\t\t\t`}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-list-slider-new-calendar-options-container\">\n\t\t\t\t\t\t${this.DOM.accessButton = Tag.render `\n\t\t\t\t\t\t\t<span class=\"calendar-list-slider-new-calendar-option-add\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('EC_SEC_SLIDER_ACCESS_ADD')}\n\t\t\t\t\t\t\t</span>`\n\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\n\t\tthis.access = {};\n\t\tthis.accessControls = {};\n\t\tthis.accessTasks = this.calendarContext?.util?.getTypeAccessTasks();\n\n\t\tif (this.calendarContext?.util?.config?.accessNames)\n\t\t{\n\t\t\tUtil.setAccessNames(this.calendarContext.util.config.accessNames);\n\t\t}\n\n\t\tEvent.bind(this.DOM.accessButton, 'click', () => {\n\t\t\tthis.entitySelectorDialog = new EntitySelectorDialog({\n\t\t\t\ttargetNode: this.DOM.accessButton,\n\t\t\t\tcontext: 'CALENDAR',\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t\t'Item:onDeselect': this.handleEntitySelectorChanges.bind(this),\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\ttargetContainer: document.body\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {selectMode: 'usersAndDepartments'}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.entitySelectorDialog.show();\n\t\t\tthis.entitySelectorDialog.subscribe('onHide', this.allowSliderClose.bind(this));\n\t\t\tthis.denySliderClose();\n\t\t});\n\n\t\tEvent.bind(this.DOM.accessWrap, 'click', (e) => {\n\t\t\tconst target = Util.findTargetNode(e.target || e.srcElement, this.DOM.outerWrap);\n\t\t\tif (Type.isElementNode(target))\n\t\t\t{\n\t\t\t\tif(target.getAttribute('data-bx-calendar-access-selector') !== null)\n\t\t\t\t{\n\t\t\t\t\t// show selector\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-selector');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showAccessSelectorPopup({\n\t\t\t\t\t\t\t\tnode: this.accessControls[code].removeIcon,\n\t\t\t\t\t\t\t\tsetValueCallback: (value) => {\n\t\t\t\t\t\t\t\t\tif (this.accessTasks[value] && this.accessControls[code])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.accessControls[code].valueNode.innerHTML =\n\t\t\t\t\t\t\t\t\t\t\tText.encode(this.accessTasks[value].title);\n\t\t\t\t\t\t\t\t\t\tthis.access[code] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(target.getAttribute('data-bx-calendar-access-remove') !== null)\n\t\t\t\t{\n\t\t\t\t\tconst code = target.getAttribute('data-bx-calendar-access-remove');\n\t\t\t\t\tif (this.accessControls[code])\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(this.accessControls[code].rowNode)\n\t\t\t\t\t\tthis.accessControls[code] = null;\n\t\t\t\t\t\tdelete this.access[code];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleEntitySelectorChanges()\n\t{\n\t\tconst entityList = this.entitySelectorDialog.getSelectedItems();\n\t\tthis.entitySelectorDialog.hide();\n\t\tif (Type.isArray(entityList))\n\t\t{\n\t\t\tentityList.forEach((entity) => {\n\t\t\t\tconst title = entity.title.text;\n\t\t\t\tconst code = Util.convertEntityToAccessCode(entity);\n\t\t\t\tUtil.setAccessName(code, title);\n\t\t\t\tthis.insertAccessRow(title, code);\n\t\t\t});\n\t\t}\n\n\t\tRuntime.debounce(() => {\n\t\t\tthis.entitySelectorDialog.destroy();\n\t\t}, 400)();\n\t}\n\n\tinsertAccessRow(title, code, value)\n\t{\n\t\tif (!this.accessControls[code])\n\t\t{\n\t\t\tif (value === undefined)\n\t\t\t{\n\t\t\t\tfor(let taskId in this.accessTasks)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.accessTasks.hasOwnProperty(taskId)\n\t\t\t\t\t\t&& this.accessTasks[taskId].name === 'calendar_type_edit'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = taskId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rowNode = Dom.adjust(\n\t\t\t\t\tthis.DOM.accessTable.insertRow(-1),\n\t\t\t\t\t{props : {className: 'calendar-section-slider-access-table-row'}}\n\t\t\t\t);\n\t\t\tconst titleNode = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\thtml: '<span class=\"calendar-section-slider-access-title\">' + Text.encode(title) + ':</span>'});\n\t\t\tconst valueCell = Dom.adjust(rowNode.insertCell(-1), {\n\t\t\t\t\tprops : {className: 'calendar-section-slider-access-table-cell'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-selector': code}\n\t\t\t\t});\n\t\t\tconst selectNode = valueCell.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-container'}\n\t\t\t\t}));\n\t\t\tconst valueNode = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\ttext: this.accessTasks[value] ? this.accessTasks[value].title : '',\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-value'}\n\t\t\t\t}));\n\t\t\tconst removeIcon = selectNode.appendChild(Dom.create('SPAN', {\n\t\t\t\t\tprops: {className: 'calendar-section-slider-access-remove'},\n\t\t\t\t\tattrs: {'data-bx-calendar-access-remove': code}\n\t\t\t\t}));\n\n\t\t\tthis.access[code] = value;\n\n\t\t\tthis.accessControls[code] = {\n\t\t\t\trowNode: rowNode,\n\t\t\t\ttitleNode: titleNode,\n\t\t\t\tvalueNode: valueNode,\n\t\t\t\tremoveIcon: removeIcon\n\t\t\t};\n\t\t}\n\t}\n\n\tcheckAccessTableHeight()\n\t{\n\t\tif (this.checkTableTimeout)\n\t\t{\n\t\t\tthis.checkTableTimeout = clearTimeout(this.checkTableTimeout);\n\t\t}\n\n\t\tthis.checkTableTimeout = setTimeout(() => {\n\t\t\tif (Dom.hasClass(this.DOM.accessWrap, 'shown'))\n\t\t\t{\n\t\t\t\tif (this.DOM.accessWrap.offsetHeight - this.DOM.accessTable.offsetHeight < 36)\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.accessWrap.style.maxHeight = parseInt(this.DOM.accessTable.offsetHeight) + 100 + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.accessWrap.style.maxHeight = '';\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\tshowAccessSelectorPopup(params)\n\t{\n\t\tif (\n\t\t\tthis.accessPopupMenu\n\t\t\t&& this.accessPopupMenu.popupWindow\n\t\t\t&& this.accessPopupMenu.popupWindow.isShown()\n\t\t)\n\t\t{\n\t\t\treturn this.accessPopupMenu.close();\n\t\t}\n\n\t\tconst _this = this;\n\t\tconst menuItems = [];\n\n\t\tfor(let taskId in this.accessTasks)\n\t\t{\n\t\t\tif (this.accessTasks.hasOwnProperty(taskId))\n\t\t\t{\n\t\t\t\tmenuItems.push(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.accessTasks[taskId].title,\n\t\t\t\t\t\tonclick: (function (value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tparams.setValueCallback(value);\n\t\t\t\t\t\t\t\t_this.accessPopupMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(taskId)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.accessPopupMenu = this.BX.PopupMenu.create(\n\t\t\t'section-access-popup' + Util.randomInt(),\n\t\t\tparams.node,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t{\n\t\t\t\t\tonPopupClose : this.allowSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.accessPopupMenu.show();\n\t\tthis.denySliderClose();\n\t}\n\n\topenHelpDesk()\n\t{\n\t\tlet helpDeskCode = 14326208;\n\t\ttop.BX.Helper.show('redirect=detail&code=' + helpDeskCode);\n\t}\n\n\tshowMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tthis.message.show();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 300 + \"px\";\n\t\t\tDom.addClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t}\n\t}\n\n\thideMessage()\n\t{\n\t\tif (this.message)\n\t\t{\n\t\t\tDom.removeClass(this.DOM.accessHelpIcon, 'calendar-settings-message-arrow-target');\n\t\t\tthis.message.hide();\n\t\t\tthis.DOM.accessMessageWrap.style.maxHeight = 0;\n\t\t\tif(!this.calendarContext.util.config.hideSettingsHintLocation)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('calendar.api.locationajax.hideSettingsHintLocation',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tvalue: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["SettingsInterface","options","calendarContext","showPersonalSettings","showGeneralSettings","showAccessControl","Type","isObjectLike","util","config","TYPE_ACCESS","settings","BX","Util","getBX","hideMessageBinded","hideMessage","bind","SidePanel","Instance","open","sliderId","contentCallback","createContent","width","SLIDER_WIDTH","animationDuration","SLIDER_DURATION","events","onCloseByEsc","escHide","onClose","hide","onCloseComplete","destroy","onLoad","onLoadSlider","event","getSlider","getUrl","denyClose","denyAction","isOpenedState","close","removeCustomEvent","proxy","DOM","sectionListWrap","slider","Promise","resolve","top","ajax","runAction","data","uid","then","response","getData","set","html","params","additionalParams","mailboxList","content","layout","get","initControls","setControlsValue","buttonsWrap","querySelector","ZIndexManager","register","saveBtn","closeBtn","Event","save","denyBusyInvitation","showWeekNumbers","meetSectionSelect","crmSelect","showDeclined","showTasks","syncTasks","showCompletedTasks","timezoneSelect","sendFromEmailSelect","isElementNode","emailSelectorControl","EmailSelectorControl","selectNode","allowAddNewEmail","emailHelpIcon","Helper","show","initHintNode","setValue","getUserOption","emailWrap","Calendar","isEventWithEmailGuestAllowed","Dom","removeClass","disabled","addClass","parentNode","UI","InfoHelper","workTimeStart","workTimeEnd","weekHolidays","yearHolidays","yearWorkdays","accessMessageWrap","accessOuterWrap","accessHelpIcon","type","initMessageControl","remove","initAccessController","moreMessageButton","Tag","render","Loc","getMessage","openHelpDesk","header","description","message","MessageCard","id","angle","hidden","actionElements","EventEmitter","subscribe","onClickHint","appendChild","getLayout","firstChild","childNodes","hideSettingsHintLocation","showMessage","isShown","length","sections","sectionManager","getSectionListForEdit","crmSection","parseInt","meetSection","section","selected","i","belongsToOwner","add","Option","name","checked","showWeekNumber","value","work_time_start","work_time_end","week_holidays","includes","year_holidays","year_workdays","typeAccess","code","hasOwnProperty","insertAccessRow","getAccessName","userSettings","userTimezoneName","timezoneName","sendFromEmail","getValue","user_settings","user_timezone_name","push","type_access","access","reload","accessWrap","accessTable","accessButton","accessControls","accessTasks","getTypeAccessTasks","accessNames","setAccessNames","entitySelectorDialog","EntitySelectorDialog","targetNode","context","preselectedItems","enableSearch","handleEntitySelectorChanges","popupOptions","targetContainer","document","body","entities","selectMode","allowSliderClose","denySliderClose","e","target","findTargetNode","srcElement","outerWrap","getAttribute","showAccessSelectorPopup","node","removeIcon","setValueCallback","valueNode","innerHTML","Text","encode","title","rowNode","entityList","getSelectedItems","isArray","forEach","entity","text","convertEntityToAccessCode","setAccessName","Runtime","debounce","undefined","taskId","adjust","insertRow","props","className","titleNode","insertCell","valueCell","attrs","create","checkTableTimeout","clearTimeout","setTimeout","hasClass","offsetHeight","style","maxHeight","accessPopupMenu","popupWindow","_this","menuItems","onclick","PopupMenu","randomInt","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","onPopupClose","helpDeskCode"],"mappings":"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"}