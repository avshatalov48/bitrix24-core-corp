{"version":3,"file":"sectionmanager.bundle.js","sources":["../src/calendarsection.js","../src/calendartasksection.js","../src/sectionmanager.js"],"sourcesContent":["import {Util} from 'calendar.util';\nimport { Event, Type } from 'main.core';\nimport {SectionManager} from \"calendar.sectionmanager\";\n\nexport class CalendarSection\n{\n\tconstructor(data)\n\t{\n\t\tthis.updateData(data);\n\t\tthis.calendarContext = Util.getCalendarContext();\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tthis.data = data || {};\n\t\tthis.type = data.CAL_TYPE || '';\n\t\tthis.ownerId = parseInt(data.OWNER_ID) || 0;\n\t\tthis.id = parseInt(data.ID);\n\t\tthis.color = this.data.COLOR;\n\t\tthis.name = this.data.NAME;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.calendarContext.sectionManager.sectionIsShown(this.id);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.isShown())\n\t\t{\n\t\t\tlet hiddenSections = this.calendarContext.sectionManager.getHiddenSections();\n\t\t\thiddenSections = hiddenSections.filter((sectionId) => {return sectionId !== this.id;}, this);\n\t\t\tthis.calendarContext.sectionManager.setHiddenSections(hiddenSections);\n\t\t\tthis.calendarContext.sectionManager.saveHiddenSections();\n\t\t}\n\t}\n\n\thide(): void\n\t{\n\t\tif (this.isShown())\n\t\t{\n\t\t\tconst hiddenSections = this.calendarContext.sectionManager.getHiddenSections();\n\t\t\thiddenSections.push(this.id);\n\t\t\tthis.calendarContext.sectionManager.setHiddenSections(hiddenSections);\n\t\t\tthis.calendarContext.sectionManager.saveHiddenSections();\n\t\t}\n\t}\n\n\tremove()\n\t{\n\t\tif (confirm(BX.message('EC_SEC_DELETE_CONFIRM')))\n\t\t{\n\t\t\tconst EventAlias = Util.getBX().Event;\n\t\t\tEventAlias.EventEmitter.emit(\n\t\t\t\t'BX.Calendar.Section:delete',\n\t\t\t\tnew EventAlias.BaseEvent({data: {sectionId: this.id}})\n\t\t\t);\n\n\t\t\tBX.ajax.runAction('calendar.api.calendarajax.deleteCalendarSection', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: this.id\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\thideSyncSection()\n\t{\n\t\tif (confirm(BX.message('EC_CAL_GOOGLE_HIDE_CONFIRM')))\n\t\t{\n\t\t\tthis.hide();\n\t\t\tBX.onCustomEvent(this.calendar, 'BXCalendar:onSectionDelete', [this.id]);\n\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t'BX.Calendar.Section:delete',\n\t\t\t\tnew Event.BaseEvent({data: {sectionId: this.id}})\n\t\t\t);\n\n\t\t\t//hideExternalCalendarSection\n\t\t\tBX.ajax.runAction('calendar.api.calendarajax.setSectionStatus', {\n\t\t\t\tdata: {\n\t\t\t\t\tsectionStatus: {\n\t\t\t\t\t\t[this.id] : false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\thideExternalCalendarSection()\n\t{\n\t\tif (confirm(BX.message('EC_CAL_GOOGLE_HIDE_CONFIRM')))\n\t\t{\n\t\t\tthis.hide();\n\t\t\tBX.onCustomEvent(this.calendar, 'BXCalendar:onSectionDelete', [this.id]);\n\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t'BX.Calendar.Section:delete',\n\t\t\t\tnew Event.BaseEvent({data: {sectionId: this.id}})\n\t\t\t);\n\n\t\t\tBX.ajax.runAction('calendar.api.calendarajax.hideExternalCalendarSection', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: this.id\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tgetLink()\n\t{\n\t\treturn this.data && this.data.LINK ? this.data.LINK : '';\n\t}\n\n\tcanBeConnectedToOutlook()\n\t{\n\t\treturn !this.isPseudo() && this.data.OUTLOOK_JS && !(this.data.CAL_DAV_CAL && this.data.CAL_DAV_CON) && !BX.browser.IsMac();\n\t}\n\n\tconnectToOutlook()\n\t{\n\t\tBX.ajax.runAction('calendar.api.syncajax.getOutlookLink', {\n\t\t\tdata: {\n\t\t\t\tid: this.id\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {\n\t\t\t\tconst url = response.data.result;\n\n\t\t\t\teval(url);\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t}\n\t\t)\n\t}\n\n\tcanDo(action)\n\t{\n\t\t//action: access|add|edit|edit_section|view_full|view_time|view_title\n\t\tif (this.isVirtual() && ['access','add','edit'].includes(action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.hasPermission(action);\n\t}\n\n\thasPermission(action)\n\t{\n\t\tif (action === 'view_event')\n\t\t{\n\t\t\taction = 'view_time';\n\t\t}\n\n\t\tif (!this.data.PERM[action])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.data.PERM && this.data.PERM[action];\n\t}\n\n\tisSuperposed()\n\t{\n\t\treturn !this.isPseudo() && !!this.data.SUPERPOSED;\n\t}\n\n\tisPseudo()\n\t{\n\t\treturn false;\n\t}\n\n\tisVirtual()\n\t{\n\t\treturn (this.data.CAL_DAV_CAL && this.data.CAL_DAV_CAL.indexOf('@virtual/events/') !== -1)\n\t\t\t|| (this.data.GAPI_CALENDAR_ID && this.data.GAPI_CALENDAR_ID.indexOf('@group.v.calendar.google.com') !== -1)\n\t\t\t|| (this.data.EXTERNAL_TYPE === 'google_readonly')\n\t\t\t|| (this.data.EXTERNAL_TYPE === 'google_freebusy')\n\t}\n\n\tisGoogle()\n\t{\n\t\tconst googleTypes = [\n\t\t\t'google_readonly',\n\t\t\t'google',\n\t\t\t'google_write_read',\n\t\t\t'google_freebusy'\n\t\t]\n\n\t\treturn !this.isPseudo() && googleTypes.includes(this.data.EXTERNAL_TYPE);\n\t}\n\n\tisCalDav()\n\t{\n\t\treturn !this.isPseudo() && this.data.CAL_DAV_CAL && this.data.CAL_DAV_CON;\n\t}\n\n\tisIcloud()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'icloud';\n\t}\n\n\tisOffice365()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'office365';\n\t}\n\n\tisArchive()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'archive';\n\t}\n\n\tisExchange()\n\t{\n\t\treturn !this.isPseudo() && this.data['IS_EXCHANGE'];\n\t}\n\n\tisCompanyCalendar()\n\t{\n\t\treturn !this.isPseudo() && this.type !== 'user' && this.type !== 'group' && !this.ownerId;\n\t}\n\n\thasConnection()\n\t{\n\t\treturn !this.isPseudo() && this.data.connectionLinks && this.data.connectionLinks.length;\n\t}\n\n\tisLocationRoom()\n\t{\n\t\treturn this.type === 'location';\n\t}\n\n\tbelongsToView()\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\treturn this.type === calendarContext.getCalendarType()\n\t\t\t&& this.ownerId === calendarContext.getOwnerId();\n\t}\n\n\tbelongsToOwner()\n\t{\n\t\treturn this.belongsToUser(Util.getCalendarContext().getUserId());\n\t}\n\n\tbelongsToUser(userId): boolean\n\t{\n\t\treturn this.type === 'user'\n\t\t\t&& this.ownerId === parseInt(userId)\n\t\t\t&& this.data.ACTIVE !== 'N';\n\t}\n\n\tgetExternalType(): string\n\t{\n\t\treturn this.data.EXTERNAL_TYPE\n\t\t\t? this.data.EXTERNAL_TYPE\n\t\t\t: (this.isCalDav() ? 'caldav' : '')\n\t\t;\n\t}\n\n\tgetConnectionLinks(): object\n\t{\n\t\treturn Type.isArray(this.data.connectionLinks)\n\t\t\t? this.data.connectionLinks\n\t\t\t: [];\n\t}\n\n\texternalTypeIsLocal(): boolean\n\t{\n\t\treturn this.getExternalType() === SectionManager.EXTERNAL_TYPE_LOCAL;\n\t}\n\n\tisPrimaryForConnection(): boolean\n\t{\n\t\treturn !this.externalTypeIsLocal() && this.getConnectionLinks().find(connection => {\n\t\t\treturn connection.isPrimary === 'Y';\n\t\t});\n\t}\n\n\tisActive()\n\t{\n\t\treturn this.data.ACTIVE !== 'N';\n\t}\n\n\tgetType()\n\t{\n\t\treturn this.type;\n\t}\n\n\tgetOwnerId()\n\t{\n\t\treturn this.ownerId;\n\t}\n\n\tgetConnectionIdList()\n\t{\n\t\tconst connectionIdList = [];\n\t\tlet connectionId =  parseInt(this.data.CAL_DAV_CON, 10);\n\t\tif (connectionId)\n\t\t{\n\t\t\tconnectionIdList.push(connectionId);\n\t\t}\n\n\t\treturn connectionIdList;\n\t}\n\n\n\tupdateListAfterDelete()\n\t{\n\t\tconst sectionManager = Util.getCalendarContext().sectionManager;\n\t\tlet reload = true;\n\t\tlet section;\n\n\t\tfor (let i = 0; i < sectionManager.sections.length; i++)\n\t\t{\n\t\t\tsection = sectionManager.sections[i];\n\t\t\tif (\n\t\t\t\tsection.id !== this.id\n\t\t\t\t&& section.belongsToView()\n\t\t\t\t&& !section.isGoogle()\n\t\t\t\t&& !section.isIcloud()\n\t\t\t\t&& !section.isOffice365()\n\t\t\t\t&& !section.isCalDav()\n\t\t\t\t&& !section.isArchive()\n\t\t\t)\n\t\t\t{\n\t\t\t\treload = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst calendar = Util.getCalendarContext();\n\t\tif (!calendar || reload)\n\t\t{\n\t\t\treturn Util.getBX().reload();\n\t\t}\n\t\tcalendar.reload();\n\t}\n\n}","import { Loc } from 'main.core';\nimport { CalendarSection } from './calendarsection';\n\nexport class CalendarTaskSection extends CalendarSection\n{\n\tconstructor(data = {}, {type, userId, ownerId})\n\t{\n\t\tconst defaultColor = '#ff5b55';\n\t\tlet belongToUser = false;\n\t\tlet defaultName = Loc.getMessage('EC_SEC_USER_TASK_DEFAULT');\n\n\t\tif (type === 'user' && userId === ownerId)\n\t\t{\n\t\t\tdefaultName = Loc.getMessage('EC_SEC_MY_TASK_DEFAULT');\n\t\t\tbelongToUser = true;\n\t\t}\n\t\telse if(type === 'group')\n\t\t{\n\t\t\tdefaultName = Loc.getMessage('EC_SEC_GROUP_TASK_DEFAULT');\n\t\t}\n\n\t\tsuper({\n\t\t\tID: 'tasks',\n\t\t\tNAME: data.name || defaultName,\n\t\t\tCOLOR: data.color || defaultColor,\n\t\t\tPERM: {\n\t\t\t\tedit_section: true,\n\t\t\t\tview_full: true,\n\t\t\t\tview_time: true,\n\t\t\t\tview_title: true\n\t\t\t}\n\t\t});\n\n\t\tthis.isUserTaskSection = belongToUser;\n\t}\n\n\tisPseudo(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\ttaskSectionBelongToUser()\n\t{\n\t\treturn this.isUserTaskSection;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tsuper.updateData(data);\n\t\tthis.id = data.ID;\n\t}\n}","import { Util } from 'calendar.util';\nimport { Event, Loc, Type, Runtime } from 'main.core';\nimport { CalendarSection } from './calendarsection';\nimport { CalendarTaskSection } from './calendartasksection';\nimport { EventEmitter } from 'main.core.events';\nexport { CalendarSection };\n\nexport class SectionManager\n{\n\tstatic newEntrySectionId = null;\n\tstatic EXTERNAL_TYPE_LOCAL = 'local';\n\tstatic RELOAD_DELAY = 1000;\n\n\tconstructor(data, config)\n\t{\n\t\tthis.setSections(data.sections);\n\t\tthis.setConfig(config);\n\t\tthis.addTaskSection();\n\t\tthis.sortSections();\n\t\tEventEmitter.subscribeOnce('BX.Calendar.Section:delete', (event) => {\n\t\t\tthis.deleteSectionHandler(event.data.sectionId);\n\t\t});\n\n\t\tthis.reloadDataDebounce = Runtime.debounce(this.reloadData, SectionManager.RELOAD_DELAY, this);\n\t}\n\n\tsetSections(rawSections = [])\n\t{\n\t\tthis.sections = [];\n\t\tthis.sectionIndex = {};\n\n\t\trawSections.forEach((sectionData) => {\n\t\t\tconst section = new CalendarSection(sectionData);\n\t\t\tif (section.canDo('view_time'))\n\t\t\t{\n\t\t\t\tthis.sections.push(section);\n\t\t\t\tthis.sectionIndex[section.getId()] = this.sections.length - 1;\n\t\t\t}\n\t\t});\n\t}\n\n\tsortSections()\n\t{\n\t\tthis.sectionIndex = {};\n\t\tthis.sections = this.sections.sort((a, b) => {\n\t\t\tif (Type.isFunction(a.isPseudo) && a.isPseudo())\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse if (Type.isFunction(b.isPseudo) && b.isPseudo())\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn a.name.localeCompare(b.name);\n\t\t});\n\n\t\tthis.sections.forEach((section, index) => {\n\t\t\tthis.sectionIndex[section.getId()] = index;\n\t\t});\n\t}\n\n\tsetConfig(config)\n\t{\n\t\tthis.setHiddenSections(config.hiddenSections);\n\t\tthis.calendarType = config.type;\n\t\tthis.ownerId = config.ownerId;\n\t\tthis.ownerName = config.ownerName || '';\n\t\tthis.userId = config.userId;\n\t\tthis.defaultSectionAccess = config.new_section_access || {};\n\n\t\tthis.sectionAccessTasks = config.sectionAccessTasks;\n\t\tthis.showTasks = config.showTasks;\n\t\tthis.customizationData = config.sectionCustomization || {};\n\t}\n\n\taddTaskSection()\n\t{\n\t\tif (this.showTasks)\n\t\t{\n\t\t\tconst taskSection = new CalendarTaskSection(\n\t\t\t\tthis.customizationData['tasks' + this.ownerId],\n\t\t\t\t{\n\t\t\t\t\ttype: this.calendarType,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\townerId: this.ownerId\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.sections.push(taskSection);\n\t\t\tthis.sectionIndex[taskSection.id] = this.sections.length - 1;\n\t\t}\n\t}\n\n\tgetCalendarType()\n\t{\n\t\treturn this.calendarType;\n\t}\n\n\thandlePullChanges(params)\n\t{\n\t\tif (params.command === 'delete_section')\n\t\t{\n\t\t\tconst sectionId = parseInt(params.fields.ID, 10);\n\t\t\tif (this.sectionIndex[sectionId])\n\t\t\t{\n\t\t\t\tthis.deleteSectionHandler(sectionId);\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t'BX.Calendar.Section:pull-delete',\n\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: { sectionId: sectionId }\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadDataDebounce();\n\t\t\t}\n\t\t}\n\t\telse if (params.command === 'edit_section')\n\t\t{\n\t\t\tthis.reloadDataDebounce();\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reloadDataDebounce();\n\t\t}\n\t}\n\n\treloadData()\n\t{\n\t\tBX.ajax.runAction('calendar.api.calendarajax.getSectionList', {\n\t\t\t\tdata: {\n\t\t\t\t\t'type': this.calendarType,\n\t\t\t\t\t'ownerId': this.ownerId\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\t\tthis.setSections(response.data.sections || []);\n\t\t\t\t\tthis.sortSections();\n\t\t\t\t\tif (response.data.config)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setConfig(config);\n\t\t\t\t\t}\n\t\t\t\t\tthis.addTaskSection();\n\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t'BX.Calendar.Section:pull-reload-data'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\tgetSections()\n\t{\n\t\treturn this.sections;\n\t}\n\n\tgetSuperposedSectionList()\n\t{\n\t\tvar i, result = [];\n\t\tfor (i = 0; i < this.sections.length; i++)\n\t\t{\n\t\t\tif (this.sections[i].isSuperposed()\n\t\t\t\t&& this.sections[i].isActive())\n\t\t\t{\n\t\t\t\tresult.push(this.sections[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSectionListForEdit()\n\t{\n\t\tconst result = [];\n\t\tfor (let i = 0; i < this.sections.length; i++)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.sections[i].canDo('add')\n\t\t\t\t&& !this.sections[i].isPseudo()\n\t\t\t\t&& this.sections[i].isActive()\n\t\t\t\t&& !this.sections[i].isLocationRoom()\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult.push(this.sections[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSection(id)\n\t{\n\t\treturn this.sections[this.sectionIndex[id]] || {};\n\t}\n\n\tgetDefaultSectionName()\n\t{\n\t\treturn Loc.getMessage('EC_DEFAULT_SECTION_NAME');\n\t}\n\n\tgetDefaultSectionAccess()\n\t{\n\t\treturn this.defaultSectionAccess;\n\t\t// return this.calendar.util.config.new_section_access || {};\n\t}\n\n\tsaveSection(name, color, access, params)\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tname = (Type.isString(name) && name.trim())\n\t\t\t\t? name.trim()\n\t\t\t\t: Loc.getMessage('EC_SEC_SLIDER_NEW_SECTION');\n\n\t\t\tif (params.section.id)\n\t\t\t{\n\t\t\t\t// BX.onCustomEvent(this.calendar, 'BXCalendar:onSectionChange', [\n\t\t\t\t// \tparams.section.id,\n\t\t\t\t// \t{\n\t\t\t\t// \t\tname: name,\n\t\t\t\t// \t\tcolor: color\n\t\t\t\t// \t}]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// BX.onCustomEvent(this.calendar, 'BXCalendar:onSectionAddBefore', [{\n\t\t\t\t// \tname: name,\n\t\t\t\t// \tcolor: color\n\t\t\t\t// }]);\n\t\t\t}\n\n\t\t\tconst isCustomization = params.section.id && params.section.isPseudo();\n\t\t\tBX.ajax.runAction('calendar.api.calendarajax.editCalendarSection', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\taction: params.section.id ? 'editSection' : 'newSection',\n\t\t\t\t\t\t\ttype: params.section.type || this.calendarType\n\t\t\t\t\t\t},\n\t\t\t\t\t\tid: params.section.id || 0,\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttype: params.section.type || this.calendarType,\n\t\t\t\t\t\townerId: params.section.ownerId || this.ownerId,\n\t\t\t\t\t\tcolor: color,\n\t\t\t\t\t\taccess: access || null,\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tcustomization: isCustomization ? 'Y' : 'N',\n\t\t\t\t\t\texternal_type: params?.section?.id ? params.section.getExternalType() : 'local'\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (isCustomization)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.reload();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst sectionList = response.data.sectionList || [];\n\t\t\t\t\t\tthis.setSections(sectionList);\n\t\t\t\t\t\tthis.sortSections();\n\t\t\t\t\t\tthis.addTaskSection();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Section:edit',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { sectionList: sectionList }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t});\n\t}\n\n\tsectionIsShown(id)\n\t{\n\t\treturn !BX.util.in_array(id, this.hiddenSections);\n\t}\n\n\tgetHiddenSections()\n\t{\n\t\treturn this.hiddenSections;\n\t}\n\n\tsetHiddenSections(hiddenSections)\n\t{\n\t\tthis.hiddenSections = [];\n\t\tif (Type.isArray(hiddenSections))\n\t\t{\n\t\t\thiddenSections.forEach((id) => {\n\t\t\t\tthis.hiddenSections.push(id === 'tasks' ? id : parseInt(id));\n\t\t\t});\n\t\t}\n\t}\n\n\tsaveHiddenSections()\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tconst optionName = calendarContext.util.userIsOwner()\n\t\t\t? 'hidden_sections'\n\t\t\t: 'hidden_sections_' + calendarContext.util.type;\n\n\t\tBX.userOptions.save('calendar', optionName, optionName, this.hiddenSections);\n\t}\n\n\tgetSectionsInfo()\n\t{\n\t\tconst allActive = [];\n\t\tconst superposed = [];\n\t\tconst active = [];\n\t\tconst hidden = [];\n\n\t\tthis.sections.forEach((section) => {\n\t\t\tif(section.isShown() && this.calendarType === 'location' && section.type === 'location')\n\t\t\t{\n\t\t\t\tif (section.isSuperposed())\n\t\t\t\t{\n\t\t\t\t\tsuperposed.push(section.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactive.push(section.id);\n\t\t\t\t}\n\t\t\t\tallActive.push(section.id);\n\t\t\t}\n\t\t\telse if (section.isShown() && this.calendarType !== 'location')\n\t\t\t{\n\t\t\t\tif (section.isSuperposed())\n\t\t\t\t{\n\t\t\t\t\tsuperposed.push(section.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactive.push(section.id);\n\t\t\t\t}\n\t\t\t\tallActive.push(section.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thidden.push(section.id);\n\t\t\t}\n\t\t});\n\n\t\treturn { superposed, active, hidden, allActive };\n\t}\n\n\tdeleteSectionHandler(sectionId)\n\t{\n\t\tif (this.sectionIndex[sectionId] !== undefined)\n\t\t{\n\t\t\tthis.sections = BX.util.deleteFromArray(this.sections, this.sectionIndex[sectionId]);\n\n\t\t\tthis.sectionIndex = {};\n\t\t\tfor (let i = 0; i < this.sections.length; i++)\n\t\t\t{\n\t\t\t\tthis.sectionIndex[this.sections[i].id] = i;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getNewEntrySectionId(calendarType = null, ownerId = null)\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tif (calendarContext && !calendarContext.isExternalMode())\n\t\t{\n\t\t\tcalendarType = calendarType || calendarContext.util.type;\n\t\t\tif (calendarType === 'location')\n\t\t\t{\n\t\t\t\tconst section = calendarContext.sectionManager.getDefaultSection(\n\t\t\t\t\t'user',\n\t\t\t\t\tcalendarContext.util.userId\n\t\t\t\t);\n\t\t\t\treturn parseInt(section.id, 10);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst section = calendarContext.sectionManager.getDefaultSection(calendarType, ownerId);\n\t\t\t\treturn parseInt(section.id, 10);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic setNewEntrySectionId(sectionId)\n\t{\n\t\tSectionManager.newEntrySectionId = parseInt(sectionId);\n\t}\n\n\tstatic getSectionGroupList(options = {})\n\t{\n\t\tlet\n\t\t\ttype = options.type,\n\t\t\townerId = options.ownerId,\n\t\t\tuserId = options.userId,\n\t\t\tfollowedUserList = options.trackingUsersList || Util.getFollowedUserList(userId),\n\t\t\tsectionGroups = [],\n\t\t\ttitle;\n\n\t\t// 1. Main group - depends from current view\n\t\tif (type === 'user')\n\t\t{\n\t\t\tif (userId === ownerId)\n\t\t\t{\n\t\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_MY_CALENDARS_LIST');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_USER_CALENDARS_LIST');\n\t\t\t}\n\t\t}\n\t\telse if (type === 'group')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_GROUP_CALENDARS_LIST');\n\t\t}\n\t\telse if (type === 'location')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TYPE_LOCATION_LIST');\n\t\t}\n\t\telse if (type === 'resource')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TYPE_RESOURCE_LIST');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TITLE_COMP_CAL');\n\t\t}\n\n\t\tsectionGroups.push({\n\t\t\ttitle: title,\n\t\t\ttype: type,\n\t\t\tbelongsToView: true\n\t\t});\n\n\t\tif (type !== 'user' || userId !== ownerId)\n\t\t{\n\t\t\tsectionGroups.push({\n\t\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_MY_CALENDARS_LIST'),\n\t\t\t\ttype: 'user',\n\t\t\t\townerId: userId\n\t\t\t});\n\t\t}\n\n\t\t// 2. Company calendar\n\t\tif (type !== 'company' && type !== 'company_calendar' && type !== 'calendar_company')\n\t\t{\n\t\t\tsectionGroups.push({\n\t\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_COMP_CAL'),\n\t\t\t\ttype: 'company'\n\t\t\t});\n\t\t}\n\n\t\t// 3. Users calendars\n\t\tif (Type.isArray(followedUserList))\n\t\t{\n\t\t\tfollowedUserList.forEach((user) => {\n\t\t\t\tif (parseInt(user.ID) !== ownerId || type !== 'user')\n\t\t\t\t{\n\t\t\t\t\tsectionGroups.push({\n\t\t\t\t\t\ttitle: BX.util.htmlspecialchars(user.FORMATTED_NAME),\n\t\t\t\t\t\ttype: 'user',\n\t\t\t\t\t\townerId: parseInt(user.ID)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 4. Groups calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP'),\n\t\t\ttype: 'group'\n\t\t});\n\n\t\t// 5. Resources calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_RESOURCE_CAL'),\n\t\t\ttype: 'resource'\n\t\t});\n\n\t\t// 6. Location calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_LOCATION_CAL'),\n\t\t\ttype: 'location'\n\t\t});\n\n\t\treturn sectionGroups;\n\t}\n\n\tgetSectionAccessTasks()\n\t{\n\t\treturn this.sectionAccessTasks;\n\t}\n\n\tgetDefaultSection(calendarType = null, ownerId = null)\n\t{\n\t\tcalendarType = Type.isString(calendarType) ? calendarType : this.calendarType;\n\t\townerId = Type.isNumber(ownerId) ? ownerId : this.ownerId;\n\n\t\tconst userSettings = Util.getUserSettings();\n\t\tconst key = calendarType + ownerId;\n\t\tconst defaultSectionId = userSettings.defaultSections[key] || userSettings.lastUsedSection;\n\t\tconst sections = this.getSectionListForEdit();\n\n\t\tlet section = sections.find((item) => {\n\t\t\treturn item.type === calendarType\n\t\t\t\t&& item.ownerId === ownerId\n\t\t\t\t&& item.id === defaultSectionId;\n\t\t});\n\n\t\tif (!section)\n\t\t{\n\t\t\tsection = sections.find((item) => {\n\t\t\t\treturn item.type === calendarType\n\t\t\t\t\t&& item.ownerId === ownerId\n\t\t\t});\n\t\t}\n\n\t\treturn section;\n\t}\n\n\tsetDefaultSection(sectionId)\n\t{\n\t\tconst section = this.getSection(parseInt(sectionId, 10));\n\n\t\tif (section\n\t\t\t&& section.type === this.calendarType\n\t\t\t&& section.ownerId === this.ownerId)\n\t\t{\n\t\t\tconst userSettings = Util.getUserSettings();\n\t\t\tconst key = this.calendarType + this.ownerId;\n\t\t\tif (userSettings.defaultSections[key] !== section.id)\n\t\t\t{\n\t\t\t\tuserSettings.defaultSections[key] = section.id;\n\t\t\t\tUtil.setUserSettings(userSettings);\n\n\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.updateDefaultSectionId', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'key': key,\n\t\t\t\t\t\t'sectionId': sectionId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic saveDefaultSectionId(sectionId, options = {})\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tif (calendarContext)\n\t\t{\n\t\t\tcalendarContext.sectionManager.setDefaultSection(sectionId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (Type.isArray(options.sections) && options.calendarType && options.ownerId)\n\t\t\t{\n\t\t\t\tconst section = options.sections.find((item) => {\n\t\t\t\t\tconst id = parseInt(item.ID || item.id, 10);\n\t\t\t\t\tconst ownerId = parseInt(item.OWNER_ID || item.ownerId, 10);\n\t\t\t\t\tconst type = item.CAL_TYPE || item.type;\n\n\t\t\t\t\treturn id === parseInt(sectionId,10)\n\t\t\t\t\t\t&& ownerId === parseInt(options.ownerId, 10)\n\t\t\t\t\t\t&& type === options.calendarType;\n\t\t\t\t});\n\n\t\t\t\tif (section)\n\t\t\t\t{\n\t\t\t\t\tconst userSettings = Util.getUserSettings();\n\t\t\t\t\tconst key = options.calendarType + options.ownerId;\n\t\t\t\t\tif (userSettings && userSettings.defaultSections[key] !== sectionId)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserSettings.defaultSections[key] = sectionId;\n\t\t\t\t\t\tUtil.setUserSettings(userSettings);\n\t\t\t\t\t\tSectionManager.newEntrySectionId = sectionId;\n\n\t\t\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.updateDefaultSectionId', {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t'key': key,\n\t\t\t\t\t\t\t\t'sectionId': sectionId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getSectionExternalConnection(section, sectionExternalType): any\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tconst linkList = section.getConnectionLinks();\n\n\t\tlet provider = undefined;\n\t\tlet connection = undefined;\n\t\tlet connectionId = linkList.length\n\t\t\t? parseInt(linkList[0].id)\n\t\t\t: parseInt(section.data.CAL_DAV_CON, 10)\n\t\t;\n\n\t\tif (connectionId && calendarContext && calendarContext.syncInterface)\n\t\t{\n\t\t\t[provider, connection] = calendarContext.syncInterface.getProviderById(connectionId);\n\n\t\t\tif (\n\t\t\t\tconnection\n\t\t\t\t&& (!linkList.length || connection.getType() === sectionExternalType)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn connection;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"],"names":["CalendarSection","constructor","data","updateData","calendarContext","Util","getCalendarContext","getId","id","type","CAL_TYPE","ownerId","parseInt","OWNER_ID","ID","color","COLOR","name","NAME","isShown","sectionManager","sectionIsShown","show","hiddenSections","getHiddenSections","filter","sectionId","setHiddenSections","saveHiddenSections","hide","push","remove","confirm","BX","message","EventAlias","getBX","Event","EventEmitter","emit","BaseEvent","ajax","runAction","then","response","updateListAfterDelete","hideSyncSection","onCustomEvent","calendar","sectionStatus","hideExternalCalendarSection","getLink","LINK","canBeConnectedToOutlook","isPseudo","OUTLOOK_JS","CAL_DAV_CAL","CAL_DAV_CON","browser","IsMac","connectToOutlook","url","result","eval","canDo","action","isVirtual","includes","hasPermission","PERM","isSuperposed","SUPERPOSED","indexOf","GAPI_CALENDAR_ID","EXTERNAL_TYPE","isGoogle","googleTypes","isCalDav","isIcloud","isOffice365","isArchive","isExchange","isCompanyCalendar","hasConnection","connectionLinks","length","isLocationRoom","belongsToView","getCalendarType","getOwnerId","belongsToOwner","belongsToUser","getUserId","userId","ACTIVE","getExternalType","getConnectionLinks","Type","isArray","externalTypeIsLocal","SectionManager","EXTERNAL_TYPE_LOCAL","isPrimaryForConnection","find","connection","isPrimary","isActive","getType","getConnectionIdList","connectionIdList","connectionId","reload","section","i","sections","CalendarTaskSection","defaultColor","belongToUser","defaultName","Loc","getMessage","edit_section","view_full","view_time","view_title","isUserTaskSection","taskSectionBelongToUser","config","setSections","setConfig","addTaskSection","sortSections","subscribeOnce","event","deleteSectionHandler","reloadDataDebounce","Runtime","debounce","reloadData","RELOAD_DELAY","rawSections","sectionIndex","forEach","sectionData","sort","a","b","isFunction","localeCompare","index","calendarType","ownerName","defaultSectionAccess","new_section_access","sectionAccessTasks","showTasks","customizationData","sectionCustomization","taskSection","handlePullChanges","params","command","fields","getSections","getSuperposedSectionList","getSectionListForEdit","getSection","getDefaultSectionName","getDefaultSectionAccess","saveSection","access","Promise","resolve","isString","trim","isCustomization","analyticsLabel","customization","external_type","sectionList","Calendar","displayError","errors","util","in_array","optionName","userIsOwner","userOptions","save","getSectionsInfo","allActive","superposed","active","hidden","undefined","deleteFromArray","getNewEntrySectionId","isExternalMode","getDefaultSection","setNewEntrySectionId","newEntrySectionId","getSectionGroupList","options","followedUserList","trackingUsersList","getFollowedUserList","sectionGroups","title","user","htmlspecialchars","FORMATTED_NAME","getSectionAccessTasks","isNumber","userSettings","getUserSettings","key","defaultSectionId","defaultSections","lastUsedSection","item","setDefaultSection","setUserSettings","saveDefaultSectionId","getSectionExternalConnection","sectionExternalType","linkList","provider","syncInterface","getProviderById"],"mappings":"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"}