BX.namespace("BX.Security");BX.Security.UserRecoveryCodes=function e(t){"use strict";var r=function(e){var r={actionUrl:location.href,ui:{containerId:"recovery-codes-container"}};e=e||{};this.signedParameters=e.signedParameters;this.componentName=e.componentName;this._options=n(r,e);this._container=t(this._options.ui.containerId);this.codesTemplate=null;this.codesContainer=null;this.initializeInterface()};r.prototype.initializeInterface=function(e){var r=this._container.querySelectorAll('[data-role="regenerate-button"]');var n=this._container.querySelector('[data-role="code-template"]');if(n){this.codesContainer=n.parentNode;this.codesTemplate=n.cloneNode(true)}[].forEach.call(r,function e(r){t.bind(r,"click",this.onRegenerate.bind(this))},this)};r.prototype.onRegenerate=function(e){if(e)e.preventDefault();t.ajax.runComponentAction(this.componentName,"regenerateRecoveryCodes",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){this.drawRecoveryCodes(e.data)}.bind(this),function(e){this.showError(e["errors"][0].message)}.bind(this))};r.prototype.drawRecoveryCodes=function(e){[].forEach.call(this._container.querySelectorAll('[data-autoclear="yes"]'),function e(r){t.remove(r)},this);[].forEach.call(e,function e(r){var n=this.codesTemplate.cloneNode(true);n.style.display="";if(r.USED=="Y"&&n.getAttribute("data-used-class"))t.addClass(n,n.getAttribute("data-used-class"));var i=n.querySelectorAll("*");[].forEach.call(i,function e(n){if(r.USED!="Y"&&n.getAttribute("data-visible-on-used")=="yes"){t.remove(n);return}var i=n.getAttribute("data-code-template-role");switch(i){case"code":n.innerHTML=t.util.htmlspecialchars(r.VALUE);break;case"using-date":if(r.USING_DATE)n.innerHTML=t.util.htmlspecialchars(r.USING_DATE);break;default:break}},this);this.codesContainer.appendChild(n)},this)};r.prototype.showError=function(e){if(!this._errorContainer)return;var r=t.create("div",{children:[t.create("div",{text:t.message("SECURITY_OTP_ERROR_TITLE")}),t.create("div",{html:e})],attrs:{className:"bx-notice error"}});this._errorContainer.appendChild(r)};r.prototype.clearErrors=function(){if(!this._errorContainer)return;t.cleanNode(this._errorContainer)};r.prototype.onComplete=function(){location.href=this._successfulUrl};function n(e,t){for(var r in t){if(!t.hasOwnProperty(r))continue;if(t[r]&&t[r].constructor===Object){if(e[r]&&e[r].constructor===Object){e[r]=n(e[r],t[r])}else{e[r]=i(t[r])}}else{e[r]=t[r]}}return e}function i(e){return JSON.parse(JSON.stringify(e))}return r}(BX);
//# sourceMappingURL=script.map.js