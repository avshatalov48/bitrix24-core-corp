this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n,d){"use strict";var b=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(b,"INITIAL","INITIAL");babelHelpers.defineProperty(b,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(b,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(b,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(b,"DATA_LOADED","DATA_LOADED");var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new l.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();var c=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);var a=e.bindElement.getBoundingClientRect();s.popupWindow.setMaxWidth(a.width);return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[this.choseItemIdx]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=t;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}}]);return t}(a.Menu);function u(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=p(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function p(e,t){if(!e)return;if(typeof e==="string")return h(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return h(e,t)}function h(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function v(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var f=new WeakMap;var H=new WeakMap;var F=new WeakMap;var P=new WeakSet;var m=new WeakSet;var g=new WeakSet;var w=new WeakSet;var y=new WeakSet;var T=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));y.add(babelHelpers.assertThisInitialized(s));w.add(babelHelpers.assertThisInitialized(s));g.add(babelHelpers.assertThisInitialized(s));m.add(babelHelpers.assertThisInitialized(s));P.add(babelHelpers.assertThisInitialized(s));f.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});H.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});F.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),f,e.inputNode);return s}babelHelpers.createClass(t,[{key:"getMenu",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,H)||babelHelpers.classPrivateFieldGet(this,H).isDestroyed()){babelHelpers.classPrivateFieldSet(this,H,v(this,P,I).call(this))}return babelHelpers.classPrivateFieldGet(this,H)}},{key:"show",value:function e(t,s){if(t.length>0){v(this,m,G).call(this,t,s);this.getMenu().show()}}},{key:"close",value:function e(){this.getMenu().close()}},{key:"choosePrevItem",value:function e(){var t=null;var s=this.getMenu().choosePrevItem();if(s){t=v(this,y,E).call(this,s.id)}return t}},{key:"chooseNextItem",value:function e(){var t=null;var s=this.getMenu().chooseNextItem();if(s){t=v(this,y,E).call(this,s.id)}return t}},{key:"isItemChosen",value:function e(){return babelHelpers.classPrivateFieldGet(this,H).isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=babelHelpers.classPrivateFieldGet(this,H).getChosenItem();if(s&&s.id){t=v(this,y,E).call(this,s.id)}return t}},{key:"isShown",value:function e(){return this.getMenu().isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,H)){babelHelpers.classPrivateFieldGet(this,H).destroy();babelHelpers.classPrivateFieldSet(this,H,null)}babelHelpers.classPrivateFieldSet(this,F,null)}}],[{key:"createMenuItemText",value:function e(t,s){var a=t.slice();if(!s||s.length<=0){return a}var i=s.replace(/,+/gi,"").split(new RegExp(/\s+/g));var l=new RegExp("(".concat(i.join("|"),")"),"gi");a=t.replace(l,function(e){return"<strong>".concat(e,"</strong>")});return a}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(T,"onItemSelectedEvent","onItemSelected");var I=function e(){return new c({bindElement:babelHelpers.classPrivateFieldGet(this,f),autoHide:false,closeByEsc:true})};var G=function e(t,s){var a=this;this.getMenu().clearItems();if(Array.isArray(t)){babelHelpers.classPrivateFieldSet(this,F,t.slice());t.forEach(function(e){a.getMenu().addMenuItem(v(a,g,k).call(a,e,s))})}};var k=function e(t,s){var a=this;var i=t.externalId;return{id:i,title:t.name,html:T.createMenuItemText(t.name,s),onclick:function e(t,s){v(a,w,S).call(a,i);a.close()}}};var S=function e(t){var s=v(this,y,E).call(this,t);if(s){this.emit(T.onItemSelectedEvent,{location:s})}};var E=function e(t){var s=null;var a=u(babelHelpers.classPrivateFieldGet(this,F)),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;if(l.externalId===t){s=l;break}}}catch(e){a.e(e)}finally{a.f()}if(!s){BX.debug("Location with externalId "+t+" was not found")}return s};function C(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function W(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function A(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var z=new WeakMap;var M=new WeakMap;var _=new WeakMap;var L=new WeakMap;var B=new WeakMap;var O=new WeakMap;var D=new WeakMap;var N=new WeakMap;var X=new WeakMap;var R=new WeakMap;var x=new WeakMap;var U=new WeakMap;var Y=new WeakMap;var V=new WeakMap;var j=new WeakMap;var q=new WeakMap;var J=new WeakMap;var K=new WeakMap;var $=new WeakSet;var Q=new WeakSet;var Z=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var se=new WeakSet;var ae=new WeakSet;var ie=new WeakSet;var le=new WeakSet;var re=new WeakSet;var ne=new WeakSet;var de=new WeakSet;var be=new WeakSet;var oe=new WeakSet;var ce=new WeakSet;var ue=new WeakSet;var pe=new WeakSet;var he=new WeakSet;var ve=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));he.add(babelHelpers.assertThisInitialized(s));pe.add(babelHelpers.assertThisInitialized(s));ue.add(babelHelpers.assertThisInitialized(s));ce.add(babelHelpers.assertThisInitialized(s));oe.add(babelHelpers.assertThisInitialized(s));be.add(babelHelpers.assertThisInitialized(s));de.add(babelHelpers.assertThisInitialized(s));ne.add(babelHelpers.assertThisInitialized(s));re.add(babelHelpers.assertThisInitialized(s));le.add(babelHelpers.assertThisInitialized(s));ie.add(babelHelpers.assertThisInitialized(s));ae.add(babelHelpers.assertThisInitialized(s));se.add(babelHelpers.assertThisInitialized(s));te.add(babelHelpers.assertThisInitialized(s));ee.add(babelHelpers.assertThisInitialized(s));Z.add(babelHelpers.assertThisInitialized(s));Q.add(babelHelpers.assertThisInitialized(s));$.add(babelHelpers.assertThisInitialized(s));z.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});M.set(babelHelpers.assertThisInitialized(s),{writable:true,value:""});_.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});L.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});B.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});O.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});D.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});N.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});X.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});R.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});x.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});U.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Y.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});V.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});j.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});q.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});J.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});K.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof l.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),L,e.addressFormat);if(!(e.autocompleteService instanceof l.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),D,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),_,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),z,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),B,e.locationRepository||new l.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),X,e.promptDelay||500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),R,e.maxPromptDelay||1500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),N,e.minCharsCountToAutocomplete||3);A(babelHelpers.assertThisInitialized(s),le,Ee).call(babelHelpers.assertThisInitialized(s),b.INITIAL);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),J,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),X));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,U,t.inputNode);babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,U).value);babelHelpers.classPrivateFieldSet(this,z,t.address);babelHelpers.classPrivateFieldGet(this,U).addEventListener("keyup",A(this,ce,_e).bind(this));babelHelpers.classPrivateFieldGet(this,U).addEventListener("focus",A(this,Z,ye).bind(this));babelHelpers.classPrivateFieldGet(this,U).addEventListener("focusout",A(this,Q,we).bind(this));babelHelpers.classPrivateFieldSet(this,O,new T({inputNode:t.inputNode}));babelHelpers.classPrivateFieldGet(this,O).subscribe(T.onItemSelectedEvent,A(this,ie,Se).bind(this));document.addEventListener("click",A(this,se,Ge).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(W(t,t,He),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(W(t,t,Fe),s)}},{key:"onSearchStartedEventSubscribe",value:function e(s){this.subscribe(W(t,t,Pe),s)}},{key:"onSearchCompletedEventSubscribe",value:function e(s){this.subscribe(W(t,t,me),s)}},{key:"showPrompt",value:function e(t,s){babelHelpers.classPrivateFieldGet(this,Y).requested=t;babelHelpers.classPrivateFieldGet(this,Y).current=t;babelHelpers.classPrivateFieldGet(this,Y).dropped="";A(this,pe,Be).call(this,t,s,A(this,ue,Le).call(this))}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,O)){babelHelpers.classPrivateFieldGet(this,O).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,O)){babelHelpers.classPrivateFieldGet(this,O).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,j)){return}d.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,O)){babelHelpers.classPrivateFieldGet(this,O).destroy();babelHelpers.classPrivateFieldSet(this,O,null)}babelHelpers.classPrivateFieldSet(this,x,null);if(babelHelpers.classPrivateFieldGet(this,U)){babelHelpers.classPrivateFieldGet(this,U).removeEventListener("keyup",A(this,ce,_e));babelHelpers.classPrivateFieldGet(this,U).removeEventListener("focus",A(this,Z,ye));babelHelpers.classPrivateFieldGet(this,U).removeEventListener("focusout",A(this,Q,we))}document.removeEventListener("click",A(this,se,Ge));babelHelpers.classPrivateFieldSet(this,j,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,z,t);if(babelHelpers.classPrivateFieldGet(this,U)){babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,U).value)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,z)}},{key:"prompt",get:function e(){return babelHelpers.classPrivateFieldGet(this,O)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,V)}}]);return t}(n.EventEmitter);var fe=function e(t){t=t.trim();if(t.length<=0){return["",""]}var s=t.lastIndexOf(" ");if(s<=0){return["",""]}return[t.slice(0,s),t.slice(s+1)]};var He={writable:true,value:"onAddressChanged"};var Fe={writable:true,value:"onStateChanged"};var Pe={writable:true,value:"onSearchStarted"};var me={writable:true,value:"onSearchCompleted"};var ge=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,L),l.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,l.AddressStringConverter.CONTENT_TYPE_TEXT)};var we=function e(){if(babelHelpers.classPrivateFieldGet(this,j)){return}if(babelHelpers.classPrivateFieldGet(this,V)===b.DATA_INPUTTING){A(this,le,Ee).call(this,b.DATA_SELECTED);A(this,te,Ie).call(this)}if(babelHelpers.classPrivateFieldGet(this,O)){babelHelpers.classPrivateFieldGet(this,O).close()}};var ye=function e(){if(babelHelpers.classPrivateFieldGet(this,j)){return}if(babelHelpers.classPrivateFieldGet(this,z)&&!babelHelpers.classPrivateFieldGet(this,z).location&&babelHelpers.classPrivateFieldGet(this,U).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,U).value,{})}};var Te=function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,U)){t=babelHelpers.classPrivateFieldGet(this,U).value}return t};var Ie=function e(){babelHelpers.classPrivateFieldSet(this,z,A(this,be,ze).call(this,A(this,ee,Te).call(this)));A(this,ne,We).call(this)};var Ge=function e(t){if(babelHelpers.classPrivateFieldGet(this,j)){return}if(t.target===babelHelpers.classPrivateFieldGet(this,U)){return}if(babelHelpers.classPrivateFieldGet(this,O).isShown()){babelHelpers.classPrivateFieldGet(this,O).close()}};var ke=function e(t,s){var a=this;if(Array.isArray(t)&&t.length>0){babelHelpers.classPrivateFieldGet(this,O).show(t,babelHelpers.classPrivateFieldGet(this,Y).requested)}else{var i=C(ve,ve,fe).call(ve,babelHelpers.classPrivateFieldGet(this,Y).current);babelHelpers.classPrivateFieldGet(this,Y).current=i[0];babelHelpers.classPrivateFieldGet(this,Y).dropped=i[1]+" "+babelHelpers.classPrivateFieldGet(this,Y).dropped;if(babelHelpers.classPrivateFieldGet(this,Y).current.length>0){A(this,pe,Be).call(this,babelHelpers.classPrivateFieldGet(this,Y).current,s,1)}else{babelHelpers.classPrivateFieldGet(this,O).getMenu().clearItems();babelHelpers.classPrivateFieldGet(this,O).getMenu().addMenuItem({id:"notFound",html:"<span>".concat(d.Loc.getMessage("LOCATION_WIDGET_PROMPT_RESULTS_NOT_FOUND"),"</span>"),onclick:function e(t,s){babelHelpers.classPrivateFieldGet(a,O).close()}});babelHelpers.classPrivateFieldGet(this,O).getMenu().show()}}};var Se=function e(t){if(t.data.location){A(this,re,Ce).call(this,t.data.location)}};var Ee=function e(t){babelHelpers.classPrivateFieldSet(this,V,t);this.emit(W(ve,ve,Fe),{state:babelHelpers.classPrivateFieldGet(this,V)})};var Ce=function e(t){var s=this;var a;A(this,le,Ee).call(this,b.DATA_SELECTED);if(t){a=A(this,de,Ae).call(this,t).then(function(e){A(s,oe,Me).call(s,e);return true},function(e){return l.ErrorPublisher.getInstance().notify(e.errors)})}else{a=new Promise(function(e){A(s,oe,Me).call(s,null);e()})}return a};var We=function e(){babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,z)?A(this,$,ge).call(this,babelHelpers.classPrivateFieldGet(this,z)):"");this.emit(W(ve,ve,He),{address:babelHelpers.classPrivateFieldGet(this,z)})};var Ae=function e(t){var s=this;A(this,le,Ee).call(this,b.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,B).findByExternalId(t.externalId,t.sourceCode,t.languageId).then(function(e){A(s,le,Ee).call(s,b.DATA_LOADED);return e},function(e){l.ErrorPublisher.getInstance().notify(e.errors)})};var ze=function e(t){var s=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,_)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,L).fieldForUnRecognized,t);return s};var Me=function e(t){babelHelpers.classPrivateFieldSet(this,z,t?t.toAddress():null);if(babelHelpers.classPrivateFieldGet(this,z)&&babelHelpers.classPrivateFieldGet(this,Y).dropped.length>0){babelHelpers.classPrivateFieldGet(this,z).setFieldValue(babelHelpers.classPrivateFieldGet(this,L).fieldForUnRecognized,babelHelpers.classPrivateFieldGet(this,Y).dropped)}A(this,ne,We).call(this)};var _e=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,j)){return}var a=Date.now();if(babelHelpers.classPrivateFieldGet(this,q)){var i=a-babelHelpers.classPrivateFieldGet(this,q);babelHelpers.classPrivateFieldSet(this,J,(babelHelpers.classPrivateFieldGet(this,J)+i)/2)}babelHelpers.classPrivateFieldSet(this,q,a);if(babelHelpers.classPrivateFieldGet(this,V)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(this,M).trim()!==A(this,ee,Te).call(this).trim()){A(this,le,Ee).call(this,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,O).isShown()){switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,O).isItemChosen()){A(this,re,Ce).call(this,babelHelpers.classPrivateFieldGet(this,O).getChosenItem()).then(function(){babelHelpers.classPrivateFieldGet(s,O).close()},function(e){return BX.debug(e)})}return;case"Tab":case"Escape":A(this,le,Ee).call(this,b.DATA_SELECTED);A(this,te,Ie).call(this);babelHelpers.classPrivateFieldGet(this,O).close();return;case"ArrowUp":babelHelpers.classPrivateFieldGet(this,O).choosePrevItem();return;case"ArrowDown":babelHelpers.classPrivateFieldGet(this,O).chooseNextItem();return}}if(babelHelpers.classPrivateFieldGet(this,M).trim()!==A(this,ee,Te).call(this).trim()){this.showPrompt(babelHelpers.classPrivateFieldGet(this,U).value,{})}};var Le=function e(){var t=babelHelpers.classPrivateFieldGet(this,X)>babelHelpers.classPrivateFieldGet(this,J)?babelHelpers.classPrivateFieldGet(this,X):babelHelpers.classPrivateFieldGet(this,J)*1.5;return t>babelHelpers.classPrivateFieldGet(this,R)?babelHelpers.classPrivateFieldGet(this,R):t};var Be=function e(t,s,a){if(t.length>babelHelpers.classPrivateFieldGet(this,N)){if(babelHelpers.classPrivateFieldGet(this,x)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,x))}babelHelpers.classPrivateFieldSet(this,x,A(this,he,Oe).call(this,t,s,a))}};var Oe=function e(t,s,a){var i=this;return setTimeout(function(){if(babelHelpers.classPrivateFieldGet(i,K)){clearTimeout(babelHelpers.classPrivateFieldGet(i,x));babelHelpers.classPrivateFieldSet(i,x,A(i,he,e).call(i,t,s,a));return}i.emit(W(ve,ve,Pe));babelHelpers.classPrivateFieldSet(i,K,true);babelHelpers.classPrivateFieldGet(i,D).autocomplete(t,s).then(function(e){babelHelpers.classPrivateFieldSet(i,x,null);A(i,ae,ke).call(i,e,s);i.emit(W(ve,ve,me));babelHelpers.classPrivateFieldSet(i,K,false)},function(e){i.emit(W(ve,ve,me));babelHelpers.classPrivateFieldSet(i,K,false);BX.debug(e)})},a)};var De=new WeakMap;var Ne=new WeakMap;var Xe=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));De.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ne.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof ve)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),De,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),De).onAddressChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ne).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),De).onStateChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ne).setStateByFeature(t.state)});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),De).onSearchStartedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ne).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchStartedEvent,payload:a})});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),De).onSearchCompletedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ne).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchCompletedEvent,payload:a})});return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,De).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Ne).mode===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,De).render({inputNode:babelHelpers.classPrivateFieldGet(this,Ne).inputNode,address:babelHelpers.classPrivateFieldGet(this,Ne).address,mode:babelHelpers.classPrivateFieldGet(this,Ne).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,De).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ne,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,De).destroy();babelHelpers.classPrivateFieldSet(this,De,null)}},{key:"autocomplete",get:function e(){return babelHelpers.classPrivateFieldGet(this,De)}}]);return t}(o);babelHelpers.defineProperty(Xe,"searchStartedEvent","searchStarted");babelHelpers.defineProperty(Xe,"searchCompletedEvent","searchCompleted");function Re(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=xe(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function xe(e,t){if(!e)return;if(typeof e==="string")return Ue(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ue(e,t)}function Ue(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Ye(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ve=new WeakMap;var je=new WeakMap;var qe=new WeakMap;var Je=new WeakMap;var Ke=new WeakMap;var $e=new WeakMap;var Qe=new WeakMap;var Ze=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var st=new WeakMap;var at=new WeakMap;var it=new WeakMap;var lt=new WeakMap;var rt=new WeakSet;var nt=new WeakSet;var dt=new WeakSet;var bt=new WeakSet;var ot=new WeakSet;var ct=new WeakSet;var ut=new WeakSet;var pt=new WeakSet;var ht=new WeakSet;var vt=new WeakSet;var ft=new WeakSet;var Ht=new WeakSet;var Ft=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ht.add(babelHelpers.assertThisInitialized(s));ft.add(babelHelpers.assertThisInitialized(s));vt.add(babelHelpers.assertThisInitialized(s));ht.add(babelHelpers.assertThisInitialized(s));pt.add(babelHelpers.assertThisInitialized(s));ut.add(babelHelpers.assertThisInitialized(s));ct.add(babelHelpers.assertThisInitialized(s));ot.add(babelHelpers.assertThisInitialized(s));bt.add(babelHelpers.assertThisInitialized(s));dt.add(babelHelpers.assertThisInitialized(s));nt.add(babelHelpers.assertThisInitialized(s));rt.add(babelHelpers.assertThisInitialized(s));Ve.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ke.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$e.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});Qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ze.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});et.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});tt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});st.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});at.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});it.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});lt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Je,e.addressFormat);if(e.address&&!(e.address instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),qe,e.address||null);if(!l.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ve,e.mode);if(!d.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ke,e.languageId);if(e.features){if(!d.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach(function(e){Ye(babelHelpers.assertThisInitialized(s),rt,Pt).call(babelHelpers.assertThisInitialized(s),e)})}if(d.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),at,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof l.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),it,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),at)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),it,new l.LocationRepository)}if(e.presetLocationList){if(!d.Type.isArray(e.presetLocationList)){throw new TypeError("Preset location list must be an array")}var a=Re(e.presetLocationList),i;try{for(a.s();!(i=a.n()).done;){var r=i.value;if(!(r instanceof l.Location)){BX.debug("location must be instance of Location")}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),lt).push(r)}}catch(e){a.e(e)}finally{a.f()}}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),je,b.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=babelHelpers.classPrivateFieldGet(this,qe)?babelHelpers.classPrivateFieldGet(this,qe).id:0;babelHelpers.classPrivateFieldSet(this,qe,t);if(a>0){babelHelpers.classPrivateFieldGet(this,qe).id=a}babelHelpers.classPrivateFieldSet(this,tt,true);Ye(this,ht,kt).call(this,t);Ye(this,nt,mt).call(this,"setAddress",[t],s);if(babelHelpers.classPrivateFieldGet(this,je)!==b.DATA_INPUTTING){Ye(this,dt,gt).call(this)}}},{key:"emitFeatureEvent",value:function e(s){this.emit(t.onFeatureEvent,s)}},{key:"onInputKeyup",value:function e(t){var s=babelHelpers.classPrivateFieldGet(this,Qe).value;switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break;default:babelHelpers.classPrivateFieldSet(this,st,true)}if(s.length===0&&babelHelpers.classPrivateFieldGet(this,lt).length>0){Ye(this,ut,It).call(this)}}},{key:"resetView",value:function e(){Ye(this,nt,mt).call(this,"resetView")}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Ze,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,Ve)===l.ControlMode.edit){if(!d.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Qe,t.inputNode);Ye(this,ht,kt).call(this,babelHelpers.classPrivateFieldGet(this,qe));d.Event.bind(babelHelpers.classPrivateFieldGet(this,Qe),"focus",Ye(this,ot,yt).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,Qe),"focusout",Ye(this,vt,St).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,Qe),"keyup",this.onInputKeyup.bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,Qe),"click",Ye(this,ct,Tt).bind(this))}Ye(this,nt,mt).call(this,"render",[t])}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,je,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnFeatureEvent",value:function e(s){this.subscribe(t.onFeatureEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){l.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,et)){return}d.Event.unbindAll(this);d.Event.unbind(babelHelpers.classPrivateFieldGet(this,Qe),"focus",Ye(this,ot,yt));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,Qe),"focusout",Ye(this,vt,St));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,Qe),"keyup",this.onInputKeyup);d.Event.unbind(babelHelpers.classPrivateFieldGet(this,Qe),"click",this.onInputClick);Ye(this,nt,mt).call(this,"destroy");Ye(this,Ht,Ct).call(this);babelHelpers.classPrivateFieldSet(this,et,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,et)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,$e)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ze)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,Qe)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,qe)},set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,qe,t);Ye(this,nt,mt).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,st,false);babelHelpers.classPrivateFieldSet(this,tt,false);Ye(this,ht,kt).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ve)},set:function e(t){if(!l.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Ve,t);Ye(this,nt,mt).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,je)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,Je)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(Ft,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(Ft,"onStateChangedEvent","onStateChanged");babelHelpers.defineProperty(Ft,"onFeatureEvent","onFeatureEvent");var Pt=function e(t){if(!(t instanceof o)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,$e).push(t)};var mt=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i;var l=Re(babelHelpers.classPrivateFieldGet(this,$e)),r;try{for(l.s();!(r=l.n()).done;){var n=r.value;if(n!==a){i=n[t].apply(n,s)}}}catch(e){l.e(e)}finally{l.f()}return i};var gt=function e(){this.emit(Ft.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,qe)});if(babelHelpers.classPrivateFieldGet(this,qe)&&babelHelpers.classPrivateFieldGet(this,at)){Ye(this,bt,wt).call(this,babelHelpers.classPrivateFieldGet(this,qe))}};var wt=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,it).findParents(t.location)}};var yt=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Qe).value;if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,Qe),s.length-1)}};var Tt=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Qe).value;if(s.length===0&&babelHelpers.classPrivateFieldGet(this,lt).length>0){Ye(this,ut,It).call(this)}};var It=function e(){var t=Ye(this,ft,Et).call(this);if(!t.autocomplete||!t.autocomplete.prompt){return}t.autocomplete.prompt.show(babelHelpers.classPrivateFieldGet(this,lt),"")};var Gt=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,Je),l.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,l.AddressStringConverter.CONTENT_TYPE_TEXT)};var kt=function e(t){if(babelHelpers.classPrivateFieldGet(this,Qe)){var s=babelHelpers.classPrivateFieldGet(this,Qe).selectionStart;var a=babelHelpers.classPrivateFieldGet(this,Qe).selectionEnd;var i=Ye(this,pt,Gt).call(this,t);babelHelpers.classPrivateFieldGet(this,Qe).value=i;babelHelpers.classPrivateFieldGet(this,Qe).title=i;babelHelpers.classPrivateFieldGet(this,Qe).setSelectionRange(s,a)}};var St=function e(t){if(babelHelpers.classPrivateFieldGet(this,st)&&!babelHelpers.classPrivateFieldGet(this,tt)){var s=babelHelpers.classPrivateFieldGet(this,Qe).value.trim();var a=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,Ke)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,Je).fieldForUnRecognized,s);this.address=a;Ye(this,dt,gt).call(this)}babelHelpers.classPrivateFieldSet(this,st,false);babelHelpers.classPrivateFieldSet(this,tt,false)};var Et=function e(){var t=null;var s=Re(babelHelpers.classPrivateFieldGet(this,$e)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i instanceof Xe){t=i;break}}}catch(e){s.e(e)}finally{s.f()}return t};var Ct=function e(){babelHelpers.classPrivateFieldGet(this,$e).splice(0,babelHelpers.classPrivateFieldGet(this,$e).length)};function Wt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);Wt=function t(){return e};return e}function At(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);At=function t(){return e};return e}function zt(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Mt=new WeakMap;var _t=new WeakMap;var Lt=new WeakMap;var Bt=new WeakMap;var Ot=new WeakSet;var Dt=function(){function e(t){babelHelpers.classCallCheck(this,e);Ot.add(this);Mt.set(this,{writable:true,value:void 0});_t.set(this,{writable:true,value:void 0});Lt.set(this,{writable:true,value:void 0});Bt.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof l.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,Bt,t.addressFormat);babelHelpers.classPrivateFieldSet(this,Mt,t.address)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Mt,t.address);babelHelpers.classPrivateFieldSet(this,Lt,d.Tag.render(At(),zt(this,Ot,Nt).call(this,babelHelpers.classPrivateFieldGet(this,Mt))));babelHelpers.classPrivateFieldSet(this,_t,d.Tag.render(Wt(),babelHelpers.classPrivateFieldGet(this,Lt)));return babelHelpers.classPrivateFieldGet(this,_t)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_t)){babelHelpers.classPrivateFieldGet(this,_t).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_t)){babelHelpers.classPrivateFieldGet(this,_t).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,_t)||babelHelpers.classPrivateFieldGet(this,_t).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,Mt,t);if(!babelHelpers.classPrivateFieldGet(this,Lt)){return}babelHelpers.classPrivateFieldGet(this,Lt).innerHTML=zt(this,Ot,Nt).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var Nt=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,Bt),l.AddressStringConverter.STRATEGY_TYPE_FIELD_SORT)};var Xt=new WeakMap;var Rt=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Xt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:20});return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){if(this.bindOptions.position&&this.bindOptions.position==="right"){var a=this.bindElement.getBoundingClientRect();var i=a.width;var l=a.height/2+babelHelpers.classPrivateFieldGet(this,Xt);var r=a.height/2;var n=this.getPopupContainer().offsetWidth;var d=this.getPopupContainer().offsetHeight;var b=a.top+d;var o=document.documentElement.clientWidth;var c=document.documentElement.clientHeight;var u=b-c;if(u>0){var p=Math.ceil(u/a.height)*a.height;if(p>a.top){p-=Math.ceil((p-a.top)/a.height)*a.height}if(a.bottom>b-p){p-=a.bottom-(b-p)+babelHelpers.classPrivateFieldGet(this,Xt)}l+=p;r+=p+babelHelpers.classPrivateFieldGet(this,Xt)}if(a.left+i+n<=o){this.setOffset({offsetLeft:i,offsetTop:-l});this.setAngle({position:"left",offset:r})}else{this.setAngle(true)}}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}]);return t}(a.Popup);function xt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>"]);xt=function t(){return e};return e}function Ut(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);Ut=function t(){return e};return e}function Yt(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Vt(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var jt=new WeakMap;var qt=new WeakMap;var Jt=new WeakMap;var Kt=new WeakMap;var $t=new WeakMap;var Qt=new WeakMap;var Zt=new WeakMap;var es=new WeakMap;var ts=new WeakMap;var ss=new WeakMap;var as=new WeakMap;var is=new WeakMap;var ls=new WeakSet;var rs=new WeakSet;var ns=new WeakSet;var ds=new WeakSet;var bs=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ds.add(babelHelpers.assertThisInitialized(s));ns.add(babelHelpers.assertThisInitialized(s));rs.add(babelHelpers.assertThisInitialized(s));ls.add(babelHelpers.assertThisInitialized(s));jt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Jt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Kt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$t.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Qt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Zt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});es.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ts.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});ss.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});as.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});is.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof l.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),jt,e.map);if(e.geocodingService instanceof l.GeocodingServiceBase){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),as,e.geocodingService)}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),jt).onLocationChangedEventSubscribe(function(e){var a=e.getData(),i=a.location,l=i.toAddress();babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Jt,l);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),$t).address=l;if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zt)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zt).location=i}s.emit(Vt(t,t,os),{address:l})});if(!(e.popup instanceof Rt)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Kt,e.popup);if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Qt,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),$t,new Dt({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qt)}));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Zt,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),es,e.locationRepository);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Jt,t.address);babelHelpers.classPrivateFieldSet(this,qt,t.mode);babelHelpers.classPrivateFieldSet(this,ts,false);babelHelpers.classPrivateFieldSet(this,ss,d.Tag.render(Ut()));Yt(this,ls,vs).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,ss))}},{key:"show",value:function e(){var s=this;Yt(this,rs,fs).call(this,babelHelpers.classPrivateFieldGet(this,Jt)).then(function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,Kt).show();if(!babelHelpers.classPrivateFieldGet(s,ts)){Yt(s,ds,Fs).call(s,{location:e}).then(function(){if(babelHelpers.classPrivateFieldGet(s,Zt)){babelHelpers.classPrivateFieldGet(s,Zt).location=e}s.emit(Vt(t,t,ps))});babelHelpers.classPrivateFieldSet(s,ts,true)}else{if(babelHelpers.classPrivateFieldGet(s,Zt)){babelHelpers.classPrivateFieldGet(s,Zt).location=e}s.emit(Vt(t,t,ps))}})}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,Kt).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,Kt).close();this.emit(Vt(t,t,hs))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(Vt(t,t,os),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(Vt(t,t,cs),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(Vt(t,t,us),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(Vt(t,t,ps),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(Vt(t,t,hs),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,jt,null);babelHelpers.classPrivateFieldSet(this,Zt,null);babelHelpers.classPrivateFieldSet(this,$t,null);babelHelpers.classPrivateFieldGet(this,Kt).destroy();babelHelpers.classPrivateFieldSet(this,Kt,null);d.Dom.remove(babelHelpers.classPrivateFieldGet(this,is));babelHelpers.classPrivateFieldSet(this,is,null);d.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Kt).getBindElement()},set:function e(t){if(d.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,Kt).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,Jt,t);babelHelpers.classPrivateFieldGet(this,$t).address=t;Yt(this,rs,fs).call(this,t).then(function(e){Yt(s,ns,Hs).call(s,e)})}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,qt,t);babelHelpers.classPrivateFieldGet(this,jt).mode=t}}]);return t}(n.EventEmitter);var os={writable:true,value:"onChanged"};var cs={writable:true,value:"onMouseOver"};var us={writable:true,value:"onMouseOut"};var ps={writable:true,value:"onShow"};var hs={writable:true,value:"onClose"};var vs=function e(t,s){var a=this;var i="";if(babelHelpers.classPrivateFieldGet(this,Zt)){i=babelHelpers.classPrivateFieldGet(this,Zt).render()}babelHelpers.classPrivateFieldSet(this,is,d.Tag.render(xt(),s,i,babelHelpers.classPrivateFieldGet(this,qt)===l.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,$t).render({address:babelHelpers.classPrivateFieldGet(this,Jt)}):""));d.Event.bind(babelHelpers.classPrivateFieldGet(this,is),"click",function(e){return e.stopPropagation()});d.Event.bind(babelHelpers.classPrivateFieldGet(this,is),"mouseover",function(e){return a.emit(Vt(bs,bs,cs),e)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,is),"mouseout",function(e){return a.emit(Vt(bs,bs,us),e)});this.bindElement=t;babelHelpers.classPrivateFieldGet(this,Kt).setContent(babelHelpers.classPrivateFieldGet(this,is))};var fs=function e(t){var s=this;return new Promise(function(e){var a=t?t.toLocation():null;if(a){if(!a.latitude&&!a.longitude&&t.latitude&&t.longitude){a.latitude=t.latitude;a.longitude=t.longitude}if(a.latitude&&a.longitude){e(a);return}}if(babelHelpers.classPrivateFieldGet(s,as)){var i=null;if(t){i=t.toString(babelHelpers.classPrivateFieldGet(s,Qt),l.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,l.AddressStringConverter.CONTENT_TYPE_TEXT)}babelHelpers.classPrivateFieldGet(s,as).geocode(i).then(function(t){var s=t.length===1?t[0]:null;e(s)})}})};var Hs=function e(t){babelHelpers.classPrivateFieldGet(this,jt).location=t;if(babelHelpers.classPrivateFieldGet(this,Zt)){babelHelpers.classPrivateFieldGet(this,Zt).location=t}};var Fs=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,jt).render({mapContainer:babelHelpers.classPrivateFieldGet(this,ss),location:s,mode:babelHelpers.classPrivateFieldGet(this,qt)})};function Ps(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);Ps=function t(){return e};return e}function ms(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);ms=function t(){return e};return e}var gs=new WeakMap;var ws=new WeakMap;var ys=new WeakMap;var Ts=new WeakMap;var Is=new WeakMap;var Gs=function(){function e(t){babelHelpers.classCallCheck(this,e);gs.set(this,{writable:true,value:void 0});ws.set(this,{writable:true,value:void 0});ys.set(this,{writable:true,value:void 0});Ts.set(this,{writable:true,value:void 0});Is.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ws,t.url);babelHelpers.classPrivateFieldSet(this,ys,t.link||"");babelHelpers.classPrivateFieldSet(this,gs,t.description||"");babelHelpers.classPrivateFieldSet(this,Ts,t.location);babelHelpers.classPrivateFieldSet(this,Is,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,gs)){t=d.Tag.render(ms(),babelHelpers.classPrivateFieldGet(this,gs))}return d.Tag.render(Ps(),t,babelHelpers.classPrivateFieldGet(this,ys),babelHelpers.classPrivateFieldGet(this,Is),babelHelpers.classPrivateFieldGet(this,Ts).externalId,babelHelpers.classPrivateFieldGet(this,ws))}}]);return e}();function ks(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=Ss(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function Ss(e,t){if(!e)return;if(typeof e==="string")return Es(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Es(e,t)}function Es(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Cs(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);Cs=function t(){return e};return e}function Ws(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);Ws=function t(){return e};return e}function As(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var zs=new WeakMap;var Ms=new WeakMap;var _s=new WeakMap;var Ls=new WeakMap;var Bs=new WeakMap;var Os=new WeakMap;var Ds=new WeakMap;var Ns=new WeakMap;var Xs=new WeakSet;var Rs=new WeakSet;var xs=function(){function e(t){babelHelpers.classCallCheck(this,e);Rs.add(this);Xs.add(this);zs.set(this,{writable:true,value:[]});Ms.set(this,{writable:true,value:null});_s.set(this,{writable:true,value:null});Ls.set(this,{writable:true,value:void 0});Bs.set(this,{writable:true,value:void 0});Os.set(this,{writable:true,value:void 0});Ds.set(this,{writable:true,value:void 0});Ns.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ls,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,Bs,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,Ds,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,Os,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Ns)){babelHelpers.classPrivateFieldGet(this,Os).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,Ns),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,Ls),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,Bs),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,Ds)}).then(function(e){if(Array.isArray(e)&&e.length>0){As(t,Xs,Us).call(t,e);t.show()}else{t.hide()}})}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ms)){babelHelpers.classPrivateFieldGet(this,Ms).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,Ms)||babelHelpers.classPrivateFieldGet(this,Ms).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ms)){babelHelpers.classPrivateFieldGet(this,Ms).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,_s,d.Tag.render(Ws()));babelHelpers.classPrivateFieldSet(this,Ms,d.Tag.render(Cs(),babelHelpers.classPrivateFieldGet(this,_s)));return babelHelpers.classPrivateFieldGet(this,Ms)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ns,t);this.refresh()}}]);return e}();var Us=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ns)){return}var s=[];var a=ks(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new Gs({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,Ns),title:babelHelpers.classPrivateFieldGet(this,Ns).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,zs,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,zs).push(d)}if(babelHelpers.classPrivateFieldGet(this,zs).length>0&&babelHelpers.classPrivateFieldGet(this,_s)){var b=babelHelpers.classPrivateFieldGet(this,zs)?As(this,Rs,Ys).call(this,babelHelpers.classPrivateFieldGet(this,zs)):"";babelHelpers.classPrivateFieldGet(this,_s).innerHTML="";if(b.length>0){var o=ks(b),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,_s).appendChild(u)}}catch(e){o.e(e)}finally{o.f()}}}};var Ys=function e(t){var s=[];var a=ks(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function Vs(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);Vs=function t(){return e};return e}function js(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);js=function t(){return e};return e}function qs(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);qs=function t(){return e};return e}function Js(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);Js=function t(){return e};return e}function Ks(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function $s(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var Qs=new WeakMap;var Zs=new WeakMap;var ea=new WeakMap;var ta=new WeakMap;var sa=new WeakMap;var aa=new WeakMap;var ia=new WeakMap;var la=new WeakMap;var ra=new WeakMap;var na=new WeakSet;var da=new WeakSet;var ba=new WeakSet;var oa=new WeakSet;var ca=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));oa.add(babelHelpers.assertThisInitialized(s));ba.add(babelHelpers.assertThisInitialized(s));da.add(babelHelpers.assertThisInitialized(s));na.add(babelHelpers.assertThisInitialized(s));Qs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Zs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ea.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ta.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});sa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});aa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ia.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});la.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});ra.set(babelHelpers.assertThisInitialized(s),{writable:true,value:b.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Qs,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ea,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ta,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Zs,typeof t.value==="string"?t.value:"");if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,sa,t.mode);babelHelpers.classPrivateFieldSet(this,la,d.Tag.render(Js(),babelHelpers.classPrivateFieldGet(this,Qs)));if(babelHelpers.classPrivateFieldGet(this,sa)===l.ControlMode.edit){Ks(this,da,va).call(this,babelHelpers.classPrivateFieldGet(this,la))}else{Ks(this,ba,fa).call(this,babelHelpers.classPrivateFieldGet(this,la))}return babelHelpers.classPrivateFieldGet(this,la)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe($s(t,t,ua),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe($s(t,t,pa),s)}},{key:"destroy",value:function e(){d.Dom.remove(babelHelpers.classPrivateFieldGet(this,la));d.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,la,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,la)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,ra)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,ea,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,ea)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,ta,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,ta)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,Zs,typeof t==="string"?t:"");Ks(this,oa,Ha).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Zs)}}]);return t}(n.EventEmitter);var ua={writable:true,value:"onValueChanged"};var pa={writable:true,value:"onStateChanged"};var ha=function e(t){babelHelpers.classPrivateFieldSet(this,ra,t);this.emit($s(ca,ca,pa),{state:babelHelpers.classPrivateFieldGet(this,ra)})};var va=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,aa,d.Tag.render(qs(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,Zs))));babelHelpers.classPrivateFieldSet(this,ia,null);d.Event.bind(babelHelpers.classPrivateFieldGet(this,aa),"focus",function(e){Ks(s,na,ha).call(s,b.DATA_INPUTTING)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,aa),"focusout",function(e){Ks(s,na,ha).call(s,b.DATA_SELECTED)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,aa),"change",function(e){Ks(s,na,ha).call(s,b.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,Zs,babelHelpers.classPrivateFieldGet(s,aa).value);s.emit($s(ca,ca,ua),{value:s})});t.appendChild(d.Tag.render(js(),babelHelpers.classPrivateFieldGet(this,aa)))};var fa=function e(t){babelHelpers.classPrivateFieldSet(this,aa,null);babelHelpers.classPrivateFieldSet(this,ia,d.Tag.render(Vs(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,Zs))));t.appendChild(babelHelpers.classPrivateFieldGet(this,ia))};var Ha=function e(){if(babelHelpers.classPrivateFieldGet(this,sa)===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,aa).value=babelHelpers.classPrivateFieldGet(this,Zs)}else{babelHelpers.classPrivateFieldGet(this,ia).innerHTML=d.Text.encode(babelHelpers.classPrivateFieldGet(this,Zs))}};function Fa(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=Pa(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function Pa(e,t){if(!e)return;if(typeof e==="string")return ma(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ma(e,t)}function ma(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function ga(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function wa(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ya=new WeakMap;var Ta=new WeakMap;var Ia=new WeakMap;var Ga=new WeakMap;var ka=new WeakMap;var Sa=new WeakMap;var Ea=new WeakMap;var Ca=new WeakSet;var Wa=new WeakSet;var Aa=new WeakSet;var za=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Aa.add(babelHelpers.assertThisInitialized(s));Wa.add(babelHelpers.assertThisInitialized(s));Ca.add(babelHelpers.assertThisInitialized(s));ya.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ta.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ia.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ga.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});ka.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Sa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ea.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ta,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ka,e.languageId);wa(babelHelpers.assertThisInitialized(s),Ca,La).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof l.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ya,t.address);if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Ia,t.mode);if(!d.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,Sa,t.container);var s=Fa(babelHelpers.classPrivateFieldGet(this,Ga)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;var r=babelHelpers.classPrivateFieldGet(this,ya)?babelHelpers.classPrivateFieldGet(this,ya).getFieldValue(i.type):"";if(babelHelpers.classPrivateFieldGet(this,Ia)===l.ControlMode.view&&!r){continue}var n=i.render({value:r,mode:babelHelpers.classPrivateFieldGet(this,Ia)});babelHelpers.classPrivateFieldGet(this,Sa).appendChild(n)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(ga(t,t,Ma),s)}},{key:"destroy",value:function e(){d.Event.unbindAll(this);var t=Fa(babelHelpers.classPrivateFieldGet(this,Ga)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}d.Dom.clean(babelHelpers.classPrivateFieldGet(this,Sa))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(ga(t,t,_a),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ya,t);var s=Fa(babelHelpers.classPrivateFieldGet(this,Ga)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;i.value=babelHelpers.classPrivateFieldGet(this,ya)?babelHelpers.classPrivateFieldGet(this,ya).getFieldValue(i.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ea)}}]);return t}(n.EventEmitter);var Ma={writable:true,value:"onAddressChanged"};var _a={writable:true,value:"onStateChanged"};var La=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,Ta).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,Ta).fieldCollection.fields[s];var i=new ca({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent(function(e){wa(t,Wa,Ba).call(t,i)});i.subscribeOnStateChangedEvent(function(e){var s=e.getData();wa(t,Aa,Oa).call(t,s.state)});babelHelpers.classPrivateFieldGet(t,Ga).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,Ta).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,Ga).sort(function(e,t){return e.sort-t.sort})};var Ba=function e(t){if(!babelHelpers.classPrivateFieldGet(this,ya)){babelHelpers.classPrivateFieldSet(this,ya,new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,ka)}))}babelHelpers.classPrivateFieldGet(this,ya).setFieldValue(t.type,t.value);if(t.type!==babelHelpers.classPrivateFieldGet(this,Ta).fieldForUnRecognized){babelHelpers.classPrivateFieldGet(this,ya).location=null;babelHelpers.classPrivateFieldGet(this,ya).latitude="";babelHelpers.classPrivateFieldGet(this,ya).longitude=""}this.emit(ga(za,za,Ma),{address:babelHelpers.classPrivateFieldGet(this,ya),changedField:t})};var Oa=function e(t){babelHelpers.classPrivateFieldSet(this,Ea,t);this.emit(ga(za,za,_a),{state:babelHelpers.classPrivateFieldGet(this,Ea)})};var Da=new WeakMap;var Na=new WeakMap;var Xa=new WeakMap;var Ra=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Da.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Na.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Xa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof bs)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Da,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Da).onChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Xa).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Da).isShown()){babelHelpers.classPrivateFieldGet(this,Da).show()}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Da).isShown()){babelHelpers.classPrivateFieldGet(this,Da).close()}babelHelpers.classPrivateFieldGet(this,Da).bindelement=babelHelpers.classPrivateFieldGet(this,Na)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Na,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,Da).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,Xa).address,mode:babelHelpers.classPrivateFieldGet(this,Xa).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,Da).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Xa,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Da).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Da).destroy();babelHelpers.classPrivateFieldSet(this,Da,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,Da)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,Xa)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Na)}}]);return t}(o);var xa=new WeakMap;var Ua=new WeakMap;var Ya=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));xa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ua.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof za)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),xa,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),xa).subscribeOnAddressChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ua).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),xa).subscribeOnStateChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ua).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Ua).mode===l.ControlMode.edit){if(!d.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,xa).render({address:babelHelpers.classPrivateFieldGet(this,Ua).address,mode:babelHelpers.classPrivateFieldGet(this,Ua).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ua,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,xa).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,xa).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,xa).destroy();babelHelpers.classPrivateFieldSet(this,xa,null)}}]);return t}(o);function Va(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ja=new WeakMap;var qa=new WeakMap;var Ja=new WeakMap;var Ka=new WeakMap;var $a=new WeakMap;var Qa=new WeakMap;var Za=new WeakSet;var ei=new WeakSet;var ti=new WeakSet;var si=new WeakSet;var ai=new WeakSet;var ii=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));ai.add(babelHelpers.assertThisInitialized(s));si.add(babelHelpers.assertThisInitialized(s));ti.add(babelHelpers.assertThisInitialized(s));ei.add(babelHelpers.assertThisInitialized(s));Za.add(babelHelpers.assertThisInitialized(s));ja.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});qa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ja.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});Ka.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});$a.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});Qa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",Va(this,ei,li).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",Va(this,si,ni).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",Va(this,ai,di).bind(this));document.addEventListener("click",Va(this,ti,ri).bind(this));this.map.onMouseOverSubscribe(Va(this,si,ni).bind(this));this.map.onMouseOutSubscribe(Va(this,ai,di).bind(this))}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){this.closeMap();return}if(!t){this.closeMap()}this.map.address=t;if(t){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Qa)){return}document.removeEventListener("click",Va(this,ti,ri));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",Va(this,ei,li));this.addressWidget.controlWrapper.removeEventListener("mouseover",Va(this,si,ni));this.addressWidget.controlWrapper.removeEventListener("mouseout",Va(this,ai,di))}babelHelpers.classPrivateFieldSet(this,qa,null);babelHelpers.classPrivateFieldSet(this,Ka,null);babelHelpers.classPrivateFieldSet(this,ja,false);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,Qa,true)}}]);return t}(Ra);var li=function e(){if(babelHelpers.classPrivateFieldGet(this,Qa)){return}if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,qa))}};var ri=function e(){if(babelHelpers.classPrivateFieldGet(this,Qa)){return}this.closeMap()};var ni=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Qa)){return}babelHelpers.classPrivateFieldSet(this,ja,true);clearTimeout(babelHelpers.classPrivateFieldGet(this,qa));clearTimeout(babelHelpers.classPrivateFieldGet(this,Ka));if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,qa,setTimeout(function(){t.showMap()},babelHelpers.classPrivateFieldGet(this,Ja)))}};var di=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Qa)){return}babelHelpers.classPrivateFieldSet(this,ja,false);clearTimeout(babelHelpers.classPrivateFieldGet(this,qa));clearTimeout(babelHelpers.classPrivateFieldGet(this,Ka));if(this.addressWidget.mode===l.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Ka,setTimeout(function(){t.closeMap()},babelHelpers.classPrivateFieldGet(this,$a)))}};var bi=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var i=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var r=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var n=t.addressFormat||new l.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var d=t.presetLocationList||[];var b=[];if(!t.useFeatures||t.useFeatures.fields!==false){b.push(this.createFieldsFeature({addressFormat:n,languageId:i}))}var o=null;if(s&&a){try{o=this.createSource(s,a,i,r)}catch(e){if(e instanceof l.SourceCreationError){o=null}else{throw e}}}if(o){if(!t.useFeatures||t.useFeatures.autocomplete!==false){b.push(this.createAutocompleteFeature({languageId:i,addressFormat:n,source:o}))}if(!t.useFeatures||t.useFeatures.map!==false){var c=a.hasOwnProperty("showPhotos")&&a.showPhotos===true;var u=a.hasOwnProperty("useGeocodingService")&&a.useGeocodingService===true;var p=80;var h=150;var v=c?5:0;var f="auto";b.push(this.createMapFeature({addressFormat:n,source:o,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||p,thumbnailWidth:t.thumbnailWidth||h,maxPhotoCount:t.maxPhotoCount||v,mapBehavior:t.mapBehavior||f,useGeocodingService:u}))}}return new Ft({features:b,address:t.address,mode:t.mode,addressFormat:n,languageId:i,presetLocationList:d})}},{key:"createFieldsFeature",value:function e(t){var s=new za({addressFormat:t.addressFormat,languageId:t.languageId});return new Ya({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new ve({languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService});return new Xe({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s=new Rt({cacheable:true,closeByEsc:true,className:"location-popup-window",animation:"fading",angle:true,bindOptions:t.popupBindOptions});var a=null;if(t.maxPhotoCount>0){a=new xs({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var i={map:new bs({addressFormat:t.addressFormat,map:t.source.map,popup:s,gallery:a,locationRepository:new l.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null})};var r;if(t.mapBehavior==="manual"){r=new Ra(i)}else{r=new ii(i)}return r}},{key:"createSource",value:function e(a,i,l,r){var n=null;i.languageId=l;i.sourceLanguageId=r;if(a==="GOOGLE"){n=new s.Google(i)}else if(a==="OSM"){n=t.OSMFactory.createOSMSource(i)}else{throw new RangeError("Wrong source code")}return n}}]);return e}();function oi(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);oi=function t(){return e};return e}function ci(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ui(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var pi=new WeakMap;var hi=new WeakMap;var vi=new WeakMap;var fi=new WeakSet;var Hi=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));fi.add(babelHelpers.assertThisInitialized(e));pi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});hi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});vi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),pi,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),vi,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,hi,d.Tag.render(oi(),ui(this,fi,Pi).call(this)));babelHelpers.classPrivateFieldGet(this,hi).addEventListener("click",function(e){a.state=babelHelpers.classPrivateFieldGet(a,pi)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit(ci(t,t,Fi),{state:babelHelpers.classPrivateFieldGet(a,pi)});e.stopPropagation();return false});babelHelpers.classPrivateFieldGet(this,hi).addEventListener("mouseover",function(e){e.stopPropagation()});return babelHelpers.classPrivateFieldGet(this,hi)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe(ci(t,t,Fi),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,pi,t);if(babelHelpers.classPrivateFieldGet(this,hi)){babelHelpers.classPrivateFieldGet(this,hi).innerHTML=ui(this,fi,Pi).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,pi)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(Hi,"STATE_OFF",0);babelHelpers.defineProperty(Hi,"STATE_ON",1);var Fi={writable:true,value:"onToggleEvent"};var Pi=function e(){return babelHelpers.classPrivateFieldGet(this,vi)[babelHelpers.classPrivateFieldGet(this,pi)]};function mi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);mi=function t(){return e};return e}function gi(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function wi(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var yi=new WeakMap;var Ti=new WeakMap;var Ii=new WeakSet;var Gi=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ii.add(babelHelpers.assertThisInitialized(e));yi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});Ti.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,yi,s.type);babelHelpers.classPrivateFieldSet(this,Ti,d.Tag.render(mi(),wi(this,Ii,Si).call(this,babelHelpers.classPrivateFieldGet(this,yi))));babelHelpers.classPrivateFieldGet(this,Ti).addEventListener("click",function(e){a.emit(gi(t,t,ki))});return babelHelpers.classPrivateFieldGet(this,Ti)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(gi(t,t,ki),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,yi,t);if(babelHelpers.classPrivateFieldGet(this,Ti)){babelHelpers.classPrivateFieldGet(this,Ti).className=wi(this,Ii,Si).call(this,babelHelpers.classPrivateFieldGet(this,yi))}}}]);return t}(n.EventEmitter);var ki={writable:true,value:"onClick"};babelHelpers.defineProperty(Gi,"TYPE_CLEAR","clear");babelHelpers.defineProperty(Gi,"TYPE_SEARCH","search");babelHelpers.defineProperty(Gi,"TYPE_LOADER","loader");var Si=function e(t){var s="";if(t===Gi.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===Gi.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===Gi.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function Ei(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Ei=function t(){return e};return e}function Ci(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);Ci=function t(){return e};return e}function Wi(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);Wi=function t(){return e};return e}function Ai(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);Ai=function t(){return e};return e}function zi(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);zi=function t(){return e};return e}function Mi(){var e=babelHelpers.taggedTemplateLiteral(["",""]);Mi=function t(){return e};return e}function _i(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);_i=function t(){return e};return e}function Li(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);Li=function t(){return e};return e}function Bi(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);Bi=function t(){return e};return e}function Oi(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function Di(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ni=new WeakSet;var Xi=new WeakSet;var Ri=new WeakSet;var xi=new WeakSet;var Ui=new WeakSet;var Yi=new WeakSet;var Vi=new WeakSet;var ji=new WeakSet;var qi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ji.add(babelHelpers.assertThisInitialized(s));Vi.add(babelHelpers.assertThisInitialized(s));Yi.add(babelHelpers.assertThisInitialized(s));Ui.add(babelHelpers.assertThisInitialized(s));xi.add(babelHelpers.assertThisInitialized(s));Ri.add(babelHelpers.assertThisInitialized(s));Xi.add(babelHelpers.assertThisInitialized(s));Ni.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var i=this.getValue();var r=null;if(d.Type.isStringFilled(i)){try{r=new l.Address(JSON.parse(i))}catch(e){BX.debug("Cant parse address value");return}}var n=new bi;this._addressWidget=n.createAddressWidget({address:r,mode:this._mode===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(Di(this,Ui,el).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(Di(this,Yi,tl).bind(this));this._fieldsSwitch=new Hi({state:Hi.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(Di(this,Xi,$i).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view;this._fieldsSwitch.state=Hi.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=Di(this,ji,al).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;d.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?Di(this,ji,al).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=d.Tag.render(Bi(),"".concat(this.getName(),"_STRING"));this._hiddenInput=d.Tag.render(Li(),this.getValue(),this.getName());this._inputIcon=new Gi;this._inputIcon.subscribeOnClickEvent(Di(this,Ni,Ki).bind(this));var l=this._inputIcon.render({type:Oi(t,t,Ji).call(t,Di(this,ji,al).call(this))});this._inputContainer=d.Tag.render(_i(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(d.Tag.render(Mi(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=d.Tag.render(zi(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=d.Tag.render(Ai());if(this._fieldsSwitch.state===Hi.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var n=Di(this,Vi,sl).call(this,Di(this,ji,al).call(this));r=d.Tag.render(Wi(),n);this._innerWrapper=d.Tag.render(Ci(),r);i.mapBindElement=r}else{this._innerWrapper=d.Tag.render(Ei(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=Gi.TYPE_CLEAR}if(!d.Type.isArray(i)){return}i.forEach(function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)})}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",function(e,s){s.methods.address=t.registerFieldMethod})}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var Ji=function e(t){return t?Gi.TYPE_CLEAR:Gi.TYPE_SEARCH};var Ki=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=Gi.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var $i=function e(t){var s=t.getData();var a=s.state;if(a===Hi.STATE_OFF){Di(this,Ri,Qi).call(this)}else{Di(this,xi,Zi).call(this)}this._addressWidget.resetView()};var Qi=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var Zi=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var el=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===r.State.DATA_LOADING){i=Gi.TYPE_LOADER}else{if(s.state===r.State.DATA_INPUTTING){this.markAsChanged()}i=Oi(qi,qi,Ji).call(qi,Di(this,ji,al).call(this))}this._inputIcon.type=i};var tl=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=Oi(qi,qi,Ji).call(qi,a)}};var sl=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var al=function e(){return this._addressWidget.address};qi.registerField();e.Address=Ft;e.BaseFeature=o;e.MapFeature=Ra;e.AutocompleteFeature=Xe;e.FieldsFeature=Ya;e.Factory=bi;e.State=b;e.UIAddress=qi})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX.Location.OSM,BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js