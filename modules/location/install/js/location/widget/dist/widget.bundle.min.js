this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n){"use strict";var d=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(d,"INITIAL","INITIAL");babelHelpers.defineProperty(d,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(d,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(d,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(d,"DATA_LOADED","DATA_LOADED");var b=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new i.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new i.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new i.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function o(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=c(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function c(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function p(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var h=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));L.add(babelHelpers.assertThisInitialized(s));_.add(babelHelpers.assertThisInitialized(s));M.add(babelHelpers.assertThisInitialized(s));z.add(babelHelpers.assertThisInitialized(s));A.add(babelHelpers.assertThisInitialized(s));W.add(babelHelpers.assertThisInitialized(s));C.add(babelHelpers.assertThisInitialized(s));E.add(babelHelpers.assertThisInitialized(s));S.add(babelHelpers.assertThisInitialized(s));v.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});f.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});H.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});F.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});P.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});m.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});g.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});w.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});y.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});T.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});I.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});k.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});G.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),F,e.addressFormat);if(e.address&&!(e.address instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),H,e.address||null);if(!i.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),v,e.mode);if(!n.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),P,e.languageId);if(e.features){if(!n.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach(function(e){p(babelHelpers.assertThisInitialized(s),S,B).call(babelHelpers.assertThisInitialized(s),e)})}if(n.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),k,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof i.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),k)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,new i.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),f,d.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=babelHelpers.classPrivateFieldGet(this,H)?babelHelpers.classPrivateFieldGet(this,H).id:0;babelHelpers.classPrivateFieldSet(this,H,t);if(a>0){babelHelpers.classPrivateFieldGet(this,H).id=a}p(this,E,O).call(this,"setAddress",[t],s);if(babelHelpers.classPrivateFieldGet(this,f)!==d.DATA_INPUTTING){p(this,C,N).call(this)}babelHelpers.classPrivateFieldSet(this,T,true);p(this,M,x).call(this,t)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break;default:babelHelpers.classPrivateFieldSet(this,I,true)}}},{key:"resetView",value:function e(){p(this,E,O).call(this,"resetView")}},{key:"render",value:function e(t){if(!n.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,w,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,v)===i.ControlMode.edit){if(!n.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,g,t.inputNode);p(this,M,x).call(this,babelHelpers.classPrivateFieldGet(this,H));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focus",p(this,A,X).bind(this));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focusout",p(this,_,U).bind(this));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup.bind(this))}p(this,E,O).call(this,"render",[t])}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,f,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){i.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,y)){return}n.Event.unbindAll(this);n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focus",p(this,A,X));n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focusout",p(this,_,U));n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup);p(this,E,O).call(this,"destroy");p(this,L,Y).call(this);babelHelpers.classPrivateFieldSet(this,y,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,y)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,w)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,H)},set:function e(t){if(t&&!(t instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,H,t);p(this,E,O).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,T,false);p(this,M,x).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,v)},set:function e(t){if(!i.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,v,t);p(this,E,O).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,F)}}]);return t}(r.EventEmitter);var v=new WeakMap;var f=new WeakMap;var H=new WeakMap;var F=new WeakMap;var P=new WeakMap;var m=new WeakMap;var g=new WeakMap;var w=new WeakMap;var y=new WeakMap;var T=new WeakMap;var I=new WeakMap;var k=new WeakMap;var G=new WeakMap;var S=new WeakSet;var E=new WeakSet;var C=new WeakSet;var W=new WeakSet;var A=new WeakSet;var z=new WeakSet;var M=new WeakSet;var _=new WeakSet;var L=new WeakSet;babelHelpers.defineProperty(h,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(h,"onStateChangedEvent","onStateChanged");var B=function e(t){if(!(t instanceof b)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,m).push(t)};var O=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i;var l=o(babelHelpers.classPrivateFieldGet(this,m)),r;try{for(l.s();!(r=l.n()).done;){var n=r.value;if(n!==a){i=n[t].apply(n,s)}}}catch(e){l.e(e)}finally{l.f()}return i};var N=function e(){this.emit(h.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,H)});if(babelHelpers.classPrivateFieldGet(this,k)){p(this,W,D).call(this,babelHelpers.classPrivateFieldGet(this,H))}};var D=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,G).findParents(t.location)}};var X=function e(t){var s=babelHelpers.classPrivateFieldGet(this,g);if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,g),s.length-1)}};var R=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,F),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)};var x=function e(t){if(babelHelpers.classPrivateFieldGet(this,g)){var s=p(this,z,R).call(this,t);babelHelpers.classPrivateFieldGet(this,g).value=s;babelHelpers.classPrivateFieldGet(this,g).title=s}};var U=function e(t){if(babelHelpers.classPrivateFieldGet(this,I)&&!babelHelpers.classPrivateFieldGet(this,T)){var s=babelHelpers.classPrivateFieldGet(this,g).value.trim();var a=new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,P)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,F).fieldForUnRecognized,s);this.address=a;p(this,C,N).call(this)}babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,T,false)};var Y=function e(){babelHelpers.classPrivateFieldGet(this,m).splice(0,babelHelpers.classPrivateFieldGet(this,m).length)};var V=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[this.choseItemIdx]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=t;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}}]);return t}(s.Menu);function j(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=q(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function q(e,t){if(!e)return;if(typeof e==="string")return J(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return J(e,t)}function J(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function K(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var $=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));re.add(babelHelpers.assertThisInitialized(s));le.add(babelHelpers.assertThisInitialized(s));ie.add(babelHelpers.assertThisInitialized(s));ae.add(babelHelpers.assertThisInitialized(s));se.add(babelHelpers.assertThisInitialized(s));te.add(babelHelpers.assertThisInitialized(s));Q.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Z.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Q,e.inputNode);return s}babelHelpers.createClass(t,[{key:"show",value:function e(t,s){if(t.length>0){K(this,ae,be).call(this,t,s);K(this,se,de).call(this).show()}}},{key:"close",value:function e(){K(this,se,de).call(this).close()}},{key:"choosePrevItem",value:function e(){var t=null;var s=K(this,se,de).call(this).choosePrevItem();if(s){t=K(this,re,ue).call(this,s.id)}return t}},{key:"chooseNextItem",value:function e(){var t=null;var s=K(this,se,de).call(this).chooseNextItem();if(s){t=K(this,re,ue).call(this,s.id)}return t}},{key:"isItemChosen",value:function e(){return babelHelpers.classPrivateFieldGet(this,Z).isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=babelHelpers.classPrivateFieldGet(this,Z).getChosenItem();if(s&&s.id){t=K(this,re,ue).call(this,s.id)}return t}},{key:"isShown",value:function e(){return K(this,se,de).call(this).isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Z)){babelHelpers.classPrivateFieldGet(this,Z).destroy();babelHelpers.classPrivateFieldSet(this,Z,null)}babelHelpers.classPrivateFieldSet(this,ee,null)}}],[{key:"createMenuItemText",value:function e(t,s){var a=t.slice();if(!s||s.length<=0){return a}var i=s.replace(/,+/gi,"").split(new RegExp(/\s+/g));var l=new RegExp("(".concat(i.join("|"),")"),"gi");a=t.replace(l,function(e){return"<strong>".concat(e,"</strong>")});return a}}]);return t}(r.EventEmitter);var Q=new WeakMap;var Z=new WeakMap;var ee=new WeakMap;var te=new WeakSet;var se=new WeakSet;var ae=new WeakSet;var ie=new WeakSet;var le=new WeakSet;var re=new WeakSet;babelHelpers.defineProperty($,"onItemSelectedEvent","onItemSelected");var ne=function e(){return new V({bindElement:babelHelpers.classPrivateFieldGet(this,Q),autoHide:false,closeByEsc:true})};var de=function e(){if(!babelHelpers.classPrivateFieldGet(this,Z)||babelHelpers.classPrivateFieldGet(this,Z).isDestroyed()){babelHelpers.classPrivateFieldSet(this,Z,K(this,te,ne).call(this))}return babelHelpers.classPrivateFieldGet(this,Z)};var be=function e(t,s){var a=this;K(this,se,de).call(this).clearItems();if(Array.isArray(t)){babelHelpers.classPrivateFieldSet(this,ee,t.slice());t.forEach(function(e){K(a,se,de).call(a).addMenuItem(K(a,ie,oe).call(a,e,s))})}};var oe=function e(t,s){var a=this;var i=t.externalId;return{id:i,text:$.createMenuItemText(t.name,s),onclick:function e(t,s){K(a,le,ce).call(a,i);a.close()}}};var ce=function e(t){var s=K(this,re,ue).call(this,t);if(s){this.emit($.onItemSelectedEvent,{location:s})}};var ue=function e(t){var s=null;var a=j(babelHelpers.classPrivateFieldGet(this,ee)),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;if(l.externalId===t){s=l;break}}}catch(e){a.e(e)}finally{a.f()}if(!s){BX.debug("Location with externalId "+t+" was not found")}return s};function pe(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function he(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ve(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var fe=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Je.add(babelHelpers.assertThisInitialized(s));qe.add(babelHelpers.assertThisInitialized(s));je.add(babelHelpers.assertThisInitialized(s));Ve.add(babelHelpers.assertThisInitialized(s));Ye.add(babelHelpers.assertThisInitialized(s));Ue.add(babelHelpers.assertThisInitialized(s));xe.add(babelHelpers.assertThisInitialized(s));Re.add(babelHelpers.assertThisInitialized(s));Xe.add(babelHelpers.assertThisInitialized(s));De.add(babelHelpers.assertThisInitialized(s));Ne.add(babelHelpers.assertThisInitialized(s));Oe.add(babelHelpers.assertThisInitialized(s));Be.add(babelHelpers.assertThisInitialized(s));Le.add(babelHelpers.assertThisInitialized(s));_e.add(babelHelpers.assertThisInitialized(s));Me.add(babelHelpers.assertThisInitialized(s));ze.add(babelHelpers.assertThisInitialized(s));He.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Fe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:""});Pe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});me.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});we.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ye.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Te.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ie.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ke.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Se.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});Ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ce.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});We.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ae.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof i.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),me,e.addressFormat);if(!(e.autocompleteService instanceof i.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ye,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Pe,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),He,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ge,e.locationRepository||new i.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ie,e.promptDelay||500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Te,e.minCharsCountToAutocomplete||3);ve(babelHelpers.assertThisInitialized(s),Xe,nt).call(babelHelpers.assertThisInitialized(s),d.INITIAL);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ae,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ie));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ge,t.inputNode);babelHelpers.classPrivateFieldSet(this,Fe,babelHelpers.classPrivateFieldGet(this,Ge).value);babelHelpers.classPrivateFieldSet(this,He,t.address);babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("keyup",ve(this,je,pt).bind(this));babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("focus",ve(this,_e,tt).bind(this));babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("focusout",ve(this,Me,et).bind(this));babelHelpers.classPrivateFieldSet(this,we,new $({inputNode:t.inputNode}));babelHelpers.classPrivateFieldGet(this,we).subscribe($.onItemSelectedEvent,ve(this,De,rt).bind(this));document.addEventListener("click",ve(this,Oe,it).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(he(t,t,$e),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(he(t,t,Qe),s)}},{key:"showPrompt",value:function e(t,s){babelHelpers.classPrivateFieldGet(this,Se).requested=t;babelHelpers.classPrivateFieldGet(this,Se).current=t;babelHelpers.classPrivateFieldGet(this,Se).dropped="";var a=babelHelpers.classPrivateFieldGet(this,Ie)>babelHelpers.classPrivateFieldGet(this,Ae)?babelHelpers.classPrivateFieldGet(this,Ie):babelHelpers.classPrivateFieldGet(this,Ae)*1.5;ve(this,qe,ht).call(this,t,s,a)}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}n.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).destroy();babelHelpers.classPrivateFieldSet(this,we,null)}babelHelpers.classPrivateFieldSet(this,ke,null);if(babelHelpers.classPrivateFieldGet(this,Ge)){babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("keyup",ve(this,je,pt));babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("focus",ve(this,_e,tt));babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("focusout",ve(this,Me,et))}document.removeEventListener("click",ve(this,Oe,it));babelHelpers.classPrivateFieldSet(this,Ce,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,He,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,He)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ee)}}]);return t}(r.EventEmitter);var He=new WeakMap;var Fe=new WeakMap;var Pe=new WeakMap;var me=new WeakMap;var ge=new WeakMap;var we=new WeakMap;var ye=new WeakMap;var Te=new WeakMap;var Ie=new WeakMap;var ke=new WeakMap;var Ge=new WeakMap;var Se=new WeakMap;var Ee=new WeakMap;var Ce=new WeakMap;var We=new WeakMap;var Ae=new WeakMap;var ze=new WeakSet;var Me=new WeakSet;var _e=new WeakSet;var Le=new WeakSet;var Be=new WeakSet;var Oe=new WeakSet;var Ne=new WeakSet;var De=new WeakSet;var Xe=new WeakSet;var Re=new WeakSet;var xe=new WeakSet;var Ue=new WeakSet;var Ye=new WeakSet;var Ve=new WeakSet;var je=new WeakSet;var qe=new WeakSet;var Je=new WeakSet;var Ke=function e(t){t=t.trim();if(t.length<=0){return["",""]}var s=t.lastIndexOf(" ");if(s<=0){return["",""]}return[t.slice(0,s),t.slice(s+1)]};var $e={writable:true,value:"onAddressChanged"};var Qe={writable:true,value:"onStateChanged"};var Ze=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,me),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)};var et=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,Ee)===d.DATA_INPUTTING){ve(this,Xe,nt).call(this,d.DATA_SELECTED);ve(this,Be,at).call(this)}if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).close()}};var tt=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,He)&&!babelHelpers.classPrivateFieldGet(this,He).location&&babelHelpers.classPrivateFieldGet(this,Ge).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ge).value,{})}};var st=function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,Ge)){t=babelHelpers.classPrivateFieldGet(this,Ge).value}return t};var at=function e(){babelHelpers.classPrivateFieldSet(this,He,ve(this,Ye,ct).call(this,ve(this,Le,st).call(this)));ve(this,xe,bt).call(this)};var it=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,we).isShown()){babelHelpers.classPrivateFieldGet(this,we).close()}};var lt=function e(t,s){if(Array.isArray(t)&&t.length>0){babelHelpers.classPrivateFieldGet(this,we).show(t,babelHelpers.classPrivateFieldGet(this,Se).requested)}else{var a=pe(fe,fe,Ke).call(fe,babelHelpers.classPrivateFieldGet(this,Se).current);babelHelpers.classPrivateFieldGet(this,Se).current=a[0];babelHelpers.classPrivateFieldGet(this,Se).dropped=a[1]+" "+babelHelpers.classPrivateFieldGet(this,Se).dropped;if(babelHelpers.classPrivateFieldGet(this,Se).current.length>0){ve(this,qe,ht).call(this,babelHelpers.classPrivateFieldGet(this,Se).current,s,1)}}};var rt=function e(t){if(t.data.location){ve(this,Re,dt).call(this,t.data.location)}};var nt=function e(t){babelHelpers.classPrivateFieldSet(this,Ee,t);this.emit(he(fe,fe,Qe),{state:babelHelpers.classPrivateFieldGet(this,Ee)})};var dt=function e(t){var s=this;var a;ve(this,Xe,nt).call(this,d.DATA_SELECTED);if(t){a=ve(this,Ue,ot).call(this,t).then(function(e){ve(s,Ve,ut).call(s,e);return true},function(e){return BX.debug(e)})}else{a=new Promise(function(e){ve(s,Ve,ut).call(s,null);e()})}return a};var bt=function e(){babelHelpers.classPrivateFieldSet(this,Fe,babelHelpers.classPrivateFieldGet(this,He)?ve(this,ze,Ze).call(this,babelHelpers.classPrivateFieldGet(this,He)):"");this.emit(he(fe,fe,$e),{address:babelHelpers.classPrivateFieldGet(this,He)})};var ot=function e(t){var s=this;ve(this,Xe,nt).call(this,d.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,ge).findByExternalId(t.externalId,t.sourceCode,t.languageId).then(function(e){ve(s,Xe,nt).call(s,d.DATA_LOADED);return e},function(e){i.ErrorPublisher.getInstance().notify(e.errors)})};var ct=function e(t){var s=new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,Pe)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,me).fieldForUnRecognized,t);return s};var ut=function e(t){babelHelpers.classPrivateFieldSet(this,He,t?t.toAddress():null);if(babelHelpers.classPrivateFieldGet(this,He)&&babelHelpers.classPrivateFieldGet(this,Se).dropped.length>0){babelHelpers.classPrivateFieldGet(this,He).setFieldValue(babelHelpers.classPrivateFieldGet(this,me).fieldForUnRecognized,babelHelpers.classPrivateFieldGet(this,Se).dropped)}ve(this,xe,bt).call(this)};var pt=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,Ce)){return}var a=Date.now();if(babelHelpers.classPrivateFieldGet(this,We)){var i=a-babelHelpers.classPrivateFieldGet(this,We);babelHelpers.classPrivateFieldSet(this,Ae,(babelHelpers.classPrivateFieldGet(this,Ae)+i)/2)}babelHelpers.classPrivateFieldSet(this,We,a);if(babelHelpers.classPrivateFieldGet(this,Ee)!==d.DATA_INPUTTING){ve(this,Xe,nt).call(this,d.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,we).isShown()){switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,we).isItemChosen()){ve(this,Re,dt).call(this,babelHelpers.classPrivateFieldGet(this,we).getChosenItem()).then(function(){babelHelpers.classPrivateFieldGet(s,we).close()},function(e){return BX.debug(e)})}return;case"Tab":case"Escape":ve(this,Xe,nt).call(this,d.DATA_SELECTED);ve(this,Be,at).call(this);babelHelpers.classPrivateFieldGet(this,we).close();return;case"ArrowUp":babelHelpers.classPrivateFieldGet(this,we).choosePrevItem();return;case"ArrowDown":babelHelpers.classPrivateFieldGet(this,we).chooseNextItem();return}}if(babelHelpers.classPrivateFieldGet(this,Fe).trim()!==ve(this,Le,st).call(this).trim()){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ge).value,{});ve(this,Be,at).call(this)}};var ht=function e(t,s,a){if(t.length>babelHelpers.classPrivateFieldGet(this,Te)){if(babelHelpers.classPrivateFieldGet(this,ke)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,ke))}babelHelpers.classPrivateFieldSet(this,ke,ve(this,Je,vt).call(this,t,s,a))}};var vt=function e(t,s,a){var i=this;return setTimeout(function(){babelHelpers.classPrivateFieldGet(i,ye).autocomplete(t,s).then(function(e){babelHelpers.classPrivateFieldSet(i,ke,null);ve(i,Ne,lt).call(i,e,s)},function(e){return BX.debug(e)})},a)};function ft(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);ft=function t(){return e};return e}function Ht(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);Ht=function t(){return e};return e}function Ft(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Pt=function(){function e(t){babelHelpers.classCallCheck(this,e);Tt.add(this);mt.set(this,{writable:true,value:void 0});gt.set(this,{writable:true,value:void 0});wt.set(this,{writable:true,value:void 0});yt.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof i.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,yt,t.addressFormat);babelHelpers.classPrivateFieldSet(this,mt,t.address)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,mt,t.address);babelHelpers.classPrivateFieldSet(this,wt,n.Tag.render(Ht(),Ft(this,Tt,It).call(this,babelHelpers.classPrivateFieldGet(this,mt))));babelHelpers.classPrivateFieldSet(this,gt,n.Tag.render(ft(),babelHelpers.classPrivateFieldGet(this,wt)));return babelHelpers.classPrivateFieldGet(this,gt)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,gt)){babelHelpers.classPrivateFieldGet(this,gt).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,gt)){babelHelpers.classPrivateFieldGet(this,gt).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,gt)||babelHelpers.classPrivateFieldGet(this,gt).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,mt,t);if(!babelHelpers.classPrivateFieldGet(this,wt)){return}babelHelpers.classPrivateFieldGet(this,wt).innerHTML=Ft(this,Tt,It).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var mt=new WeakMap;var gt=new WeakMap;var wt=new WeakMap;var yt=new WeakMap;var Tt=new WeakSet;var It=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,yt),i.AddressStringConverter.STRATEGY_TYPE_FIELD_SORT)};var kt=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Gt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:20});return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){if(this.bindOptions.position&&this.bindOptions.position==="right"){var a=this.bindElement.getBoundingClientRect();var i=a.width;var l=a.height/2+babelHelpers.classPrivateFieldGet(this,Gt);var r=a.height/2;var n=this.getPopupContainer().offsetWidth;var d=this.getPopupContainer().offsetHeight;var b=a.top+d;var o=document.documentElement.clientWidth;var c=document.documentElement.clientHeight;var u=b-c;if(u>0){var p=Math.ceil(u/a.height)*a.height;if(p>a.top){p-=Math.ceil((p-a.top)/a.height)*a.height}if(a.bottom>b-p){p-=a.bottom-(b-p)+babelHelpers.classPrivateFieldGet(this,Gt)}l+=p;r+=p+babelHelpers.classPrivateFieldGet(this,Gt)}if(a.left+i+n<=o){this.setOffset({offsetLeft:i,offsetTop:-l});this.setAngle({position:"left",offset:r})}else{this.setAngle(true)}}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}]);return t}(s.Popup);var Gt=new WeakMap;function St(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>"]);St=function t(){return e};return e}function Et(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);Et=function t(){return e};return e}function Ct(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Wt(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var At=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));qt.add(babelHelpers.assertThisInitialized(s));jt.add(babelHelpers.assertThisInitialized(s));Vt.add(babelHelpers.assertThisInitialized(s));Yt.add(babelHelpers.assertThisInitialized(s));zt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Mt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_t.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Lt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Bt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ot.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Nt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Dt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Rt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ut.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof i.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),zt,e.map);if(e.geocodingService instanceof i.GeocodingServiceBase){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),xt,e.geocodingService)}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),zt).onLocationChangedEventSubscribe(function(e){var a=e.getData(),i=a.location,l=i.toAddress();babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),_t,l);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Bt).address=l;if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Nt)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Nt).location=i}s.emit(Wt(t,t,Jt),{address:l})});if(!(e.popup instanceof kt)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Lt,e.popup);if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ot,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Bt,new Pt({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ot)}));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Nt,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Dt,e.locationRepository);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,_t,t.address);babelHelpers.classPrivateFieldSet(this,Mt,t.mode);babelHelpers.classPrivateFieldSet(this,Xt,false);babelHelpers.classPrivateFieldSet(this,Rt,n.Tag.render(Et()));Ct(this,Yt,es).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,Rt))}},{key:"show",value:function e(){var s=this;Ct(this,Vt,ts).call(this,babelHelpers.classPrivateFieldGet(this,_t)).then(function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,Lt).show();if(!babelHelpers.classPrivateFieldGet(s,Xt)){Ct(s,qt,as).call(s,{location:e}).then(function(){if(babelHelpers.classPrivateFieldGet(s,Nt)){babelHelpers.classPrivateFieldGet(s,Nt).location=e}s.emit(Wt(t,t,Qt))});babelHelpers.classPrivateFieldSet(s,Xt,true)}else{if(babelHelpers.classPrivateFieldGet(s,Nt)){babelHelpers.classPrivateFieldGet(s,Nt).location=e}s.emit(Wt(t,t,Qt))}})}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,Lt).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,Lt).close();this.emit(Wt(t,t,Zt))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(Wt(t,t,Jt),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(Wt(t,t,Kt),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(Wt(t,t,$t),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(Wt(t,t,Qt),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(Wt(t,t,Zt),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,zt,null);babelHelpers.classPrivateFieldSet(this,Nt,null);babelHelpers.classPrivateFieldSet(this,Bt,null);babelHelpers.classPrivateFieldGet(this,Lt).destroy();babelHelpers.classPrivateFieldSet(this,Lt,null);n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ut));babelHelpers.classPrivateFieldSet(this,Ut,null);n.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Lt).getBindElement()},set:function e(t){if(n.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,Lt).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,_t,t);babelHelpers.classPrivateFieldGet(this,Bt).address=t;Ct(this,Vt,ts).call(this,t).then(function(e){Ct(s,jt,ss).call(s,e)})}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,Mt,t);babelHelpers.classPrivateFieldGet(this,zt).mode=t}}]);return t}(r.EventEmitter);var zt=new WeakMap;var Mt=new WeakMap;var _t=new WeakMap;var Lt=new WeakMap;var Bt=new WeakMap;var Ot=new WeakMap;var Nt=new WeakMap;var Dt=new WeakMap;var Xt=new WeakMap;var Rt=new WeakMap;var xt=new WeakMap;var Ut=new WeakMap;var Yt=new WeakSet;var Vt=new WeakSet;var jt=new WeakSet;var qt=new WeakSet;var Jt={writable:true,value:"onChanged"};var Kt={writable:true,value:"onMouseOver"};var $t={writable:true,value:"onMouseOut"};var Qt={writable:true,value:"onShow"};var Zt={writable:true,value:"onClose"};var es=function e(t,s){var a=this;var l="";if(babelHelpers.classPrivateFieldGet(this,Nt)){l=babelHelpers.classPrivateFieldGet(this,Nt).render()}babelHelpers.classPrivateFieldSet(this,Ut,n.Tag.render(St(),s,l,babelHelpers.classPrivateFieldGet(this,Mt)===i.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,Bt).render({address:babelHelpers.classPrivateFieldGet(this,_t)}):""));n.Event.bind(babelHelpers.classPrivateFieldGet(this,Ut),"click",function(e){return e.stopPropagation()});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Ut),"mouseover",function(e){return a.emit(Wt(At,At,Kt),e)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Ut),"mouseout",function(e){return a.emit(Wt(At,At,$t),e)});this.bindElement=t;babelHelpers.classPrivateFieldGet(this,Lt).setContent(babelHelpers.classPrivateFieldGet(this,Ut))};var ts=function e(t){var s=this;return new Promise(function(e){var a=t?t.toLocation():null;if(a){if(!a.latitude&&!a.longitude&&t.latitude&&t.longitude){a.latitude=t.latitude;a.longitude=t.longitude}if(a.latitude&&a.longitude){e(a);return}}if(babelHelpers.classPrivateFieldGet(s,xt)){var l=null;if(t){l=t.toString(babelHelpers.classPrivateFieldGet(s,Ot),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)}babelHelpers.classPrivateFieldGet(s,xt).geocode(l).then(function(t){var s=t.length===1?t[0]:null;e(s)})}})};var ss=function e(t){babelHelpers.classPrivateFieldGet(this,zt).location=t;if(babelHelpers.classPrivateFieldGet(this,Nt)){babelHelpers.classPrivateFieldGet(this,Nt).location=t}};var as=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,zt).render({mapContainer:babelHelpers.classPrivateFieldGet(this,Rt),location:s,mode:babelHelpers.classPrivateFieldGet(this,Mt)})};function is(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);is=function t(){return e};return e}function ls(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);ls=function t(){return e};return e}var rs=function(){function e(t){babelHelpers.classCallCheck(this,e);ns.set(this,{writable:true,value:void 0});ds.set(this,{writable:true,value:void 0});bs.set(this,{writable:true,value:void 0});os.set(this,{writable:true,value:void 0});cs.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ds,t.url);babelHelpers.classPrivateFieldSet(this,bs,t.link||"");babelHelpers.classPrivateFieldSet(this,ns,t.description||"");babelHelpers.classPrivateFieldSet(this,os,t.location);babelHelpers.classPrivateFieldSet(this,cs,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,ns)){t=n.Tag.render(ls(),babelHelpers.classPrivateFieldGet(this,ns))}return n.Tag.render(is(),t,babelHelpers.classPrivateFieldGet(this,bs),babelHelpers.classPrivateFieldGet(this,cs),babelHelpers.classPrivateFieldGet(this,os).externalId,babelHelpers.classPrivateFieldGet(this,ds))}}]);return e}();var ns=new WeakMap;var ds=new WeakMap;var bs=new WeakMap;var os=new WeakMap;var cs=new WeakMap;function us(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=ps(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function ps(e,t){if(!e)return;if(typeof e==="string")return hs(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return hs(e,t)}function hs(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function vs(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);vs=function t(){return e};return e}function fs(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);fs=function t(){return e};return e}function Hs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Fs=function(){function e(t){babelHelpers.classCallCheck(this,e);Ss.add(this);Gs.add(this);Ps.set(this,{writable:true,value:[]});ms.set(this,{writable:true,value:null});gs.set(this,{writable:true,value:null});ws.set(this,{writable:true,value:void 0});ys.set(this,{writable:true,value:void 0});Ts.set(this,{writable:true,value:void 0});Is.set(this,{writable:true,value:void 0});ks.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ws,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,ys,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,Is,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,Ts,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,ks)){babelHelpers.classPrivateFieldGet(this,Ts).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,ks),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,ws),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,ys),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,Is)}).then(function(e){if(Array.isArray(e)&&e.length>0){Hs(t,Gs,Es).call(t,e);t.show()}else{t.hide()}})}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ms)){babelHelpers.classPrivateFieldGet(this,ms).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,ms)||babelHelpers.classPrivateFieldGet(this,ms).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ms)){babelHelpers.classPrivateFieldGet(this,ms).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,gs,n.Tag.render(fs()));babelHelpers.classPrivateFieldSet(this,ms,n.Tag.render(vs(),babelHelpers.classPrivateFieldGet(this,gs)));return babelHelpers.classPrivateFieldGet(this,ms)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,ks,t);this.refresh()}}]);return e}();var Ps=new WeakMap;var ms=new WeakMap;var gs=new WeakMap;var ws=new WeakMap;var ys=new WeakMap;var Ts=new WeakMap;var Is=new WeakMap;var ks=new WeakMap;var Gs=new WeakSet;var Ss=new WeakSet;var Es=function e(t){if(!babelHelpers.classPrivateFieldGet(this,ks)){return}var s=[];var a=us(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new rs({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,ks),title:babelHelpers.classPrivateFieldGet(this,ks).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,Ps,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,Ps).push(d)}if(babelHelpers.classPrivateFieldGet(this,Ps).length>0&&babelHelpers.classPrivateFieldGet(this,gs)){var b=babelHelpers.classPrivateFieldGet(this,Ps)?Hs(this,Ss,Cs).call(this,babelHelpers.classPrivateFieldGet(this,Ps)):"";babelHelpers.classPrivateFieldGet(this,gs).innerHTML="";if(b.length>0){var o=us(b),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,gs).appendChild(u)}}catch(e){o.e(e)}finally{o.f()}}}};var Cs=function e(t){var s=[];var a=us(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function Ws(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);Ws=function t(){return e};return e}function As(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);As=function t(){return e};return e}function zs(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);zs=function t(){return e};return e}function Ms(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);Ms=function t(){return e};return e}function _s(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Ls(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var Bs=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ks.add(babelHelpers.assertThisInitialized(s));Js.add(babelHelpers.assertThisInitialized(s));qs.add(babelHelpers.assertThisInitialized(s));js.add(babelHelpers.assertThisInitialized(s));Os.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ns.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ds.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Rs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Us.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ys.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Vs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:d.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Os,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ds,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Xs,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ns,typeof t.value==="string"?t.value:"");if(!i.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Rs,t.mode);babelHelpers.classPrivateFieldSet(this,Ys,n.Tag.render(Ms(),babelHelpers.classPrivateFieldGet(this,Os)));if(babelHelpers.classPrivateFieldGet(this,Rs)===i.ControlMode.edit){_s(this,qs,ea).call(this,babelHelpers.classPrivateFieldGet(this,Ys))}else{_s(this,Js,ta).call(this,babelHelpers.classPrivateFieldGet(this,Ys))}return babelHelpers.classPrivateFieldGet(this,Ys)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe(Ls(t,t,$s),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(Ls(t,t,Qs),s)}},{key:"destroy",value:function e(){n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ys));n.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,Ys,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ys)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Vs)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ds,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ds)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,Xs,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Xs)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ns,typeof t==="string"?t:"");_s(this,Ks,sa).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ns)}}]);return t}(r.EventEmitter);var Os=new WeakMap;var Ns=new WeakMap;var Ds=new WeakMap;var Xs=new WeakMap;var Rs=new WeakMap;var xs=new WeakMap;var Us=new WeakMap;var Ys=new WeakMap;var Vs=new WeakMap;var js=new WeakSet;var qs=new WeakSet;var Js=new WeakSet;var Ks=new WeakSet;var $s={writable:true,value:"onValueChanged"};var Qs={writable:true,value:"onStateChanged"};var Zs=function e(t){babelHelpers.classPrivateFieldSet(this,Vs,t);this.emit(Ls(Bs,Bs,Qs),{state:babelHelpers.classPrivateFieldGet(this,Vs)})};var ea=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,xs,n.Tag.render(zs(),n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ns))));babelHelpers.classPrivateFieldSet(this,Us,null);n.Event.bind(babelHelpers.classPrivateFieldGet(this,xs),"focus",function(e){_s(s,js,Zs).call(s,d.DATA_INPUTTING)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,xs),"focusout",function(e){_s(s,js,Zs).call(s,d.DATA_SELECTED)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,xs),"change",function(e){_s(s,js,Zs).call(s,d.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,Ns,babelHelpers.classPrivateFieldGet(s,xs).value);s.emit(Ls(Bs,Bs,$s),{value:s})});t.appendChild(n.Tag.render(As(),babelHelpers.classPrivateFieldGet(this,xs)))};var ta=function e(t){babelHelpers.classPrivateFieldSet(this,xs,null);babelHelpers.classPrivateFieldSet(this,Us,n.Tag.render(Ws(),n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ns))));t.appendChild(babelHelpers.classPrivateFieldGet(this,Us))};var sa=function e(){if(babelHelpers.classPrivateFieldGet(this,Rs)===i.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,xs).value=babelHelpers.classPrivateFieldGet(this,Ns)}else{babelHelpers.classPrivateFieldGet(this,Us).innerHTML=n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ns))}};function aa(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=ia(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function ia(e,t){if(!e)return;if(typeof e==="string")return la(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return la(e,t)}function la(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function ra(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function na(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var da=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Fa.add(babelHelpers.assertThisInitialized(s));Ha.add(babelHelpers.assertThisInitialized(s));fa.add(babelHelpers.assertThisInitialized(s));ba.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});oa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ca.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ua.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});pa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ha.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});va.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),oa,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),pa,e.languageId);na(babelHelpers.assertThisInitialized(s),fa,ga).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof i.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ba,t.address);if(!i.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,ca,t.mode);if(!n.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,ha,t.container);var s=aa(babelHelpers.classPrivateFieldGet(this,ua)),a;try{for(s.s();!(a=s.n()).done;){var l=a.value;var r=babelHelpers.classPrivateFieldGet(this,ba)?babelHelpers.classPrivateFieldGet(this,ba).getFieldValue(l.type):"";if(babelHelpers.classPrivateFieldGet(this,ca)===i.ControlMode.view&&!r){continue}var d=l.render({value:r,mode:babelHelpers.classPrivateFieldGet(this,ca)});babelHelpers.classPrivateFieldGet(this,ha).appendChild(d)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(ra(t,t,Pa),s)}},{key:"destroy",value:function e(){n.Event.unbindAll(this);var t=aa(babelHelpers.classPrivateFieldGet(this,ua)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}n.Dom.clean(babelHelpers.classPrivateFieldGet(this,ha))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(ra(t,t,ma),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ba,t);var s=aa(babelHelpers.classPrivateFieldGet(this,ua)),a;try{for(s.s();!(a=s.n()).done;){var l=a.value;l.value=babelHelpers.classPrivateFieldGet(this,ba)?babelHelpers.classPrivateFieldGet(this,ba).getFieldValue(l.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,va)}}]);return t}(r.EventEmitter);var ba=new WeakMap;var oa=new WeakMap;var ca=new WeakMap;var ua=new WeakMap;var pa=new WeakMap;var ha=new WeakMap;var va=new WeakMap;var fa=new WeakSet;var Ha=new WeakSet;var Fa=new WeakSet;var Pa={writable:true,value:"onAddressChanged"};var ma={writable:true,value:"onStateChanged"};var ga=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,oa).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,oa).fieldCollection.fields[s];var i=new Bs({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent(function(e){na(t,Ha,wa).call(t,i)});i.subscribeOnStateChangedEvent(function(e){var s=e.getData();na(t,Fa,ya).call(t,s.state)});babelHelpers.classPrivateFieldGet(t,ua).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,oa).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,ua).sort(function(e,t){return e.sort-t.sort})};var wa=function e(t){if(!babelHelpers.classPrivateFieldGet(this,ba)){babelHelpers.classPrivateFieldSet(this,ba,new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,pa)}))}babelHelpers.classPrivateFieldGet(this,ba).latitude="";babelHelpers.classPrivateFieldGet(this,ba).longitude="";babelHelpers.classPrivateFieldGet(this,ba).setFieldValue(t.type,t.value);if(t.type!==babelHelpers.classPrivateFieldGet(this,oa).fieldForUnRecognized){babelHelpers.classPrivateFieldGet(this,ba).location=null}this.emit(ra(da,da,Pa),{address:babelHelpers.classPrivateFieldGet(this,ba),changedField:t})};var ya=function e(t){babelHelpers.classPrivateFieldSet(this,va,t);this.emit(ra(da,da,ma),{state:babelHelpers.classPrivateFieldGet(this,va)})};var Ta=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ia.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});ka.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ga.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof At)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ia,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ia).onChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ga).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Ia).isShown()){babelHelpers.classPrivateFieldGet(this,Ia).show()}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ia).isShown()){babelHelpers.classPrivateFieldGet(this,Ia).close()}babelHelpers.classPrivateFieldGet(this,Ia).bindelement=babelHelpers.classPrivateFieldGet(this,ka)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!n.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,ka,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,Ia).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,Ga).address,mode:babelHelpers.classPrivateFieldGet(this,Ga).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===d.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,Ia).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ga,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ia).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ia).destroy();babelHelpers.classPrivateFieldSet(this,Ia,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ia)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ga)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,ka)}}]);return t}(b);var Ia=new WeakMap;var ka=new WeakMap;var Ga=new WeakMap;var Sa=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ea.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ca.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof fe)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ea,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ea).onAddressChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ca).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ea).onStateChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ca).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Ea).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Ca).mode===i.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Ea).render({inputNode:babelHelpers.classPrivateFieldGet(this,Ca).inputNode,address:babelHelpers.classPrivateFieldGet(this,Ca).address,mode:babelHelpers.classPrivateFieldGet(this,Ca).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ea).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ca,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ea).destroy();babelHelpers.classPrivateFieldSet(this,Ea,null)}}]);return t}(b);var Ea=new WeakMap;var Ca=new WeakMap;var Wa=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Aa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});za.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof da)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Aa,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Aa).subscribeOnAddressChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),za).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Aa).subscribeOnStateChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),za).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,za).mode===i.ControlMode.edit){if(!n.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,Aa).render({address:babelHelpers.classPrivateFieldGet(this,za).address,mode:babelHelpers.classPrivateFieldGet(this,za).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,za,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Aa).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Aa).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Aa).destroy();babelHelpers.classPrivateFieldSet(this,Aa,null)}}]);return t}(b);var Aa=new WeakMap;var za=new WeakMap;function Ma(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var _a=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Va.add(babelHelpers.assertThisInitialized(s));Ya.add(babelHelpers.assertThisInitialized(s));Ua.add(babelHelpers.assertThisInitialized(s));xa.add(babelHelpers.assertThisInitialized(s));Ra.add(babelHelpers.assertThisInitialized(s));La.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Ba.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Oa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});Na.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Da.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});Xa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",Ma(this,xa,ja).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",Ma(this,Ya,Ja).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",Ma(this,Va,Ka).bind(this));document.addEventListener("click",Ma(this,Ua,qa).bind(this));this.map.onMouseOverSubscribe(Ma(this,Ya,Ja).bind(this));this.map.onMouseOutSubscribe(Ma(this,Va,Ka).bind(this))}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===d.DATA_INPUTTING){this.closeMap();return}if(!t){this.closeMap()}this.map.address=t;if(t){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Xa)){return}document.removeEventListener("click",Ma(this,Ua,qa));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",Ma(this,xa,ja));this.addressWidget.controlWrapper.removeEventListener("mouseover",Ma(this,Ya,Ja));this.addressWidget.controlWrapper.removeEventListener("mouseout",Ma(this,Va,Ka))}babelHelpers.classPrivateFieldSet(this,Ba,null);babelHelpers.classPrivateFieldSet(this,Na,null);babelHelpers.classPrivateFieldSet(this,La,false);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,Xa,true)}}]);return t}(Ta);var La=new WeakMap;var Ba=new WeakMap;var Oa=new WeakMap;var Na=new WeakMap;var Da=new WeakMap;var Xa=new WeakMap;var Ra=new WeakSet;var xa=new WeakSet;var Ua=new WeakSet;var Ya=new WeakSet;var Va=new WeakSet;var ja=function e(){if(babelHelpers.classPrivateFieldGet(this,Xa)){return}if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,Ba))}};var qa=function e(){if(babelHelpers.classPrivateFieldGet(this,Xa)){return}this.closeMap()};var Ja=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Xa)){return}babelHelpers.classPrivateFieldSet(this,La,true);clearTimeout(babelHelpers.classPrivateFieldGet(this,Ba));clearTimeout(babelHelpers.classPrivateFieldGet(this,Na));if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Ba,setTimeout(function(){t.showMap()},babelHelpers.classPrivateFieldGet(this,Oa)))}};var Ka=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Xa)){return}babelHelpers.classPrivateFieldSet(this,La,false);clearTimeout(babelHelpers.classPrivateFieldGet(this,Ba));clearTimeout(babelHelpers.classPrivateFieldGet(this,Na));if(this.addressWidget.mode===i.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Na,setTimeout(function(){t.closeMap()},babelHelpers.classPrivateFieldGet(this,Da)))}};var $a=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var l=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var r=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var n=t.addressFormat||new i.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var d=[];if(!t.useFeatures||t.useFeatures.fields!==false){d.push(this.createFieldsFeature({addressFormat:n,languageId:l}))}var b=null;if(s&&a){b=this.createSource(s,a,l,r)}if(b){if(!t.useFeatures||t.useFeatures.autocomplete!==false){d.push(this.createAutocompleteFeature({languageId:l,addressFormat:n,source:b}))}if(!t.useFeatures||t.useFeatures.map!==false){var o=a.hasOwnProperty("showPhotos")&&a.showPhotos===true;var c=a.hasOwnProperty("useGeocodingService")&&a.useGeocodingService===true;var u=80;var p=150;var v=o?5:0;var f="auto";d.push(this.createMapFeature({addressFormat:n,source:b,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||u,thumbnailWidth:t.thumbnailWidth||p,maxPhotoCount:t.maxPhotoCount||v,mapBehavior:t.mapBehavior||f,useGeocodingService:c}))}}return new h({features:d,address:t.address,mode:t.mode,addressFormat:n,languageId:l})}},{key:"createFieldsFeature",value:function e(t){var s=new da({addressFormat:t.addressFormat,languageId:t.languageId});return new Wa({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new fe({languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService});return new Sa({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s=new kt({cacheable:true,closeByEsc:true,className:"location-popup-window",animation:"fading",angle:true,bindOptions:t.popupBindOptions});var a=null;if(t.maxPhotoCount>0){a=new Fs({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var l={map:new At({addressFormat:t.addressFormat,map:t.source.map,popup:s,gallery:a,locationRepository:new i.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null})};var r;if(t.mapBehavior==="manual"){r=new Ta(l)}else{r=new _a(l)}return r}},{key:"createSource",value:function e(s,a,l,r){var n=null;if(s==="GOOGLE"){a.languageId=l;a.sourceLanguageId=r;try{n=new t.Google(a)}catch(e){if(e instanceof i.SourceCreationError){n=null}else{throw e}}}else{throw new RangeError("Wrong source code")}return n}}]);return e}();function Qa(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);Qa=function t(){return e};return e}function Za(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ei(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ti=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));li.add(babelHelpers.assertThisInitialized(e));si.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});ai.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});ii.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),si,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),ii,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,ai,n.Tag.render(Qa(),ei(this,li,ni).call(this)));babelHelpers.classPrivateFieldGet(this,ai).addEventListener("click",function(e){a.state=babelHelpers.classPrivateFieldGet(a,si)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit(Za(t,t,ri),{state:babelHelpers.classPrivateFieldGet(a,si)});e.stopPropagation();return false});babelHelpers.classPrivateFieldGet(this,ai).addEventListener("mouseover",function(e){e.stopPropagation()});return babelHelpers.classPrivateFieldGet(this,ai)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe(Za(t,t,ri),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,si,t);if(babelHelpers.classPrivateFieldGet(this,ai)){babelHelpers.classPrivateFieldGet(this,ai).innerHTML=ei(this,li,ni).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,si)}}]);return t}(r.EventEmitter);var si=new WeakMap;var ai=new WeakMap;var ii=new WeakMap;var li=new WeakSet;babelHelpers.defineProperty(ti,"STATE_OFF",0);babelHelpers.defineProperty(ti,"STATE_ON",1);var ri={writable:true,value:"onToggleEvent"};var ni=function e(){return babelHelpers.classPrivateFieldGet(this,ii)[babelHelpers.classPrivateFieldGet(this,si)]};function di(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);di=function t(){return e};return e}function bi(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function oi(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ci=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));hi.add(babelHelpers.assertThisInitialized(e));ui.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});pi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,ui,s.type);babelHelpers.classPrivateFieldSet(this,pi,n.Tag.render(di(),oi(this,hi,fi).call(this,babelHelpers.classPrivateFieldGet(this,ui))));babelHelpers.classPrivateFieldGet(this,pi).addEventListener("click",function(e){a.emit(bi(t,t,vi))});return babelHelpers.classPrivateFieldGet(this,pi)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(bi(t,t,vi),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,ui,t);if(babelHelpers.classPrivateFieldGet(this,pi)){babelHelpers.classPrivateFieldGet(this,pi).className=oi(this,hi,fi).call(this,babelHelpers.classPrivateFieldGet(this,ui))}}}]);return t}(r.EventEmitter);var ui=new WeakMap;var pi=new WeakMap;var hi=new WeakSet;var vi={writable:true,value:"onClick"};babelHelpers.defineProperty(ci,"TYPE_CLEAR","clear");babelHelpers.defineProperty(ci,"TYPE_SEARCH","search");babelHelpers.defineProperty(ci,"TYPE_LOADER","loader");var fi=function e(t){var s="";if(t===ci.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===ci.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===ci.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function Hi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Hi=function t(){return e};return e}function Fi(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);Fi=function t(){return e};return e}function Pi(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);Pi=function t(){return e};return e}function mi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);mi=function t(){return e};return e}function gi(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);gi=function t(){return e};return e}function wi(){var e=babelHelpers.taggedTemplateLiteral(["",""]);wi=function t(){return e};return e}function yi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);yi=function t(){return e};return e}function Ti(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);Ti=function t(){return e};return e}function Ii(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);Ii=function t(){return e};return e}function ki(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function Gi(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Si=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Li.add(babelHelpers.assertThisInitialized(s));_i.add(babelHelpers.assertThisInitialized(s));Mi.add(babelHelpers.assertThisInitialized(s));zi.add(babelHelpers.assertThisInitialized(s));Ai.add(babelHelpers.assertThisInitialized(s));Wi.add(babelHelpers.assertThisInitialized(s));Ci.add(babelHelpers.assertThisInitialized(s));Ei.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var l=this.getValue();var r=null;if(n.Type.isStringFilled(l)){try{r=new i.Address(JSON.parse(l))}catch(e){BX.debug("Cant parse address value");return}}var d=new $a;this._addressWidget=d.createAddressWidget({address:r,mode:this._mode===BX.UI.EntityEditorMode.edit?i.ControlMode.edit:i.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(Gi(this,zi,Ri).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(Gi(this,Mi,xi).bind(this));this._fieldsSwitch=new ti({state:ti.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(Gi(this,Ci,Ni).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?i.ControlMode.edit:i.ControlMode.view;this._fieldsSwitch.state=ti.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=Gi(this,Li,Yi).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;n.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?Gi(this,Li,Yi).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=n.Tag.render(Ii(),"".concat(this.getName(),"_STRING"));this._hiddenInput=n.Tag.render(Ti(),this.getValue(),this.getName());this._inputIcon=new ci;this._inputIcon.subscribeOnClickEvent(Gi(this,Ei,Oi).bind(this));var l=this._inputIcon.render({type:ki(t,t,Bi).call(t,Gi(this,Li,Yi).call(this))});this._inputContainer=n.Tag.render(yi(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(n.Tag.render(wi(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=n.Tag.render(gi(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=n.Tag.render(mi());if(this._fieldsSwitch.state===ti.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var d=Gi(this,_i,Ui).call(this,Gi(this,Li,Yi).call(this));r=n.Tag.render(Pi(),d);this._innerWrapper=n.Tag.render(Fi(),r);i.mapBindElement=r}else{this._innerWrapper=n.Tag.render(Hi(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=ci.TYPE_CLEAR}if(!n.Type.isArray(i)){return}i.forEach(function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)})}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",function(e,s){s.methods.address=t.registerFieldMethod})}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var Ei=new WeakSet;var Ci=new WeakSet;var Wi=new WeakSet;var Ai=new WeakSet;var zi=new WeakSet;var Mi=new WeakSet;var _i=new WeakSet;var Li=new WeakSet;var Bi=function e(t){return t?ci.TYPE_CLEAR:ci.TYPE_SEARCH};var Oi=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=ci.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var Ni=function e(t){var s=t.getData();var a=s.state;if(a===ti.STATE_OFF){Gi(this,Wi,Di).call(this)}else{Gi(this,Ai,Xi).call(this)}this._addressWidget.resetView()};var Di=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var Xi=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var Ri=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===l.State.DATA_LOADING){i=ci.TYPE_LOADER}else{if(s.state===l.State.DATA_INPUTTING){this.markAsChanged()}i=ki(Si,Si,Bi).call(Si,Gi(this,Li,Yi).call(this))}this._inputIcon.type=i};var xi=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=ki(Si,Si,Bi).call(Si,a)}};var Ui=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var Yi=function e(){return this._addressWidget.address};Si.registerField();e.Address=h;e.BaseFeature=b;e.MapFeature=Ta;e.AutocompleteFeature=Sa;e.FieldsFeature=Wa;e.Factory=$a;e.State=d;e.UIAddress=Si})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js