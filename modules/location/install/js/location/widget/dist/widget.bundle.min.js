this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n,d){"use strict";var b=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(b,"INITIAL","INITIAL");babelHelpers.defineProperty(b,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(b,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(b,"DATA_SUPPOSED","DATA_SUPPOSED");babelHelpers.defineProperty(b,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(b,"DATA_LOADED","DATA_LOADED");var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new l.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function c(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=u(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function u(e,t){if(!e)return;if(typeof e==="string")return p(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(e,t)}function p(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function v(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var h=new WeakMap;var f=new WeakMap;var H=new WeakMap;var F=new WeakMap;var P=new WeakMap;var m=new WeakMap;var g=new WeakMap;var T=new WeakMap;var w=new WeakMap;var I=new WeakMap;var y=new WeakMap;var G=new WeakMap;var S=new WeakMap;var k=new WeakSet;var E=new WeakSet;var C=new WeakSet;var W=new WeakSet;var A=new WeakSet;var M=new WeakSet;var z=new WeakSet;var _=new WeakSet;var L=new WeakSet;var O=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));L.add(babelHelpers.assertThisInitialized(s));_.add(babelHelpers.assertThisInitialized(s));z.add(babelHelpers.assertThisInitialized(s));M.add(babelHelpers.assertThisInitialized(s));A.add(babelHelpers.assertThisInitialized(s));W.add(babelHelpers.assertThisInitialized(s));C.add(babelHelpers.assertThisInitialized(s));E.add(babelHelpers.assertThisInitialized(s));k.add(babelHelpers.assertThisInitialized(s));h.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});f.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});H.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});F.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});P.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});m.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});g.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});T.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});w.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});I.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});y.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});G.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});S.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),F,e.addressFormat);if(e.address&&!(e.address instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),H,e.address||null);if(!l.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),h,e.mode);if(!d.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),P,e.languageId);if(e.features){if(!d.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach(function(e){v(babelHelpers.assertThisInitialized(s),k,N).call(babelHelpers.assertThisInitialized(s),e)})}if(d.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof l.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),S,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),G)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),S,new l.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),f,b.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var i=babelHelpers.classPrivateFieldGet(this,H)?babelHelpers.classPrivateFieldGet(this,H).id:0;if(t&&!t.getFieldValue(l.AddressType.ADDRESS_LINE_1)&&babelHelpers.classPrivateFieldGet(this,F).isTemplateExists(l.FormatTemplateType.ADDRESS_LINE_1)){t.setFieldValue(l.AddressType.ADDRESS_LINE_1,l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,F).getTemplate(l.FormatTemplateType.ADDRESS_LINE_1),l.AddressStringConverter.CONTENT_TYPE_TEXT,null,babelHelpers.classPrivateFieldGet(this,F)))}babelHelpers.classPrivateFieldSet(this,H,t);if(i>0){babelHelpers.classPrivateFieldGet(this,H).id=i}babelHelpers.classPrivateFieldSet(this,I,true);v(this,z,U).call(this,t);v(this,E,D).call(this,"setAddress",[t],s,a);if(babelHelpers.classPrivateFieldGet(this,f)!==b.DATA_INPUTTING){v(this,C,B).call(this)}}},{key:"emitFeatureEvent",value:function e(s){this.emit(t.onFeatureEvent,s)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break;default:babelHelpers.classPrivateFieldSet(this,y,true)}}},{key:"resetView",value:function e(){v(this,E,D).call(this,"resetView")}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,T,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,h)===l.ControlMode.edit){if(!d.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,g,t.inputNode);v(this,z,U).call(this,babelHelpers.classPrivateFieldGet(this,H))}v(this,E,D).call(this,"render",[t]);if(babelHelpers.classPrivateFieldGet(this,h)===l.ControlMode.edit){d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focus",v(this,A,X).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focusout",v(this,_,V).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup.bind(this))}}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,f,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnFeatureEvent",value:function e(s){this.subscribe(t.onFeatureEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){l.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,w)){return}d.Event.unbindAll(this);d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focus",v(this,A,X));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focusout",v(this,_,V));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup);v(this,E,D).call(this,"destroy");v(this,L,Y).call(this);babelHelpers.classPrivateFieldSet(this,w,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,w)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,T)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,H)},set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,H,t);v(this,E,D).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,y,false);babelHelpers.classPrivateFieldSet(this,I,false);v(this,z,U).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,h)},set:function e(t){if(!l.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,h,t);v(this,E,D).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,F)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(O,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(O,"onStateChangedEvent","onStateChanged");babelHelpers.defineProperty(O,"onFeatureEvent","onFeatureEvent");var N=function e(t){if(!(t instanceof o)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,m).push(t)};var D=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var l;var r=c(babelHelpers.classPrivateFieldGet(this,m)),n;try{for(r.s();!(n=r.n()).done;){var d=n.value;var b=false;var o=c(i),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;if(d instanceof p){b=true;break}}}catch(e){o.e(e)}finally{o.f()}if(!b&&d!==a){l=d[t].apply(d,s)}}}catch(e){r.e(e)}finally{r.f()}return l};var B=function e(){this.emit(O.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,H)});if(babelHelpers.classPrivateFieldGet(this,H)&&babelHelpers.classPrivateFieldGet(this,G)){v(this,W,R).call(this,babelHelpers.classPrivateFieldGet(this,H))}};var R=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,S).findParents(t.location)}};var X=function e(t){var s=babelHelpers.classPrivateFieldGet(this,g).value;if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,g),s.length-1)}};var x=function e(t,s){var a="";if(t){if(!babelHelpers.classPrivateFieldGet(this,F).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,F).code,'" does not have a template "').concat(s,'"'));return""}a=l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,F).getTemplate(s),l.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,F))}return a};var U=function e(t){if(babelHelpers.classPrivateFieldGet(this,g)){var s=v(this,M,x).call(this,t,l.FormatTemplateType.AUTOCOMPLETE);var a=v(this,M,x).call(this,t,l.FormatTemplateType.DEFAULT);babelHelpers.classPrivateFieldGet(this,g).value=s.trim()!==""?s:a;babelHelpers.classPrivateFieldGet(this,g).title=a;var i=babelHelpers.classPrivateFieldGet(this,g).selectionStart;var r=s.length;babelHelpers.classPrivateFieldGet(this,g).setSelectionRange(i,r)}};var V=function e(t){if(babelHelpers.classPrivateFieldGet(this,y)&&!babelHelpers.classPrivateFieldGet(this,I)){var s=babelHelpers.classPrivateFieldGet(this,g).value.trim();var a=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,P)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,F).fieldForUnRecognized,s);this.address=a;v(this,C,B).call(this)}babelHelpers.classPrivateFieldSet(this,y,false);babelHelpers.classPrivateFieldSet(this,I,false)};var Y=function e(){babelHelpers.classPrivateFieldGet(this,m).splice(0,babelHelpers.classPrivateFieldGet(this,m).length)};function j(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<span class="location-map-popup-item--info"> \t\t\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t"]);j=function t(){return e};return e}function J(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);J=function t(){return e};return e}function K(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-popup-item--info-left"></div>']);K=function t(){return e};return e}var q=new WeakMap;var $=new WeakMap;var Z=new WeakMap;var Q=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));q.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});$.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});Z.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Autocomplete.MenuBottom");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,$,d.Tag.render(K()));babelHelpers.classPrivateFieldSet(this,Z,d.Tag.render(J()));babelHelpers.classPrivateFieldSet(this,q,d.Tag.render(j(),babelHelpers.classPrivateFieldGet(this,$),babelHelpers.classPrivateFieldGet(this,Z)));return babelHelpers.classPrivateFieldGet(this,q)}},{key:"setRightItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,Z).firstChild){babelHelpers.classPrivateFieldGet(this,Z).removeChild(babelHelpers.classPrivateFieldGet(this,Z).firstChild)}babelHelpers.classPrivateFieldGet(this,Z).appendChild(t)}},{key:"setLeftItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,$).firstChild){babelHelpers.classPrivateFieldGet(this,$).removeChild(babelHelpers.classPrivateFieldGet(this,$).firstChild)}babelHelpers.classPrivateFieldGet(this,$).appendChild(t)}}]);return t}(n.EventEmitter);var ee=new WeakMap;var te=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});var a=e.bindElement.getBoundingClientRect();s.popupWindow.setMaxWidth(a.width);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ee,new Q);s.layout.menuContainer.appendChild(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),ee).render());return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[t]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){var s=t;if(s<0){s=this.menuItems.length-1}else if(s>this.menuItems.length-1){s=0}this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=s;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}},{key:"setBottomRightItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,ee).setRightItemNode(t)}},{key:"setBottomLeftItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,ee).setLeftItemNode(t)}}]);return t}(a.Menu);function se(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ae=new WeakMap;var ie=new WeakMap;var le=new WeakMap;var re=new WeakMap;var ne=new WeakSet;var de=new WeakSet;var be=new WeakSet;var oe=new WeakSet;var ce=new WeakSet;var ue=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ce.add(babelHelpers.assertThisInitialized(s));oe.add(babelHelpers.assertThisInitialized(s));be.add(babelHelpers.assertThisInitialized(s));de.add(babelHelpers.assertThisInitialized(s));ne.add(babelHelpers.assertThisInitialized(s));ae.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ie.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});le.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});re.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ae,e.inputNode);if(e.menuNode){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ie,e.menuNode)}return s}babelHelpers.createClass(t,[{key:"getMenu",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,le)||babelHelpers.classPrivateFieldGet(this,le).isDestroyed()){babelHelpers.classPrivateFieldSet(this,le,se(this,ne,pe).call(this))}return babelHelpers.classPrivateFieldGet(this,le)}},{key:"show",value:function e(t,s){if(t.length>0){this.setMenuItems(t,s);this.getMenu().show()}}},{key:"close",value:function e(){this.getMenu().close()}},{key:"setMenuItems",value:function e(t,s,a){var i=this;this.getMenu().clearItems();if(Array.isArray(t)){var r=false;babelHelpers.classPrivateFieldSet(this,re,t.slice());t.forEach(function(e,t){if(a&&a.getFieldValue(l.AddressType.LOCALITY)){if(!r&&e&&e.address&&e.address.getFieldValue(l.AddressType.LOCALITY)){if(!se(i,de,ve).call(i,e.address).includes(a.getFieldValue(l.AddressType.LOCALITY))){r=true;i.getMenu().addMenuItem({html:d.Loc.getMessage("LOCATION_WIDGET_PROMPT_IN_OTHER_CITY"),delimiter:true})}}}i.getMenu().addMenuItem(se(i,be,he).call(i,t,e,s))})}}},{key:"choosePrevItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s=null;var a=this.getMenu().choosePrevItem();if(a){if(a.delimiter&&a.delimiter===true){s=t?this.getMenu().chooseNextItem():this.choosePrevItem(true)}else{s=se(this,ce,He).call(this,this.getMenu().choseItemIdx)}}return s}},{key:"chooseNextItem",value:function e(){var t=null;var s=this.getMenu().chooseNextItem();if(s){if(s.delimiter&&s.delimiter===true){t=this.chooseNextItem()}else{t=se(this,ce,He).call(this,this.getMenu().choseItemIdx)}}return t}},{key:"isItemChosen",value:function e(){return this.getMenu().isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=this.getMenu().getChosenItem();if(s&&s.id){t=se(this,ce,He).call(this,this.getMenu().choseItemIdx)}return t}},{key:"isShown",value:function e(){return this.getMenu().isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,le)){babelHelpers.classPrivateFieldGet(this,le).destroy();babelHelpers.classPrivateFieldSet(this,le,null)}babelHelpers.classPrivateFieldSet(this,re,null)}}],[{key:"createMenuItemText",value:function e(t,s,a){var i="\n\t\t<div>\n\t\t\t<strong>".concat(t,"</strong>\n\t\t</div>");var r;if(a.getFieldValue(l.LocationType.TMP_TYPE_CLARIFICATION)){r=a.getFieldValue(l.LocationType.TMP_TYPE_CLARIFICATION);if(r){if(a.getFieldValue(l.LocationType.TMP_TYPE_HINT)){r+=" <i>(".concat(a.getFieldValue(l.LocationType.TMP_TYPE_HINT),")</i>")}i+="<div>".concat(r,"</div>")}}return'<div data-role="location-widget-menu-item" tabindex="-1">'+i+"</div>"}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(ue,"onItemSelectedEvent","onItemSelected");var pe=function e(){return new te({bindElement:babelHelpers.classPrivateFieldGet(this,ie)?babelHelpers.classPrivateFieldGet(this,ie):babelHelpers.classPrivateFieldGet(this,ae),autoHide:false,closeByEsc:true,className:"location-widget-prompt-menu"})};var ve=function e(t){var s=[];if(t.getFieldValue(l.AddressType.LOCALITY)){s.push(t.getFieldValue(l.AddressType.LOCALITY))}if(t.getFieldValue(l.AddressType.ADM_LEVEL_1)){s.push(t.getFieldValue(l.AddressType.ADM_LEVEL_1))}return s};var he=function e(t,s,a){var i=this;return{id:t,title:s.name,html:ue.createMenuItemText(s.name,a,s),onclick:function e(s,a){se(i,oe,fe).call(i,t);i.close()}}};var fe=function e(t){var s=se(this,ce,He).call(this,t);if(s){this.emit(ue.onItemSelectedEvent,{location:s})}};var He=function e(t){var s=null;if(babelHelpers.classPrivateFieldGet(this,re)[t]!==undefined){s=babelHelpers.classPrivateFieldGet(this,re)[t]}if(!s){BX.debug("Location with index ".concat(t," was not found"))}return s};function Fe(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Pe=new WeakMap;var me=new WeakMap;var ge=new WeakMap;var Te=new WeakMap;var we=new WeakSet;var Ie=new WeakSet;var ye=new WeakSet;var Ge=function(){function e(t,s,a){babelHelpers.classCallCheck(this,e);ye.add(this);Ie.add(this);we.add(this);Pe.set(this,{writable:true,value:null});me.set(this,{writable:true,value:""});ge.set(this,{writable:true,value:""});Te.set(this,{writable:true,value:null});if(!(t instanceof HTMLInputElement)){throw new TypeError("Wrong input type")}babelHelpers.classPrivateFieldSet(this,Pe,t);if(!(s instanceof l.Format)){throw new TypeError("Wrong addressFormat type")}babelHelpers.classPrivateFieldSet(this,Te,s);if(a&&!(a instanceof l.Address)){throw new TypeError("Wrong address type")}if(a){this.setValueFromAddress(a)}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldSet(this,me,t);babelHelpers.classPrivateFieldGet(this,Pe).value=t;if(s){babelHelpers.classPrivateFieldSet(this,ge,t)}Fe(this,we,Se).call(this)}},{key:"actualize",value:function e(){babelHelpers.classPrivateFieldSet(this,me,babelHelpers.classPrivateFieldGet(this,Pe).value);Fe(this,we,Se).call(this)}},{key:"isChanged",value:function e(){return babelHelpers.classPrivateFieldGet(this,me).trim()!==babelHelpers.classPrivateFieldGet(this,Pe).value.trim()}},{key:"hasPureAddressString",value:function e(){return babelHelpers.classPrivateFieldGet(this,ge)!==""}},{key:"setValueFromAddress",value:function e(t){var s="";if(t){s=Fe(this,ye,Ee).call(this,t,l.FormatTemplateType.AUTOCOMPLETE);if(s.trim()===""){s=Fe(this,ye,Ee).call(this,t,l.FormatTemplateType.DEFAULT)}}this.setValue(s,true)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,me)}},{key:"customTail",get:function e(){if(babelHelpers.classPrivateFieldGet(this,ge)===""){return babelHelpers.classPrivateFieldGet(this,me)}var t;if(!Fe(this,Ie,ke).call(this)){t=babelHelpers.classPrivateFieldGet(this,me).slice(babelHelpers.classPrivateFieldGet(this,ge).length)}else{t=babelHelpers.classPrivateFieldGet(this,me)}return t}}]);return e}();var Se=function e(){if(Fe(this,Ie,ke).call(this)){babelHelpers.classPrivateFieldSet(this,ge,"")}};var ke=function e(){return babelHelpers.classPrivateFieldGet(this,me)===""||babelHelpers.classPrivateFieldGet(this,ge)===""||babelHelpers.classPrivateFieldGet(this,me).indexOf(babelHelpers.classPrivateFieldGet(this,ge))!==0};var Ee=function e(t,s){if(!babelHelpers.classPrivateFieldGet(this,Te).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,Te).code,'" does not have a template "').concat(s,'"'));return""}return l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,Te).getTemplate(s),l.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,Te))};function Ce(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span>\t\t\t\t\n\t\t\t\t\t<span class="menu-popup-item-icon"></span>\n\t\t\t\t\t<span class="menu-popup-item-text">',"</span>\n\t\t\t\t</span>\t\t\n\t\t"]);Ce=function t(){return e};return e}function We(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="location-map-popup-item--show-on-map">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t"]);We=function t(){return e};return e}function Ae(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function Me(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ze(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var _e=new WeakMap;var Le=new WeakMap;var Oe=new WeakMap;var Ne=new WeakMap;var De=new WeakMap;var Be=new WeakMap;var Re=new WeakMap;var Xe=new WeakMap;var xe=new WeakMap;var Ue=new WeakMap;var Ve=new WeakMap;var Ye=new WeakMap;var je=new WeakMap;var Je=new WeakMap;var Ke=new WeakMap;var qe=new WeakMap;var $e=new WeakMap;var Ze=new WeakMap;var Qe=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var st=new WeakMap;var at=new WeakMap;var it=new WeakMap;var lt=new WeakMap;var rt=new WeakSet;var nt=new WeakSet;var dt=new WeakSet;var bt=new WeakSet;var ot=new WeakSet;var ct=new WeakSet;var ut=new WeakSet;var pt=new WeakSet;var vt=new WeakSet;var ht=new WeakSet;var ft=new WeakSet;var Ht=new WeakSet;var Ft=new WeakSet;var Pt=new WeakSet;var mt=new WeakSet;var gt=new WeakSet;var Tt=new WeakSet;var wt=new WeakSet;var It=new WeakSet;var yt=new WeakSet;var Gt=new WeakSet;var St=new WeakSet;var kt=new WeakSet;var Et=new WeakSet;var Ct=new WeakSet;var Wt=new WeakSet;var At=new WeakSet;var Mt=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));At.add(babelHelpers.assertThisInitialized(s));Wt.add(babelHelpers.assertThisInitialized(s));Ct.add(babelHelpers.assertThisInitialized(s));Et.add(babelHelpers.assertThisInitialized(s));kt.add(babelHelpers.assertThisInitialized(s));St.add(babelHelpers.assertThisInitialized(s));Gt.add(babelHelpers.assertThisInitialized(s));yt.add(babelHelpers.assertThisInitialized(s));It.add(babelHelpers.assertThisInitialized(s));wt.add(babelHelpers.assertThisInitialized(s));Tt.add(babelHelpers.assertThisInitialized(s));gt.add(babelHelpers.assertThisInitialized(s));mt.add(babelHelpers.assertThisInitialized(s));Pt.add(babelHelpers.assertThisInitialized(s));Ft.add(babelHelpers.assertThisInitialized(s));Ht.add(babelHelpers.assertThisInitialized(s));ft.add(babelHelpers.assertThisInitialized(s));ht.add(babelHelpers.assertThisInitialized(s));vt.add(babelHelpers.assertThisInitialized(s));pt.add(babelHelpers.assertThisInitialized(s));ut.add(babelHelpers.assertThisInitialized(s));ct.add(babelHelpers.assertThisInitialized(s));ot.add(babelHelpers.assertThisInitialized(s));bt.add(babelHelpers.assertThisInitialized(s));dt.add(babelHelpers.assertThisInitialized(s));nt.add(babelHelpers.assertThisInitialized(s));rt.add(babelHelpers.assertThisInitialized(s));_e.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Le.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Oe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ne.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});De.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Be.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Re.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ue.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ve.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ye.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ke.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});$e.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ze.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});et.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});tt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});st.set(babelHelpers.assertThisInitialized(s),{writable:true,value:100});at.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});it.set(babelHelpers.assertThisInitialized(s),{writable:true,value:"bitrixLocationLastSelectedLocation"});lt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof l.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ne,e.addressFormat);if(!(e.autocompleteService instanceof l.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ue,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Oe,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),De,e.sourceCode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),_e,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Xe,e.presetLocationsProvider);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Be,e.locationRepository||new l.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Re,e.userLocation);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ye,e.promptDelay||300);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),je,e.maxPromptDelay||500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ve,e.minCharsCountToAutocomplete||3);ze(babelHelpers.assertThisInitialized(s),mt,es).call(babelHelpers.assertThisInitialized(s),b.INITIAL);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),et,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ye));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),lt,new l.AutocompleteServiceFilter);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ke,t.inputNode);babelHelpers.classPrivateFieldSet(this,_e,t.address);babelHelpers.classPrivateFieldSet(this,Le,new Ge(babelHelpers.classPrivateFieldGet(this,Ke),babelHelpers.classPrivateFieldGet(this,Ne),babelHelpers.classPrivateFieldGet(this,_e)));babelHelpers.classPrivateFieldGet(this,Ke).addEventListener("keyup",ze(this,Gt,rs).bind(this));babelHelpers.classPrivateFieldGet(this,Ke).addEventListener("focus",ze(this,ut,Yt).bind(this));babelHelpers.classPrivateFieldGet(this,Ke).addEventListener("focusout",ze(this,ct,Vt).bind(this));babelHelpers.classPrivateFieldGet(this,Ke).addEventListener("click",ze(this,rt,Bt).bind(this));babelHelpers.classPrivateFieldSet(this,xe,new ue({inputNode:t.inputNode,menuNode:t.menuNode}));babelHelpers.classPrivateFieldGet(this,xe).subscribe(ue.onItemSelectedEvent,ze(this,Pt,Qt).bind(this));document.addEventListener("click",ze(this,ht,Kt).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(Me(t,t,_t),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(Me(t,t,Lt),s)}},{key:"onSearchStartedEventSubscribe",value:function e(s){this.subscribe(Me(t,t,Ot),s)}},{key:"onSearchCompletedEventSubscribe",value:function e(s){this.subscribe(Me(t,t,Nt),s)}},{key:"onShowOnMapClickedEventSubscribe",value:function e(s){this.subscribe(Me(t,t,Dt),s)}},{key:"showPrompt",value:function e(t){babelHelpers.classPrivateFieldGet(this,qe).requested=t;babelHelpers.classPrivateFieldGet(this,qe).current=t;babelHelpers.classPrivateFieldGet(this,qe).dropped="";ze(this,Et,bs).call(this,t,ze(this,kt,ds).call(this))}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,xe)){babelHelpers.classPrivateFieldGet(this,xe).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,xe)){babelHelpers.classPrivateFieldGet(this,xe).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ze)){return}d.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,xe)){babelHelpers.classPrivateFieldGet(this,xe).destroy();babelHelpers.classPrivateFieldSet(this,xe,null)}babelHelpers.classPrivateFieldSet(this,Je,null);if(babelHelpers.classPrivateFieldGet(this,Ke)){babelHelpers.classPrivateFieldGet(this,Ke).removeEventListener("keyup",ze(this,Gt,rs));babelHelpers.classPrivateFieldGet(this,Ke).removeEventListener("focus",ze(this,ut,Yt));babelHelpers.classPrivateFieldGet(this,Ke).removeEventListener("focusout",ze(this,ct,Vt));babelHelpers.classPrivateFieldGet(this,Ke).removeEventListener("click",ze(this,rt,Bt))}document.removeEventListener("click",ze(this,ht,Kt));babelHelpers.classPrivateFieldSet(this,Ze,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,_e,t);if(babelHelpers.classPrivateFieldGet(this,Le)){babelHelpers.classPrivateFieldGet(this,Le).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,_e))}if(!t){babelHelpers.classPrivateFieldGet(this,lt).reset()}},get:function e(){return babelHelpers.classPrivateFieldGet(this,_e)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,$e)}}]);return t}(n.EventEmitter);var zt=function e(t){t=t.trim();if(t.length<=0){return["",""]}var s=t.lastIndexOf(" ");if(s<=0){return["",""]}return[t.slice(0,s),t.slice(s+1)]};var _t={writable:true,value:"onAddressChanged"};var Lt={writable:true,value:"onStateChanged"};var Ot={writable:true,value:"onSearchStarted"};var Nt={writable:true,value:"onSearchCompleted"};var Dt={writable:true,value:"onShowOnMapClicked"};var Bt=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Le).value;if(s.length===0){ze(this,nt,Rt).call(this)}};var Rt=function e(){var t=babelHelpers.classPrivateFieldGet(this,Xe).call(this);babelHelpers.classPrivateFieldGet(this,xe).setMenuItems(t,"");var s;if(t.length>0){s=d.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP")}else{s=d.Loc.getMessage("LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP")}ze(this,ot,Ut).call(this,s,null)};var Xt=function e(t){var s=d.Tag.render(We(),d.Loc.getMessage("LOCATION_WIDGET_SHOW_ON_MAP"));s.addEventListener("click",ze(this,Ft,Zt).call(this,t));return s};var xt=function e(t){return d.Tag.render(Ce(),t)};var Ut=function e(t,s){babelHelpers.classPrivateFieldGet(this,xe).getMenu().setBottomRightItemNode(ze(this,dt,Xt).call(this,s));babelHelpers.classPrivateFieldGet(this,xe).getMenu().setBottomLeftItemNode(ze(this,bt,xt).call(this,t));babelHelpers.classPrivateFieldGet(this,xe).getMenu().show()};var Vt=function e(t){if(babelHelpers.classPrivateFieldGet(this,Ze)){return}if(babelHelpers.classPrivateFieldGet(this,$e)===b.DATA_INPUTTING&&!(t.relatedTarget&&t.relatedTarget.getAttribute("data-role")==="location-widget-menu-item")){ze(this,mt,es).call(this,b.DATA_SUPPOSED);if(babelHelpers.classPrivateFieldGet(this,Le)){if(!babelHelpers.classPrivateFieldGet(this,_e)||!babelHelpers.classPrivateFieldGet(this,Le).hasPureAddressString()){babelHelpers.classPrivateFieldSet(this,_e,ze(this,It,is).call(this,babelHelpers.classPrivateFieldGet(this,Le).value))}else if(babelHelpers.classPrivateFieldGet(this,Le).customTail!==""){babelHelpers.classPrivateFieldGet(this,_e).setFieldValue(babelHelpers.classPrivateFieldGet(this,Ne).fieldForUnRecognized,babelHelpers.classPrivateFieldGet(this,Le).customTail)}}ze(this,Tt,ss).call(this)}if(babelHelpers.classPrivateFieldGet(this,xe)){babelHelpers.classPrivateFieldGet(this,xe).close()}t.stopImmediatePropagation()};var Yt=function e(){if(babelHelpers.classPrivateFieldGet(this,Ze)){return}if(babelHelpers.classPrivateFieldGet(this,_e)&&(!babelHelpers.classPrivateFieldGet(this,_e).location||!babelHelpers.classPrivateFieldGet(this,_e).location.hasExternalRelation())&&babelHelpers.classPrivateFieldGet(this,Le).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Le).value)}};var jt=function e(){var t=ze(this,Wt,cs).call(this);var s=new l.AutocompleteServiceFilter;if(!t){return s}var a=null;if(t.type===l.LocationType.COUNTRY){a=l.LocationType.LOCALITY}else if(t.type===l.LocationType.LOCALITY){a=l.LocationType.STREET}else if(t.type===l.LocationType.STREET){a=l.LocationType.BUILDING}if(a){s.types=[a]}return s};var Jt=function e(){var t=null;var s={};var a=ze(this,Wt,cs).call(this);if(a){t=a}else if(babelHelpers.classPrivateFieldGet(this,Re)){t=babelHelpers.classPrivateFieldGet(this,Re)}s.filter=babelHelpers.classPrivateFieldGet(this,lt);s.locationForBias=t;return s};var Kt=function e(t){if(babelHelpers.classPrivateFieldGet(this,Ze)){return}if(t.target===babelHelpers.classPrivateFieldGet(this,Ke)){return}if(babelHelpers.classPrivateFieldGet(this,xe).isShown()){babelHelpers.classPrivateFieldGet(this,xe).close()}};var qt=function e(t,s){var a=this;if(Array.isArray(t)&&t.length>0){if(t.length===1&&babelHelpers.classPrivateFieldGet(this,_e)&&babelHelpers.classPrivateFieldGet(this,_e).location&&babelHelpers.classPrivateFieldGet(this,_e).location.externalId&&babelHelpers.classPrivateFieldGet(this,_e).location.externalId===t[0].externalId){this.closePrompt();return}babelHelpers.classPrivateFieldGet(this,xe).setMenuItems(t,babelHelpers.classPrivateFieldGet(this,qe).requested,ze(this,Ht,$t).call(this));ze(this,ot,Ut).call(this,d.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP"),t[0])}else{var i=Ae(Mt,Mt,zt).call(Mt,babelHelpers.classPrivateFieldGet(this,qe).current);babelHelpers.classPrivateFieldGet(this,qe).current=i[0];babelHelpers.classPrivateFieldGet(this,qe).dropped="".concat(i[1]," ").concat(babelHelpers.classPrivateFieldGet(this,qe).dropped);if(babelHelpers.classPrivateFieldGet(this,qe).current.length>0){ze(this,Et,bs).call(this,babelHelpers.classPrivateFieldGet(this,qe).current,s,1)}else{babelHelpers.classPrivateFieldGet(this,xe).getMenu().clearItems();babelHelpers.classPrivateFieldGet(this,xe).getMenu().addMenuItem({id:"notFound",html:"<span>".concat(d.Loc.getMessage("LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND"),"</span>"),onclick:function e(t,s){babelHelpers.classPrivateFieldGet(a,xe).close()}});ze(this,ot,Ut).call(this,d.Loc.getMessage("LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP"),null)}}};var $t=function e(){if(this.address&&this.address.getFieldValue(l.AddressType.LOCALITY)){return this.address}var t=ze(this,Wt,cs).call(this);if(t&&t.address&&t.address.getFieldValue(l.AddressType.LOCALITY)){return t.address}return null};var Zt=function e(t){var s=this;return function(){if(t&&babelHelpers.classPrivateFieldGet(s,Re)&&t.latitude&&t.longitude&&babelHelpers.classPrivateFieldGet(s,Re).latitude&&babelHelpers.classPrivateFieldGet(s,Re).longitude){var e=l.DistanceCalculator.getDistanceFromLatLonInKm(t.latitude,t.longitude,babelHelpers.classPrivateFieldGet(s,Re).latitude,babelHelpers.classPrivateFieldGet(s,Re).longitude);if(e<=babelHelpers.classPrivateFieldGet(s,st)){ze(s,gt,ts).call(s,t);return}}setTimeout(function(){s.emit(Me(Mt,Mt,Dt))},1)}};var Qt=function e(t){if(t.data.location){ze(this,gt,ts).call(this,t.data.location)}};var es=function e(t){babelHelpers.classPrivateFieldSet(this,$e,t);this.emit(Me(Mt,Mt,Lt),{state:babelHelpers.classPrivateFieldGet(this,$e)})};var ts=function e(t){var s=this;var a;ze(this,mt,es).call(this,b.DATA_SELECTED);if(t){if(t.hasExternalRelation()&&babelHelpers.classPrivateFieldGet(this,De)===t.sourceCode){a=ze(this,wt,as).call(this,t).then(function(e){if(t.address&&t.address.getFieldValue(l.AddressType.ADDRESS_LINE_2)){e.address.setFieldValue(l.AddressType.ADDRESS_LINE_2,t.address.getFieldValue(l.AddressType.ADDRESS_LINE_2))}ze(s,St,ns).call(s,e,0);return true},function(e){return l.ErrorPublisher.getInstance().notify(e.errors)})}else{a=new Promise(function(e){setTimeout(function(){ze(s,St,ns).call(s,t,0);e()},0)})}}else{a=new Promise(function(e){setTimeout(function(){ze(s,St,ns).call(s,null,0);e()},0)})}return a};var ss=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.emit(Me(Mt,Mt,_t),{address:babelHelpers.classPrivateFieldGet(this,_e),excludeSetAddressFeatures:t})};var as=function e(t){var s=this;ze(this,mt,es).call(this,b.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,Be).findByExternalId(t.externalId,t.sourceCode,t.languageId).then(function(e){ze(s,mt,es).call(s,b.DATA_LOADED);var a;if(e.latitude!=="0"&&e.longitude!=="0"&&e!==""){a=e;a.name=t.name}else{a=t}return a},function(e){l.ErrorPublisher.getInstance().notify(e.errors)})};var is=function e(t){var s=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,Oe)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,Ne).fieldForUnRecognized,t);return s};var ls=function e(t){if(t){ze(this,At,us).call(this,t)}babelHelpers.classPrivateFieldSet(this,lt,ze(this,pt,jt).call(this));babelHelpers.classPrivateFieldSet(this,_e,t?t.toAddress():null);babelHelpers.classPrivateFieldGet(this,Le).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,_e));ze(this,Tt,ss).call(this)};var rs=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,Ze)){return}var a=Date.now();if(babelHelpers.classPrivateFieldGet(this,Qe)){var i=a-babelHelpers.classPrivateFieldGet(this,Qe);babelHelpers.classPrivateFieldSet(this,et,(babelHelpers.classPrivateFieldGet(this,et)+i)/2)}babelHelpers.classPrivateFieldSet(this,Qe,a);if(babelHelpers.classPrivateFieldGet(this,$e)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(this,Le).isChanged()){ze(this,mt,es).call(this,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,xe).isShown()){var l;var r=700;switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,xe).isItemChosen()){ze(this,gt,ts).call(this,babelHelpers.classPrivateFieldGet(this,xe).getChosenItem()).then(function(){babelHelpers.classPrivateFieldGet(s,xe).close()},function(e){return BX.debug(e)})}return;case"Tab":case"Escape":ze(this,mt,es).call(this,b.DATA_SUPPOSED);ze(this,Tt,ss).call(this);babelHelpers.classPrivateFieldGet(this,xe).close();return;case"ArrowUp":l=babelHelpers.classPrivateFieldGet(this,xe).choosePrevItem();if(l&&l.address){ze(this,St,ns).call(this,l,r)}return;case"ArrowDown":l=babelHelpers.classPrivateFieldGet(this,xe).chooseNextItem();if(l&&l.address){ze(this,St,ns).call(this,l,r)}return;case"Backspace":case"Delete":babelHelpers.classPrivateFieldGet(this,lt).reset();break}}if(babelHelpers.classPrivateFieldGet(this,Le).isChanged()){babelHelpers.classPrivateFieldGet(this,Le).actualize();this.showPrompt(babelHelpers.classPrivateFieldGet(this,Le).value)}if(babelHelpers.classPrivateFieldGet(this,Le).value.length===0){ze(this,nt,Rt).call(this)}};var ns=function e(t,s){var a=this;if(babelHelpers.classPrivateFieldGet(this,at)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,at))}babelHelpers.classPrivateFieldSet(this,at,setTimeout(function(){ze(a,yt,ls).call(a,t)},s))};var ds=function e(){var t=babelHelpers.classPrivateFieldGet(this,Ye)>babelHelpers.classPrivateFieldGet(this,et)?babelHelpers.classPrivateFieldGet(this,Ye):babelHelpers.classPrivateFieldGet(this,et)*1.5;return t>babelHelpers.classPrivateFieldGet(this,je)?babelHelpers.classPrivateFieldGet(this,je):t};var bs=function e(t,s){if(t.length<=babelHelpers.classPrivateFieldGet(this,Ve)){s*=2}if(babelHelpers.classPrivateFieldGet(this,Je)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,Je))}babelHelpers.classPrivateFieldSet(this,Je,ze(this,Ct,os).call(this,t,s))};var os=function e(t,s){var a=this;return setTimeout(function(){if(babelHelpers.classPrivateFieldGet(a,tt)){clearTimeout(babelHelpers.classPrivateFieldGet(a,Je));babelHelpers.classPrivateFieldSet(a,Je,ze(a,Ct,e).call(a,t,s));return}a.emit(Me(Mt,Mt,Ot));babelHelpers.classPrivateFieldSet(a,tt,true);var i=ze(a,vt,Jt).call(a);babelHelpers.classPrivateFieldGet(a,Ue).autocomplete(t,i).then(function(e){babelHelpers.classPrivateFieldSet(a,Je,null);ze(a,ft,qt).call(a,e,i);a.emit(Me(Mt,Mt,Nt));babelHelpers.classPrivateFieldSet(a,tt,false)},function(e){a.emit(Me(Mt,Mt,Nt));babelHelpers.classPrivateFieldSet(a,tt,false);BX.debug(e)})},s)};var cs=function e(){var t=localStorage.getItem(babelHelpers.classPrivateFieldGet(this,it));if(t){try{return l.LocationJsonConverter.convertJsonToLocation(JSON.parse(t))}catch(e){}}return null};var us=function e(t){var s=t.toJson();localStorage.setItem(babelHelpers.classPrivateFieldGet(this,it),s);BX.userOptions.save("location","last_selected_location",null,s)};function ps(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);ps=function t(){return e};return e}function vs(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);vs=function t(){return e};return e}function hs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var fs=new WeakMap;var Hs=new WeakMap;var Fs=new WeakMap;var Ps=new WeakMap;var ms=new WeakSet;var gs=function(){function e(t){babelHelpers.classCallCheck(this,e);ms.add(this);fs.set(this,{writable:true,value:void 0});Hs.set(this,{writable:true,value:void 0});Fs.set(this,{writable:true,value:void 0});Ps.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof l.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,Ps,t.addressFormat)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,fs,t.address);var s=hs(this,ms,Ts).call(this,babelHelpers.classPrivateFieldGet(this,fs));babelHelpers.classPrivateFieldSet(this,Fs,d.Tag.render(vs(),s));babelHelpers.classPrivateFieldSet(this,Hs,d.Tag.render(ps(),babelHelpers.classPrivateFieldGet(this,Fs)));if(s===""){this.hide()}return babelHelpers.classPrivateFieldGet(this,Hs)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Hs)){babelHelpers.classPrivateFieldGet(this,Hs).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Hs)){babelHelpers.classPrivateFieldGet(this,Hs).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,Hs)||babelHelpers.classPrivateFieldGet(this,Hs).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,fs,t);if(!babelHelpers.classPrivateFieldGet(this,Fs)){return}babelHelpers.classPrivateFieldGet(this,Fs).innerHTML=hs(this,ms,Ts).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var Ts=function e(t){var s="";if(t){s=l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,Ps).getTemplate(l.FormatTemplateType.DEFAULT),l.AddressStringConverter.CONTENT_TYPE_HTML,", ",babelHelpers.classPrivateFieldGet(this,Ps))}return s};function ws(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Is=new WeakSet;var ys=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Is.add(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){var a,i;if(this.bindOptions.position&&this.bindOptions.position==="right"){a=true;i=ws(this,Is,Gs).call(this)}if(!(a&&i)){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}}]);return t}(a.Popup);var Gs=function e(){var t=this.bindElement.getBoundingClientRect();var s=this.getPopupContainer().offsetHeight;var a=this.getPopupContainer().offsetWidth;if(t.left+t.width+a>document.documentElement.clientWidth){return false}var i=s/2;var l=t.left+t.width+10;var r=window.pageYOffset+t.top+t.height/2-s/2;if(r<window.pageYOffset){i-=window.pageYOffset-r;r=window.pageYOffset}else if(r>window.pageYOffset+document.body.clientHeight-s){i+=r-(window.pageYOffset+document.body.clientHeight-s);r=window.pageYOffset+document.body.clientHeight-s}this.setAngle({position:"left",offset:i});d.Dom.adjust(this.popupContainer,{style:{top:"".concat(r,"px"),left:"".concat(l,"px"),zIndex:this.getZindex()}});return true};function Ss(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\n\t\t\t<div class="location-map-address-changed hidden">\n\t\t\t\t<div class="location-map-address-changed-inner">\n\t\t\t\t\t<div class="location-map-address-changed-title">\n\t\t\t\t\t\t',":\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>"]);Ss=function t(){return e};return e}function ks(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button type="button" class="location-map-address-changed-btn">\n\t\t\t\t',"\n\t\t\t</button>"]);ks=function t(){return e};return e}function Es(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-changed-text">\n\t\t\t\t',"\n\t\t\t</div>"]);Es=function t(){return e};return e}function Cs(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Ws(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var As=new WeakMap;var Ms=new WeakMap;var zs=new WeakMap;var _s=new WeakMap;var Ls=new WeakMap;var Os=new WeakSet;var Ns=new WeakSet;var Ds=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ns.add(babelHelpers.assertThisInitialized(s));Os.add(babelHelpers.assertThisInitialized(s));As.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ms.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});zs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_s.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ls.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup.AddressRestorer");if(!(e.addressFormat instanceof l.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),As,e.addressFormat);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){this.address=t.address;babelHelpers.classPrivateFieldSet(this,_s,d.Tag.render(Es(),Ws(this,Ns,Xs).call(this,babelHelpers.classPrivateFieldGet(this,Ms))));babelHelpers.classPrivateFieldSet(this,Ls,d.Tag.render(ks(),BX.message("LOCATION_WIDGET_AUI_ADDRESS_RESTORE")));babelHelpers.classPrivateFieldGet(this,Ls).addEventListener("click",Ws(this,Os,Rs).bind(this));babelHelpers.classPrivateFieldSet(this,zs,d.Tag.render(Ss(),BX.message("LOCATION_WIDGET_AUI_ADDRESS_CHANGED"),babelHelpers.classPrivateFieldGet(this,_s),babelHelpers.classPrivateFieldGet(this,Ls)));babelHelpers.classPrivateFieldGet(this,zs).style.display="none";return babelHelpers.classPrivateFieldGet(this,zs)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,zs)&&babelHelpers.classPrivateFieldGet(this,Ms)&&this.isHidden()){babelHelpers.classPrivateFieldGet(this,zs).style.display="flex";babelHelpers.classPrivateFieldGet(this,zs).classList.remove("hidden")}}},{key:"hide",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,zs)&&!this.isHidden()){babelHelpers.classPrivateFieldGet(this,zs).classList.add("hidden");setTimeout(function(){babelHelpers.classPrivateFieldGet(t,zs).style.display="none"},600)}}},{key:"isHidden",value:function e(){var t=false;if(babelHelpers.classPrivateFieldGet(this,zs)){t=babelHelpers.classPrivateFieldGet(this,zs).classList.contains("hidden")}return t}},{key:"onRestoreEventSubscribe",value:function e(s){this.subscribe(Cs(t,t,Bs),s)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ms,t);if(!babelHelpers.classPrivateFieldGet(this,_s)||!babelHelpers.classPrivateFieldGet(this,Ms)){return}babelHelpers.classPrivateFieldGet(this,_s).innerHTML=Ws(this,Ns,Xs).call(this,babelHelpers.classPrivateFieldGet(this,Ms))}}]);return t}(n.EventEmitter);var Bs={writable:true,value:"onRestore"};var Rs=function e(t){this.emit(Cs(Ds,Ds,Bs),{address:babelHelpers.classPrivateFieldGet(this,Ms)})};var Xs=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,As),l.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA)};function xs(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);xs=function t(){return e};return e}function Us(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);Us=function t(){return e};return e}function Vs(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Ys(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var js=new WeakMap;var Js=new WeakMap;var Ks=new WeakMap;var qs=new WeakMap;var $s=new WeakMap;var Zs=new WeakMap;var Qs=new WeakMap;var ea=new WeakMap;var ta=new WeakMap;var sa=new WeakMap;var aa=new WeakMap;var ia=new WeakMap;var la=new WeakMap;var ra=new WeakMap;var na=new WeakMap;var da=new WeakSet;var ba=new WeakSet;var oa=new WeakSet;var ca=new WeakSet;var ua=new WeakSet;var pa=new WeakSet;var va=new WeakSet;var ha=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));va.add(babelHelpers.assertThisInitialized(s));pa.add(babelHelpers.assertThisInitialized(s));ua.add(babelHelpers.assertThisInitialized(s));ca.add(babelHelpers.assertThisInitialized(s));oa.add(babelHelpers.assertThisInitialized(s));ba.add(babelHelpers.assertThisInitialized(s));da.add(babelHelpers.assertThisInitialized(s));js.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Js.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ks.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$s.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Zs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Qs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ea.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ta.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});sa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});aa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ia.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});la.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ra.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});na.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof l.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),js,e.map);if(e.geocodingService instanceof l.GeocodingServiceBase){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ia,e.geocodingService)}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),js).onLocationChangedEventSubscribe(Ys(babelHelpers.assertThisInitialized(s),da,ga).bind(babelHelpers.assertThisInitialized(s)));if(!(e.popup instanceof ys)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),qs,e.popup);if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Qs,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),$s,new gs({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qs)}));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Zs,new Ds({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qs)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zs).onRestoreEventSubscribe(Ys(babelHelpers.assertThisInitialized(s),ba,Ta).bind(babelHelpers.assertThisInitialized(s)));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ea,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ta,e.locationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),na,e.userLocation);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ks,t.address);babelHelpers.classPrivateFieldSet(this,ra,true);babelHelpers.classPrivateFieldSet(this,Js,t.mode);babelHelpers.classPrivateFieldSet(this,sa,false);babelHelpers.classPrivateFieldSet(this,aa,d.Tag.render(Us()));Ys(this,oa,wa).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,aa))}},{key:"show",value:function e(){var s=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;Ys(this,ua,ya).call(this,babelHelpers.classPrivateFieldGet(this,Ks),a).then(function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,qs).show();if(!babelHelpers.classPrivateFieldGet(s,sa)){Ys(s,va,Sa).call(s,{location:e}).then(function(){if(babelHelpers.classPrivateFieldGet(s,ea)){babelHelpers.classPrivateFieldGet(s,ea).location=e}s.emit(Vs(t,t,Pa));babelHelpers.classPrivateFieldGet(s,js).onMapShow()});babelHelpers.classPrivateFieldSet(s,sa,true)}else{babelHelpers.classPrivateFieldGet(s,js).location=e;if(babelHelpers.classPrivateFieldGet(s,ea)){babelHelpers.classPrivateFieldGet(s,ea).location=e}s.emit(Vs(t,t,Pa));babelHelpers.classPrivateFieldGet(s,js).onMapShow()}})}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,qs).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,qs).close();babelHelpers.classPrivateFieldSet(this,ra,false);if(!babelHelpers.classPrivateFieldGet(this,Zs).isHidden()){babelHelpers.classPrivateFieldGet(this,Zs).hide()}this.emit(Vs(t,t,ma))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(Vs(t,t,fa),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(Vs(t,t,Ha),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(Vs(t,t,Fa),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(Vs(t,t,Pa),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(Vs(t,t,ma),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,js,null);babelHelpers.classPrivateFieldSet(this,ea,null);babelHelpers.classPrivateFieldSet(this,$s,null);babelHelpers.classPrivateFieldSet(this,Zs,null);babelHelpers.classPrivateFieldGet(this,qs).destroy();babelHelpers.classPrivateFieldSet(this,qs,null);d.Dom.remove(babelHelpers.classPrivateFieldGet(this,la));babelHelpers.classPrivateFieldSet(this,la,null);d.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,qs).getBindElement()},set:function e(t){if(d.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,qs).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,Ks,t);babelHelpers.classPrivateFieldSet(this,ra,true);babelHelpers.classPrivateFieldGet(this,$s).address=t;babelHelpers.classPrivateFieldGet(this,Zs).address=t;Ys(this,ua,ya).call(this,t).then(function(e){Ys(s,pa,Ga).call(s,e)})}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,Js,t);babelHelpers.classPrivateFieldGet(this,js).mode=t}}]);return t}(n.EventEmitter);var fa={writable:true,value:"onChanged"};var Ha={writable:true,value:"onMouseOver"};var Fa={writable:true,value:"onMouseOut"};var Pa={writable:true,value:"onShow"};var ma={writable:true,value:"onClose"};var ga=function e(t){var s=t.getData();var a=s.location;var i=a.toAddress();babelHelpers.classPrivateFieldSet(this,Ks,i);babelHelpers.classPrivateFieldGet(this,$s).address=i;if(babelHelpers.classPrivateFieldGet(this,ra)){if(babelHelpers.classPrivateFieldGet(this,Zs).isHidden()){babelHelpers.classPrivateFieldGet(this,Zs).show()}}if(babelHelpers.classPrivateFieldGet(this,ea)){babelHelpers.classPrivateFieldGet(this,ea).location=a}this.emit(Vs(ha,ha,fa),{address:i})};var Ta=function e(t){var s=t.getData();var a=s.address;a.latitude=babelHelpers.classPrivateFieldGet(this,Ks).latitude;a.longitude=babelHelpers.classPrivateFieldGet(this,Ks).longitude;babelHelpers.classPrivateFieldSet(this,Ks,a);babelHelpers.classPrivateFieldGet(this,$s).address=a;babelHelpers.classPrivateFieldGet(this,Zs).hide();this.emit(Vs(ha,ha,fa),{address:a})};var wa=function e(t,s){var a=this;var i="";if(babelHelpers.classPrivateFieldGet(this,ea)){i=babelHelpers.classPrivateFieldGet(this,ea).render()}babelHelpers.classPrivateFieldSet(this,la,d.Tag.render(xs(),s,i,babelHelpers.classPrivateFieldGet(this,Js)===l.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,$s).render({address:babelHelpers.classPrivateFieldGet(this,Ks)}):"",babelHelpers.classPrivateFieldGet(this,Js)===l.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,Zs).render({address:babelHelpers.classPrivateFieldGet(this,Ks)}):""));d.Event.bind(babelHelpers.classPrivateFieldGet(this,la),"click",function(e){return e.stopPropagation()});d.Event.bind(babelHelpers.classPrivateFieldGet(this,la),"mouseover",function(e){return a.emit(Vs(ha,ha,Ha),e)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,la),"mouseout",function(e){return a.emit(Vs(ha,ha,Fa),e)});this.bindElement=t;babelHelpers.classPrivateFieldGet(this,qs).setContent(babelHelpers.classPrivateFieldGet(this,la))};var Ia=function e(t){var s=null;var a;var i;if(t.latitude&&t.longitude){a=t.latitude;i=t.longitude}else if(t.location&&t.location.latitude&&t.location.longitude){a=t.location.latitude;i=t.location.longitude}if(a&&a!=="0"&&i&&i!=="0"){s=[a,i]}return s};var ya=function e(t){var s=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise(function(e){var i=null;if(a){i=babelHelpers.classPrivateFieldGet(s,na)&&babelHelpers.classPrivateFieldGet(s,Js)!==l.ControlMode.view?babelHelpers.classPrivateFieldGet(s,na):null}if(t){var r=Ys(s,ca,Ia).call(s,t);if(r){e(new l.Location({latitude:r[0],longitude:r[1],type:t.getType()}));return}if(babelHelpers.classPrivateFieldGet(s,ia)){var n=t.toString(babelHelpers.classPrivateFieldGet(s,Qs),l.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,l.AddressStringConverter.CONTENT_TYPE_TEXT);babelHelpers.classPrivateFieldGet(s,ia).geocode(n).then(function(t){if(Array.isArray(t)&&t.length===1){i=t[0]}e(i)});return}}e(i)})};var Ga=function e(t){babelHelpers.classPrivateFieldGet(this,js).location=t;if(babelHelpers.classPrivateFieldGet(this,ea)){babelHelpers.classPrivateFieldGet(this,ea).location=t}};var Sa=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,js).render({mapContainer:babelHelpers.classPrivateFieldGet(this,aa),location:s,mode:babelHelpers.classPrivateFieldGet(this,Js)})};function ka(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);ka=function t(){return e};return e}function Ea(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);Ea=function t(){return e};return e}var Ca=new WeakMap;var Wa=new WeakMap;var Aa=new WeakMap;var Ma=new WeakMap;var za=new WeakMap;var _a=function(){function e(t){babelHelpers.classCallCheck(this,e);Ca.set(this,{writable:true,value:void 0});Wa.set(this,{writable:true,value:void 0});Aa.set(this,{writable:true,value:void 0});Ma.set(this,{writable:true,value:void 0});za.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Wa,t.url);babelHelpers.classPrivateFieldSet(this,Aa,t.link||"");babelHelpers.classPrivateFieldSet(this,Ca,t.description||"");babelHelpers.classPrivateFieldSet(this,Ma,t.location);babelHelpers.classPrivateFieldSet(this,za,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,Ca)){t=d.Tag.render(Ea(),babelHelpers.classPrivateFieldGet(this,Ca))}return d.Tag.render(ka(),t,babelHelpers.classPrivateFieldGet(this,Aa),babelHelpers.classPrivateFieldGet(this,za),babelHelpers.classPrivateFieldGet(this,Ma).externalId,babelHelpers.classPrivateFieldGet(this,Wa))}}]);return e}();function La(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=Oa(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function Oa(e,t){if(!e)return;if(typeof e==="string")return Na(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Na(e,t)}function Na(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Da(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);Da=function t(){return e};return e}function Ba(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);Ba=function t(){return e};return e}function Ra(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Xa=new WeakMap;var xa=new WeakMap;var Ua=new WeakMap;var Va=new WeakMap;var Ya=new WeakMap;var ja=new WeakMap;var Ja=new WeakMap;var Ka=new WeakMap;var qa=new WeakSet;var $a=new WeakSet;var Za=function(){function e(t){babelHelpers.classCallCheck(this,e);$a.add(this);qa.add(this);Xa.set(this,{writable:true,value:[]});xa.set(this,{writable:true,value:null});Ua.set(this,{writable:true,value:null});Va.set(this,{writable:true,value:void 0});Ya.set(this,{writable:true,value:void 0});ja.set(this,{writable:true,value:void 0});Ja.set(this,{writable:true,value:void 0});Ka.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Va,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,Ya,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,Ja,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,ja,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Ka)){babelHelpers.classPrivateFieldGet(this,ja).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,Ka),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,Va),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,Ya),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,Ja)}).then(function(e){if(Array.isArray(e)&&e.length>0){Ra(t,qa,Qa).call(t,e);t.show()}else{t.hide()}})}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,xa)){babelHelpers.classPrivateFieldGet(this,xa).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,xa)||babelHelpers.classPrivateFieldGet(this,xa).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,xa)){babelHelpers.classPrivateFieldGet(this,xa).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,Ua,d.Tag.render(Ba()));babelHelpers.classPrivateFieldSet(this,xa,d.Tag.render(Da(),babelHelpers.classPrivateFieldGet(this,Ua)));return babelHelpers.classPrivateFieldGet(this,xa)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ka,t);this.refresh()}}]);return e}();var Qa=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ka)){return}var s=[];var a=La(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new _a({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,Ka),title:babelHelpers.classPrivateFieldGet(this,Ka).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,Xa,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,Xa).push(d)}if(babelHelpers.classPrivateFieldGet(this,Xa).length>0&&babelHelpers.classPrivateFieldGet(this,Ua)){var b=babelHelpers.classPrivateFieldGet(this,Xa)?Ra(this,$a,ei).call(this,babelHelpers.classPrivateFieldGet(this,Xa)):"";babelHelpers.classPrivateFieldGet(this,Ua).innerHTML="";if(b.length>0){var o=La(b),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,Ua).appendChild(u)}}catch(e){o.e(e)}finally{o.f()}}}};var ei=function e(t){var s=[];var a=La(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function ti(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);ti=function t(){return e};return e}function si(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);si=function t(){return e};return e}function ai(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);ai=function t(){return e};return e}function ii(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);ii=function t(){return e};return e}function li(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function ri(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var ni=new WeakMap;var di=new WeakMap;var bi=new WeakMap;var oi=new WeakMap;var ci=new WeakMap;var ui=new WeakMap;var pi=new WeakMap;var vi=new WeakMap;var hi=new WeakMap;var fi=new WeakSet;var Hi=new WeakSet;var Fi=new WeakSet;var Pi=new WeakSet;var mi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Pi.add(babelHelpers.assertThisInitialized(s));Fi.add(babelHelpers.assertThisInitialized(s));Hi.add(babelHelpers.assertThisInitialized(s));fi.add(babelHelpers.assertThisInitialized(s));ni.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});di.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});bi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});oi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ci.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ui.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});pi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});vi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});hi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:b.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ni,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),bi,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),oi,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,di,typeof t.value==="string"?t.value:"");if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,ci,t.mode);babelHelpers.classPrivateFieldSet(this,vi,d.Tag.render(ii(),babelHelpers.classPrivateFieldGet(this,ni)));if(babelHelpers.classPrivateFieldGet(this,ci)===l.ControlMode.edit){li(this,Hi,Ii).call(this,babelHelpers.classPrivateFieldGet(this,vi))}else{li(this,Fi,yi).call(this,babelHelpers.classPrivateFieldGet(this,vi))}return babelHelpers.classPrivateFieldGet(this,vi)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe(ri(t,t,gi),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(ri(t,t,Ti),s)}},{key:"destroy",value:function e(){d.Dom.remove(babelHelpers.classPrivateFieldGet(this,vi));d.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,vi,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,vi)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,hi)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,bi,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,bi)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,oi,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,oi)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,di,typeof t==="string"?t:"");li(this,Pi,Gi).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,di)}}]);return t}(n.EventEmitter);var gi={writable:true,value:"onValueChanged"};var Ti={writable:true,value:"onStateChanged"};var wi=function e(t){babelHelpers.classPrivateFieldSet(this,hi,t);this.emit(ri(mi,mi,Ti),{state:babelHelpers.classPrivateFieldGet(this,hi)})};var Ii=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,ui,d.Tag.render(ai(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,di))));babelHelpers.classPrivateFieldSet(this,pi,null);d.Event.bind(babelHelpers.classPrivateFieldGet(this,ui),"focus",function(e){li(s,fi,wi).call(s,b.DATA_INPUTTING)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,ui),"focusout",function(e){li(s,fi,wi).call(s,b.DATA_SELECTED)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,ui),"change",function(e){li(s,fi,wi).call(s,b.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,di,babelHelpers.classPrivateFieldGet(s,ui).value);s.emit(ri(mi,mi,gi),{value:s})});t.appendChild(d.Tag.render(si(),babelHelpers.classPrivateFieldGet(this,ui)))};var yi=function e(t){babelHelpers.classPrivateFieldSet(this,ui,null);babelHelpers.classPrivateFieldSet(this,pi,d.Tag.render(ti(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,di))));t.appendChild(babelHelpers.classPrivateFieldGet(this,pi))};var Gi=function e(){if(babelHelpers.classPrivateFieldGet(this,ci)===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,ui).value=babelHelpers.classPrivateFieldGet(this,di)}else{babelHelpers.classPrivateFieldGet(this,pi).innerHTML=d.Text.encode(babelHelpers.classPrivateFieldGet(this,di))}};function Si(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=ki(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function ki(e,t){if(!e)return;if(typeof e==="string")return Ei(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ei(e,t)}function Ei(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Ci(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Wi(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ai=new WeakMap;var Mi=new WeakMap;var zi=new WeakMap;var _i=new WeakMap;var Li=new WeakMap;var Oi=new WeakMap;var Ni=new WeakMap;var Di=new WeakSet;var Bi=new WeakSet;var Ri=new WeakSet;var Xi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ri.add(babelHelpers.assertThisInitialized(s));Bi.add(babelHelpers.assertThisInitialized(s));Di.add(babelHelpers.assertThisInitialized(s));Ai.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Mi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});zi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_i.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});Li.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Oi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ni.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Mi,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Li,e.languageId);Wi(babelHelpers.assertThisInitialized(s),Di,Vi).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof l.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Ai,t.address);if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,zi,t.mode);if(!d.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,Oi,t.container);var s=Si(babelHelpers.classPrivateFieldGet(this,_i)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;var r=babelHelpers.classPrivateFieldGet(this,Ai)?babelHelpers.classPrivateFieldGet(this,Ai).getFieldValue(i.type):"";if(babelHelpers.classPrivateFieldGet(this,zi)===l.ControlMode.view&&!r){continue}var n=i.render({value:r,mode:babelHelpers.classPrivateFieldGet(this,zi)});babelHelpers.classPrivateFieldGet(this,Oi).appendChild(n)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(Ci(t,t,xi),s)}},{key:"destroy",value:function e(){d.Event.unbindAll(this);var t=Si(babelHelpers.classPrivateFieldGet(this,_i)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}d.Dom.clean(babelHelpers.classPrivateFieldGet(this,Oi))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(Ci(t,t,Ui),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Ai,t);var s=Si(babelHelpers.classPrivateFieldGet(this,_i)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;i.value=babelHelpers.classPrivateFieldGet(this,Ai)?babelHelpers.classPrivateFieldGet(this,Ai).getFieldValue(i.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ni)}}]);return t}(n.EventEmitter);var xi={writable:true,value:"onAddressChanged"};var Ui={writable:true,value:"onStateChanged"};var Vi=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,Mi).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,Mi).fieldCollection.fields[s];var i=new mi({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent(function(e){Wi(t,Bi,Yi).call(t,i)});i.subscribeOnStateChangedEvent(function(e){var s=e.getData();Wi(t,Ri,ji).call(t,s.state)});babelHelpers.classPrivateFieldGet(t,_i).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,Mi).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,_i).sort(function(e,t){return e.sort-t.sort})};var Yi=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ai)){babelHelpers.classPrivateFieldSet(this,Ai,new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,Li)}))}babelHelpers.classPrivateFieldGet(this,Ai).setFieldValue(t.type,t.value);if(t.type!==babelHelpers.classPrivateFieldGet(this,Mi).fieldForUnRecognized){babelHelpers.classPrivateFieldGet(this,Ai).location=null;babelHelpers.classPrivateFieldGet(this,Ai).latitude="";babelHelpers.classPrivateFieldGet(this,Ai).longitude=""}this.emit(Ci(Xi,Xi,xi),{address:babelHelpers.classPrivateFieldGet(this,Ai),changedField:t})};var ji=function e(t){babelHelpers.classPrivateFieldSet(this,Ni,t);this.emit(Ci(Xi,Xi,Ui),{state:babelHelpers.classPrivateFieldGet(this,Ni)})};var Ji=new WeakMap;var Ki=new WeakMap;var qi=new WeakMap;var $i=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ji.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ki.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});qi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof ha)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ji,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ji).onChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),qi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!babelHelpers.classPrivateFieldGet(this,Ji).isShown()){babelHelpers.classPrivateFieldGet(this,Ji).show(t)}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ji).isShown()){babelHelpers.classPrivateFieldGet(this,Ji).close()}babelHelpers.classPrivateFieldGet(this,Ji).bindelement=babelHelpers.classPrivateFieldGet(this,Ki)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Ki,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,Ji).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,qi).address,mode:babelHelpers.classPrivateFieldGet(this,qi).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,Ji).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,qi,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ji).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ji).destroy();babelHelpers.classPrivateFieldSet(this,Ji,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ji)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,qi)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ki)}}]);return t}(o);var Zi=new WeakMap;var Qi=new WeakMap;var el=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Zi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Qi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof Mt)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Zi,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zi).onAddressChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s),t.excludeSetAddressFeatures)});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zi).onStateChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qi).setStateByFeature(t.state)});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zi).onSearchStartedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchStartedEvent,payload:a})});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zi).onSearchCompletedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchCompletedEvent,payload:a})});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Zi).onShowOnMapClickedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Qi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.showOnMapClickedEvent,payload:a})});return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Zi).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Qi).mode===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Zi).render({inputNode:babelHelpers.classPrivateFieldGet(this,Qi).inputNode,menuNode:t.autocompleteMenuElement,address:babelHelpers.classPrivateFieldGet(this,Qi).address,mode:babelHelpers.classPrivateFieldGet(this,Qi).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Zi).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Qi,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Zi).destroy();babelHelpers.classPrivateFieldSet(this,Zi,null)}}]);return t}(o);babelHelpers.defineProperty(el,"searchStartedEvent","searchStarted");babelHelpers.defineProperty(el,"searchCompletedEvent","searchCompleted");babelHelpers.defineProperty(el,"showOnMapClickedEvent","showOnMapClicked");var tl=new WeakMap;var sl=new WeakMap;var al=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));tl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});sl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof Xi)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),tl,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),tl).subscribeOnAddressChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),sl).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),tl).subscribeOnStateChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),sl).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,sl).mode===l.ControlMode.edit){if(!d.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,tl).render({address:babelHelpers.classPrivateFieldGet(this,sl).address,mode:babelHelpers.classPrivateFieldGet(this,sl).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,sl,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,tl).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,tl).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,tl).destroy();babelHelpers.classPrivateFieldSet(this,tl,null)}}]);return t}(o);function il(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ll=new WeakMap;var rl=new WeakMap;var nl=new WeakMap;var dl=new WeakMap;var bl=new WeakMap;var ol=new WeakSet;var cl=new WeakSet;var ul=new WeakSet;var pl=new WeakSet;var vl=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));pl.add(babelHelpers.assertThisInitialized(s));ul.add(babelHelpers.assertThisInitialized(s));cl.add(babelHelpers.assertThisInitialized(s));ol.add(babelHelpers.assertThisInitialized(s));ll.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});rl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});nl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});dl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});bl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",il(this,ol,hl).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",il(this,ul,Hl).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",il(this,pl,Fl).bind(this));document.addEventListener("click",il(this,cl,fl).bind(this));this.map.onMouseOverSubscribe(il(this,ul,Hl).bind(this));this.map.onMouseOutSubscribe(il(this,pl,Fl).bind(this))}},{key:"setAddress",value:function e(t){if(!t){this.closeMap()}this.map.address=t;if(t&&this.addressWidget.state!==b.DATA_SUPPOSED){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,bl)){return}document.removeEventListener("click",il(this,cl,fl));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",il(this,ol,hl));this.addressWidget.controlWrapper.removeEventListener("mouseover",il(this,ul,Hl));this.addressWidget.controlWrapper.removeEventListener("mouseout",il(this,pl,Fl))}babelHelpers.classPrivateFieldSet(this,ll,null);babelHelpers.classPrivateFieldSet(this,nl,null);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,bl,true)}}]);return t}($i);var hl=function e(t){if(babelHelpers.classPrivateFieldGet(this,bl)){return}if(this.addressWidget.mode===l.ControlMode.view){if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,ll))}}};var fl=function e(t){if(babelHelpers.classPrivateFieldGet(this,bl)){return}if(this.addressWidget.inputNode!==t.target){this.closeMap()}};var Hl=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,bl)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,ll));clearTimeout(babelHelpers.classPrivateFieldGet(this,nl));if(this.addressWidget.mode!==l.ControlMode.view){return}if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,ll,setTimeout(function(){t.showMap()},babelHelpers.classPrivateFieldGet(this,rl)))}};var Fl=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,bl)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,ll));clearTimeout(babelHelpers.classPrivateFieldGet(this,nl));if(this.addressWidget.mode!==l.ControlMode.view){return}if(this.addressWidget.mode===l.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,nl,setTimeout(function(){t.closeMap()},babelHelpers.classPrivateFieldGet(this,dl)))}};var Pl=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var i=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var r=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var n=new l.Location(JSON.parse(BX.message("LOCATION_WIDGET_USER_LOCATION")));var d=t.addressFormat||new l.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var b=t.presetLocationsProvider?t.presetLocationsProvider:function(){return t.presetLocationList?t.presetLocationList:[]};var o=[];if(!t.useFeatures||t.useFeatures.fields!==false){o.push(this.createFieldsFeature({addressFormat:d,languageId:i}))}var c=null;if(s&&a){try{c=this.createSource(s,a,i,r)}catch(e){if(e instanceof l.SourceCreationError){c=null}else{throw e}}}var u=null;if(c){if(!t.useFeatures||t.useFeatures.autocomplete!==false){o.push(this.createAutocompleteFeature({languageId:i,addressFormat:d,source:c,userLocation:n,presetLocationsProvider:b}))}if(!t.useFeatures||t.useFeatures.map!==false){var p=!!a.showPhotos;var v=!!a.useGeocodingService;var h=80;var f=150;var H=p?5:0;var F="auto";u=this.createMapFeature({addressFormat:d,source:c,useGeocodingService:v,popupOptions:t.popupOptions,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||h,thumbnailWidth:t.thumbnailWidth||f,maxPhotoCount:t.maxPhotoCount||H,mapBehavior:t.mapBehavior||F,userLocation:n});o.push(u)}}var P=new O({features:o,address:t.address,mode:t.mode,addressFormat:d,languageId:i});if(u){P.subscribeOnFeatureEvent(function(e){var t=e.getData();if(t.feature instanceof el&&t.eventCode===el.showOnMapClickedEvent){u.showMap(true)}})}return P}},{key:"createFieldsFeature",value:function e(t){var s=new Xi({addressFormat:t.addressFormat,languageId:t.languageId});return new al({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new Mt({sourceCode:t.source.sourceCode,languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService,userLocation:t.userLocation,presetLocationsProvider:t.presetLocationsProvider});return new el({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s={cacheable:true,closeByEsc:true,className:"location-popup-window location-source-".concat(t.source.sourceCode),animation:"fading",angle:true,bindOptions:t.popupBindOptions};if(t.popupOptions){s=Object.assign(s,t.popupOptions)}var a=new ys(s);var i=null;if(t.maxPhotoCount>0){i=new Za({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var r={map:new ha({addressFormat:t.addressFormat,map:t.source.map,popup:a,gallery:i,locationRepository:new l.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null,userLocation:t.userLocation})};var n;if(t.mapBehavior==="manual"){n=new $i(r)}else{n=new vl(r)}return n}},{key:"createSource",value:function e(a,i,l,r){var n=null;i.languageId=l;i.sourceLanguageId=r;if(a==="GOOGLE"){n=new s.Google(i)}else if(a==="OSM"){n=t.OSMFactory.createOSMSource(i)}else{throw new RangeError("Wrong source code")}return n}}]);return e}();function ml(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);ml=function t(){return e};return e}function gl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Tl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var wl=new WeakMap;var Il=new WeakMap;var yl=new WeakMap;var Gl=new WeakSet;var Sl=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Gl.add(babelHelpers.assertThisInitialized(e));wl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});Il.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});yl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),wl,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),yl,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,Il,d.Tag.render(ml(),Tl(this,Gl,El).call(this)));babelHelpers.classPrivateFieldGet(this,Il).addEventListener("click",function(e){a.state=babelHelpers.classPrivateFieldGet(a,wl)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit(gl(t,t,kl),{state:babelHelpers.classPrivateFieldGet(a,wl)});e.stopPropagation();return false});babelHelpers.classPrivateFieldGet(this,Il).addEventListener("mouseover",function(e){e.stopPropagation()});return babelHelpers.classPrivateFieldGet(this,Il)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe(gl(t,t,kl),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,wl,t);if(babelHelpers.classPrivateFieldGet(this,Il)){babelHelpers.classPrivateFieldGet(this,Il).innerHTML=Tl(this,Gl,El).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,wl)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(Sl,"STATE_OFF",0);babelHelpers.defineProperty(Sl,"STATE_ON",1);var kl={writable:true,value:"onToggleEvent"};var El=function e(){return babelHelpers.classPrivateFieldGet(this,yl)[babelHelpers.classPrivateFieldGet(this,wl)]};function Cl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);Cl=function t(){return e};return e}function Wl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Al(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ml=new WeakMap;var zl=new WeakMap;var _l=new WeakSet;var Ll=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));_l.add(babelHelpers.assertThisInitialized(e));Ml.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});zl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,Ml,s.type);babelHelpers.classPrivateFieldSet(this,zl,d.Tag.render(Cl(),Al(this,_l,Nl).call(this,babelHelpers.classPrivateFieldGet(this,Ml))));babelHelpers.classPrivateFieldGet(this,zl).addEventListener("click",function(e){a.emit(Wl(t,t,Ol))});return babelHelpers.classPrivateFieldGet(this,zl)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(Wl(t,t,Ol),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ml,t);if(babelHelpers.classPrivateFieldGet(this,zl)){babelHelpers.classPrivateFieldGet(this,zl).className=Al(this,_l,Nl).call(this,babelHelpers.classPrivateFieldGet(this,Ml))}}}]);return t}(n.EventEmitter);var Ol={writable:true,value:"onClick"};babelHelpers.defineProperty(Ll,"TYPE_CLEAR","clear");babelHelpers.defineProperty(Ll,"TYPE_SEARCH","search");babelHelpers.defineProperty(Ll,"TYPE_LOADER","loader");var Nl=function e(t){var s="";if(t===Ll.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===Ll.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===Ll.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function Dl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Dl=function t(){return e};return e}function Bl(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);Bl=function t(){return e};return e}function Rl(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);Rl=function t(){return e};return e}function Xl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);Xl=function t(){return e};return e}function xl(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);xl=function t(){return e};return e}function Ul(){var e=babelHelpers.taggedTemplateLiteral(["",""]);Ul=function t(){return e};return e}function Vl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);Vl=function t(){return e};return e}function Yl(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);Yl=function t(){return e};return e}function jl(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);jl=function t(){return e};return e}function Jl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function Kl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ql=new WeakSet;var $l=new WeakSet;var Zl=new WeakSet;var Ql=new WeakSet;var er=new WeakSet;var tr=new WeakSet;var sr=new WeakSet;var ar=new WeakSet;var ir=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ar.add(babelHelpers.assertThisInitialized(s));sr.add(babelHelpers.assertThisInitialized(s));tr.add(babelHelpers.assertThisInitialized(s));er.add(babelHelpers.assertThisInitialized(s));Ql.add(babelHelpers.assertThisInitialized(s));Zl.add(babelHelpers.assertThisInitialized(s));$l.add(babelHelpers.assertThisInitialized(s));ql.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var i=this.getValue();var r=null;if(d.Type.isStringFilled(i)){try{r=new l.Address(JSON.parse(i))}catch(e){BX.debug("Cant parse address value");return}}var n=new Pl;this._addressWidget=n.createAddressWidget({address:r,mode:this._mode===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(Kl(this,er,or).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(Kl(this,tr,cr).bind(this));this._fieldsSwitch=new Sl({state:Sl.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(Kl(this,$l,nr).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view;this._fieldsSwitch.state=Sl.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=Kl(this,ar,pr).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;d.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?Kl(this,ar,pr).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=d.Tag.render(jl(),"".concat(this.getName(),"_STRING"));this._hiddenInput=d.Tag.render(Yl(),this.getValue(),this.getName());this._inputIcon=new Ll;this._inputIcon.subscribeOnClickEvent(Kl(this,ql,rr).bind(this));var l=this._inputIcon.render({type:Jl(t,t,lr).call(t,Kl(this,ar,pr).call(this))});this._inputContainer=d.Tag.render(Vl(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(d.Tag.render(Ul(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=d.Tag.render(xl(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=d.Tag.render(Xl());if(this._fieldsSwitch.state===Sl.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var n=Kl(this,sr,ur).call(this,Kl(this,ar,pr).call(this));r=d.Tag.render(Rl(),n);this._innerWrapper=d.Tag.render(Bl(),r);i.mapBindElement=r}else{this._innerWrapper=d.Tag.render(Dl(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=Ll.TYPE_CLEAR}if(!d.Type.isArray(i)){return}i.forEach(function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)})}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",function(e,s){s.methods.address=t.registerFieldMethod})}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var lr=function e(t){return t?Ll.TYPE_CLEAR:Ll.TYPE_SEARCH};var rr=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=Ll.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var nr=function e(t){var s=t.getData();var a=s.state;if(a===Sl.STATE_OFF){Kl(this,Zl,dr).call(this)}else{Kl(this,Ql,br).call(this)}this._addressWidget.resetView()};var dr=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var br=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var or=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===r.State.DATA_LOADING){i=Ll.TYPE_LOADER}else{if(s.state===r.State.DATA_INPUTTING){this.markAsChanged()}i=Jl(ir,ir,lr).call(ir,Kl(this,ar,pr).call(this))}this._inputIcon.type=i};var cr=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=Jl(ir,ir,lr).call(ir,a)}};var ur=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var pr=function e(){return this._addressWidget.address};ir.registerField();e.Address=O;e.BaseFeature=o;e.MapFeature=$i;e.AutocompleteFeature=el;e.FieldsFeature=al;e.Factory=Pl;e.State=b;e.UIAddress=ir})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX.Location.OSM,BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js