this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n,d,o){"use strict";var b=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(b,"INITIAL","INITIAL");babelHelpers.defineProperty(b,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(b,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(b,"DATA_SUPPOSED","DATA_SUPPOSED");babelHelpers.defineProperty(b,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(b,"DATA_LOADED","DATA_LOADED");function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);c=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);u=function t(){return e};return e}function p(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var v=new WeakMap;var h=new WeakMap;var f=new WeakMap;var H=new WeakMap;var F=new WeakSet;var P=function(){function e(t){babelHelpers.classCallCheck(this,e);F.add(this);v.set(this,{writable:true,value:void 0});h.set(this,{writable:true,value:void 0});f.set(this,{writable:true,value:void 0});H.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof r.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,H,t.addressFormat)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,v,t.address);var s=p(this,F,m).call(this,babelHelpers.classPrivateFieldGet(this,v));babelHelpers.classPrivateFieldSet(this,f,o.Tag.render(u(),s));babelHelpers.classPrivateFieldSet(this,h,o.Tag.render(c(),babelHelpers.classPrivateFieldGet(this,f)));if(s===""){this.hide()}return babelHelpers.classPrivateFieldGet(this,h)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,h)){babelHelpers.classPrivateFieldGet(this,h).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,h)){babelHelpers.classPrivateFieldGet(this,h).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,h)||babelHelpers.classPrivateFieldGet(this,h).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,v,t);if(!babelHelpers.classPrivateFieldGet(this,f)){return}babelHelpers.classPrivateFieldGet(this,f).innerHTML=p(this,F,m).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var m=function e(t){var s="";if(t){s=r.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,H).getTemplate(r.FormatTemplateType.DEFAULT),r.AddressStringConverter.CONTENT_TYPE_HTML,", ",babelHelpers.classPrivateFieldGet(this,H))}return s};var g=t.Vue.extend({props:{address:{required:true},addressFormat:{required:true},isHidden:{required:true}},methods:{handleApplyClick:function e(){this.$emit("apply",{address:this.address})},convertAddressToString:function e(t){if(!t){return""}return t.toString(this.addressFormat,r.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA)}},computed:{addressString:function e(){if(!this.address){return""}return this.address.toString(this.addressFormat,r.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA,r.AddressStringConverter.CONTENT_TYPE_TEXT)},containerStyles:function e(){return{display:this.isHidden?"none":"flex"}},containerClasses:function e(){return this.isHidden?{hidden:true}:{}},localize:function e(){return t.Vue.getFilteredPhrases("LOCATION_WIDGET_")}},template:'\n\t\t<div\n\t\t\t:class="containerClasses"\n\t\t\t:style="containerStyles"\n\t\t\tclass="location-map-address-changed"\n\t\t>\n\t\t\t<div class="location-map-address-changed-inner">\n\t\t\t<div class="location-map-address-changed-title">\n\t\t\t\t{{localize.LOCATION_WIDGET_AUI_ADDRESS_CHANGED_NEW_ADDRESS}}\n\t\t\t</div>\n\t\t\t<div class="location-map-address-changed-text">{{addressString}}</div>\n\t\t\t</div>\n\t\t\t<button @click="handleApplyClick" type="button" class="location-map-address-apply-btn">\n\t\t\t\t{{localize.LOCATION_WIDGET_AUI_ADDRESS_APPLY}}\n\t\t\t</button>\n\t\t</div>\t\n\t'});function T(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var y=new WeakSet;var w=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));y.add(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){var a,i;if(this.bindOptions.position&&this.bindOptions.position==="right"){a=true;i=T(this,y,I).call(this)}if(!(a&&i)){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}}]);return t}(i.Popup);var I=function e(){var t=this.bindElement.getBoundingClientRect();var s=this.getPopupContainer().offsetHeight;var a=this.getPopupContainer().offsetWidth;if(t.left+t.width+a>document.documentElement.clientWidth){return false}var i=s/2;var l=t.left+t.width+10;var r=window.pageYOffset+t.top+t.height/2-s/2;if(r<window.pageYOffset){i-=window.pageYOffset-r;r=window.pageYOffset}else if(r>window.pageYOffset+document.body.clientHeight-s){i+=r-(window.pageYOffset+document.body.clientHeight-s);r=window.pageYOffset+document.body.clientHeight-s}this.setAngle({position:"left",offset:i});o.Dom.adjust(this.popupContainer,{style:{top:"".concat(r,"px"),left:"".concat(l,"px"),zIndex:this.getZindex()}});return true};function G(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);G=function t(){return e};return e}function S(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-third-party-warning">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);S=function t(){return e};return e}function E(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);E=function t(){return e};return e}function k(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function C(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var A=new WeakMap;var W=new WeakMap;var _=new WeakMap;var M=new WeakMap;var L=new WeakMap;var z=new WeakMap;var O=new WeakMap;var N=new WeakMap;var D=new WeakMap;var B=new WeakMap;var R=new WeakMap;var X=new WeakMap;var x=new WeakMap;var U=new WeakMap;var V=new WeakSet;var Y=new WeakSet;var j=new WeakSet;var K=new WeakSet;var $=new WeakSet;var q=new WeakSet;var J=new WeakSet;var Z=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));J.add(babelHelpers.assertThisInitialized(s));q.add(babelHelpers.assertThisInitialized(s));$.add(babelHelpers.assertThisInitialized(s));K.add(babelHelpers.assertThisInitialized(s));j.add(babelHelpers.assertThisInitialized(s));Y.add(babelHelpers.assertThisInitialized(s));V.add(babelHelpers.assertThisInitialized(s));A.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});W.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});M.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});L.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});z.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});O.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});N.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});D.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});B.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});R.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});X.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});x.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});U.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof r.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),A,e.map);if(e.geocodingService instanceof r.GeocodingServiceBase){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),X,e.geocodingService)}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),A).onLocationChangedEventSubscribe(C(babelHelpers.assertThisInitialized(s),Y,le).bind(babelHelpers.assertThisInitialized(s)));if(!(e.popup instanceof w)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),M,e.popup);if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),O,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),L,new P({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),O)}));C(babelHelpers.assertThisInitialized(s),V,ie).call(babelHelpers.assertThisInitialized(s));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),N,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),D,e.locationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),U,e.userLocationPoint);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,_,t.address);babelHelpers.classPrivateFieldSet(this,W,t.mode);babelHelpers.classPrivateFieldSet(this,B,false);babelHelpers.classPrivateFieldSet(this,R,o.Tag.render(E()));C(this,j,re).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,R))}},{key:"show",value:function e(){var s=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;C(this,$,de).call(this,babelHelpers.classPrivateFieldGet(this,_),a).then((function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,M).show();if(!babelHelpers.classPrivateFieldGet(s,B)){C(s,J,be).call(s,{location:e}).then((function(){if(babelHelpers.classPrivateFieldGet(s,N)){babelHelpers.classPrivateFieldGet(s,N).location=e}s.emit(k(t,t,se));babelHelpers.classPrivateFieldGet(s,A).onMapShow()}));babelHelpers.classPrivateFieldSet(s,B,true)}else{babelHelpers.classPrivateFieldGet(s,A).location=e;if(babelHelpers.classPrivateFieldGet(s,N)){babelHelpers.classPrivateFieldGet(s,N).location=e}s.emit(k(t,t,se));babelHelpers.classPrivateFieldGet(s,A).onMapShow()}}))}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,M).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,M).close();babelHelpers.classPrivateFieldGet(this,z).$props.isHidden=true;this.emit(k(t,t,ae))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(k(t,t,Q),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(k(t,t,ee),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(k(t,t,te),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(k(t,t,se),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(k(t,t,ae),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,A,null);babelHelpers.classPrivateFieldSet(this,N,null);babelHelpers.classPrivateFieldSet(this,L,null);babelHelpers.classPrivateFieldSet(this,z,null);babelHelpers.classPrivateFieldGet(this,M).destroy();babelHelpers.classPrivateFieldSet(this,M,null);o.Dom.remove(babelHelpers.classPrivateFieldGet(this,x));babelHelpers.classPrivateFieldSet(this,x,null);o.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,M).getBindElement()},set:function e(t){if(o.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,M).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,_,t);babelHelpers.classPrivateFieldGet(this,L).address=t;C(this,$,de).call(this,t).then((function(e){C(s,q,oe).call(s,e)}))}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,W,t);babelHelpers.classPrivateFieldGet(this,A).mode=t}}]);return t}(d.EventEmitter);var Q={writable:true,value:"onChanged"};var ee={writable:true,value:"onMouseOver"};var te={writable:true,value:"onMouseOut"};var se={writable:true,value:"onShow"};var ae={writable:true,value:"onClose"};var ie=function e(){var t=this;babelHelpers.classPrivateFieldSet(this,z,new g({propsData:{address:babelHelpers.classPrivateFieldGet(this,_),addressFormat:babelHelpers.classPrivateFieldGet(this,O),isHidden:true}}));babelHelpers.classPrivateFieldGet(this,z).$mount();babelHelpers.classPrivateFieldGet(this,z).$on("apply",(function(e){var s=e.address;babelHelpers.classPrivateFieldSet(t,_,s);babelHelpers.classPrivateFieldGet(t,L).address=s;babelHelpers.classPrivateFieldGet(t,z).$props.isHidden=true;t.emit(k(Z,Z,Q),{address:s})}))};var le=function e(t){var s=t.getData();var a=s.location;var i=a.toAddress();if(!babelHelpers.classPrivateFieldGet(this,_)){babelHelpers.classPrivateFieldSet(this,_,i);babelHelpers.classPrivateFieldGet(this,L).address=i;this.emit(k(Z,Z,Q),{address:i})}else if(i.fieldCollection.isEqual(babelHelpers.classPrivateFieldGet(this,_).fieldCollection,r.LocationType.ADDRESS_LINE_1)){babelHelpers.classPrivateFieldGet(this,_).latitude=i.latitude;babelHelpers.classPrivateFieldGet(this,_).longitude=i.longitude;if(babelHelpers.classPrivateFieldGet(this,_).location){babelHelpers.classPrivateFieldGet(this,_).location.latitude=i.latitude;babelHelpers.classPrivateFieldGet(this,_).location.longitude=i.longitude}this.emit(k(Z,Z,Q),{address:babelHelpers.classPrivateFieldGet(this,_)});babelHelpers.classPrivateFieldGet(this,z).$props.isHidden=true}else{babelHelpers.classPrivateFieldGet(this,L).address=i;babelHelpers.classPrivateFieldGet(this,z).$props.address=i;babelHelpers.classPrivateFieldGet(this,z).$props.isHidden=false}if(babelHelpers.classPrivateFieldGet(this,N)){babelHelpers.classPrivateFieldGet(this,N).location=a}};var re=function e(t,s){var a=this;var i="";if(babelHelpers.classPrivateFieldGet(this,N)){i=babelHelpers.classPrivateFieldGet(this,N).render()}var l=o.Tag.render(S(),o.Loc.getMessage("LOCATION_WIDGET_THIRD_PARTY_WARNING"));babelHelpers.classPrivateFieldSet(this,x,o.Tag.render(G(),s,i,babelHelpers.classPrivateFieldGet(this,W)===r.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,L).render({address:babelHelpers.classPrivateFieldGet(this,_)}):"",l,babelHelpers.classPrivateFieldGet(this,W)===r.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,z).$el:""));o.Event.bind(babelHelpers.classPrivateFieldGet(this,x),"click",(function(e){return e.stopPropagation()}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,x),"mouseover",(function(e){return a.emit(k(Z,Z,ee),e)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,x),"mouseout",(function(e){return a.emit(k(Z,Z,te),e)}));this.bindElement=t;babelHelpers.classPrivateFieldGet(this,M).setContent(babelHelpers.classPrivateFieldGet(this,x))};var ne=function e(t){var s=null;var a;var i;if(t.latitude&&t.longitude){a=t.latitude;i=t.longitude}else if(t.location&&t.location.latitude&&t.location.longitude){a=t.location.latitude;i=t.location.longitude}if(a&&a!=="0"&&i&&i!=="0"){s=[a,i]}return s};var de=function e(t){var s=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise((function(e){if(a){e(babelHelpers.classPrivateFieldGet(s,U)&&babelHelpers.classPrivateFieldGet(s,W)!==r.ControlMode.view?new r.Location({latitude:babelHelpers.classPrivateFieldGet(s,U).latitude,longitude:babelHelpers.classPrivateFieldGet(s,U).longitude}):null);return}if(t){var i=C(s,K,ne).call(s,t);if(i){e(new r.Location({latitude:i[0],longitude:i[1],type:t.getType()}));return}}e(null)}))};var oe=function e(t){if(babelHelpers.classPrivateFieldGet(this,A)){babelHelpers.classPrivateFieldGet(this,A).location=t}if(babelHelpers.classPrivateFieldGet(this,N)){babelHelpers.classPrivateFieldGet(this,N).location=t}};var be=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,A).render({mapContainer:babelHelpers.classPrivateFieldGet(this,R),location:s,mode:babelHelpers.classPrivateFieldGet(this,W)})};var ce=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"_saveResourceStrategy",false);this._saveResourceStrategy=t.saveResourceStrategy}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new r.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new r.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new r.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function ue(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=pe(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function pe(e,t){if(!e)return;if(typeof e==="string")return ve(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ve(e,t)}function ve(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function he(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var fe=new WeakMap;var He=new WeakMap;var Fe=new WeakMap;var Pe=new WeakMap;var me=new WeakMap;var ge=new WeakMap;var Te=new WeakMap;var ye=new WeakMap;var we=new WeakMap;var Ie=new WeakMap;var Ge=new WeakMap;var Se=new WeakMap;var Ee=new WeakMap;var ke=new WeakSet;var Ce=new WeakSet;var Ae=new WeakSet;var We=new WeakSet;var _e=new WeakSet;var Me=new WeakSet;var Le=new WeakSet;var ze=new WeakSet;var Oe=new WeakSet;var Ne=new WeakSet;var De=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ne.add(babelHelpers.assertThisInitialized(s));Oe.add(babelHelpers.assertThisInitialized(s));ze.add(babelHelpers.assertThisInitialized(s));Le.add(babelHelpers.assertThisInitialized(s));Me.add(babelHelpers.assertThisInitialized(s));_e.add(babelHelpers.assertThisInitialized(s));We.add(babelHelpers.assertThisInitialized(s));Ae.add(babelHelpers.assertThisInitialized(s));Ce.add(babelHelpers.assertThisInitialized(s));ke.add(babelHelpers.assertThisInitialized(s));fe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});He.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Fe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Pe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});me.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});Te.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ye.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});we.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Ie.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Se.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});Ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Pe,e.addressFormat);if(e.address&&!(e.address instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Fe,e.address||null);if(!r.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),fe,e.mode);if(!o.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),me,e.languageId);if(e.features){if(!o.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach((function(e){he(babelHelpers.assertThisInitialized(s),ke,Be).call(babelHelpers.assertThisInitialized(s),e)}))}if(o.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Se,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof r.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ee,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Se)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ee,new r.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),He,b.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var l=babelHelpers.classPrivateFieldGet(this,Fe)?babelHelpers.classPrivateFieldGet(this,Fe).id:0;if(t&&!t.getFieldValue(r.AddressType.ADDRESS_LINE_1)&&babelHelpers.classPrivateFieldGet(this,Pe).isTemplateExists(r.FormatTemplateType.ADDRESS_LINE_1)){t.setFieldValue(r.AddressType.ADDRESS_LINE_1,r.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,Pe).getTemplate(r.FormatTemplateType.ADDRESS_LINE_1),r.AddressStringConverter.CONTENT_TYPE_TEXT,null,babelHelpers.classPrivateFieldGet(this,Pe)))}babelHelpers.classPrivateFieldSet(this,Fe,t);var n=i.hasOwnProperty("storeAsLastAddress")?i.storeAsLastAddress:true;if(n){he(this,Oe,Ke).call(this)}if(l>0){babelHelpers.classPrivateFieldGet(this,Fe).id=l}babelHelpers.classPrivateFieldSet(this,Ie,true);he(this,Le,Ye).call(this,t);he(this,Ce,Re).call(this,"setAddress",[t],s,a);if(babelHelpers.classPrivateFieldGet(this,He)!==b.DATA_INPUTTING){he(this,Ae,Xe).call(this)}}},{key:"emitFeatureEvent",value:function e(s){this.emit(t.onFeatureEvent,s)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break}}},{key:"onInputInput",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ge,true)}},{key:"resetView",value:function e(){he(this,Ce,Re).call(this,"resetView")}},{key:"render",value:function e(t){if(!o.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,ye,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,fe)===r.ControlMode.edit){if(!o.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Te,t.inputNode);he(this,Le,Ye).call(this,babelHelpers.classPrivateFieldGet(this,Fe))}he(this,Ce,Re).call(this,"render",[t]);if(babelHelpers.classPrivateFieldGet(this,fe)===r.ControlMode.edit){o.Event.bind(babelHelpers.classPrivateFieldGet(this,Te),"focus",he(this,_e,Ue).bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Te),"focusout",he(this,ze,je).bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Te),"keyup",this.onInputKeyup.bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Te),"input",this.onInputInput.bind(this))}}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,He,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnFeatureEvent",value:function e(s){this.subscribe(t.onFeatureEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){r.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,we)){return}o.Event.unbindAll(this);o.Event.unbind(babelHelpers.classPrivateFieldGet(this,Te),"focus",he(this,_e,Ue));o.Event.unbind(babelHelpers.classPrivateFieldGet(this,Te),"focusout",he(this,ze,je));o.Event.unbind(babelHelpers.classPrivateFieldGet(this,Te),"keyup",this.onInputKeyup);o.Event.unbind(babelHelpers.classPrivateFieldGet(this,Te),"input",this.onInputInput);he(this,Ce,Re).call(this,"destroy");he(this,Ne,$e).call(this);babelHelpers.classPrivateFieldSet(this,we,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,we)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,ge)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,ye)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,Te)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,Fe)},set:function e(t){if(t&&!(t instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Fe,t);he(this,Oe,Ke).call(this);he(this,Ce,Re).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,Ge,false);babelHelpers.classPrivateFieldSet(this,Ie,false);he(this,Le,Ye).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,fe)},set:function e(t){if(!r.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,fe,t);he(this,Ce,Re).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,He)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,Pe)}}]);return t}(d.EventEmitter);babelHelpers.defineProperty(De,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(De,"onStateChangedEvent","onStateChanged");babelHelpers.defineProperty(De,"onFeatureEvent","onFeatureEvent");var Be=function e(t){if(!(t instanceof ce)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,ge).push(t)};var Re=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var l;var r=ue(babelHelpers.classPrivateFieldGet(this,ge)),n;try{for(r.s();!(n=r.n()).done;){var d=n.value;var o=false;var b=ue(i),c;try{for(b.s();!(c=b.n()).done;){var u=c.value;if(d instanceof u){o=true;break}}}catch(e){b.e(e)}finally{b.f()}if(!o&&d!==a){l=d[t].apply(d,s)}}}catch(e){r.e(e)}finally{r.f()}return l};var Xe=function e(){this.emit(De.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,Fe)});if(babelHelpers.classPrivateFieldGet(this,Fe)&&babelHelpers.classPrivateFieldGet(this,Se)){he(this,We,xe).call(this,babelHelpers.classPrivateFieldGet(this,Fe))}};var xe=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,Ee).findParents(t.location)}};var Ue=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Te).value;if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,Te),s.length)}};var Ve=function e(t,s){var a="";if(t){if(!babelHelpers.classPrivateFieldGet(this,Pe).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,Pe).code,'" does not have a template "').concat(s,'"'));return""}a=r.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,Pe).getTemplate(s),r.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,Pe))}return a};var Ye=function e(t){if(babelHelpers.classPrivateFieldGet(this,Te)){var s=he(this,Me,Ve).call(this,t,r.FormatTemplateType.AUTOCOMPLETE);var a=he(this,Me,Ve).call(this,t,r.FormatTemplateType.DEFAULT);babelHelpers.classPrivateFieldGet(this,Te).value=s.trim()!==""?s:a;babelHelpers.classPrivateFieldGet(this,Te).title=a;var i=babelHelpers.classPrivateFieldGet(this,Te).selectionStart;var l=s.length;babelHelpers.classPrivateFieldGet(this,Te).setSelectionRange(i,l)}};var je=function e(t){if(babelHelpers.classPrivateFieldGet(this,Ge)&&!babelHelpers.classPrivateFieldGet(this,Ie)){var s=babelHelpers.classPrivateFieldGet(this,Te).value.trim();var a=new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,me)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,Pe).fieldForUnRecognized,s);this.address=a;he(this,Ae,Xe).call(this)}babelHelpers.classPrivateFieldSet(this,Ge,false);babelHelpers.classPrivateFieldSet(this,Ie,false)};var Ke=function e(){if(babelHelpers.classPrivateFieldGet(this,Fe)&&babelHelpers.classPrivateFieldGet(this,Fe).fieldCollection&&babelHelpers.classPrivateFieldGet(this,Fe).fieldCollection.isFieldExists(r.AddressType.LOCALITY)){r.Storage.getInstance().lastAddress=babelHelpers.classPrivateFieldGet(this,Fe)}};var $e=function e(){babelHelpers.classPrivateFieldGet(this,ge).splice(0,babelHelpers.classPrivateFieldGet(this,ge).length)};function qe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<span class="location-map-popup-item--info"> \t\t\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t"]);qe=function t(){return e};return e}function Je(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);Je=function t(){return e};return e}function Ze(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-popup-item--info-left"></div>']);Ze=function t(){return e};return e}var Qe=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var st=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Qe.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});et.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});tt.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Autocomplete.MenuBottom");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,et,o.Tag.render(Ze()));babelHelpers.classPrivateFieldSet(this,tt,o.Tag.render(Je()));babelHelpers.classPrivateFieldSet(this,Qe,o.Tag.render(qe(),babelHelpers.classPrivateFieldGet(this,et),babelHelpers.classPrivateFieldGet(this,tt)));return babelHelpers.classPrivateFieldGet(this,Qe)}},{key:"setRightItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,tt).firstChild){babelHelpers.classPrivateFieldGet(this,tt).removeChild(babelHelpers.classPrivateFieldGet(this,tt).firstChild)}babelHelpers.classPrivateFieldGet(this,tt).appendChild(t)}},{key:"setLeftItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,et).firstChild){babelHelpers.classPrivateFieldGet(this,et).removeChild(babelHelpers.classPrivateFieldGet(this,et).firstChild)}babelHelpers.classPrivateFieldGet(this,et).appendChild(t)}}]);return t}(d.EventEmitter);var at=new WeakMap;var it=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);at.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});var a=e.bindElement.getBoundingClientRect();s.popupWindow.setMaxWidth(a.width);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),at,new st);s.layout.menuContainer.appendChild(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),at).render());return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[t]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){var s=t;if(s<0){s=this.menuItems.length-1}else if(s>this.menuItems.length-1){s=0}this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=s;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}},{key:"setBottomRightItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,at).setRightItemNode(t)}},{key:"setBottomLeftItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,at).setLeftItemNode(t)}}]);return t}(i.Menu);function lt(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=rt(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function rt(e,t){if(!e)return;if(typeof e==="string")return nt(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return nt(e,t)}function nt(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function dt(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function ot(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var bt=new WeakMap;var ct=new WeakMap;var ut=new WeakMap;var pt=new WeakMap;var vt=new WeakSet;var ht=new WeakSet;var ft=new WeakSet;var Ht=new WeakSet;var Ft=new WeakSet;var Pt=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ft.add(babelHelpers.assertThisInitialized(s));Ht.add(babelHelpers.assertThisInitialized(s));ft.add(babelHelpers.assertThisInitialized(s));ht.add(babelHelpers.assertThisInitialized(s));vt.add(babelHelpers.assertThisInitialized(s));bt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ct.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ut.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});pt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),bt,e.inputNode);if(e.menuNode){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ct,e.menuNode)}return s}babelHelpers.createClass(t,[{key:"getMenu",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,ut)||babelHelpers.classPrivateFieldGet(this,ut).isDestroyed()){babelHelpers.classPrivateFieldSet(this,ut,ot(this,vt,Tt).call(this))}return babelHelpers.classPrivateFieldGet(this,ut)}},{key:"show",value:function e(t,s){if(t.length>0){this.setMenuItems(t,s);this.getMenu().show()}}},{key:"close",value:function e(){this.getMenu().close()}},{key:"setMenuItems",value:function e(s,a,i){var l=this;this.getMenu().clearItems();if(Array.isArray(s)){babelHelpers.classPrivateFieldSet(this,pt,s.slice());var n=!i||!i.getFieldValue(r.AddressType.LOCALITY)||!dt(t,t,mt).call(t,babelHelpers.classPrivateFieldGet(this,pt));if(n){s.forEach((function(e,t){l.getMenu().addMenuItem(ot(l,ft,wt).call(l,t,e,a))}))}else{s.forEach((function(e,t){if(ot(l,ht,yt).call(l,i,e)){l.getMenu().addMenuItem(ot(l,ft,wt).call(l,t,e,a))}}));var d=false;s.forEach((function(e,t){if(!ot(l,ht,yt).call(l,i,e)){if(!d){l.getMenu().addMenuItem({html:o.Loc.getMessage("LOCATION_WIDGET_PROMPT_IN_OTHER_CITY"),delimiter:true})}l.getMenu().addMenuItem(ot(l,ft,wt).call(l,t,e,a));d=true}}))}}}},{key:"choosePrevItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s=null;var a=this.getMenu().choosePrevItem();if(a){if(a.delimiter&&a.delimiter===true){s=t?this.getMenu().chooseNextItem():this.choosePrevItem(true)}else{s=ot(this,Ft,Gt).call(this,this.getMenu().choseItemIdx)}}return s}},{key:"chooseNextItem",value:function e(){var t=null;var s=this.getMenu().chooseNextItem();if(s){if(s.delimiter&&s.delimiter===true){t=this.chooseNextItem()}else{t=ot(this,Ft,Gt).call(this,this.getMenu().choseItemIdx)}}return t}},{key:"isItemChosen",value:function e(){return this.getMenu().isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=this.getMenu().getChosenItem();if(s&&s.id){t=ot(this,Ft,Gt).call(this,this.getMenu().choseItemIdx)}return t}},{key:"isShown",value:function e(){return this.getMenu().isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ut)){babelHelpers.classPrivateFieldGet(this,ut).destroy();babelHelpers.classPrivateFieldSet(this,ut,null)}babelHelpers.classPrivateFieldSet(this,pt,null)}}],[{key:"createMenuItemText",value:function e(t,s,a){var i="\n\t\t<div>\n\t\t\t<strong>".concat(t,"</strong>\n\t\t</div>");var l;if(a.getFieldValue(r.LocationType.TMP_TYPE_CLARIFICATION)){l=a.getFieldValue(r.LocationType.TMP_TYPE_CLARIFICATION);if(l){if(a.getFieldValue(r.LocationType.TMP_TYPE_HINT)){l+=" <i>(".concat(a.getFieldValue(r.LocationType.TMP_TYPE_HINT),")</i>")}i+="<div>".concat(l,"</div>")}}return'<div data-role="location-widget-menu-item" tabindex="-1">'+i+"</div>"}}]);return t}(d.EventEmitter);var mt=function e(t){var s=lt(t),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i.address&&i.address.getFieldValue(r.AddressType.LOCALITY)){return true}}}catch(e){s.e(e)}finally{s.f()}return false};var gt=function e(t){var s=[];if(t.getFieldValue(r.AddressType.LOCALITY)){s.push(t.getFieldValue(r.AddressType.LOCALITY))}if(t.getFieldValue(r.AddressType.ADM_LEVEL_1)){s.push(t.getFieldValue(r.AddressType.ADM_LEVEL_1))}return s};babelHelpers.defineProperty(Pt,"onItemSelectedEvent","onItemSelected");var Tt=function e(){return new it({bindElement:babelHelpers.classPrivateFieldGet(this,ct)?babelHelpers.classPrivateFieldGet(this,ct):babelHelpers.classPrivateFieldGet(this,bt),autoHide:false,closeByEsc:true,className:"location-widget-prompt-menu"})};var yt=function e(t,s){return t&&t.getFieldValue(r.AddressType.LOCALITY)&&s&&s.address&&s.address.getFieldValue(r.AddressType.LOCALITY)&&dt(Pt,Pt,gt).call(Pt,s.address).includes(t.getFieldValue(r.AddressType.LOCALITY))};var wt=function e(t,s,a){var i=this;return{id:t,title:s.name,html:Pt.createMenuItemText(s.name,a,s),onclick:function e(s,a){ot(i,Ht,It).call(i,t);i.close()}}};var It=function e(t){var s=ot(this,Ft,Gt).call(this,t);if(s){this.emit(Pt.onItemSelectedEvent,{location:s})}};var Gt=function e(t){var s=null;if(babelHelpers.classPrivateFieldGet(this,pt)[t]!==undefined){s=babelHelpers.classPrivateFieldGet(this,pt)[t]}if(!s){BX.debug("Location with index ".concat(t," was not found"))}return s};function St(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Et=new WeakMap;var kt=new WeakMap;var Ct=new WeakMap;var At=new WeakMap;var Wt=new WeakSet;var _t=new WeakSet;var Mt=new WeakSet;var Lt=function(){function e(t,s,a){babelHelpers.classCallCheck(this,e);Mt.add(this);_t.add(this);Wt.add(this);Et.set(this,{writable:true,value:null});kt.set(this,{writable:true,value:""});Ct.set(this,{writable:true,value:""});At.set(this,{writable:true,value:null});if(!(t instanceof HTMLInputElement)){throw new TypeError("Wrong input type")}babelHelpers.classPrivateFieldSet(this,Et,t);if(!(s instanceof r.Format)){throw new TypeError("Wrong addressFormat type")}babelHelpers.classPrivateFieldSet(this,At,s);if(a&&!(a instanceof r.Address)){throw new TypeError("Wrong address type")}if(a){this.setValueFromAddress(a)}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldSet(this,kt,t);babelHelpers.classPrivateFieldGet(this,Et).value=t;if(s){babelHelpers.classPrivateFieldSet(this,Ct,t)}St(this,Wt,zt).call(this)}},{key:"actualize",value:function e(){babelHelpers.classPrivateFieldSet(this,kt,babelHelpers.classPrivateFieldGet(this,Et).value);St(this,Wt,zt).call(this)}},{key:"isChanged",value:function e(){return babelHelpers.classPrivateFieldGet(this,kt).trim()!==babelHelpers.classPrivateFieldGet(this,Et).value.trim()}},{key:"hasPureAddressString",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ct)!==""}},{key:"setValueFromAddress",value:function e(t){var s="";if(t){s=St(this,Mt,Nt).call(this,t,r.FormatTemplateType.AUTOCOMPLETE);if(s.trim()===""){s=St(this,Mt,Nt).call(this,t,r.FormatTemplateType.DEFAULT)}}this.setValue(s,true)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,kt)}},{key:"customTail",get:function e(){if(babelHelpers.classPrivateFieldGet(this,Ct)===""){return babelHelpers.classPrivateFieldGet(this,kt)}var t;if(!St(this,_t,Ot).call(this)){t=babelHelpers.classPrivateFieldGet(this,kt).slice(babelHelpers.classPrivateFieldGet(this,Ct).length)}else{t=babelHelpers.classPrivateFieldGet(this,kt)}return t}}]);return e}();var zt=function e(){if(St(this,_t,Ot).call(this)){babelHelpers.classPrivateFieldSet(this,Ct,"")}};var Ot=function e(){return babelHelpers.classPrivateFieldGet(this,kt)===""||babelHelpers.classPrivateFieldGet(this,Ct)===""||babelHelpers.classPrivateFieldGet(this,kt).indexOf(babelHelpers.classPrivateFieldGet(this,Ct))!==0};var Nt=function e(t,s){if(!babelHelpers.classPrivateFieldGet(this,At).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,At).code,'" does not have a template "').concat(s,'"'));return""}return r.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,At).getTemplate(s),r.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,At))};function Dt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span>\n\t\t\t\t\t<span class="menu-popup-item-icon"></span>\n\t\t\t\t\t<span class="menu-popup-item-text">',"</span>\n\t\t\t\t</span>\n\t\t"]);Dt=function t(){return e};return e}function Bt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="location-map-popup-item--show-on-map">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t"]);Bt=function t(){return e};return e}function Rt(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Xt(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var xt=new WeakMap;var Ut=new WeakMap;var Vt=new WeakMap;var Yt=new WeakMap;var jt=new WeakMap;var Kt=new WeakMap;var $t=new WeakMap;var qt=new WeakMap;var Jt=new WeakMap;var Zt=new WeakMap;var Qt=new WeakMap;var es=new WeakMap;var ts=new WeakMap;var ss=new WeakMap;var as=new WeakMap;var is=new WeakMap;var ls=new WeakMap;var rs=new WeakMap;var ns=new WeakMap;var ds=new WeakSet;var os=new WeakSet;var bs=new WeakSet;var cs=new WeakSet;var us=new WeakSet;var ps=new WeakSet;var vs=new WeakSet;var hs=new WeakSet;var fs=new WeakSet;var Hs=new WeakSet;var Fs=new WeakSet;var Ps=new WeakSet;var ms=new WeakSet;var gs=new WeakSet;var Ts=new WeakSet;var ys=new WeakSet;var ws=new WeakSet;var Is=new WeakSet;var Gs=new WeakSet;var Ss=new WeakSet;var Es=new WeakSet;var ks=new WeakSet;var Cs=new WeakSet;var As=new WeakSet;var Ws=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));As.add(babelHelpers.assertThisInitialized(s));Cs.add(babelHelpers.assertThisInitialized(s));ks.add(babelHelpers.assertThisInitialized(s));Es.add(babelHelpers.assertThisInitialized(s));Ss.add(babelHelpers.assertThisInitialized(s));Gs.add(babelHelpers.assertThisInitialized(s));Is.add(babelHelpers.assertThisInitialized(s));ws.add(babelHelpers.assertThisInitialized(s));ys.add(babelHelpers.assertThisInitialized(s));Ts.add(babelHelpers.assertThisInitialized(s));gs.add(babelHelpers.assertThisInitialized(s));ms.add(babelHelpers.assertThisInitialized(s));Ps.add(babelHelpers.assertThisInitialized(s));Fs.add(babelHelpers.assertThisInitialized(s));Hs.add(babelHelpers.assertThisInitialized(s));fs.add(babelHelpers.assertThisInitialized(s));hs.add(babelHelpers.assertThisInitialized(s));vs.add(babelHelpers.assertThisInitialized(s));ps.add(babelHelpers.assertThisInitialized(s));us.add(babelHelpers.assertThisInitialized(s));cs.add(babelHelpers.assertThisInitialized(s));bs.add(babelHelpers.assertThisInitialized(s));os.add(babelHelpers.assertThisInitialized(s));ds.add(babelHelpers.assertThisInitialized(s));xt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ut.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Vt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Yt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});jt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Kt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$t.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Jt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Zt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Qt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});es.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ts.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});ss.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});as.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});is.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});ls.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});rs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});ns.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof r.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Yt,e.addressFormat);if(!(e.autocompleteService instanceof r.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Zt,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Vt,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),jt,e.sourceCode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),xt,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),qt,e.presetLocationsProvider);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Kt,e.locationRepository||new r.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),$t,e.userLocationPoint);Xt(babelHelpers.assertThisInitialized(s),ms,qs).call(babelHelpers.assertThisInitialized(s),b.INITIAL);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,es,t.inputNode);babelHelpers.classPrivateFieldSet(this,xt,t.address);babelHelpers.classPrivateFieldSet(this,Ut,new Lt(babelHelpers.classPrivateFieldGet(this,es),babelHelpers.classPrivateFieldGet(this,Yt),babelHelpers.classPrivateFieldGet(this,xt)));babelHelpers.classPrivateFieldGet(this,es).addEventListener("keydown",Xt(this,Gs,sa).bind(this));babelHelpers.classPrivateFieldGet(this,es).addEventListener("keyup",Xt(this,Ss,aa).bind(this));babelHelpers.classPrivateFieldGet(this,es).addEventListener("focus",Xt(this,vs,Us).bind(this));babelHelpers.classPrivateFieldGet(this,es).addEventListener("focusout",Xt(this,ps,xs).bind(this));babelHelpers.classPrivateFieldGet(this,es).addEventListener("click",Xt(this,ds,Ns).bind(this));babelHelpers.classPrivateFieldGet(this,es).addEventListener("paste",Xt(this,Es,ia).bind(this));babelHelpers.classPrivateFieldSet(this,Jt,new Pt({inputNode:t.inputNode,menuNode:t.menuNode}));babelHelpers.classPrivateFieldGet(this,Jt).subscribe(Pt.onItemSelectedEvent,Xt(this,Ps,$s).bind(this));document.addEventListener("click",Xt(this,fs,Ys).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(Rt(t,t,_s),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(Rt(t,t,Ms),s)}},{key:"onSearchStartedEventSubscribe",value:function e(s){this.subscribe(Rt(t,t,Ls),s)}},{key:"onSearchCompletedEventSubscribe",value:function e(s){this.subscribe(Rt(t,t,zs),s)}},{key:"onShowOnMapClickedEventSubscribe",value:function e(s){this.subscribe(Rt(t,t,Os),s)}},{key:"showPrompt",value:function e(t){babelHelpers.classPrivateFieldGet(this,ts).requested=t;babelHelpers.classPrivateFieldGet(this,ts).current=t;babelHelpers.classPrivateFieldGet(this,ts).dropped="";Xt(this,Cs,ra).call(this,t)}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Jt)){babelHelpers.classPrivateFieldGet(this,Jt).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Jt)){babelHelpers.classPrivateFieldGet(this,Jt).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,is)){return}o.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,Jt)){babelHelpers.classPrivateFieldGet(this,Jt).destroy();babelHelpers.classPrivateFieldSet(this,Jt,null)}babelHelpers.classPrivateFieldSet(this,Qt,null);if(babelHelpers.classPrivateFieldGet(this,es)){babelHelpers.classPrivateFieldGet(this,es).removeEventListener("keydown",Xt(this,Gs,sa));babelHelpers.classPrivateFieldGet(this,es).removeEventListener("keyup",Xt(this,Ss,aa));babelHelpers.classPrivateFieldGet(this,es).removeEventListener("focus",Xt(this,vs,Us));babelHelpers.classPrivateFieldGet(this,es).removeEventListener("focusout",Xt(this,ps,xs));babelHelpers.classPrivateFieldGet(this,es).removeEventListener("click",Xt(this,ds,Ns));babelHelpers.classPrivateFieldGet(this,es).removeEventListener("paste",Xt(this,Es,ia))}document.removeEventListener("click",Xt(this,fs,Ys));babelHelpers.classPrivateFieldSet(this,is,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,xt,t);if(babelHelpers.classPrivateFieldGet(this,Ut)){babelHelpers.classPrivateFieldGet(this,Ut).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,xt))}if(!t){babelHelpers.classPrivateFieldSet(this,as,true)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,xt)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,ss)}}]);return t}(d.EventEmitter);var _s={writable:true,value:"onAddressChanged"};var Ms={writable:true,value:"onStateChanged"};var Ls={writable:true,value:"onSearchStarted"};var zs={writable:true,value:"onSearchCompleted"};var Os={writable:true,value:"onShowOnMapClicked"};var Ns=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Ut).value;if(s.length===0){Xt(this,os,Ds).call(this)}};var Ds=function e(){var t=babelHelpers.classPrivateFieldGet(this,qt).call(this);babelHelpers.classPrivateFieldGet(this,Jt).setMenuItems(t,"");var s;if(t.length>0){s=o.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP")}else{s=o.Loc.getMessage("LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP")}Xt(this,us,Xs).call(this,s,null)};var Bs=function e(t){var s=o.Tag.render(Bt(),o.Loc.getMessage("LOCATION_WIDGET_SHOW_ON_MAP"));s.addEventListener("click",Xt(this,Fs,Ks).call(this,t));return s};var Rs=function e(t){return o.Tag.render(Dt(),t)};var Xs=function e(t,s){babelHelpers.classPrivateFieldGet(this,Jt).getMenu().setBottomRightItemNode(Xt(this,bs,Bs).call(this,s));babelHelpers.classPrivateFieldGet(this,Jt).getMenu().setBottomLeftItemNode(Xt(this,cs,Rs).call(this,t));babelHelpers.classPrivateFieldGet(this,Jt).getMenu().show()};var xs=function e(t){if(babelHelpers.classPrivateFieldGet(this,is)){return}if(babelHelpers.classPrivateFieldGet(this,ss)===b.DATA_INPUTTING&&!(t.relatedTarget&&t.relatedTarget.getAttribute("data-role")==="location-widget-menu-item")){Xt(this,ms,qs).call(this,b.DATA_SUPPOSED);var s=false;if(babelHelpers.classPrivateFieldGet(this,Ut)){if(!babelHelpers.classPrivateFieldGet(this,xt)||!babelHelpers.classPrivateFieldGet(this,Ut).hasPureAddressString()){babelHelpers.classPrivateFieldSet(this,xt,Xt(this,ws,ea).call(this,babelHelpers.classPrivateFieldGet(this,Ut).value));s=true}else if(babelHelpers.classPrivateFieldGet(this,Ut).customTail!==""){var a=babelHelpers.classPrivateFieldGet(this,xt).getFieldValue(babelHelpers.classPrivateFieldGet(this,Yt).fieldForUnRecognized);var i=a?a+babelHelpers.classPrivateFieldGet(this,Ut).customTail:babelHelpers.classPrivateFieldGet(this,Ut).customTail;babelHelpers.classPrivateFieldGet(this,xt).setFieldValue(babelHelpers.classPrivateFieldGet(this,Yt).fieldForUnRecognized,i);s=true}}if(s){babelHelpers.classPrivateFieldGet(this,Ut).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,xt));Xt(this,Ts,Zs).call(this,[],{storeAsLastAddress:false})}}t.stopImmediatePropagation()};var Us=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,is)){return}if(!babelHelpers.classPrivateFieldGet(this,xt)){var s=r.Storage.getInstance().lastAddress;if(s&&s.fieldCollection.isFieldExists(r.AddressType.LOCALITY)&&!babelHelpers.classPrivateFieldGet(this,as)){var a={};a[r.AddressType.LOCALITY]=s.fieldCollection.getFieldValue(r.AddressType.LOCALITY);if(s.fieldCollection.isFieldExists(r.AddressType.COUNTRY)){a[r.AddressType.COUNTRY]=s.fieldCollection.getFieldValue(r.AddressType.COUNTRY)}if(s.fieldCollection.isFieldExists(r.AddressType.ADM_LEVEL_1)){a[r.AddressType.ADM_LEVEL_1]=s.fieldCollection.getFieldValue(r.AddressType.ADM_LEVEL_1)}if(["RU","RU_2"].includes(babelHelpers.classPrivateFieldGet(this,Yt).code)){a[r.AddressType.ADDRESS_LINE_2]=", "}babelHelpers.classPrivateFieldSet(this,xt,new r.Address({languageId:s.languageId,fieldCollection:a}));babelHelpers.classPrivateFieldGet(this,Ut).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,xt));Xt(this,ms,qs).call(this,b.DATA_SUPPOSED);Xt(this,Ts,Zs).call(this,[],{storeAsLastAddress:false});setTimeout((function(){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(t,es),babelHelpers.classPrivateFieldGet(t,es).value.length)}),0)}}else{if(babelHelpers.classPrivateFieldGet(this,xt)&&(!babelHelpers.classPrivateFieldGet(this,xt).location||!babelHelpers.classPrivateFieldGet(this,xt).location.hasExternalRelation())&&babelHelpers.classPrivateFieldGet(this,Ut).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ut).value)}}};var Vs=function e(){var t={};if(babelHelpers.classPrivateFieldGet(this,xt)&&babelHelpers.classPrivateFieldGet(this,xt).latitude&&babelHelpers.classPrivateFieldGet(this,xt).longitude){t.biasPoint=new r.Point(babelHelpers.classPrivateFieldGet(this,xt).latitude,babelHelpers.classPrivateFieldGet(this,xt).longitude)}return t};var Ys=function e(t){if(babelHelpers.classPrivateFieldGet(this,is)){return}if(t.target===babelHelpers.classPrivateFieldGet(this,es)){return}if(babelHelpers.classPrivateFieldGet(this,Jt).isShown()){babelHelpers.classPrivateFieldGet(this,Jt).close()}};var js=function e(t,s){var a=this;if(Array.isArray(t)&&t.length>0){if(t.length===1&&babelHelpers.classPrivateFieldGet(this,xt)&&babelHelpers.classPrivateFieldGet(this,xt).location&&babelHelpers.classPrivateFieldGet(this,xt).location.externalId&&babelHelpers.classPrivateFieldGet(this,xt).location.externalId===t[0].externalId){this.closePrompt();return}babelHelpers.classPrivateFieldGet(this,Jt).setMenuItems(t,babelHelpers.classPrivateFieldGet(this,ts).requested,this.address);Xt(this,us,Xs).call(this,o.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP"),t[0])}else{babelHelpers.classPrivateFieldGet(this,Jt).getMenu().clearItems();babelHelpers.classPrivateFieldGet(this,Jt).getMenu().addMenuItem({id:"notFound",html:"<span>".concat(o.Loc.getMessage("LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND"),"</span>"),onclick:function e(t,s){babelHelpers.classPrivateFieldGet(a,Jt).close()}});Xt(this,us,Xs).call(this,o.Loc.getMessage("LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP"),null)}};var Ks=function e(t){var s=this;return function(){if(t){Xt(s,gs,Js).call(s,t);return}setTimeout((function(){s.emit(Rt(Ws,Ws,Os))}),1)}};var $s=function e(t){if(t.data.location){Xt(this,gs,Js).call(this,t.data.location)}};var qs=function e(t){babelHelpers.classPrivateFieldSet(this,ss,t);this.emit(Rt(Ws,Ws,Ms),{state:babelHelpers.classPrivateFieldGet(this,ss)})};var Js=function e(t){var s=this;var a;Xt(this,ms,qs).call(this,b.DATA_SELECTED);if(t){if(t.hasExternalRelation()&&babelHelpers.classPrivateFieldGet(this,jt)===t.sourceCode){a=Xt(this,ys,Qs).call(this,t).then((function(e){if(t.address&&t.address.getFieldValue(r.AddressType.ADDRESS_LINE_2)){var a="";if(e.address.getFieldValue(r.AddressType.ADDRESS_LINE_2)){a=e.address.getFieldValue(r.AddressType.ADDRESS_LINE_2);a+=", "}a+=t.address.getFieldValue(r.AddressType.ADDRESS_LINE_2);e.address.setFieldValue(r.AddressType.ADDRESS_LINE_2,a)}Xt(s,ks,la).call(s,e,0);return true}),(function(e){return r.ErrorPublisher.getInstance().notify(e.errors)}))}else{a=new Promise((function(e){setTimeout((function(){Xt(s,ks,la).call(s,t,0);e()}),0)}))}}else{a=new Promise((function(e){setTimeout((function(){Xt(s,ks,la).call(s,null,0);e()}),0)}))}return a};var Zs=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.emit(Rt(Ws,Ws,_s),{address:babelHelpers.classPrivateFieldGet(this,xt),excludeSetAddressFeatures:t,options:s})};var Qs=function e(t){var s=this;Xt(this,ms,qs).call(this,b.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,Kt).findByExternalId(t.externalId,t.sourceCode,t.languageId).then((function(e){Xt(s,ms,qs).call(s,b.DATA_LOADED);var a;if(e.latitude!=="0"&&e.longitude!=="0"&&e!==""){a=e;a.name=t.name}else{a=t}return a}),(function(e){r.ErrorPublisher.getInstance().notify(e.errors)}))};var ea=function e(t){var s=new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,Vt)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,Yt).fieldForUnRecognized,t);return s};var ta=function e(t){babelHelpers.classPrivateFieldSet(this,xt,t?t.toAddress():null);babelHelpers.classPrivateFieldGet(this,Ut).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,xt));Xt(this,Ts,Zs).call(this)};var sa=function e(t){if(!(babelHelpers.classPrivateFieldGet(this,es)&&babelHelpers.classPrivateFieldGet(this,es).selectionStart===0&&babelHelpers.classPrivateFieldGet(this,es).selectionEnd===babelHelpers.classPrivateFieldGet(this,es).value.length)){return}if(t.code==="Backspace"||t.code==="Delete"||t.code==="KeyV"&&(t.ctrlKey||t.metaKey)||t.code==="KeyX"&&(t.ctrlKey||t.metaKey)||t.code==="Insert"&&t.shiftKey||!(t.ctrlKey||t.metaKey)&&babelHelpers.toConsumableArray(t.key).length===1){this.address=null;Xt(this,Ts,Zs).call(this)}};var aa=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,is)){return}if(babelHelpers.classPrivateFieldGet(this,ss)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(this,Ut).isChanged()){Xt(this,ms,qs).call(this,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,Jt).isShown()){var a;var i=700;switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,Jt).isItemChosen()){Xt(this,gs,Js).call(this,babelHelpers.classPrivateFieldGet(this,Jt).getChosenItem()).then((function(){babelHelpers.classPrivateFieldGet(s,Jt).close()}),(function(e){return BX.debug(e)}))}return;case"Tab":case"Escape":Xt(this,ms,qs).call(this,b.DATA_SUPPOSED);Xt(this,Ts,Zs).call(this);babelHelpers.classPrivateFieldGet(this,Jt).close();return;case"ArrowUp":a=babelHelpers.classPrivateFieldGet(this,Jt).choosePrevItem();if(a&&a.address){Xt(this,ks,la).call(this,a,i)}return;case"ArrowDown":a=babelHelpers.classPrivateFieldGet(this,Jt).chooseNextItem();if(a&&a.address){Xt(this,ks,la).call(this,a,i)}return}}if(babelHelpers.classPrivateFieldGet(this,Ut).isChanged()){babelHelpers.classPrivateFieldGet(this,Ut).actualize();this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ut).value)}if(babelHelpers.classPrivateFieldGet(this,Ut).value.length===0){Xt(this,os,Ds).call(this)}};var ia=function e(){var t=this;setTimeout((function(){if(babelHelpers.classPrivateFieldGet(t,ss)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(t,Ut).isChanged()){Xt(t,ms,qs).call(t,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(t,Ut).isChanged()){babelHelpers.classPrivateFieldGet(t,Ut).actualize();t.showPrompt(babelHelpers.classPrivateFieldGet(t,Ut).value)}}),0)};var la=function e(t,s){var a=this;if(babelHelpers.classPrivateFieldGet(this,ns)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,ns))}babelHelpers.classPrivateFieldSet(this,ns,setTimeout((function(){Xt(a,Is,ta).call(a,t)}),s))};var ra=function e(t){if(t.length<=3){return}if(babelHelpers.classPrivateFieldGet(this,Qt)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,Qt))}babelHelpers.classPrivateFieldSet(this,Qt,Xt(this,As,na).call(this,t))};var na=function e(t){var s=this;return setTimeout((function(){if(babelHelpers.classPrivateFieldGet(s,ls)){clearTimeout(babelHelpers.classPrivateFieldGet(s,Qt));babelHelpers.classPrivateFieldSet(s,Qt,Xt(s,As,e).call(s,t));babelHelpers.classPrivateFieldSet(s,rs,true);return}babelHelpers.classPrivateFieldSet(s,rs,false);s.emit(Rt(Ws,Ws,Ls));babelHelpers.classPrivateFieldSet(s,ls,true);var a=Xt(s,hs,Vs).call(s);babelHelpers.classPrivateFieldGet(s,Zt).autocomplete(t,a).then((function(e){babelHelpers.classPrivateFieldSet(s,Qt,null);if(!babelHelpers.classPrivateFieldGet(s,rs)){Xt(s,Hs,js).call(s,e,a);s.emit(Rt(Ws,Ws,zs))}babelHelpers.classPrivateFieldSet(s,ls,false)}),(function(e){if(!babelHelpers.classPrivateFieldGet(s,rs)){s.emit(Rt(Ws,Ws,zs))}babelHelpers.classPrivateFieldSet(s,ls,false);BX.debug(e)}))}),300)};function da(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);da=function t(){return e};return e}function oa(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);oa=function t(){return e};return e}var ba=new WeakMap;var ca=new WeakMap;var ua=new WeakMap;var pa=new WeakMap;var va=new WeakMap;var ha=function(){function e(t){babelHelpers.classCallCheck(this,e);ba.set(this,{writable:true,value:void 0});ca.set(this,{writable:true,value:void 0});ua.set(this,{writable:true,value:void 0});pa.set(this,{writable:true,value:void 0});va.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ca,t.url);babelHelpers.classPrivateFieldSet(this,ua,t.link||"");babelHelpers.classPrivateFieldSet(this,ba,t.description||"");babelHelpers.classPrivateFieldSet(this,pa,t.location);babelHelpers.classPrivateFieldSet(this,va,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,ba)){t=o.Tag.render(oa(),babelHelpers.classPrivateFieldGet(this,ba))}return o.Tag.render(da(),t,babelHelpers.classPrivateFieldGet(this,ua),babelHelpers.classPrivateFieldGet(this,va),babelHelpers.classPrivateFieldGet(this,pa).externalId,babelHelpers.classPrivateFieldGet(this,ca))}}]);return e}();function fa(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=Ha(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function Ha(e,t){if(!e)return;if(typeof e==="string")return Fa(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Fa(e,t)}function Fa(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Pa(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);Pa=function t(){return e};return e}function ma(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);ma=function t(){return e};return e}function ga(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ta=new WeakMap;var ya=new WeakMap;var wa=new WeakMap;var Ia=new WeakMap;var Ga=new WeakMap;var Sa=new WeakMap;var Ea=new WeakMap;var ka=new WeakMap;var Ca=new WeakSet;var Aa=new WeakSet;var Wa=function(){function e(t){babelHelpers.classCallCheck(this,e);Aa.add(this);Ca.add(this);Ta.set(this,{writable:true,value:[]});ya.set(this,{writable:true,value:null});wa.set(this,{writable:true,value:null});Ia.set(this,{writable:true,value:void 0});Ga.set(this,{writable:true,value:void 0});Sa.set(this,{writable:true,value:void 0});Ea.set(this,{writable:true,value:void 0});ka.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ia,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,Ga,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,Ea,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,Sa,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,ka)){babelHelpers.classPrivateFieldGet(this,Sa).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,ka),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,Ia),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,Ga),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,Ea)}).then((function(e){if(Array.isArray(e)&&e.length>0){ga(t,Ca,_a).call(t,e);t.show()}else{t.hide()}}))}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ya)){babelHelpers.classPrivateFieldGet(this,ya).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,ya)||babelHelpers.classPrivateFieldGet(this,ya).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ya)){babelHelpers.classPrivateFieldGet(this,ya).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,wa,o.Tag.render(ma()));babelHelpers.classPrivateFieldSet(this,ya,o.Tag.render(Pa(),babelHelpers.classPrivateFieldGet(this,wa)));return babelHelpers.classPrivateFieldGet(this,ya)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,ka,t);this.refresh()}}]);return e}();var _a=function e(t){if(!babelHelpers.classPrivateFieldGet(this,ka)){return}var s=[];var a=fa(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new ha({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,ka),title:babelHelpers.classPrivateFieldGet(this,ka).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,Ta,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,Ta).push(d)}if(babelHelpers.classPrivateFieldGet(this,Ta).length>0&&babelHelpers.classPrivateFieldGet(this,wa)){var o=babelHelpers.classPrivateFieldGet(this,Ta)?ga(this,Aa,Ma).call(this,babelHelpers.classPrivateFieldGet(this,Ta)):"";babelHelpers.classPrivateFieldGet(this,wa).innerHTML="";if(o.length>0){var b=fa(o),c;try{for(b.s();!(c=b.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,wa).appendChild(u)}}catch(e){b.e(e)}finally{b.f()}}}};var Ma=function e(t){var s=[];var a=fa(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function La(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);La=function t(){return e};return e}function za(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);za=function t(){return e};return e}function Oa(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);Oa=function t(){return e};return e}function Na(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);Na=function t(){return e};return e}function Da(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Ba(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var Ra=new WeakMap;var Xa=new WeakMap;var xa=new WeakMap;var Ua=new WeakMap;var Va=new WeakMap;var Ya=new WeakMap;var ja=new WeakMap;var Ka=new WeakMap;var $a=new WeakMap;var qa=new WeakSet;var Ja=new WeakSet;var Za=new WeakSet;var Qa=new WeakSet;var ei=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Qa.add(babelHelpers.assertThisInitialized(s));Za.add(babelHelpers.assertThisInitialized(s));Ja.add(babelHelpers.assertThisInitialized(s));qa.add(babelHelpers.assertThisInitialized(s));Ra.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ua.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Va.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ya.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ja.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ka.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});$a.set(babelHelpers.assertThisInitialized(s),{writable:true,value:b.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ra,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),xa,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ua,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Xa,typeof t.value==="string"?t.value:"");if(!r.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Va,t.mode);babelHelpers.classPrivateFieldSet(this,Ka,o.Tag.render(Na(),babelHelpers.classPrivateFieldGet(this,Ra)));if(babelHelpers.classPrivateFieldGet(this,Va)===r.ControlMode.edit){Da(this,Ja,ii).call(this,babelHelpers.classPrivateFieldGet(this,Ka))}else{Da(this,Za,li).call(this,babelHelpers.classPrivateFieldGet(this,Ka))}return babelHelpers.classPrivateFieldGet(this,Ka)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe(Ba(t,t,ti),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(Ba(t,t,si),s)}},{key:"destroy",value:function e(){o.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ka));o.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,Ka,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ka)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,$a)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,xa,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,xa)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ua,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ua)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,Xa,typeof t==="string"?t:"");Da(this,Qa,ri).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Xa)}}]);return t}(d.EventEmitter);var ti={writable:true,value:"onValueChanged"};var si={writable:true,value:"onStateChanged"};var ai=function e(t){babelHelpers.classPrivateFieldSet(this,$a,t);this.emit(Ba(ei,ei,si),{state:babelHelpers.classPrivateFieldGet(this,$a)})};var ii=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,Ya,o.Tag.render(Oa(),o.Text.encode(babelHelpers.classPrivateFieldGet(this,Xa))));babelHelpers.classPrivateFieldSet(this,ja,null);o.Event.bind(babelHelpers.classPrivateFieldGet(this,Ya),"focus",(function(e){Da(s,qa,ai).call(s,b.DATA_INPUTTING)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Ya),"focusout",(function(e){Da(s,qa,ai).call(s,b.DATA_SELECTED)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Ya),"change",(function(e){Da(s,qa,ai).call(s,b.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,Xa,babelHelpers.classPrivateFieldGet(s,Ya).value);s.emit(Ba(ei,ei,ti),{value:s})}));t.appendChild(o.Tag.render(za(),babelHelpers.classPrivateFieldGet(this,Ya)))};var li=function e(t){babelHelpers.classPrivateFieldSet(this,Ya,null);babelHelpers.classPrivateFieldSet(this,ja,o.Tag.render(La(),o.Text.encode(babelHelpers.classPrivateFieldGet(this,Xa))));t.appendChild(babelHelpers.classPrivateFieldGet(this,ja))};var ri=function e(){if(babelHelpers.classPrivateFieldGet(this,Va)===r.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Ya).value=babelHelpers.classPrivateFieldGet(this,Xa)}else{babelHelpers.classPrivateFieldGet(this,ja).innerHTML=o.Text.encode(babelHelpers.classPrivateFieldGet(this,Xa))}};function ni(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=di(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function di(e,t){if(!e)return;if(typeof e==="string")return oi(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return oi(e,t)}function oi(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function bi(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ci(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ui=new WeakMap;var pi=new WeakMap;var vi=new WeakMap;var hi=new WeakMap;var fi=new WeakMap;var Hi=new WeakMap;var Fi=new WeakMap;var Pi=new WeakSet;var mi=new WeakSet;var gi=new WeakSet;var Ti=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));gi.add(babelHelpers.assertThisInitialized(s));mi.add(babelHelpers.assertThisInitialized(s));Pi.add(babelHelpers.assertThisInitialized(s));ui.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});pi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});vi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});hi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});fi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Hi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Fi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),pi,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),fi,e.languageId);ci(babelHelpers.assertThisInitialized(s),Pi,Ii).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof r.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ui,t.address);if(!r.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,vi,t.mode);if(!o.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,Hi,t.container);var s=ni(babelHelpers.classPrivateFieldGet(this,hi)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;var l=babelHelpers.classPrivateFieldGet(this,ui)?babelHelpers.classPrivateFieldGet(this,ui).getFieldValue(i.type):"";if(babelHelpers.classPrivateFieldGet(this,vi)===r.ControlMode.view&&!l){continue}var n=i.render({value:l,mode:babelHelpers.classPrivateFieldGet(this,vi)});babelHelpers.classPrivateFieldGet(this,Hi).appendChild(n)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(bi(t,t,yi),s)}},{key:"destroy",value:function e(){o.Event.unbindAll(this);var t=ni(babelHelpers.classPrivateFieldGet(this,hi)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}o.Dom.clean(babelHelpers.classPrivateFieldGet(this,Hi))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(bi(t,t,wi),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,ui,t);var s=ni(babelHelpers.classPrivateFieldGet(this,hi)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;i.value=babelHelpers.classPrivateFieldGet(this,ui)?babelHelpers.classPrivateFieldGet(this,ui).getFieldValue(i.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Fi)}}]);return t}(d.EventEmitter);var yi={writable:true,value:"onAddressChanged"};var wi={writable:true,value:"onStateChanged"};var Ii=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,pi).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,pi).fieldCollection.fields[s];var i=new ei({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent((function(e){ci(t,mi,Gi).call(t,i)}));i.subscribeOnStateChangedEvent((function(e){var s=e.getData();ci(t,gi,Si).call(t,s.state)}));babelHelpers.classPrivateFieldGet(t,hi).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,pi).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,hi).sort((function(e,t){return e.sort-t.sort}))};var Gi=function e(t){if(!babelHelpers.classPrivateFieldGet(this,ui)){babelHelpers.classPrivateFieldSet(this,ui,new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,fi)}))}babelHelpers.classPrivateFieldGet(this,ui).setFieldValue(t.type,t.value);this.emit(bi(Ti,Ti,yi),{address:babelHelpers.classPrivateFieldGet(this,ui),changedField:t})};var Si=function e(t){babelHelpers.classPrivateFieldSet(this,Fi,t);this.emit(bi(Ti,Ti,wi),{state:babelHelpers.classPrivateFieldGet(this,Fi)})};var Ei=new WeakMap;var ki=new WeakMap;var Ci=new WeakMap;var Ai=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ei.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});ki.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ci.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof Z)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ei,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ei).onChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ci).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))}));return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!babelHelpers.classPrivateFieldGet(this,Ei).isShown()){babelHelpers.classPrivateFieldGet(this,Ei).show(t)}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ei).isShown()){babelHelpers.classPrivateFieldGet(this,Ei).close()}babelHelpers.classPrivateFieldGet(this,Ei).bindelement=babelHelpers.classPrivateFieldGet(this,ki)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!o.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,ki,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,Ei).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,Ci).address,mode:babelHelpers.classPrivateFieldGet(this,Ci).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,Ei).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ci,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ei).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ei).destroy();babelHelpers.classPrivateFieldSet(this,Ei,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ei)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ci)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,ki)}}]);return t}(ce);var Wi=new WeakMap;var _i=new WeakMap;var Mi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Wi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_i.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof Ws)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Wi,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wi).onAddressChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_i).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s),t.excludeSetAddressFeatures,t.options)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wi).onStateChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_i).setStateByFeature(t.state)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wi).onSearchStartedEventSubscribe((function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_i).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchStartedEvent,payload:a})}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wi).onSearchCompletedEventSubscribe((function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_i).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchCompletedEvent,payload:a})}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wi).onShowOnMapClickedEventSubscribe((function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_i).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.showOnMapClickedEvent,payload:a})}));return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Wi).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,_i).mode===r.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Wi).render({inputNode:babelHelpers.classPrivateFieldGet(this,_i).inputNode,menuNode:t.autocompleteMenuElement,address:babelHelpers.classPrivateFieldGet(this,_i).address,mode:babelHelpers.classPrivateFieldGet(this,_i).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Wi).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,_i,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Wi).destroy();babelHelpers.classPrivateFieldSet(this,Wi,null)}}]);return t}(ce);babelHelpers.defineProperty(Mi,"searchStartedEvent","searchStarted");babelHelpers.defineProperty(Mi,"searchCompletedEvent","searchCompleted");babelHelpers.defineProperty(Mi,"showOnMapClickedEvent","showOnMapClicked");var Li=new WeakMap;var zi=new WeakMap;var Oi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Li.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});zi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof Ti)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Li,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Li).subscribeOnAddressChangedEvent((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),zi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Li).subscribeOnStateChangedEvent((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),zi).setStateByFeature(t.state)}));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,zi).mode===r.ControlMode.edit){if(!o.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,Li).render({address:babelHelpers.classPrivateFieldGet(this,zi).address,mode:babelHelpers.classPrivateFieldGet(this,zi).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,zi,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Li).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Li).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Li).destroy();babelHelpers.classPrivateFieldSet(this,Li,null)}}]);return t}(ce);function Ni(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Di=new WeakMap;var Bi=new WeakMap;var Ri=new WeakMap;var Xi=new WeakMap;var xi=new WeakMap;var Ui=new WeakSet;var Vi=new WeakSet;var Yi=new WeakSet;var ji=new WeakSet;var Ki=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));ji.add(babelHelpers.assertThisInitialized(s));Yi.add(babelHelpers.assertThisInitialized(s));Vi.add(babelHelpers.assertThisInitialized(s));Ui.add(babelHelpers.assertThisInitialized(s));Di.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Bi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});Ri.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Xi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});xi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",Ni(this,Ui,$i).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",Ni(this,Yi,Ji).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",Ni(this,ji,Zi).bind(this));document.addEventListener("click",Ni(this,Vi,qi).bind(this));this.map.onMouseOverSubscribe(Ni(this,Yi,Ji).bind(this));this.map.onMouseOutSubscribe(Ni(this,ji,Zi).bind(this))}},{key:"setAddress",value:function e(t){if(!t){this.closeMap()}this.map.address=t;if(t&&this.addressWidget.state!==b.DATA_SUPPOSED){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,xi)){return}document.removeEventListener("click",Ni(this,Vi,qi));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",Ni(this,Ui,$i));this.addressWidget.controlWrapper.removeEventListener("mouseover",Ni(this,Yi,Ji));this.addressWidget.controlWrapper.removeEventListener("mouseout",Ni(this,ji,Zi))}babelHelpers.classPrivateFieldSet(this,Di,null);babelHelpers.classPrivateFieldSet(this,Ri,null);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,xi,true)}}]);return t}(Ai);var $i=function e(t){if(babelHelpers.classPrivateFieldGet(this,xi)){return}if(this.addressWidget.mode===r.ControlMode.view){if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,Di))}}else if(this.addressWidget.mode===r.ControlMode.edit&&this._saveResourceStrategy===false){if(this.addressWidget.address&&!this.map.isShown()&&t.target===this.addressWidget.inputNode){this.showMap()}}};var qi=function e(t){if(babelHelpers.classPrivateFieldGet(this,xi)){return}if(this.addressWidget.inputNode!==t.target){this.closeMap()}};var Ji=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,xi)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Di));clearTimeout(babelHelpers.classPrivateFieldGet(this,Ri));if(this.addressWidget.mode!==r.ControlMode.view){return}if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Di,setTimeout((function(){t.showMap()}),babelHelpers.classPrivateFieldGet(this,Bi)))}};var Zi=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,xi)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Di));clearTimeout(babelHelpers.classPrivateFieldGet(this,Ri));if(this.addressWidget.mode!==r.ControlMode.view){return}if(this.addressWidget.mode===r.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Ri,setTimeout((function(){t.closeMap()}),babelHelpers.classPrivateFieldGet(this,Xi)))}};var Qi=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var i=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var l=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var n=new r.Location(JSON.parse(BX.message("LOCATION_WIDGET_USER_LOCATION_POINT")));var d=t.addressFormat||new r.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var o=t.presetLocationsProvider?t.presetLocationsProvider:function(){return t.presetLocationList?t.presetLocationList:[]};var b=[];if(!t.useFeatures||t.useFeatures.fields!==false){b.push(this.createFieldsFeature({addressFormat:d,languageId:i}))}var c=null;if(s&&a){try{c=this.createSource(s,a,i,l)}catch(e){if(e instanceof r.SourceCreationError){c=null}else{throw e}}}var u=null;if(c){if(!t.useFeatures||t.useFeatures.autocomplete!==false){b.push(this.createAutocompleteFeature({languageId:i,addressFormat:d,source:c,userLocationPoint:n,presetLocationsProvider:o}))}if(!t.useFeatures||t.useFeatures.map!==false){var p=!!a.showPhotos;var v=!!a.useGeocodingService;var h=80;var f=150;var H=p?5:0;var F="auto";u=this.createMapFeature({addressFormat:d,source:c,useGeocodingService:v,popupOptions:t.popupOptions,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||h,thumbnailWidth:t.thumbnailWidth||f,maxPhotoCount:t.maxPhotoCount||H,mapBehavior:t.mapBehavior||F,userLocationPoint:n});b.push(u)}}var P=new De({features:b,address:t.address,mode:t.mode,addressFormat:d,languageId:i});if(u){P.subscribeOnFeatureEvent((function(e){var t=e.getData();if(t.feature instanceof Mi&&t.eventCode===Mi.showOnMapClickedEvent){u.showMap(true)}}))}return P}},{key:"createFieldsFeature",value:function e(t){var s=new Ti({addressFormat:t.addressFormat,languageId:t.languageId});return new Oi({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new Ws({sourceCode:t.source.sourceCode,languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService,userLocationPoint:t.userLocationPoint,presetLocationsProvider:t.presetLocationsProvider});return new Mi({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s={cacheable:true,closeByEsc:true,className:"location-popup-window location-source-".concat(t.source.sourceCode),animation:"fading",angle:true,bindOptions:t.popupBindOptions};if(t.popupOptions){s=Object.assign(s,t.popupOptions)}var i=new w(s);var l=null;if(t.maxPhotoCount>0){l=new Wa({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var n={saveResourceStrategy:t.source.sourceCode===a.Google.code,map:new Z({addressFormat:t.addressFormat,map:t.source.map,popup:i,gallery:l,locationRepository:new r.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null,userLocationPoint:t.userLocationPoint})};var d;if(t.mapBehavior==="manual"){d=new Ai(n)}else{d=new Ki(n)}return d}},{key:"createSource",value:function e(t,i,l,r){var n=null;i.languageId=l;i.sourceLanguageId=r;if(t===a.Google.code){n=new a.Google(i)}else if(t===s.OSM.code){n=s.OSMFactory.createOSMSource(i)}else{throw new RangeError("Wrong source code")}return n}}]);return e}();function el(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);el=function t(){return e};return e}function tl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function sl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var al=new WeakMap;var il=new WeakMap;var ll=new WeakMap;var rl=new WeakSet;var nl=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));rl.add(babelHelpers.assertThisInitialized(e));al.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});il.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});ll.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),al,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),ll,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,il,o.Tag.render(el(),sl(this,rl,ol).call(this)));babelHelpers.classPrivateFieldGet(this,il).addEventListener("click",(function(e){a.state=babelHelpers.classPrivateFieldGet(a,al)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit(tl(t,t,dl),{state:babelHelpers.classPrivateFieldGet(a,al)});e.stopPropagation();return false}));babelHelpers.classPrivateFieldGet(this,il).addEventListener("mouseover",(function(e){e.stopPropagation()}));return babelHelpers.classPrivateFieldGet(this,il)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe(tl(t,t,dl),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,al,t);if(babelHelpers.classPrivateFieldGet(this,il)){babelHelpers.classPrivateFieldGet(this,il).innerHTML=sl(this,rl,ol).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,al)}}]);return t}(d.EventEmitter);babelHelpers.defineProperty(nl,"STATE_OFF",0);babelHelpers.defineProperty(nl,"STATE_ON",1);var dl={writable:true,value:"onToggleEvent"};var ol=function e(){return babelHelpers.classPrivateFieldGet(this,ll)[babelHelpers.classPrivateFieldGet(this,al)]};function bl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);bl=function t(){return e};return e}function cl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ul(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var pl=new WeakMap;var vl=new WeakMap;var hl=new WeakSet;var fl=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));hl.add(babelHelpers.assertThisInitialized(e));pl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});vl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,pl,s.type);babelHelpers.classPrivateFieldSet(this,vl,o.Tag.render(bl(),ul(this,hl,Fl).call(this,babelHelpers.classPrivateFieldGet(this,pl))));babelHelpers.classPrivateFieldGet(this,vl).addEventListener("click",(function(e){a.emit(cl(t,t,Hl))}));return babelHelpers.classPrivateFieldGet(this,vl)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(cl(t,t,Hl),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,pl,t);if(babelHelpers.classPrivateFieldGet(this,vl)){babelHelpers.classPrivateFieldGet(this,vl).className=ul(this,hl,Fl).call(this,babelHelpers.classPrivateFieldGet(this,pl))}}}]);return t}(d.EventEmitter);var Hl={writable:true,value:"onClick"};babelHelpers.defineProperty(fl,"TYPE_CLEAR","clear");babelHelpers.defineProperty(fl,"TYPE_SEARCH","search");babelHelpers.defineProperty(fl,"TYPE_LOADER","loader");var Fl=function e(t){var s="";if(t===fl.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===fl.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===fl.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function Pl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Pl=function t(){return e};return e}function ml(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);ml=function t(){return e};return e}function gl(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);gl=function t(){return e};return e}function Tl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);Tl=function t(){return e};return e}function yl(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);yl=function t(){return e};return e}function wl(){var e=babelHelpers.taggedTemplateLiteral(["",""]);wl=function t(){return e};return e}function Il(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);Il=function t(){return e};return e}function Gl(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);Gl=function t(){return e};return e}function Sl(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);Sl=function t(){return e};return e}function El(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function kl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Cl=new WeakSet;var Al=new WeakSet;var Wl=new WeakSet;var _l=new WeakSet;var Ml=new WeakSet;var Ll=new WeakSet;var zl=new WeakSet;var Ol=new WeakSet;var Nl=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ol.add(babelHelpers.assertThisInitialized(s));zl.add(babelHelpers.assertThisInitialized(s));Ll.add(babelHelpers.assertThisInitialized(s));Ml.add(babelHelpers.assertThisInitialized(s));_l.add(babelHelpers.assertThisInitialized(s));Wl.add(babelHelpers.assertThisInitialized(s));Al.add(babelHelpers.assertThisInitialized(s));Cl.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var i=this.getValue();var l=null;if(o.Type.isStringFilled(i)){try{l=new r.Address(JSON.parse(i))}catch(e){BX.debug("Cant parse address value");return}}var n=new Qi;this._addressWidget=n.createAddressWidget({address:l,mode:this._mode===BX.UI.EntityEditorMode.edit?r.ControlMode.edit:r.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(kl(this,Ml,Ul).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(kl(this,Ll,Vl).bind(this));this._fieldsSwitch=new nl({state:nl.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(kl(this,Al,Rl).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?r.ControlMode.edit:r.ControlMode.view;this._fieldsSwitch.state=nl.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=kl(this,Ol,jl).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;o.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?kl(this,Ol,jl).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=o.Tag.render(Sl(),"".concat(this.getName(),"_STRING"));this._hiddenInput=o.Tag.render(Gl(),this.getValue(),this.getName());this._inputIcon=new fl;this._inputIcon.subscribeOnClickEvent(kl(this,Cl,Bl).bind(this));var l=this._inputIcon.render({type:El(t,t,Dl).call(t,kl(this,Ol,jl).call(this))});this._inputContainer=o.Tag.render(Il(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(o.Tag.render(wl(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=o.Tag.render(yl(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=o.Tag.render(Tl());if(this._fieldsSwitch.state===nl.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var n=kl(this,zl,Yl).call(this,kl(this,Ol,jl).call(this));r=o.Tag.render(gl(),n);this._innerWrapper=o.Tag.render(ml(),r);i.mapBindElement=r}else{this._innerWrapper=o.Tag.render(Pl(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=fl.TYPE_CLEAR}if(!o.Type.isArray(i)){return}i.forEach((function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)}))}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",(function(e,s){s.methods.address=t.registerFieldMethod}))}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var Dl=function e(t){return t?fl.TYPE_CLEAR:fl.TYPE_SEARCH};var Bl=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=fl.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var Rl=function e(t){var s=t.getData();var a=s.state;if(a===nl.STATE_OFF){kl(this,Wl,Xl).call(this)}else{kl(this,_l,xl).call(this)}this._addressWidget.resetView()};var Xl=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var xl=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var Ul=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===n.State.DATA_LOADING){i=fl.TYPE_LOADER}else{if(s.state===n.State.DATA_INPUTTING){this.markAsChanged()}i=El(Nl,Nl,Dl).call(Nl,kl(this,Ol,jl).call(this))}this._inputIcon.type=i};var Vl=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=El(Nl,Nl,Dl).call(Nl,a)}};var Yl=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var jl=function e(){return this._addressWidget.address};Nl.registerField();e.Address=De;e.BaseFeature=ce;e.MapFeature=Ai;e.AutocompleteFeature=Mi;e.FieldsFeature=Oi;e.Factory=Qi;e.State=b;e.UIAddress=Nl})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX,BX.Location.OSM,BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js