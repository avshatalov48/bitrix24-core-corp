this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n,d){"use strict";var b=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(b,"INITIAL","INITIAL");babelHelpers.defineProperty(b,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(b,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(b,"DATA_SUPPOSED","DATA_SUPPOSED");babelHelpers.defineProperty(b,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(b,"DATA_LOADED","DATA_LOADED");var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new l.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new l.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function c(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=u(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function u(e,t){if(!e)return;if(typeof e==="string")return p(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(e,t)}function p(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function v(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var h=new WeakMap;var f=new WeakMap;var H=new WeakMap;var F=new WeakMap;var P=new WeakMap;var m=new WeakMap;var g=new WeakMap;var T=new WeakMap;var w=new WeakMap;var y=new WeakMap;var I=new WeakMap;var G=new WeakMap;var S=new WeakMap;var k=new WeakSet;var E=new WeakSet;var C=new WeakSet;var W=new WeakSet;var A=new WeakSet;var M=new WeakSet;var z=new WeakSet;var _=new WeakSet;var L=new WeakSet;var O=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));L.add(babelHelpers.assertThisInitialized(s));_.add(babelHelpers.assertThisInitialized(s));z.add(babelHelpers.assertThisInitialized(s));M.add(babelHelpers.assertThisInitialized(s));A.add(babelHelpers.assertThisInitialized(s));W.add(babelHelpers.assertThisInitialized(s));C.add(babelHelpers.assertThisInitialized(s));E.add(babelHelpers.assertThisInitialized(s));k.add(babelHelpers.assertThisInitialized(s));h.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});f.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});H.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});F.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});P.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});m.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});g.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});T.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});w.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});y.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});I.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});G.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});S.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),F,e.addressFormat);if(e.address&&!(e.address instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),H,e.address||null);if(!l.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),h,e.mode);if(!d.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),P,e.languageId);if(e.features){if(!d.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach(function(e){v(babelHelpers.assertThisInitialized(s),k,N).call(babelHelpers.assertThisInitialized(s),e)})}if(d.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof l.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),S,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),G)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),S,new l.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),f,b.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var i=babelHelpers.classPrivateFieldGet(this,H)?babelHelpers.classPrivateFieldGet(this,H).id:0;if(t&&!t.getFieldValue(l.AddressType.ADDRESS_LINE_1)&&babelHelpers.classPrivateFieldGet(this,F).isTemplateExists(l.FormatTemplateType.ADDRESS_LINE_1)){t.setFieldValue(l.AddressType.ADDRESS_LINE_1,l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,F).getTemplate(l.FormatTemplateType.ADDRESS_LINE_1),l.AddressStringConverter.CONTENT_TYPE_TEXT,null,babelHelpers.classPrivateFieldGet(this,F)))}babelHelpers.classPrivateFieldSet(this,H,t);if(i>0){babelHelpers.classPrivateFieldGet(this,H).id=i}babelHelpers.classPrivateFieldSet(this,y,true);v(this,z,U).call(this,t);v(this,E,D).call(this,"setAddress",[t],s,a);if(babelHelpers.classPrivateFieldGet(this,f)!==b.DATA_INPUTTING){v(this,C,B).call(this)}}},{key:"emitFeatureEvent",value:function e(s){this.emit(t.onFeatureEvent,s)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break;default:babelHelpers.classPrivateFieldSet(this,I,true)}}},{key:"resetView",value:function e(){v(this,E,D).call(this,"resetView")}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,T,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,h)===l.ControlMode.edit){if(!d.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,g,t.inputNode);v(this,z,U).call(this,babelHelpers.classPrivateFieldGet(this,H))}v(this,E,D).call(this,"render",[t]);if(babelHelpers.classPrivateFieldGet(this,h)===l.ControlMode.edit){d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focus",v(this,A,X).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focusout",v(this,_,Y).bind(this));d.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup.bind(this))}}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,f,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnFeatureEvent",value:function e(s){this.subscribe(t.onFeatureEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){l.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,w)){return}d.Event.unbindAll(this);d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focus",v(this,A,X));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focusout",v(this,_,Y));d.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup);v(this,E,D).call(this,"destroy");v(this,L,V).call(this);babelHelpers.classPrivateFieldSet(this,w,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,w)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,T)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,H)},set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,H,t);v(this,E,D).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,y,false);v(this,z,U).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,h)},set:function e(t){if(!l.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,h,t);v(this,E,D).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,F)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(O,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(O,"onStateChangedEvent","onStateChanged");babelHelpers.defineProperty(O,"onFeatureEvent","onFeatureEvent");var N=function e(t){if(!(t instanceof o)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,m).push(t)};var D=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var l;var r=c(babelHelpers.classPrivateFieldGet(this,m)),n;try{for(r.s();!(n=r.n()).done;){var d=n.value;var b=false;var o=c(i),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;if(d instanceof p){b=true;break}}}catch(e){o.e(e)}finally{o.f()}if(!b&&d!==a){l=d[t].apply(d,s)}}}catch(e){r.e(e)}finally{r.f()}return l};var B=function e(){this.emit(O.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,H)});if(babelHelpers.classPrivateFieldGet(this,H)&&babelHelpers.classPrivateFieldGet(this,G)){v(this,W,R).call(this,babelHelpers.classPrivateFieldGet(this,H))}};var R=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,S).findParents(t.location)}};var X=function e(t){var s=babelHelpers.classPrivateFieldGet(this,g).value;if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,g),s.length-1)}};var x=function e(t,s){var a="";if(t){if(!babelHelpers.classPrivateFieldGet(this,F).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,F).code,'" does not have a template "').concat(s,'"'));return""}a=l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,F).getTemplate(s),l.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,F))}return a};var U=function e(t){if(babelHelpers.classPrivateFieldGet(this,g)){var s=v(this,M,x).call(this,t,l.FormatTemplateType.AUTOCOMPLETE);var a=v(this,M,x).call(this,t,l.FormatTemplateType.DEFAULT);babelHelpers.classPrivateFieldGet(this,g).value=s.trim()!==""?s:a;babelHelpers.classPrivateFieldGet(this,g).title=a;var i=babelHelpers.classPrivateFieldGet(this,g).selectionStart;var r=s.length;babelHelpers.classPrivateFieldGet(this,g).setSelectionRange(i,r)}};var Y=function e(t){if(babelHelpers.classPrivateFieldGet(this,I)&&!babelHelpers.classPrivateFieldGet(this,y)){var s=babelHelpers.classPrivateFieldGet(this,g).value.trim();var a=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,P)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,F).fieldForUnRecognized,s);this.address=a;v(this,C,B).call(this)}babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,y,false)};var V=function e(){babelHelpers.classPrivateFieldGet(this,m).splice(0,babelHelpers.classPrivateFieldGet(this,m).length)};function j(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<span class="location-map-popup-item--info"> \t\t\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t"]);j=function t(){return e};return e}function K(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);K=function t(){return e};return e}function q(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-popup-item--info-left"></div>']);q=function t(){return e};return e}var J=new WeakMap;var $=new WeakMap;var Z=new WeakMap;var Q=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));J.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});$.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});Z.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Autocomplete.MenuBottom");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,$,d.Tag.render(q()));babelHelpers.classPrivateFieldSet(this,Z,d.Tag.render(K()));babelHelpers.classPrivateFieldSet(this,J,d.Tag.render(j(),babelHelpers.classPrivateFieldGet(this,$),babelHelpers.classPrivateFieldGet(this,Z)));return babelHelpers.classPrivateFieldGet(this,J)}},{key:"setRightItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,Z).firstChild){babelHelpers.classPrivateFieldGet(this,Z).removeChild(babelHelpers.classPrivateFieldGet(this,Z).firstChild)}babelHelpers.classPrivateFieldGet(this,Z).appendChild(t)}},{key:"setLeftItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,$).firstChild){babelHelpers.classPrivateFieldGet(this,$).removeChild(babelHelpers.classPrivateFieldGet(this,$).firstChild)}babelHelpers.classPrivateFieldGet(this,$).appendChild(t)}}]);return t}(n.EventEmitter);var ee=new WeakMap;var te=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});var a=e.bindElement.getBoundingClientRect();s.popupWindow.setMaxWidth(a.width);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ee,new Q);s.layout.menuContainer.appendChild(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),ee).render());return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[t]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){var s=t;if(s<0){s=this.menuItems.length-1}else if(s>this.menuItems.length-1){s=0}this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=s;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}},{key:"setBottomRightItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,ee).setRightItemNode(t)}},{key:"setBottomLeftItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,ee).setLeftItemNode(t)}}]);return t}(a.Menu);function se(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=ae(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function ae(e,t){if(!e)return;if(typeof e==="string")return ie(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ie(e,t)}function ie(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function le(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var re=new WeakMap;var ne=new WeakMap;var de=new WeakMap;var be=new WeakMap;var oe=new WeakSet;var ce=new WeakSet;var ue=new WeakSet;var pe=new WeakSet;var ve=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));pe.add(babelHelpers.assertThisInitialized(s));ue.add(babelHelpers.assertThisInitialized(s));ce.add(babelHelpers.assertThisInitialized(s));oe.add(babelHelpers.assertThisInitialized(s));re.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ne.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});de.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});be.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),re,e.inputNode);if(e.menuNode){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ne,e.menuNode)}return s}babelHelpers.createClass(t,[{key:"getMenu",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,de)||babelHelpers.classPrivateFieldGet(this,de).isDestroyed()){babelHelpers.classPrivateFieldSet(this,de,le(this,oe,he).call(this))}return babelHelpers.classPrivateFieldGet(this,de)}},{key:"show",value:function e(t,s){if(t.length>0){this.setMenuItems(t,s);this.getMenu().show()}}},{key:"close",value:function e(){this.getMenu().close()}},{key:"setMenuItems",value:function e(t,s,a){var i=this;this.getMenu().clearItems();if(Array.isArray(t)){var r=false;babelHelpers.classPrivateFieldSet(this,be,t.slice());t.forEach(function(e){if(a&&a.getFieldValue(l.AddressType.LOCALITY)){if(!r&&e&&e.address&&e.address.getFieldValue(l.AddressType.LOCALITY)){if(a.getFieldValue(l.AddressType.LOCALITY)!==e.address.getFieldValue(l.AddressType.LOCALITY)){r=true;i.getMenu().addMenuItem({html:d.Loc.getMessage("LOCATION_WIDGET_PROMPT_IN_OTHER_CITY"),delimiter:true})}}}i.getMenu().addMenuItem(le(i,ce,fe).call(i,e,s))})}}},{key:"choosePrevItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s=null;var a=this.getMenu().choosePrevItem();if(a){if(a.delimiter&&a.delimiter===true){s=t?this.getMenu().chooseNextItem():this.choosePrevItem(true)}else{s=le(this,pe,Fe).call(this,a.id)}}return s}},{key:"chooseNextItem",value:function e(){var t=null;var s=this.getMenu().chooseNextItem();if(s){if(s.delimiter&&s.delimiter===true){t=this.chooseNextItem()}else{t=le(this,pe,Fe).call(this,s.id)}}return t}},{key:"isItemChosen",value:function e(){return babelHelpers.classPrivateFieldGet(this,de).isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=babelHelpers.classPrivateFieldGet(this,de).getChosenItem();if(s&&s.id){t=le(this,pe,Fe).call(this,s.id)}return t}},{key:"isShown",value:function e(){return this.getMenu().isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,de)){babelHelpers.classPrivateFieldGet(this,de).destroy();babelHelpers.classPrivateFieldSet(this,de,null)}babelHelpers.classPrivateFieldSet(this,be,null)}}],[{key:"createMenuItemText",value:function e(t,s,a){var i="\n\t\t<div>\n\t\t\t<strong>".concat(t,"</strong>\n\t\t</div>");var r;if(a.getFieldValue(l.LocationType.TMP_TYPE_CLARIFICATION)){r=a.getFieldValue(l.LocationType.TMP_TYPE_CLARIFICATION);if(r){if(a.getFieldValue(l.LocationType.TMP_TYPE_HINT)){r+=" <i>(".concat(a.getFieldValue(l.LocationType.TMP_TYPE_HINT),")</i>")}i+="<div>".concat(r,"</div>")}}return i}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(ve,"onItemSelectedEvent","onItemSelected");var he=function e(){return new te({bindElement:babelHelpers.classPrivateFieldGet(this,ne)?babelHelpers.classPrivateFieldGet(this,ne):babelHelpers.classPrivateFieldGet(this,re),autoHide:false,closeByEsc:true,className:"location-widget-prompt-menu"})};var fe=function e(t,s){var a=this;var i=t.externalId;return{id:i,title:t.name,html:ve.createMenuItemText(t.name,s,t),onclick:function e(t,s){le(a,ue,He).call(a,i);a.close()}}};var He=function e(t){var s=le(this,pe,Fe).call(this,t);if(s){this.emit(ve.onItemSelectedEvent,{location:s})}};var Fe=function e(t){var s=null;var a=se(babelHelpers.classPrivateFieldGet(this,be)),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;if(l.externalId===t){s=l;break}}}catch(e){a.e(e)}finally{a.f()}if(!s){BX.debug("Location with externalId ".concat(t," was not found"))}return s};function Pe(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var me=new WeakMap;var ge=new WeakMap;var Te=new WeakMap;var we=new WeakMap;var ye=new WeakSet;var Ie=new WeakSet;var Ge=new WeakSet;var Se=function(){function e(t,s,a){babelHelpers.classCallCheck(this,e);Ge.add(this);Ie.add(this);ye.add(this);me.set(this,{writable:true,value:null});ge.set(this,{writable:true,value:""});Te.set(this,{writable:true,value:""});we.set(this,{writable:true,value:null});if(!(t instanceof HTMLInputElement)){throw new TypeError("Wrong input type")}babelHelpers.classPrivateFieldSet(this,me,t);if(!(s instanceof l.Format)){throw new TypeError("Wrong addressFormat type")}babelHelpers.classPrivateFieldSet(this,we,s);if(a&&!(a instanceof l.Address)){throw new TypeError("Wrong address type")}if(a){this.setValueFromAddress(a)}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldSet(this,ge,t);babelHelpers.classPrivateFieldGet(this,me).value=t;if(s){babelHelpers.classPrivateFieldSet(this,Te,t)}Pe(this,ye,ke).call(this)}},{key:"actualize",value:function e(){babelHelpers.classPrivateFieldSet(this,ge,babelHelpers.classPrivateFieldGet(this,me).value);Pe(this,ye,ke).call(this)}},{key:"isChanged",value:function e(){return babelHelpers.classPrivateFieldGet(this,ge).trim()!==babelHelpers.classPrivateFieldGet(this,me).value.trim()}},{key:"hasPureAddressString",value:function e(){return babelHelpers.classPrivateFieldGet(this,Te)!==""}},{key:"setValueFromAddress",value:function e(t){var s="";if(t){s=Pe(this,Ge,Ce).call(this,t,l.FormatTemplateType.AUTOCOMPLETE);if(s.trim()===""){s=Pe(this,Ge,Ce).call(this,t,l.FormatTemplateType.DEFAULT)}}this.setValue(s,true)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,ge)}},{key:"customTail",get:function e(){if(babelHelpers.classPrivateFieldGet(this,Te)===""){return babelHelpers.classPrivateFieldGet(this,ge)}var t;if(!Pe(this,Ie,Ee).call(this)){t=babelHelpers.classPrivateFieldGet(this,ge).slice(babelHelpers.classPrivateFieldGet(this,Te).length)}else{t=babelHelpers.classPrivateFieldGet(this,ge)}return t}}]);return e}();var ke=function e(){if(Pe(this,Ie,Ee).call(this)){babelHelpers.classPrivateFieldSet(this,Te,"")}};var Ee=function e(){return babelHelpers.classPrivateFieldGet(this,ge)===""||babelHelpers.classPrivateFieldGet(this,Te)===""||babelHelpers.classPrivateFieldGet(this,ge).indexOf(babelHelpers.classPrivateFieldGet(this,Te))!==0};var Ce=function e(t,s){if(!babelHelpers.classPrivateFieldGet(this,we).isTemplateExists(s)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,we).code,'" does not have a template "').concat(s,'"'));return""}return l.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,we).getTemplate(s),l.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,we))};function We(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span>\t\t\t\t\n\t\t\t\t\t<span class="menu-popup-item-icon"></span>\n\t\t\t\t\t<span class="menu-popup-item-text">',"</span>\n\t\t\t\t</span>\t\t\n\t\t"]);We=function t(){return e};return e}function Ae(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="location-map-popup-item--show-on-map">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t"]);Ae=function t(){return e};return e}function Me(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function ze(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function _e(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Le=new WeakMap;var Oe=new WeakMap;var Ne=new WeakMap;var De=new WeakMap;var Be=new WeakMap;var Re=new WeakMap;var Xe=new WeakMap;var xe=new WeakMap;var Ue=new WeakMap;var Ye=new WeakMap;var Ve=new WeakMap;var je=new WeakMap;var Ke=new WeakMap;var qe=new WeakMap;var Je=new WeakMap;var $e=new WeakMap;var Ze=new WeakMap;var Qe=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var st=new WeakMap;var at=new WeakMap;var it=new WeakMap;var lt=new WeakMap;var rt=new WeakMap;var nt=new WeakSet;var dt=new WeakSet;var bt=new WeakSet;var ot=new WeakSet;var ct=new WeakSet;var ut=new WeakSet;var pt=new WeakSet;var vt=new WeakSet;var ht=new WeakSet;var ft=new WeakSet;var Ht=new WeakSet;var Ft=new WeakSet;var Pt=new WeakSet;var mt=new WeakSet;var gt=new WeakSet;var Tt=new WeakSet;var wt=new WeakSet;var yt=new WeakSet;var It=new WeakSet;var Gt=new WeakSet;var St=new WeakSet;var kt=new WeakSet;var Et=new WeakSet;var Ct=new WeakSet;var Wt=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ct.add(babelHelpers.assertThisInitialized(s));Et.add(babelHelpers.assertThisInitialized(s));kt.add(babelHelpers.assertThisInitialized(s));St.add(babelHelpers.assertThisInitialized(s));Gt.add(babelHelpers.assertThisInitialized(s));It.add(babelHelpers.assertThisInitialized(s));yt.add(babelHelpers.assertThisInitialized(s));wt.add(babelHelpers.assertThisInitialized(s));Tt.add(babelHelpers.assertThisInitialized(s));gt.add(babelHelpers.assertThisInitialized(s));mt.add(babelHelpers.assertThisInitialized(s));Pt.add(babelHelpers.assertThisInitialized(s));Ft.add(babelHelpers.assertThisInitialized(s));Ht.add(babelHelpers.assertThisInitialized(s));ft.add(babelHelpers.assertThisInitialized(s));ht.add(babelHelpers.assertThisInitialized(s));vt.add(babelHelpers.assertThisInitialized(s));pt.add(babelHelpers.assertThisInitialized(s));ut.add(babelHelpers.assertThisInitialized(s));ct.add(babelHelpers.assertThisInitialized(s));ot.add(babelHelpers.assertThisInitialized(s));bt.add(babelHelpers.assertThisInitialized(s));dt.add(babelHelpers.assertThisInitialized(s));nt.add(babelHelpers.assertThisInitialized(s));Le.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Oe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ne.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});De.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Be.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Re.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ue.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ye.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ve.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ke.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Je.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$e.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ze.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});Qe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});et.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});tt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});st.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});at.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});it.set(babelHelpers.assertThisInitialized(s),{writable:true,value:100});lt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});rt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof l.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),De,e.addressFormat);if(!(e.autocompleteService instanceof l.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ye,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ne,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Be,e.sourceCode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Le,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),xe,e.presetLocationsProvider);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Re,e.locationRepository||new l.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Xe,e.userLocation);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),je,e.promptDelay||300);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ke,e.maxPromptDelay||500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ve,e.minCharsCountToAutocomplete||3);_e(babelHelpers.assertThisInitialized(s),mt,$t).call(babelHelpers.assertThisInitialized(s),b.INITIAL);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),st,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),je));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),rt,new l.AutocompleteServiceFilter);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Je,t.inputNode);babelHelpers.classPrivateFieldSet(this,Le,t.address);babelHelpers.classPrivateFieldSet(this,Oe,new Se(babelHelpers.classPrivateFieldGet(this,Je),babelHelpers.classPrivateFieldGet(this,De),babelHelpers.classPrivateFieldGet(this,Le)));babelHelpers.classPrivateFieldGet(this,Je).addEventListener("keyup",_e(this,Gt,as).bind(this));babelHelpers.classPrivateFieldGet(this,Je).addEventListener("focus",_e(this,pt,Ut).bind(this));babelHelpers.classPrivateFieldGet(this,Je).addEventListener("focusout",_e(this,ut,xt).bind(this));babelHelpers.classPrivateFieldGet(this,Je).addEventListener("click",_e(this,nt,Nt).bind(this));babelHelpers.classPrivateFieldSet(this,Ue,new ve({inputNode:t.inputNode,menuNode:t.menuNode}));babelHelpers.classPrivateFieldGet(this,Ue).subscribe(ve.onItemSelectedEvent,_e(this,Pt,Jt).bind(this));document.addEventListener("click",_e(this,ft,jt).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(ze(t,t,Mt),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(ze(t,t,zt),s)}},{key:"onSearchStartedEventSubscribe",value:function e(s){this.subscribe(ze(t,t,_t),s)}},{key:"onSearchCompletedEventSubscribe",value:function e(s){this.subscribe(ze(t,t,Lt),s)}},{key:"onShowOnMapClickedEventSubscribe",value:function e(s){this.subscribe(ze(t,t,Ot),s)}},{key:"showPrompt",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ze).requested=t;babelHelpers.classPrivateFieldGet(this,Ze).current=t;babelHelpers.classPrivateFieldGet(this,Ze).dropped="";_e(this,Et,rs).call(this,t,_e(this,kt,ls).call(this))}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ue)){babelHelpers.classPrivateFieldGet(this,Ue).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ue)){babelHelpers.classPrivateFieldGet(this,Ue).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,et)){return}d.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,Ue)){babelHelpers.classPrivateFieldGet(this,Ue).destroy();babelHelpers.classPrivateFieldSet(this,Ue,null)}babelHelpers.classPrivateFieldSet(this,qe,null);if(babelHelpers.classPrivateFieldGet(this,Je)){babelHelpers.classPrivateFieldGet(this,Je).removeEventListener("keyup",_e(this,Gt,as));babelHelpers.classPrivateFieldGet(this,Je).removeEventListener("focus",_e(this,pt,Ut));babelHelpers.classPrivateFieldGet(this,Je).removeEventListener("focusout",_e(this,ut,xt));babelHelpers.classPrivateFieldGet(this,Je).removeEventListener("click",_e(this,nt,Nt))}document.removeEventListener("click",_e(this,ft,jt));babelHelpers.classPrivateFieldSet(this,et,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,Le,t);if(babelHelpers.classPrivateFieldGet(this,Oe)){babelHelpers.classPrivateFieldGet(this,Oe).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Le))}if(!t){babelHelpers.classPrivateFieldGet(this,rt).reset()}},get:function e(){return babelHelpers.classPrivateFieldGet(this,Le)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Qe)}}]);return t}(n.EventEmitter);var At=function e(t){t=t.trim();if(t.length<=0){return["",""]}var s=t.lastIndexOf(" ");if(s<=0){return["",""]}return[t.slice(0,s),t.slice(s+1)]};var Mt={writable:true,value:"onAddressChanged"};var zt={writable:true,value:"onStateChanged"};var _t={writable:true,value:"onSearchStarted"};var Lt={writable:true,value:"onSearchCompleted"};var Ot={writable:true,value:"onShowOnMapClicked"};var Nt=function e(t){var s=babelHelpers.classPrivateFieldGet(this,Oe).value;if(s.length===0){_e(this,dt,Dt).call(this)}};var Dt=function e(){var t=babelHelpers.classPrivateFieldGet(this,xe).call(this);babelHelpers.classPrivateFieldGet(this,Ue).setMenuItems(t,"");var s;if(t.length>0){s=d.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP")}else{s=d.Loc.getMessage("LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP")}_e(this,ct,Xt).call(this,s,null)};var Bt=function e(t){var s=d.Tag.render(Ae(),d.Loc.getMessage("LOCATION_WIDGET_SHOW_ON_MAP"));s.addEventListener("click",_e(this,Ft,qt).call(this,t));return s};var Rt=function e(t){return d.Tag.render(We(),t)};var Xt=function e(t,s){babelHelpers.classPrivateFieldGet(this,Ue).getMenu().setBottomRightItemNode(_e(this,bt,Bt).call(this,s));babelHelpers.classPrivateFieldGet(this,Ue).getMenu().setBottomLeftItemNode(_e(this,ot,Rt).call(this,t));babelHelpers.classPrivateFieldGet(this,Ue).getMenu().show()};var xt=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,et)){return}setTimeout(function(){if(babelHelpers.classPrivateFieldGet(s,Qe)===b.DATA_INPUTTING){_e(s,mt,$t).call(s,b.DATA_SUPPOSED);if(babelHelpers.classPrivateFieldGet(s,Oe)){if(!babelHelpers.classPrivateFieldGet(s,Le)||!babelHelpers.classPrivateFieldGet(s,Oe).hasPureAddressString()){babelHelpers.classPrivateFieldSet(s,Le,_e(s,yt,ts).call(s,babelHelpers.classPrivateFieldGet(s,Oe).value))}else if(babelHelpers.classPrivateFieldGet(s,Oe).customTail!==""){babelHelpers.classPrivateFieldGet(s,Le).setFieldValue(babelHelpers.classPrivateFieldGet(s,De).fieldForUnRecognized,babelHelpers.classPrivateFieldGet(s,Oe).customTail)}}_e(s,Tt,Qt).call(s)}},1);if(babelHelpers.classPrivateFieldGet(this,Ue)){babelHelpers.classPrivateFieldGet(this,Ue).close()}t.stopImmediatePropagation()};var Ut=function e(){if(babelHelpers.classPrivateFieldGet(this,et)){return}if(babelHelpers.classPrivateFieldGet(this,Le)&&(!babelHelpers.classPrivateFieldGet(this,Le).location||!babelHelpers.classPrivateFieldGet(this,Le).location.hasExternalRelation())&&babelHelpers.classPrivateFieldGet(this,Oe).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Oe).value)}};var Yt=function e(t){var s=new l.AutocompleteServiceFilter;if(!t){return s}var a=null;if(t.type===l.LocationType.COUNTRY){a=l.LocationType.LOCALITY}else if(t.type===l.LocationType.LOCALITY){a=l.LocationType.STREET}else if(t.type===l.LocationType.STREET){a=l.LocationType.BUILDING}if(a){s.types=[a]}return s};var Vt=function e(){var t=null;var s={};if(babelHelpers.classPrivateFieldGet(this,$e)){t=babelHelpers.classPrivateFieldGet(this,$e)}else if(babelHelpers.classPrivateFieldGet(this,Xe)){t=babelHelpers.classPrivateFieldGet(this,Xe)}s.filter=babelHelpers.classPrivateFieldGet(this,rt);s.locationForBias=t;return s};var jt=function e(t){if(babelHelpers.classPrivateFieldGet(this,et)){return}if(t.target===babelHelpers.classPrivateFieldGet(this,Je)){return}if(babelHelpers.classPrivateFieldGet(this,Ue).isShown()){babelHelpers.classPrivateFieldGet(this,Ue).close()}};var Kt=function e(t,s){var a=this;if(Array.isArray(t)&&t.length>0){if(t.length===1&&babelHelpers.classPrivateFieldGet(this,Le)&&babelHelpers.classPrivateFieldGet(this,Le).location&&babelHelpers.classPrivateFieldGet(this,Le).location.externalId&&babelHelpers.classPrivateFieldGet(this,Le).location.externalId===t[0].externalId){this.closePrompt();return}babelHelpers.classPrivateFieldGet(this,Ue).setMenuItems(t,babelHelpers.classPrivateFieldGet(this,Ze).requested,this.address);_e(this,ct,Xt).call(this,d.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP"),t[0])}else{var i=Me(Wt,Wt,At).call(Wt,babelHelpers.classPrivateFieldGet(this,Ze).current);babelHelpers.classPrivateFieldGet(this,Ze).current=i[0];babelHelpers.classPrivateFieldGet(this,Ze).dropped="".concat(i[1]," ").concat(babelHelpers.classPrivateFieldGet(this,Ze).dropped);if(babelHelpers.classPrivateFieldGet(this,Ze).current.length>0){_e(this,Et,rs).call(this,babelHelpers.classPrivateFieldGet(this,Ze).current,s,1)}else{babelHelpers.classPrivateFieldGet(this,Ue).getMenu().clearItems();babelHelpers.classPrivateFieldGet(this,Ue).getMenu().addMenuItem({id:"notFound",html:"<span>".concat(d.Loc.getMessage("LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND"),"</span>"),onclick:function e(t,s){babelHelpers.classPrivateFieldGet(a,Ue).close()}});_e(this,ct,Xt).call(this,d.Loc.getMessage("LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP"),null)}}};var qt=function e(t){var s=this;return function(){if(t&&babelHelpers.classPrivateFieldGet(s,Xe)&&t.latitude&&t.longitude&&babelHelpers.classPrivateFieldGet(s,Xe).latitude&&babelHelpers.classPrivateFieldGet(s,Xe).longitude){var e=l.DistanceCalculator.getDistanceFromLatLonInKm(t.latitude,t.longitude,babelHelpers.classPrivateFieldGet(s,Xe).latitude,babelHelpers.classPrivateFieldGet(s,Xe).longitude);if(e<=babelHelpers.classPrivateFieldGet(s,it)){_e(s,gt,Zt).call(s,t);return}}setTimeout(function(){s.emit(ze(Wt,Wt,Ot))},1)}};var Jt=function e(t){if(t.data.location){_e(this,gt,Zt).call(this,t.data.location)}};var $t=function e(t){babelHelpers.classPrivateFieldSet(this,Qe,t);this.emit(ze(Wt,Wt,zt),{state:babelHelpers.classPrivateFieldGet(this,Qe)})};var Zt=function e(t){var s=this;var a;_e(this,mt,$t).call(this,b.DATA_SELECTED);if(t){if(t.hasExternalRelation()&&babelHelpers.classPrivateFieldGet(this,Be)===t.sourceCode){a=_e(this,wt,es).call(this,t).then(function(e){_e(s,St,is).call(s,e,0);return true},function(e){return l.ErrorPublisher.getInstance().notify(e.errors)})}else{a=new Promise(function(e){setTimeout(function(){_e(s,St,is).call(s,t,0);e()},0)})}}else{a=new Promise(function(e){setTimeout(function(){_e(s,St,is).call(s,null,0);e()},0)})}return a};var Qt=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.emit(ze(Wt,Wt,Mt),{address:babelHelpers.classPrivateFieldGet(this,Le),excludeSetAddressFeatures:t})};var es=function e(t){var s=this;_e(this,mt,$t).call(this,b.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,Re).findByExternalId(t.externalId,t.sourceCode,t.languageId).then(function(e){_e(s,mt,$t).call(s,b.DATA_LOADED);var a;if(e.latitude!=="0"&&e.longitude!=="0"&&e!==""){a=e;a.name=t.name}else{a=t}return a},function(e){l.ErrorPublisher.getInstance().notify(e.errors)})};var ts=function e(t){var s=new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,Ne)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,De).fieldForUnRecognized,t);return s};var ss=function e(t){babelHelpers.classPrivateFieldSet(this,$e,t);babelHelpers.classPrivateFieldSet(this,rt,_e(this,vt,Yt).call(this,babelHelpers.classPrivateFieldGet(this,$e)));babelHelpers.classPrivateFieldSet(this,Le,t?t.toAddress():null);babelHelpers.classPrivateFieldGet(this,Oe).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Le));_e(this,Tt,Qt).call(this)};var as=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,et)){return}var a=Date.now();if(babelHelpers.classPrivateFieldGet(this,tt)){var i=a-babelHelpers.classPrivateFieldGet(this,tt);babelHelpers.classPrivateFieldSet(this,st,(babelHelpers.classPrivateFieldGet(this,st)+i)/2)}babelHelpers.classPrivateFieldSet(this,tt,a);if(babelHelpers.classPrivateFieldGet(this,Qe)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(this,Oe).isChanged()){_e(this,mt,$t).call(this,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,Ue).isShown()){var l;var r=700;switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,Ue).isItemChosen()){_e(this,gt,Zt).call(this,babelHelpers.classPrivateFieldGet(this,Ue).getChosenItem()).then(function(){babelHelpers.classPrivateFieldGet(s,Ue).close()},function(e){return BX.debug(e)})}return;case"Tab":case"Escape":_e(this,mt,$t).call(this,b.DATA_SUPPOSED);_e(this,Tt,Qt).call(this);babelHelpers.classPrivateFieldGet(this,Ue).close();return;case"ArrowUp":l=babelHelpers.classPrivateFieldGet(this,Ue).choosePrevItem();if(l&&l.address){_e(this,St,is).call(this,l,r)}return;case"ArrowDown":l=babelHelpers.classPrivateFieldGet(this,Ue).chooseNextItem();if(l&&l.address){_e(this,St,is).call(this,l,r)}return;case"Backspace":case"Delete":babelHelpers.classPrivateFieldGet(this,rt).reset();break}}if(babelHelpers.classPrivateFieldGet(this,Oe).isChanged()){babelHelpers.classPrivateFieldGet(this,Oe).actualize();this.showPrompt(babelHelpers.classPrivateFieldGet(this,Oe).value)}if(babelHelpers.classPrivateFieldGet(this,Oe).value.length===0){_e(this,dt,Dt).call(this)}};var is=function e(t,s){var a=this;if(babelHelpers.classPrivateFieldGet(this,lt)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,lt))}babelHelpers.classPrivateFieldSet(this,lt,setTimeout(function(){_e(a,It,ss).call(a,t)},s))};var ls=function e(){var t=babelHelpers.classPrivateFieldGet(this,je)>babelHelpers.classPrivateFieldGet(this,st)?babelHelpers.classPrivateFieldGet(this,je):babelHelpers.classPrivateFieldGet(this,st)*1.5;return t>babelHelpers.classPrivateFieldGet(this,Ke)?babelHelpers.classPrivateFieldGet(this,Ke):t};var rs=function e(t,s){if(t.length<=babelHelpers.classPrivateFieldGet(this,Ve)){s*=2}if(babelHelpers.classPrivateFieldGet(this,qe)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,qe))}babelHelpers.classPrivateFieldSet(this,qe,_e(this,Ct,ns).call(this,t,s))};var ns=function e(t,s){var a=this;return setTimeout(function(){if(babelHelpers.classPrivateFieldGet(a,at)){clearTimeout(babelHelpers.classPrivateFieldGet(a,qe));babelHelpers.classPrivateFieldSet(a,qe,_e(a,Ct,e).call(a,t,s));return}a.emit(ze(Wt,Wt,_t));babelHelpers.classPrivateFieldSet(a,at,true);var i=_e(a,ht,Vt).call(a);babelHelpers.classPrivateFieldGet(a,Ye).autocomplete(t,i).then(function(e){babelHelpers.classPrivateFieldSet(a,qe,null);_e(a,Ht,Kt).call(a,e,i);a.emit(ze(Wt,Wt,Lt));babelHelpers.classPrivateFieldSet(a,at,false)},function(e){a.emit(ze(Wt,Wt,Lt));babelHelpers.classPrivateFieldSet(a,at,false);BX.debug(e)})},s)};function ds(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);ds=function t(){return e};return e}function bs(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);bs=function t(){return e};return e}function os(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var cs=new WeakMap;var us=new WeakMap;var ps=new WeakMap;var vs=new WeakMap;var hs=new WeakSet;var fs=function(){function e(t){babelHelpers.classCallCheck(this,e);hs.add(this);cs.set(this,{writable:true,value:void 0});us.set(this,{writable:true,value:void 0});ps.set(this,{writable:true,value:void 0});vs.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof l.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,vs,t.addressFormat)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,cs,t.address);var s=os(this,hs,Hs).call(this,babelHelpers.classPrivateFieldGet(this,cs));babelHelpers.classPrivateFieldSet(this,ps,d.Tag.render(bs(),s));babelHelpers.classPrivateFieldSet(this,us,d.Tag.render(ds(),babelHelpers.classPrivateFieldGet(this,ps)));if(s===""){this.hide()}return babelHelpers.classPrivateFieldGet(this,us)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,us)){babelHelpers.classPrivateFieldGet(this,us).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,us)){babelHelpers.classPrivateFieldGet(this,us).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,us)||babelHelpers.classPrivateFieldGet(this,us).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,cs,t);if(!babelHelpers.classPrivateFieldGet(this,ps)){return}babelHelpers.classPrivateFieldGet(this,ps).innerHTML=os(this,hs,Hs).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var Hs=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,vs),l.AddressStringConverter.STRATEGY_TYPE_FIELD_SORT)};function Fs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ps=new WeakSet;var ms=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Ps.add(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){var a,i;if(this.bindOptions.position&&this.bindOptions.position==="right"){a=true;i=Fs(this,Ps,gs).call(this)}if(!(a&&i)){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}}]);return t}(a.Popup);var gs=function e(){var t=this.bindElement.getBoundingClientRect();var s=this.getPopupContainer().offsetHeight;var a=this.getPopupContainer().offsetWidth;if(t.left+t.width+a>document.documentElement.clientWidth){return false}var i=s/2;var l=t.left+t.width+10;var r=window.pageYOffset+t.top+t.height/2-s/2;if(r<window.pageYOffset){i-=window.pageYOffset-r;r=window.pageYOffset}else if(r>window.pageYOffset+document.body.clientHeight-s){i+=r-(window.pageYOffset+document.body.clientHeight-s);r=window.pageYOffset+document.body.clientHeight-s}this.setAngle({position:"left",offset:i});d.Dom.adjust(this.popupContainer,{style:{top:"".concat(r,"px"),left:"".concat(l,"px"),zIndex:this.getZindex()}});return true};function Ts(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\n\t\t\t<div class="location-map-address-changed hidden">\n\t\t\t\t<div class="location-map-address-changed-inner">\n\t\t\t\t\t<div class="location-map-address-changed-title">\n\t\t\t\t\t\t',":\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>"]);Ts=function t(){return e};return e}function ws(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button type="button" class="location-map-address-changed-btn">\n\t\t\t\t',"\n\t\t\t</button>"]);ws=function t(){return e};return e}function ys(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-changed-text">\n\t\t\t\t',"\n\t\t\t</div>"]);ys=function t(){return e};return e}function Is(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Gs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ss=new WeakMap;var ks=new WeakMap;var Es=new WeakMap;var Cs=new WeakMap;var Ws=new WeakMap;var As=new WeakSet;var Ms=new WeakSet;var zs=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ms.add(babelHelpers.assertThisInitialized(s));As.add(babelHelpers.assertThisInitialized(s));Ss.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ks.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Es.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Cs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ws.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup.AddressRestorer");if(!(e.addressFormat instanceof l.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ss,e.addressFormat);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){this.address=t.address;babelHelpers.classPrivateFieldSet(this,Cs,d.Tag.render(ys(),Gs(this,Ms,Os).call(this,babelHelpers.classPrivateFieldGet(this,ks))));babelHelpers.classPrivateFieldSet(this,Ws,d.Tag.render(ws(),BX.message("LOCATION_WIDGET_AUI_ADDRESS_RESTORE")));babelHelpers.classPrivateFieldGet(this,Ws).addEventListener("click",Gs(this,As,Ls).bind(this));babelHelpers.classPrivateFieldSet(this,Es,d.Tag.render(Ts(),BX.message("LOCATION_WIDGET_AUI_ADDRESS_CHANGED"),babelHelpers.classPrivateFieldGet(this,Cs),babelHelpers.classPrivateFieldGet(this,Ws)));babelHelpers.classPrivateFieldGet(this,Es).style.display="none";return babelHelpers.classPrivateFieldGet(this,Es)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Es)&&babelHelpers.classPrivateFieldGet(this,ks)&&this.isHidden()){babelHelpers.classPrivateFieldGet(this,Es).style.display="flex";babelHelpers.classPrivateFieldGet(this,Es).classList.remove("hidden")}}},{key:"hide",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Es)&&!this.isHidden()){babelHelpers.classPrivateFieldGet(this,Es).classList.add("hidden");setTimeout(function(){babelHelpers.classPrivateFieldGet(t,Es).style.display="none"},600)}}},{key:"isHidden",value:function e(){var t=false;if(babelHelpers.classPrivateFieldGet(this,Es)){t=babelHelpers.classPrivateFieldGet(this,Es).classList.contains("hidden")}return t}},{key:"onRestoreEventSubscribe",value:function e(s){this.subscribe(Is(t,t,_s),s)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,ks,t);if(!babelHelpers.classPrivateFieldGet(this,Cs)||!babelHelpers.classPrivateFieldGet(this,ks)){return}babelHelpers.classPrivateFieldGet(this,Cs).innerHTML=Gs(this,Ms,Os).call(this,babelHelpers.classPrivateFieldGet(this,ks))}}]);return t}(n.EventEmitter);var _s={writable:true,value:"onRestore"};var Ls=function e(t){this.emit(Is(zs,zs,_s),{address:babelHelpers.classPrivateFieldGet(this,ks)})};var Os=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,Ss),l.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA)};function Ns(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);Ns=function t(){return e};return e}function Ds(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);Ds=function t(){return e};return e}function Bs(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Rs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Xs=new WeakMap;var xs=new WeakMap;var Us=new WeakMap;var Ys=new WeakMap;var Vs=new WeakMap;var js=new WeakMap;var Ks=new WeakMap;var qs=new WeakMap;var Js=new WeakMap;var $s=new WeakMap;var Zs=new WeakMap;var Qs=new WeakMap;var ea=new WeakMap;var ta=new WeakMap;var sa=new WeakMap;var aa=new WeakSet;var ia=new WeakSet;var la=new WeakSet;var ra=new WeakSet;var na=new WeakSet;var da=new WeakSet;var ba=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));da.add(babelHelpers.assertThisInitialized(s));na.add(babelHelpers.assertThisInitialized(s));ra.add(babelHelpers.assertThisInitialized(s));la.add(babelHelpers.assertThisInitialized(s));ia.add(babelHelpers.assertThisInitialized(s));aa.add(babelHelpers.assertThisInitialized(s));Xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Us.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ys.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Vs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});js.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ks.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Js.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});$s.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Zs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Qs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ea.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ta.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});sa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof l.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Xs,e.map);if(e.geocodingService instanceof l.GeocodingServiceBase){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Qs,e.geocodingService)}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Xs).onLocationChangedEventSubscribe(Rs(babelHelpers.assertThisInitialized(s),aa,ha).bind(babelHelpers.assertThisInitialized(s)));if(!(e.popup instanceof ms)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ys,e.popup);if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ks,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Vs,new fs({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ks)}));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),js,new zs({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ks)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),js).onRestoreEventSubscribe(Rs(babelHelpers.assertThisInitialized(s),ia,fa).bind(babelHelpers.assertThisInitialized(s)));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),qs,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Js,e.locationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),sa,e.userLocation);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Us,t.address);babelHelpers.classPrivateFieldSet(this,ta,true);babelHelpers.classPrivateFieldSet(this,xs,t.mode);babelHelpers.classPrivateFieldSet(this,$s,false);babelHelpers.classPrivateFieldSet(this,Zs,d.Tag.render(Ds()));Rs(this,la,Ha).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,Zs))}},{key:"show",value:function e(){var s=this;Rs(this,ra,Fa).call(this,babelHelpers.classPrivateFieldGet(this,Us)).then(function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,Ys).show();if(!babelHelpers.classPrivateFieldGet(s,$s)){Rs(s,da,ma).call(s,{location:e}).then(function(){if(babelHelpers.classPrivateFieldGet(s,qs)){babelHelpers.classPrivateFieldGet(s,qs).location=e}s.emit(Bs(t,t,pa));babelHelpers.classPrivateFieldGet(s,Xs).onMapShow()});babelHelpers.classPrivateFieldSet(s,$s,true)}else{babelHelpers.classPrivateFieldGet(s,Xs).location=e;if(babelHelpers.classPrivateFieldGet(s,qs)){babelHelpers.classPrivateFieldGet(s,qs).location=e}s.emit(Bs(t,t,pa));babelHelpers.classPrivateFieldGet(s,Xs).onMapShow()}})}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ys).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,Ys).close();babelHelpers.classPrivateFieldSet(this,ta,false);if(!babelHelpers.classPrivateFieldGet(this,js).isHidden()){babelHelpers.classPrivateFieldGet(this,js).hide()}this.emit(Bs(t,t,va))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(Bs(t,t,oa),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(Bs(t,t,ca),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(Bs(t,t,ua),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(Bs(t,t,pa),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(Bs(t,t,va),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,Xs,null);babelHelpers.classPrivateFieldSet(this,qs,null);babelHelpers.classPrivateFieldSet(this,Vs,null);babelHelpers.classPrivateFieldSet(this,js,null);babelHelpers.classPrivateFieldGet(this,Ys).destroy();babelHelpers.classPrivateFieldSet(this,Ys,null);d.Dom.remove(babelHelpers.classPrivateFieldGet(this,ea));babelHelpers.classPrivateFieldSet(this,ea,null);d.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ys).getBindElement()},set:function e(t){if(d.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,Ys).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,Us,t);babelHelpers.classPrivateFieldSet(this,ta,true);babelHelpers.classPrivateFieldGet(this,Vs).address=t;babelHelpers.classPrivateFieldGet(this,js).address=t;Rs(this,ra,Fa).call(this,t).then(function(e){Rs(s,na,Pa).call(s,e)})}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,xs,t);babelHelpers.classPrivateFieldGet(this,Xs).mode=t}}]);return t}(n.EventEmitter);var oa={writable:true,value:"onChanged"};var ca={writable:true,value:"onMouseOver"};var ua={writable:true,value:"onMouseOut"};var pa={writable:true,value:"onShow"};var va={writable:true,value:"onClose"};var ha=function e(t){var s=t.getData();var a=s.location;var i=a.toAddress();babelHelpers.classPrivateFieldSet(this,Us,i);babelHelpers.classPrivateFieldGet(this,Vs).address=i;if(babelHelpers.classPrivateFieldGet(this,ta)){if(babelHelpers.classPrivateFieldGet(this,js).isHidden()){babelHelpers.classPrivateFieldGet(this,js).show()}}if(babelHelpers.classPrivateFieldGet(this,qs)){babelHelpers.classPrivateFieldGet(this,qs).location=a}this.emit(Bs(ba,ba,oa),{address:i})};var fa=function e(t){var s=t.getData();var a=s.address;a.latitude=babelHelpers.classPrivateFieldGet(this,Us).latitude;a.longitude=babelHelpers.classPrivateFieldGet(this,Us).longitude;babelHelpers.classPrivateFieldSet(this,Us,a);babelHelpers.classPrivateFieldGet(this,Vs).address=a;babelHelpers.classPrivateFieldGet(this,js).hide();this.emit(Bs(ba,ba,oa),{address:a})};var Ha=function e(t,s){var a=this;var i="";if(babelHelpers.classPrivateFieldGet(this,qs)){i=babelHelpers.classPrivateFieldGet(this,qs).render()}babelHelpers.classPrivateFieldSet(this,ea,d.Tag.render(Ns(),s,i,babelHelpers.classPrivateFieldGet(this,xs)===l.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,Vs).render({address:babelHelpers.classPrivateFieldGet(this,Us)}):"",babelHelpers.classPrivateFieldGet(this,xs)===l.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,js).render({address:babelHelpers.classPrivateFieldGet(this,Us)}):""));d.Event.bind(babelHelpers.classPrivateFieldGet(this,ea),"click",function(e){return e.stopPropagation()});d.Event.bind(babelHelpers.classPrivateFieldGet(this,ea),"mouseover",function(e){return a.emit(Bs(ba,ba,ca),e)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,ea),"mouseout",function(e){return a.emit(Bs(ba,ba,ua),e)});this.bindElement=t;babelHelpers.classPrivateFieldGet(this,Ys).setContent(babelHelpers.classPrivateFieldGet(this,ea))};var Fa=function e(t){var s=this;return new Promise(function(e){if(t){var a;var i;if(t.latitude&&t.longitude){a=t.latitude;i=t.longitude}else if(t.location&&t.location.latitude&&t.location.longitude){a=t.location.latitude;i=t.location.longitude}if(a&&a!=="0"&&i&&i!=="0"){e(new l.Location({latitude:a,longitude:i,type:t.getType()}));return}var r=babelHelpers.classPrivateFieldGet(s,sa)&&babelHelpers.classPrivateFieldGet(s,xs)!==l.ControlMode.view?babelHelpers.classPrivateFieldGet(s,sa):null;if(babelHelpers.classPrivateFieldGet(s,Qs)){var n=t.toString(babelHelpers.classPrivateFieldGet(s,Ks),l.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,l.AddressStringConverter.CONTENT_TYPE_TEXT);babelHelpers.classPrivateFieldGet(s,Qs).geocode(n).then(function(t){if(Array.isArray(t)&&t.length===1){r=t[0]}e(r)});return}}e(babelHelpers.classPrivateFieldGet(s,sa)&&babelHelpers.classPrivateFieldGet(s,xs)!==l.ControlMode.view?babelHelpers.classPrivateFieldGet(s,sa):null)})};var Pa=function e(t){babelHelpers.classPrivateFieldGet(this,Xs).location=t;if(babelHelpers.classPrivateFieldGet(this,qs)){babelHelpers.classPrivateFieldGet(this,qs).location=t}};var ma=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,Xs).render({mapContainer:babelHelpers.classPrivateFieldGet(this,Zs),location:s,mode:babelHelpers.classPrivateFieldGet(this,xs)})};function ga(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);ga=function t(){return e};return e}function Ta(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);Ta=function t(){return e};return e}var wa=new WeakMap;var ya=new WeakMap;var Ia=new WeakMap;var Ga=new WeakMap;var Sa=new WeakMap;var ka=function(){function e(t){babelHelpers.classCallCheck(this,e);wa.set(this,{writable:true,value:void 0});ya.set(this,{writable:true,value:void 0});Ia.set(this,{writable:true,value:void 0});Ga.set(this,{writable:true,value:void 0});Sa.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ya,t.url);babelHelpers.classPrivateFieldSet(this,Ia,t.link||"");babelHelpers.classPrivateFieldSet(this,wa,t.description||"");babelHelpers.classPrivateFieldSet(this,Ga,t.location);babelHelpers.classPrivateFieldSet(this,Sa,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,wa)){t=d.Tag.render(Ta(),babelHelpers.classPrivateFieldGet(this,wa))}return d.Tag.render(ga(),t,babelHelpers.classPrivateFieldGet(this,Ia),babelHelpers.classPrivateFieldGet(this,Sa),babelHelpers.classPrivateFieldGet(this,Ga).externalId,babelHelpers.classPrivateFieldGet(this,ya))}}]);return e}();function Ea(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=Ca(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function Ca(e,t){if(!e)return;if(typeof e==="string")return Wa(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Wa(e,t)}function Wa(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function Aa(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);Aa=function t(){return e};return e}function Ma(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);Ma=function t(){return e};return e}function za(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var _a=new WeakMap;var La=new WeakMap;var Oa=new WeakMap;var Na=new WeakMap;var Da=new WeakMap;var Ba=new WeakMap;var Ra=new WeakMap;var Xa=new WeakMap;var xa=new WeakSet;var Ua=new WeakSet;var Ya=function(){function e(t){babelHelpers.classCallCheck(this,e);Ua.add(this);xa.add(this);_a.set(this,{writable:true,value:[]});La.set(this,{writable:true,value:null});Oa.set(this,{writable:true,value:null});Na.set(this,{writable:true,value:void 0});Da.set(this,{writable:true,value:void 0});Ba.set(this,{writable:true,value:void 0});Ra.set(this,{writable:true,value:void 0});Xa.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Na,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,Da,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,Ra,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,Ba,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Xa)){babelHelpers.classPrivateFieldGet(this,Ba).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,Xa),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,Na),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,Da),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,Ra)}).then(function(e){if(Array.isArray(e)&&e.length>0){za(t,xa,Va).call(t,e);t.show()}else{t.hide()}})}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,La)){babelHelpers.classPrivateFieldGet(this,La).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,La)||babelHelpers.classPrivateFieldGet(this,La).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,La)){babelHelpers.classPrivateFieldGet(this,La).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,Oa,d.Tag.render(Ma()));babelHelpers.classPrivateFieldSet(this,La,d.Tag.render(Aa(),babelHelpers.classPrivateFieldGet(this,Oa)));return babelHelpers.classPrivateFieldGet(this,La)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,Xa,t);this.refresh()}}]);return e}();var Va=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Xa)){return}var s=[];var a=Ea(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new ka({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,Xa),title:babelHelpers.classPrivateFieldGet(this,Xa).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,_a,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,_a).push(d)}if(babelHelpers.classPrivateFieldGet(this,_a).length>0&&babelHelpers.classPrivateFieldGet(this,Oa)){var b=babelHelpers.classPrivateFieldGet(this,_a)?za(this,Ua,ja).call(this,babelHelpers.classPrivateFieldGet(this,_a)):"";babelHelpers.classPrivateFieldGet(this,Oa).innerHTML="";if(b.length>0){var o=Ea(b),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,Oa).appendChild(u)}}catch(e){o.e(e)}finally{o.f()}}}};var ja=function e(t){var s=[];var a=Ea(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function Ka(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);Ka=function t(){return e};return e}function qa(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);qa=function t(){return e};return e}function Ja(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);Ja=function t(){return e};return e}function $a(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);$a=function t(){return e};return e}function Za(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Qa(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var ei=new WeakMap;var ti=new WeakMap;var si=new WeakMap;var ai=new WeakMap;var ii=new WeakMap;var li=new WeakMap;var ri=new WeakMap;var ni=new WeakMap;var di=new WeakMap;var bi=new WeakSet;var oi=new WeakSet;var ci=new WeakSet;var ui=new WeakSet;var pi=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ui.add(babelHelpers.assertThisInitialized(s));ci.add(babelHelpers.assertThisInitialized(s));oi.add(babelHelpers.assertThisInitialized(s));bi.add(babelHelpers.assertThisInitialized(s));ei.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ti.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});si.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ai.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ii.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});li.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ri.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ni.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});di.set(babelHelpers.assertThisInitialized(s),{writable:true,value:b.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ei,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),si,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ai,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,ti,typeof t.value==="string"?t.value:"");if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,ii,t.mode);babelHelpers.classPrivateFieldSet(this,ni,d.Tag.render($a(),babelHelpers.classPrivateFieldGet(this,ei)));if(babelHelpers.classPrivateFieldGet(this,ii)===l.ControlMode.edit){Za(this,oi,Hi).call(this,babelHelpers.classPrivateFieldGet(this,ni))}else{Za(this,ci,Fi).call(this,babelHelpers.classPrivateFieldGet(this,ni))}return babelHelpers.classPrivateFieldGet(this,ni)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe(Qa(t,t,vi),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(Qa(t,t,hi),s)}},{key:"destroy",value:function e(){d.Dom.remove(babelHelpers.classPrivateFieldGet(this,ni));d.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,ni,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,ni)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,di)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,si,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,si)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,ai,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,ai)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,ti,typeof t==="string"?t:"");Za(this,ui,Pi).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,ti)}}]);return t}(n.EventEmitter);var vi={writable:true,value:"onValueChanged"};var hi={writable:true,value:"onStateChanged"};var fi=function e(t){babelHelpers.classPrivateFieldSet(this,di,t);this.emit(Qa(pi,pi,hi),{state:babelHelpers.classPrivateFieldGet(this,di)})};var Hi=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,li,d.Tag.render(Ja(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,ti))));babelHelpers.classPrivateFieldSet(this,ri,null);d.Event.bind(babelHelpers.classPrivateFieldGet(this,li),"focus",function(e){Za(s,bi,fi).call(s,b.DATA_INPUTTING)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,li),"focusout",function(e){Za(s,bi,fi).call(s,b.DATA_SELECTED)});d.Event.bind(babelHelpers.classPrivateFieldGet(this,li),"change",function(e){Za(s,bi,fi).call(s,b.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,ti,babelHelpers.classPrivateFieldGet(s,li).value);s.emit(Qa(pi,pi,vi),{value:s})});t.appendChild(d.Tag.render(qa(),babelHelpers.classPrivateFieldGet(this,li)))};var Fi=function e(t){babelHelpers.classPrivateFieldSet(this,li,null);babelHelpers.classPrivateFieldSet(this,ri,d.Tag.render(Ka(),d.Text.encode(babelHelpers.classPrivateFieldGet(this,ti))));t.appendChild(babelHelpers.classPrivateFieldGet(this,ri))};var Pi=function e(){if(babelHelpers.classPrivateFieldGet(this,ii)===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,li).value=babelHelpers.classPrivateFieldGet(this,ti)}else{babelHelpers.classPrivateFieldGet(this,ri).innerHTML=d.Text.encode(babelHelpers.classPrivateFieldGet(this,ti))}};function mi(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=gi(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&s.return!=null)s.return()}finally{if(r)throw n}}}}function gi(e,t){if(!e)return;if(typeof e==="string")return Ti(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ti(e,t)}function Ti(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function wi(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function yi(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ii=new WeakMap;var Gi=new WeakMap;var Si=new WeakMap;var ki=new WeakMap;var Ei=new WeakMap;var Ci=new WeakMap;var Wi=new WeakMap;var Ai=new WeakSet;var Mi=new WeakSet;var zi=new WeakSet;var _i=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));zi.add(babelHelpers.assertThisInitialized(s));Mi.add(babelHelpers.assertThisInitialized(s));Ai.add(babelHelpers.assertThisInitialized(s));Ii.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Gi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Si.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ki.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});Ei.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ci.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Wi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof l.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Gi,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ei,e.languageId);yi(babelHelpers.assertThisInitialized(s),Ai,Ni).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof l.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Ii,t.address);if(!l.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Si,t.mode);if(!d.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,Ci,t.container);var s=mi(babelHelpers.classPrivateFieldGet(this,ki)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;var r=babelHelpers.classPrivateFieldGet(this,Ii)?babelHelpers.classPrivateFieldGet(this,Ii).getFieldValue(i.type):"";if(babelHelpers.classPrivateFieldGet(this,Si)===l.ControlMode.view&&!r){continue}var n=i.render({value:r,mode:babelHelpers.classPrivateFieldGet(this,Si)});babelHelpers.classPrivateFieldGet(this,Ci).appendChild(n)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(wi(t,t,Li),s)}},{key:"destroy",value:function e(){d.Event.unbindAll(this);var t=mi(babelHelpers.classPrivateFieldGet(this,ki)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}d.Dom.clean(babelHelpers.classPrivateFieldGet(this,Ci))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(wi(t,t,Oi),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof l.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Ii,t);var s=mi(babelHelpers.classPrivateFieldGet(this,ki)),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;i.value=babelHelpers.classPrivateFieldGet(this,Ii)?babelHelpers.classPrivateFieldGet(this,Ii).getFieldValue(i.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Wi)}}]);return t}(n.EventEmitter);var Li={writable:true,value:"onAddressChanged"};var Oi={writable:true,value:"onStateChanged"};var Ni=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,Gi).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,Gi).fieldCollection.fields[s];var i=new pi({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent(function(e){yi(t,Mi,Di).call(t,i)});i.subscribeOnStateChangedEvent(function(e){var s=e.getData();yi(t,zi,Bi).call(t,s.state)});babelHelpers.classPrivateFieldGet(t,ki).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,Gi).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,ki).sort(function(e,t){return e.sort-t.sort})};var Di=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ii)){babelHelpers.classPrivateFieldSet(this,Ii,new l.Address({languageId:babelHelpers.classPrivateFieldGet(this,Ei)}))}babelHelpers.classPrivateFieldGet(this,Ii).setFieldValue(t.type,t.value);if(t.type!==babelHelpers.classPrivateFieldGet(this,Gi).fieldForUnRecognized){babelHelpers.classPrivateFieldGet(this,Ii).location=null;babelHelpers.classPrivateFieldGet(this,Ii).latitude="";babelHelpers.classPrivateFieldGet(this,Ii).longitude=""}this.emit(wi(_i,_i,Li),{address:babelHelpers.classPrivateFieldGet(this,Ii),changedField:t})};var Bi=function e(t){babelHelpers.classPrivateFieldSet(this,Wi,t);this.emit(wi(_i,_i,Oi),{state:babelHelpers.classPrivateFieldGet(this,Wi)})};var Ri=new WeakMap;var Xi=new WeakMap;var xi=new WeakMap;var Ui=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ri.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Xi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});xi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof ba)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ri,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ri).onChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),xi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Ri).isShown()){babelHelpers.classPrivateFieldGet(this,Ri).show()}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ri).isShown()){babelHelpers.classPrivateFieldGet(this,Ri).close()}babelHelpers.classPrivateFieldGet(this,Ri).bindelement=babelHelpers.classPrivateFieldGet(this,Xi)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!d.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Xi,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,Ri).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,xi).address,mode:babelHelpers.classPrivateFieldGet(this,xi).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,Ri).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,xi,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ri).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ri).destroy();babelHelpers.classPrivateFieldSet(this,Ri,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ri)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,xi)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Xi)}}]);return t}(o);var Yi=new WeakMap;var Vi=new WeakMap;var ji=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Yi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Vi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof Wt)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Yi,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Yi).onAddressChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Vi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s),t.excludeSetAddressFeatures)});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Yi).onStateChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Vi).setStateByFeature(t.state)});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Yi).onSearchStartedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Vi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchStartedEvent,payload:a})});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Yi).onSearchCompletedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Vi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.searchCompletedEvent,payload:a})});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Yi).onShowOnMapClickedEventSubscribe(function(e){var a=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Vi).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(s),eventCode:t.showOnMapClickedEvent,payload:a})});return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Yi).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Vi).mode===l.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Yi).render({inputNode:babelHelpers.classPrivateFieldGet(this,Vi).inputNode,menuNode:t.autocompleteMenuElement,address:babelHelpers.classPrivateFieldGet(this,Vi).address,mode:babelHelpers.classPrivateFieldGet(this,Vi).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Yi).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Vi,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Yi).destroy();babelHelpers.classPrivateFieldSet(this,Yi,null)}}]);return t}(o);babelHelpers.defineProperty(ji,"searchStartedEvent","searchStarted");babelHelpers.defineProperty(ji,"searchCompletedEvent","searchCompleted");babelHelpers.defineProperty(ji,"showOnMapClickedEvent","showOnMapClicked");var Ki=new WeakMap;var qi=new WeakMap;var Ji=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ki.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});qi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof _i)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ki,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ki).subscribeOnAddressChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),qi).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ki).subscribeOnStateChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),qi).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,qi).mode===l.ControlMode.edit){if(!d.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,Ki).render({address:babelHelpers.classPrivateFieldGet(this,qi).address,mode:babelHelpers.classPrivateFieldGet(this,qi).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,qi,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ki).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ki).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ki).destroy();babelHelpers.classPrivateFieldSet(this,Ki,null)}}]);return t}(o);function $i(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Zi=new WeakMap;var Qi=new WeakMap;var el=new WeakMap;var tl=new WeakMap;var sl=new WeakMap;var al=new WeakMap;var il=new WeakSet;var ll=new WeakSet;var rl=new WeakSet;var nl=new WeakSet;var dl=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));nl.add(babelHelpers.assertThisInitialized(s));rl.add(babelHelpers.assertThisInitialized(s));ll.add(babelHelpers.assertThisInitialized(s));il.add(babelHelpers.assertThisInitialized(s));Zi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Qi.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});el.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});tl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});sl.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});al.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",$i(this,il,bl).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",$i(this,rl,cl).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",$i(this,nl,ul).bind(this));document.addEventListener("click",$i(this,ll,ol).bind(this));this.map.onMouseOverSubscribe($i(this,rl,cl).bind(this));this.map.onMouseOutSubscribe($i(this,nl,ul).bind(this))}},{key:"setAddress",value:function e(t){if(!t){this.closeMap()}this.map.address=t;if(t&&this.addressWidget.state!==b.DATA_SUPPOSED){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,al)){return}document.removeEventListener("click",$i(this,ll,ol));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",$i(this,il,bl));this.addressWidget.controlWrapper.removeEventListener("mouseover",$i(this,rl,cl));this.addressWidget.controlWrapper.removeEventListener("mouseout",$i(this,nl,ul))}babelHelpers.classPrivateFieldSet(this,Qi,null);babelHelpers.classPrivateFieldSet(this,tl,null);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,al,true)}}]);return t}(Ui);var bl=function e(t){if(babelHelpers.classPrivateFieldGet(this,al)){return}if(this.addressWidget.mode===l.ControlMode.view){if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,Qi))}}};var ol=function e(t){if(babelHelpers.classPrivateFieldGet(this,al)){return}if(this.addressWidget.inputNode!==t.target){this.closeMap()}};var cl=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,al)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Qi));clearTimeout(babelHelpers.classPrivateFieldGet(this,tl));if(this.addressWidget.mode!==l.ControlMode.view){return}if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Qi,setTimeout(function(){t.showMap()},babelHelpers.classPrivateFieldGet(this,el)))}};var ul=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,al)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Qi));clearTimeout(babelHelpers.classPrivateFieldGet(this,tl));if(this.addressWidget.mode!==l.ControlMode.view){return}if(this.addressWidget.mode===l.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,tl,setTimeout(function(){t.closeMap()},babelHelpers.classPrivateFieldGet(this,sl)))}};var pl=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var i=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var r=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var n=new l.Location(JSON.parse(BX.message("LOCATION_WIDGET_USER_LOCATION")));var d=t.addressFormat||new l.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var b=t.presetLocationsProvider?t.presetLocationsProvider:function(){return t.presetLocationList?t.presetLocationList:[]};var o=[];if(!t.useFeatures||t.useFeatures.fields!==false){o.push(this.createFieldsFeature({addressFormat:d,languageId:i}))}var c=null;if(s&&a){try{c=this.createSource(s,a,i,r)}catch(e){if(e instanceof l.SourceCreationError){c=null}else{throw e}}}var u=null;if(c){if(!t.useFeatures||t.useFeatures.autocomplete!==false){o.push(this.createAutocompleteFeature({languageId:i,addressFormat:d,source:c,userLocation:n,presetLocationsProvider:b}))}if(!t.useFeatures||t.useFeatures.map!==false){var p=!!a.showPhotos;var v=!!a.useGeocodingService;var h=80;var f=150;var H=p?5:0;var F="auto";u=this.createMapFeature({addressFormat:d,source:c,useGeocodingService:v,popupOptions:t.popupOptions,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||h,thumbnailWidth:t.thumbnailWidth||f,maxPhotoCount:t.maxPhotoCount||H,mapBehavior:t.mapBehavior||F,userLocation:n});o.push(u)}}var P=new O({features:o,address:t.address,mode:t.mode,addressFormat:d,languageId:i});if(u){P.subscribeOnFeatureEvent(function(e){var t=e.getData();if(t.feature instanceof ji&&t.eventCode===ji.showOnMapClickedEvent){u.showMap()}})}return P}},{key:"createFieldsFeature",value:function e(t){var s=new _i({addressFormat:t.addressFormat,languageId:t.languageId});return new Ji({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new Wt({sourceCode:t.source.sourceCode,languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService,userLocation:t.userLocation,presetLocationsProvider:t.presetLocationsProvider});return new ji({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s={cacheable:true,closeByEsc:true,className:"location-popup-window location-source-".concat(t.source.sourceCode),animation:"fading",angle:true,bindOptions:t.popupBindOptions};if(t.popupOptions){s=Object.assign(s,t.popupOptions)}var a=new ms(s);var i=null;if(t.maxPhotoCount>0){i=new Ya({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var r={map:new ba({addressFormat:t.addressFormat,map:t.source.map,popup:a,gallery:i,locationRepository:new l.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null,userLocation:t.userLocation})};var n;if(t.mapBehavior==="manual"){n=new Ui(r)}else{n=new dl(r)}return n}},{key:"createSource",value:function e(a,i,l,r){var n=null;i.languageId=l;i.sourceLanguageId=r;if(a==="GOOGLE"){n=new s.Google(i)}else if(a==="OSM"){n=t.OSMFactory.createOSMSource(i)}else{throw new RangeError("Wrong source code")}return n}}]);return e}();function vl(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);vl=function t(){return e};return e}function hl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function fl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Hl=new WeakMap;var Fl=new WeakMap;var Pl=new WeakMap;var ml=new WeakSet;var gl=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ml.add(babelHelpers.assertThisInitialized(e));Hl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});Fl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});Pl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),Hl,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),Pl,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,Fl,d.Tag.render(vl(),fl(this,ml,wl).call(this)));babelHelpers.classPrivateFieldGet(this,Fl).addEventListener("click",function(e){a.state=babelHelpers.classPrivateFieldGet(a,Hl)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit(hl(t,t,Tl),{state:babelHelpers.classPrivateFieldGet(a,Hl)});e.stopPropagation();return false});babelHelpers.classPrivateFieldGet(this,Fl).addEventListener("mouseover",function(e){e.stopPropagation()});return babelHelpers.classPrivateFieldGet(this,Fl)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe(hl(t,t,Tl),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,Hl,t);if(babelHelpers.classPrivateFieldGet(this,Fl)){babelHelpers.classPrivateFieldGet(this,Fl).innerHTML=fl(this,ml,wl).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,Hl)}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(gl,"STATE_OFF",0);babelHelpers.defineProperty(gl,"STATE_ON",1);var Tl={writable:true,value:"onToggleEvent"};var wl=function e(){return babelHelpers.classPrivateFieldGet(this,Pl)[babelHelpers.classPrivateFieldGet(this,Hl)]};function yl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);yl=function t(){return e};return e}function Il(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Gl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Sl=new WeakMap;var kl=new WeakMap;var El=new WeakSet;var Cl=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));El.add(babelHelpers.assertThisInitialized(e));Sl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});kl.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,Sl,s.type);babelHelpers.classPrivateFieldSet(this,kl,d.Tag.render(yl(),Gl(this,El,Al).call(this,babelHelpers.classPrivateFieldGet(this,Sl))));babelHelpers.classPrivateFieldGet(this,kl).addEventListener("click",function(e){a.emit(Il(t,t,Wl))});return babelHelpers.classPrivateFieldGet(this,kl)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(Il(t,t,Wl),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Sl,t);if(babelHelpers.classPrivateFieldGet(this,kl)){babelHelpers.classPrivateFieldGet(this,kl).className=Gl(this,El,Al).call(this,babelHelpers.classPrivateFieldGet(this,Sl))}}}]);return t}(n.EventEmitter);var Wl={writable:true,value:"onClick"};babelHelpers.defineProperty(Cl,"TYPE_CLEAR","clear");babelHelpers.defineProperty(Cl,"TYPE_SEARCH","search");babelHelpers.defineProperty(Cl,"TYPE_LOADER","loader");var Al=function e(t){var s="";if(t===Cl.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===Cl.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===Cl.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function Ml(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Ml=function t(){return e};return e}function zl(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);zl=function t(){return e};return e}function _l(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);_l=function t(){return e};return e}function Ll(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);Ll=function t(){return e};return e}function Ol(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Ol=function t(){return e};return e}function Nl(){var e=babelHelpers.taggedTemplateLiteral(["",""]);Nl=function t(){return e};return e}function Dl(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);Dl=function t(){return e};return e}function Bl(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);Bl=function t(){return e};return e}function Rl(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);Rl=function t(){return e};return e}function Xl(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function xl(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ul=new WeakSet;var Yl=new WeakSet;var Vl=new WeakSet;var jl=new WeakSet;var Kl=new WeakSet;var ql=new WeakSet;var Jl=new WeakSet;var $l=new WeakSet;var Zl=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));$l.add(babelHelpers.assertThisInitialized(s));Jl.add(babelHelpers.assertThisInitialized(s));ql.add(babelHelpers.assertThisInitialized(s));Kl.add(babelHelpers.assertThisInitialized(s));jl.add(babelHelpers.assertThisInitialized(s));Vl.add(babelHelpers.assertThisInitialized(s));Yl.add(babelHelpers.assertThisInitialized(s));Ul.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var i=this.getValue();var r=null;if(d.Type.isStringFilled(i)){try{r=new l.Address(JSON.parse(i))}catch(e){BX.debug("Cant parse address value");return}}var n=new pl;this._addressWidget=n.createAddressWidget({address:r,mode:this._mode===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(xl(this,Kl,ir).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(xl(this,ql,lr).bind(this));this._fieldsSwitch=new gl({state:gl.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(xl(this,Yl,tr).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?l.ControlMode.edit:l.ControlMode.view;this._fieldsSwitch.state=gl.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=xl(this,$l,nr).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;d.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?xl(this,$l,nr).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=d.Tag.render(Rl(),"".concat(this.getName(),"_STRING"));this._hiddenInput=d.Tag.render(Bl(),this.getValue(),this.getName());this._inputIcon=new Cl;this._inputIcon.subscribeOnClickEvent(xl(this,Ul,er).bind(this));var l=this._inputIcon.render({type:Xl(t,t,Ql).call(t,xl(this,$l,nr).call(this))});this._inputContainer=d.Tag.render(Dl(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(d.Tag.render(Nl(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=d.Tag.render(Ol(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=d.Tag.render(Ll());if(this._fieldsSwitch.state===gl.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var n=xl(this,Jl,rr).call(this,xl(this,$l,nr).call(this));r=d.Tag.render(_l(),n);this._innerWrapper=d.Tag.render(zl(),r);i.mapBindElement=r}else{this._innerWrapper=d.Tag.render(Ml(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=Cl.TYPE_CLEAR}if(!d.Type.isArray(i)){return}i.forEach(function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)})}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",function(e,s){s.methods.address=t.registerFieldMethod})}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var Ql=function e(t){return t?Cl.TYPE_CLEAR:Cl.TYPE_SEARCH};var er=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=Cl.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var tr=function e(t){var s=t.getData();var a=s.state;if(a===gl.STATE_OFF){xl(this,Vl,sr).call(this)}else{xl(this,jl,ar).call(this)}this._addressWidget.resetView()};var sr=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var ar=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var ir=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===r.State.DATA_LOADING){i=Cl.TYPE_LOADER}else{if(s.state===r.State.DATA_INPUTTING){this.markAsChanged()}i=Xl(Zl,Zl,Ql).call(Zl,xl(this,$l,nr).call(this))}this._inputIcon.type=i};var lr=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=Xl(Zl,Zl,Ql).call(Zl,a)}};var rr=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var nr=function e(){return this._addressWidget.address};Zl.registerField();e.Address=O;e.BaseFeature=o;e.MapFeature=Ui;e.AutocompleteFeature=ji;e.FieldsFeature=Ji;e.Factory=pl;e.State=b;e.UIAddress=Zl})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX.Location.OSM,BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js