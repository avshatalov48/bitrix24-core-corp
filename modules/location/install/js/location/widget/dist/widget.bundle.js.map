{"version":3,"file":"widget.bundle.js","sources":["../src/state.js","../src/address/features/basefeature.js","../src/autocomplete/menu.js","../src/autocomplete/prompt.js","../src/autocomplete/autocomplete.js","../src/address/features/autocompletefeature.js","../src/address/address.js","../src/mappopup/addressstring.js","../src/mappopup/popup.js","../src/mappopup/mappopup.js","../src/mappopup/photo.js","../src/mappopup/gallery.js","../src/fields/field.js","../src/fields/fields.js","../src/address/features/mapfeature.js","../src/address/features/fieldsfeature.js","../src/address/features/mapfeatureauto.js","../src/factory.js","../src/ui-address/switch.js","../src/ui-address/icon.js","../src/ui-address/ui-address.js","../src/widget.js"],"sourcesContent":["/**\n * Contains\n * */\nexport default class State\n{\n\tstatic INITIAL = 'INITIAL';\n\tstatic DATA_INPUTTING = 'DATA_INPUTTING';\n\tstatic DATA_SELECTED = 'DATA_SELECTED';\n\tstatic DATA_LOADING = 'DATA_LOADING';\n\tstatic DATA_LOADED = 'DATA_LOADED';\n}","import {Address, MethodNotImplemented} from \"location.core\";\n\n/**\n * Base class for the address widget feature\n */\nexport default class BaseFeature\n{\n\trender(props)\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthrow new MethodNotImplemented('Method set address must be implemented');\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\n\t}\n\n\tdestroy(): void\n\t{\n\n\t}\n\n\tresetView(): void\n\t{\n\n\t}\n}","import {Menu as MainMenu} from \"main.popup\";\nimport \"./css/menu.css\";\n\nexport default class Menu extends MainMenu\n{\n\tchoseItemIdx = -1;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tconst elRect = options.bindElement.getBoundingClientRect();\n\t\tthis.popupWindow.setMaxWidth(elRect.width);\n\t}\n\n\tisMenuEmpty(): boolean\n\t{\n\t\treturn this.menuItems.length <= 0;\n\t}\n\n\tisChoseLastItem(): boolean\n\t{\n\t\treturn this.choseItemIdx >= this.menuItems.length - 1;\n\t}\n\n\tisChoseFirstItem(): boolean\n\t{\n\t\treturn this.choseItemIdx === 0;\n\t}\n\n\tisItemChosen(): boolean\n\t{\n\t\treturn this.choseItemIdx >= 0;\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn this.getPopupWindow().isDestroyed();\n\t}\n\n\tisItemExist(index: number): boolean\n\t{\n\t\treturn typeof this.menuItems[this.choseItemIdx] !== 'undefined';\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\n\t\tif(this.isItemChosen() && this.isItemExist(this.choseItemIdx))\n\t\t{\n\t\t\tresult = this.menuItems[this.choseItemIdx];\n\t\t}\n\n\t\treturn result;\n\t}\n\tchooseNextItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseLastItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx + 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\tchoosePrevItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseFirstItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx - 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\thighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tlet item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.add(\"highlighted\");\n\t\t\t}\n\t\t}\n\t}\n\n\tunHighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tlet item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.remove(\"highlighted\");\n\t\t\t}\n\t\t}\n\t}\n\n\tchooseItem(index: number)\n\t{\n\t\tthis.unHighlightItem(this.choseItemIdx);\n\t\tthis.choseItemIdx = index;\n\t\tthis.highlightItem(this.choseItemIdx);\n\t}\n\n\tclearItems()\n\t{\n\t\twhile(this.menuItems.length > 0)\n\t\t{\n\t\t\tthis.removeMenuItem(this.menuItems[0].id);\n\t\t}\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getPopupWindow().isShown();\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport Menu from './menu';\n\nexport default class Prompt extends EventEmitter\n{\n\tstatic onItemSelectedEvent = 'onItemSelected';\n\n\t/** Element */\n\t#inputNode;\n\t/** {Menu} */\n\t#menu;\n\n\t#locationList;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Prompt');\n\n\t\tthis.#inputNode = props.inputNode;\n\t}\n\n\t#createMenu()\n\t{\n\t\treturn new Menu({\n\t\t\tbindElement: this.#inputNode,\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true\n\t\t});\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tif(!this.#menu || this.#menu.isDestroyed())\n\t\t{\n\t\t\tthis.#menu = this.#createMenu();\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t/**\n\t * Show menu with list of locations\n\t * @param {array} locationsList\n\t * @param {string} searchPhrase\n\t * @returns void\n\t */\n\tshow(locationsList: Array<Location>, searchPhrase: string): void\n\t{\n\t\tif(locationsList.length > 0)\n\t\t{\n\t\t\tthis.#setMenuItems(locationsList, searchPhrase);\n\t\t\tthis.getMenu().show();\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.getMenu().close();\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @param {string} searchPhrase\n\t * @returns {*}\n\t */\n\t#setMenuItems(locationsList: array<Location>, searchPhrase: string): Menu\n\t{\n\t\tthis.getMenu().clearItems();\n\n\t\tif(Array.isArray(locationsList))\n\t\t{\n\t\t\tthis.#locationList = locationsList.slice();\n\n\t\t\tlocationsList.forEach((location) => {\n\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\tthis.#createMenuItem(location, searchPhrase)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * @param {Location} location\n\t * @param {string} searchPhrase\n\t * @returns {{onclick: onclick, text: string}}\n\t */\n\t#createMenuItem(location: Location, searchPhrase): Object\n\t{\n\t\tconst externalId = location.externalId;\n\n\t\treturn {\n\t\t\tid: externalId,\n\t\t\ttitle: location.name,\n\t\t\thtml: Prompt.createMenuItemText(location.name, searchPhrase),\n\t\t\tonclick: (event, item) => {\n\t\t\t\tthis.#onItemSelect(externalId);\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t};\n\t}\n\n\t#onItemSelect(externalId: string): void\n\t{\n\t\tconst location = this.#getLocationFromList(externalId);\n\n\t\tif(location)\n\t\t{\n\t\t\tthis.emit(Prompt.onItemSelectedEvent, {location: location});\n\t\t}\n\t}\n\n\tstatic createMenuItemText(locationName: string, searchPhrase: string): string\n\t{\n\t\tlet result = locationName.slice();\n\n\t\tif(!searchPhrase || searchPhrase.length <= 0)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst spWords = searchPhrase\n\t\t\t.replace(/,+/gi, '')\n\t\t\t.split(new RegExp(/\\s+/g));\n\n\t\tconst pattern = new RegExp(`(${spWords.join('|')})`, 'gi');\n\n\t\tresult = locationName.replace(pattern, match => `<strong>${match}</strong>`);\n\n\t\treturn result;\n\t}\n\n\t#getLocationFromList(externalId: string): ?Location\n\t{\n\t\tlet result = null;\n\n\t\tfor(let location of this.#locationList)\n\t\t{\n\t\t\tif(location.externalId === externalId)\n\t\t\t{\n\t\t\t\tresult = location;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif(!result)\n\t\t{\n\t\t\tBX.debug('Location with externalId ' + externalId + ' was not found');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchoosePrevItem()\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().choosePrevItem();\n\n\t\tif(item)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(item.id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem()\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().chooseNextItem();\n\n\t\tif(item)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(item.id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisItemChosen()\n\t{\n\t\treturn this.#menu.isItemChosen();\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\t\tconst menuItem = this.#menu.getChosenItem();\n\n\t\tif(menuItem && menuItem.id)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(menuItem.id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getMenu().isShown();\n\t}\n\n\tdestroy()\n\t{\n\t\tif(this.#menu)\n\t\t{\n\t\t\tthis.#menu.destroy();\n\t\t\tthis.#menu = null;\n\t\t}\n\n\t\tthis.#locationList = null;\n\t}\n}","import {Event} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {LocationRepository, AutocompleteServiceBase, Format, Address, Location, AddressType, AddressStringConverter, ErrorPublisher} from 'location.core';\nimport Prompt from './prompt';\nimport State from '../state';\nimport {Loc} from 'main.core';\n\n/**\n * @mixes EventEmitter\n */\nexport default class Autocomplete extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\tstatic #onSearchStartedEvent = 'onSearchStarted';\n\tstatic #onSearchCompletedEvent = 'onSearchCompleted';\n\n\t/** {Address} */\n\t#address;\n\t/** {String} */\n\t#addressString = '';\n\t/** {String} */\n\t#languageId;\n\t/** {Format} */\n\t#addressFormat;\n\t/** {LocationRepository} */\n\t#locationRepository;\n\t/** {Prompt} */\n\t#prompt;\n\t/** {AutocompleteServiceBase} */\n\t#autocompleteService;\n\t/** @type {number} */\n\t#minCharsCountToAutocomplete;\n\t/** {number} miliseconds promptDelay before the searching will start */\n\t#promptDelay;\n\t/** {number} */\n\t#maxPromptDelay;\n\t/** {number} */\n\t#timerId = null;\n\t/** {Element} */\n\t#inputNode;\n\n\t#searchPhrase = {\n\t\trequested: '',\n\t\tcurrent: '',\n\t\tdropped: ''\n\t};\n\n\t#state;\n\t#isDestroyed = false;\n\n\t#prevKeyUpTime;\n\t#avgKeyUpDelay;\n\n\t#isAutocompleteRequestStarted = false;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('props.addressFormat must be type of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif(!(props.autocompleteService instanceof AutocompleteServiceBase))\n\t\t{\n\t\t\tthrow new Error('props.autocompleteService must be type of AutocompleteServiceBase');\n\t\t}\n\n\t\tthis.#autocompleteService = props.autocompleteService;\n\n\t\tif(!props.languageId)\n\t\t{\n\t\t\tthrow new Error('props.languageId must be defined');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#address = props.address;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#promptDelay = props.promptDelay || 500;\n\t\tthis.#maxPromptDelay = props.maxPromptDelay || 1500;\n\t\tthis.#minCharsCountToAutocomplete = props.minCharsCountToAutocomplete || 3;\n\t\tthis.#setState(State.INITIAL);\n\t\tthis.#avgKeyUpDelay = this.#promptDelay;\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(\n\t\t\tthis.#addressFormat,\n\t\t\tAddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT\n\t\t);\n\t}\n\n\trender(props: {}): void\n\t{\n\t\tthis.#inputNode = props.inputNode;\n\t\tthis.#addressString = this.#inputNode.value;\n\n\t\tthis.#address = props.address;\n\n\t\tthis.#inputNode.addEventListener('keyup', this.#onInputKeyUp.bind(this));\n\t\tthis.#inputNode.addEventListener('focus', this.#onInputFocus.bind(this));\n\t\tthis.#inputNode.addEventListener('focusout', this.#onInputFocusOut.bind(this));\n\n\n\t\tthis.#prompt = new Prompt({\n\t\t\tinputNode: props.inputNode\n\t\t});\n\n\t\tthis.#prompt.subscribe(Prompt.onItemSelectedEvent, this.#onPromptItemSelected.bind(this));\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\t}\n\n\t#onInputFocusOut()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.#state === State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\tthis.#setAddressFromInput();\n\t\t}\n\n\t\tif(this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\t#onInputFocus()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.#address && (!this.#address.location) && this.#inputNode.value.length > 0)\n\t\t{\n\t\t\tthis.showPrompt(this.#inputNode.value, {});\n\t\t}\n\t}\n\n\t/**\n\t * @param address\n\t */\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif(this.#inputNode)\n\t\t{\n\t\t\tthis.#addressString = this.#inputNode.value;\n\t\t}\n\t}\n\n\t#getInputValue()\n\t{\n\t\tlet result = '';\n\n\t\tif(this.#inputNode)\n\t\t{\n\t\t\tresult = this.#inputNode.value;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @returns {Address}\n\t */\n\tget address(): ?Address\n\t{\n\t\treturn this.#address;\n\t}\n\n\t/**\n\t * @returns {Prompt}\n\t */\n\tget prompt(): ?Prompt\n\t{\n\t\treturn this.#prompt;\n\t}\n\n\t#setAddressFromInput()\n\t{\n\t\tthis.#address = this.#convertStringToAddress(\n\t\t\tthis.#getInputValue()\n\t\t);\n\n\t\tthis.#onAddressChangedEventEmit();\n\t}\n\n\t/**\n\t * Close menu on mouse click outside\n\t * @param {MouseEvent} event\n\t */\n\t#onDocumentClick(event: MouseEvent)\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.target === this.#inputNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.#prompt.isShown())\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\t/**\n\t * Subscribe on changed event\n\t * @param {Function} listener\n\t */\n\tonAddressChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onAddressChangedEvent, listener);\n\t}\n\n\t/**\n\t * Subscribe on loading event\n\t * @param {Function} listener\n\t */\n\tonStateChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onStateChangedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchStartedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchStartedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchCompletedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchCompletedEvent, listener);\n\t}\n\n\t/**\n\t * Is called when autocompleteService returned location list\n\t * @param {array} locationsList\n\t * @param {object} params\n\t */\n\t#onPromptsReceived(locationsList: array<Location>, params: Object): void\n\t{\n\t\tif(Array.isArray(locationsList) && locationsList.length > 0)\n\t\t{\n\t\t\tthis.#prompt.show(locationsList, this.#searchPhrase.requested);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst split = Autocomplete.#splitPhrase(this.#searchPhrase.current);\n\t\t\tthis.#searchPhrase.current = split[0];\n\t\t\tthis.#searchPhrase.dropped = split[1] + ' ' + this.#searchPhrase.dropped;\n\n\t\t\tif(this.#searchPhrase.current.length > 0)\n\t\t\t{\n\t\t\t\tthis.#showPromptInner(this.#searchPhrase.current, params, 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#prompt.getMenu().clearItems();\n\n\t\t\t\tthis.#prompt.getMenu().addMenuItem(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'notFound',\n\t\t\t\t\t\thtml: `<span>${Loc.getMessage('LOCATION_WIDGET_PROMPT_RESULTS_NOT_FOUND')}</span>`,\n\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.#prompt.getMenu().show();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic #splitPhrase(phrase: string): Object\n\t{\n\t\tphrase = phrase.trim();\n\n\t\tif(phrase.length <= 0)\n\t\t{\n\t\t\treturn['', ''];\n\t\t}\n\n\t\tconst tailPosition = phrase.lastIndexOf(' ');\n\n\t\tif(tailPosition <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\treturn [phrase.slice(0, tailPosition), phrase.slice(tailPosition + 1)];\n\t}\n\n\t/**\n\t * Is called when location from menu have chosen\n\t * @param event\n\t */\n\t#onPromptItemSelected(event: BaseEvent): void\n\t{\n\t\tif(event.data.location)\n\t\t{\n\t\t\tthis.#fulfillSelection(event.data.location)\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Autocomplete.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\t/**\n\t * Fulfill selected location\n\t * @param {Location} location\n\t * @returns {*}\n\t */\n\t#fulfillSelection(location: ?Location): void\n\t{\n\t\tlet result;\n\t\tthis.#setState(State.DATA_SELECTED);\n\n\t\tif(location)\n\t\t{\n\t\t\tresult = this.#getLocationDetails(location)\n\t\t\t\t.then((location: ?Location) => {\n\t\t\t\t\tthis.#onLocationSelect(location);\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tresponse => ErrorPublisher.getInstance().notify(response.errors)\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\tthis.#onLocationSelect(null);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#onAddressChangedEventEmit()\n\t{\n\t\tthis.#addressString = this.#address ? this.#convertAddressToString(this.#address) : '';\n\t\tthis.emit(Autocomplete.#onAddressChangedEvent, {address: this.#address});\n\t}\n\n\t/**\n\t * obtain location details\n\t * @param {Location} location\n\t * @returns {*}\n\t */\n\t#getLocationDetails(location: Location): Promise\n\t{\n\t\tthis.#setState(State.DATA_LOADING);\n\n\t\treturn this.#locationRepository.findByExternalId(\n\t\t\tlocation.externalId,\n\t\t\tlocation.sourceCode,\n\t\t\tlocation.languageId\n\t\t)\n\t\t.then((location: ?Location) => {\n\t\t\t\tthis.#setState(State.DATA_LOADED);\n\t\t\treturn location;\n\t\t},\n\t\t\t(response) => {\n\t\t\t\tErrorPublisher.getInstance().notify(response.errors);\n\t\t\t}\n\t\t);\n\t}\n\n\t#convertStringToAddress(addressString: string)\n\t{\n\t\tconst result = new Address({\n\t\t\tlanguageId: this.#languageId\n\t\t});\n\n\t\tresult.setFieldValue(this.#addressFormat.fieldForUnRecognized, addressString);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Is called when location was selected and the location details were obtained\n\t * @param {Location} location\n\t */\n\t#onLocationSelect(location: ?Location): void\n\t{\n\t\tthis.#address = location ? location.toAddress() : null;\n\n\t\tif(this.#address && this.#searchPhrase.dropped.length > 0)\n\t\t{\n\t\t\tthis.#address.setFieldValue(this.#addressFormat.fieldForUnRecognized, this.#searchPhrase.dropped);\n\t\t}\n\n\t\tthis.#onAddressChangedEventEmit();\n\t}\n\n\t#onInputKeyUp(e: KeyboardEvent): void\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst now = Date.now();\n\n\t\tif(this.#prevKeyUpTime)\n\t\t{\n\t\t\tconst delta = now - this.#prevKeyUpTime;\n\t\t\tthis.#avgKeyUpDelay = (this.#avgKeyUpDelay + delta) / 2;\n\t\t}\n\n\t\tthis.#prevKeyUpTime = now;\n\n\t\tif(\n\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t&& this.#addressString.trim() !== this.#getInputValue().trim()\n\t\t)\n\t\t{\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t}\n\n\t\tif(this.#prompt.isShown())\n\t\t{\n\t\t\tswitch (e.code)\n\t\t\t{\n\t\t\t\tcase 'NumpadEnter':\n\t\t\t\tcase 'Enter':\n\t\t\t\t\tif(this.#prompt.isItemChosen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#fulfillSelection(this.#prompt.getChosenItem())\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror => BX.debug(error)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\tcase 'Tab':\n\t\t\t\tcase 'Escape':\n\t\t\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\t\t\tthis.#setAddressFromInput();\n\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\tthis.#prompt.choosePrevItem();\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\tthis.#prompt.chooseNextItem();\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(this.#addressString.trim() !== this.#getInputValue().trim())\n\t\t{\n\t\t\tthis.showPrompt(this.#inputNode.value, {});\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} searchPhrase\n\t * @param {Object} params\n\t */\n\tshowPrompt(searchPhrase: string, params: Object): void\n\t{\n\t\tthis.#searchPhrase.requested = searchPhrase;\n\t\tthis.#searchPhrase.current = searchPhrase;\n\t\tthis.#searchPhrase.dropped = '';\n\t\tthis.#showPromptInner(searchPhrase, params, this.#computePromptDelay());\n\t}\n\n\t/**\n\t * @returns {number}\n\t */\n\t#computePromptDelay(): number\n\t{\n\t\tconst delay = this.#promptDelay > this.#avgKeyUpDelay ? this.#promptDelay : this.#avgKeyUpDelay * 1.5;\n\t\treturn delay > this.#maxPromptDelay ? this.#maxPromptDelay : delay;\n\t}\n\n\tclosePrompt(): void\n\t{\n\t\tif(this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\tisPromptShown(): boolean\n\t{\n\t\tif(this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.isShown();\n\t\t}\n\t}\n\n\t#showPromptInner(searchPhrase: string, params: Object, promptDelay: number): void\n\t{\n\t\tif(searchPhrase.length > this.#minCharsCountToAutocomplete)\n\t\t{\n\t\t\tif(this.#timerId !== null)\n\t\t\t{\n\t\t\t\tclearTimeout(this.#timerId);\n\t\t\t}\n\n\t\t\tthis.#timerId = this.#createTimer(searchPhrase, params, promptDelay);\n\t\t}\n\t}\n\n\t/**\n\t * Wait for further user input for some time\n\t * @param {string} searchPhrase\n\t * @param {object} params\n\t * @param {number} promptDelay\n\t * @returns {number}\n\t */\n\t#createTimer(searchPhrase: string, params: Object, promptDelay: number): number\n\t{\n\t\treturn setTimeout(() => {\n\n\t\t\t// to avoid multiple parallel requests, if server responses are too slow.\n\t\t\tif(this.#isAutocompleteRequestStarted)\n\t\t\t{\n\t\t\t\tclearTimeout(this.#timerId);\n\t\t\t\tthis.#timerId = this.#createTimer(searchPhrase, params, promptDelay);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(Autocomplete.#onSearchStartedEvent);\n\t\t\tthis.#isAutocompleteRequestStarted = true;\n\t\t\tthis.#autocompleteService.autocomplete(searchPhrase, params)\n\t\t\t\t.then(\n\t\t\t\t\t(locationsList: Array<Location>) => {\n\t\t\t\t\t\tthis.#timerId = null;\n\t\t\t\t\t\tthis.#onPromptsReceived(locationsList, params);\n\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t},\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\tBX.debug(error);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tpromptDelay\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\n\t\tif(this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.destroy();\n\t\t\tthis.#prompt = null;\n\t\t}\n\n\t\tthis.#timerId = null;\n\n\t\tif(this.#inputNode)\n\t\t{\n\t\t\tthis.#inputNode.removeEventListener('keyup', this.#onInputKeyUp);\n\t\t\tthis.#inputNode.removeEventListener('focus', this.#onInputFocus);\n\t\t\tthis.#inputNode.removeEventListener('focusout', this.#onInputFocusOut);\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Autocomplete from '../../autocomplete/autocomplete';\n\n/**\n * Complex address widget\n */\nexport default class AutocompleteFeature extends BaseFeature\n{\n\tstatic searchStartedEvent = 'searchStarted';\n\tstatic searchCompletedEvent = 'searchCompleted';\n\n\t#autocomplete;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper();\n\n\t\tif(!(props.autocomplete instanceof Autocomplete))\n\t\t{\n\t\t\tBX.debug('props.autocomplete  must be instance of Autocomplete');\n\t\t}\n\n\t\tthis.#autocomplete = props.autocomplete;\n\n\t\tthis.#autocomplete.onAddressChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\n\t\tthis.#autocomplete.onStateChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchStartedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchStartedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchCompletedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchCompletedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#autocomplete.closePrompt();\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#autocomplete.render({\n\t\t\t\tinputNode: this.#addressWidget.inputNode,\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tthis.#autocomplete.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tget autocomplete()\n\t{\n\t\treturn this.#autocomplete;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#autocomplete.destroy();\n\t\tthis.#autocomplete = null;\n\t}\n}","import {Type, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Address as AddressEntity, AddressType, ControlMode, Format,\n\t\tAddressStringConverter, LocationRepository, ErrorPublisher, Location} from 'location.core';\nimport State from '../state';\nimport BaseFeature from './features/basefeature';\nimport AutocompleteFeature from './features/autocompletefeature';\nimport {FeatureEvent} from './featurevent';\n\n/**\n * Props for the address widget constructor\n */\nexport type AddressConstructorProps = {\n\t/** @see ControlMode */\n\tmode: string,\n\taddressFormat: Format,\n\taddress?: AddressEntity,\n\tneedWarmBackendAfterAddressChanged?: boolean,\n\tlocationRepository?: LocationRepository,\n\tpresetLocationList?: Array\n};\n\n/**\n * Props for the address widget render method\n */\nexport type AddressRenderProps = {\n\t/** Input control witch will be used by user to enter the address */\n\tinputNode: Element,\n\t/** Control wrapper witch could be used for mouseover event etc. */\n\tcontrolWrapper: Element,\n\t/** If map feature is used it could be used ti bind map popup */\n\tmapBindElement: ?Element\n};\n\n/**\n * Address widget\n */\nexport default class Address extends EventEmitter\n{\n\t/* If address was changed by user */\n\tstatic onAddressChangedEvent = 'onAddressChanged';\n\t/* If state of the widget was changed */\n\tstatic onStateChangedEvent = 'onStateChanged';\n\t/* Any feature-related events */\n\tstatic onFeatureEvent = 'onFeatureEvent';\n\n\t#mode;\n\t#state;\n\t#address;\n\t#addressFormat;\n\t#languageId;\n\n\t#features = [];\n\n\t#inputNode;\n\t#controlWrapper;\n\n\t#destroyed = false;\n\n\t#isAddressChangedByFeature = false;\n\t#isInputNodeValueUpdated = false;\n\n\t#needWarmBackendAfterAddressChanged = true;\n\t#locationRepository;\n\n\t#presetLocationList = [];\n\n\t/**\n\t * Constructor\n\t * @param {AddressConstructorProps} props\n\t */\n\tconstructor(props: AddressConstructorProps)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Address');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif(props.address && !(props.address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address || null;\n\n\t\tif(!(ControlMode.isValid(props.mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif(!Type.isString(props.languageId))\n\t\t{\n\t\t\tthrow new TypeError('props.languageId must be type of string');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\n\t\tif(props.features)\n\t\t{\n\t\t\tif(!Type.isArray(props.features))\n\t\t\t{\n\t\t\t\tthrow new TypeError('features must be an array');\n\t\t\t}\n\n\t\t\tprops.features.forEach((feature: BaseFeature) => {\n\t\t\t\tthis.#addFeature(feature);\n\t\t\t});\n\t\t}\n\n\t\tif(Type.isBoolean(props.needWarmBackendAfterAddressChanged))\n\t\t{\n\t\t\tthis.#needWarmBackendAfterAddressChanged = props.needWarmBackendAfterAddressChanged;\n\t\t}\n\n\t\tif(props.locationRepository instanceof LocationRepository)\n\t\t{\n\t\t\tthis.#locationRepository = props.locationRepository;\n\t\t}\n\t\telse if(this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#locationRepository = new LocationRepository();\n\t\t}\n\n\t\tif(props.presetLocationList)\n\t\t{\n\t\t\tif(!Type.isArray(props.presetLocationList))\n\t\t\t{\n\t\t\t\tthrow new TypeError('Preset location list must be an array');\n\t\t\t}\n\n\t\t\tfor (let location of props.presetLocationList)\n\t\t\t{\n\t\t\t\tif(!(location instanceof Location))\n\t\t\t\t{\n\t\t\t\t\tBX.debug('location must be instance of Location');\n\t\t\t\t}\n\n\t\t\t\tthis.#presetLocationList.push(location);\n\t\t\t}\n\t\t}\n\n\t\tthis.#state = State.INITIAL;\n\t}\n\n\t/**\n\t * @param {AddressEntity} address\n\t * @param {BaseFeature} sourceFeature\n\t * @internal\n\t */\n\tsetAddressByFeature(address: AddressEntity, sourceFeature: BaseFeature): void\n\t{\n\t\tconst addressId = this.#address ? this.#address.id : 0;\n\t\tthis.#address = address;\n\n\t\tif(addressId > 0)\n\t\t{\n\t\t\tthis.#address.id = addressId;\n\t\t}\n\n\t\tthis.#isAddressChangedByFeature = true;\n\t\tthis.#setInputValue(address);\n\n\t\tthis.#executeFeatureMethod('setAddress', [address], sourceFeature);\n\n\t\tif(this.#state !== State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\t}\n\n\temitFeatureEvent(featureEvent: FeatureEvent)\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onFeatureEvent,\n\t\t\tfeatureEvent\n\t\t);\n\t}\n\n\t/**\n\t * Add feature to the widget\n\t * @param {BaseFeature} feature\n\t */\n\t#addFeature(feature: BaseFeature)\n\t{\n\t\tif(!(feature instanceof BaseFeature))\n\t\t{\n\t\t\tBX.debug('feature must be instance of BaseFeature');\n\t\t}\n\n\t\tfeature.setAddressWidget(this);\n\t\tthis.#features.push(feature);\n\t}\n\n\tget features()\n\t{\n\t\treturn this.#features;\n\t}\n\n\t#executeFeatureMethod(method, params = [], excludeFeature = null)\n\t{\n\t\tlet result;\n\n\t\tfor(let feature of this.#features)\n\t\t{\n\t\t\tif(feature !== excludeFeature)\n\t\t\t{\n\t\t\t\tresult = feature[method].apply(feature, params);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#emitOnAddressChanged()\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onAddressChangedEvent,\n\t\t\t{address: this.#address}\n\t\t);\n\n\t\tif(this.#address && this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#warmBackendAfterAddressChanged(this.#address);\n\t\t}\n\t}\n\n\t#warmBackendAfterAddressChanged(address: AddressEntity): void\n\t{\n\t\tif(address.location !== null && address.location.id <= 0)\n\t\t{\n\t\t\tthis.#locationRepository.findParents(address.location);\n\t\t}\n\t}\n\n\t#onInputFocus(e: KeyboardEvent)\n\t{\n\t\tlet value = this.#inputNode.value;\n\n\t\tif(value.length > 0)\n\t\t{\n\t\t\tBX.setCaretPosition(this.#inputNode, value.length - 1)\n\t\t}\n\t}\n\n\t#onInputClick(e: MouseEvent)\n\t{\n\t\tlet value = this.#inputNode.value;\n\n\t\tif(value.length === 0 && this.#presetLocationList.length > 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#showPresetLocations()\n\t{\n\t\tlet autocompleteFeature = this.#getAutocompleteFeature();\n\n\t\tif (!autocompleteFeature.autocomplete || !autocompleteFeature.autocomplete.prompt)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tautocompleteFeature.autocomplete.prompt.show(this.#presetLocationList, '');\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(\n\t\t\tthis.#addressFormat,\n\t\t\tAddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT\n\t\t);\n\t}\n\n\t#setInputValue(address: ?Address)\n\t{\n\t\tif(this.#inputNode)\n\t\t{\n\t\t\tlet selectionStart = this.#inputNode.selectionStart;\n\t\t\tlet selectionEnd = this.#inputNode.selectionEnd;\n\n\t\t\tconst addressString = this.#convertAddressToString(address);\n\t\t\tthis.#inputNode.value = addressString;\n\t\t\tthis.#inputNode.title = addressString;\n\n\t\t\tthis.#inputNode.setSelectionRange(selectionStart, selectionEnd);\n\t\t}\n\t}\n\n\t#onInputFocusOut(e: KeyboardEvent)\n\t{\n\t\t// Seems that we don't have any autocompleter feature\n\t\tif(this.#isInputNodeValueUpdated && !this.#isAddressChangedByFeature)\n\t\t{\n\t\t\tlet value = this.#inputNode.value.trim();\n\t\t\tlet address = new AddressEntity({languageId: this.#languageId});\n\t\t\taddress.setFieldValue(this.#addressFormat.fieldForUnRecognized, value);\n\t\t\tthis.address = address;\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t}\n\n\tonInputKeyup(e: KeyboardEvent)\n\t{\n\t\tlet value = this.#inputNode.value;\n\n\t\tswitch (e.code)\n\t\t{\n\t\t\tcase 'Tab':\n\t\t\tcase 'Esc':\n\t\t\tcase 'Enter':\n\t\t\tcase 'NumpadEnter':\n\t\t\t\tthis.resetView();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.#isInputNodeValueUpdated = true;\n\t\t}\n\n\t\tif(value.length === 0 && this.#presetLocationList.length > 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#executeFeatureMethod('resetView');\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tif(!Type.isDomNode(props.controlWrapper))\n\t\t{\n\t\t\tBX.debug('props.controlWrapper  must be instance of Element');\n\t\t}\n\n\t\tthis.#controlWrapper = props.controlWrapper;\n\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tif(!Type.isDomNode(props.inputNode))\n\t\t\t{\n\t\t\t\tBX.debug('props.inputNode  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#inputNode = props.inputNode;\n\t\t\tthis.#setInputValue(this.#address);\n\t\t\tEvent.bind(this.#inputNode, 'focus', this.#onInputFocus.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'focusout', this.#onInputFocusOut.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'keyup', this.onInputKeyup.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'click', this.#onInputClick.bind(this));\n\t\t}\n\n\t\tthis.#executeFeatureMethod('render', [props]);\n\t}\n\n\tget controlWrapper()\n\t{\n\t\treturn this.#controlWrapper;\n\t}\n\n\tget inputNode()\n\t{\n\t\treturn this.#inputNode;\n\t}\n\n\tget address(): ?AddressEntity\n\t{\n\t\treturn this.#address;\n\t}\n\n\tset address(address: ?AddressEntity): void\n\t{\n\t\tif(address && !(address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\t\tthis.#executeFeatureMethod('setAddress', [address]);\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t\tthis.#setInputValue(address);\n\t}\n\n\tget mode()\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tif(!(ControlMode.isValid(mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tthis.#executeFeatureMethod('setMode', [mode]);\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\tget addressFormat(): Format\n\t{\n\t\treturn this.#addressFormat;\n\t}\n\n\tsetStateByFeature(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tthis.emit(\n\t\t\tAddress.onStateChangedEvent,\n\t\t\t{state: state}\n\t\t);\n\t}\n\n\t#getAutocompleteFeature()\n\t{\n\t\tlet result = null;\n\n\t\tfor( let feature of this.#features)\n\t\t{\n\t\t\tif(feature instanceof AutocompleteFeature)\n\t\t\t{\n\t\t\t\tresult = feature;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onStateChangedEvent, listener);\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onAddressChangedEvent, listener);\n\t}\n\n\tsubscribeOnFeatureEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onFeatureEvent, listener);\n\t}\n\n\tsubscribeOnErrorEvent(listener: Function): void\n\t{\n\t\tErrorPublisher.getInstance().subscribe(listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#destroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\t\tEvent.unbind(this.#inputNode, 'focus', this.#onInputFocus);\n\t\tEvent.unbind(this.#inputNode, 'focusout', this.#onInputFocusOut);\n\t\tEvent.unbind(this.#inputNode, 'keyup', this.onInputKeyup);\n\t\tEvent.unbind(this.#inputNode, 'click', this.onInputClick);\n\n\t\tthis.#executeFeatureMethod('destroy');\n\t\tthis.#destroyFeatures();\n\t\tthis.#destroyed = true;\n\t}\n\n\t#destroyFeatures()\n\t{\n\t\tthis.#features.splice(0, this.#features.length);\n\t}\n\n\tisDestroyed()\n\t{\n\t\treturn this.#destroyed;\n\t}\n}","import {Tag} from \"main.core\";\nimport {Address, Format, AddressStringConverter} from \"location.core\";\n\nexport default class AddressString\n{\n\t#address;\n\t#element;\n\t#stringElement;\n\t#addressFormat;\n\n\tconstructor(props)\n\t{\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t\tthis.#address = props.address;\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif(!this.#stringElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stringElement.innerHTML = this.#convertAddressToString(address);\n\n\t\tif(!address && !this.isHidden())\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse if(address && this.isHidden())\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.#addressFormat, AddressStringConverter.STRATEGY_TYPE_FIELD_SORT);\n\t}\n\n\trender(props): Element\n\t{\n\t\tthis.#address = props.address;\n\n\t\tthis.#stringElement = Tag.render`<div class=\"location-map-address-text\">${this.#convertAddressToString(this.#address)}</div>`;\n\n\t\tthis.#element = Tag.render`\n\t\t\t<div class=\"location-map-address-container\">\n\t\t\t\t<div class=\"location-map-address-icon\"></div>\n\t\t\t\t${this.#stringElement}\n\t\t\t</div>`;\n\n\t\treturn this.#element;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'block';\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif(this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#element || this.#element.style.display === 'none';\n\t}\n}","import {Popup as MainPopup} from 'main.popup';\n\n/**\n * Popup window, which contains map\n */\nexport default class Popup extends MainPopup\n{\n\t#detailsPopupPadding = 20;\n\n\tgetBindElement()\n\t{\n\t\treturn this.bindElement;\n\t}\n\n\tadjustPosition(bindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t}): void\n\t{\n\t\tif(this.bindOptions.position && this.bindOptions.position === 'right')\n\t\t{\n\t\t\tconst itemRect = this.bindElement.getBoundingClientRect();\n\n\t\t\tconst offsetLeft = itemRect.width;\n\t\t\tlet offsetTop = itemRect.height / 2 + this.#detailsPopupPadding;\n\t\t\tlet angleOffset = itemRect.height / 2;\n\n\t\t\tconst popupWidth = this.getPopupContainer().offsetWidth;\n\t\t\tconst popupHeight = this.getPopupContainer().offsetHeight;\n\t\t\tconst popupBottom = itemRect.top + popupHeight;\n\n\t\t\tconst clientWidth = document.documentElement.clientWidth;\n\t\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\t\t// let's try to fit a this to the browser viewport\n\t\t\tconst exceeded = popupBottom - clientHeight;\n\t\t\tif(exceeded > 0)\n\t\t\t{\n\t\t\t\tlet roundOffset = Math.ceil(exceeded / itemRect.height) * itemRect.height;\n\t\t\t\tif(roundOffset > itemRect.top)\n\t\t\t\t{\n\t\t\t\t\t// it cannot be higher than the browser viewport.\n\t\t\t\t\troundOffset -= Math.ceil((roundOffset - itemRect.top) / itemRect.height) * itemRect.height;\n\t\t\t\t}\n\n\t\t\t\tif(itemRect.bottom > (popupBottom - roundOffset))\n\t\t\t\t{\n\t\t\t\t\t// let's sync bottom boundaries.\n\t\t\t\t\troundOffset -= itemRect.bottom - (popupBottom - roundOffset) + this.#detailsPopupPadding;\n\t\t\t\t}\n\n\t\t\t\toffsetTop += roundOffset;\n\t\t\t\tangleOffset += roundOffset + this.#detailsPopupPadding;\n\t\t\t}\n\n\t\t\tif((itemRect.left + offsetLeft + popupWidth) <= clientWidth)\n\t\t\t{\n\t\t\t\tthis.setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\t\t\tthis.setAngle({position: 'left', offset: angleOffset});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setAngle(true);\n\t\t\t}\n\t\t}\n\n\t\tsuper.adjustPosition(bindOptions);\n\t}\n}","import {Tag, Type, Dom, Event} from 'main.core';\nimport {Address, Format, ControlMode, MapBase, GeocodingServiceBase, AddressStringConverter} from 'location.core';\nimport {EventEmitter} from 'main.core.events';\nimport AddressString from './addressstring';\nimport './css/mappopup.css';\nimport Popup from './popup';\n\nexport default class MapPopup extends EventEmitter\n{\n\tstatic #onChangedEvent = 'onChanged';\n\tstatic #onMouseOverEvent = 'onMouseOver';\n\tstatic #onMouseOutEvent = 'onMouseOut';\n\tstatic #onShowedEvent = 'onShow';\n\tstatic #onClosedEvent = 'onClose';\n\n\t#map;\n\t#mode;\n\t#address;\n\t#popup;\n\t#addressString;\n\t#addressFormat;\n\t#gallery;\n\t#locationRepository;\n\t#isMapRendered = false;\n\t#mapInnerContainer;\n\t#geocodingService;\n\t#contentWrapper;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.MapPopup');\n\n\t\tif(!(props.map instanceof MapBase))\n\t\t{\n\t\t\tBX.debug('map must be instance of Map');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tif(props.geocodingService instanceof GeocodingServiceBase)\n\t\t{\n\t\t\tthis.#geocodingService = props.geocodingService;\n\t\t}\n\n\t\tthis.#map.onLocationChangedEventSubscribe( (event) => {\n\n\t\t\tlet data = event.getData(),\n\t\t\t\tlocation = data.location,\n\t\t\t\taddress = location.toAddress();\n\n\t\t\tthis.#address = address;\n\t\t\tthis.#addressString.address = address;\n\n\t\t\tif(this.#gallery)\n\t\t\t{\n\t\t\t\tthis.#gallery.location = location;\n\t\t\t}\n\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{ address: address}\n\t\t\t);\n\t\t});\n\n\t\tif(!(props.popup instanceof Popup))\n\t\t{\n\t\t\tBX.debug('popup must be instance of Popup');\n\t\t}\n\n\t\tthis.#popup = props.popup;\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tthis.#addressString = new AddressString({\n\t\t\taddressFormat: this.#addressFormat\n\t\t});\n\n\t\tif(props.gallery)\n\t\t{\n\t\t\tthis.#gallery = props.gallery;\n\t\t}\n\n\t\tthis.#locationRepository = props.locationRepository;\n\t}\n\n\trender(props: object): void\n\t{\n\t\tthis.#address = props.address;\n\t\tthis.#mode = props.mode;\n\t\tthis.#isMapRendered = false;\n\t\tthis.#mapInnerContainer = Tag.render`<div class=\"location-map-inner\"></div>`;\n\t\tthis.#renderPopup(props.bindElement, this.#mapInnerContainer);\n\t}\n\n\t#renderPopup(bindElement: Element, mapInnerContainer: Element): Popup\n\t{\n\t\tlet gallery = '';\n\n\t\tif(this.#gallery)\n\t\t{\n\t\t\tgallery = this.#gallery.render();\n\t\t}\n\n\t\tthis.#contentWrapper = Tag.render`\n\t\t\t<div class=\"location-map-wrapper\">\n\t\t\t\t<div class=\"location-map-container\">\n\t\t\t\t\t${mapInnerContainer}\n\t\t\t\t\t${gallery}\n\t\t\t\t</div>\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressString.render({address: this.#address}) : ''}\n\t\t\t</div>`;\n\n\t\tEvent.bind(this.#contentWrapper, 'click', (e) => e.stopPropagation());\n\t\tEvent.bind(this.#contentWrapper, 'mouseover', (e) => this.emit(MapPopup.#onMouseOverEvent, e));\n\t\tEvent.bind(this.#contentWrapper, 'mouseout', (e) => this.emit(MapPopup.#onMouseOutEvent, e));\n\t\tthis.bindElement = bindElement;\n\t\tthis.#popup.setContent(this.#contentWrapper);\n\t}\n\n\tget bindElement()\n\t{\n\t\treturn this.#popup.getBindElement();\n\t}\n\n\tset bindElement(bindElement: Element)\n\t{\n\t\tif(Type.isDomNode(bindElement))\n\t\t{\n\t\t\tthis.#popup.setBindElement(bindElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('bindElement must be type of dom node');\n\t\t}\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\t\tthis.#addressString.address = address;\n\n\t\tthis.#convertAddressToLocation(address)\n\t\t\t.then((location) => {\n\t\t\t\tthis.#setLocationInternal(location);\n\t\t\t});\n\t}\n\n\t#convertAddressToLocation(address: ?Address): Promise<?Location>\n\t{\n\t\treturn new Promise((resolve) => {\n\n\t\t\tlet location = address ? address.toLocation() : null;\n\n\t\t\tif(location)\n\t\t\t{\n\t\t\t\tif(!location.latitude\n\t\t\t\t\t&& !location.longitude\n\t\t\t\t\t&& address.latitude\n\t\t\t\t\t&& address.longitude\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tlocation.latitude = address.latitude;\n\t\t\t\t\tlocation.longitude = address.longitude;\n\t\t\t\t}\n\n\t\t\t\tif(location.latitude && location.longitude)\n\t\t\t\t{\n\t\t\t\t\tresolve(location);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(this.#geocodingService)\n\t\t\t{\n\t\t\t\tlet addressStr = null;\n\n\t\t\t\tif (address)\n\t\t\t\t{\n\t\t\t\t\taddressStr = address.toString(\n\t\t\t\t\t\tthis.#addressFormat,\n\t\t\t\t\t\tAddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,\n\t\t\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.#geocodingService.geocode(addressStr)\n\t\t\t\t\t.then((locationsList: Array) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet location = locationsList.length === 1 ? locationsList[0] : null;\n\t\t\t\t\t\tresolve(location);\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t#setLocationInternal(location: ?Location): void\n\t{\n\t\tthis.#map.location = location;\n\n\t\tif(this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#map.mode = mode;\n\t}\n\n\t#renderMap({location})\n\t{\n\t\treturn this.#map.render({\n\t\t\tmapContainer: this.#mapInnerContainer,\n\t\t\tlocation: location,\n\t\t\tmode: this.#mode\n\t\t});\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#convertAddressToLocation(this.#address)\n\t\t\t.then((location) => {\n\n\t\t\t\tif(!location)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#popup.show();\n\n\t\t\t\tif(!this.#isMapRendered)\n\t\t\t\t{\n\t\t\t\t\tthis.#renderMap({location})\n\t\t\t\t\t\t.then(() => {\n\n\t\t\t\t\t\t\tif(this.#gallery)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.#isMapRendered = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif(this.#gallery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup.close();\n\t\tthis.emit(MapPopup.#onClosedEvent)\n\t}\n\n\tonChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onChangedEvent, listener);\n\t}\n\n\tonMouseOverSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOverEvent, listener);\n\t}\n\n\tonMouseOutSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOutEvent, listener);\n\t}\n\n\tsubscribeOnShowedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onShowedEvent, listener);\n\t}\n\n\tsubscribeOnClosedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onClosedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#map = null;\n\t\tthis.#gallery = null;\n\t\tthis.#addressString = null;\n\n\t\tthis.#popup.destroy();\n\t\tthis.#popup = null;\n\t\tDom.remove(this.#contentWrapper);\n\t\tthis.#contentWrapper = null;\n\t\tEvent.unbindAll(this);\n\t}\n}\n","import {Tag} from \"main.core\";\n\nexport default class Photo\n{\n\t#description;\n\t#url;\n\t#link;\n\t#location;\n\t#title;\n\n\tconstructor(props)\n\t{\n\t\tthis.#url = props.url;\n\t\tthis.#link = props.link || '';\n\t\tthis.#description = props.description || '';\n\t\tthis.#location = props.location;\n\t\tthis.#title = props.title || '';\n\t}\n\n\trender()\n\t{\n\t\tlet description = '';\n\n\t\tif(this.#description)\n\t\t{\n\t\t\t//todo: sanitize\n\t\t\tdescription = Tag.render`<span class=\"location-map-item-description\">${this.#description}</span>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"location-map-photo-item-block\">\n\t\t\t\t<span class=\"location-map-photo-item-block-image-block-inner\">\n\t\t\t\t\t${description}\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type=\"image\" \n\t\t\t\t\t\tdata-src=\"${this.#link}\" \n\t\t\t\t\t\tdata-title=\"${this.#title}\"\n\t\t\t\t\t\tclass=\"location-map-item-photo-image\" \n\t\t\t\t\t\tdata-viewer-group-by=\"${this.#location.externalId}\"\n\t\t\t\t\t\tstyle=\"background-image: url(${this.#url});\">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n}","import {Tag, Dom} from \"main.core\";\nimport Photo from \"./photo\";\n\nexport default class Gallery\n{\n\t#photos = [];\n\t#container = null;\n\t#photosContainer = null;\n\t#thumbnailHeight;\n\t#thumbnailWidth;\n\t#photoService;\n\t#maxPhotoCount;\n\t#location;\n\n\tconstructor(props)\n\t{\n\t\tthis.#thumbnailHeight = props.thumbnailHeight;\n\t\tthis.#thumbnailWidth = props.thumbnailWidth;\n\t\tthis.#maxPhotoCount = props.maxPhotoCount;\n\t\tthis.#photoService = props.photoService;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.#location)\n\t\t{\n\t\t\tthis.#photoService.requestPhotos({\t\t\t\t\n\t\t\t\tlocation: this.#location,\n\t\t\t\tthumbnailHeight: this.#thumbnailHeight,\n\t\t\t\tthumbnailWidth: this.#thumbnailWidth,\n\t\t\t\tmaxPhotoCount: this.#maxPhotoCount\n\t\t\t\t\n\t\t\t})\n\t\t\t.then((photosData) => {\n\t\t\t\tif(Array.isArray(photosData) && photosData.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#setPhotos(photosData);\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tset location(location: Location)\n\t{\n\t\tthis.#location = location;\n\t\tthis.refresh();\n\t}\n\n\t#setPhotos(photosData)\n\t{\n\t\tif(!this.#location)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet photos = [];\n\n\t\tfor(let photo of photosData)\n\t\t{\n\t\t\tphotos.push(\n\t\t\t\tnew Photo({\n\t\t\t\t\turl: photo.thumbnail.url,\n\t\t\t\t\tlink: photo.url,\n\t\t\t\t\tlocation: this.#location,\n\t\t\t\t\ttitle: this.#location.name + \" ( \" + BX.util.strip_tags(photo.description) + ' )'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif(!Array.isArray(photos))\n\t\t{\n\t\t\tBX.debug('Wrong type of photos. Must be array');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#photos = [];\n\n\t\tfor(let photo of photos)\n\t\t{\n\t\t\tthis.#photos.push(photo);\n\t\t}\n\n\t\tif(this.#photos.length > 0 && this.#photosContainer)\n\t\t{\n\t\t\tlet renderedPhotos = this.#photos ? this.#renderPhotos(this.#photos) : '';\n\n\t\t\tthis.#photosContainer.innerHTML = '';\n\n\t\t\tif(renderedPhotos.length > 0)\n\t\t\t{\n\t\t\t\tfor (let photo of renderedPhotos)\n\t\t\t\t{\n\t\t\t\t\tthis.#photosContainer.appendChild(photo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#container || this.#container.clientWidth <= 0;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'block';\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tthis.#photosContainer = Tag.render`\t\t\t\t\t\n\t\t\t\t<div class=\"location-map-photo-inner\">\t\t\t\t\t\n\t\t\t\t</div>`;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"location-map-photo-container\">\n\t\t\t\t${this.#photosContainer}\n\t\t\t</div>`;\n\n\t\treturn this.#container;\n\t}\n\n\t#renderPhotos(photos)\n\t{\n\t\tlet result = [];\n\n\t\tfor (let photo of photos)\n\t\t{\n\t\t\tresult.push(photo.render());\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Tag, Event, Dom, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.forms';\nimport {ControlMode} from 'location.core';\nimport State from '../state';\n\nexport default class Field extends EventEmitter\n{\n\tstatic #onValueChangedEvent = 'onValueChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#title;\n\t#value;\n\t#type;\n\t#sort;\n\t#mode;\n\t#input;\n\t#viewContainer;\n\t#container = null;\n\t#state = State.INITIAL;\n\n\tconstructor(props: FieldConstructorProps)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Field');\n\n\t\tthis.#title = props.title;\n\t\tthis.#type = props.type;\n\t\tthis.#sort = props.sort;\n\t}\n\n\tget container()\n\t{\n\t\treturn this.#container;\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Field.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\trender(props: FieldRenderProps): void\n\t{\n\t\tthis.#value = typeof props.value === 'string' ? props.value : '';\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${this.#title}:</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#renderEditMode(this.#container)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderViewMode(this.#container)\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\t#renderEditMode(container: Element)\n\t{\n\t\tthis.#input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" value=\"${Text.encode(this.#value)}\">`;\n\t\tthis.#viewContainer = null;\n\n\t\tEvent.bind(this.#input, 'focus', (e) => {\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'focusout', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'change', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\tthis.#value = this.#input.value;\n\t\t\tthis.emit(Field.#onValueChangedEvent, {value: this});\n\t\t});\n\n\t\tcontainer.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${this.#input}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\t}\n\n\t#renderViewMode(container: Element)\n\t{\n\t\tthis.#input = null;\n\n\t\tthis.#viewContainer = Tag.render`\n\t\t\t<div class=\"ui-title-6\">\n\t\t\t\t${Text.encode(this.#value)}\n\t\t\t</div>`;\n\n\t\tcontainer.appendChild(this.#viewContainer);\n\t}\n\n\t#refreshLayout()\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#input.value = this.#value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#viewContainer.innerHTML = Text.encode(this.#value);\n\t\t}\n\t}\n\n\tset type(type: number)\n\t{\n\t\tthis.#type = type;\n\t}\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset sort(sort: number)\n\t{\n\t\tthis.#sort = sort;\n\t}\n\n\tget sort(): number\n\t{\n\t\treturn this.#sort;\n\t}\n\n\tset value(value: string)\n\t{\n\t\tthis.#value = typeof value === 'string' ? value : '';\n\t\tthis.#refreshLayout();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tsubscribeOnValueChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onValueChangedEvent, listener);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onStateChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#container);\n\t\tEvent.unbindAll(this);\n\t\tthis.#container = null;\n\t}\n}\n\ntype FieldConstructorProps = {\n\ttitle: string\n}\n\ntype FieldRenderProps = {\n\tvalue: string,\n\tmode: string //ControlMode\n}","import {Event, Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Format, Address, ControlMode} from 'location.core';\nimport Field from './field';\n\nexport type FieldsConstructorType = {\n\taddressFormat: Format\n}\n\nexport type FieldsRenderType = {\n\taddress: Address,\n\tmode: string, // ControlMode\n\tcontainer: Element\n}\n\nexport default class Fields extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#address;\n\t#addressFormat;\n\t#mode;\n\t#fields = [];\n\t#languageId;\n\t#container;\n\t#state;\n\n\tconstructor(props: FieldsConstructorType)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Fields');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#initFields();\n\t}\n\n\t#initFields()\n\t{\n\t\tfor (let type in this.#addressFormat.fieldCollection.fields)\n\t\t{\n\t\t\tif(!this.#addressFormat.fieldCollection.fields.hasOwnProperty(type))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet formatField = this.#addressFormat.fieldCollection.fields[type];\n\n\t\t\tlet field = new Field({\n\t\t\t\ttitle: formatField.name,\n\t\t\t\ttype: formatField.type,\n\t\t\t\tsort: formatField.sort\n\t\t\t});\n\n\t\t\tfield.subscribeOnValueChangedEvent((event) => {\n\t\t\t\tthis.#onFieldChanged(field);\n\t\t\t});\n\n\t\t\tfield.subscribeOnStateChangedEvent((event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#setState(data.state);\n\t\t\t});\n\n\t\t\tthis.#fields.push(field)\n\t\t}\n\n\t\tthis.#fields.sort((a, b) => {\n\t\t\treturn a.sort - b.sort;\n\t\t});\n\t}\n\n\trender(props: FieldsRenderType): void\n\t{\n\t\tif(props.address && !(props.address instanceof Address))\n\t\t{\n\t\t\tBX.debug('props.address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address;\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif(!Type.isDomNode(props.container))\n\t\t{\n\t\t\tBX.debug('props.container must be dom node');\n\t\t}\n\n\t\tthis.#container = props.container;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tlet value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\n\t\t\tif(this.#mode === ControlMode.view && !value)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet item = field.render({\n\t\t\t\tvalue: value,\n\t\t\t\tmode: this.#mode\n\t\t\t});\n\n\t\t\tthis.#container.appendChild(item);\n\t\t}\n\t}\n\n\t#onFieldChanged(field: Field)\n\t{\n\t\tif(!this.#address)\n\t\t{\n\t\t\tthis.#address = new Address({\n\t\t\t\tlanguageId: this.#languageId\n\t\t\t});\n\t\t}\n\n\t\tthis.#address.setFieldValue(field.type, field.value);\n\n\t\tif(field.type !== this.#addressFormat.fieldForUnRecognized)\n\t\t{\n\t\t\tthis.#address.location = null;\n\t\t\tthis.#address.latitude = '';\n\t\t\tthis.#address.longitude = '';\n\t\t}\n\n\t\tthis.emit(Fields.#onAddressChangedEvent, {\n\t\t\taddress: this.#address,\n\t\t\tchangedField: field\n\t\t});\n\t}\n\n\tset address(address: ?Address)\n\t{\n\t\tif(address && !(address instanceof Address))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\t\t}\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onAddressChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbindAll(this);\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.destroy();\n\t\t}\n\n\t\tDom.clean(this.#container);\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Fields.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onStateChangedEvent, listener);\n\t}\n}","import {Type} from 'main.core';\nimport {Address} from 'location.core';\nimport MapPopup from '../../mappopup/mappopup';\nimport BaseFeature from './basefeature';\nimport State from \"../../state\";\n\n/**\n * Complex address widget\n */\nexport default class MapFeature extends BaseFeature\n{\n\t#map = null;\n\n\t#mapBindElement = null;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper();\n\n\t\tif(!(props.map instanceof MapPopup))\n\t\t{\n\t\t\tBX.debug('props.map must be instance of MapPopup');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tthis.#map.onChangedEventSubscribe(\n\t\t\t(event) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\t}\n\n\tshowMap(): void\n\t{\n\t\tif(!this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.show();\n\t\t}\n\t}\n\n\tcloseMap(): void\n\t{\n\t\tif(this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.close();\n\t\t}\n\n\t\tthis.#map.bindelement = this.#mapBindElement;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.closeMap();\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {Object} props\n\t */\n\trender(props: {}): void\n\t{\n\t\tif(!Type.isDomNode(props.mapBindElement))\n\t\t{\n\t\t\tBX.debug('props.mapBindElement  must be instance of Element');\n\t\t}\n\n\t\tthis.#mapBindElement = props.mapBindElement;\n\n\t\tthis.#map.render({\n\t\t\tbindElement: props.mapBindElement,\n\t\t\taddress: this.#addressWidget.address,\n\t\t\tmode: this.#addressWidget.mode,\n\t\t});\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif(this.addressWidget.state === State.DATA_INPUTTING)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#map.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#map.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#map.destroy();\n\t\tthis.#map = null;\n\t}\n\n\tget map(): MapPopup\n\t{\n\t\treturn this.#map;\n\t}\n\n\tget addressWidget(): Address\n\t{\n\t\treturn this.#addressWidget;\n\t}\n\n\tget mapBindElement(): Element\n\t{\n\t\treturn this.#mapBindElement;\n\t}\n}","import {Type} from 'main.core';\nimport {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Fields from '../../fields/fields';\n\n/**\n * Fields widget feature\n */\nexport default class FieldsFeature extends BaseFeature\n{\n\t#fields;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.fields instanceof Fields))\n\t\t{\n\t\t\tBX.debug('props.Fields must be instance of Fields');\n\t\t}\n\n\t\tthis.#fields = props.fields;\n\n\t\tthis.#fields.subscribeOnAddressChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\n\t\tthis.#fields.subscribeOnStateChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.fieldsContainer))\n\t\t\t{\n\t\t\t\tBX.debug('props.fieldsContainer  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#fields.render({\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t\tcontainer: props.fieldsContainer\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthis.#fields.address = address;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#fields.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#fields.destroy();\n\t\tthis.#fields = null;\n\t}\n}","import {Address, ControlMode} from \"location.core\";\nimport State from \"../../state\";\nimport MapFeature from \"./mapfeature\";\n\n/**\n * Map feature for the address widget with auto map opening / closing behavior\n */\nexport default class MapFeatureAuto extends MapFeature\n{\n\t#isMouseOver = false;\n\t#showMapTimerId = null;\n\t#showMapDelay = 700;\n\t#closeMapTimerId = null;\n\t#closeMapDelay = 800;\n\n\t#isDestroyed = false;\n\n\t#onInputFocus(e: KeyboardEvent)\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.map.bindElement = this.mapBindElement;\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tsuper.render(props);\n\n\t\tthis.addressWidget.controlWrapper.addEventListener('click', this.#onControlWrapperClick.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseover', this.#processOnMouseOver.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseout', this.#processOnMouseOut.bind(this));\n\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\n\t\tthis.map.onMouseOverSubscribe(this.#processOnMouseOver.bind(this));\n\t\tthis.map.onMouseOutSubscribe(this.#processOnMouseOut.bind(this));\n\t}\n\n\t#onControlWrapperClick()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.map.isShown())\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.#showMapTimerId);\n\t\t}\n\t}\n\n\t#onDocumentClick()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.closeMap();\n\t}\n\n\t#processOnMouseOver()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isMouseOver = true;\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif(this.addressWidget.address && !this.map.isShown())\n\t\t{\n\t\t\tthis.#showMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.showMap();\n\t\t\t\t},\n\t\t\t\tthis.#showMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\t#processOnMouseOut()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isMouseOver = false;\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif(this.addressWidget.mode === ControlMode.view && this.map.isShown())\n\t\t{\n\t\t\tthis.#closeMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.closeMap();\n\t\t\t\t},\n\t\t\t\tthis.#closeMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif(this.addressWidget.state === State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t\treturn;\n\t\t}\n\n\t\tif(!address)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\n\t\tthis.map.address = address;\n\n\t\tif(address)\n\t\t{\n\t\t\tthis.showMap();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif(this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\n\t\tif(this.addressWidget.controlWrapper)\n\t\t{\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('click', this.#onControlWrapperClick);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseover', this.#processOnMouseOver);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseout', this.#processOnMouseOut);\n\t\t}\n\n\t\tthis.#showMapTimerId = null;\n\t\tthis.#closeMapTimerId = null;\n\t\tthis.#isMouseOver = false;\n\n\t\tsuper.destroy();\n\t\tthis.#isDestroyed = true;\n\t}\n}","import {BaseSource, LocationRepository, SourceCreationError, Format} from 'location.core';\n\nimport {OSMFactory} from 'location.osm';\n\nimport {Google} from 'location.google';\n\nimport Address from './address/address';\nimport Autocomplete from './autocomplete/autocomplete';\n\nimport MapPopup from './mappopup/mappopup';\nimport Gallery from './mappopup/gallery';\nimport Popup from './mappopup/popup';\nimport Fields from './fields/fields';\n\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\nimport MapFeatureAuto from './address/features/mapfeatureauto';\n\n/**\n * Props type for the main fabric method\n */\nexport type FactoryCreateAddressWidgetProps = {\n\t// Initial Address\n\taddress?: Address,\n\t// Initial widget mode\n\tmode: 'edit' | 'view',\n\n\t// optional\n\tlanguageId?: string,\n\taddressFormat?: Format,\n\tsourceCode?: string,\n\tsourceParams?: {},\n\n\t// Witch features will be used?\n\tuseFeatures?: {\n\t\tfields?: boolean, \t\t// default true\n\t\tmap?: boolean, \t\t\t// default true\n\t\tautocomplete?: boolean\t// default true\n\t},\n\n\t// Useful for the using with map feature only\n\t// Address photo height if photo exists\n\tthumbnailHeight: number,\n\t// Address photo width if photo exists\n\tthumbnailWidth: number,\n\t// Max photo thumbnails count\n\tmaxPhotoCount: number,\n\t/*\n\t * auto - open / close map feature depends on user's input\n\t * manual - allow to control open / close map\n\t */\n\tmapBehavior: 'auto' | 'manual',\n\tpopupBindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t},\n\tpresetLocationList?: Array\n};\n\n/**\n * Factory class with a set of tools for the address widget creation\n */\nexport default class Factory\n{\n\t/**\n\t * Main factory method\n\t * @param {FactoryCreateAddressWidgetProps} props\n\t * @returns {Address}\n\t */\n\tcreateAddressWidget(props: FactoryCreateAddressWidgetProps): Address\n\t{\n\t\tconst sourceCode = props.sourceCode || BX.message('LOCATION_WIDGET_SOURCE_CODE');\n\t\tconst sourceParams = props.sourceParams || BX.message('LOCATION_WIDGET_SOURCE_PARAMS');\n\t\tconst languageId = props.languageId || BX.message('LOCATION_WIDGET_LANGUAGE_ID');\n\t\tconst sourceLanguageId = props.sourceLanguageId || BX.message('LOCATION_WIDGET_SOURCE_LANGUAGE_ID');\n\n\t\tconst addressFormat = props.addressFormat || new Format(\n\t\t\tJSON.parse(\n\t\t\t\tBX.message('LOCATION_WIDGET_DEFAULT_FORMAT')\n\t\t\t));\n\n\t\tlet presetLocationList = props.presetLocationList || [];\n\n\t\tconst features = [];\n\n\t\tif(!props.useFeatures || props.useFeatures.fields !== false)\n\t\t{\n\t\t\tfeatures.push(\n\t\t\t\tthis.createFieldsFeature({addressFormat, languageId})\n\t\t\t);\n\t\t}\n\n\t\tlet source = null;\n\n\t\tif(sourceCode && sourceParams)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tsource = this.createSource(sourceCode, sourceParams, languageId, sourceLanguageId);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif(e instanceof SourceCreationError)\n\t\t\t\t{\n\t\t\t\t\tsource = null;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(source)\n\t\t{\n\t\t\tif(!props.useFeatures || props.useFeatures.autocomplete !== false)\n\t\t\t{\n\t\t\t\tfeatures.push(\n\t\t\t\t\tthis.createAutocompleteFeature({\n\t\t\t\t\t\tlanguageId,\n\t\t\t\t\t\taddressFormat,\n\t\t\t\t\t\tsource\n\t\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif(!props.useFeatures || props.useFeatures.map !== false)\n\t\t\t{\n\t\t\t\tconst showPhotos = (sourceParams.hasOwnProperty('showPhotos') && sourceParams.showPhotos === true);\n\t\t\t\tconst useGeocodingService = (sourceParams.hasOwnProperty('useGeocodingService') && sourceParams.useGeocodingService === true);\n\n\t\t\t\tconst DEFAULT_THUMBNAIL_HEIGHT = 80;\n\t\t\t\tconst DEFAULT_THUMBNAIL_WIDTH = 150;\n\t\t\t\tconst DEFAULT_MAX_PHOTO_COUNT = showPhotos ? 5 : 0;\n\t\t\t\tconst DEFAULT_MAP_BEHAVIOR = 'auto';\n\n\t\t\t\tfeatures.push(\n\t\t\t\t\tthis.createMapFeature({\n\t\t\t\t\t\taddressFormat,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tpopupBindOptions: props.popupBindOptions,\n\t\t\t\t\t\tthumbnailHeight: props.thumbnailHeight || DEFAULT_THUMBNAIL_HEIGHT,\n\t\t\t\t\t\tthumbnailWidth: props.thumbnailWidth || DEFAULT_THUMBNAIL_WIDTH,\n\t\t\t\t\t\tmaxPhotoCount: props.maxPhotoCount || DEFAULT_MAX_PHOTO_COUNT,\n\t\t\t\t\t\tmapBehavior: props.mapBehavior || DEFAULT_MAP_BEHAVIOR,\n\t\t\t\t\t\tuseGeocodingService,\n\t\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\treturn new Address({\n\t\t\tfeatures,\n\t\t\taddress: props.address,\n\t\t\tmode: props.mode,\n\t\t\taddressFormat,\n\t\t\tlanguageId,\n\t\t\tpresetLocationList\n\t\t});\n\t}\n\n\tcreateFieldsFeature(props: {}): FieldsFeature\n\t{\n\t\tconst fields = new Fields({\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tlanguageId: props.languageId,\n\t\t});\n\n\t\treturn new FieldsFeature({\n\t\t\tfields\n\t\t});\n\t}\n\n\tcreateAutocompleteFeature(props: {}): AutocompleteFeature\n\t{\n\t\tconst autocomplete = new Autocomplete({\n\t\t\tlanguageId: props.languageId,\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tautocompleteService: props.source.autocompleteService,\n\t\t});\n\n\t\treturn new AutocompleteFeature({\n\t\t\tautocomplete\n\t\t});\n\t}\n\n\tcreateMapFeature(props: {}): MapFeature\n\t{\n\t\tconst popup = new Popup({\n\t\t\tcacheable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: 'location-popup-window',\n\t\t\tanimation: 'fading',\n\t\t\tangle: true,\n\t\t\tbindOptions: props.popupBindOptions\n\t\t});\n\n\t\tlet gallery = null;\n\n\t\tif(props.maxPhotoCount > 0)\n\t\t{\n\t\t\tgallery = new Gallery({\n\t\t\t\tphotoService: props.source.photoService,\n\t\t\t\tthumbnailHeight: props.thumbnailHeight,\n\t\t\t\tthumbnailWidth: props.thumbnailWidth,\n\t\t\t\tmaxPhotoCount: props.maxPhotoCount\n\t\t\t});\n\t\t}\n\n\t\tconst mapFeatureProps = {\n\t\t\tmap: new MapPopup({\n\t\t\t\taddressFormat: props.addressFormat,\n\t\t\t\tmap: props.source.map,\n\t\t\t\tpopup: popup,\n\t\t\t\tgallery: gallery,\n\t\t\t\tlocationRepository: new LocationRepository(),\n\t\t\t\tgeocodingService: props.useGeocodingService ? props.source.geocodingService : null\n\t\t\t})\n\t\t};\n\n\t\tlet result;\n\n\t\tif(props.mapBehavior === 'manual')\n\t\t{\n\t\t\tresult = new MapFeature(mapFeatureProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new MapFeatureAuto(mapFeatureProps);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// todo: add custom sources\n\tcreateSource(code: string, params: {}, languageId: string, sourceLanguageId: string): BaseSource\n\t{\n\t\tlet source = null;\n\n\t\tparams.languageId = languageId;\n\t\tparams.sourceLanguageId = sourceLanguageId;\n\n\t\tif(code === 'GOOGLE')\n\t\t{\n\t\t\tsource = new Google(params);\n\t\t}\n\t\telse if(code === 'OSM')\n\t\t{\n\t\t\tsource = OSMFactory.createOSMSource(params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new RangeError('Wrong source code');\n\t\t}\n\n\t\treturn source;\n\t}\n}","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Switch extends EventEmitter\n{\n\tstatic STATE_OFF = 0;\n\tstatic STATE_ON = 1;\n\n\tstatic #onToggleEvent = \"onToggleEvent\";\n\n\t#state;\n\t#titleContainer;\n\t#titles = ['on', 'off'];\n\n\tconstructor(props = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Switch');\n\t\tthis.#state = props.state;\n\t\tthis.#titles = props.titles;\n\t}\n\n\tset state(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tif(this.#titleContainer)\n\t\t{\n\t\t\tthis.#titleContainer.innerHTML = this.#getTitle();\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#getTitle()\n\t{\n\t\treturn this.#titles[this.#state];\n\t}\n\n\trender(mode: number)\n\t{\n\t\tthis.#titleContainer = Tag.render`\t\t\t\n\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\">\n\t\t\t\t${this.#getTitle()}\n\t\t\t</span>`;\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tthis.state = this.#state === Switch.STATE_OFF ? Switch.STATE_ON : Switch.STATE_OFF;\n\t\t\t\tthis.emit(Switch.#onToggleEvent, {state: this.#state});\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t);\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'mouseover',\n\t\t\t(event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t);\n\n\t\treturn this.#titleContainer;\n\t}\n\n\tsubscribeOnToggleEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Switch.#onToggleEvent, listener);\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Icon extends EventEmitter\n{\n\tstatic #onClickEvent = 'onClick';\n\n\tstatic TYPE_CLEAR = 'clear';\n\tstatic TYPE_SEARCH = 'search';\n\tstatic TYPE_LOADER = 'loader';\n\n\t#type = Icon.TYPE_SEARCH;\n\t#domNode;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Icon');\n\t}\n\n\tset type(type: string): void\n\t{\n\t\tthis.#type = type;\n\n\t\tif(this.#domNode)\n\t\t{\n\t\t\tthis.#domNode.className = this.#getClassByType(this.#type);\n\t\t}\n\t}\n\n\t#getClassByType(iconType: string): void\n\t{\n\t\tlet iconClass = '';\n\n\t\tif(iconType === Icon.TYPE_CLEAR)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_SEARCH)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-search\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_LOADER)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-loader\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('Wrong icon type');\n\t\t}\n\n\t\treturn iconClass;\n\t}\n\n\trender(props)\n\t{\n\t\tthis.#type = props.type;\n\t\tthis.#domNode = Tag.render`<div class=\"${this.#getClassByType(this.#type)}\"></div>`;\n\n\t\tthis.#domNode.addEventListener(\n\t\t\t'click',\n\t\t\t(e) => {\n\t\t\t\tthis.emit(Icon.#onClickEvent);\n\t\t\t}\n\t\t);\n\n\t\treturn this.#domNode;\n\t}\n\n\tsubscribeOnClickEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Icon.#onClickEvent, listener);\n\t}\n}","import {Type, Tag, Dom} from 'main.core';\nimport {Address, ControlMode, ErrorPublisher} from 'location.core';\nimport {BaseEvent} from 'main.core.events';\nimport './css/ui-address.css';\nimport {State as WidgetState} from 'location.widget';\nimport Factory from '../factory';\nimport Switch from './switch';\nimport Icon from './icon';\n\n/**\n * Address field widget for the ui.entity-editor\n */\nexport default class UIAddress extends BX.UI.EntityEditorField\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis._input = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._addressWidget = null;\n\t\tthis._addressFieldsContainer = null;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new UIAddress();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\n\t\tconst value = this.getValue();\n\t\tlet address = null;\n\n\t\tif(Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tBX.debug('Cant parse address value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view,\n\t\t\tpopupBindOptions: {\n\t\t\t\tposition: 'right'\n\t\t\t}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.#onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.#onAddressChanged.bind(this));\n\n\t\tthis._fieldsSwitch = new Switch({\n\t\t\tstate: Switch.STATE_OFF,\n\t\t\ttitles: [\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_MORE'),\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_BRIEFLY')\n\t\t\t]\n\t\t});\n\t\tthis._fieldsSwitch.subscribeOnToggleEventSubscribe(this.#onFieldsSwitchToggle.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tif(this._input.value !== '')\n\t\t{\n\t\t\tthis._input.value = '';\n\t\t\tthis._addressWidget.address = null;\n\t\t\tthis._inputIcon.type = Icon.TYPE_SEARCH;\n\t\t}\n\n\t\tif(this.hasError())\n\t\t{\n\t\t\tthis.clearError();\n\t\t}\n\t}\n\n\t#onFieldsSwitchToggle(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\n\t\tif(state === Switch.STATE_OFF)\n\t\t{\n\t\t\tthis.#hideFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showFields();\n\t\t}\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tfocus()\n\t{\n\t\tif(!this._input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.focus(this._input);\n\t\tBX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input);\n\t}\n\n\t#hideFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.remove('visible');\n\t\t}\n\t}\n\n\t#showFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t}\n\t}\n\n\t#onAddressWidgetChangedState(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\t\tlet iconType;\n\n\t\tif(data.state === WidgetState.DATA_LOADING)\n\t\t{\n\t\t\ticonType = Icon.TYPE_LOADER;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(data.state === WidgetState.DATA_INPUTTING)\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\n\t\t\ticonType = UIAddress.#chooseInputIconTypeByAddress(this.#getAddress());\n\t\t}\n\n\n\t\tthis._inputIcon.type = iconType;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif(mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdoSetMode(mode)\n\t{\n\t\tthis._addressWidget.mode = mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view;\n\t\tthis._fieldsSwitch.state = Switch.STATE_OFF;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this._innerWrapper;\n\t}\n\n\t#onAddressChanged(event: BaseEvent): void\n\t{\n\t\tconst data = event.getData();\n\t\tconst address = data.address;\n\n\t\tif(this._hiddenInput)\n\t\t{\n\t\t\tthis._hiddenInput.value = address ? address.toJson() : '';\n\t\t\tthis.markAsChanged();\n\t\t}\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = UIAddress.#chooseInputIconTypeByAddress(address);\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(!this.isEditable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst address = this.#getAddress();\n\n\t\tthis._model.setField(\n\t\t\tthis.getName(),\n\t\t\taddress ? address.toJson() : ''\n\t\t);\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tshowError(error, anchor)\n\t{\n\t\tsuper.showError.apply(this, [error, anchor]);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.addClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tclearError()\n\t{\n\t\tsuper.clearError.apply(this);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.removeClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tthis._input = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._inputContainer = null;\n\t\tthis._addressFieldsContainer = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tDom.clean(this._innerWrapper);\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(!(this._mode === BX.UI.EntityEditorMode.edit && this._input))\n\t\t{\n\t\t\tthrow Error('BX.Location.UIAddress. Invalid validation context');\n\t\t}\n\n\t\tthis.clearError();\n\n\t\tif(this.hasValidators())\n\t\t{\n\t\t\treturn this.executeValidators(result);\n\t\t}\n\n\t\tconst isValid = !this.isRequired() || BX.util.trim(this._input.value) !== '';\n\n\t\tif(!isValid)\n\t\t{\n\t\t\tresult.addError(BX.UI.EntityValidationError.create({field: this}));\n\t\t\tthis.showRequiredFieldError(this._input);\n\t\t}\n\t\treturn isValid;\n\t}\n\n\tgetRuntimeValue()\n\t{\n\t\treturn (this._mode === BX.UI.EntityEditorMode.edit\n\t\t\t? this.#getAddress() : null\n\t\t);\n\t}\n\n\tstatic #chooseInputIconTypeByAddress(address: ?Address): string\n\t{\n\t\treturn address ? Icon.TYPE_CLEAR : Icon.TYPE_SEARCH;\n\t};\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this._addressWidget.addressFormat);\n\t}\n\n\t#getAddress(): Address\n\t{\n\t\treturn this._addressWidget.address;\n\t}\n\n\tlayout(options): void\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['ui-entity-card-content-block-field-phone']});\n\t\tthis.adjustWrapper();\n\n\t\tconst title = this.getTitle();\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\n\t\t}\n\n\t\tconst addressWidgetParams = {};\n\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tthis._input = Tag.render`<input class=\"ui-ctl-element ui-ctl-textbox\" value=\"\" type=\"text\" autocomplete=\"off\" name=\"${`${this.getName()}_STRING`}\">`;\n\t\t\tthis._hiddenInput = Tag.render`<input value='${this.getValue()}' type=\"hidden\" name=\"${this.getName()}\">`;\n\t\t\tthis._inputIcon = new Icon();\n\t\t\tthis._inputIcon.subscribeOnClickEvent(this.#onIconClick.bind(this));\n\t\t\tconst inputIconNode = this._inputIcon.render({\n\t\t\t\ttype: UIAddress.#chooseInputIconTypeByAddress(this.#getAddress())\n\t\t\t});\n\n\t\t\tthis._inputContainer = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">${inputIconNode}${this._input}${this._hiddenInput}</div>`;\n\t\t\tthis._titleWrapper.appendChild(Tag.render`${this._fieldsSwitch.render(this._mode)}`);\n\n\t\t\tthis._innerWrapper = Tag.render`\t\t\t\t\t\t    \n\t\t\t\t<div class=\"location-search-control-block\">\t\t\t\t\t\n\t\t\t\t\t${this._inputContainer}\n\t\t\t\t</div>`;\n\n\t\t\taddressWidgetParams.inputNode = this._input;\n\t\t\taddressWidgetParams.mapBindElement = inputIconNode;\n\n\t\t\tthis._addressFieldsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\n\t\t\tif(this._fieldsSwitch.state === Switch.STATE_ON)\n\t\t\t{\n\t\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t\t}\n\n\t\t\taddressWidgetParams.fieldsContainer = this._addressFieldsContainer;\n\t\t\tthis._innerWrapper.appendChild(this._addressFieldsContainer);\n\t\t}\n\t\telse// if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tlet addressStringNode;\n\n\t\t\tif(this.hasContentToDisplay())\n\t\t\t{\n\t\t\t\tconst addressString = this.#convertAddressToString(this.#getAddress());\n\t\t\t\taddressStringNode = Tag.render`<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>`;\n\n\t\t\t\tthis._innerWrapper = Tag.render`\n\t\t\t\t\t<div class=\"location-search-control-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t\t\t\t${addressStringNode}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = addressStringNode;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._innerWrapper = Tag.render`<div class=\"location-search-control-block\">\n\t\t\t\t\t${BX.message('UI_ENTITY_EDITOR_FIELD_EMPTY')}\n\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = this._innerWrapper;\n\t\t\t}\n\t\t}\n\n\t\taddressWidgetParams.controlWrapper = this._innerWrapper;\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\tthis._wrapper.appendChild(this._innerWrapper);\n\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));\n\n\t\tif(this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\terrorListener(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = Icon.TYPE_CLEAR;\n\t\t}\n\n\t\tif(!Type.isArray(errors))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// todo: this.showError supports only one error\n\t\terrors.forEach((error) => {\n\t\t\tlet message;\n\n\t\t\tif(error.message)\n\t\t\t{\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage = BX.message('LOCATION_WIDGET_AUI_UNKNOWN_ERROR');\n\t\t\t}\n\n\t\t\tif(error.code)\n\t\t\t{\n\t\t\t\tmessage += ` [${error.code}]`;\n\t\t\t}\n\n\t\t\tthis.showError(message);\n\t\t});\n\t}\n\n\tprocessModelChange(params)\n\t{\n\t\tif(BX.prop.get(params, 'originator', null) === this)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!BX.prop.getBoolean(params, 'forAll', false)\n\t\t\t&& BX.prop.getString(params, 'name', '') !== this.getName()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refreshLayout();\n\t}\n\n\tstatic registerField(): void\n\t{\n\t\tif(typeof BX.UI.EntityEditorControlFactory !== 'undefined')\n\t\t{\n\t\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod('address', UIAddress.registerFieldMethod);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addCustomEvent('BX.UI.EntityEditorControlFactory:onInitialize', (params, eventArgs) =>\n\t\t\t{\n\t\t\t\teventArgs.methods.address = UIAddress.registerFieldMethod;\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic registerFieldMethod(type, controlId, settings): ?UIAddress\n\t{\n\t\tlet result = null;\n\n\t\tif(type === 'address')\n\t\t{\n\t\t\tresult = UIAddress.create(controlId, settings);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import Address from './address/address';\nimport Factory from './factory';\nimport UIAddress from './ui-address/ui-address';\nimport State from './state';\nimport BaseFeature from './address/features/basefeature';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\n\n/* A set of widgets for using to deal with addresses */\nexport {\n\n\t// Main Widget\n\tAddress,\n\n\t// Widget features\n\tBaseFeature,\n\n\tMapFeature,\n\tAutocompleteFeature,\n\tFieldsFeature,\n\n\t// Widget factory\n\tFactory,\n\n\t// Possible widget states\n\tState,\n\n\t/* Address field for the ui.forms.\n\t * This can be used as an example of the widget implementation\n\t */\n\tUIAddress,\n};\n\n// Register fields for ui.entity-editor\nUIAddress.registerField();\n"],"names":["State","BaseFeature","props","MethodNotImplemented","addressWidget","address","mode","Menu","options","elRect","bindElement","getBoundingClientRect","popupWindow","setMaxWidth","width","menuItems","length","choseItemIdx","getPopupWindow","isDestroyed","index","result","isItemChosen","isItemExist","isMenuEmpty","isChoseLastItem","chooseItem","getChosenItem","isChoseFirstItem","item","layout","classList","add","remove","unHighlightItem","highlightItem","removeMenuItem","id","isShown","MainMenu","Prompt","setEventNamespace","inputNode","locationsList","searchPhrase","getMenu","show","close","choosePrevItem","chooseNextItem","menuItem","destroy","locationName","slice","spWords","replace","split","RegExp","pattern","join","match","EventEmitter","autoHide","closeByEsc","clearItems","Array","isArray","forEach","location","addMenuItem","externalId","title","name","html","createMenuItemText","onclick","event","emit","onItemSelectedEvent","BX","debug","Autocomplete","requested","current","dropped","addressFormat","Format","Error","autocompleteService","AutocompleteServiceBase","languageId","locationRepository","LocationRepository","promptDelay","maxPromptDelay","minCharsCountToAutocomplete","INITIAL","value","addEventListener","_classPrivateMethodGet","bind","subscribe","document","listener","params","Event","unbindAll","removeEventListener","phrase","trim","tailPosition","lastIndexOf","toString","AddressStringConverter","STRATEGY_TYPE_FIELD_TYPE","CONTENT_TYPE_TEXT","DATA_INPUTTING","DATA_SELECTED","showPrompt","target","Loc","getMessage","data","state","then","response","ErrorPublisher","getInstance","notify","errors","Promise","resolve","DATA_LOADING","findByExternalId","sourceCode","DATA_LOADED","addressString","Address","setFieldValue","fieldForUnRecognized","toAddress","e","now","Date","delta","code","error","delay","clearTimeout","setTimeout","autocomplete","AutocompleteFeature","onAddressChangedEventSubscribe","getData","setAddressByFeature","onStateChangedEventSubscribe","setStateByFeature","onSearchStartedEventSubscribe","emitFeatureEvent","feature","eventCode","searchStartedEvent","payload","onSearchCompletedEventSubscribe","searchCompletedEvent","closePrompt","ControlMode","edit","render","AddressEntity","isValid","Type","isString","TypeError","features","isBoolean","needWarmBackendAfterAddressChanged","presetLocationList","Location","push","sourceFeature","addressId","featureEvent","onFeatureEvent","resetView","isDomNode","controlWrapper","onInputKeyup","onStateChangedEvent","onAddressChangedEvent","unbind","onInputClick","setAddressWidget","method","excludeFeature","apply","findParents","setCaretPosition","autocompleteFeature","prompt","selectionStart","selectionEnd","setSelectionRange","splice","AddressString","Tag","style","display","innerHTML","isHidden","hide","STRATEGY_TYPE_FIELD_SORT","Popup","bindOptions","position","itemRect","offsetLeft","offsetTop","height","angleOffset","popupWidth","getPopupContainer","offsetWidth","popupHeight","offsetHeight","popupBottom","top","clientWidth","documentElement","clientHeight","exceeded","roundOffset","Math","ceil","bottom","left","setOffset","setAngle","offset","MainPopup","MapPopup","map","MapBase","geocodingService","GeocodingServiceBase","onLocationChangedEventSubscribe","popup","gallery","Dom","getBindElement","setBindElement","mapInnerContainer","stopPropagation","setContent","toLocation","latitude","longitude","addressStr","geocode","mapContainer","Photo","url","link","description","Gallery","thumbnailHeight","thumbnailWidth","maxPhotoCount","photoService","requestPhotos","photosData","refresh","photos","photo","thumbnail","util","strip_tags","renderedPhotos","appendChild","Field","type","sort","container","Text","encode","Fields","field","getFieldValue","view","clean","fieldCollection","fields","hasOwnProperty","formatField","subscribeOnValueChangedEvent","subscribeOnStateChangedEvent","a","b","changedField","MapFeature","onChangedEventSubscribe","bindelement","closeMap","mapBindElement","FieldsFeature","subscribeOnAddressChangedEvent","fieldsContainer","MapFeatureAuto","onMouseOverSubscribe","onMouseOutSubscribe","showMap","Factory","message","sourceParams","sourceLanguageId","JSON","parse","useFeatures","createFieldsFeature","source","createSource","SourceCreationError","createAutocompleteFeature","showPhotos","useGeocodingService","DEFAULT_THUMBNAIL_HEIGHT","DEFAULT_THUMBNAIL_WIDTH","DEFAULT_MAX_PHOTO_COUNT","DEFAULT_MAP_BEHAVIOR","createMapFeature","popupBindOptions","mapBehavior","cacheable","className","animation","angle","mapFeatureProps","Google","OSMFactory","createOSMSource","RangeError","Switch","titles","STATE_OFF","STATE_ON","Icon","TYPE_SEARCH","iconType","iconClass","TYPE_CLEAR","TYPE_LOADER","UIAddress","_input","_inputIcon","_hiddenInput","_innerWrapper","_addressWidget","_addressFieldsContainer","settings","getValue","isStringFilled","widgetFactory","createAddressWidget","_mode","UI","EntityEditorMode","_fieldsSwitch","subscribeOnToggleEventSubscribe","focus","EditorTextHelper","getCurrent","setPositionAtEnd","EntityEditorModeSwitchType","common","button","content","isEditable","_model","setField","getName","toJson","anchor","addClass","_inputContainer","removeClass","clearError","hasValidators","executeValidators","isRequired","addError","EntityValidationError","create","showRequiredFieldError","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","getTitle","isDragEnabled","_wrapper","createDragButton","addressWidgetParams","createTitleNode","subscribeOnClickEvent","inputIconNode","_titleWrapper","addressStringNode","hasContentToDisplay","subscribeOnErrorEvent","errorListener","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","registerLayout","showError","prop","get","getBoolean","getString","refreshLayout","self","initialize","EntityEditorControlFactory","registerFactoryMethod","registerFieldMethod","addCustomEvent","eventArgs","methods","controlId","EntityEditorField","hasError","WidgetState","markAsChanged","registerField"],"mappings":"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"}