{"version":3,"file":"widget.bundle.js","sources":["../src/state.js","../src/address/features/basefeature.js","../src/address/address.js","../src/autocomplete/menubottom.js","../src/autocomplete/menu.js","../src/autocomplete/prompt.js","../src/autocomplete/addressstring.js","../src/autocomplete/autocomplete.js","../src/mappopup/addressstring.js","../src/mappopup/popup.js","../src/mappopup/addressrestorer.js","../src/mappopup/mappopup.js","../src/mappopup/photo.js","../src/mappopup/gallery.js","../src/fields/field.js","../src/fields/fields.js","../src/address/features/mapfeature.js","../src/address/features/autocompletefeature.js","../src/address/features/fieldsfeature.js","../src/address/features/mapfeatureauto.js","../src/factory.js","../src/ui-address/switch.js","../src/ui-address/icon.js","../src/ui-address/ui-address.js","../src/widget.js"],"sourcesContent":["/**\n * Contains\n * */\nexport default class State\n{\n\tstatic INITIAL = 'INITIAL';\n\tstatic DATA_INPUTTING = 'DATA_INPUTTING';\n\tstatic DATA_SELECTED = 'DATA_SELECTED';\n\tstatic DATA_SUPPOSED = 'DATA_SUPPOSED';\n\tstatic DATA_LOADING = 'DATA_LOADING';\n\tstatic DATA_LOADED = 'DATA_LOADED';\n}","import {Address, MethodNotImplemented} from \"location.core\";\n\n/**\n * Base class for the address widget feature\n */\nexport default class BaseFeature\n{\n\trender(props)\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthrow new MethodNotImplemented('Method set address must be implemented');\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\n\t}\n\n\tdestroy(): void\n\t{\n\n\t}\n\n\tresetView(): void\n\t{\n\n\t}\n}","import {Type, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {\n\tAddress as AddressEntity, ControlMode, Format, AddressStringConverter,\n\tLocationRepository, ErrorPublisher, FormatTemplateType, AddressType\n} from 'location.core';\nimport State from '../state';\nimport BaseFeature from './features/basefeature';\nimport {FeatureEvent} from './featurevent';\n\n/**\n * Props for the address widget constructor\n */\nexport type AddressConstructorProps = {\n\t/** @see ControlMode */\n\tmode: string,\n\taddressFormat: Format,\n\taddress?: AddressEntity,\n\tneedWarmBackendAfterAddressChanged?: boolean,\n\tlocationRepository?: LocationRepository,\n};\n\n/**\n * Props for the address widget render method\n */\nexport type AddressRenderProps = {\n\t/** Input control witch will be used by user to enter the address */\n\tinputNode: Element,\n\t/** Control wrapper witch could be used for mouseover event etc. */\n\tcontrolWrapper: Element,\n\t/** If map feature is used it could be used to bind map popup */\n\tmapBindElement: ?Element,\n\t/** If autocomplete feature is used it could be used to bind menu node */\n\tautocompleteMenuElement: ?Element\n};\n\n/**\n * Address widget\n */\nexport default class Address extends EventEmitter\n{\n\t/* If address was changed by user */\n\tstatic onAddressChangedEvent = 'onAddressChanged';\n\t/* If state of the widget was changed */\n\tstatic onStateChangedEvent = 'onStateChanged';\n\t/* Any feature-related events */\n\tstatic onFeatureEvent = 'onFeatureEvent';\n\n\t#mode;\n\t#state;\n\t#address;\n\t#addressFormat;\n\t#languageId;\n\n\t#features = [];\n\n\t#inputNode;\n\t#controlWrapper;\n\n\t#destroyed = false;\n\n\t#isAddressChangedByFeature = false;\n\t#isInputNodeValueUpdated = false;\n\n\t#needWarmBackendAfterAddressChanged = true;\n\t#locationRepository;\n\n\t/**\n\t * Constructor\n\t * @param {AddressConstructorProps} props\n\t */\n\tconstructor(props: AddressConstructorProps)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Address');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (props.address && !(props.address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address || null;\n\n\t\tif (!(ControlMode.isValid(props.mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif (!Type.isString(props.languageId))\n\t\t{\n\t\t\tthrow new TypeError('props.languageId must be type of string');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\n\t\tif (props.features)\n\t\t{\n\t\t\tif (!Type.isArray(props.features))\n\t\t\t{\n\t\t\t\tthrow new TypeError('features must be an array');\n\t\t\t}\n\n\t\t\tprops.features.forEach((feature: BaseFeature) => {\n\t\t\t\tthis.#addFeature(feature);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isBoolean(props.needWarmBackendAfterAddressChanged))\n\t\t{\n\t\t\tthis.#needWarmBackendAfterAddressChanged = props.needWarmBackendAfterAddressChanged;\n\t\t}\n\n\t\tif (props.locationRepository instanceof LocationRepository)\n\t\t{\n\t\t\tthis.#locationRepository = props.locationRepository;\n\t\t}\n\t\telse if (this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#locationRepository = new LocationRepository();\n\t\t}\n\n\t\tthis.#state = State.INITIAL;\n\t}\n\n\t/**\n\t * @param {AddressEntity} address\n\t * @param {BaseFeature} sourceFeature\n\t * @param {Array} excludeFeatures\n\t * @internal\n\t */\n\tsetAddressByFeature(\n\t\taddress: AddressEntity,\n\t\tsourceFeature: BaseFeature,\n\t\texcludeFeatures: Array = []\n\t): void\n\t{\n\t\tconst addressId = this.#address ? this.#address.id : 0;\n\n\t\tif (\n\t\t\taddress\n\t\t\t&& !address.getFieldValue(AddressType.ADDRESS_LINE_1)\n\t\t\t&& this.#addressFormat.isTemplateExists(FormatTemplateType.ADDRESS_LINE_1)\n\t\t)\n\t\t{\n\t\t\taddress.setFieldValue(\n\t\t\t\tAddressType.ADDRESS_LINE_1,\n\t\t\t\tAddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\t\taddress,\n\t\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.ADDRESS_LINE_1),\n\t\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t\tnull,\n\t\t\t\t\tthis.#addressFormat\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tif (addressId > 0)\n\t\t{\n\t\t\tthis.#address.id = addressId;\n\t\t}\n\n\t\tthis.#isAddressChangedByFeature = true;\n\t\tthis.#setInputValue(address);\n\n\t\tthis.#executeFeatureMethod(\n\t\t\t'setAddress',\n\t\t\t[address],\n\t\t\tsourceFeature,\n\t\t\texcludeFeatures\n\t\t);\n\n\t\tif (this.#state !== State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\t}\n\n\temitFeatureEvent(featureEvent: FeatureEvent)\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onFeatureEvent,\n\t\t\tfeatureEvent\n\t\t);\n\t}\n\n\t/**\n\t * Add feature to the widget\n\t * @param {BaseFeature} feature\n\t */\n\t#addFeature(feature: BaseFeature)\n\t{\n\t\tif (!(feature instanceof BaseFeature))\n\t\t{\n\t\t\tBX.debug('feature must be instance of BaseFeature');\n\t\t}\n\n\t\tfeature.setAddressWidget(this);\n\t\tthis.#features.push(feature);\n\t}\n\n\tget features()\n\t{\n\t\treturn this.#features;\n\t}\n\n\t#executeFeatureMethod(method, params = [], sourceFeature = null, excludeFeatures = [])\n\t{\n\t\tlet result;\n\n\t\tfor(const feature of this.#features)\n\t\t{\n\t\t\tlet isExcluded = false;\n\t\t\tfor(const excludeFeature of excludeFeatures)\n\t\t\t{\n\t\t\t\tif (feature instanceof excludeFeature)\n\t\t\t\t{\n\t\t\t\t\tisExcluded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isExcluded && feature !== sourceFeature)\n\t\t\t{\n\t\t\t\tresult = feature[method].apply(feature, params);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#emitOnAddressChanged()\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onAddressChangedEvent,\n\t\t\t{address: this.#address}\n\t\t);\n\n\t\tif (this.#address && this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#warmBackendAfterAddressChanged(this.#address);\n\t\t}\n\t}\n\n\t#warmBackendAfterAddressChanged(address: AddressEntity): void\n\t{\n\t\tif (address.location !== null && address.location.id <= 0)\n\t\t{\n\t\t\tthis.#locationRepository.findParents(address.location);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocus(e: KeyboardEvent)\n\t{\n\t\tconst value = this.#inputNode.value;\n\n\t\tif (value.length > 0)\n\t\t{\n\t\t\tBX.setCaretPosition(this.#inputNode, value.length - 1);\n\t\t}\n\t}\n\n\t#convertAddressToString(\n\t\taddress: ?Address,\n\t\ttemplateType: string\n\t): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t\t{\n\t\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setInputValue(address: ?Address)\n\t{\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tconst shortAddressString = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\t\t\tconst fullAddressString = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\tthis.#inputNode.value = shortAddressString.trim() !== '' ? shortAddressString : fullAddressString;\n\t\t\tthis.#inputNode.title = fullAddressString;\n\t\t\tconst selectionStart = this.#inputNode.selectionStart;\n\t\t\tconst selectionEnd = shortAddressString.length;\n\t\t\tthis.#inputNode.setSelectionRange(selectionStart, selectionEnd);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocusOut(e: Event)\n\t{\n\t\t// Seems that we don't have any autocompleter feature\n\t\tif (this.#isInputNodeValueUpdated && !this.#isAddressChangedByFeature)\n\t\t{\n\t\t\tconst value = this.#inputNode.value.trim();\n\t\t\tconst address = new AddressEntity({languageId: this.#languageId});\n\t\t\taddress.setFieldValue(this.#addressFormat.fieldForUnRecognized, value);\n\t\t\tthis.address = address;\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t}\n\n\tonInputKeyup(e: KeyboardEvent)\n\t{\n\t\tswitch (e.code)\n\t\t{\n\t\t\tcase 'Tab':\n\t\t\tcase 'Esc':\n\t\t\tcase 'Enter':\n\t\t\tcase 'NumpadEnter':\n\t\t\t\tthis.resetView();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.#isInputNodeValueUpdated = true;\n\t\t}\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#executeFeatureMethod('resetView');\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tif (!Type.isDomNode(props.controlWrapper))\n\t\t{\n\t\t\tBX.debug('props.controlWrapper  must be instance of Element');\n\t\t}\n\n\t\tthis.#controlWrapper = props.controlWrapper;\n\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.inputNode))\n\t\t\t{\n\t\t\t\tBX.debug('props.inputNode  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#inputNode = props.inputNode;\n\t\t\tthis.#setInputValue(this.#address);\n\t\t}\n\n\t\tthis.#executeFeatureMethod('render', [props]);\n\n\t\t// We can prevent these events in features if need\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tEvent.bind(this.#inputNode, 'focus', this.#onInputFocus.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'focusout', this.#onInputFocusOut.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'keyup', this.onInputKeyup.bind(this));\n\t\t}\n\t}\n\n\tget controlWrapper()\n\t{\n\t\treturn this.#controlWrapper;\n\t}\n\n\tget inputNode()\n\t{\n\t\treturn this.#inputNode;\n\t}\n\n\tget address(): ?AddressEntity\n\t{\n\t\treturn this.#address;\n\t}\n\n\tset address(address: ?AddressEntity): void\n\t{\n\t\tif (address && !(address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\t\tthis.#executeFeatureMethod('setAddress', [address]);\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t\tthis.#setInputValue(address);\n\t}\n\n\tget mode()\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tif (!(ControlMode.isValid(mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tthis.#executeFeatureMethod('setMode', [mode]);\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\tget addressFormat(): Format\n\t{\n\t\treturn this.#addressFormat;\n\t}\n\n\tsetStateByFeature(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tthis.emit(\n\t\t\tAddress.onStateChangedEvent,\n\t\t\t{state: state}\n\t\t);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onStateChangedEvent, listener);\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onAddressChangedEvent, listener);\n\t}\n\n\tsubscribeOnFeatureEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onFeatureEvent, listener);\n\t}\n\n\tsubscribeOnErrorEvent(listener: Function): void\n\t{\n\t\tErrorPublisher.getInstance().subscribe(listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#destroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\t\tEvent.unbind(this.#inputNode, 'focus', this.#onInputFocus);\n\t\tEvent.unbind(this.#inputNode, 'focusout', this.#onInputFocusOut);\n\t\tEvent.unbind(this.#inputNode, 'keyup', this.onInputKeyup);\n\n\t\tthis.#executeFeatureMethod('destroy');\n\t\tthis.#destroyFeatures();\n\t\tthis.#destroyed = true;\n\t}\n\n\t#destroyFeatures()\n\t{\n\t\tthis.#features.splice(0, this.#features.length);\n\t}\n\n\tisDestroyed()\n\t{\n\t\treturn this.#destroyed;\n\t}\n}","import {EventEmitter} from 'main.core.events';\nimport {Tag} from 'main.core';\n\nexport default class MenuBottom extends EventEmitter\n{\n\t#node;\n\t#leftItemNodeContainer;\n\t#rightItemNodeContainer;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete.MenuBottom');\n\t}\n\n\trender()\n\t{\n\t\tthis.#leftItemNodeContainer = Tag.render`<div class=\"location-map-popup-item--info-left\"></div>`;\n\t\tthis.#rightItemNodeContainer = Tag.render`<div></div>`;\n\n\t\tthis.#node = Tag.render`\n\t\t\t<div>\n\t\t\t\t<span class=\"location-map-popup-item--info\"> \t\t\n\t\t\t\t\t${this.#leftItemNodeContainer}\n\t\t\t\t\t${this.#rightItemNodeContainer}\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#node;\n\t}\n\n\tsetRightItemNode(node: Element): void\n\t{\n\t\twhile (this.#rightItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#rightItemNodeContainer.removeChild(this.#rightItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#rightItemNodeContainer.appendChild(node);\n\t}\n\n\tsetLeftItemNode(node: Element): void\n\t{\n\t\twhile (this.#leftItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#leftItemNodeContainer.removeChild(this.#leftItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#leftItemNodeContainer.appendChild(node);\n\t}\n}","import {Menu as MainMenu} from 'main.popup';\nimport './css/menu.css';\nimport MenuBottom from './menubottom';\n\nexport default class Menu extends MainMenu\n{\n\tchoseItemIdx = -1;\n\t#bottom;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tconst elRect = options.bindElement.getBoundingClientRect();\n\t\tthis.popupWindow.setMaxWidth(elRect.width);\n\t\tthis.#bottom = new MenuBottom();\n\t\tthis.layout.menuContainer.appendChild(\n\t\t\tthis.#bottom.render()\n\t\t);\n\t}\n\n\tisMenuEmpty(): boolean\n\t{\n\t\treturn this.menuItems.length <= 0;\n\t}\n\n\tisChoseLastItem(): boolean\n\t{\n\t\treturn this.choseItemIdx >= this.menuItems.length - 1;\n\t}\n\n\tisChoseFirstItem(): boolean\n\t{\n\t\treturn this.choseItemIdx === 0;\n\t}\n\n\tisItemChosen(): boolean\n\t{\n\t\treturn this.choseItemIdx >= 0;\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn this.getPopupWindow().isDestroyed();\n\t}\n\n\tisItemExist(index: number): boolean\n\t{\n\t\treturn typeof this.menuItems[index] !== 'undefined';\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\n\t\tif(this.isItemChosen() && this.isItemExist(this.choseItemIdx))\n\t\t{\n\t\t\tresult = this.menuItems[this.choseItemIdx];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseLastItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx + 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\tchoosePrevItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseFirstItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx - 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\thighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.add('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tunHighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.remove('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tchooseItem(index: number)\n\t{\n\t\tlet idx = index;\n\n\t\tif(idx < 0)\n\t\t{\n\t\t\tidx = this.menuItems.length - 1;\n\t\t}\n\t\telse if(idx > this.menuItems.length - 1)\n\t\t{\n\t\t\tidx = 0;\n\t\t}\n\n\t\tthis.unHighlightItem(this.choseItemIdx);\n\t\tthis.choseItemIdx = idx;\n\t\tthis.highlightItem(this.choseItemIdx);\n\t}\n\n\tclearItems()\n\t{\n\t\twhile(this.menuItems.length > 0)\n\t\t{\n\t\t\tthis.removeMenuItem(this.menuItems[0].id);\n\t\t}\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getPopupWindow().isShown();\n\t}\n\n\tsetBottomRightItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setRightItemNode(node);\n\t}\n\n\tsetBottomLeftItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setLeftItemNode(node);\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Loc} from 'main.core';\nimport {Location, Address, AddressType, LocationType} from 'location.core';\nimport Menu from './menu';\n\nexport default class Prompt extends EventEmitter\n{\n\tstatic onItemSelectedEvent = 'onItemSelected';\n\n\t/** Element */\n\t#inputNode;\n\n\t/** Element */\n\t#menuNode;\n\n\t/** {Menu} */\n\t#menu;\n\n\t/** {Array<Location>} */\n\t#locationList;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Prompt');\n\n\t\tthis.#inputNode = props.inputNode;\n\n\t\tif (props.menuNode)\n\t\t{\n\t\t\tthis.#menuNode = props.menuNode;\n\t\t}\n\t}\n\n\t#createMenu()\n\t{\n\t\treturn new Menu({\n\t\t\tbindElement: this.#menuNode ? this.#menuNode : this.#inputNode,\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: 'location-widget-prompt-menu',\n\t\t});\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tif(!this.#menu || this.#menu.isDestroyed())\n\t\t{\n\t\t\tthis.#menu = this.#createMenu();\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t/**\n\t * Show menu with list of locations\n\t * @param {array} locationsList\n\t * @param {string} searchPhrase\n\t * @returns void\n\t */\n\tshow(locationsList: Array<Location>, searchPhrase: string): void\n\t{\n\t\tif(locationsList.length > 0)\n\t\t{\n\t\t\tthis.setMenuItems(locationsList, searchPhrase);\n\t\t\tthis.getMenu().show();\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.getMenu().close();\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @param {string} searchPhrase\n\t * @param {Address} address\n\t * @returns {*}\n\t */\n\tsetMenuItems(locationsList: Array<Location>, searchPhrase: string, address: ?Address): Menu\n\t{\n\t\tthis.getMenu().clearItems();\n\n\t\tif(Array.isArray(locationsList))\n\t\t{\n\t\t\tlet isSeparatorSet = false;\n\n\t\t\tthis.#locationList = locationsList.slice();\n\n\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\tif(address && address.getFieldValue(AddressType.LOCALITY))\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t!isSeparatorSet\n\t\t\t\t\t\t&& location\n\t\t\t\t\t\t&& location.address\n\t\t\t\t\t\t&& location.address.getFieldValue(AddressType.LOCALITY)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!this.#getAddressPossibleLocalities(location.address).includes(\n\t\t\t\t\t\t\t\taddress.getFieldValue(AddressType.LOCALITY)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tisSeparatorSet = true;\n\t\t\t\t\t\t\tthis.getMenu().addMenuItem({\n\t\t\t\t\t\t\t\thtml: Loc.getMessage('LOCATION_WIDGET_PROMPT_IN_OTHER_CITY'),\n\t\t\t\t\t\t\t\tdelimiter: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\t#getAddressPossibleLocalities(address: Address)\n\t{\n\t\tconst result = [];\n\n\t\tif (address.getFieldValue(AddressType.LOCALITY))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.LOCALITY));\n\t\t}\n\n\t\t/**\n\t\t * Address break-down formed on frontend is very inaccurate so we can't rely only on the locality type field\n\t\t * @see #142094\n\t\t */\n\t\tif (address.getFieldValue(AddressType.ADM_LEVEL_1))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.ADM_LEVEL_1));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param {number} index\n\t * @param {Location} location\n\t * @param {string} searchPhrase\n\t * @returns {{onclick: onclick, text: string}}\n\t */\n\t#createMenuItem(index, location: Location, searchPhrase): Object\n\t{\n\t\treturn {\n\t\t\tid: index,\n\t\t\ttitle: location.name,\n\t\t\thtml: Prompt.createMenuItemText(location.name, searchPhrase, location),\n\t\t\tonclick: (event, item) => {\n\t\t\t\tthis.#onItemSelect(index);\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t};\n\t}\n\n\t#onItemSelect(index: number): void\n\t{\n\t\tconst location = this.#getLocationFromList(index);\n\n\t\tif(location)\n\t\t{\n\t\t\tthis.emit(Prompt.onItemSelectedEvent, {location: location});\n\t\t}\n\t}\n\n\tstatic createMenuItemText(locationName: string, searchPhrase: string, location: Location): string\n\t{\n\t\tlet result = `\n\t\t<div>\n\t\t\t<strong>${locationName}</strong>\n\t\t</div>`;\n\n\t\tlet clarification;\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\n\t\t\tif(clarification)\n\t\t\t{\n\t\t\t\tif(location.getFieldValue(LocationType.TMP_TYPE_HINT))\n\t\t\t\t{\n\t\t\t\t\tclarification += ` <i>(${location.getFieldValue(LocationType.TMP_TYPE_HINT)})</i>`;\n\t\t\t\t}\n\n\t\t\t\tresult += `<div>${clarification}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn '<div data-role=\"location-widget-menu-item\" tabindex=\"-1\">' + result + '</div>';\n\t}\n\n\tstatic #extractClarification(location: Location): string\n\t{\n\t\tlet clarification = '';\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\t\t}\n\n\t\treturn clarification;\n\t}\n\n\t#getLocationFromList(index: number): ?Location\n\t{\n\t\tlet result = null;\n\n\t\tif (this.#locationList[index] !== undefined)\n\t\t{\n\t\t\tresult = this.#locationList[index];\n\t\t}\n\n\t\tif(!result)\n\t\t{\n\t\t\tBX.debug(`Location with index ${index} was not found`);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchoosePrevItem(isRecursive: boolean = false)\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().choosePrevItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = isRecursive ? this.getMenu().chooseNextItem() : this.choosePrevItem(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem()\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().chooseNextItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = this.chooseNextItem();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisItemChosen()\n\t{\n\t\treturn this.getMenu().isItemChosen();\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\t\tconst menuItem = this.getMenu().getChosenItem();\n\n\t\tif(menuItem && menuItem.id)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getMenu().isShown();\n\t}\n\n\tdestroy()\n\t{\n\t\tif(this.#menu)\n\t\t{\n\t\t\tthis.#menu.destroy();\n\t\t\tthis.#menu = null;\n\t\t}\n\n\t\tthis.#locationList = null;\n\t}\n}","import {Format, FormatTemplateType, AddressStringConverter, Address} from 'location.core';\n\nexport default class AddressString\n{\n\t// Input node element\n\t#input = null;\n\t// Address string value\n\t#value = '';\n\t// Address string as it was without custom inputs\n\t#pureAddressString = '';\n\t#addressFormat = null;\n\n\tconstructor(input: HTMLInputElement, addressFormat: Format, address: ?Address)\n\t{\n\t\tif (!(input instanceof HTMLInputElement))\n\t\t{\n\t\t\tthrow new TypeError('Wrong input type');\n\t\t}\n\n\t\tthis.#input = input;\n\n\t\tif (!(addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new TypeError('Wrong addressFormat type');\n\t\t}\n\n\t\tthis.#addressFormat = addressFormat;\n\n\t\tif (address && !(address instanceof Address))\n\t\t{\n\t\t\tthrow new TypeError('Wrong address type');\n\t\t}\n\t\tif (address)\n\t\t{\n\t\t\tthis.setValueFromAddress(address);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {string} value Address string value\n\t * @param {boolean} isPureAddress Does it contain user input or not\n\t */\n\tsetValue(value: string, isPureAddress: boolean = false): void\n\t{\n\t\tthis.#value = value;\n\t\tthis.#input.value = value;\n\n\t\tif (isPureAddress)\n\t\t{\n\t\t\tthis.#pureAddressString = value;\n\t\t}\n\n\t\tthis.#actualizePureString();\n\t}\n\n\tactualize()\n\t{\n\t\tthis.#value = this.#input.value;\n\t\tthis.#actualizePureString();\n\t}\n\n\t#actualizePureString()\n\t{\n\t\tif (this.#isPureAddressStringModified())\n\t\t{\n\t\t\tthis.#pureAddressString = '';\n\t\t}\n\t}\n\n\tisChanged()\n\t{\n\t\treturn this.#value.trim() !== this.#input.value.trim();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tget customTail()\n\t{\n\t\tif (this.#pureAddressString === '')\n\t\t{\n\t\t\treturn this.#value;\n\t\t}\n\n\t\tlet result;\n\n\t\tif (!this.#isPureAddressStringModified())\n\t\t{\n\t\t\tresult = this.#value.slice(this.#pureAddressString.length);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = this.#value;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thasPureAddressString()\n\t{\n\t\treturn this.#pureAddressString !== '';\n\t}\n\n\t// We suggest that user will input data after the address data\n\t#isPureAddressStringModified(): boolean\n\t{\n\t\treturn this.#value === ''\n\t\t\t|| this.#pureAddressString === ''\n\t\t\t|| this.#value.indexOf(this.#pureAddressString) !== 0;\n\t}\n\n\tsetValueFromAddress(address: ?Address): void\n\t{\n\t\tlet value = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\t}\n\t\t}\n\n\t\tthis.setValue(value, true);\n\t}\n\n\t#convertAddressToString(address: Address, templateType: string): string\n\t{\n\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t{\n\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\treturn '';\n\t\t}\n\n\t\treturn AddressStringConverter.convertAddressToStringTemplate(\n\t\t\taddress,\n\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t', ',\n\t\t\tthis.#addressFormat\n\t\t);\n\t}\n}","import {Event, Loc, Tag} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {LocationRepository, AutocompleteServiceBase, Format, Address, Location,\n\tDistanceCalculator,\tErrorPublisher, LocationType,\n\tAutocompleteServiceFilter,\n\tAddressType,\n\tLocationJsonConverter\n} from 'location.core';\nimport type {AutocompleteServiceParams} from 'location.core';\nimport Prompt from './prompt';\nimport State from '../state';\nimport AddressString from './addressstring';\n\n/**\n * @mixes EventEmitter\n */\nexport default class Autocomplete extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\tstatic #onSearchStartedEvent = 'onSearchStarted';\n\tstatic #onSearchCompletedEvent = 'onSearchCompleted';\n\tstatic #onShowOnMapClickedEvent = 'onShowOnMapClicked';\n\n\t/** {Address} */\n\t#address;\n\t/** {AddressString|null} */\n\t#addressString = null;\n\t/** {String} */\n\t#languageId;\n\t/** {Format} */\n\t#addressFormat;\n\t/** {String} */\n\t#sourceCode;\n\t/** {LocationRepository} */\n\t#locationRepository;\n\t/** {Location} */\n\t#userLocation;\n\t/** {Function} */\n\t#presetLocationsProvider;\n\t/** {Prompt} */\n\t#prompt;\n\t/** {AutocompleteServiceBase} */\n\t#autocompleteService;\n\t/** @type {number} */\n\t#minCharsCountToAutocomplete;\n\t/** {number} milliseconds promptDelay before the searching will start */\n\t#promptDelay;\n\t/** {number} */\n\t#maxPromptDelay;\n\t/** {number} */\n\t#timerId = null;\n\t/** {Element} */\n\t#inputNode;\n\n\t#searchPhrase = {\n\t\trequested: '',\n\t\tcurrent: '',\n\t\tdropped: ''\n\t};\n\n\t#state;\n\t#isDestroyed = false;\n\n\t#prevKeyUpTime;\n\t#avgKeyUpDelay;\n\n\t#isAutocompleteRequestStarted = false;\n\n\t#maxFirstItemUserDistanceKm = 100;\n\t#onLocationSelectTimerId = null;\n\n\t#lastSelectedLocationLocalStorageKey = `bitrixLocationLastSelectedLocation`;\n\n\t/** {AutocompleteServiceFilter} */\n\t#filter;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('props.addressFormat must be type of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (!(props.autocompleteService instanceof AutocompleteServiceBase))\n\t\t{\n\t\t\tthrow new Error('props.autocompleteService must be type of AutocompleteServiceBase');\n\t\t}\n\n\t\tthis.#autocompleteService = props.autocompleteService;\n\n\t\tif (!props.languageId)\n\t\t{\n\t\t\tthrow new Error('props.languageId must be defined');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#sourceCode = props.sourceCode;\n\t\tthis.#address = props.address;\n\t\tthis.#presetLocationsProvider = props.presetLocationsProvider;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#userLocation = props.userLocation;\n\t\tthis.#promptDelay = props.promptDelay || 300;\n\t\tthis.#maxPromptDelay = props.maxPromptDelay || 500;\n\t\tthis.#minCharsCountToAutocomplete = props.minCharsCountToAutocomplete || 3;\n\t\tthis.#setState(State.INITIAL);\n\t\tthis.#avgKeyUpDelay = this.#promptDelay;\n\t\tthis.#filter = new AutocompleteServiceFilter();\n\t}\n\n\trender(props: {}): void\n\t{\n\t\tthis.#inputNode = props.inputNode;\n\t\tthis.#address = props.address;\n\t\tthis.#addressString = new AddressString(this.#inputNode, this.#addressFormat, this.#address);\n\t\tthis.#inputNode.addEventListener('keyup', this.#onInputKeyUp.bind(this));\n\t\tthis.#inputNode.addEventListener('focus', this.#onInputFocus.bind(this));\n\t\tthis.#inputNode.addEventListener('focusout', this.#onInputFocusOut.bind(this));\n\t\tthis.#inputNode.addEventListener('click', this.#onInputClick.bind(this));\n\n\t\tthis.#prompt = new Prompt({\n\t\t\tinputNode: props.inputNode,\n\t\t\tmenuNode: props.menuNode,\n\t\t});\n\n\t\tthis.#prompt.subscribe(Prompt.onItemSelectedEvent, this.#onPromptItemSelected.bind(this));\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputClick(e: MouseEvent)\n\t{\n\t\tconst value = this.#addressString.value;\n\n\t\tif (value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#showPresetLocations()\n\t{\n\t\tconst presetLocationList = this.#presetLocationsProvider();\n\n\t\tthis.#prompt.setMenuItems(presetLocationList, '');\n\n\t\tlet leftBottomMenuMessage;\n\n\t\tif (presetLocationList.length > 0)\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP');\n\t\t}\n\n\t\tthis.#showMenu(leftBottomMenuMessage, null);\n\t}\n\n\t#createRightBottomMenuNode(location: ?Location): Element\n\t{\n\t\tconst element = Tag.render`\n\t\t\t\t<span class=\"location-map-popup-item--show-on-map\">\n\t\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_SHOW_ON_MAP')}\n\t\t\t\t</span>\n\t\t`;\n\n\t\telement.addEventListener('click', this.#getShowOnMapHandler(location));\n\n\t\treturn element;\n\t}\n\n\t#createLeftBottomMenuNode(text: string): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<span>\t\t\t\t\n\t\t\t\t\t<span class=\"menu-popup-item-icon\"></span>\n\t\t\t\t\t<span class=\"menu-popup-item-text\">${text}</span>\n\t\t\t\t</span>\t\t\n\t\t`;\n\t}\n\n\t#showMenu(leftBottomText: string, location: ?Location): void\n\t{\n\t\t/* Menu destroys popup after the closing, so we need to refresh it every time, we show it */\n\t\tthis.#prompt.getMenu().setBottomRightItemNode(\n\t\t\tthis.#createRightBottomMenuNode(location)\n\t\t);\n\t\tthis.#prompt.getMenu().setBottomLeftItemNode(\n\t\t\tthis.#createLeftBottomMenuNode(leftBottomText)\n\t\t);\n\t\tthis.#prompt.getMenu().show();\n\t}\n\n\t#onInputFocusOut(e: Event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#state === State.DATA_INPUTTING\n\t\t\t&& !(\n\t\t\t\te.relatedTarget\n\t\t\t\t&& (e.relatedTarget.getAttribute('data-role') === 'location-widget-menu-item')\n\t\t\t)\n\t\t) {\n\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\n\t\t\tif (this.#addressString) {\n\t\t\t\tif (!this.#address || !this.#addressString.hasPureAddressString()) {\n\t\t\t\t\tthis.#address = this.#convertStringToAddress(\n\t\t\t\t\t\tthis.#addressString.value\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\t// this.#addressString === null until autocompete'll be rendered\n\t\t\t\telse if (this.#addressString.customTail !== '') {\n\t\t\t\t\tthis.#address.setFieldValue(\n\t\t\t\t\t\tthis.#addressFormat.fieldForUnRecognized,\n\t\t\t\t\t\tthis.#addressString.customTail\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.#onAddressChangedEventEmit();\n\t\t}\n\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\n\t\t// Let's prevent other onInputFocusOut handlers.\n\t\te.stopImmediatePropagation();\n\t}\n\n\t#onInputFocus()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#address\n\t\t\t&& (!this.#address.location || !this.#address.location.hasExternalRelation())\n\t\t\t&& this.#addressString.value.length > 0\n\t\t)\n\t\t{\n\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t}\n\t}\n\n\t#makeAutocompleteFilter(): AutocompleteServiceFilter\n\t{\n\t\tconst locationForBias = this.#getLastSelectedLocation();\n\t\tconst result = new AutocompleteServiceFilter();\n\n\t\tif (!locationForBias)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\t\tlet filterType = null;\n\n\t\tif (locationForBias.type === LocationType.COUNTRY)\n\t\t{\n\t\t\tfilterType = LocationType.LOCALITY;\n\t\t}\n\t\telse if (locationForBias.type === LocationType.LOCALITY)\n\t\t{\n\t\t\tfilterType = LocationType.STREET;\n\t\t}\n\t\telse if (locationForBias.type === LocationType.STREET)\n\t\t{\n\t\t\tfilterType = LocationType.BUILDING;\n\t\t}\n\n\t\tif (filterType)\n\t\t{\n\t\t\tresult.types = [filterType];\n\t\t}\n\t\treturn result;\n\t}\n\n\t#makeAutocompleteServiceParams(): AutocompleteServiceParams\n\t{\n\t\tlet locationForBias = null;\n\t\tconst result: AutocompleteServiceParams = {};\n\n\t\tconst lastSelectedLocation = this.#getLastSelectedLocation();\n\t\tif (lastSelectedLocation)\n\t\t{\n\t\t\tlocationForBias = lastSelectedLocation;\n\t\t}\n\t\telse if (this.#userLocation)\n\t\t{\n\t\t\tlocationForBias = this.#userLocation;\n\t\t}\n\n\t\tresult.filter = this.#filter;\n\t\tresult.locationForBias = locationForBias;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param address\n\t */\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (this.#addressString) // already rendered\n\t\t{\n\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t}\n\n\t\tif (!address)\n\t\t{\n\t\t\tthis.#filter.reset();\n\t\t}\n\t}\n\n\t/**\n\t * @returns {Address}\n\t */\n\tget address(): ?Address\n\t{\n\t\treturn this.#address;\n\t}\n\n\t/**\n\t * Close menu on mouse click outside\n\t * @param {MouseEvent} event\n\t */\n\t#onDocumentClick(event: MouseEvent)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.target === this.#inputNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\t/**\n\t * Subscribe on changed event\n\t * @param {Function} listener\n\t */\n\tonAddressChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onAddressChangedEvent, listener);\n\t}\n\n\t/**\n\t * Subscribe on loading event\n\t * @param {Function} listener\n\t */\n\tonStateChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onStateChangedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchStartedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchStartedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchCompletedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchCompletedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonShowOnMapClickedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onShowOnMapClickedEvent, listener);\n\t}\n\n\t/**\n\t * Is called when autocompleteService returned location list\n\t * @param {array} locationsList\n\t * @param {object} params\n\t */\n\t#onPromptsReceived(locationsList: array<Location>, params: Object): void\n\t{\n\t\tif (Array.isArray(locationsList) && locationsList.length > 0)\n\t\t{\n\t\t\tif (\n\t\t\t\tlocationsList.length === 1\n\t\t\t\t&& this.#address\n\t\t\t\t&& this.#address.location\n\t\t\t\t&& this.#address.location.externalId\n\t\t\t\t&& this.#address.location.externalId === locationsList[0].externalId\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.closePrompt();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#prompt.setMenuItems(locationsList, this.#searchPhrase.requested, this.#getCurrentAddress());\n\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP'), locationsList[0]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst split = Autocomplete.#splitPhrase(this.#searchPhrase.current);\n\t\t\tthis.#searchPhrase.current = split[0];\n\t\t\tthis.#searchPhrase.dropped = `${split[1]} ${this.#searchPhrase.dropped}`;\n\n\t\t\tif (this.#searchPhrase.current.length > 0)\n\t\t\t{\n\t\t\t\tthis.#showPromptInner(this.#searchPhrase.current, params, 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#prompt.getMenu().clearItems();\n\n\t\t\t\tthis.#prompt.getMenu().addMenuItem(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'notFound',\n\t\t\t\t\t\thtml: `<span>${Loc.getMessage('LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND')}</span>`,\n\t\t\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP'), null);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getCurrentAddress()\n\t{\n\t\tif (\n\t\t\tthis.address\n\t\t\t&& this.address.getFieldValue(AddressType.LOCALITY)\n\t\t)\n\t\t{\n\t\t\treturn this.address;\n\t\t}\n\n\t\tconst lastSelectedLocation = this.#getLastSelectedLocation();\n\t\tif (\n\t\t\tlastSelectedLocation\n\t\t\t&& lastSelectedLocation.address\n\t\t\t&& lastSelectedLocation.address.getFieldValue(AddressType.LOCALITY)\n\t\t)\n\t\t{\n\t\t\treturn lastSelectedLocation.address;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getShowOnMapHandler(location: ?Location)\n\t{\n\t\treturn () => {\n\t\t\tif (location && this.#userLocation\n\t\t\t\t&& location.latitude && location.longitude\n\t\t\t\t&& this.#userLocation.latitude\n\t\t\t\t&& this.#userLocation.longitude\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst firstItemUserDistance = DistanceCalculator.getDistanceFromLatLonInKm(\n\t\t\t\t\tlocation.latitude,\n\t\t\t\t\tlocation.longitude,\n\t\t\t\t\tthis.#userLocation.latitude,\n\t\t\t\t\tthis.#userLocation.longitude\n\t\t\t\t);\n\n\t\t\t\tif (firstItemUserDistance <= this.#maxFirstItemUserDistanceKm)\n\t\t\t\t{\n\t\t\t\t\tthis.#fulfillSelection(location);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit(Autocomplete.#onShowOnMapClickedEvent);\n\t\t\t\t},\n\t\t\t\t1 // Otherwise this click will close just opened map popup.\n\t\t\t);\n\t\t};\n\t}\n\n\tstatic #splitPhrase(phrase: string): Object\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tphrase = phrase.trim();\n\n\t\tif (phrase.length <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\tconst tailPosition = phrase.lastIndexOf(' ');\n\n\t\tif (tailPosition <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\treturn [phrase.slice(0, tailPosition), phrase.slice(tailPosition + 1)];\n\t}\n\n\t/**\n\t * Is called when location from menu have chosen\n\t * @param event\n\t */\n\t#onPromptItemSelected(event: BaseEvent): void\n\t{\n\t\tif (event.data.location)\n\t\t{\n\t\t\tthis.#fulfillSelection(event.data.location);\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Autocomplete.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\t/**\n\t * Fulfill selected location\n\t * @param {Location} location\n\t * @returns {Promise}\n\t */\n\t#fulfillSelection(location: ?Location): void\n\t{\n\t\tlet result;\n\t\tthis.#setState(State.DATA_SELECTED);\n\t\tif (location)\n\t\t{\n\t\t\tif (location.hasExternalRelation() && this.#sourceCode === location.sourceCode)\n\t\t\t{\n\t\t\t\tresult = this.#getLocationDetails(location)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(detailedLocation: ?Location) => {\n\n\t\t\t\t\t\t\tif (location.address && location.address.getFieldValue(AddressType.ADDRESS_LINE_2))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdetailedLocation.address.setFieldValue(\n\t\t\t\t\t\t\t\t\tAddressType.ADDRESS_LINE_2,\n\t\t\t\t\t\t\t\t\tlocation.address.getFieldValue(AddressType.ADDRESS_LINE_2)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.#createOnLocationSelectTimer(detailedLocation, 0);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => ErrorPublisher.getInstance().notify(response.errors)\n\t\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, 0);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.#createOnLocationSelectTimer(null, 0);\n\t\t\t\t\tresolve();\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#onAddressChangedEventEmit(excludeSetAddressFeatures: Array = [])\n\t{\n\t\tthis.emit(\n\t\t\tAutocomplete.#onAddressChangedEvent,\n\t\t\t{\n\t\t\t\taddress: this.#address,\n\t\t\t\texcludeSetAddressFeatures\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * obtain location details\n\t * @param {Location} location\n\t * @returns {*}\n\t */\n\t#getLocationDetails(location: Location): Promise\n\t{\n\t\tthis.#setState(State.DATA_LOADING);\n\n\t\treturn this.#locationRepository.findByExternalId(\n\t\t\tlocation.externalId,\n\t\t\tlocation.sourceCode,\n\t\t\tlocation.languageId\n\t\t)\n\t\t\t.then((detailedLocation: ?Location) => {\n\t\t\t\t\tthis.#setState(State.DATA_LOADED);\n\n\t\t\t\t\tlet result;\n\t\t\t\t\t/*\n\t\t\t\t\t * Nominatim could return a bit different location without the coordinates.\n\t\t\t\t\t * For example N752206814\n\t\t\t\t\t */\n\t\t\t\t\tif (\n\t\t\t\t\t\tdetailedLocation.latitude !== '0'\n\t\t\t\t\t\t&& detailedLocation.longitude !== '0'\n\t\t\t\t\t\t&& detailedLocation !== ''\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = detailedLocation;\n\t\t\t\t\t\tresult.name = location.name;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = location;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\tErrorPublisher.getInstance().notify(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\t#convertStringToAddress(addressString: string)\n\t{\n\t\tconst result = new Address({\n\t\t\tlanguageId: this.#languageId\n\t\t});\n\n\t\tresult.setFieldValue(this.#addressFormat.fieldForUnRecognized, addressString);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Is called when location was selected and the location details were obtained\n\t * @param {Location} location\n\t */\n\t#onLocationSelect(location: ?Location): void\n\t{\n\t\tif (location)\n\t\t{\n\t\t\tthis.#setLastSelectedLocation(location);\n\t\t}\n\n\t\tthis.#filter = this.#makeAutocompleteFilter();\n\t\tthis.#address = location ? location.toAddress() : null;\n\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\tthis.#onAddressChangedEventEmit();\n\t}\n\n\t#onInputKeyUp(e: KeyboardEvent): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst now = Date.now();\n\n\t\tif (this.#prevKeyUpTime)\n\t\t{\n\t\t\tconst delta = now - this.#prevKeyUpTime;\n\t\t\tthis.#avgKeyUpDelay = (this.#avgKeyUpDelay + delta) / 2;\n\t\t}\n\n\t\tthis.#prevKeyUpTime = now;\n\n\t\tif (\n\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t&& this.#addressString.isChanged()\n\t\t)\n\t\t{\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tlet location;\n\t\t\tconst onLocationSelectTimeout = 700;\n\n\t\t\tswitch (e.code)\n\t\t\t{\n\t\t\t\tcase 'NumpadEnter':\n\t\t\t\tcase 'Enter':\n\t\t\t\t\tif (this.#prompt.isItemChosen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#fulfillSelection(this.#prompt.getChosenItem())\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t(error) => BX.debug(error)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Tab':\n\t\t\t\tcase 'Escape':\n\t\t\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\t\t\t\t\tthis.#onAddressChangedEventEmit();\n\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\tlocation = this.#prompt.choosePrevItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\tlocation = this.#prompt.chooseNextItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Backspace':\n\t\t\t\tcase 'Delete':\n\t\t\t\t\tthis.#filter.reset();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#addressString.isChanged())\n\t\t{\n\t\t\tthis.#addressString.actualize();\n\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t}\n\n\t\tif (this.#addressString.value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#createOnLocationSelectTimer(location: Location, timeout: Number): void\n\t{\n\t\tif (this.#onLocationSelectTimerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#onLocationSelectTimerId);\n\t\t}\n\n\t\tthis.#onLocationSelectTimerId = setTimeout(() => {\n\t\t\t\tthis.#onLocationSelect(location);\n\t\t\t},\n\t\t\ttimeout\n\t\t);\n\t}\n\n\t/**\n\t * @param {string} searchPhrase\n\t */\n\tshowPrompt(searchPhrase: string): void\n\t{\n\t\tthis.#searchPhrase.requested = searchPhrase;\n\t\tthis.#searchPhrase.current = searchPhrase;\n\t\tthis.#searchPhrase.dropped = '';\n\t\tthis.#showPromptInner(searchPhrase, this.#computePromptDelay());\n\t}\n\n\t/**\n\t * @returns {number}\n\t */\n\t#computePromptDelay(): number\n\t{\n\t\tconst delay = this.#promptDelay > this.#avgKeyUpDelay ? this.#promptDelay : this.#avgKeyUpDelay * 1.5;\n\t\treturn delay > this.#maxPromptDelay ? this.#maxPromptDelay : delay;\n\t}\n\n\tclosePrompt(): void\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\tisPromptShown(): boolean\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.isShown();\n\t\t}\n\t}\n\n\t#showPromptInner(searchPhrase: string, promptDelay: number): void\n\t{\n\t\tif (searchPhrase.length <= this.#minCharsCountToAutocomplete)\n\t\t{\n\t\t\tpromptDelay *= 2;\n\t\t}\n\n\t\tif (this.#timerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#timerId);\n\t\t}\n\n\t\tthis.#timerId = this.#createTimer(searchPhrase, promptDelay);\n\t}\n\n\t/**\n\t * Wait for further user input for some time\n\t * @param {string} searchPhrase\n\t * @param {number} promptDelay\n\t * @returns {number}\n\t */\n\t#createTimer(searchPhrase: string, promptDelay: number): number\n\t{\n\t\treturn setTimeout(() => {\n\t\t\t\t// to avoid multiple parallel requests, server responses are too slow.\n\t\t\t\tif (this.#isAutocompleteRequestStarted)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#timerId);\n\t\t\t\t\tthis.#timerId = this.#createTimer(searchPhrase, promptDelay);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.emit(Autocomplete.#onSearchStartedEvent);\n\t\t\t\tthis.#isAutocompleteRequestStarted = true;\n\t\t\t\tconst params = this.#makeAutocompleteServiceParams();\n\n\t\t\t\tthis.#autocompleteService.autocomplete(searchPhrase, params)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(locationsList: Array<Location>) => {\n\t\t\t\t\t\t\tthis.#timerId = null;\n\t\t\t\t\t\t\tthis.#onPromptsReceived(locationsList, params);\n\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t\tBX.debug(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tpromptDelay\n\t\t);\n\t}\n\n\t#getLastSelectedLocation()\n\t{\n\t\tconst lastSelectedLocation = localStorage.getItem(this.#lastSelectedLocationLocalStorageKey);\n\n\t\tif (lastSelectedLocation)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\treturn LocationJsonConverter.convertJsonToLocation(JSON.parse(lastSelectedLocation));\n\t\t\t}\n\t\t\tcatch(e) {}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#setLastSelectedLocation(location: Location)\n\t{\n\t\tconst jsonLocation = location.toJson();\n\n\t\tlocalStorage.setItem(this.#lastSelectedLocationLocalStorageKey, jsonLocation);\n\t\tBX.userOptions.save('location', 'last_selected_location', null, jsonLocation);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.destroy();\n\t\t\tthis.#prompt = null;\n\t\t}\n\n\t\tthis.#timerId = null;\n\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tthis.#inputNode.removeEventListener('keyup', this.#onInputKeyUp);\n\t\t\tthis.#inputNode.removeEventListener('focus', this.#onInputFocus);\n\t\t\tthis.#inputNode.removeEventListener('focusout', this.#onInputFocusOut);\n\t\t\tthis.#inputNode.removeEventListener('click', this.#onInputClick);\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\t\tthis.#isDestroyed = true;\n\t}\n}","import {Tag} from 'main.core';\nimport {Address, Format, AddressStringConverter, FormatTemplateType} from 'location.core';\n\nexport default class AddressString\n{\n\t#address;\n\t#element;\n\t#stringElement;\n\t#addressFormat;\n\n\tconstructor(props)\n\t{\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (!this.#stringElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stringElement.innerHTML = this.#convertAddressToString(address);\n\n\t\tif (!address && !this.isHidden())\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse if (address && this.isHidden())\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.DEFAULT),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_HTML,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\t\n\trender(props): Element\n\t{\n\t\tthis.#address = props.address;\n\t\tconst addresStr = this.#convertAddressToString(this.#address);\n\t\tthis.#stringElement = Tag.render`<div class=\"location-map-address-text\">${addresStr}</div>`;\n\n\t\tthis.#element = Tag.render`\n\t\t\t<div class=\"location-map-address-container\">\n\t\t\t\t<div class=\"location-map-address-icon\"></div>\n\t\t\t\t${this.#stringElement}\n\t\t\t</div>`;\n\n\t\tif (addresStr === '')\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\n\t\treturn this.#element;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'block';\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#element || this.#element.style.display === 'none';\n\t}\n}","import {Popup as MainPopup} from 'main.popup';\nimport {Dom} from 'main.core';\n\n/**\n * Popup window, which contains map\n */\nexport default class Popup extends MainPopup\n{\n\tgetBindElement()\n\t{\n\t\treturn this.bindElement;\n\t}\n\n\tadjustPosition(bindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t}): void\n\t{\n\t\tlet isCustomPosition, isCustomPositionSuccess;\n\n\t\tif (this.bindOptions.position && this.bindOptions.position === 'right')\n\t\t{\n\t\t\tisCustomPosition = true;\n\t\t\tisCustomPositionSuccess = this.#adjustRightPosition();\n\t\t}\n\n\t\tif (!(isCustomPosition && isCustomPositionSuccess))\n\t\t{\n\t\t\tsuper.adjustPosition(bindOptions);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the popup in right position\n\t * @returns {boolean} an indicator whether or not we have managed to adjust the popup successfully\n\t */\n\t#adjustRightPosition(): boolean\n\t{\n\t\tconst bindElRect = this.bindElement.getBoundingClientRect();\n\t\tconst popupHeight = this.getPopupContainer().offsetHeight;\n\t\tconst popupWidth = this.getPopupContainer().offsetWidth;\n\n\t\t/**\n\t\t * Check if the popup fits in the viewport\n\t\t */\n\t\tif ((bindElRect.left + bindElRect.width + popupWidth) > document.documentElement.clientWidth)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet angleOffsetY = popupHeight / 2;\n\n\t\tconst left = bindElRect.left + bindElRect.width + 10;\n\t\tlet top = window.pageYOffset + bindElRect.top + bindElRect.height / 2 - popupHeight / 2;\n\n\t\tif(top < window.pageYOffset)\n\t\t{\n\t\t\tangleOffsetY -= window.pageYOffset - top;\n\t\t\ttop = window.pageYOffset;\n\t\t}\n\t\telse if(top > window.pageYOffset + document.body.clientHeight - popupHeight)\n\t\t{\n\t\t\tangleOffsetY += top - (window.pageYOffset + document.body.clientHeight - popupHeight);\n\t\t\ttop = window.pageYOffset + document.body.clientHeight - popupHeight;\n\t\t}\n\n\t\tthis.setAngle({position: 'left', offset: angleOffsetY});\n\n\t\tDom.adjust(this.popupContainer, {\n\t\t\tstyle: {\n\t\t\t\ttop: `${top}px`,\n\t\t\t\tleft: `${left}px`,\n\t\t\t\tzIndex: this.getZindex()\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","import {Tag} from 'main.core';\nimport {Address, Format, AddressStringConverter} from 'location.core';\nimport {EventEmitter} from 'main.core.events';\n\n/**\n * Class AddressRestorer\n * It is responsible for the address restoring.\n * If user saved the unrecognized address and then changes the marker position on the map.\n * The address changes.\n * We show the dialog where the user can restore the address entered earlier.\n */\nexport default class AddressRestorer extends EventEmitter\n{\n\tstatic #onRestoreEvent = 'onRestore';\n\n\t/** {Format} */\n\t#addressFormat;\n\t/** {Address} */\n\t#address;\n\t/** {Element} */\n\t#element;\n\t/** {Element} */\n\t#stringElement;\n\t/** {Element} */\n\t#button;\n\n\tconstructor(props)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Location.Widget.MapPopup.AddressRestorer');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t}\n\n\trender(props): Element\n\t{\n\t\tthis.address = props.address;\n\n\t\tthis.#stringElement = Tag.render`\n\t\t\t<div class=\"location-map-address-changed-text\">\n\t\t\t\t${this.#convertAddressToString(this.#address)}\n\t\t\t</div>`;\n\n\t\tthis.#button = Tag.render`\n\t\t\t<button type=\"button\" class=\"location-map-address-changed-btn\">\n\t\t\t\t${BX.message('LOCATION_WIDGET_AUI_ADDRESS_RESTORE')}\n\t\t\t</button>`;\n\n\t\tthis.#button.addEventListener('click', this.#onRestoreButtonClick.bind(this));\n\n\t\tthis.#element = Tag.render`\t\t\t\t\n\t\t\t<div class=\"location-map-address-changed hidden\">\n\t\t\t\t<div class=\"location-map-address-changed-inner\">\n\t\t\t\t\t<div class=\"location-map-address-changed-title\">\n\t\t\t\t\t\t${BX.message('LOCATION_WIDGET_AUI_ADDRESS_CHANGED')}:\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#stringElement}\n\t\t\t\t</div>\n\t\t\t\t${this.#button}\n\t\t\t</div>`;\n\n\t\tthis.#element.style.display = 'none';\n\t\treturn this.#element;\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onRestoreButtonClick(e)\n\t{\n\t\tthis.emit(AddressRestorer.#onRestoreEvent, {address: this.#address});\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.#addressFormat, AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA);\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\t// Not rendered yet\n\t\tif (!this.#stringElement || !this.#address)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stringElement.innerHTML = this.#convertAddressToString(this.#address);\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#element && this.#address && this.isHidden())\n\t\t{\n\t\t\tthis.#element.style.display = 'flex';\n\t\t\tthis.#element.classList.remove('hidden');\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (this.#element && !this.isHidden())\n\t\t{\n\t\t\tthis.#element.classList.add('hidden');\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.#element.style.display = 'none';\n\t\t\t}, 600);\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\tlet result = false;\n\n\t\tif (this.#element)\n\t\t{\n\t\t\tresult = this.#element.classList.contains('hidden');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonRestoreEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(AddressRestorer.#onRestoreEvent, listener);\n\t}\n}","import {Tag, Type, Dom, Event} from 'main.core';\nimport {\n\tAddress, Format, Location, ControlMode, MapBase, GeocodingServiceBase, AddressStringConverter\n} from 'location.core';\nimport {EventEmitter} from 'main.core.events';\nimport AddressString from './addressstring';\nimport './css/mappopup.css';\nimport Popup from './popup';\nimport AddressRestorer from './addressrestorer';\n\nexport default class MapPopup extends EventEmitter\n{\n\tstatic #onChangedEvent = 'onChanged';\n\tstatic #onMouseOverEvent = 'onMouseOver';\n\tstatic #onMouseOutEvent = 'onMouseOut';\n\tstatic #onShowedEvent = 'onShow';\n\tstatic #onClosedEvent = 'onClose';\n\n\t#map;\n\t#mode;\n\t#address;\n\t#popup;\n\t#addressString;\n\t#addressRestorer;\n\t#addressFormat;\n\t#gallery;\n\t#locationRepository;\n\t#isMapRendered = false;\n\t#mapInnerContainer;\n\t#geocodingService;\n\t#contentWrapper;\n\t#needRestore = false;\n\t#userLocation;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.MapPopup');\n\n\t\tif (!(props.map instanceof MapBase))\n\t\t{\n\t\t\tBX.debug('map must be instance of Map');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tif (props.geocodingService instanceof GeocodingServiceBase)\n\t\t{\n\t\t\tthis.#geocodingService = props.geocodingService;\n\t\t}\n\n\t\tthis.#map.onLocationChangedEventSubscribe(this.#onLocationChanged.bind(this));\n\n\t\tif (!(props.popup instanceof Popup))\n\t\t{\n\t\t\tBX.debug('popup must be instance of Popup');\n\t\t}\n\n\t\tthis.#popup = props.popup;\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tthis.#addressString = new AddressString({\n\t\t\taddressFormat: this.#addressFormat\n\t\t});\n\n\t\tthis.#addressRestorer = new AddressRestorer({\n\t\t\taddressFormat: this.#addressFormat\n\t\t});\n\n\t\tthis.#addressRestorer.onRestoreEventSubscribe(this.#onAddressRestore.bind(this));\n\n\t\tif (props.gallery)\n\t\t{\n\t\t\tthis.#gallery = props.gallery;\n\t\t}\n\n\t\tthis.#locationRepository = props.locationRepository;\n\t\tthis.#userLocation = props.userLocation;\n\t}\n\n\t#onLocationChanged(event: Event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst location = data.location;\n\t\tconst address = location.toAddress();\n\n\t\tthis.#address = address;\n\t\tthis.#addressString.address = address;\n\n\t\tif (this.#needRestore)\n\t\t{\n\t\t\tif (this.#addressRestorer.isHidden())\n\t\t\t{\n\t\t\t\tthis.#addressRestorer.show();\n\t\t\t}\n\t\t}\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\n\t\tthis.emit(\n\t\t\tMapPopup.#onChangedEvent,\n\t\t\t{address: address}\n\t\t);\n\t}\n\n\t#onAddressRestore(event: Event)\n\t{\n\t\tconst data = event.getData();\n\t\t\tconst prevAddress = data.address;\n\n\t\tprevAddress.latitude = this.#address.latitude;\n\t\tprevAddress.longitude = this.#address.longitude;\n\n\t\tthis.#address = prevAddress;\n\t\tthis.#addressString.address = prevAddress;\n\n\t\tthis.#addressRestorer.hide();\n\n\t\tthis.emit(\n\t\t\tMapPopup.#onChangedEvent,\n\t\t\t{address: prevAddress}\n\t\t);\n\t}\n\n\trender(props: object): void\n\t{\n\t\tthis.#address = props.address;\n\t\tthis.#needRestore = true;\n\t\tthis.#mode = props.mode;\n\t\tthis.#isMapRendered = false;\n\t\tthis.#mapInnerContainer = Tag.render`<div class=\"location-map-inner\"></div>`;\n\t\tthis.#renderPopup(props.bindElement, this.#mapInnerContainer);\n\t}\n\n\t#renderPopup(bindElement: Element, mapInnerContainer: Element): Popup\n\t{\n\t\tlet gallery = '';\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tgallery = this.#gallery.render();\n\t\t}\n\n\t\tthis.#contentWrapper = Tag.render`\n\t\t\t<div class=\"location-map-wrapper\">\n\t\t\t\t<div class=\"location-map-container\">\n\t\t\t\t\t${mapInnerContainer}\n\t\t\t\t\t${gallery}\n\t\t\t\t</div>\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressString.render({address: this.#address}) : ''}\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressRestorer.render({address: this.#address}) : ''}\n\t\t\t</div>`;\n\n\t\tEvent.bind(this.#contentWrapper, 'click', (e) => e.stopPropagation());\n\t\tEvent.bind(this.#contentWrapper, 'mouseover', (e) => this.emit(MapPopup.#onMouseOverEvent, e));\n\t\tEvent.bind(this.#contentWrapper, 'mouseout', (e) => this.emit(MapPopup.#onMouseOutEvent, e));\n\t\tthis.bindElement = bindElement;\n\t\tthis.#popup.setContent(this.#contentWrapper);\n\t}\n\n\tget bindElement()\n\t{\n\t\treturn this.#popup.getBindElement();\n\t}\n\n\tset bindElement(bindElement: Element)\n\t{\n\t\tif (Type.isDomNode(bindElement))\n\t\t{\n\t\t\tthis.#popup.setBindElement(bindElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('bindElement must be type of dom node');\n\t\t}\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\t\tthis.#needRestore = true;\n\t\tthis.#addressString.address = address;\n\t\tthis.#addressRestorer.address = address;\n\n\t\tthis.#convertAddressToLocation(address)\n\t\t\t.then((location) => {\n\t\t\t\tthis.#setLocationInternal(location);\n\t\t\t});\n\t}\n\n\t#extractLatLon(address: Address): ?Array\n\t{\n\t\tlet result = null;\n\t\tlet lat;\n\t\tlet lon;\n\n\t\tif (address.latitude && address.longitude)\n\t\t{\n\t\t\tlat = address.latitude;\n\t\t\tlon = address.longitude;\n\t\t}\n\t\telse if (address.location\n\t\t\t&& address.location.latitude\n\t\t\t&& address.location.longitude\n\t\t)\n\t\t{\n\t\t\tlat = address.location.latitude;\n\t\t\tlon = address.location.longitude;\n\t\t}\n\n\t\tif (lat && lat !== '0' && lon && lon !== '0')\n\t\t{\n\t\t\tresult = [lat, lon];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#convertAddressToLocation(address: ?Address, useUserLocation: boolean = false): Promise<?Location>\n\t{\n\t\treturn new Promise((resolve) => {\n\n\t\t\tlet location = null;\n\n\t\t\tif (useUserLocation)\n\t\t\t{\n\t\t\t\tlocation = this.#userLocation && this.#mode !== ControlMode.view ? this.#userLocation : null;\n\t\t\t}\n\n\t\t\tif (address)\n\t\t\t{\n\t\t\t\tconst latLon = this.#extractLatLon(address);\n\n\t\t\t\tif (latLon)\n\t\t\t\t{\n\t\t\t\t\tresolve(new Location({\n\t\t\t\t\t\tlatitude: latLon[0],\n\t\t\t\t\t\tlongitude: latLon[1],\n\t\t\t\t\t\ttype: address.getType()\n\t\t\t\t\t}));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Try to find via geocoding by string name\n\t\t\t\tif (this.#geocodingService)\n\t\t\t\t{\n\t\t\t\t\tconst addressStr = address.toString(\n\t\t\t\t\t\tthis.#addressFormat,\n\t\t\t\t\t\tAddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,\n\t\t\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.#geocodingService.geocode(addressStr)\n\t\t\t\t\t\t.then((locationsList: ?Array) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// If we have found just one location - we probably have found the right one.\n\t\t\t\t\t\t\tif (Array.isArray(locationsList) && locationsList.length === 1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlocation = locationsList[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// geocoded or user's location\n\t\t\t\t\t\t\tresolve(location);\n\t\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(location);\n\t\t});\n\t}\n\n\t#setLocationInternal(location: ?Location): void\n\t{\n\t\tthis.#map.location = location;\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#map.mode = mode;\n\t}\n\n\t#renderMap({location})\n\t{\n\t\treturn this.#map.render({\n\t\t\tmapContainer: this.#mapInnerContainer,\n\t\t\tlocation: location,\n\t\t\tmode: this.#mode\n\t\t});\n\t}\n\n\tshow(useUserLocation: boolean = false): void\n\t{\n\t\tthis.#convertAddressToLocation(this.#address, useUserLocation)\n\t\t\t.then((location) => {\n\t\t\t\tif (!location)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#popup.show();\n\n\t\t\t\tif (!this.#isMapRendered)\n\t\t\t\t{\n\t\t\t\t\tthis.#renderMap({location})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.#isMapRendered = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#map.location = location;\n\n\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup.close();\n\n\t\tthis.#needRestore = false;\n\n\t\tif (!this.#addressRestorer.isHidden())\n\t\t{\n\t\t\tthis.#addressRestorer.hide();\n\t\t}\n\n\t\tthis.emit(MapPopup.#onClosedEvent);\n\t}\n\n\tonChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onChangedEvent, listener);\n\t}\n\n\tonMouseOverSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOverEvent, listener);\n\t}\n\n\tonMouseOutSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOutEvent, listener);\n\t}\n\n\tsubscribeOnShowedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onShowedEvent, listener);\n\t}\n\n\tsubscribeOnClosedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onClosedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#map = null;\n\t\tthis.#gallery = null;\n\t\tthis.#addressString = null;\n\t\tthis.#addressRestorer = null;\n\n\t\tthis.#popup.destroy();\n\t\tthis.#popup = null;\n\t\tDom.remove(this.#contentWrapper);\n\t\tthis.#contentWrapper = null;\n\t\tEvent.unbindAll(this);\n\t}\n}\n","import {Tag} from \"main.core\";\n\nexport default class Photo\n{\n\t#description;\n\t#url;\n\t#link;\n\t#location;\n\t#title;\n\n\tconstructor(props)\n\t{\n\t\tthis.#url = props.url;\n\t\tthis.#link = props.link || '';\n\t\tthis.#description = props.description || '';\n\t\tthis.#location = props.location;\n\t\tthis.#title = props.title || '';\n\t}\n\n\trender()\n\t{\n\t\tlet description = '';\n\n\t\tif(this.#description)\n\t\t{\n\t\t\t//todo: sanitize\n\t\t\tdescription = Tag.render`<span class=\"location-map-item-description\">${this.#description}</span>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"location-map-photo-item-block\">\n\t\t\t\t<span class=\"location-map-photo-item-block-image-block-inner\">\n\t\t\t\t\t${description}\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type=\"image\" \n\t\t\t\t\t\tdata-src=\"${this.#link}\" \n\t\t\t\t\t\tdata-title=\"${this.#title}\"\n\t\t\t\t\t\tclass=\"location-map-item-photo-image\" \n\t\t\t\t\t\tdata-viewer-group-by=\"${this.#location.externalId}\"\n\t\t\t\t\t\tstyle=\"background-image: url(${this.#url});\">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n}","import {Tag, Dom} from \"main.core\";\nimport Photo from \"./photo\";\n\nexport default class Gallery\n{\n\t#photos = [];\n\t#container = null;\n\t#photosContainer = null;\n\t#thumbnailHeight;\n\t#thumbnailWidth;\n\t#photoService;\n\t#maxPhotoCount;\n\t#location;\n\n\tconstructor(props)\n\t{\n\t\tthis.#thumbnailHeight = props.thumbnailHeight;\n\t\tthis.#thumbnailWidth = props.thumbnailWidth;\n\t\tthis.#maxPhotoCount = props.maxPhotoCount;\n\t\tthis.#photoService = props.photoService;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.#location)\n\t\t{\n\t\t\tthis.#photoService.requestPhotos({\t\t\t\t\n\t\t\t\tlocation: this.#location,\n\t\t\t\tthumbnailHeight: this.#thumbnailHeight,\n\t\t\t\tthumbnailWidth: this.#thumbnailWidth,\n\t\t\t\tmaxPhotoCount: this.#maxPhotoCount\n\t\t\t\t\n\t\t\t})\n\t\t\t.then((photosData) => {\n\t\t\t\tif(Array.isArray(photosData) && photosData.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#setPhotos(photosData);\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tset location(location: Location)\n\t{\n\t\tthis.#location = location;\n\t\tthis.refresh();\n\t}\n\n\t#setPhotos(photosData)\n\t{\n\t\tif(!this.#location)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet photos = [];\n\n\t\tfor(let photo of photosData)\n\t\t{\n\t\t\tphotos.push(\n\t\t\t\tnew Photo({\n\t\t\t\t\turl: photo.thumbnail.url,\n\t\t\t\t\tlink: photo.url,\n\t\t\t\t\tlocation: this.#location,\n\t\t\t\t\ttitle: this.#location.name + \" ( \" + BX.util.strip_tags(photo.description) + ' )'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif(!Array.isArray(photos))\n\t\t{\n\t\t\tBX.debug('Wrong type of photos. Must be array');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#photos = [];\n\n\t\tfor(let photo of photos)\n\t\t{\n\t\t\tthis.#photos.push(photo);\n\t\t}\n\n\t\tif(this.#photos.length > 0 && this.#photosContainer)\n\t\t{\n\t\t\tlet renderedPhotos = this.#photos ? this.#renderPhotos(this.#photos) : '';\n\n\t\t\tthis.#photosContainer.innerHTML = '';\n\n\t\t\tif(renderedPhotos.length > 0)\n\t\t\t{\n\t\t\t\tfor (let photo of renderedPhotos)\n\t\t\t\t{\n\t\t\t\t\tthis.#photosContainer.appendChild(photo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#container || this.#container.clientWidth <= 0;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'block';\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tthis.#photosContainer = Tag.render`\t\t\t\t\t\n\t\t\t\t<div class=\"location-map-photo-inner\">\t\t\t\t\t\n\t\t\t\t</div>`;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"location-map-photo-container\">\n\t\t\t\t${this.#photosContainer}\n\t\t\t</div>`;\n\n\t\treturn this.#container;\n\t}\n\n\t#renderPhotos(photos)\n\t{\n\t\tlet result = [];\n\n\t\tfor (let photo of photos)\n\t\t{\n\t\t\tresult.push(photo.render());\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Tag, Event, Dom, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.forms';\nimport {ControlMode} from 'location.core';\nimport State from '../state';\n\nexport default class Field extends EventEmitter\n{\n\tstatic #onValueChangedEvent = 'onValueChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#title;\n\t#value;\n\t#type;\n\t#sort;\n\t#mode;\n\t#input;\n\t#viewContainer;\n\t#container = null;\n\t#state = State.INITIAL;\n\n\tconstructor(props: FieldConstructorProps)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Field');\n\n\t\tthis.#title = props.title;\n\t\tthis.#type = props.type;\n\t\tthis.#sort = props.sort;\n\t}\n\n\tget container()\n\t{\n\t\treturn this.#container;\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Field.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\trender(props: FieldRenderProps): void\n\t{\n\t\tthis.#value = typeof props.value === 'string' ? props.value : '';\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${this.#title}:</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#renderEditMode(this.#container)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderViewMode(this.#container)\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\t#renderEditMode(container: Element)\n\t{\n\t\tthis.#input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" value=\"${Text.encode(this.#value)}\">`;\n\t\tthis.#viewContainer = null;\n\n\t\tEvent.bind(this.#input, 'focus', (e) => {\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'focusout', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'change', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\tthis.#value = this.#input.value;\n\t\t\tthis.emit(Field.#onValueChangedEvent, {value: this});\n\t\t});\n\n\t\tcontainer.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${this.#input}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\t}\n\n\t#renderViewMode(container: Element)\n\t{\n\t\tthis.#input = null;\n\n\t\tthis.#viewContainer = Tag.render`\n\t\t\t<div class=\"ui-title-6\">\n\t\t\t\t${Text.encode(this.#value)}\n\t\t\t</div>`;\n\n\t\tcontainer.appendChild(this.#viewContainer);\n\t}\n\n\t#refreshLayout()\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#input.value = this.#value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#viewContainer.innerHTML = Text.encode(this.#value);\n\t\t}\n\t}\n\n\tset type(type: number)\n\t{\n\t\tthis.#type = type;\n\t}\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset sort(sort: number)\n\t{\n\t\tthis.#sort = sort;\n\t}\n\n\tget sort(): number\n\t{\n\t\treturn this.#sort;\n\t}\n\n\tset value(value: string)\n\t{\n\t\tthis.#value = typeof value === 'string' ? value : '';\n\t\tthis.#refreshLayout();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tsubscribeOnValueChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onValueChangedEvent, listener);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onStateChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#container);\n\t\tEvent.unbindAll(this);\n\t\tthis.#container = null;\n\t}\n}\n\ntype FieldConstructorProps = {\n\ttitle: string\n}\n\ntype FieldRenderProps = {\n\tvalue: string,\n\tmode: string //ControlMode\n}","import {Event, Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Format, Address, ControlMode} from 'location.core';\nimport Field from './field';\n\nexport type FieldsConstructorType = {\n\taddressFormat: Format\n}\n\nexport type FieldsRenderType = {\n\taddress: Address,\n\tmode: string, // ControlMode\n\tcontainer: Element\n}\n\nexport default class Fields extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#address;\n\t#addressFormat;\n\t#mode;\n\t#fields = [];\n\t#languageId;\n\t#container;\n\t#state;\n\n\tconstructor(props: FieldsConstructorType)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Fields');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#initFields();\n\t}\n\n\t#initFields()\n\t{\n\t\tfor (let type in this.#addressFormat.fieldCollection.fields)\n\t\t{\n\t\t\tif(!this.#addressFormat.fieldCollection.fields.hasOwnProperty(type))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet formatField = this.#addressFormat.fieldCollection.fields[type];\n\n\t\t\tlet field = new Field({\n\t\t\t\ttitle: formatField.name,\n\t\t\t\ttype: formatField.type,\n\t\t\t\tsort: formatField.sort\n\t\t\t});\n\n\t\t\tfield.subscribeOnValueChangedEvent((event) => {\n\t\t\t\tthis.#onFieldChanged(field);\n\t\t\t});\n\n\t\t\tfield.subscribeOnStateChangedEvent((event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#setState(data.state);\n\t\t\t});\n\n\t\t\tthis.#fields.push(field)\n\t\t}\n\n\t\tthis.#fields.sort((a, b) => {\n\t\t\treturn a.sort - b.sort;\n\t\t});\n\t}\n\n\trender(props: FieldsRenderType): void\n\t{\n\t\tif(props.address && !(props.address instanceof Address))\n\t\t{\n\t\t\tBX.debug('props.address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address;\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif(!Type.isDomNode(props.container))\n\t\t{\n\t\t\tBX.debug('props.container must be dom node');\n\t\t}\n\n\t\tthis.#container = props.container;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tlet value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\n\t\t\tif(this.#mode === ControlMode.view && !value)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet item = field.render({\n\t\t\t\tvalue: value,\n\t\t\t\tmode: this.#mode\n\t\t\t});\n\n\t\t\tthis.#container.appendChild(item);\n\t\t}\n\t}\n\n\t#onFieldChanged(field: Field)\n\t{\n\t\tif(!this.#address)\n\t\t{\n\t\t\tthis.#address = new Address({\n\t\t\t\tlanguageId: this.#languageId\n\t\t\t});\n\t\t}\n\n\t\tthis.#address.setFieldValue(field.type, field.value);\n\n\t\tif(field.type !== this.#addressFormat.fieldForUnRecognized)\n\t\t{\n\t\t\tthis.#address.location = null;\n\t\t\tthis.#address.latitude = '';\n\t\t\tthis.#address.longitude = '';\n\t\t}\n\n\t\tthis.emit(Fields.#onAddressChangedEvent, {\n\t\t\taddress: this.#address,\n\t\t\tchangedField: field\n\t\t});\n\t}\n\n\tset address(address: ?Address)\n\t{\n\t\tif(address && !(address instanceof Address))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\t\t}\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onAddressChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbindAll(this);\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.destroy();\n\t\t}\n\n\t\tDom.clean(this.#container);\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Fields.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onStateChangedEvent, listener);\n\t}\n}","import {Type} from 'main.core';\nimport {Address} from 'location.core';\nimport MapPopup from '../../mappopup/mappopup';\nimport BaseFeature from './basefeature';\nimport State from '../../state';\n\n/**\n * Complex address widget\n */\nexport default class MapFeature extends BaseFeature\n{\n\t#map = null;\n\n\t#mapBindElement = null;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper();\n\n\t\tif(!(props.map instanceof MapPopup))\n\t\t{\n\t\t\tBX.debug('props.map must be instance of MapPopup');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tthis.#map.onChangedEventSubscribe(\n\t\t\t(event) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\t}\n\n\tshowMap(useUserLocation: boolean = false): void\n\t{\n\t\tif(!this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.show(useUserLocation);\n\t\t}\n\t}\n\n\tcloseMap(): void\n\t{\n\t\tif(this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.close();\n\t\t}\n\n\t\tthis.#map.bindelement = this.#mapBindElement;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.closeMap();\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {Object} props\n\t */\n\trender(props: {}): void\n\t{\n\t\tif(!Type.isDomNode(props.mapBindElement))\n\t\t{\n\t\t\tBX.debug('props.mapBindElement  must be instance of Element');\n\t\t}\n\n\t\tthis.#mapBindElement = props.mapBindElement;\n\n\t\tthis.#map.render({\n\t\t\tbindElement: props.mapBindElement,\n\t\t\taddress: this.#addressWidget.address,\n\t\t\tmode: this.#addressWidget.mode,\n\t\t});\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif(this.addressWidget.state === State.DATA_INPUTTING)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#map.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#map.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#map.destroy();\n\t\tthis.#map = null;\n\t}\n\n\tget map(): MapPopup\n\t{\n\t\treturn this.#map;\n\t}\n\n\tget addressWidget(): Address\n\t{\n\t\treturn this.#addressWidget;\n\t}\n\n\tget mapBindElement(): Element\n\t{\n\t\treturn this.#mapBindElement;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Autocomplete from '../../autocomplete/autocomplete';\n\n/**\n * Complex address widget\n */\nexport default class AutocompleteFeature extends BaseFeature\n{\n\tstatic searchStartedEvent = 'searchStarted';\n\tstatic searchCompletedEvent = 'searchCompleted';\n\tstatic showOnMapClickedEvent = 'showOnMapClicked';\n\n\t#autocomplete;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper();\n\n\t\tif(!(props.autocomplete instanceof Autocomplete))\n\t\t{\n\t\t\tBX.debug('props.autocomplete  must be instance of Autocomplete');\n\t\t}\n\n\t\tthis.#autocomplete = props.autocomplete;\n\n\t\tthis.#autocomplete.onAddressChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this, data.excludeSetAddressFeatures);\n\t\t\t});\n\n\t\tthis.#autocomplete.onStateChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchStartedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchStartedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchCompletedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchCompletedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onShowOnMapClickedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.showOnMapClickedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#autocomplete.closePrompt();\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#autocomplete.render({\n\t\t\t\tinputNode: this.#addressWidget.inputNode,\n\t\t\t\tmenuNode: props.autocompleteMenuElement,\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tthis.#autocomplete.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#autocomplete.destroy();\n\t\tthis.#autocomplete = null;\n\t}\n}","import {Type} from 'main.core';\nimport {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Fields from '../../fields/fields';\n\n/**\n * Fields widget feature\n */\nexport default class FieldsFeature extends BaseFeature\n{\n\t#fields;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.fields instanceof Fields))\n\t\t{\n\t\t\tBX.debug('props.Fields must be instance of Fields');\n\t\t}\n\n\t\tthis.#fields = props.fields;\n\n\t\tthis.#fields.subscribeOnAddressChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\n\t\tthis.#fields.subscribeOnStateChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.fieldsContainer))\n\t\t\t{\n\t\t\t\tBX.debug('props.fieldsContainer  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#fields.render({\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t\tcontainer: props.fieldsContainer\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthis.#fields.address = address;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#fields.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#fields.destroy();\n\t\tthis.#fields = null;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport State from '../../state';\nimport MapFeature from './mapfeature';\n\n/**\n * Map feature for the address widget with auto map opening / closing behavior\n */\nexport default class MapFeatureAuto extends MapFeature\n{\n\t#showMapTimerId = null;\n\t#showMapDelay = 700;\n\t#closeMapTimerId = null;\n\t#closeMapDelay = 800;\n\n\t#isDestroyed = false;\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tsuper.render(props);\n\n\t\tthis.addressWidget.controlWrapper.addEventListener('click', this.#onControlWrapperClick.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseover', this.#processOnMouseOver.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseout', this.#processOnMouseOut.bind(this));\n\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\n\t\tthis.map.onMouseOverSubscribe(this.#processOnMouseOver.bind(this));\n\t\tthis.map.onMouseOutSubscribe(this.#processOnMouseOut.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onControlWrapperClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view)\n\t\t{\n\t\t\tif (this.map.isShown())\n\t\t\t{\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearTimeout(this.#showMapTimerId);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onDocumentClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.inputNode !== event.target)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\t}\n\n\t#processOnMouseOver()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.address && !this.map.isShown())\n\t\t{\n\t\t\tthis.#showMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.showMap();\n\t\t\t\t},\n\t\t\t\tthis.#showMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\t#processOnMouseOut()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view && this.map.isShown())\n\t\t{\n\t\t\tthis.#closeMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.closeMap();\n\t\t\t\t},\n\t\t\t\tthis.#closeMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\n\t\tthis.map.address = address;\n\n\t\tif (address && this.addressWidget.state !== State.DATA_SUPPOSED)\n\t\t{\n\t\t\tthis.showMap();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\n\t\tif (this.addressWidget.controlWrapper)\n\t\t{\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('click', this.#onControlWrapperClick);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseover', this.#processOnMouseOver);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseout', this.#processOnMouseOut);\n\t\t}\n\n\t\tthis.#showMapTimerId = null;\n\t\tthis.#closeMapTimerId = null;\n\n\t\tsuper.destroy();\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {BaseSource, LocationRepository, SourceCreationError, Format, Location} from 'location.core';\n\nimport {OSMFactory} from 'location.osm';\n\nimport {Google} from 'location.google';\n\nimport Address from './address/address';\nimport Autocomplete from './autocomplete/autocomplete';\n\nimport MapPopup from './mappopup/mappopup';\nimport Gallery from './mappopup/gallery';\nimport Popup from './mappopup/popup';\nimport Fields from './fields/fields';\n\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\nimport MapFeatureAuto from './address/features/mapfeatureauto';\n\n/**\n * Props type for the main fabric method\n */\nexport type FactoryCreateAddressWidgetProps = {\n\t// Initial Address\n\taddress?: Address,\n\t// Initial widget mode\n\tmode: 'edit' | 'view',\n\n\t// optional\n\tlanguageId?: string,\n\taddressFormat?: Format,\n\tsourceCode?: string,\n\tsourceParams?: {},\n\n\t// Witch features will be used?\n\tuseFeatures?: {\n\t\tfields?: boolean, \t\t// default true\n\t\tmap?: boolean, \t\t\t// default true\n\t\tautocomplete?: boolean\t// default true\n\t},\n\n\t// Useful for the using with map feature only\n\t// Address photo height if photo exists\n\tthumbnailHeight: number,\n\t// Address photo width if photo exists\n\tthumbnailWidth: number,\n\t// Max photo thumbnails count\n\tmaxPhotoCount: number,\n\t/*\n\t * auto - open / close map feature depends on user's input\n\t * manual - allow to control open / close map\n\t */\n\tmapBehavior: 'auto' | 'manual',\n\tpopupOptions?: {},\n\tpopupBindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t},\n\tpresetLocationsProvider?: Function,\n\tpresetLocationList?: []\n};\n\n/**\n * Factory class with a set of tools for the address widget creation\n */\nexport default class Factory\n{\n\t/**\n\t * Main factory method\n\t * @param {FactoryCreateAddressWidgetProps} props\n\t * @returns {Address}\n\t */\n\tcreateAddressWidget(props: FactoryCreateAddressWidgetProps): Address\n\t{\n\t\tconst sourceCode = props.sourceCode || BX.message('LOCATION_WIDGET_SOURCE_CODE');\n\t\tconst sourceParams = props.sourceParams || BX.message('LOCATION_WIDGET_SOURCE_PARAMS');\n\t\tconst languageId = props.languageId || BX.message('LOCATION_WIDGET_LANGUAGE_ID');\n\t\tconst sourceLanguageId = props.sourceLanguageId || BX.message('LOCATION_WIDGET_SOURCE_LANGUAGE_ID');\n\t\tconst userLocation = new Location(JSON.parse(BX.message('LOCATION_WIDGET_USER_LOCATION')));\n\n\t\tconst addressFormat = props.addressFormat || new Format(\n\t\t\tJSON.parse(\n\t\t\t\tBX.message('LOCATION_WIDGET_DEFAULT_FORMAT')\n\t\t\t));\n\n\t\tconst presetLocationsProvider = props.presetLocationsProvider\n\t\t\t? props.presetLocationsProvider\n\t\t\t: () => {\n\t\t\t\treturn props.presetLocationList ? props.presetLocationList : [];\n\t\t\t};\n\n\t\tconst features = [];\n\n\t\tif(!props.useFeatures || props.useFeatures.fields !== false)\n\t\t{\n\t\t\tfeatures.push(\n\t\t\t\tthis.createFieldsFeature({addressFormat, languageId})\n\t\t\t);\n\t\t}\n\n\t\tlet source = null;\n\n\t\tif(sourceCode && sourceParams)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tsource = this.createSource(sourceCode, sourceParams, languageId, sourceLanguageId);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif(e instanceof SourceCreationError)\n\t\t\t\t{\n\t\t\t\t\tsource = null;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet mapFeature = null;\n\t\tif(source)\n\t\t{\n\t\t\tif(!props.useFeatures || props.useFeatures.autocomplete !== false)\n\t\t\t{\n\t\t\t\tfeatures.push(\n\t\t\t\t\tthis.createAutocompleteFeature({\n\t\t\t\t\t\tlanguageId,\n\t\t\t\t\t\taddressFormat,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tuserLocation: userLocation,\n\t\t\t\t\t\tpresetLocationsProvider\n\t\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif(!props.useFeatures || props.useFeatures.map !== false)\n\t\t\t{\n\t\t\t\tconst showPhotos = !!sourceParams.showPhotos;\n\t\t\t\tconst useGeocodingService = !!sourceParams.useGeocodingService;\n\t\t\t\tconst DEFAULT_THUMBNAIL_HEIGHT = 80;\n\t\t\t\tconst DEFAULT_THUMBNAIL_WIDTH = 150;\n\t\t\t\tconst DEFAULT_MAX_PHOTO_COUNT = showPhotos ? 5 : 0;\n\t\t\t\tconst DEFAULT_MAP_BEHAVIOR = 'auto';\n\n\t\t\t\tmapFeature = this.createMapFeature({\n\t\t\t\t\taddressFormat,\n\t\t\t\t\tsource,\n\t\t\t\t\tuseGeocodingService,\n\t\t\t\t\tpopupOptions: props.popupOptions,\n\t\t\t\t\tpopupBindOptions: props.popupBindOptions,\n\t\t\t\t\tthumbnailHeight: props.thumbnailHeight || DEFAULT_THUMBNAIL_HEIGHT,\n\t\t\t\t\tthumbnailWidth: props.thumbnailWidth || DEFAULT_THUMBNAIL_WIDTH,\n\t\t\t\t\tmaxPhotoCount: props.maxPhotoCount || DEFAULT_MAX_PHOTO_COUNT,\n\t\t\t\t\tmapBehavior: props.mapBehavior || DEFAULT_MAP_BEHAVIOR,\n\t\t\t\t\tuserLocation: userLocation\n\t\t\t\t});\n\n\t\t\t\tfeatures.push(mapFeature);\n\t\t\t}\n\t\t}\n\n\t\tconst widget = new Address({\n\t\t\tfeatures,\n\t\t\taddress: props.address,\n\t\t\tmode: props.mode,\n\t\t\taddressFormat,\n\t\t\tlanguageId,\n\t\t});\n\n\t\tif(mapFeature)\n\t\t{\n\t\t\twidget.subscribeOnFeatureEvent((event) => {\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tif(data.feature instanceof AutocompleteFeature\n\t\t\t\t\t&& data.eventCode === AutocompleteFeature.showOnMapClickedEvent\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tmapFeature.showMap(true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn widget;\n\t}\n\n\tcreateFieldsFeature(props: {}): FieldsFeature\n\t{\n\t\tconst fields = new Fields({\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tlanguageId: props.languageId,\n\t\t});\n\n\t\treturn new FieldsFeature({\n\t\t\tfields\n\t\t});\n\t}\n\n\tcreateAutocompleteFeature(props: {}): AutocompleteFeature\n\t{\n\t\tconst autocomplete = new Autocomplete({\n\t\t\tsourceCode: props.source.sourceCode,\n\t\t\tlanguageId: props.languageId,\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tautocompleteService: props.source.autocompleteService,\n\t\t\tuserLocation: props.userLocation,\n\t\t\tpresetLocationsProvider: props.presetLocationsProvider,\n\t\t});\n\n\t\treturn new AutocompleteFeature({\n\t\t\tautocomplete\n\t\t});\n\t}\n\n\tcreateMapFeature(props: {}): MapFeature\n\t{\n\t\tlet popupOptions = {\n\t\t\tcacheable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: `location-popup-window location-source-${props.source.sourceCode}`,\n\t\t\tanimation: 'fading',\n\t\t\tangle: true,\n\t\t\tbindOptions: props.popupBindOptions\n\t\t};\n\t\tif(props.popupOptions)\n\t\t{\n\t\t\tpopupOptions = Object.assign(popupOptions, props.popupOptions);\n\t\t}\n\t\tconst popup = new Popup(popupOptions);\n\n\t\tlet gallery = null;\n\n\t\tif(props.maxPhotoCount > 0)\n\t\t{\n\t\t\tgallery = new Gallery({\n\t\t\t\tphotoService: props.source.photoService,\n\t\t\t\tthumbnailHeight: props.thumbnailHeight,\n\t\t\t\tthumbnailWidth: props.thumbnailWidth,\n\t\t\t\tmaxPhotoCount: props.maxPhotoCount\n\t\t\t});\n\t\t}\n\n\t\tconst mapFeatureProps = {\n\t\t\tmap: new MapPopup({\n\t\t\t\taddressFormat: props.addressFormat,\n\t\t\t\tmap: props.source.map,\n\t\t\t\tpopup: popup,\n\t\t\t\tgallery: gallery,\n\t\t\t\tlocationRepository: new LocationRepository(),\n\t\t\t\tgeocodingService: props.useGeocodingService ? props.source.geocodingService : null,\n\t\t\t\tuserLocation: props.userLocation\n\t\t\t})\n\t\t};\n\n\t\tlet result;\n\n\t\tif(props.mapBehavior === 'manual')\n\t\t{\n\t\t\tresult = new MapFeature(mapFeatureProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new MapFeatureAuto(mapFeatureProps);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// todo: add custom sources\n\tcreateSource(code: string, params: {}, languageId: string, sourceLanguageId: string): BaseSource\n\t{\n\t\tlet source = null;\n\n\t\tparams.languageId = languageId;\n\t\tparams.sourceLanguageId = sourceLanguageId;\n\n\t\tif(code === 'GOOGLE')\n\t\t{\n\t\t\tsource = new Google(params);\n\t\t}\n\t\telse if(code === 'OSM')\n\t\t{\n\t\t\tsource = OSMFactory.createOSMSource(params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new RangeError('Wrong source code');\n\t\t}\n\n\t\treturn source;\n\t}\n}","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Switch extends EventEmitter\n{\n\tstatic STATE_OFF = 0;\n\tstatic STATE_ON = 1;\n\n\tstatic #onToggleEvent = \"onToggleEvent\";\n\n\t#state;\n\t#titleContainer;\n\t#titles = ['on', 'off'];\n\n\tconstructor(props = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Switch');\n\t\tthis.#state = props.state;\n\t\tthis.#titles = props.titles;\n\t}\n\n\tset state(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tif(this.#titleContainer)\n\t\t{\n\t\t\tthis.#titleContainer.innerHTML = this.#getTitle();\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#getTitle()\n\t{\n\t\treturn this.#titles[this.#state];\n\t}\n\n\trender(mode: number)\n\t{\n\t\tthis.#titleContainer = Tag.render`\t\t\t\n\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\">\n\t\t\t\t${this.#getTitle()}\n\t\t\t</span>`;\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tthis.state = this.#state === Switch.STATE_OFF ? Switch.STATE_ON : Switch.STATE_OFF;\n\t\t\t\tthis.emit(Switch.#onToggleEvent, {state: this.#state});\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t);\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'mouseover',\n\t\t\t(event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t);\n\n\t\treturn this.#titleContainer;\n\t}\n\n\tsubscribeOnToggleEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Switch.#onToggleEvent, listener);\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Icon extends EventEmitter\n{\n\tstatic #onClickEvent = 'onClick';\n\n\tstatic TYPE_CLEAR = 'clear';\n\tstatic TYPE_SEARCH = 'search';\n\tstatic TYPE_LOADER = 'loader';\n\n\t#type = Icon.TYPE_SEARCH;\n\t#domNode;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Icon');\n\t}\n\n\tset type(type: string): void\n\t{\n\t\tthis.#type = type;\n\n\t\tif(this.#domNode)\n\t\t{\n\t\t\tthis.#domNode.className = this.#getClassByType(this.#type);\n\t\t}\n\t}\n\n\t#getClassByType(iconType: string): void\n\t{\n\t\tlet iconClass = '';\n\n\t\tif(iconType === Icon.TYPE_CLEAR)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_SEARCH)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-search\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_LOADER)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-loader\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('Wrong icon type');\n\t\t}\n\n\t\treturn iconClass;\n\t}\n\n\trender(props)\n\t{\n\t\tthis.#type = props.type;\n\t\tthis.#domNode = Tag.render`<div class=\"${this.#getClassByType(this.#type)}\"></div>`;\n\n\t\tthis.#domNode.addEventListener(\n\t\t\t'click',\n\t\t\t(e) => {\n\t\t\t\tthis.emit(Icon.#onClickEvent);\n\t\t\t}\n\t\t);\n\n\t\treturn this.#domNode;\n\t}\n\n\tsubscribeOnClickEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Icon.#onClickEvent, listener);\n\t}\n}","import {Type, Tag, Dom} from 'main.core';\nimport {Address, ControlMode, ErrorPublisher} from 'location.core';\nimport {BaseEvent} from 'main.core.events';\nimport './css/ui-address.css';\nimport {State as WidgetState} from 'location.widget';\nimport Factory from '../factory';\nimport Switch from './switch';\nimport Icon from './icon';\n\n/**\n * Address field widget for the ui.entity-editor\n */\nexport default class UIAddress extends BX.UI.EntityEditorField\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis._input = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._addressWidget = null;\n\t\tthis._addressFieldsContainer = null;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new UIAddress();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\n\t\tconst value = this.getValue();\n\t\tlet address = null;\n\n\t\tif(Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tBX.debug('Cant parse address value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view,\n\t\t\tpopupBindOptions: {\n\t\t\t\tposition: 'right'\n\t\t\t}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.#onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.#onAddressChanged.bind(this));\n\n\t\tthis._fieldsSwitch = new Switch({\n\t\t\tstate: Switch.STATE_OFF,\n\t\t\ttitles: [\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_MORE'),\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_BRIEFLY')\n\t\t\t]\n\t\t});\n\t\tthis._fieldsSwitch.subscribeOnToggleEventSubscribe(this.#onFieldsSwitchToggle.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tif(this._input.value !== '')\n\t\t{\n\t\t\tthis._input.value = '';\n\t\t\tthis._addressWidget.address = null;\n\t\t\tthis._inputIcon.type = Icon.TYPE_SEARCH;\n\t\t}\n\n\t\tif(this.hasError())\n\t\t{\n\t\t\tthis.clearError();\n\t\t}\n\t}\n\n\t#onFieldsSwitchToggle(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\n\t\tif(state === Switch.STATE_OFF)\n\t\t{\n\t\t\tthis.#hideFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showFields();\n\t\t}\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tfocus()\n\t{\n\t\tif(!this._input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.focus(this._input);\n\t\tBX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input);\n\t}\n\n\t#hideFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.remove('visible');\n\t\t}\n\t}\n\n\t#showFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t}\n\t}\n\n\t#onAddressWidgetChangedState(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\t\tlet iconType;\n\n\t\tif(data.state === WidgetState.DATA_LOADING)\n\t\t{\n\t\t\ticonType = Icon.TYPE_LOADER;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(data.state === WidgetState.DATA_INPUTTING)\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\n\t\t\ticonType = UIAddress.#chooseInputIconTypeByAddress(this.#getAddress());\n\t\t}\n\n\n\t\tthis._inputIcon.type = iconType;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif(mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdoSetMode(mode)\n\t{\n\t\tthis._addressWidget.mode = mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view;\n\t\tthis._fieldsSwitch.state = Switch.STATE_OFF;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this._innerWrapper;\n\t}\n\n\t#onAddressChanged(event: BaseEvent): void\n\t{\n\t\tconst data = event.getData();\n\t\tconst address = data.address;\n\n\t\tif(this._hiddenInput)\n\t\t{\n\t\t\tthis._hiddenInput.value = address ? address.toJson() : '';\n\t\t\tthis.markAsChanged();\n\t\t}\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = UIAddress.#chooseInputIconTypeByAddress(address);\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(!this.isEditable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst address = this.#getAddress();\n\n\t\tthis._model.setField(\n\t\t\tthis.getName(),\n\t\t\taddress ? address.toJson() : ''\n\t\t);\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tshowError(error, anchor)\n\t{\n\t\tsuper.showError.apply(this, [error, anchor]);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.addClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tclearError()\n\t{\n\t\tsuper.clearError.apply(this);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.removeClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tthis._input = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._inputContainer = null;\n\t\tthis._addressFieldsContainer = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tDom.clean(this._innerWrapper);\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(!(this._mode === BX.UI.EntityEditorMode.edit && this._input))\n\t\t{\n\t\t\tthrow Error('BX.Location.UIAddress. Invalid validation context');\n\t\t}\n\n\t\tthis.clearError();\n\n\t\tif(this.hasValidators())\n\t\t{\n\t\t\treturn this.executeValidators(result);\n\t\t}\n\n\t\tconst isValid = !this.isRequired() || BX.util.trim(this._input.value) !== '';\n\n\t\tif(!isValid)\n\t\t{\n\t\t\tresult.addError(BX.UI.EntityValidationError.create({field: this}));\n\t\t\tthis.showRequiredFieldError(this._input);\n\t\t}\n\t\treturn isValid;\n\t}\n\n\tgetRuntimeValue()\n\t{\n\t\treturn (this._mode === BX.UI.EntityEditorMode.edit\n\t\t\t? this.#getAddress() : null\n\t\t);\n\t}\n\n\tstatic #chooseInputIconTypeByAddress(address: ?Address): string\n\t{\n\t\treturn address ? Icon.TYPE_CLEAR : Icon.TYPE_SEARCH;\n\t};\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this._addressWidget.addressFormat);\n\t}\n\n\t#getAddress(): Address\n\t{\n\t\treturn this._addressWidget.address;\n\t}\n\n\tlayout(options): void\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['ui-entity-card-content-block-field-phone']});\n\t\tthis.adjustWrapper();\n\n\t\tconst title = this.getTitle();\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\n\t\t}\n\n\t\tconst addressWidgetParams = {};\n\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tthis._input = Tag.render`<input class=\"ui-ctl-element ui-ctl-textbox\" value=\"\" type=\"text\" autocomplete=\"off\" name=\"${`${this.getName()}_STRING`}\">`;\n\t\t\tthis._hiddenInput = Tag.render`<input value='${this.getValue()}' type=\"hidden\" name=\"${this.getName()}\">`;\n\t\t\tthis._inputIcon = new Icon();\n\t\t\tthis._inputIcon.subscribeOnClickEvent(this.#onIconClick.bind(this));\n\t\t\tconst inputIconNode = this._inputIcon.render({\n\t\t\t\ttype: UIAddress.#chooseInputIconTypeByAddress(this.#getAddress())\n\t\t\t});\n\n\t\t\tthis._inputContainer = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">${inputIconNode}${this._input}${this._hiddenInput}</div>`;\n\t\t\tthis._titleWrapper.appendChild(Tag.render`${this._fieldsSwitch.render(this._mode)}`);\n\n\t\t\tthis._innerWrapper = Tag.render`\t\t\t\t\t\t    \n\t\t\t\t<div class=\"location-search-control-block\">\t\t\t\t\t\n\t\t\t\t\t${this._inputContainer}\n\t\t\t\t</div>`;\n\n\t\t\taddressWidgetParams.inputNode = this._input;\n\t\t\taddressWidgetParams.mapBindElement = inputIconNode;\n\n\t\t\tthis._addressFieldsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\n\t\t\tif(this._fieldsSwitch.state === Switch.STATE_ON)\n\t\t\t{\n\t\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t\t}\n\n\t\t\taddressWidgetParams.fieldsContainer = this._addressFieldsContainer;\n\t\t\tthis._innerWrapper.appendChild(this._addressFieldsContainer);\n\t\t}\n\t\telse// if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tlet addressStringNode;\n\n\t\t\tif(this.hasContentToDisplay())\n\t\t\t{\n\t\t\t\tconst addressString = this.#convertAddressToString(this.#getAddress());\n\t\t\t\taddressStringNode = Tag.render`<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>`;\n\n\t\t\t\tthis._innerWrapper = Tag.render`\n\t\t\t\t\t<div class=\"location-search-control-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t\t\t\t${addressStringNode}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = addressStringNode;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._innerWrapper = Tag.render`<div class=\"location-search-control-block\">\n\t\t\t\t\t${BX.message('UI_ENTITY_EDITOR_FIELD_EMPTY')}\n\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = this._innerWrapper;\n\t\t\t}\n\t\t}\n\n\t\taddressWidgetParams.controlWrapper = this._innerWrapper;\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\tthis._wrapper.appendChild(this._innerWrapper);\n\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));\n\n\t\tif(this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\terrorListener(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = Icon.TYPE_CLEAR;\n\t\t}\n\n\t\tif(!Type.isArray(errors))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// todo: this.showError supports only one error\n\t\terrors.forEach((error) => {\n\t\t\tlet message;\n\n\t\t\tif(error.message)\n\t\t\t{\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage = BX.message('LOCATION_WIDGET_AUI_UNKNOWN_ERROR');\n\t\t\t}\n\n\t\t\tif(error.code)\n\t\t\t{\n\t\t\t\tmessage += ` [${error.code}]`;\n\t\t\t}\n\n\t\t\tthis.showError(message);\n\t\t});\n\t}\n\n\tprocessModelChange(params)\n\t{\n\t\tif(BX.prop.get(params, 'originator', null) === this)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!BX.prop.getBoolean(params, 'forAll', false)\n\t\t\t&& BX.prop.getString(params, 'name', '') !== this.getName()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refreshLayout();\n\t}\n\n\tstatic registerField(): void\n\t{\n\t\tif(typeof BX.UI.EntityEditorControlFactory !== 'undefined')\n\t\t{\n\t\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod('address', UIAddress.registerFieldMethod);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addCustomEvent('BX.UI.EntityEditorControlFactory:onInitialize', (params, eventArgs) =>\n\t\t\t{\n\t\t\t\teventArgs.methods.address = UIAddress.registerFieldMethod;\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic registerFieldMethod(type, controlId, settings): ?UIAddress\n\t{\n\t\tlet result = null;\n\n\t\tif(type === 'address')\n\t\t{\n\t\t\tresult = UIAddress.create(controlId, settings);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import Address from './address/address';\nimport Factory from './factory';\nimport UIAddress from './ui-address/ui-address';\nimport State from './state';\nimport BaseFeature from './address/features/basefeature';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\n\n/* A set of widgets for using to deal with addresses */\nexport {\n\n\t// Main Widget\n\tAddress,\n\n\t// Widget features\n\tBaseFeature,\n\n\tMapFeature,\n\tAutocompleteFeature,\n\tFieldsFeature,\n\n\t// Widget factory\n\tFactory,\n\n\t// Possible widget states\n\tState,\n\n\t/* Address field for the ui.forms.\n\t * This can be used as an example of the widget implementation\n\t */\n\tUIAddress,\n};\n\n// Register fields for ui.entity-editor\nUIAddress.registerField();\n"],"names":["State","BaseFeature","props","MethodNotImplemented","addressWidget","address","mode","Address","setEventNamespace","addressFormat","Format","BX","debug","AddressEntity","ControlMode","isValid","Type","isString","languageId","TypeError","features","isArray","forEach","feature","isBoolean","needWarmBackendAfterAddressChanged","locationRepository","LocationRepository","INITIAL","sourceFeature","excludeFeatures","addressId","id","getFieldValue","AddressType","ADDRESS_LINE_1","isTemplateExists","FormatTemplateType","setFieldValue","AddressStringConverter","convertAddressToStringTemplate","getTemplate","CONTENT_TYPE_TEXT","DATA_INPUTTING","featureEvent","emit","onFeatureEvent","e","code","resetView","isDomNode","controlWrapper","edit","inputNode","Event","bind","onInputKeyup","state","onStateChangedEvent","listener","subscribe","onAddressChangedEvent","ErrorPublisher","getInstance","unbindAll","unbind","EventEmitter","setAddressWidget","push","method","params","result","isExcluded","excludeFeature","apply","location","findParents","value","length","setCaretPosition","templateType","console","error","shortAddressString","AUTOCOMPLETE","fullAddressString","DEFAULT","trim","title","selectionStart","selectionEnd","setSelectionRange","fieldForUnRecognized","splice","MenuBottom","Tag","render","node","firstChild","removeChild","appendChild","Menu","options","elRect","bindElement","getBoundingClientRect","popupWindow","setMaxWidth","width","layout","menuContainer","menuItems","choseItemIdx","getPopupWindow","isDestroyed","index","isItemChosen","isItemExist","isMenuEmpty","isChoseLastItem","chooseItem","getChosenItem","isChoseFirstItem","item","classList","add","remove","idx","unHighlightItem","highlightItem","removeMenuItem","isShown","setRightItemNode","setLeftItemNode","MainMenu","Prompt","menuNode","locationsList","searchPhrase","setMenuItems","getMenu","show","close","clearItems","Array","isSeparatorSet","slice","LOCALITY","_classPrivateMethodGet","includes","addMenuItem","html","Loc","getMessage","delimiter","isRecursive","choosePrevItem","chooseNextItem","menuItem","destroy","locationName","clarification","LocationType","TMP_TYPE_CLARIFICATION","TMP_TYPE_HINT","autoHide","closeByEsc","className","ADM_LEVEL_1","name","createMenuItemText","onclick","event","onItemSelectedEvent","undefined","AddressString","input","HTMLInputElement","setValueFromAddress","isPureAddress","setValue","indexOf","Autocomplete","requested","current","dropped","Error","autocompleteService","AutocompleteServiceBase","sourceCode","presetLocationsProvider","userLocation","promptDelay","maxPromptDelay","minCharsCountToAutocomplete","AutocompleteServiceFilter","addEventListener","document","removeEventListener","reset","phrase","tailPosition","lastIndexOf","presetLocationList","leftBottomMenuMessage","element","text","leftBottomText","setBottomRightItemNode","setBottomLeftItemNode","relatedTarget","getAttribute","DATA_SUPPOSED","hasPureAddressString","customTail","stopImmediatePropagation","hasExternalRelation","showPrompt","locationForBias","filterType","type","COUNTRY","STREET","BUILDING","types","lastSelectedLocation","filter","target","externalId","closePrompt","split","latitude","longitude","firstItemUserDistance","DistanceCalculator","getDistanceFromLatLonInKm","setTimeout","data","DATA_SELECTED","then","detailedLocation","ADDRESS_LINE_2","response","notify","errors","Promise","resolve","excludeSetAddressFeatures","DATA_LOADING","findByExternalId","DATA_LOADED","addressString","toAddress","now","Date","delta","isChanged","onLocationSelectTimeout","actualize","timeout","clearTimeout","delay","autocomplete","localStorage","getItem","LocationJsonConverter","convertJsonToLocation","JSON","parse","jsonLocation","toJson","setItem","userOptions","save","addresStr","hide","style","display","innerHTML","isHidden","CONTENT_TYPE_HTML","Popup","bindOptions","isCustomPosition","isCustomPositionSuccess","position","MainPopup","bindElRect","popupHeight","getPopupContainer","offsetHeight","popupWidth","offsetWidth","left","documentElement","clientWidth","angleOffsetY","top","window","pageYOffset","height","body","clientHeight","setAngle","offset","Dom","adjust","popupContainer","zIndex","getZindex","AddressRestorer","message","contains","toString","STRATEGY_TYPE_TEMPLATE_COMMA","MapPopup","map","MapBase","geocodingService","GeocodingServiceBase","onLocationChangedEventSubscribe","popup","onRestoreEventSubscribe","gallery","useUserLocation","onMapShow","getBindElement","setBindElement","getData","prevAddress","mapInnerContainer","stopPropagation","setContent","lat","lon","view","latLon","Location","getType","addressStr","STRATEGY_TYPE_FIELD_TYPE","geocode","mapContainer","Photo","url","link","description","Gallery","thumbnailHeight","thumbnailWidth","maxPhotoCount","photoService","requestPhotos","photosData","refresh","photos","photo","thumbnail","util","strip_tags","renderedPhotos","Field","sort","container","Text","encode","Fields","field","clean","fieldCollection","fields","hasOwnProperty","formatField","subscribeOnValueChangedEvent","subscribeOnStateChangedEvent","a","b","changedField","MapFeature","onChangedEventSubscribe","setAddressByFeature","bindelement","closeMap","mapBindElement","AutocompleteFeature","onAddressChangedEventSubscribe","onStateChangedEventSubscribe","setStateByFeature","onSearchStartedEventSubscribe","emitFeatureEvent","eventCode","searchStartedEvent","payload","onSearchCompletedEventSubscribe","searchCompletedEvent","onShowOnMapClickedEventSubscribe","showOnMapClickedEvent","autocompleteMenuElement","FieldsFeature","subscribeOnAddressChangedEvent","fieldsContainer","MapFeatureAuto","onMouseOverSubscribe","onMouseOutSubscribe","showMap","Factory","sourceParams","sourceLanguageId","useFeatures","createFieldsFeature","source","createSource","SourceCreationError","mapFeature","createAutocompleteFeature","showPhotos","useGeocodingService","DEFAULT_THUMBNAIL_HEIGHT","DEFAULT_THUMBNAIL_WIDTH","DEFAULT_MAX_PHOTO_COUNT","DEFAULT_MAP_BEHAVIOR","createMapFeature","popupOptions","popupBindOptions","mapBehavior","widget","subscribeOnFeatureEvent","cacheable","animation","angle","Object","assign","mapFeatureProps","Google","OSMFactory","createOSMSource","RangeError","Switch","titles","STATE_OFF","STATE_ON","Icon","TYPE_SEARCH","iconType","iconClass","TYPE_CLEAR","TYPE_LOADER","UIAddress","_input","_inputIcon","_hiddenInput","_innerWrapper","_addressWidget","_addressFieldsContainer","settings","getValue","isStringFilled","widgetFactory","createAddressWidget","_mode","UI","EntityEditorMode","_fieldsSwitch","subscribeOnToggleEventSubscribe","focus","EditorTextHelper","getCurrent","setPositionAtEnd","EntityEditorModeSwitchType","common","button","content","isEditable","_model","setField","getName","anchor","addClass","_inputContainer","removeClass","clearError","hasValidators","executeValidators","isRequired","addError","EntityValidationError","create","showRequiredFieldError","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","getTitle","isDragEnabled","_wrapper","createDragButton","addressWidgetParams","createTitleNode","subscribeOnClickEvent","inputIconNode","_titleWrapper","addressStringNode","hasContentToDisplay","subscribeOnErrorEvent","errorListener","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","registerLayout","showError","prop","get","getBoolean","getString","refreshLayout","self","initialize","EntityEditorControlFactory","registerFactoryMethod","registerFieldMethod","addCustomEvent","eventArgs","methods","controlId","EntityEditorField","hasError","WidgetState","markAsChanged","registerField"],"mappings":"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"}