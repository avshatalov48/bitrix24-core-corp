{"version":3,"file":"google.bundle.js","sources":["../src/loader.js","../src/autocompleteservice.js","../src/map.js","../src/photoservice.js","../src/geocodingservice.js","../src/google.js"],"sourcesContent":["/**\n * Loads google source services\n * todo: save loaded instances\n */\nexport default class Loader\n{\n\tstatic #loadingPromise = null;\n\n\tstatic #createSrc(apiKey, languageId)\n\t{\n\t\treturn 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&libraries=places&language=' + languageId;\n\t}\n\n\t/**\n\t * Loads google services\n\t * @param {string} apiKey\n\t * @param {string} languageId\n\t * @returns {Promise}\n\t */\n\tstatic load(apiKey: string, languageId: string): Promise\n\t{\n\t\tif(Loader.#loadingPromise === null)\n\t\t{\n\t\t\tLoader.#loadingPromise = new Promise((resolve) => {\n\n\t\t\t\tBX.load(\n\t\t\t\t\t[Loader.#createSrc(apiKey, languageId)],\n\t\t\t\t\t() => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Loader.#loadingPromise;\n\t}\n}","import {Location, AutocompleteServiceBase} from \"location.core\";\n\nexport default class AutocompleteService extends AutocompleteServiceBase\n{\n\t/** {string} */\n\t#languageId;\n\t/** {google.maps.places.AutocompleteService} */\n\t#googleAutocompleteService;\n\t/** {Promise}*/\n\t#loaderPromise;\n\t/** {GoogleSource} */\n\t#googleSource;\n\t/** {string} */\n\t#localStorageKey = 'locationGoogleAutocomplete';\n\t/** {number} */\n\t#localStorageResCount = 30;\n\t/** {number} */\n\t#biasBoundRadius = 50000;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#googleSource = props.googleSource;\n\t\t//Because googleSource could still be in the process of loading\n\t\tthis.#loaderPromise = props.googleSource.loaderPromise\n\t\t\t.then(() => {\n\t\t\t\tthis.#initAutocompleteService();\n\t\t\t});\n\t}\n\n\t#getLocalStoredResults(query, params): object\n\t{\n\t\tlet result = null,\n\t\t\tstoredResults = localStorage.getItem(this.#localStorageKey);\n\n\t\tif(storedResults)\n\t\t{\n\t\t\ttry {\n\t\t\t\tstoredResults = JSON.parse(storedResults);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif(Array.isArray(storedResults))\n\t\t\t{\n\t\t\t\tfor(const [index, item] of storedResults.entries())\n\t\t\t\t{\n\t\t\t\t\tif(item && typeof item.query !== 'undefined' && item.query === query)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = Object.assign({}, item);\n\t\t\t\t\t\tstoredResults.splice(index, 1);\n\t\t\t\t\t\tstoredResults.push(result);\n\t\t\t\t\t\tlocalStorage.setItem(this.#localStorageKey, JSON.stringify(storedResults));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t#getPredictionPromiseLocalStorage(query, params): ?Promise\n\t{\n\t\tlet result = null,\n\t\t\tanswer = this.#getLocalStoredResults(query, params);\n\n\t\tif(answer !== null)\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tresolve(\n\t\t\t\t\t\tthis.#convertToLocationsList(answer.answer, answer.status)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setPredictionResult(query, params, answer, status): void\n\t{\n\t\tlet storedResults = localStorage.getItem(this.#localStorageKey);\n\n\t\tif(storedResults)\n\t\t{\n\t\t\ttry {\n\t\t\t\tstoredResults = JSON.parse(storedResults);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(!Array.isArray(storedResults))\n\t\t{\n\t\t\tstoredResults = [];\n\t\t}\n\n\t\tstoredResults.push({\n\t\t\tstatus: status,\n\t\t\tquery: query,\n\t\t\tanswer: answer\n\t\t});\n\n\t\tif(storedResults.length > this.#localStorageResCount)\n\t\t{\n\t\t\tstoredResults.shift();\n\t\t}\n\n\t\tlocalStorage.setItem(this.#localStorageKey, JSON.stringify(storedResults));\n\t}\n\n\t#getPredictionPromise(query, params): Promise\n\t{\n\t\tlet result = this.#getPredictionPromiseLocalStorage(query, params);\n\n\t\tif(!result)\n\t\t{\n\t\t\tlet queryPredictionsParams = {\n\t\t\t\tinput: query,\n\t\t\t};\n\t\t\tif(params.userCoordinates)\n\t\t\t{\n\t\t\t\tqueryPredictionsParams.location = new google.maps.LatLng(\n\t\t\t\t\tparams.userCoordinates[0],\n\t\t\t\t\tparams.userCoordinates[1]\n\t\t\t\t);\n\t\t\t\tqueryPredictionsParams.radius = this.#biasBoundRadius;\n\t\t\t}\n\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tthis.#googleAutocompleteService.getQueryPredictions(\n\t\t\t\t\t\tqueryPredictionsParams,\n\t\t\t\t\t\t(result, status) => {\n\t\t\t\t\t\t\tlet locationsList = this.#convertToLocationsList(result, status);\n\t\t\t\t\t\t\tthis.#setPredictionResult(query, params, result, status);\n\t\t\t\t\t\t\tresolve(locationsList);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns Promise witch  will transfer locations list\n\t * @param {string} query\n\t * @param {object} params\n\t * @returns {Promise}\n\t */\n\tautocomplete(query:string, params: Object): Promise\n\t{\n\t\t//Because google.maps.places.AutocompleteService could be still in the process of loading\n\t\treturn this.#loaderPromise\n\t\t\t.then(() => {\n\t\t\t\treturn this.#getPredictionPromise(query, params);\n\t\t\t},\n\t\t\terror => BX.debug(error)\n\t\t);\n\t}\n\n\t#initAutocompleteService()\n\t{\n\t\tif(typeof google === 'undefined' || typeof google.maps.places.AutocompleteService === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.places.AutocompleteService must be defined');\n\t\t}\n\n\t\tthis.#googleAutocompleteService = new google.maps.places.AutocompleteService();\n\t}\n\n\t#convertToLocationsList(data, status)\n\t{\n\t\tif(status === 'ZERO_RESULTS')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tif(!data || status !== 'OK')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = [];\n\n\t\tfor (let item of data)\n\t\t{\n\t\t\tif(item.place_id)\n\t\t\t{\n\t\t\t\tconst location = new Location({\n\t\t\t\t\tsourceCode: this.#googleSource.sourceCode,\n\t\t\t\t\texternalId: item.place_id,\n\t\t\t\t\tname: item.description,\n\t\t\t\t\tlanguageId: this.#languageId\n\t\t\t\t});\n\n\t\t\t\tresult.push(location);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Event} from 'main.core';\nimport {Location, LocationRepository, ControlMode, MapBase, ErrorPublisher} from 'location.core';\n\n/**\n * Class for the autocomplete locations and addresses inputs\n */\nexport default class Map extends MapBase\n{\n\tstatic #onChangedEvent = 'onChanged';\n\n\t/** {string} */\n\t#languageId;\n\t/** {google.maps.Map} */\n\t#googleMap;\n\t/** {GoogleSource} */\n\t#googleSource;\n\t/** {number} */\n\t#zoom;\n\t/** {google.maps.Marker} */\n\t#locationMarker;\n\t/** {ControlMode} */\n\t#mode;\n\t/** Location */\n\t#location;\n\t#geocoder;\n\t#locationRepository;\n\t#timerId = null;\n\t#isUpdating = false;\n\t#changeDelay;\n\t#loaderPromise = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#googleSource = props.googleSource;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#changeDelay = props.changeDelay || 700;\n\t}\n\n\trender(props: object)\n\t{\n\t\tthis.#loaderPromise = this.#googleSource.loaderPromise.then(() => {\n\t\t\tthis.#initGoogleMap(props);\n\t\t});\n\n\t\treturn this.#loaderPromise;\n\t}\n\n\tget loaderPromise()\n\t{\n\t\treturn this.#loaderPromise;\n\t}\n\n\tset mode(mode: string)\n\t{\n\t\tthis.#mode = mode;\n\n\t\tif(this.#locationMarker)\n\t\t{\n\t\t\tthis.#locationMarker.setDraggable(mode === ControlMode.edit);\n\t\t}\n\t}\n\n\t#convertLocationToPosition(location: ?Location): Object\n\t{\n\t\tif(!location)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif(typeof google === 'undefined' || typeof google.maps === 'undefined')\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new google.maps.LatLng(location.latitude, location.longitude);\n\t}\n\n\t#adjustZoom(): void\n\t{\n\t\tif(!this.#location)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet zoom = Map.#chooseZoomByLocation(this.#location);\n\n\t\tif(zoom !== null && zoom !== this.#zoom)\n\t\t{\n\t\t\tthis.zoom = zoom;\n\t\t}\n\t}\n\n\tget zoom(): number\n\t{\n\t\treturn this.#zoom;\n\t}\n\n\tset zoom(zoom: number): void\n\t{\n\t\tthis.#zoom = zoom;\n\n\t\tif(this.#googleMap)\n\t\t{\n\t\t\tthis.#googleMap.setZoom(zoom);\n\t\t}\n\t}\n\n\t#getPositionToLocationPromise(position): Promise\n\t{\n\t\treturn new Promise( (resolve) => {\n\t\t\tthis.#geocoder.geocode({'location': position}, (results, status)  => {\n\t\t\t\tif (status === 'OK' && results[0])\n\t\t\t\t{\n\t\t\t\t\tresolve(results[0].place_id);\n\t\t\t\t}\n\t\t\t\telse if(status === 'ZERO_RESULTS')\n\t\t\t\t{\n\t\t\t\t\tresolve('');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow Error('Geocoder failed due to: ' + status);\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\t.then((placeId) => {\n\t\t\tlet result;\n\n\t\t\tif(placeId)\n\t\t\t{\n\t\t\t\tresult = this.#locationRepository.findByExternalId(\n\t\t\t\t\tplaceId,\n\t\t\t\t\tthis.#googleSource.sourceCode,\n\t\t\t\t\tthis.#languageId\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tresolve(null);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tset location(location: Location)\n\t{\n\t\tthis.#location = location;\n\t\tlet position = this.#convertLocationToPosition(location);\n\n\t\tif(position)\n\t\t{\n\t\t\tif(this.#locationMarker)\n\t\t\t{\n\t\t\t\tthis.#isUpdating = true;\n\t\t\t\tthis.#locationMarker.setPosition(position);\n\t\t\t\tthis.#isUpdating = false;\n\t\t\t}\n\n\t\t\tif(this.#googleMap)\n\t\t\t{\n\t\t\t\tif(!this.#locationMarker.getMap())\n\t\t\t\t{\n\t\t\t\t\tthis.#locationMarker.setMap(this.#googleMap);\n\t\t\t\t}\n\n\t\t\t\tthis.#googleMap.panTo(position);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this.#locationMarker)\n\t\t\t{\n\t\t\t\tthis.#locationMarker.setMap(null);\n\t\t\t}\n\t\t}\n\n\t\tthis.#adjustZoom();\n\t}\n\n\tget location(): Location\n\t{\n\t\treturn this.#location;\n\t}\n\n\tonLocationChangedEventSubscribe(listener: function): void\n\t{\n\t\tthis.subscribe(Map.#onChangedEvent, listener);\n\t}\n\n\t#emitOnLocationChangedEvent(location: ?Location)\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.emit(Map.#onChangedEvent, { location: location\t});\n\t\t}\n\t}\n\n\t#onMarkerUpdatePosition()\n\t{\n\t\tif(!this.#isUpdating && this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#createTimer(this.#locationMarker.getPosition());\n\t\t}\n\t}\n\n\t#createTimer(position)\n\t{\n\t\tif(this.#timerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#timerId);\n\t\t}\n\n\t\tthis.#timerId = setTimeout(() => {\n\t\t\t\tthis.#timerId = null;\n\t\t\t\tthis.#googleMap.panTo(position);\n\t\t\t\tthis.#fulfillOnChangedEvent(position);\n\t\t\t},\n\t\t\tthis.#changeDelay\n\t\t);\n\t}\n\n\t#fulfillOnChangedEvent(position)\n\t{\n\t\tthis.#getPositionToLocationPromise(position)\n\t\t.then(this.#emitOnLocationChangedEvent.bind(this))\n\t\t.catch((response) => {\n\t\t\tErrorPublisher.getInstance().notify(response.errors);\n\t\t});\n\t}\n\n\t#onMapClick(position)\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tif(!this.#locationMarker.getMap)\n\t\t\t{\n\t\t\t\tthis.#locationMarker.setMap(this.#googleMap);\n\t\t\t}\n\n\t\t\tthis.#locationMarker.setPosition(position);\n\t\t\tthis.#createTimer(position);\n\t\t}\n\t}\n\n\t#initGoogleMap(props): void\n\t{\n\t\tthis.#mode = props.mode;\n\t\tthis.#location = props.location || null;\n\n\t\tif(typeof google === 'undefined' || typeof google.maps.Map === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Map must be defined');\n\t\t}\n\n\t\tlet position = this.#convertLocationToPosition(this.#location);\n\n\t\tlet mapProps = {\n\t\t\tgestureHandling: 'greedy',\n\t\t};\n\n\t\tlet zoom = Map.#chooseZoomByLocation(this.#location);\n\n\t\tif(zoom)\n\t\t{\n\t\t\tmapProps.zoom = zoom;\n\t\t}\n\n\t\tif(position)\n\t\t{\n\t\t\tmapProps.center = position;\n\t\t}\n\n\t\tthis.#googleMap = new google.maps.Map(\n\t\t\tprops.mapContainer,\n\t\t\tmapProps\n\t\t);\n\n\t\tthis.#googleMap.addListener('click', (e) => {\n\t\t\tthis.#onMapClick(e.latLng);\n\t\t});\n\n\t\tif(typeof google.maps.Marker === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Marker must be defined');\n\t\t}\n\n\t\tthis.#locationMarker = new google.maps.Marker({\n\t\t\tposition: position,\n\t\t\tmap: this.#googleMap,\n\t\t\tdraggable: this.#mode === ControlMode.edit\n\t\t});\n\n\t\tthis.#locationMarker.addListener('position_changed', () => {\n\t\t\tthis.#onMarkerUpdatePosition();\n\t\t});\n\n\t\tif(typeof google.maps.Geocoder === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Geocoder must be defined');\n\t\t}\n\n\t\tthis.#geocoder = new google.maps.Geocoder;\n\t}\n\n\tstatic #chooseZoomByLocation(location: ?Location): number\n\t{\n\t\tlet result = 18;\n\n\t\tif(location)\n\t\t{\n\t\t\tlet locationType = location.type;\n\n\t\t\tif(locationType > 0)\n\t\t\t{\n\t\t\t\tif(locationType < 100)\n\t\t\t\t\tresult = 1;\n\t\t\t\telse if(locationType === 100)\n\t\t\t\t\tresult = 4;\n\t\t\t\telse if(locationType <= 200)\n\t\t\t\t\tresult = 6;\n\t\t\t\telse if(locationType <= 300)\n\t\t\t\t\tresult = 11;\n\t\t\t\telse if(locationType <= 340)\n\t\t\t\t\tresult = 16;\n\t\t\t\telse if(locationType > 340)\n\t\t\t\t\tresult = 18;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tget googleMap()\n\t{\n\t\treturn this.#googleMap;\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbindAll(this);\n\t\tthis.#googleMap = null;\n\t\tthis.#locationMarker = null;\n\t\tthis.#geocoder = null;\n\t\tthis.#timerId = null;\n\t\tthis.#loaderPromise = null;\n\t\tsuper.destroy();\n\t}\n}","import {PhotoServiceBase, BasePhotoServiceRequestPhotosPropsType} from \"location.core\";\n\nexport default class PhotoService extends PhotoServiceBase\n{\n\t#map;\n\t#service;\n\t#googleSource;\n\t#loadingPromise;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.#googleSource = props.googleSource;\n\t\tthis.#map = props.map;\n\t}\n\n\t#getLoaderPromise()\n\t{\n\t\tif(!this.#loadingPromise)\n\t\t{\n\t\t\t//map haven't rendered yet\t`\n\t\t\tif(this.#map.loaderPromise === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#loadingPromise = this.#map.loaderPromise.then(() => {\n\t\t\t\tthis.#service = new google.maps.places.PlacesService(this.#map.googleMap);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\trequestPhotos(props: BasePhotoServiceRequestPhotosPropsType): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\n\t\t\tlet promise = this.#getLoaderPromise();\n\n\t\t\tif(!promise)\n\t\t\t{\n\t\t\t\tresolve([]);\n\t\t\t}\n\n\t\t\tlet loaderPromise = this.#getLoaderPromise();\n\n\t\t\tif(!loaderPromise)\n\t\t\t{\n\t\t\t\tresolve([]);\n\t\t\t}\n\n\t\t\tloaderPromise\n\t\t\t .then(() => {\n\t\t\t\tif(props.location.sourceCode !== this.#googleSource.sourceCode)\n\t\t\t\t{\n\t\t\t\t\tresolve([]);\n\t\t\t\t}\n\n\t\t\t\tif(props.location.externalId.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tresolve([]);\n\t\t\t\t}\n\n\t\t\t\tthis.#service.getDetails(\n\t\t\t\t\t{\n\t\t\t\t\t\tplaceId: props.location.externalId,\n\t\t\t\t\t\tfields: ['photos']\n\t\t\t\t\t},\n\t\t\t\t\tfunction(place, status)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet resultPhotos = [];\n\n\t\t\t\t\t\tif (status === google.maps.places.PlacesServiceStatus.OK)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(Array.isArray(place.photos))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet count = 0;\n\n\t\t\t\t\t\t\t\tfor(let gPhoto of place.photos)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tresultPhotos.push({\n\t\t\t\t\t\t\t\t\t\turl: gPhoto.getUrl(),\n\t\t\t\t\t\t\t\t\t\twidth: gPhoto.width,\n\t\t\t\t\t\t\t\t\t\theight: gPhoto.height,\n\t\t\t\t\t\t\t\t\t\tdescription: Array.isArray(gPhoto.html_attributions) ? gPhoto.html_attributions.join('<br>') : '',\n\t\t\t\t\t\t\t\t\t\tthumbnail: {\n\t\t\t\t\t\t\t\t\t\t\turl: gPhoto.getUrl({\n\t\t\t\t\t\t\t\t\t\t\t\tmaxHeight: props.thumbnailHeight,\n\t\t\t\t\t\t\t\t\t\t\t\tmaxWidth: props.thumbnailWidth\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\twidth: props.thumbnailWidth,\n\t\t\t\t\t\t\t\t\t\t\theight: props.thumbnailHeight\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcount++;\n\n\t\t\t\t\t\t\t\t\tif(props.maxPhotoCount && count >= props.maxPhotoCount)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(resultPhotos);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t});\n\t}\n}","import {Location, AddressType, LocationType, GeocodingServiceBase} from 'location.core';\n\nexport default class GeocodingService extends GeocodingServiceBase\n{\n\t#map;\n\t#geocoder;\n\t#loadingPromise;\n\t#googleSource;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.#map = props.map;\n\t\tthis.#googleSource = props.googleSource;\n\t}\n\n\t#getLoaderPromise()\n\t{\n\t\tif(!this.#loadingPromise)\n\t\t{\n\t\t\t//map haven't rendered yet\t`\n\t\t\tif(this.#googleSource.loaderPromise === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#loadingPromise = this.#googleSource.loaderPromise.then(() => {\n\t\t\t\tthis.#geocoder = new google.maps.Geocoder();\n\t\t\t});\n\t\t}\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\t#convertLocationType(types: Array)\n\t{\n\t\tlet typeMap = {\n\t\t\t'country': LocationType.COUNTRY,\n\t\t\t'locality': LocationType.LOCALITY,\n\t\t\t'postal_town': LocationType.LOCALITY,\n\t\t\t'route': LocationType.STREET,\n\t\t\t'street_address': LocationType.ADDRESS_LINE_1,\n\t\t\t'administrative_area_level_4': LocationType.ADM_LEVEL_4,\n\t\t\t'administrative_area_level_3': LocationType.ADM_LEVEL_3,\n\t\t\t'administrative_area_level_2': LocationType.ADM_LEVEL_2,\n\t\t\t'administrative_area_level_1': LocationType.ADM_LEVEL_1,\n\t\t\t'floor': LocationType.FLOOR,\n\t\t\t'postal_code': AddressType.POSTAL_CODE,\n\t\t\t'room': LocationType.ROOM,\n\t\t\t'sublocality': LocationType.SUB_LOCALITY,\n\t\t\t'sublocality_level_1': LocationType.SUB_LOCALITY_LEVEL_1,\n\t\t\t'sublocality_level_2': LocationType.SUB_LOCALITY_LEVEL_2,\n\t\t\t'street_number': LocationType.BUILDING\n\t\t};\n\n\t\tlet result = LocationType.UNKNOWN;\n\n\t\tfor (let item of types)\n\t\t{\n\t\t\tif(typeof typeMap[item] !== 'undefined')\n\t\t\t{\n\t\t\t\tresult = typeMap[item];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#convertResultToLocations(data: Array)\n\t{\n\t\tlet result = [];\n\n\t\tfor (let item of data)\n\t\t{\n\t\t\tlet location = new Location;\n\t\t\tlocation.sourceCode = this.#googleSource.sourceCode;\n\t\t\tlocation.languageId = this.#googleSource.languageId;\n\t\t\tlocation.externalId = item.place_id;\n\t\t\tlocation.type = this.#convertLocationType(item.types);\n\t\t\tlocation.name = item.formatted_address;\n\t\t\tlocation.latitude = item.geometry.location.lat();\n\t\t\tlocation.longitude = item.geometry.location.lng();\n\t\t\tresult.push(location);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgeocodeConcrete(addressString: string): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\n\t\t\tconst loaderPromise = this.#getLoaderPromise();\n\n\t\t\tif(!loaderPromise)\n\t\t\t{\n\t\t\t\tresolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tloaderPromise\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.#geocoder.geocode({address: addressString}, (results, status) => {\n\t\t\t\t\t\tif(status === 'OK') {\n\t\t\t\t\t\t\tresolve(this.#convertResultToLocations(results));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(status === 'ZERO_RESULTS')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve([]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.debug(`Geocode was not successful for the following reason: ${status}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n}","import {Type} from \"main.core\";\nimport {BaseSource, SourceCreationError} from \"location.core\";\nimport Loader from \"./loader\";\nimport AutocompleteService from \"./autocompleteservice\";\nimport Map from \"./map\";\nimport PhotoService from \"./photoservice\";\nimport GeocodingService from \"./geocodingservice\";\n\nexport class Google extends BaseSource\n{\n\t#code = 'GOOGLE';\n\t#languageId = '';\n\t#sourceLanguageId = '';\n\t#loaderPromise = null;\n\t#map;\n\t#photoService;\n\t#geocodingService;\n\t#autocompleteService;\n\n\tconstructor(props: Object)\n\t{\n\t\tsuper(props);\n\n\t\tif(!Type.isString(props.languageId) || props.languageId.trim() === '')\n\t\t{\n\t\t\tthrow new SourceCreationError('props.languageId must be a string');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\n\t\tif(!Type.isString(props.sourceLanguageId) || props.sourceLanguageId.trim() === '')\n\t\t{\n\t\t\tthrow new SourceCreationError('props.sourceLanguageId must be a string');\n\t\t}\n\n\t\tthis.#sourceLanguageId = props.sourceLanguageId;\n\n\t\tif(!Type.isString(props.apiKey) || props.apiKey.trim() === '')\n\t\t{\n\t\t\tthrow new SourceCreationError('props.apiKey must be a string');\n\t\t}\n\n\t\tthis.#loaderPromise = Loader.load(props.apiKey, props.sourceLanguageId);\n\n\t\tthis.#map = new Map({\n\t\t\tgoogleSource: this,\n\t\t\tlanguageId: this.#languageId,\n\t\t});\n\n\t\tthis.#autocompleteService = new AutocompleteService({\n\t\t\tgoogleSource: this,\n\t\t\tlanguageId: this.#languageId\n\t\t});\n\n\t\tthis.#photoService = new PhotoService({\n\t\t\tgoogleSource: this,\n\t\t\tmap: this.#map\n\t\t});\n\n\t\tthis.#geocodingService = new GeocodingService({\n\t\t\tgoogleSource: this,\n\t\t\tmap: this.#map\n\t\t});\n\t}\n\n\tget sourceCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\tget loaderPromise(): Promise\n\t{\n\t\treturn this.#loaderPromise;\n\t}\n\n\tget map()\n\t{\n\t\treturn this.#map;\n\t}\n\n\tget autocompleteService()\n\t{\n\t\treturn this.#autocompleteService;\n\t}\n\n\tget photoService()\n\t{\n\t\treturn this.#photoService;\n\t}\n\n\tget geocodingService()\n\t{\n\t\treturn this.#geocodingService;\n\t}\n\n\tget languageId()\n\t{\n\t\treturn this.#languageId;\n\t}\n}"],"names":["Loader","apiKey","languageId","Promise","resolve","BX","load","AutocompleteService","props","googleSource","loaderPromise","then","query","params","error","debug","AutocompleteServiceBase","result","storedResults","localStorage","getItem","JSON","parse","e","Array","isArray","entries","index","item","Object","assign","splice","push","setItem","stringify","answer","status","length","shift","queryPredictionsParams","input","userCoordinates","location","google","maps","LatLng","radius","getQueryPredictions","locationsList","places","Error","data","place_id","Location","sourceCode","externalId","name","description","Map","locationRepository","LocationRepository","changeDelay","listener","subscribe","Event","unbindAll","mode","setDraggable","ControlMode","edit","zoom","setZoom","position","setPosition","getMap","setMap","panTo","MapBase","locationType","type","latitude","longitude","geocode","results","placeId","findByExternalId","emit","getPosition","clearTimeout","setTimeout","_classPrivateMethodGet","bind","catch","response","ErrorPublisher","getInstance","notify","errors","mapProps","gestureHandling","center","mapContainer","addListener","latLng","Marker","map","draggable","Geocoder","PhotoService","promise","getDetails","fields","place","resultPhotos","PlacesServiceStatus","OK","photos","count","gPhoto","url","getUrl","width","height","html_attributions","join","thumbnail","maxHeight","thumbnailHeight","maxWidth","thumbnailWidth","maxPhotoCount","PhotoServiceBase","PlacesService","googleMap","GeocodingService","addressString","address","GeocodingServiceBase","types","typeMap","LocationType","COUNTRY","LOCALITY","STREET","ADDRESS_LINE_1","ADM_LEVEL_4","ADM_LEVEL_3","ADM_LEVEL_2","ADM_LEVEL_1","FLOOR","AddressType","POSTAL_CODE","ROOM","SUB_LOCALITY","SUB_LOCALITY_LEVEL_1","SUB_LOCALITY_LEVEL_2","BUILDING","UNKNOWN","formatted_address","geometry","lat","lng","Google","Type","isString","trim","SourceCreationError","sourceLanguageId","BaseSource"],"mappings":"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"}