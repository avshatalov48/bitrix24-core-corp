{"version":3,"file":"source.bundle.js","sources":["../src/google/loader.js","../src/google/autocompleter.js","../src/google/map.js","../src/google/googlesource.js","../src/sourcefactory.js"],"sourcesContent":["/**\n * Loads google source services\n */\nexport default class Loader\n{\n\tstatic #isGoogleApiLoaded = false;\n\n\tstatic #createSrc(apiKey, languageId)\n\t{\n\t\treturn 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&libraries=places&language=' + languageId;\n\t}\n\n\t/**\n\t * Loads google services\n\t * @param {string} apiKey\n\t * @param {string} languageId\n\t * @returns {Promise}\n\t */\n\tstatic load(apiKey: string, languageId: string): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\n\t\t\tif(Loader.#isGoogleApiLoaded)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tBX.load(\n\t\t\t\t[Loader.#createSrc(apiKey, languageId)],\n\t\t\t\t() => {\n\t\t\t\t\tLoader.#isGoogleApiLoaded = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n}","import {Location} from \"location.core\";\n\nexport default class Autocompleter\n{\n\t/** {string} */\n\t#languageId;\n\t/** {google.maps.places.AutocompleteService} */\n\t#googleAutocompleteService;\n\t/** {Promise}*/\n\t#loaderPromise;\n\t/** {GoogleSource} */\n\t#source;\n\t/** {string} */\n\t#localStorageKey = 'locationGoogleAutocomplete';\n\t/** {number} */\n\t#localStorageResCount = 30;\n\n\tconstructor(props)\n\t{\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#source = props.source;\n\t\t//Because source could still be in the process of loading\n\t\tthis.#loaderPromise = props.loaderPromise\n\t\t\t.then(() => {\n\t\t\t\tthis.#initAutocompleteService();\n\t\t\t});\n\t}\n\n\t#getLocalStoredResults(query, params): object\n\t{\n\t\tlet result = null,\n\t\t\tstoredResults = localStorage.getItem(this.#localStorageKey);\n\n\t\tif(storedResults)\n\t\t{\n\t\t\ttry {\n\t\t\t\tstoredResults = JSON.parse(storedResults);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif(Array.isArray(storedResults))\n\t\t\t{\n\t\t\t\tfor(const [index, item] of storedResults.entries())\n\t\t\t\t{\n\t\t\t\t\tif(item && typeof item.query !== 'undefined' && item.query === query)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = Object.assign({}, item);\n\t\t\t\t\t\tstoredResults.splice(index, 1);\n\t\t\t\t\t\tstoredResults.push(result);\n\t\t\t\t\t\tlocalStorage.setItem(this.#localStorageKey, JSON.stringify(storedResults));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t#getPredictionPromiseLocalStorage(query, params): ?Promise\n\t{\n\t\tlet result = null,\n\t\t\tanswer = this.#getLocalStoredResults(query, params);\n\n\t\tif(answer !== null)\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tresolve(\n\t\t\t\t\t\tthis.#convertToLocationsList(answer.answer, answer.status)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setPredictionResult(query, params, answer, status): void\n\t{\n\t\tlet storedResults = localStorage.getItem(this.#localStorageKey);\n\n\t\tif(storedResults)\n\t\t{\n\t\t\ttry {\n\t\t\t\tstoredResults = JSON.parse(storedResults);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(!Array.isArray(storedResults))\n\t\t{\n\t\t\tstoredResults = [];\n\t\t}\n\n\t\tstoredResults.push({\n\t\t\tstatus: status,\n\t\t\tquery: query,\n\t\t\tanswer: answer\n\t\t});\n\n\t\tif(storedResults.length > this.#localStorageResCount)\n\t\t{\n\t\t\tstoredResults.shift();\n\t\t}\n\n\t\tlocalStorage.setItem(this.#localStorageKey, JSON.stringify(storedResults));\n\t}\n\n\t#getPredictionPromise(query, params): Promise\n\t{\n\t\tlet result = this.#getPredictionPromiseLocalStorage(query, params);\n\n\t\tif(!result)\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tthis.#googleAutocompleteService.getQueryPredictions({input: query}, (result, status) => {\n\t\t\t\t\t\tlet locationsList = this.#convertToLocationsList(result, status);\n\t\t\t\t\t\tthis.#setPredictionResult(query, params, result, status);\n\t\t\t\t\t\tresolve(locationsList);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns Promise witch  will transfer locations list\n\t * @param {string} query\n\t * @param {object} params\n\t * @returns {Promise}\n\t */\n\tautocomplete(query:string, params: Object): Promise\n\t{\n\t\t//Because google.maps.places.AutocompleteService could be still in the process of loading\n\t\treturn this.#loaderPromise\n\t\t\t.then(() => {\n\t\t\t\treturn this.#getPredictionPromise(query, params);\n\t\t\t},\n\t\t\terror => BX.debug(error)\n\t\t);\n\t}\n\n\t#initAutocompleteService()\n\t{\n\t\tif(typeof google === 'undefined' || typeof google.maps.places.AutocompleteService === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.places.AutocompleteService must be defined');\n\t\t}\n\n\t\tthis.#googleAutocompleteService = new google.maps.places.AutocompleteService();\n\t}\n\n\t#convertToLocationsList(data, status)\n\t{\n\t\tif(status === 'ZERO_RESULTS')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tif(!data || status !== 'OK')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = [];\n\n\t\tfor (let item of data) {\n\t\t\tconst location = new Location({\n\t\t\t\tsourceCode: this.#source.sourceCode,\n\t\t\t\texternalId: item.place_id,\n\t\t\t\tname: item.description,\n\t\t\t\tlanguageId: this.#languageId\n\t\t\t});\n\n\t\t\tresult.push(location);\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Location, LocationRepository, ControlMode, ZoomType} from \"location.core\";\nimport {EventEmitter} from \"main.core.events\";\n\n/**\n * Class for the autocomplete locations and addresses inputs\n */\nexport default class Map extends EventEmitter\n{\n\tstatic #onChangedEvent = 'onChanged';\n\n\t/** {string} */\n\t#languageId;\n\t/** {google.maps.Map} */\n\t#googleMap;\n\t/** {Promise}*/\n\t#loaderPromise;\n\t/** {GoogleSource} */\n\t#googleSource;\n\t/** {number} */\n\t#zoom;\n\t/** {google.maps.Marker} */\n\t#locationMarker;\n\t/** {ControlMode}*/\n\t#mode;\n\n\t#geocoder;\n\t#locationRepository;\n\t#defaultPosition;\n\t#changeDelay;\n\t#timerId = '';\n\t#isUpdating = false;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#googleSource = props.googleSource;\n\t\tthis.#zoom = props.zoom || 10;\n\t\tlet location = props.location || null;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#defaultPosition = props.defaultPosition || {latitude: 54.719208, longitude: 20.488515};\n\t\tthis.#changeDelay = props.changeDelay || 500;\n\t\tthis.#mode = props.mode;\n\n\t\t//Because googleSource could still be in the process of loading\n\t\tthis.#loaderPromise = props.loaderPromise\n\t\t\t.then(() => {\n\t\t\t\tthis.#initGoogleMap(props.mapContainer, location, this.#zoom);\n\t\t\t});\n\t}\n\n\tset mode(mode: string)\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#locationMarker.setDraggable(mode === ControlMode.edit);\n\t}\n\n\t#convertLocationToPosition(location: ?Location): Object\n\t{\n\t\tlet lat, lon;\n\n\t\tif(location)\n\t\t{\n\t\t\tlat = location.latitude;\n\t\t\tlon = location.longitude;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlat = this.#defaultPosition.latitude;\n\t\t\tlon = this.#defaultPosition.longitude;\n\t\t}\n\n\t\treturn new google.maps.LatLng(lat, lon);\n\t}\n\n\t#getPositionToLocationPromise(position): Promise\n\t{\n\t\treturn new Promise( (resolve) => {\n\t\t\tthis.#geocoder.geocode({'location': position}, (results, status)  => {\n\t\t\t\tif (status === 'OK' && results[0])\n\t\t\t\t{\n\t\t\t\t\tresolve(results[0].place_id);\n\t\t\t\t}\n\t\t\t\telse if(status === 'ZERO_RESULTS')\n\t\t\t\t{\n\t\t\t\t\tresolve('');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow Error('Geocoder failed due to: ' + status);\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\t.then((placeId) => {\n\t\t\tlet result;\n\n\t\t\tif(placeId)\n\t\t\t{\n\t\t\t\tresult = this.#locationRepository.findByExternalId(\n\t\t\t\t\tplaceId,\n\t\t\t\t\tthis.#googleSource.sourceCode,\n\t\t\t\t\tthis.#languageId\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tresolve(null);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tupdate(location: Location)\n\t{\n\t\tlet position = this.#convertLocationToPosition(location);\n\t\tthis.#isUpdating = true;\n\t\tthis.#locationMarker.setPosition(position);\n\t\tthis.#isUpdating = false;\n\t\tthis.#googleMap.panTo(position);\n\t}\n\n\tonChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Map.#onChangedEvent, listener);\n\t}\n\n\t#emitOnChangedEvent(location: ?Location)\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.emit(Map.#onChangedEvent, { location: location\t});\n\t\t}\n\t}\n\n\t#onMarkerUpdatePosition()\n\t{\n\t\tif(!this.#isUpdating && this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#createTimer(this.#locationMarker.getPosition());\n\t\t}\n\t}\n\n\t#createTimer(position)\n\t{\n\t\tif(this.#timerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#timerId);\n\t\t}\n\n\t\tthis.#timerId = setTimeout(() => {\n\t\t\t\tthis.#timerId = null;\n\t\t\t\tthis.#googleMap.panTo(position);\n\t\t\t\tthis.#fulfillOnChangedEvent(position);\n\t\t\t},\n\t\t\tthis.#changeDelay\n\t\t);\n\t}\n\n\t#fulfillOnChangedEvent(position)\n\t{\n\t\tthis.#getPositionToLocationPromise(position)\n\t\t.then(this.#emitOnChangedEvent.bind(this));\n\t}\n\n\t#onMapClick(position)\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#locationMarker.setPosition(position);\n\t\t\tthis.#createTimer(position);\n\t\t}\n\t}\n\n\t#initGoogleMap(mapNode: Element, location: ?Location, zoom: number): void\n\t{\n\t\tif(typeof google === 'undefined' || typeof google.maps.Map === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Map must be defined');\n\t\t}\n\n\t\tlet position = this.#convertLocationToPosition(location);\n\n\t\tthis.#googleMap = new google.maps.Map(mapNode, {\n\t\t\tcenter: position,\n\t\t\tzoom: zoom\n\t\t});\n\n\t\tthis.#googleMap.addListener('click', (e) => {\n\t\t\tthis.#onMapClick(e.latLng);\n\t\t});\n\n\t\tthis.#googleMap.addListener('zoom_changed', (e) => {\n\t\t\tconsole.log('zoom_changed');\n\t\t\tconsole.log(this.#googleMap.getZoom());\n\t\t});\n\n\t\tif(typeof google.maps.Marker === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Marker must be defined');\n\t\t}\n\n\t\tthis.#locationMarker = new google.maps.Marker({\n\t\t\tposition: position,\n\t\t\tmap: this.#googleMap,\n\t\t\tanimation: google.maps.Animation.DROP,\n\t\t\tdraggable: this.#mode === ControlMode.edit,\n\t\t});\n\n\t\tthis.#locationMarker.addListener('position_changed', () => {\n\t\t\tthis.#onMarkerUpdatePosition();\n\t\t});\n\n\t\tif(typeof google.maps.Geocoder === 'undefined')\n\t\t{\n\t\t\tthrow new Error('google.maps.Geocoder must be defined');\n\t\t}\n\n\t\tthis.#geocoder = new google.maps.Geocoder;\n\t}\n\n\t#convertInnerZoomToGoogle(innerZoom: number)\n\t{\n\t\tlet result;\n\n\t\tif(innerZoom <= ZoomType.World)\n\t\t\tresult = 1;\n\t\telse if(innerZoom <= ZoomType.Country)\n\t\t\tresult = 4;\n\t\telse if(innerZoom <= ZoomType.Region)\n\t\t\tresult = 6;\n\t\telse if(innerZoom <= ZoomType.City)\n\t\t\tresult = 11;\n\t\telse if(innerZoom <= ZoomType.Street)\n\t\t\tresult = 16;\n\t\telse\n\t\t\tresult = 18;\n\n\t\treturn result;\n\t}\n\n\t#convertGoogleZoomToInner(gZoom: number)\n\t{\n\t\tlet result;\n\n\t\tif(gZoom <= 5)\n\t\t\tresult = ZoomType.World;\n\t\telse if(gZoom <= 7)\n\t\t\tresult = ZoomType.Country;\n\t\telse if(gZoom <= 9)\n\t\t\tresult = ZoomType.Region;\n\t\telse if(gZoom <= 10)\n\t\t\tresult = ZoomType.City;\n\t\telse if(gZoom <= 15)\n\t\t\tresult = ZoomType.Street;\n\t\telse if(gZoom > 15)\n\t\t\tresult = ZoomType.Building;\n\n\t\treturn result;\n\t}\n\n\tset zoom(innerZoom: number): void\n\t{\n\t\tif(this.#googleMap)\n\t\t{\n\t\t\tthis.#googleMap.setZoom(\n\t\t\t\tthis.#convertInnerZoomToGoogle(innerZoom)\n\t\t\t);\n\t\t}\n\t}\n\n\tget zoom(): number\n\t{\n\t\tif(this.#googleMap)\n\t\t{\n\t\t\treturn this.#convertGoogleZoomToInner(\n\t\t\t\tthis.#googleMap.getZoom()\n\t\t\t);\n\t\t}\n\t}\n}","import Loader from \"./loader\";\nimport Autocompleter from \"./autocompleter\";\nimport Map from \"./map\";\n\nexport default class GoogleSource\n{\n\t#code = 'GOOGLE';\n\t#languageId = '';\n\t#autocompleter = null;\n\t#loaderPromise = null;\n\t\n\tconstructor(props)\n\t{\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#loaderPromise = Loader.load(props.apiKey, props.languageId);\n\t}\n\n\tget autocompleter(): Autocompleter\n\t{\n\t\tif(this.#autocompleter === null)\n\t\t{\n\t\t\tthis.#autocompleter = this.#createAutocompleter(this.#languageId);\n\t\t}\n\n\t\treturn this.#autocompleter;\n\t}\n\n\tget sourceCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t#createAutocompleter(languageId: string)\n\t{\n\t\treturn new Autocompleter({\n\t\t\tsource: this,\n\t\t\tlanguageId: languageId,\n\t\t\tloaderPromise: this.#loaderPromise\n\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param {Element} mapContainer\n\t * @param {Location} location\n\t * @param mode\n\t * @param zoom\n\t * @return {MapBase}\n\t * todo: initial zoom\n\t */\n\tcreateMap(mapContainer: Element, location: Location, mode, zoom: number): Map\n\t{\n\t\treturn new Map({\n\t\t\tgoogleSource: this,\n\t\t\tlanguageId: this.#languageId,\n\t\t\tloaderPromise: this.#loaderPromise,\n\t\t\tmapContainer: mapContainer,\n\t\t\tlocation: location,\n\t\t\tmode: mode,\n\t\t\tzoom: zoom\n\t\t});\n\t}\n}","import GoogleSource from \"./google/googlesource\";\nimport {BaseSource} from \"location.core\";\n\n/**\n * Creates Source using code and source init params\n */\nexport default class SourceFactory\n{\n\tstatic createSource(sourceCode: string , sourceParams: Object): BaseSource\n\t{\n\t\t//todo: make the event for custom and tests sources.\n\t\tif(sourceCode === 'GOOGLE')\n\t\t{\n\t\t\tlet params = Object.assign({}, sourceParams);\n\t\t\tparams.languageId = BX.message('LANGUAGE_ID');\n\t\t\treturn new GoogleSource(params);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('WrongSourceType', 'Source \"' + sourceCode + '\" does not exist');\n\t\t}\n\t}\n}"],"names":["Loader","apiKey","languageId","Promise","resolve","BX","load","Autocompleter","props","source","loaderPromise","then","query","params","error","debug","result","storedResults","localStorage","getItem","JSON","parse","e","Array","isArray","entries","index","item","Object","assign","splice","push","setItem","stringify","answer","status","length","shift","getQueryPredictions","input","locationsList","google","maps","places","AutocompleteService","Error","data","location","Location","sourceCode","externalId","place_id","name","description","Map","googleSource","zoom","locationRepository","LocationRepository","defaultPosition","latitude","longitude","changeDelay","mode","mapContainer","position","setPosition","panTo","listener","subscribe","setDraggable","ControlMode","edit","innerZoom","setZoom","getZoom","EventEmitter","lat","lon","LatLng","geocode","results","placeId","findByExternalId","emit","getPosition","clearTimeout","setTimeout","_classPrivateMethodGet","bind","mapNode","center","addListener","latLng","console","log","Marker","map","animation","Animation","DROP","draggable","Geocoder","ZoomType","World","Country","Region","City","Street","gZoom","Building","GoogleSource","SourceFactory","sourceParams","message"],"mappings":";;;;;;;;;;;CAAA;;;KAGqBA;;;;;;;;;;CASpB;;;;;;0BAMYC,QAAgBC,YAC5B;CACC,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;CAE/B,4CAAGJ,MAAH,EAnBkBA,MAmBlB,uBACA;CACCI,UAAAA,OAAO;CACP;;CAEDC,QAAAA,EAAE,CAACC,IAAH,CACC,8BAACN,MAAD,EAzBiBA,MAyBjB,mBAACA,MAAD,EAAmBC,MAAnB,EAA2BC,UAA3B,EADD,EAEC,YAAM;CACL,0CAAAF,MAAM,EA3BUA,MA2BV,sBAAsB,IAAtB,CAAN;;CACAI,UAAAA,OAAO;CACP,SALF;CAOA,OAdM,CAAP;CAeA;;;;;sCA5BiBH,QAAQC,YAC1B;CACC,SAAO,iDAAiDD,MAAjD,GAA0D,6BAA1D,GAA0FC,UAAjG;CACA;;;;UAL2B;;;;;KCHRK;;;CAEpB;;CAEA;;CAEA;;CAEA;;CAEA;;CAEA;CAGA,yBAAYC,KAAZ,EACA;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA,aALmB;CAKnB;;CAAA;CAAA;CAAA,aAHwB;CAGxB;;CACC,yDAAmBA,KAAK,CAACN,UAAzB;CACA,qDAAeM,KAAK,CAACC,MAArB,EAFD;;CAIC,4DAAsBD,KAAK,CAACE,aAAN,CACpBC,IADoB,CACf,YAAM;CACX,6BAAA,KAAI,sDAAJ,MAAA,KAAI;CACJ,KAHoB,CAAtB;CAIA;;;;;CAwGD;;;;;;kCAMaC,OAAcC,QAC3B;CAAA;;CACC;CACA,aAAO,wDACLF,IADK,CACA,YAAM;CACX,sCAAO,MAAP,sDAAO,MAAP,EAAkCC,KAAlC,EAAyCC,MAAzC;CACA,OAHK,EAIN,UAAAC,KAAK;CAAA,eAAIT,EAAE,CAACU,KAAH,CAASD,KAAT,CAAJ;CAAA,OAJC,CAAP;CAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gEArHsBF,OAAOC,QAC9B;CACC,MAAIG,MAAM,GAAG,IAAb;CAAA,MACCC,aAAa,GAAGC,YAAY,CAACC,OAAb,mCAAqB,IAArB,oBADjB;;CAGA,MAAGF,aAAH,EACA;CACC,QAAI;CACHA,MAAAA,aAAa,GAAGG,IAAI,CAACC,KAAL,CAAWJ,aAAX,CAAhB;CACA,KAFD,CAGA,OAAOK,CAAP,EAAU;CACT,aAAO,IAAP;CACA;;CAED,QAAGC,KAAK,CAACC,OAAN,CAAcP,aAAd,CAAH,EACA;CAAA;CAAA;CAAA;;CAAA;CACC,6BAA2BA,aAAa,CAACQ,OAAd,EAA3B,8HACA;CAAA;CAAA,cADWC,KACX;CAAA,cADkBC,IAClB;;CACC,cAAGA,IAAI,IAAI,OAAOA,IAAI,CAACf,KAAZ,KAAsB,WAA9B,IAA6Ce,IAAI,CAACf,KAAL,KAAeA,KAA/D,EACA;CACCI,YAAAA,MAAM,GAAGY,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBF,IAAlB,CAAT;CACAV,YAAAA,aAAa,CAACa,MAAd,CAAqBJ,KAArB,EAA4B,CAA5B;CACAT,YAAAA,aAAa,CAACc,IAAd,CAAmBf,MAAnB;CACAE,YAAAA,YAAY,CAACc,OAAb,mCAAqB,IAArB,qBAA4CZ,IAAI,CAACa,SAAL,CAAehB,aAAf,CAA5C;CACA;CACA;CACD;CAXF;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAYC;CACD;;CACD,SAAOD,MAAP;CACA;;sFAEiCJ,OAAOC,QACzC;CAAA;;CACC,MAAIG,MAAM,GAAG,IAAb;CAAA,MACCkB,MAAM,0BAAG,IAAH,wDAAG,IAAH,EAA+BtB,KAA/B,EAAsCC,MAAtC,CADP;;CAGA,MAAGqB,MAAM,KAAK,IAAd,EACA;CACClB,IAAAA,MAAM,GAAG,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAa;CAChCA,MAAAA,OAAO,wBACN,MADM,0DACN,MADM,EACuB8B,MAAM,CAACA,MAD9B,EACsCA,MAAM,CAACC,MAD7C,EAAP;CAGA,KAJO,CAAT;CAMA;;CAED,SAAOnB,MAAP;CACA;;4DAEoBJ,OAAOC,QAAQqB,QAAQC,QAC5C;CACC,MAAIlB,aAAa,GAAGC,YAAY,CAACC,OAAb,mCAAqB,IAArB,oBAApB;;CAEA,MAAGF,aAAH,EACA;CACC,QAAI;CACHA,MAAAA,aAAa,GAAGG,IAAI,CAACC,KAAL,CAAWJ,aAAX,CAAhB;CACA,KAFD,CAGA,OAAOK,CAAP,EAAU;CACT;CACA;CACD;;CAED,MAAG,CAACC,KAAK,CAACC,OAAN,CAAcP,aAAd,CAAJ,EACA;CACCA,IAAAA,aAAa,GAAG,EAAhB;CACA;;CAEDA,EAAAA,aAAa,CAACc,IAAd,CAAmB;CAClBI,IAAAA,MAAM,EAAEA,MADU;CAElBvB,IAAAA,KAAK,EAAEA,KAFW;CAGlBsB,IAAAA,MAAM,EAAEA;CAHU,GAAnB;;CAMA,MAAGjB,aAAa,CAACmB,MAAd,qCAAuB,IAAvB,wBAAH,EACA;CACCnB,IAAAA,aAAa,CAACoB,KAAd;CACA;;CAEDnB,EAAAA,YAAY,CAACc,OAAb,mCAAqB,IAArB,qBAA4CZ,IAAI,CAACa,SAAL,CAAehB,aAAf,CAA5C;CACA;;8DAEqBL,OAAOC,QAC7B;CAAA;;CACC,MAAIG,MAAM,0BAAG,IAAH,8EAAG,IAAH,EAA0CJ,KAA1C,EAAiDC,MAAjD,CAAV;;CAEA,MAAG,CAACG,MAAJ,EACA;CACCA,IAAAA,MAAM,GAAG,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAa;CAChC,wCAAA,MAAI,6BAAJ,CAAgCkC,mBAAhC,CAAoD;CAACC,QAAAA,KAAK,EAAE3B;CAAR,OAApD,EAAoE,UAACI,MAAD,EAASmB,MAAT,EAAoB;CACvF,YAAIK,aAAa,0BAAG,MAAH,0DAAG,MAAH,EAAgCxB,MAAhC,EAAwCmB,MAAxC,CAAjB;;CACA,+BAAA,MAAI,8CAAJ,MAAA,MAAI,EAAsBvB,KAAtB,EAA6BC,MAA7B,EAAqCG,MAArC,EAA6CmB,MAA7C,CAAJ;;CACA/B,QAAAA,OAAO,CAACoC,aAAD,CAAP;CACA,OAJD;CAKA,KANO,CAAT;CAQA;;CAED,SAAOxB,MAAP;CACA;;sEAoBD;CACC,MAAG,OAAOyB,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACC,IAAP,CAAYC,MAAZ,CAAmBC,mBAA1B,KAAkD,WAAtF,EACA;CACC,UAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;CACA;;CAED,sEAAkC,IAAIJ,MAAM,CAACC,IAAP,CAAYC,MAAZ,CAAmBC,mBAAvB,EAAlC;CACA;;kEAEuBE,MAAMX,QAC9B;CACC,MAAGA,MAAM,KAAK,cAAd,EACA;CACC,WAAO,EAAP;CACA;;CAED,MAAG,CAACW,IAAD,IAASX,MAAM,KAAK,IAAvB,EACA;CACC,WAAO,KAAP;CACA;;CAED,MAAInB,MAAM,GAAG,EAAb;CAXD;CAAA;CAAA;;CAAA;CAaC,0BAAiB8B,IAAjB,mIAAuB;CAAA,UAAdnB,IAAc;CACtB,UAAMoB,QAAQ,GAAG,IAAIC,sBAAJ,CAAa;CAC7BC,QAAAA,UAAU,EAAE,iDAAaA,UADI;CAE7BC,QAAAA,UAAU,EAAEvB,IAAI,CAACwB,QAFY;CAG7BC,QAAAA,IAAI,EAAEzB,IAAI,CAAC0B,WAHkB;CAI7BnD,QAAAA,UAAU,oCAAE,IAAF;CAJmB,OAAb,CAAjB;CAOAc,MAAAA,MAAM,CAACe,IAAP,CAAYgB,QAAZ;CACA;CAtBF;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;;CAwBC,SAAO/B,MAAP;CACA;;;;;CCpLF;;;;KAGqBsC;;;;;CAIpB;;CAEA;;CAEA;;CAEA;;CAEA;;CAEA;;CAEA;CAUA,eAAY9C,KAAZ,EACA;CAAA;;CAAA;CACC,qGAAMA,KAAN;;CADD;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA,aAJW;CAIX;;CAAA;CAAA;CAAA,aAHc;CAGd;;CAEC,gGAAmBA,KAAK,CAACN,UAAzB;CACA,gGAAqBM,KAAK,CAAC+C,YAA3B;CACA,wFAAa/C,KAAK,CAACgD,IAAN,IAAc,EAA3B;;CACA,QAAIT,SAAQ,GAAGvC,KAAK,CAACuC,QAAN,IAAkB,IAAjC;;CACA,sGAA2BvC,KAAK,CAACiD,kBAAN,IAA4B,IAAIC,gCAAJ,EAAvD;CACA,mGAAwBlD,KAAK,CAACmD,eAAN,IAAyB;CAACC,MAAAA,QAAQ,EAAE,SAAX;CAAsBC,MAAAA,SAAS,EAAE;CAAjC,KAAjD;CACA,+FAAoBrD,KAAK,CAACsD,WAAN,IAAqB,GAAzC;CACA,wFAAatD,KAAK,CAACuD,IAAnB,EATD;;CAYC,mGAAsBvD,KAAK,CAACE,aAAN,CACpBC,IADoB,CACf,YAAM;CACX,2JAAoBH,KAAK,CAACwD,YAA1B,EAAwCjB,SAAxC;CACA,KAHoB,CAAtB;CAZD;CAgBC;;;;4BAkEMA,UACP;CACC,UAAIkB,QAAQ,4BAAG,IAAH,gEAAG,IAAH,EAAmClB,QAAnC,CAAZ;;CACA,2DAAmB,IAAnB;CACA,+DAAqBmB,WAArB,CAAiCD,QAAjC;CACA,2DAAmB,KAAnB;CACA,0DAAgBE,KAAhB,CAAsBF,QAAtB;CACA;;;6CAEuBG,UACxB;CACC,WAAKC,SAAL,mCAAef,GAAf,EAxHmBA,GAwHnB,oBAAoCc,QAApC;CACA;;;uBA5EQL,MACT;CACC,qDAAaA,IAAb;CACA,+DAAqBO,YAArB,CAAkCP,IAAI,KAAKQ,yBAAW,CAACC,IAAvD;CACA;;;uBAgNQC,WACT;CACC,4CAAG,IAAH,eACA;CACC,4DAAgBC,OAAhB,0BACC,IADD,8DACC,IADD,EACgCD,SADhC;CAGA;CACD;yBAGD;CACC,4CAAG,IAAH,eACA;CACC,wCAAO,IAAP,8DAAO,IAAP,EACC,oDAAgBE,OAAhB,EADD;CAGA;CACD;;;GAnR+BC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAEP;;;wEAiDE7B,UAC3B;CACC,MAAI8B,GAAJ,EAASC,GAAT;;CAEA,MAAG/B,QAAH,EACA;CACC8B,IAAAA,GAAG,GAAG9B,QAAQ,CAACa,QAAf;CACAkB,IAAAA,GAAG,GAAG/B,QAAQ,CAACc,SAAf;CACA,GAJD,MAMA;CACCgB,IAAAA,GAAG,GAAG,0DAAsBjB,QAA5B;CACAkB,IAAAA,GAAG,GAAG,0DAAsBjB,SAA5B;CACA;;CAED,SAAO,IAAIpB,MAAM,CAACC,IAAP,CAAYqC,MAAhB,CAAuBF,GAAvB,EAA4BC,GAA5B,CAAP;CACA;;8EAE6Bb,UAC9B;CAAA;;CACC,SAAO,IAAI9D,OAAJ,CAAa,UAACC,OAAD,EAAa;CAChC,sCAAA,MAAI,YAAJ,CAAe4E,OAAf,CAAuB;CAAC,kBAAYf;CAAb,KAAvB,EAA+C,UAACgB,OAAD,EAAU9C,MAAV,EAAsB;CACpE,UAAIA,MAAM,KAAK,IAAX,IAAmB8C,OAAO,CAAC,CAAD,CAA9B,EACA;CACC7E,QAAAA,OAAO,CAAC6E,OAAO,CAAC,CAAD,CAAP,CAAW9B,QAAZ,CAAP;CACA,OAHD,MAIK,IAAGhB,MAAM,KAAK,cAAd,EACL;CACC/B,QAAAA,OAAO,CAAC,EAAD,CAAP;CACA,OAHI,MAKL;CACC,cAAMyC,KAAK,CAAC,6BAA6BV,MAA9B,CAAX;CACA;CACD,KAbD;CAcA,GAfM,EAgBNxB,IAhBM,CAgBD,UAACuE,OAAD,EAAa;CAClB,QAAIlE,MAAJ;;CAEA,QAAGkE,OAAH,EACA;CACClE,MAAAA,MAAM,GAAG,kCAAA,MAAI,sBAAJ,CAAyBmE,gBAAzB,CACRD,OADQ,EAER,kCAAA,MAAI,gBAAJ,CAAmBjC,UAFX,oCAGR,MAHQ,iBAAT;CAKA,KAPD,MASA;CACCjC,MAAAA,MAAM,GAAG,IAAIb,OAAJ,CAAY,UAACC,OAAD,EAAa;CACjCA,QAAAA,OAAO,CAAC,IAAD,CAAP;CACA,OAFQ,CAAT;CAGA;;CAED,WAAOY,MAAP;CACA,GAnCM,CAAP;CAoCA;;0DAgBmB+B,UACpB;CACC,MAAG,mDAAewB,yBAAW,CAACC,IAA9B,EACA;CACC,SAAKY,IAAL,mCAAU9B,GAAV,EA/HkBA,GA+HlB,oBAA+B;CAAEP,MAAAA,QAAQ,EAAEA;CAAZ,KAA/B;CACA;CACD;;oEAGD;CACC,MAAG,mCAAC,IAAD,kBAAqB,mDAAewB,yBAAW,CAACC,IAAnD,EACA;CACC,2EAAkB,yDAAqBa,WAArB,EAAlB;CACA;CACD;;4CAEYpB,UACb;CAAA;;CACC,MAAG,sDAAkB,IAArB,EACA;CACCqB,IAAAA,YAAY,mCAAC,IAAD,YAAZ;CACA;;CAED,oDAAgBC,UAAU,CAAC,YAAM;CAC/B,sCAAA,MAAI,YAAY,IAAZ,CAAJ;CACA,sCAAA,MAAI,aAAJ,CAAgBpB,KAAhB,CAAsBF,QAAtB;;CACA,6BAAA,MAAI,kDAAJ,MAAA,MAAI,EAAwBA,QAAxB,CAAJ;CACA,GAJwB,oCAKzB,IALyB,gBAA1B;CAOA;;gEAEsBA,UACvB;CACC,2GAAmCA,QAAnC,EACCtD,IADD,CACM6E,0EAAyBC,IAAzB,CAA8B,IAA9B,CADN;CAEA;;0CAEWxB,UACZ;CACC,MAAG,mDAAeM,yBAAW,CAACC,IAA9B,EACA;CACC,6DAAqBN,WAArB,CAAiCD,QAAjC;;CACA,2EAAkBA,QAAlB;CACA;CACD;;gDAEcyB,SAAkB3C,UAAqBS,MACtD;CAAA;;CACC,MAAG,OAAOf,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACC,IAAP,CAAYY,GAAnB,KAA2B,WAA/D,EACA;CACC,UAAM,IAAIT,KAAJ,CAAU,iCAAV,CAAN;CACA;;CAED,MAAIoB,QAAQ,4BAAG,IAAH,gEAAG,IAAH,EAAmClB,QAAnC,CAAZ;;CAEA,sDAAkB,IAAIN,MAAM,CAACC,IAAP,CAAYY,GAAhB,CAAoBoC,OAApB,EAA6B;CAC9CC,IAAAA,MAAM,EAAE1B,QADsC;CAE9CT,IAAAA,IAAI,EAAEA;CAFwC,GAA7B,CAAlB;CAKA,sDAAgBoC,WAAhB,CAA4B,OAA5B,EAAqC,UAACtE,CAAD,EAAO;CAC3C,6BAAA,MAAI,4BAAJ,MAAA,MAAI,EAAaA,CAAC,CAACuE,MAAf,CAAJ;CACA,GAFD;CAIA,sDAAgBD,WAAhB,CAA4B,cAA5B,EAA4C,UAACtE,CAAD,EAAO;CAClDwE,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;CACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,kCAAA,MAAI,aAAJ,CAAgBpB,OAAhB,EAAZ;CACA,GAHD;;CAKA,MAAG,OAAOlC,MAAM,CAACC,IAAP,CAAYsD,MAAnB,KAA8B,WAAjC,EACA;CACC,UAAM,IAAInD,KAAJ,CAAU,oCAAV,CAAN;CACA;;CAED,2DAAuB,IAAIJ,MAAM,CAACC,IAAP,CAAYsD,MAAhB,CAAuB;CAC7C/B,IAAAA,QAAQ,EAAEA,QADmC;CAE7CgC,IAAAA,GAAG,oCAAE,IAAF,aAF0C;CAG7CC,IAAAA,SAAS,EAAEzD,MAAM,CAACC,IAAP,CAAYyD,SAAZ,CAAsBC,IAHY;CAI7CC,IAAAA,SAAS,EAAE,mDAAe9B,yBAAW,CAACC;CAJO,GAAvB,CAAvB;CAOA,2DAAqBoB,WAArB,CAAiC,kBAAjC,EAAqD,YAAM;CAC1D,6BAAA,MAAI,oDAAJ,MAAA,MAAI;CACJ,GAFD;;CAIA,MAAG,OAAOnD,MAAM,CAACC,IAAP,CAAY4D,QAAnB,KAAgC,WAAnC,EACA;CACC,UAAM,IAAIzD,KAAJ,CAAU,sCAAV,CAAN;CACA;;CAED,qDAAiB,IAAIJ,MAAM,CAACC,IAAP,CAAY4D,QAAhB,EAAjB;CACA;;sEAEyB7B,WAC1B;CACC,MAAIzD,MAAJ;CAEA,MAAGyD,SAAS,IAAI8B,sBAAQ,CAACC,KAAzB,EACCxF,MAAM,GAAG,CAAT,CADD,KAEK,IAAGyD,SAAS,IAAI8B,sBAAQ,CAACE,OAAzB,EACJzF,MAAM,GAAG,CAAT,CADI,KAEA,IAAGyD,SAAS,IAAI8B,sBAAQ,CAACG,MAAzB,EACJ1F,MAAM,GAAG,CAAT,CADI,KAEA,IAAGyD,SAAS,IAAI8B,sBAAQ,CAACI,IAAzB,EACJ3F,MAAM,GAAG,EAAT,CADI,KAEA,IAAGyD,SAAS,IAAI8B,sBAAQ,CAACK,MAAzB,EACJ5F,MAAM,GAAG,EAAT,CADI,KAGJA,MAAM,GAAG,EAAT;CAED,SAAOA,MAAP;CACA;;sEAEyB6F,OAC1B;CACC,MAAI7F,MAAJ;CAEA,MAAG6F,KAAK,IAAI,CAAZ,EACC7F,MAAM,GAAGuF,sBAAQ,CAACC,KAAlB,CADD,KAEK,IAAGK,KAAK,IAAI,CAAZ,EACJ7F,MAAM,GAAGuF,sBAAQ,CAACE,OAAlB,CADI,KAEA,IAAGI,KAAK,IAAI,CAAZ,EACJ7F,MAAM,GAAGuF,sBAAQ,CAACG,MAAlB,CADI,KAEA,IAAGG,KAAK,IAAI,EAAZ,EACJ7F,MAAM,GAAGuF,sBAAQ,CAACI,IAAlB,CADI,KAEA,IAAGE,KAAK,IAAI,EAAZ,EACJ7F,MAAM,GAAGuF,sBAAQ,CAACK,MAAlB,CADI,KAEA,IAAGC,KAAK,GAAG,EAAX,EACJ7F,MAAM,GAAGuF,sBAAQ,CAACO,QAAlB;CAED,SAAO9F,MAAP;CACA;;;;KCjQmB+F;;;CAOpB,wBAAYvG,KAAZ,EACA;CAAA;;CAAA;;CAAA;CAAA;CAAA,aANQ;CAMR;;CAAA;CAAA;CAAA,aALc;CAKd;;CAAA;CAAA;CAAA,aAJiB;CAIjB;;CAAA;CAAA;CAAA,aAHiB;CAGjB;;CACC,2DAAmBA,KAAK,CAACN,UAAzB;CACA,8DAAsBF,MAAM,CAACM,IAAP,CAAYE,KAAK,CAACP,MAAlB,EAA0BO,KAAK,CAACN,UAAhC,CAAtB;CACA;;;;;CA0BD;;;;;;;;;+BASU8D,cAAuBjB,UAAoBgB,MAAMP,MAC3D;CACC,aAAO,IAAIF,GAAJ,CAAQ;CACdC,QAAAA,YAAY,EAAE,IADA;CAEdrD,QAAAA,UAAU,oCAAE,IAAF,gBAFI;CAGdQ,QAAAA,aAAa,oCAAE,IAAF,mBAHC;CAIdsD,QAAAA,YAAY,EAAEA,YAJA;CAKdjB,QAAAA,QAAQ,EAAEA,QALI;CAMdgB,QAAAA,IAAI,EAAEA,IANQ;CAOdP,QAAAA,IAAI,EAAEA;CAPQ,OAAR,CAAP;CASA;;;yBA3CD;CACC,UAAG,4DAAwB,IAA3B,EACA;CACC,yFAAsB,IAAtB,oDAAsB,IAAtB,oCAAgD,IAAhD;CACA;;CAED,+CAAO,IAAP;CACA;;;yBAGD;CACC,+CAAO,IAAP;CACA;;;;;;;;;;;;;;;4DAEoBtD,YACrB;CACC,SAAO,IAAIK,aAAJ,CAAkB;CACxBE,IAAAA,MAAM,EAAE,IADgB;CAExBP,IAAAA,UAAU,EAAEA,UAFY;CAGxBQ,IAAAA,aAAa,oCAAE,IAAF;CAHW,GAAlB,CAAP;CAKA;;CCpCF;;;;KAGqBsG;;;;;;;;;kCAEA/D,YAAqBgE,cACzC;CACC;CACA,UAAGhE,UAAU,KAAK,QAAlB,EACA;CACC,YAAIpC,MAAM,GAAGe,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBoF,YAAlB,CAAb;CACApG,QAAAA,MAAM,CAACX,UAAP,GAAoBG,EAAE,CAAC6G,OAAH,CAAW,aAAX,CAApB;CACA,eAAO,IAAIH,YAAJ,CAAiBlG,MAAjB,CAAP;CACA,OALD,MAOA;CACC,cAAM,IAAIgC,KAAJ,CAAU,iBAAV,EAA6B,aAAaI,UAAb,GAA0B,kBAAvD,CAAN;CACA;CACD;;;;;;;;;;;"}