{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom, Loc} from 'main.core';\nimport {MenuManager} from 'main.popup';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmUpdateDynamicActivity\n{\n\tdocumentType: Array<string>;\n\tisRobot: boolean;\n\tentityTypeIdSelect: HTMLSelectElement;\n\tfieldsListSelect: HTMLSelectElement;\n\tentitiesFieldsContainers: HTMLDivElement | HTMLTableElement;\n\n\tfilterFieldsContainer: HTMLDivElement | null;\n\tfilteringFieldsPrefix: string;\n\tfilterFieldsMap: Map<string, object>;\n\tconditionGroup: BX.Bizproc.Automation.ConditionGroup | undefined;\n\n\tcurrentEntityTypeId: number;\n\tfieldsMap: Map<string, object>;\n\tcurrentValues: Map<string, object>;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.documentType = options.documentType;\n\t\t\tthis.isRobot = options.isRobot;\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.entityTypeIdSelect = form.dynamic_type_id;\n\t\t\t\tthis.currentEntityTypeId = this.entityTypeIdSelect.value;\n\t\t\t\tthis.entityTypeDependentElements = document.querySelectorAll(\n\t\t\t\t\t'[data-role=\"bca-cuda-entity-type-id-dependent\"]',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.isRobot)\n\t\t\t{\n\t\t\t\tthis.fieldsListSelect = document.querySelector('[data-role=\"bca-cuda-fields-list\"]');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.addConditionButton = document.querySelector('[data-role=\"bca_cuda_add_condition\"]');\n\t\t\t}\n\t\t\tthis.entitiesFieldsContainers = document.querySelector('[data-role=\"bca-cuda-fields-container\"]');\n\t\t\tthis.conditinIdPrefix = 'id_bca_cuda_field_';\n\n\t\t\tthis.fieldsMap = new Map(Object.entries(options.fieldsMap));\n\n\t\t\tthis.filterFieldsContainer = document.querySelector('[data-role=\"bca-cuda-filter-fields-container\"]');\n\t\t\tthis.filteringFieldsPrefix = options.filteringFieldsPrefix;\n\t\t\tthis.filterFieldsMap = new Map(Object.entries(options.filterFieldsMap));\n\t\t\tif (!Type.isNil(options.documentName))\n\t\t\t{\n\t\t\t\tBX.Bizproc.Automation.API.documentName = options.documentName;\n\t\t\t}\n\t\t\tif (BX.Bizproc.Automation && BX.Bizproc.Automation.ConditionGroup)\n\t\t\t{\n\t\t\t\tthis.conditionGroup = new BX.Bizproc.Automation.ConditionGroup(options.conditions);\n\t\t\t}\n\n\t\t\tthis.currentValues = new Map();\n\t\t\tArray\n\t\t\t\t.from(this.fieldsMap.keys())\n\t\t\t\t.forEach((entityTypeId) => this.currentValues.set(entityTypeId, {}));\n\n\t\t\tif (!Type.isNil(this.currentEntityTypeId) && Type.isObject(options.currentValues))\n\t\t\t{\n\t\t\t\tthis.currentValues.set(this.currentEntityTypeId, options.currentValues);\n\t\t\t}\n\t\t\tthis.render();\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tif (\n\t\t\tthis.entityTypeIdSelect\n\t\t\t&& this.fieldsMap\n\t\t\t&& this.entitiesFieldsContainers\n\t\t)\n\t\t{\n\t\t\tEvent.bind(this.entityTypeIdSelect, 'change', this.onEntityTypeIdChange.bind(this));\n\t\t}\n\n\t\tif (this.isRobot && this.fieldsListSelect)\n\t\t{\n\t\t\tEvent.bind(this.fieldsListSelect, 'click', this.onFieldsListSelectClick.bind(this));\n\t\t}\n\t\telse if (!this.isRobot && this.addConditionButton)\n\t\t{\n\t\t\tEvent.bind(this.addConditionButton, 'click', this.onAddConditionButtonClick.bind(this));\n\t\t}\n\t}\n\n\tonEntityTypeIdChange(): void\n\t{\n\t\tthis.currentEntityTypeId = this.entityTypeIdSelect.value;\n\n\t\tDom.clean(this.filterFieldsContainer);\n\t\tif (BX.Bizproc.Automation && BX.Bizproc.Automation.ConditionGroup)\n\t\t{\n\t\t\tthis.conditionGroup = new BX.Bizproc.Automation.ConditionGroup();\n\t\t}\n\n\t\tArray\n\t\t\t.from(this.entitiesFieldsContainers.children)\n\t\t\t.forEach((elem) => Dom.remove(elem));\n\n\t\tthis.render();\n\t}\n\n\trender(): void\n\t{\n\t\tif (Type.isNil(this.currentEntityTypeId) || this.currentEntityTypeId === '')\n\t\t{\n\t\t\tthis.entityTypeDependentElements.forEach((element) => Dom.hide(element));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.entityTypeDependentElements.forEach((element) => Dom.show(element));\n\t\t\tthis.renderFilterFields();\n\t\t\tthis.renderEntityFields();\n\t\t}\n\t}\n\n\trenderFilterFields(): void\n\t{\n\t\tif (\n\t\t\t!Type.isNil(this.conditionGroup)\n\t\t\t&& !Type.isNil(this.currentEntityTypeId)\n\t\t)\n\t\t{\n\t\t\tconst selector = new BX.Bizproc.Automation.ConditionGroupSelector(this.conditionGroup, {\n\t\t\t\tfields: Object.values(this.filterFieldsMap.get(this.currentEntityTypeId)),\n\t\t\t\tfieldPrefix: this.filteringFieldsPrefix,\n\t\t\t});\n\n\t\t\tthis.filterFieldsContainer.appendChild(selector.createNode());\n\t\t}\n\t}\n\n\trenderEntityFields(): void\n\t{\n\t\tObject\n\t\t\t.keys(this.currentValues.get(this.currentEntityTypeId))\n\t\t\t.forEach((fieldId) => this.addCondition(fieldId));\n\t}\n\n\tonFieldsListSelectClick(event)\n\t{\n\t\tconst fields = this.fieldsMap.get(this.currentEntityTypeId);\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\treturn event.preventDefault();\n\t\t}\n\n\t\tconst activity = this;\n\t\tconst menuItems = Object.entries(fields).map(([fieldId, field]) => ({\n\t\t\tfieldId,\n\t\t\ttext: field.Name,\n\t\t\tonclick(_, item)\n\t\t\t{\n\t\t\t\tthis.popupWindow.close();\n\t\t\t\tactivity.addCondition(item.fieldId);\n\t\t\t},\n\t\t}));\n\n\t\tconst menuManagerOptions = {\n\t\t\tid: Math.random().toString(),\n\t\t\tbindElement: this.fieldsListSelect,\n\t\t\titems: Array.from(menuItems),\n\t\t\tautoHide: true,\n\t\t\toffsetLeft: Dom.getPosition(this.fieldsListSelect).width / 2,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: 0,\n\t\t\t},\n\t\t\tzIndex: 200,\n\t\t\tclassName: 'bizproc-automation-inline-selector-menu',\n\t\t\tevents: {\n\t\t\t\tonPopupClose()\n\t\t\t\t{\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tMenuManager.show(menuManagerOptions);\n\n\t\treturn event.preventDefault();\n\t}\n\n\tonAddConditionButtonClick(event): void\n\t{\n\t\tconst defaultFieldId = Object.keys(this.fieldsMap.get(this.currentEntityTypeId))[0];\n\t\tthis.addCondition(defaultFieldId);\n\n\t\treturn event.preventDefault();\n\t}\n\n\taddCondition(fieldId: string): void\n\t{\n\t\tif (this.isRobot)\n\t\t{\n\t\t\tthis.addRobotCondition(fieldId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addBizprocCondition(fieldId);\n\t\t}\n\t}\n\n\taddRobotCondition(fieldId: string): void\n\t{\n\t\tconst conditionId = this.conditinIdPrefix + fieldId;\n\n\t\tconst titleNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete',\n\t\t\t},\n\t\t\ttext: this.fieldsMap.get(this.currentEntityTypeId)[fieldId].Name,\n\t\t});\n\n\t\tconst deleteButton = Dom.create('a', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-delete bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-light',\n\t\t\t},\n\t\t\tprops: {href: '#'},\n\t\t\ttext: Loc.getMessage('CRM_UDA_DELETE_CONDITION'),\n\t\t\tevents: {\n\t\t\t\t// eslint-disable-next-line func-names\n\t\t\t\tclick: function(event) {\n\t\t\t\t\tthis.deleteCondition(fieldId);\n\t\t\t\t\treturn event.preventDefault();\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tconst fieldNode = Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings',\n\t\t\t},\n\t\t\tprops: {id: conditionId},\n\t\t\tchildren: [\n\t\t\t\ttitleNode,\n\t\t\t\tthis.renderField(fieldId),\n\t\t\t\tdeleteButton,\n\t\t\t],\n\t\t});\n\n\t\tthis.entitiesFieldsContainers.appendChild(fieldNode);\n\t}\n\n\tdeleteCondition(fieldId: string): void\n\t{\n\t\tconst conditionId = this.conditinIdPrefix + fieldId;\n\t\tDom.remove(document.getElementById(conditionId));\n\t}\n\n\taddBizprocCondition(fieldId: string): void\n\t{\n\t\tconst newConditionRow = this.entitiesFieldsContainers.insertRow(-1);\n\t\tnewConditionRow.id = this.conditinIdPrefix + Math.random().toString().substr(1, 5);\n\n\t\tconst activity = this;\n\n\t\tconst entityFieldSelect = Dom.create('select', {\n\t\t\tchildren: this.getCurrentFieldsOptions(fieldId),\n\t\t\tevents: {\n\t\t\t\tchange(event) {\n\t\t\t\t\tconst fieldValueNode = newConditionRow.children[2];\n\t\t\t\t\tconst newFieldId = event.srcElement.value;\n\t\t\t\t\tnewConditionRow.replaceChild(activity.renderField(newFieldId), fieldValueNode);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst equalSignNode = Dom.create('span', {text: '='});\n\n\t\tconst entityFieldValueNode = this.renderField(fieldId);\n\n\t\tconst deleteConditionButton = Dom.create('a', {\n\t\t\tprops: {href: '#'},\n\t\t\ttext: Loc.getMessage('CRM_UDA_DELETE_CONDITION'),\n\t\t\tevents: {\n\t\t\t\tclick(event) {\n\t\t\t\t\tDom.remove(document.getElementById(newConditionRow.id));\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\t[entityFieldSelect, equalSignNode, entityFieldValueNode, deleteConditionButton].forEach(\n\t\t\t(node) => {\n\t\t\t\tnewConditionRow.insertCell(-1).appendChild(node);\n\t\t\t},\n\t\t);\n\t}\n\n\tgetCurrentFieldsOptions(selectedFieldId)\n\t{\n\t\treturn Object\n\t\t\t.entries(this.fieldsMap.get(this.currentEntityTypeId))\n\t\t\t.map(\n\t\t\t\t([fieldId, field]) => {\n\t\t\t\t\treturn Dom.create('option', {\n\t\t\t\t\t\tprops: {value: field.FieldName},\n\t\t\t\t\t\tattrs: selectedFieldId === fieldId ? {selected: 'selected'} : undefined,\n\t\t\t\t\t\ttext: field.Name,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t);\n\t}\n\n\trenderField(fieldId: string): HTMLElement\n\t{\n\t\tlet value = this.currentValues.get(this.currentEntityTypeId)[fieldId];\n\t\tif (Type.isNil(value))\n\t\t{\n\t\t\tvalue = '';\n\t\t}\n\n\t\treturn BX.Bizproc.FieldType.renderControl(\n\t\t\tthis.documentType,\n\t\t\tthis.fieldsMap.get(this.currentEntityTypeId)[fieldId],\n\t\t\tfieldId,\n\t\t\tvalue,\n\t\t\tthis.isRobot ? 'public' : 'designer',\n\t\t);\n\t}\n}\n\nnamespace.CrmUpdateDynamicActivity = CrmUpdateDynamicActivity;"],"names":["namespace","Reflection","CrmUpdateDynamicActivity","options","Type","isPlainObject","documentType","isRobot","form","document","forms","formName","isNil","entityTypeIdSelect","dynamic_type_id","currentEntityTypeId","value","entityTypeDependentElements","querySelectorAll","fieldsListSelect","querySelector","addConditionButton","entitiesFieldsContainers","conditinIdPrefix","fieldsMap","Map","Object","entries","filterFieldsContainer","filteringFieldsPrefix","filterFieldsMap","documentName","BX","Bizproc","Automation","API","ConditionGroup","conditionGroup","conditions","currentValues","Array","from","keys","forEach","entityTypeId","set","isObject","render","Event","bind","onEntityTypeIdChange","onFieldsListSelectClick","onAddConditionButtonClick","Dom","clean","children","elem","remove","element","hide","show","renderFilterFields","renderEntityFields","selector","ConditionGroupSelector","fields","values","get","fieldPrefix","appendChild","createNode","fieldId","addCondition","event","preventDefault","activity","menuItems","map","field","text","Name","onclick","_","item","popupWindow","close","menuManagerOptions","id","Math","random","toString","bindElement","items","autoHide","offsetLeft","getPosition","width","angle","position","offset","zIndex","className","events","onPopupClose","destroy","MenuManager","defaultFieldId","addRobotCondition","addBizprocCondition","conditionId","titleNode","create","attrs","deleteButton","props","href","Loc","getMessage","click","deleteCondition","fieldNode","renderField","getElementById","newConditionRow","insertRow","substr","entityFieldSelect","getCurrentFieldsOptions","change","fieldValueNode","newFieldId","srcElement","replaceChild","equalSignNode","entityFieldValueNode","deleteConditionButton","node","insertCell","selectedFieldId","FieldName","selected","undefined","FieldType","renderControl"],"mappings":"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"}