this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,s,a,l,i,o,r){"use strict";let n=e=>e,c,d,b;const p=a.Reflection.namespace("BX.Crm.Activity");var v=babelHelpers.classPrivateFieldLooseKey("isRobot");var u=babelHelpers.classPrivateFieldLooseKey("colorSelector");var h=babelHelpers.classPrivateFieldLooseKey("colorId");var P=babelHelpers.classPrivateFieldLooseKey("locationSelectorWrapper");var L=babelHelpers.classPrivateFieldLooseKey("additionalSettingsButton");var F=babelHelpers.classPrivateFieldLooseKey("documentFields");var f=babelHelpers.classPrivateFieldLooseKey("additionalSettingsWrapper");var g=babelHelpers.classPrivateFieldLooseKey("documentType");var B=babelHelpers.classPrivateFieldLooseKey("additionalSettingsFields");var m=babelHelpers.classPrivateFieldLooseKey("dataConfig");var y=babelHelpers.classPrivateFieldLooseKey("fileSelector");var H=babelHelpers.classPrivateFieldLooseKey("fileControl");var C=babelHelpers.classPrivateFieldLooseKey("diskControl");var O=babelHelpers.classPrivateFieldLooseKey("diskControlItems");var T=babelHelpers.classPrivateFieldLooseKey("attachmentType");var E=babelHelpers.classPrivateFieldLooseKey("setOnBeforeSaveSettingsCallback");var _=babelHelpers.classPrivateFieldLooseKey("onBeforeSaveRobotSettings");var S=babelHelpers.classPrivateFieldLooseKey("onColorChanged");var A=babelHelpers.classPrivateFieldLooseKey("getLocationSelectorDialog");var D=babelHelpers.classPrivateFieldLooseKey("getLocationExpressionTag");var I=babelHelpers.classPrivateFieldLooseKey("renderLocation");var w=babelHelpers.classPrivateFieldLooseKey("fetchRoomsManagerData");var R=babelHelpers.classPrivateFieldLooseKey("prepareMenuItems");var j=babelHelpers.classPrivateFieldLooseKey("onAdditionalSettingsButtonClick");var M=babelHelpers.classPrivateFieldLooseKey("renderBaseControl");var N=babelHelpers.classPrivateFieldLooseKey("renderFile");var K=babelHelpers.classPrivateFieldLooseKey("removeControl");var k=babelHelpers.classPrivateFieldLooseKey("getCapacityTitle");var X=babelHelpers.classPrivateFieldLooseKey("getActionItemHtml");var x=babelHelpers.classPrivateFieldLooseKey("getColorSelector");var W=babelHelpers.classPrivateFieldLooseKey("onChangeAttachmentTypeHandler");var z=babelHelpers.classPrivateFieldLooseKey("openDiskFileDialog");var Y=babelHelpers.classPrivateFieldLooseKey("onSaveButtonClickHandler");var $=babelHelpers.classPrivateFieldLooseKey("renderAttachmentFile");var V=babelHelpers.classPrivateFieldLooseKey("assertValidOptions");class G{constructor(e){Object.defineProperty(this,V,{value:ue});Object.defineProperty(this,$,{value:ve});Object.defineProperty(this,Y,{value:pe});Object.defineProperty(this,z,{value:be});Object.defineProperty(this,W,{value:de});Object.defineProperty(this,x,{value:ce});Object.defineProperty(this,X,{value:ne});Object.defineProperty(this,k,{value:re});Object.defineProperty(this,K,{value:oe});Object.defineProperty(this,N,{value:ie});Object.defineProperty(this,M,{value:le});Object.defineProperty(this,j,{value:ae});Object.defineProperty(this,R,{value:se});Object.defineProperty(this,w,{value:te});Object.defineProperty(this,I,{value:ee});Object.defineProperty(this,D,{value:Z});Object.defineProperty(this,A,{value:Q});Object.defineProperty(this,S,{value:J});Object.defineProperty(this,_,{value:q});Object.defineProperty(this,E,{value:U});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.documentFields;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.isRobot===true;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.documentType;if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]){babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.additionalSettingsWrapper;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.additionalSettingsButton;a.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"click",babelHelpers.classPrivateFieldLooseBase(this,j)[j].bind(this));babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.dataConfig;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=babelHelpers.classPrivateFieldLooseBase(this,x)[x](e.colorSelectorWrapper,e.colorSettings,e.isAvailableColor);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.colorSettings.selectedValueId;l.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,u)[u],s.ColorSelectorEvents.EVENT_COLORSELECTOR_VALUE_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,S)[S].bind(this));babelHelpers.classPrivateFieldLooseBase(this,E)[E]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]={}}else if(e.attachmentType){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=e.fileControl;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e.diskControl;babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e.diskControlItems;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.attachmentType.value;a.Event.bind(e.attachmentType,"change",(e=>babelHelpers.classPrivateFieldLooseBase(this,W)[W](e.target.value)));a.Event.bind(e.showDiskFileDialogButton,"click",babelHelpers.classPrivateFieldLooseBase(this,z)[z].bind(this))}}async renderControl(e,t=null){if(babelHelpers.classPrivateFieldLooseBase(this,B)[B][e]||!(e in babelHelpers.classPrivateFieldLooseBase(this,F)[F])){return}if(e==="Colleagues"){this.renderControl("Duration")}const s=a.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"}});a.Dom.append(a.Dom.create("span",{text:babelHelpers.classPrivateFieldLooseBase(this,F)[F][e].Name,attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"}}),s);const l=a.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-delete bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-light"},props:{href:"#"},events:{click:t=>babelHelpers.classPrivateFieldLooseBase(this,K)[K](e,t)},text:a.Loc.getMessage("CRM_BP_CREATE_TODO_ADDITIONAL_FIELD_DELETE")});a.Dom.append(l,s);let i;if(e==="LocationId"){i=await babelHelpers.classPrivateFieldLooseBase(this,I)[I](t)}else if(e==="Attachment"){i=babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}else{i=babelHelpers.classPrivateFieldLooseBase(this,M)[M](e,t)}a.Dom.append(i,s);babelHelpers.classPrivateFieldLooseBase(this,B)[B][e]=s;a.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,B)[B][e],babelHelpers.classPrivateFieldLooseBase(this,f)[f])}}function U(){var e;if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return}const s=(e=t.Designer.getInstance())==null?void 0:e.getRobotSettingsDialog();if(s!=null&&s.robot){s.robot.setOnBeforeSaveRobotSettings(babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}}function q(){const e={color_id:babelHelpers.classPrivateFieldLooseBase(this,h)[h]};if(babelHelpers.classPrivateFieldLooseBase(this,B)[B].LocationId){var t;e.location_id=(t=this.locationSelectorDialog.getTags()[0])==null?void 0:t.id}return e}function J({data:e}){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.value}function Q(e){if(this.locations===null){return null}if(a.Type.isNil(this.locationSelectorDialog)){var t;const l=[{id:"location",title:a.Loc.getMessage("CRM_BP_CREATE_TODO_LOCATION_SELECTOR_ROOMS_ENTITY_TITLE")}];const i=[];(t=this.locations.rooms)==null?void 0:t.forEach((e=>{var t;i.push({id:e.ID,title:e.NAME,subtitle:babelHelpers.classPrivateFieldLooseBase(this,k)[k]((t=e.CAPACITY)!=null?t:null),entityId:"location",tabs:"location",avatarOptions:{bgColor:e.COLOR,bgSize:"22px",bgImage:"none"},customData:{locationId:e.LOCATION_ID}})}));this.locationSelectorDialog=new o.TagSelector({multiple:false,textBoxAutoHide:true,dialogOptions:{id:"todo-robot-calendar-room-selector-dialog",targetNode:babelHelpers.classPrivateFieldLooseBase(this,P)[P],context:"CRM_ACTIVITY_TODO_ROBOT_CALENDAR_ROOM",multiple:false,dropdownMode:true,showAvatars:true,enableSearch:true,width:450,height:300,zIndex:2500,items:i,tabs:l}});if(e){var s;const t=(s=i.find((t=>t.id===e)))!=null?s:babelHelpers.classPrivateFieldLooseBase(this,D)[D](e);this.locationSelectorDialog.addTag(t)}}return this.locationSelectorDialog}function Z(e){return{id:e,title:e,entityId:"location"}}async function ee(e){this.renderControl("Duration");this.locations=await babelHelpers.classPrivateFieldLooseBase(this,w)[w]();const t=a.Dom.create("div");babelHelpers.classPrivateFieldLooseBase(this,A)[A](e).renderTo(t);return t}async function te(){return new Promise((e=>{a.ajax.runAction("calendar.api.locationajax.getRoomsManagerData").then((t=>{e(t.data)})).catch((e=>{console.log(e)}))}))}function se(){const e=[];const t=this;e.push({html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("CALENDAR_1",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_CALENDAR")),onclick(){this.popupWindow.close();t.renderControl("Duration")}},{html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("PERSON",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_CLIENT")),onclick(){this.popupWindow.close();t.renderControl("Client","Y")}},{html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("PERSONS_2",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_COLLEAGUE")),fieldName:"Colleagues",onclick(){this.popupWindow.close();t.renderControl("Colleagues")}},{html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("LOCATION_1",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_ADDRESS")),onclick(){this.popupWindow.close();t.renderControl("Address")}});if("LocationId"in babelHelpers.classPrivateFieldLooseBase(this,F)[F]){e.push({html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("CHATS_PERSONS",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_ROOM")),onclick(){this.popupWindow.close();t.renderControl("LocationId")}})}e.push({html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("INSERT_HYPERLINK",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_LINK")),onclick(){this.popupWindow.close();t.renderControl("Link")}});if("Attachment"in babelHelpers.classPrivateFieldLooseBase(this,F)[F]){e.push({html:babelHelpers.classPrivateFieldLooseBase(this,X)[X]("ATTACH",a.Loc.getMessage("CRM_BP_CREATE_TODO_ACTIONS_FILE")),text:babelHelpers.classPrivateFieldLooseBase(this,F)[F].Attachment.Name,onclick(){this.popupWindow.close();t.renderControl("Attachment")}})}return e}function ae(){const e=`bp-create-todo-activity-${Math.random()}`;i.PopupMenu.show(e,babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,R)[R](),{autoHide:true,offsetLeft:a.Dom.getPosition(this).width/2,angle:{position:"top",offset:0},className:"bizproc-automation-inline-selector-menu",overlay:{backgroundColor:"transparent"}})}function le(e,t=null){return BX.Bizproc.FieldType.renderControl(babelHelpers.classPrivateFieldLooseBase(this,g)[g],babelHelpers.classPrivateFieldLooseBase(this,F)[F][e],babelHelpers.classPrivateFieldLooseBase(this,F)[F][e].FieldName,t)}function ie(){var e;const s=a.Dom.create("div",{attrs:{"data-role":"file-selector","data-config":babelHelpers.classPrivateFieldLooseBase(this,m)[m]}});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new t.FileSelector({context:new t.SelectorContext({fields:t.getGlobalContext().document.getFields(),rootGroupTitle:t.getGlobalContext().document.title})});babelHelpers.classPrivateFieldLooseBase(this,y)[y].renderTo(s);const l=(e=t.Designer.getInstance().getRobotSettingsDialog())==null?void 0:e.template;if(l){l.robotSettingsControls.push(babelHelpers.classPrivateFieldLooseBase(this,y)[y])}return s}function oe(e,t=null){if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B][e]){return}if(e==="Attachment"){babelHelpers.classPrivateFieldLooseBase(this,y)[y].destroy()}if(e==="Duration"){babelHelpers.classPrivateFieldLooseBase(this,K)[K]("Colleagues");babelHelpers.classPrivateFieldLooseBase(this,K)[K]("LocationId")}t==null?void 0:t.preventDefault();a.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,B)[B][e]);delete babelHelpers.classPrivateFieldLooseBase(this,B)[B][e]}function re(e){if(a.Type.isNil(e)||e<=0){return""}return a.Loc.getMessage("CRM_BP_CREATE_TODO_LOCATION_SELECTOR_ROOMS_CAPACITY",{"#CAPACITY_VALUE#":e})}function ne(e,t){const s=new r.Icon({icon:r.Main[e],color:getComputedStyle(document.body).getPropertyValue("--ui-color-palette-gray-50"),size:25});return a.Tag.render(c||(c=n`
			<span class="bizproc_automation-todo-activity-actions-menu-item">
				<span class="bizproc_automation-todo-activity-actions-menu-item-icon">${0}</span>
				${0}
			</span>
		`),s.render(),t)}function ce(e,t,a){return new s.ColorSelector({target:e,colorList:t.valuesList,selectedColorId:a?t.selectedValueId:"default",readOnlyMode:t.readOnlyMode})}function de(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H].hidden=e==="disk";babelHelpers.classPrivateFieldLooseBase(this,C)[C].hidden=e==="file";const t=BX(`BPMA-${babelHelpers.classPrivateFieldLooseBase(this,T)[T]}-control`).querySelectorAll("input");for(const e of t){e.disable=true}const s=BX(`BPMA-${e}-control`).querySelectorAll("input");for(const e of s){e.disabled=false}}function be(){const e=`/bitrix/tools/disk/uf.php?action=selectFile&dialog2=Y&SITE_ID=${a.Loc.getMessage("SITE_ID")}`;const t="BPMA";BX.ajax.get(e,`multiselect=Y&dialogName=${t}`,(()=>{setTimeout((()=>{BX.DiskFileDialog.obCallback[t]={saveButton:(e,t,s)=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e,t,s)};BX.DiskFileDialog.openDialog(t)}),10)}))}function pe(e,t,s){for(const e of Object.values(s)){if(e.type==="file"){a.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,$)[$](e),babelHelpers.classPrivateFieldLooseBase(this,O)[O])}}}function ve(e){const t=a.Tag.render(d||(d=n`
			<div>
				<input type="hidden" name="attachment[]" value="${0}"/>
				<span style="color: grey">${0}</span>
			</div>
		`),e.id.toString().slice(1),BX.util.htmlspecialchars(e.name));const s=a.Tag.render(b||(b=n`
			<a style="color: red; text-decoration: none; border-bottom: 1px dotted">x</a>
		`));a.Event.bind(s,"click",(()=>a.Dom.remove(t)));a.Dom.append(s,t);return t}function ue(e){if(!a.Type.isObject(e.documentFields)){throw new TypeError("documentFields must be a object")}if(!a.Type.isElementNode(e.additionalSettingsWrapper)){throw new Error("additionalSettingsWrapper must be HTMLElement")}if(!a.Type.isElementNode(e.additionalSettingsButton)){throw new Error("additionalSettingsButton must be HTMLElement")}if(!a.Type.isArrayFilled(e.documentType)){throw new Error("documentType must be filled array")}if(!a.Type.isElementNode(e.colorSelectorWrapper)){throw new Error("colorSelectorWrapper must be HTMLElement")}if(!a.Type.isStringFilled(e.formName)){throw new Error("formName must be filled string")}if(!a.Type.isStringFilled(e.dataConfig)){throw new Error("dataConfig must be a filled string")}if(!a.Type.isObject(e.colorSettings)){throw new TypeError("colorSettings must be a object")}}p.CrmCreateTodoActivity=G})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Bizproc.Automation,BX.Crm.Field,BX,BX.Event,BX.Main,BX.UI.EntitySelector,BX.UI.IconSet);
//# sourceMappingURL=script.map.js