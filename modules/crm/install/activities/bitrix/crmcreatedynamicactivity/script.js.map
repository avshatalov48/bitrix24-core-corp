{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom, Tag, Text} from 'main.core';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\ntype Property = {\n\tId: string,\n\tName: string,\n\tFieldName: string,\n\tType: string,\n\tRequired: ?boolean,\n\tDefault: any,\n\tOptions: ?Array,\n\tSettings: Object<string, any>,\n}\n\ntype EntityTypeId = number;\ntype FieldsMap = Object<string, Property>;\n\nclass CrmCreateDynamicActivity\n{\n\tisRobot: boolean;\n\tfieldsMapContainer: ?HTMLDivElement = undefined;\n\tentityTypeIdSelect: ?HTMLSelectElement = undefined;\n\tentitiesFieldsMap: Object<EntityTypeId, {\n\t\tdocumentType: [string, string, string],\n\t\tfieldsMap: FieldsMap,\n\t}>;\n\tcurrentValues: Object<string, any> = {};\n\n\tentitiesFieldsContainers = new Map();\n\n\tconstructor(options: {\n\t\tisRobot: boolean,\n\t\tformName: string,\n\t\tentitiesFieldsMap: Object<EntityTypeId, FieldsMap>,\n\t\tcurrentValues: Object<string, any>,\n\t})\n\t{\n\t\tthis.fieldsMapContainer = document.getElementById('fields-map-container');\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.isRobot = options.isRobot;\n\n\t\t\tconst form = document.forms[options.formName];\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.entityTypeIdSelect = form['dynamic_type_id'];\n\t\t\t}\n\n\t\t\tthis.entitiesFieldsMap = options.entitiesFieldsMap;\n\n\t\t\tif (Type.isPlainObject(options.currentValues))\n\t\t\t{\n\t\t\t\tthis.currentValues = options.currentValues;\n\t\t\t}\n\t\t}\n\t}\n\n\tget currentEntityTypeId(): number\n\t{\n\t\tif (!this.entityTypeIdSelect)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn parseInt(this.entityTypeIdSelect.value)\n\t}\n\n\tgetBindFieldId(): string\n\t{\n\t\treturn `${this.currentEntityTypeId}_BindToCurrentElement`;\n\t}\n\n\tinit(): boolean\n\t{\n\t\tif (this.entityTypeIdSelect)\n\t\t{\n\t\t\tthis.render();\n\t\t\tEvent.bind(this.entityTypeIdSelect, 'change', this.onEntityTypeIdChange.bind(this));\n\t\t}\n\t}\n\n\tonEntityTypeIdChange(): void\n\t{\n\t\tDom.clean(this.fieldsMapContainer);\n\t\tthis.currentValues = {};\n\t\tthis.render();\n\t}\n\n\trender(): void\n\t{\n\t\tif (this.entitiesFieldsMap.hasOwnProperty(this.currentEntityTypeId))\n\t\t{\n\t\t\tconst { fieldsMap } = this.entitiesFieldsMap[this.currentEntityTypeId];\n\n\t\t\tfor (const fieldId of Object.keys(fieldsMap))\n\t\t\t{\n\t\t\t\tDom.append(this.renderProperty(fieldId), this.fieldsMapContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderProperty(fieldId: string): HTMLElement\n\t{\n\t\tif (this.getBindFieldId() === fieldId)\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.isRobot\n\t\t\t\t\t? this.renderRobotBindField()\n\t\t\t\t\t: ''\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\tthis.isRobot\n\t\t\t\t? this.renderRobotProperty(fieldId)\n\t\t\t\t: this.renderDesignerProperty(fieldId)\n\t\t);\n\t}\n\n\trenderRobotBindField(): HTMLElement\n\t{\n\t\tconst { fieldsMap } = this.entitiesFieldsMap[this.currentEntityTypeId];\n\n\t\tconst bindField = fieldsMap[this.getBindFieldId()];\n\t\tconst bindFieldValue = (\n\t\t\tthis.currentValues.hasOwnProperty(this.getBindFieldId())\n\t\t\t&& (\n\t\t\t\tthis.currentValues[this.getBindFieldId()] === 'Y'\n\t\t\t\t|| this.currentValues[this.getBindFieldId()] === true\n\t\t\t)\n\t\t)\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t<div class=\"bizproc-automation-popup-checkbox-item\">\n\t\t\t\t\t<input type=\"hidden\" name=\"${Text.encode(bindField.FieldName)}\" value=\"N\">\n\t\t\t\t\t<label class=\"bizproc-automation-popup-chk-label\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tname=\"${Text.encode(bindField.FieldName)}\"\n\t\t\t\t\t\t\tvalue=\"Y\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-chk\"\n\t\t\t\t\t\t\t${ bindFieldValue ? 'checked' : '' }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${Text.encode(bindField.Name)}\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderRobotProperty(fieldId: string): HTMLElement\n\t{\n\t\tconst { documentType, fieldsMap } = this.entitiesFieldsMap[this.currentEntityTypeId];\n\t\tconst property = fieldsMap[fieldId];\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Text.encode(property.Name)}:\n\t\t\t\t</span>\n\t\t\t\t${BX.Bizproc.FieldType.renderControlPublic(\n\t\t\t\t\tdocumentType,\n\t\t\t\t\tproperty,\n\t\t\t\t\tproperty.FieldName,\n\t\t\t\t\tthis.currentValues[fieldId],\n\t\t\t\t)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderDesignerProperty(fieldId: string): HTMLElement\n\t{\n\t\tconst { documentType, fieldsMap } = this.entitiesFieldsMap[this.currentEntityTypeId];\n\t\tconst property = fieldsMap[fieldId];\n\n\t\treturn Tag.render`\n\t\t\t<tr>\n\t\t\t\t<td align=\"right\" width=\"40%\">${Text.encode(property.Name)}:</td>\n\t\t\t\t<td width=\"60%\">\n\t\t\t\t\t${BX.Bizproc.FieldType.renderControlDesigner(\n\t\t\t\t\t\tdocumentType,\n\t\t\t\t\t\tproperty,\n\t\t\t\t\t\tproperty.FieldName,\n\t\t\t\t\t\tthis.currentValues[fieldId],\n\t\t\t\t\t)}\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t`;\n\t}\n}\n\nnamespace.CrmCreateDynamicActivity = CrmCreateDynamicActivity;"],"names":["namespace","Reflection","CrmCreateDynamicActivity","options","undefined","Map","fieldsMapContainer","document","getElementById","Type","isPlainObject","isRobot","form","forms","formName","isNil","entityTypeIdSelect","entitiesFieldsMap","currentValues","currentEntityTypeId","render","Event","bind","onEntityTypeIdChange","Dom","clean","hasOwnProperty","fieldsMap","Object","keys","fieldId","append","renderProperty","getBindFieldId","renderRobotBindField","renderRobotProperty","renderDesignerProperty","bindField","bindFieldValue","Tag","Text","encode","FieldName","Name","documentType","property","BX","Bizproc","FieldType","renderControlPublic","renderControlDesigner","parseInt","value"],"mappings":"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"}