(function(t,e){"use strict";var i,n,r;var s=e.Reflection.namespace("BX.Crm.Activity");var a=function(){function t(i){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"fieldsMapContainer",undefined);babelHelpers.defineProperty(this,"entityTypeIdSelect",undefined);babelHelpers.defineProperty(this,"currentValues",{});babelHelpers.defineProperty(this,"renderedProperties",{});babelHelpers.defineProperty(this,"entitiesFieldsContainers",new Map);this.fieldsMapContainer=document.getElementById("fields-map-container");if(e.Type.isPlainObject(i)){this.isRobot=i.isRobot;var n=document.forms[i.formName];if(!e.Type.isNil(n)){this.entityTypeIdSelect=n["dynamic_type_id"]}this.entitiesFieldsMap=i.entitiesFieldsMap;if(e.Type.isPlainObject(i.currentValues)){this.currentValues=i.currentValues}}}babelHelpers.createClass(t,[{key:"getBindFieldId",value:function t(){return"".concat(this.currentEntityTypeId,"_BindToCurrentElement")}},{key:"init",value:function t(){if(this.entityTypeIdSelect){this.render();e.Event.bind(this.entityTypeIdSelect,"change",this.onEntityTypeIdChange.bind(this))}}},{key:"onEntityTypeIdChange",value:function t(){e.Dom.clean(this.fieldsMapContainer);this.currentValues={};this.render()}},{key:"render",value:function t(){if(Object.hasOwn(this.entitiesFieldsMap,this.currentEntityTypeId)){var i=this.entitiesFieldsMap[this.currentEntityTypeId].fieldsMap;this.loadRenderedFields();for(var n=0,r=Object.keys(i);n<r.length;n++){var s=r[n];e.Dom.append(this.renderProperty(s),this.fieldsMapContainer)}}}},{key:"loadRenderedFields",value:function t(){var i=this;var n=this.entitiesFieldsMap[this.currentEntityTypeId],r=n.documentType,s=n.fieldsMap;if(e.Type.isFunction(BX.Bizproc.FieldType.renderControlCollection)){this.renderedProperties=BX.Bizproc.FieldType.renderControlCollection(r,Object.entries(s).map((function(t){var e=babelHelpers.slicedToArray(t,2),n=e[0],r=e[1];return{property:r,fieldName:r.FieldName,value:i.currentValues[n],controlId:n}})),this.isRobot?"public":"designer")}}},{key:"renderProperty",value:function t(e){if(this.getBindFieldId()===e){return this.isRobot?this.renderRobotBindField():""}return this.isRobot?this.renderRobotProperty(e):this.renderDesignerProperty(e)}},{key:"renderRobotBindField",value:function t(){var n=this.entitiesFieldsMap[this.currentEntityTypeId].fieldsMap;var r=n[this.getBindFieldId()];var s=Object.hasOwn(this.currentValues,this.getBindFieldId())&&(this.currentValues[this.getBindFieldId()]==="Y"||this.currentValues[this.getBindFieldId()]===true);return e.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<div class="bizproc-automation-popup-checkbox-item">\n\t\t\t\t\t<input type="hidden" name="','" value="N">\n\t\t\t\t\t<label class="bizproc-automation-popup-chk-label">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\tname="','"\n\t\t\t\t\t\t\tvalue="Y"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-chk"\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t","\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),e.Text.encode(r.FieldName),e.Text.encode(r.FieldName),s?"checked":"",e.Text.encode(r.Name))}},{key:"renderRobotProperty",value:function t(i){var r=this;var s=this.entitiesFieldsMap[this.currentEntityTypeId],a=s.documentType,d=s.fieldsMap;var l=d[i];var o=function t(){return BX.Bizproc.FieldType.renderControlPublic(a,l,l.FieldName,r.currentValues[i])};return e.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',":\n\t\t\t\t</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),e.Text.encode(l.Name),e.Type.isDomNode(this.renderedProperties[i])?this.renderedProperties[i]:o())}},{key:"renderDesignerProperty",value:function t(i){var n=this;var s=this.entitiesFieldsMap[this.currentEntityTypeId],a=s.documentType,d=s.fieldsMap;var l=d[i];var o=function t(){return BX.Bizproc.FieldType.renderControlDesigner(a,l,l.FieldName,n.currentValues[i])};return e.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<tr>\n\t\t\t\t<td align="right" width="40%">',':</td>\n\t\t\t\t<td width="60%">\n\t\t\t\t\t',"\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t"])),e.Text.encode(l.Name),e.Type.isDomNode(this.renderedProperties[i])?this.renderedProperties[i]:o())}},{key:"currentEntityTypeId",get:function t(){if(!this.entityTypeIdSelect){return 0}return parseInt(this.entityTypeIdSelect.value,10)}}]);return t}();s.CrmCreateDynamicActivity=a})(this.window=this.window||{},BX);
//# sourceMappingURL=script.map.js