{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Dom, Text} from 'main.core';\n\nconst namespace = Reflection.namespace('BX.Crm.Automation.Activity');\n\ntype StageInfo = {id: string, name: string};\n\nexport class CompleteTaskActivity\n{\n\t#form: HTMLFormElement;\n\t#chosenStages: Set<string>;\n\t#stages: Object<string, Array<StageInfo>>;\n\t#categoryContainer: HTMLSelectElement;\n\t#stagesContainer: HTMLSelectElement;\n\n\tconstructor(options: {\n\t\tformName: string,\n\t\tstages: Object<string, Array<{id: string, name: string}>>,\n\t\tchosenStages: Array<string>,\n\t})\n\t{\n\t\tthis.#form = document.forms.namedItem(options.formName);\n\n\t\tthis.#categoryContainer = this.#form['target_category'];\n\t\tthis.#stagesContainer = this.#form['target_status[]'];\n\t\tthis.#stages = options.stages;\n\t\tthis.#chosenStages = new Set(options.chosenStages);\n\t}\n\n\tinit()\n\t{\n\t\tthis.updateStages();\n\t}\n\n\tupdateStages()\n\t{\n\t\tDom.clean(this.#stagesContainer);\n\t\tthis.renderStages();\n\t}\n\n\trender()\n\t{\n\t\tif (this.#categoryContainer)\n\t\t{\n\t\t\tthis.#categoryContainer.onchange = this.updateStages.bind(this);\n\t\t}\n\t}\n\n\trenderStages()\n\t{\n\t\tif (this.#stages.hasOwnProperty(this.#categoryContainer.value))\n\t\t{\n\t\t\tconst stages = this.#stages[this.#categoryContainer.value];\n\n\t\t\tstages.forEach(({id, name}) => {\n\t\t\t\tconst option = new Option(name, id, false, this.#chosenStages.has(id))\n\n\t\t\t\tthis.#stagesContainer.append(option);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (const categoryOption of this.#categoryContainer.options)\n\t\t\t{\n\t\t\t\tconst categoryId = categoryOption.value;\n\t\t\t\tconst categoryName = categoryOption.text;\n\n\t\t\t\tif (this.#stages.hasOwnProperty(categoryId))\n\t\t\t\t{\n\t\t\t\t\tthis.#stages[categoryId].forEach(({id, name}) => {\n\t\t\t\t\t\tconst stageName = Text.encode(`${categoryName} / ${name}`);\n\t\t\t\t\t\tconst option = new Option(stageName, id, false, this.#chosenStages.has(id));\n\n\t\t\t\t\t\tthis.#stagesContainer.append(option);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nnamespace.CompleteTaskActivity = CompleteTaskActivity;"],"names":["namespace","Reflection","CompleteTaskActivity","options","document","forms","namedItem","formName","stages","Set","chosenStages","updateStages","Dom","clean","renderStages","onchange","bind","hasOwnProperty","value","forEach","id","name","option","Option","has","append","categoryOption","categoryId","categoryName","text","stageName","Text","encode"],"mappings":";;;;;;;;AAAA,CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAS,CAAC,4BAA4B,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;AAIrE,KAAaE,oBAAoB;GAQhC,8BAAYC,OAIX,EACD;KAAA;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,sCAAI,SAASC,QAAQ,CAACC,KAAK,CAACC,SAAS,CAACH,OAAO,CAACI,QAAQ,CAAC;KAEvD,sCAAI,sBAAsB,sCAAI,SAAO,iBAAiB,CAAC;KACvD,sCAAI,oBAAoB,sCAAI,SAAO,iBAAiB,CAAC;KACrD,sCAAI,WAAWJ,OAAO,CAACK,MAAM;KAC7B,sCAAI,iBAAiB,IAAIC,GAAG,CAACN,OAAO,CAACO,YAAY,CAAC;;GAClD;KAAA;KAAA,uBAGD;OACC,IAAI,CAACC,YAAY,EAAE;;;KACnB;KAAA,+BAGD;OACCC,aAAG,CAACC,KAAK,mCAAC,IAAI,oBAAkB;OAChC,IAAI,CAACC,YAAY,EAAE;;;KACnB;KAAA,yBAGD;OACC,sCAAI,IAAI,uBACR;SACC,sCAAI,sBAAoBC,QAAQ,GAAG,IAAI,CAACJ,YAAY,CAACK,IAAI,CAAC,IAAI,CAAC;;;;KAEhE;KAAA,+BAGD;OAAA;OACC,IAAI,sCAAI,WAASC,cAAc,CAAC,sCAAI,sBAAoBC,KAAK,CAAC,EAC9D;SACC,IAAMV,MAAM,GAAG,sCAAI,WAAS,sCAAI,sBAAoBU,KAAK,CAAC;SAE1DV,MAAM,CAACW,OAAO,CAAC,gBAAgB;WAAA,IAAdC,EAAE,QAAFA,EAAE;aAAEC,IAAI,QAAJA,IAAI;WACxB,IAAMC,MAAM,GAAG,IAAIC,MAAM,CAACF,IAAI,EAAED,EAAE,EAAE,KAAK,EAAE,uCAAI,iBAAeI,GAAG,CAACJ,EAAE,CAAC,CAAC;WAEtE,uCAAI,oBAAkBK,MAAM,CAACH,MAAM,CAAC;UACpC,CAAC;QACF,MAED;SAAA,2CAC8B,sCAAI,sBAAoBnB,OAAO;WAAA;SAAA;WAAA,6BAC5D;aAAA,IADWuB,cAAc;aAExB,IAAMC,UAAU,GAAGD,cAAc,CAACR,KAAK;aACvC,IAAMU,YAAY,GAAGF,cAAc,CAACG,IAAI;aAExC,IAAI,uCAAI,WAASZ,cAAc,CAACU,UAAU,CAAC,EAC3C;eACC,uCAAI,WAASA,UAAU,CAAC,CAACR,OAAO,CAAC,iBAAgB;iBAAA,IAAdC,EAAE,SAAFA,EAAE;mBAAEC,IAAI,SAAJA,IAAI;iBAC1C,IAAMS,SAAS,GAAGC,cAAI,CAACC,MAAM,WAAIJ,YAAY,gBAAMP,IAAI,EAAG;iBAC1D,IAAMC,MAAM,GAAG,IAAIC,MAAM,CAACO,SAAS,EAAEV,EAAE,EAAE,KAAK,EAAE,uCAAI,iBAAeI,GAAG,CAACJ,EAAE,CAAC,CAAC;iBAE3E,uCAAI,oBAAkBK,MAAM,CAACH,MAAM,CAAC;gBACpC,CAAC;;YAEH;WAdD;aAAA;;;WAcC;;WAAA;;;;;GAEF;CAAA;CAGFtB,SAAS,CAACE,oBAAoB,GAAGA,oBAAoB;;;;;;;;"}