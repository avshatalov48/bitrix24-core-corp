{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Type, Event } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmAddProductRowActivity\n{\n\tproductNode;\n\tproductSettings;\n\n\t#selector;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.productNode = form['product_id'];\n\t\t\t}\n\n\t\t\tif (options.productProperty && Type.isPlainObject(options.productProperty.Settings))\n\t\t\t{\n\t\t\t\tthis.productSettings = options.productProperty.Settings;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.productNode && this.productSettings)\n\t\t{\n\t\t\tEvent.bind(this.productNode, 'click', this.#onProductClick.bind(this));\n\t\t}\n\t}\n\n\t#onProductClick(): void\n\t{\n\t\tthis.#getProductSelector().show();\n\t}\n\n\t#getProductSelector()\n\t{\n\t\tif (!this.#selector)\n\t\t{\n\t\t\tthis.#selector = new Dialog({\n\t\t\t\tcontext: 'catalog-products',\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'product',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tiblockId: this.productSettings.iblockId,\n\t\t\t\t\t\t\tbasePriceId: this.productSettings.basePriceId,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\ttargetNode: this.productNode,\n\t\t\t\theight: 300,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onBeforeSelect': (event) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.productNode.value = event.getData().item.getId();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.#selector;\n\t}\n}\n\nnamespace.CrmAddProductRowActivity = CrmAddProductRowActivity;"],"names":["namespace","Reflection","CrmAddProductRowActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","productNode","productProperty","Settings","productSettings","Event","bind","show","Dialog","context","entities","id","iblockId","basePriceId","targetNode","height","multiple","dropdownMode","enableSearch","events","event","preventDefault","value","getData","item","getId"],"mappings":";;;;;;;;;;CAGA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;;;;;;;KAEME;GAOL,kCAAYC,OAAZ,EACA;KAAA;;KAAA;;KAAA;;KAAA;OAAA;OAAA;;;KACC,IAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;OACC,IAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeL,OAAO,CAACM,QAAvB,CAAb;;OAEA,IAAI,CAACL,cAAI,CAACM,KAAL,CAAWJ,IAAX,CAAL,EACA;SACC,KAAKK,WAAL,GAAmBL,IAAI,CAAC,YAAD,CAAvB;;;OAGD,IAAIH,OAAO,CAACS,eAAR,IAA2BR,cAAI,CAACC,aAAL,CAAmBF,OAAO,CAACS,eAAR,CAAwBC,QAA3C,CAA/B,EACA;SACC,KAAKC,eAAL,GAAuBX,OAAO,CAACS,eAAR,CAAwBC,QAA/C;;;;;;;4BAMH;OACC,IAAI,KAAKF,WAAL,IAAoB,KAAKG,eAA7B,EACA;SACCC,eAAK,CAACC,IAAN,CAAW,KAAKL,WAAhB,EAA6B,OAA7B,EAAsC,gEAAqBK,IAArB,CAA0B,IAA1B,CAAtC;;;;;;;6BAKF;GACC,mFAA2BC,IAA3B;CACA;;iCAGD;GAAA;;GACC,IAAI,mCAAC,IAAD,YAAJ,EACA;KACC,mDAAiB,IAAIC,wBAAJ,CAAW;OAC3BC,OAAO,EAAE,kBADkB;OAE3BC,QAAQ,EAAE,CACT;SACCC,EAAE,EAAE,SADL;SAEClB,OAAO,EAAE;WACRmB,QAAQ,EAAE,KAAKR,eAAL,CAAqBQ,QADvB;WAERC,WAAW,EAAE,KAAKT,eAAL,CAAqBS;;QAL3B,CAFiB;OAW3BC,UAAU,EAAE,KAAKb,WAXU;OAY3Bc,MAAM,EAAE,GAZmB;OAa3BC,QAAQ,EAAE,KAbiB;OAc3BC,YAAY,EAAE,IAda;OAe3BC,YAAY,EAAE,IAfa;OAgB3BC,MAAM,EAAE;SACP,uBAAuB,4BAACC,KAAD,EACvB;WACCA,KAAK,CAACC,cAAN;WACA,KAAI,CAACpB,WAAL,CAAiBqB,KAAjB,GAAyBF,KAAK,CAACG,OAAN,GAAgBC,IAAhB,CAAqBC,KAArB,EAAzB;;;MApBc,CAAjB;;;GA0BD,yCAAO,IAAP;CACA;;CAGFnC,SAAS,CAACE,wBAAV,GAAqCA,wBAArC;;;;"}