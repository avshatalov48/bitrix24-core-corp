{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom} from 'main.core';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmCopyDynamicActivity\n{\n\tcategorySelect;\n\tstageSelect;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.categorySelect = form['category_id'];\n\t\t\t\tthis.stageSelect = form['stage_id'];\n\t\t\t}\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.categorySelect || !this.stageSelect)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tEvent.bind(this.categorySelect, 'change', this.filter.bind(this));\n\n\t\tthis.filter(this.categorySelect.value);\n\t}\n\n\tfilter()\n\t{\n\t\tconst categoryId = this.categorySelect.value;\n\t\tconst prefix = `C${categoryId}:`;\n\n\t\tfor (let opt of this.stageSelect.options)\n\t\t{\n\t\t\tif (opt.value === '')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\topt.disabled = opt.value.indexOf(prefix) < 0;\n\n\t\t\tif (opt.disabled === Dom.isShown(opt))\n\t\t\t{\n\t\t\t\tDom.toggle(opt);\n\t\t\t}\n\t\t\tif (opt.disabled && opt.value === this.stageSelect.value)\n\t\t\t{\n\t\t\t\topt.selected = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nnamespace.CrmCopyDynamicActivity = CrmCopyDynamicActivity;"],"names":["namespace","Reflection","CrmCopyDynamicActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","categorySelect","stageSelect","Event","bind","filter","value","categoryId","prefix","opt","disabled","indexOf","Dom","isShown","toggle","selected"],"mappings":";;;;;;;;CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;KAEME;CAKL,kCAAYC,OAAZ,EACA;CAAA;;CACC,QAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;CACC,UAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeL,OAAO,CAACM,QAAvB,CAAb;;CAEA,UAAI,CAACL,cAAI,CAACM,KAAL,CAAWJ,IAAX,CAAL,EACA;CACC,aAAKK,cAAL,GAAsBL,IAAI,CAAC,aAAD,CAA1B;CACA,aAAKM,WAAL,GAAmBN,IAAI,CAAC,UAAD,CAAvB;CACA;CACD;CACD;;;;4BAGD;CACC,UAAI,CAAC,KAAKK,cAAN,IAAwB,CAAC,KAAKC,WAAlC,EACA;CACC,eAAO,KAAP;CACA;;CAEDC,MAAAA,eAAK,CAACC,IAAN,CAAW,KAAKH,cAAhB,EAAgC,QAAhC,EAA0C,KAAKI,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAA1C;CAEA,WAAKC,MAAL,CAAY,KAAKJ,cAAL,CAAoBK,KAAhC;CACA;;;8BAGD;CACC,UAAMC,UAAU,GAAG,KAAKN,cAAL,CAAoBK,KAAvC;CACA,UAAME,MAAM,cAAOD,UAAP,MAAZ;;CAFD,iDAIiB,KAAKL,WAAL,CAAiBT,OAJlC;CAAA;;CAAA;CAIC,4DACA;CAAA,cADSgB,GACT;;CACC,cAAIA,GAAG,CAACH,KAAJ,KAAc,EAAlB,EACA;CACC;CACA;;CAEDG,UAAAA,GAAG,CAACC,QAAJ,GAAeD,GAAG,CAACH,KAAJ,CAAUK,OAAV,CAAkBH,MAAlB,IAA4B,CAA3C;;CAEA,cAAIC,GAAG,CAACC,QAAJ,KAAiBE,aAAG,CAACC,OAAJ,CAAYJ,GAAZ,CAArB,EACA;CACCG,YAAAA,aAAG,CAACE,MAAJ,CAAWL,GAAX;CACA;;CACD,cAAIA,GAAG,CAACC,QAAJ,IAAgBD,GAAG,CAACH,KAAJ,KAAc,KAAKJ,WAAL,CAAiBI,KAAnD,EACA;CACCG,YAAAA,GAAG,CAACM,QAAJ,GAAe,KAAf;CACA;CACD;CArBF;CAAA;CAAA;CAAA;CAAA;CAsBC;;;;;CAGFzB,SAAS,CAACE,sBAAV,GAAmCA,sBAAnC;;;;"}