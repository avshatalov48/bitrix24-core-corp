{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom} from 'main.core';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmChangeDealCategoryActivity\n{\n\tcategorySelect;\n\tstageSelect;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.categorySelect = form['category_id'];\n\t\t\t\tthis.stageSelect = form['stage_id'];\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.categorySelect && this.stageSelect)\n\t\t{\n\t\t\tEvent.bind(this.categorySelect, 'change', this.filter.bind(this));\n\n\t\t\tthis.filter();\n\t\t}\n\t}\n\n\tfilter(): void\n\t{\n\t\tconst categoryId = this.categorySelect.value;\n\t\tconst prefix = categoryId !== '0' ? `C${categoryId}:` : '';\n\n\t\tfor (const opt of this.stageSelect.options)\n\t\t{\n\t\t\tif (opt.value === '')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\topt.disabled = (prefix && opt.value.indexOf(prefix) < 0) || (!prefix && opt.value.indexOf(':') > -1);\n\n\t\t\tif (opt.disabled === Dom.isShown(opt))\n\t\t\t{\n\t\t\t\tDom.toggle(opt);\n\t\t\t}\n\t\t\tif (opt.disabled && opt.value === this.stageSelect.value)\n\t\t\t{\n\t\t\t\topt.selected = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nnamespace.CrmChangeDealCategoryActivity = CrmChangeDealCategoryActivity;"],"names":["namespace","Reflection","CrmChangeDealCategoryActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","categorySelect","stageSelect","Event","bind","filter","categoryId","value","prefix","opt","disabled","indexOf","Dom","isShown","toggle","selected"],"mappings":";;;;;;;;CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;KAEME;CAKL,yCAAYC,OAAZ,EACA;CAAA;;CACC,QAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;CACC,UAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeL,OAAO,CAACM,QAAvB,CAAb;;CAEA,UAAI,CAACL,cAAI,CAACM,KAAL,CAAWJ,IAAX,CAAL,EACA;CACC,aAAKK,cAAL,GAAsBL,IAAI,CAAC,aAAD,CAA1B;CACA,aAAKM,WAAL,GAAmBN,IAAI,CAAC,UAAD,CAAvB;CACA;CACD;CACD;;;;4BAGD;CACC,UAAI,KAAKK,cAAL,IAAuB,KAAKC,WAAhC,EACA;CACCC,QAAAA,eAAK,CAACC,IAAN,CAAW,KAAKH,cAAhB,EAAgC,QAAhC,EAA0C,KAAKI,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAA1C;CAEA,aAAKC,MAAL;CACA;CACD;;;8BAGD;CACC,UAAMC,UAAU,GAAG,KAAKL,cAAL,CAAoBM,KAAvC;CACA,UAAMC,MAAM,GAAGF,UAAU,KAAK,GAAf,cAAyBA,UAAzB,SAAyC,EAAxD;;CAFD,iDAImB,KAAKJ,WAAL,CAAiBT,OAJpC;CAAA;;CAAA;CAIC,4DACA;CAAA,cADWgB,GACX;;CACC,cAAIA,GAAG,CAACF,KAAJ,KAAc,EAAlB,EACA;CACC;CACA;;CAEDE,UAAAA,GAAG,CAACC,QAAJ,GAAgBF,MAAM,IAAIC,GAAG,CAACF,KAAJ,CAAUI,OAAV,CAAkBH,MAAlB,IAA4B,CAAvC,IAA8C,CAACA,MAAD,IAAWC,GAAG,CAACF,KAAJ,CAAUI,OAAV,CAAkB,GAAlB,IAAyB,CAAC,CAAlG;;CAEA,cAAIF,GAAG,CAACC,QAAJ,KAAiBE,aAAG,CAACC,OAAJ,CAAYJ,GAAZ,CAArB,EACA;CACCG,YAAAA,aAAG,CAACE,MAAJ,CAAWL,GAAX;CACA;;CACD,cAAIA,GAAG,CAACC,QAAJ,IAAgBD,GAAG,CAACF,KAAJ,KAAc,KAAKL,WAAL,CAAiBK,KAAnD,EACA;CACCE,YAAAA,GAAG,CAACM,QAAJ,GAAe,KAAf;CACA;CACD;CArBF;CAAA;CAAA;CAAA;CAAA;CAsBC;;;;;CAGFzB,SAAS,CAACE,6BAAV,GAA0CA,6BAA1C;;;;"}