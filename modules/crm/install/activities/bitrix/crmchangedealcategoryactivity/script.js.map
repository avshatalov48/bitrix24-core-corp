{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom} from 'main.core';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmChangeDealCategoryActivity\n{\n\tcategorySelect;\n\tstageSelect;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.categorySelect = form['category_id'];\n\t\t\t\tthis.stageSelect = form['stage_id'];\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.categorySelect && this.stageSelect)\n\t\t{\n\t\t\tEvent.bind(this.categorySelect, 'change', this.filter.bind(this));\n\n\t\t\tthis.filter();\n\t\t}\n\t}\n\n\tfilter(): void\n\t{\n\t\tconst categoryId = this.categorySelect.value;\n\t\tconst prefix = categoryId !== '0' ? `C${categoryId}:` : '';\n\n\t\tfor (const opt of this.stageSelect.options)\n\t\t{\n\t\t\tif (opt.value === '')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (opt.selected && opt.getAttribute('data-role') === 'expression')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\topt.disabled = (prefix && opt.value.indexOf(prefix) < 0) || (!prefix && opt.value.indexOf(':') > -1);\n\n\t\t\tif (opt.disabled === Dom.isShown(opt))\n\t\t\t{\n\t\t\t\tDom.toggle(opt);\n\t\t\t}\n\t\t\tif (opt.disabled && opt.value === this.stageSelect.value)\n\t\t\t{\n\t\t\t\topt.selected = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nnamespace.CrmChangeDealCategoryActivity = CrmChangeDealCategoryActivity;"],"names":["namespace","Reflection","CrmChangeDealCategoryActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","categorySelect","stageSelect","Event","bind","filter","categoryId","value","prefix","opt","selected","getAttribute","disabled","indexOf","Dom","isShown","toggle"],"mappings":";;;;;;AAAA,CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAS,CAAC,iBAAiB,CAAC;CAAC,IAEpDE,6BAA6B;GAKlC,uCAAYC,OAAO,EACnB;KAAA;KACC,IAAIC,cAAI,CAACC,aAAa,CAACF,OAAO,CAAC,EAC/B;OACC,IAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAK,CAACL,OAAO,CAACM,QAAQ,CAAC;OAE7C,IAAI,CAACL,cAAI,CAACM,KAAK,CAACJ,IAAI,CAAC,EACrB;SACC,IAAI,CAACK,cAAc,GAAGL,IAAI,CAAC,aAAa,CAAC;SACzC,IAAI,CAACM,WAAW,GAAGN,IAAI,CAAC,UAAU,CAAC;;;;GAGrC;KAAA;KAAA,uBAGD;OACC,IAAI,IAAI,CAACK,cAAc,IAAI,IAAI,CAACC,WAAW,EAC3C;SACCC,eAAK,CAACC,IAAI,CAAC,IAAI,CAACH,cAAc,EAAE,QAAQ,EAAE,IAAI,CAACI,MAAM,CAACD,IAAI,CAAC,IAAI,CAAC,CAAC;SAEjE,IAAI,CAACC,MAAM,EAAE;;;;KAEd;KAAA,yBAGD;OACC,IAAMC,UAAU,GAAG,IAAI,CAACL,cAAc,CAACM,KAAK;OAC5C,IAAMC,MAAM,GAAGF,UAAU,KAAK,GAAG,cAAOA,UAAU,SAAM,EAAE;OAAC,2CAEzC,IAAI,CAACJ,WAAW,CAACT,OAAO;SAAA;OAAA;SAA1C,oDACA;WAAA,IADWgB,GAAG;WAEb,IAAIA,GAAG,CAACF,KAAK,KAAK,EAAE,EACpB;aACC;;WAGD,IAAIE,GAAG,CAACC,QAAQ,IAAID,GAAG,CAACE,YAAY,CAAC,WAAW,CAAC,KAAK,YAAY,EAClE;aACC;;WAGDF,GAAG,CAACG,QAAQ,GAAIJ,MAAM,IAAIC,GAAG,CAACF,KAAK,CAACM,OAAO,CAACL,MAAM,CAAC,GAAG,CAAC,IAAM,CAACA,MAAM,IAAIC,GAAG,CAACF,KAAK,CAACM,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAE;WAEpG,IAAIJ,GAAG,CAACG,QAAQ,KAAKE,aAAG,CAACC,OAAO,CAACN,GAAG,CAAC,EACrC;aACCK,aAAG,CAACE,MAAM,CAACP,GAAG,CAAC;;WAEhB,IAAIA,GAAG,CAACG,QAAQ,IAAIH,GAAG,CAACF,KAAK,KAAK,IAAI,CAACL,WAAW,CAACK,KAAK,EACxD;aACCE,GAAG,CAACC,QAAQ,GAAG,KAAK;;;;SAErB;;SAAA;;;;GACD;CAAA;CAGFpB,SAAS,CAACE,6BAA6B,GAAGA,6BAA6B;;;;"}