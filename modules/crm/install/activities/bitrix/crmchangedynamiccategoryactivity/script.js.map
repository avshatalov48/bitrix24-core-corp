{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom} from 'main.core';\r\n\r\nconst namespace = Reflection.namespace('BX.Crm.Activity');\r\n\r\nclass CrmChangeDynamicCategoryActivity\r\n{\r\n\tcategorySelect;\r\n\tstageSelect;\r\n\r\n\tconstructor(options)\r\n\t{\r\n\t\tif (Type.isPlainObject(options))\r\n\t\t{\r\n\t\t\tconst form = document.forms[options.formName];\r\n\r\n\t\t\tif (!Type.isNil(form))\r\n\t\t\t{\r\n\t\t\t\tthis.categorySelect = form['category_id'];\r\n\t\t\t\tthis.stageSelect = form['stage_id'];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif (!this.categorySelect || !this.stageSelect)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tEvent.bind(this.categorySelect, 'change', this.filter.bind(this));\r\n\r\n\t\tthis.filter();\r\n\t}\r\n\r\n\tfilter()\r\n\t{\r\n\t\tconst categoryId = this.categorySelect.value;\r\n\t\tconst prefix = `C${categoryId}:`;\r\n\r\n\t\tfor (let opt of this.stageSelect.options)\r\n\t\t{\r\n\t\t\tif (opt.value === '')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\topt.disabled = opt.value.indexOf(prefix) < 0;\r\n\r\n\t\t\tif (opt.disabled === Dom.isShown(opt))\r\n\t\t\t{\r\n\t\t\t\tDom.toggle(opt);\r\n\t\t\t}\r\n\t\t\tif (opt.disabled && opt.value === this.stageSelect.value)\r\n\t\t\t{\r\n\t\t\t\topt.selected = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nnamespace.CrmChangeDynamicCategoryActivity = CrmChangeDynamicCategoryActivity;"],"names":["namespace","Reflection","CrmChangeDynamicCategoryActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","categorySelect","stageSelect","Event","bind","filter","categoryId","value","prefix","opt","disabled","indexOf","Dom","isShown","toggle","selected"],"mappings":";;;;;;;;CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;KAEME;GAKL,0CAAYC,OAAZ,EACA;KAAA;;KACC,IAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;OACC,IAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeL,OAAO,CAACM,QAAvB,CAAb;;OAEA,IAAI,CAACL,cAAI,CAACM,KAAL,CAAWJ,IAAX,CAAL,EACA;SACC,KAAKK,cAAL,GAAsBL,IAAI,CAAC,aAAD,CAA1B;SACA,KAAKM,WAAL,GAAmBN,IAAI,CAAC,UAAD,CAAvB;;;;;;;4BAMH;OACC,IAAI,CAAC,KAAKK,cAAN,IAAwB,CAAC,KAAKC,WAAlC,EACA;SACC,OAAO,KAAP;;;OAGDC,eAAK,CAACC,IAAN,CAAW,KAAKH,cAAhB,EAAgC,QAAhC,EAA0C,KAAKI,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAA1C;OAEA,KAAKC,MAAL;;;;8BAID;OACC,IAAMC,UAAU,GAAG,KAAKL,cAAL,CAAoBM,KAAvC;OACA,IAAMC,MAAM,cAAOF,UAAP,MAAZ;;OAFD,2CAIiB,KAAKJ,WAAL,CAAiBT,OAJlC;;;OAAA;SAIC,oDACA;WAAA,IADSgB,GACT;;WACC,IAAIA,GAAG,CAACF,KAAJ,KAAc,EAAlB,EACA;aACC;;;WAGDE,GAAG,CAACC,QAAJ,GAAeD,GAAG,CAACF,KAAJ,CAAUI,OAAV,CAAkBH,MAAlB,IAA4B,CAA3C;;WAEA,IAAIC,GAAG,CAACC,QAAJ,KAAiBE,aAAG,CAACC,OAAJ,CAAYJ,GAAZ,CAArB,EACA;aACCG,aAAG,CAACE,MAAJ,CAAWL,GAAX;;;WAED,IAAIA,GAAG,CAACC,QAAJ,IAAgBD,GAAG,CAACF,KAAJ,KAAc,KAAKL,WAAL,CAAiBK,KAAnD,EACA;aACCE,GAAG,CAACM,QAAJ,GAAe,KAAf;;;;SAnBH;;SAAA;;;;;;;CAyBDzB,SAAS,CAACE,gCAAV,GAA6CA,gCAA7C;;;;"}