{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Dom} from 'main.core';\r\n\r\nconst namespace = Reflection.namespace('BX.Crm.Activity');\r\n\r\nclass CrmChangeDynamicCategoryActivity\r\n{\r\n\tcategorySelect;\r\n\tstageSelect;\r\n\r\n\tconstructor(options)\r\n\t{\r\n\t\tif (Type.isPlainObject(options))\r\n\t\t{\r\n\t\t\tconst form = document.forms[options.formName];\r\n\r\n\t\t\tif (!Type.isNil(form))\r\n\t\t\t{\r\n\t\t\t\tthis.categorySelect = form['category_id'];\r\n\t\t\t\tthis.stageSelect = form['stage_id'];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif (!this.categorySelect || !this.stageSelect)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tEvent.bind(this.categorySelect, 'change', this.filter.bind(this));\r\n\r\n\t\tthis.filter(this.categorySelect.value);\r\n\t}\r\n\r\n\tfilter()\r\n\t{\r\n\t\tconst categoryId = this.categorySelect.value;\r\n\t\tconst prefix = `C${categoryId}:`;\r\n\r\n\t\tfor (let opt of this.stageSelect.options)\r\n\t\t{\r\n\t\t\tif (opt.value === '')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\topt.disabled = opt.value.indexOf(prefix) < 0;\r\n\r\n\t\t\tif (opt.disabled === Dom.isShown(opt))\r\n\t\t\t{\r\n\t\t\t\tDom.toggle(opt);\r\n\t\t\t}\r\n\t\t\tif (opt.disabled && opt.value === this.stageSelect.value)\r\n\t\t\t{\r\n\t\t\t\topt.selected = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nnamespace.CrmChangeDynamicCategoryActivity = CrmChangeDynamicCategoryActivity;"],"names":["namespace","Reflection","CrmChangeDynamicCategoryActivity","options","Type","isPlainObject","form","document","forms","formName","isNil","categorySelect","stageSelect","Event","bind","filter","value","categoryId","prefix","opt","disabled","indexOf","Dom","isShown","toggle","selected"],"mappings":";;;;;;;;CAEA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;KAEME;CAKL,4CAAYC,OAAZ,EACA;CAAA;;CACC,QAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;CACC,UAAMG,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeL,OAAO,CAACM,QAAvB,CAAb;;CAEA,UAAI,CAACL,cAAI,CAACM,KAAL,CAAWJ,IAAX,CAAL,EACA;CACC,aAAKK,cAAL,GAAsBL,IAAI,CAAC,aAAD,CAA1B;CACA,aAAKM,WAAL,GAAmBN,IAAI,CAAC,UAAD,CAAvB;CACA;CACD;CACD;;;;4BAGD;CACC,UAAI,CAAC,KAAKK,cAAN,IAAwB,CAAC,KAAKC,WAAlC,EACA;CACC,eAAO,KAAP;CACA;;CAEDC,MAAAA,eAAK,CAACC,IAAN,CAAW,KAAKH,cAAhB,EAAgC,QAAhC,EAA0C,KAAKI,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAA1C;CAEA,WAAKC,MAAL,CAAY,KAAKJ,cAAL,CAAoBK,KAAhC;CACA;;;8BAGD;CACC,UAAMC,UAAU,GAAG,KAAKN,cAAL,CAAoBK,KAAvC;CACA,UAAME,MAAM,cAAOD,UAAP,MAAZ;;CAFD,iDAIiB,KAAKL,WAAL,CAAiBT,OAJlC;CAAA;;CAAA;CAIC,4DACA;CAAA,cADSgB,GACT;;CACC,cAAIA,GAAG,CAACH,KAAJ,KAAc,EAAlB,EACA;CACC;CACA;;CAEDG,UAAAA,GAAG,CAACC,QAAJ,GAAeD,GAAG,CAACH,KAAJ,CAAUK,OAAV,CAAkBH,MAAlB,IAA4B,CAA3C;;CAEA,cAAIC,GAAG,CAACC,QAAJ,KAAiBE,aAAG,CAACC,OAAJ,CAAYJ,GAAZ,CAArB,EACA;CACCG,YAAAA,aAAG,CAACE,MAAJ,CAAWL,GAAX;CACA;;CACD,cAAIA,GAAG,CAACC,QAAJ,IAAgBD,GAAG,CAACH,KAAJ,KAAc,KAAKJ,WAAL,CAAiBI,KAAnD,EACA;CACCG,YAAAA,GAAG,CAACM,QAAJ,GAAe,KAAf;CACA;CACD;CArBF;CAAA;CAAA;CAAA;CAAA;CAsBC;;;;;CAGFzB,SAAS,CAACE,gCAAV,GAA6CA,gCAA7C;;;;"}