(function(e,i){"use strict";var t=i.Reflection.namespace("BX.Crm.Activity");var n=function(){function e(t){babelHelpers.classCallCheck(this,e);if(i.Type.isPlainObject(t)){this.documentType=t.documentType;this.isRobot=t.isRobot;var n=document.forms[t.formName];if(!i.Type.isNil(n)){this.entityTypeIdSelect=n.dynamic_type_id;this.currentEntityTypeId=Number(this.entityTypeIdSelect.value);this.entityTypeDependentElements=document.querySelectorAll('[data-role="bca-cuda-entity-type-id-dependent"]')}this.initFilterFields(t);this.initReturnFields(t);this.render()}}babelHelpers.createClass(e,[{key:"initFilterFields",value:function e(t){this.conditinIdPrefix="id_bca_cuda_field_";this.filterFieldsContainer=document.querySelector('[data-role="bca-cuda-filter-fields-container"]');this.filteringFieldsPrefix=t.filteringFieldsPrefix;this.filterFieldsMap=new Map(Object.entries(t.filterFieldsMap).map(function(e){var i=babelHelpers.slicedToArray(e,2),t=i[0],n=i[1];return[Number(t),n]}));if(!i.Type.isNil(t.documentName)){BX.Bizproc.Automation.API.documentName=t.documentName}if(BX.Bizproc.Automation&&BX.Bizproc.Automation.ConditionGroup){this.conditionGroup=new BX.Bizproc.Automation.ConditionGroup(t.conditions)}}},{key:"initReturnFields",value:function e(t){var n=this;this.returnFieldsProperty=t.returnFieldsProperty;this.returnFieldsIds=i.Type.isArray(t.returnFieldsIds)?t.returnFieldsIds:[];this.returnFieldsMapContainer=document.querySelector('[data-role="bca-cuda-return-fields-container"]');this.returnFieldsMap=new Map;Object.entries(t.returnFieldsMap).forEach(function(e){var i=babelHelpers.slicedToArray(e,2),t=i[0],r=i[1];n.returnFieldsMap.set(Number(t),new Map(Object.entries(r)))})}},{key:"init",value:function e(){if(this.entityTypeIdSelect){i.Event.bind(this.entityTypeIdSelect,"change",this.onEntityTypeIdChange.bind(this))}}},{key:"onEntityTypeIdChange",value:function e(){this.currentEntityTypeId=Number(this.entityTypeIdSelect.value);if(BX.Bizproc.Automation&&BX.Bizproc.Automation.ConditionGroup){this.conditionGroup=new BX.Bizproc.Automation.ConditionGroup}this.returnFieldsIds=[];this.render()}},{key:"render",value:function e(){if(i.Type.isNil(this.currentEntityTypeId)||this.currentEntityTypeId===0){this.entityTypeDependentElements.forEach(function(e){return i.Dom.hide(e)})}else{this.entityTypeDependentElements.forEach(function(e){return i.Dom.show(e)});this.renderFilterFields();this.renderReturnFields()}}},{key:"renderFilterFields",value:function e(){if(!i.Type.isNil(this.conditionGroup)&&this.currentEntityTypeId!==0){var t=new BX.Bizproc.Automation.ConditionGroupSelector(this.conditionGroup,{fields:Object.values(this.filterFieldsMap.get(this.currentEntityTypeId)),fieldPrefix:this.filteringFieldsPrefix});i.Dom.clean(this.filterFieldsContainer);this.filterFieldsContainer.appendChild(t.createNode())}}},{key:"renderReturnFields",value:function e(){var t=this.currentEntityTypeId;var n=this.returnFieldsMap.get(t);if(!i.Type.isNil(n)){var r={};n.forEach(function(e,i){r[i]=e.Name});this.returnFieldsProperty.Options=r;i.Dom.clean(this.returnFieldsMapContainer);this.returnFieldsMapContainer.appendChild(BX.Bizproc.FieldType.renderControl(this.documentType,this.returnFieldsProperty,this.returnFieldsProperty.FieldName,this.returnFieldsIds,this.isRobot?"public":"designer"))}}}]);return e}();t.CrmGetDynamicInfoActivity=n})(this.window=this.window||{},BX);
//# sourceMappingURL=script.map.js