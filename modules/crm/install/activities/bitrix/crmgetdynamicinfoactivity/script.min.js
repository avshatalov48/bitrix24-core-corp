(function(e,t,i){"use strict";var n=t.Reflection.namespace("BX.Crm.Activity");var r=function(){function e(n){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(n)){this.documentType=n.documentType;this.isRobot=n.isRobot;var r=document.forms[n.formName];this.document=new i.Document({rawDocumentType:this.documentType,documentFields:n.returnFieldsMap,title:n.documentName});if(!t.Type.isNil(r)){this.entityTypeIdSelect=r.dynamic_type_id;this.currentEntityTypeId=Number(this.entityTypeIdSelect.value);this.entityTypeDependentElements=document.querySelectorAll('[data-role="bca-cuda-entity-type-id-dependent"]')}this.initFilterFields(n);this.initReturnFields(n);this.render()}}babelHelpers.createClass(e,[{key:"initFilterFields",value:function e(t){this.conditinIdPrefix="id_bca_cuda_field_";this.filterFieldsContainer=document.querySelector('[data-role="bca-cuda-filter-fields-container"]');this.filteringFieldsPrefix=t.filteringFieldsPrefix;this.filterFieldsMap=new Map(Object.entries(t.filterFieldsMap).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return[Number(i),n]})));this.conditionGroup=new i.ConditionGroup(t.conditions)}},{key:"initReturnFields",value:function e(i){var n=this;this.returnFieldsProperty=i.returnFieldsProperty;this.returnFieldsIds=t.Type.isArray(i.returnFieldsIds)?i.returnFieldsIds:[];this.returnFieldsMapContainer=document.querySelector('[data-role="bca-cuda-return-fields-container"]');this.returnFieldsMap=new Map;Object.entries(i.returnFieldsMap).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],r=t[1];n.returnFieldsMap.set(Number(i),new Map(Object.entries(r)))}))}},{key:"initAutomationContext",value:function e(){try{i.getGlobalContext()}catch(e){i.setGlobalContext(new i.AutomationContext({document:this.document}))}}},{key:"init",value:function e(){if(this.entityTypeIdSelect){t.Event.bind(this.entityTypeIdSelect,"change",this.onEntityTypeIdChange.bind(this))}}},{key:"onEntityTypeIdChange",value:function e(){this.currentEntityTypeId=Number(this.entityTypeIdSelect.value);this.conditionGroup=new i.ConditionGroup;this.returnFieldsIds=[];this.render()}},{key:"render",value:function e(){if(t.Type.isNil(this.currentEntityTypeId)||this.currentEntityTypeId===0){this.entityTypeDependentElements.forEach((function(e){return t.Dom.hide(e)}))}else{this.entityTypeDependentElements.forEach((function(e){return t.Dom.show(e)}));this.renderFilterFields();this.renderReturnFields()}}},{key:"renderFilterFields",value:function e(){if(!t.Type.isNil(this.conditionGroup)&&this.currentEntityTypeId!==0){var n=new i.ConditionGroupSelector(this.conditionGroup,{fields:Object.values(this.filterFieldsMap.get(this.currentEntityTypeId)),fieldPrefix:this.filteringFieldsPrefix});t.Dom.clean(this.filterFieldsContainer);this.filterFieldsContainer.appendChild(n.createNode())}}},{key:"renderReturnFields",value:function e(){var i=this.currentEntityTypeId;var n=this.returnFieldsMap.get(i);if(!t.Type.isNil(n)){var r={};n.forEach((function(e,t){r[t]=e.Name}));this.returnFieldsProperty.Options=r;t.Dom.clean(this.returnFieldsMapContainer);this.returnFieldsMapContainer.appendChild(BX.Bizproc.FieldType.renderControl(this.documentType,this.returnFieldsProperty,this.returnFieldsProperty.FieldName,this.returnFieldsIds,this.isRobot?"public":"designer"))}}}]);return e}();n.CrmGetDynamicInfoActivity=r})(this.window=this.window||{},BX,BX.Bizproc);
//# sourceMappingURL=script.map.js