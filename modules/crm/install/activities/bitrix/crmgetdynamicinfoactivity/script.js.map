{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Type, Event, Dom, Loc } from 'main.core';\nimport {\n\tContext,\n\tConditionGroup,\n\tConditionGroupSelector,\n\tDocument,\n\tgetGlobalContext,\n\tsetGlobalContext,\n\tInlineSelector,\n\tDesigner,\n} from 'bizproc.automation';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nclass CrmGetDynamicInfoActivity\n{\n\tdocumentType: Array<string>;\n\tdocument: Document;\n\tisRobot: boolean;\n\tentityTypeIdSelect: HTMLSelectElement;\n\n\treturnFieldsProperty: object;\n\treturnFieldsMapContainer: HTMLDivElement;\n\treturnFieldsMap: Map<number, Map<string, object>>;\n\treturnFieldsIds: Array<string>;\n\n\tfilterFieldsContainer: HTMLDivElement | null;\n\tfilteringFieldsPrefix: string;\n\tfilterFieldsMap: Map<number, object>;\n\tconditionGroup: ConditionGroup | undefined;\n\n\tcurrentEntityTypeId: number;\n\n\tonOpenFilterFieldsMenu: ?Function;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.documentType = options.documentType;\n\t\t\tthis.isRobot = options.isRobot;\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.entityTypeIdSelect = form.dynamic_type_id;\n\t\t\t\tthis.currentEntityTypeId = Number(this.entityTypeIdSelect.value);\n\t\t\t\tthis.entityTypeDependentElements = document.querySelectorAll(\n\t\t\t\t\t'[data-role=\"bca-cuda-entity-type-id-dependent\"]',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.document = new Document({\n\t\t\t\trawDocumentType: this.documentType,\n\t\t\t\tdocumentFields: options.documentFields,\n\t\t\t\ttitle: options.documentName,\n\t\t\t});\n\n\t\t\tthis.initAutomationContext();\n\t\t\tthis.initFilterFields(options);\n\t\t\tthis.initReturnFields(options);\n\n\t\t\tthis.render();\n\t\t}\n\t}\n\n\tinitFilterFields(options)\n\t{\n\t\tthis.conditinIdPrefix = 'id_bca_cuda_field_';\n\t\tthis.filterFieldsContainer = document.querySelector('[data-role=\"bca-cuda-filter-fields-container\"]');\n\t\tthis.filteringFieldsPrefix = options.filteringFieldsPrefix;\n\t\tthis.filterFieldsMap = new Map(\n\t\t\tObject.entries(options.filterFieldsMap)\n\t\t\t\t.map(([entityTypeId, fieldsMap]) => [Number(entityTypeId), fieldsMap]),\n\t\t);\n\n\t\t// issue 0158608\n\t\tif (!Type.isNil(options.documentType) && !this.isRobot)\n\t\t{\n\t\t\tBX.Bizproc.Automation.API.documentType = options.documentType;\n\t\t}\n\t\tthis.conditionGroup = new ConditionGroup(options.conditions);\n\t}\n\n\tinitReturnFields(options)\n\t{\n\t\tthis.returnFieldsProperty = options.returnFieldsProperty;\n\t\tthis.returnFieldsIds = Type.isArray(options.returnFieldsIds) ? options.returnFieldsIds : [];\n\n\t\tthis.returnFieldsMapContainer = document.querySelector('[data-role=\"bca-cuda-return-fields-container\"]');\n\t\tthis.returnFieldsMap = new Map();\n\t\tObject.entries(options.returnFieldsMap).forEach(([entityTypeId, fieldsMap]) => {\n\t\t\tthis.returnFieldsMap.set(Number(entityTypeId), new Map(Object.entries(fieldsMap)));\n\t\t});\n\t}\n\n\tinitAutomationContext()\n\t{\n\t\ttry\n\t\t{\n\t\t\tgetGlobalContext();\n\t\t\tif (this.isRobot)\n\t\t\t{\n\t\t\t\tthis.onOpenFilterFieldsMenu = (event) => {\n\t\t\t\t\tconst dialog = Designer.getInstance().getRobotSettingsDialog();\n\t\t\t\t\tconst template = dialog.template;\n\t\t\t\t\tconst robot = dialog.robot;\n\t\t\t\t\tif (template && robot)\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplate.onOpenMenu(event, robot);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch(error)\n\t\t{\n\t\t\tsetGlobalContext(new Context({document: this.document}));\n\t\t\tthis.onOpenFilterFieldsMenu = (event) => this.addBPFields(event.getData().selector);\n\t\t}\n\t}\n\n\taddBPFields(selector: InlineSelector): void\n\t{\n\t\tconst getSelectorProperties = ({properties, objectName, expressionPrefix}) => {\n\t\t\tif (Type.isObject(properties))\n\t\t\t{\n\t\t\t\treturn Object.entries(properties).map(([id, property]) => ({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle: property.Name,\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\tfield: {\n\t\t\t\t\t\t\tId: id,\n\t\t\t\t\t\t\tType: property.Type,\n\t\t\t\t\t\t\tName: property.Name,\n\t\t\t\t\t\t\tObjectName: objectName,\n\t\t\t\t\t\t\tSystemExpression: `{=${objectName}:${id}}`,\n\t\t\t\t\t\t\tExpression: expressionPrefix ? `{{${expressionPrefix}:${id}}}` : `{=${objectName}:${id}}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\treturn [];\n\t\t}\n\t\tconst getGlobalSelectorProperties = ({properties, visibilityNames, objectName}) => {\n\t\t\tif (Type.isObject(properties))\n\t\t\t{\n\t\t\t\treturn Object.entries(properties).map(([id, property]) => {\n\t\t\t\t\tconst field = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tType: property.Type,\n\t\t\t\t\t\ttitle: property.Name,\n\t\t\t\t\t\tObjectName: objectName,\n\t\t\t\t\t\tSystemExpression: `{=${objectName}:${id}}`,\n\t\t\t\t\t\tExpression: `{=${objectName}:${id}}`,\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property.Visibility && visibilityNames[property.Visibility])\n\t\t\t\t\t{\n\t\t\t\t\t\tfield.Expression = `{{${visibilityNames[property.Visibility]}:${property.Name}}}`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle: property.Name,\n\t\t\t\t\t\tsupertitle: visibilityNames[property.Visibility],\n\t\t\t\t\t\tcustomData: { field },\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn [];\n\t\t}\n\n\t\tselector.addGroup('workflowParameters', {\n\t\t\tid: 'workflowParameters',\n\t\t\ttitle: Loc.getMessage('BIZPROC_WFEDIT_MENU_PARAMS'),\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: 'parameters',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_PARAMETERS_LIST'),\n\t\t\t\t\tchildren: getSelectorProperties({\n\t\t\t\t\t\tproperties: window.arWorkflowParameters || {},\n\t\t\t\t\t\tobjectName: 'Template',\n\t\t\t\t\t\texpressionPrefix: '~*',\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'variables',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST_1'),\n\t\t\t\t\tchildren: getSelectorProperties({\n\t\t\t\t\t\tproperties: window.arWorkflowVariables || {},\n\t\t\t\t\t\tobjectName: 'Variable',\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'constants',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CONSTANTS_LIST'),\n\t\t\t\t\tchildren: getSelectorProperties({\n\t\t\t\t\t\tproperties: window.arWorkflowConstants || {},\n\t\t\t\t\t\tobjectName: 'Constant',\n\t\t\t\t\t\texpressionPrefix: '~&',\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tif (window.arWorkflowGlobalVariables && window.wfGVarVisibilityNames)\n\t\t{\n\t\t\tselector.addGroup('globalVariables', {\n\t\t\t\tid: 'globalVariables',\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST'),\n\t\t\t\tchildren: getGlobalSelectorProperties({\n\t\t\t\t\tproperties: window.arWorkflowGlobalVariables || {},\n\t\t\t\t\tvisibilityNames: window.wfGVarVisibilityNames || {},\n\t\t\t\t\tobjectName: 'GlobalVar',\n\t\t\t\t}),\n\t\t\t});\n\t\t}\n\t\tselector.addGroup('globalConstants', {\n\t\t\tid: 'globalConstants',\n\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_GLOB_CONSTANTS_LIST'),\n\t\t\tchildren: getGlobalSelectorProperties({\n\t\t\t\tproperties: window.arWorkflowGlobalConstants || {},\n\t\t\t\tvisibilityNames: window.wfGConstVisibilityNames || {},\n\t\t\t\tobjectName: 'GlobalConst',\n\t\t\t}),\n\t\t});\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.entityTypeIdSelect)\n\t\t{\n\t\t\tEvent.bind(this.entityTypeIdSelect, 'change', this.onEntityTypeIdChange.bind(this));\n\t\t}\n\t}\n\n\tonEntityTypeIdChange(): void\n\t{\n\t\tthis.currentEntityTypeId = Number(this.entityTypeIdSelect.value);\n\n\t\tthis.conditionGroup = new ConditionGroup();\n\n\t\tthis.returnFieldsIds = [];\n\n\t\tthis.render();\n\t}\n\n\trender(): void\n\t{\n\t\tif (Type.isNil(this.currentEntityTypeId) || this.currentEntityTypeId === 0)\n\t\t{\n\t\t\tthis.entityTypeDependentElements.forEach((element) => Dom.hide(element));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.entityTypeDependentElements.forEach((element) => Dom.show(element));\n\t\t\tthis.renderFilterFields();\n\t\t\tthis.renderReturnFields();\n\t\t}\n\t}\n\n\trenderFilterFields(): void\n\t{\n\t\tif (\n\t\t\t!Type.isNil(this.conditionGroup)\n\t\t\t&& this.currentEntityTypeId !== 0\n\t\t)\n\t\t{\n\t\t\tconst selector = new ConditionGroupSelector(this.conditionGroup, {\n\t\t\t\tfields: Object.values(this.filterFieldsMap.get(this.currentEntityTypeId)),\n\t\t\t\tfieldPrefix: this.filteringFieldsPrefix,\n\t\t\t\tonOpenMenu: this.onOpenFilterFieldsMenu,\n\t\t\t});\n\n\t\t\tDom.clean(this.filterFieldsContainer);\n\t\t\tthis.filterFieldsContainer.appendChild(selector.createNode());\n\t\t}\n\t}\n\n\trenderReturnFields(): void\n\t{\n\t\tconst entityTypeId = this.currentEntityTypeId;\n\t\tconst fieldsMap = this.returnFieldsMap.get(entityTypeId);\n\n\t\tif (!Type.isNil(fieldsMap))\n\t\t{\n\t\t\tconst fieldOptions = {};\n\t\t\tfieldsMap.forEach((field, fieldId) => {\n\t\t\t\tfieldOptions[fieldId] = field.Name;\n\t\t\t});\n\t\t\tthis.returnFieldsProperty.Options = fieldOptions;\n\n\t\t\tDom.clean(this.returnFieldsMapContainer);\n\t\t\tthis.returnFieldsMapContainer.appendChild(\n\t\t\t\tBX.Bizproc.FieldType.renderControl(\n\t\t\t\t\tthis.documentType,\n\t\t\t\t\tthis.returnFieldsProperty,\n\t\t\t\t\tthis.returnFieldsProperty.FieldName,\n\t\t\t\t\tthis.returnFieldsIds,\n\t\t\t\t\tthis.isRobot ? 'public' : 'designer',\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t}\n}\n\nnamespace.CrmGetDynamicInfoActivity = CrmGetDynamicInfoActivity;"],"names":["namespace","Reflection","CrmGetDynamicInfoActivity","options","Type","isPlainObject","documentType","isRobot","form","document","forms","formName","isNil","entityTypeIdSelect","dynamic_type_id","currentEntityTypeId","Number","value","entityTypeDependentElements","querySelectorAll","Document","rawDocumentType","documentFields","title","documentName","initAutomationContext","initFilterFields","initReturnFields","render","conditinIdPrefix","filterFieldsContainer","querySelector","filteringFieldsPrefix","filterFieldsMap","Map","Object","entries","map","entityTypeId","fieldsMap","BX","Bizproc","Automation","API","conditionGroup","ConditionGroup","conditions","returnFieldsProperty","returnFieldsIds","isArray","returnFieldsMapContainer","returnFieldsMap","forEach","set","getGlobalContext","onOpenFilterFieldsMenu","event","dialog","Designer","getInstance","getRobotSettingsDialog","template","robot","onOpenMenu","error","setGlobalContext","Context","addBPFields","getData","selector","getSelectorProperties","properties","objectName","expressionPrefix","isObject","id","property","Name","customData","field","Id","ObjectName","SystemExpression","Expression","getGlobalSelectorProperties","visibilityNames","Visibility","supertitle","addGroup","Loc","getMessage","children","window","arWorkflowParameters","arWorkflowVariables","arWorkflowConstants","arWorkflowGlobalVariables","wfGVarVisibilityNames","arWorkflowGlobalConstants","wfGConstVisibilityNames","Event","bind","onEntityTypeIdChange","element","Dom","hide","show","renderFilterFields","renderReturnFields","ConditionGroupSelector","fields","values","get","fieldPrefix","clean","appendChild","createNode","fieldOptions","fieldId","Options","FieldType","renderControl","FieldName"],"mappings":";;;CAYA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,iBAArB,CAAlB;;KAEME;CAqBL,qCAAYC,OAAZ,EACA;CAAA;;CACC,QAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;CACC,WAAKG,YAAL,GAAoBH,OAAO,CAACG,YAA5B;CACA,WAAKC,OAAL,GAAeJ,OAAO,CAACI,OAAvB;CACA,UAAMC,IAAI,GAAGC,QAAQ,CAACC,KAAT,CAAeP,OAAO,CAACQ,QAAvB,CAAb;;CAEA,UAAI,CAACP,cAAI,CAACQ,KAAL,CAAWJ,IAAX,CAAL,EACA;CACC,aAAKK,kBAAL,GAA0BL,IAAI,CAACM,eAA/B;CACA,aAAKC,mBAAL,GAA2BC,MAAM,CAAC,KAAKH,kBAAL,CAAwBI,KAAzB,CAAjC;CACA,aAAKC,2BAAL,GAAmCT,QAAQ,CAACU,gBAAT,CAClC,iDADkC,CAAnC;CAGA;;CAED,WAAKV,QAAL,GAAgB,IAAIW,2BAAJ,CAAa;CAC5BC,QAAAA,eAAe,EAAE,KAAKf,YADM;CAE5BgB,QAAAA,cAAc,EAAEnB,OAAO,CAACmB,cAFI;CAG5BC,QAAAA,KAAK,EAAEpB,OAAO,CAACqB;CAHa,OAAb,CAAhB;CAMA,WAAKC,qBAAL;CACA,WAAKC,gBAAL,CAAsBvB,OAAtB;CACA,WAAKwB,gBAAL,CAAsBxB,OAAtB;CAEA,WAAKyB,MAAL;CACA;CACD;;;;sCAEgBzB,SACjB;CACC,WAAK0B,gBAAL,GAAwB,oBAAxB;CACA,WAAKC,qBAAL,GAA6BrB,QAAQ,CAACsB,aAAT,CAAuB,gDAAvB,CAA7B;CACA,WAAKC,qBAAL,GAA6B7B,OAAO,CAAC6B,qBAArC;CACA,WAAKC,eAAL,GAAuB,IAAIC,GAAJ,CACtBC,MAAM,CAACC,OAAP,CAAejC,OAAO,CAAC8B,eAAvB,EACEI,GADF,CACM;CAAA;CAAA,YAAEC,YAAF;CAAA,YAAgBC,SAAhB;;CAAA,eAA+B,CAACvB,MAAM,CAACsB,YAAD,CAAP,EAAuBC,SAAvB,CAA/B;CAAA,OADN,CADsB,CAAvB,CAJD;;CAUC,UAAI,CAACnC,cAAI,CAACQ,KAAL,CAAWT,OAAO,CAACG,YAAnB,CAAD,IAAqC,CAAC,KAAKC,OAA/C,EACA;CACCiC,QAAAA,EAAE,CAACC,OAAH,CAAWC,UAAX,CAAsBC,GAAtB,CAA0BrC,YAA1B,GAAyCH,OAAO,CAACG,YAAjD;CACA;;CACD,WAAKsC,cAAL,GAAsB,IAAIC,iCAAJ,CAAmB1C,OAAO,CAAC2C,UAA3B,CAAtB;CACA;;;sCAEgB3C,SACjB;CAAA;;CACC,WAAK4C,oBAAL,GAA4B5C,OAAO,CAAC4C,oBAApC;CACA,WAAKC,eAAL,GAAuB5C,cAAI,CAAC6C,OAAL,CAAa9C,OAAO,CAAC6C,eAArB,IAAwC7C,OAAO,CAAC6C,eAAhD,GAAkE,EAAzF;CAEA,WAAKE,wBAAL,GAAgCzC,QAAQ,CAACsB,aAAT,CAAuB,gDAAvB,CAAhC;CACA,WAAKoB,eAAL,GAAuB,IAAIjB,GAAJ,EAAvB;CACAC,MAAAA,MAAM,CAACC,OAAP,CAAejC,OAAO,CAACgD,eAAvB,EAAwCC,OAAxC,CAAgD,iBAA+B;CAAA;CAAA,YAA7Bd,YAA6B;CAAA,YAAfC,SAAe;;CAC9E,QAAA,KAAI,CAACY,eAAL,CAAqBE,GAArB,CAAyBrC,MAAM,CAACsB,YAAD,CAA/B,EAA+C,IAAIJ,GAAJ,CAAQC,MAAM,CAACC,OAAP,CAAeG,SAAf,CAAR,CAA/C;CACA,OAFD;CAGA;;;6CAGD;CAAA;;CACC,UACA;CACCe,QAAAA,mCAAgB;;CAChB,YAAI,KAAK/C,OAAT,EACA;CACC,eAAKgD,sBAAL,GAA8B,UAACC,KAAD,EAAW;CACxC,gBAAMC,MAAM,GAAGC,2BAAQ,CAACC,WAAT,GAAuBC,sBAAvB,EAAf;CACA,gBAAMC,QAAQ,GAAGJ,MAAM,CAACI,QAAxB;CACA,gBAAMC,KAAK,GAAGL,MAAM,CAACK,KAArB;;CACA,gBAAID,QAAQ,IAAIC,KAAhB,EACA;CACCD,cAAAA,QAAQ,CAACE,UAAT,CAAoBP,KAApB,EAA2BM,KAA3B;CACA;CACD,WARD;CASA;CACD,OAfD,CAgBA,OAAME,KAAN,EACA;CACCC,QAAAA,mCAAgB,CAAC,IAAIC,0BAAJ,CAAY;CAACzD,UAAAA,QAAQ,EAAE,KAAKA;CAAhB,SAAZ,CAAD,CAAhB;;CACA,aAAK8C,sBAAL,GAA8B,UAACC,KAAD;CAAA,iBAAW,MAAI,CAACW,WAAL,CAAiBX,KAAK,CAACY,OAAN,GAAgBC,QAAjC,CAAX;CAAA,SAA9B;CACA;CACD;;;iCAEWA,UACZ;CACC,UAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,QAAgD;CAAA,YAA9CC,UAA8C,SAA9CA,UAA8C;CAAA,YAAlCC,UAAkC,SAAlCA,UAAkC;CAAA,YAAtBC,gBAAsB,SAAtBA,gBAAsB;;CAC7E,YAAIrE,cAAI,CAACsE,QAAL,CAAcH,UAAd,CAAJ,EACA;CACC,iBAAOpC,MAAM,CAACC,OAAP,CAAemC,UAAf,EAA2BlC,GAA3B,CAA+B;CAAA;CAAA,gBAAEsC,EAAF;CAAA,gBAAMC,QAAN;;CAAA,mBAAqB;CAC1DD,cAAAA,EAAE,EAAFA,EAD0D;CAE1DpD,cAAAA,KAAK,EAAEqD,QAAQ,CAACC,IAF0C;CAG1DC,cAAAA,UAAU,EAAE;CACXC,gBAAAA,KAAK,EAAE;CACNC,kBAAAA,EAAE,EAAEL,EADE;CAENvE,kBAAAA,IAAI,EAAEwE,QAAQ,CAACxE,IAFT;CAGNyE,kBAAAA,IAAI,EAAED,QAAQ,CAACC,IAHT;CAINI,kBAAAA,UAAU,EAAET,UAJN;CAKNU,kBAAAA,gBAAgB,cAAOV,UAAP,cAAqBG,EAArB,MALV;CAMNQ,kBAAAA,UAAU,EAAEV,gBAAgB,eAAQA,gBAAR,cAA4BE,EAA5B,sBAA0CH,UAA1C,cAAwDG,EAAxD;CANtB;CADI;CAH8C,aAArB;CAAA,WAA/B,CAAP;CAcA;;CAED,eAAO,EAAP;CACA,OApBD;;CAqBA,UAAMS,2BAA2B,GAAG,SAA9BA,2BAA8B,QAA+C;CAAA,YAA7Cb,UAA6C,SAA7CA,UAA6C;CAAA,YAAjCc,eAAiC,SAAjCA,eAAiC;CAAA,YAAhBb,UAAgB,SAAhBA,UAAgB;;CAClF,YAAIpE,cAAI,CAACsE,QAAL,CAAcH,UAAd,CAAJ,EACA;CACC,iBAAOpC,MAAM,CAACC,OAAP,CAAemC,UAAf,EAA2BlC,GAA3B,CAA+B,iBAAoB;CAAA;CAAA,gBAAlBsC,EAAkB;CAAA,gBAAdC,QAAc;;CACzD,gBAAMG,KAAK,GAAG;CACbJ,cAAAA,EAAE,EAAFA,EADa;CAEbvE,cAAAA,IAAI,EAAEwE,QAAQ,CAACxE,IAFF;CAGbmB,cAAAA,KAAK,EAAEqD,QAAQ,CAACC,IAHH;CAIbI,cAAAA,UAAU,EAAET,UAJC;CAKbU,cAAAA,gBAAgB,cAAOV,UAAP,cAAqBG,EAArB,MALH;CAMbQ,cAAAA,UAAU,cAAOX,UAAP,cAAqBG,EAArB;CANG,aAAd;;CASA,gBAAIC,QAAQ,CAACU,UAAT,IAAuBD,eAAe,CAACT,QAAQ,CAACU,UAAV,CAA1C,EACA;CACCP,cAAAA,KAAK,CAACI,UAAN,eAAwBE,eAAe,CAACT,QAAQ,CAACU,UAAV,CAAvC,cAAgEV,QAAQ,CAACC,IAAzE;CACA;;CAED,mBAAO;CACNF,cAAAA,EAAE,EAAFA,EADM;CAENpD,cAAAA,KAAK,EAAEqD,QAAQ,CAACC,IAFV;CAGNU,cAAAA,UAAU,EAAEF,eAAe,CAACT,QAAQ,CAACU,UAAV,CAHrB;CAINR,cAAAA,UAAU,EAAE;CAAEC,gBAAAA,KAAK,EAALA;CAAF;CAJN,aAAP;CAMA,WArBM,CAAP;CAsBA;;CAED,eAAO,EAAP;CACA,OA5BD;;CA8BAV,MAAAA,QAAQ,CAACmB,QAAT,CAAkB,oBAAlB,EAAwC;CACvCb,QAAAA,EAAE,EAAE,oBADmC;CAEvCpD,QAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAFgC;CAGvCC,QAAAA,QAAQ,EAAE,CACT;CACChB,UAAAA,EAAE,EAAE,YADL;CAECpD,UAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,wCAAf,CAFR;CAGCC,UAAAA,QAAQ,EAAErB,qBAAqB,CAAC;CAC/BC,YAAAA,UAAU,EAAEqB,MAAM,CAACC,oBAAP,IAA+B,EADZ;CAE/BrB,YAAAA,UAAU,EAAE,UAFmB;CAG/BC,YAAAA,gBAAgB,EAAE;CAHa,WAAD;CAHhC,SADS,EAUT;CACCE,UAAAA,EAAE,EAAE,WADL;CAECpD,UAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,8CAAf,CAFR;CAGCC,UAAAA,QAAQ,EAAErB,qBAAqB,CAAC;CAC/BC,YAAAA,UAAU,EAAEqB,MAAM,CAACE,mBAAP,IAA8B,EADX;CAE/BtB,YAAAA,UAAU,EAAE;CAFmB,WAAD;CAHhC,SAVS,EAkBT;CACCG,UAAAA,EAAE,EAAE,WADL;CAECpD,UAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,uCAAf,CAFR;CAGCC,UAAAA,QAAQ,EAAErB,qBAAqB,CAAC;CAC/BC,YAAAA,UAAU,EAAEqB,MAAM,CAACG,mBAAP,IAA8B,EADX;CAE/BvB,YAAAA,UAAU,EAAE,UAFmB;CAG/BC,YAAAA,gBAAgB,EAAE;CAHa,WAAD;CAHhC,SAlBS;CAH6B,OAAxC;;CAgCA,UAAImB,MAAM,CAACI,yBAAP,IAAoCJ,MAAM,CAACK,qBAA/C,EACA;CACC5B,QAAAA,QAAQ,CAACmB,QAAT,CAAkB,iBAAlB,EAAqC;CACpCb,UAAAA,EAAE,EAAE,iBADgC;CAEpCpD,UAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,4CAAf,CAF6B;CAGpCC,UAAAA,QAAQ,EAAEP,2BAA2B,CAAC;CACrCb,YAAAA,UAAU,EAAEqB,MAAM,CAACI,yBAAP,IAAoC,EADX;CAErCX,YAAAA,eAAe,EAAEO,MAAM,CAACK,qBAAP,IAAgC,EAFZ;CAGrCzB,YAAAA,UAAU,EAAE;CAHyB,WAAD;CAHD,SAArC;CASA;;CACDH,MAAAA,QAAQ,CAACmB,QAAT,CAAkB,iBAAlB,EAAqC;CACpCb,QAAAA,EAAE,EAAE,iBADgC;CAEpCpD,QAAAA,KAAK,EAAEkE,aAAG,CAACC,UAAJ,CAAe,4CAAf,CAF6B;CAGpCC,QAAAA,QAAQ,EAAEP,2BAA2B,CAAC;CACrCb,UAAAA,UAAU,EAAEqB,MAAM,CAACM,yBAAP,IAAoC,EADX;CAErCb,UAAAA,eAAe,EAAEO,MAAM,CAACO,uBAAP,IAAkC,EAFd;CAGrC3B,UAAAA,UAAU,EAAE;CAHyB,SAAD;CAHD,OAArC;CASA;;;4BAGD;CACC,UAAI,KAAK3D,kBAAT,EACA;CACCuF,QAAAA,eAAK,CAACC,IAAN,CAAW,KAAKxF,kBAAhB,EAAoC,QAApC,EAA8C,KAAKyF,oBAAL,CAA0BD,IAA1B,CAA+B,IAA/B,CAA9C;CACA;CACD;;;4CAGD;CACC,WAAKtF,mBAAL,GAA2BC,MAAM,CAAC,KAAKH,kBAAL,CAAwBI,KAAzB,CAAjC;CAEA,WAAK2B,cAAL,GAAsB,IAAIC,iCAAJ,EAAtB;CAEA,WAAKG,eAAL,GAAuB,EAAvB;CAEA,WAAKpB,MAAL;CACA;;;8BAGD;CACC,UAAIxB,cAAI,CAACQ,KAAL,CAAW,KAAKG,mBAAhB,KAAwC,KAAKA,mBAAL,KAA6B,CAAzE,EACA;CACC,aAAKG,2BAAL,CAAiCkC,OAAjC,CAAyC,UAACmD,OAAD;CAAA,iBAAaC,aAAG,CAACC,IAAJ,CAASF,OAAT,CAAb;CAAA,SAAzC;CACA,OAHD,MAKA;CACC,aAAKrF,2BAAL,CAAiCkC,OAAjC,CAAyC,UAACmD,OAAD;CAAA,iBAAaC,aAAG,CAACE,IAAJ,CAASH,OAAT,CAAb;CAAA,SAAzC;CACA,aAAKI,kBAAL;CACA,aAAKC,kBAAL;CACA;CACD;;;0CAGD;CACC,UACC,CAACxG,cAAI,CAACQ,KAAL,CAAW,KAAKgC,cAAhB,CAAD,IACG,KAAK7B,mBAAL,KAA6B,CAFjC,EAIA;CACC,YAAMsD,QAAQ,GAAG,IAAIwC,yCAAJ,CAA2B,KAAKjE,cAAhC,EAAgD;CAChEkE,UAAAA,MAAM,EAAE3E,MAAM,CAAC4E,MAAP,CAAc,KAAK9E,eAAL,CAAqB+E,GAArB,CAAyB,KAAKjG,mBAA9B,CAAd,CADwD;CAEhEkG,UAAAA,WAAW,EAAE,KAAKjF,qBAF8C;CAGhE+B,UAAAA,UAAU,EAAE,KAAKR;CAH+C,SAAhD,CAAjB;CAMAiD,QAAAA,aAAG,CAACU,KAAJ,CAAU,KAAKpF,qBAAf;CACA,aAAKA,qBAAL,CAA2BqF,WAA3B,CAAuC9C,QAAQ,CAAC+C,UAAT,EAAvC;CACA;CACD;;;0CAGD;CACC,UAAM9E,YAAY,GAAG,KAAKvB,mBAA1B;CACA,UAAMwB,SAAS,GAAG,KAAKY,eAAL,CAAqB6D,GAArB,CAAyB1E,YAAzB,CAAlB;;CAEA,UAAI,CAAClC,cAAI,CAACQ,KAAL,CAAW2B,SAAX,CAAL,EACA;CACC,YAAM8E,YAAY,GAAG,EAArB;CACA9E,QAAAA,SAAS,CAACa,OAAV,CAAkB,UAAC2B,KAAD,EAAQuC,OAAR,EAAoB;CACrCD,UAAAA,YAAY,CAACC,OAAD,CAAZ,GAAwBvC,KAAK,CAACF,IAA9B;CACA,SAFD;CAGA,aAAK9B,oBAAL,CAA0BwE,OAA1B,GAAoCF,YAApC;CAEAb,QAAAA,aAAG,CAACU,KAAJ,CAAU,KAAKhE,wBAAf;CACA,aAAKA,wBAAL,CAA8BiE,WAA9B,CACC3E,EAAE,CAACC,OAAH,CAAW+E,SAAX,CAAqBC,aAArB,CACC,KAAKnH,YADN,EAEC,KAAKyC,oBAFN,EAGC,KAAKA,oBAAL,CAA0B2E,SAH3B,EAIC,KAAK1E,eAJN,EAKC,KAAKzC,OAAL,GAAe,QAAf,GAA0B,UAL3B,CADD;CASA;CACD;;;;;CAGFP,SAAS,CAACE,yBAAV,GAAsCA,yBAAtC;;;;"}