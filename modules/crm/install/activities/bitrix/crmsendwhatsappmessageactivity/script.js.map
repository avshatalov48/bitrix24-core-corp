{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Reflection, Type, Event, ajax, Text, Dom } from 'main.core';\nimport { Editor, FilledPlaceholder } from 'crm.template.editor';\nimport { Designer, tryGetGlobalContext, Template, SelectorItemsManager, enrichFieldsWithModifiers } from 'bizproc.automation';\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nimport './css/style.css';\n\nclass CrmSendWhatsAllMessageActivity\n{\n\t#isRobot: boolean;\n\t#documentType: [];\n\t#formName: string;\n\t#editorWrapper: HTMLDivElement;\n\t#templates: Map = new Map();\n\t#placeholders: Map = new Map();\n\t#templateId: number;\n\n\t#dialogItems: [] = [];\n\t#items: Object<string, { title: string, parentTitle: string }> = {};\n\n\tconstructor(options: {\n\t\tisRobot: boolean,\n\t\tdocumentType: [],\n\t\tformName: string,\n\t\teditorWrapper: HTMLDivElement,\n\t\tcurrentTemplateId: ?string,\n\t\tcurrentTemplate: ?{},\n\t\tcurrentPlaceholders: ?{},\n\t})\n\t{\n\t\tthis.#isRobot = Type.isBoolean(options.isRobot) ? options.isRobot : true;\n\n\t\tif (!Type.isArrayFilled(options.documentType))\n\t\t{\n\t\t\tthrow new Error('documentType must be filled array');\n\t\t}\n\t\tthis.#documentType = options.documentType;\n\n\t\tif (!Type.isElementNode(options.editorWrapper))\n\t\t{\n\t\t\tthrow new Error('editorWrapper must be HTMLDivElement');\n\t\t}\n\t\tthis.#editorWrapper = options.editorWrapper;\n\n\t\tif (!Type.isStringFilled(options.formName))\n\t\t{\n\t\t\tthrow new Error('formName must be filled string');\n\t\t}\n\t\tthis.#formName = options.formName;\n\n\t\tconst form = document.forms[this.#formName];\n\t\tif (!form || !form.template_id)\n\t\t{\n\t\t\tthrow new Error('form must have template_id element');\n\t\t}\n\t\tEvent.bind(form.template_id, 'change', this.#onChangeTemplate.bind(this));\n\n\t\tthis.#setOnBeforeSaveSettingsCallback();\n\n\t\tthis.#fillDialogItems();\n\t\tif (Type.isPlainObject(options.currentTemplate) && (Text.toInteger(options.currentTemplateId) > 0))\n\t\t{\n\t\t\tthis.#setCurrentTemplate(\n\t\t\t\tText.toInteger(options.currentTemplateId),\n\t\t\t\toptions.currentTemplate,\n\t\t\t\toptions.currentPlaceholders,\n\t\t\t);\n\t\t}\n\t}\n\n\t#onChangeTemplate(event): void\n\t{\n\t\tconst target: ?HTMLSelectElement = event.target;\n\t\tif (!target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedOptions = target.selectedOptions;\n\t\tconst templateId = selectedOptions.item(0) ? Text.toInteger(selectedOptions.item(0).value) : 0;\n\n\t\tthis.#templateId = templateId;\n\n\t\tif (templateId <= 0)\n\t\t{\n\t\t\tthis.#removeTemplateEditor();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#templates.has(templateId))\n\t\t{\n\t\t\tthis.#insertTemplateEditor(templateId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#loadTemplate(templateId)\n\t\t\t.then(({ data }) => {\n\t\t\t\tif (Type.isPlainObject(data))\n\t\t\t\t{\n\t\t\t\t\tthis.#addTemplate(templateId, data);\n\t\t\t\t\tthis.#insertTemplateEditor(templateId);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => console.error(response.errors))\n\t\t;\n\t}\n\n\t#setOnBeforeSaveSettingsCallback(): void\n\t{\n\t\tif (!this.#isRobot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst designer = Designer.getInstance();\n\t\tconst dialog = designer ? designer.getRobotSettingsDialog() : null;\n\t\tif (dialog?.robot)\n\t\t{\n\t\t\tdialog.robot.setOnBeforeSaveRobotSettings(this.#onBeforeSaveRobotSettings.bind(this));\n\t\t}\n\t}\n\n\t#setCurrentTemplate(templateId: number, template: {}, placeholders): void\n\t{\n\t\tthis.#templateId = templateId;\n\t\tthis.#addTemplate(templateId, template);\n\t\tif (Type.isPlainObject(placeholders))\n\t\t{\n\t\t\tconst templatePlaceholders: Map = this.#placeholders.get(templateId);\n\t\t\tObject.entries(placeholders).forEach(([key: string, value: string]) => {\n\t\t\t\tif (Object.hasOwn(this.#items, value))\n\t\t\t\t{\n\t\t\t\t\ttemplatePlaceholders.set(\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\t{ value, parentTitle: this.#items[value].parentTitle, title: this.#items[value].title },\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#insertTemplateEditor(templateId);\n\t}\n\n\t#addTemplate(templateId: number, data: {}): void\n\t{\n\t\tconst content = Type.isString(data.content) ? data.content : '';\n\n\t\tthis.#templates.set(\n\t\t\ttemplateId,\n\t\t\t{\n\t\t\t\tcontent: Text.encode(content).replaceAll('\\n', '<br>'),\n\t\t\t\tplaceholders: Type.isPlainObject(data.placeholders) ? data.placeholders : {},\n\t\t\t},\n\t\t);\n\t\tthis.#placeholders.set(templateId, new Map());\n\t}\n\n\t#loadTemplate(templateId: number): Promise\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'bizproc.activity.request',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tdocumentType: this.#documentType,\n\t\t\t\t\tactivity: 'CrmSendWhatsAppMessageActivity',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttemplate_id: templateId,\n\t\t\t\t\t\tform_name: this.#formName,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t#insertTemplateEditor(templateId: number): void\n\t{\n\t\tconst data = this.#templates.get(templateId);\n\n\t\tDom.addClass(this.#editorWrapper, 'bizproc-automation-whats-app-message-activity-editor');\n\t\tDom.removeClass(\n\t\t\tthis.#isRobot ? this.#editorWrapper.parentElement : this.#editorWrapper.parentElement?.parentElement,\n\t\t\t'--hidden',\n\t\t);\n\n\t\tconst editor = new Editor({\n\t\t\ttarget: this.#editorWrapper,\n\t\t\tonSelect: ({ id, value, parentTitle, title }) => {\n\t\t\t\tconst templatePlaceholders: Map = this.#placeholders.get(templateId);\n\t\t\t\ttemplatePlaceholders.set(id, { value, parentTitle, title });\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\titems: this.#dialogItems,\n\t\t\t\tentities: [],\n\t\t\t},\n\t\t\tusePlaceholderProvider: false,\n\t\t\tcanUseFieldsDialog: true,\n\t\t\tcanUseFieldValueInput: false,\n\t\t});\n\n\t\teditor\n\t\t\t.setPlaceholders(data.placeholders)\n\t\t\t.setFilledPlaceholders(this.#prepareFilledPlaceholders(templateId))\n\t\t\t.setBody(data.content)\n\t\t;\n\t}\n\n\t#fillDialogItems(): void\n\t{\n\t\tif (!this.#isRobot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = tryGetGlobalContext();\n\t\tif (!context)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst designer = Designer.getInstance();\n\t\tconst component = designer ? designer.component : null;\n\t\tconst dialog = designer ? designer.getRobotSettingsDialog() : null;\n\t\tconst template: Template = dialog ? dialog.template : null;\n\t\tconst triggerManager = component ? component.triggerManager : null;\n\n\t\tconst robotsWithReturnFields = template ? template.getRobotsWithReturnFields(dialog.robot) : [];\n\n\t\tconst manager = new SelectorItemsManager({\n\t\t\tdocumentFields: enrichFieldsWithModifiers(context.document.getFields(), 'Document'),\n\t\t\tdocumentTitle: context.document.title,\n\t\t\tglobalVariables: context.automationGlobals.globalVariables,\n\t\t\tvariables: template ? template.getVariables() : null,\n\t\t\tglobalConstants: context.automationGlobals.globalConstants,\n\t\t\tconstants: template ? template.getConstants() : null,\n\t\t\tactivityResultFields: (\n\t\t\t\trobotsWithReturnFields.map((robot) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: robot.getId(),\n\t\t\t\t\t\ttitle: robot.getTitle(),\n\t\t\t\t\t\tfields: enrichFieldsWithModifiers(\n\t\t\t\t\t\t\trobot.getReturnFieldsDescription(),\n\t\t\t\t\t\t\trobot.getId(),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfriendly: false,\n\t\t\t\t\t\t\t\tprintable: false,\n\t\t\t\t\t\t\t\tserver: false,\n\t\t\t\t\t\t\t\tresponsible: false,\n\t\t\t\t\t\t\t\tshortLink: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t),\n\t\t\ttriggerResultFields: (\n\t\t\t\ttriggerManager && template ? triggerManager.getReturnProperties(template.getStatusId()) : null\n\t\t\t),\n\t\t\tuseModifier: true,\n\t\t});\n\n\t\tthis.#dialogItems = manager.groupsWithChildren;\n\t\tmanager.items.forEach((field) => {\n\t\t\tthis.#items[field.id] = {\n\t\t\t\ttitle: field.title,\n\t\t\t\tparentTitle: field.supertitle,\n\t\t\t};\n\t\t});\n\t}\n\n\t#prepareFilledPlaceholders(templateId: number): FilledPlaceholder[]\n\t{\n\t\tconst placeholders = [];\n\n\t\tconst templatePlaceholders: Map = this.#placeholders.get(templateId);\n\t\ttemplatePlaceholders.forEach((data, key) => {\n\t\t\tplaceholders.push({\n\t\t\t\tPLACEHOLDER_ID: key,\n\t\t\t\tFIELD_NAME: data.value,\n\t\t\t\tFIELD_ENTITY_TYPE: 'bp',\n\t\t\t\tTITLE: data.title,\n\t\t\t\tPARENT_TITLE: data.parentTitle,\n\t\t\t});\n\t\t});\n\n\t\treturn placeholders;\n\t}\n\n\t#removeTemplateEditor(): void\n\t{\n\t\tDom.removeClass(this.#editorWrapper, 'bizproc-automation-whats-app-message-activity-editor');\n\t\tDom.clean(this.#editorWrapper);\n\t\tDom.addClass(\n\t\t\tthis.#isRobot ? this.#editorWrapper.parentElement : this.#editorWrapper.parentElement?.parentElement,\n\t\t\t'--hidden',\n\t\t);\n\t}\n\n\t#onBeforeSaveRobotSettings(): Object\n\t{\n\t\tif (this.#templateId > 0)\n\t\t{\n\t\t\tconst placeholders = {};\n\t\t\tthis.#placeholders.get(this.#templateId).forEach(({ value }, key) => {\n\t\t\t\tplaceholders[key] = value;\n\t\t\t});\n\n\t\t\treturn { placeholders };\n\t\t}\n\n\t\treturn {};\n\t}\n}\n\nnamespace.CrmSendWhatsAllMessageActivity = CrmSendWhatsAllMessageActivity;\n"],"names":["namespace","Reflection","CrmSendWhatsAllMessageActivity","constructor","options","Map","Type","isBoolean","isRobot","isArrayFilled","documentType","Error","isElementNode","editorWrapper","isStringFilled","formName","form","document","forms","template_id","Event","bind","isPlainObject","currentTemplate","Text","toInteger","currentTemplateId","currentPlaceholders","event","target","selectedOptions","templateId","item","value","has","then","data","catch","response","console","error","errors","designer","Designer","getInstance","dialog","getRobotSettingsDialog","robot","setOnBeforeSaveRobotSettings","template","placeholders","templatePlaceholders","get","Object","entries","forEach","key","hasOwn","set","parentTitle","title","content","isString","encode","replaceAll","ajax","runAction","activity","params","form_name","Dom","addClass","removeClass","parentElement","editor","Editor","onSelect","id","dialogOptions","items","entities","usePlaceholderProvider","canUseFieldsDialog","canUseFieldValueInput","setPlaceholders","setFilledPlaceholders","setBody","context","tryGetGlobalContext","component","triggerManager","robotsWithReturnFields","getRobotsWithReturnFields","manager","SelectorItemsManager","documentFields","enrichFieldsWithModifiers","getFields","documentTitle","globalVariables","automationGlobals","variables","getVariables","globalConstants","constants","getConstants","activityResultFields","map","getId","getTitle","fields","getReturnFieldsDescription","friendly","printable","server","responsible","shortLink","triggerResultFields","getReturnProperties","getStatusId","useModifier","groupsWithChildren","field","supertitle","push","PLACEHOLDER_ID","FIELD_NAME","FIELD_ENTITY_TYPE","TITLE","PARENT_TITLE","clean"],"mappings":"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"}