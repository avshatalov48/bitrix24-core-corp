this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,n,a){"use strict";var s=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,t);this.width=e}babelHelpers.createClass(t,[{key:"getSliderId",value:function t(){return""}},{key:"show",value:function t(){}}]);return t}();var i,o,r,l,c,u,d,g,_,f,v,h,R;var O=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.tag=a.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(["<div/>"])));BX.addCustomEvent(window,"seo-client-auth-result",(function(e){var n;e.reload=false;(n=t.slider)===null||n===void 0?void 0:n.reload()}));return t}babelHelpers.createClass(e,[{key:"getSliderId",value:function t(){return this.code+":conversion"}},{key:"getSliderTitle",value:function t(){switch(this.type){case"facebook.form":return a.Loc.getMessage("CRM_ADS_CONVERSION_FORM_SLIDER_TITLE");case"facebook.lead":return a.Loc.getMessage("CRM_ADS_CONVERSION_LEAD_SLIDER_TITLE");case"facebook.deal":return a.Loc.getMessage("CRM_ADS_CONVERSION_DEAL_SLIDER_TITLE");case"facebook.payment":return a.Loc.getMessage("CRM_ADS_CONVERSION_PAYMENT_SLIDER_TITLE");default:return""}}},{key:"notify",value:function t(e){BX.UI.Notification.Center.notify({content:e})}},{key:"saveConfiguration",value:function t(e){return BX.ajax.runAction("crm.ads.conversion.saveConfiguration",{data:{code:this.code,configuration:e}})}},{key:"onItemEnable",value:function t(e,n){var s=this;this.data.configuration.items=a.Type.isArray(this.data.configuration.items)?this.data.configuration.items:[];if(!this.data.configuration.items.includes(e)){this.data.configuration.items.push(e)}this.saveConfiguration(this.data.configuration).then((function(t){if(!t.data.success){n.check(true,false);s.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}}))["catch"]((function(){n.check(true,false);s.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}))}},{key:"onItemDisable",value:function t(e,n){var s=this;this.data.configuration.items=a.Type.isArray(this.data.configuration.items)?this.data.configuration.items:[];for(var i=0;i<this.data.configuration.items.length;i++){if(e==this.data.configuration.items[i]){this.data.configuration.items.splice(i,1);break}}this.saveConfiguration(this.data.configuration).then((function(t){if(!t.data.success){n.check(true,false);s.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}}))["catch"]((function(){n.check(true,false);s.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}))}},{key:"login",value:function t(){n.LoginFactory.getLoginObject({TYPE:"facebook",ENGINE_CODE:"business.facebook"}).login()}},{key:"loadData",value:function t(){return BX.ajax.runAction("crm.ads.conversion.load",{data:{type:this.code}})}},{key:"logout",value:function t(){var e,n=this;(e=this.slider)===null||e===void 0?void 0:e.showLoader();return BX.ajax.runAction("crm.ads.conversion.logout",{data:{},analyticsLabel:{connect:"FBE",action:"disconnect",type:"disconnect"}}).then((function(){var t;(t=n.slider)===null||t===void 0?void 0:t.reload()}))["catch"]((function(){var t;(t=n.slider)===null||t===void 0?void 0:t.reload()}))}},{key:"getContentTitle",value:function t(){return""}},{key:"render",value:function t(){var e=this;this.tag.innerHTML="";if(this.data&&this.data.available){this.tag.appendChild(a.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-slider-section crm-ads-conversion-title-section">\n\t\t\t\t\t<span class="ui-icon ui-slider-icon ui-icon-service-fb">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="ui-slider-content-box">\n\t\t\t\t\t\t<div class="ui-slider-paragraph-2">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="ui-slider-list crm-ads-conversion-features">\n\t\t\t\t\t\t\t<li class="ui-slider-list-item">\n\t\t\t\t\t\t\t\t<span class="ui-slider-list-text">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="ui-slider-list-item">\n\t\t\t\t\t\t\t\t<span class="ui-slider-list-text">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="ui-slider-list-item">\n\t\t\t\t\t\t\t\t<span class="ui-slider-list-text">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="ui-slider-list-item">\n\t\t\t\t\t\t\t\t<span class="ui-slider-list-text">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\thref="https://www.facebook.com/business/help/1292598407460746?id=1205376682832142" \n\t\t\t\t\t\t\tclass="ui-slider-link" \n\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TITLE"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TEXT_LIST_1"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TEXT_LIST_2"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TEXT_LIST_3"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TEXT_LIST_4"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_LINK")));if(this.data.auth&&this.data.profile){this.tag.appendChild(a.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-slider-section crm-ads-conversion-account-section">\n\t\t\t\t\t\t<div class="crm-ads-conversion-block">\n\t\t\t\t\t\t\t<div class="crm-ads-conversion-social crm-ads-conversion-social-facebook">\n\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-social-avatar">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tclass="crm-ads-conversion-social-avatar-icon" \n\t\t\t\t\t\t\t\t\t\tstyle="background-image: url(',')"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-social-user">\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\ttarget="_top" \n\t\t\t\t\t\t\t\t\t\tclass="crm-ads-conversion-social-user-link" \n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-social-shutoff">\n\t\t\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\t\t\tclass="crm-ads-conversion-social-shutoff-link" \n\t\t\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Tag.safe(l||(l=babelHelpers.taggedTemplateLiteral(["",""])),this.data.profile.picture),this.data.profile.url?'href="'+a.Tag.safe(c||(c=babelHelpers.taggedTemplateLiteral(["",""])),this.data.profile.url)+'"':"",a.Tag.safe(u||(u=babelHelpers.taggedTemplateLiteral(["",""])),this.data.profile.name),this.logout.bind(this),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGOUT")));if(a.Type.isArray(this.data.items)){this.tag.appendChild(this.data.items.reduce((function(t,n){var s=a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-settings-block">\n\t\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-settings-name-block">\n\t\t\t\t\t\t\t\t\t\t<span class="crm-ads-conversion-settings-name">','</span>\n\t\t\t\t\t\t\t\t\t\t<span class="crm-ads-conversion-settings-detail">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-settings-control">\n\t\t\t\t\t\t\t\t\t\t<span data-switcher-node=""/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t'])),a.Tag.safe(g||(g=babelHelpers.taggedTemplateLiteral(["",""])),n.name),a.Loc.getMessage("CRM_ADS_CONVERSION_DETAIL"));var i=new BX.UI.Switcher({node:s.querySelector("[data-switcher-node]"),checked:n.enable});i.handlers={checked:e.onItemDisable.bind(e,n.id,i),unchecked:e.onItemEnable.bind(e,n.id,i)};t.appendChild(s);return t}),a.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="ui-slider-section crm-ads-conversion-settings">\n\t\t\t\t\t\t\t<div class="ui-slider-heading-3">',"</div>\n\t\t\t\t\t\t</div>"])),a.Tag.safe(f||(f=babelHelpers.taggedTemplateLiteral(["",""])),this.getScriptMessage()))))}}else{this.tag.appendChild(a.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-slider-section">\n\t\t\t\t\t\t<div class="ui-slider-content-box">\n\t\t\t\t\t\t\t<div class="ui-slider-heading-3">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="crm-ads-conversion-login-block">\n\t\t\t\t\t\t\t\t<div class="crm-ads-conversion-login-wrapper">\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\tclass="webform-small-button webform-small-button-transparent"\n\t\t\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<span class="crm-ads-conversion-settings-detail">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_CONNECT_TITLE"),this.login.bind(this),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN"),a.Loc.getMessage("CRM_ADS_CONVERSION_LOGIN_OPPORTUNITY_TEXT_LIST_5")))}}else{this.tag.appendChild(a.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-slider-no-access">\n\t\t\t\t\t<div class="ui-slider-no-access-inner">\n\t\t\t\t\t\t<div class="ui-slider-no-access-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-slider-no-access-subtitle">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-slider-no-access-img">\n\t\t\t\t\t\t\t<div class="ui-slider-no-access-img-inner"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_TITLE_SERVICE_ERROR"),this.errors.length>0?this.errors.reduce((function(t,n){var s=a.Tag.safe(R||(R=babelHelpers.taggedTemplateLiteral(["",""])),e.getErrorMessage(n));if(t.includes(s)){t.push(s)}return t}),[]).join("<br>"):a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_MESSAGE_SERVICE_ERROR")))}}},{key:"getErrorMessage",value:function t(e){if(a.Type.isObject(e)&&e.code){if(e.code==="permissions"){return a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_ACCESS_DENY")}if(e.code==="modules"&&e.customData){switch(e.customData.module){case"seo":return a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SEO_NOT_INSTALLED");case"crm":return a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_CRM_NOT_INSTALLED");case"socialservices":return a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SOCIAL_NOT_INSTALLED")}}}return a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_UNKNOWN_ERROR")}},{key:"saveData",value:function t(e){if(e){e.configuration=a.Type.isObject(e.configuration)?e.configuration:{};this.data=e}}},{key:"saveErrors",value:function t(e){this.errors=a.Type.isArray(e)?e:[]}},{key:"show",value:function t(){var e,n=this,s,i,o;this.slider=(e=this.slider)!==null&&e!==void 0?e:BX.SidePanel.Instance.open(this.getSliderId(),{contentCallback:function t(){return a.Runtime.loadExtension("ui.sidepanel.layout").then((function(){return BX.UI.SidePanel.Layout.createContent({title:n.getContentTitle(),extensions:["crm.ads.conversion","ui.forms","ui.switcher","seo.ads.login"],design:{section:false,margin:true},content:function t(){return n.loadData().then((function(t){n.saveData(t.data);n.saveErrors(t.errors);n.render();return n.tag}))["catch"]((function(t){n.saveData(t.data);n.saveErrors(t.errors);n.render();if(((t.errors||[])[0]||{}).code===100){BX.UI.InfoHelper.show("crm_ad_conversion")}return n.tag}))}})}))},title:this.getSliderTitle(),width:(s=(i=this.width)!==null&&i!==void 0?i:(o=BX.SidePanel.Instance.getTopSlider())===null||o===void 0?void 0:o.getWidth())!==null&&s!==void 0?s:800})?BX.SidePanel.Instance.getSlider(this.getSliderId()):null}}]);return e}(s);var b=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.code="facebook.deal";return t}babelHelpers.createClass(e,[{key:"getContentTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_DEAL_CONTENT_TITLE")}},{key:"getSliderTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_DEAL_SLIDER_TITLE")}},{key:"getScriptMessage",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_DEAL_SLIDER_ITEM_TITLE")}}]);return e}(O);var C=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.code="facebook.webform";return t}babelHelpers.createClass(e,[{key:"getSliderTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_FORM_SLIDER_TITLE")}},{key:"getScriptMessage",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_FORM_SLIDER_ITEM_TITLE")}},{key:"getContentTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_FORM_CONTENT_TITLE")}}]);return e}(O);var E=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.code="facebook.payment";return t}babelHelpers.createClass(e,[{key:"getScriptMessage",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_PAYMENT_SLIDER_TITLE")}},{key:"getSliderTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_PAYMENT_SLIDER_TITLE")}},{key:"onItemEnable",value:function t(e,n){this.onOptionClick(n)}},{key:"onItemDisable",value:function t(e,n){this.onOptionClick(n)}},{key:"getContentTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_PAYMENT_CONTENT_TITLE")}},{key:"onOptionClick",value:function t(e){var n=this;this.data.configuration.enable=!(this.data.configuration.enable=="true");this.saveConfiguration(this.data.configuration).then((function(t){if(!t.data.success){e.check(!n.data.configuration.enabled,false);n.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}}))["catch"]((function(){e.check(!n.data.configuration.enabled,false);n.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}))}},{key:"saveData",value:function t(n){if(n){n.configuration=a.Type.isObject(n.configuration)?n.configuration:{};n.items=[{id:null,name:a.Loc.getMessage("CRM_ADS_CONVERSION_PAYMENT_OPTION"),enable:n.configuration.enable=="true"}]}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveData",this).call(this,n)}}]);return e}(O);var p=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:800;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.code="facebook.lead";return t}babelHelpers.createClass(e,[{key:"getScriptMessage",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_LEAD_SLIDER_TITLE")}},{key:"getSliderTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_LEAD_SLIDER_TITLE")}},{key:"onItemEnable",value:function t(e,n){this.onOptionClick(n)}},{key:"onItemDisable",value:function t(e,n){this.onOptionClick(n)}},{key:"getContentTitle",value:function t(){return a.Loc.getMessage("CRM_ADS_CONVERSION_LEAD_CONTENT_TITLE")}},{key:"onOptionClick",value:function t(e){var n=this;this.data.configuration.enable=!(this.data.configuration.enable=="true");this.saveConfiguration(this.data.configuration).then((function(t){if(!t.data.success){e.check(!n.data.configuration.enabled,false);n.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}}))["catch"]((function(){e.check(!n.data.configuration.enabled,false);n.notify(a.Loc.getMessage("CRM_ADS_CONVERSION_ERROR_SAVE"))}))}},{key:"saveData",value:function t(n){if(n){n.configuration=a.Type.isObject(n.configuration)?n.configuration:{};n.items=[{id:null,name:a.Loc.getMessage("CRM_ADS_CONVERSION_LEAD_OPTION"),enable:n.configuration.enable=="true"}]}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveData",this).call(this,n)}}]);return e}(O);var S=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"conversion",value:function t(e){switch(e){case"facebook_conversion_deal":return new b;case"facebook_conversion_webform":return new C;case"facebook_conversion_payment":return new E;case"facebook_conversion_lead":return new p}}}]);return t}();t.Registry=S})(this.BX.Crm.Ads=this.BX.Crm.Ads||{},BX.UI.SidePanel,BX.Seo.Ads,BX);
//# sourceMappingURL=registry.bundle.map.js