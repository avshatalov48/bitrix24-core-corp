{"version":3,"file":"editor.bundle.js","sources":["../src/menu-popup.js","../src/text-popup.js","../src/editor.js"],"sourcesContent":["import { Loc, Text } from 'main.core';\nimport { Menu, MenuItemOptions, MenuManager } from 'main.popup';\n\nexport default class MenuPopup\n{\n\t#menu: Menu = null;\n\t#bindElement: HTMLElement = null;\n\t#isTextItemFirst: boolean = false;\n\t#onEditorItemClick: Function = () => {};\n\t#onTextItemClick: Function = () => {};\n\n\tconstructor({ bindElement, isTextItemFirst, onEditorItemClick, onTextItemClick })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#isTextItemFirst = isTextItemFirst;\n\t\tthis.#onEditorItemClick = onEditorItemClick;\n\t\tthis.#onTextItemClick = onTextItemClick;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getMenuPopup().show();\n\t}\n\n\t#getMenuPopup(): Menu\n\t{\n\t\tif (this.#menu === null)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: 'crm-template-editor-placeholder-selector',\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.#getItems(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#getItems(): Object[]\n\t{\n\t\tconst editorItem = this.#getEditorItem();\n\t\tconst textItem = this.#getTextItem();\n\n\t\tif (this.#isTextItemFirst)\n\t\t{\n\t\t\treturn [\n\t\t\t\ttextItem,\n\t\t\t\teditorItem,\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\teditorItem,\n\t\t\ttextItem,\n\t\t];\n\t}\n\n\t#getEditorItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\thtml: this.#getItemTitle('CRM_TEMPLATE_EDITOR_SELECT_FIELD'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onEditorItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getTextItem(): MenuItemOptions\n\t{\n\t\tconst code = (\n\t\t\tthis.#isTextItemFirst\n\t\t\t\t? 'CRM_TEMPLATE_EDITOR_UPDATE_TEXT'\n\t\t\t\t: 'CRM_TEMPLATE_EDITOR_CREATE_TEXT'\n\t\t);\n\n\t\treturn {\n\t\t\thtml: this.#getItemTitle(code),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#getMenuPopup().close();\n\t\t\t\tthis.#onTextItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getItemTitle(code: string): string\n\t{\n\t\tconst placeholder = '<span class=\"crm-template-editor-placeholder-selector-menu-item\">#ITEM_TEXT#</span>';\n\n\t\treturn placeholder.replace('#ITEM_TEXT#', Text.encode(Loc.getMessage(code)));\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { Popup, PopupWindowManager } from 'main.popup';\nimport { Button, ButtonState } from 'ui.buttons';\n\nexport default class TextPopup\n{\n\t#popup: Popup = null;\n\t#input: HTMLInputElement = null;\n\t#bindElement: HTMLElement = null;\n\t#value: string = null;\n\t#onApply: Function = () => {};\n\n\tconstructor({ bindElement, value, onApply })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#value = value;\n\t\tthis.#onApply = onApply;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = PopupWindowManager.create(\n\t\t\t\t'crm-template-editor-text-popup',\n\t\t\t\tthis.#bindElement,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcontent: this.#getContent(),\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcloseIcon: false,\n\t\t\t\t\tbuttons: this.#getMenuButtons(),\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.#popup.subscribe('onShow', () => {\n\t\t\t\tthis.#input.focus();\n\t\t\t\tthis.#setCursorToEnd();\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`<div class=\"crm-template-editor-text-popup-wrapper\"></div>`;\n\n\t\tthis.#input = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tvalue=\"${Text.encode(this.#value)}\"\n\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER')}\n\t\t\t\">\n\t\t`;\n\t\tDom.append(this.#input, content);\n\n\t\tthis.#bindInputEvents();\n\n\t\treturn content;\n\t}\n\n\t#bindInputEvents(): void\n\t{\n\t\tEvent.bind(this.#input, 'keyup', (event: Event) => {\n\t\t\tconst button = this.#getApplyButtonInstance();\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { value } = event.target;\n\t\t\tthis.#adjustButtonState(button, value);\n\t\t});\n\t}\n\n\t#getMenuButtons(): Button[]\n\t{\n\t\treturn [\n\t\t\tthis.#getApplyButton(),\n\t\t\tthis.#getCancelButton(),\n\t\t];\n\t}\n\n\t#getApplyButton(): Button\n\t{\n\t\tconst button = new Button({\n\t\t\tid: 'apply-button',\n\t\t\ttext: this.#getApplyButtonText(),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-primary ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onApplyButtonClick();\n\t\t\t},\n\t\t});\n\n\t\tconst { value } = this.#input;\n\t\tthis.#adjustButtonState(button, value);\n\n\t\treturn button;\n\t}\n\n\t#adjustButtonState(button: Button, value: string): void\n\t{\n\t\tbutton.setState(\n\t\t\t(Type.isStringFilled(value) && Type.isStringFilled(value.trim()))\n\t\t\t\t? ButtonState.ACTIVE\n\t\t\t\t: ButtonState.DISABLED\n\t\t);\n\t}\n\n\t#getApplyButtonText(): string\n\t{\n\t\tif (Type.isStringFilled(this.#value))\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE');\n\t\t}\n\n\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD');\n\t}\n\n\t#onApplyButtonClick(): void\n\t{\n\t\tconst button = this.#getApplyButtonInstance();\n\t\tif (button.getState() !== ButtonState.ACTIVE)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroy();\n\n\t\tconst { value } = this.#input;\n\t\tthis.#bindElement.textContent = Text.encode(value);\n\n\t\tthis.#onApply(value.trim());\n\t}\n\n\t#getApplyButtonInstance(): Button\n\t{\n\t\treturn this.#popup.getButton('apply-button');\n\t}\n\n\t#getCancelButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL'),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-light ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.destroy();\n\t\t\t},\n\t\t});\n\t}\n\n\t#setCursorToEnd(): void\n\t{\n\t\tconst { length } = this.#input.value;\n\n\t\tthis.#input.selectionStart = length;\n\t\tthis.#input.selectionEnd = length;\n\t}\n}\n","import { Dialog } from 'crm.entity-selector';\nimport { Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Menu, Popup } from 'main.popup';\n\nimport 'ui.design-tokens';\nimport { DialogOptions } from 'ui.entity-selector';\nimport type { EditorOptions } from './editor-options';\nimport './editor.css';\nimport MenuPopup from './menu-popup';\nimport TextPopup from './text-popup';\nimport type { FilledPlaceholder } from './types';\n\nconst UPDATE_ACTION = 'update';\nconst DELETE_ACTION = 'delete';\n\nconst HEADER_POSITION = 'HEADER';\nconst PREVIEW_POSITION = 'PREVIEW';\nconst FOOTER_POSITION = 'FOOTER';\n\nexport class Editor\n{\n\t#id: ?string;\n\t#target: HTMLElement = null;\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\t#categoryId: ?number = null;\n\t#canUseFieldsDialog: boolean = true;\n\t#canUseFieldValueInput: boolean = true;\n\tplaceholders: string[] = [];\n\tfilledPlaceholders: FilledPlaceholder[] = [];\n\tonSelect = () => {};\n\n\t// @todo replace this variables with a generic container\n\t#headerContainerEl: ?HTMLElement = null;\n\t#bodyContainerEl: ?HTMLElement = null;\n\t#footerContainerEl: ?HTMLElement = null;\n\n\t#placeHoldersDialogDefaultOptions: ?DialogOptions = null;\n\n\t#headerRaw: ?string = null;\n\t#bodyRaw: ?string = null;\n\t#footerRaw: ?string = null;\n\n\t#popupMenu: ?Menu = null;\n\t#inputPopup: ?Popup = null;\n\n\tconstructor(params: EditorOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#id = params.id || `crm-template-editor-${Text.getRandom()}`;\n\t\tthis.#target = params.target;\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#categoryId = Type.isNumber(params.categoryId) ? params.categoryId : null;\n\t\tthis.onSelect = params.onSelect;\n\n\t\tthis.#canUseFieldsDialog = Boolean(params.canUseFieldsDialog ?? true);\n\t\tthis.#canUseFieldValueInput = Boolean(params.canUseFieldValueInput ?? true);\n\n\t\tthis.onPlaceholderClick = this.onPlaceholderClick.bind(this);\n\t\tthis.onShowInputPopup = this.onShowInputPopup.bind(this);\n\n\t\tthis.#placeHoldersDialogDefaultOptions = {\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t},\n\t\t};\n\n\t\tif (this.#canUsePlaceholderProvider(params.usePlaceholderProvider))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions.entities = [{\n\t\t\t\tid: 'placeholder',\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tentityId: this.#entityId,\n\t\t\t\t\tcategoryId: this.#categoryId,\n\t\t\t\t},\n\t\t\t}];\n\t\t}\n\n\t\tif (Type.isPlainObject(params.dialogOptions))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions = { ...this.#placeHoldersDialogDefaultOptions, ...params.dialogOptions };\n\t\t}\n\n\t\tthis.#createContainer();\n\t}\n\n\tsetPlaceholders(placeholders: string[]): this\n\t{\n\t\tthis.placeholders = placeholders;\n\n\t\treturn this;\n\t}\n\n\tsetFilledPlaceholders(filledPlaceholders: FilledPlaceholder[]): this\n\t{\n\t\tthis.filledPlaceholders = filledPlaceholders;\n\n\t\treturn this;\n\t}\n\n\t// region Public methods\n\tsetHeader(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#headerRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#headerContainerEl);\n\t}\n\n\tsetBody(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#bodyRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#bodyContainerEl);\n\t}\n\n\tsetFooter(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#footerRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#footerContainerEl);\n\t}\n\n\tgetData(): ?Object\n\t{\n\t\tif (this.placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\theader: this.#getPlainText(HEADER_POSITION),\n\t\t\tbody: this.#getPlainText(PREVIEW_POSITION),\n\t\t\tfooter: this.#getPlainText(FOOTER_POSITION),\n\t\t};\n\t}\n\n\tgetRawData(): Object\n\t{\n\t\treturn {\n\t\t\theader: this.#headerRaw,\n\t\t\tbody: this.#bodyRaw,\n\t\t\tfooter: this.#footerRaw,\n\t\t};\n\t}\n\t// endregion\n\n\t#createContainer(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst containerEl = Tag.render`\n\t\t\t<div id=\"${this.#id}\" class=\"crm-template-editor crm-template-editor__scope\"></div>\n\t\t`;\n\n\t\tthis.#headerContainerEl = Tag.render`<div class=\"crm-template-editor-header\"></div>`;\n\t\tDom.append(this.#headerContainerEl, containerEl);\n\t\tthis.#bodyContainerEl = Tag.render`<div class=\"crm-template-editor-body\"></div>`;\n\t\tDom.append(this.#bodyContainerEl, containerEl);\n\t\tthis.#footerContainerEl = Tag.render`<div class=\"crm-template-editor-footer\"></div>`;\n\t\tDom.append(this.#footerContainerEl, containerEl);\n\n\t\tDom.clean(this.#target);\n\t\tDom.append(containerEl, this.#target);\n\t}\n\n\t#createContainerWithSelectors(input: string, position: string = PREVIEW_POSITION): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst container = this.#getInputContainer(input, position);\n\n\t\tplaceholders.forEach((placeholder, key) => {\n\t\t\tconst element = [...container.childNodes].find(\n\t\t\t\t(node) => node.dataset && Number(node.dataset.templatePlaceholder) === key,\n\t\t\t);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dlgOptions = Runtime.clone(this.#placeHoldersDialogDefaultOptions);\n\t\t\tthis.#prepareDlgOptions(dlgOptions, element, position);\n\n\t\t\tconst dialog = new Dialog(dlgOptions);\n\n\t\t\tEvent.bind(element, 'click', (event) => {\n\t\t\t\tthis.onPlaceholderClick({ dialog, event });\n\t\t\t});\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tonPlaceholderClick({ dialog, event }): void\n\t{\n\t\tthis.#inputPopup?.destroy();\n\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(event.target, PREVIEW_POSITION);\n\t\tconst isTextItemFirst = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE);\n\n\t\tif (this.#canUseFieldsDialog && this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.#popupMenu = new MenuPopup({\n\t\t\t\tbindElement: event.target,\n\t\t\t\tisTextItemFirst,\n\t\t\t\tonEditorItemClick: () => {\n\t\t\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialog);\n\t\t\t\t},\n\t\t\t\tonTextItemClick: (element: HTMLElement) => {\n\t\t\t\t\tthis.onShowInputPopup(element);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#popupMenu.show();\n\t\t}\n\t\telse if (this.#canUseFieldsDialog)\n\t\t{\n\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialog);\n\t\t}\n\t\telse if (this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.onShowInputPopup(event.target);\n\t\t}\n\t}\n\n\tonShowDialogPopup(filledPlaceholder: FilledPlaceholder, dialog: Dialog): void\n\t{\n\t\tif (Type.isStringFilled(filledPlaceholder?.FIELD_VALUE))\n\t\t{\n\t\t\tdialog.getPreselectedItems().forEach((preselectedItem) => {\n\t\t\t\tconst item = dialog.getItem(preselectedItem);\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\titem.deselect();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tdialog.show();\n\t}\n\n\tonShowInputPopup(bindElement: HTMLElement): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(bindElement);\n\t\tconst value = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE) ? filledPlaceholder.FIELD_VALUE : '';\n\n\t\tthis.#inputPopup = new TextPopup({\n\t\t\tbindElement,\n\t\t\tvalue,\n\t\t\tonApply: (newValue: string) => {\n\t\t\t\tthis.#onApplyInputPopup(newValue, bindElement);\n\t\t\t},\n\t\t});\n\n\t\tthis.#inputPopup.show();\n\t}\n\n\t#onApplyInputPopup(value: string, bindElement: HTMLElement): void\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(bindElement, PREVIEW_POSITION);\n\n\t\tconst params = {\n\t\t\tid: placeholderId,\n\t\t\tparentTitle: null,\n\t\t\ttext: value,\n\t\t\ttitle: value,\n\t\t\tentityType: BX.CrmEntityType.resolveName(this.#entityTypeId).toLowerCase(),\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tbindElement.textContent = value;\n\t\tDom.addClass(bindElement, '--selected');\n\n\t\tthis.#adjustFilledPlaceholders(params);\n\t\tthis.onSelect(params);\n\t}\n\n\t#getInputContainer(input: string, position: string): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet i = 0;\n\t\tplaceholders.forEach((placeholder) => {\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholder);\n\n\t\t\tlet title = Loc.getMessage('CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL');\n\t\t\tlet spanClass = 'crm-template-editor-element-pill';\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tType.isStringFilled(filledPlaceholder.PARENT_TITLE)\n\t\t\t\t\t&& Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = `${filledPlaceholder.PARENT_TITLE}: ${filledPlaceholder.TITLE}`;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.TITLE;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_NAME;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_VALUE;\n\t\t\t\t}\n\n\t\t\t\ttitle = Text.encode(title);\n\t\t\t\tspanClass += ' --selected';\n\t\t\t}\n\n\t\t\tconst replaceValue = `<span class=\"${spanClass}\" data-template-placeholder=\"${i++}\">${title}</span>`;\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinput = input.replace(placeholder, replaceValue);\n\t\t});\n\n\t\treturn Tag.render`<div>${input}</div>`;\n\t}\n\n\t#getPlaceholders(position: string): ?[]\n\t{\n\t\tconst allPlaceholders = Type.isPlainObject(this.placeholders) ? this.placeholders : {};\n\t\tconst placeholders = Type.isArrayFilled(allPlaceholders[position]) ? allPlaceholders[position] : [];\n\n\t\treturn Type.isArrayLike(placeholders) ? placeholders : null;\n\t}\n\n\t#prepareDlgOptions(dlgOptions: DialogOptions, element: HTMLElement, position: string): void\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tconst placeholderId = placeholders[element.dataset.templatePlaceholder] ?? null;\n\t\tif (placeholderId)\n\t\t{\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholderId);\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdlgOptions.preselectedItems = [\n\t\t\t\t\t[\n\t\t\t\t\t\tfilledPlaceholder.FIELD_ENTITY_TYPE,\n\t\t\t\t\t\tfilledPlaceholder.FIELD_NAME,\n\t\t\t\t\t],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.events = {\n\t\t\tonShow: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.addClass(element, '--flipped');\n\t\t\t},\n\t\t\tonHide: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.removeClass(element, '--flipped');\n\t\t\t},\n\t\t\t'Item:onSelect': (event: BaseEvent): void => {\n\t\t\t\tDom.addClass(element, '--selected');\n\n\t\t\t\tconst item = event.getData().item;\n\t\t\t\tconst parentTitle = item.supertitle.text;\n\t\t\t\tconst title = item.title.text;\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\telement.textContent = `${parentTitle}: ${title}`;\n\n\t\t\t\tconst value = item.id;\n\t\t\t\tconst entityType = item.entityId;\n\n\t\t\t\tconst params = {\n\t\t\t\t\tid: placeholderId,\n\t\t\t\t\tvalue,\n\t\t\t\t\tparentTitle,\n\t\t\t\t\ttitle,\n\t\t\t\t\tentityType,\n\t\t\t\t};\n\n\t\t\t\tthis.#adjustFilledPlaceholders(params);\n\t\t\t\tthis.onSelect(params);\n\t\t\t},\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.targetNode = element;\n\t}\n\n\t#adjustFilledPlaceholders({ id, value, text, parentTitle, title }, action: string = UPDATE_ACTION): void\n\t{\n\t\tif (action === DELETE_ACTION)\n\t\t{\n\t\t\tthis.#deleteFromFilledPlaceholders(id, value);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateForFilledPlaceholders({ id, value, text, parentTitle, title });\n\t}\n\n\t#deleteFromFilledPlaceholders(id: string, value: string): void\n\t{\n\t\tthis.filledPlaceholders = this.filledPlaceholders.filter(\n\t\t\t(filledPlaceholder) => {\n\t\t\t\treturn filledPlaceholder.PLACEHOLDER_ID !== id || filledPlaceholder.FIELD_NAME !== value;\n\t\t\t},\n\t\t);\n\t}\n\n\t#updateForFilledPlaceholders({ id, value, text, parentTitle, title }): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(id);\n\n\t\tif (filledPlaceholder)\n\t\t{\n\t\t\tfilledPlaceholder.FIELD_NAME = value ?? null;\n\t\t\tfilledPlaceholder.FIELD_VALUE = text ?? null;\n\t\t\tfilledPlaceholder.PARENT_TITLE = parentTitle;\n\t\t\tfilledPlaceholder.TITLE = title;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.filledPlaceholders.push({\n\t\t\t\tPLACEHOLDER_ID: id,\n\t\t\t\tFIELD_NAME: value,\n\t\t\t\tFIELD_VALUE: text,\n\t\t\t\tPARENT_TITLE: parentTitle,\n\t\t\t\tTITLE: title,\n\t\t\t});\n\t\t}\n\t}\n\n\t#getFilledPlaceholderByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?FilledPlaceholder\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(element, position);\n\n\t\treturn this.#getFilledPlaceholderById(placeholderId);\n\t}\n\n\t#getPlaceholderIdByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?string\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\n\t\treturn placeholders[element.dataset.templatePlaceholder] ?? null;\n\t}\n\n\t#getFilledPlaceholderById(placeholderId: string): ?FilledPlaceholder\n\t{\n\t\treturn this.filledPlaceholders.find(\n\t\t\t(filledPlaceholderItem) => filledPlaceholderItem.PLACEHOLDER_ID === placeholderId,\n\t\t);\n\t}\n\n\t#getPlainText(position: string): ?string\n\t{\n\t\tlet text = this.#getRawTextByPosition(position);\n\t\tif (text === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.filledPlaceholders))\n\t\t{\n\t\t\tthis.filledPlaceholders.forEach((filledPlaceholder) => {\n\t\t\t\tif (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t\t{\n\t\t\t\t\ttext = text.replace(filledPlaceholder.PLACEHOLDER_ID, `{${filledPlaceholder.FIELD_NAME}}`);\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_VALUE))\n\t\t\t\t{\n\t\t\t\t\ttext = text.replace(filledPlaceholder.PLACEHOLDER_ID, filledPlaceholder.FIELD_VALUE);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst placeholders = this.placeholders[position];\n\t\tif (Type.isArrayFilled(placeholders))\n\t\t{\n\t\t\tplaceholders.forEach((placeholder) => {\n\t\t\t\ttext = text.replace(placeholder, ' ');\n\t\t\t});\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t#getRawTextByPosition(position: string): ?string\n\t{\n\t\tif (position === HEADER_POSITION)\n\t\t{\n\t\t\treturn this.#headerRaw;\n\t\t}\n\n\t\tif (position === PREVIEW_POSITION)\n\t\t{\n\t\t\treturn this.#bodyRaw;\n\t\t}\n\n\t\tif (position === FOOTER_POSITION)\n\t\t{\n\t\t\treturn this.#footerRaw;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#assertValidParams(params: EditorOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"params\" argument must be object');\n\t\t}\n\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Template.Editor: The \"target\" argument must be DOM node');\n\t\t}\n\n\t\tif (this.#canUsePlaceholderProvider(params.usePlaceholderProvider))\n\t\t{\n\t\t\tif (!BX.CrmEntityType.isDefined(params.entityTypeId))\n\t\t\t{\n\t\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"entityTypeId\" argument is not correct');\n\t\t\t}\n\n\t\t\tif (!Type.isNumber(params.entityId) || params.entityId <= 0)\n\t\t\t{\n\t\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"entityId\" argument is not correct');\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"onSelect\" argument is not correct');\n\t\t}\n\t}\n\n\t#canUsePlaceholderProvider(value): boolean\n\t{\n\t\treturn (Type.isNil(value) || value === true);\n\t}\n}\n"],"names":["MenuPopup","bindElement","isTextItemFirst","onEditorItemClick","onTextItemClick","show","MenuManager","create","id","autoHide","offsetLeft","angle","closeByEsc","cacheable","items","editorItem","textItem","html","onclick","code","close","placeholder","replace","Text","encode","Loc","getMessage","TextPopup","value","onApply","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","destroy","_classPrivateMethodGet","PopupWindowManager","content","closeIcon","buttons","subscribe","focus","Tag","render","Dom","append","Event","bind","event","button","target","Button","text","className","setState","Type","isStringFilled","trim","ButtonState","ACTIVE","DISABLED","getState","textContent","getButton","length","selectionStart","selectionEnd","UPDATE_ACTION","DELETE_ACTION","HEADER_POSITION","PREVIEW_POSITION","FOOTER_POSITION","Editor","params","getRandom","entityTypeId","entityId","isNumber","categoryId","onSelect","Boolean","canUseFieldsDialog","canUseFieldValueInput","onPlaceholderClick","onShowInputPopup","multiple","showAvatars","dropdownMode","compactView","enableSearch","tagSelectorOptions","textBoxWidth","usePlaceholderProvider","entities","options","isPlainObject","dialogOptions","placeholders","filledPlaceholders","input","header","body","footer","dialog","filledPlaceholder","FIELD_VALUE","onShowDialogPopup","element","getPreselectedItems","forEach","preselectedItem","item","getItem","deselect","newValue","containerEl","clean","position","container","key","childNodes","find","node","dataset","Number","templatePlaceholder","dlgOptions","Runtime","clone","Dialog","placeholderId","parentTitle","title","entityType","BX","CrmEntityType","resolveName","toLowerCase","addClass","i","spanClass","PARENT_TITLE","TITLE","FIELD_NAME","replaceValue","allPlaceholders","isArrayFilled","isArrayLike","preselectedItems","FIELD_ENTITY_TYPE","events","onShow","keyframes","transform","duration","pseudoElement","animate","onHide","removeClass","getData","supertitle","targetNode","action","filter","PLACEHOLDER_ID","push","filledPlaceholderItem","TypeError","isDomNode","Error","isDefined","isFunction","isNil"],"mappings":"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"}