this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,l,a,i,r,s,n,c,o){"use strict";function h(e,t){p(e,t);t.add(e)}function d(e,t,l){p(e,t);t.set(e,l)}function p(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function v(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var u=new WeakMap;var b=new WeakMap;var f=new WeakMap;var P=new WeakMap;var w=new WeakMap;var E=new WeakSet;var T=new WeakSet;var F=new WeakSet;var H=new WeakSet;var m=new WeakSet;var S=function(){function e(t){var l=t.bindElement,a=t.isTextItemFirst,i=t.onEditorItemClick,r=t.onTextItemClick;babelHelpers.classCallCheck(this,e);h(this,m);h(this,H);h(this,F);h(this,T);h(this,E);d(this,u,{writable:true,value:null});d(this,b,{writable:true,value:null});d(this,f,{writable:true,value:false});d(this,P,{writable:true,value:function e(){}});d(this,w,{writable:true,value:function e(){}});babelHelpers.classPrivateFieldSet(this,b,l);babelHelpers.classPrivateFieldSet(this,f,a);babelHelpers.classPrivateFieldSet(this,P,i);babelHelpers.classPrivateFieldSet(this,w,r)}babelHelpers.createClass(e,[{key:"show",value:function e(){v(this,E,y).call(this).show()}}]);return e}();function y(){if(babelHelpers.classPrivateFieldGet(this,u)===null){babelHelpers.classPrivateFieldSet(this,u,c.MenuManager.create({id:"crm-template-editor-placeholder-selector",bindElement:babelHelpers.classPrivateFieldGet(this,b),autoHide:true,offsetLeft:20,angle:true,closeByEsc:false,cacheable:false,items:v(this,T,g).call(this)}))}return babelHelpers.classPrivateFieldGet(this,u)}function g(){var e=v(this,F,k).call(this);var t=v(this,H,L).call(this);if(babelHelpers.classPrivateFieldGet(this,f)){return[t,e]}return[e,t]}function k(){var e=this;return{html:v(this,m,I).call(this,"CRM_TEMPLATE_EDITOR_SELECT_FIELD"),onclick:function t(){babelHelpers.classPrivateFieldGet(e,P).call(e,babelHelpers.classPrivateFieldGet(e,b))}}}function L(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,f)?"CRM_TEMPLATE_EDITOR_UPDATE_TEXT":"CRM_TEMPLATE_EDITOR_CREATE_TEXT";return{html:v(this,m,I).call(this,t),onclick:function t(){v(e,E,y).call(e).close();babelHelpers.classPrivateFieldGet(e,w).call(e,babelHelpers.classPrivateFieldGet(e,b))}}}function I(e){var t='<span class="crm-template-editor-placeholder-selector-menu-item">#ITEM_TEXT#</span>';return t.replace("#ITEM_TEXT#",n.Text.encode(n.Loc.getMessage(e)))}var G,D;function C(e,t){_(e,t);t.add(e)}function M(e,t,l){_(e,t);t.set(e,l)}function _(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function W(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var A={LOADING:1,SUCCESS:2,FAILED:3};var O=new WeakMap;var R=new WeakMap;var B=new WeakMap;var x=new WeakMap;var X=new WeakMap;var N=new WeakMap;var U=new WeakSet;var j=new WeakSet;var V=function(){function e(t,l,a){babelHelpers.classCallCheck(this,e);C(this,j);C(this,U);M(this,O,{writable:true,value:null});M(this,R,{writable:true,value:null});M(this,B,{writable:true,value:null});M(this,x,{writable:true,value:null});M(this,X,{writable:true,value:null});M(this,N,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,R,t);babelHelpers.classPrivateFieldSet(this,X,l);babelHelpers.classPrivateFieldSet(this,N,a)}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;(t=W(this,U,z).call(this))===null||t===void 0?void 0:t.destroy()}},{key:"isShown",value:function e(){var t;(t=W(this,U,z).call(this))===null||t===void 0?void 0:t.isShown()}},{key:"show",value:function e(){var t;(t=W(this,U,z).call(this))===null||t===void 0?void 0:t.show()}},{key:"apply",value:function e(t){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var a=W(this,U,z).call(this).getPopupContainer().querySelector(".popup-window-close-icon");switch(t){case A.LOADING:{n.Dom.addClass(a,"--hidden");babelHelpers.classPrivateFieldGet(this,B).innerText="";if(!babelHelpers.classPrivateFieldGet(this,x)){babelHelpers.classPrivateFieldSet(this,x,new r.ProgressBar({color:r.ProgressBar.Color.PRIMARY,size:10,maxValue:100,value:30,infiniteLoading:true}))}W(this,U,z).call(this).setHeight(75);babelHelpers.classPrivateFieldGet(this,x).renderTo(babelHelpers.classPrivateFieldGet(this,B));break}case A.SUCCESS:{W(this,U,z).call(this).setHeight(null);W(this,U,z).call(this).setAutoHide(true);babelHelpers.classPrivateFieldGet(this,B).innerText=l;n.Dom.removeClass(a,"--hidden");n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,B),"--loaded");break}case A.FAILED:{W(this,U,z).call(this).destroy();s.UI.Notification.Center.notify({content:n.Text.encode(l),autoHideDelay:5e3});break}default:throw new TypeError("Unsupported preview popup content status ".concat(t))}}}]);return e}();function z(){if(babelHelpers.classPrivateFieldGet(this,O)===null){babelHelpers.classPrivateFieldSet(this,O,c.PopupWindowManager.create({id:"crm-template-editor-preview-popup-".concat(babelHelpers.classPrivateFieldGet(this,X),"-").concat(babelHelpers.classPrivateFieldGet(this,N)),bindElement:babelHelpers.classPrivateFieldGet(this,R),closeIcon:{top:"10px"},cacheable:false,closeByEsc:false,autoHide:false,angle:{position:"top",offset:70},content:W(this,j,Y).call(this)}))}return babelHelpers.classPrivateFieldGet(this,O)}function Y(){babelHelpers.classPrivateFieldSet(this,B,n.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-preview-popup-content"></div>']))));return n.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-template-editor-preview-popup-wrapper">\n\t\t\t\t<div class="crm-template-editor-preview-popup-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_POPUP_TITLE"),babelHelpers.classPrivateFieldGet(this,B))}var q,K;function J(e,t){Z(e,t);t.add(e)}function Q(e,t,l){Z(e,t);t.set(e,l)}function Z(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function $(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var ee=new WeakMap;var te=new WeakMap;var le=new WeakMap;var ae=new WeakMap;var ie=new WeakMap;var re=new WeakSet;var se=new WeakSet;var ne=new WeakSet;var ce=new WeakSet;var oe=new WeakSet;var he=new WeakSet;var de=new WeakSet;var pe=new WeakSet;var ve=new WeakSet;var ue=new WeakSet;var be=new WeakSet;var fe=function(){function e(t){var l=t.bindElement,a=t.value,i=t.onApply;babelHelpers.classCallCheck(this,e);J(this,be);J(this,ue);J(this,ve);J(this,pe);J(this,de);J(this,he);J(this,oe);J(this,ce);J(this,ne);J(this,se);J(this,re);Q(this,ee,{writable:true,value:null});Q(this,te,{writable:true,value:null});Q(this,le,{writable:true,value:null});Q(this,ae,{writable:true,value:null});Q(this,ie,{writable:true,value:function e(){}});babelHelpers.classPrivateFieldSet(this,le,l);babelHelpers.classPrivateFieldSet(this,ae,a);babelHelpers.classPrivateFieldSet(this,ie,i)}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;(t=babelHelpers.classPrivateFieldGet(this,ee))===null||t===void 0?void 0:t.destroy()}},{key:"show",value:function e(){$(this,re,Pe).call(this).show()}}]);return e}();function Pe(){var e=this;if(babelHelpers.classPrivateFieldGet(this,ee)===null){babelHelpers.classPrivateFieldSet(this,ee,c.PopupWindowManager.create("crm-template-editor-text-popup",babelHelpers.classPrivateFieldGet(this,le),{autoHide:true,content:$(this,se,we).call(this),closeByEsc:true,closeIcon:false,buttons:$(this,ce,Te).call(this),cacheable:false}));babelHelpers.classPrivateFieldGet(this,ee).subscribe("onShow",(function(){setTimeout((function(){babelHelpers.classPrivateFieldGet(e,te).focus();$(e,be,ke).call(e)}),0)}))}return babelHelpers.classPrivateFieldGet(this,ee)}function we(){var e=n.Tag.render(q||(q=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-text-popup-wrapper"></div>'])));babelHelpers.classPrivateFieldSet(this,te,n.Tag.render(K||(K=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input \n\t\t\t\ttype="text" \n\t\t\t\tvalue="','"\n\t\t\t\tmaxlength="255"\n\t\t\t\tplaceholder="','\n\t\t\t">\n\t\t'])),n.Text.encode(babelHelpers.classPrivateFieldGet(this,ae)),n.Loc.getMessage("CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER")));n.Dom.append(babelHelpers.classPrivateFieldGet(this,te),e);$(this,ne,Ee).call(this);return e}function Ee(){var e=this;n.Event.bind(babelHelpers.classPrivateFieldGet(this,te),"keyup",(function(t){var l=$(e,ve,ye).call(e);if(!l){return}var a=t.target.value;$(e,he,He).call(e,l,a)}))}function Te(){return[$(this,oe,Fe).call(this),$(this,ue,ge).call(this)]}function Fe(){var e=this;var t=new o.Button({id:"apply-button",text:$(this,de,me).call(this),className:"ui-btn ui-btn-xs ui-btn-primary ui-btn-round",onclick:function t(){$(e,pe,Se).call(e)}});var l=babelHelpers.classPrivateFieldGet(this,te),a=l.value;$(this,he,He).call(this,t,a);return t}function He(e,t){e.setState(n.Type.isStringFilled(t)&&n.Type.isStringFilled(t.trim())?o.ButtonState.ACTIVE:o.ButtonState.DISABLED)}function me(){if(n.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,ae))){return n.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE")}return n.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD")}function Se(){var e=$(this,ve,ye).call(this);if(e.getState()!==o.ButtonState.ACTIVE){return}this.destroy();var t=babelHelpers.classPrivateFieldGet(this,te),l=t.value;babelHelpers.classPrivateFieldGet(this,le).textContent=n.Text.encode(l);babelHelpers.classPrivateFieldGet(this,ie).call(this,l.trim())}function ye(){return babelHelpers.classPrivateFieldGet(this,ee).getButton("apply-button")}function ge(){var e=this;return new o.Button({text:n.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL"),className:"ui-btn ui-btn-xs ui-btn-light ui-btn-round",onclick:function t(){e.destroy()}})}function ke(){var e=babelHelpers.classPrivateFieldGet(this,te).value.length;babelHelpers.classPrivateFieldGet(this,te).selectionStart=e;babelHelpers.classPrivateFieldGet(this,te).selectionEnd=e}var Le,Ie,Ge,De,Ce,Me;function _e(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,a)}return l}function We(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(l),!0).forEach((function(t){babelHelpers.defineProperty(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):_e(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function Ae(e,t){Re(e,t);t.add(e)}function Oe(e,t,l){Re(e,t);t.set(e,l)}function Re(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Be(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var xe="update";var Xe="delete";var Ne="HEADER";var Ue="PREVIEW";var je="FOOTER";var Ve=new WeakMap;var ze=new WeakMap;var Ye=new WeakMap;var qe=new WeakMap;var Ke=new WeakMap;var Je=new WeakMap;var Qe=new WeakMap;var Ze=new WeakMap;var $e=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var lt=new WeakMap;var at=new WeakMap;var it=new WeakMap;var rt=new WeakMap;var st=new WeakMap;var nt=new WeakMap;var ct=new WeakMap;var ot=new WeakMap;var ht=new WeakMap;var dt=new WeakMap;var pt=new WeakSet;var vt=new WeakSet;var ut=new WeakSet;var bt=new WeakSet;var ft=new WeakSet;var Pt=new WeakSet;var wt=new WeakSet;var Et=new WeakSet;var Tt=new WeakSet;var Ft=new WeakSet;var Ht=new WeakSet;var mt=new WeakSet;var St=new WeakSet;var yt=new WeakSet;var gt=new WeakSet;var kt=new WeakSet;var Lt=new WeakSet;var It=function(){function e(t){var l,a,i;babelHelpers.classCallCheck(this,e);Ae(this,Lt);Ae(this,kt);Ae(this,gt);Ae(this,yt);Ae(this,St);Ae(this,mt);Ae(this,Ht);Ae(this,Ft);Ae(this,Tt);Ae(this,Et);Ae(this,wt);Ae(this,Pt);Ae(this,ft);Ae(this,bt);Ae(this,ut);Ae(this,vt);Ae(this,pt);Oe(this,Ve,{writable:true,value:void 0});Oe(this,ze,{writable:true,value:null});Oe(this,Ye,{writable:true,value:null});Oe(this,qe,{writable:true,value:null});Oe(this,Ke,{writable:true,value:null});Oe(this,Je,{writable:true,value:true});Oe(this,Qe,{writable:true,value:true});Oe(this,Ze,{writable:true,value:false});Oe(this,$e,{writable:true,value:false});Oe(this,et,{writable:true,value:null});Oe(this,tt,{writable:true,value:null});Oe(this,lt,{writable:true,value:null});babelHelpers.defineProperty(this,"placeholders",[]);babelHelpers.defineProperty(this,"filledPlaceholders",[]);babelHelpers.defineProperty(this,"onSelect",(function(){}));Oe(this,at,{writable:true,value:null});Oe(this,it,{writable:true,value:null});Oe(this,rt,{writable:true,value:null});Oe(this,st,{writable:true,value:null});Oe(this,nt,{writable:true,value:null});Oe(this,ct,{writable:true,value:null});Oe(this,ot,{writable:true,value:null});Oe(this,ht,{writable:true,value:null});Oe(this,dt,{writable:true,value:null});Be(this,kt,Vt).call(this,t);babelHelpers.classPrivateFieldSet(this,Ve,t.id||"crm-template-editor-".concat(n.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,ze,t.target);babelHelpers.classPrivateFieldSet(this,Ye,t.entityTypeId);babelHelpers.classPrivateFieldSet(this,qe,t.entityId);babelHelpers.classPrivateFieldSet(this,Ke,n.Type.isNumber(t.categoryId)?t.categoryId:null);this.onSelect=t.onSelect;babelHelpers.classPrivateFieldSet(this,Je,Boolean((l=t.canUseFieldsDialog)!==null&&l!==void 0?l:true));babelHelpers.classPrivateFieldSet(this,Qe,Boolean((a=t.canUseFieldValueInput)!==null&&a!==void 0?a:true));babelHelpers.classPrivateFieldSet(this,Ze,Boolean((i=t.canUsePreview)!==null&&i!==void 0?i:false));this.onPlaceholderClick=this.onPlaceholderClick.bind(this);this.onShowInputPopup=this.onShowInputPopup.bind(this);babelHelpers.classPrivateFieldSet(this,st,{multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,tagSelectorOptions:{textBoxWidth:"100%"}});if(Be(this,Lt,zt).call(this,t.usePlaceholderProvider)){var r;babelHelpers.classPrivateFieldGet(this,st).entities=[{id:"placeholder",options:{entityTypeId:babelHelpers.classPrivateFieldGet(this,Ye),entityId:babelHelpers.classPrivateFieldGet(this,qe),categoryId:(r=babelHelpers.classPrivateFieldGet(this,Ke))!==null&&r!==void 0?r:null}}]}if(n.Type.isPlainObject(t.dialogOptions)){babelHelpers.classPrivateFieldSet(this,st,We(We({},babelHelpers.classPrivateFieldGet(this,st)),t.dialogOptions))}Be(this,pt,Gt).call(this)}babelHelpers.createClass(e,[{key:"setPlaceholders",value:function e(t){this.placeholders=t;return this}},{key:"setFilledPlaceholders",value:function e(t){this.filledPlaceholders=t;return this}},{key:"setHeader",value:function e(t){if(!n.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,nt,t);n.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,at))}},{key:"setBody",value:function e(t){if(!n.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,ct,t);n.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,it))}},{key:"setFooter",value:function e(t){if(!n.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,ot,t);n.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,rt))}},{key:"getData",value:function e(){if(this.placeholders===null){return null}return{header:Be(this,yt,Ut).call(this,Ne),body:Be(this,yt,Ut).call(this,Ue),footer:Be(this,yt,Ut).call(this,je)}}},{key:"getRawData",value:function e(){return{header:babelHelpers.classPrivateFieldGet(this,nt),body:babelHelpers.classPrivateFieldGet(this,ct),footer:babelHelpers.classPrivateFieldGet(this,ot)}}},{key:"onPlaceholderClick",value:function e(t){var l,a=this;var i=t.dialog,r=t.event;(l=babelHelpers.classPrivateFieldGet(this,dt))===null||l===void 0?void 0:l.destroy();var s=Be(this,Ht,xt).call(this,r.target,Ue);var c=n.Type.isStringFilled(s===null||s===void 0?void 0:s.FIELD_VALUE);if(babelHelpers.classPrivateFieldGet(this,Je)&&babelHelpers.classPrivateFieldGet(this,Qe)){babelHelpers.classPrivateFieldSet(this,ht,new S({bindElement:r.target,isTextItemFirst:c,onEditorItemClick:function e(){a.onShowDialogPopup(s,i)},onTextItemClick:function e(t){a.onShowInputPopup(t)}}));babelHelpers.classPrivateFieldGet(this,ht).show()}else if(babelHelpers.classPrivateFieldGet(this,Je)){this.onShowDialogPopup(s,i)}else if(babelHelpers.classPrivateFieldGet(this,Qe)){this.onShowInputPopup(r.target)}}},{key:"onShowDialogPopup",value:function e(t,l){if(n.Type.isStringFilled(t===null||t===void 0?void 0:t.FIELD_VALUE)){l.getPreselectedItems().forEach((function(e){var t=l.getItem(e);if(t){t.deselect()}}))}l.show()}},{key:"onShowInputPopup",value:function e(t){var l=this;var a=Be(this,Ht,xt).call(this,t);var i=n.Type.isStringFilled(a===null||a===void 0?void 0:a.FIELD_VALUE)?a.FIELD_VALUE:"";babelHelpers.classPrivateFieldSet(this,dt,new fe({bindElement:t,value:i,onApply:function e(a){Be(l,ut,Ct).call(l,a,t)}}));babelHelpers.classPrivateFieldGet(this,dt).show()}}]);return e}();function Gt(){if(!babelHelpers.classPrivateFieldGet(this,ze)){return}var e=n.Tag.render(Le||(Le=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="crm-template-editor crm-template-editor__scope"></div>\n\t\t'])),babelHelpers.classPrivateFieldGet(this,Ve));babelHelpers.classPrivateFieldSet(this,at,n.Tag.render(Ie||(Ie=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-header"></div>']))));n.Dom.append(babelHelpers.classPrivateFieldGet(this,at),e);babelHelpers.classPrivateFieldSet(this,it,n.Tag.render(Ge||(Ge=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-body"></div>']))));n.Dom.append(babelHelpers.classPrivateFieldGet(this,it),e);babelHelpers.classPrivateFieldSet(this,rt,n.Tag.render(De||(De=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-footer"></div>']))));n.Dom.append(babelHelpers.classPrivateFieldGet(this,rt),e);if(babelHelpers.classPrivateFieldGet(this,Ze)){var t=n.Tag.render(Ce||(Ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-template-editor-preview-link" href="#">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),n.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_LINK_TITLE"));n.Event.bind(t,"click",Be(this,bt,Mt).bind(this));n.Dom.append(t,e)}n.Dom.clean(babelHelpers.classPrivateFieldGet(this,ze));n.Dom.append(e,babelHelpers.classPrivateFieldGet(this,ze))}function Dt(e){var l=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var i=Be(this,Pt,Wt).call(this,a);if(i===null){return null}var r=Be(this,ft,_t).call(this,e,a);i.forEach((function(e,i){var s=babelHelpers.toConsumableArray(r.childNodes).find((function(e){return e.dataset&&Number(e.dataset.templatePlaceholder)===i}));if(!s){return}var c=n.Runtime.clone(babelHelpers.classPrivateFieldGet(l,st));Be(l,wt,At).call(l,c,s,a);var o=new t.Dialog(c);n.Event.bind(s,"click",(function(e){l.onPlaceholderClick({dialog:o,event:e})}))}));return r}function Ct(e,t){var l=Be(this,mt,Xt).call(this,t,Ue);var a={id:l,parentTitle:null,text:e,title:e,entityType:BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldGet(this,Ye)).toLowerCase()};t.textContent=e;n.Dom.addClass(t,"--selected");Be(this,Et,Ot).call(this,a);this.onSelect(a)}function Mt(e){var t,l,a=this;if((t=babelHelpers.classPrivateFieldGet(this,lt))!==null&&t!==void 0&&t.isShown()){return}if(babelHelpers.classPrivateFieldGet(this,$e)){var i;(i=babelHelpers.classPrivateFieldGet(this,lt))===null||i===void 0?void 0:i.show();return}if(babelHelpers.classPrivateFieldGet(this,qe)<=0){var r;(r=babelHelpers.classPrivateFieldGet(this,lt))===null||r===void 0?void 0:r.show();return}(l=babelHelpers.classPrivateFieldGet(this,lt))===null||l===void 0?void 0:l.destroy();var s=this.placeholders===null?this.getRawData().body:this.getData().body;var c=BX.util.hashCode(s);if(babelHelpers.classPrivateFieldGet(this,tt)===c){babelHelpers.classPrivateFieldSet(this,lt,new V(e.target,babelHelpers.classPrivateFieldGet(this,Ye),babelHelpers.classPrivateFieldGet(this,qe)));babelHelpers.classPrivateFieldGet(this,lt).apply(A.SUCCESS,babelHelpers.classPrivateFieldGet(this,et));babelHelpers.classPrivateFieldGet(this,lt).show();return}babelHelpers.classPrivateFieldSet(this,lt,new V(e.target,babelHelpers.classPrivateFieldGet(this,Ye),babelHelpers.classPrivateFieldGet(this,qe)));babelHelpers.classPrivateFieldGet(this,lt).apply(A.LOADING);babelHelpers.classPrivateFieldGet(this,lt).show();babelHelpers.classPrivateFieldSet(this,$e,true);n.ajax.runAction("crm.activity.smsplaceholder.preview",{data:{entityTypeId:babelHelpers.classPrivateFieldGet(this,Ye),entityId:babelHelpers.classPrivateFieldGet(this,qe),message:s,entityCategoryId:babelHelpers.classPrivateFieldGet(this,Ke)}}).then((function(e){babelHelpers.classPrivateFieldGet(a,lt).apply(A.SUCCESS,e.data.preview);babelHelpers.classPrivateFieldSet(a,$e,false);babelHelpers.classPrivateFieldSet(a,tt,c);babelHelpers.classPrivateFieldSet(a,et,e.data.preview)}))["catch"]((function(e){var t;babelHelpers.classPrivateFieldGet(a,lt).apply(A.FAILED,(t=e.errors[0].message)!==null&&t!==void 0?t:"Unknown error");babelHelpers.classPrivateFieldSet(a,$e,false)}))}function _t(e,t){var l=this;var a=Be(this,Pt,Wt).call(this,t);if(a===null){return null}var i=0;a.forEach((function(t){var a=Be(l,St,Nt).call(l,t);var r=n.Loc.getMessage("CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL");var s="crm-template-editor-element-pill";if(a){if(n.Type.isStringFilled(a.PARENT_TITLE)&&n.Type.isStringFilled(a.TITLE)){r="".concat(a.PARENT_TITLE,": ").concat(a.TITLE)}else if(n.Type.isStringFilled(a.TITLE)){r=a.TITLE}else if(n.Type.isStringFilled(a.FIELD_NAME)){r=a.FIELD_NAME}else{r=a.FIELD_VALUE}r=n.Text.encode(r);s+=" --selected"}var c='<span class="'.concat(s,'" data-template-placeholder="').concat(i++,'">').concat(r,"</span>");e=e.replace(t,c)}));return n.Tag.render(Me||(Me=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),e)}function Wt(e){var t=n.Type.isPlainObject(this.placeholders)?this.placeholders:{};var l=n.Type.isArrayFilled(t[e])?t[e]:[];return n.Type.isArrayLike(l)?l:null}function At(e,t,l){var a,i=this;var r=Be(this,Pt,Wt).call(this,l);var s=(a=r[t.dataset.templatePlaceholder])!==null&&a!==void 0?a:null;if(s){var c=Be(this,St,Nt).call(this,s);if(c){e.preselectedItems=[[c.FIELD_ENTITY_TYPE,c.FIELD_NAME]]}}e.events={onShow:function e(){var l=[{transform:"rotate(0)"},{transform:"rotate(90deg)"},{transform:"rotate(180deg)"}];var a={duration:200,pseudoElement:"::after"};t.animate(l,a);n.Dom.addClass(t,"--flipped")},onHide:function e(){var l=[{transform:"rotate(180deg)"},{transform:"rotate(90deg)"},{transform:"rotate(0)"}];var a={duration:200,pseudoElement:"::after"};t.animate(l,a);n.Dom.removeClass(t,"--flipped")},"Item:onSelect":function e(l){n.Dom.addClass(t,"--selected");var a=l.getData().item;var r=a.supertitle.text;var c=a.title.text;t.textContent="".concat(r,": ").concat(c);var o=a.id;var h=a.entityId;var d={id:s,value:o,parentTitle:r,title:c,entityType:h};Be(i,Et,Ot).call(i,d);i.onSelect(d)}};e.targetNode=t}function Ot(e){var t=e.id,l=e.value,a=e.text,i=e.parentTitle,r=e.title;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:xe;if(s===Xe){Be(this,Tt,Rt).call(this,t,l);return}Be(this,Ft,Bt).call(this,{id:t,value:l,text:a,parentTitle:i,title:r})}function Rt(e,t){this.filledPlaceholders=this.filledPlaceholders.filter((function(l){return l.PLACEHOLDER_ID!==e||l.FIELD_NAME!==t}))}function Bt(e){var t=e.id,l=e.value,a=e.text,i=e.parentTitle,r=e.title;var s=Be(this,St,Nt).call(this,t);if(s){s.FIELD_NAME=l!==null&&l!==void 0?l:null;s.FIELD_VALUE=a!==null&&a!==void 0?a:null;s.PARENT_TITLE=i;s.TITLE=r}else{this.filledPlaceholders.push({PLACEHOLDER_ID:t,FIELD_NAME:l,FIELD_VALUE:a,PARENT_TITLE:i,TITLE:r})}}function xt(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var l=Be(this,mt,Xt).call(this,e,t);return Be(this,St,Nt).call(this,l)}function Xt(e){var t;var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var a=Be(this,Pt,Wt).call(this,l);return(t=a[e.dataset.templatePlaceholder])!==null&&t!==void 0?t:null}function Nt(e){return this.filledPlaceholders.find((function(t){return t.PLACEHOLDER_ID===e}))}function Ut(e){var t=Be(this,gt,jt).call(this,e);if(t===null){return null}if(n.Type.isArrayFilled(this.filledPlaceholders)){this.filledPlaceholders.forEach((function(e){if(n.Type.isStringFilled(e.FIELD_NAME)){t=t.replace(e.PLACEHOLDER_ID,"{".concat(e.FIELD_NAME,"}"))}else if(n.Type.isStringFilled(e.FIELD_VALUE)){var l=e.FIELD_VALUE.replaceAll("{","&#123;").replaceAll("}","&#125;");t=t.replace(e.PLACEHOLDER_ID,l)}}))}var l=this.placeholders[e];if(n.Type.isArrayFilled(l)){l.forEach((function(e){t=t.replace(e," ")}))}return t}function jt(e){if(e===Ne){return babelHelpers.classPrivateFieldGet(this,nt)}if(e===Ue){return babelHelpers.classPrivateFieldGet(this,ct)}if(e===je){return babelHelpers.classPrivateFieldGet(this,ot)}return null}function Vt(e){if(!n.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Template.Editor: The "params" argument must be object')}if(!n.Type.isDomNode(e.target)){throw new Error('BX.Crm.Template.Editor: The "target" argument must be DOM node')}if(Be(this,Lt,zt).call(this,e.usePlaceholderProvider)&&!BX.CrmEntityType.isDefined(e.entityTypeId)){throw new TypeError('BX.Crm.Template.Editor: The "entityTypeId" argument is not correct')}if(!n.Type.isFunction(e.onSelect)){throw new TypeError('BX.Crm.Template.Editor: The "onSelect" argument is not correct')}}function zt(e){return n.Type.isNil(e)||e===true}e.Editor=It})(this.BX.Crm.Template=this.BX.Crm.Template||{},BX.Crm.EntitySelectorEx,BX.Event,BX,BX.UI.EntitySelector,BX.UI,BX,BX,BX.Main,BX.UI);
//# sourceMappingURL=editor.bundle.map.js