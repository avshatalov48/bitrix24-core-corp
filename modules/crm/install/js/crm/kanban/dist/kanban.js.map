{"version":3,"file":"kanban.js","sources":["../src/actions/simpleaction.js","../src/actions/deleteaction.js","../src/fieldsselector.js","../src/viewmode.js","../src/pulloperation.js","../src/pullmanager.js"],"sourcesContent":["import { EntityCloseEvent } from 'crm.integration.analytics';\nimport { Loc, Reflection, Type } from 'main.core';\nimport { QueueManager } from 'pull.queuemanager';\nimport { UI } from 'ui.notification';\n\nconst NAMESPACE = Reflection.namespace('BX.CRM.Kanban.Actions');\n\nexport default class SimpleAction\n{\n\t#grid: BX.CRM.Kanban.Grid;\n\t#params: Object;\n\t#isShowNotify: boolean = true;\n\t#isApplyFilterAfterAction: boolean = false;\n\t#useIgnorePostfixForCode: boolean = false;\n\t#analyticsData: ?EntityCloseEvent = null;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid, params: Object)\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#params = params;\n\t}\n\n\tshowNotify(value: boolean = true): SimpleAction\n\t{\n\t\tthis.#isShowNotify = value;\n\n\t\treturn this;\n\t}\n\n\tapplyFilterAfterAction(value: boolean = false): SimpleAction\n\t{\n\t\tthis.#isApplyFilterAfterAction = value;\n\n\t\treturn this;\n\t}\n\n\tsetIgnorePostfixForCode(value: boolean = true): SimpleAction\n\t{\n\t\tthis.#useIgnorePostfixForCode = value;\n\n\t\treturn this;\n\t}\n\n\texecute(): Promise\n\t{\n\t\tthis.#prepareExecute();\n\n\t\tif (this.#params.action === 'status')\n\t\t{\n\t\t\tthis.#prepareAnalyticsData();\n\t\t\tthis.#grid.registerAnalyticsCloseEvent(\n\t\t\t\tthis.#analyticsData,\n\t\t\t\tBX.Crm.Integration.Analytics.Dictionary.STATUS_ATTEMPT,\n\t\t\t);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#grid.ajax(\n\t\t\t\tthis.#params,\n\t\t\t\t(data) => this.#onSuccess(data, resolve),\n\t\t\t\t(error) => this.#onFailure(error, reject),\n\t\t\t);\n\t\t});\n\t}\n\n\t#prepareExecute(): void\n\t{\n\t\tif (this.#grid.isMultiSelectMode())\n\t\t{\n\t\t\tthis.#grid.resetMultiSelectMode();\n\t\t}\n\n\t\tif (!Type.isStringFilled(this.#params.eventId) && QueueManager)\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tthis.#params.eventId = QueueManager.registerRandomEventId();\n\t\t}\n\t}\n\n\t#onSuccess(data: Object, resolve: Function): void\n\t{\n\t\tif (!data || data.error)\n\t\t{\n\t\t\tthis.#grid.registerAnalyticsCloseEvent(this.#analyticsData, BX.Crm.Integration.Analytics.Dictionary.STATUS_ERROR);\n\t\t\tthis.#handleErrorOnSimpleAction(data, resolve);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#grid.registerAnalyticsCloseEvent(this.#analyticsData, BX.Crm.Integration.Analytics.Dictionary.STATUS_SUCCESS);\n\t\t\tthis.#handleSuccessOnSimpleAction(data, resolve);\n\t\t}\n\t\tthis.#analyticsData = null;\n\t}\n\n\t#handleErrorOnSimpleAction(data, callback): void\n\t{\n\t\tconst grid = this.#grid;\n\t\tconst gridData = grid.getData();\n\n\t\tconst params = this.#params;\n\t\tif (params.action === 'status')\n\t\t{\n\t\t\tgrid.stopActionPanel();\n\t\t\tgrid.onApplyFilter();\n\n\t\t\tif (grid.getTypeInfoParam('showPersonalSetStatusNotCompletedText'))\n\t\t\t{\n\t\t\t\tlet messageCode = (\n\t\t\t\t\tgridData.isDynamicEntity\n\t\t\t\t\t\t? 'CRM_KANBAN_SET_STATUS_NOT_COMPLETED_TEXT_DYNAMIC_MSGVER_1'\n\t\t\t\t\t\t: null\n\t\t\t\t);\n\n\t\t\t\tif (!messageCode)\n\t\t\t\t{\n\t\t\t\t\tconst codeVer = `CRM_KANBAN_SET_STATUS_NOT_COMPLETED_TEXT_${gridData.entityType}`;\n\t\t\t\t\tconst codeVer1 = `${codeVer}_MSGVER_1`;\n\t\t\t\t\tconst codeVer2 = `${codeVer}_MSGVER_2`;\n\t\t\t\t\tmessageCode = BX.Loc.hasMessage(codeVer2) ? codeVer2 : codeVer1;\n\t\t\t\t}\n\n\t\t\t\tBX.Kanban.Utils.showErrorDialog(Loc.getMessage(messageCode));\n\n\t\t\t\tcallback(new Error(Loc.getMessage(messageCode)));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.Kanban.Utils.showErrorDialog(data.error, data.fatal);\n\n\t\t\t\tcallback(new Error(data.error));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.Kanban.Utils.showErrorDialog(data.error, data.fatal);\n\n\t\t\tcallback(new Error(data.error));\n\t\t}\n\t}\n\n\t#handleSuccessOnSimpleAction(data: Object, callback: Function): void\n\t{\n\t\tconst grid = this.#grid;\n\t\tconst params = this.#params;\n\n\t\tif (this.#isApplyFilterAfterAction)\n\t\t{\n\t\t\tgrid.onApplyFilter();\n\t\t}\n\t\tgrid.stopActionPanel();\n\n\t\tif (this.#isShowNotify)\n\t\t{\n\t\t\tlet code = grid.getData().entityType;\n\t\t\tif (code.startsWith('DYNAMIC'))\n\t\t\t{\n\t\t\t\tcode = 'DYNAMIC';\n\t\t\t}\n\n\t\t\t// @todo replace to useIgnorePostfixForCode check later\n\t\t\tif (params.action === 'delete' && params.ignore === 'Y')\n\t\t\t{\n\t\t\t\tcode = `${code}_IGNORE`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcode = `${code}_${params.action.toUpperCase()}`;\n\t\t\t}\n\n\t\t\tthis.#notify(code);\n\t\t}\n\n\t\tcallback(data);\n\t}\n\n\t#notify(code: string): void\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tcode = this.#getPreparedNotifyCode(code);\n\n\t\tconst content = this.#getPreparedNotifyContent(code);\n\n\t\tif (Type.isStringFilled(content))\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent,\n\t\t\t});\n\t\t}\n\t}\n\n\t#getPreparedNotifyCode(code: string): string\n\t{\n\t\tif (code === 'DEAL_CHANGECATEGORY')\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tcode = 'DEAL_CHANGECATEGORY_LINK2';\n\t\t}\n\t\telse if (code === 'DYNAMIC_CHANGECATEGORY')\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tcode = 'DYNAMIC_CHANGECATEGORY_LINK2';\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tcode = `CRM_KANBAN_NOTIFY_${code}`;\n\n\t\tconst msgVer1Codes = [\n\t\t\t'CRM_KANBAN_NOTIFY_LEAD_STATUS',\n\t\t\t'CRM_KANBAN_NOTIFY_DYNAMIC_STATUS',\n\t\t\t'CRM_KANBAN_NOTIFY_INVOICE_STATUS',\n\t\t\t'CRM_KANBAN_NOTIFY_QUOTE_DELETE',\n\t\t\t'CRM_KANBAN_NOTIFY_QUOTE_SETASSIGNED',\n\t\t];\n\n\t\tif (msgVer1Codes.includes(code))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tcode = `${code}_MSGVER_1`;\n\t\t}\n\n\t\tconst msgVer2Codes = [\n\t\t\t'CRM_KANBAN_NOTIFY_QUOTE_STATUS',\n\t\t];\n\n\t\tif (msgVer2Codes.includes(code))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tcode = `${code}_MSGVER_2`;\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t#getPreparedNotifyContent(code: string): ?string\n\t{\n\t\tlet content = Loc.getMessage(code);\n\t\tif (!Type.isStringFilled(content))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst params = this.#params;\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tObject.entries(params).forEach((entryData) => {\n\t\t\t\tcontent = content.replace(`#${entryData[0]}#`, entryData[1]);\n\t\t\t});\n\t\t}\n\n\t\treturn content;\n\t}\n\n\t#onFailure(error: string, callback: Function): void\n\t{\n\t\tthis.#grid.registerAnalyticsCloseEvent(this.#analyticsData, BX.Crm.Integration.Analytics.Dictionary.STATUS_ERROR);\n\t\tthis.#analyticsData = null;\n\n\t\tBX.Kanban.Utils.showErrorDialog(`Error: ${error}`, true);\n\n\t\tcallback(new Error(error));\n\t}\n\n\t#prepareAnalyticsData(): void\n\t{\n\t\tconst [entityId] = this.#params.entity_id;\n\t\tconst item = this.#grid.getItem(entityId);\n\t\tconst targetColumn = this.#grid.getColumn(this.#params.status);\n\n\t\tconst type = targetColumn ? targetColumn.getData().type : this.#params.type;\n\t\tthis.#analyticsData = this.#grid.getDefaultAnalyticsCloseEvent(\n\t\t\titem,\n\t\t\ttype,\n\t\t\tthis.#params.entity_id.toString(),\n\t\t);\n\n\t\tthis.#analyticsData.c_element = BX.Crm.Integration.Analytics.Dictionary.ELEMENT_WON_TOP_ACTIONS;\n\n\t\tif (type === 'LOOSE')\n\t\t{\n\t\t\tthis.#analyticsData.c_element = BX.Crm.Integration.Analytics.Dictionary.ELEMENT_LOSE_TOP_ACTIONS;\n\t\t}\n\t}\n}\n\nNAMESPACE.SimpleAction = SimpleAction;\n","import { ajax as Ajax, Loc, Reflection, Type } from 'main.core';\nimport { UI } from 'ui.notification';\nimport SimpleAction from './simpleaction';\n\nconst NAMESPACE = Reflection.namespace('BX.CRM.Kanban.Actions');\n\ntype Params = {\n\tids: Number[];\n\tshowNotify?: boolean;\n\tapplyFilterAfterAction?: boolean;\n}\n\nexport default class DeleteAction\n{\n\t#grid: BX.CRM.Kanban.Grid;\n\t#dropZone: BX.CRM.Kanban.DropZone;\n\t#deletedItems: BX.CRM.Kanban.Item[] = null;\n\t#ids: Number[] = [];\n\t#showNotify: boolean;\n\t#applyFilterAfterAction: boolean;\n\t#action: Class<SimpleAction> = SimpleAction;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid, params: Params)\n\t{\n\t\tthis.#grid = grid;\n\n\t\tif (!Type.isArrayFilled(params.ids))\n\t\t{\n\t\t\tthrow new Error('Param ids must be filled array');\n\t\t}\n\n\t\tthis.#ids = params.ids;\n\t\tthis.#showNotify = (\n\t\t\tType.isBoolean(params.showNotify)\n\t\t\t\t? params.showNotify\n\t\t\t\t: true\n\t\t);\n\t\tthis.#applyFilterAfterAction = (\n\t\t\tType.isBoolean(params.applyFilterAfterAction)\n\t\t\t\t? params.applyFilterAfterAction\n\t\t\t\t: false\n\t\t);\n\t}\n\n\tsetDropZone(dropZone: BX.CRM.Kanban.DropZone): DeleteAction\n\t{\n\t\tthis.#dropZone = dropZone;\n\n\t\treturn this;\n\t}\n\n\texecute(): void\n\t{\n\t\tconst actionParams = {\n\t\t\taction: 'delete',\n\t\t\tid: this.#ids,\n\t\t};\n\n\t\t(new this.#action(this.#grid, actionParams))\n\t\t\t.showNotify(this.#showNotify)\n\t\t\t.applyFilterAfterAction(this.#applyFilterAfterAction)\n\t\t\t.execute()\n\t\t\t.then(\n\t\t\t\t(response) => this.#onResolve(response),\n\t\t\t\t(response) => this.#onReject(response),\n\t\t\t)\n\t\t\t.catch(() => {\n\t\t\t\tthis.#showActionError();\n\t\t\t})\n\t\t;\n\t}\n\n\t#onResolve(response: Object)\n\t{\n\t\tconst dropZone = this.#dropZone;\n\n\t\tif (dropZone)\n\t\t{\n\t\t\tthis.#prepareDropZone();\n\t\t}\n\n\t\tthis.#prepareGrid();\n\t\tthis.#unHideUndeletedItems(response);\n\t\tthis.#showResult(response);\n\t}\n\n\t#getDeletedItems(): BX.CRM.Kanban.Item[]\n\t{\n\t\tif (this.#deletedItems === null)\n\t\t{\n\t\t\tconst grid = this.#grid;\n\t\t\tconst ids = this.#ids;\n\n\t\t\tids.forEach((id) => {\n\t\t\t\tconst item = grid.getItem(id);\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tif (this.#deletedItems === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#deletedItems = [];\n\t\t\t\t\t}\n\t\t\t\t\tthis.#deletedItems.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.#deletedItems;\n\t}\n\n\t#prepareDropZone(): void\n\t{\n\t\tconst dropZone = this.#dropZone;\n\n\t\tdropZone.empty();\n\t\tdropZone.getDropZoneArea().hide();\n\n\t\tdropZone.droppedItems = [];\n\t}\n\n\t#prepareGrid(): void\n\t{\n\t\tconst grid = this.#grid;\n\n\t\tgrid.dropZonesShow = false;\n\n\t\tgrid.resetMultiSelectMode();\n\t\tgrid.resetActionPanel();\n\t\tgrid.resetDragMode();\n\t}\n\n\t#unHideUndeletedItems(data: Object): void\n\t{\n\t\tconst deletedItems = this.#getDeletedItems();\n\t\tconst { deletedIds, errors } = data;\n\n\t\tconst undeletedItems = deletedItems.filter((item) => !deletedIds.includes(Number(item.getId())));\n\n\t\tif (Type.isArrayFilled(undeletedItems))\n\t\t{\n\t\t\tundeletedItems.forEach((item) => this.#restoreItemInColumn(item));\n\n\t\t\terrors.forEach(({ message: content, data: { id } }) => {\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent,\n\t\t\t\t\tactions: [{\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_OPEN_ITEM'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tBX.fireEvent(this.#grid.getItem(id).link, 'click');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}],\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#showResult(data: Object): void\n\t{\n\t\tconst deletedItems = this.#getDeletedItems();\n\t\tconst { deletedIds } = data;\n\n\t\tconst removedItems = deletedItems.filter((item) => deletedIds.includes(Number(item.getId())));\n\t\tif (!Type.isArrayFilled(removedItems))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst balloonOptions = {\n\t\t\tcontent: this.#getDeleteTitle(removedItems),\n\t\t};\n\n\t\tconst grid = this.#grid;\n\t\tif (grid.getTypeInfoParam('isRecyclebinEnabled'))\n\t\t{\n\t\t\tballoonOptions.actions = [{\n\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_DELETE_CANCEL'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => this.#onDeletionCancelClick(balloon, removedItems),\n\t\t\t\t},\n\t\t\t}];\n\t\t}\n\n\t\tconst balloon = UI.Notification.Center.notify(balloonOptions);\n\t}\n\n\t#getDeleteTitle(removedItems: BX.CRM.Kanban.Item[]): string\n\t{\n\t\tconst ids = this.#ids;\n\n\t\tif (ids.length === 1)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_KANBAN_DELETE_SUCCESS',\n\t\t\t\t{ '#ELEMENT_NAME#': removedItems[0].getData().name },\n\t\t\t);\n\t\t}\n\n\t\tconst difference = (ids.length - removedItems.length);\n\t\tif (difference === 0)\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_KANBAN_DELETE_SUCCESS_MULTIPLE');\n\t\t}\n\n\t\treturn Loc.getMessage(\n\t\t\t'CRM_KANBAN_DELETE_SUCCESS_MULTIPLE_WITH_ERRORS',\n\t\t\t{\n\t\t\t\t'#COUNT#': difference,\n\t\t\t},\n\t\t);\n\t}\n\n\t#onDeletionCancelClick(balloon, removedItems: BX.CRM.Kanban.Item[]): void\n\t{\n\t\tballoon.close();\n\n\t\tconst grid = this.#grid;\n\t\tconst entityIds = this.#ids;\n\t\tconst { entityTypeInt: entityTypeId } = grid.getData();\n\n\t\tAjax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'restore',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityIds,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t},\n\t\t\t},\n\t\t).then(\n\t\t\t({ data }) => {\n\t\t\t\tif (!Type.isPlainObject(data))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst ids = Object.values(data).filter((id) => Type.isNumber(id));\n\n\t\t\t\tif (Type.isArrayFilled(ids))\n\t\t\t\t{\n\t\t\t\t\tthis\n\t\t\t\t\t\t.#grid\n\t\t\t\t\t\t.loadNew(ids, false, true, true, true)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\t\tconst autoHideDelay = 6000;\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_DELETE_RESTORE_SUCCESS'),\n\t\t\t\t\t\t\t\t\tautoHideDelay,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tthis.#showActionError();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tthis.#showActionError();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t(response) => this.#onReject(response),\n\t\t).catch(() => {\n\t\t\tthis.#showActionError();\n\t\t});\n\t}\n\n\t#showActionError(): void\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_KANBAN_ACTION_ERROR'),\n\t\t});\n\t}\n\n\t#restoreItemInColumn(item: BX.CRM.Kanban.Item): void\n\t{\n\t\tconst lastPosition = item.getLastPosition();\n\n\t\tif (!lastPosition.columnId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = item.getData();\n\n\t\tdata.columnId = lastPosition.columnId;\n\t\tdata.targetId = lastPosition.targetId;\n\n\t\tconst grid = this.#grid;\n\t\tconst price = parseFloat(data.price);\n\t\tgrid.getColumn(item.columnId).incPrice(price);\n\n\t\tgrid.updateItem(item.getId(), data);\n\t\tgrid.unhideItem(item);\n\t}\n\n\t#onReject(response: Object): void\n\t{\n\t\tconst { message: content } = response.errors[0];\n\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent,\n\t\t});\n\t}\n}\n\nNAMESPACE.DeleteAction = DeleteAction;","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Event, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\theadersSections: Object,\n\tdefaultHeaderSectionId: ?string,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.fieldsPopupItems = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\n\t\tthis.enableHeadersSections = Boolean(this.options.headersSections);\n\t\tthis.headersSections = (this.options.headersSections ?? {});\n\t\tthis.defaultHeaderSectionId = (this.options.defaultHeaderSectionId ?? null);\n\n\t\tthis.fieldVisibleClass = 'crm-kanban-popup-field-search-list-item-visible';\n\t\tthis.fieldHiddenClass = 'crm-kanban-popup-field-search-list-item-hidden';\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: Loc.getMessage('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.fieldsPopupItems = null;\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tconst headerWrapper = Tag.render`\n\t\t\t<div class=\"crm-kanban-popup-field-search-header-wrapper\">\n\t\t\t\t<div class=\"ui-form-row-inline\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tcontainer.prepend(headerWrapper);\n\n\t\tthis.preparePopupContentHeaderSections(headerWrapper);\n\t\tthis.preparePopupContentHeaderSearch(headerWrapper);\n\n\t\tthis.getSections().map(section => {\n\t\t\tconst sectionWrapperId = this.getSectionWrapperNameBySectionName(section.name);\n\t\t\tconst sectionWrapper = Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"crm-kanban-popup-field-search-section\" \n\t\t\t\t\tdata-crm-kanban-popup-field-search-section=\"${sectionWrapperId}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(sectionWrapper, container);\n\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tpreparePopupContentHeaderSections(headerWrapper: HTMLElement): void\n\t{\n\t\tif (!this.enableHeadersSections)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerSectionsWrapper = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-section-wrapper\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(headerSectionsWrapper);\n\n\t\tconst headersSections = this.getHeadersSections();\n\n\t\tfor (let key in headersSections)\n\t\t{\n\t\t\tconst itemClass = 'crm-kanban-popup-field-search-section-item-icon'\n\t\t\t\t+ (headersSections[key].selected ? ` crm-kanban-popup-field-search-section-item-icon-active` : '');\n\n\t\t\tconst headerSectionItem = Tag.render`\n\t\t\t\t<div class=\"crm-kanban-popup-field-search-section-item\" data-kanban-popup-filter-section-button=\"${key}\">\n\t\t\t\t\t<div class=\"${itemClass}\">\n\t\t\t\t\t\t${Text.encode(headersSections[key].name)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\theaderSectionsWrapper.firstElementChild.appendChild(headerSectionItem);\n\n\t\t\tif (this.type !== TYPE_VIEW)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tEvent.bind(headerSectionItem, 'click', this.onFilterSectionClick.bind(this, headerSectionItem));\n\t\t}\n\t}\n\n\tonFilterSectionClick(item: HTMLElement): void\n\t{\n\t\tconst activeClass = 'crm-kanban-popup-field-search-section-item-icon-active';\n\t\tconst sectionId = item.dataset.kanbanPopupFilterSectionButton;\n\t\tconst sections = document.querySelectorAll(\n\t\t\t`[data-crm-kanban-popup-field-search-section=\"${sectionId}\"]`\n\t\t);\n\t\tif (Dom.hasClass(item.firstElementChild, activeClass))\n\t\t{\n\t\t\tDom.removeClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'show');\n\t\t}\n\t}\n\n\tfilterSectionsToggle(sections: NodeList, action: string): void\n\t{\n\t\tArray.from(sections).map(section => {\n\t\t\t(action === 'show' ? Dom.show(section) : Dom.hide(section));\n\t\t});\n\t}\n\n\tpreparePopupContentHeaderSearch(headerWrapper: HTMLElement): void\n\t{\n\t\tconst searchForm = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-input-wrapper\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\"></button>\n\t\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element crm-kanban-popup-field-search-section-input\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(searchForm);\n\t\tconst inputs = searchForm.getElementsByClassName('crm-kanban-popup-field-search-section-input');\n\t\tif (inputs.length)\n\t\t{\n\t\t\tconst input = inputs[0];\n\t\t\tEvent.bind(input, 'input', this.onFilterSectionSearchInput.bind(this, input));\n\t\t\tEvent.bind(input.previousElementSibling, 'click', this.onFilterSectionSearchInputClear.bind(this, input));\n\t\t}\n\t}\n\n\tonFilterSectionSearchInput(input: HTMLElement): void\n\t{\n\t\tlet search = input.value;\n\t\tif (search.length)\n\t\t{\n\t\t\tsearch = search.toLowerCase();\n\t\t}\n\n\t\tthis.getFieldsPopupItems().map(item => {\n\t\t\tconst title = item.innerText.toLowerCase();\n\n\t\t\tif (search.length && title.indexOf(search) === -1)\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldVisibleClass);\n\t\t\t\tDom.addClass(item, this.fieldHiddenClass);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldHiddenClass);\n\t\t\t\tDom.addClass(item, this.fieldVisibleClass);\n\t\t\t\titem.style.display = 'block';\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFieldsPopupItems(): ?HTMLElement[]\n\t{\n\t\tif (!Type.isArray(this.fieldsPopupItems))\n\t\t{\n\t\t\tthis.fieldsPopupItems = Array.from(\n\t\t\t\tthis.popup.getPopupContainer().querySelectorAll('.crm-kanban-popup-field-item')\n\t\t\t);\n\t\t\tthis.prepareAnimation();\n\t\t}\n\n\t\treturn this.fieldsPopupItems;\n\t}\n\n\tprepareAnimation(): void\n\t{\n\t\tthis.fieldsPopupItems.map(item => {\n\t\t\tEvent.bind(item, 'animationend', this.onAnimationEnd.bind(this, item));\n\t\t});\n\t}\n\n\tonAnimationEnd(item: HTMLElement): void\n\t{\n\t\titem.style.display = (\n\t\t\tDom.hasClass(item, this.fieldHiddenClass)\n\t\t\t\t? 'none'\n\t\t\t\t: 'block'\n\t\t);\n\t}\n\n\tonFilterSectionSearchInputClear(input: HTMLElement): void\n\t{\n\t\tif (input.value.length)\n\t\t{\n\t\t\tinput.value = '';\n\t\t\tthis.onFilterSectionSearchInput(input);\n\t\t}\n\t}\n\n\tgetSectionWrapperNameBySectionName(name: string): ?string\n\t{\n\t\tconst headerSections = this.getHeadersSections();\n\t\tfor (let id in headerSections)\n\t\t{\n\t\t\tif (this.headersSections[id].sections && this.headersSections[id].sections.includes(name))\n\t\t\t{\n\t\t\t\treturn this.headersSections[id].id;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.headersSections[this.defaultHeaderSectionId] && this.defaultHeaderSectionId)\n\t\t\t\t? this.headersSections[this.defaultHeaderSectionId].id\n\t\t\t\t: null\n\t\t);\n\t}\n\n\tgetHeadersSections(): Object\n\t{\n\t\treturn (this.headersSections ?? {});\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n","const ViewMode = {\n\tMODE_STAGES: 'STAGES',\n\tMODE_ACTIVITIES: 'ACTIVITIES',\n\tMODE_DEADLINES: 'DEADLINES',\n\n\tgetDefault(): string\n\t{\n\t\treturn this.MODE_STAGES;\n\t},\n\n\tgetAll(): string[]\n\t{\n\t\treturn [\n\t\t\tthis.MODE_STAGES,\n\t\t\tthis.MODE_ACTIVITIES,\n\t\t\tthis.MODE_DEADLINES,\n\t\t];\n\t},\n\n\tnormalize(mode: string): string\n\t{\n\t\treturn this.getAll().includes(mode) ? mode : this.getDefault();\n\t},\n};\n\nObject.freeze(ViewMode);\n\nexport {\n\tViewMode,\n};\n","import { Sorter } from 'crm.kanban.sort';\nimport { Type } from 'main.core';\nimport { ViewMode } from './viewmode';\n\nexport default class PullOperation\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\titemId: Number;\n\taction: String;\n\tactionParams: Object;\n\n\tstatic createInstance(data: Object): PullOperation\n\t{\n\t\treturn (new PullOperation(data.grid))\n\t\t\t.setItemId(data.itemId)\n\t\t\t.setAction(data.action)\n\t\t\t.setActionParams(data.actionParams)\n\t\t;\n\t}\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.grid = grid;\n\t}\n\n\tsetItemId(itemId: Number): PullOperation\n\t{\n\t\tthis.itemId = itemId;\n\n\t\treturn this;\n\t}\n\n\tgetItemId(): Number\n\t{\n\t\treturn this.itemId;\n\t}\n\n\tsetAction(action: String): PullOperation\n\t{\n\t\tthis.action = action;\n\n\t\treturn this;\n\t}\n\n\tgetAction(): String\n\t{\n\t\treturn this.action;\n\t}\n\n\tsetActionParams(actionParams: Object): PullOperation\n\t{\n\t\tthis.actionParams = actionParams;\n\n\t\treturn this;\n\t}\n\n\tgetActionParams(): Object\n\t{\n\t\treturn this.actionParams;\n\t}\n\n\texecute(): void\n\t{\n\t\tconst action = this.getAction();\n\n\t\tif (action === 'updateItem')\n\t\t{\n\t\t\tthis.updateItem();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'addItem')\n\t\t{\n\t\t\tthis.addItem();\n\t\t}\n\t}\n\n\tupdateItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { viewMode } = this.grid.getData();\n\t\tif ([ViewMode.MODE_ACTIVITIES, ViewMode.MODE_DEADLINES].includes(viewMode))\n\t\t{\n\t\t\titem.useAnimation = false;\n\n\t\t\tthis.grid.insertItem(item);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst insertItemParams = {};\n\t\tconst { lastActivity, columnId: newColumnId, price } = paramsItem.data;\n\t\tif (Type.isObjectLike(lastActivity) && lastActivity.timestamp !== item.data.lastActivity.timestamp)\n\t\t{\n\t\t\tinsertItemParams.canShowLastActivitySortTour = true;\n\t\t}\n\n\t\tconst oldPrice = parseFloat(item.data.price);\n\t\tconst oldColumnId = item.columnId;\n\n\t\tfor (const key in paramsItem.data)\n\t\t{\n\t\t\tif (key in item.data)\n\t\t\t{\n\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t}\n\t\t}\n\n\t\titem.rawData = paramsItem.rawData;\n\t\titem.setActivityExistInnerHtml();\n\t\titem.useAnimation = true;\n\t\titem.setChangedInPullRequest();\n\n\t\tthis.grid.resetMultiSelectMode();\n\n\t\tconst newColumn = this.grid.getColumn(newColumnId);\n\t\tconst newPrice = parseFloat(price);\n\n\t\tinsertItemParams.newColumnId = newColumnId;\n\t\tthis.grid.insertItem(item, insertItemParams);\n\n\t\titem.columnId = newColumnId;\n\n\t\tif (!this.grid.getTypeInfoParam('showTotalPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (oldColumnId === newColumnId)\n\t\t{\n\t\t\tif (oldPrice < newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t\telse if (oldPrice > newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst groupIds = this.grid.itemMoving?.dropEvent?.groupIds ?? [];\n\t\tif (!groupIds.includes(item.id))\n\t\t{\n\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\toldColumn.decPrice(oldPrice);\n\t\t\toldColumn.renderSubTitle();\n\t\t}\n\n\t\tif (newColumn)\n\t\t{\n\t\t\tnewColumn.incPrice(newPrice);\n\t\t\tnewColumn.renderSubTitle();\n\t\t}\n\t}\n\n\taddItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\tif (!column)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sorter = Sorter.createWithCurrentSortType(column.getItems());\n\n\t\tconst beforeItem = sorter.calcBeforeItemByParams(params.item.data.sort);\n\t\tif (beforeItem)\n\t\t{\n\t\t\tparams.item.targetId = beforeItem.getId();\n\t\t}\n\n\t\tthis.grid.addItem(params.item);\n\t}\n}\n","import { Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { ActionItem } from 'pull.queuemanager';\nimport { QueueManager } from 'pull.queuemanager';\nimport PullOperation from './pulloperation';\nimport { ViewMode } from './viewmode';\n\nconst EventName = {\n\titemUpdated: 'ITEMUPDATED',\n\titemAdded: 'ITEMADDED',\n\titemDeleted: 'ITEMDELETED',\n\tstageAdded: 'STAGEADDED',\n\tstageUpdated: 'STAGEUPDATED',\n\tstageDeleted: 'STAGEDELETED',\n};\n\nexport default class PullManager\n{\n\tqueueManager: QueueManager;\n\tgrid: BX.CRM.Kanban.Grid;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid)\n\t{\n\t\tif (!BX.PULL)\n\t\t{\n\t\t\tconsole.info('BX.PULL is not initialized');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid = grid;\n\n\t\tconst data = grid.getData();\n\n\t\tconst options = {\n\t\t\tmoduleId: data.moduleId,\n\t\t\tpullTag: data.pullTag,\n\t\t\tadditionalPullTags: data.additionalPullTags ?? [],\n\t\t\tuserId: data.userId,\n\t\t\tadditionalData: {\n\t\t\t\tviewMode: data.viewMode,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonBeforePull: (event) => {\n\t\t\t\t\tthis.#onBeforePull(event);\n\t\t\t\t},\n\t\t\t\tonPull: (event) => {\n\t\t\t\t\tthis.#onPull(event);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcallbacks: {\n\t\t\t\tonBeforeQueueExecute: (items) => {\n\t\t\t\t\treturn this.#onBeforeQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonQueueExecute: (items) => {\n\t\t\t\t\treturn this.#onQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonReload: () => {\n\t\t\t\t\tthis.#onReload();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.queueManager = new QueueManager(options);\n\t}\n\n\t#onBeforeQueueExecute(items: Object[]): Promise\n\t{\n\t\titems.forEach((item) => {\n\t\t\tconst { data } = item;\n\n\t\t\tconst operation = PullOperation.createInstance({\n\t\t\t\tgrid: this.grid,\n\t\t\t\titemId: data.id,\n\t\t\t\taction: data.action,\n\t\t\t\tactionParams: data.actionParams,\n\t\t\t});\n\n\t\t\toperation.execute(); // change to async and use Promise.all in return\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#onQueueExecute(items: Object[]): Promise\n\t{\n\t\tconst ids = [];\n\t\titems.forEach(({ id, data: { action } }) => {\n\t\t\tif (action === 'addItem' || action === 'updateItem')\n\t\t\t{\n\t\t\t\tids.push(parseInt(id, 10));\n\t\t\t}\n\t\t});\n\n\t\tif (ids.length === 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.grid.loadNew(ids, false, true, true, true);\n\t}\n\n\t#onReload(): void\n\t{\n\t\tthis.grid.reload();\n\t}\n\n\t#onBeforePull(event: BaseEvent): void\n\t{\n\t\tconst { data: { options, pullData } } = event;\n\t\tif (\n\t\t\t!pullData.command.startsWith(options.pullTag)\n\t\t\t&& options.additionalData.viewMode !== ViewMode.MODE_ACTIVITIES\n\t\t)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#onPull(event: BaseEvent): void\n\t{\n\t\tconst { pullData: { params } } = event.data;\n\n\t\tif (params.eventName === EventName.itemUpdated)\n\t\t{\n\t\t\tthis.#onPullItemUpdated(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.eventName === EventName.itemAdded)\n\t\t{\n\t\t\tthis.#onPullItemAdded(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.eventName === EventName.itemDeleted)\n\t\t{\n\t\t\tthis.#onPullItemDeleted(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.eventName === EventName.stageAdded)\n\t\t{\n\t\t\tthis.#onPullStageChanged(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.eventName === EventName.stageUpdated)\n\t\t{\n\t\t\tthis.#onPullStageChanged(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.eventName === EventName.stageDeleted)\n\t\t{\n\t\t\tthis.#onPullStageDeleted(event);\n\t\t}\n\t}\n\n\t#onPullItemUpdated(event: BaseEvent): void\n\t{\n\t\tconst { pullData: { params }, promises } = event.data;\n\n\t\tconst item = this.grid.getItem(params.item.id);\n\n\t\tif (item)\n\t\t{\n\t\t\tpromises.push(Promise.resolve({\n\t\t\t\tdata: this.#getPullData('updateItem', params),\n\t\t\t}));\n\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tparams.eventName = EventName.itemAdded;\n\t\tthis.#onPullItemAdded(event);\n\t}\n\n\t#onPullItemAdded(event: BaseEvent): void\n\t{\n\t\tconst { pullData: { params }, promises } = event.data;\n\n\t\tconst itemId = params.item.id;\n\t\tconst oldItem = this.grid.getItem(itemId);\n\n\t\tif (oldItem)\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tpromises.push(Promise.resolve({\n\t\t\tdata: this.#getPullData('addItem', params),\n\t\t}));\n\t}\n\n\t#getPullData(action: string, actionParams: Object): ActionItem\n\t{\n\t\tconst { id } = actionParams.item;\n\n\t\treturn {\n\t\t\tid,\n\t\t\taction,\n\t\t\tactionParams,\n\t\t};\n\t}\n\n\t#onPullItemDeleted(event: BaseEvent): void\n\t{\n\t\tconst { pullData: { params } } = event.data;\n\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { id, data: { columnId } } = params.item;\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (\n\t\t\tthis.queueManager.hasInQueue(id)\n\t\t\t\t? this.queueManager.getLoadItemsDelay()\n\t\t\t\t: 0\n\t\t);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.queueManager.deleteFromQueue(id);\n\n\t\t\tconst { grid } = this;\n\t\t\tconst item = grid.getItem(id);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgrid.removeItem(id);\n\n\t\t\tif (grid.getTypeInfoParam('showTotalPrice'))\n\t\t\t{\n\t\t\t\tconst column = grid.getColumn(columnId);\n\t\t\t\tcolumn.decPrice(item.data.price);\n\t\t\t\tcolumn.renderSubTitle();\n\t\t\t}\n\t\t}, delay);\n\n\t\tevent.preventDefault();\n\t}\n\n\t#onPullStageChanged(event: BaseEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\t#onPullStageDeleted(event: BaseEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst { pullData: { params } } = event.data;\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n}\n"],"names":["NAMESPACE","Reflection","namespace","SimpleAction","grid","params","value","action","registerAnalyticsCloseEvent","BX","Crm","Integration","Analytics","Dictionary","STATUS_ATTEMPT","Promise","resolve","reject","ajax","data","error","isMultiSelectMode","resetMultiSelectMode","Type","isStringFilled","eventId","QueueManager","registerRandomEventId","STATUS_ERROR","STATUS_SUCCESS","callback","gridData","getData","stopActionPanel","onApplyFilter","getTypeInfoParam","messageCode","isDynamicEntity","codeVer","entityType","codeVer1","codeVer2","Loc","hasMessage","Kanban","Utils","showErrorDialog","getMessage","Error","fatal","code","startsWith","ignore","toUpperCase","content","UI","Notification","Center","notify","msgVer1Codes","includes","msgVer2Codes","isPlainObject","Object","entries","forEach","entryData","replace","entity_id","entityId","item","getItem","targetColumn","getColumn","status","type","getDefaultAnalyticsCloseEvent","toString","c_element","ELEMENT_WON_TOP_ACTIONS","ELEMENT_LOSE_TOP_ACTIONS","DeleteAction","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","isArrayFilled","ids","isBoolean","showNotify","applyFilterAfterAction","dropZone","actionParams","id","execute","then","response","_classPrivateMethodGet","push","empty","getDropZoneArea","hide","droppedItems","dropZonesShow","resetActionPanel","resetDragMode","deletedItems","deletedIds","errors","undeletedItems","filter","Number","getId","message","actions","title","events","click","fireEvent","link","removedItems","balloonOptions","balloon","length","name","difference","close","entityIds","entityTypeId","entityTypeInt","Ajax","runComponentAction","mode","values","isNumber","loadNew","autoHideDelay","lastPosition","getLastPosition","columnId","targetId","price","parseFloat","incPrice","updateItem","unhideItem","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","fieldsPopupItems","hasOwnProperty","selectedFields","slice","enableHeadersSections","Boolean","headersSections","defaultHeaderSectionId","fieldVisibleClass","fieldHiddenClass","createPopup","setContent","getFieldsLayout","loadPopupContent","show","PopupManager","create","className","titleBar","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","field","indexOf","NAME","executeCallback","autoHide","CancelButton","loaderContainer","Tag","render","loader","Loader","target","size","entityTypeName","viewType","destroy","getButtons","button","setDisabled","adjustPosition","pop","sectionsWithFields","distributeFieldsBySections","container","headerWrapper","prepend","preparePopupContentHeaderSections","preparePopupContentHeaderSearch","getSections","map","section","sectionWrapperId","getSectionWrapperNameBySectionName","sectionWrapper","Dom","append","sectionName","Text","encode","label","LABEL","encodedLabel","ID","onFieldClick","bind","headerSectionsWrapper","firstElementChild","appendChild","getHeadersSections","key","itemClass","selected","headerSectionItem","Event","onFilterSectionClick","activeClass","sectionId","dataset","kanbanPopupFilterSectionButton","sections","document","querySelectorAll","hasClass","removeClass","filterSectionsToggle","addClass","Array","from","searchForm","inputs","getElementsByClassName","input","onFilterSectionSearchInput","previousElementSibling","onFilterSectionSearchInputClear","search","toLowerCase","getFieldsPopupItems","innerText","style","display","isArray","getPopupContainer","prepareAnimation","onAnimationEnd","headerSections","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","i","elements","filterFieldsByList","filterFieldsByRule","RegExp","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","event","checked","splice","ViewMode","MODE_STAGES","MODE_ACTIVITIES","MODE_DEADLINES","getDefault","getAll","normalize","freeze","PullOperation","setItemId","itemId","setAction","setActionParams","getAction","addItem","getActionParams","paramsItem","viewMode","useAnimation","insertItem","insertItemParams","lastActivity","newColumnId","isObjectLike","timestamp","canShowLastActivitySortTour","oldPrice","oldColumnId","rawData","setActivityExistInnerHtml","setChangedInPullRequest","newColumn","newPrice","renderSubTitle","decPrice","groupIds","itemMoving","dropEvent","oldColumn","oldItem","column","sorter","Sorter","createWithCurrentSortType","getItems","beforeItem","calcBeforeItemByParams","sort","EventName","itemUpdated","itemAdded","itemDeleted","stageAdded","stageUpdated","stageDeleted","PullManager","PULL","console","info","moduleId","pullTag","additionalPullTags","userId","additionalData","onBeforePull","onPull","callbacks","onBeforeQueueExecute","items","onQueueExecute","onReload","queueManager","operation","createInstance","parseInt","reload","pullData","command","preventDefault","eventName","promises","delay","hasInQueue","getLoadItemsDelay","setTimeout","deleteFromQueue","removeItem","removeColumn","stage"],"mappings":"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"}