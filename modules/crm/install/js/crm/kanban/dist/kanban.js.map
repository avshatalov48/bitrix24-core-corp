{"version":3,"file":"kanban.js","sources":["../src/pulloperation.js","../src/pullqueue.js","../src/pullmanager.js","../src/fieldsselector.js"],"sourcesContent":["export default class PullOperation\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\titemId: Number;\n\taction: String;\n\tactionParams: Object;\n\n\tstatic createInstance(data: Object): PullOperation\n\t{\n\t\tconst instance = new PullOperation(data.grid);\n\n\t\tinstance.setItemId(data.itemId);\n\t\tinstance.setAction(data.action);\n\t\tinstance.setActionParams(data.actionParams);\n\n\t\treturn instance;\n\t}\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.grid = grid;\n\t}\n\n\tsetItemId(itemId: Number): PullOperation\n\t{\n\t\tthis.itemId = itemId;\n\t\treturn this;\n\t}\n\n\tgetItemId(): Number\n\t{\n\t\treturn this.itemId;\n\t}\n\n\tsetAction(action: String): PullOperation\n\t{\n\t\tthis.action = action;\n\t\treturn this;\n\t}\n\n\tgetAction(): String\n\t{\n\t\treturn this.action;\n\t}\n\n\tsetActionParams(actionParams: Object): PullOperation\n\t{\n\t\tthis.actionParams = actionParams;\n\t\treturn this;\n\t}\n\n\tgetActionParams(): Object\n\t{\n\t\treturn this.actionParams;\n\t}\n\n\texecute(): void\n\t{\n\t\tif (this.getAction() === 'updateItem')\n\t\t{\n\t\t\treturn this.updateItem();\n\t\t}\n\n\t\tif (this.getAction() === 'addItem')\n\t\t{\n\t\t\treturn this.addItem();\n\t\t}\n\t}\n\n\tupdateItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldPrice = parseFloat(item.data.price);\n\t\tconst oldColumnId = item.columnId;\n\n\t\tfor (let key in paramsItem.data)\n\t\t{\n\t\t\tif (key in item.data)\n\t\t\t{\n\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t}\n\t\t}\n\n\t\titem.rawData = paramsItem.rawData;\n\t\titem.setActivityExistInnerHtml();\n\t\titem.useAnimation = true;\n\t\titem.setChangedInPullRequest();\n\n\t\tthis.grid.resetMultiSelectMode();\n\t\tthis.grid.insertItem(item);\n\n\t\tconst newColumnId = paramsItem.data.columnId;\n\t\tconst newColumn = this.grid.getColumn(newColumnId);\n\t\tconst newPrice = parseFloat(paramsItem.data.price);\n\n\t\titem.columnId = newColumnId;\n\n\t\tif (oldColumnId !== newColumnId)\n\t\t{\n\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\toldColumn.decPrice(oldPrice);\n\t\t\toldColumn.renderSubTitle();\n\t\t\tif (newColumn)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (oldPrice < newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t\telse if (oldPrice > newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t}\n\n\taddItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.addItemTop(params.item);\n\t}\n}\n","import PullOperation from \"./pulloperation\";\n\n/**\n * @class PullQueue\n */\n\nexport default class PullQueue\n{\n\t#queue: Map<number>;\n\t#grid: BX.CRM.Kanban.Grid;\n\t#isProgress: boolean;\n\t#isFreeze: boolean;\n\tloadItemsTimer;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#queue = new Map();\n\t\tthis.#isProgress = false;\n\t\tthis.#isFreeze = false;\n\t\tthis.loadItemsTimer = null;\n\t}\n\n\tloadItem(isForce: boolean): void\n\t{\n\t\tif (this.loadItemsTimer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadItemsTimer = setTimeout(\n\t\t\t() => {\n\t\t\t\tisForce = (isForce || false);\n\t\t\t\tif (this.#isProgress && !isForce)\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.hidden || this.isOverflow() || this.isFreezed())\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst items = this.popAllAsArray();\n\t\t\t\tif (items.length)\n\t\t\t\t{\n\t\t\t\t\tconst ids = [];\n\t\t\t\t\titems.map(item => {\n\t\t\t\t\t\tids.push(item.id);\n\t\t\t\t\t\tconst data = item.data;\n\t\t\t\t\t\tconst operation = PullOperation.createInstance({\n\t\t\t\t\t\t\tgrid: this.#grid,\n\t\t\t\t\t\t\titemId: data.id,\n\t\t\t\t\t\t\taction: data.action,\n\t\t\t\t\t\t\tactionParams: data.actionParams,\n\t\t\t\t\t\t});\n\t\t\t\t\t\toperation.execute();\n\t\t\t\t\t});\n\n\t\t\t\t\tconst loadNextOnSuccess = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t\tif (this.peek())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.loadItem(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#isProgress = false;\n\t\t\t\t\t};\n\t\t\t\t\tconst doNothingOnError = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#isProgress = true;\n\t\t\t\t\tthis.\n\t\t\t\t\t\t#grid\n\t\t\t\t\t\t.loadNew(ids, false, true, true)\n\t\t\t\t\t\t.then(loadNextOnSuccess, doNothingOnError)\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t},\n\t\t\t5000\n\t\t);\n\t}\n\n\tpush(id: number, item: string): PullQueue\n\t{\n\t\tid = parseInt(id, 10);\n\t\tif (this.has(id))\n\t\t{\n\t\t\tthis.delete(id);\n\t\t}\n\n\t\tthis.#queue.set(id, item);\n\t\treturn this;\n\t}\n\n\tpopAllAsArray()\n\t{\n\t\tconst items = Array.from(this.#queue, ([id, data]) => ({id, data}));\n\t\tthis.#queue.clear();\n\t\treturn items;\n\t}\n\n\tpopBatch(count: number)\n\t{\n\t\tif (count <= 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst results = [];\n\t\tfor (let i=0; i < count; i++)\n\t\t{\n\t\t\tconst item = this.pop();\n\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tresults.push(item);\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tpop(): number\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\tif (first.value)\n\t\t{\n\t\t\tthis.#queue.delete(first.value[0]);\n\t\t}\n\t\treturn first.value;\n\t}\n\n\tpeek(): number|null\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\treturn (first.value ?? null);\n\t}\n\n\tdelete(id: number): void\n\t{\n\t\tthis.#queue.delete(id);\n\t}\n\n\thas(id: number): boolean\n\t{\n\t\treturn this.#queue.has(id);\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#queue.clear();\n\t}\n\n\tisOverflow(): boolean\n\t{\n\t\tconst MAX_PENDING_ITEMS = 30;\n\t\treturn (this.#queue.size > MAX_PENDING_ITEMS);\n\t}\n\n\tfreeze(): void\n\t{\n\t\tthis.#isFreeze = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tthis.#isFreeze = false;\n\t}\n\n\tisFreezed(): boolean\n\t{\n\t\treturn this.#isFreeze;\n\t}\n}\n","import {Event, Type, Loc} from 'main.core';\nimport PullQueue from \"./pullqueue\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport default class PullManager\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\tqueue: PullQueue;\n\tnotifier: BX.UI.Notification.Balloon;\n\topenedSlidersCount: Number;\n\n\tconstructor(grid)\n\t{\n\t\tthis.grid = grid;\n\t\tthis.queue = new PullQueue(this.grid);\n\t\tthis.openedSlidersCount = 0;\n\t\tif (Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.bindEvents();\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif (!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tPull.subscribe({\n\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\tcommand: this.grid.getData().pullTag,\n\t\t\t\tcallback: (params) =>\n\t\t\t\t{\n\t\t\t\t\tif (Type.isString(params.eventName))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(this.queue.isOverflow())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (params.eventName === 'ITEMUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\n\t\t\tEvent.bind(document, 'visibilitychange', () => {\n\t\t\t\tif (!document.hidden)\n\t\t\t\t{\n\t\t\t\t\tthis.onTabActivated();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tif (this.updateItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tupdateItem(params)\n\t{\n\t\tconst item = this.grid.getItem(params.item.id);\n\n\t\tif (item)\n\t\t{\n\t\t\tthis.queue.push(item.id, {\n\t\t\t\tid: item.id,\n\t\t\t\taction: 'updateItem',\n\t\t\t\tactionParams: params,\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.onPullItemAdded(params);\n\t\treturn false\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tif (this.addItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\taddItem(params)\n\t{\n\t\tconst itemId = params.item.id;\n\t\tconst oldItem = this.grid.getItem(itemId);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.queue.push(itemId, {\n\t\t\tid: itemId,\n\t\t\taction: 'addItem',\n\t\t\tactionParams: params,\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonPullItemDeleted(params)\n\t{\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (this.queue.has(params.item.id) ? 5000 : 0);\n\n\t\tsetTimeout(function() {\n\t\t\tthis.queue.delete(params.item.id);\n\t\t\tthis.grid.removeItem(params.item.id);\n\n\t\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\t\tcolumn.decPrice(params.item.data.price);\n\t\t\tcolumn.renderSubTitle();\n\t\t}.bind(this), delay);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonTabActivated()\n\t{\n\t\tif (this.queue.isOverflow())\n\t\t{\n\t\t\tthis.showOutdatedDataDialog();\n\t\t}\n\t\telse if (this.queue.peek())\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tshowOutdatedDataDialog()\n\t{\n\t\tif (!this.notifier)\n\t\t{\n\t\t\tthis.notifier = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_NOTIFY_OUTDATED_DATA'),\n\t\t\t\tcloseButton: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_GRID_RELOAD'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t\tthis.queue.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifier.show();\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', (event) => {\n\t\t\tthis.openedSlidersCount++;\n\t\t\tthis.queue.freeze();\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\tthis.openedSlidersCount--;\n\t\t\tif (this.openedSlidersCount <= 0)\n\t\t\t{\n\t\t\t\tthis.openedSlidersCount = 0;\n\t\t\t\tthis.queue.unfreeze();\n\t\t\t\tthis.onTabActivated();\n\t\t\t}\n\t\t});\n\t}\n}\n","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Event, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\theadersSections: Object,\n\tdefaultHeaderSectionId: ?string,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.fieldsPopupItems = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\n\t\tthis.enableHeadersSections = Boolean(this.options.headersSections);\n\t\tthis.headersSections = (this.options.headersSections ?? {});\n\t\tthis.defaultHeaderSectionId = (this.options.defaultHeaderSectionId ?? null);\n\n\t\tthis.fieldVisibleClass = 'crm-kanban-popup-field-search-list-item-visible';\n\t\tthis.fieldHiddenClass = 'crm-kanban-popup-field-search-list-item-hidden';\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: BX.message('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => (this.popup = null)\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tconst headerWrapper = Tag.render`\n\t\t\t<div class=\"crm-kanban-popup-field-search-header-wrapper\">\n\t\t\t\t<div class=\"ui-form-row-inline\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tcontainer.prepend(headerWrapper);\n\n\t\tthis.preparePopupContentHeaderSections(headerWrapper);\n\t\tthis.preparePopupContentHeaderSearch(headerWrapper);\n\n\t\tthis.getSections().map(section => {\n\t\t\tconst sectionWrapperId = this.getSectionWrapperNameBySectionName(section.name);\n\t\t\tconst sectionWrapper = Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"crm-kanban-popup-field-search-section\" \n\t\t\t\t\tdata-crm-kanban-popup-field-search-section=\"${sectionWrapperId}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(sectionWrapper, container);\n\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tpreparePopupContentHeaderSections(headerWrapper: HTMLElement): void\n\t{\n\t\tif (!this.enableHeadersSections)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerSectionsWrapper = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-section-wrapper\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(headerSectionsWrapper);\n\n\t\tconst headersSections = this.getHeadersSections();\n\n\t\tfor (let key in headersSections)\n\t\t{\n\t\t\tconst itemClass = 'crm-kanban-popup-field-search-section-item-icon'\n\t\t\t\t+ (headersSections[key].selected ? ` crm-kanban-popup-field-search-section-item-icon-active` : '');\n\n\t\t\tconst headerSectionItem = Tag.render`\n\t\t\t\t<div class=\"crm-kanban-popup-field-search-section-item\" data-kanban-popup-filter-section-button=\"${key}\">\n\t\t\t\t\t<div class=\"${itemClass}\">\n\t\t\t\t\t\t${Text.encode(headersSections[key].name)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\theaderSectionsWrapper.firstElementChild.appendChild(headerSectionItem);\n\n\t\t\tif (this.type !== TYPE_VIEW)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tEvent.bind(headerSectionItem, 'click', this.onFilterSectionClick.bind(this, headerSectionItem));\n\t\t}\n\t}\n\n\tonFilterSectionClick(item: HTMLElement): void\n\t{\n\t\tconst activeClass = 'crm-kanban-popup-field-search-section-item-icon-active';\n\t\tconst sectionId = item.dataset.kanbanPopupFilterSectionButton;\n\t\tconst sections = document.querySelectorAll(\n\t\t\t`[data-crm-kanban-popup-field-search-section=\"${sectionId}\"]`\n\t\t);\n\t\tif (Dom.hasClass(item.firstElementChild, activeClass))\n\t\t{\n\t\t\tDom.removeClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'show');\n\t\t}\n\t}\n\n\tfilterSectionsToggle(sections: NodeList, action: string): void\n\t{\n\t\tArray.from(sections).map(section => {\n\t\t\t(action === 'show' ? Dom.show(section) : Dom.hide(section));\n\t\t});\n\t}\n\n\tpreparePopupContentHeaderSearch(headerWrapper: HTMLElement): void\n\t{\n\t\tconst searchForm = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-input-wrapper\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\"></button>\n\t\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element crm-kanban-popup-field-search-section-input\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(searchForm);\n\t\tconst inputs = searchForm.getElementsByClassName('crm-kanban-popup-field-search-section-input');\n\t\tif (inputs.length)\n\t\t{\n\t\t\tconst input = inputs[0];\n\t\t\tEvent.bind(input, 'input', this.onFilterSectionSearchInput.bind(this, input));\n\t\t\tEvent.bind(input.previousElementSibling, 'click', this.onFilterSectionSearchInputClear.bind(this, input));\n\t\t}\n\t}\n\n\tonFilterSectionSearchInput(input: HTMLElement): void\n\t{\n\t\tlet search = input.value;\n\t\tif (search.length)\n\t\t{\n\t\t\tsearch = search.toLowerCase();\n\t\t}\n\n\t\tthis.getFieldsPopupItems().map(item => {\n\t\t\tconst title = item.innerText.toLowerCase();\n\n\t\t\tif (search.length && title.indexOf(search) === -1)\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldVisibleClass);\n\t\t\t\tDom.addClass(item, this.fieldHiddenClass);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldHiddenClass);\n\t\t\t\tDom.addClass(item, this.fieldVisibleClass);\n\t\t\t\titem.style.display = 'block';\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFieldsPopupItems(): ?HTMLElement[]\n\t{\n\t\tif (!Type.isArray(this.fieldsPopupItems))\n\t\t{\n\t\t\tthis.fieldsPopupItems = Array.from(\n\t\t\t\tthis.popup.getPopupContainer().querySelectorAll('.crm-kanban-popup-field-item')\n\t\t\t);\n\t\t\tthis.prepareAnimation();\n\t\t}\n\n\t\treturn this.fieldsPopupItems;\n\t}\n\n\tprepareAnimation(): void\n\t{\n\t\tthis.fieldsPopupItems.map(item => {\n\t\t\tEvent.bind(item, 'animationend', this.onAnimationEnd.bind(this, item));\n\t\t});\n\t}\n\n\tonAnimationEnd(item: HTMLElement): void\n\t{\n\t\titem.style.display = (\n\t\t\tDom.hasClass(item, this.fieldHiddenClass)\n\t\t\t\t? 'none'\n\t\t\t\t: 'block'\n\t\t);\n\t}\n\n\tonFilterSectionSearchInputClear(input: HTMLElement): void\n\t{\n\t\tif (input.value.length)\n\t\t{\n\t\t\tinput.value = '';\n\t\t\tthis.onFilterSectionSearchInput(input);\n\t\t}\n\t}\n\n\tgetSectionWrapperNameBySectionName(name: string): ?string\n\t{\n\t\tconst headerSections = this.getHeadersSections();\n\t\tfor (let id in headerSections)\n\t\t{\n\t\t\tif (this.headersSections[id].sections && this.headersSections[id].sections.includes(name))\n\t\t\t{\n\t\t\t\treturn this.headersSections[id].id;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.headersSections[this.defaultHeaderSectionId] && this.defaultHeaderSectionId)\n\t\t\t\t? this.headersSections[this.defaultHeaderSectionId].id\n\t\t\t\t: null\n\t\t);\n\t}\n\n\tgetHeadersSections(): Object\n\t{\n\t\treturn (this.headersSections ?? {});\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'CLOSEDATE',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n"],"names":["PullOperation","data","instance","grid","setItemId","itemId","setAction","action","setActionParams","actionParams","getAction","updateItem","addItem","params","getActionParams","item","getItem","id","paramsItem","oldPrice","parseFloat","price","oldColumnId","columnId","key","rawData","setActivityExistInnerHtml","useAnimation","setChangedInPullRequest","resetMultiSelectMode","insertItem","newColumnId","newColumn","getColumn","newPrice","oldColumn","decPrice","renderSubTitle","incPrice","oldItem","addItemTop","PullQueue","Map","loadItemsTimer","isForce","setTimeout","document","hidden","isOverflow","isFreezed","items","popAllAsArray","length","ids","map","push","operation","createInstance","execute","loadNextOnSuccess","peek","loadItem","doNothingOnError","loadNew","then","parseInt","has","set","Array","from","clear","count","results","i","pop","entries","first","next","value","MAX_PENDING_ITEMS","size","PullManager","queue","openedSlidersCount","Type","isString","getData","moduleId","userId","init","bindEvents","Event","ready","Pull","BX","PULL","console","error","subscribe","command","pullTag","callback","eventName","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","onPullStageAdded","onPullStageDeleted","onPullStageUpdated","extendWatch","bind","onTabActivated","isPlainObject","delay","removeItem","column","onApplyFilter","removeColumn","stage","showOutdatedDataDialog","notifier","UI","Notification","Center","notify","content","Loc","getMessage","closeButton","autoHide","actions","title","events","click","event","balloon","close","reload","show","EventEmitter","freeze","unfreeze","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","fieldsPopupItems","type","hasOwnProperty","selectedFields","slice","enableHeadersSections","Boolean","headersSections","defaultHeaderSectionId","fieldVisibleClass","fieldHiddenClass","createPopup","setContent","getFieldsLayout","loadPopupContent","PopupManager","create","className","titleBar","message","toUpperCase","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","filter","field","indexOf","NAME","executeCallback","autoHideDelay","CancelButton","loaderContainer","Tag","render","loader","Loader","target","ajax","runComponentAction","mode","entityType","entityTypeName","viewType","response","destroy","getButtons","forEach","button","setDisabled","adjustPosition","Kanban","Utils","showErrorDialog","errors","sectionsWithFields","distributeFieldsBySections","container","headerWrapper","prepend","preparePopupContentHeaderSections","preparePopupContentHeaderSearch","getSections","section","sectionWrapperId","getSectionWrapperNameBySectionName","name","sectionWrapper","Dom","append","sectionName","Text","encode","label","LABEL","encodedLabel","ID","onFieldClick","headerSectionsWrapper","firstElementChild","appendChild","getHeadersSections","itemClass","selected","headerSectionItem","onFilterSectionClick","activeClass","sectionId","dataset","kanbanPopupFilterSectionButton","sections","querySelectorAll","hasClass","removeClass","filterSectionsToggle","addClass","hide","searchForm","inputs","getElementsByClassName","input","onFilterSectionSearchInput","previousElementSibling","onFilterSectionSearchInputClear","search","toLowerCase","getFieldsPopupItems","innerText","style","display","isArray","getPopupContainer","prepareAnimation","onAnimationEnd","headerSections","includes","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","elements","filterFieldsByList","filterFieldsByRule","RegExp","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","Object","values","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","checked","splice"],"mappings":";;;;;KAAqBA;;;oCAOEC,MACtB;CACC,UAAMC,QAAQ,GAAG,IAAIF,aAAJ,CAAkBC,IAAI,CAACE,IAAvB,CAAjB;CAEAD,MAAAA,QAAQ,CAACE,SAAT,CAAmBH,IAAI,CAACI,MAAxB;CACAH,MAAAA,QAAQ,CAACI,SAAT,CAAmBL,IAAI,CAACM,MAAxB;CACAL,MAAAA,QAAQ,CAACM,eAAT,CAAyBP,IAAI,CAACQ,YAA9B;CAEA,aAAOP,QAAP;CACA;;;CAED,yBAAYC,IAAZ,EACA;CAAA;CACC,SAAKA,IAAL,GAAYA,IAAZ;CACA;;;;+BAESE,QACV;CACC,WAAKA,MAAL,GAAcA,MAAd;CACA,aAAO,IAAP;CACA;;;iCAGD;CACC,aAAO,KAAKA,MAAZ;CACA;;;+BAESE,QACV;CACC,WAAKA,MAAL,GAAcA,MAAd;CACA,aAAO,IAAP;CACA;;;iCAGD;CACC,aAAO,KAAKA,MAAZ;CACA;;;qCAEeE,cAChB;CACC,WAAKA,YAAL,GAAoBA,YAApB;CACA,aAAO,IAAP;CACA;;;uCAGD;CACC,aAAO,KAAKA,YAAZ;CACA;;;+BAGD;CACC,UAAI,KAAKC,SAAL,OAAqB,YAAzB,EACA;CACC,eAAO,KAAKC,UAAL,EAAP;CACA;;CAED,UAAI,KAAKD,SAAL,OAAqB,SAAzB,EACA;CACC,eAAO,KAAKE,OAAL,EAAP;CACA;CACD;;;kCAGD;CACC,UAAMC,MAAM,GAAG,KAAKC,eAAL,EAAf;CACA,UAAMC,IAAI,GAAG,KAAKZ,IAAL,CAAUa,OAAV,CAAkBH,MAAM,CAACE,IAAP,CAAYE,EAA9B,CAAb;CACA,UAAMC,UAAU,GAAGL,MAAM,CAACE,IAA1B;;CAEA,UAAI,CAACA,IAAL,EACA;CACC;CACA;;CAED,UAAMI,QAAQ,GAAGC,UAAU,CAACL,IAAI,CAACd,IAAL,CAAUoB,KAAX,CAA3B;CACA,UAAMC,WAAW,GAAGP,IAAI,CAACQ,QAAzB;;CAEA,WAAK,IAAIC,GAAT,IAAgBN,UAAU,CAACjB,IAA3B,EACA;CACC,YAAIuB,GAAG,IAAIT,IAAI,CAACd,IAAhB,EACA;CACCc,UAAAA,IAAI,CAACd,IAAL,CAAUuB,GAAV,IAAiBN,UAAU,CAACjB,IAAX,CAAgBuB,GAAhB,CAAjB;CACA;CACD;;CAEDT,MAAAA,IAAI,CAACU,OAAL,GAAeP,UAAU,CAACO,OAA1B;CACAV,MAAAA,IAAI,CAACW,yBAAL;CACAX,MAAAA,IAAI,CAACY,YAAL,GAAoB,IAApB;CACAZ,MAAAA,IAAI,CAACa,uBAAL;CAEA,WAAKzB,IAAL,CAAU0B,oBAAV;CACA,WAAK1B,IAAL,CAAU2B,UAAV,CAAqBf,IAArB;CAEA,UAAMgB,WAAW,GAAGb,UAAU,CAACjB,IAAX,CAAgBsB,QAApC;CACA,UAAMS,SAAS,GAAG,KAAK7B,IAAL,CAAU8B,SAAV,CAAoBF,WAApB,CAAlB;CACA,UAAMG,QAAQ,GAAGd,UAAU,CAACF,UAAU,CAACjB,IAAX,CAAgBoB,KAAjB,CAA3B;CAEAN,MAAAA,IAAI,CAACQ,QAAL,GAAgBQ,WAAhB;;CAEA,UAAIT,WAAW,KAAKS,WAApB,EACA;CACC,YAAMI,SAAS,GAAG,KAAKhC,IAAL,CAAU8B,SAAV,CAAoBX,WAApB,CAAlB;CACAa,QAAAA,SAAS,CAACC,QAAV,CAAmBjB,QAAnB;CACAgB,QAAAA,SAAS,CAACE,cAAV;;CACA,YAAIL,SAAJ,EACA;CACCA,UAAAA,SAAS,CAACM,QAAV,CAAmBJ,QAAnB;CACAF,UAAAA,SAAS,CAACK,cAAV;CACA;CACD,OAVD,MAYA;CACC,YAAIlB,QAAQ,GAAGe,QAAf,EACA;CACCF,UAAAA,SAAS,CAACM,QAAV,CAAmBJ,QAAQ,GAAGf,QAA9B;CACAa,UAAAA,SAAS,CAACK,cAAV;CACA,SAJD,MAKK,IAAIlB,QAAQ,GAAGe,QAAf,EACL;CACCF,UAAAA,SAAS,CAACI,QAAV,CAAmBjB,QAAQ,GAAGe,QAA9B;CACAF,UAAAA,SAAS,CAACK,cAAV;CACA;CACD;CACD;;;+BAGD;CACC,UAAMxB,MAAM,GAAG,KAAKC,eAAL,EAAf;CACA,UAAMyB,OAAO,GAAG,KAAKpC,IAAL,CAAUa,OAAV,CAAkBH,MAAM,CAACE,IAAP,CAAYE,EAA9B,CAAhB;;CACA,UAAIsB,OAAJ,EACA;CACC;CACA;;CAED,WAAKpC,IAAL,CAAUqC,UAAV,CAAqB3B,MAAM,CAACE,IAA5B;CACA;;;;;;;;CC3IF;CACA;CACA;;;;;;;;;;KAEqB0B;CAQpB,qBAAYtC,IAAZ,EACA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CAAA;CAAA;CAAA;CAAA;;CACC,mDAAaA,IAAb;CACA,oDAAc,IAAIuC,GAAJ,EAAd;CACA,yDAAmB,KAAnB;CACA,uDAAiB,KAAjB;CACA,SAAKC,cAAL,GAAsB,IAAtB;CACA;;;;8BAEQC,SACT;CAAA;;CACC,UAAI,KAAKD,cAAT,EACA;CACC;CACA;;CAED,WAAKA,cAAL,GAAsBE,UAAU,CAC/B,YAAM;CACLD,QAAAA,OAAO,GAAIA,OAAO,IAAI,KAAtB;;CACA,YAAI,kCAAA,KAAI,cAAJ,IAAoB,CAACA,OAAzB,EACA;CACC,UAAA,KAAI,CAACD,cAAL,GAAsB,IAAtB;CACA;CACA;;CAED,YAAIG,QAAQ,CAACC,MAAT,IAAmB,KAAI,CAACC,UAAL,EAAnB,IAAwC,KAAI,CAACC,SAAL,EAA5C,EACA;CACC,UAAA,KAAI,CAACN,cAAL,GAAsB,IAAtB;CACA;CACA;;CAED,YAAMO,KAAK,GAAG,KAAI,CAACC,aAAL,EAAd;;CACA,YAAID,KAAK,CAACE,MAAV,EACA;CACC,cAAMC,GAAG,GAAG,EAAZ;CACAH,UAAAA,KAAK,CAACI,GAAN,CAAU,UAAAvC,IAAI,EAAI;CACjBsC,YAAAA,GAAG,CAACE,IAAJ,CAASxC,IAAI,CAACE,EAAd;CACA,gBAAMhB,IAAI,GAAGc,IAAI,CAACd,IAAlB;CACA,gBAAMuD,SAAS,GAAGxD,aAAa,CAACyD,cAAd,CAA6B;CAC9CtD,cAAAA,IAAI,oCAAE,KAAF,QAD0C;CAE9CE,cAAAA,MAAM,EAAEJ,IAAI,CAACgB,EAFiC;CAG9CV,cAAAA,MAAM,EAAEN,IAAI,CAACM,MAHiC;CAI9CE,cAAAA,YAAY,EAAER,IAAI,CAACQ;CAJ2B,aAA7B,CAAlB;CAMA+C,YAAAA,SAAS,CAACE,OAAV;CACA,WAVD;;CAYA,cAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;CAC/B,YAAA,KAAI,CAAChB,cAAL,GAAsB,IAAtB;;CACA,gBAAI,KAAI,CAACiB,IAAL,EAAJ,EACA;CACC,cAAA,KAAI,CAACC,QAAL,CAAc,IAAd;CACA;;CACD,8CAAA,KAAI,eAAe,KAAf,CAAJ;CACA,WAPD;;CAQA,cAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;CAC9B,YAAA,KAAI,CAACnB,cAAL,GAAsB,IAAtB;CACA,WAFD;;CAIA,4CAAA,KAAI,eAAe,IAAf,CAAJ;CACA,4CAAA,KAAI,QAAJ,CAEEoB,OAFF,CAEUV,GAFV,EAEe,KAFf,EAEsB,IAFtB,EAE4B,IAF5B,EAGEW,IAHF,CAGOL,iBAHP,EAG0BG,gBAH1B;CAKA;CACD,OAlD8B,EAmD/B,IAnD+B,CAAhC;CAqDA;;;0BAEI7C,IAAYF,MACjB;CACCE,MAAAA,EAAE,GAAGgD,QAAQ,CAAChD,EAAD,EAAK,EAAL,CAAb;;CACA,UAAI,KAAKiD,GAAL,CAASjD,EAAT,CAAJ,EACA;CACC,uBAAYA,EAAZ;CACA;;CAED,sDAAYkD,GAAZ,CAAgBlD,EAAhB,EAAoBF,IAApB;CACA,aAAO,IAAP;CACA;;;qCAGD;CACC,UAAMmC,KAAK,GAAGkB,KAAK,CAACC,IAAN,mCAAW,IAAX,WAAwB;CAAA;CAAA,YAAEpD,EAAF;CAAA,YAAMhB,IAAN;;CAAA,eAAiB;CAACgB,UAAAA,EAAE,EAAFA,EAAD;CAAKhB,UAAAA,IAAI,EAAJA;CAAL,SAAjB;CAAA,OAAxB,CAAd;CACA,sDAAYqE,KAAZ;CACA,aAAOpB,KAAP;CACA;;;8BAEQqB,OACT;CACC,UAAIA,KAAK,IAAI,CAAb,EACA;CACC,eAAO,EAAP;CACA;;CAED,UAAMC,OAAO,GAAG,EAAhB;;CACA,WAAK,IAAIC,CAAC,GAAC,CAAX,EAAcA,CAAC,GAAGF,KAAlB,EAAyBE,CAAC,EAA1B,EACA;CACC,YAAM1D,IAAI,GAAG,KAAK2D,GAAL,EAAb;;CAEA,YAAI,CAAC3D,IAAL,EACA;CACC;CACA;;CAEDyD,QAAAA,OAAO,CAACjB,IAAR,CAAaxC,IAAb;CACA;;CAED,aAAOyD,OAAP;CACA;;;2BAGD;CACC,UAAMtB,KAAK,GAAG,gDAAYyB,OAAZ,EAAd;CACA,UAAMC,KAAK,GAAG1B,KAAK,CAAC2B,IAAN,EAAd;;CACA,UAAID,KAAK,CAACE,KAAV,EACA;CACC,kEAAmBF,KAAK,CAACE,KAAN,CAAY,CAAZ,CAAnB;CACA;;CACD,aAAOF,KAAK,CAACE,KAAb;CACA;;;4BAGD;CAAA;;CACC,UAAM5B,KAAK,GAAG,gDAAYyB,OAAZ,EAAd;CACA,UAAMC,KAAK,GAAG1B,KAAK,CAAC2B,IAAN,EAAd;CACA,6BAAQD,KAAK,CAACE,KAAd,uDAAuB,IAAvB;CACA;;;6BAEM7D,IACP;CACC,gEAAmBA,EAAnB;CACA;;;yBAEGA,IACJ;CACC,aAAO,gDAAYiD,GAAZ,CAAgBjD,EAAhB,CAAP;CACA;;;6BAGD;CACC,sDAAYqD,KAAZ;CACA;;;kCAGD;CACC,UAAMS,iBAAiB,GAAG,EAA1B;CACA,aAAQ,gDAAYC,IAAZ,GAAmBD,iBAA3B;CACA;;;8BAGD;CACC,yDAAiB,IAAjB;CACA;;;gCAGD;CACC,yDAAiB,KAAjB;CACA;;;iCAGD;CACC,+CAAO,IAAP;CACA;;;;;KC/KmBE;CAOpB,uBAAY9E,IAAZ,EACA;CAAA;CACC,SAAKA,IAAL,GAAYA,IAAZ;CACA,SAAK+E,KAAL,GAAa,IAAIzC,SAAJ,CAAc,KAAKtC,IAAnB,CAAb;CACA,SAAKgF,kBAAL,GAA0B,CAA1B;;CACA,QAAIC,cAAI,CAACC,QAAL,CAAclF,IAAI,CAACmF,OAAL,GAAeC,QAA7B,KAA0CpF,IAAI,CAACmF,OAAL,GAAeE,MAAf,GAAwB,CAAtE,EACA;CACC,WAAKC,IAAL;CACA;;CAED,SAAKC,UAAL;CACA;;;;4BAGD;CAAA;;CACCC,MAAAA,eAAK,CAACC,KAAN,CAAY,YACZ;CACC,YAAMC,IAAI,GAAGC,EAAE,CAACC,IAAhB;;CACA,YAAI,CAACF,IAAL,EACA;CACCG,UAAAA,OAAO,CAACC,KAAR,CAAc,yBAAd;CACA;CACA;;CAEDJ,QAAAA,IAAI,CAACK,SAAL,CAAe;CACdX,UAAAA,QAAQ,EAAE,KAAI,CAACpF,IAAL,CAAUmF,OAAV,GAAoBC,QADhB;CAEdY,UAAAA,OAAO,EAAE,KAAI,CAAChG,IAAL,CAAUmF,OAAV,GAAoBc,OAFf;CAGdC,UAAAA,QAAQ,EAAE,kBAACxF,MAAD,EACV;CACC,gBAAIuE,cAAI,CAACC,QAAL,CAAcxE,MAAM,CAACyF,SAArB,CAAJ,EACA;CACC,kBAAG,KAAI,CAACpB,KAAL,CAAWlC,UAAX,EAAH,EACA;CACC;CACA;;CACD,kBAAInC,MAAM,CAACyF,SAAP,KAAqB,aAAzB,EACA;CACC,gBAAA,KAAI,CAACC,iBAAL,CAAuB1F,MAAvB;CACA,eAHD,MAIK,IAAIA,MAAM,CAACyF,SAAP,KAAqB,WAAzB,EACL;CACC,gBAAA,KAAI,CAACE,eAAL,CAAqB3F,MAArB;CACA,eAHI,MAIA,IAAIA,MAAM,CAACyF,SAAP,KAAqB,aAAzB,EACL;CACC,gBAAA,KAAI,CAACG,iBAAL,CAAuB5F,MAAvB;CACA,eAHI,MAIA,IAAIA,MAAM,CAACyF,SAAP,KAAqB,YAAzB,EACL;CACC,gBAAA,KAAI,CAACI,gBAAL,CAAsB7F,MAAtB;CACA,eAHI,MAIA,IAAIA,MAAM,CAACyF,SAAP,KAAqB,cAAzB,EACL;CACC,gBAAA,KAAI,CAACK,kBAAL,CAAwB9F,MAAxB;CACA,eAHI,MAIA,IAAIA,MAAM,CAACyF,SAAP,KAAqB,cAAzB,EACL;CACC,gBAAA,KAAI,CAACM,kBAAL,CAAwB/F,MAAxB;CACA;CACD;CACD;CApCa,SAAf;CAsCAgF,QAAAA,IAAI,CAACgB,WAAL,CAAiB,KAAI,CAAC1G,IAAL,CAAUmF,OAAV,GAAoBc,OAArC;CAEAT,QAAAA,eAAK,CAACmB,IAAN,CAAWhE,QAAX,EAAqB,kBAArB,EAAyC,YAAM;CAC9C,cAAI,CAACA,QAAQ,CAACC,MAAd,EACA;CACC,YAAA,KAAI,CAACgE,cAAL;CACA;CACD,SALD;CAMA,OAvDD;CAwDA;;;uCAEiBlG,QAClB;CACC,UAAI,KAAKF,UAAL,CAAgBE,MAAhB,CAAJ,EACA;CACC,aAAKqE,KAAL,CAAWrB,QAAX;CACA;CACD;;;gCAEUhD,QACX;CACC,UAAME,IAAI,GAAG,KAAKZ,IAAL,CAAUa,OAAV,CAAkBH,MAAM,CAACE,IAAP,CAAYE,EAA9B,CAAb;;CAEA,UAAIF,IAAJ,EACA;CACC,aAAKmE,KAAL,CAAW3B,IAAX,CAAgBxC,IAAI,CAACE,EAArB,EAAyB;CACxBA,UAAAA,EAAE,EAAEF,IAAI,CAACE,EADe;CAExBV,UAAAA,MAAM,EAAE,YAFgB;CAGxBE,UAAAA,YAAY,EAAEI;CAHU,SAAzB;CAMA,eAAO,IAAP;CACA;;CAED,WAAK2F,eAAL,CAAqB3F,MAArB;CACA,aAAO,KAAP;CACA;;;qCAEeA,QAChB;CACC,UAAI,KAAKD,OAAL,CAAaC,MAAb,CAAJ,EACA;CACC,aAAKqE,KAAL,CAAWrB,QAAX;CACA;CACD;;;6BAEOhD,QACR;CACC,UAAMR,MAAM,GAAGQ,MAAM,CAACE,IAAP,CAAYE,EAA3B;CACA,UAAMsB,OAAO,GAAG,KAAKpC,IAAL,CAAUa,OAAV,CAAkBX,MAAlB,CAAhB;;CACA,UAAIkC,OAAJ,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAK2C,KAAL,CAAW3B,IAAX,CAAgBlD,MAAhB,EAAwB;CACvBY,QAAAA,EAAE,EAAEZ,MADmB;CAEvBE,QAAAA,MAAM,EAAE,SAFe;CAGvBE,QAAAA,YAAY,EAAEI;CAHS,OAAxB;CAMA,aAAO,IAAP;CACA;;;uCAEiBA,QAClB;CACC,UAAI,CAACuE,cAAI,CAAC4B,aAAL,CAAmBnG,MAAM,CAACE,IAA1B,CAAL,EACA;CACC;CACA;CAED;CACF;CACA;CACA;;;CACE,UAAMkG,KAAK,GAAI,KAAK/B,KAAL,CAAWhB,GAAX,CAAerD,MAAM,CAACE,IAAP,CAAYE,EAA3B,IAAiC,IAAjC,GAAwC,CAAvD;CAEA4B,MAAAA,UAAU,CAAC,YAAW;CACrB,aAAKqC,KAAL,WAAkBrE,MAAM,CAACE,IAAP,CAAYE,EAA9B;CACA,aAAKd,IAAL,CAAU+G,UAAV,CAAqBrG,MAAM,CAACE,IAAP,CAAYE,EAAjC;CAEA,YAAMkG,MAAM,GAAG,KAAKhH,IAAL,CAAU8B,SAAV,CAAoBpB,MAAM,CAACE,IAAP,CAAYd,IAAZ,CAAiBsB,QAArC,CAAf;CACA4F,QAAAA,MAAM,CAAC/E,QAAP,CAAgBvB,MAAM,CAACE,IAAP,CAAYd,IAAZ,CAAiBoB,KAAjC;CACA8F,QAAAA,MAAM,CAAC9E,cAAP;CACA,OAPU,CAOTyE,IAPS,CAOJ,IAPI,CAAD,EAOIG,KAPJ,CAAV;CAQA;;;sCAEgBpG,QACjB;CACC,WAAKV,IAAL,CAAUiH,aAAV;CACA;;;wCAEkBvG,QACnB;CACC,WAAKV,IAAL,CAAUkH,YAAV,CAAuBxG,MAAM,CAACyG,KAAP,CAAarG,EAApC;CACA;;;wCAEkBJ,QACnB;CACC,WAAKV,IAAL,CAAUiH,aAAV;CACA;;;sCAGD;CACC,UAAI,KAAKlC,KAAL,CAAWlC,UAAX,EAAJ,EACA;CACC,aAAKuE,sBAAL;CACA,OAHD,MAIK,IAAI,KAAKrC,KAAL,CAAWtB,IAAX,EAAJ,EACL;CACC,aAAKsB,KAAL,CAAWrB,QAAX;CACA;CACD;;;8CAGD;CAAA;;CACC,UAAI,CAAC,KAAK2D,QAAV,EACA;CACC,aAAKA,QAAL,GAAgB1B,EAAE,CAAC2B,EAAH,CAAMC,YAAN,CAAmBC,MAAnB,CAA0BC,MAA1B,CAAiC;CAChDC,UAAAA,OAAO,EAAEC,aAAG,CAACC,UAAJ,CAAe,iCAAf,CADuC;CAEhDC,UAAAA,WAAW,EAAE,KAFmC;CAGhDC,UAAAA,QAAQ,EAAE,KAHsC;CAIhDC,UAAAA,OAAO,EAAE,CAAC;CACTC,YAAAA,KAAK,EAAEL,aAAG,CAACC,UAAJ,CAAe,wBAAf,CADE;CAETK,YAAAA,MAAM,EAAE;CACPC,cAAAA,KAAK,EAAE,eAACC,KAAD,EAAQC,OAAR,EAAiBhI,MAAjB,EAA4B;CAClCgI,gBAAAA,OAAO,CAACC,KAAR;;CACA,gBAAA,MAAI,CAACrI,IAAL,CAAUsI,MAAV;;CACA,gBAAA,MAAI,CAACvD,KAAL,CAAWZ,KAAX;CACA;CALM;CAFC,WAAD;CAJuC,SAAjC,CAAhB;CAeA,OAjBD,MAmBA;CACC,aAAKkD,QAAL,CAAckB,IAAd;CACA;CACD;;;kCAGD;CAAA;;CACCC,MAAAA,6BAAY,CAACzC,SAAb,CAAuB,yBAAvB,EAAkD,UAACoC,KAAD,EAAW;CAC5D,QAAA,MAAI,CAACnD,kBAAL;;CACA,QAAA,MAAI,CAACD,KAAL,CAAW0D,MAAX;CACA,OAHD;CAIAD,MAAAA,6BAAY,CAACzC,SAAb,CAAuB,0BAAvB,EAAmD,UAACoC,KAAD,EAAW;CAC7D,QAAA,MAAI,CAACnD,kBAAL;;CACA,YAAI,MAAI,CAACA,kBAAL,IAA2B,CAA/B,EACA;CACC,UAAA,MAAI,CAACA,kBAAL,GAA0B,CAA1B;;CACA,UAAA,MAAI,CAACD,KAAL,CAAW2D,QAAX;;CACA,UAAA,MAAI,CAAC9B,cAAL;CACA;CACD,OARD;CASA;;;;;;CCrNF,IAAM+B,SAAS,GAAG,MAAlB;CACA,IAAMC,SAAS,GAAG,MAAlB;;KAEqBC;CAEpB,0BAAYC,OAAZ,EACA;CAAA;;CAAA;CACC,SAAKC,KAAL,GAAa,IAAb;CACA,SAAKC,MAAL,GAAc,IAAd;CACA,SAAKC,gBAAL,GAAwB,IAAxB;CACA,SAAKH,OAAL,GAAeA,OAAf;CACA,SAAKI,IAAL,GACC,KAAKJ,OAAL,CAAaK,cAAb,CAA4B,MAA5B,IACG,KAAKL,OAAL,CAAaI,IADhB,GAEGP,SAHJ;CAMA,SAAKS,cAAL,GACC,KAAKN,OAAL,CAAaK,cAAb,CAA4B,gBAA5B,IACG,KAAKL,OAAL,CAAaM,cAAb,CAA4BC,KAA5B,CAAkC,CAAlC,CADH,GAEG,EAHJ;CAMA,SAAKC,qBAAL,GAA6BC,OAAO,CAAC,KAAKT,OAAL,CAAaU,eAAd,CAApC;CACA,SAAKA,eAAL,4BAAwB,KAAKV,OAAL,CAAaU,eAArC,yEAAwD,EAAxD;CACA,SAAKC,sBAAL,4BAA+B,KAAKX,OAAL,CAAaW,sBAA5C,yEAAsE,IAAtE;CAEA,SAAKC,iBAAL,GAAyB,iDAAzB;CACA,SAAKC,gBAAL,GAAwB,gDAAxB;CACA;;;;4BAGD;CACC,UAAI,CAAC,KAAKZ,KAAV,EACA;CACC,aAAKA,KAAL,GAAa,KAAKa,WAAL,EAAb;CACA;;CACD,UAAI,KAAKZ,MAAT,EACA;CACC,aAAKD,KAAL,CAAWc,UAAX,CAAsB,KAAKC,eAAL,EAAtB;CACA,OAHD,MAKA;CACC,aAAKC,gBAAL,CAAsB,KAAKhB,KAA3B;CACA;;CACD,WAAKA,KAAL,CAAWR,IAAX;CACA;;;mCAGD;CAAA;;CACC,aAAOyB,uBAAY,CAACC,MAAb,CAAoB;CAC1BnJ,QAAAA,EAAE,EAAE,0BAA0B,KAAKoI,IADT;CAE1BgB,QAAAA,SAAS,EAAE,wBAFe;CAG1BC,QAAAA,QAAQ,EAAExE,EAAE,CAACyE,OAAH,CAAW,8BAA8B,KAAKlB,IAAL,CAAUmB,WAAV,EAAzC,CAHgB;CAI1BC,QAAAA,SAAS,EAAE,KAJe;CAK1BC,QAAAA,SAAS,EAAE,IALe;CAM1BC,QAAAA,WAAW,EAAE,IANa;CAO1BC,QAAAA,OAAO,EAAE,IAPiB;CAQ1BC,QAAAA,SAAS,EAAE,IARe;CAS1BC,QAAAA,UAAU,EAAE,IATc;CAU1BC,QAAAA,YAAY,EAAE,OAVY;CAW1BC,QAAAA,SAAS,EAAEC,MAAM,CAACC,WAAP,GAAqB,EAXN;CAY1B9C,QAAAA,MAAM,EAAE;CACP+C,UAAAA,OAAO,EAAE;CAAA,mBAAO,KAAI,CAACjC,KAAL,GAAa,IAApB;CAAA;CADF,SAZkB;CAe1BkC,QAAAA,OAAO,EAAE,CACR,IAAItF,EAAE,CAAC2B,EAAH,CAAM4D,UAAV,CAAqB;CACpBC,UAAAA,KAAK,EAAExF,EAAE,CAAC2B,EAAH,CAAM8D,MAAN,CAAaC,KAAb,CAAmBC,OADN;CAEpBC,UAAAA,KAAK,EAAE,KAAKvC,MAAL,GAAc,EAAd,GAAmBrD,EAAE,CAAC2B,EAAH,CAAM8D,MAAN,CAAaI,KAAb,CAAmBC,QAFzB;CAGpBC,UAAAA,OAAO,EAAE,mBACT;CACC,gBAAMtC,cAAc,GACnB,KAAI,CAACJ,MAAL,GACG,KAAI,CAACA,MAAL,CAAY2C,MAAZ,CAAmB,UAAAC,KAAK;CAAA,qBAAI,KAAI,CAACxC,cAAL,CAAoByC,OAApB,CAA4BD,KAAK,CAACE,IAAlC,KAA2C,CAA/C;CAAA,aAAxB,CADH,GAEG,EAHJ;;CAKA,gBAAI1C,cAAc,CAACnG,MAAnB,EACA;CACC,cAAA,KAAI,CAAC8F,KAAL,CAAWV,KAAX;;CACA,cAAA,KAAI,CAAC0D,eAAL,CAAqB3C,cAArB;CACA,aAJD,MAMA;CACC9B,cAAAA,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;CAC7BC,gBAAAA,OAAO,EAAEC,aAAG,CAACC,UAAJ,CAAe,qCAAf,CADoB;CAE7BE,gBAAAA,QAAQ,EAAE,IAFmB;CAG7BkE,gBAAAA,aAAa,EAAE;CAHc,eAA9B;CAKA;CACD;CAvBmB,SAArB,CADQ,EA0BR,IAAIrG,EAAE,CAAC2B,EAAH,CAAM2E,YAAV,CAAuB;CACtBP,UAAAA,OAAO,EAAE,mBACT;CACC,YAAA,KAAI,CAAC3C,KAAL,CAAWV,KAAX;CACA;CAJqB,SAAvB,CA1BQ;CAfiB,OAApB,CAAP;CAiDA;;;sCAEgBU,OACjB;CAAA;;CACC,UAAMmD,eAAe,GAAGC,aAAG,CAACC,MAAP,oIAArB;CAEA,UAAMC,MAAM,GAAG,IAAI1G,EAAE,CAAC2G,MAAP,CAAc;CAC5BC,QAAAA,MAAM,EAAEL,eADoB;CAE5BrH,QAAAA,IAAI,EAAE;CAFsB,OAAd,CAAf;CAIAwH,MAAAA,MAAM,CAAC9D,IAAP;CAEAQ,MAAAA,KAAK,CAACc,UAAN,CAAiBqC,eAAjB;CAEAvG,MAAAA,EAAE,CAAC6G,IAAH,CAAQC,kBAAR,CACC,mBADD,EAEC,WAFD,EAGC;CACCC,QAAAA,IAAI,EAAE,MADP;CAEC5M,QAAAA,IAAI,EAAE;CACL6M,UAAAA,UAAU,EAAE,KAAK7D,OAAL,CAAa8D,cADpB;CAELC,UAAAA,QAAQ,EAAE,KAAK3D;CAFV;CAFP,OAHD,EAWErF,IAXF,CAYE,UAACiJ,QAAD,EACA;CACCT,QAAAA,MAAM,CAACU,OAAP;CAEA,QAAA,MAAI,CAAC/D,MAAL,GAAc8D,QAAQ,CAAChN,IAAvB;CACAiJ,QAAAA,KAAK,CAACc,UAAN,CAAiB,MAAI,CAACC,eAAL,EAAjB;CACAf,QAAAA,KAAK,CAACiE,UAAN,GAAmBC,OAAnB,CAA2B,UAAAC,MAAM;CAAA,iBAAIA,MAAM,CAACC,WAAP,CAAmB,KAAnB,CAAJ;CAAA,SAAjC;CACApE,QAAAA,KAAK,CAACqE,cAAN;CACA,OApBH,WAuBE,UAACN,QAAD,EACA;CACCnH,QAAAA,EAAE,CAAC0H,MAAH,CAAUC,KAAV,CAAgBC,eAAhB,CAAgCT,QAAQ,CAACU,MAAT,CAAgBjJ,GAAhB,GAAsB6F,OAAtD;CACA,OA1BH;CA6BA,aAAOrB,KAAP;CACA;;;uCAGD;CAAA;;CACC,UAAM0E,kBAAkB,GAAG,KAAKC,0BAAL,CAAgC,KAAK1E,MAArC,CAA3B;CAEA,UAAM2E,SAAS,GAAGxB,aAAG,CAACC,MAAP,+HAAf;CAEA,UAAMwB,aAAa,GAAGzB,aAAG,CAACC,MAAP,6NAAnB;CAMAuB,MAAAA,SAAS,CAACE,OAAV,CAAkBD,aAAlB;CAEA,WAAKE,iCAAL,CAAuCF,aAAvC;CACA,WAAKG,+BAAL,CAAqCH,aAArC;CAEA,WAAKI,WAAL,GAAmB7K,GAAnB,CAAuB,UAAA8K,OAAO,EAAI;CACjC,YAAMC,gBAAgB,GAAG,MAAI,CAACC,kCAAL,CAAwCF,OAAO,CAACG,IAAhD,CAAzB;;CACA,YAAMC,cAAc,GAAGlC,aAAG,CAACC,MAAP,uPAG4B8B,gBAH5B,CAApB;CAMAI,QAAAA,aAAG,CAACC,MAAJ,CAAWF,cAAX,EAA2BV,SAA3B;CAEA,YAAMa,WAAW,GAAGP,OAAO,CAACG,IAA5B;;CACA,YAAIX,kBAAkB,CAACtE,cAAnB,CAAkCqF,WAAlC,KAAkDf,kBAAkB,CAACe,WAAD,CAAlB,CAAgCvL,MAAtF,EACA;CACCqL,UAAAA,aAAG,CAACC,MAAJ,CACCpC,aAAG,CAACC,MADL,0IACwDqC,cAAI,CAACC,MAAL,CAAYT,OAAO,CAACjG,KAApB,CADxD,GAECqG,cAFD;CAIAC,UAAAA,aAAG,CAACC,MAAJ,CACCpC,aAAG,CAACC,MADL,sKAEIqB,kBAAkB,CAACe,WAAD,CAAlB,CAAgCrL,GAAhC,CACF,UAACyI,KAAD,EACA;CACC,gBAAI+C,KAAK,GAAG/C,KAAK,CAACgD,KAAlB;;CACA,gBACC,CAACD,KAAK,CAAC1L,MAAP,IACGgL,OAAO,CAAC,UAAD,CADV,IAEGA,OAAO,CAAC,UAAD,CAAP,CAAoBrC,KAAK,CAACE,IAA1B,CAFH,IAGGmC,OAAO,CAAC,UAAD,CAAP,CAAoBrC,KAAK,CAACE,IAA1B,EAAgC,OAAhC,CAHH,IAIGmC,OAAO,CAAC,UAAD,CAAP,CAAoBrC,KAAK,CAACE,IAA1B,EAAgC,OAAhC,EAAyC7I,MAL7C,EAOA;CACC0L,cAAAA,KAAK,GAAGV,OAAO,CAAC,UAAD,CAAP,CAAoBrC,KAAK,CAACE,IAA1B,EAAgC,OAAhC,CAAR;CACA;;CACD,gBAAM+C,YAAY,GAAGJ,cAAI,CAACC,MAAL,CAAYC,KAAZ,CAArB;CAEA,mBAAOxC,aAAG,CAACC,MAAX,gpBACmDyC,YADnD,EAGYJ,cAAI,CAACC,MAAL,CAAY9C,KAAK,CAACkD,EAAlB,CAHZ,EAKWL,cAAI,CAACC,MAAL,CAAY9C,KAAK,CAACE,IAAlB,CALX,EAOiB+C,YAPjB,EAQK,MAAI,CAACzF,cAAL,CAAoByC,OAApB,CAA4BD,KAAK,CAACE,IAAlC,KAA2C,CAA3C,GAA+C,SAA/C,GAA2D,EARhE,EASc,MAAI,CAACiD,YAAL,CAAkBpI,IAAlB,CAAuB,MAAvB,CATd,EAWmB8H,cAAI,CAACC,MAAL,CAAY9C,KAAK,CAACkD,EAAlB,CAXnB,EAYKD,YAZL;CAeA,WA/BC,CAFJ,GAoCCR,cApCD;CAsCA;CACD,OAxDD;CA0DA,aAAOV,SAAP;CACA;;;uDAEiCC,eAClC;CACC,UAAI,CAAC,KAAKtE,qBAAV,EACA;CACC;CACA;;CAED,UAAM0F,qBAAqB,GAAG7C,aAAG,CAACC,MAAP,uOAA3B;CAMAwB,MAAAA,aAAa,CAACqB,iBAAd,CAAgCC,WAAhC,CAA4CF,qBAA5C;CAEA,UAAMxF,eAAe,GAAG,KAAK2F,kBAAL,EAAxB;;CAEA,WAAK,IAAI9N,GAAT,IAAgBmI,eAAhB,EACA;CACC,YAAM4F,SAAS,GAAG,qDACd5F,eAAe,CAACnI,GAAD,CAAf,CAAqBgO,QAArB,+DAA4F,EAD9E,CAAlB;CAGA,YAAMC,iBAAiB,GAAGnD,aAAG,CAACC,MAAP,qSAC6E/K,GAD7E,EAEP+N,SAFO,EAGlBX,cAAI,CAACC,MAAL,CAAYlF,eAAe,CAACnI,GAAD,CAAf,CAAqB+M,IAAjC,CAHkB,CAAvB;CAQAY,QAAAA,qBAAqB,CAACC,iBAAtB,CAAwCC,WAAxC,CAAoDI,iBAApD;;CAEA,YAAI,KAAKpG,IAAL,KAAcP,SAAlB,EACA;CACC;CACA;;CAEDnD,QAAAA,eAAK,CAACmB,IAAN,CAAW2I,iBAAX,EAA8B,OAA9B,EAAuC,KAAKC,oBAAL,CAA0B5I,IAA1B,CAA+B,IAA/B,EAAqC2I,iBAArC,CAAvC;CACA;CACD;;;0CAEoB1O,MACrB;CACC,UAAM4O,WAAW,GAAG,wDAApB;CACA,UAAMC,SAAS,GAAG7O,IAAI,CAAC8O,OAAL,CAAaC,8BAA/B;CACA,UAAMC,QAAQ,GAAGjN,QAAQ,CAACkN,gBAAT,yDACgCJ,SADhC,SAAjB;;CAGA,UAAInB,aAAG,CAACwB,QAAJ,CAAalP,IAAI,CAACqO,iBAAlB,EAAqCO,WAArC,CAAJ,EACA;CACClB,QAAAA,aAAG,CAACyB,WAAJ,CAAgBnP,IAAI,CAACqO,iBAArB,EAAwCO,WAAxC;CACA,aAAKQ,oBAAL,CAA0BJ,QAA1B,EAAoC,MAApC;CACA,OAJD,MAMA;CACCtB,QAAAA,aAAG,CAAC2B,QAAJ,CAAarP,IAAI,CAACqO,iBAAlB,EAAqCO,WAArC;CACA,aAAKQ,oBAAL,CAA0BJ,QAA1B,EAAoC,MAApC;CACA;CACD;;;0CAEoBA,UAAoBxP,QACzC;CACC6D,MAAAA,KAAK,CAACC,IAAN,CAAW0L,QAAX,EAAqBzM,GAArB,CAAyB,UAAA8K,OAAO,EAAI;CAClC7N,QAAAA,MAAM,KAAK,MAAX,GAAoBkO,aAAG,CAAC/F,IAAJ,CAAS0F,OAAT,CAApB,GAAwCK,aAAG,CAAC4B,IAAJ,CAASjC,OAAT,CAAzC;CACA,OAFD;CAGA;;;qDAE+BL,eAChC;CACC,UAAMuC,UAAU,GAAGhE,aAAG,CAACC,MAAP,6kBAAhB;CAYAwB,MAAAA,aAAa,CAACqB,iBAAd,CAAgCC,WAAhC,CAA4CiB,UAA5C;CACA,UAAMC,MAAM,GAAGD,UAAU,CAACE,sBAAX,CAAkC,6CAAlC,CAAf;;CACA,UAAID,MAAM,CAACnN,MAAX,EACA;CACC,YAAMqN,KAAK,GAAGF,MAAM,CAAC,CAAD,CAApB;CACA5K,QAAAA,eAAK,CAACmB,IAAN,CAAW2J,KAAX,EAAkB,OAAlB,EAA2B,KAAKC,0BAAL,CAAgC5J,IAAhC,CAAqC,IAArC,EAA2C2J,KAA3C,CAA3B;CACA9K,QAAAA,eAAK,CAACmB,IAAN,CAAW2J,KAAK,CAACE,sBAAjB,EAAyC,OAAzC,EAAkD,KAAKC,+BAAL,CAAqC9J,IAArC,CAA0C,IAA1C,EAAgD2J,KAAhD,CAAlD;CACA;CACD;;;gDAE0BA,OAC3B;CAAA;;CACC,UAAII,MAAM,GAAGJ,KAAK,CAAC3L,KAAnB;;CACA,UAAI+L,MAAM,CAACzN,MAAX,EACA;CACCyN,QAAAA,MAAM,GAAGA,MAAM,CAACC,WAAP,EAAT;CACA;;CAED,WAAKC,mBAAL,GAA2BzN,GAA3B,CAA+B,UAAAvC,IAAI,EAAI;CACtC,YAAMoH,KAAK,GAAGpH,IAAI,CAACiQ,SAAL,CAAeF,WAAf,EAAd;;CAEA,YAAID,MAAM,CAACzN,MAAP,IAAiB+E,KAAK,CAAC6D,OAAN,CAAc6E,MAAd,MAA0B,CAAC,CAAhD,EACA;CACCpC,UAAAA,aAAG,CAACyB,WAAJ,CAAgBnP,IAAhB,EAAsB,MAAI,CAAC8I,iBAA3B;CACA4E,UAAAA,aAAG,CAAC2B,QAAJ,CAAarP,IAAb,EAAmB,MAAI,CAAC+I,gBAAxB;CACA,SAJD,MAMA;CACC2E,UAAAA,aAAG,CAACyB,WAAJ,CAAgBnP,IAAhB,EAAsB,MAAI,CAAC+I,gBAA3B;CACA2E,UAAAA,aAAG,CAAC2B,QAAJ,CAAarP,IAAb,EAAmB,MAAI,CAAC8I,iBAAxB;CACA9I,UAAAA,IAAI,CAACkQ,KAAL,CAAWC,OAAX,GAAqB,OAArB;CACA;CACD,OAdD;CAeA;;;2CAGD;CACC,UAAI,CAAC9L,cAAI,CAAC+L,OAAL,CAAa,KAAK/H,gBAAlB,CAAL,EACA;CACC,aAAKA,gBAAL,GAAwBhF,KAAK,CAACC,IAAN,CACvB,KAAK6E,KAAL,CAAWkI,iBAAX,GAA+BpB,gBAA/B,CAAgD,8BAAhD,CADuB,CAAxB;CAGA,aAAKqB,gBAAL;CACA;;CAED,aAAO,KAAKjI,gBAAZ;CACA;;;wCAGD;CAAA;;CACC,WAAKA,gBAAL,CAAsB9F,GAAtB,CAA0B,UAAAvC,IAAI,EAAI;CACjC4E,QAAAA,eAAK,CAACmB,IAAN,CAAW/F,IAAX,EAAiB,cAAjB,EAAiC,MAAI,CAACuQ,cAAL,CAAoBxK,IAApB,CAAyB,MAAzB,EAA+B/F,IAA/B,CAAjC;CACA,OAFD;CAGA;;;oCAEcA,MACf;CACCA,MAAAA,IAAI,CAACkQ,KAAL,CAAWC,OAAX,GACCzC,aAAG,CAACwB,QAAJ,CAAalP,IAAb,EAAmB,KAAK+I,gBAAxB,IACG,MADH,GAEG,OAHJ;CAKA;;;qDAE+B2G,OAChC;CACC,UAAIA,KAAK,CAAC3L,KAAN,CAAY1B,MAAhB,EACA;CACCqN,QAAAA,KAAK,CAAC3L,KAAN,GAAc,EAAd;CACA,aAAK4L,0BAAL,CAAgCD,KAAhC;CACA;CACD;;;wDAEkClC,MACnC;CACC,UAAMgD,cAAc,GAAG,KAAKjC,kBAAL,EAAvB;;CACA,WAAK,IAAIrO,EAAT,IAAesQ,cAAf,EACA;CACC,YAAI,KAAK5H,eAAL,CAAqB1I,EAArB,EAAyB8O,QAAzB,IAAqC,KAAKpG,eAAL,CAAqB1I,EAArB,EAAyB8O,QAAzB,CAAkCyB,QAAlC,CAA2CjD,IAA3C,CAAzC,EACA;CACC,iBAAO,KAAK5E,eAAL,CAAqB1I,EAArB,EAAyBA,EAAhC;CACA;CACD;;CAED,aACE,KAAK0I,eAAL,CAAqB,KAAKC,sBAA1B,KAAqD,KAAKA,sBAA3D,GACG,KAAKD,eAAL,CAAqB,KAAKC,sBAA1B,EAAkD3I,EADrD,GAEG,IAHJ;CAKA;;;0CAGD;CAAA;;CACC,sCAAQ,KAAK0I,eAAb,yEAAgC,EAAhC;CACA;;;gDAE0BR,QAC3B;CACC;CACA,UAAMsI,aAAa,GAAG,KAAKC,gBAAL,EAAtB;CACAvI,MAAAA,MAAM,GAAGA,MAAM,CAAC2C,MAAP,CAAc,UAAA/K,IAAI;CAAA,eAAI,EAAE0Q,aAAa,CAACnI,cAAd,CAA6BvI,IAAI,CAACkL,IAAlC,KAA2CwF,aAAa,CAAC1Q,IAAI,CAACkL,IAAN,CAA1D,CAAJ;CAAA,OAAlB,CAAT;CAEA,UAAI0F,gBAAgB,GAAG,EAAvB;CACA,UAAIC,kBAAkB,GAAG,EAAzB;CACA,UAAM7B,QAAQ,GAAG,KAAK9G,OAAL,CAAaK,cAAb,CAA4B,UAA5B,IAA0C,KAAKL,OAAL,CAAa8G,QAAvD,GAAkE,EAAnF;;CACA,WAAK,IAAItL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsL,QAAQ,CAAC3M,MAA7B,EAAqCqB,CAAC,EAAtC,EACA;CACC,YAAM2J,OAAO,GAAG2B,QAAQ,CAACtL,CAAD,CAAxB;CACA,YAAMkK,WAAW,GAAGP,OAAO,CAACG,IAA5B;CACAoD,QAAAA,gBAAgB,CAAChD,WAAD,CAAhB,GAAgC,EAAhC;;CACA,YAAIvJ,cAAI,CAAC4B,aAAL,CAAmBoH,OAAO,CAACyD,QAA3B,CAAJ,EACA;CACCF,UAAAA,gBAAgB,CAAChD,WAAD,CAAhB,GAAgC,KAAKmD,kBAAL,CAAwB3I,MAAxB,EAAgCiF,OAAO,CAACyD,QAAxC,CAAhC;CACA,SAHD,MAIK,IAAIzD,OAAO,CAAC9E,cAAR,CAAuB,cAAvB,CAAJ,EACL;CACCqI,UAAAA,gBAAgB,CAAChD,WAAD,CAAhB,GAAgC,KAAKoD,kBAAL,CAAwB5I,MAAxB,EAAgC,IAAI6I,MAAJ,CAAW5D,OAAO,CAAC6D,YAAnB,CAAhC,CAAhC;CACA,SAHI,MAIA,IAAI7D,OAAO,CAACyD,QAAR,KAAqB,GAAzB,EACL;CACCD,UAAAA,kBAAkB,GAAGjD,WAArB;CACA;CACD;;CACD,UAAIiD,kBAAkB,KAAK,EAA3B,EACA;CACCD,QAAAA,gBAAgB,CAACC,kBAAD,CAAhB,GAAuC,KAAKM,mBAAL,CAAyB/I,MAAzB,EAAiCwI,gBAAjC,CAAvC;CACA;;CAED,aAAOA,gBAAP;CACA;;;wCAEkBxI,QAAegJ,WAClC;CACC,aAAOhJ,MAAM,CAAC2C,MAAP,CAAc,UAAC/K,IAAD;CAAA,eAAUoR,SAAS,CAAC7I,cAAV,CAAyBvI,IAAI,CAACkL,IAA9B,CAAV;CAAA,OAAd,CAAP;CACA;;;wCAEkB9C,QAAeiJ,MAClC;CACC,aAAOjJ,MAAM,CAAC2C,MAAP,CAAc,UAAC/K,IAAD;CAAA,eAAUA,IAAI,CAACkL,IAAL,CAAUoG,KAAV,CAAgBD,IAAhB,CAAV;CAAA,OAAd,CAAP;CACA;;;yCAEmBjJ,QAAemJ,4BACnC;CACC,UAAIC,sBAAsB,GAAGC,MAAM,CAACC,MAAP,CAAcH,0BAAd,EAA0CI,MAA1C,CAC5B,UAACC,UAAD,EAAaC,aAAb,EACA;CACC,eAAOD,UAAU,CAACE,MAAX,CAAkBD,aAAa,CAACtP,GAAd,CAAkB,UAACvC,IAAD;CAAA,iBAAUA,IAAI,CAACkL,IAAf;CAAA,SAAlB,CAAlB,CAAP;CACA,OAJ2B,EAK5B,EAL4B,CAA7B;CAQA,aAAO9C,MAAM,CAAC2C,MAAP,CAAc,UAAA/K,IAAI;CAAA,eAAIwR,sBAAsB,CAACvG,OAAvB,CAA+BjL,IAAI,CAACkL,IAApC,IAA4C,CAAhD;CAAA,OAAlB,CAAP;CACA;;;mCAGD;CACC,aAAO,KAAKhD,OAAL,CAAaK,cAAb,CAA4B,UAA5B,IAA0C,KAAKL,OAAL,CAAa8G,QAAvD,GAAkE,EAAzE;CACA;;;wCAGD;CACC,UAAI5G,MAAM,GAAGqJ,MAAM,CAACM,MAAP,CAAc,EAAd,EAAkB,KAAK7J,OAAL,CAAawI,aAA/B,CAAb;CACA,UAAIsB,WAAW,GAAG,EAAlB;;CACA,UAAI,KAAK1J,IAAL,KAAcN,SAAlB,EACA;CACCgK,QAAAA,WAAW,GAAG,CACb,IADa,EAEb,QAFa,EAGb,WAHa,EAIb,aAJa,EAKb,aALa,EAMb,UANa,EAOb,aAPa,CAAd;CASA,OAXD,MAaA;CACCA,QAAAA,WAAW,GAAG,CACb,OADa,EAEb,OAFa,EAGb,KAHa,EAIb,IAJa,CAAd;CAMA;;CACDA,MAAAA,WAAW,CAAC3F,OAAZ,CAAqB,UAAA4F,SAAS;CAAA,eAAK7J,MAAM,CAAC6J,SAAD,CAAN,GAAoB,IAAzB;CAAA,OAA9B;CAEA,aAAO7J,MAAP;CACA;;;qCAEeI,gBAChB;CACC,UAAI,CAAC,KAAKN,OAAL,CAAaK,cAAb,CAA4B,UAA5B,CAAD,IAA4C,CAAClE,cAAI,CAAC6N,UAAL,CAAgB,KAAKhK,OAAL,CAAaiK,QAA7B,CAAjD,EACA;CACC;CACA;;CACD,UAAIC,eAAe,GAAG,EAAtB;CACA5J,MAAAA,cAAc,CAAC6D,OAAf,CACC,UAACrB,KAAD,EACA;CACCoH,QAAAA,eAAe,CAACpH,KAAK,CAACE,IAAP,CAAf,GACCF,KAAK,CAACgD,KAAN,GACGhD,KAAK,CAACgD,KADT,GAEG,EAHJ;CAKA,OARF;CAUA,WAAK9F,OAAL,CAAaiK,QAAb,CAAsBC,eAAtB;CACA;;;kCAEY7K,OACb;CACC,UAAM0K,SAAS,GAAG1K,KAAK,CAACoE,MAAN,CAAa6B,IAA/B;;CACA,UAAIjG,KAAK,CAACoE,MAAN,CAAa0G,OAAb,IAAwB,KAAK7J,cAAL,CAAoByC,OAApB,CAA4BgH,SAA5B,IAAyC,CAArE,EACA;CACC,aAAKzJ,cAAL,CAAoBhG,IAApB,CAAyByP,SAAzB;CACA;;CACD,UAAI,CAAC1K,KAAK,CAACoE,MAAN,CAAa0G,OAAd,IAAyB,KAAK7J,cAAL,CAAoByC,OAApB,CAA4BgH,SAA5B,KAA0C,CAAvE,EACA;CACC,aAAKzJ,cAAL,CAAoB8J,MAApB,CAA2B,KAAK9J,cAAL,CAAoByC,OAApB,CAA4BgH,SAA5B,CAA3B,EAAmE,CAAnE;CACA;CACD;;;;;;;;;;;;"}