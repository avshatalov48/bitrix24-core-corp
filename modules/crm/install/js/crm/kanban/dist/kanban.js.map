{"version":3,"file":"kanban.js","sources":["../src/pulloperation.js","../src/viewmode.js","../src/pullqueue.js","../src/pullmanager.js","../src/fieldsselector.js"],"sourcesContent":["import { Sorter } from \"crm.kanban.sort\";\n\nexport default class PullOperation\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\titemId: Number;\n\taction: String;\n\tactionParams: Object;\n\n\tstatic createInstance(data: Object): PullOperation\n\t{\n\t\tconst instance = new PullOperation(data.grid);\n\n\t\tinstance.setItemId(data.itemId);\n\t\tinstance.setAction(data.action);\n\t\tinstance.setActionParams(data.actionParams);\n\n\t\treturn instance;\n\t}\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.grid = grid;\n\t}\n\n\tsetItemId(itemId: Number): PullOperation\n\t{\n\t\tthis.itemId = itemId;\n\t\treturn this;\n\t}\n\n\tgetItemId(): Number\n\t{\n\t\treturn this.itemId;\n\t}\n\n\tsetAction(action: String): PullOperation\n\t{\n\t\tthis.action = action;\n\t\treturn this;\n\t}\n\n\tgetAction(): String\n\t{\n\t\treturn this.action;\n\t}\n\n\tsetActionParams(actionParams: Object): PullOperation\n\t{\n\t\tthis.actionParams = actionParams;\n\t\treturn this;\n\t}\n\n\tgetActionParams(): Object\n\t{\n\t\treturn this.actionParams;\n\t}\n\n\texecute(): void\n\t{\n\t\tif (this.getAction() === 'updateItem')\n\t\t{\n\t\t\treturn this.updateItem();\n\t\t}\n\n\t\tif (this.getAction() === 'addItem')\n\t\t{\n\t\t\treturn this.addItem();\n\t\t}\n\t}\n\n\tupdateItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst insertItemParams = {};\n\t\tif (paramsItem.data.lastActivity && paramsItem.data.lastActivity.timestamp !== item.data.lastActivity.timestamp)\n\t\t{\n\t\t\tinsertItemParams.canShowLastActivitySortTour = true;\n\t\t}\n\n\t\tconst oldPrice = parseFloat(item.data.price);\n\t\tconst oldColumnId = item.columnId;\n\n\t\tfor (let key in paramsItem.data)\n\t\t{\n\t\t\tif (key in item.data)\n\t\t\t{\n\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t}\n\t\t}\n\n\t\titem.rawData = paramsItem.rawData;\n\t\titem.setActivityExistInnerHtml();\n\t\titem.useAnimation = true;\n\t\titem.setChangedInPullRequest();\n\n\t\tthis.grid.resetMultiSelectMode();\n\n\t\tconst newColumnId = paramsItem.data.columnId;\n\t\tconst newColumn = this.grid.getColumn(newColumnId);\n\t\tconst newPrice = parseFloat(paramsItem.data.price);\n\n\t\tinsertItemParams.newColumnId = newColumnId;\n\t\tthis.grid.insertItem(item, insertItemParams);\n\n\t\titem.columnId = newColumnId;\n\n\t\tif (!this.grid.getTypeInfoParam('showTotalPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (oldColumnId !== newColumnId)\n\t\t{\n\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\toldColumn.decPrice(oldPrice);\n\t\t\toldColumn.renderSubTitle();\n\t\t\tif (newColumn)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (oldPrice < newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t\telse if (oldPrice > newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t}\n\n\taddItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\tif (!column)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sorter = Sorter.createWithCurrentSortType(column.getItems());\n\n\t\tconst beforeItem = sorter.calcBeforeItemByParams(params.item.data.sort);\n\t\tif (beforeItem)\n\t\t{\n\t\t\tparams.item.targetId = beforeItem.getId();\n\t\t}\n\n\t\tthis.grid.addItem(params.item);\n\t}\n}\n","const ViewMode = {\n\tMODE_STAGES: 'STAGES',\n\tMODE_ACTIVITIES: 'ACTIVITIES',\n\n\tgetDefault(): string\n\t{\n\t\treturn this.MODE_STAGES;\n\t},\n\n\tgetAll(): string[]\n\t{\n\t\treturn [\n\t\t\tthis.MODE_STAGES,\n\t\t\tthis.MODE_ACTIVITIES,\n\t\t];\n\t},\n\n\tnormalize(mode: string): string\n\t{\n\t\treturn this.getAll().includes(mode) ? mode : this.getDefault();\n\t},\n};\n\nObject.freeze(ViewMode);\n\nexport {\n\tViewMode,\n};\n","import PullOperation from \"./pulloperation\";\nimport {ViewMode} from \"./viewmode\";\n\n/**\n * @class PullQueue\n */\n\nconst LOAD_ITEMS_DELAY = 5000;\n\nexport default class PullQueue\n{\n\t#queue: Map<number>;\n\t#grid: BX.CRM.Kanban.Grid;\n\t#viewMode: string;\n\t#isProgress: boolean;\n\t#isFreeze: boolean;\n\tloadItemsTimer;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#viewMode = ViewMode.normalize(this.#grid.getData().viewMode);\n\t\tthis.#queue = new Map();\n\t\tthis.#isProgress = false;\n\t\tthis.#isFreeze = false;\n\t\tthis.loadItemsTimer = null;\n\t}\n\n\tloadItem(ignoreProgressStatus: boolean = false, ignoreDelay: boolean = false): void\n\t{\n\t\tif (this.loadItemsTimer && !ignoreDelay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadItemsTimer = setTimeout(\n\t\t\t() => {\n\t\t\t\tif (this.#isProgress && !ignoreProgressStatus)\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.hidden || this.isOverflow() || this.isFreezed())\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst items = this.popAllAsArray();\n\t\t\t\tif (items.length)\n\t\t\t\t{\n\t\t\t\t\tconst ids = [];\n\t\t\t\t\titems.map(item => {\n\t\t\t\t\t\tids.push(item.id);\n\t\t\t\t\t\tconst data = item.data;\n\t\t\t\t\t\tconst operation = PullOperation.createInstance({\n\t\t\t\t\t\t\tgrid: this.#grid,\n\t\t\t\t\t\t\titemId: data.id,\n\t\t\t\t\t\t\taction: data.action,\n\t\t\t\t\t\t\tactionParams: data.actionParams,\n\t\t\t\t\t\t});\n\t\t\t\t\t\toperation.execute();\n\t\t\t\t\t});\n\n\t\t\t\t\tconst loadNextOnSuccess = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t\tif (this.peek())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.loadItem(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#isProgress = false;\n\t\t\t\t\t};\n\t\t\t\t\tconst doNothingOnError = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#isProgress = true;\n\t\t\t\t\tthis.\n\t\t\t\t\t\t#grid\n\t\t\t\t\t\t.loadNew(ids, false, true, true)\n\t\t\t\t\t\t.then(loadNextOnSuccess, doNothingOnError)\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t},\n\t\t\tignoreDelay ? 0 : LOAD_ITEMS_DELAY\n\t\t);\n\t}\n\n\tpush(id: number, item: string): PullQueue\n\t{\n\t\tid = parseInt(id, 10);\n\t\tif (this.has(id))\n\t\t{\n\t\t\tthis.delete(id);\n\t\t}\n\n\t\tthis.#queue.set(id, item);\n\t\treturn this;\n\t}\n\n\tpopAllAsArray()\n\t{\n\t\tconst items = Array.from(this.#queue, ([id, data]) => ({id, data}));\n\t\tthis.#queue.clear();\n\t\treturn items;\n\t}\n\n\tpopBatch(count: number)\n\t{\n\t\tif (count <= 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst results = [];\n\t\tfor (let i=0; i < count; i++)\n\t\t{\n\t\t\tconst item = this.pop();\n\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tresults.push(item);\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tpop(): number\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\tif (first.value)\n\t\t{\n\t\t\tthis.#queue.delete(first.value[0]);\n\t\t}\n\t\treturn first.value;\n\t}\n\n\tpeek(): number|null\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\treturn (first.value ?? null);\n\t}\n\n\tdelete(id: number): void\n\t{\n\t\tthis.#queue.delete(id);\n\t}\n\n\thas(id: number): boolean\n\t{\n\t\treturn this.#queue.has(id);\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#queue.clear();\n\t}\n\n\tisOverflow(): boolean\n\t{\n\t\tconst MAX_PENDING_ITEMS = 30;\n\t\treturn (this.#queue.size > MAX_PENDING_ITEMS);\n\t}\n\n\tfreeze(): void\n\t{\n\t\tthis.#isFreeze = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tthis.#isFreeze = false;\n\t}\n\n\tisFreezed(): boolean\n\t{\n\t\treturn this.#isFreeze;\n\t}\n}\n","import {Event, Type, Loc, Text} from 'main.core';\nimport PullQueue from \"./pullqueue\";\nimport {EventEmitter} from \"main.core.events\";\nimport {ViewMode} from \"./viewmode\";\n\nexport default class PullManager\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\tqueue: PullQueue;\n\tnotifier: BX.UI.Notification.Balloon;\n\topenedSlidersCount: Number;\n\n\tstatic eventIds = new Set();\n\n\tconstructor(grid)\n\t{\n\t\tthis.grid = grid;\n\t\tthis.queue = new PullQueue(this.grid);\n\t\tthis.openedSlidersCount = 0;\n\t\tif (Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.bindEvents();\n\t}\n\n\tstatic registerRandomEventId(): string\n\t{\n\t\tconst eventId = Text.getRandom(12);\n\t\tthis.registerEventId(eventId);\n\t\treturn eventId;\n\t}\n\n\tstatic registerEventId(eventId: string)\n\t{\n\t\tthis.eventIds.add(eventId);\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() => {\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif (!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst gridData = this.grid.getData();\n\t\t\tconst { pullTag, eventKanbanUpdatedTag, viewMode } = gridData;\n\n\t\t\tPull.subscribe({\n\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t//command: this.grid.getData().pullTag,\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command !== pullTag\n\t\t\t\t\t\t&& !(data.command.indexOf(eventKanbanUpdatedTag) === 0 && viewMode === ViewMode.MODE_ACTIVITIES)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { params } = data;\n\n\t\t\t\t\tif (Type.isString(params.eventName))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(PullManager.eventIds.has(params.eventId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(this.queue.isOverflow())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (params.eventName === 'ITEMUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\n\t\t\tEvent.bind(document, 'visibilitychange', () => {\n\t\t\t\tif (!document.hidden)\n\t\t\t\t{\n\t\t\t\t\tthis.onTabActivated();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tif (this.updateItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem(false, params.ignoreDelay || false);\n\t\t}\n\t}\n\n\tupdateItem(params)\n\t{\n\t\tconst item = this.grid.getItem(params.item.id);\n\n\t\tif (item)\n\t\t{\n\t\t\tthis.queue.push(item.id, {\n\t\t\t\tid: item.id,\n\t\t\t\taction: 'updateItem',\n\t\t\t\tactionParams: params,\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.onPullItemAdded(params);\n\t\treturn false\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tif (this.addItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem(false, params.ignoreDelay || false);\n\t\t}\n\t}\n\n\taddItem(params)\n\t{\n\t\tconst itemId = params.item.id;\n\t\tconst oldItem = this.grid.getItem(itemId);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.queue.push(itemId, {\n\t\t\tid: itemId,\n\t\t\taction: 'addItem',\n\t\t\tactionParams: params,\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonPullItemDeleted(params)\n\t{\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (this.queue.has(params.item.id) ? 5000 : 0);\n\n\t\tsetTimeout(function() {\n\t\t\tthis.queue.delete(params.item.id);\n\t\t\tthis.grid.removeItem(params.item.id);\n\n\t\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\t\tcolumn.decPrice(params.item.data.price);\n\t\t\tcolumn.renderSubTitle();\n\t\t}.bind(this), delay);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonTabActivated()\n\t{\n\t\tif (this.queue.isOverflow())\n\t\t{\n\t\t\tthis.showOutdatedDataDialog();\n\t\t}\n\t\telse if (this.queue.peek())\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tshowOutdatedDataDialog()\n\t{\n\t\tif (!this.notifier)\n\t\t{\n\t\t\tthis.notifier = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_NOTIFY_OUTDATED_DATA'),\n\t\t\t\tcloseButton: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_GRID_RELOAD'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t\tthis.queue.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifier.show();\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', (event) => {\n\t\t\tthis.openedSlidersCount++;\n\t\t\tthis.queue.freeze();\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\tthis.openedSlidersCount--;\n\t\t\tif (this.openedSlidersCount <= 0)\n\t\t\t{\n\t\t\t\tthis.openedSlidersCount = 0;\n\t\t\t\tthis.queue.unfreeze();\n\t\t\t\tthis.onTabActivated();\n\t\t\t}\n\t\t});\n\t}\n}\n","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Event, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\theadersSections: Object,\n\tdefaultHeaderSectionId: ?string,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.fieldsPopupItems = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\n\t\tthis.enableHeadersSections = Boolean(this.options.headersSections);\n\t\tthis.headersSections = (this.options.headersSections ?? {});\n\t\tthis.defaultHeaderSectionId = (this.options.defaultHeaderSectionId ?? null);\n\n\t\tthis.fieldVisibleClass = 'crm-kanban-popup-field-search-list-item-visible';\n\t\tthis.fieldHiddenClass = 'crm-kanban-popup-field-search-list-item-hidden';\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: BX.message('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => (this.popup = null)\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tconst headerWrapper = Tag.render`\n\t\t\t<div class=\"crm-kanban-popup-field-search-header-wrapper\">\n\t\t\t\t<div class=\"ui-form-row-inline\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tcontainer.prepend(headerWrapper);\n\n\t\tthis.preparePopupContentHeaderSections(headerWrapper);\n\t\tthis.preparePopupContentHeaderSearch(headerWrapper);\n\n\t\tthis.getSections().map(section => {\n\t\t\tconst sectionWrapperId = this.getSectionWrapperNameBySectionName(section.name);\n\t\t\tconst sectionWrapper = Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"crm-kanban-popup-field-search-section\" \n\t\t\t\t\tdata-crm-kanban-popup-field-search-section=\"${sectionWrapperId}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(sectionWrapper, container);\n\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tpreparePopupContentHeaderSections(headerWrapper: HTMLElement): void\n\t{\n\t\tif (!this.enableHeadersSections)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerSectionsWrapper = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-section-wrapper\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(headerSectionsWrapper);\n\n\t\tconst headersSections = this.getHeadersSections();\n\n\t\tfor (let key in headersSections)\n\t\t{\n\t\t\tconst itemClass = 'crm-kanban-popup-field-search-section-item-icon'\n\t\t\t\t+ (headersSections[key].selected ? ` crm-kanban-popup-field-search-section-item-icon-active` : '');\n\n\t\t\tconst headerSectionItem = Tag.render`\n\t\t\t\t<div class=\"crm-kanban-popup-field-search-section-item\" data-kanban-popup-filter-section-button=\"${key}\">\n\t\t\t\t\t<div class=\"${itemClass}\">\n\t\t\t\t\t\t${Text.encode(headersSections[key].name)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\theaderSectionsWrapper.firstElementChild.appendChild(headerSectionItem);\n\n\t\t\tif (this.type !== TYPE_VIEW)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tEvent.bind(headerSectionItem, 'click', this.onFilterSectionClick.bind(this, headerSectionItem));\n\t\t}\n\t}\n\n\tonFilterSectionClick(item: HTMLElement): void\n\t{\n\t\tconst activeClass = 'crm-kanban-popup-field-search-section-item-icon-active';\n\t\tconst sectionId = item.dataset.kanbanPopupFilterSectionButton;\n\t\tconst sections = document.querySelectorAll(\n\t\t\t`[data-crm-kanban-popup-field-search-section=\"${sectionId}\"]`\n\t\t);\n\t\tif (Dom.hasClass(item.firstElementChild, activeClass))\n\t\t{\n\t\t\tDom.removeClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'show');\n\t\t}\n\t}\n\n\tfilterSectionsToggle(sections: NodeList, action: string): void\n\t{\n\t\tArray.from(sections).map(section => {\n\t\t\t(action === 'show' ? Dom.show(section) : Dom.hide(section));\n\t\t});\n\t}\n\n\tpreparePopupContentHeaderSearch(headerWrapper: HTMLElement): void\n\t{\n\t\tconst searchForm = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-input-wrapper\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\"></button>\n\t\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element crm-kanban-popup-field-search-section-input\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(searchForm);\n\t\tconst inputs = searchForm.getElementsByClassName('crm-kanban-popup-field-search-section-input');\n\t\tif (inputs.length)\n\t\t{\n\t\t\tconst input = inputs[0];\n\t\t\tEvent.bind(input, 'input', this.onFilterSectionSearchInput.bind(this, input));\n\t\t\tEvent.bind(input.previousElementSibling, 'click', this.onFilterSectionSearchInputClear.bind(this, input));\n\t\t}\n\t}\n\n\tonFilterSectionSearchInput(input: HTMLElement): void\n\t{\n\t\tlet search = input.value;\n\t\tif (search.length)\n\t\t{\n\t\t\tsearch = search.toLowerCase();\n\t\t}\n\n\t\tthis.getFieldsPopupItems().map(item => {\n\t\t\tconst title = item.innerText.toLowerCase();\n\n\t\t\tif (search.length && title.indexOf(search) === -1)\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldVisibleClass);\n\t\t\t\tDom.addClass(item, this.fieldHiddenClass);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldHiddenClass);\n\t\t\t\tDom.addClass(item, this.fieldVisibleClass);\n\t\t\t\titem.style.display = 'block';\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFieldsPopupItems(): ?HTMLElement[]\n\t{\n\t\tif (!Type.isArray(this.fieldsPopupItems))\n\t\t{\n\t\t\tthis.fieldsPopupItems = Array.from(\n\t\t\t\tthis.popup.getPopupContainer().querySelectorAll('.crm-kanban-popup-field-item')\n\t\t\t);\n\t\t\tthis.prepareAnimation();\n\t\t}\n\n\t\treturn this.fieldsPopupItems;\n\t}\n\n\tprepareAnimation(): void\n\t{\n\t\tthis.fieldsPopupItems.map(item => {\n\t\t\tEvent.bind(item, 'animationend', this.onAnimationEnd.bind(this, item));\n\t\t});\n\t}\n\n\tonAnimationEnd(item: HTMLElement): void\n\t{\n\t\titem.style.display = (\n\t\t\tDom.hasClass(item, this.fieldHiddenClass)\n\t\t\t\t? 'none'\n\t\t\t\t: 'block'\n\t\t);\n\t}\n\n\tonFilterSectionSearchInputClear(input: HTMLElement): void\n\t{\n\t\tif (input.value.length)\n\t\t{\n\t\t\tinput.value = '';\n\t\t\tthis.onFilterSectionSearchInput(input);\n\t\t}\n\t}\n\n\tgetSectionWrapperNameBySectionName(name: string): ?string\n\t{\n\t\tconst headerSections = this.getHeadersSections();\n\t\tfor (let id in headerSections)\n\t\t{\n\t\t\tif (this.headersSections[id].sections && this.headersSections[id].sections.includes(name))\n\t\t\t{\n\t\t\t\treturn this.headersSections[id].id;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.headersSections[this.defaultHeaderSectionId] && this.defaultHeaderSectionId)\n\t\t\t\t? this.headersSections[this.defaultHeaderSectionId].id\n\t\t\t\t: null\n\t\t);\n\t}\n\n\tgetHeadersSections(): Object\n\t{\n\t\treturn (this.headersSections ?? {});\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'CLOSEDATE',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n"],"names":["PullOperation","data","instance","grid","setItemId","itemId","setAction","action","setActionParams","actionParams","getAction","updateItem","addItem","params","getActionParams","item","getItem","id","paramsItem","insertItemParams","lastActivity","timestamp","canShowLastActivitySortTour","oldPrice","parseFloat","price","oldColumnId","columnId","key","rawData","setActivityExistInnerHtml","useAnimation","setChangedInPullRequest","resetMultiSelectMode","newColumnId","newColumn","getColumn","newPrice","insertItem","getTypeInfoParam","oldColumn","decPrice","renderSubTitle","incPrice","oldItem","column","sorter","Sorter","createWithCurrentSortType","getItems","beforeItem","calcBeforeItemByParams","sort","targetId","getId","ViewMode","MODE_STAGES","MODE_ACTIVITIES","getDefault","getAll","normalize","mode","includes","Object","freeze","LOAD_ITEMS_DELAY","PullQueue","getData","viewMode","Map","loadItemsTimer","ignoreProgressStatus","ignoreDelay","setTimeout","document","hidden","isOverflow","isFreezed","items","popAllAsArray","length","ids","map","push","operation","createInstance","execute","loadNextOnSuccess","peek","loadItem","doNothingOnError","loadNew","then","parseInt","has","set","Array","from","clear","count","results","i","pop","entries","first","next","value","MAX_PENDING_ITEMS","size","PullManager","queue","openedSlidersCount","Type","isString","moduleId","userId","init","bindEvents","Event","ready","Pull","BX","PULL","console","error","gridData","pullTag","eventKanbanUpdatedTag","subscribe","callback","command","indexOf","eventName","eventIds","eventId","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","onPullStageAdded","onPullStageDeleted","onPullStageUpdated","extendWatch","bind","onTabActivated","isPlainObject","delay","removeItem","onApplyFilter","removeColumn","stage","showOutdatedDataDialog","notifier","UI","Notification","Center","notify","content","Loc","getMessage","closeButton","autoHide","actions","title","events","click","event","balloon","close","reload","show","EventEmitter","unfreeze","Text","getRandom","registerEventId","add","Set","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","fieldsPopupItems","type","hasOwnProperty","selectedFields","slice","enableHeadersSections","Boolean","headersSections","defaultHeaderSectionId","fieldVisibleClass","fieldHiddenClass","createPopup","setContent","getFieldsLayout","loadPopupContent","PopupManager","create","className","titleBar","message","toUpperCase","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","filter","field","NAME","executeCallback","autoHideDelay","CancelButton","loaderContainer","Tag","render","loader","Loader","target","ajax","runComponentAction","entityType","entityTypeName","viewType","response","destroy","getButtons","forEach","button","setDisabled","adjustPosition","Kanban","Utils","showErrorDialog","errors","sectionsWithFields","distributeFieldsBySections","container","headerWrapper","prepend","preparePopupContentHeaderSections","preparePopupContentHeaderSearch","getSections","section","sectionWrapperId","getSectionWrapperNameBySectionName","name","sectionWrapper","Dom","append","sectionName","encode","label","LABEL","encodedLabel","ID","onFieldClick","headerSectionsWrapper","firstElementChild","appendChild","getHeadersSections","itemClass","selected","headerSectionItem","onFilterSectionClick","activeClass","sectionId","dataset","kanbanPopupFilterSectionButton","sections","querySelectorAll","hasClass","removeClass","filterSectionsToggle","addClass","hide","searchForm","inputs","getElementsByClassName","input","onFilterSectionSearchInput","previousElementSibling","onFilterSectionSearchInputClear","search","toLowerCase","getFieldsPopupItems","innerText","style","display","isArray","getPopupContainer","prepareAnimation","onAnimationEnd","headerSections","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","elements","filterFieldsByList","filterFieldsByRule","RegExp","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","values","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","checked","splice"],"mappings":"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"}