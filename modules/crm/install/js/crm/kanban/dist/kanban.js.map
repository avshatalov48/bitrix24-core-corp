{"version":3,"file":"kanban.js","sources":["../src/pullqueue.js","../src/pullmanager.js","../src/fieldsselector.js"],"sourcesContent":["export default class PullQueue\n{\n\t#queue: Set<number>;\n\t#grid: BX.CRM.Kanban.Grid;\n\t#isProgress: boolean;\n\t#isFreeze: boolean;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#queue = new Set();\n\t\tthis.#isProgress = false;\n\t\tthis.#isFreeze = false;\n\t}\n\n\tloadItem(isForce: boolean): void\n\t{\n\t\tsetTimeout(\n\t\t\t() => {\n\t\t\t\tisForce = (isForce || false);\n\t\t\t\tif (this.#isProgress && !isForce)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.hidden || this.isOverflow() || this.isFreezed())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst id = this.pop();\n\t\t\t\tif (id)\n\t\t\t\t{\n\t\t\t\t\tconst loadNextOnSuccess = (response) => {\n\t\t\t\t\t\tif (this.peek())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.loadItem(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#isProgress = false;\n\t\t\t\t\t};\n\t\t\t\t\tconst doNothingOnError = (err) => {};\n\n\t\t\t\t\tthis.#isProgress = true;\n\t\t\t\t\tthis.#grid.loadNew(id, false, true, true).then(loadNextOnSuccess, doNothingOnError);\n\t\t\t\t}\n\t\t\t},\n\t\t\t1000\n\t\t);\n\t}\n\n\tpush(id: number): PullQueue\n\t{\n\t\tid = parseInt(id, 10);\n\t\tif (this.#queue.has(id))\n\t\t{\n\t\t\tthis.#queue.delete(id);\n\t\t}\n\n\t\tthis.#queue.add(id);\n\t\treturn this;\n\t}\n\n\tpop(): number\n\t{\n\t\tconst values = this.#queue.values();\n\t\tconst first = values.next();\n\t\tif (first.value !== undefined)\n\t\t{\n\t\t\tthis.#queue.delete(first.value);\n\t\t}\n\t\treturn first.value;\n\t}\n\n\tpeek(): number|null\n\t{\n\t\tconst values = this.#queue.values();\n\t\tconst first = values.next();\n\t\treturn (first.value !== undefined ? first.value : null);\n\t}\n\n\tdelete(id: number): void\n\t{\n\t\tthis.#queue.delete(id);\n\t}\n\n\thas(id: number): boolean\n\t{\n\t\treturn this.#queue.has(id);\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#queue.clear();\n\t}\n\n\tisOverflow(): boolean\n\t{\n\t\tconst MAX_PENDING_ITEMS = 10;\n\t\treturn (this.#queue.size > MAX_PENDING_ITEMS);\n\t}\n\n\tfreeze(): void\n\t{\n\t\tthis.#isFreeze = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tthis.#isFreeze = false;\n\t}\n\n\tisFreezed(): boolean\n\t{\n\t\treturn this.#isFreeze;\n\t}\n}\n","import {Event, Type, Loc} from 'main.core';\nimport PullQueue from \"./pullqueue\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport default class PullManager\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\tqueue: PullQueue;\n\tnotifier: BX.UI.Notification.Balloon;\n\n\tconstructor(grid)\n\t{\n\t\tthis.grid = grid;\n\t\tthis.queue = new PullQueue(this.grid);\n\t\tif (Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.bindEvents();\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif (!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tPull.subscribe({\n\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\tcommand: this.grid.getData().pullTag,\n\t\t\t\tcallback: (params) =>\n\t\t\t\t{\n\t\t\t\t\tif (Type.isString(params.eventName))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(this.queue.isOverflow())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (params.eventName === 'ITEMUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\n\t\t\tEvent.bind(document, 'visibilitychange', () => {\n\t\t\t\tif (!document.hidden)\n\t\t\t\t{\n\t\t\t\t\tthis.onTabActivated();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tif (this.updateItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tupdateItem(params)\n\t{\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (item)\n\t\t{\n\t\t\tconst oldPrice = parseFloat(item.data.price);\n\t\t\tconst oldColumnId = item.data.columnId;\n\n\t\t\tfor (let key in paramsItem.data)\n\t\t\t{\n\t\t\t\tif (key in item.data)\n\t\t\t\t{\n\t\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titem.rawData = paramsItem.rawData;\n\t\t\titem.setActivityExistInnerHtml();\n\t\t\titem.useAnimation = true;\n\t\t\titem.setChangedInPullRequest();\n\t\t\tthis.grid.resetMultiSelectMode();\n\n\t\t\tthis.grid.insertItem(item);\n\n\t\t\tconst newColumn = this.grid.getColumn(paramsItem.data.columnId);\n\t\t\tconst newPrice = parseFloat(paramsItem.data.price);\n\n\t\t\tif (oldColumnId !== paramsItem.data.columnId)\n\t\t\t{\n\t\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\t\toldColumn.decPrice(oldPrice);\n\t\t\t\toldColumn.renderSubTitle();\n\n\t\t\t\tnewColumn.incPrice(newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (oldPrice < newPrice)\n\t\t\t\t{\n\t\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t\t}\n\t\t\t\telse if (oldPrice > newPrice)\n\t\t\t\t{\n\t\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titem.columnId = paramsItem.data.columnId;\n\t\t\tthis.queue.push(item.id);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.onPullItemAdded(params);\n\t\treturn false\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tthis.addItem(params);\n\t\tthis.queue.loadItem();\n\t}\n\n\taddItem(params)\n\t{\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.addItemTop(params.item);\n\t\tthis.queue.push(params.item.id);\n\t}\n\n\tonPullItemDeleted(params)\n\t{\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (this.queue.has(params.item.id) ? 5000 : 0);\n\n\t\tsetTimeout(function() {\n\t\t\tthis.queue.delete(params.item.id);\n\t\t\tthis.grid.removeItem(params.item.id);\n\n\t\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\t\tcolumn.decPrice(params.item.data.price);\n\t\t\tcolumn.renderSubTitle();\n\t\t}.bind(this), delay);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonTabActivated()\n\t{\n\t\tif (this.queue.isOverflow())\n\t\t{\n\t\t\tthis.showOutdatedDataDialog();\n\t\t}\n\t\telse if (this.queue.peek())\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tshowOutdatedDataDialog()\n\t{\n\t\tif (!this.notifier)\n\t\t{\n\t\t\tthis.notifier = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_NOTIFY_OUTDATED_DATA'),\n\t\t\t\tcloseButton: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_GRID_RELOAD'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t\tthis.queue.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifier.show();\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', (event) => {\n\t\t\tif (this.isEntitySlider(event.data[0].slider))\n\t\t\t{\n\t\t\t\tthis.queue.freeze();\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (this.isEntitySlider(event.data[0].slider))\n\t\t\t{\n\t\t\t\tthis.queue.unfreeze();\n\t\t\t\tthis.onTabActivated();\n\t\t\t}\n\t\t});\n\t}\n\n\tisEntitySlider(slider): boolean\n\t{\n\t\tconst sliderUrl = slider.getUrl();\n\t\tconst entityPath = this.grid.getData().entityPath;\n\t\tconst maskUrl = entityPath.replace(/\\#([^\\#]+)\\#/, '([\\\\d]+)');\n\n\t\treturn (new RegExp(maskUrl)).test(sliderUrl);\n\t}\n}\n","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: BX.message('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => (this.popup = null)\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tthis.getSections().forEach((section) =>\n\t\t{\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tcontainer\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tcontainer\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'CLOSEDATE',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n"],"names":["PullQueue","grid","Set","isForce","setTimeout","document","hidden","isOverflow","isFreezed","id","pop","loadNextOnSuccess","response","peek","loadItem","doNothingOnError","err","loadNew","then","parseInt","has","delete","add","values","first","next","value","undefined","clear","MAX_PENDING_ITEMS","size","PullManager","queue","Type","isString","getData","moduleId","userId","init","bindEvents","Event","ready","Pull","BX","PULL","console","error","subscribe","command","pullTag","callback","params","eventName","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","onPullStageAdded","onPullStageDeleted","onPullStageUpdated","extendWatch","bind","onTabActivated","updateItem","item","getItem","paramsItem","oldPrice","parseFloat","data","price","oldColumnId","columnId","key","rawData","setActivityExistInnerHtml","useAnimation","setChangedInPullRequest","resetMultiSelectMode","insertItem","newColumn","getColumn","newPrice","oldColumn","decPrice","renderSubTitle","incPrice","push","addItem","oldItem","addItemTop","isPlainObject","delay","removeItem","column","onApplyFilter","removeColumn","stage","showOutdatedDataDialog","notifier","UI","Notification","Center","notify","content","Loc","getMessage","closeButton","autoHide","actions","title","events","click","event","balloon","action","close","reload","show","EventEmitter","isEntitySlider","slider","freeze","unfreeze","sliderUrl","getUrl","entityPath","maskUrl","replace","RegExp","test","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","type","hasOwnProperty","selectedFields","slice","createPopup","setContent","getFieldsLayout","loadPopupContent","PopupManager","create","className","titleBar","message","toUpperCase","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","filter","field","indexOf","NAME","length","executeCallback","autoHideDelay","CancelButton","loaderContainer","Tag","render","loader","Loader","target","ajax","runComponentAction","mode","entityType","entityTypeName","viewType","destroy","getButtons","forEach","button","setDisabled","adjustPosition","catch","Kanban","Utils","showErrorDialog","errors","sectionsWithFields","distributeFieldsBySections","container","getSections","section","sectionName","name","Dom","append","Text","encode","map","label","LABEL","encodedLabel","ID","onFieldClick","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","sections","i","elements","filterFieldsByList","filterFieldsByRule","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","Object","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","checked","splice"],"mappings":"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"}