{"version":3,"file":"kanban.js","sources":["../src/pulloperation.js","../src/viewmode.js","../src/pullqueue.js","../src/pullmanager.js","../src/fieldsselector.js"],"sourcesContent":["import { Sorter } from \"crm.kanban.sort\";\n\nexport default class PullOperation\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\titemId: Number;\n\taction: String;\n\tactionParams: Object;\n\n\tstatic createInstance(data: Object): PullOperation\n\t{\n\t\tconst instance = new PullOperation(data.grid);\n\n\t\tinstance.setItemId(data.itemId);\n\t\tinstance.setAction(data.action);\n\t\tinstance.setActionParams(data.actionParams);\n\n\t\treturn instance;\n\t}\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.grid = grid;\n\t}\n\n\tsetItemId(itemId: Number): PullOperation\n\t{\n\t\tthis.itemId = itemId;\n\t\treturn this;\n\t}\n\n\tgetItemId(): Number\n\t{\n\t\treturn this.itemId;\n\t}\n\n\tsetAction(action: String): PullOperation\n\t{\n\t\tthis.action = action;\n\t\treturn this;\n\t}\n\n\tgetAction(): String\n\t{\n\t\treturn this.action;\n\t}\n\n\tsetActionParams(actionParams: Object): PullOperation\n\t{\n\t\tthis.actionParams = actionParams;\n\t\treturn this;\n\t}\n\n\tgetActionParams(): Object\n\t{\n\t\treturn this.actionParams;\n\t}\n\n\texecute(): void\n\t{\n\t\tif (this.getAction() === 'updateItem')\n\t\t{\n\t\t\treturn this.updateItem();\n\t\t}\n\n\t\tif (this.getAction() === 'addItem')\n\t\t{\n\t\t\treturn this.addItem();\n\t\t}\n\t}\n\n\tupdateItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst insertItemParams = {};\n\t\tif (paramsItem.data.lastActivity && paramsItem.data.lastActivity.timestamp !== item.data.lastActivity.timestamp)\n\t\t{\n\t\t\tinsertItemParams.canShowLastActivitySortTour = true;\n\t\t}\n\n\t\tconst oldPrice = parseFloat(item.data.price);\n\t\tconst oldColumnId = item.columnId;\n\n\t\tfor (let key in paramsItem.data)\n\t\t{\n\t\t\tif (key in item.data)\n\t\t\t{\n\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t}\n\t\t}\n\n\t\titem.rawData = paramsItem.rawData;\n\t\titem.setActivityExistInnerHtml();\n\t\titem.useAnimation = true;\n\t\titem.setChangedInPullRequest();\n\n\t\tthis.grid.resetMultiSelectMode();\n\n\t\tconst newColumnId = paramsItem.data.columnId;\n\t\tconst newColumn = this.grid.getColumn(newColumnId);\n\t\tconst newPrice = parseFloat(paramsItem.data.price);\n\n\t\tinsertItemParams.newColumnId = newColumnId;\n\t\tthis.grid.insertItem(item, insertItemParams);\n\n\t\titem.columnId = newColumnId;\n\n\t\tif (!this.grid.getTypeInfoParam('showTotalPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (oldColumnId !== newColumnId)\n\t\t{\n\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\toldColumn.decPrice(oldPrice);\n\t\t\toldColumn.renderSubTitle();\n\t\t\tif (newColumn)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (oldPrice < newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t\telse if (oldPrice > newPrice)\n\t\t\t{\n\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t}\n\t\t}\n\t}\n\n\taddItem(): void\n\t{\n\t\tconst params = this.getActionParams();\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\tif (!column)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sorter = Sorter.createWithCurrentSortType(column.getItems());\n\n\t\tconst beforeItem = sorter.calcBeforeItemByParams(params.item.data.sort);\n\t\tif (beforeItem)\n\t\t{\n\t\t\tparams.item.targetId = beforeItem.getId();\n\t\t}\n\n\t\tthis.grid.addItem(params.item);\n\t}\n}\n","const ViewMode = {\n\tMODE_STAGES: 'STAGES',\n\tMODE_ACTIVITIES: 'ACTIVITIES',\n\n\tgetDefault(): string\n\t{\n\t\treturn this.MODE_STAGES;\n\t},\n\n\tgetAll(): string[]\n\t{\n\t\treturn [\n\t\t\tthis.MODE_STAGES,\n\t\t\tthis.MODE_ACTIVITIES,\n\t\t];\n\t},\n\n\tnormalize(mode: string): string\n\t{\n\t\treturn this.getAll().includes(mode) ? mode : this.getDefault();\n\t},\n};\n\nObject.freeze(ViewMode);\n\nexport {\n\tViewMode,\n};\n","import PullOperation from \"./pulloperation\";\nimport {ViewMode} from \"./viewmode\";\n\n/**\n * @class PullQueue\n */\n\nconst LOAD_ITEMS_DELAY = 5000;\n\nexport default class PullQueue\n{\n\t#queue: Map<number>;\n\t#grid: BX.CRM.Kanban.Grid;\n\t#viewMode: string;\n\t#isProgress: boolean;\n\t#isFreeze: boolean;\n\tloadItemsTimer;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#viewMode = ViewMode.normalize(this.#grid.getData().viewMode);\n\t\tthis.#queue = new Map();\n\t\tthis.#isProgress = false;\n\t\tthis.#isFreeze = false;\n\t\tthis.loadItemsTimer = null;\n\t}\n\n\tloadItem(ignoreProgressStatus: boolean = false, ignoreDelay: boolean = false): void\n\t{\n\t\tif (this.loadItemsTimer && !ignoreDelay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadItemsTimer = setTimeout(\n\t\t\t() => {\n\t\t\t\tif (this.#isProgress && !ignoreProgressStatus)\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.hidden || this.isOverflow() || this.isFreezed())\n\t\t\t\t{\n\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst items = this.popAllAsArray();\n\t\t\t\tif (items.length)\n\t\t\t\t{\n\t\t\t\t\tconst ids = [];\n\t\t\t\t\titems.map(item => {\n\t\t\t\t\t\tids.push(item.id);\n\t\t\t\t\t\tconst data = item.data;\n\t\t\t\t\t\tconst operation = PullOperation.createInstance({\n\t\t\t\t\t\t\tgrid: this.#grid,\n\t\t\t\t\t\t\titemId: data.id,\n\t\t\t\t\t\t\taction: data.action,\n\t\t\t\t\t\t\tactionParams: data.actionParams,\n\t\t\t\t\t\t});\n\t\t\t\t\t\toperation.execute();\n\t\t\t\t\t});\n\n\t\t\t\t\tconst loadNextOnSuccess = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t\tif (this.peek())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.loadItem(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#isProgress = false;\n\t\t\t\t\t};\n\t\t\t\t\tconst doNothingOnError = () => {\n\t\t\t\t\t\tthis.loadItemsTimer = null;\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#isProgress = true;\n\t\t\t\t\tthis.\n\t\t\t\t\t\t#grid\n\t\t\t\t\t\t.loadNew(ids, false, true, true, true)\n\t\t\t\t\t\t.then(loadNextOnSuccess, doNothingOnError)\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t},\n\t\t\tignoreDelay ? 0 : LOAD_ITEMS_DELAY\n\t\t);\n\t}\n\n\tpush(id: number, item: string): PullQueue\n\t{\n\t\tid = parseInt(id, 10);\n\t\tif (this.has(id))\n\t\t{\n\t\t\tthis.delete(id);\n\t\t}\n\n\t\tthis.#queue.set(id, item);\n\t\treturn this;\n\t}\n\n\tpopAllAsArray()\n\t{\n\t\tconst items = Array.from(this.#queue, ([id, data]) => ({id, data}));\n\t\tthis.#queue.clear();\n\t\treturn items;\n\t}\n\n\tpopBatch(count: number)\n\t{\n\t\tif (count <= 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst results = [];\n\t\tfor (let i=0; i < count; i++)\n\t\t{\n\t\t\tconst item = this.pop();\n\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tresults.push(item);\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tpop(): number\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\tif (first.value)\n\t\t{\n\t\t\tthis.#queue.delete(first.value[0]);\n\t\t}\n\t\treturn first.value;\n\t}\n\n\tpeek(): number|null\n\t{\n\t\tconst items = this.#queue.entries();\n\t\tconst first = items.next();\n\t\treturn (first.value ?? null);\n\t}\n\n\tdelete(id: number): void\n\t{\n\t\tthis.#queue.delete(id);\n\t}\n\n\thas(id: number): boolean\n\t{\n\t\treturn this.#queue.has(id);\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#queue.clear();\n\t}\n\n\tisOverflow(): boolean\n\t{\n\t\tconst MAX_PENDING_ITEMS = 30;\n\t\treturn (this.#queue.size > MAX_PENDING_ITEMS);\n\t}\n\n\tfreeze(): void\n\t{\n\t\tthis.#isFreeze = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tthis.#isFreeze = false;\n\t}\n\n\tisFreezed(): boolean\n\t{\n\t\treturn this.#isFreeze;\n\t}\n}\n","import {Event, Type, Loc, Text} from 'main.core';\nimport PullQueue from \"./pullqueue\";\nimport {EventEmitter} from \"main.core.events\";\nimport {ViewMode} from \"./viewmode\";\n\nexport default class PullManager\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\tqueue: PullQueue;\n\tnotifier: BX.UI.Notification.Balloon;\n\topenedSlidersCount: Number;\n\n\tstatic eventIds = new Set();\n\n\tconstructor(grid)\n\t{\n\t\tthis.grid = grid;\n\t\tthis.queue = new PullQueue(this.grid);\n\t\tthis.openedSlidersCount = 0;\n\t\tif (Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.bindEvents();\n\t}\n\n\tstatic registerRandomEventId(): string\n\t{\n\t\tconst eventId = Text.getRandom(12);\n\t\tthis.registerEventId(eventId);\n\t\treturn eventId;\n\t}\n\n\tstatic registerEventId(eventId: string)\n\t{\n\t\tthis.eventIds.add(eventId);\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() => {\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif (!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst gridData = this.grid.getData();\n\t\t\tconst { pullTag, eventKanbanUpdatedTag, viewMode } = gridData;\n\n\t\t\tPull.subscribe({\n\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t//command: this.grid.getData().pullTag,\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command !== pullTag\n\t\t\t\t\t\t&& !(data.command.indexOf(eventKanbanUpdatedTag) === 0 && viewMode === ViewMode.MODE_ACTIVITIES)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { params } = data;\n\n\t\t\t\t\tif (Type.isString(params.eventName))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(PullManager.eventIds.has(params.eventId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(this.queue.isOverflow())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (params.eventName === 'ITEMUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\n\t\t\tEvent.bind(document, 'visibilitychange', () => {\n\t\t\t\tif (!document.hidden)\n\t\t\t\t{\n\t\t\t\t\tthis.onTabActivated();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tif (this.updateItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem(false, params.ignoreDelay || false);\n\t\t}\n\t}\n\n\tupdateItem(params)\n\t{\n\t\tconst item = this.grid.getItem(params.item.id);\n\n\t\tif (item)\n\t\t{\n\t\t\tthis.queue.push(item.id, {\n\t\t\t\tid: item.id,\n\t\t\t\taction: 'updateItem',\n\t\t\t\tactionParams: params,\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.onPullItemAdded(params);\n\t\treturn false\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tif (this.addItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem(false, params.ignoreDelay || false);\n\t\t}\n\t}\n\n\taddItem(params)\n\t{\n\t\tconst itemId = params.item.id;\n\t\tconst oldItem = this.grid.getItem(itemId);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.queue.push(itemId, {\n\t\t\tid: itemId,\n\t\t\taction: 'addItem',\n\t\t\tactionParams: params,\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonPullItemDeleted(params)\n\t{\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { id, data: { columnId } } = params.item;\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (this.queue.has(id) ? 5000 : 0);\n\n\t\tsetTimeout(function() {\n\t\t\tthis.queue.delete(id);\n\n\t\t\tconst item = this.grid.getItem(id);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.grid.removeItem(id);\n\n\t\t\tconst column = this.grid.getColumn(columnId);\n\t\t\tcolumn.decPrice(item.price);\n\t\t\tcolumn.renderSubTitle();\n\t\t}.bind(this), delay);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonTabActivated()\n\t{\n\t\tif (this.queue.isOverflow())\n\t\t{\n\t\t\tthis.showOutdatedDataDialog();\n\t\t}\n\t\telse if (this.queue.peek())\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tshowOutdatedDataDialog()\n\t{\n\t\tif (!this.notifier)\n\t\t{\n\t\t\tthis.notifier = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_NOTIFY_OUTDATED_DATA'),\n\t\t\t\tcloseButton: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_GRID_RELOAD'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t\tthis.queue.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifier.show();\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', (event) => {\n\t\t\tthis.openedSlidersCount++;\n\t\t\tthis.queue.freeze();\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\tthis.openedSlidersCount--;\n\t\t\tif (this.openedSlidersCount <= 0)\n\t\t\t{\n\t\t\t\tthis.openedSlidersCount = 0;\n\t\t\t\tthis.queue.unfreeze();\n\t\t\t\tthis.onTabActivated();\n\t\t\t}\n\t\t});\n\t}\n}\n","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Event, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\theadersSections: Object,\n\tdefaultHeaderSectionId: ?string,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.fieldsPopupItems = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\n\t\tthis.enableHeadersSections = Boolean(this.options.headersSections);\n\t\tthis.headersSections = (this.options.headersSections ?? {});\n\t\tthis.defaultHeaderSectionId = (this.options.defaultHeaderSectionId ?? null);\n\n\t\tthis.fieldVisibleClass = 'crm-kanban-popup-field-search-list-item-visible';\n\t\tthis.fieldHiddenClass = 'crm-kanban-popup-field-search-list-item-hidden';\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: Loc.getMessage('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.fieldsPopupItems = null;\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tconst headerWrapper = Tag.render`\n\t\t\t<div class=\"crm-kanban-popup-field-search-header-wrapper\">\n\t\t\t\t<div class=\"ui-form-row-inline\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tcontainer.prepend(headerWrapper);\n\n\t\tthis.preparePopupContentHeaderSections(headerWrapper);\n\t\tthis.preparePopupContentHeaderSearch(headerWrapper);\n\n\t\tthis.getSections().map(section => {\n\t\t\tconst sectionWrapperId = this.getSectionWrapperNameBySectionName(section.name);\n\t\t\tconst sectionWrapper = Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"crm-kanban-popup-field-search-section\" \n\t\t\t\t\tdata-crm-kanban-popup-field-search-section=\"${sectionWrapperId}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(sectionWrapper, container);\n\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tpreparePopupContentHeaderSections(headerWrapper: HTMLElement): void\n\t{\n\t\tif (!this.enableHeadersSections)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerSectionsWrapper = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-section-wrapper\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(headerSectionsWrapper);\n\n\t\tconst headersSections = this.getHeadersSections();\n\n\t\tfor (let key in headersSections)\n\t\t{\n\t\t\tconst itemClass = 'crm-kanban-popup-field-search-section-item-icon'\n\t\t\t\t+ (headersSections[key].selected ? ` crm-kanban-popup-field-search-section-item-icon-active` : '');\n\n\t\t\tconst headerSectionItem = Tag.render`\n\t\t\t\t<div class=\"crm-kanban-popup-field-search-section-item\" data-kanban-popup-filter-section-button=\"${key}\">\n\t\t\t\t\t<div class=\"${itemClass}\">\n\t\t\t\t\t\t${Text.encode(headersSections[key].name)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\theaderSectionsWrapper.firstElementChild.appendChild(headerSectionItem);\n\n\t\t\tif (this.type !== TYPE_VIEW)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tEvent.bind(headerSectionItem, 'click', this.onFilterSectionClick.bind(this, headerSectionItem));\n\t\t}\n\t}\n\n\tonFilterSectionClick(item: HTMLElement): void\n\t{\n\t\tconst activeClass = 'crm-kanban-popup-field-search-section-item-icon-active';\n\t\tconst sectionId = item.dataset.kanbanPopupFilterSectionButton;\n\t\tconst sections = document.querySelectorAll(\n\t\t\t`[data-crm-kanban-popup-field-search-section=\"${sectionId}\"]`\n\t\t);\n\t\tif (Dom.hasClass(item.firstElementChild, activeClass))\n\t\t{\n\t\t\tDom.removeClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'show');\n\t\t}\n\t}\n\n\tfilterSectionsToggle(sections: NodeList, action: string): void\n\t{\n\t\tArray.from(sections).map(section => {\n\t\t\t(action === 'show' ? Dom.show(section) : Dom.hide(section));\n\t\t});\n\t}\n\n\tpreparePopupContentHeaderSearch(headerWrapper: HTMLElement): void\n\t{\n\t\tconst searchForm = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-input-wrapper\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\"></button>\n\t\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element crm-kanban-popup-field-search-section-input\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(searchForm);\n\t\tconst inputs = searchForm.getElementsByClassName('crm-kanban-popup-field-search-section-input');\n\t\tif (inputs.length)\n\t\t{\n\t\t\tconst input = inputs[0];\n\t\t\tEvent.bind(input, 'input', this.onFilterSectionSearchInput.bind(this, input));\n\t\t\tEvent.bind(input.previousElementSibling, 'click', this.onFilterSectionSearchInputClear.bind(this, input));\n\t\t}\n\t}\n\n\tonFilterSectionSearchInput(input: HTMLElement): void\n\t{\n\t\tlet search = input.value;\n\t\tif (search.length)\n\t\t{\n\t\t\tsearch = search.toLowerCase();\n\t\t}\n\n\t\tthis.getFieldsPopupItems().map(item => {\n\t\t\tconst title = item.innerText.toLowerCase();\n\n\t\t\tif (search.length && title.indexOf(search) === -1)\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldVisibleClass);\n\t\t\t\tDom.addClass(item, this.fieldHiddenClass);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldHiddenClass);\n\t\t\t\tDom.addClass(item, this.fieldVisibleClass);\n\t\t\t\titem.style.display = 'block';\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFieldsPopupItems(): ?HTMLElement[]\n\t{\n\t\tif (!Type.isArray(this.fieldsPopupItems))\n\t\t{\n\t\t\tthis.fieldsPopupItems = Array.from(\n\t\t\t\tthis.popup.getPopupContainer().querySelectorAll('.crm-kanban-popup-field-item')\n\t\t\t);\n\t\t\tthis.prepareAnimation();\n\t\t}\n\n\t\treturn this.fieldsPopupItems;\n\t}\n\n\tprepareAnimation(): void\n\t{\n\t\tthis.fieldsPopupItems.map(item => {\n\t\t\tEvent.bind(item, 'animationend', this.onAnimationEnd.bind(this, item));\n\t\t});\n\t}\n\n\tonAnimationEnd(item: HTMLElement): void\n\t{\n\t\titem.style.display = (\n\t\t\tDom.hasClass(item, this.fieldHiddenClass)\n\t\t\t\t? 'none'\n\t\t\t\t: 'block'\n\t\t);\n\t}\n\n\tonFilterSectionSearchInputClear(input: HTMLElement): void\n\t{\n\t\tif (input.value.length)\n\t\t{\n\t\t\tinput.value = '';\n\t\t\tthis.onFilterSectionSearchInput(input);\n\t\t}\n\t}\n\n\tgetSectionWrapperNameBySectionName(name: string): ?string\n\t{\n\t\tconst headerSections = this.getHeadersSections();\n\t\tfor (let id in headerSections)\n\t\t{\n\t\t\tif (this.headersSections[id].sections && this.headersSections[id].sections.includes(name))\n\t\t\t{\n\t\t\t\treturn this.headersSections[id].id;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.headersSections[this.defaultHeaderSectionId] && this.defaultHeaderSectionId)\n\t\t\t\t? this.headersSections[this.defaultHeaderSectionId].id\n\t\t\t\t: null\n\t\t);\n\t}\n\n\tgetHeadersSections(): Object\n\t{\n\t\treturn (this.headersSections ?? {});\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n"],"names":["PullOperation","data","instance","grid","setItemId","itemId","setAction","action","setActionParams","actionParams","getAction","updateItem","addItem","params","getActionParams","item","getItem","id","paramsItem","insertItemParams","lastActivity","timestamp","canShowLastActivitySortTour","oldPrice","parseFloat","price","oldColumnId","columnId","key","rawData","setActivityExistInnerHtml","useAnimation","setChangedInPullRequest","resetMultiSelectMode","newColumnId","newColumn","getColumn","newPrice","insertItem","getTypeInfoParam","oldColumn","decPrice","renderSubTitle","incPrice","oldItem","column","sorter","Sorter","createWithCurrentSortType","getItems","beforeItem","calcBeforeItemByParams","sort","targetId","getId","ViewMode","MODE_STAGES","MODE_ACTIVITIES","getDefault","getAll","normalize","mode","includes","Object","freeze","LOAD_ITEMS_DELAY","PullQueue","getData","viewMode","Map","loadItemsTimer","ignoreProgressStatus","ignoreDelay","setTimeout","document","hidden","isOverflow","isFreezed","items","popAllAsArray","length","ids","map","push","operation","createInstance","execute","loadNextOnSuccess","peek","loadItem","doNothingOnError","loadNew","then","parseInt","has","set","Array","from","clear","count","results","i","pop","entries","first","next","value","MAX_PENDING_ITEMS","size","PullManager","queue","openedSlidersCount","Type","isString","moduleId","userId","init","bindEvents","Event","ready","Pull","BX","PULL","console","error","gridData","pullTag","eventKanbanUpdatedTag","subscribe","callback","command","indexOf","eventName","eventIds","eventId","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","onPullStageAdded","onPullStageDeleted","onPullStageUpdated","extendWatch","bind","onTabActivated","isPlainObject","delay","removeItem","onApplyFilter","removeColumn","stage","showOutdatedDataDialog","notifier","UI","Notification","Center","notify","content","Loc","getMessage","closeButton","autoHide","actions","title","events","click","event","balloon","close","reload","show","EventEmitter","unfreeze","Text","getRandom","registerEventId","add","Set","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","fieldsPopupItems","type","hasOwnProperty","selectedFields","slice","enableHeadersSections","Boolean","headersSections","defaultHeaderSectionId","fieldVisibleClass","fieldHiddenClass","createPopup","setContent","getFieldsLayout","loadPopupContent","PopupManager","create","className","titleBar","toUpperCase","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","filter","field","NAME","executeCallback","autoHideDelay","CancelButton","loaderContainer","Tag","render","loader","Loader","target","ajax","runComponentAction","entityType","entityTypeName","viewType","response","destroy","getButtons","forEach","button","setDisabled","adjustPosition","Kanban","Utils","showErrorDialog","errors","message","sectionsWithFields","distributeFieldsBySections","container","headerWrapper","prepend","preparePopupContentHeaderSections","preparePopupContentHeaderSearch","getSections","section","sectionWrapperId","getSectionWrapperNameBySectionName","name","sectionWrapper","Dom","append","sectionName","encode","label","LABEL","encodedLabel","ID","onFieldClick","headerSectionsWrapper","firstElementChild","appendChild","getHeadersSections","itemClass","selected","headerSectionItem","onFilterSectionClick","activeClass","sectionId","dataset","kanbanPopupFilterSectionButton","sections","querySelectorAll","hasClass","removeClass","filterSectionsToggle","addClass","hide","searchForm","inputs","getElementsByClassName","input","onFilterSectionSearchInput","previousElementSibling","onFilterSectionSearchInputClear","search","toLowerCase","getFieldsPopupItems","innerText","style","display","isArray","getPopupContainer","prepareAnimation","onAnimationEnd","headerSections","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","elements","filterFieldsByList","filterFieldsByRule","RegExp","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","values","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","checked","splice"],"mappings":"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"}