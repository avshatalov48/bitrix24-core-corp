{"version":3,"file":"kanban.js","sources":["../src/pullqueue.js","../src/pullmanager.js","../src/fieldsselector.js"],"sourcesContent":["export default class PullQueue\n{\n\t#queue: Set<number>;\n\t#grid: BX.CRM.Kanban.Grid;\n\t#isProgress: boolean;\n\t#isFreeze: boolean;\n\n\tconstructor(grid: BX.CRM.Kanban.Grid): void\n\t{\n\t\tthis.#grid = grid;\n\t\tthis.#queue = new Set();\n\t\tthis.#isProgress = false;\n\t\tthis.#isFreeze = false;\n\t}\n\n\tloadItem(isForce: boolean): void\n\t{\n\t\tsetTimeout(\n\t\t\t() => {\n\t\t\t\tisForce = (isForce || false);\n\t\t\t\tif (this.#isProgress && !isForce)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.hidden || this.isOverflow() || this.isFreezed())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst id = this.pop();\n\t\t\t\tif (id)\n\t\t\t\t{\n\t\t\t\t\tconst loadNextOnSuccess = (response) => {\n\t\t\t\t\t\tif (this.peek())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.loadItem(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#isProgress = false;\n\t\t\t\t\t};\n\t\t\t\t\tconst doNothingOnError = (err) => {};\n\n\t\t\t\t\tthis.#isProgress = true;\n\t\t\t\t\tthis.#grid.loadNew(id, false, true, true).then(loadNextOnSuccess, doNothingOnError);\n\t\t\t\t}\n\t\t\t},\n\t\t\t1000\n\t\t);\n\t}\n\n\tpush(id: number): PullQueue\n\t{\n\t\tid = parseInt(id, 10);\n\t\tif (this.#queue.has(id))\n\t\t{\n\t\t\tthis.#queue.delete(id);\n\t\t}\n\n\t\tthis.#queue.add(id);\n\t\treturn this;\n\t}\n\n\tpop(): number\n\t{\n\t\tconst values = this.#queue.values();\n\t\tconst first = values.next();\n\t\tif (first.value !== undefined)\n\t\t{\n\t\t\tthis.#queue.delete(first.value);\n\t\t}\n\t\treturn first.value;\n\t}\n\n\tpeek(): number|null\n\t{\n\t\tconst values = this.#queue.values();\n\t\tconst first = values.next();\n\t\treturn (first.value !== undefined ? first.value : null);\n\t}\n\n\tdelete(id: number): void\n\t{\n\t\tthis.#queue.delete(id);\n\t}\n\n\thas(id: number): boolean\n\t{\n\t\treturn this.#queue.has(id);\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#queue.clear();\n\t}\n\n\tisOverflow(): boolean\n\t{\n\t\tconst MAX_PENDING_ITEMS = 10;\n\t\treturn (this.#queue.size > MAX_PENDING_ITEMS);\n\t}\n\n\tfreeze(): void\n\t{\n\t\tthis.#isFreeze = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tthis.#isFreeze = false;\n\t}\n\n\tisFreezed(): boolean\n\t{\n\t\treturn this.#isFreeze;\n\t}\n}\n","import {Event, Type, Loc} from 'main.core';\nimport PullQueue from \"./pullqueue\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport default class PullManager\n{\n\tgrid: BX.CRM.Kanban.Grid;\n\tqueue: PullQueue;\n\tnotifier: BX.UI.Notification.Balloon;\n\n\tconstructor(grid)\n\t{\n\t\tthis.grid = grid;\n\t\tthis.queue = new PullQueue(this.grid);\n\t\tif (Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.bindEvents();\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif (!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tPull.subscribe({\n\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\tcommand: this.grid.getData().pullTag,\n\t\t\t\tcallback: (params) =>\n\t\t\t\t{\n\t\t\t\t\tif (Type.isString(params.eventName))\n\t\t\t\t\t{\n\t\t\t\t\t\tif(this.queue.isOverflow())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (params.eventName === 'ITEMUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'ITEMDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEADDED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEDELETED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (params.eventName === 'STAGEUPDATED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\n\t\t\tEvent.bind(document, 'visibilitychange', () => {\n\t\t\t\tif (!document.hidden)\n\t\t\t\t{\n\t\t\t\t\tthis.onTabActivated();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tif (this.updateItem(params))\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tupdateItem(params)\n\t{\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tconst paramsItem = params.item;\n\n\t\tif (item)\n\t\t{\n\t\t\tconst oldPrice = parseFloat(item.data.price);\n\t\t\tconst oldColumnId = item.columnId;\n\n\t\t\tfor (let key in paramsItem.data)\n\t\t\t{\n\t\t\t\tif (key in item.data)\n\t\t\t\t{\n\t\t\t\t\titem.data[key] = paramsItem.data[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titem.rawData = paramsItem.rawData;\n\t\t\titem.setActivityExistInnerHtml();\n\t\t\titem.useAnimation = true;\n\t\t\titem.setChangedInPullRequest();\n\t\t\tthis.grid.resetMultiSelectMode();\n\n\t\t\tthis.grid.insertItem(item);\n\n\t\t\tconst newColumnId = paramsItem.data.columnId;\n\t\t\tconst newColumn = this.grid.getColumn(newColumnId);\n\t\t\tconst newPrice = parseFloat(paramsItem.data.price);\n\n\t\t\titem.columnId = newColumnId;\n\n\t\t\tif (oldColumnId !== newColumnId)\n\t\t\t{\n\t\t\t\tconst oldColumn = this.grid.getColumn(oldColumnId);\n\t\t\t\toldColumn.decPrice(oldPrice);\n\t\t\t\toldColumn.renderSubTitle();\n\n\t\t\t\tif (newColumn)\n\t\t\t\t{\n\t\t\t\t\tnewColumn.incPrice(newPrice);\n\t\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (oldPrice < newPrice)\n\t\t\t\t{\n\t\t\t\t\tnewColumn.incPrice(newPrice - oldPrice);\n\t\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t\t}\n\t\t\t\telse if (oldPrice > newPrice)\n\t\t\t\t{\n\t\t\t\t\tnewColumn.decPrice(oldPrice - newPrice);\n\t\t\t\t\tnewColumn.renderSubTitle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.queue.push(item.id);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.onPullItemAdded(params);\n\t\treturn false\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tthis.addItem(params);\n\t\tthis.queue.loadItem();\n\t}\n\n\taddItem(params)\n\t{\n\t\tconst oldItem = this.grid.getItem(params.item.id);\n\t\tif (oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.addItemTop(params.item);\n\t\tthis.queue.push(params.item.id);\n\t}\n\n\tonPullItemDeleted(params)\n\t{\n\t\tif (!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Delay so that the element has time to be rendered before deletion,\n\t\t * if an event for changing the element came before. Ticket #141983\n\t\t */\n\t\tconst delay = (this.queue.has(params.item.id) ? 5000 : 0);\n\n\t\tsetTimeout(function() {\n\t\t\tthis.queue.delete(params.item.id);\n\t\t\tthis.grid.removeItem(params.item.id);\n\n\t\t\tconst column = this.grid.getColumn(params.item.data.columnId);\n\t\t\tcolumn.decPrice(params.item.data.price);\n\t\t\tcolumn.renderSubTitle();\n\t\t}.bind(this), delay);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonTabActivated()\n\t{\n\t\tif (this.queue.isOverflow())\n\t\t{\n\t\t\tthis.showOutdatedDataDialog();\n\t\t}\n\t\telse if (this.queue.peek())\n\t\t{\n\t\t\tthis.queue.loadItem();\n\t\t}\n\t}\n\n\tshowOutdatedDataDialog()\n\t{\n\t\tif (!this.notifier)\n\t\t{\n\t\t\tthis.notifier = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_NOTIFY_OUTDATED_DATA'),\n\t\t\t\tcloseButton: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_KANBAN_GRID_RELOAD'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\tthis.grid.reload();\n\t\t\t\t\t\t\tthis.queue.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifier.show();\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', (event) => {\n\t\t\tif (this.isEntitySlider(event.data[0].slider))\n\t\t\t{\n\t\t\t\tthis.queue.freeze();\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (this.isEntitySlider(event.data[0].slider))\n\t\t\t{\n\t\t\t\tthis.queue.unfreeze();\n\t\t\t\tthis.onTabActivated();\n\t\t\t}\n\t\t});\n\t}\n\n\tisEntitySlider(slider): boolean\n\t{\n\t\tconst sliderUrl = slider.getUrl();\n\t\tconst entityPath = this.grid.getData().entityPath;\n\t\tconst maskUrl = entityPath.replace(/\\#([^\\#]+)\\#/, '([\\\\d]+)');\n\n\t\treturn (new RegExp(maskUrl)).test(sliderUrl);\n\t}\n}\n","import {UI} from 'ui.notification';\nimport {PopupManager} from \"main.popup\";\nimport {Dom, Event, Loc, Tag, Text, Type} from \"main.core\";\n\ntype FieldsSelectorOptions = {\n\ttype: string,\n\tentityTypeName: string,\n\tsections: Array,\n\tselectedFields: Array,\n\tignoredFields: Object,\n\theadersSections: Object,\n\tdefaultHeaderSectionId: ?string,\n\tonSelect?: Function\n}\n\nconst TYPE_VIEW = 'view';\nconst TYPE_EDIT = 'edit';\n\nexport default class FieldsSelector\n{\n\tconstructor(options: FieldsSelectorOptions)\n\t{\n\t\tthis.popup = null;\n\t\tthis.fields = null;\n\t\tthis.fieldsPopupItems = null;\n\t\tthis.options = options;\n\t\tthis.type =\n\t\t\tthis.options.hasOwnProperty('type')\n\t\t\t\t? this.options.type\n\t\t\t\t: TYPE_VIEW\n\t\t;\n\n\t\tthis.selectedFields =\n\t\t\tthis.options.hasOwnProperty('selectedFields')\n\t\t\t\t? this.options.selectedFields.slice(0)\n\t\t\t\t: []\n\t\t;\n\n\t\tthis.enableHeadersSections = Boolean(this.options.headersSections);\n\t\tthis.headersSections = (this.options.headersSections ?? {});\n\t\tthis.defaultHeaderSectionId = (this.options.defaultHeaderSectionId ?? null);\n\n\t\tthis.fieldVisibleClass = 'crm-kanban-popup-field-search-list-item-visible';\n\t\tthis.fieldHiddenClass = 'crm-kanban-popup-field-search-list-item-hidden';\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t}\n\t\tif (this.fields)\n\t\t{\n\t\t\tthis.popup.setContent(this.getFieldsLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadPopupContent(this.popup);\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\tcreatePopup()\n\t{\n\t\treturn PopupManager.create({\n\t\t\tid: 'kanban_custom_fields_' + this.type,\n\t\t\tclassName: 'crm-kanban-popup-field',\n\t\t\ttitleBar: BX.message('CRM_KANBAN_CUSTOM_FIELDS_' + this.type.toUpperCase()),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\toverlay: true,\n\t\t\tdraggable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcontentColor: 'white',\n\t\t\tmaxHeight: window.innerHeight - 50,\n\t\t\tevents: {\n\t\t\t\tonClose: () => (this.popup = null)\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: this.fields ? '' : BX.UI.Button.State.DISABLED,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst selectedFields =\n\t\t\t\t\t\t\tthis.fields\n\t\t\t\t\t\t\t\t? this.fields.filter(field => this.selectedFields.indexOf(field.NAME) >= 0)\n\t\t\t\t\t\t\t\t: []\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (selectedFields.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\tthis.executeCallback(selectedFields);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_KANBAN_POPUP_AT_LEAST_ONE_FIELD'),\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tloadPopupContent(popup: Popup)\n\t{\n\t\tconst loaderContainer = Tag.render`<div class=\"crm-kanban-popup-field-loader\"></div>`;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: loaderContainer,\n\t\t\tsize: 80\n\t\t});\n\t\tloader.show();\n\n\t\tpopup.setContent(loaderContainer);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.kanban',\n\t\t\t'getFields',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tentityType: this.options.entityTypeName,\n\t\t\t\t\tviewType: this.type,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tloader.destroy();\n\n\t\t\t\t\tthis.fields = response.data;\n\t\t\t\t\tpopup.setContent(this.getFieldsLayout());\n\t\t\t\t\tpopup.getButtons().forEach(button => button.setDisabled(false));\n\t\t\t\t\tpopup.adjustPosition();\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tBX.Kanban.Utils.showErrorDialog(response.errors.pop().message);\n\t\t\t\t}\n\t\t\t);\n\n\t\treturn popup;\n\t}\n\n\tgetFieldsLayout()\n\t{\n\t\tconst sectionsWithFields = this.distributeFieldsBySections(this.fields);\n\n\t\tconst container = Tag.render`<div class=\"crm-kanban-popup-field\"></div>`;\n\n\t\tconst headerWrapper = Tag.render`\n\t\t\t<div class=\"crm-kanban-popup-field-search-header-wrapper\">\n\t\t\t\t<div class=\"ui-form-row-inline\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tcontainer.prepend(headerWrapper);\n\n\t\tthis.preparePopupContentHeaderSections(headerWrapper);\n\t\tthis.preparePopupContentHeaderSearch(headerWrapper);\n\n\t\tthis.getSections().map(section => {\n\t\t\tconst sectionWrapperId = this.getSectionWrapperNameBySectionName(section.name);\n\t\t\tconst sectionWrapper = Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"crm-kanban-popup-field-search-section\" \n\t\t\t\t\tdata-crm-kanban-popup-field-search-section=\"${sectionWrapperId}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(sectionWrapper, container);\n\n\t\t\tconst sectionName = section.name;\n\t\t\tif (sectionsWithFields.hasOwnProperty(sectionName) && sectionsWithFields[sectionName].length)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-title\">${Text.encode(section.title)}</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"crm-kanban-popup-field-wrapper\">\n\t\t\t\t\t\t${sectionsWithFields[sectionName].map(\n\t\t\t\t\t\t(field) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet label = field.LABEL;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!label.length\n\t\t\t\t\t\t\t\t&& section['elements']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title']\n\t\t\t\t\t\t\t\t&& section['elements'][field.NAME]['title'].length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel = section['elements'][field.NAME]['title'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst encodedLabel = Text.encode(label);\n\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"crm-kanban-popup-field-item\" title=\"${encodedLabel}\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid=\"cf_${Text.encode(field.ID)}\" \n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\t\t\t\tname=\"${Text.encode(field.NAME)}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-kanban-popup-field-item-input\"\n\t\t\t\t\t\t\t\t\t\tdata-label=\"${encodedLabel}\"\n\t\t\t\t\t\t\t\t\t\t${this.selectedFields.indexOf(field.NAME) >= 0 ? 'checked' : ''}\n\t\t\t\t\t\t\t\t\t\tonclick=\"${this.onFieldClick.bind(this)}\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label for=\"cf_${Text.encode(field.ID)}\" class=\"crm-kanban-popup-field-item-label\">\n\t\t\t\t\t\t\t\t\t\t${encodedLabel}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t\t</div>`,\n\t\t\t\t\tsectionWrapper\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tpreparePopupContentHeaderSections(headerWrapper: HTMLElement): void\n\t{\n\t\tif (!this.enableHeadersSections)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerSectionsWrapper = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-section-wrapper\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(headerSectionsWrapper);\n\n\t\tconst headersSections = this.getHeadersSections();\n\n\t\tfor (let key in headersSections)\n\t\t{\n\t\t\tconst itemClass = 'crm-kanban-popup-field-search-section-item-icon'\n\t\t\t\t+ (headersSections[key].selected ? ` crm-kanban-popup-field-search-section-item-icon-active` : '');\n\n\t\t\tconst headerSectionItem = Tag.render`\n\t\t\t\t<div class=\"crm-kanban-popup-field-search-section-item\" data-kanban-popup-filter-section-button=\"${key}\">\n\t\t\t\t\t<div class=\"${itemClass}\">\n\t\t\t\t\t\t${Text.encode(headersSections[key].name)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\theaderSectionsWrapper.firstElementChild.appendChild(headerSectionItem);\n\n\t\t\tif (this.type !== TYPE_VIEW)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tEvent.bind(headerSectionItem, 'click', this.onFilterSectionClick.bind(this, headerSectionItem));\n\t\t}\n\t}\n\n\tonFilterSectionClick(item: HTMLElement): void\n\t{\n\t\tconst activeClass = 'crm-kanban-popup-field-search-section-item-icon-active';\n\t\tconst sectionId = item.dataset.kanbanPopupFilterSectionButton;\n\t\tconst sections = document.querySelectorAll(\n\t\t\t`[data-crm-kanban-popup-field-search-section=\"${sectionId}\"]`\n\t\t);\n\t\tif (Dom.hasClass(item.firstElementChild, activeClass))\n\t\t{\n\t\t\tDom.removeClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(item.firstElementChild, activeClass);\n\t\t\tthis.filterSectionsToggle(sections, 'show');\n\t\t}\n\t}\n\n\tfilterSectionsToggle(sections: NodeList, action: string): void\n\t{\n\t\tArray.from(sections).map(section => {\n\t\t\t(action === 'show' ? Dom.show(section) : Dom.hide(section));\n\t\t});\n\t}\n\n\tpreparePopupContentHeaderSearch(headerWrapper: HTMLElement): void\n\t{\n\t\tconst searchForm = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-content crm-kanban-popup-field-search-input-wrapper\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\"></button>\n\t\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element crm-kanban-popup-field-search-section-input\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\theaderWrapper.firstElementChild.appendChild(searchForm);\n\t\tconst inputs = searchForm.getElementsByClassName('crm-kanban-popup-field-search-section-input');\n\t\tif (inputs.length)\n\t\t{\n\t\t\tconst input = inputs[0];\n\t\t\tEvent.bind(input, 'input', this.onFilterSectionSearchInput.bind(this, input));\n\t\t\tEvent.bind(input.previousElementSibling, 'click', this.onFilterSectionSearchInputClear.bind(this, input));\n\t\t}\n\t}\n\n\tonFilterSectionSearchInput(input: HTMLElement): void\n\t{\n\t\tlet search = input.value;\n\t\tif (search.length)\n\t\t{\n\t\t\tsearch = search.toLowerCase();\n\t\t}\n\n\t\tthis.getFieldsPopupItems().map(item => {\n\t\t\tconst title = item.innerText.toLowerCase();\n\n\t\t\tif (search.length && title.indexOf(search) === -1)\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldVisibleClass);\n\t\t\t\tDom.addClass(item, this.fieldHiddenClass);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item, this.fieldHiddenClass);\n\t\t\t\tDom.addClass(item, this.fieldVisibleClass);\n\t\t\t\titem.style.display = 'block';\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFieldsPopupItems(): ?HTMLElement[]\n\t{\n\t\tif (!Type.isArray(this.fieldsPopupItems))\n\t\t{\n\t\t\tthis.fieldsPopupItems = Array.from(\n\t\t\t\tthis.popup.getPopupContainer().querySelectorAll('.crm-kanban-popup-field-item')\n\t\t\t);\n\t\t\tthis.prepareAnimation();\n\t\t}\n\n\t\treturn this.fieldsPopupItems;\n\t}\n\n\tprepareAnimation(): void\n\t{\n\t\tthis.fieldsPopupItems.map(item => {\n\t\t\tEvent.bind(item, 'animationend', this.onAnimationEnd.bind(this, item));\n\t\t});\n\t}\n\n\tonAnimationEnd(item: HTMLElement): void\n\t{\n\t\titem.style.display = (\n\t\t\tDom.hasClass(item, this.fieldHiddenClass)\n\t\t\t\t? 'none'\n\t\t\t\t: 'block'\n\t\t);\n\t}\n\n\tonFilterSectionSearchInputClear(input: HTMLElement): void\n\t{\n\t\tif (input.value.length)\n\t\t{\n\t\t\tinput.value = '';\n\t\t\tthis.onFilterSectionSearchInput(input);\n\t\t}\n\t}\n\n\tgetSectionWrapperNameBySectionName(name: string): ?string\n\t{\n\t\tconst headerSections = this.getHeadersSections();\n\t\tfor (let id in headerSections)\n\t\t{\n\t\t\tif (this.headersSections[id].sections && this.headersSections[id].sections.includes(name))\n\t\t\t{\n\t\t\t\treturn this.headersSections[id].id;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.headersSections[this.defaultHeaderSectionId] && this.defaultHeaderSectionId)\n\t\t\t\t? this.headersSections[this.defaultHeaderSectionId].id\n\t\t\t\t: null\n\t\t);\n\t}\n\n\tgetHeadersSections(): Object\n\t{\n\t\treturn (this.headersSections ?? {});\n\t}\n\n\tdistributeFieldsBySections(fields: Array)\n\t{\n\t\t// remove ignored fields from result:\n\t\tconst ignoredFields = this.getIgnoredFields();\n\t\tfields = fields.filter(item => !(ignoredFields.hasOwnProperty(item.NAME) && ignoredFields[item.NAME]));\n\n\t\tlet fieldsBySections = {};\n\t\tlet defaultSectionName = '';\n\t\tconst sections = this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t\tfor (let i = 0; i < sections.length; i++)\n\t\t{\n\t\t\tconst section = sections[i];\n\t\t\tconst sectionName = section.name;\n\t\t\tfieldsBySections[sectionName] = [];\n\t\t\tif (Type.isPlainObject(section.elements))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByList(fields, section.elements);\n\t\t\t}\n\t\t\telse if (section.hasOwnProperty('elementsRule'))\n\t\t\t{\n\t\t\t\tfieldsBySections[sectionName] = this.filterFieldsByRule(fields, new RegExp(section.elementsRule));\n\t\t\t}\n\t\t\telse if (section.elements === '*')\n\t\t\t{\n\t\t\t\tdefaultSectionName = sectionName;\n\t\t\t}\n\t\t}\n\t\tif (defaultSectionName !== '')\n\t\t{\n\t\t\tfieldsBySections[defaultSectionName] = this.filterNotUsedFields(fields, fieldsBySections);\n\t\t}\n\n\t\treturn fieldsBySections;\n\t}\n\n\tfilterFieldsByList(fields: Array, whiteList: Object): Array\n\t{\n\t\treturn fields.filter((item) => whiteList.hasOwnProperty(item.NAME));\n\t}\n\n\tfilterFieldsByRule(fields: Array, rule: RegExp): Array\n\t{\n\t\treturn fields.filter((item) => item.NAME.match(rule));\n\t}\n\n\tfilterNotUsedFields(fields: Array, alreadyUsedFieldsBySection: Object): Array\n\t{\n\t\tlet alreadyUsedFieldsNames = Object.values(alreadyUsedFieldsBySection).reduce(\n\t\t\t(prevFields, sectionFields) =>\n\t\t\t{\n\t\t\t\treturn prevFields.concat(sectionFields.map((item) => item.NAME))\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn fields.filter(item => alreadyUsedFieldsNames.indexOf(item.NAME) < 0);\n\t}\n\n\tgetSections(): Array\n\t{\n\t\treturn this.options.hasOwnProperty('sections') ? this.options.sections : [];\n\t}\n\n\tgetIgnoredFields()\n\t{\n\t\tlet fields = Object.assign({}, this.options.ignoredFields);\n\t\tlet extraFields = [];\n\t\tif (this.type === TYPE_EDIT)\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'ID',\n\t\t\t\t'CLOSED',\n\t\t\t\t'CLOSEDATE',\n\t\t\t\t'DATE_CREATE',\n\t\t\t\t'DATE_MODIFY',\n\t\t\t\t'COMMENTS',\n\t\t\t\t'OPPORTUNITY',\n\t\t\t]\n\t\t}\n\t\telse\n\t\t{\n\t\t\textraFields = [\n\t\t\t\t'PHONE',\n\t\t\t\t'EMAIL',\n\t\t\t\t'WEB',\n\t\t\t\t'IM',\n\t\t\t]\n\t\t}\n\t\textraFields.forEach((fieldName => (fields[fieldName] = true)));\n\n\t\treturn fields;\n\t}\n\n\texecuteCallback(selectedFields: Array)\n\t{\n\t\tif (!this.options.hasOwnProperty('onSelect') || !Type.isFunction(this.options.onSelect))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet callbackPayload = {};\n\t\tselectedFields.forEach(\n\t\t\t(field) =>\n\t\t\t{\n\t\t\t\tcallbackPayload[field.NAME] =\n\t\t\t\t\tfield.LABEL\n\t\t\t\t\t\t? field.LABEL\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t\tthis.options.onSelect(callbackPayload);\n\t}\n\n\tonFieldClick(event)\n\t{\n\t\tconst fieldName = event.target.name;\n\t\tif (event.target.checked && this.selectedFields.indexOf(fieldName) < 0)\n\t\t{\n\t\t\tthis.selectedFields.push(fieldName);\n\t\t}\n\t\tif (!event.target.checked && this.selectedFields.indexOf(fieldName) >= 0)\n\t\t{\n\t\t\tthis.selectedFields.splice(this.selectedFields.indexOf(fieldName), 1);\n\t\t}\n\t}\n}\n"],"names":["PullQueue","grid","Set","isForce","setTimeout","document","hidden","isOverflow","isFreezed","id","pop","loadNextOnSuccess","response","peek","loadItem","doNothingOnError","err","loadNew","then","parseInt","has","delete","add","values","first","next","value","undefined","clear","MAX_PENDING_ITEMS","size","PullManager","queue","Type","isString","getData","moduleId","userId","init","bindEvents","Event","ready","Pull","BX","PULL","console","error","subscribe","command","pullTag","callback","params","eventName","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","onPullStageAdded","onPullStageDeleted","onPullStageUpdated","extendWatch","bind","onTabActivated","updateItem","item","getItem","paramsItem","oldPrice","parseFloat","data","price","oldColumnId","columnId","key","rawData","setActivityExistInnerHtml","useAnimation","setChangedInPullRequest","resetMultiSelectMode","insertItem","newColumnId","newColumn","getColumn","newPrice","oldColumn","decPrice","renderSubTitle","incPrice","push","addItem","oldItem","addItemTop","isPlainObject","delay","removeItem","column","onApplyFilter","removeColumn","stage","showOutdatedDataDialog","notifier","UI","Notification","Center","notify","content","Loc","getMessage","closeButton","autoHide","actions","title","events","click","event","balloon","action","close","reload","show","EventEmitter","isEntitySlider","slider","freeze","unfreeze","sliderUrl","getUrl","entityPath","maskUrl","replace","RegExp","test","TYPE_VIEW","TYPE_EDIT","FieldsSelector","options","popup","fields","fieldsPopupItems","type","hasOwnProperty","selectedFields","slice","enableHeadersSections","Boolean","headersSections","defaultHeaderSectionId","fieldVisibleClass","fieldHiddenClass","createPopup","setContent","getFieldsLayout","loadPopupContent","PopupManager","create","className","titleBar","message","toUpperCase","cacheable","closeIcon","lightShadow","overlay","draggable","closeByEsc","contentColor","maxHeight","window","innerHeight","onClose","buttons","SaveButton","color","Button","Color","PRIMARY","state","State","DISABLED","onclick","filter","field","indexOf","NAME","length","executeCallback","autoHideDelay","CancelButton","loaderContainer","Tag","render","loader","Loader","target","ajax","runComponentAction","mode","entityType","entityTypeName","viewType","destroy","getButtons","forEach","button","setDisabled","adjustPosition","catch","Kanban","Utils","showErrorDialog","errors","sectionsWithFields","distributeFieldsBySections","container","headerWrapper","prepend","preparePopupContentHeaderSections","preparePopupContentHeaderSearch","getSections","map","section","sectionWrapperId","getSectionWrapperNameBySectionName","name","sectionWrapper","Dom","append","sectionName","Text","encode","label","LABEL","encodedLabel","ID","onFieldClick","headerSectionsWrapper","firstElementChild","appendChild","getHeadersSections","itemClass","selected","headerSectionItem","onFilterSectionClick","activeClass","sectionId","dataset","kanbanPopupFilterSectionButton","sections","querySelectorAll","hasClass","removeClass","filterSectionsToggle","addClass","Array","from","hide","searchForm","inputs","getElementsByClassName","input","onFilterSectionSearchInput","previousElementSibling","onFilterSectionSearchInputClear","search","toLowerCase","getFieldsPopupItems","innerText","style","display","isArray","getPopupContainer","prepareAnimation","onAnimationEnd","headerSections","includes","ignoredFields","getIgnoredFields","fieldsBySections","defaultSectionName","i","elements","filterFieldsByList","filterFieldsByRule","elementsRule","filterNotUsedFields","whiteList","rule","match","alreadyUsedFieldsBySection","alreadyUsedFieldsNames","Object","reduce","prevFields","sectionFields","concat","assign","extraFields","fieldName","isFunction","onSelect","callbackPayload","checked","splice"],"mappings":"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"}