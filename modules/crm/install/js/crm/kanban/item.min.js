(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Item=function(t){BX.Kanban.Item.apply(this,arguments);this.container=null;this.timer=null;this.popupTooltip=null;this.plannerCurrent=null;this.fieldsWrapper=null;this.clientName=null;this.clientNameItems=[];this.useAnimation=false;this.isAnimationInProgress=false;this.changedInPullRequest=false;this.nextFieldsRenderingDisabled=false};BX.CRM.Kanban.Item.prototype={__proto__:BX.Kanban.Item.prototype,constructor:BX.CRM.Kanban.Item,lastPosition:{columnId:null,targetId:null},checked:false,clipTitle:function(t){var e=t;var i=e.split(" ");var a="<span>"+i[i.length-1]+"</span>";i.splice(i.length-1);e=i.join(" ")+" "+a;return e},setDataKey:function(t,e){var i=this.getData();i[t]=e;this.setData(i)},getDataKey:function(t){var e=this.getData();return e[t]},switchClass:function(t,e,i){if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},switchVisible:function(t,e){if(e){t.style.display=""}else{BX.hide(t)}},getLastPosition:function(){return this.lastPosition},setLastPosition:function(){var t=this.getColumn();var e=t.getNextItemSibling(this);this.lastPosition={columnId:t.getId(),targetId:e?e.getId():0}},getBodyContainer:function(){if(!this.layout.bodyContainer){this.layout.bodyContainer=BX.create("div",{attrs:{className:"main-kanban-item-wrapper"}})}return this.layout.bodyContainer},render:function(){var t=null;var e=this.getData();var i=this.getGridData();if(e.special_type==="import"){t=this.getStartLayout();BX.onCustomEvent("Crm.Kanban.Grid:onSpecialItemDraw",[this,t]);this.grid.ccItem=this;this.getBodyContainer().style.background="none";return t}else if(e.special_type==="rest"){t=this.getIndustrySolutionsLayout();BX.onCustomEvent("Crm.Kanban.Grid:onSpecialItemDraw",[this,t]);this.grid.restItem=this;return t}if(!this.container){this.createLayout()}var a=this.getColumn();var n=a.getColor();var s=BX.util.hex2rgb(n);var r="rgba("+s.r+","+s.g+","+s.b+","+".7)";BX.style(this.container,"border-left","3px solid "+r);this.link.innerHTML=this.clipTitle(e.name);this.link.setAttribute("href",e.link);if(this.totalPrice){this.totalPrice.innerHTML=e.price_formatted}this.date.textContent=e.date;this.clientNameItems=[];if(e.contactId&&e.contactName&&BX.util.in_array("CLIENT",i.customFields)){this.clientNameItems.push(e.contactTooltip)}if(e.companyId&&e.companyName&&BX.util.in_array("CLIENT",i.customFields)){this.clientNameItems.push(e.companyTooltip)}if(this.clientNameItems.length){this.clientName.innerHTML=this.clientNameItems.join("<br>");this.switchVisible(this.clientName,true)}else{this.switchVisible(this.clientName,false)}if(this.planner){this.switchPlanner()}var c=["Phone","Email","Im"];for(var o=0,l=c.length;o<l;o++){var d=c[o];var h="crm-kanban-item-contact-"+d.toLowerCase()+"-disabled";BX.unbindAll(this["contact"+d]);if(e[d.toLowerCase()]){BX.bind(this["contact"+d],"click",BX.delegate(this.clickContact,this));this.switchClass(this["contact"+d],h,false)}else{BX.bind(this["contact"+d],"mouseover",BX.delegate(function(){var t=BX.data(BX.proxy_context,"type");this.showTooltip(BX.message("CRM_KANBAN_NO_"+t.toUpperCase()),BX.proxy_context)},this));BX.bind(this["contact"+d],"mouseout",BX.delegate(this.hideTooltip,this));this.switchClass(this["contact"+d],h,true)}}if(this.needRenderFields()){this.fieldsWrapper.innerHTML=null;this.layoutFields()}this.nextFieldsRenderingDisabled=false;t=this.container;return t},needRenderFields:function(){var t=this.fieldsWrapper?true:false;var e=this.getData().fields?true:false;var i=this.getGrid().getTypeInfoParam("doLayoutFieldsInItemRender");var a=!this.nextFieldsRenderingDisabled;return t&&e&&i&&a},preventNextFieldsRendering:function(){this.nextFieldsRenderingDisabled=true},getItemFields:function(){if(!this.fieldsWrapper){var t=this.getGridData();this.fieldsWrapper=BX.create("div",{props:{className:"crm-kanban-item-fields"}});if(this.getGrid().getTypeInfoParam("useRequiredVisibleFields")){this.switchVisible(this.link,true);this.switchVisible(this.date,true);this.switchVisible(this.clientName,true);if(this.total){this.switchVisible(this.total,true)}return this.fieldsWrapper}this.layoutFields()}return this.fieldsWrapper},layoutFields:function(){if(this.fieldsWrapper){for(var t=0;t<this.data.fields.length;t++){var e=this.data.fields[t].code;if(e==="TITLE"){this.switchVisible(this.link,true);continue}if(e==="DATE_CREATE"){this.switchVisible(this.date,true);continue}if(e==="CLIENT"){this.switchVisible(this.clientName,true);continue}if(e==="OPPORTUNITY"||e==="PRICE"){if(this.total){this.switchVisible(this.total,true)}continue}var i=null;if((e==="ASSIGNED_BY_ID"||e==="RESPONSIBLE_ID")&&this.data.fields[t].value.picture){i=' style="background-image: url('+encodeURI(this.data.fields[t].value.picture)+')"'}var a={props:{className:"crm-kanban-item-fields-item-value"}};if(e==="ASSIGNED_BY_ID"||e==="RESPONSIBLE_ID"){if(this.data.fields[t].html===true){var n="";var s="";if(this.data.fields[t].value.link===""){n='<span class="crm-kanban-item-fields-item-value-userpic"></span>';s='<span class="crm-kanban-item-fields-item-value-name">'+this.data.fields[t].value.title+"</span>"}else{n='<a class="crm-kanban-item-fields-item-value-userpic" href="'+this.data.fields[t].value.link+'"'+i+"></a>";s='<a class="crm-kanban-item-fields-item-value-name" href="'+this.data.fields[t].value.link+'">'+this.data.fields[t].value.title+"</a>"}a["html"]='<div class="crm-kanban-item-fields-item-value-user">'+n+s+"</div>"}else{a["text"]=this.getMessage("noname")}}else if(e==="ORDER_STAGE"){var r="";if(this.data.fields[t].value.code==="PAID"){r="paid"}else if(this.data.fields[t].value.code==="SENT_NO_VIEWED"){r="send"}else if(this.data.fields[t].value.code==="VIEWED_NO_PAID"){r="seen"}else if(this.data.fields[t].value.code==="PAYMENT_CANCEL"){r="cancel"}else if(this.data.fields[t].value.code==="REFUND"){r="refund"}a["html"]='<div class="crm-kanban-item-status crm-kanban-item-status-'+r+'">'+this.data.fields[t].value.title+"</div>"}else if(e==="DELIVERY_STAGE"){try{var c=this.data.fields[t].value.STAGE.TITLE;var e=this.data.fields[t].value.STAGE.CODE;var r=e==="SHIPPED"?"shipped":"no-shipped";a["html"]='<div class="crm-kanban-item-status crm-kanban-item-status-'+r+'">'+c+"</div>"}catch(t){}}else if(this.data.fields[t].type==="money"||this.data.fields[t].html===true){a["html"]=this.data.fields[t].value}else{a["text"]=this.data.fields[t].value}this.fieldsWrapper.appendChild(BX.create("div",{props:{className:"crm-kanban-item-fields-item"},children:[BX.create("div",{props:{className:"crm-kanban-item-fields-item-title"},html:this.data.fields[t].title}),BX.create("div",a)]}))}}},getItemFieldsEditor:function(){var t=this.getGridData();var e=BX.create("div",{});var i=BX.create("div",{props:{className:"crm-kanban-item-fields"},children:[e]});var a=BX.Crm.PartialEditorDialog.entityEditorUrls[t.entityType];if(this.data.fieldsEditor){var n=BX.Crm.EntityEditorModelFactory.create("kanban_model","",{data:this.data.fieldsEditor});BX.Crm.EntityEditor.create("kanban_"+t.entityType.toLowerCase()+"_"+this.getId(),{containerId:e,serviceUrl:a,entityTypeId:t.entityTypeInt,entityId:this.getId(),scheme:t.schemeInline,model:n,initialMode:"view",enableModeToggle:true,enableToolPanel:true,enableRequiredUserFieldCheck:true,userFieldManager:t.userFieldManagerInline})}return i},getCloseStartLayout:function(){return BX.create("div",{props:{className:"crm-kanban-item-contact-center-close"},events:{click:function(t){this.grid.toggleCC();t.stopPropagation(t)}.bind(this)}})},getCloseRestLayout:function(){return BX.create("div",{props:{className:"crm-kanban-item-industry-close"},events:{click:function(t){this.grid.toggleRest();t.stopPropagation(t)}.bind(this)}})},getStartLayout:function(){this.getCloseStartLayout();var t=this.getGridData();return BX.create("div",{props:{className:"crm-kanban-item-contact-center"},children:[BX.create("div",{dataset:{url:"contact_center"},props:{className:"crm-kanban-sidepanel"},children:[this.getCloseStartLayout(),BX.create("div",{props:{className:"crm-kanban-item-contact-center-title"},children:[BX.create("div",{props:{className:"crm-kanban-item-contact-center-title-item"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_TITLE")}),BX.create("div",{props:{className:"crm-kanban-item-contact-center-title-item"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_TEXT"+t.entityType)})]}),BX.create("div",{props:{className:"crm-kanban-item-contact-center-action"},children:[BX.create("div",{props:{className:"crm-kanban-item-contact-center-action-section"},children:[BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-chat"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_CHAT"),dataset:{url:"ol_chat"}}),BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-crm-forms"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_FORMS"),dataset:{url:"ol_forms"}}),BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-viber"},text:"Viber",dataset:{url:"ol_viber"}})]}),BX.create("div",{props:{className:"crm-kanban-item-contact-center-action-section"},children:[BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-call"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_PHONES"),dataset:{url:"telephony"}}),BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-mail"},text:BX.message("CRM_KANBAN_EMPTY_CARD_CT_EMAIL"),dataset:{url:"email"}}),BX.create("a",{attrs:{href:"#"},props:{className:"crm-kanban-sidepanel crm-kanban-item-contact-center-action-item "+"crm-kanban-item-contact-center-action-item-facebook"},text:"Facebook",dataset:{url:"ol_facebook"}})]})]})]}),t.rights.canImport?BX.create("div",{children:[BX.create("div",{props:{className:"crm-kanban-item-contact-center-title crm-kanban-item-contact-center-title-import"},html:BX.message("CRM_KANBAN_EMPTY_CARD_IMPORT")})]}):null]})},getIndustrySolutionsLayout:function(){var t=[{text:BX.message("CRM_KANBAN_REST_DEMO_FILE_IMPORT")},{text:BX.message("CRM_KANBAN_REST_DEMO_FILE_EXPORT")},{text:BX.message("CRM_KANBAN_REST_DEMO_CRM_MIGRATION")},{text:BX.message("CRM_KANBAN_REST_DEMO_MARKET_2")},{text:BX.message("CRM_KANBAN_REST_DEMO_PUBLICATION_2")}];var e=document.createDocumentFragment();t.map(function(t,i){e.appendChild(BX.create("div",{props:{className:"crm-kanban-item-industry-list-item crm-kanban-item-industry-list-item-"+(i+1)},children:[BX.create("div",{props:{className:"crm-kanban-item-industry-list-item-img"}}),BX.create("div",{props:{className:"crm-kanban-item-industry-list-item-text"},text:t.text})]}))});return BX.create("div",{props:{className:"crm-kanban-item-industry"},children:[BX.create("div",{props:{className:"crm-kanban-item-industry-title"},text:BX.message("CRM_KANBAN_REST_DEMO_MARKET_SECTOR")}),BX.create("div",{props:{className:"crm-kanban-item-industry-list"},children:[e]}),BX.create("span",{props:{className:"ui-btn ui-btn-sm ui-btn-primary ui-btn-round crm-kanban-sidepanel"},dataset:{url:"rest_demo"},text:BX.message("CRM_KANBAN_REST_DEMO_SETUP")}),this.getCloseRestLayout()]})},selectItem:function(){this.checked=true;BX.addClass(this.checkedButton,"crm-kanban-item-checkbox-checked");BX.addClass(this.container,"crm-kanban-item-selected")},unSelectItem:function(){this.checked=false;BX.removeClass(this.checkedButton,"crm-kanban-item-checkbox-checked");BX.removeClass(this.container,"crm-kanban-item-selected")},createLayout:function(){var t=this.getGridData();this.container=BX.create("div",{props:{className:this.getGrid().getTypeInfoParam("kanbanItemClassName")},events:{click:function(t){var e=BX.findParent(t.target,{className:this.container.className});if(t.target!==this.container&&!e||e&&t.target.tagName==="A"||e&&t.target.tagName==="SPAN"){return}if(this.checked){this.getGrid().unCheckItem(this);if(this.getGrid().getChecked().length===0){this.getGrid().resetMultiSelectMode();this.getGrid().stopActionPanel()}}else{this.getGrid().checkItem(this);this.getGrid().onMultiSelectMode();this.getGrid().startActionPanel()}this.getGrid().calculateTotalCheckItems()}.bind(this),dblclick:function(){BX.fireEvent(this.link,"click")}.bind(this),mouseleave:function(){this.removeHoverClass(this.container)}.bind(this)}});BX.bind(this.container,"animationend",function(){BX.removeClass(this.layout.container,"main-kanban-item-new")}.bind(this));this.link=BX.create("a",{props:{className:"crm-kanban-item-title"},style:this.data.fields.length>0?{display:"none"}:{}});this.container.appendChild(this.link);if(this.options.data.return||this.options.data.returnApproach){this.repeated=BX.create("div",{props:{className:"crm-kanban-item-repeated"},text:this.options.data.returnApproach?BX.message("CRM_KANBAN_REPEATED_APPROACH_"+t.entityType):BX.message("CRM_KANBAN_REPEATED_"+t.entityType)});this.container.appendChild(this.repeated)}this.totalPrice=BX.create("div",{props:{className:"crm-kanban-item-total-price"}});this.total=BX.create("div",{props:{className:"crm-kanban-item-total"},style:this.data.fields.length>0?{display:"none"}:{},children:[this.totalPrice]});this.container.appendChild(this.total);this.clientName=BX.create("span",{props:{className:"crm-kanban-item-contact"}});this.container.appendChild(this.clientName);this.date=BX.create("div",{props:{className:"crm-kanban-item-date"},style:this.data.fields.length>0?{display:"none"}:{}});this.container.appendChild(this.date);this.checkedButton=BX.create("div",{props:{className:"crm-kanban-item-checkbox"},events:{click:function(){this.checked=!this.checked;this.checked?BX.addClass(this.checkedButton,"crm-kanban-item-checkbox-checked"):BX.removeClass(this.checkedButton,"crm-kanban-item-checkbox-checked")}.bind(this)}});this.container.appendChild(this.checkedButton);if(false&&this.data.fieldsEditor){this.container.appendChild(this.getItemFieldsEditor())}else if(this.data.fields.length>0){this.container.appendChild(this.getItemFields())}if(t.showActivity){this.activityExist=BX.create("span",{props:{className:"crm-kanban-item-activity"},events:{click:BX.delegate(this.showCurrentPlan,this)}});this.activityEmpty=BX.create("span",{props:{className:"crm-kanban-item-activity"},events:{click:BX.delegate(function(){this.showTooltip(this.getActivityMessage(t.entityType),BX.proxy_context,true)},this)}});this.activityPlan=BX.create("span",{props:{className:"crm-kanban-item-plan"},text:"+ "+BX.message("CRM_KANBAN_ACTIVITY_TO_PLAN"),events:{click:BX.delegate(this.showPlannerMenu,this)}});this.planner=BX.create("div",{props:{className:"crm-kanban-item-planner"},children:[this.activityEmpty,this.activityExist,this.activityPlan]});this.container.appendChild(this.planner)}this.contactPhone=BX.create("span",{props:{className:"crm-kanban-item-contact-phone crm-kanban-item-contact-phone-disabled"},attrs:{"data-type":"phone"}});this.contactEmail=BX.create("span",{props:{className:"crm-kanban-item-contact-email crm-kanban-item-contact-email-disabled"},attrs:{"data-type":"email"}});this.contactIm=BX.create("span",{props:{className:"crm-kanban-item-contact-im crm-kanban-item-contact-im-disabled"},attrs:{"data-type":"im"}});this.contactBlock=BX.create("div",{props:{className:"crm-kanban-item-connect"},children:[this.contactPhone,this.contactEmail,this.contactIm]});this.container.appendChild(this.contactBlock);this.container.appendChild(this.createShadow())},isChecked:function(){return this.checked},getActivityMessage:function(t){var e=BX.create("span");e.innerHTML=BX.message("CRM_KANBAN_ACTIVITY_CHANGE_"+t);var i=e.querySelector(".crm-kanban-item-activity-link");BX.bind(i,"click",function(){this.showPlannerMenu(this.activityPlan);this.popupTooltip.destroy()}.bind(this));return e},getPreloader:function(){return'<div class="crm-kanban-preloader-wapper">\n\t\t\t\t\t\t\t\t<div class="crm-kanban-preloader">\n\t\t\t\t\t\t\t\t\t<svg class="crm-kanban-circular" viewBox="25 25 50 50">\n\t\t\t\t\t\t\t\t\t\t<circle class="crm-kanban-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>'},loadCurrentPlan:function(){this.getGrid().ajax({action:"activities",entity_id:this.getId()},function(t){this.plannerCurrent.setContent(t);this.plannerCurrent.adjustPosition()}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true)}.bind(this),"html")},showCurrentPlan:function(){this.plannerCurrent=BX.PopupWindowManager.create("kanban_planner_current",BX.proxy_context,{closeIcon:false,autoHide:true,className:"crm-kanban-popup-plan",closeByEsc:true,contentColor:"white",angle:true,offsetLeft:15,overlay:{backgroundColor:"transparent",opacity:"0"},events:{onAfterPopupShow:BX.delegate(this.loadCurrentPlan,this),onPopupClose:function(){this.plannerCurrent.destroy();BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});this.plannerCurrent.setContent(this.getPreloader());this.plannerCurrent.show();BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))},clickContact:function(){var t=BX.data(BX.proxy_context,"type");var e=this.getContactInfo(t);if(typeof e==="object"&&Object.keys(e).length>1){this.showManyContacts(e,t)}else{this.showSingleContact(e,t)}},clickContactItem:function(t,e){var i=this.getData();if(e.type==="phone"&&typeof BXIM!=="undefined"){BXIM.phoneTo(e.value,{ENTITY_TYPE:e.clientType!==undefined?e.clientType:i.contactType,ENTITY_ID:e.clientId!==undefined?e.clientId:i.contactId})}else if(e.type==="im"&&typeof BXIM!=="undefined"){BXIM.openMessengerSlider(e.value,{RECENT:"N",MENU:"N"})}else if(e.type==="email"){var a=BX.CrmActivityEditor&&BX.CrmActivityEditor.items["kanban_activity_editor"];var n=top.BX.Bitrix24&&top.BX.Bitrix24.Slider;if(a&&BX.CrmActivityProvider&&n){var s=this.getGridData();BX.CrmActivityEditor.items["kanban_activity_editor"].addEmail({ownerType:s.entityType,ownerID:i.id,communications:[{type:"EMAIL",value:e.value,entityId:i.id,entityType:s.entityType,entityTitle:i.name}],communicationsLoaded:true})}else{top.location.href="mailto:"+e.value}}},showManyContacts:function(t,e){var i=[];var a=[];if(Array.isArray(t)){t={0:t}}for(var n in t){if(n==="company"||n==="contact"){i.push({delimiter:true,text:this.getMessage(n)})}a=t[n];for(var s=0,r=a.length;s<r;s++){var c="";var o="";var l=this.getData();if(n==="company"){c="CRM_COMPANY";o=l.companyId}else if(n==="contact"){c="CRM_CONTACT";o=l.contactId}i.push({value:a[s]["value"],type:e,clientType:c,clientId:o,text:a[s]["value"]+" ("+a[s]["title"]+")",onclick:BX.proxy(this.clickContactItem,this)})}}BX.PopupMenu.show("kanban_contact_menu_"+e+this.getId(),BX.proxy_context,i,{autoHide:true,zIndex:1200,offsetLeft:20,angle:true,closeByEsc:true,events:{onPopupClose:function(){BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))},showSingleContact:function(t,e){var i=this.getSingleContactCategory(t);if(!Array.isArray(i)){i=[i]}this.clickContactItem(0,{value:typeof i[0]["value"]!=="undefined"?i[0]["value"]:i[0],type:e})},getSingleContactCategory:function(t){return typeof t==="object"?t[Object.keys(t)[0]]:t},getMessage:function(t){return BX.CRM.Kanban.Item.messages[t]||""},selectPlannerMenu:function(t,e){BX.onCustomEvent("Crm.Kanban:selectPlannerMenu");var i=this.getGridData();if(e.type==="meeting"||e.type==="call"){(new BX.Crm.Activity.Planner).showEdit({TYPE_ID:BX.CrmActivityType[e.type],OWNER_TYPE:i.entityType,OWNER_ID:this.getId()})}else if(e.type==="task"){if(typeof window["taskIFramePopup"]!=="undefined"){var a={UF_CRM_TASK:[BX.CrmOwnerTypeAbbr.resolve(i.entityType)+"_"+this.getId()],TITLE:"CRM: ",TAGS:"crm"};window["taskIFramePopup"].add(a)}}else if(e.type==="visit"){var n=i.visitParams;n.OWNER_TYPE=i.entityType;n.OWNER_ID=this.getId();BX.CrmActivityVisit.create(n).showEdit()}var s=BX.PopupMenu.getCurrentMenu();if(s){s.close()}},getPlannerMenu:function(){var t=this.getGrid().getData();return[{type:"call",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_CALL"),onclick:BX.delegate(this.selectPlannerMenu,this)},{type:"meeting",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_MEETING"),onclick:BX.delegate(this.selectPlannerMenu,this)},t.rights.canUseVisit?{type:"visit",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_VISIT"),onclick:BX.delegate(this.selectPlannerMenu,this)}:null,{type:"task",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_TASK"),onclick:BX.delegate(this.selectPlannerMenu,this)}]},showPlannerMenu:function(t){var e=BX.PopupMenu.create("kanban_planner_menu_"+this.getId(),t.isNode?t:this.activityPlan,this.getPlannerMenu(),{className:"crm-kanban-planner-popup-window",autoHide:true,offsetLeft:50,angle:true,overlay:{backgroundColor:"transparent",opacity:"0"},events:{onPopupClose:function(){BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this));e.destroy()}.bind(this)}});BX.addCustomEvent(window,"Crm.Kanban:selectPlannerMenu",function(){e.destroy()});e.show();BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))},switchPlanner:function(){var t=this.getData();var e=this.getColumn();var i=e.getData();if(t.activityProgress>0){this.switchVisible(this.activityExist,true);this.switchVisible(this.activityEmpty,false);this.setActivityExistInnerHtml()}else{var a=this.getGrid().getData();this.switchVisible(this.activityExist,false);this.switchVisible(this.activityPlan,true);this.switchVisible(this.activityEmpty,true);if(a.reckonActivitylessItems&&a.userId==t.assignedBy){this.activityEmpty.innerHTML=BX.message("CRM_KANBAN_ACTIVITY_MY")+(i.type==="PROGRESS"?" <span>1</span>":"")}else{this.activityEmpty.innerHTML=BX.message("CRM_KANBAN_ACTIVITY_MY")}}},setActivityExistInnerHtml:function(){if(this.activityExist!==undefined){var t=this.getData();var e=this.getColumn();var i=e.getData();this.activityExist.innerHTML=BX.message("CRM_KANBAN_ACTIVITY_MY")+(t.activityErrorTotal&&i.type==="PROGRESS"?" <span>"+t.activityErrorTotal+"</span>":"")}},showTooltip:function(t,e,i){this.popupTooltip=new BX.PopupWindow("kanban_tooltip",BX.proxy_context,{className:i?"crm-kanban-without-tooltip crm-kanban-without-tooltip-white":"crm-kanban-without-tooltip crm-kanban-tooltip-animate",offsetLeft:14,darkMode:i?false:true,overlay:i?{background:"black",opacity:0}:null,closeByEsc:true,angle:true,autoHide:true,content:t,events:{onPopupClose:function(){BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this));this.popupTooltip.show()},hideTooltip:function(){this.popupTooltip.destroy()},createShadow:function(){return BX.create("div",{props:{className:"crm-kanban-item-shadow"}})},removeHoverClass:function(t){BX.removeClass(t,"crm-kanban-item-event");BX.removeClass(t,"crm-kanban-item-hover")},adjustPopup:function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t){if(e){var e=BX.PopupMenu.getCurrentMenu();t=e.getPopupWindow()}}if(t){t.adjustPosition()}},onDragDrop:function(t,e,i){this.dropChangedInPullRequest();this.hideDragTarget();var a,n,s;a=this.getGrid().getItemByElement(t);a.dropChangedInPullRequest();n=new BX.Kanban.DragEvent;n.setItem(a);n.setTargetColumn(this.getColumn());n.setTargetItem(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[n]);if(!n.isActionAllowed()){return}s=this.getGrid().moveItem(a,this.getColumn(),this);if(s){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[a,this.getColumn(),this])}if(a.getColumn().getId()===this.getColumn().getId()){this.getGrid().resetMultiSelectMode();this.getGrid().cleanSelectedItems()}},onDragStart:function(){if(this.dragElement){return}if(!this.checked||this.grid.getChecked().length===1){this.grid.resetMultiSelectMode()}var t,e;if(this.grid.getChecked().length>1){var i=this.grid.getChecked().reverse();this.dragElement=BX.create("div",{props:{className:"main-kanban-item-drag-multi"}});for(var a=0;a<i.length&&a<3;a++){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStart",[i[a]]);var n=i[a].getContainer().cloneNode(true);n.style.width=i[a].getContainer().offsetWidth+"px";this.getContainer().maxHeight=i[0].getContainer().offsetHeight+"px";this.dragElement.appendChild(n)}for(var a=0;a<i.length;a++){i[a].getContainer().classList.add("main-kanban-item-disabled")}document.body.appendChild(this.dragElement);return}BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStart",[this]);t=this.getContainer();e=this.getBodyContainer();this.getContainer().classList.add("main-kanban-item-disabled");this.dragElement=t.cloneNode(true);this.dragElement.style.position="absolute";this.dragElement.style.width=e.offsetWidth+"px";this.dragElement.className="main-kanban-item main-kanban-item-drag";document.body.appendChild(this.dragElement)},makeDroppable:function(){if(!this.isDroppable()){return}var t=this.getContainer();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);t.onbxdestdragstop=BX.delegate(this.onItemDragEnd,this);jsDD.registerDest(t,5);if(this.getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){this.disableDropping()}},getContactInfo:function(t){var e=this.getData();return e[t]},getStageId:function(){return this.getData().stageId},animate:function(t){var e=t.duration;var i=t.draw;var a=t.timing||function(t){return t};var n=t.useAnimation&&!this.isAnimationInProgress||false;var s=performance.now();return new Promise(function(t,r){if(!n){this.isAnimationInProgress=false;return t()}var c=this;c.isAnimationInProgress=true;requestAnimationFrame(function n(r){var o=(r-s)/e;if(o>1){o=1}var l=a(o);i(l);if(o<1){requestAnimationFrame(n)}if(l===1){c.isAnimationInProgress=false;t()}}.bind(this))}.bind(this))},setChangedInPullRequest:function(){this.changedInPullRequest=true},dropChangedInPullRequest:function(){this.changedInPullRequest=false},isChangedInPullRequest:function(){return this.changedInPullRequest===true}}})();
//# sourceMappingURL=item.map.js