(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Actions={startCallList:function(e,t){if(typeof BX.CrmCallListHelper==="undefined"){return}if(typeof t==="undefined"){t=true}var i=e.getData();BX.CrmCallListHelper.createCallList({entityType:i.entityType,entityIds:e.getCheckedId(),createActivity:t},function(e){if(!BX.type.isPlainObject(e)){return}if(!e.SUCCESS&&e.ERRORS){var i=e.ERRORS.join(". \n");BX.Kanban.Utils.showErrorDialog(i)}else if(e.SUCCESS&&e.DATA){var n=e.DATA;if(n.RESTRICTION){if(B24.licenseInfoPopup){B24.licenseInfoPopup.show("ivr-limit-popup",n.RESTRICTION.HEADER,n.RESTRICTION.CONTENT)}}else{var a=n.ID;if(t&&BXIM){BXIM.startCallList(a,{})}else{(new BX.Crm.Activity.Planner).showEdit({PROVIDER_ID:"CALL_LIST",PROVIDER_TYPE_ID:"CALL_LIST",ASSOCIATED_ENTITY_ID:a})}}}})},notifySimpleAction:function(e,t){if(e==="DEAL_CHANGECATEGORY"){e="DEAL_CHANGECATEGORY_LINK"}e="CRM_KANBAN_NOTIFY_"+e;if(typeof BX.message[e]!=="undefined"){var i=BX.message[e];if(BX.type.isPlainObject(t)){for(var n in t){i=i.replace("#"+n+"#",t[n])}}BX.UI.Notification.Center.notify({content:i})}},simpleAction:function(e,t,i){if(t.action==="delete"&&BX.type.isArray(t["id"])){for(var n=0,a=t["id"].length;n<a;n++){e.hideItem(t["id"][n])}}e.ajax(t,function(n){var a=e.getData();if(n&&!n.error){if(!i){e.onApplyFilter()}e.stopActionPanel();var o=a.entityType;if(t.action==="delete"&&t.ignore==="Y"){o+="_IGNORE"}else{o+="_"+t.action.toUpperCase()}if(i!==true){this.notifySimpleAction(o,t)}}else if(n){if(t.action==="status"){e.stopActionPanel();e.onApplyFilter();if(a.entityType==="LEAD"||a.entityType==="DEAL"){BX.Kanban.Utils.showErrorDialog(BX.message("CRM_KANBAN_SET_STATUS_NOT_COMPLETED_TEXT_"+a.entityType))}else{BX.Kanban.Utils.showErrorDialog(n.error,n.fatal)}}else{BX.Kanban.Utils.showErrorDialog(n.error,n.fatal)}}}.bind(this),function(e){BX.Kanban.Utils.showErrorDialog("Error: "+e,true)}.bind(this))},setAssigned:function(e,t){this.simpleAction(e,{action:"setAssigned",ids:e.getCheckedId(),assignedId:t.entityId,assignedName:t.name},false)},changeCategory:function(e,t){var i=e.getData();var n="";if(i.linksPath&&i.linksPath.dealCategory&&i.linksPath.dealCategory.url){n=i.linksPath.dealCategory.url;n=n.replace("#category_id#",t.ID)}this.simpleAction(e,{action:"changeCategory",id:e.getCheckedId(),category:t.ID,categoryName:BX.util.htmlspecialchars(t.NAME),categoryLink:n},false)},changeColumn:function(e,t){var i=e.getData();e.firstRenderComplete=false;this.simpleAction(e,{action:"status",entity_id:e.getCheckedId(),status:t.id,statusName:BX.util.htmlspecialchars(t.name),entity_type:i.entityType},false)},delete:function(e,t){this.simpleAction(e,{action:"delete",id:t?t:e.getCheckedId()},true)},deleteAll:function(e){this.confirm(BX.message("CRM_KANBAN_PANEL_ACTION_CONFIRM"),function(){this.simpleAction(e,{action:"delete",id:e.getCheckedId()},false)}.bind(this))},open:function(e,t){if(typeof t==="undefined"){t=false}this.simpleAction(e,{action:"open",id:e.getCheckedId(),flag:t?"Y":"N"},false)},ignore:function(e,t){this.confirm(BX.message("CRM_KANBAN_PANEL_ACTION_CONFIRM"),function(){this.simpleAction(e,{action:"delete",ignore:"Y",id:e.getCheckedId()},false)}.bind(this))},refreshaccount:function(e){this.simpleAction(e,{action:"refreshAccount",id:e.getCheckedId()},false)},email:function(e){if(BX.CrmActivityEditor&&BX.CrmActivityProvider&&BX.CrmActivityEditor.items["kanban_activity_editor"]){var t=e.getData();var i=[];var n=e.getCheckedId();for(var a=0,o=n.length;a<o;a++){i.push({type:"EMAIL",entityId:n[a],entityType:t.entityType})}BX.CrmActivityEditor.items["kanban_activity_editor"].addEmail({communications:i,communicationsLoaded:true})}},task:function(e){if(typeof window["taskIFramePopup"]!=="undefined"){var t=e.getData();var i="";var n=e.getCheckedId();for(var a=0,o=n.length;a<o;a++){i+=BX.CrmOwnerTypeAbbr.resolve(t.entityType)+"_"+n[a]+";"}window["taskIFramePopup"].add({UF_CRM_TASK:i,TITLE:"CRM: ",TAGS:"crm"})}},confirm:function(e,t){var i=BX.PopupWindowManager.create("crm-kanban-confirm-dialog",null,{titleBar:BX.message("CRM_KANBAN_CONFIRM_TITLE"),content:"",width:400,autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true}});i.setContent(e);i.setButtons([,new BX.PopupWindowButton({text:BX.message("CRM_KANBAN_CONFIRM_Y"),className:"popup-window-button-accept",events:{click:function(){t();this.popupWindow.close()}}}),new BX.PopupWindowButton({text:BX.message("CRM_KANBAN_CONFIRM_N"),className:"popup-window-button-cancel",events:{click:function(){this.popupWindow.close()}}})]);i.show();return i}}})();
//# sourceMappingURL=actions.map.js