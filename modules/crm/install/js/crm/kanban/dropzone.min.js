(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.DropZone=function(e){BX.Kanban.DropZone.apply(this,arguments);this.droppedItems=[]};BX.CRM.Kanban.DropZone.prototype={__proto__:BX.Kanban.DropZone.prototype,constructor:BX.CRM.Kanban.DropZone,onDragDrop:function(e,t,i){var o;var n=this.getGrid().getData();var r=this.getData();this.getGrid().dropZonesShow=true;if(this.getGrid().getChecked().length>1&&(n.entityType==="LEAD"&&r.type==="WIN"||n.entityType==="INVOICE")){this.getGrid().getPopupCancel(BX.message("CRM_KANBAN_MASS_CONVERT_DISABLE")).show();if(this.getGrid().getChecked().length>0){for(var s=0;s<this.getGrid().getChecked().length;s++){BX.removeClass(this.getGrid().getChecked()[s].layout.container,"main-kanban-item-disabled")}this.getGrid().resetMultiSelectMode()}return}o=this.getGrid().getItemByElement(e);this.captureItem(o);this.getDropZoneArea().unsetActive();if(this.getGrid().getChecked().length>1){this.droppedItems=this.getGrid().getChecked();for(var s=0;s<this.droppedItems.length;s++){this.getGrid().hideItem(this.droppedItems[s]);if(o!==this.droppedItems[s]){this.droppedItems[s].getColumn().decPrice(this.droppedItems[s].data.price);this.droppedItems[s].getColumn().renderSubTitle()}}}},captureItem:function(e){var t;t=new BX.Kanban.DropZoneEvent;t.setItem(e);t.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemCaptured",[t]);if(!t.isActionAllowed()){return}this.empty();this.droppedItem=e;this.getDropZoneArea().show();this.setCaptured();this.unsetActive();this.animateRemove(e.layout.container);this.getGrid().hideItem(e);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemCaptured",[e,this]);this.captureTimeout=setTimeout(function(){this.empty();this.getDropZoneArea().hide();this.droppedItems=[];this.getGrid().dropZonesShow=false}.bind(this),this.getDropZoneArea().getDropZoneTimeout())},restore:function(){this.getGrid().dropZonesShow=false;if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}var e=new BX.Kanban.DropZoneEvent;if(!e.isActionAllowed()){return}this.unsetActive();this.unsetCaptured();if(this.droppedItems.length>0){this.droppedItems=this.getGrid().getChecked();for(var t=0;t<this.droppedItems.length;t++){e.setItem(this.droppedItems[t]);e.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[e]);this.getGrid().unhideItem(this.droppedItems[t]);if(this.droppedItem!==this.droppedItems[t]){this.droppedItems[t].getColumn().incPrice(this.droppedItems[t].data.price);this.droppedItems[t].getColumn().renderSubTitle()}BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItems[t],this])}this.droppedItem=null;return}e.setItem(this.droppedItem);e.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[e]);this.getGrid().unhideItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItem,this]);this.droppedItem=null},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-dropzone","data-id":this.getId()},children:[this.getNameContainer(),this.getCancelLink(),this.getBgContainer()]});this.makeDroppable();var e=[];for(var t in this.dropZoneArea.dropZones){e.push(this.dropZoneArea.dropZones[t])}if(e.length===1){this.layout.container.style.minWidth="auto";this.layout.container.style.maxWidth="none"}return this.layout.container},makeDroppable:function(){var e=this.getContainer();e.onbxdestdraghover=BX.delegate(this.onDragEnter,this);e.onbxdestdraghout=BX.delegate(this.onDragLeave,this);e.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);jsDD.registerDest(e,4)}}})();
//# sourceMappingURL=dropzone.map.js