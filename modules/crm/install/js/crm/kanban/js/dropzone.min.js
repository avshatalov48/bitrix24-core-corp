(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.DropZone=function(t){BX.Kanban.DropZone.apply(this,arguments);this.droppedItems=[]};BX.CRM.Kanban.DropZone.prototype={__proto__:BX.Kanban.DropZone.prototype,constructor:BX.CRM.Kanban.DropZone,onDragDrop:function(t,e,i){var o;var n=this.getGrid().getData();var r=this.getData();this.getGrid().dropZonesShow=true;if(this.getGrid().getChecked().length>1&&(n.entityType==="LEAD"&&r.type==="WIN"||n.entityType==="INVOICE")){this.getGrid().getPopupCancel(BX.message("CRM_KANBAN_MASS_CONVERT_DISABLE_MSGVER_1")).show();if(this.getGrid().getChecked().length>0){for(var s=0;s<this.getGrid().getChecked().length;s++){BX.removeClass(this.getGrid().getChecked()[s].layout.container,"main-kanban-item-disabled")}this.getGrid().resetMultiSelectMode()}return}var d=this.getGrid().getChecked();o=this.getGrid().getItemByElement(t);this.captureItem(o);this.getDropZoneArea().unsetActive();if(d.length>1&&this.droppedItem){this.droppedItems=d;for(var s=0;s<this.droppedItems.length;s++){this.getGrid().hideItem(this.droppedItems[s]);if(o!==this.droppedItems[s]){this.droppedItems[s].getColumn().decPrice(this.droppedItems[s].data.price);this.droppedItems[s].getColumn().renderSubTitle()}}this.getGrid().resetMultiSelectMode()}},captureItem:function(t){const e=new BX.CRM.Kanban.DropZoneEvent;e.setItem(t);e.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemCaptured",[e]);if(!e.isActionAllowed()){return}this.empty();this.droppedItem=t;this.getDropZoneArea().show();this.setCaptured();this.unsetActive();this.animateRemove(t.layout.container);this.getGrid().hideItem(t);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemCaptured",[t,this,e.groupIds]);this.captureTimeout=setTimeout((()=>{this.empty();this.getDropZoneArea().hide();this.droppedItems=[];this.getGrid().dropZonesShow=false}),this.getDropZoneArea().getDropZoneTimeout())},restore:function(){this.getGrid().dropZonesShow=false;if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}var t=new BX.Kanban.DropZoneEvent;if(!t.isActionAllowed()){return}this.unsetActive();this.unsetCaptured();if(this.droppedItems.length>0){this.droppedItems=this.getGrid().getChecked();for(var e=0;e<this.droppedItems.length;e++){t.setItem(this.droppedItems[e]);t.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[t]);this.getGrid().unhideItem(this.droppedItems[e]);if(this.droppedItem!==this.droppedItems[e]){this.droppedItems[e].getColumn().incPrice(this.droppedItems[e].data.price);this.droppedItems[e].getColumn().renderSubTitle()}BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItems[e],this])}this.droppedItem=null;return}t.setItem(this.droppedItem);t.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[t]);this.getGrid().unhideItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItem,this]);this.droppedItem=null},getContainer:function(){if(this.layout.container!==null){return this.layout.container}var t=[];t.push(this.getNameContainer());if(this.getId()!=="DELETED"){t.push(this.getCancelLink())}t.push(this.getBgContainer());this.layout.container=BX.create("div",{attrs:{className:"main-kanban-dropzone","data-id":this.getId()},children:t});this.makeDroppable();var e=[];for(var i in this.dropZoneArea.dropZones){e.push(this.dropZoneArea.dropZones[i])}if(e.length===1){this.layout.container.style.minWidth="auto";this.layout.container.style.maxWidth="none"}return this.layout.container},makeDroppable:function(){var t=this.getContainer();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);jsDD.registerDest(t,4)},onDragEnter:function(t,e,i){var o=this.getGrid().getItemByElement(t);if(o.isItemMoveDisabled()){return}this.setActive();this.getDropZoneArea().setActive()},empty:function(){if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}this.unsetActive();this.unsetCaptured();BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemEmptied",[this.droppedItem,this]);this.droppedItem=null}};BX.CRM.Kanban.DropZoneEvent=function(t){BX.Kanban.DropZoneEvent.apply(this,t);this.groupIds=[]};BX.CRM.Kanban.DropZoneEvent.prototype={__proto__:BX.Kanban.DropZoneEvent.prototype}})();
//# sourceMappingURL=dropzone.map.js