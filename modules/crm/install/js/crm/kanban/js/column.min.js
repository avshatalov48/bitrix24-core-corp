(function(){BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Column=function(t){BX.Kanban.Column.apply(this,arguments)};BX.CRM.Kanban.Column.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.CRM.Kanban.Column,renderSubtitleTime:6,subtitleNode:null,pathToAdd:null,editorNodeWaiting:null,editorNodeIsBlock:null,editorNodeIsVisible:false,editorNode:null,editorNodeContainer:null,editorNodeCreate:null,editorNodeSelectFields:null,editorNodeSelectPopup:null,editorLoaded:false,editorOpen:false,quickFormSaveButton:null,quickFormCancelButton:null,editorId:null,editor:null,loader:null,isKeyMetaPressed:false,clickStatus:null,cancelEditHandler:null,blockSize:20,canLoadMoreItems:true,getSubTitle:function(){const t=BX.Kanban.Column.prototype.getSubTitle.apply(this);if(!this.getGrid().getTypeInfoParam("isQuickEditorEnabled")&&!this.getGrid().getTypeInfoParam("showTotalPrice")){BX.Dom.addClass(t,"--hidden")}return t},currencyFormat:function(t,e,i){var n="",o;if(typeof BX.Currency==="undefined"){return t}i=!!i;o=BX.Currency.getCurrencyFormat(e);if(!!o&&typeof o==="object"){o.CURRENT_DECIMALS=o.DECIMALS;o.HIDE_ZERO="Y";if(o.HIDE_ZERO==="Y"&&t==parseInt(t,10)){o.CURRENT_DECIMALS=0}n=BX.util.number_format(t,o.CURRENT_DECIMALS,o.DEC_POINT,o.THOUSANDS_SEP);if(i){n=o.FORMAT_STRING.replace(/(^|[^&])#/,"$1"+n)}}return n},decPrice:function(t){if(this.isHiddenTotalSum()||!BX.Type.isNumber(t)){return}const e=this.getData();e.sum=parseFloat(e.sum)-t;this.setData(e)},incPrice:function(t){if(this.isHiddenTotalSum()||!BX.Type.isNumber(t)){return}const e=this.getData();e.sum=parseFloat(e.sum)+t;this.setData(e)},getAddColumnButton:function(){var t=this.getData();if(t.type==="WIN"){this.layout.info.style.marginRight="0";return BX.create("div")}else{return BX.Kanban.Column.prototype.getAddColumnButton.apply(this,arguments)}},getAddPath:function(){if(this.pathToAdd!==null){return this.pathToAdd}var t=this.getGridData();var e=t.entityType.toLowerCase();var i,n;if(e==="invoice"){i="crm_invoice_toolbar"}else if(e==="order"){i="toolbar_order_kanban"}else{i="toolbar_"+e+"_list"}if(BX(i)){n=BX(i).querySelector("a");if(BX.type.isDomNode(n)){this.pathToAdd=n.getAttribute("href");this.pathToAdd+=this.pathToAdd.indexOf("?")===-1?"?":"&"}}return this.pathToAdd},addItem:function(t,e){if(!(t instanceof BX.Kanban.Item)){throw new Error("item must be an instance of BX.Kanban.Item")}if(t.layout.container&&t.layout.container.classList.contains("main-kanban-item-disabled")){BX.removeClass(t.layout.container,"main-kanban-item-disabled")}var i=t.getColumnId();t.setColumnId(this.getId());if(t.checked){t.unSelectItem()}var n=BX.util.array_search(e,this.items);var o=this.getItems();var a=false;for(const e in o){if(o[e].id===t.getId()){o[e]=t;a=true}}if(!a){if(n>=0){this.items.splice(n,0,t)}else{this.items.push(t)}if(t.isCountable()){this.incrementTotal()}}this.setPullItemBackground(t);t.animate({duration:this.getGrid().animationDuration/4,draw:function(e){const i=t.layout.container.scrollHeight*e;t.layout.container.style.height=`${i}px`;t.layout.container.style.zIndex=-1},useAnimation:t.useAnimation}).then((()=>{this.setPullItemBackground(t,"#fff");t.useAnimation=false;const n={height:"auto",opacity:"100%",zIndex:null};BX.Dom.style(t.layout.container,n);const o={item:t,targetColumn:this,beforeItem:e,oldColumn:this.grid.getColumn(i)};BX.Event.EventEmitter.emit("Crm.Kanban.Column:onItemAdded",o)}));if(this.getGrid().isRendered()){this.render()}},addItems:function(t,e){if(!t){t=this.getGrid().getChecked()}var i=[];var n=BX.util.array_search(e,this.items);var o=0;var a=this.getPreviousItemSibling(e);if(a){o=a.getId()}for(var r=0;r<t.length;r++){t[r].visible=true;if(t[r].getColumn()!==this){t[r].getColumn().decPrice(t[r].data.price);t[r].getColumn().renderSubTitle();this.incPrice(t[r].data.price)}if(t[r].layout.container&&t[r].layout.container.classList.contains("main-kanban-item-disabled")){BX.removeClass(t[r].layout.container,"main-kanban-item-disabled")}t[r].setColumnId(this.getId());if(t[r].checked){t[r].unSelectItem()}var s=BX.util.array_search(t[r],this.items);if(e){if(s>=0){this.items.splice(s,0,t[r])}else{this.items.splice(n,0,t[r])}}else{this.items.splice(this.items.length,0,t[r])}if(t[r].isCountable()){this.incrementTotal()}t[r].parentColumn=null;i.push(t[r].getId())}const d=this.getId();const u={action:"status",entity_id:i,prev_entity_id:o,status:d};this.getGrid().ajax(u,(t=>{this.prepareGridAfterItemsAdded(i,t)}),(t=>{BX.Kanban.Utils.showErrorDialog(`Error: ${t}`,true)}));if(this.getGrid().isRendered()){const t=[];for(const e in this.items){if(!BX.util.in_array(this.items[e].id,t)){t.push(this.items[e].id)}}this.render()}},prepareGridAfterItemsAdded:function(t,e){if(!BX.Type.isObjectLike(e)){return}const{grid:i}=this;if(i.hasResponseError(e)){i.clearItemMoving();i.rollbackItemsMovement(t,this.getId());i.showResponseError(e);return}if(e.isShouldUpdateCard){const e=!Array.isArray(t)||t.length<=1;void this.getGrid().loadNew(t,false,true,true,e)}},hasLoading:function(){if(!this.getGrid().getData().skipColumnCountCheck){return BX.Kanban.Column.prototype.hasLoading.call(this)}if(!this.canLoadMoreItems){this.showTotalCount();return false}return BX.Kanban.Column.prototype.getItemsCount.call(this)>0},onDragDrop:function(t,e,i){this.hideDragTarget();var n,o;var a=this.getGrid().getItemByElement(t);n=new BX.Kanban.DragEvent;n.setItem(a);n.setTargetColumn(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[n]);if(!n.isActionAllowed()){return}o=this.getGrid().moveItem(a,this);if(o){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[a,this,null])}},processQuickEditor:function(){this.editor.save()},resetQuickEditor:function(){this.editorNodeContainer.style.height=this.editorNodeContainer.offsetHeight+"px";this.editorNodeContainer.innerHTML=""},getQuickEditor:function(){return this.editor},showQuickEditor:function(t){if(!t){this.editorOpen=true}this.getBody().scrollTop=0;var e=this.getGridData();var i=e.entityType;var n=e.params.CATEGORY_ID?parseInt(e.params.CATEGORY_ID):0;this.editorId="quick_editor_v6_"+this.getId()+"_"+i.toLowerCase()+"_"+n;if(!this.getGrid().getTypeInfoParam("isQuickEditorEnabled")){return}var o=this.getGrid().getTypeInfoParam("useFactoryBasedApproach");if(typeof e.quickEditorPath[i.toLowerCase()]==="undefined"&&!o){return}var a=e.params;a["VIEW_MODE"]=e.viewMode;var r={PARAMS:a};r[this.getGrid().getTypeInfoParam("stageIdKey")]=this.getId();var s=this.getGrid().getTypeInfoParam("defaultQuickFormFields");if(!this.editorNodeContainer.innerHTML){if(!t){this.layout.subTitleAddButton.classList.add("crm-kanban-column-add-item-button-wait");this.disabledAddButton()}const n={data:BX.Crm.Integration.Analytics.Builder.Entity.AddEvent.createDefault(i).setSubSection(BX.Crm.Integration.Analytics.Dictionary.SUB_SECTION_KANBAN).setElement(BX.Crm.Integration.Analytics.Dictionary.ELEMENT_QUICK_BUTTON).buildData()};if(o){BX.ajax.runAction("crm.api.item.getEditor",{data:{entityTypeId:e.entityTypeInt,id:0,stageId:this.getId(),categoryId:e.params.CATEGORY_ID?e.params.CATEGORY_ID:0,guid:this.editorId,configId:e.editorConfigId,viewMode:e.viewMode,params:{ENABLE_PERSONAL_CONFIGURATION_UPDATE:true,ENABLE_COMMON_CONFIGURATION_UPDATE:true,ENABLE_CONFIG_SCOPE_TOGGLE:true,ENABLE_SETTINGS_FOR_ALL:true,ANALYTICS_CONFIG:n}}}).then(function(e){var i=BX.processHTML(e.data.html);this.editorNodeContainer.innerHTML=e.data.html;this.editorNodeContainer.appendChild(this.editorNodeCreate);this.editorNode.style.height="0px";BX.ajax.processScripts(i.SCRIPT,undefined,function(){var e=setInterval(function(){if(this.editorNodeContainer.offsetHeight<150){return}if(!this.editorOpen){this.layout.subTitleAddButton.classList.remove("crm-kanban-column-add-item-button-wait");return}if(t){return}this.editorNode.style.height=this.editorNodeContainer.offsetHeight+"px";this.layout.subTitleAddButton.classList.remove("crm-kanban-column-add-item-button-wait");var i=function(){this.editorNode.style.height=null;BX.unbind(this.editorNode,"transitionend",i)}.bind(this);BX.bind(this.editorNode,"transitionend",i);clearInterval(e)}.bind(this),100)}.bind(this))}.bind(this))}else{BX.ajax.post(e.quickEditorPath[i.toLowerCase()],{ACTION:"PREPARE_EDITOR_HTML",ACTION_ENTITY_TYPE_NAME:i,ACTION_ENTITY_ID:0,GUID:this.editorId,CONFIG_ID:e.editorConfigId,FORCE_DEFAULT_CONFIG:"N",FORCE_DEFAULT_OPTIONS:"Y",IS_EMBEDDED:"Y",ENABLE_CONFIG_SCOPE_TOGGLE:"Y",ENABLE_CONFIGURATION_UPDATE:"Y",ENABLE_REQUIRED_USER_FIELD_CHECK:"Y",ENABLE_FIELDS_CONTEXT_MENU:"N",FIELDS:s,CONTEXT:r,ANALYTICS_CONFIG:n},function(e){this.editorNodeContainer.innerHTML=e;this.editorNodeContainer.appendChild(this.editorNodeCreate);if(!this.editorOpen){this.layout.subTitleAddButton.classList.remove("crm-kanban-column-add-item-button-wait");return}if(t){return}this.editorNode.style.height="0px";var i=setInterval(function(){if(this.editorNodeContainer.offsetHeight<150){return}this.editorNode.style.height=this.editorNodeContainer.offsetHeight+"px";this.layout.subTitleAddButton.classList.remove("crm-kanban-column-add-item-button-wait");var t=function(){this.editorNode.style.height=null;BX.unbind(this.editorNode,"transitionend",t)}.bind(this);BX.bind(this.editorNode,"transitionend",t);clearInterval(i)}.bind(this),100)}.bind(this))}}else{this.getLoader().hide();this.hideQuickEditorLoader()}if(!this.editorLoaded){BX.addCustomEvent(window,"BX.Crm.EntityEditor:onInit",function(t,e){if(t.getId()===this.editorId){this.editor=t}}.bind(this));BX.addCustomEvent(window,"onCrmEntityCreateError",(({error:t,checkErrors:e})=>{this.hideQuickEditorLoader();if(BX.type.isUndefined(t)){return}if(BX.type.isObject(e)){this.openQuickFormPartialEditor(Object.keys(e))}else if(BX.type.isStringFilled(t)){BX.UI.Notification.Center.notify({content:BX.Text.encode(t.replaceAll("<br />","\n")),autoHideDelay:5e3})}}));if(!this.cancelEditHandler){this.cancelEditHandler=function(t){this.hideQuickEditorLoader()}.bind(this);BX.addCustomEvent(window,"BX.Crm.EntityEditor:onFailedValidation",this.cancelEditHandler);BX.addCustomEvent(window,"BX.Crm.EntityEditor:onRestrictionAction",this.cancelEditHandler)}BX.addCustomEvent(window,"BX.Crm.EntityEditorAjax:onSubmitFailure",function(t){if(this.editorOpen){this.quickFormSaveButton.classList.remove("ui-btn-wait");this.editorNode.classList.remove("crm-kanban-quick-form-wait");var e="";var i=[];for(var n in t){if(t.hasOwnProperty(n)&&t[n].message){if(t[n].code==="CRM_FIELD_ERROR_REQUIRED"&&t[n].customData&&t[n].customData.fieldName){i.push(t[n].customData.fieldName)}e+=t[n].message+", "}}if(i.length>0){this.openQuickFormPartialEditor(i)}else{BX.Kanban.Utils.showErrorDialog(BX.Text.encode(e),true)}}}.bind(this));BX.addCustomEvent(window,"onCrmEntityCreate",function(t){var e=t.sender.getContext();var i=this.getGrid().getTypeInfoParam("stageIdKey");if(e[i]===this.getId()){this.getGrid().loadNew(t.entityId,true,false,false,true)}if(this.editorOpen){this.hideQuickEditorLoader();t.isCancelled=true}}.bind(this));var d=this;BX.addCustomEvent("CRM.Kanban.Column:clickAddButton",(function(){if(d!==this){d.hideQuickFormEditor();d.enabledAddButton();d.cleanEditor()}}));BX.bind(window,"keydown",function(t){if(t.code==="MetaRight"||t.code==="MetaLeft"||t.code==="ControlRight"||t.code==="ControlLeft"){this.isKeyMetaPressed=true}}.bind(this));BX.bind(window,"keyup",function(t){const e=["MetaRight","MetaLeft","ControlRight","ControlLeft"];if(e.includes(t.code)){this.isKeyMetaPressed=false}}.bind(this));BX.bind(window,"keydown",function(t){if((t.code==="Enter"||t.code==="NumpadEnter")&&this.isKeyMetaPressed&&this.editorOpen){this.processQuickEditor();this.showQuickEditorLoader();BX.PreventDefault(t)}}.bind(this));BX.addCustomEvent(window,"BX.CRM.Kanban.Item.select",this.hideQuickFormEditor.bind(this));BX.addCustomEvent(window,"BX.CRM.Kanban.Item.select",this.enabledAddButton.bind(this));BX.addCustomEvent(window,"onCrmEntityCreate",this.hideQuickFormEditor.bind(this));BX.addCustomEvent(window,"Kanban.Column:render",this.enabledAddButton.bind(this));BX.addCustomEvent(window,"Kanban.Grid:onItemDragStart",this.enabledAddButton.bind(this));BX.addCustomEvent(window,"Kanban.Grid:onItemDragStart",function(){if(this.editorOpen){BX.bind(this.editorNode,"transitionend",function(){for(var t=0;t<this.items.length;t++){this.items[t].makeDroppable()}}.bind(this))}this.hideQuickFormEditor();this.enabledAddButton()}.bind(this))}this.editorLoaded=true;this.layout.items.insertBefore(this.editorNode,this.layout.items.firstChild)},openQuickFormPartialEditor:function(t){if(!this.editorOpen||this.quickFormPartialEditor&&this.quickFormPartialEditor._isLocked){return}var e=new FormData(this.editor._ajaxForm._elementNode),i={};var n=e.entries(),o=n.next(),a;while(!o.done){a=o.value;if(i[a[0]]===undefined){i[a[0]]=[]}i[a[0]].push(a[1]);o=n.next()}var r=this.grid.getData();var s={};s[this.getGrid().getTypeInfoParam("stageIdKey")]=this.id;s["NOT_CHANGE_STATUS"]="Y";var d={entityTypeId:r.entityTypeInt,entityId:0,fieldNames:t,context:s,values:[],presetValues:i,analyticsConfig:{data:BX.Crm.Integration.Analytics.Builder.Entity.AddEvent.createDefault(r.entityType).setSubSection(BX.Crm.Integration.Analytics.Dictionary.SUB_SECTION_KANBAN).setElement(BX.Crm.Integration.Analytics.Dictionary.ELEMENT_FILL_REQUIRED_FIELDS_POPUP).buildData()}};if(this.getGrid().getTypeInfoParam("useFactoryBasedApproach")){d.title=BX.message("CRM_TYPE_ITEM_PARTIAL_EDITOR_TITLE");d.isController=true;d.entityTypeName=r.entityType;d.stageId=this.getId()}else{d.title=BX.message("CRM_KANBAN_REQUIRED_FIELDS_TITLE_"+r.entityType)}this.quickFormPartialEditor=BX.Crm.QuickFormPartialEditorDialog.create("quickform-partial-entity-editor",d);this.quickFormPartialEditor.open()},isEditorOpen:function(){return this.editorOpen},showQuickEditorLoader:function(){this.quickFormSaveButton.classList.add("ui-btn-wait");this.editorNode.classList.add("crm-kanban-quick-form-wait")},hideQuickEditorLoader:function(){this.quickFormSaveButton.classList.remove("ui-btn-wait");this.editorNode.classList.remove("crm-kanban-quick-form-wait")},hideQuickFormEditor:function(){if(!this.editorOpen){return}this.editorOpen=false;this.editorNode.style.height=this.editorNode.offsetHeight+"px";setTimeout(function(){this.editorNode.style.height="0px"}.bind(this),10)},disabledAddButton:function(){BX.addClass(this.layout.subTitleAddButton,"crm-kanban-column-add-item-button-event")},enabledAddButton:function(){BX.removeClass(this.layout.subTitleAddButton,"crm-kanban-column-add-item-button-event")},isQuickFormPopup:function(t){return BX.findParent(t,{className:"popup-window"})},isBoundToDocument:function(t){return!!t.closest("body")},isQuickFormEditor:function(t){return BX.findParent(t,{className:"ui-entity-editor-column-content"})},renderSubTitle:function(){if(this.canAddItem===null){this.canAddItem=true}this.createSubTitlePrice();if(this.subtitleNode){return this.subtitleNode}let t="";let e=true;const i=this.getData();const n=this.getGridData();if(i.sort===100&&this.getGrid().getTypeInfoParam("hasPlusButtonTitle")){t=n.isDynamicEntity?BX.message("CRM_KANBAN_PLUS_TITLE_DYNAMIC"):BX.message(`CRM_KANBAN_PLUS_TITLE_${n.entityType}`)||BX.message(`CRM_KANBAN_PLUS_TITLE_${n.entityType}_MSGVER_1`)}if(e){this.editorNode=BX.create("div",{props:{className:"crm-kanban-quick-form"},style:{height:"0px"},children:[this.editorNodeContainer=BX.create("div",{props:{className:"crm-kanban-quick-form-container"}})]});this.editorNodeCreate=BX.create("div",{props:{className:"crm-kanban-quick-form-buttons"},children:[this.quickFormSaveButton=BX.create("input",{attrs:{type:"button",value:BX.message("CRM_KANBAN_POPUP_SAVE"),className:"ui-btn ui-btn-xs ui-btn-primary"},events:{click:function(t){this.processQuickEditor();this.showQuickEditorLoader();BX.PreventDefault(t)}.bind(this)}}),this.quickFormCancelButton=BX.create("input",{attrs:{type:"button",value:BX.message("CRM_KANBAN_CONFIRM_N"),className:"ui-btn ui-btn-xs ui-btn-link"},events:{click:function(){this.enabledAddButton();this.hideQuickFormEditor();this.cleanEditor()}.bind(this)}})]})}var o=this.getGrid().getTypeInfoParam("stageIdKey");o=o.toLowerCase();if(this.canAddItem&&this.getGrid().getTypeInfoParam("isQuickEditorEnabled")){this.layout.subTitleAddButton=BX.create("div",{text:t,attrs:{className:"crm-kanban-column-add-item-button"},events:{click:e?function(t){const e=n.tariffRestrictions||{};if(e.addItemNotPermittedByTariff===true){BX.Crm.Router.Instance.showFeatureSlider();return}if(document.getElementsByTagName("html")[0].classList.contains("bx-ie")){if(n.entityType==="LEAD"){BX.SidePanel.Instance.open("/crm/lead/details/0/?category_id="+n.params.CATEGORY_ID)}else if(n.entityType==="DEAL"){BX.SidePanel.Instance.open("/crm/deal/details/0/")}return}if(BX.hasClass(this.layout.subTitleAddButton,"crm-kanban-column-add-item-button-event")){return}this.disabledAddButton();if(!this.editorNodeContainer.innerHTML){var i=this.getGrid().getColumns();for(var o=0;o<i.length;o++){if(i[o]!==this){if(i[o].editor){i[o].editor.release();i[o].editor=null;i[o].editorOpen=false;i[o].editorLoaded=false;BX.cleanNode(i[o].editorNodeContainer)}i[o].hideQuickFormEditor();i[o].enabledAddButton();i[o].cleanEditor()}}this.showQuickEditor();return}BX.onCustomEvent(this,"CRM.Kanban.Column:clickAddButton",this);if(!this.editorNode.parentNode){this.layout.items.insertBefore(this.editorNode,this.layout.items.firstElementChild)}this.getBody().scrollTop=0;this.editorNode.style.height="0px";this.editorOpen=true;setTimeout(function(){this.editorNode.style.height=this.editorNodeContainer.offsetHeight+"px";var t=function(){this.editorNode.style.height=null;BX.unbind(this.editorNode,"transitionend",t)}.bind(this);BX.bind(this.editorNode,"transitionend",t);if(this.editor){this.editor.refreshLayout({reset:true})}}.bind(this),10)}.bind(this):null}})}else if(this.canAddItem){this.layout.subTitleAddButton=this.getAddPath()?BX.create("a",{text:t,attrs:{className:"crm-kanban-column-add-item-button",href:this.getAddPath()+o+"="+this.getId()}}):null}else if(this.isShowHiddenAddItemButton()){this.layout.subTitleAddButton=BX.Tag.render`
					<div class="crm-kanban-column-add-item-button--dummy"</div>
				`}this.subtitleNode=BX.create("div",{children:[this.layout.subTitlePrice,e?this.layout.subTitleAddButton:this.getAddPath()?BX.create("a",{text:t,attrs:{className:"crm-kanban-column-add-item-button",href:this.getAddPath()+o+"="+this.getId()}}):null,this.editorNode]});return this.subtitleNode},createSubTitlePrice:function(){this.createSubTitlePriceLayout();this.renderSubTitlePrice()},createSubTitlePriceLayout:function(){const t=this.getGrid().getTypeInfoParam("showTotalPrice");if(t&&!this.layout.subTitlePrice){this.layout.subTitlePriceText=BX.Tag.render`<span class="crm-kanban-total-price-total"></span>`;this.layout.subTitlePrice=BX.Tag.render`<div class="crm-kanban-total-price">`;BX.Dom.append(this.layout.subTitlePriceText,this.layout.subTitlePrice)}else if(!t){this.layout.subTitlePrice=null}if(this.isHiddenTotalSum()){const{subTitlePriceText:t}=this.layout;BX.Event.unbindAll(t,"mouseenter");BX.Event.unbindAll(t,"mouseleave");BX.Event.bind(t,"mouseenter",this.onSubTitlePriceMouseEnter.bind(this));BX.Event.bind(t,"mouseleave",this.onSubTitlePriceMouseLeave.bind(this))}},onSubTitlePriceMouseEnter:function(){this.columnSumPopup=BX.PopupWindowManager.create(this.getHideColumnSumPopupId(),this.layout.subTitlePriceText,{autoHide:true,angle:true,animation:"fading",darkMode:true,offsetTop:-10,offsetLeft:this.layout.subTitlePriceText.offsetWidth/2,content:BX.Loc.getMessage("CRM_KANBAN_COLUMN_HIDDEN_SUM"),bindOptions:{position:"top"},params:{angleLeftOffset:200}});this.columnSumPopup.show()},getHideColumnSumPopupId(){return`kanban-column-${this.getId()}-hidden-sum-popup`},onSubTitlePriceMouseLeave:function(){this.columnSumPopup.close()},renderSubTitlePrice:function(){if(!this.layout.subTitlePriceText){return}if(this.isHiddenTotalSum()){this.renderHiddenTotalSum()}else{this.animateChangeSubTitlePrice()}},renderHiddenTotalSum:function(){if(!this.layout.subTitlePriceText||!this.isHiddenTotalSum()){return}const{currencyFormat:t}=this.getData();this.layout.subTitlePriceText.innerHTML=`***** ${t}`},animateChangeSubTitlePrice:function(){const t=this.getData();t.sum=parseFloat(t.sum);t.sum_init=t.sum;t.sum_old=t.sum_old?t.sum_old:t.sum_init;if(this.subTitleAnimationInterval){clearInterval(this.subTitleAnimationInterval)}const e=this.getGridData().currency;this.subTitleAnimationInterval=this.renderSubTitleAnimation(t.sum_old,t.sum,Math.abs(t.sum_old-t.sum)/20,this.layout.subTitlePriceText,((i,n)=>{i.innerHTML=this.currencyFormat(Math.round(n),e,true);t.sum_old=t.sum}));this.setData(t)},isHiddenTotalSum:function(){const{hiddenTotalSum:t}=this.getData();return Boolean(t)},isShowHiddenAddItemButton:function(){const t=this.getGrid().getColumns();return t.some((t=>t.canAddItem))},cleanEditorNode:function(){BX.cleanNode(this.editorNodeContainer)},cleanEditor:function(){if(this.editor){this.editor.rollback();this.editor.refreshLayout()}},getLoader:function(){if(!this.loader){this.loader=new BX.Loader({target:this.editorNode})}return this.loader},renderSubTitleAnimation:function(t,e,i,n,o){var a=t;var r=parseFloat(e);var s=this.renderSubtitleTime;if(a===r){if(typeof o==="function"){o(n,e)}return null}var d=t>e?"minus":"plus";var u=function(t){return d==="plus"?e<t:e>t};if(t>r){i=-1*i}var l=setInterval((function(){n.textContent=BX.util.number_format(a,0,","," ");a+=i;if(u(a)){clearInterval(l);this.subTitleAnimationInterval=null;o(n,e)}}),s);return l},handleAddColumnButtonClick:function(t){var e=this.getGridData();if(e.rights&&e.rights.canAddColumn){const t=this.getGrid().addColumn({id:"kanban-new-column-"+BX.util.getRandomString(5),type:"BX.CRM.Kanban.DraftColumn",canSort:false,canAddItem:false,droppable:false,targetId:this.getGrid().getNextColumnSibling(this)});t.switchToEditMode()}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},switchToEditMode:function(){var t=this.getGridData();if(t.rights&&t.rights.canAddColumn){BX.Kanban.Column.prototype.switchToEditMode.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},focusTextBox:function(){setTimeout(function(){this.getTitleTextBox().focus()}.bind(this))},makeDroppable:function(){if(!this.isDroppable()){return}var t=this.getBody();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);t.onbxdestdragstop=BX.delegate(this.onItemDragEnd,this);jsDD.registerDest(t,10);this.disableDropping()},removeItem:function(t){return new Promise(function(e,i){var n=false;this.items=this.items.filter((function(e){if(e===t){n=true;return false}return true}));if(n){const i=t.layout.container.style.opacity*100;const n=i===100?t.useAnimation:false;this.setPullItemBackground(t);t.animate({useAnimation:n,duration:this.getGrid().animationDuration,draw:function(e){const n=i-e*i+"%";t.layout.container.style.opacity=n}}).then(function(i){if(t.isCountable()&&t.isVisible()){this.decrementTotal();this.getGrid().resetMultiSelectMode()}if(this.getGrid().isRendered()){this.render()}e()}.bind(this))}else{e()}}.bind(this))},setPullItemBackground:function(t,e="#fffabf"){if(t.changedInPullRequest&&t.layout.bodyContainer.children[0]){t.layout.bodyContainer.children[0].style.backgroundColor=e}},setLoadingInProgress:function(t=true){this.loadingInProgress=t},setLoadingMoreItem:function(t=true){this.canLoadMoreItems=t},showTotalCount:function(){if(BX.Dom.hasClass(this.layout.total,"--hidden")){this.renderTitle();BX.Dom.removeClass(this.layout.total,"--hidden")}},getTotalItem:function(){const t=BX.Kanban.Column.prototype.getTotalItem.call(this);if(this.getGrid().getData().skipColumnCountCheck){t.classList.add("--hidden")}return t},cleanLayoutItems:function(){var t=Array.from(this.layout.items.childNodes);t.map(function(t,e){if(t.classList.contains("main-kanban-item")){this.layout.items.removeChild(t)}}.bind(this))},hasItem:function(t){return this.items.some((e=>e.id===t))}};BX.CRM.Kanban.DraftColumn=function(t){BX.Kanban.DraftColumn.apply(this,arguments)};BX.CRM.Kanban.DraftColumn.prototype={__proto__:BX.Kanban.DraftColumn.prototype,constructor:BX.CRM.Kanban.DraftColumn,handleRemoveButtonClick:function(t){this.getGrid().getColumns().forEach((function(t){t.getAddColumnButton().style.visibility=null}));BX.Kanban.DraftColumn.prototype.handleRemoveButtonClick.apply(this,arguments)}}})();
//# sourceMappingURL=column.map.js