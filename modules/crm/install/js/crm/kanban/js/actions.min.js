(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Actions={startCallList:function(grid,createActivity){if(typeof BX.CrmCallListHelper==="undefined"){return}if(typeof createActivity==="undefined"){createActivity=true}var gridData=grid.getData();BX.CrmCallListHelper.createCallList({entityType:gridData.entityType,entityIds:grid.getCheckedId(),createActivity:createActivity},function(response){if(!BX.type.isPlainObject(response)){return}if(!response.SUCCESS&&response.ERRORS){var error=response.ERRORS.join(". \n");BX.Kanban.Utils.showErrorDialog(error)}else if(response.SUCCESS&&response.DATA){var data=response.DATA;if(data.RESTRICTION){if(BX.Type.isPlainObject(data.RESTRICTION)&&B24&&B24.licenseInfoPopup){B24.licenseInfoPopup.show("ivr-limit-popup",data.RESTRICTION.HEADER,data.RESTRICTION.CONTENT)}else if(BX.Type.isStringFilled(data.RESTRICTION)){eval(data.RESTRICTION)}}else{var callListId=data.ID;if(createActivity&&BXIM){BXIM.startCallList(callListId,{})}else{(new BX.Crm.Activity.Planner).showEdit({PROVIDER_ID:"CALL_LIST",PROVIDER_TYPE_ID:"CALL_LIST",ASSOCIATED_ENTITY_ID:callListId})}}}})},notifySimpleAction:function(e,t){if(e==="DEAL_CHANGECATEGORY"){e="DEAL_CHANGECATEGORY_LINK"}if(e==="DYNAMIC_CHANGECATEGORY"){e="DYNAMIC_CHANGECATEGORY_LINK"}e="CRM_KANBAN_NOTIFY_"+e;if(typeof BX.message[e]!=="undefined"){var i=BX.message[e];if(BX.type.isPlainObject(t)){for(var n in t){i=i.replace("#"+n+"#",t[n])}}BX.UI.Notification.Center.notify({content:i})}},simpleAction:function(e,t,i){if(e.isMultiSelectMode()){e.resetMultiSelectMode()}return new Promise(function(n,a){e.ajax(t,function(o){var r=e.getData();if(o&&!o.error){if(!i){e.onApplyFilter()}e.stopActionPanel();var s=r.entityType;if(s.indexOf("DYNAMIC")===0){s="DYNAMIC"}if(t.action==="delete"&&t.ignore==="Y"){s+="_IGNORE"}else{s+="_"+t.action.toUpperCase()}if(i!==true){this.notifySimpleAction(s,t)}n(o)}else if(o){if(t.action==="status"){e.stopActionPanel();e.onApplyFilter();if(e.getTypeInfoParam("showPersonalSetStatusNotCompletedText")){var c=r.isDynamicEntity?"CRM_KANBAN_SET_STATUS_NOT_COMPLETED_TEXT_DYNAMIC":"CRM_KANBAN_SET_STATUS_NOT_COMPLETED_TEXT_"+r.entityType;BX.Kanban.Utils.showErrorDialog(BX.message(c));a(new Error(BX.message(c)))}else{BX.Kanban.Utils.showErrorDialog(o.error,o.fatal);a(new Error(o.error))}}else{BX.Kanban.Utils.showErrorDialog(o.error,o.fatal);a(new Error(o.error))}}}.bind(this),function(e){BX.Kanban.Utils.showErrorDialog("Error: "+e,true);a(new Error(e))}.bind(this))}.bind(this))},setAssigned:function(e,t){this.simpleAction(e,{action:"setAssigned",ids:e.getCheckedId(),assignedId:t.entityId,assignedName:t.name},false)},merge:function(e){var t=e.getCheckedId();var i=BX.Crm.BatchMergeManager.getItem(e.getData().gridId);if(i&&!i.isRunning()&&t.length>1){i.setEntityIds(t);i.execute()}},changeCategory:function(e,t){var i="";if(t.url){i=t.url}this.simpleAction(e,{action:"changeCategory",id:e.getCheckedId(),category:t.ID,categoryName:BX.util.htmlspecialchars(t.NAME),categoryLink:i},false)},changeColumn:function(e,t){var i=e.getData();e.firstRenderComplete=false;this.simpleAction(e,{action:"status",entity_id:e.getCheckedId(),status:t.id,statusName:BX.util.htmlspecialchars(t.name),entity_type:i.entityType},false)},delete:function(e,t,i){t=t?t:e.getCheckedId();this.simpleAction(e,{action:"delete",id:t},true).then(function(n){if(i){var a=t.length?i.droppedItems:[i.droppedItem];var o=t.length?BX.message("CRM_KANBAN_DELETE_SUCCESS_MULTIPLE"):BX.message("CRM_KANBAN_DELETE_SUCCESS").replace("#ELEMENT_NAME#",i.droppedItem.data.name);i.empty();i.getDropZoneArea().hide();i.droppedItems=[];e.dropZonesShow=false;e.resetMultiSelectMode();e.resetActionPanel();e.resetDragMode();var r={content:o};if(e.getTypeInfoParam("isRecyclebinEnabled")){r.actions=[{title:BX.message("CRM_KANBAN_DELETE_CANCEL"),events:{click:function(){s.close();BX.ajax.runComponentAction("bitrix:crm.kanban","restore",{mode:"ajax",data:{entityIds:t.length?t:[t],entityTypeId:e.data.entityTypeInt}}).then(function(t){a.forEach(function(t){var i=e.getColumn(t.options.columnId);i.addItem(t)});var i=6e3;BX.UI.Notification.Center.notify({content:BX.message("CRM_KANBAN_DELETE_RESTORE_SUCCESS"),autoHideDelay:i})},function(e){BX.UI.Notification.Center.notify({content:e.errors[0].message})})}}}]}var s=BX.UI.Notification.Center.notify(r)}},function(e){BX.UI.Notification.Center.notify({content:e.errors[0].message})})},deleteAll:function(e){this.confirm(BX.message("CRM_KANBAN_PANEL_ACTION_CONFIRM"),function(){this.simpleAction(e,{action:"delete",id:e.getCheckedId()},false)}.bind(this))},open:function(e,t){if(typeof t==="undefined"){t=false}this.simpleAction(e,{action:"open",id:e.getCheckedId(),flag:t?"Y":"N"},false)},ignore:function(e,t){this.confirm(BX.message("CRM_KANBAN_PANEL_ACTION_CONFIRM"),function(){e.fadeOut();BX.ajax.runComponentAction("bitrix:crm.kanban","excludeEntity",{mode:"ajax",data:{entityType:e.getData().entityType,ids:e.getCheckedId()}}).then(function(t){this.simpleAction(e,{action:"delete",ignore:"Y",id:e.getCheckedId()},false)}.bind(this))}.bind(this))},refreshaccount:function(e){this.simpleAction(e,{action:"refreshAccount",id:e.getCheckedId()},false)},email:function(e){if(BX.CrmActivityEditor&&BX.CrmActivityProvider&&BX.CrmActivityEditor.items["kanban_activity_editor"]){var t=e.getData();var i=[];var n=e.getCheckedId();for(var a=0,o=n.length;a<o;a++){i.push({type:"EMAIL",entityId:n[a],entityType:t.entityType})}BX.CrmActivityEditor.items["kanban_activity_editor"].addEmail({communications:i,communicationsLoaded:true})}},task:function(e){if(typeof window["taskIFramePopup"]!=="undefined"){var t=e.getData();var i="";var n=e.getCheckedId();for(var a=0,o=n.length;a<o;a++){i+=BX.CrmOwnerTypeAbbr.resolve(t.entityType)+"_"+n[a]+";"}window["taskIFramePopup"].add({UF_CRM_TASK:i,TITLE:"CRM: ",TAGS:"crm"})}},confirm:function(e,t){var i=BX.PopupWindowManager.create("crm-kanban-confirm-dialog",null,{titleBar:BX.message("CRM_KANBAN_CONFIRM_TITLE"),content:"",width:400,autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true}});i.setContent(e);i.setButtons([,new BX.PopupWindowButton({text:BX.message("CRM_KANBAN_CONFIRM_Y"),className:"popup-window-button-accept",events:{click:function(){t();this.popupWindow.close()}}}),new BX.PopupWindowButton({text:BX.message("CRM_KANBAN_CONFIRM_N"),className:"popup-window-button-cancel",events:{click:function(){this.popupWindow.close()}}})]);i.show();return i}}})();
//# sourceMappingURL=actions.map.js