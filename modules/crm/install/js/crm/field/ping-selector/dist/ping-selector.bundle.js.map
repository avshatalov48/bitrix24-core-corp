{"version":3,"file":"ping-selector.bundle.js","sources":["../src/ping-selector.js"],"sourcesContent":["import { DatetimeConverter } from 'crm.timeline.tools';\nimport { Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { MenuManager } from 'main.popup';\nimport { UI } from 'ui.notification';\nimport type { PingSelectorOptions } from './ping-selector-options';\n\nimport 'ui.design-tokens';\nimport './ping-selector.css';\n\nconst MENU_ITEM_CLASS_ACTIVE = 'menu-popup-item-accept';\nconst MENU_ITEM_CLASS_INACTIVE = 'menu-popup-item-none';\nconst MENU_ITEM_CLASS_ARROW = 'crm-field-ping-selector-arrow';\n\nconst MENU_ITEM_SHOW_CALENDAR_ID = 'item-selector-menu-id-custom-calendar';\n\ntype Item = {\n\tid: string | number;\n\ttitle: string;\n}\n\nexport type { PingSelectorOptions };\n\nexport type MenuItem = {\n\tid: string;\n\tclassName: string;\n\thtml: string;\n\tonclick: Function;\n}\n\nexport const CompactIcons = {\n\tNONE: null,\n\tBELL: 'bell',\n};\n\nexport const PingSelectorEvents = {\n\tEVENT_PINGSELECTOR_OPEN: 'crm.field.pingselector:open',\n\tEVENT_PINGSELECTOR_VALUE_CHANGE: 'crm.field.pingselector:change',\n};\n\nexport class PingSelector\n{\n\t#id: ?string;\n\t#target: ?HTMLElement = null;\n\t#valuesList: Item[] = [];\n\t#selectedValues: Set = new Set();\n\t#readonlyMode: boolean = false;\n\t#icon: ?string = null;\n\t#deadline: ?Date = null;\n\n\t#selectedValueWrapperEl: ?HTMLElement = null;\n\t#valuesMenuPopup: ?Menu = null;\n\t#addButtonCompact: ?HTMLElement = null;\n\n\tconstructor(params: PingSelectorOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#id = params.id || `ping-selector-${Text.getRandom()}`;\n\t\tthis.#target = Type.isDomNode(params.target) ? params.target : null;\n\t\tthis.#valuesList = Type.isArrayFilled(params.valuesList) ? params.valuesList : [];\n\n\t\tif (Type.isArrayFilled(params.selectedValues))\n\t\t{\n\t\t\tparams.selectedValues.forEach((selectedValue) => this.#selectedValues.add(selectedValue));\n\t\t}\n\n\t\tthis.#readonlyMode = params.readonlyMode === true;\n\t\tthis.#deadline = (Type.isDate(params?.deadline) ? params.deadline : new Date());\n\n\t\tif (Type.isStringFilled(params.icon) && Object.values(CompactIcons).includes(params.icon))\n\t\t{\n\t\t\tthis.#icon = params.icon;\n\t\t}\n\n\t\tthis.#create();\n\t\tthis.#bindEvents();\n\t\tthis.#applyCurrentValue(100);\n\t}\n\n\tsetDeadline(deadline: Date): void\n\t{\n\t\tthis.#deadline = deadline;\n\t}\n\n\tgetValue(): Array\n\t{\n\t\treturn [...this.#selectedValues.values()];\n\t}\n\n\tsetValue(values: Array, isEmitEvent: boolean = false): void\n\t{\n\t\tthis.clearAll();\n\n\t\tvalues.forEach((value: string) => {\n\t\t\tthis.#addValue(value, isEmitEvent);\n\t\t});\n\t}\n\n\t#addValue(value: mixed, isEmitEvent: boolean = false): void\n\t{\n\t\tconst rawValue = this.#valuesList.find((element: Item) => {\n\t\t\treturn element?.id?.toString() === value?.toString();\n\t\t});\n\n\t\tif (!rawValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectedValues.add(rawValue.id);\n\n\t\tthis.#adjustAddButtonCompact();\n\n\t\tif (isEmitEvent)\n\t\t{\n\t\t\tthis.#emitEvent();\n\t\t}\n\t}\n\n\t#removeValue(value: string | number, isEmitEvent: boolean = false): void\n\t{\n\t\tthis.#selectedValues.delete(value);\n\n\t\tthis.#adjustAddButtonCompact();\n\n\t\tif (isEmitEvent)\n\t\t{\n\t\t\tthis.#emitEvent();\n\t\t}\n\t}\n\n\tclearAll(): void\n\t{\n\t\tif (this.#selectedValues.size === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectedValues.forEach((value) => this.#removeValue(value));\n\n\t\tthis.#selectedValues = new Set();\n\n\t\tthis.#adjustAddButtonCompact();\n\t}\n\n\t#create(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#readonlyMode)\n\t\t{\n\t\t\tthis.#addButtonCompact = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-field-ping-selector-compact-icon ${Type.isStringFilled(this.#icon) ? `--${this.#icon}` : ''}\"\n\t\t\t\t></span>\n\t\t\t`;\n\n\t\t\tthis.#adjustAddButtonCompact();\n\t\t}\n\n\t\tDom.append(this.#getAddButtonEl(), this.#target);\n\t}\n\n\t#adjustAddButtonCompact(): void\n\t{\n\t\tif (this.#selectedValues.size > 0)\n\t\t{\n\t\t\tDom.removeClass(this.#addButtonCompact, '--empty');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.#addButtonCompact, '--empty');\n\t\t}\n\t}\n\n\t#getAddButtonEl(): ?HTMLElement\n\t{\n\t\treturn this.#addButtonCompact;\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (Type.isDomNode(this.#getAddButtonEl()))\n\t\t{\n\t\t\tEvent.bind(this.#getAddButtonEl(), 'click', this.#onShowPopup.bind(this));\n\t\t}\n\n\t\tif (Type.isDomNode(this.#addButtonCompact))\n\t\t{\n\t\t\tEvent.bind(this.#addButtonCompact, 'click', this.#onShowPopup.bind(this));\n\t\t}\n\n\t\tif (Type.isDomNode(this.#selectedValueWrapperEl))\n\t\t{\n\t\t\tEvent.bind(this.#selectedValueWrapperEl, 'click', this.#onRemoveValue.bind(this));\n\t\t}\n\n\t\tEvent.unbind(window, 'resize', this.#onWindowResize);\n\t\tEvent.bind(window, 'resize', this.#onWindowResize.bind(this));\n\t}\n\n\t#onShowPopup(): void\n\t{\n\t\tconst menuItems = this.#getPreparedMenuItems();\n\n\t\t// @todo temporary, need other fix\n\t\tconst angle = { offset: 29, position: 'top' };\n\n\t\tconst menuParams = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\toffsetLeft: this.#getAddButtonEl().offsetWidth - 16,\n\t\t\tangle,\n\t\t\tcacheable: false,\n\t\t};\n\n\t\tthis.#valuesMenuPopup = MenuManager.create(this.#id, this.#getAddButtonEl(), menuItems, menuParams);\n\t\tthis.#valuesMenuPopup.show();\n\n\t\tEventEmitter.emit(this, PingSelectorEvents.EVENT_PINGSELECTOR_OPEN);\n\t}\n\n\t#getPreparedMenuItems(): MenuItem[]\n\t{\n\t\tconst items = this.#valuesList.map((item: Item) => this.#getPreparedMenuItem(item));\n\t\titems.push(this.#getCalendarMenuItem());\n\n\t\treturn items;\n\t}\n\n\t#getPreparedMenuItem(item: Item): MenuItem\n\t{\n\t\treturn {\n\t\t\tid: `ping-selector-menu-id-${item.id}`,\n\t\t\tclassName: this.#isValueSelected(item.id) ? MENU_ITEM_CLASS_ACTIVE : MENU_ITEM_CLASS_INACTIVE,\n\t\t\tonclick: this.#onMenuItemClick.bind(this, item.id),\n\t\t\thtml: Text.encode(item.title),\n\t\t};\n\t}\n\n\t#getCalendarMenuItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\tid: MENU_ITEM_SHOW_CALENDAR_ID,\n\t\t\tclassName: MENU_ITEM_CLASS_ARROW,\n\t\t\tonclick: (event) => {\n\t\t\t\tthis.#showCalendar(event.target);\n\t\t\t},\n\t\t\thtml: Loc.getMessage('CRM_FIELD_PING_SELECTOR_OTHER_TIME'),\n\t\t};\n\t}\n\n\t#showCalendar(target: HTMLElement): void\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\tBX.calendar({\n\t\t\tnode: target,\n\t\t\tbTime: true,\n\t\t\tbHideTime: false,\n\t\t\tbSetFocus: false,\n\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.#deadline),\n\t\t\tcallback: this.#addCustomValue.bind(this),\n\t\t});\n\t}\n\n\t#addCustomValue(date: Date): void\n\t{\n\t\tif (date.getTime() > this.#deadline.getTime())\n\t\t{\n\t\t\tthis.#close();\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CRM_FIELD_PING_SELECTOR_WRONG_TIME'),\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst offset = (this.#deadline.getTime() - date.getTime()) / 1000 / 60;\n\t\tthis.#selectedValues.add(offset.toString());\n\n\t\tconst customValue = {\n\t\t\tid: offset.toString(),\n\t\t\ttitle: this.#getOffsetTitle(offset),\n\t\t};\n\n\t\tthis.#valuesList.push(customValue);\n\n\t\tthis.#valuesList = this.#valuesList.sort((a, b) => {\n\t\t\tconst offset1 = Number(a.id);\n\t\t\tconst offset2 = Number(b.id);\n\n\t\t\treturn ((offset1 < offset2) ? -1 : ((offset1 > offset2) ? 1 : 0));\n\t\t});\n\n\t\tthis.#close();\n\n\t\tthis.#emitEvent();\n\t}\n\n\t#getOffsetTitle(offset: Number): String\n\t{\n\t\tconst minutesInHour = 60;\n\n\t\tconst days = Math.floor(offset / (minutesInHour * 24));\n\t\tlet daysString = null;\n\t\tif (days > 0)\n\t\t{\n\t\t\tdaysString = Loc.getMessagePlural(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_DAY',\n\t\t\t\tdays,\n\t\t\t\t{\n\t\t\t\t\t'#COUNT#': days,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tconst hours = Math.floor((offset % (minutesInHour * 24)) / (minutesInHour));\n\t\tlet hoursString = null;\n\t\tif (hours > 0)\n\t\t{\n\t\t\thoursString = Loc.getMessagePlural(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_HOUR',\n\t\t\t\thours,\n\t\t\t\t{\n\t\t\t\t\t'#COUNT#': hours,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tconst minutes = Math.floor(offset % (minutesInHour));\n\t\tlet minutesString = null;\n\t\tif (minutes > 0)\n\t\t{\n\t\t\tminutesString = Loc.getMessagePlural(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_MINUTE',\n\t\t\t\tminutes,\n\t\t\t\t{\n\t\t\t\t\t'#COUNT#': minutes,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (days > 0 && hours > 0 && minutes > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_MINUTE_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#DAYS#': daysString,\n\t\t\t\t\t'#HOURS#': hoursString,\n\t\t\t\t\t'#MINUTES#': minutesString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (days > 0 && hours > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#DAYS#': daysString,\n\t\t\t\t\t'#HOURS#': hoursString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (days > 0 && minutes > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_MINUTE_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#DAYS#': daysString,\n\t\t\t\t\t'#MINUTES#': minutesString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (days > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#DAYS#': daysString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (hours > 0 && minutes > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_MINUTE_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#HOURS#': hoursString,\n\t\t\t\t\t'#MINUTES#': minutesString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (hours > 0)\n\t\t{\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_TITLE',\n\t\t\t\t{\n\t\t\t\t\t'#HOURS#': hoursString,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn Loc.getMessage(\n\t\t\t'CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_MINUTE_TITLE',\n\t\t\t{\n\t\t\t\t'#MINUTES#': minutesString,\n\t\t\t},\n\t\t);\n\t}\n\n\t#close(): void\n\t{\n\t\tthis.#valuesMenuPopup.close();\n\t\tMenuManager.destroy(this.#id);\n\t}\n\n\t#onRemoveValue(event: BaseEvent): void\n\t{\n\t\tconst target = event.target || event.srcElement;\n\t\tconst itemIdToRemove = target.getAttribute('data-ping-selector-id');\n\t\tif (Type.isNull(itemIdToRemove))\n\t\t{\n\t\t\treturn; // nothing to do\n\t\t}\n\n\t\tif (this.#isValueSelected(itemIdToRemove))\n\t\t{\n\t\t\tthis.#removeValue(itemIdToRemove, true);\n\t\t}\n\t}\n\n\t#onMenuItemClick(value: mixed, event: PointerEvent, item: MenuItem): void\n\t{\n\t\tif (this.#isValueSelected(value))\n\t\t{\n\t\t\tthis.#removeValue(value, true);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#addValue(value, true);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t}\n\t}\n\n\t#onWindowResize(): void\n\t{\n\t\tthis.#applyCurrentValue(750);\n\t}\n\n\t#emitEvent(): void\n\t{\n\t\tEventEmitter.emit(this, PingSelectorEvents.EVENT_PINGSELECTOR_VALUE_CHANGE, {\n\t\t\tvalue: this.getValue(),\n\t\t});\n\t}\n\n\t#assertValidParams(params: PingSelectorOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Field.PingSelector: The \"params\" argument must be object');\n\t\t}\n\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Field.PingSelector: The \"target\" argument must be DOM node');\n\t\t}\n\n\t\tif (!Type.isArrayFilled(params.valuesList))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Field.PingSelector: The \"valuesList\" argument must be filled');\n\t\t}\n\t}\n\n\t#applyCurrentValue(delay: number): void\n\t{\n\t\tRuntime.debounce(\n\t\t\t() => {\n\t\t\t\tthis.setValue([...this.#selectedValues] || []);\n\t\t\t},\n\t\t\tdelay,\n\t\t\tthis,\n\t\t)();\n\t}\n\n\t#isValueSelected(value: string | number): boolean\n\t{\n\t\treturn this.#selectedValues.has(value);\n\t}\n}\n"],"names":["MENU_ITEM_CLASS_ACTIVE","MENU_ITEM_CLASS_INACTIVE","MENU_ITEM_CLASS_ARROW","MENU_ITEM_SHOW_CALENDAR_ID","CompactIcons","NONE","BELL","PingSelectorEvents","EVENT_PINGSELECTOR_OPEN","EVENT_PINGSELECTOR_VALUE_CHANGE","PingSelector","params","Set","id","Text","getRandom","Type","isDomNode","target","isArrayFilled","valuesList","selectedValues","forEach","selectedValue","add","readonlyMode","isDate","deadline","Date","isStringFilled","icon","Object","values","includes","isEmitEvent","clearAll","value","size","rawValue","find","element","toString","Tag","render","Dom","append","removeClass","addClass","Event","bind","unbind","window","menuItems","angle","offset","position","menuParams","closeByEsc","autoHide","offsetLeft","offsetWidth","cacheable","MenuManager","create","show","EventEmitter","emit","items","map","item","push","className","onclick","html","encode","title","event","Loc","getMessage","BX","calendar","node","bTime","bHideTime","bSetFocus","DateTimeFormat","format","DatetimeConverter","getSiteDateTimeFormat","callback","date","getTime","UI","Notification","Center","notify","content","autoHideDelay","customValue","sort","a","b","offset1","Number","offset2","minutesInHour","days","Math","floor","daysString","getMessagePlural","hours","hoursString","minutes","minutesString","close","destroy","srcElement","itemIdToRemove","getAttribute","isNull","getContainer","getValue","isPlainObject","TypeError","Error","delay","Runtime","debounce","setValue","has"],"mappings":"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"}