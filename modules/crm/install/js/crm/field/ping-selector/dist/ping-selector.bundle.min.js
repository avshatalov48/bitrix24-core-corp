this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,a,l,s,r){"use strict";var n;function c(e,t){o(e,t);t.add(e)}function h(e,t,i){o(e,t);t.set(e,i)}function o(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function u(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var v="menu-popup-item-accept";var d="menu-popup-item-none";var b="crm-field-ping-selector-arrow";var p="item-selector-menu-id-custom-calendar";var E={NONE:null,BELL:"bell"};var f={EVENT_PINGSELECTOR_OPEN:"crm.field.pingselector:open",EVENT_PINGSELECTOR_VALUE_CHANGE:"crm.field.pingselector:change"};var T=new WeakMap;var S=new WeakMap;var _=new WeakMap;var F=new WeakMap;var m=new WeakMap;var g=new WeakMap;var P=new WeakMap;var C=new WeakMap;var H=new WeakMap;var M=new WeakMap;var w=new WeakSet;var L=new WeakSet;var G=new WeakSet;var N=new WeakSet;var O=new WeakSet;var I=new WeakSet;var k=new WeakSet;var D=new WeakSet;var R=new WeakSet;var W=new WeakSet;var y=new WeakSet;var U=new WeakSet;var A=new WeakSet;var B=new WeakSet;var X=new WeakSet;var V=new WeakSet;var Y=new WeakSet;var z=new WeakSet;var j=new WeakSet;var x=new WeakSet;var q=new WeakSet;var J=function(){function e(t){var a=this;babelHelpers.classCallCheck(this,e);c(this,q);c(this,x);c(this,j);c(this,z);c(this,Y);c(this,V);c(this,X);c(this,B);c(this,A);c(this,U);c(this,y);c(this,W);c(this,R);c(this,D);c(this,k);c(this,I);c(this,O);c(this,N);c(this,G);c(this,L);c(this,w);h(this,T,{writable:true,value:void 0});h(this,S,{writable:true,value:null});h(this,_,{writable:true,value:[]});h(this,F,{writable:true,value:new Set});h(this,m,{writable:true,value:false});h(this,g,{writable:true,value:null});h(this,P,{writable:true,value:null});h(this,C,{writable:true,value:null});h(this,H,{writable:true,value:null});h(this,M,{writable:true,value:null});u(this,j,be).call(this,t);babelHelpers.classPrivateFieldSet(this,T,t.id||"ping-selector-".concat(i.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,S,i.Type.isDomNode(t.target)?t.target:null);babelHelpers.classPrivateFieldSet(this,_,i.Type.isArrayFilled(t.valuesList)?t.valuesList:[]);if(i.Type.isArrayFilled(t.selectedValues)){t.selectedValues.forEach((function(e){return babelHelpers.classPrivateFieldGet(a,F).add(e)}))}babelHelpers.classPrivateFieldSet(this,m,t.readonlyMode===true);babelHelpers.classPrivateFieldSet(this,P,i.Type.isDate(t===null||t===void 0?void 0:t.deadline)?t.deadline:new Date);if(i.Type.isStringFilled(t.icon)&&Object.values(E).includes(t.icon)){babelHelpers.classPrivateFieldSet(this,g,t.icon)}u(this,G,Z).call(this);u(this,I,te).call(this);u(this,x,pe).call(this,100)}babelHelpers.createClass(e,[{key:"setDeadline",value:function e(t){babelHelpers.classPrivateFieldSet(this,P,t)}},{key:"getValue",value:function e(){return babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,F).values())}},{key:"setValue",value:function e(t){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.clearAll();t.forEach((function(e){u(i,w,K).call(i,e,a)}))}},{key:"clearAll",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,F).size===0){return}babelHelpers.classPrivateFieldGet(this,F).forEach((function(e){return u(t,L,Q).call(t,e)}));babelHelpers.classPrivateFieldSet(this,F,new Set);u(this,N,$).call(this)}}]);return e}();function K(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=babelHelpers.classPrivateFieldGet(this,_).find((function(t){var i;return(t===null||t===void 0?void 0:(i=t.id)===null||i===void 0?void 0:i.toString())===(e===null||e===void 0?void 0:e.toString())}));if(!i){return}babelHelpers.classPrivateFieldGet(this,F).add(i.id);u(this,N,$).call(this);if(t){u(this,z,de).call(this)}}function Q(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldGet(this,F)["delete"](e);u(this,N,$).call(this);if(t){u(this,z,de).call(this)}}function Z(){if(!babelHelpers.classPrivateFieldGet(this,S)){return}if(!babelHelpers.classPrivateFieldGet(this,m)){babelHelpers.classPrivateFieldSet(this,M,i.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="crm-field-ping-selector-compact-icon ','"\n\t\t\t\t></span>\n\t\t\t'])),i.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,g))?"--".concat(babelHelpers.classPrivateFieldGet(this,g)):""));u(this,N,$).call(this)}i.Dom.append(u(this,O,ee).call(this),babelHelpers.classPrivateFieldGet(this,S))}function $(){if(babelHelpers.classPrivateFieldGet(this,F).size>0){i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,M),"--empty")}else{i.Dom.addClass(babelHelpers.classPrivateFieldGet(this,M),"--empty")}}function ee(){return babelHelpers.classPrivateFieldGet(this,M)}function te(){if(i.Type.isDomNode(u(this,O,ee).call(this))){i.Event.bind(u(this,O,ee).call(this),"click",u(this,k,ie).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,M))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,M),"click",u(this,k,ie).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,C))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,C),"click",u(this,X,oe).bind(this))}i.Event.unbind(window,"resize",u(this,Y,ve));i.Event.bind(window,"resize",u(this,Y,ve).bind(this))}function ie(){var e=u(this,D,ae).call(this);var t={offset:29,position:"top"};var i={closeByEsc:true,autoHide:true,offsetLeft:u(this,O,ee).call(this).offsetWidth-16,angle:t,cacheable:false};babelHelpers.classPrivateFieldSet(this,H,s.MenuManager.create(babelHelpers.classPrivateFieldGet(this,T),u(this,O,ee).call(this),e,i));babelHelpers.classPrivateFieldGet(this,H).show();a.EventEmitter.emit(this,f.EVENT_PINGSELECTOR_OPEN)}function ae(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,_).map((function(t){return u(e,R,le).call(e,t)}));t.push(u(this,W,se).call(this));return t}function le(e){return{id:"ping-selector-menu-id-".concat(e.id),className:u(this,q,Ee).call(this,e.id)?v:d,onclick:u(this,V,ue).bind(this,e.id),html:i.Text.encode(e.title)}}function se(){var e=this;return{id:p,className:b,onclick:function t(i){u(e,y,re).call(e,i.target)},html:i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_OTHER_TIME")}}function re(e){BX.calendar({node:e,bTime:true,bHideTime:false,bSetFocus:false,value:l.DateTimeFormat.format(t.DatetimeConverter.getSiteDateTimeFormat(),babelHelpers.classPrivateFieldGet(this,P)),callback:u(this,U,ne).bind(this)})}function ne(e){if(e.getTime()>babelHelpers.classPrivateFieldGet(this,P).getTime()){u(this,B,he).call(this);r.UI.Notification.Center.notify({content:i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_WRONG_TIME"),autoHideDelay:3e3});return}var t=(babelHelpers.classPrivateFieldGet(this,P).getTime()-e.getTime())/1e3/60;babelHelpers.classPrivateFieldGet(this,F).add(t.toString());var a={id:t.toString(),title:u(this,A,ce).call(this,t)};babelHelpers.classPrivateFieldGet(this,_).push(a);babelHelpers.classPrivateFieldSet(this,_,babelHelpers.classPrivateFieldGet(this,_).sort((function(e,t){var i=Number(e.id);var a=Number(t.id);return i<a?-1:i>a?1:0})));u(this,B,he).call(this);u(this,z,de).call(this)}function ce(e){var t=60;var a=Math.floor(e/(t*24));var l=null;if(a>0){l=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_DAY",a,{"#COUNT#":a})}var s=Math.floor(e%(t*24)/t);var r=null;if(s>0){r=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_HOUR",s,{"#COUNT#":s})}var n=Math.floor(e%t);var c=null;if(n>0){c=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_MINUTE",n,{"#COUNT#":n})}if(a>0&&s>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_MINUTE_TITLE",{"#DAYS#":l,"#HOURS#":r,"#MINUTES#":c})}if(a>0&&s>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_TITLE",{"#DAYS#":l,"#HOURS#":r})}if(a>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_MINUTE_TITLE",{"#DAYS#":l,"#MINUTES#":c})}if(a>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_TITLE",{"#DAYS#":l})}if(s>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_MINUTE_TITLE",{"#HOURS#":r,"#MINUTES#":c})}if(s>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_TITLE",{"#HOURS#":r})}return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_MINUTE_TITLE",{"#MINUTES#":c})}function he(){babelHelpers.classPrivateFieldGet(this,H).close();s.MenuManager.destroy(babelHelpers.classPrivateFieldGet(this,T))}function oe(e){var t=e.target||e.srcElement;var a=t.getAttribute("data-ping-selector-id");if(i.Type.isNull(a)){return}if(u(this,q,Ee).call(this,a)){u(this,L,Q).call(this,a,true)}}function ue(e,t,a){if(u(this,q,Ee).call(this,e)){u(this,L,Q).call(this,e,true);i.Dom.removeClass(a.getContainer(),v);i.Dom.addClass(a.getContainer(),d)}else{u(this,w,K).call(this,e,true);i.Dom.removeClass(a.getContainer(),d);i.Dom.addClass(a.getContainer(),v)}}function ve(){u(this,x,pe).call(this,750)}function de(){a.EventEmitter.emit(this,f.EVENT_PINGSELECTOR_VALUE_CHANGE,{value:this.getValue()})}function be(e){if(!i.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Field.PingSelector: The "params" argument must be object')}if(!i.Type.isDomNode(e.target)){throw new Error('BX.Crm.Field.PingSelector: The "target" argument must be DOM node')}if(!i.Type.isArrayFilled(e.valuesList)){throw new Error('BX.Crm.Field.PingSelector: The "valuesList" argument must be filled')}}function pe(e){var t=this;i.Runtime.debounce((function(){t.setValue(babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(t,F))||[])}),e,this)()}function Ee(e){return babelHelpers.classPrivateFieldGet(this,F).has(e)}e.CompactIcons=E;e.PingSelectorEvents=f;e.PingSelector=J})(this.BX.Crm.Field=this.BX.Crm.Field||{},BX.Crm.Timeline,BX,BX.Event,BX.Main,BX.Main,BX);
//# sourceMappingURL=ping-selector.bundle.map.js