this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,a,l,s,r){"use strict";var n;function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function h(e,t){v(e,t);t.add(e)}function u(e,t,i){v(e,t);t.set(e,i)}function v(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function d(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var b="menu-popup-item-accept";var p="menu-popup-item-none";var f="crm-field-ping-selector-arrow";var E="item-selector-menu-id-custom-calendar";var T={NONE:null,BELL:"bell"};var S={EVENT_PINGSELECTOR_OPEN:"crm.field.pingselector:open",EVENT_PINGSELECTOR_VALUE_CHANGE:"crm.field.pingselector:change"};var _=new WeakMap;var g=new WeakMap;var F=new WeakMap;var m=new WeakMap;var P=new WeakMap;var w=new WeakMap;var C=new WeakMap;var O=new WeakMap;var H=new WeakMap;var M=new WeakMap;var L=new WeakSet;var G=new WeakSet;var N=new WeakSet;var I=new WeakSet;var D=new WeakSet;var y=new WeakSet;var k=new WeakSet;var R=new WeakSet;var W=new WeakSet;var U=new WeakSet;var A=new WeakSet;var B=new WeakSet;var X=new WeakSet;var j=new WeakSet;var V=new WeakSet;var Y=new WeakSet;var z=new WeakSet;var x=new WeakSet;var q=new WeakSet;var J=new WeakSet;var K=new WeakSet;var Q=function(){function e(t){var a=this;babelHelpers.classCallCheck(this,e);h(this,K);h(this,J);h(this,q);h(this,x);h(this,z);h(this,Y);h(this,V);h(this,j);h(this,X);h(this,B);h(this,A);h(this,U);h(this,W);h(this,R);h(this,k);h(this,y);h(this,D);h(this,I);h(this,N);h(this,G);h(this,L);u(this,_,{writable:true,value:void 0});u(this,g,{writable:true,value:null});u(this,F,{writable:true,value:[]});u(this,m,{writable:true,value:new Set});u(this,P,{writable:true,value:false});u(this,w,{writable:true,value:null});u(this,C,{writable:true,value:null});u(this,O,{writable:true,value:null});u(this,H,{writable:true,value:null});u(this,M,{writable:true,value:null});d(this,q,fe).call(this,t);babelHelpers.classPrivateFieldSet(this,_,t.id||"ping-selector-".concat(i.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,g,i.Type.isDomNode(t.target)?t.target:null);babelHelpers.classPrivateFieldSet(this,F,i.Type.isArrayFilled(t.valuesList)?t.valuesList.map((function(e){return o(o({},e),{},{id:e.id.toString()})})):[]);if(i.Type.isArrayFilled(t.selectedValues)){t.selectedValues.forEach((function(e){return babelHelpers.classPrivateFieldGet(a,m).add(e.toString())}))}babelHelpers.classPrivateFieldSet(this,P,t.readonlyMode===true);babelHelpers.classPrivateFieldSet(this,C,i.Type.isDate(t===null||t===void 0?void 0:t.deadline)?t.deadline:new Date);babelHelpers.classPrivateFieldGet(this,C).setSeconds(0);if(i.Type.isStringFilled(t.icon)&&Object.values(T).includes(t.icon)){babelHelpers.classPrivateFieldSet(this,w,t.icon)}d(this,N,ee).call(this);d(this,y,ae).call(this);d(this,J,Ee).call(this,100)}babelHelpers.createClass(e,[{key:"setDeadline",value:function e(t){babelHelpers.classPrivateFieldSet(this,C,t)}},{key:"getValue",value:function e(){return babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,m).values())}},{key:"setValue",value:function e(t){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.clearAll();t.forEach((function(e){d(i,L,Z).call(i,e,a)}))}},{key:"clearAll",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,m).size===0){return}babelHelpers.classPrivateFieldGet(this,m).forEach((function(e){return d(t,G,$).call(t,e)}));babelHelpers.classPrivateFieldSet(this,m,new Set);d(this,I,te).call(this)}}]);return e}();function Z(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=babelHelpers.classPrivateFieldGet(this,F).find((function(t){var i;return(t===null||t===void 0?void 0:(i=t.id)===null||i===void 0?void 0:i.toString())===(e===null||e===void 0?void 0:e.toString())}));if(!i){return}babelHelpers.classPrivateFieldGet(this,m).add(i.id);d(this,I,te).call(this);if(t){d(this,x,pe).call(this)}}function $(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldGet(this,m)["delete"](e);d(this,I,te).call(this);if(t){d(this,x,pe).call(this)}}function ee(){if(!babelHelpers.classPrivateFieldGet(this,g)){return}if(!babelHelpers.classPrivateFieldGet(this,P)){babelHelpers.classPrivateFieldSet(this,M,i.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="crm-field-ping-selector-compact-icon ','"\n\t\t\t\t></span>\n\t\t\t'])),i.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,w))?"--".concat(babelHelpers.classPrivateFieldGet(this,w)):""));d(this,I,te).call(this)}i.Dom.append(d(this,D,ie).call(this),babelHelpers.classPrivateFieldGet(this,g))}function te(){if(babelHelpers.classPrivateFieldGet(this,m).size>0){i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,M),"--empty")}else{i.Dom.addClass(babelHelpers.classPrivateFieldGet(this,M),"--empty")}}function ie(){return babelHelpers.classPrivateFieldGet(this,M)}function ae(){if(i.Type.isDomNode(d(this,D,ie).call(this))){i.Event.bind(d(this,D,ie).call(this),"click",d(this,k,le).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,M))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,M),"click",d(this,k,le).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,O))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,O),"click",d(this,V,ve).bind(this))}i.Event.unbind(window,"resize",d(this,z,be));i.Event.bind(window,"resize",d(this,z,be).bind(this))}function le(){var e=d(this,R,se).call(this);var t={offset:29,position:"top"};var i={closeByEsc:true,autoHide:true,offsetLeft:d(this,D,ie).call(this).offsetWidth-16,angle:t,cacheable:false};babelHelpers.classPrivateFieldSet(this,H,s.MenuManager.create(babelHelpers.classPrivateFieldGet(this,_),d(this,D,ie).call(this),e,i));babelHelpers.classPrivateFieldGet(this,H).show();a.EventEmitter.emit(this,S.EVENT_PINGSELECTOR_OPEN)}function se(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,F).map((function(t){return d(e,W,re).call(e,t)}));t.push(d(this,U,ne).call(this));return t}function re(e){return{id:"ping-selector-menu-id-".concat(e.id),className:d(this,K,Te).call(this,e.id)?b:p,onclick:d(this,Y,de).bind(this,e.id),html:i.Text.encode(e.title)}}function ne(){var e=this;return{id:E,className:f,onclick:function t(i){d(e,A,ce).call(e,i.target)},html:i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_OTHER_TIME")}}function ce(e){BX.calendar({node:e,bTime:true,bHideTime:false,bSetFocus:false,value:l.DateTimeFormat.format(t.DatetimeConverter.getSiteDateTimeFormat(),babelHelpers.classPrivateFieldGet(this,C)),callback:d(this,B,oe).bind(this)})}function oe(e){if(e.getTime()>babelHelpers.classPrivateFieldGet(this,C).getTime()){d(this,j,ue).call(this);r.UI.Notification.Center.notify({content:i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_WRONG_TIME"),autoHideDelay:3e3});return}var t=Math.floor((babelHelpers.classPrivateFieldGet(this,C).getTime()-e.getTime())/1e3/60);babelHelpers.classPrivateFieldGet(this,m).add(t.toString());var a={id:t.toString(),title:d(this,X,he).call(this,t)};babelHelpers.classPrivateFieldGet(this,F).push(a);babelHelpers.classPrivateFieldSet(this,F,babelHelpers.classPrivateFieldGet(this,F).sort((function(e,t){var i=Number(e.id);var a=Number(t.id);return i<a?-1:i>a?1:0})));d(this,j,ue).call(this);d(this,x,pe).call(this)}function he(e){var t=60;var a=Math.floor(e/(t*24));var l=null;if(a>0){l=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_DAY",a,{"#COUNT#":a})}var s=Math.floor(e%(t*24)/t);var r=null;if(s>0){r=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_HOUR",s,{"#COUNT#":s})}var n=Math.floor(e%t);var c=null;if(n>0){c=i.Loc.getMessagePlural("CRM_FIELD_PING_SELECTOR_MINUTE",n,{"#COUNT#":n})}if(a>0&&s>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_MINUTE_TITLE",{"#DAYS#":l,"#HOURS#":r,"#MINUTES#":c})}if(a>0&&s>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_HOUR_TITLE",{"#DAYS#":l,"#HOURS#":r})}if(a>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_MINUTE_TITLE",{"#DAYS#":l,"#MINUTES#":c})}if(a>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_DAY_TITLE",{"#DAYS#":l})}if(s>0&&n>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_MINUTE_TITLE",{"#HOURS#":r,"#MINUTES#":c})}if(s>0){return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_HOUR_TITLE",{"#HOURS#":r})}return i.Loc.getMessage("CRM_FIELD_PING_SELECTOR_CUSTOM_OFFSET_MINUTE_TITLE",{"#MINUTES#":c})}function ue(){babelHelpers.classPrivateFieldGet(this,H).close();s.MenuManager.destroy(babelHelpers.classPrivateFieldGet(this,_))}function ve(e){var t=e.target||e.srcElement;var a=t.getAttribute("data-ping-selector-id");if(i.Type.isNull(a)){return}if(d(this,K,Te).call(this,a)){d(this,G,$).call(this,a,true)}}function de(e,t,a){if(d(this,K,Te).call(this,e)){d(this,G,$).call(this,e,true);i.Dom.removeClass(a.getContainer(),b);i.Dom.addClass(a.getContainer(),p)}else{d(this,L,Z).call(this,e,true);i.Dom.removeClass(a.getContainer(),p);i.Dom.addClass(a.getContainer(),b)}}function be(){d(this,J,Ee).call(this,750)}function pe(){a.EventEmitter.emit(this,S.EVENT_PINGSELECTOR_VALUE_CHANGE,{value:this.getValue()})}function fe(e){if(!i.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Field.PingSelector: The "params" argument must be object')}if(!i.Type.isDomNode(e.target)){throw new Error('BX.Crm.Field.PingSelector: The "target" argument must be DOM node')}if(!i.Type.isArrayFilled(e.valuesList)){throw new Error('BX.Crm.Field.PingSelector: The "valuesList" argument must be filled')}}function Ee(e){var t=this;i.Runtime.debounce((function(){t.setValue(babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(t,m))||[])}),e,this)()}function Te(e){return babelHelpers.classPrivateFieldGet(this,m).has(e)}e.CompactIcons=T;e.PingSelectorEvents=S;e.PingSelector=Q})(this.BX.Crm.Field=this.BX.Crm.Field||{},BX.Crm.Timeline,BX,BX.Event,BX.Main,BX.Main,BX);
//# sourceMappingURL=ping-selector.bundle.map.js