{"version":3,"file":"color-selector.bundle.js","sources":["../src/color-selector.js"],"sourcesContent":["import { Dom, Event, Tag, Text, Type } from 'main.core';\n\nimport 'ui.design-tokens';\nimport './color-selector.css';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nexport const ColorSelectorEvents = {\n\tEVENT_COLORSELECTOR_VALUE_CHANGE: 'crm.field.colorselector:change',\n};\n\nexport class ColorSelector\n{\n\t#target: ?HTMLElement = null;\n\t#colorList: Item[] = [];\n\t#selectedColorId: string = 'default';\n\t#readOnlyMode: boolean = false;\n\n\t#popup: Popup = null;\n\t#icon: ?HTMLElement = null;\n\t#container: ?HTMLElement = null;\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#target = Type.isDomNode(params.target) ? params.target : null;\n\t\tthis.#colorList = Type.isArrayFilled(params.colorList) ? params.colorList : [];\n\t\tthis.#selectedColorId = Type.isStringFilled(params.selectedColorId) ? params.selectedColorId : [];\n\t\tthis.#readOnlyMode = params.readOnlyMode === true;\n\n\t\tthis.togglePopup = this.togglePopup.bind(this);\n\n\t\tthis.#create();\n\t}\n\n\t// region DOM management\n\t#create(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#icon = Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"crm-field-color-selector ${this.#readOnlyMode ? '--readonly' : ''}\"\n\t\t\t></div>\n\t\t`;\n\n\t\tDom.append(this.#icon, this.#target);\n\n\t\tconst background = this.#getColorById(this.#selectedColorId).color;\n\t\tDom.style(this.#icon, { '--crm-field-color-selector-color': background });\n\n\t\tEvent.bind(this.#icon, 'click', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.togglePopup();\n\t\t});\n\t}\n\n\t#getColorById(id: string): Object\n\t{\n\t\treturn this.#colorList.find((item) => item.id === id);\n\t}\n\n\ttogglePopup(): void\n\t{\n\t\tif (this.#readOnlyMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst popup = this.#getPopup();\n\n\t\tif (popup.isShown())\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.show();\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tid: `crm-todo-color-selector-popup-${Text.getRandom()}`,\n\t\t\t\tautoHide: true,\n\t\t\t\tbindElement: this.#target,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tdraggable: false,\n\t\t\t\twidth: 188,\n\t\t\t\tpadding: 0,\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: 6,\n\t\t\t\toffsetTop: 14,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`<div class=\"crm-field-color-selector-menu-container\"></div>`;\n\n\t\tthis.#colorList.forEach((item) => {\n\t\t\tconst id = Text.encode(`crm-field-color-selector-menu-item-${item.id}`);\n\t\t\tconst element = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tid=\"${id}\"\n\t\t\t\t\tclass=\"crm-field-color-selector-menu-item ${item.id === this.#selectedColorId ? '--selected' : ''}\"\n\t\t\t\t\tonclick=\"${this.onSelectColor.bind(this, item.id)}\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t`;\n\t\t\tDom.append(element, this.#container);\n\n\t\t\tDom.style(element, { '--crm-field-color-selector-color': item.color });\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-field-color-selector-popup\">\n\t\t\t\t${this.#container}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tonSelectColor(id: string): void\n\t{\n\t\tthis.#getPopup().close();\n\t\tthis.setValue(id);\n\n\t\tEventEmitter.emit(this, ColorSelectorEvents.EVENT_COLORSELECTOR_VALUE_CHANGE, {\n\t\t\tvalue: id,\n\t\t});\n\t}\n\n\tsetValue(id: string): void\n\t{\n\t\tthis.#selectedColorId = id;\n\n\t\tconst backgroundColor = this.#getColorById(this.#selectedColorId).color;\n\t\tDom.style(this.#icon, { backgroundColor });\n\n\t\tif (!this.#container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#container.querySelector('.--selected'), '--selected');\n\n\t\tconst target = this.#container.querySelector(`#crm-field-color-selector-menu-item-${id}`);\n\t\tif (target)\n\t\t{\n\t\t\tDom.addClass(target, '--selected');\n\t\t}\n\t}\n\n\tonKeyUpHandler(event): void\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.#popup?.close();\n\t\t}\n\t}\n}\n"],"names":["ColorSelectorEvents","EVENT_COLORSELECTOR_VALUE_CHANGE","ColorSelector","params","Type","isDomNode","target","isArrayFilled","colorList","isStringFilled","selectedColorId","readOnlyMode","togglePopup","bind","popup","isShown","close","show","id","setValue","EventEmitter","emit","value","backgroundColor","color","Dom","style","removeClass","querySelector","addClass","event","keyCode","Tag","render","append","background","Event","preventDefault","find","item","Popup","Text","getRandom","autoHide","bindElement","content","closeByEsc","closeIcon","draggable","width","padding","angle","offsetLeft","offsetTop","forEach","encode","element","onSelectColor"],"mappings":"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"}