{"version":3,"file":"item-selector.bundle.js","sources":["../src/item-selector-button.js","../src/item-selector.js"],"sourcesContent":["import { Dom, Loc, Text } from 'main.core';\nimport { Button, ButtonOptions } from 'ui.buttons';\n\nconst DEFAULT_CLASS = 'crm-field-item-selector__add-btn';\n\nexport const ItemSelectorButtonState = Object.freeze({\n\tADD: 'add',\n\tMORE_ADD: 'more-add',\n\tCOUNTER_ADD: 'counter-add',\n});\n\nexport class ItemSelectorButton extends Button\n{\n\tconstructor(options: ButtonOptions)\n\t{\n\t\tsuper(options);\n\n\t\tDom.addClass(this.getContainer(), DEFAULT_CLASS);\n\t}\n\n\tgetDefaultOptions(): Object\n\t{\n\t\treturn {\n\t\t\tid: `item-selector-button-${Text.getRandom()}`,\n\t\t\ttext: Loc.getMessage('CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL'),\n\t\t\ttag: Button.Tag.SPAN,\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\tcolor: Button.Color.LIGHT,\n\t\t\tround: true,\n\t\t\tdropdown: true,\n\t\t};\n\t}\n\n\tapplyState(state: string, counter: number = 0): void\n\t{\n\t\tswitch (state)\n\t\t{\n\t\t\tcase ItemSelectorButtonState.MORE_ADD:\n\t\t\t\tthis.setText(\n\t\t\t\t\tLoc.getMessage('CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_BUTTON_LABEL'),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ItemSelectorButtonState.COUNTER_ADD:\n\t\t\t\tthis.setText(\n\t\t\t\t\tLoc.getMessage('CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_COUNTER_BUTTON_LABEL')?.replace('#COUNTER#', counter),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ItemSelectorButtonState.ADD:\n\t\t\tdefault:\n\t\t\t\tthis.setText(\n\t\t\t\t\tLoc.getMessage('CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL'),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","import { Dom, Event, Runtime, Tag, Text, Type } from 'main.core';\nimport { MenuItem, MenuManager } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\nimport { ItemSelectorButton, ItemSelectorButtonState } from './item-selector-button';\nimport { ItemSelectorOptions } from './item-selector-options';\n\nimport 'ui.design-tokens';\nimport './item-selector.css';\n\nconst MENU_ITEM_CLASS_ACTIVE = 'menu-popup-item-accept';\nconst MENU_ITEM_CLASS_INACTIVE = 'menu-popup-item-none';\n\ntype Item = {\n\tid: string | number;\n\ttitle: string;\n}\n\nexport const Events = {\n\tEVENT_ITEMSELECTOR_VALUE_CHANGE: 'crm.field.itemselector:change',\n};\n\nexport class ItemSelector\n{\n\t// options\n\t#id: ?string;\n\t#target: ?HTMLElement = null;\n\t#valuesList: Item[] = [];\n\t#selectedValues: Array<string | number> = [];\n\t#readonlyMode: boolean = false;\n\n\t// local\n\t#containerEl: ?HTMLElement = null;\n\t#selectedElementList: Object = {};\n\t#selectedHiddenElementList: Object = {};\n\t#selectedValueWrapperEl: ?HTMLElement = null;\n\t#valuesMenuPopup: ?Menu = null;\n\t#addButton: ?ItemSelectorButton = null;\n\n\tconstructor(params: ItemSelectorOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#id = params.id || `item-selector-${Text.getRandom()}`;\n\t\tthis.#target = Type.isDomNode(params.target) ? params.target : null;\n\t\tthis.#valuesList = Type.isArrayFilled(params.valuesList) ? params.valuesList : [];\n\t\tthis.#selectedValues = Type.isArrayFilled(params.selectedValues) ? params.selectedValues : [];\n\t\tthis.#readonlyMode = params.readonlyMode === true;\n\n\t\tthis.#create();\n\t\tthis.#bindEvents();\n\t\tthis.#applyCurrentValue(100);\n\t}\n\n\t// region Data management\n\tgetValue(): Array\n\t{\n\t\treturn this.#selectedValues;\n\t}\n\n\tsetValue(values: Array, isEmitEvent: boolean = false): void\n\t{\n\t\tthis.clearAll();\n\n\t\tvalues.forEach((value: string) => {\n\t\t\tthis.addValue(value, isEmitEvent);\n\t\t});\n\t}\n\n\taddValue(value: mixed, isEmitEvent: boolean = false): void\n\t{\n\t\tconst rawValue = this.#valuesList.find((element: Item) => element.id.toString() === value.toString());\n\t\tif (!rawValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemEl: HTMLElement = Tag.render`\n\t\t\t<span class=\"crm-field-item-selector__value\">\n\t\t\t\t<span class=\"crm-field-item-selector__value-title\">\n\t\t\t\t\t${Text.encode(rawValue.title)}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t`;\n\n\t\tif (!this.#readonlyMode)\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span class=\"crm-field-item-selector__value-clear-icon\" data-item-selector-id=\"${rawValue.id}\"/>\n\t\t\t\t\t</span>\n\t\t\t\t`,\n\t\t\t\titemEl,\n\t\t\t);\n\t\t}\n\n\t\tDom.append(itemEl, this.#selectedValueWrapperEl);\n\n\t\tconst itemElWidth = itemEl.offsetWidth;\n\n\t\tDom.addClass(itemEl, '--hidden');\n\n\t\tif (this.#isTargetOverflown(itemElWidth))\n\t\t{\n\t\t\tthis.#selectedHiddenElementList[rawValue.id] = itemEl;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#animateAdd(itemEl); // add animation\n\t\t}\n\n\t\tthis.#selectedValues.push(rawValue.id);\n\t\tthis.#selectedElementList[rawValue.id] = itemEl;\n\t\tthis.#applyAddButtonState(itemElWidth);\n\n\t\tif (isEmitEvent)\n\t\t{\n\t\t\tthis.#emitEvent();\n\t\t}\n\t}\n\n\tremoveValue(value: string | number, isEmitEvent: boolean = false): void\n\t{\n\t\tif (this.#selectedElementList[value] && Type.isDomNode(this.#selectedElementList[value]))\n\t\t{\n\t\t\tthis.#animateRemove(this.#selectedElementList[value]);\n\t\t\tDom.remove(this.#selectedElementList[value]);\n\n\t\t\tdelete this.#selectedElementList[value];\n\t\t}\n\n\t\tthis.#selectedValues = this.#selectedValues.filter((item: string | number) => item.toString() !== value.toString());\n\n\t\tconst isHiddenElementNeedApply = this.#selectedHiddenElementList[value]\n\t\t\t&& Type.isDomNode(this.#selectedHiddenElementList[value])\n\t\t;\n\n\t\tif (isHiddenElementNeedApply)\n\t\t{\n\t\t\tdelete this.#selectedHiddenElementList[value];\n\t\t}\n\n\t\tif (!this.#isTargetOverflown() || isHiddenElementNeedApply)\n\t\t{\n\t\t\tconst itemEl = Object.values(this.#selectedHiddenElementList)[0];\n\t\t\tif (Type.isDomNode(itemEl) && !this.#isTargetOverflown(itemEl.offsetWidth))\n\t\t\t{\n\t\t\t\tthis.#animateAdd(itemEl);\n\t\t\t\tdelete this.#selectedHiddenElementList[Object.keys(this.#selectedHiddenElementList)[0]];\n\t\t\t}\n\t\t}\n\n\t\tthis.#applyAddButtonState();\n\n\t\tif (isEmitEvent)\n\t\t{\n\t\t\tthis.#emitEvent();\n\t\t}\n\t}\n\n\tclearAll(): void\n\t{\n\t\tif (!Type.isArrayFilled(this.#selectedValues))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectedValues.forEach((value) => this.removeValue(value));\n\n\t\tthis.#selectedValues = [];\n\t\tthis.#selectedElementList = {};\n\t\tthis.#selectedHiddenElementList = {};\n\t}\n\t// endregion\n\n\t// region DOM management\n\t#create(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#containerEl = Tag.render`<div class=\"crm-field-item-selector crm-field-item-selector__scope\"></div>`;\n\t\tthis.#selectedValueWrapperEl = Tag.render`<span class=\"crm-field-item-selector__values\"></span>`;\n\n\t\tDom.append(this.#selectedValueWrapperEl, this.#containerEl);\n\n\t\tif (!this.#readonlyMode)\n\t\t{\n\t\t\tthis.#addButton = new ItemSelectorButton();\n\n\t\t\tDom.append(this.#getAddButtonEl(), this.#containerEl);\n\t\t}\n\n\t\tDom.append(this.#containerEl, this.#target);\n\t}\n\n\t#getAddButtonEl(): ?HTMLElement\n\t{\n\t\treturn this.#addButton?.getContainer();\n\t}\n\n\t#animateAdd(element: HTMLElement): void\n\t{\n\t\tDom.removeClass(element, ['--hidden', '--removing']);\n\t\tDom.addClass(element, '--adding');\n\t}\n\n\t#animateRemove(element: HTMLElement): void\n\t{\n\t\tDom.removeClass(element, '--adding');\n\t\tDom.addClass(element, '--removing');\n\t}\n\n\t#applyAddButtonState(portion: number = 0): void\n\t{\n\t\tif (!Type.isDomNode(this.#getAddButtonEl()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hiddenElementsCnt = Object.keys(this.#selectedHiddenElementList).length;\n\n\t\tif (this.#selectedValues.length === 0)\n\t\t{\n\t\t\tthis.#addButton.applyState(ItemSelectorButtonState.ADD);\n\t\t}\n\t\telse if (this.#isTargetOverflown(portion) && hiddenElementsCnt > 0)\n\t\t{\n\t\t\tthis.#addButton.applyState(ItemSelectorButtonState.COUNTER_ADD, hiddenElementsCnt);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#addButton.applyState(ItemSelectorButtonState.MORE_ADD);\n\t\t}\n\t}\n\t// endregion\n\n\t// region Event handlers\n\t#bindEvents(): void\n\t{\n\t\tif (Type.isDomNode(this.#getAddButtonEl()))\n\t\t{\n\t\t\tEvent.bind(this.#getAddButtonEl(), 'click', this.#onShowPopup.bind(this));\n\t\t}\n\n\t\tif (Type.isDomNode(this.#selectedValueWrapperEl))\n\t\t{\n\t\t\tEvent.bind(this.#selectedValueWrapperEl, 'click', this.#onRemoveValue.bind(this));\n\t\t}\n\n\t\tEvent.unbind(window, 'resize', this.#onWindowResize);\n\t\tEvent.bind(window, 'resize', this.#onWindowResize.bind(this));\n\t}\n\n\t#onShowPopup(event: Event): void\n\t{\n\t\tconst menuItems = this.#valuesList.map((item: Item) => {\n\t\t\treturn {\n\t\t\t\tid: `item-selector-menu-id-${item.id}`,\n\t\t\t\ttext: Text.encode(item.title),\n\t\t\t\tclassName: this.#isValueSelected(item.id) ? MENU_ITEM_CLASS_ACTIVE : MENU_ITEM_CLASS_INACTIVE,\n\t\t\t\tonclick: this.#onMenuItemClick.bind(this, item.id),\n\t\t\t};\n\t\t});\n\t\tconst menuParams = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: this.#getAddButtonEl().offsetWidth - 16,\n\t\t\tangle: true,\n\t\t\tcacheable: false,\n\t\t};\n\n\t\tthis.#valuesMenuPopup = MenuManager.create(this.#id, this.#getAddButtonEl(), menuItems, menuParams);\n\t\tthis.#valuesMenuPopup.show();\n\t}\n\n\t#onRemoveValue(event: Event): void\n\t{\n\t\tconst target = event.target || event.srcElement;\n\t\tconst itemIdToRemove = target.getAttribute('data-item-selector-id');\n\t\tif (Type.isNull(itemIdToRemove))\n\t\t{\n\t\t\treturn; // nothing to do\n\t\t}\n\n\t\tif (this.#isValueSelected(itemIdToRemove))\n\t\t{\n\t\t\tthis.removeValue(itemIdToRemove, true);\n\t\t}\n\t}\n\n\t#onMenuItemClick(value: mixed, event: PointerEvent, item: MenuItem): void\n\t{\n\t\tif (this.#isValueSelected(value))\n\t\t{\n\t\t\tthis.removeValue(value, true);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addValue(value, true);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t}\n\t}\n\n\t#onWindowResize(): void\n\t{\n\t\tthis.#applyCurrentValue(750);\n\t}\n\n\t#emitEvent(): void\n\t{\n\t\tEventEmitter.emit(this, Events.EVENT_ITEMSELECTOR_VALUE_CHANGE, {\n\t\t\tvalue: this.getValue(),\n\t\t});\n\t}\n\t// endregion\n\n\t// region Utils\n\t#assertValidParams(params: ItemSelectorOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Field.ItemSelector: The \"params\" argument must be object');\n\t\t}\n\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Field.ItemSelector: The \"target\" argument must be DOM node');\n\t\t}\n\n\t\tif (!Type.isArrayFilled(params.valuesList))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Field.ItemSelector: The \"valuesList\" argument must be filled');\n\t\t}\n\t}\n\n\t#applyCurrentValue(delay: number): void\n\t{\n\t\tRuntime.debounce(\n\t\t\t() => {\n\t\t\t\tthis.setValue(this.#selectedValues || []);\n\t\t\t},\n\t\t\tdelay,\n\t\t\tthis,\n\t\t)();\n\t}\n\n\t#isValueSelected(value: string | number): boolean\n\t{\n\t\treturn !Type.isUndefined(\n\t\t\tthis.#selectedValues.find((item: string | number) => item.toString() === value.toString()),\n\t\t);\n\t}\n\n\t#isTargetOverflown(portion: number = 0): boolean\n\t{\n\t\tif (this.#readonlyMode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst targetWidth = this.#target.offsetWidth;\n\t\tconst selectedValuesWidth = this.#selectedValueWrapperEl.offsetWidth;\n\t\tconst addBtnWidth = this.#getAddButtonEl().offsetWidth;\n\t\tconst result = targetWidth - (selectedValuesWidth + addBtnWidth + portion);\n\n\t\treturn result <= 20;\n\t}\n\t// endregion\n}\n"],"names":["DEFAULT_CLASS","ItemSelectorButtonState","Object","freeze","ADD","MORE_ADD","COUNTER_ADD","ItemSelectorButton","options","Dom","addClass","getContainer","id","Text","getRandom","text","Loc","getMessage","tag","Button","Tag","SPAN","size","Size","EXTRA_SMALL","color","Color","LIGHT","round","dropdown","state","counter","setText","replace","MENU_ITEM_CLASS_ACTIVE","MENU_ITEM_CLASS_INACTIVE","Events","EVENT_ITEMSELECTOR_VALUE_CHANGE","ItemSelector","params","Type","isDomNode","target","isArrayFilled","valuesList","selectedValues","readonlyMode","values","isEmitEvent","clearAll","forEach","value","addValue","rawValue","find","element","toString","itemEl","render","encode","title","append","itemElWidth","offsetWidth","push","remove","filter","item","isHiddenElementNeedApply","keys","removeValue","removeClass","portion","hiddenElementsCnt","length","applyState","Event","bind","unbind","window","event","menuItems","map","className","onclick","menuParams","closeByEsc","autoHide","offsetTop","offsetLeft","angle","cacheable","MenuManager","create","show","srcElement","itemIdToRemove","getAttribute","isNull","EventEmitter","emit","getValue","isPlainObject","TypeError","Error","delay","Runtime","debounce","setValue","isUndefined","targetWidth","selectedValuesWidth","addBtnWidth","result"],"mappings":"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"}