this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,l,i,a){"use strict";var s="crm-field-item-selector__add-btn";var r=Object.freeze({ADD:"add",MORE_ADD:"more-add",COUNTER_ADD:"counter-add"});var n=function(e){babelHelpers.inherits(t,e);function t(e){var l;babelHelpers.classCallCheck(this,t);l=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.Dom.addClass(l.getContainer(),s);return l}babelHelpers.createClass(t,[{key:"getDefaultOptions",value:function e(){return{id:"item-selector-button-".concat(i.Text.getRandom()),text:i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL"),tag:a.Button.Tag.SPAN,size:a.Button.Size.EXTRA_SMALL,color:a.Button.Color.LIGHT,round:true,dropdown:true}}},{key:"applyState",value:function e(t){var l;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;switch(t){case r.MORE_ADD:this.setText(i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_BUTTON_LABEL"));break;case r.COUNTER_ADD:this.setText((l=i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_COUNTER_BUTTON_LABEL"))===null||l===void 0?void 0:l.replace("#COUNTER#",a));break;case r.ADD:default:this.setText(i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL"));break}}}]);return t}(a.Button);var c,d,h,b,v;function o(e,t){p(e,t);t.add(e)}function u(e,t,l){p(e,t);t.set(e,l)}function p(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var m="menu-popup-item-accept";var F="menu-popup-item-none";var H={NONE:null,BELL:"bell"};var P={EVENT_ITEMSELECTOR_OPEN:"crm.field.itemselector:open",EVENT_ITEMSELECTOR_VALUE_CHANGE:"crm.field.itemselector:change"};var E=new WeakMap;var T=new WeakMap;var g=new WeakMap;var G=new WeakMap;var w=new WeakMap;var S=new WeakMap;var D=new WeakMap;var C=new WeakMap;var _=new WeakMap;var k=new WeakMap;var y=new WeakMap;var L=new WeakMap;var M=new WeakMap;var W=new WeakMap;var A=new WeakMap;var O=new WeakMap;var N=new WeakSet;var B=new WeakSet;var R=new WeakSet;var I=new WeakSet;var V=new WeakSet;var U=new WeakSet;var X=new WeakSet;var j=new WeakSet;var x=new WeakSet;var z=new WeakSet;var q=new WeakSet;var J=new WeakSet;var K=new WeakSet;var Q=new WeakSet;var Y=new WeakSet;var Z=new WeakSet;var $=new WeakSet;var ee=new WeakSet;var te=function(){function e(t){var l;babelHelpers.classCallCheck(this,e);o(this,ee);o(this,$);o(this,Z);o(this,Y);o(this,Q);o(this,K);o(this,J);o(this,q);o(this,z);o(this,x);o(this,j);o(this,X);o(this,U);o(this,V);o(this,I);o(this,R);o(this,B);o(this,N);u(this,E,{writable:true,value:void 0});u(this,T,{writable:true,value:null});u(this,g,{writable:true,value:[]});u(this,G,{writable:true,value:[]});u(this,w,{writable:true,value:false});u(this,S,{writable:true,value:false});u(this,D,{writable:true,value:null});u(this,C,{writable:true,value:null});u(this,_,{writable:true,value:true});u(this,k,{writable:true,value:null});u(this,y,{writable:true,value:{}});u(this,L,{writable:true,value:{}});u(this,M,{writable:true,value:null});u(this,W,{writable:true,value:null});u(this,A,{writable:true,value:null});u(this,O,{writable:true,value:null});f(this,Y,fe).call(this,t);babelHelpers.classPrivateFieldSet(this,E,t.id||"item-selector-".concat(i.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,T,i.Type.isDomNode(t.target)?t.target:null);babelHelpers.classPrivateFieldSet(this,g,i.Type.isArrayFilled(t.valuesList)?t.valuesList:[]);babelHelpers.classPrivateFieldSet(this,G,i.Type.isArrayFilled(t.selectedValues)?t.selectedValues:[]);babelHelpers.classPrivateFieldSet(this,w,t.readonlyMode===true);babelHelpers.classPrivateFieldSet(this,S,t.compactMode===true);if(i.Type.isStringFilled(t.icon)&&Object.values(H).includes(t.icon)){babelHelpers.classPrivateFieldSet(this,D,t.icon)}babelHelpers.classPrivateFieldSet(this,C,i.Type.isFunction(t.htmlItemCallback)?t.htmlItemCallback:null);babelHelpers.classPrivateFieldSet(this,_,Boolean((l=t.multiple)!==null&&l!==void 0?l:true));f(this,N,le).call(this);f(this,X,ce).call(this);f(this,Z,me).call(this,100)}babelHelpers.createClass(e,[{key:"getValue",value:function e(){return babelHelpers.classPrivateFieldGet(this,G)}},{key:"setValue",value:function e(t){var l=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.clearAll();t.forEach((function(e){l.addValue(e,i)}))}},{key:"addValue",value:function e(t){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var a=babelHelpers.classPrivateFieldGet(this,g).find((function(e){var l;return(e===null||e===void 0?void 0:(l=e.id)===null||l===void 0?void 0:l.toString())===(t===null||t===void 0?void 0:t.toString())}));if(!a){return}if(!babelHelpers.classPrivateFieldGet(this,S)){var s=i.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="crm-field-item-selector__value">\n\t\t\t\t<span class="crm-field-item-selector__value-title">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),i.Text.encode(a.title));if(!babelHelpers.classPrivateFieldGet(this,w)){i.Dom.append(i.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="crm-field-item-selector__value-clear-icon" data-item-selector-id="','"/>\n\t\t\t\t\t</span>\n\t\t\t\t'])),a.id),s)}i.Dom.append(s,babelHelpers.classPrivateFieldGet(this,M));var r=s.offsetWidth;i.Dom.addClass(s,"--hidden");if(f(this,ee,He).call(this,r)){babelHelpers.classPrivateFieldGet(this,L)[a.id]=s}else{f(this,I,se).call(this,s)}babelHelpers.classPrivateFieldGet(this,y)[a.id]=s;f(this,U,ne).call(this,r)}babelHelpers.classPrivateFieldGet(this,G).push(a.id);f(this,B,ie).call(this);if(l){f(this,Q,pe).call(this)}}},{key:"removeValue",value:function e(t){var l;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!babelHelpers.classPrivateFieldGet(this,S)){if(babelHelpers.classPrivateFieldGet(this,y)[t]&&i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,y)[t])){f(this,V,re).call(this,babelHelpers.classPrivateFieldGet(this,y)[t]);i.Dom.remove(babelHelpers.classPrivateFieldGet(this,y)[t]);delete babelHelpers.classPrivateFieldGet(this,y)[t]}var s=babelHelpers.classPrivateFieldGet(this,L)[t]&&i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,L)[t]);if(s){delete babelHelpers.classPrivateFieldGet(this,L)[t]}if(!f(this,ee,He).call(this)||s){var r=Object.values(babelHelpers.classPrivateFieldGet(this,L))[0];if(i.Type.isDomNode(r)&&!f(this,ee,He).call(this,r.offsetWidth)){f(this,I,se).call(this,r);delete babelHelpers.classPrivateFieldGet(this,L)[Object.keys(babelHelpers.classPrivateFieldGet(this,L))[0]]}}f(this,U,ne).call(this)}babelHelpers.classPrivateFieldSet(this,G,(l=babelHelpers.classPrivateFieldGet(this,G))===null||l===void 0?void 0:l.filter((function(e){return(e===null||e===void 0?void 0:e.toString())!==(t===null||t===void 0?void 0:t.toString())})));f(this,B,ie).call(this);if(a){f(this,Q,pe).call(this)}}},{key:"clearAll",value:function e(){var t=this;if(!i.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,G))){return}babelHelpers.classPrivateFieldGet(this,G).forEach((function(e){return t.removeValue(e)}));babelHelpers.classPrivateFieldSet(this,G,[]);babelHelpers.classPrivateFieldSet(this,y,{});babelHelpers.classPrivateFieldSet(this,L,{});f(this,B,ie).call(this)}}]);return e}();function le(){if(!babelHelpers.classPrivateFieldGet(this,T)){return}if(!babelHelpers.classPrivateFieldGet(this,S)){babelHelpers.classPrivateFieldSet(this,k,i.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="crm-field-item-selector crm-field-item-selector__scope"></div>']))));babelHelpers.classPrivateFieldSet(this,M,i.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<span class="crm-field-item-selector__values"></span>']))));i.Dom.append(babelHelpers.classPrivateFieldGet(this,M),babelHelpers.classPrivateFieldGet(this,k))}if(!babelHelpers.classPrivateFieldGet(this,w)){if(babelHelpers.classPrivateFieldGet(this,S)){babelHelpers.classPrivateFieldSet(this,O,i.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="crm-field-item-selector-compact-icon ','"\n\t\t\t\t\t></span>\n\t\t\t\t'])),i.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,D))?"--".concat(babelHelpers.classPrivateFieldGet(this,D)):""));f(this,B,ie).call(this)}else{babelHelpers.classPrivateFieldSet(this,A,new n);i.Dom.append(f(this,R,ae).call(this),babelHelpers.classPrivateFieldGet(this,k))}}if(babelHelpers.classPrivateFieldGet(this,S)){i.Dom.append(f(this,R,ae).call(this),babelHelpers.classPrivateFieldGet(this,T))}else{i.Dom.append(babelHelpers.classPrivateFieldGet(this,k),babelHelpers.classPrivateFieldGet(this,T))}}function ie(){if(!babelHelpers.classPrivateFieldGet(this,S)){return}if(i.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,G))){i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,O),"--empty")}else{i.Dom.addClass(babelHelpers.classPrivateFieldGet(this,O),"--empty")}}function ae(){var e;return babelHelpers.classPrivateFieldGet(this,S)?babelHelpers.classPrivateFieldGet(this,O):(e=babelHelpers.classPrivateFieldGet(this,A))===null||e===void 0?void 0:e.getContainer()}function se(e){i.Dom.removeClass(e,["--hidden","--removing"]);i.Dom.addClass(e,"--adding")}function re(e){i.Dom.removeClass(e,"--adding");i.Dom.addClass(e,"--removing")}function ne(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!i.Type.isDomNode(f(this,R,ae).call(this))){return}var t=Object.keys(babelHelpers.classPrivateFieldGet(this,L)).length;if(babelHelpers.classPrivateFieldGet(this,G).length===0){babelHelpers.classPrivateFieldGet(this,A).applyState(r.ADD)}else if(f(this,ee,He).call(this,e)&&t>0){babelHelpers.classPrivateFieldGet(this,A).applyState(r.COUNTER_ADD,t)}else{babelHelpers.classPrivateFieldGet(this,A).applyState(r.MORE_ADD)}}function ce(){if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,O))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,O),"click",f(this,j,de).bind(this))}else if(i.Type.isDomNode(f(this,R,ae).call(this))){i.Event.bind(f(this,R,ae).call(this),"click",f(this,j,de).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,M))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,M),"click",f(this,q,ve).bind(this))}i.Event.unbind(window,"resize",f(this,K,ue));i.Event.bind(window,"resize",f(this,K,ue).bind(this))}function de(e){var i=f(this,x,he).call(this);var a=babelHelpers.classPrivateFieldGet(this,S)?{offset:29,position:"top"}:true;var s={closeByEsc:true,autoHide:true,offsetLeft:f(this,R,ae).call(this).offsetWidth-16,angle:a,cacheable:false};babelHelpers.classPrivateFieldSet(this,W,l.MenuManager.create(babelHelpers.classPrivateFieldGet(this,E),f(this,R,ae).call(this),i,s));babelHelpers.classPrivateFieldGet(this,W).show();t.EventEmitter.emit(this,P.EVENT_ITEMSELECTOR_OPEN)}function he(){var e=this;return babelHelpers.classPrivateFieldGet(this,g).map((function(t){return f(e,z,be).call(e,t)}))}function be(e){var t={id:"item-selector-menu-id-".concat(e.id),className:f(this,$,Fe).call(this,e.id)?m:F,onclick:f(this,J,oe).bind(this,e.id)};if(babelHelpers.classPrivateFieldGet(this,C)){t.html=babelHelpers.classPrivateFieldGet(this,C).call(this,e)}else{t.html=i.Text.encode(e.title)}return t}function ve(e){var t=e.target||e.srcElement;var l=t.getAttribute("data-item-selector-id");if(i.Type.isNull(l)){return}if(f(this,$,Fe).call(this,l)){this.removeValue(l,true)}}function oe(e,t,l){if(!babelHelpers.classPrivateFieldGet(this,_)){this.clearAll();babelHelpers.classPrivateFieldGet(this,W).menuItems.forEach((function(e){i.Dom.removeClass(e.getContainer(),m)}));babelHelpers.classPrivateFieldGet(this,W).close()}if(f(this,$,Fe).call(this,e)){this.removeValue(e,true);i.Dom.removeClass(l.getContainer(),m);i.Dom.addClass(l.getContainer(),F)}else{this.addValue(e,true);i.Dom.removeClass(l.getContainer(),F);i.Dom.addClass(l.getContainer(),m)}}function ue(){f(this,Z,me).call(this,750)}function pe(){t.EventEmitter.emit(this,P.EVENT_ITEMSELECTOR_VALUE_CHANGE,{value:this.getValue()})}function fe(e){if(!i.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Field.ItemSelector: The "params" argument must be object')}if(!i.Type.isDomNode(e.target)){throw new Error('BX.Crm.Field.ItemSelector: The "target" argument must be DOM node')}if(!i.Type.isArrayFilled(e.valuesList)){throw new Error('BX.Crm.Field.ItemSelector: The "valuesList" argument must be filled')}}function me(e){var t=this;i.Runtime.debounce((function(){t.setValue(babelHelpers.classPrivateFieldGet(t,G)||[])}),e,this)()}function Fe(e){return!i.Type.isUndefined(babelHelpers.classPrivateFieldGet(this,G).find((function(t){return t.toString()===e.toString()})))}function He(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(babelHelpers.classPrivateFieldGet(this,w)||babelHelpers.classPrivateFieldGet(this,S)){return false}var t=babelHelpers.classPrivateFieldGet(this,T).offsetWidth;var l=babelHelpers.classPrivateFieldGet(this,M).offsetWidth;var i=f(this,R,ae).call(this).offsetWidth;var a=t-(l+i+e);return a<=20}e.CompactIcons=H;e.Events=P;e.ItemSelector=te})(this.BX.Crm.Field=this.BX.Crm.Field||{},BX.Event,BX.Main,BX,BX.UI);
//# sourceMappingURL=item-selector.bundle.map.js