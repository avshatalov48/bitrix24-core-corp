this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,a,i,l){"use strict";var s="crm-field-item-selector__add-btn";var r=Object.freeze({ADD:"add",MORE_ADD:"more-add",COUNTER_ADD:"counter-add"});var n=function(e){babelHelpers.inherits(t,e);function t(e){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.Dom.addClass(a.getContainer(),s);return a}babelHelpers.createClass(t,[{key:"getDefaultOptions",value:function e(){return{id:"item-selector-button-".concat(i.Text.getRandom()),text:i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL"),tag:l.Button.Tag.SPAN,size:l.Button.Size.EXTRA_SMALL,color:l.Button.Color.LIGHT,round:true,dropdown:true}}},{key:"applyState",value:function e(t){var a;var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;switch(t){case r.MORE_ADD:this.setText(i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_BUTTON_LABEL"));break;case r.COUNTER_ADD:this.setText((a=i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_MORE_COUNTER_BUTTON_LABEL"))===null||a===void 0?void 0:a.replace("#COUNTER#",l));break;case r.ADD:default:this.setText(i.Loc.getMessage("CRM_FIELD_ITEM_SELECTOR_DEFAULT_ADD_BUTTON_LABEL"));break}}}]);return t}(l.Button);var c,d,h,o;function b(e,t){u(e,t);t.add(e)}function v(e,t,a){u(e,t);t.set(e,a)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function p(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var f="menu-popup-item-accept";var m="menu-popup-item-none";var F={EVENT_ITEMSELECTOR_VALUE_CHANGE:"crm.field.itemselector:change"};var H=new WeakMap;var T=new WeakMap;var E=new WeakMap;var g=new WeakMap;var P=new WeakMap;var w=new WeakMap;var D=new WeakMap;var _=new WeakMap;var S=new WeakMap;var C=new WeakMap;var G=new WeakMap;var k=new WeakSet;var L=new WeakSet;var y=new WeakSet;var M=new WeakSet;var A=new WeakSet;var W=new WeakSet;var O=new WeakSet;var B=new WeakSet;var R=new WeakSet;var N=new WeakSet;var U=new WeakSet;var V=new WeakSet;var I=new WeakSet;var X=new WeakSet;var x=new WeakSet;var j=function(){function e(t){babelHelpers.classCallCheck(this,e);b(this,x);b(this,X);b(this,I);b(this,V);b(this,U);b(this,N);b(this,R);b(this,B);b(this,O);b(this,W);b(this,A);b(this,M);b(this,y);b(this,L);b(this,k);v(this,H,{writable:true,value:void 0});v(this,T,{writable:true,value:null});v(this,E,{writable:true,value:[]});v(this,g,{writable:true,value:[]});v(this,P,{writable:true,value:false});v(this,w,{writable:true,value:null});v(this,D,{writable:true,value:{}});v(this,_,{writable:true,value:{}});v(this,S,{writable:true,value:null});v(this,C,{writable:true,value:null});v(this,G,{writable:true,value:null});p(this,V,ie).call(this,t);babelHelpers.classPrivateFieldSet(this,H,t.id||"item-selector-".concat(i.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,T,i.Type.isDomNode(t.target)?t.target:null);babelHelpers.classPrivateFieldSet(this,E,i.Type.isArrayFilled(t.valuesList)?t.valuesList:[]);babelHelpers.classPrivateFieldSet(this,g,i.Type.isArrayFilled(t.selectedValues)?t.selectedValues:[]);babelHelpers.classPrivateFieldSet(this,P,t.readonlyMode===true);p(this,k,z).call(this);p(this,W,Y).call(this);p(this,I,le).call(this,100)}babelHelpers.createClass(e,[{key:"getValue",value:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"setValue",value:function e(t){var a=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.clearAll();t.forEach((function(e){a.addValue(e,i)}))}},{key:"addValue",value:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var l=babelHelpers.classPrivateFieldGet(this,E).find((function(e){return e.id.toString()===t.toString()}));if(!l){return}var s=i.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="crm-field-item-selector__value">\n\t\t\t\t<span class="crm-field-item-selector__value-title">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),i.Text.encode(l.title));if(!babelHelpers.classPrivateFieldGet(this,P)){i.Dom.append(i.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="crm-field-item-selector__value-clear-icon" data-item-selector-id="','"/>\n\t\t\t\t\t</span>\n\t\t\t\t'])),l.id),s)}i.Dom.append(s,babelHelpers.classPrivateFieldGet(this,S));var r=s.offsetWidth;i.Dom.addClass(s,"--hidden");if(p(this,x,re).call(this,r)){babelHelpers.classPrivateFieldGet(this,_)[l.id]=s}else{p(this,y,J).call(this,s)}babelHelpers.classPrivateFieldGet(this,g).push(l.id);babelHelpers.classPrivateFieldGet(this,D)[l.id]=s;p(this,A,Q).call(this,r);if(a){p(this,U,ae).call(this)}}},{key:"removeValue",value:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(babelHelpers.classPrivateFieldGet(this,D)[t]&&i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,D)[t])){p(this,M,K).call(this,babelHelpers.classPrivateFieldGet(this,D)[t]);i.Dom.remove(babelHelpers.classPrivateFieldGet(this,D)[t]);delete babelHelpers.classPrivateFieldGet(this,D)[t]}babelHelpers.classPrivateFieldSet(this,g,babelHelpers.classPrivateFieldGet(this,g).filter((function(e){return e.toString()!==t.toString()})));var l=babelHelpers.classPrivateFieldGet(this,_)[t]&&i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,_)[t]);if(l){delete babelHelpers.classPrivateFieldGet(this,_)[t]}if(!p(this,x,re).call(this)||l){var s=Object.values(babelHelpers.classPrivateFieldGet(this,_))[0];if(i.Type.isDomNode(s)&&!p(this,x,re).call(this,s.offsetWidth)){p(this,y,J).call(this,s);delete babelHelpers.classPrivateFieldGet(this,_)[Object.keys(babelHelpers.classPrivateFieldGet(this,_))[0]]}}p(this,A,Q).call(this);if(a){p(this,U,ae).call(this)}}},{key:"clearAll",value:function e(){var t=this;if(!i.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,g))){return}babelHelpers.classPrivateFieldGet(this,g).forEach((function(e){return t.removeValue(e)}));babelHelpers.classPrivateFieldSet(this,g,[]);babelHelpers.classPrivateFieldSet(this,D,{});babelHelpers.classPrivateFieldSet(this,_,{})}}]);return e}();function z(){if(!babelHelpers.classPrivateFieldGet(this,T)){return}babelHelpers.classPrivateFieldSet(this,w,i.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="crm-field-item-selector crm-field-item-selector__scope"></div>']))));babelHelpers.classPrivateFieldSet(this,S,i.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<span class="crm-field-item-selector__values"></span>']))));i.Dom.append(babelHelpers.classPrivateFieldGet(this,S),babelHelpers.classPrivateFieldGet(this,w));if(!babelHelpers.classPrivateFieldGet(this,P)){babelHelpers.classPrivateFieldSet(this,G,new n);i.Dom.append(p(this,L,q).call(this),babelHelpers.classPrivateFieldGet(this,w))}i.Dom.append(babelHelpers.classPrivateFieldGet(this,w),babelHelpers.classPrivateFieldGet(this,T))}function q(){var e;return(e=babelHelpers.classPrivateFieldGet(this,G))===null||e===void 0?void 0:e.getContainer()}function J(e){i.Dom.removeClass(e,["--hidden","--removing"]);i.Dom.addClass(e,"--adding")}function K(e){i.Dom.removeClass(e,"--adding");i.Dom.addClass(e,"--removing")}function Q(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!i.Type.isDomNode(p(this,L,q).call(this))){return}var t=Object.keys(babelHelpers.classPrivateFieldGet(this,_)).length;if(babelHelpers.classPrivateFieldGet(this,g).length===0){babelHelpers.classPrivateFieldGet(this,G).applyState(r.ADD)}else if(p(this,x,re).call(this,e)&&t>0){babelHelpers.classPrivateFieldGet(this,G).applyState(r.COUNTER_ADD,t)}else{babelHelpers.classPrivateFieldGet(this,G).applyState(r.MORE_ADD)}}function Y(){if(i.Type.isDomNode(p(this,L,q).call(this))){i.Event.bind(p(this,L,q).call(this),"click",p(this,O,Z).bind(this))}if(i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,S))){i.Event.bind(babelHelpers.classPrivateFieldGet(this,S),"click",p(this,B,$).bind(this))}i.Event.unbind(window,"resize",p(this,N,te));i.Event.bind(window,"resize",p(this,N,te).bind(this))}function Z(e){var a=this;var l=babelHelpers.classPrivateFieldGet(this,E).map((function(e){return{id:"item-selector-menu-id-".concat(e.id),text:i.Text.encode(e.title),className:p(a,X,se).call(a,e.id)?f:m,onclick:p(a,R,ee).bind(a,e.id)}}));var s={closeByEsc:true,autoHide:true,offsetTop:0,offsetLeft:p(this,L,q).call(this).offsetWidth-16,angle:true,cacheable:false};babelHelpers.classPrivateFieldSet(this,C,t.MenuManager.create(babelHelpers.classPrivateFieldGet(this,H),p(this,L,q).call(this),l,s));babelHelpers.classPrivateFieldGet(this,C).show()}function $(e){var t=e.target||e.srcElement;var a=t.getAttribute("data-item-selector-id");if(i.Type.isNull(a)){return}if(p(this,X,se).call(this,a)){this.removeValue(a,true)}}function ee(e,t,a){if(p(this,X,se).call(this,e)){this.removeValue(e,true);i.Dom.removeClass(a.getContainer(),f);i.Dom.addClass(a.getContainer(),m)}else{this.addValue(e,true);i.Dom.removeClass(a.getContainer(),m);i.Dom.addClass(a.getContainer(),f)}}function te(){p(this,I,le).call(this,750)}function ae(){a.EventEmitter.emit(this,F.EVENT_ITEMSELECTOR_VALUE_CHANGE,{value:this.getValue()})}function ie(e){if(!i.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Field.ItemSelector: The "params" argument must be object')}if(!i.Type.isDomNode(e.target)){throw new Error('BX.Crm.Field.ItemSelector: The "target" argument must be DOM node')}if(!i.Type.isArrayFilled(e.valuesList)){throw new Error('BX.Crm.Field.ItemSelector: The "valuesList" argument must be filled')}}function le(e){var t=this;i.Runtime.debounce((function(){t.setValue(babelHelpers.classPrivateFieldGet(t,g)||[])}),e,this)()}function se(e){return!i.Type.isUndefined(babelHelpers.classPrivateFieldGet(this,g).find((function(t){return t.toString()===e.toString()})))}function re(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(babelHelpers.classPrivateFieldGet(this,P)){return false}var t=babelHelpers.classPrivateFieldGet(this,T).offsetWidth;var a=babelHelpers.classPrivateFieldGet(this,S).offsetWidth;var i=p(this,L,q).call(this).offsetWidth;var l=t-(a+i+e);return l<=20}e.Events=F;e.ItemSelector=j})(this.BX.Crm.Field=this.BX.Crm.Field||{},BX.Main,BX.Event,BX,BX.UI);
//# sourceMappingURL=item-selector.bundle.map.js