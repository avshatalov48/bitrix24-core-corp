{"version":3,"file":"list-editor.bundle.js","sources":["../src/item/item.js","../src/backend/backend.js","../src/list-editor.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Text, Dom, Type} from 'main.core';\nimport 'ui.forms';\nimport '\"ui.layout-form';\nimport type {ListEditorItemOptions} from '../types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport class Item extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\n\tconstructor(options: ListEditorItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor.Item');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setOptions(options);\n\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\t}\n\n\tsetOptions(options: ListEditorItemOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetCustomTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('customTitleLayout', () => {\n\t\t\treturn this.getLayout().querySelector('.crm-field-list-editor-item-text-custom-title');\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\tconst {data, categoryCaption} = this.getOptions();\n\t\t\tconst {sourceData} = this.getOptions();\n\t\t\tconst label = data.label || sourceData.caption;\n\n\t\t\tconst preparedCategoryCaption = (() => {\n\t\t\t\tif (Type.isStringFilled(categoryCaption))\n\t\t\t\t{\n\t\t\t\t\treturn `&middot; ${Text.encode(categoryCaption)}`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item\" data-name=\"${Text.encode(sourceData.name)}\">\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-header\">\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-drag-button\"></div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text\">\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-source-title\">\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${Text.encode(sourceData.caption)}</span>\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${preparedCategoryCaption}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title\">\n\t\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title-inner\">${Text.encode(label)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-actions\">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-edit\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEditClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-remove\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onRemoveClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-body\">\n\t\t\t\t\t\t${this.getFormLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonEditClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isOpened())\n\t\t{\n\t\t\tthis.open();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tonRemoveClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tthis.emit('onRemove');\n\t}\n\n\topen()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tisOpened(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tclose()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tcreateTextInput(options: {name: string, label: string, value: string}): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-text-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tvalue=\"${options.value}\"\n\t\t\t\t\t\t\toninput=\"${this.onFormChange}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\">\t\n\t\t\t\t\t</div>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateCheckbox(options: {name: string, label: string, checked: boolean}): HTMLLabelElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-checkbox-row\">\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tonchange=\"${this.onFormChange}\"\n\t\t\t\t\t\t\t${options.checked ? 'checked': ''}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t\t</label>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetAllInputs(): Array<HTMLInputElement>\n\t{\n\t\treturn [...this.getLayout().querySelectorAll('.ui-ctl-element')];\n\t}\n\n\tgetValue(): {[key: string]: any}\n\t{\n\t\treturn this.getAllInputs().reduce((acc, input) => {\n\t\t\tacc[input.name] = input.type === 'checkbox' ? input.checked : input.value;\n\t\t\treturn acc;\n\t\t}, {...this.getOptions().data});\n\t}\n\n\tonFormChange()\n\t{\n\t\tconst value = this.getValue();\n\t\tthis.getCustomTitleLayout().textContent = value.caption || value.label;\n\n\t\tthis.emit('onChange');\n\t}\n\n\tgetFormControls(): Array<HTMLElement>\n\t{\n\t\treturn this.#cache.remember('formControls', () => {\n\t\t\tconst editableEntries = Object.entries(this.getOptions().editable);\n\t\t\tconst {data} = this.getOptions();\n\n\t\t\treturn editableEntries.map(([name, options]) => {\n\t\t\t\tif (options.type === 'string')\n\t\t\t\t{\n\t\t\t\t\treturn this.createTextInput({\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tlabel: options.label,\n\t\t\t\t\t\tvalue: data[name],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this.createCheckbox({\n\t\t\t\t\tname,\n\t\t\t\t\tlabel: options.label,\n\t\t\t\t\tchecked: data[name],\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFormLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('formLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item-form\">\n\t\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t\t${this.getFormControls()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {Cache, ajax, Type} from 'main.core';\n\nconst {MemoryCache} = Cache;\n\nexport class Backend\n{\n\tstatic #instance = null;\n\t#cache = new MemoryCache();\n\n\tstatic getInstance(): Backend\n\t{\n\t\tif (!Backend.#instance)\n\t\t{\n\t\t\tBackend.#instance = new Backend();\n\t\t}\n\n\t\treturn Backend.#instance;\n\t}\n\n\tgetFieldsList(): Promise<any>\n\t{\n\t\treturn this.#cache.remember('fieldsList', () => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tajax\n\t\t\t\t\t.runAction('crm.api.form.field.list', {json: {}})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (Type.isPlainObject(result?.data?.tree))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(result.data.tree);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFieldsSet(id: number): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.get', {json: {id}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result.data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tsaveFieldsSet(options: {[key: string]: any}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.set', {json: {options}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Dom, Text, Loc, Tag, Type, Runtime, Event} from 'main.core';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {SaveButton} from 'ui.buttons';\nimport {Loader} from 'main.loader';\nimport {Item} from './item/item';\nimport {Backend} from './backend/backend';\nimport 'landing.master';\n\nimport type {ListEditorOptions} from './types/list-editor-options';\nimport type {ListEditorItemOptions} from './types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport {\n\tBackend,\n};\n\n/**\n * @memberOf BX.Crm.Field\n */\nexport class ListEditor extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\t#loadPromise: Promise;\n\n\tstatic #defaultOptions = {\n\t\tsetId: 0,\n\t\tautoSave: true,\n\t\tfieldsPanelOptions: {},\n\t\tdebouncingDelay: 500,\n\t};\n\n\tconstructor(options: ListEditorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setTitle(options.title || '');\n\t\tthis.onWindowResize = this.onWindowResize.bind(this);\n\n\t\tthis.setOptions({\n\t\t\t...ListEditor.#defaultOptions,\n\t\t\t...options,\n\t\t});\n\n\t\tthis.onDebounceChange = Runtime.debounce(\n\t\t\tthis.onDebounceChange,\n\t\t\tthis.getOptions().debouncingDelay,\n\t\t\tthis,\n\t\t);\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.crm-field-list-editor-item',\n\t\t\tdragElement: '.crm-field-list-editor-item-drag-button',\n\t\t\toffset: {\n\t\t\t\tx: -800,\n\t\t\t},\n\t\t\tcontext: window.top,\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onSortEnd.bind(this));\n\n\t\tthis.showLoader();\n\n\t\tthis.#loadPromise = Promise\n\t\t\t.all([\n\t\t\t\tthis.loadFieldsDictionary(),\n\t\t\t\tthis.loadValue(),\n\t\t\t])\n\t\t\t.then(([fieldsDictionary, value]) => {\n\t\t\t\tif (Type.isPlainObject(fieldsDictionary))\n\t\t\t\t{\n\t\t\t\t\tthis.setFieldsDictionary(fieldsDictionary);\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid fields dictionary');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isPlainObject(value))\n\t\t\t\t{\n\t\t\t\t\tthis.setClientEntityTypeId(value.clientEntityTypeId);\n\t\t\t\t\tthis.setEntityTypeId(value.entityTypeId);\n\n\t\t\t\t\tif (Type.isStringFilled(value.title) && !Type.isStringFilled(this.getTitle()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTitle(value.title);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(value.fields))\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue.fields.forEach((itemData) => {\n\t\t\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\t\t\tsourceData: this.getFieldByName(itemData.name),\n\t\t\t\t\t\t\t\tdata: itemData,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid value');\n\t\t\t\t}\n\n\t\t\t\tthis.hideLoader();\n\t\t\t});\n\t}\n\n\tsetData(data: {[key: string]: any})\n\t{\n\t\tthis.#cache.set('data', {...data});\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.#cache.get('data', {});\n\t}\n\n\tsetTitle(title: string)\n\t{\n\t\tthis.#cache.set('title', title);\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#cache.get('title', '');\n\t}\n\n\tsetClientEntityTypeId(clientEntityTypeId)\n\t{\n\t\tthis.#cache.set('clientEntityTypeId', clientEntityTypeId);\n\t}\n\n\tgetClientEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('clientEntityTypeId');\n\t}\n\n\tsetEntityTypeId(entityTypeId)\n\t{\n\t\tthis.#cache.set('entityTypeId', entityTypeId);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('entityTypeId');\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.#cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.getLayout(),\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetOptions(options: ListEditorOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tsetFieldsDictionary(fields: Array<any>)\n\t{\n\t\tthis.#cache.set('fieldsDictionary', fields);\n\t}\n\n\tgetFieldsDictionary(): Array<any>\n\t{\n\t\treturn this.#cache.get('fieldsDictionary', []);\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor\">\n\t\t\t\t\t${this.getListContainer()}\n\t\t\t\t\t<div class=\"crm-field-list-editor-footer\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"ui-link ui-link-dashed\"\n\t\t\t\t\t\t\tonclick=\"${this.onAddFieldClick.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_FIELD_LIST_EDITOR_ADD_FIELD_BUTTON_LABEL')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(target: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\tconsole.error('target is not a DOM element');\n\t\t}\n\n\t\tDom.append(this.getLayout(), target);\n\t}\n\n\tloadFieldsDictionary(): Promise<any>\n\t{\n\t\treturn Backend.getInstance().getFieldsList();\n\t}\n\n\tloadValue(): Promise<any>\n\t{\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.getFieldsSet(this.getOptions().setId)\n\t\t\t.then((result) => {\n\t\t\t\treturn result.options;\n\t\t\t});\n\t}\n\n\tgetItems(): Array<Item>\n\t{\n\t\treturn this.#cache.remember('items', []);\n\t}\n\n\tsetItems(items: Array<Item>)\n\t{\n\t\tthis.#cache.set('items', items);\n\t}\n\n\taddItem(options: ListEditorItemOptions)\n\t{\n\t\tconst items = this.getItems();\n\n\t\tconst hasItem = items.some((item) => {\n\t\t\treturn item.getOptions().data.name === options.data.name;\n\t\t});\n\n\t\tif (!hasItem)\n\t\t{\n\t\t\tconst item = new Item({\n\t\t\t\t...options,\n\t\t\t\tcategoryCaption: this.getCategoryCaption(options.data.name),\n\t\t\t\teditable: this.getOptions().editable,\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: () => {\n\t\t\t\t\t\tthis.onChange();\n\t\t\t\t\t},\n\t\t\t\t\tonRemove: this.onRemoveItemClick.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\titems.push(item);\n\t\t\tDom.append(item.getLayout(), this.getListContainer());\n\t\t}\n\t}\n\n\tonRemoveItemClick(event: BaseEvent)\n\t{\n\t\tconst target: Item = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tthis.setItems(\n\t\t\tthis.getItems().filter((item) => {\n\t\t\t\treturn item !== target;\n\t\t\t}),\n\t\t);\n\n\t\tthis.onChange();\n\t}\n\n\tgetFieldByName(name: string): ?{[key: string]: any}\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\treturn category.FIELDS.find((field) => {\n\t\t\t\t\treturn field.name === name;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, null);\n\t}\n\n\tgetCategoryCaption(fieldName: string): string\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\tconst hasField = category.FIELDS.some((field) => {\n\t\t\t\t\treturn field.name === fieldName;\n\t\t\t\t});\n\n\t\t\t\tif (hasField)\n\t\t\t\t{\n\t\t\t\t\treturn category.CAPTION;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, '');\n\t}\n\n\tshowFieldsPanel(panelOptions): Promise<Array<string>>\n\t{\n\t\tconst fieldsPanel = FieldsPanel.getInstance();\n\t\tDom.append(fieldsPanel.layout, window.top.document.body);\n\t\treturn fieldsPanel.show(panelOptions);\n\t}\n\n\tonAddFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\tthis.showFieldsPanel(fieldsPanelOptions)\n\t\t\t.then((result) => {\n\t\t\t\tthis.setFieldsDictionary(\n\t\t\t\t\tFieldsPanel.getInstance().getCrmFields(),\n\t\t\t\t);\n\n\t\t\t\treturn result;\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tresult.forEach((fieldName) => {\n\t\t\t\t\tconst fieldData = this.getFieldByName(fieldName);\n\t\t\t\t\tif (!Type.isString(fieldData.label) && Type.isString(fieldData.caption))\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldData.label = fieldData.caption;\n\t\t\t\t\t}\n\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\tsourceData: fieldData,\n\t\t\t\t\t\tdata: fieldData,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.onChange();\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonChange()\n\t{\n\t\tthis.emit('onChange');\n\t\tthis.onDebounceChange();\n\t}\n\n\tonDebounceChange()\n\t{\n\t\tif (this.getOptions().autoSave)\n\t\t{\n\t\t\tvoid this.save();\n\t\t}\n\n\t\tthis.emit('onDebounceChange');\n\t}\n\n\tsave(): Promise<any>\n\t{\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.saveFieldsSet({\n\t\t\t\tid: this.getOptions().setId,\n\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\tclientEntityTypeId: this.getClientEntityTypeId(),\n\t\t\t\t...this.getData(),\n\t\t\t\tfields: this.getValue(),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.emit('onSave');\n\t\t\t});\n\t}\n\n\tgetValue(): Array<{[key: string]: any}>\n\t{\n\t\treturn this.getItems().map((item) => {\n\t\t\treturn item.getValue();\n\t\t});\n\t}\n\n\t#adjustSliderDragAndDropOffsets()\n\t{\n\t\tconst sliderLayout = this.getLayout().closest('.ui-sidepanel-layout');\n\t\tif (Type.isDomNode(sliderLayout))\n\t\t{\n\t\t\tconst offsetLeft = -(sliderLayout.getBoundingClientRect().left);\n\n\t\t\tthis.draggable.setOptions({\n\t\t\t\t...this.draggable.getOptions(),\n\t\t\t\toffset: {\n\t\t\t\t\tx: offsetLeft,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tonWindowResize()\n\t{\n\t\tthis.#adjustSliderDragAndDropOffsets();\n\t}\n\n\tshowSlider()\n\t{\n\t\tconst buttons = [];\n\t\tif (!this.getOptions().autoSave)\n\t\t{\n\t\t\tbuttons.push(\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting(true);\n\t\t\t\t\t\tthis.save().then(() => {\n\t\t\t\t\t\t\tbutton.setWaiting(false);\n\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tBX.SidePanel.Instance.open('crm:field-list-editor', {\n\t\t\twidth: 600,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn this.#loadPromise\n\t\t\t\t\t.then(() => Layout.createContent({\n\t\t\t\t\t\textensions: ['crm.field.list-editor'],\n\t\t\t\t\t\ttitle: this.getTitle(),\n\t\t\t\t\t\tcontent: () => this.getLayout(),\n\t\t\t\t\t\tbuttons: ({cancelButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t...buttons,\n\t\t\t\t\t\t\t\tcancelButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t\t.catch(({errors}) => Layout.createContent({\n\t\t\t\t\t\textensions: ['ui.sidepanel-content'],\n\t\t\t\t\t\tdesign: {section: false},\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\tconst title = Loc.getMessage('CRM_FIELD_LIST_EDITOR_ERROR_LOAD');\n\t\t\t\t\t\t\tconst msg = ((errors||[])[0]||{}).message || 'Unknown error';\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-title\">${Text.encode(title)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">${Text.encode(msg)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t;\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonOpenComplete: () => {\n\t\t\t\t\tconst timeoutId = setTimeout(() => {\n\t\t\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\t\t\tthis.#adjustSliderDragAndDropOffsets();\n\t\t\t\t\t}, 500);\n\t\t\t\t\tEvent.bind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tEvent.unbind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tonSortEnd()\n\t{\n\t\tconst listNodes = [...this.getListContainer().children];\n\n\t\tthis.getItems().sort((a, b) => {\n\t\t\tconst aIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn a.getLayout() === node;\n\t\t\t});\n\n\t\t\tconst bIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn b.getLayout() === node;\n\t\t\t});\n\n\t\t\treturn aIndex - bIndex;\n\t\t});\n\n\t\tthis.onChange();\n\t}\n}"],"names":["MemoryCache","Cache","Item","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","setOptions","onFormChange","bind","set","getOptions","get","getCustomTitleLayout","remember","getLayout","querySelector","data","categoryCaption","sourceData","label","caption","preparedCategoryCaption","Type","isStringFilled","Text","encode","Tag","render","name","onEditClick","onRemoveClick","getFormLayout","event","preventDefault","isOpened","open","close","emit","Dom","addClass","hasClass","removeClass","createTextInput","value","createCheckbox","checked","getAllInputs","querySelectorAll","getValue","reduce","acc","input","type","textContent","getFormControls","editableEntries","Object","entries","editable","map","Backend","getInstance","getFieldsList","Promise","resolve","reject","ajax","runAction","json","then","result","isPlainObject","tree","catch","error","getFieldsSet","id","saveFieldsSet","ListEditor","setTitle","title","onWindowResize","onDebounceChange","Runtime","debounce","debouncingDelay","draggable","Draggable","container","getListContainer","dragElement","offset","x","context","window","top","subscribe","onSortEnd","showLoader","all","loadFieldsDictionary","loadValue","fieldsDictionary","setFieldsDictionary","console","setClientEntityTypeId","clientEntityTypeId","setEntityTypeId","entityTypeId","getTitle","isArrayFilled","fields","forEach","itemData","addItem","getFieldByName","hideLoader","setData","getData","getClientEntityTypeId","getEntityTypeId","getLoader","Loader","target","show","hide","getFieldsDictionary","onAddFieldClick","Loc","getMessage","renderTo","isDomNode","append","setId","getItems","setItems","items","hasItem","some","item","getCategoryCaption","onChange","onRemove","onRemoveItemClick","push","getTarget","remove","filter","values","category","FIELDS","find","field","fieldName","hasField","CAPTION","showFieldsPanel","panelOptions","fieldsPanel","FieldsPanel","layout","document","body","fieldsPanelOptions","disabledFields","getCrmFields","fieldData","isString","autoSave","save","showSlider","buttons","SaveButton","onclick","button","setWaiting","BX","SidePanel","Instance","width","contentCallback","Layout","createContent","extensions","content","cancelButton","errors","design","section","msg","message","closeButton","onOpenComplete","timeoutId","setTimeout","clearTimeout","Event","onClose","unbind","listNodes","children","sort","a","b","aIndex","findIndex","node","bIndex","sliderLayout","closest","offsetLeft","getBoundingClientRect","left"],"mappings":"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"}