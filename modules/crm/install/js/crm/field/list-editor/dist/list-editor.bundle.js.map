{"version":3,"file":"list-editor.bundle.js","sources":["../src/item/item.js","../src/backend/backend.js","../src/list-editor.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Text, Dom, Type} from 'main.core';\nimport 'ui.forms';\nimport '\"ui.layout-form';\nimport type {ListEditorItemOptions} from '../types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport class Item extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\n\tconstructor(options: ListEditorItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor.Item');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setOptions(options);\n\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\t}\n\n\tsetOptions(options: ListEditorItemOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetCustomTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('customTitleLayout', () => {\n\t\t\treturn this.getLayout().querySelector('.crm-field-list-editor-item-text-custom-title');\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\tconst {data, categoryCaption} = this.getOptions();\n\t\t\tconst {sourceData} = this.getOptions();\n\t\t\tconst label = data.label || sourceData.caption;\n\n\t\t\tconst preparedCategoryCaption = (() => {\n\t\t\t\tif (Type.isStringFilled(categoryCaption))\n\t\t\t\t{\n\t\t\t\t\treturn `&middot; ${Text.encode(categoryCaption)}`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item\" data-name=\"${Text.encode(sourceData?.name || '')}\">\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-header\">\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-drag-button\"></div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text\">\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-source-title\">\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${Text.encode(sourceData?.caption || '')}</span>\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${preparedCategoryCaption}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title\">\n\t\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title-inner\">${Text.encode(label)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-actions\">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-edit\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEditClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-remove\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onRemoveClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-body\">\n\t\t\t\t\t\t${this.getFormLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonEditClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isOpened())\n\t\t{\n\t\t\tthis.open();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tonRemoveClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tthis.emit('onRemove');\n\t}\n\n\topen()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tisOpened(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tclose()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tcreateTextInput(options: {name: string, label: string, value: string}): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-text-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tvalue=\"${options.value}\"\n\t\t\t\t\t\t\toninput=\"${this.onFormChange}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\">\t\n\t\t\t\t\t</div>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateCheckbox(options: {name: string, label: string, checked: boolean}): HTMLLabelElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-checkbox-row\">\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tonchange=\"${this.onFormChange}\"\n\t\t\t\t\t\t\t${options.checked ? 'checked': ''}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t\t</label>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetAllInputs(): Array<HTMLInputElement>\n\t{\n\t\treturn [...this.getLayout().querySelectorAll('.ui-ctl-element')];\n\t}\n\n\tgetValue(): {[key: string]: any}\n\t{\n\t\treturn this.getAllInputs().reduce((acc, input) => {\n\t\t\tacc[input.name] = input.type === 'checkbox' ? input.checked : input.value;\n\t\t\treturn acc;\n\t\t}, {...this.getOptions().data});\n\t}\n\n\tonFormChange()\n\t{\n\t\tconst value = this.getValue();\n\t\tthis.getCustomTitleLayout().textContent = value.caption || value.label;\n\n\t\tthis.emit('onChange');\n\t}\n\n\tgetFormControls(): Array<HTMLElement>\n\t{\n\t\treturn this.#cache.remember('formControls', () => {\n\t\t\tconst editableEntries = Object.entries(this.getOptions().editable);\n\t\t\tconst {data} = this.getOptions();\n\n\t\t\treturn editableEntries.map(([name, options]) => {\n\t\t\t\tif (options.type === 'string')\n\t\t\t\t{\n\t\t\t\t\treturn this.createTextInput({\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tlabel: options.label,\n\t\t\t\t\t\tvalue: data[name],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this.createCheckbox({\n\t\t\t\t\tname,\n\t\t\t\t\tlabel: options.label,\n\t\t\t\t\tchecked: data[name],\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFormLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('formLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item-form\">\n\t\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t\t${this.getFormControls()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {Cache, ajax, Type} from 'main.core';\n\nconst {MemoryCache} = Cache;\n\nexport class Backend\n{\n\tstatic #instance = null;\n\t#cache = new MemoryCache();\n\n\tstatic getInstance(): Backend\n\t{\n\t\tif (!Backend.#instance)\n\t\t{\n\t\t\tBackend.#instance = new Backend();\n\t\t}\n\n\t\treturn Backend.#instance;\n\t}\n\n\tgetFieldsList(presetId: number): Promise<any>\n\t{\n\t\treturn this.#cache.remember('fieldsList', () => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tajax\n\t\t\t\t\t.runAction('crm.api.form.field.list', {json: {presetId}})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (Type.isPlainObject(result?.data?.tree))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(result.data.tree);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFieldsSet(id: number): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.get', {json: {id}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result.data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tsaveFieldsSet(options: {[key: string]: any}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.set', {json: {options}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Dom, Text, Loc, Tag, Type, Runtime, Event} from 'main.core';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {SaveButton} from 'ui.buttons';\nimport {Loader} from 'main.loader';\nimport {Item} from './item/item';\nimport {Backend} from './backend/backend';\nimport 'landing.master';\n\nimport type {ListEditorOptions} from './types/list-editor-options';\nimport type {ListEditorItemOptions} from './types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport {\n\tBackend,\n};\n\n/**\n * @memberOf BX.Crm.Field\n */\nexport class ListEditor extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\t#loadPromise: Promise;\n\n\tstatic #defaultOptions = {\n\t\tsetId: 0,\n\t\tautoSave: true,\n\t\tcacheable: true,\n\t\tfieldsPanelOptions: {},\n\t\tdebouncingDelay: 500,\n\t};\n\n\tconstructor(options: ListEditorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setTitle(options.title || '');\n\t\tthis.onWindowResize = this.onWindowResize.bind(this);\n\n\t\tthis.setOptions({\n\t\t\t...ListEditor.#defaultOptions,\n\t\t\t...options,\n\t\t});\n\n\t\tthis.onDebounceChange = Runtime.debounce(\n\t\t\tthis.onDebounceChange,\n\t\t\tthis.getOptions().debouncingDelay,\n\t\t\tthis,\n\t\t);\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.crm-field-list-editor-item',\n\t\t\tdragElement: '.crm-field-list-editor-item-drag-button',\n\t\t\toffset: {\n\t\t\t\tx: -800,\n\t\t\t},\n\t\t\tcontext: window.top,\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onSortEnd.bind(this));\n\n\t\tthis.showLoader();\n\n\t\tthis.#loadPromise = Promise\n\t\t\t.all([\n\t\t\t\tthis.loadFieldsDictionary(),\n\t\t\t\tthis.loadValue(),\n\t\t\t])\n\t\t\t.then(([fieldsDictionary, value]) => {\n\t\t\t\tif (Type.isPlainObject(fieldsDictionary))\n\t\t\t\t{\n\t\t\t\t\tthis.setFieldsDictionary(fieldsDictionary);\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid fields dictionary');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isPlainObject(value))\n\t\t\t\t{\n\t\t\t\t\tthis.setClientEntityTypeId(value.clientEntityTypeId);\n\t\t\t\t\tthis.setEntityTypeId(value.entityTypeId);\n\n\t\t\t\t\tif (Type.isStringFilled(value.title) && !Type.isStringFilled(this.getTitle()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTitle(value.title);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(value.fields))\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue.fields.forEach((itemData) => {\n\t\t\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\t\t\tsourceData: this.getFieldByName(itemData.name),\n\t\t\t\t\t\t\t\tdata: itemData,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid value');\n\t\t\t\t}\n\n\t\t\t\tthis.hideLoader();\n\t\t\t});\n\t}\n\n\tsetData(data: {[key: string]: any})\n\t{\n\t\tthis.#cache.set('data', {...data});\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.#cache.get('data', {});\n\t}\n\n\tsetTitle(title: string)\n\t{\n\t\tthis.#cache.set('title', title);\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#cache.get('title', '');\n\t}\n\n\tsetClientEntityTypeId(clientEntityTypeId)\n\t{\n\t\tthis.#cache.set('clientEntityTypeId', clientEntityTypeId);\n\t}\n\n\tgetClientEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('clientEntityTypeId');\n\t}\n\n\tsetEntityTypeId(entityTypeId)\n\t{\n\t\tthis.#cache.set('entityTypeId', entityTypeId);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('entityTypeId');\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.#cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.getLayout(),\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetOptions(options: ListEditorOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tsetFieldsDictionary(fields: Array<any>)\n\t{\n\t\tthis.#cache.set('fieldsDictionary', fields);\n\t}\n\n\tgetFieldsDictionary(): Array<any>\n\t{\n\t\treturn this.#cache.get('fieldsDictionary', []);\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor\">\n\t\t\t\t\t${this.getListContainer()}\n\t\t\t\t\t<div class=\"crm-field-list-editor-footer\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"ui-link ui-link-dashed\"\n\t\t\t\t\t\t\tonclick=\"${this.onAddFieldClick.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_FIELD_LIST_EDITOR_ADD_FIELD_BUTTON_LABEL')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(target: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\tconsole.error('target is not a DOM element');\n\t\t}\n\n\t\tDom.append(this.getLayout(), target);\n\t}\n\n\tloadFieldsDictionary(): Promise<any>\n\t{\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\treturn Backend.getInstance().getFieldsList(fieldsPanelOptions?.presetId || null);\n\t}\n\n\tloadValue(): Promise<any>\n\t{\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.getFieldsSet(this.getOptions().setId)\n\t\t\t.then((result) => {\n\t\t\t\treturn result.options;\n\t\t\t});\n\t}\n\n\tgetItems(): Array<Item>\n\t{\n\t\treturn this.#cache.remember('items', []);\n\t}\n\n\tsetItems(items: Array<Item>)\n\t{\n\t\tthis.#cache.set('items', items);\n\t}\n\n\taddItem(options: ListEditorItemOptions)\n\t{\n\t\tconst items = this.getItems();\n\n\t\tconst hasItem = items.some((item) => {\n\t\t\treturn item.getOptions().data.name === options.data.name;\n\t\t});\n\n\t\tif (!hasItem)\n\t\t{\n\t\t\tconst item = new Item({\n\t\t\t\t...options,\n\t\t\t\tcategoryCaption: this.getCategoryCaption(options.data.name),\n\t\t\t\teditable: this.getOptions().editable,\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: () => {\n\t\t\t\t\t\tthis.onChange();\n\t\t\t\t\t},\n\t\t\t\t\tonRemove: this.onRemoveItemClick.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\titems.push(item);\n\t\t\tDom.append(item.getLayout(), this.getListContainer());\n\t\t}\n\t}\n\n\tonRemoveItemClick(event: BaseEvent)\n\t{\n\t\tconst target: Item = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tthis.setItems(\n\t\t\tthis.getItems().filter((item) => {\n\t\t\t\treturn item !== target;\n\t\t\t}),\n\t\t);\n\n\t\tthis.onChange();\n\t}\n\n\tgetFieldByName(name: string): ?{[key: string]: any}\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\treturn category.FIELDS.find((field) => {\n\t\t\t\t\treturn field.name === name;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, null);\n\t}\n\n\tgetCategoryCaption(fieldName: string): string\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\tconst hasField = category.FIELDS.some((field) => {\n\t\t\t\t\treturn field.name === fieldName;\n\t\t\t\t});\n\n\t\t\t\tif (hasField)\n\t\t\t\t{\n\t\t\t\t\treturn category.CAPTION;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, '');\n\t}\n\n\tshowFieldsPanel(panelOptions): Promise<Array<string>>\n\t{\n\t\tconst fieldsPanel = FieldsPanel.getInstance();\n\t\tDom.append(fieldsPanel.layout, window.top.document.body);\n\t\treturn fieldsPanel.show(panelOptions);\n\t}\n\n\tonAddFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\tthis.showFieldsPanel(fieldsPanelOptions)\n\t\t\t.then((result) => {\n\t\t\t\tthis.setFieldsDictionary(\n\t\t\t\t\tFieldsPanel.getInstance().getCrmFields(),\n\t\t\t\t);\n\n\t\t\t\treturn result;\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tresult.forEach((fieldName) => {\n\t\t\t\t\tconst fieldData = this.getFieldByName(fieldName);\n\t\t\t\t\tif (!Type.isString(fieldData.label) && Type.isString(fieldData.caption))\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldData.label = fieldData.caption;\n\t\t\t\t\t}\n\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\tsourceData: fieldData,\n\t\t\t\t\t\tdata: fieldData,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.onChange();\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonChange()\n\t{\n\t\tthis.emit('onChange');\n\t\tthis.onDebounceChange();\n\t}\n\n\tonDebounceChange()\n\t{\n\t\tif (this.getOptions().autoSave)\n\t\t{\n\t\t\tvoid this.save();\n\t\t}\n\n\t\tthis.emit('onDebounceChange');\n\t}\n\n\tsave(): Promise<any>\n\t{\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.saveFieldsSet({\n\t\t\t\tid: this.getOptions().setId,\n\t\t\t\tpresetId: fieldsPanelOptions?.presetId || null,\n\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\tclientEntityTypeId: this.getClientEntityTypeId(),\n\t\t\t\t...this.getData(),\n\t\t\t\tfields: this.getValue(),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.emit('onSave');\n\t\t\t});\n\t}\n\n\tgetValue(): Array<{[key: string]: any}>\n\t{\n\t\treturn this.getItems().map((item) => {\n\t\t\treturn item.getValue();\n\t\t});\n\t}\n\n\t#adjustSliderDragAndDropOffsets()\n\t{\n\t\tconst sliderLayout = this.getLayout().closest('.ui-sidepanel-layout');\n\t\tif (Type.isDomNode(sliderLayout))\n\t\t{\n\t\t\tconst offsetLeft = -(sliderLayout.getBoundingClientRect().left);\n\n\t\t\tthis.draggable.setOptions({\n\t\t\t\t...this.draggable.getOptions(),\n\t\t\t\toffset: {\n\t\t\t\t\tx: offsetLeft,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tonWindowResize()\n\t{\n\t\tthis.#adjustSliderDragAndDropOffsets();\n\t}\n\n\tshowSlider()\n\t{\n\n\t\tconst buttons = [];\n\t\tif (!this.getOptions().autoSave)\n\t\t{\n\t\t\tbuttons.push(\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting(true);\n\t\t\t\t\t\tthis.save().then(() => {\n\t\t\t\t\t\t\tbutton.setWaiting(false);\n\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tBX.SidePanel.Instance.open('crm:field-list-editor', {\n\t\t\twidth: 600,\n\t\t\tcacheable: this.getOptions().cacheable,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn this.#loadPromise\n\t\t\t\t\t.then(() => Layout.createContent({\n\t\t\t\t\t\textensions: ['crm.field.list-editor'],\n\t\t\t\t\t\ttitle: this.getTitle(),\n\t\t\t\t\t\tcontent: () => this.getLayout(),\n\t\t\t\t\t\tbuttons: ({cancelButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t...buttons,\n\t\t\t\t\t\t\t\tcancelButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t\t.catch(({errors}) => Layout.createContent({\n\t\t\t\t\t\textensions: ['ui.sidepanel-content'],\n\t\t\t\t\t\tdesign: {section: false},\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\tconst title = Loc.getMessage('CRM_FIELD_LIST_EDITOR_ERROR_LOAD');\n\t\t\t\t\t\t\tconst msg = ((errors||[])[0]||{}).message || 'Unknown error';\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-title\">${Text.encode(title)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">${Text.encode(msg)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t;\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonOpenComplete: () => {\n\t\t\t\t\tconst timeoutId = setTimeout(() => {\n\t\t\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\t\t\tthis.#adjustSliderDragAndDropOffsets();\n\t\t\t\t\t}, 500);\n\t\t\t\t\tEvent.bind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tEvent.unbind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tonSortEnd()\n\t{\n\t\tconst listNodes = [...this.getListContainer().children];\n\n\t\tthis.getItems().sort((a, b) => {\n\t\t\tconst aIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn a.getLayout() === node;\n\t\t\t});\n\n\t\t\tconst bIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn b.getLayout() === node;\n\t\t\t});\n\n\t\t\treturn aIndex - bIndex;\n\t\t});\n\n\t\tthis.onChange();\n\t}\n}"],"names":["MemoryCache","Cache","Item","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","setOptions","onFormChange","bind","set","getOptions","get","getCustomTitleLayout","remember","getLayout","querySelector","data","categoryCaption","sourceData","label","caption","preparedCategoryCaption","Type","isStringFilled","Text","encode","Tag","render","name","onEditClick","onRemoveClick","getFormLayout","event","preventDefault","isOpened","open","close","emit","Dom","addClass","hasClass","removeClass","createTextInput","value","createCheckbox","checked","getAllInputs","querySelectorAll","getValue","reduce","acc","input","type","textContent","getFormControls","editableEntries","Object","entries","editable","map","Backend","getInstance","getFieldsList","presetId","Promise","resolve","reject","ajax","runAction","json","then","result","isPlainObject","tree","catch","error","getFieldsSet","id","saveFieldsSet","ListEditor","setTitle","title","onWindowResize","onDebounceChange","Runtime","debounce","debouncingDelay","draggable","Draggable","container","getListContainer","dragElement","offset","x","context","window","top","subscribe","onSortEnd","showLoader","all","loadFieldsDictionary","loadValue","fieldsDictionary","setFieldsDictionary","console","setClientEntityTypeId","clientEntityTypeId","setEntityTypeId","entityTypeId","getTitle","isArrayFilled","fields","forEach","itemData","addItem","getFieldByName","hideLoader","setData","getData","getClientEntityTypeId","getEntityTypeId","getLoader","Loader","target","show","hide","getFieldsDictionary","onAddFieldClick","Loc","getMessage","renderTo","isDomNode","append","fieldsPanelOptions","disabledFields","field","setId","getItems","setItems","items","hasItem","some","item","getCategoryCaption","onChange","onRemove","onRemoveItemClick","push","getTarget","remove","filter","values","category","FIELDS","find","fieldName","hasField","CAPTION","showFieldsPanel","panelOptions","fieldsPanel","FieldsPanel","layout","document","body","getCrmFields","fieldData","isString","autoSave","save","showSlider","buttons","SaveButton","onclick","button","setWaiting","BX","SidePanel","Instance","width","cacheable","contentCallback","Layout","createContent","extensions","content","cancelButton","errors","design","section","msg","message","closeButton","onOpenComplete","timeoutId","setTimeout","clearTimeout","Event","onClose","unbind","listNodes","children","sort","a","b","aIndex","findIndex","node","bIndex","sliderLayout","closest","offsetLeft","getBoundingClientRect","left"],"mappings":"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"}