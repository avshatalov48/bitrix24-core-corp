{"version":3,"file":"list-editor.bundle.js","sources":["../src/item/item.js","../src/backend/backend.js","../src/list-editor.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Text, Dom, Type} from 'main.core';\nimport 'ui.forms';\nimport '\"ui.layout-form';\nimport type {ListEditorItemOptions} from '../types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport class Item extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\n\tconstructor(options: ListEditorItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor.Item');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setOptions(options);\n\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\t}\n\n\tsetOptions(options: ListEditorItemOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetCustomTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('customTitleLayout', () => {\n\t\t\treturn this.getLayout().querySelector('.crm-field-list-editor-item-text-custom-title');\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\tconst {data, categoryCaption} = this.getOptions();\n\t\t\tconst {sourceData} = this.getOptions();\n\t\t\tconst label = data.label || sourceData.caption;\n\n\t\t\tconst preparedCategoryCaption = (() => {\n\t\t\t\tif (Type.isStringFilled(categoryCaption))\n\t\t\t\t{\n\t\t\t\t\treturn `&middot; ${Text.encode(categoryCaption)}`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item\" data-name=\"${Text.encode(sourceData?.name || '')}\">\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-header\">\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-drag-button\"></div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text\">\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-source-title\">\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${Text.encode(sourceData?.caption || '')}</span>\n\t\t\t\t\t\t\t\t<span class=\"crm-field-list-editor-item-text-source-title-inner\">${preparedCategoryCaption}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title\">\n\t\t\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-text-custom-title-inner\">${Text.encode(label)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-field-list-editor-item-actions\">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-edit\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEditClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"crm-field-list-editor-item-button-remove\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onRemoveClick.bind(this)}\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-field-list-editor-item-body\">\n\t\t\t\t\t\t${this.getFormLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonEditClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isOpened())\n\t\t{\n\t\t\tthis.open();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tonRemoveClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tthis.emit('onRemove');\n\t}\n\n\topen()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tisOpened(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tclose()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-item-opened');\n\t}\n\n\tcreateTextInput(options: {name: string, label: string, value: string}): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-text-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tvalue=\"${options.value}\"\n\t\t\t\t\t\t\toninput=\"${this.onFormChange}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\">\t\n\t\t\t\t\t</div>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateCheckbox(options: {name: string, label: string, checked: boolean}): HTMLLabelElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row crm-field-list-editor-item-form-checkbox-row\">\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype=\"checkbox\" \n\t\t\t\t\t\t\tname=\"${options.name}\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tonchange=\"${this.onFormChange}\"\n\t\t\t\t\t\t\t${options.checked ? 'checked': ''}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${options.label}</div>\n\t\t\t\t\t</label>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetAllInputs(): Array<HTMLInputElement>\n\t{\n\t\treturn [...this.getLayout().querySelectorAll('.ui-ctl-element')];\n\t}\n\n\tgetValue(): {[key: string]: any}\n\t{\n\t\treturn this.getAllInputs().reduce((acc, input) => {\n\t\t\tacc[input.name] = input.type === 'checkbox' ? input.checked : input.value;\n\t\t\treturn acc;\n\t\t}, {...this.getOptions().data});\n\t}\n\n\tonFormChange()\n\t{\n\t\tconst value = this.getValue();\n\t\tthis.getCustomTitleLayout().textContent = value.caption || value.label;\n\n\t\tthis.emit('onChange');\n\t}\n\n\tgetFormControls(): Array<HTMLElement>\n\t{\n\t\treturn this.#cache.remember('formControls', () => {\n\t\t\tconst editableEntries = Object.entries(this.getOptions().editable);\n\t\t\tconst {data} = this.getOptions();\n\n\t\t\treturn editableEntries.map(([name, options]) => {\n\t\t\t\tif (options.type === 'string')\n\t\t\t\t{\n\t\t\t\t\treturn this.createTextInput({\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tlabel: options.label,\n\t\t\t\t\t\tvalue: data[name],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this.createCheckbox({\n\t\t\t\t\tname,\n\t\t\t\t\tlabel: options.label,\n\t\t\t\t\tchecked: data[name],\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFormLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('formLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-item-form\">\n\t\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t\t${this.getFormControls()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {Cache, ajax, Type} from 'main.core';\n\nconst {MemoryCache} = Cache;\n\nexport class Backend\n{\n\tstatic #instance = null;\n\t#cache = new MemoryCache();\n\n\tstatic getInstance(): Backend\n\t{\n\t\tif (!Backend.#instance)\n\t\t{\n\t\t\tBackend.#instance = new Backend();\n\t\t}\n\n\t\treturn Backend.#instance;\n\t}\n\n\tgetFieldsList(presetId: number): Promise<any>\n\t{\n\t\treturn this.#cache.remember('fieldsList', () => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tajax\n\t\t\t\t\t.runAction('crm.api.form.field.list', {json: {presetId}})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (Type.isPlainObject(result?.data?.tree))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(result.data.tree);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFieldsSet(id: number): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.get', {json: {id}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result.data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tsaveFieldsSet(options: {[key: string]: any}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction('crm.api.fieldset.set', {json: {options}})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (Type.isPlainObject(result?.data))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Dom, Text, Loc, Tag, Type, Runtime, Event} from 'main.core';\nimport {Notification} from 'ui.notification';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {SaveButton} from 'ui.buttons';\nimport {Loader} from 'main.loader';\nimport {Item} from './item/item';\nimport {Backend} from './backend/backend';\nimport {Selector} from \"crm.form.fields.selector\";\n\nimport type {ListEditorOptions} from './types/list-editor-options';\nimport type {ListEditorItemOptions} from './types/list-editor-item-options';\n\nimport './css/style.css';\n\nconst {MemoryCache} = Cache;\n\nexport {\n\tBackend,\n};\n\n/**\n * @memberOf BX.Crm.Field\n */\nexport class ListEditor extends EventEmitter\n{\n\t#cache = new MemoryCache();\n\t#loadPromise: Promise;\n\n\tstatic #defaultOptions = {\n\t\tsetId: 0,\n\t\tautoSave: true,\n\t\tcacheable: true,\n\t\tfieldsPanelOptions: {},\n\t\tdebouncingDelay: 500,\n\t};\n\n\tconstructor(options: ListEditorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Field.ListEditor');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setTitle(options.title || '');\n\t\tthis.onWindowResize = this.onWindowResize.bind(this);\n\n\t\tthis.setOptions({\n\t\t\t...ListEditor.#defaultOptions,\n\t\t\t...options,\n\t\t});\n\n\t\tthis.onDebounceChange = Runtime.debounce(\n\t\t\tthis.onDebounceChange,\n\t\t\tthis.getOptions().debouncingDelay,\n\t\t\tthis,\n\t\t);\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.crm-field-list-editor-item',\n\t\t\tdragElement: '.crm-field-list-editor-item-drag-button',\n\t\t\toffset: {\n\t\t\t\tx: -800,\n\t\t\t},\n\t\t\tcontext: window.top,\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onSortEnd.bind(this));\n\n\t\tthis.showLoader();\n\n\t\tthis.#loadPromise = Promise\n\t\t\t.all([\n\t\t\t\tthis.loadFieldsDictionary(),\n\t\t\t\tthis.loadValue(),\n\t\t\t])\n\t\t\t.then(([fieldsDictionary, value]) => {\n\t\t\t\tif (Type.isPlainObject(fieldsDictionary))\n\t\t\t\t{\n\t\t\t\t\tthis.setFieldsDictionary(fieldsDictionary);\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid fields dictionary');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isPlainObject(value))\n\t\t\t\t{\n\t\t\t\t\tthis.setClientEntityTypeId(value.clientEntityTypeId);\n\t\t\t\t\tthis.setEntityTypeId(value.entityTypeId);\n\n\t\t\t\t\tif (Type.isStringFilled(value.title) && !Type.isStringFilled(this.getTitle()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTitle(value.title);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(value.fields))\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue.fields.forEach((itemData) => {\n\t\t\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\t\t\tsourceData: this.getFieldByName(itemData.name),\n\t\t\t\t\t\t\t\tdata: itemData,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BX.Crm.Field.ListEditor: Invalid value');\n\t\t\t\t}\n\n\t\t\t\tthis.hideLoader();\n\t\t\t});\n\t}\n\n\tsetData(data: {[key: string]: any})\n\t{\n\t\tthis.#cache.set('data', {...data});\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.#cache.get('data', {});\n\t}\n\n\tsetTitle(title: string)\n\t{\n\t\tthis.#cache.set('title', title);\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#cache.get('title', '');\n\t}\n\n\tsetClientEntityTypeId(clientEntityTypeId)\n\t{\n\t\tthis.#cache.set('clientEntityTypeId', clientEntityTypeId);\n\t}\n\n\tgetClientEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('clientEntityTypeId');\n\t}\n\n\tsetEntityTypeId(entityTypeId)\n\t{\n\t\tthis.#cache.set('entityTypeId', entityTypeId);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#cache.get('entityTypeId');\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.#cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.getLayout(),\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.getLayout(), 'crm-field-list-editor-state-load');\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetOptions(options: ListEditorOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): ListEditorOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tsetFieldsDictionary(fields: Array<any>)\n\t{\n\t\tthis.#cache.set('fieldsDictionary', fields);\n\t}\n\n\tgetFieldsDictionary(): Array<any>\n\t{\n\t\treturn this.#cache.get('fieldsDictionary', []);\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-field-list-editor\">\n\t\t\t\t\t${this.getListContainer()}\n\t\t\t\t\t<div class=\"crm-field-list-editor-footer\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"ui-link ui-link-dashed\"\n\t\t\t\t\t\t\tonclick=\"${this.onAddFieldClick.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_FIELD_LIST_EDITOR_ADD_FIELD_BUTTON_LABEL')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(target: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\tconsole.error('target is not a DOM element');\n\t\t}\n\n\t\tDom.append(this.getLayout(), target);\n\t}\n\n\tloadFieldsDictionary(): Promise<any>\n\t{\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\treturn Backend.getInstance().getFieldsList(fieldsPanelOptions?.presetId || null);\n\t}\n\n\tloadValue(): Promise<any>\n\t{\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.getFieldsSet(this.getOptions().setId)\n\t\t\t.then((result) => {\n\t\t\t\treturn result.options;\n\t\t\t});\n\t}\n\n\tgetItems(): Array<Item>\n\t{\n\t\treturn this.#cache.remember('items', []);\n\t}\n\n\tsetItems(items: Array<Item>)\n\t{\n\t\tthis.#cache.set('items', items);\n\t}\n\n\taddItem(options: ListEditorItemOptions)\n\t{\n\t\tconst items = this.getItems();\n\n\t\tconst hasItem = items.some((item) => {\n\t\t\treturn item.getOptions().data.name === options.data.name;\n\t\t});\n\n\t\tif (!hasItem)\n\t\t{\n\t\t\tconst item = new Item({\n\t\t\t\t...options,\n\t\t\t\tcategoryCaption: this.getCategoryCaption(options.data.name),\n\t\t\t\teditable: this.getOptions().editable,\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: () => {\n\t\t\t\t\t\tthis.onChange();\n\t\t\t\t\t},\n\t\t\t\t\tonRemove: this.onRemoveItemClick.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\titems.push(item);\n\t\t\tDom.append(item.getLayout(), this.getListContainer());\n\t\t}\n\t}\n\n\tonRemoveItemClick(event: BaseEvent)\n\t{\n\t\tconst target: Item = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tthis.setItems(\n\t\t\tthis.getItems().filter((item) => {\n\t\t\t\treturn item !== target;\n\t\t\t}),\n\t\t);\n\n\t\tthis.onChange();\n\t}\n\n\tgetFieldByName(name: string): ?{[key: string]: any}\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\treturn category.FIELDS.find((field) => {\n\t\t\t\t\treturn field.name === name;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, null);\n\t}\n\n\tgetCategoryCaption(fieldName: string): string\n\t{\n\t\tconst fieldsDictionary = this.getFieldsDictionary();\n\n\t\treturn Object.values(fieldsDictionary).reduce((acc, category) => {\n\t\t\tif (!acc)\n\t\t\t{\n\t\t\t\tconst hasField = category.FIELDS.some((field) => {\n\t\t\t\t\treturn field.name === fieldName;\n\t\t\t\t});\n\n\t\t\t\tif (hasField)\n\t\t\t\t{\n\t\t\t\t\treturn category.CAPTION;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, '');\n\t}\n\n\tonAddFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\tconst selector = new Selector(fieldsPanelOptions);\n\t\tselector.show()\n\t\t\t.then((result) => {\n\t\t\t\tthis.setFieldsDictionary(selector.getFieldsList());\n\t\t\t\treturn result;\n\t\t\t})\n\t\t\t.then((result: Array<string>) => {\n\t\t\t\tresult.forEach((fieldName) => {\n\t\t\t\t\tconst fieldData = this.getFieldByName(fieldName);\n\t\t\t\t\tif (!Type.isString(fieldData.label) && Type.isString(fieldData.caption))\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldData.label = fieldData.caption;\n\t\t\t\t\t}\n\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\tsourceData: fieldData,\n\t\t\t\t\t\tdata: fieldData,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.onChange();\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonChange()\n\t{\n\t\tthis.emit('onChange');\n\t\tthis.onDebounceChange();\n\t}\n\n\tonDebounceChange()\n\t{\n\t\tif (this.getOptions().autoSave)\n\t\t{\n\t\t\tvoid this.save();\n\t\t}\n\n\t\tthis.emit('onDebounceChange');\n\t}\n\n\tsave(): Promise<any>\n\t{\n\t\tconst fieldsPanelOptions = {\n\t\t\t...this.getOptions().fieldsPanelOptions,\n\t\t\tdisabledFields: this.getValue().map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t}),\n\t\t};\n\n\t\treturn Backend\n\t\t\t.getInstance()\n\t\t\t.saveFieldsSet({\n\t\t\t\tid: this.getOptions().setId,\n\t\t\t\tpresetId: fieldsPanelOptions?.presetId || null,\n\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\tclientEntityTypeId: this.getClientEntityTypeId(),\n\t\t\t\t...this.getData(),\n\t\t\t\tfields: this.getValue(),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.emit('onSave');\n\t\t\t});\n\t}\n\n\tgetValue(): Array<{[key: string]: any}>\n\t{\n\t\treturn this.getItems().map((item) => {\n\t\t\treturn item.getValue();\n\t\t});\n\t}\n\n\t#adjustSliderDragAndDropOffsets()\n\t{\n\t\tconst sliderLayout = this.getLayout().closest('.ui-sidepanel-layout');\n\t\tif (Type.isDomNode(sliderLayout))\n\t\t{\n\t\t\tconst offsetLeft = -(sliderLayout.getBoundingClientRect().left);\n\n\t\t\tthis.draggable.setOptions({\n\t\t\t\t...this.draggable.getOptions(),\n\t\t\t\toffset: {\n\t\t\t\t\tx: offsetLeft,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tonWindowResize()\n\t{\n\t\tthis.#adjustSliderDragAndDropOffsets();\n\t}\n\n\tshowSlider()\n\t{\n\n\t\tconst buttons = [];\n\t\tif (!this.getOptions().autoSave)\n\t\t{\n\t\t\tbuttons.push(\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting(true);\n\t\t\t\t\t\tthis.save().then(() => {\n\t\t\t\t\t\t\tbutton.setWaiting(false);\n\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t}).catch((data) => {\n\t\t\t\t\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: data.errors.map((item) => Text.encode(item.message)).join('\\n'),\n\t\t\t\t\t\t\t\tautoHide: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbutton.setWaiting(false);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tBX.SidePanel.Instance.open('crm:field-list-editor', {\n\t\t\twidth: 600,\n\t\t\tcacheable: this.getOptions().cacheable,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn this.#loadPromise\n\t\t\t\t\t.then(() => Layout.createContent({\n\t\t\t\t\t\textensions: ['crm.field.list-editor'],\n\t\t\t\t\t\ttitle: this.getTitle(),\n\t\t\t\t\t\tcontent: () => this.getLayout(),\n\t\t\t\t\t\tbuttons: ({cancelButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t...buttons,\n\t\t\t\t\t\t\t\tcancelButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t\t.catch(({errors}) => Layout.createContent({\n\t\t\t\t\t\textensions: ['ui.sidepanel-content'],\n\t\t\t\t\t\tdesign: {section: false},\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\tconst title = Loc.getMessage('CRM_FIELD_LIST_EDITOR_ERROR_IN_LOAD');\n\t\t\t\t\t\t\tconst msg = ((errors||[])[0]||{}).message || 'Unknown error';\n\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-title\">${Text.encode(title)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">${Text.encode(msg)}</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t}))\n\t\t\t\t;\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonOpenComplete: () => {\n\t\t\t\t\tconst timeoutId = setTimeout(() => {\n\t\t\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\t\t\tthis.#adjustSliderDragAndDropOffsets();\n\t\t\t\t\t}, 500);\n\t\t\t\t\tEvent.bind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tEvent.unbind(window, 'resize', this.onWindowResize);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tonSortEnd()\n\t{\n\t\tconst listNodes = [...this.getListContainer().children];\n\n\t\tthis.getItems().sort((a, b) => {\n\t\t\tconst aIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn a.getLayout() === node;\n\t\t\t});\n\n\t\t\tconst bIndex = listNodes.findIndex((node) => {\n\t\t\t\treturn b.getLayout() === node;\n\t\t\t});\n\n\t\t\treturn aIndex - bIndex;\n\t\t});\n\n\t\tthis.onChange();\n\t}\n}"],"names":["MemoryCache","Cache","Item","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","setOptions","onFormChange","bind","set","getOptions","get","getCustomTitleLayout","remember","getLayout","querySelector","data","categoryCaption","sourceData","label","caption","preparedCategoryCaption","Type","isStringFilled","Text","encode","Tag","render","name","onEditClick","onRemoveClick","getFormLayout","event","preventDefault","isOpened","open","close","emit","Dom","addClass","hasClass","removeClass","createTextInput","value","createCheckbox","checked","getAllInputs","querySelectorAll","getValue","reduce","acc","input","type","textContent","getFormControls","editableEntries","Object","entries","editable","map","Backend","getInstance","getFieldsList","presetId","Promise","resolve","reject","ajax","runAction","json","then","result","isPlainObject","tree","catch","error","getFieldsSet","id","saveFieldsSet","ListEditor","setTitle","title","onWindowResize","onDebounceChange","Runtime","debounce","debouncingDelay","draggable","Draggable","container","getListContainer","dragElement","offset","x","context","window","top","subscribe","onSortEnd","showLoader","all","loadFieldsDictionary","loadValue","fieldsDictionary","setFieldsDictionary","console","setClientEntityTypeId","clientEntityTypeId","setEntityTypeId","entityTypeId","getTitle","isArrayFilled","fields","forEach","itemData","addItem","getFieldByName","hideLoader","setData","getData","getClientEntityTypeId","getEntityTypeId","getLoader","Loader","target","show","hide","getFieldsDictionary","onAddFieldClick","Loc","getMessage","renderTo","isDomNode","append","fieldsPanelOptions","disabledFields","field","setId","getItems","setItems","items","hasItem","some","item","getCategoryCaption","onChange","onRemove","onRemoveItemClick","push","getTarget","remove","filter","values","category","FIELDS","find","fieldName","hasField","CAPTION","selector","Selector","fieldData","isString","autoSave","save","showSlider","buttons","SaveButton","onclick","button","setWaiting","BX","SidePanel","Instance","UI","Notification","Center","notify","content","errors","message","join","autoHide","width","cacheable","contentCallback","Layout","createContent","extensions","cancelButton","design","section","msg","closeButton","onOpenComplete","timeoutId","setTimeout","clearTimeout","Event","onClose","unbind","listNodes","children","sort","a","b","aIndex","findIndex","node","bIndex","sliderLayout","closest","offsetLeft","getBoundingClientRect","left"],"mappings":"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"}