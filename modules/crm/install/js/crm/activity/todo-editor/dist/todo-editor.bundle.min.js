this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,a,r,l,n,o,c,d,u,p){"use strict";const h={props:{icon:{type:String,required:true,default:""},action:{type:Function,required:true,default:()=>{}},description:{type:String,required:false,default:""}},data(){return{popup:null}},computed:{iconClassname(){return["crm-activity__todo-editor_action-btn-icon",`--${this.icon}`]}},methods:{onMouseEnter(e){if(!this.description){return}this.popup=new o.Popup({content:this.description,bindElement:e.target,darkMode:true});setTimeout((()=>{if(!this.popup){return}this.popup.show()}),400)},onMouseLeave(){if(!this.popup||!this.description){return}this.popup.close();this.popup=null},onButtonClick(){this.action.call(this)}},template:`\n\t\t<button\n\t\t\t@mouseenter="onMouseEnter"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t\t@click="onButtonClick"\n\t\t\tclass="crm-activity__todo-editor_action-btn"\n\t\t>\n\t\t\t<i :class="iconClassname"></i>\n\t\t</button>\n\t`};const b={computed:{className(){return["crm-activity__todo-editor_action-delimiter"]}},template:`\n\t\t<span :class="className">\n\t\t\t<i class="crm-activity__todo-editor_action-delimiter-icon"></i>\n\t\t</span>\n\t`};const v={props:{valuesList:{type:Array,required:true,default:[]},selectedValues:{type:Array,default:[]}},methods:{getValue(){if(this.itemSelector){return this.itemSelector.getValue()}return[]},setValue(e){if(this.itemSelector){this.itemSelector.setValue(e)}}},mounted(){this.itemSelector=new c.ItemSelector({target:this.$el,valuesList:this.valuesList,selectedValues:this.selectedValues})},template:`<div style="width: 100%;"></div>`};const m={props:{userId:{type:Number,required:true,default:0},userName:{type:String,required:true,default:""},imageUrl:{type:String,required:true,default:""}},data(){return{isTickFlipped:false,userAvatarUrl:this.imageUrl}},computed:{userIconClassName(){return["ui-icon","ui-icon-common-user","crm-timeline__user-icon"]},tickIconClassName(){return["crm-activity__todo-editor_action-user-selector-tick","crm-activity__todo-editor_action-user-selector-tick-icon",{"--flipped":this.isTickFlipped}]},userIconStyles(){if(!this.userAvatarUrl){return{}}return{backgroundImage:"url('"+encodeURI(d.Text.encode(this.userAvatarUrl))+"')",backgroundSize:"21px"}}},methods:{onDialogShow(e){this.isTickFlipped=true},onDialogHide(e){this.isTickFlipped=false},onSelectUser(e){const t=e.getData().item.getDialog().getSelectedItems()[0];if(t){this.userAvatarUrl=t.getAvatar();this.$Bitrix.eventEmitter.emit(g.EVENT_RESPONSIBLE_USER_CHANGE,{responsibleUserId:t.getId()})}},onDeselectUser(){setTimeout((()=>{const e=this.userSelectorDialog.getSelectedItems();if(e.length===0){this.userAvatarUrl=this.imageUrl;this.userSelectorDialog.hide();this.$Bitrix.eventEmitter.emit(g.EVENT_RESPONSIBLE_USER_CHANGE,{responsibleUserId:this.userId})}}),100)},showUserDialog(){if(this.userSelectorDialog){setTimeout((()=>{this.userSelectorDialog.show()}),5)}},resetToDefault(){this.userAvatarUrl=this.imageUrl;if(this.userSelectorDialog){const e=this.userSelectorDialog.getItem({id:this.userId,entityId:"user"});if(e){e.select(true)}}}},mounted(){this.userSelectorDialog=new p.Dialog({id:"responsible-user-selector-dialog",targetNode:this.$refs.userSelector,context:"CRM_ACTIVITY_TODO_RESPONSIBLE_USER",multiple:false,dropdownMode:true,showAvatars:true,enableSearch:true,width:450,zIndex:2500,entities:[{id:"user"}],preselectedItems:[["user",this.userId]],undeselectedItems:[["user",this.userId]],events:{onShow:this.onDialogShow,onHide:this.onDialogHide,"Item:onSelect":this.onSelectUser,"Item:onDeselect":this.onDeselectUser}})},template:`\n\t\t<div \n\t\t\tclass="crm-activity__todo-editor_responsible-user-selector"\n\t\t\tref="userSelector"\n\t\t\t@click="showUserDialog"\n\t\t>\n\t\t\t<span :class="userIconClassName">\n\t\t\t\t<i :style="userIconStyles"></i>\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\t:class="tickIconClassName"\n\t\t\t\tref="tickIcon"\n\t\t\t>\n\t\t\t</span>\n\t\t</div>\n\t`};const f=126;const g={EVENT_RESPONSIBLE_USER_CHANGE:"crm:timeline:todo:responsible-user-changed"};const S={components:{TodoEditorActionBtn:h,TodoEditorActionDelimiter:b,TodoEditorResponsibleUserSelector:m,TodoEditorPingSelector:v},props:{onFocus:Function,onChangeDescription:Function,onSaveHotkeyPressed:Function,deadline:Date,defaultDescription:{type:String,required:false,default:""},additionalButtons:Array,popupMode:Boolean,currentUser:Object,pingSettings:Object,copilotSettings:Object},data(){var e;const t=d.Type.isPlainObject(this.copilotSettings);return{description:this.defaultDescription,currentDeadline:(e=this.deadline)!==null&&e!==void 0?e:new Date,pingOffsets:this.pingSettings.selectedValues,responsibleUserId:this.currentUser.userId,showFileUploader:false,isTextareaToLong:false,wasUsed:false,isCopilotEnabled:t,placeholderText:d.Loc.getMessage(t?"CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_WITH_COPILOT":"CRM_ACTIVITY_TODO_ADD_PLACEHOLDER")}},computed:{deadlineFormatted(){const e=new l.DatetimeConverter(this.currentDeadline);return e.toDatetimeString({withDayOfWeek:true,delimiter:", "})}},watch:{description(){d.Dom.style(this.$refs.textarea,"height","auto");void this.$nextTick((()=>{const e=this.$refs.textarea.scrollHeight;d.Dom.style(this.$refs.textarea,"height",`${e}px`);if(this.popupMode===true){this.isTextareaToLong=e>f}}))}},methods:{clearDescription(){this.description="";d.Dom.style(this.$refs.textarea,"height","auto")},setDescription(e){this.description=e},onTextareaFocus(){this.wasUsed=true;this.onFocus()},onTextareaKeydown(e){if(e.keyCode!==13){return}const t=d.Browser.isMac()&&(e.metaKey===true||e.altKey===true);if(e.ctrlKey===true||t){this.onSaveHotkeyPressed()}},setTextareaFocused(){this.wasUsed=true;this.$refs.textarea.focus()},onDeadlineClick(){BX.calendar({node:this.$refs.deadline,bTime:true,bHideTime:false,bSetFocus:false,value:n.DateTimeFormat.format(l.DatetimeConverter.getSiteDateTimeFormat(),this.currentDeadline),callback:this.setDeadline.bind(this)})},setDeadline(e){this.currentDeadline=e},onResponsibleUserChange(e){const t=e.getData();if(t){this.setResponsibleUserId(t.responsibleUserId)}},setPingOffsets(e){this.pingOffsets=e},setResponsibleUserId(e){this.responsibleUserId=e},resetPingOffsetsToDefault(){var e;this.setPingOffsets(this.pingSettings.selectedValues);(e=this.$refs.pingSelector)===null||e===void 0?void 0:e.setValue(this.pingSettings.selectedValues)},resetResponsibleUserToDefault(){this.setResponsibleUserId(this.currentUser.userId);const e=this.$refs.userSelector;if(e){e.resetToDefault()}},getData(){var e;return{description:this.description,deadline:this.currentDeadline,responsibleUserId:this.responsibleUserId,pingOffsets:(e=this.$refs.pingSelector)===null||e===void 0?void 0:e.getValue()}},onTextareaInput(e){const t=e.target.value;this.setDescription(t);this.onChangeDescription(t)},onCopilotTextareaValueChange(e){const t=this.isCopilotEnabled?this.copilotTextarea.getId():"";const i=e.getData().id;if(this.wasUsed&&t===i){const t=e.getData().value;this.setDescription(t);this.onChangeDescription(t)}}},mounted(){this.$Bitrix.eventEmitter.subscribe(g.EVENT_RESPONSIBLE_USER_CHANGE,this.onResponsibleUserChange);if(this.isCopilotEnabled){this.copilotTextarea=new r.CopilotTextarea({id:d.Text.getRandom(),target:this.$refs.textarea,copilotParams:this.copilotSettings});u.EventEmitter.subscribe(r.Events.EVENT_VALUE_CHANGE,this.onCopilotTextareaValueChange)}},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(g.EVENT_RESPONSIBLE_USER_CHANGE,this.onResponsibleUserChange);if(this.isCopilotEnabled){u.EventEmitter.unsubscribe(r.Events.EVENT_VALUE_CHANGE,this.onCopilotTextareaValueChange)}},template:`\n\t\t<label class="crm-activity__todo-editor_body">\n\t\t\t<textarea\n\t\t\t\trows="2"\n\t\t\t\tref="textarea"\n\t\t\t\t@focus="onTextareaFocus"\n\t\t\t\t@keydown="onTextareaKeydown"\n\t\t\t\tclass="crm-activity__todo-editor_textarea"\n\t\t\t\t:placeholder="placeholderText"\n\t\t\t\t@input="onTextareaInput"\n\t\t\t\t:value="description"\n\t\t\t\t:class="{ '--has-scroll': isTextareaToLong }"\n\t\t\t></textarea>\n\t\t\t<div class="crm-activity__todo-editor_tools" v-if="wasUsed">\n\t\t\t\t<div class="crm-activity__todo-editor_left_tools">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="deadline"\n\t\t\t\t\t\t@click="onDeadlineClick"\n\t\t\t\t\t\tclass="crm-activity__todo-editor_deadline"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-icon"><i></i></span>\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-pill">\n\t\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-text">{{ deadlineFormatted }}</span>\n\t\t\t\t\t\t\t<span class="crm-timeline__date-pill_caret"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-activity__todo-editor_ping_selector_wrapper">\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_ping-selector-icon"><i></i></span>\n\t\t\t\t\t\t<TodoEditorPingSelector\n\t\t\t\t\t\t\tref="pingSelector"\n\t\t\t\t\t\t\t:valuesList="pingSettings.valuesList"\n\t\t\t\t\t\t\t:selectedValues="pingSettings.selectedValues"\n\t\t\t\t\t\t\tclass="crm-activity__todo-editor_ping_selector"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</TodoEditorPingSelector>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-activity__todo-editor_action-btns">\n\t\t\t\t\t<TodoEditorActionBtn\n\t\t\t\t\t\tv-for="btn in additionalButtons"\n\t\t\t\t\t\t:key="btn.id"\n\t\t\t\t\t\t:icon="btn.icon"\n\t\t\t\t\t\t:description="btn.description"\n\t\t\t\t\t\t:action="btn.action"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorActionDelimiter/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId="currentUser.userId"\n\t\t\t\t\t\t:userName="currentUser.title"\n\t\t\t\t\t\t:imageUrl="currentUser.imageUrl"\n\t\t\t\t\t\tref="userSelector"\n\t\t\t\t\t\tclass="crm-activity__todo-editor_action-btn"\n\t\t\t\t\t>\n\t\t\t\t\t</TodoEditorResponsibleUserSelector>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</label>\n\t`};let T=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(T,"DEFAULT","default");babelHelpers.defineProperty(T,"PRIMARY","primary");function F(e,t){P(e,t);t.add(e)}function D(e,t,i){P(e,t);t.set(e,i)}function P(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function w(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}const _={ADD:"add",UPDATE:"update"};var H=new WeakMap;var y=new WeakMap;var E=new WeakMap;var C=new WeakMap;var I=new WeakMap;var k=new WeakMap;var U=new WeakMap;var G=new WeakMap;var A=new WeakMap;var O=new WeakMap;var M=new WeakMap;var B=new WeakMap;var N=new WeakMap;var x=new WeakMap;var W=new WeakMap;var L=new WeakMap;var R=new WeakMap;var V=new WeakMap;var X=new WeakMap;var $=new WeakMap;var j=new WeakMap;var q=new WeakSet;var Y=new WeakSet;var z=new WeakSet;var K=new WeakSet;var J=new WeakSet;var Q=new WeakSet;var Z=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var ie=new WeakSet;var se=new WeakSet;var ae=new WeakSet;var re=new WeakSet;var le=new WeakSet;var ne=new WeakSet;var oe=new WeakSet;var ce=new WeakSet;var de=new WeakSet;var ue=new WeakSet;var pe=new WeakSet;let he=function(){function e(t){babelHelpers.classCallCheck(this,e);F(this,pe);F(this,ue);F(this,de);F(this,ce);F(this,oe);F(this,ne);F(this,le);F(this,re);F(this,ae);F(this,se);F(this,ie);F(this,te);F(this,ee);F(this,Z);F(this,Q);F(this,J);F(this,K);F(this,z);F(this,Y);F(this,q);D(this,H,{writable:true,value:null});D(this,y,{writable:true,value:null});D(this,E,{writable:true,value:null});D(this,C,{writable:true,value:null});D(this,I,{writable:true,value:_.ADD});D(this,k,{writable:true,value:null});D(this,U,{writable:true,value:null});D(this,G,{writable:true,value:null});D(this,A,{writable:true,value:null});D(this,O,{writable:true,value:null});D(this,M,{writable:true,value:null});D(this,B,{writable:true,value:null});D(this,N,{writable:true,value:null});D(this,x,{writable:true,value:""});D(this,W,{writable:true,value:null});D(this,L,{writable:true,value:null});D(this,R,{writable:true,value:null});D(this,V,{writable:true,value:null});D(this,X,{writable:true,value:{}});D(this,$,{writable:true,value:false});D(this,j,{writable:true,value:false});if(!d.Type.isDomNode(t.container)){throw new Error("TodoEditor container must be a DOM Node")}babelHelpers.classPrivateFieldSet(this,H,t.container);babelHelpers.classPrivateFieldSet(this,x,w(this,de,ke).call(this,t.borderColor)?t.borderColor:e.BorderColor.DEFAULT);d.Dom.addClass(babelHelpers.classPrivateFieldGet(this,H),w(this,ue,Ue).call(this));if(!d.Type.isNumber(t.ownerTypeId)){throw new TypeError("OwnerTypeId must be set")}babelHelpers.classPrivateFieldSet(this,k,t.ownerTypeId);if(!d.Type.isNumber(t.ownerId)){throw new TypeError("OwnerId must be set")}babelHelpers.classPrivateFieldSet(this,U,t.ownerId);if(!d.Type.isObjectLike(t.currentUser)){throw new TypeError("Current user must be set")}babelHelpers.classPrivateFieldSet(this,G,t.currentUser);if(!d.Type.isObjectLike(t.pingSettings)||Object.keys(t.pingSettings).length===0){throw new Error("Ping settings must be set")}babelHelpers.classPrivateFieldSet(this,A,t.pingSettings||{});babelHelpers.classPrivateFieldSet(this,O,t.copilotSettings||null);babelHelpers.classPrivateFieldSet(this,M,d.Type.isString(t.defaultDescription)?t.defaultDescription:w(this,le,ye).call(this));babelHelpers.classPrivateFieldSet(this,B,d.Type.isDate(t.deadline)?t.deadline:null);if(!babelHelpers.classPrivateFieldGet(this,B)){this.setDefaultDeadLine(false)}w(this,q,be).call(this,t);babelHelpers.classPrivateFieldSet(this,$,d.Type.isBoolean(t.enableCalendarSync)?t.enableCalendarSync:false);babelHelpers.classPrivateFieldSet(this,j,d.Type.isBoolean(t.popupMode)?t.popupMode:false)}babelHelpers.createClass(e,[{key:"setMode",value:function e(t){if(!Object.values(_).some((e=>e===t))){throw new Error(`Unknown TodoEditor mode ${t}`)}babelHelpers.classPrivateFieldSet(this,I,t);return this}},{key:"show",value:function e(){babelHelpers.classPrivateFieldSet(this,y,a.BitrixVue.createApp(S,{deadline:babelHelpers.classPrivateFieldGet(this,B),defaultDescription:babelHelpers.classPrivateFieldGet(this,M),onFocus:w(this,ne,Ee).bind(this),onChangeDescription:w(this,oe,Ce).bind(this),onSaveHotkeyPressed:w(this,ce,Ie).bind(this),additionalButtons:w(this,Y,ve).call(this),popupMode:babelHelpers.classPrivateFieldGet(this,j),currentUser:babelHelpers.classPrivateFieldGet(this,G),pingSettings:babelHelpers.classPrivateFieldGet(this,A),copilotSettings:babelHelpers.classPrivateFieldGet(this,O)}));babelHelpers.classPrivateFieldSet(this,E,babelHelpers.classPrivateFieldGet(this,y).mount(babelHelpers.classPrivateFieldGet(this,H)))}},{key:"onSettingsChange",value:function e(t){this.setSettings(t);if(t!==null&&t!==void 0&&t.calendar){this.setDeadlineFromTimestamp(t["calendar"].from)}}},{key:"setSettings",value:function e(t={}){babelHelpers.classPrivateFieldSet(this,X,t)}},{key:"save",value:function e(){if(babelHelpers.classPrivateFieldGet(this,C)){return babelHelpers.classPrivateFieldGet(this,C)}babelHelpers.classPrivateFieldSet(this,C,new Promise(((e,t)=>{w(this,Q,Se).call(this).then((i=>{d.ajax.runAction(w(this,Z,Te).call(this),{data:i}).then(e).catch(t)})).catch(t)})).catch((e=>{s.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3});throw e})).finally((()=>{babelHelpers.classPrivateFieldSet(this,C,null)})));return babelHelpers.classPrivateFieldGet(this,C)}},{key:"getDeadline",value:function e(){var t,i;return(t=(i=babelHelpers.classPrivateFieldGet(this,E))===null||i===void 0?void 0:i.getData()["deadline"])!==null&&t!==void 0?t:null}},{key:"getDescription",value:function e(){var t,i;return(t=(i=babelHelpers.classPrivateFieldGet(this,E))===null||i===void 0?void 0:i.getData()["description"])!==null&&t!==void 0?t:""}},{key:"setParentActivityId",value:function e(t){babelHelpers.classPrivateFieldSet(this,N,t);return this}},{key:"setActivityId",value:function e(t){babelHelpers.classPrivateFieldSet(this,W,t);return this}},{key:"setDeadline",value:function e(t){const i=n.DateTimeFormat.parse(t);if(d.Type.isDate(i)){babelHelpers.classPrivateFieldGet(this,E).setDeadline(i);babelHelpers.classPrivateFieldSet(this,B,i)}return this}},{key:"setDeadlineFromTimestamp",value:function e(t){const i=new Date(t*1e3);babelHelpers.classPrivateFieldGet(this,E).setDeadline(i);babelHelpers.classPrivateFieldSet(this,B,i);return this}},{key:"setDefaultDeadLine",value:function e(t=true){let i=BX.parseDate(d.Loc.getMessage("CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME"));if(d.Type.isDate(i)){babelHelpers.classPrivateFieldSet(this,B,i)}else{babelHelpers.classPrivateFieldSet(this,B,new Date);babelHelpers.classPrivateFieldGet(this,B).setMinutes(0);babelHelpers.classPrivateFieldGet(this,B).setTime(babelHelpers.classPrivateFieldGet(this,B).getTime()+60*60*1e3)}if(t){babelHelpers.classPrivateFieldGet(this,E).setDeadline(babelHelpers.classPrivateFieldGet(this,B))}return this}},{key:"setFocused",value:function e(){babelHelpers.classPrivateFieldGet(this,E).setTextareaFocused()}},{key:"setDescription",value:function e(t){babelHelpers.classPrivateFieldGet(this,E).setDescription(t);return this}},{key:"clearValue",value:function e(){babelHelpers.classPrivateFieldGet(this,E).clearDescription();babelHelpers.classPrivateFieldSet(this,N,null);return w(this,re,He).call(this)}},{key:"resetToDefaults",value:function e(){babelHelpers.classPrivateFieldGet(this,E).setDescription(w(this,le,ye).call(this));return w(this,re,He).call(this)}},{key:"setStorageElementIds",value:function e(t){this.initFileUploader(t)}},{key:"initFileUploader",value:function e(i=[]){if(!babelHelpers.classPrivateFieldGet(this,R)){babelHelpers.classPrivateFieldSet(this,R,new t.FileUploader({baseContainer:babelHelpers.classPrivateFieldGet(this,H),events:{"File:onRemove":e=>{babelHelpers.classPrivateFieldGet(this,L).emit("onChangeUploaderContainerSize")},onUploadStart:e=>{babelHelpers.classPrivateFieldGet(this,L).emit("onChangeUploaderContainerSize")}},ownerId:babelHelpers.classPrivateFieldGet(this,U),ownerTypeId:babelHelpers.classPrivateFieldGet(this,k),activityId:babelHelpers.classPrivateFieldGet(this,W),files:i}))}const s=babelHelpers.classPrivateFieldGet(this,R).getContainer();const a="--is-displayed";if(i&&!d.Dom.hasClass(s,a)){d.Dom.addClass(s,a)}else{d.Dom.toggleClass(s,a)}babelHelpers.classPrivateFieldGet(this,L).emit("onChangeUploaderContainerSize")}}]);return e}();function be(e){babelHelpers.classPrivateFieldSet(this,L,new u.EventEmitter);babelHelpers.classPrivateFieldGet(this,L).setEventNamespace("Crm.Activity.TodoEditor");if(d.Type.isObject(e.events)){for(const t in e.events){if(d.Type.isFunction(e.events[t])){babelHelpers.classPrivateFieldGet(this,L).subscribe(t,e.events[t])}}}}function ve(){const e=[];if(babelHelpers.classPrivateFieldGet(this,$)){e.push(w(this,z,me).call(this))}e.push(w(this,J,ge).call(this));return e}function me(){return{id:"settings",icon:"settings",description:d.Loc.getMessage("CRM_ACTIVITY_TODO_SETTINGS_BUTTON_HINT"),action:w(this,K,fe).bind(this)}}function fe(){if(!babelHelpers.classPrivateFieldGet(this,V)){babelHelpers.classPrivateFieldSet(this,V,new i.SettingsPopup({onSettingsChange:this.onSettingsChange.bind(this),sections:w(this,se,we).call(this),settings:babelHelpers.classPrivateFieldGet(this,X)}))}if(babelHelpers.classPrivateFieldGet(this,E)){babelHelpers.classPrivateFieldGet(this,V).syncSettings(babelHelpers.classPrivateFieldGet(this,E).getData())}babelHelpers.classPrivateFieldGet(this,V).show()}function ge(){return{id:"file-uploader",icon:"attach",description:d.Loc.getMessage("CRM_ACTIVITY_TODO_UPLOAD_FILE_BUTTON_HINT"),action:w(this,pe,Ge).bind(this)}}function Se(){return new Promise((e=>{w(this,ee,Fe).call(this).then((t=>{const i=babelHelpers.classPrivateFieldGet(this,E).getData();const s={ownerTypeId:babelHelpers.classPrivateFieldGet(this,k),ownerId:babelHelpers.classPrivateFieldGet(this,U),description:i.description,responsibleId:i.responsibleUserId,deadline:n.DateTimeFormat.format(l.DatetimeConverter.getSiteDateTimeFormat(),i.deadline),parentActivityId:babelHelpers.classPrivateFieldGet(this,N),fileTokens:babelHelpers.classPrivateFieldGet(this,R)?babelHelpers.classPrivateFieldGet(this,R).getServerFileIds():[],settings:t,pingOffsets:i.pingOffsets};if(babelHelpers.classPrivateFieldGet(this,I)===_.UPDATE){s.id=babelHelpers.classPrivateFieldGet(this,W)}e(s)}))}))}function Te(){return babelHelpers.classPrivateFieldGet(this,I)===_.ADD?"crm.activity.todo.add":"crm.activity.todo.update"}function Fe(){if(babelHelpers.classPrivateFieldGet(this,V)){return w(this,te,De).call(this)}return w(this,ie,Pe).call(this)}function De(){if(babelHelpers.classPrivateFieldGet(this,E)){babelHelpers.classPrivateFieldGet(this,V).syncSettings(babelHelpers.classPrivateFieldGet(this,E).getData())}return new Promise((e=>{setTimeout((()=>{e(babelHelpers.classPrivateFieldGet(this,V).getSettings())}),0)}))}function Pe(){const e=[];w(this,se,we).call(this).forEach((t=>{if(!t.active){return}const i=t.params;i.id=t.id;e.push(i)}));return Promise.resolve(e)}function we(){const e={id:i.Calendar.methods.getId(),component:i.Calendar};if(babelHelpers.classPrivateFieldGet(this,V)){const t=babelHelpers.classPrivateFieldGet(this,V).getSettings();if(t.calendar){const i=t.calendar;e.params={from:i.from,to:i.to,duration:i.duration};e.active=true}}if(!e.params){e.params=w(this,ae,_e).call(this);e.active=false}return[e]}function _e(){const e=this.getDeadline()||babelHelpers.classPrivateFieldGet(this,B);const t=e.getTime()/1e3;const i=3600;const s=t+i;return{from:t,duration:i,to:s}}function He(){this.setDefaultDeadLine();babelHelpers.classPrivateFieldGet(this,E).resetPingOffsetsToDefault();babelHelpers.classPrivateFieldGet(this,E).resetResponsibleUserToDefault();d.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,H),"--is-edit");if(babelHelpers.classPrivateFieldGet(this,R)){d.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,R).getContainer(),"--is-displayed")}babelHelpers.classPrivateFieldSet(this,R,null);babelHelpers.classPrivateFieldSet(this,V,null);return new Promise((e=>{setTimeout(e,10)}))}function ye(){let e="CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT";switch(babelHelpers.classPrivateFieldGet(this,k)){case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL"}return d.Loc.getMessage(e)}function Ee(){d.Dom.addClass(babelHelpers.classPrivateFieldGet(this,H),"--is-edit");babelHelpers.classPrivateFieldGet(this,L).emit("onFocus")}function Ce(e){const t=new u.BaseEvent({data:{description:e}});babelHelpers.classPrivateFieldGet(this,L).emit("onChangeDescription",t)}function Ie(){babelHelpers.classPrivateFieldGet(this,L).emit("onSaveHotkeyPressed")}function ke(e){return d.Type.isString(e)&&he.BorderColor[e.toUpperCase()]}function Ue(){return`crm-activity__todo-editor --border-${babelHelpers.classPrivateFieldGet(this,x)}`}function Ge(){this.initFileUploader()}babelHelpers.defineProperty(he,"BorderColor",T);const Ae=d.Reflection.namespace("BX.Crm.Activity");Ae.TodoEditor=he;e.TodoEditorMode=_;e.TodoEditor=he})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX.Crm.Activity,BX,BX.Vue3,BX.Crm.AI,BX.Crm.Timeline,BX.Main,BX.Main,BX.Crm.Field,BX,BX.Event,BX.UI.EntitySelector);
//# sourceMappingURL=todo-editor.bundle.map.js