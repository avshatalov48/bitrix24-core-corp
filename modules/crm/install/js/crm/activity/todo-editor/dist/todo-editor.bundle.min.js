this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,a,r,l,n,o,c,d,u){"use strict";const h={props:{icon:{type:String,required:true,default:""},action:{type:Function,required:true,default:()=>{}},description:{type:String,required:false,default:""}},data(){return{popup:null}},computed:{iconClassname(){return["crm-activity__todo-editor_action-btn-icon",`--${this.icon}`]}},methods:{onMouseEnter(e){if(!this.description){return}this.popup=new n.Popup({content:this.description,bindElement:e.target,darkMode:true});setTimeout((()=>{if(!this.popup){return}this.popup.show()}),400)},onMouseLeave(){if(!this.popup||!this.description){return}this.popup.close();this.popup=null},onButtonClick(){this.action.call(this)}},template:`\n\t\t<button\n\t\t\t@mouseenter="onMouseEnter"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t\t@click="onButtonClick"\n\t\t\tclass="crm-activity__todo-editor_action-btn"\n\t\t>\n\t\t\t<i :class="iconClassname"></i>\n\t\t</button>\n\t`};const p={computed:{className(){return["crm-activity__todo-editor_action-delimiter"]}},template:`\n\t\t<span :class="className">\n\t\t\t<i class="crm-activity__todo-editor_action-delimiter-icon"></i>\n\t\t</span>\n\t`};const b={props:{valuesList:{type:Array,required:true,default:[]},selectedValues:{type:Array,default:[]}},methods:{getValue(){if(this.itemSelector){return this.itemSelector.getValue()}return[]},setValue(e){if(this.itemSelector){this.itemSelector.setValue(e)}}},mounted(){this.itemSelector=new o.ItemSelector({target:this.$el,valuesList:this.valuesList,selectedValues:this.selectedValues})},template:`<div style="width: 100%;"></div>`};const v={props:{userId:{type:Number,required:true,default:0},userName:{type:String,required:true,default:""},imageUrl:{type:String,required:true,default:""}},data(){return{isTickFlipped:false,userAvatarUrl:this.imageUrl}},computed:{userIconClassName(){return["ui-icon","ui-icon-common-user","crm-timeline__user-icon"]},tickIconClassName(){return["crm-activity__todo-editor_action-user-selector-tick","crm-activity__todo-editor_action-user-selector-tick-icon",{"--flipped":this.isTickFlipped}]},userIconStyles(){if(!this.userAvatarUrl){return{}}return{backgroundImage:"url('"+encodeURI(c.Text.encode(this.userAvatarUrl))+"')",backgroundSize:"21px"}}},methods:{onDialogShow(e){this.isTickFlipped=true},onDialogHide(e){this.isTickFlipped=false},onSelectUser(e){const t=e.getData().item.getDialog().getSelectedItems()[0];if(t){this.userAvatarUrl=t.getAvatar();this.$Bitrix.eventEmitter.emit(f.EVENT_RESPONSIBLE_USER_CHANGE,{responsibleUserId:t.getId()})}},onDeselectUser(){setTimeout((()=>{const e=this.userSelectorDialog.getSelectedItems();if(e.length===0){this.userAvatarUrl=this.imageUrl;this.userSelectorDialog.hide();this.$Bitrix.eventEmitter.emit(f.EVENT_RESPONSIBLE_USER_CHANGE,{responsibleUserId:this.userId})}}),100)},showUserDialog(){if(this.userSelectorDialog){setTimeout((()=>{this.userSelectorDialog.show()}),5)}},resetToDefault(){this.userAvatarUrl=this.imageUrl;if(this.userSelectorDialog){const e=this.userSelectorDialog.getItem({id:this.userId,entityId:"user"});if(e){e.select(true)}}}},mounted(){this.userSelectorDialog=new u.Dialog({id:"responsible-user-selector-dialog",targetNode:this.$refs.userSelector,context:"CRM_ACTIVITY_TODO_RESPONSIBLE_USER",multiple:false,dropdownMode:true,showAvatars:true,enableSearch:true,width:450,zIndex:2500,entities:[{id:"user"}],preselectedItems:[["user",this.userId]],undeselectedItems:[["user",this.userId]],events:{onShow:this.onDialogShow,onHide:this.onDialogHide,"Item:onSelect":this.onSelectUser,"Item:onDeselect":this.onDeselectUser}})},template:`\n\t\t<div \n\t\t\tclass="crm-activity__todo-editor_responsible-user-selector"\n\t\t\tref="userSelector"\n\t\t\t@click="showUserDialog"\n\t\t>\n\t\t\t<span :class="userIconClassName">\n\t\t\t\t<i :style="userIconStyles"></i>\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\t:class="tickIconClassName"\n\t\t\t\tref="tickIcon"\n\t\t\t>\n\t\t\t</span>\n\t\t</div>\n\t`};const m=126;const f={EVENT_RESPONSIBLE_USER_CHANGE:"crm:timeline:todo:responsible-user-changed"};const g={components:{TodoEditorActionBtn:h,TodoEditorActionDelimiter:p,TodoEditorResponsibleUserSelector:v,TodoEditorPingSelector:b},props:{onFocus:Function,onChangeDescription:Function,onSaveHotkeyPressed:Function,deadline:Date,defaultDescription:{type:String,required:false,default:""},additionalButtons:Array,popupMode:Boolean,currentUser:Object,pingSettings:Object},data(){var e;return{description:this.defaultDescription,currentDeadline:(e=this.deadline)!==null&&e!==void 0?e:new Date,pingOffsets:this.pingSettings.selectedValues,responsibleUserId:this.currentUser.userId,showFileUploader:false,isTextareaToLong:false,wasUsed:false}},computed:{deadlineFormatted(){const e=new r.DatetimeConverter(this.currentDeadline);return e.toDatetimeString({withDayOfWeek:true,delimiter:", "})}},watch:{description(){c.Dom.style(this.$refs.textarea,"height","auto");void this.$nextTick((()=>{const e=this.$refs.textarea.scrollHeight;c.Dom.style(this.$refs.textarea,"height",`${e}px`);if(this.popupMode===true){this.isTextareaToLong=e>m}}))}},methods:{clearDescription(){this.description="";c.Dom.style(this.$refs.textarea,"height","auto")},setDescription(e){this.description=e},onTextareaFocus(){this.wasUsed=true;this.onFocus()},onTextareaKeydown(e){if(e.keyCode!==13){return}const t=c.Browser.isMac()&&(e.metaKey===true||e.altKey===true);if(e.ctrlKey===true||t){this.onSaveHotkeyPressed()}},setTextareaFocused(){this.wasUsed=true;this.$refs.textarea.focus()},onDeadlineClick(){BX.calendar({node:this.$refs.deadline,bTime:true,bHideTime:false,bSetFocus:false,value:l.DateTimeFormat.format(r.DatetimeConverter.getSiteDateTimeFormat(),this.currentDeadline),callback:this.setDeadline.bind(this)})},setDeadline(e){this.currentDeadline=e},onResponsibleUserChange(e){const t=e.getData();if(t){this.setResponsibleUserId(t.responsibleUserId)}},setPingOffsets(e){this.pingOffsets=e},setResponsibleUserId(e){this.responsibleUserId=e},resetPingOffsetsToDefault(){var e;this.setPingOffsets(this.pingSettings.selectedValues);(e=this.$refs.pingSelector)===null||e===void 0?void 0:e.setValue(this.pingSettings.selectedValues)},resetResponsibleUserToDefault(){this.setResponsibleUserId(this.currentUser.userId);const e=this.$refs.userSelector;if(e){e.resetToDefault()}},getData(){var e;return{description:this.description,deadline:this.currentDeadline,responsibleUserId:this.responsibleUserId,pingOffsets:(e=this.$refs.pingSelector)===null||e===void 0?void 0:e.getValue()}},onTextareaInput(e){this.setDescription(e.target.value);this.onChangeDescription(e.target.value)}},mounted(){this.$Bitrix.eventEmitter.subscribe(f.EVENT_RESPONSIBLE_USER_CHANGE,this.onResponsibleUserChange)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(f.EVENT_RESPONSIBLE_USER_CHANGE,this.onResponsibleUserChange)},template:`\n\t\t<label class="crm-activity__todo-editor_body">\n\t\t\t<textarea\n\t\t\t\trows="1"\n\t\t\t\tref="textarea"\n\t\t\t\t@focus="onTextareaFocus"\n\t\t\t\t@keydown="onTextareaKeydown"\n\t\t\t\tclass="crm-activity__todo-editor_textarea"\n\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_PLACEHOLDER')"\n\t\t\t\t@input="onTextareaInput"\n\t\t\t\t:value="description"\n\t\t\t\t:class="{ '--has-scroll': isTextareaToLong }"\n\t\t\t></textarea>\n\t\t\t<div class="crm-activity__todo-editor_tools" v-if="wasUsed">\n\t\t\t\t<div class="crm-activity__todo-editor_left_tools">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="deadline"\n\t\t\t\t\t\t@click="onDeadlineClick"\n\t\t\t\t\t\tclass="crm-activity__todo-editor_deadline"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-icon"><i></i></span>\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-pill">\n\t\t\t\t\t\t\t<span class="crm-activity__todo-editor_deadline-text">{{ deadlineFormatted }}</span>\n\t\t\t\t\t\t\t<span class="crm-timeline__date-pill_caret"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-activity__todo-editor_ping_selector_wrapper">\n\t\t\t\t\t\t<span class="crm-activity__todo-editor_ping-selector-icon"><i></i></span>\n\t\t\t\t\t\t<TodoEditorPingSelector\n\t\t\t\t\t\t\tref="pingSelector"\n\t\t\t\t\t\t\t:valuesList="pingSettings.valuesList"\n\t\t\t\t\t\t\t:selectedValues="pingSettings.selectedValues"\n\t\t\t\t\t\t\tclass="crm-activity__todo-editor_ping_selector"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</TodoEditorPingSelector>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-activity__todo-editor_action-btns">\n\t\t\t\t\t<TodoEditorActionBtn\n\t\t\t\t\t\tv-for="btn in additionalButtons"\n\t\t\t\t\t\t:key="btn.id"\n\t\t\t\t\t\t:icon="btn.icon"\n\t\t\t\t\t\t:description="btn.description"\n\t\t\t\t\t\t:action="btn.action"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorActionDelimiter/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId="currentUser.userId"\n\t\t\t\t\t\t:userName="currentUser.title"\n\t\t\t\t\t\t:imageUrl="currentUser.imageUrl"\n\t\t\t\t\t\tref="userSelector"\n\t\t\t\t\t\tclass="crm-activity__todo-editor_action-btn"\n\t\t\t\t\t>\n\t\t\t\t\t</TodoEditorResponsibleUserSelector>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</label>\n\t`};let S=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(S,"DEFAULT","default");babelHelpers.defineProperty(S,"PRIMARY","primary");function F(e,t){D(e,t);t.add(e)}function T(e,t,i){D(e,t);t.set(e,i)}function D(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function P(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}const w={ADD:"add",UPDATE:"update"};var y=new WeakMap;var H=new WeakMap;var _=new WeakMap;var I=new WeakMap;var k=new WeakMap;var E=new WeakMap;var C=new WeakMap;var U=new WeakMap;var G=new WeakMap;var A=new WeakMap;var M=new WeakMap;var B=new WeakMap;var O=new WeakMap;var N=new WeakMap;var W=new WeakMap;var L=new WeakMap;var R=new WeakMap;var x=new WeakMap;var V=new WeakMap;var X=new WeakMap;var $=new WeakSet;var j=new WeakSet;var q=new WeakSet;var Y=new WeakSet;var z=new WeakSet;var K=new WeakSet;var J=new WeakSet;var Q=new WeakSet;var Z=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var ie=new WeakSet;var se=new WeakSet;var ae=new WeakSet;var re=new WeakSet;var le=new WeakSet;var ne=new WeakSet;var oe=new WeakSet;var ce=new WeakSet;var de=new WeakSet;let ue=function(){function e(t){babelHelpers.classCallCheck(this,e);F(this,de);F(this,ce);F(this,oe);F(this,ne);F(this,le);F(this,re);F(this,ae);F(this,se);F(this,ie);F(this,te);F(this,ee);F(this,Z);F(this,Q);F(this,J);F(this,K);F(this,z);F(this,Y);F(this,q);F(this,j);F(this,$);T(this,y,{writable:true,value:null});T(this,H,{writable:true,value:null});T(this,_,{writable:true,value:null});T(this,I,{writable:true,value:null});T(this,k,{writable:true,value:w.ADD});T(this,E,{writable:true,value:null});T(this,C,{writable:true,value:null});T(this,U,{writable:true,value:null});T(this,G,{writable:true,value:null});T(this,A,{writable:true,value:null});T(this,M,{writable:true,value:null});T(this,B,{writable:true,value:null});T(this,O,{writable:true,value:""});T(this,N,{writable:true,value:null});T(this,W,{writable:true,value:null});T(this,L,{writable:true,value:null});T(this,R,{writable:true,value:null});T(this,x,{writable:true,value:{}});T(this,V,{writable:true,value:false});T(this,X,{writable:true,value:false});if(!c.Type.isDomNode(t.container)){throw new Error("TodoEditor container must be a DOM Node")}babelHelpers.classPrivateFieldSet(this,y,t.container);babelHelpers.classPrivateFieldSet(this,O,P(this,oe,Ie).call(this,t.borderColor)?t.borderColor:e.BorderColor.DEFAULT);c.Dom.addClass(babelHelpers.classPrivateFieldGet(this,y),P(this,ce,ke).call(this));if(!c.Type.isNumber(t.ownerTypeId)){throw new Error("OwnerTypeId must be set")}babelHelpers.classPrivateFieldSet(this,E,t.ownerTypeId);if(!c.Type.isNumber(t.ownerId)){throw new Error("OwnerId must be set")}babelHelpers.classPrivateFieldSet(this,C,t.ownerId);if(!c.Type.isObjectLike(t.currentUser)){throw new Error("Current user must be set")}babelHelpers.classPrivateFieldSet(this,U,t.currentUser);if(!c.Type.isObjectLike(t.pingSettings)||Object.keys(t.pingSettings).length===0){throw new Error("Ping settings must be set")}babelHelpers.classPrivateFieldSet(this,G,t.pingSettings||{});babelHelpers.classPrivateFieldSet(this,A,c.Type.isString(t.defaultDescription)?t.defaultDescription:P(this,ae,we).call(this));babelHelpers.classPrivateFieldSet(this,M,c.Type.isDate(t.deadline)?t.deadline:null);if(!babelHelpers.classPrivateFieldGet(this,M)){this.setDefaultDeadLine(false)}babelHelpers.classPrivateFieldSet(this,W,new d.EventEmitter);babelHelpers.classPrivateFieldGet(this,W).setEventNamespace("Crm.Activity.TodoEditor");if(c.Type.isObject(t.events)){for(const e in t.events){if(c.Type.isFunction(t.events[e])){babelHelpers.classPrivateFieldGet(this,W).subscribe(e,t.events[e])}}}babelHelpers.classPrivateFieldSet(this,V,c.Type.isBoolean(t.enableCalendarSync)?t.enableCalendarSync:false);babelHelpers.classPrivateFieldSet(this,X,c.Type.isBoolean(t.popupMode)?t.popupMode:false)}babelHelpers.createClass(e,[{key:"setMode",value:function e(t){if(!Object.values(w).some((e=>e===t))){throw new Error(`Unknown TodoEditor mode ${t}`)}babelHelpers.classPrivateFieldSet(this,k,t);return this}},{key:"show",value:function e(){babelHelpers.classPrivateFieldSet(this,H,a.BitrixVue.createApp(g,{deadline:babelHelpers.classPrivateFieldGet(this,M),defaultDescription:babelHelpers.classPrivateFieldGet(this,A),onFocus:P(this,re,ye).bind(this),onChangeDescription:P(this,le,He).bind(this),onSaveHotkeyPressed:P(this,ne,_e).bind(this),additionalButtons:P(this,$,he).call(this),popupMode:babelHelpers.classPrivateFieldGet(this,X),currentUser:babelHelpers.classPrivateFieldGet(this,U),pingSettings:babelHelpers.classPrivateFieldGet(this,G)}));babelHelpers.classPrivateFieldSet(this,_,babelHelpers.classPrivateFieldGet(this,H).mount(babelHelpers.classPrivateFieldGet(this,y)))}},{key:"onSettingsChange",value:function e(t){this.setSettings(t);if(t!==null&&t!==void 0&&t.calendar){this.setDeadlineFromTimestamp(t["calendar"].from)}}},{key:"setSettings",value:function e(t={}){babelHelpers.classPrivateFieldSet(this,x,t)}},{key:"save",value:function e(){if(babelHelpers.classPrivateFieldGet(this,I)){return babelHelpers.classPrivateFieldGet(this,I)}babelHelpers.classPrivateFieldSet(this,I,new Promise(((e,t)=>{P(this,K,me).call(this).then((i=>{c.ajax.runAction(P(this,J,fe).call(this),{data:i}).then(e).catch(t)}))})).catch((e=>{s.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3});throw e})).finally((()=>{babelHelpers.classPrivateFieldSet(this,I,null)})));return babelHelpers.classPrivateFieldGet(this,I)}},{key:"getDeadline",value:function e(){var t,i;return(t=(i=babelHelpers.classPrivateFieldGet(this,_))===null||i===void 0?void 0:i.getData()["deadline"])!==null&&t!==void 0?t:null}},{key:"getDescription",value:function e(){var t,i;return(t=(i=babelHelpers.classPrivateFieldGet(this,_))===null||i===void 0?void 0:i.getData()["description"])!==null&&t!==void 0?t:""}},{key:"setParentActivityId",value:function e(t){babelHelpers.classPrivateFieldSet(this,B,t);return this}},{key:"setActivityId",value:function e(t){babelHelpers.classPrivateFieldSet(this,N,t);return this}},{key:"setDeadline",value:function e(t){const i=l.DateTimeFormat.parse(t);if(c.Type.isDate(i)){babelHelpers.classPrivateFieldGet(this,_).setDeadline(i);babelHelpers.classPrivateFieldSet(this,M,i)}return this}},{key:"setDeadlineFromTimestamp",value:function e(t){const i=new Date(t*1e3);babelHelpers.classPrivateFieldGet(this,_).setDeadline(i);babelHelpers.classPrivateFieldSet(this,M,i);return this}},{key:"setDefaultDeadLine",value:function e(t=true){let i=BX.parseDate(c.Loc.getMessage("CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME"));if(c.Type.isDate(i)){babelHelpers.classPrivateFieldSet(this,M,i)}else{babelHelpers.classPrivateFieldSet(this,M,new Date);babelHelpers.classPrivateFieldGet(this,M).setMinutes(0);babelHelpers.classPrivateFieldGet(this,M).setTime(babelHelpers.classPrivateFieldGet(this,M).getTime()+60*60*1e3)}if(t){babelHelpers.classPrivateFieldGet(this,_).setDeadline(babelHelpers.classPrivateFieldGet(this,M))}return this}},{key:"setFocused",value:function e(){babelHelpers.classPrivateFieldGet(this,_).setTextareaFocused()}},{key:"setDescription",value:function e(t){babelHelpers.classPrivateFieldGet(this,_).setDescription(t);return this}},{key:"clearValue",value:function e(){babelHelpers.classPrivateFieldGet(this,_).clearDescription();babelHelpers.classPrivateFieldSet(this,B,null);return P(this,se,Pe).call(this)}},{key:"resetToDefaults",value:function e(){babelHelpers.classPrivateFieldGet(this,_).setDescription(P(this,ae,we).call(this));return P(this,se,Pe).call(this)}},{key:"setStorageElementIds",value:function e(t){this.initFileUploader(t)}},{key:"initFileUploader",value:function e(i=[]){if(!babelHelpers.classPrivateFieldGet(this,L)){babelHelpers.classPrivateFieldSet(this,L,new t.FileUploader({baseContainer:babelHelpers.classPrivateFieldGet(this,y),events:{"File:onRemove":e=>{babelHelpers.classPrivateFieldGet(this,W).emit("onChangeUploaderContainerSize")},onUploadStart:e=>{babelHelpers.classPrivateFieldGet(this,W).emit("onChangeUploaderContainerSize")}},ownerId:babelHelpers.classPrivateFieldGet(this,C),ownerTypeId:babelHelpers.classPrivateFieldGet(this,E),activityId:babelHelpers.classPrivateFieldGet(this,N),files:i}))}const s=babelHelpers.classPrivateFieldGet(this,L).getContainer();const a="--is-displayed";if(i&&!c.Dom.hasClass(s,a)){c.Dom.addClass(s,a)}else{c.Dom.toggleClass(s,a)}babelHelpers.classPrivateFieldGet(this,W).emit("onChangeUploaderContainerSize")}}]);return e}();function he(){const e=[];if(babelHelpers.classPrivateFieldGet(this,V)){e.push(P(this,j,pe).call(this))}e.push(P(this,z,ve).call(this));return e}function pe(){return{id:"settings",icon:"settings",description:c.Loc.getMessage("CRM_ACTIVITY_TODO_SETTINGS_BUTTON_HINT"),action:P(this,q,be).bind(this)}}function be(){if(!babelHelpers.classPrivateFieldGet(this,R)){babelHelpers.classPrivateFieldSet(this,R,new i.SettingsPopup({onSettingsChange:this.onSettingsChange.bind(this),sections:P(this,te,Te).call(this),settings:babelHelpers.classPrivateFieldGet(this,x)}))}if(babelHelpers.classPrivateFieldGet(this,_)){babelHelpers.classPrivateFieldGet(this,R).syncSettings(babelHelpers.classPrivateFieldGet(this,_).getData())}babelHelpers.classPrivateFieldGet(this,R).show()}function ve(){return{id:"file-uploader",icon:"attach",description:c.Loc.getMessage("CRM_ACTIVITY_TODO_UPLOAD_FILE_BUTTON_HINT"),action:P(this,de,Ee).bind(this)}}function me(){return new Promise((e=>{P(this,Q,ge).call(this).then((t=>{const i=babelHelpers.classPrivateFieldGet(this,_).getData();const s={ownerTypeId:babelHelpers.classPrivateFieldGet(this,E),ownerId:babelHelpers.classPrivateFieldGet(this,C),description:i.description,responsibleId:i.responsibleUserId,deadline:l.DateTimeFormat.format(r.DatetimeConverter.getSiteDateTimeFormat(),i.deadline),parentActivityId:babelHelpers.classPrivateFieldGet(this,B),fileTokens:babelHelpers.classPrivateFieldGet(this,L)?babelHelpers.classPrivateFieldGet(this,L).getServerFileIds():[],settings:t,pingOffsets:i.pingOffsets};if(babelHelpers.classPrivateFieldGet(this,k)===w.UPDATE){s.id=babelHelpers.classPrivateFieldGet(this,N)}e(s)}))}))}function fe(){return babelHelpers.classPrivateFieldGet(this,k)===w.ADD?"crm.activity.todo.add":"crm.activity.todo.update"}function ge(){if(babelHelpers.classPrivateFieldGet(this,R)){return P(this,Z,Se).call(this)}return P(this,ee,Fe).call(this)}function Se(){if(babelHelpers.classPrivateFieldGet(this,_)){babelHelpers.classPrivateFieldGet(this,R).syncSettings(babelHelpers.classPrivateFieldGet(this,_).getData())}return new Promise((e=>{setTimeout((()=>{e(babelHelpers.classPrivateFieldGet(this,R).getSettings())}),0)}))}function Fe(){const e=[];P(this,te,Te).call(this).forEach((t=>{if(!t.active){return}const i=t.params;i.id=t.id;e.push(i)}));return Promise.resolve(e)}function Te(){const e={id:i.Calendar.methods.getId(),component:i.Calendar};if(babelHelpers.classPrivateFieldGet(this,R)){const t=babelHelpers.classPrivateFieldGet(this,R).getSettings();if(t.calendar){const i=t.calendar;e.params={from:i.from,to:i.to,duration:i.duration};e.active=true}}if(!e.params){e.params=P(this,ie,De).call(this);e.active=false}return[e]}function De(){const e=this.getDeadline()||babelHelpers.classPrivateFieldGet(this,M);const t=e.getTime()/1e3;const i=3600;const s=t+i;return{from:t,duration:i,to:s}}function Pe(){this.setDefaultDeadLine();babelHelpers.classPrivateFieldGet(this,_).resetPingOffsetsToDefault();babelHelpers.classPrivateFieldGet(this,_).resetResponsibleUserToDefault();c.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,y),"--is-edit");if(babelHelpers.classPrivateFieldGet(this,L)){c.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,L).getContainer(),"--is-displayed")}babelHelpers.classPrivateFieldSet(this,L,null);babelHelpers.classPrivateFieldSet(this,R,null);return new Promise((e=>{setTimeout(e,10)}))}function we(){let e="CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT";switch(babelHelpers.classPrivateFieldGet(this,E)){case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL"}return c.Loc.getMessage(e)}function ye(){c.Dom.addClass(babelHelpers.classPrivateFieldGet(this,y),"--is-edit");babelHelpers.classPrivateFieldGet(this,W).emit("onFocus")}function He(e){const t=new d.BaseEvent({data:{description:e}});babelHelpers.classPrivateFieldGet(this,W).emit("onChangeDescription",t)}function _e(){babelHelpers.classPrivateFieldGet(this,W).emit("onSaveHotkeyPressed")}function Ie(e){return c.Type.isString(e)&&ue.BorderColor[e.toUpperCase()]}function ke(){return`crm-activity__todo-editor --border-${babelHelpers.classPrivateFieldGet(this,O)}`}function Ee(){this.initFileUploader()}babelHelpers.defineProperty(ue,"BorderColor",S);const Ce=c.Reflection.namespace("BX.Crm.Activity");Ce.TodoEditor=ue;e.TodoEditorMode=w;e.TodoEditor=ue})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX.Crm.Activity,BX,BX.Vue3,BX.Crm.Timeline,BX.Main,BX.Main,BX.Crm.Field,BX,BX.Event,BX.UI.EntitySelector);
//# sourceMappingURL=todo-editor.bundle.map.js