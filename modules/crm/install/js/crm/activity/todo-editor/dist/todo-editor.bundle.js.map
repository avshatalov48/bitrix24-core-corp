{"version":3,"file":"todo-editor.bundle.js","sources":["../src/components/todo-editor-action-btn.js","../src/components/todo-editor.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import { Popup } from 'main.popup';\n\nexport const TodoEditorActionBtn = {\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\taction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t\tdefault: () => {}\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpopup: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ticonClassname()\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-btn-icon',\n\t\t\t\t`--${this.icon}`,\n\t\t\t]\n\t\t}\n\t},\n\tmethods: {\n\t\tonMouseEnter(event): void\n\t\t{\n\t\t\tif (!this.description) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tcontent: this.description,\n\t\t\t\tbindElement: event.target,\n\t\t\t\tdarkMode: true,\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!this.popup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.popup.show();\n\t\t\t}, 400);\n\t\t},\n\n\t\tonMouseLeave(): void\n\t\t{\n\t\t\tif (!this.popup || !this.description)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup.close();\n\t\t\tthis.popup = null;\n\t\t},\n\n\t\tonButtonClick(): void\n\t\t{\n\t\t\tthis.action.call(this);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t@mouseenter=\"onMouseEnter\"\n\t\t\t@mouseleave=\"onMouseLeave\"\n\t\t\t@click=\"onButtonClick\"\n\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t>\n\t\t\t<i :class=\"iconClassname\"></i>\n\t\t</button>\n\t`\n}\n","import { DatetimeConverter } from \"crm.timeline.tools\";\nimport { TodoEditorActionBtn } from './todo-editor-action-btn';\nimport { DateTimeFormat } from \"main.date\";\nimport { Dom, Browser } from 'main.core';\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorActionBtn,\n\t},\n\tprops: {\n\t\tonFocus: Function,\n\t\tonChangeDescription: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tadditionalButtons: Array,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline: this.deadline ?? new Date(),\n\t\t\tshowFileUploader: false\n\t\t}\n\t},\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\treturn (new DatetimeConverter(this.currentDeadline)).toDatetimeString({ withDayOfWeek: true, delimiter:', ' });\n\t\t}\n\t},\n\tmethods: {\n\t\tclearDescription(): void\n\t\t{\n\t\t\tthis.description = '';\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\n\t\tsetDescription(description): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tDom.style(this.$refs.textarea, 'height', `${this.$refs.textarea.scrollHeight}px`);\n\t\t},\n\n\t\tonTextareaFocus(): void\n\t\t{\n\t\t\tthis.onFocus();\n\t\t},\n\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (\n\t\t\t\tevent.keyCode === 13\n\t\t\t\t&& (\n\t\t\t\t\tevent.ctrlKey === true ||\n\t\t\t\t\t( Browser.isMac() && (event.metaKey === true || event.altKey === true) )\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.setDeadlineValue.bind(this)\n\t\t\t});\n\t\t},\n\n\t\tsetDeadlineValue(newDeadline): void\n\t\t{\n\t\t\tthis.currentDeadline = newDeadline;\n\t\t},\n\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t};\n\t\t},\n\n\t\tonTextareaInput(event)\n\t\t{\n\t\t\tDom.style(event.target, 'height', 'auto');\n\t\t\tDom.style(event.target, 'height', `${event.target.scrollHeight}px`);\n\n\t\t\tthis.description = event.target.value;\n\n\t\t\tthis.onChangeDescription(event.target.value);\n\t\t}\n\t},\n\ttemplate: `\n\t\t\t<textarea \n\t\t\t\trows=\"1\" \n\t\t\t\tref=\"textarea\"\n\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\tclass=\"crm-activity__todo-editor_textarea\"\n\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_PLACEHOLDER')\"\n\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t:value=\"description\"\n\t\t\t></textarea>\n\t\t\t<div\n\t\t\t\tref=\"deadline\"\n\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\tclass=\"crm-activity__todo-editor_deadline\"\n\t\t\t>\n\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-icon\"><i></i></span>\n\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t</div>\n\t\t\t<div class=\"crm-activity__todo-editor_action-btns\">\n\t\t\t\t<TodoEditorActionBtn\n\t\t\t\t\tv-for=\"btn in additionalButtons\"\n\t\t\t\t\t:key=\"btn.id\"\n\t\t\t\t\t:icon=\"btn.icon\"\n\t\t\t\t\t:description=\"btn.description\"\n\t\t\t\t\t:action=\"btn.action\"\n\t\t\t\t/>\n\t\t\t</div>\n\t`\n};\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import {ajax as Ajax, Dom, Loc, Reflection, Type} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport { TodoEditor as TodoEditorComponent } from './components/todo-editor';\nimport { UI } from 'ui.notification';\nimport { DateTimeFormat } from 'main.date';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { TodoEditorBorderColor } from './enums/border-color';\nimport { FileUploader as TodoEditorFileUploader } from 'crm.activity.file-uploader';\n\nimport './todo-editor.css';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\townerTypeId: number,\n\tborderColor: string,\n};\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditor\n{\n/**\n * @event onFocus\n * @event onChangeDescription\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\n\t#eventEmitter: EventEmitter = null;\n\t#fileUploader: TodoEditorFileUploader = null;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor =\n\t\t\tthis.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditor.BorderColor.DEFAULT\n\t\t;\n\t\tDom.addClass(this.#container, this.#getClassname());\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new Error('OwnerTypeId must be set');\n\t\t}\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new Error('OwnerId must be set');\n\t\t}\n\t\tthis.#ownerId = params.ownerId;\n\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription) ? params.defaultDescription : this.#getDefaultDescription();\n\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tthis.#eventEmitter = new EventEmitter;\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tfor (const eventName in params.events)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName])\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\tadditionalButtons: [{\n\t\t\t\tid: 'file-uploader',\n\t\t\t\ticon: 'attach',\n\t\t\t\tdescription: Loc.getMessage('CRM_ACTIVITY_TODO_UPLOAD_FILE_BUTTON_HINT'),\n\t\t\t\taction: this.#onFileUploadButtonClick.bind(this),\n\t\t\t}]\n\t\t});\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\t\tconst userData = this.#layoutComponent.getData();\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('crm.activity.todo.add', {\n\t\t\t\tdata: {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId,\n\t\t\t\t\tfileTokens: this.#fileUploader ? this.#fileUploader.getServerFileIds() : []\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t//so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent.getData()['deadline'] ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent.getData()['description'] ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): void\n\t{\n\t\tthis.#parentActivityId = activityId;\n\t}\n\n\tsetDeadLine(deadLine: String): void\n\t{\n\t\tlet value = BX.parseDate(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadlineValue(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): void\n\t{\n\t\tlet defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadlineValue(this.#deadline);\n\t\t}\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tclearValue(): Promise\n\t{\n\t\tthis.#layoutComponent.clearDescription();\n\t\tthis.#parentActivityId = null;\n\t\tthis.setDefaultDeadLine();\n\t\tDom.removeClass(this.#container, '--is-edit');\n\t\tif (this.#fileUploader) {\n\t\t\tDom.removeClass(this.#fileUploader.getContainer(), '--is-displayed');\n\t\t}\n\n\t\tthis.#fileUploader = null;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\t\tthis.setDefaultDeadLine();\n\t\tDom.removeClass(this.#container, '--is-edit');\n\t\tif (this.#fileUploader)\n\t\t{\n\t\t\tDom.removeClass(this.#fileUploader.getContainer(), '--is-displayed');\n\t\t}\n\n\t\tthis.#fileUploader = null;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onChangeDescription(description): void\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription\n\t\t\t},\n\t\t});\n\n\t\tthis.#eventEmitter.emit('onChangeDescription', event);\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditor.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor --border-${this.#borderColor}`;\n\t}\n\n\t#onFileUploadButtonClick(): void\n\t{\n\t\tif (!this.#fileUploader)\n\t\t{\n\t\t\tthis.#fileUploader = new TodoEditorFileUploader({\n\t\t\t\tbaseContainer: this.#container,\n\t\t\t\tevents: {\n\t\t\t\t\t'File:onRemove': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t'onUploadStart': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t// TODO: not implemented yet\n\t\t\t\t\t//\t\t'File:onComplete'\n\t\t\t\t\t//\t\t'onUploadComplete'\n\t\t\t\t},\n\t\t\t\townerId: this.#ownerId,\n\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\tactivityId: null, // new activity\n\t\t\t});\n\t\t}\n\n\t\tDom.toggleClass(this.#fileUploader.getContainer(), '--is-displayed');\n\n\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t}\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\nnamespace.TodoEditor = TodoEditor;\n"],"names":["TodoEditorActionBtn","props","icon","type","String","required","default","action","Function","description","data","popup","computed","iconClassname","methods","onMouseEnter","event","Popup","content","bindElement","target","darkMode","setTimeout","show","onMouseLeave","close","onButtonClick","call","template","TodoEditor","components","onFocus","onChangeDescription","onSaveHotkeyPressed","deadline","Date","defaultDescription","additionalButtons","Array","currentDeadline","showFileUploader","deadlineFormatted","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","clearDescription","Dom","style","$refs","textarea","setDescription","scrollHeight","onTextareaFocus","onTextareaKeydown","keyCode","ctrlKey","Browser","isMac","metaKey","altKey","setTextareaFocused","focus","onDeadlineClick","BX","calendar","node","bTime","bHideTime","bSetFocus","value","DateTimeFormat","format","getSiteDateTimeFormat","callback","setDeadlineValue","bind","newDeadline","getData","onTextareaInput","TodoEditorBorderColor","params","Type","isDomNode","container","Error","borderColor","BorderColor","DEFAULT","addClass","isNumber","ownerTypeId","ownerId","isString","isDate","setDefaultDeadLine","EventEmitter","setEventNamespace","isObject","events","eventName","isFunction","subscribe","BitrixVue","createApp","TodoEditorComponent","id","Loc","getMessage","mount","userData","Promise","resolve","reject","Ajax","runAction","parentActivityId","fileTokens","getServerFileIds","then","catch","response","UI","Notification","Center","notify","errors","message","autoHideDelay","finally","activityId","deadLine","parseDate","isNeedUpdateLayout","defaultDate","setMinutes","setTime","getTime","removeClass","getContainer","messagePhrase","CrmEntityType","enumeration","deal","emit","BaseEvent","toUpperCase","TodoEditorFileUploader","baseContainer","toggleClass","namespace","Reflection"],"mappings":"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"}