{"version":3,"file":"todo-editor.bundle.js","sources":["../src/components/todo-editor-action-btn.js","../src/components/todo-editor.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\n\nexport const TodoEditorActionBtn = {\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\taction: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpopup: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ticonClassname()\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-btn-icon',\n\t\t\t\t`--${this.icon}`,\n\t\t\t]\n\t\t}\n\t},\n\tmethods: {\n\t\tonMouseEnter(e)\n\t\t{\n\t\t\tif (!this.description) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tcontent: this.description,\n\t\t\t\tbindElement: e.target,\n\t\t\t\tdarkMode: true,\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!this.popup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.popup.show();\n\t\t\t}, 400);\n\t\t},\n\t\tonMouseLeave()\n\t\t{\n\t\t\tif (!this.popup || !this.description)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup.close();\n\t\t\tthis.popup = null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t@mouseenter=\"onMouseEnter\"\n\t\t\t@mouseleave=\"onMouseLeave\"\n\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t>\n\t\t\t<i :class=\"iconClassname\"></i>\n\t\t</button>\n\t`\n}","import { DatetimeConverter } from \"crm.timeline.tools\";\nimport {TodoEditorActionBtn} from './todo-editor-action-btn';\nimport {DateTimeFormat} from \"main.date\";\nimport {Dom, Browser} from 'main.core';\n\nconst exampleAdditionalButtons = [\n\t{\n\t\tid: 'attach',\n\t\taction: {},\n\t\ticon: 'attach',\n\t\tdescription: 'Attach file',\n\t},\n\t{\n\t\tid: 'attach-2',\n\t\taction: {},\n\t\ticon: 'attach-2',\n\t\tdescription: 'Attach document',\n\t},\n\t{\n\t\tid: 'micro',\n\t\taction: {},\n\t\ticon: 'micro',\n\t\tdescription: 'Record audio',\n\t},\n];\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorActionBtn,\n\t},\n\tprops: {\n\t\tonFocus: Function,\n\t\tonChangeDescription: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline: this.deadline ?? new Date()\n\t\t}\n\t},\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\treturn (new DatetimeConverter(this.currentDeadline)).toDatetimeString({ withDayOfWeek: true, delimiter:', ' });\n\t\t},\n\n\t\texampleAdditionalButtons() {\n\t\t\treturn [];\n\t\t\t//return exampleAdditionalButtons;\n\t\t},\n\t},\n\tmethods: {\n\t\tclearDescription(): void\n\t\t{\n\t\t\tthis.description = '';\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\t\tsetDescription(description): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tDom.style(this.$refs.textarea, 'height', `${this.$refs.textarea.scrollHeight}px`);\n\t\t},\n\t\tonTextareaFocus(): void\n\t\t{\n\t\t\tthis.onFocus();\n\t\t},\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (\n\t\t\t\tevent.keyCode === 13\n\t\t\t\t&& (\n\t\t\t\t\tevent.ctrlKey === true ||\n\t\t\t\t\t( Browser.isMac() && (event.metaKey === true || event.altKey === true) )\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.setDeadlineValue.bind(this)\n\t\t\t});\n\t\t},\n\t\tsetDeadlineValue(newDeadline): void\n\t\t{\n\t\t\tthis.currentDeadline = newDeadline;\n\t\t},\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t};\n\t\t},\n\t\tonTextareaInput(e) {\n\t\t\tDom.style(e.target, 'height', 'auto');\n\t\t\tDom.style(e.target, 'height', `${e.target.scrollHeight}px`);\n\n\t\t\tthis.description = e.target.value;\n\n\t\t\tthis.onChangeDescription(e.target.value);\n\t\t},\n\n\t},\n\ttemplate: `\n\t\t\t<textarea \n\t\t\t\trows=\"1\" \n\t\t\t\tref=\"textarea\"\n\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\tclass=\"crm-activity__todo-editor_textarea\"\n\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_PLACEHOLDER')\"\n\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t:value=\"description\"\n\t\t\t></textarea>\n\t\t\t<div\n\t\t\t\tref=\"deadline\"\n\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\tclass=\"crm-activity__todo-editor_deadline\"\n\t\t\t>\n\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-icon\"><i></i></span>\n\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t</div>\n\t\t\t<div class=\"crm-activity__todo-editor_action-btns\">\n\t\t\t\t<TodoEditorActionBtn\n\t\t\t\tv-for=\"btn in exampleAdditionalButtons\"\n\t\t\t\t:key=\"btn.id\"\n\t\t\t\t:icon=\"btn.icon\"\n\t\t\t\t:description=\"btn.description\"\n\t\t\t\t:action=\"btn.action\"\n\t\t\t/>\n\t\t\t</div>\n\t`\n};\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import { ajax as Ajax, Dom, Loc, Reflection, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport './todo-editor.css';\nimport { BitrixVue } from \"ui.vue3\";\nimport { TodoEditor as TodoEditorComponent } from \"./components/todo-editor\";\nimport { UI } from 'ui.notification';\nimport { DateTimeFormat } from \"main.date\";\nimport { DatetimeConverter } from \"crm.timeline.tools\";\nimport { TodoEditorBorderColor } from './enums/border-color';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\townerTypeId: number,\n\tborderColor: string,\n};\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditor\n{\n/**\n * @event onFocus\n * @event onChangeDescription\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\n\t#eventEmitter: EventEmitter = null;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor =\n\t\t\tthis.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditor.BorderColor.DEFAULT\n\t\t;\n\t\tDom.addClass(this.#container, this.#getClassname());\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new Error('OwnerTypeId must be set');\n\t\t}\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new Error('OwnerId must be set');\n\t\t}\n\t\tthis.#ownerId = params.ownerId;\n\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription) ? params.defaultDescription : this.#getDefaultDescription();\n\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tthis.#eventEmitter = new EventEmitter;\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tfor (const eventName in params.events)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName])\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t});\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\t\tconst userData = this.#layoutComponent.getData();\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('crm.activity.todo.add', {\n\t\t\t\tdata: {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t//so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent.getData()['deadline'] ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent.getData()['description'] ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): void\n\t{\n\t\tthis.#parentActivityId = activityId;\n\t}\n\n\tsetDeadLine(deadLine: String): void\n\t{\n\t\tlet value = BX.parseDate(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadlineValue(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): void\n\t{\n\t\tlet defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadlineValue(this.#deadline);\n\t\t}\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tclearValue(): Promise\n\t{\n\t\tthis.#layoutComponent.clearDescription();\n\t\tthis.#parentActivityId = null;\n\t\tthis.setDefaultDeadLine();\n\t\tDom.removeClass(this.#container, '--is-edit');\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\t\tthis.setDefaultDeadLine();\n\t\tDom.removeClass(this.#container, '--is-edit');\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onChangeDescription(description): void\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription\n\t\t\t},\n\t\t});\n\n\t\tthis.#eventEmitter.emit('onChangeDescription', event);\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditor.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor --border-${this.#borderColor}`;\n\t}\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\nnamespace.TodoEditor = TodoEditor;\n"],"names":["TodoEditorActionBtn","props","icon","type","String","required","default","action","Object","description","data","popup","computed","iconClassname","methods","onMouseEnter","e","Popup","content","bindElement","target","darkMode","setTimeout","show","onMouseLeave","close","template","TodoEditor","components","onFocus","Function","onChangeDescription","onSaveHotkeyPressed","deadline","Date","defaultDescription","currentDeadline","deadlineFormatted","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","exampleAdditionalButtons","clearDescription","Dom","style","$refs","textarea","setDescription","scrollHeight","onTextareaFocus","onTextareaKeydown","event","keyCode","ctrlKey","Browser","isMac","metaKey","altKey","setTextareaFocused","focus","onDeadlineClick","BX","calendar","node","bTime","bHideTime","bSetFocus","value","DateTimeFormat","format","getSiteDateTimeFormat","callback","setDeadlineValue","bind","newDeadline","getData","onTextareaInput","TodoEditorBorderColor","params","Type","isDomNode","container","Error","borderColor","BorderColor","DEFAULT","addClass","isNumber","ownerTypeId","ownerId","isString","isDate","setDefaultDeadLine","EventEmitter","setEventNamespace","isObject","events","eventName","isFunction","subscribe","BitrixVue","createApp","TodoEditorComponent","mount","userData","Promise","resolve","reject","Ajax","runAction","parentActivityId","then","catch","response","UI","Notification","Center","notify","errors","message","autoHideDelay","finally","activityId","deadLine","parseDate","isNeedUpdateLayout","defaultDate","Loc","getMessage","setMinutes","setTime","getTime","removeClass","messagePhrase","CrmEntityType","enumeration","deal","emit","BaseEvent","toUpperCase","namespace","Reflection"],"mappings":"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"}