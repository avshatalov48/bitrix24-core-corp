{"version":3,"file":"todo-editor.bundle.js","sources":["../src/components/todo-editor-action-btn.js","../src/components/todo-editor-action-delimiter.js","../src/components/todo-editor-responsible-user-selector.js","../src/components/todo-editor.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nexport const TodoEditorActionBtn = {\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\taction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t\tdefault: () => {}\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t}\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tpopup: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\ticonClassname(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-btn-icon',\n\t\t\t\t`--${this.icon}`,\n\t\t\t]\n\t\t}\n\t},\n\n\tmethods: {\n\t\tonMouseEnter(event: BaseEvent): void\n\t\t{\n\t\t\tif (!this.description) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tcontent: this.description,\n\t\t\t\tbindElement: event.target,\n\t\t\t\tdarkMode: true,\n\t\t\t});\n\n\t\t\tsetTimeout((): void => {\n\t\t\t\tif (!this.popup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.popup.show();\n\t\t\t}, 400);\n\t\t},\n\n\t\tonMouseLeave(): void\n\t\t{\n\t\t\tif (!this.popup || !this.description)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup.close();\n\t\t\tthis.popup = null;\n\t\t},\n\n\t\tonButtonClick(): void\n\t\t{\n\t\t\tthis.action.call(this);\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\t@mouseenter=\"onMouseEnter\"\n\t\t\t@mouseleave=\"onMouseLeave\"\n\t\t\t@click=\"onButtonClick\"\n\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t>\n\t\t\t<i :class=\"iconClassname\"></i>\n\t\t</button>\n\t`\n}\n","export const TodoEditorActionDelimiter = {\n\tcomputed: {\n\t\tclassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-delimiter',\n\t\t\t]\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<span :class=\"className\">\n\t\t\t<i class=\"crm-activity__todo-editor_action-delimiter-icon\"></i>\n\t\t</span>\n\t`\n};\n","import { Text } from \"main.core\";\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { Events } from './todo-editor'\n\nexport const TodoEditorResponsibleUserSelector = {\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tdefault: 0,\n\t\t},\n\t\tuserName: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\timageUrl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tisTickFlipped: false,\n\t\t\tuserAvatarUrl: this.imageUrl,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tuserIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-icon',\n\t\t\t\t'ui-icon-common-user',\n\t\t\t\t'crm-timeline__user-icon'\n\t\t\t]\n\t\t},\n\n\t\ttickIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-user-selector-tick',\n\t\t\t\t'crm-activity__todo-editor_action-user-selector-tick-icon', {\n\t\t\t\t\t'--flipped': this.isTickFlipped,\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\tuserIconStyles(): Object\n\t\t{\n\t\t\tif (!this.userAvatarUrl)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: \"url('\" + encodeURI(Text.encode(this.userAvatarUrl)) + \"')\",\n\t\t\t\tbackgroundSize: '21px'\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonDialogShow(event: BaseEvent): void\n\t\t{\n\t\t\tthis.isTickFlipped = true;\n\t\t},\n\n\t\tonDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tthis.isTickFlipped = false;\n\t\t},\n\n\t\tonSelectUser(event: BaseEvent): void\n\t\t{\n\t\t\tconst selectedItem = event.getData().item.getDialog().getSelectedItems()[0];\n\t\t\tif (selectedItem)\n\t\t\t{\n\t\t\t\tthis.userAvatarUrl = selectedItem.getAvatar();\n\t\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_RESPONSIBLE_USER_CHANGE, {\n\t\t\t\t\tresponsibleUserId: selectedItem.getId()\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tonDeselectUser(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst selectedItems = this.userSelectorDialog.getSelectedItems();\n\t\t\t\tif (selectedItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_RESPONSIBLE_USER_CHANGE, {responsibleUserId: this.userId });\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\n\t\tshowUserDialog(): void\n\t\t{\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.userSelectorDialog.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tconst defaultUserItem = this.userSelectorDialog.getItem({id: this.userId, entityId: 'user'});\n\t\t\t\tif (defaultUserItem)\n\t\t\t\t{\n\t\t\t\t\tdefaultUserItem.select(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.userSelectorDialog = new Dialog({\n\t\t\tid: 'responsible-user-selector-dialog',\n\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\tcontext: 'CRM_ACTIVITY_TODO_RESPONSIBLE_USER',\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tshowAvatars: true,\n\t\t\tenableSearch: true,\n\t\t\twidth: 450,\n\t\t\tzIndex: 2500,\n\t\t\tentities: [{\n\t\t\t\tid: 'user',\n\t\t\t}],\n\t\t\tpreselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tundeselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'onShow': this.onDialogShow,\n\t\t\t\t'onHide': this.onDialogHide,\n\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t},\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"crm-activity__todo-editor_responsible-user-selector\"\n\t\t\tref=\"userSelector\"\n\t\t\t@click=\"showUserDialog\"\n\t\t>\n\t\t\t<span :class=\"userIconClassName\">\n\t\t\t\t<i :style=\"userIconStyles\"></i>\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\t:class=\"tickIconClassName\"\n\t\t\t\tref=\"tickIcon\"\n\t\t\t>\n\t\t\t</span>\n\t\t</div>\n\t`\n};\n","import { DateTimeFormat } from 'main.date';\nimport { Browser, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { TodoEditorActionBtn } from './todo-editor-action-btn';\nimport { TodoEditorActionDelimiter } from './todo-editor-action-delimiter';\nimport { TodoEditorResponsibleUserSelector } from './todo-editor-responsible-user-selector';\n\nconst TEXTAREA_MAX_HEIGHT = 126;\n\nexport const Events = {\n\tEVENT_RESPONSIBLE_USER_CHANGE: 'crm:timeline:todo:responsible-user-changed',\n};\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorActionBtn,\n\t\tTodoEditorActionDelimiter,\n\t\tTodoEditorResponsibleUserSelector\n\t},\n\n\tprops: {\n\t\tonFocus: Function,\n\t\tonChangeDescription: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tadditionalButtons: Array,\n\t\tpopupMode: Boolean,\n\t\tcurrentUser: Object,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline: this.deadline ?? new Date(),\n\t\t\tresponsibleUserId: this.currentUser.userId,\n\t\t\tshowFileUploader: false,\n\t\t\tisTextareaToLong: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tconst converter = new DatetimeConverter(this.currentDeadline);\n\n\t\t\treturn converter.toDatetimeString({ withDayOfWeek: true, delimiter:', ' });\n\t\t}\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst currentTextareaHeight = this.$refs.textarea.scrollHeight;\n\t\t\t\tDom.style(this.$refs.textarea, 'height', `${currentTextareaHeight}px`);\n\t\t\t\tif (this.popupMode === true)\n\t\t\t\t{\n\t\t\t\t\tthis.isTextareaToLong = currentTextareaHeight > TEXTAREA_MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\t\n\tmethods: {\n\t\tclearDescription(): void\n\t\t{\n\t\t\tthis.description = '';\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\n\t\tsetDescription(description): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t},\n\n\t\tonTextareaFocus(): void\n\t\t{\n\t\t\tthis.onFocus();\n\t\t},\n\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (event.keyCode !== 13)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isMacCtrlKeydown = Browser.isMac() && (event.metaKey === true || event.altKey === true);\n\n\t\t\tif (event.ctrlKey === true || isMacCtrlKeydown)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.setDeadline.bind(this),\n\t\t\t});\n\t\t},\n\n\t\tsetDeadline(newDeadline): void\n\t\t{\n\t\t\tthis.currentDeadline = newDeadline;\n\t\t},\n\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.setResponsibleUserId(data.responsibleUserId);\n\t\t\t}\n\t\t},\n\n\t\tsetResponsibleUserId(userId: Number): void\n\t\t{\n\t\t\tthis.responsibleUserId = userId;\n\t\t},\n\n\t\tresetResponsibleUserToDefault(): void\n\t\t{\n\t\t\tthis.setResponsibleUserId(this.currentUser.userId);\n\n\t\t\tconst userSelector = this.$refs.userSelector;\n\t\t\tif (userSelector)\n\t\t\t{\n\t\t\t\tuserSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId,\n\t\t\t};\n\t\t},\n\n\t\tonTextareaInput(event)\n\t\t{\n\t\t\tthis.setDescription(event.target.value);\n\t\t\tthis.onChangeDescription(event.target.value);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t},\n\n\ttemplate: `\n\t\t<label class=\"crm-activity__todo-editor_body\">\n\t\t\t<textarea\n\t\t\t\trows=\"1\"\n\t\t\t\tref=\"textarea\"\n\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\tclass=\"crm-activity__todo-editor_textarea\"\n\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_PLACEHOLDER')\"\n\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t:value=\"description\"\n\t\t\t\t:class=\"{ '--has-scroll': isTextareaToLong }\"\n\t\t\t></textarea>\n\t\t\t<div class=\"crm-activity__todo-editor_tools\">\n\t\t\t\t<div\n\t\t\t\t\tref=\"deadline\"\n\t\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\t\tclass=\"crm-activity__todo-editor_deadline\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-icon\"><i></i></span>\n\t\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor_action-btns\">\n\t\t\t\t\t<TodoEditorActionBtn\n\t\t\t\t\t\tv-for=\"btn in additionalButtons\"\n\t\t\t\t\t\t:key=\"btn.id\"\n\t\t\t\t\t\t:icon=\"btn.icon\"\n\t\t\t\t\t\t:description=\"btn.description\"\n\t\t\t\t\t\t:action=\"btn.action\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorActionDelimiter/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId=\"currentUser.userId\"\n\t\t\t\t\t\t:userName=\"currentUser.title\"\n\t\t\t\t\t\t:imageUrl=\"currentUser.imageUrl\"\n\t\t\t\t\t\tref=\"userSelector\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t\t\t\t>\n\t\t\t\t\t</TodoEditorResponsibleUserSelector>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</label>\n\t`\n};\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import { ajax as Ajax, Dom, Loc, Reflection, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport { TodoEditor as TodoEditorComponent } from './components/todo-editor';\nimport { UI } from 'ui.notification';\nimport { DateTimeFormat } from 'main.date';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { TodoEditorBorderColor } from './enums/border-color';\nimport { FileUploader as TodoEditorFileUploader } from 'crm.activity.file-uploader';\nimport {\n\tCalendar as SettingsPopupCalendar,\n\tSettingsPopup as TodoEditorSettingsPopup\n} from 'crm.activity.settings-popup';\nimport { Ping as SettingsPopupPing } from 'crm.activity.settings-popup';\n\nimport './todo-editor.css';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\tcurrentUser?: Object,\n\townerTypeId: number,\n\tborderColor: string,\n\tenableCalendarSync: boolean,\n\tpopupMode: boolean,\n};\n\ntype TodoEditorAdditionalButton = {\n\tid: string,\n\ticon: string,\n\tdescription: string,\n\taction: () => {},\n}\n\nexport type SectionSettings = {\n\tid: string,\n\tactive: boolean,\n\tcomponent: Object,\n\tparams: Object,\n}\n\nexport const TodoEditorMode = {\n\tADD: 'add',\n\tUPDATE: 'update',\n}\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditor\n{\n/**\n * @event onFocus\n * @event onChangeDescription\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#mode: String = TodoEditorMode.ADD;\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#currentUser: Object = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\t#activityId: Number = null;\n\t#eventEmitter: EventEmitter = null;\n\t#fileUploader: TodoEditorFileUploader = null;\n\t#settingsPopup: TodoEditorSettingsPopup = null;\n\t#settings: Object = {};\n\t#enableCalendarSync: boolean = false;\n\t#popupMode: boolean = false;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor =\n\t\t\tthis.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditor.BorderColor.DEFAULT\n\t\t;\n\t\tDom.addClass(this.#container, this.#getClassname());\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new Error('OwnerTypeId must be set');\n\t\t}\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new Error('OwnerId must be set');\n\t\t}\n\t\tthis.#ownerId = params.ownerId;\n\n\t\tif (!Type.isObject(params.currentUser))\n\t\t{\n\t\t\tthrow new Error('Current user must be set');\n\t\t}\n\t\tthis.#currentUser = params.currentUser;\n\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription) ? params.defaultDescription : this.#getDefaultDescription();\n\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tthis.#eventEmitter = new EventEmitter;\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tfor (const eventName in params.events)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName])\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#enableCalendarSync = Type.isBoolean(params.enableCalendarSync) ? params.enableCalendarSync : false;\n\t\tthis.#popupMode = Type.isBoolean(params.popupMode) ? params.popupMode : false;\n\t}\n\n\tsetMode(mode: String): self\n\t{\n\t\tif (!Object.values(TodoEditorMode).some(value => value === mode) )\n\t\t{\n\t\t\tthrow new Error(`Unknown TodoEditor mode ${mode}`);\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\tadditionalButtons: this.#getAdditionalButtons(),\n\t\t\tpopupMode: this.#popupMode,\n\t\t\tcurrentUser: this.#currentUser,\n\t\t});\n\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\t#getAdditionalButtons(): ReadonlyArray<TodoEditorAdditionalButton>\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.#enableCalendarSync)\n\t\t{\n\t\t\tbuttons.push(this.#getSettingsButton());\n\t\t}\n\n\t\tbuttons.push(this.#getFileUploaderButton());\n\n\t\treturn buttons;\n\t}\n\n\t#getSettingsButton(): TodoEditorAdditionalButton\n\t{\n\t\treturn {\n\t\t\tid: 'settings',\n\t\t\ticon: 'settings',\n\t\t\tdescription: Loc.getMessage('CRM_ACTIVITY_TODO_SETTINGS_BUTTON_HINT'),\n\t\t\taction: this.#onSettingsButtonClick.bind(this),\n\t\t}\n\t}\n\n\t#onSettingsButtonClick(): void\n\t{\n\t\tif (!this.#settingsPopup)\n\t\t{\n\t\t\tthis.#settingsPopup = new TodoEditorSettingsPopup({\n\t\t\t\tonSettingsChange: this.onSettingsChange.bind(this),\n\t\t\t\tsections: this.#getSectionSettings(),\n\t\t\t\tsettings: this.#settings,\n\t\t\t});\n\t\t}\n\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#settingsPopup.syncSettings(this.#layoutComponent.getData());\n\t\t}\n\n\t\tthis.#settingsPopup.show();\n\t}\n\n\tonSettingsChange(settings: Object): void\n\t{\n\t\tthis.setSettings(settings);\n\n\t\tif (settings?.calendar)\n\t\t{\n\t\t\tthis.setDeadlineFromTimestamp(settings['calendar'].from);\n\t\t}\n\t}\n\n\tsetSettings(settings: Object = {}): void\n\t{\n\t\tthis.#settings = settings;\n\t}\n\n\t#getSettingsSection(name: String): ?Object\n\t{\n\t\treturn (this.#settings[name] || null);\n\t}\n\n\t#getFileUploaderButton(): TodoEditorAdditionalButton\n\t{\n\t\treturn {\n\t\t\tid: 'file-uploader',\n\t\t\ticon: 'attach',\n\t\t\tdescription: Loc.getMessage('CRM_ACTIVITY_TODO_UPLOAD_FILE_BUTTON_HINT'),\n\t\t\taction: this.#onFileUploadButtonClick.bind(this),\n\t\t}\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#getSaveActionData().then(data => {\n\t\t\t\tAjax\n\t\t\t\t\t.runAction(this.#getSaveActionPath(), { data })\n\t\t\t\t\t.then(resolve)\n\t\t\t\t\t.catch(reject)\n\t\t\t\t;\n\t\t\t})\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t//so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\t#getSaveActionData(): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tthis.#getSaveActionDataSettings().then(settings => {\n\t\t\t\tconst userData = this.#layoutComponent.getData();\n\t\t\t\tconst data = {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tresponsibleId: userData.responsibleUserId,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId,\n\t\t\t\t\tfileTokens: this.#fileUploader ? this.#fileUploader.getServerFileIds() : [],\n\t\t\t\t\tsettings,\n\t\t\t\t}\n\n\t\t\t\tif (this.#mode === TodoEditorMode.UPDATE)\n\t\t\t\t{\n\t\t\t\t\tdata.id = this.#activityId;\n\t\t\t\t}\n\n\t\t\t\tresolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\t#getSaveActionPath(): String\n\t{\n\t\treturn (this.#mode === TodoEditorMode.ADD ? 'crm.activity.todo.add' : 'crm.activity.todo.update');\n\t}\n\n\t#getSaveActionDataSettings(): Promise\n\t{\n\t\tif (this.#settingsPopup)\n\t\t{\n\t\t\treturn this.#syncAndGetSaveActionDataSettingsFromPopup();\n\t\t}\n\n\t\treturn this.#getSaveActionDefaultDataSettings();\n\t}\n\n\t#syncAndGetSaveActionDataSettingsFromPopup(): Promise\n\t{\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#settingsPopup.syncSettings(this.#layoutComponent.getData());\n\t\t}\n\n\t\t// must first work out vue reactivity in nested components\n\t\treturn new Promise(resolve => {\n\t\t\tsetTimeout(()=>{\n\t\t\t\tresolve(this.#settingsPopup.getSettings());\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\t#getSaveActionDefaultDataSettings(): Promise\n\t{\n\t\tconst result = [];\n\n\t\tthis.#getSectionSettings().forEach(section => {\n\t\t\tif (!section.active)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst sectionSettings = section.params;\n\t\t\tsectionSettings.id = section.id;\n\t\t\tresult.push(sectionSettings);\n\t\t});\n\n\t\treturn Promise.resolve(result);\n\t}\n\n\t#getSectionSettings(): ReadonlyArray<SectionSettings>\n\t{\n\t\tconst ping = {\n\t\t\tid: SettingsPopupPing.methods.getId(),\n\t\t\tcomponent: SettingsPopupPing,\n\t\t\tactive: true,\n\t\t\tshowToggleSelector: false,\n\t\t};\n\n\t\tconst calendar = {\n\t\t\tid: SettingsPopupCalendar.methods.getId(),\n\t\t\tcomponent: SettingsPopupCalendar,\n\t\t};\n\n\t\tif (this.#settingsPopup)\n\t\t{\n\t\t\tconst settings = this.#settingsPopup.getSettings();\n\n\t\t\tif (settings.ping)\n\t\t\t{\n\t\t\t\tconst pingSettings = settings.ping;\n\t\t\t\tping.params = {\n\t\t\t\t\tselectedItems: pingSettings.selectedItems,\n\t\t\t\t};\n\t\t\t\tping.active = true;\n\t\t\t\tping.showToggleSelector = false;\n\t\t\t}\n\n\t\t\tif (settings.calendar)\n\t\t\t{\n\t\t\t\tconst calendarSettings = settings.calendar;\n\t\t\t\tcalendar.params = {\n\t\t\t\t\tfrom: calendarSettings.from,\n\t\t\t\t\tto: calendarSettings.to,\n\t\t\t\t\tduration: calendarSettings.duration,\n\t\t\t\t}\n\t\t\t\tcalendar.active = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!ping.params)\n\t\t{\n\t\t\tping.params = this.#getDefaultPingParams();\n\t\t}\n\n\t\tif (!calendar.params)\n\t\t{\n\t\t\tcalendar.params = this.#getDefaultCalendarParams();\n\t\t\tcalendar.active = false;\n\t\t}\n\n\t\treturn [\n\t\t\tping,\n\t\t\tcalendar,\n\t\t];\n\t}\n\n\t#getDefaultCalendarParams(): Object\n\t{\n\t\tconst fromDate = this.getDeadline() || this.#deadline;\n\t\tconst from = fromDate.getTime() / 1000;\n\t\tconst duration = 3600;\n\t\tconst to = from + duration;\n\n\t\treturn  {\n\t\t\tfrom,\n\t\t\tduration,\n\t\t\tto,\n\t\t}\n\t}\n\n\t#getDefaultPingParams(): Object\n\t{\n\t\treturn  {\n\t\t\tselectedItems: ['at the time of the onset', 'in 15 minutes']\n\t\t}\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent?.getData()['deadline'] ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent?.getData()['description'] ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): self\n\t{\n\t\tthis.#parentActivityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetActivityId(activityId: Number): self\n\t{\n\t\tthis.#activityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetDeadline(deadLine: String): self\n\t{\n\t\tconst value = DateTimeFormat.parse(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetDeadlineFromTimestamp(timestamp: Number): self\n\t{\n\t\tconst value = new Date(timestamp * 1000);\n\t\tthis.#layoutComponent.setDeadline(value);\n\t\tthis.#deadline = value;\n\n\t\treturn this;\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): self\n\t{\n\t\tlet defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(this.#deadline);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tsetDescription(description: String): self\n\t{\n\t\tthis.#layoutComponent.setDescription(description);\n\n\t\treturn this;\n\t}\n\n\tclearValue(): Promise\n\t{\n\t\tthis.#layoutComponent.clearDescription();\n\t\tthis.#parentActivityId = null;\n\t\tthis.setDefaultDeadLine();\n\t\tthis.#layoutComponent.resetResponsibleUserToDefault();\n\t\tDom.removeClass(this.#container, '--is-edit');\n\t\tif (this.#fileUploader)\n\t\t{\n\t\t\tDom.removeClass(this.#fileUploader.getContainer(), '--is-displayed');\n\t\t}\n\n\t\tthis.#fileUploader = null;\n\t\tthis.#settingsPopup = null;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\t\tthis.setDefaultDeadLine();\n\t\tthis.#layoutComponent.resetResponsibleUserToDefault();\n\n\t\tDom.removeClass(this.#container, '--is-edit');\n\t\tif (this.#fileUploader)\n\t\t{\n\t\t\tDom.removeClass(this.#fileUploader.getContainer(), '--is-displayed');\n\t\t}\n\n\t\tthis.#fileUploader = null;\n\t\tthis.#settingsPopup = null;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onChangeDescription(description): void\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription\n\t\t\t},\n\t\t});\n\n\t\tthis.#eventEmitter.emit('onChangeDescription', event);\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditor.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor --border-${this.#borderColor}`;\n\t}\n\n\t#onFileUploadButtonClick(): void\n\t{\n\t\tthis.initFileUploader();\n\t}\n\n\tsetStorageElementIds(ids: Array): void\n\t{\n\t\tthis.initFileUploader(ids);\n\t}\n\n\tinitFileUploader(files: Array = []): void\n\t{\n\t\tif (!this.#fileUploader)\n\t\t{\n\t\t\tthis.#fileUploader = new TodoEditorFileUploader({\n\t\t\t\tbaseContainer: this.#container,\n\t\t\t\tevents: {\n\t\t\t\t\t'File:onRemove': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t'onUploadStart': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t// TODO: not implemented yet\n\t\t\t\t\t//\t\t'File:onComplete'\n\t\t\t\t\t//\t\t'onUploadComplete'\n\t\t\t\t},\n\t\t\t\townerId: this.#ownerId,\n\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\tactivityId: this.#activityId,\n\t\t\t\tfiles,\n\t\t\t});\n\t\t}\n\n\t\tconst fileUploaderContainer = this.#fileUploader.getContainer();\n\t\tconst displayedClass = '--is-displayed';\n\n\t\tif (files && !Dom.hasClass(fileUploaderContainer, displayedClass))\n\t\t{\n\t\t\tDom.addClass(fileUploaderContainer, displayedClass);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(fileUploaderContainer, displayedClass);\n\t\t}\n\n\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t}\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nnamespace.TodoEditor = TodoEditor;\n"],"names":["TodoEditorActionBtn","props","icon","type","String","required","default","action","Function","description","data","popup","computed","iconClassname","methods","onMouseEnter","event","Popup","content","bindElement","target","darkMode","setTimeout","show","onMouseLeave","close","onButtonClick","call","template","TodoEditorActionDelimiter","className","TodoEditorResponsibleUserSelector","userId","Number","userName","imageUrl","isTickFlipped","userAvatarUrl","userIconClassName","tickIconClassName","userIconStyles","backgroundImage","encodeURI","Text","encode","backgroundSize","onDialogShow","onDialogHide","onSelectUser","selectedItem","getData","item","getDialog","getSelectedItems","getAvatar","$Bitrix","eventEmitter","emit","Events","EVENT_RESPONSIBLE_USER_CHANGE","responsibleUserId","getId","onDeselectUser","selectedItems","userSelectorDialog","length","hide","showUserDialog","resetToDefault","defaultUserItem","getItem","id","entityId","select","mounted","Dialog","targetNode","$refs","userSelector","context","multiple","dropdownMode","showAvatars","enableSearch","width","zIndex","entities","preselectedItems","undeselectedItems","events","TEXTAREA_MAX_HEIGHT","TodoEditor","components","onFocus","onChangeDescription","onSaveHotkeyPressed","deadline","Date","defaultDescription","additionalButtons","Array","popupMode","Boolean","currentUser","Object","currentDeadline","showFileUploader","isTextareaToLong","deadlineFormatted","converter","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","watch","Dom","style","textarea","$nextTick","currentTextareaHeight","scrollHeight","clearDescription","setDescription","onTextareaFocus","onTextareaKeydown","keyCode","isMacCtrlKeydown","Browser","isMac","metaKey","altKey","ctrlKey","setTextareaFocused","focus","onDeadlineClick","BX","calendar","node","bTime","bHideTime","bSetFocus","value","DateTimeFormat","format","getSiteDateTimeFormat","callback","setDeadline","bind","newDeadline","onResponsibleUserChange","setResponsibleUserId","resetResponsibleUserToDefault","onTextareaInput","subscribe","beforeUnmount","unsubscribe","TodoEditorBorderColor","TodoEditorMode","ADD","UPDATE","params","Type","isDomNode","container","Error","borderColor","BorderColor","DEFAULT","addClass","isNumber","ownerTypeId","ownerId","isObject","isString","isDate","setDefaultDeadLine","EventEmitter","setEventNamespace","eventName","isFunction","isBoolean","enableCalendarSync","mode","values","some","BitrixVue","createApp","TodoEditorComponent","mount","settings","setSettings","setDeadlineFromTimestamp","from","Promise","resolve","reject","then","Ajax","runAction","catch","response","UI","Notification","Center","notify","errors","message","autoHideDelay","finally","activityId","deadLine","parse","timestamp","isNeedUpdateLayout","defaultDate","parseDate","Loc","getMessage","setMinutes","setTime","getTime","removeClass","getContainer","ids","initFileUploader","files","TodoEditorFileUploader","baseContainer","fileUploaderContainer","displayedClass","hasClass","toggleClass","buttons","push","TodoEditorSettingsPopup","onSettingsChange","sections","syncSettings","userData","responsibleId","parentActivityId","fileTokens","getServerFileIds","getSettings","result","forEach","section","active","sectionSettings","ping","SettingsPopupPing","component","showToggleSelector","SettingsPopupCalendar","pingSettings","calendarSettings","to","duration","fromDate","getDeadline","messagePhrase","CrmEntityType","enumeration","deal","BaseEvent","toUpperCase","namespace","Reflection"],"mappings":";;;;;CAGO,MAAMA,mBAAmB,GAAG;GAClCC,KAAK,EAAE;KACNC,IAAI,EAAE;OACLC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE;MACT;KACDC,MAAM,EAAE;OACPJ,IAAI,EAAEK,QAAQ;OACdH,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE,MAAM;MACf;KACDG,WAAW,EAAE;OACZN,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;;IAEV;GAEDI,IAAI,GAAG;KACN,OAAO;OACNC,KAAK,EAAE;MACP;IACD;GAEDC,QAAQ,EAAE;KACTC,aAAa,GACb;OACC,OAAO,CACN,2CAA2C,EAC1C,KAAI,IAAI,CAACX,IAAK,EAAC,CAChB;;IAEF;GAEDY,OAAO,EAAE;KACRC,YAAY,CAACC,KAAgB,EAC7B;OACC,IAAI,CAAC,IAAI,CAACP,WAAW,EAAE;SACtB;;OAGD,IAAI,CAACE,KAAK,GAAG,IAAIM,gBAAK,CAAC;SACtBC,OAAO,EAAE,IAAI,CAACT,WAAW;SACzBU,WAAW,EAAEH,KAAK,CAACI,MAAM;SACzBC,QAAQ,EAAE;QACV,CAAC;OAEFC,UAAU,CAAC,MAAY;SACtB,IAAI,CAAC,IAAI,CAACX,KAAK,EACf;WACC;;SAGD,IAAI,CAACA,KAAK,CAACY,IAAI,EAAE;QACjB,EAAE,GAAG,CAAC;MACP;KAEDC,YAAY,GACZ;OACC,IAAI,CAAC,IAAI,CAACb,KAAK,IAAI,CAAC,IAAI,CAACF,WAAW,EACpC;SACC;;OAGD,IAAI,CAACE,KAAK,CAACc,KAAK,EAAE;OAClB,IAAI,CAACd,KAAK,GAAG,IAAI;MACjB;KAEDe,aAAa,GACb;OACC,IAAI,CAACnB,MAAM,CAACoB,IAAI,CAAC,IAAI,CAAC;;IAEvB;GAEDC,QAAQ,EAAG;;;;;;;;;;CAUZ,CAAC;;CCxFM,MAAMC,yBAAyB,GAAG;GACxCjB,QAAQ,EAAE;KACTkB,SAAS,GACT;OACC,OAAO,CACN,4CAA4C,CAC5C;;IAEF;GAEDF,QAAQ,EAAG;;;;;CAKZ,CAAC;;CCVM,MAAMG,iCAAiC,GAAG;GAChD9B,KAAK,EAAE;KACN+B,MAAM,EAAE;OACP7B,IAAI,EAAE8B,MAAM;OACZ5B,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE;MACT;KACD4B,QAAQ,EAAE;OACT/B,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE;MACT;KACD6B,QAAQ,EAAE;OACThC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE;;IAEV;GAEDI,IAAI,GAAG;KACN,OAAO;OACN0B,aAAa,EAAE,KAAK;OACpBC,aAAa,EAAE,IAAI,CAACF;MACpB;IACD;GAEDvB,QAAQ,EAAE;KACT0B,iBAAiB,GACjB;OACC,OAAO,CACN,SAAS,EACT,qBAAqB,EACrB,yBAAyB,CACzB;MACD;KAEDC,iBAAiB,GACjB;OACC,OAAO,CACN,qDAAqD,EACrD,0DAA0D,EAAE;SAC3D,WAAW,EAAE,IAAI,CAACH;QAClB,CACD;MACD;KAEDI,cAAc,GACd;OACC,IAAI,CAAC,IAAI,CAACH,aAAa,EACvB;SACC,OAAO,EAAE;;OAGV,OAAO;SACNI,eAAe,EAAE,OAAO,GAAGC,SAAS,CAACC,cAAI,CAACC,MAAM,CAAC,IAAI,CAACP,aAAa,CAAC,CAAC,GAAG,IAAI;SAC5EQ,cAAc,EAAE;QAChB;;IAEF;GAED/B,OAAO,EAAE;KACRgC,YAAY,CAAC9B,KAAgB,EAC7B;OACC,IAAI,CAACoB,aAAa,GAAG,IAAI;MACzB;KAEDW,YAAY,CAAC/B,KAAgB,EAC7B;OACC,IAAI,CAACoB,aAAa,GAAG,KAAK;MAC1B;KAEDY,YAAY,CAAChC,KAAgB,EAC7B;OACC,MAAMiC,YAAY,GAAGjC,KAAK,CAACkC,OAAO,EAAE,CAACC,IAAI,CAACC,SAAS,EAAE,CAACC,gBAAgB,EAAE,CAAC,CAAC,CAAC;OAC3E,IAAIJ,YAAY,EAChB;SACC,IAAI,CAACZ,aAAa,GAAGY,YAAY,CAACK,SAAS,EAAE;SAC7C,IAAI,CAACC,OAAO,CAACC,YAAY,CAACC,IAAI,CAACC,MAAM,CAACC,6BAA6B,EAAE;WACpEC,iBAAiB,EAAEX,YAAY,CAACY,KAAK;UACrC,CAAC;;MAEH;KAEDC,cAAc,GACd;OACCxC,UAAU,CAAC,MAAM;SAChB,MAAMyC,aAAa,GAAG,IAAI,CAACC,kBAAkB,CAACX,gBAAgB,EAAE;SAChE,IAAIU,aAAa,CAACE,MAAM,KAAK,CAAC,EAC9B;WACC,IAAI,CAAC5B,aAAa,GAAG,IAAI,CAACF,QAAQ;WAClC,IAAI,CAAC6B,kBAAkB,CAACE,IAAI,EAAE;WAC9B,IAAI,CAACX,OAAO,CAACC,YAAY,CAACC,IAAI,CAACC,MAAM,CAACC,6BAA6B,EAAE;aAACC,iBAAiB,EAAE,IAAI,CAAC5B;YAAQ,CAAC;;QAExG,EAAE,GAAG,CAAC;MACP;KAEDmC,cAAc,GACd;OACC,IAAI,IAAI,CAACH,kBAAkB,EAC3B;SACC1C,UAAU,CAAC,MAAM;WAChB,IAAI,CAAC0C,kBAAkB,CAACzC,IAAI,EAAE;UAC9B,EAAE,CAAC,CAAC;;MAEN;KAED6C,cAAc,GACd;OACC,IAAI,CAAC/B,aAAa,GAAG,IAAI,CAACF,QAAQ;OAClC,IAAI,IAAI,CAAC6B,kBAAkB,EAC3B;SACC,MAAMK,eAAe,GAAG,IAAI,CAACL,kBAAkB,CAACM,OAAO,CAAC;WAACC,EAAE,EAAE,IAAI,CAACvC,MAAM;WAAEwC,QAAQ,EAAE;UAAO,CAAC;SAC5F,IAAIH,eAAe,EACnB;WACCA,eAAe,CAACI,MAAM,CAAC,IAAI,CAAC;;;;IAI/B;GAEDC,OAAO,GACP;KACC,IAAI,CAACV,kBAAkB,GAAG,IAAIW,wBAAM,CAAC;OACpCJ,EAAE,EAAE,kCAAkC;OACtCK,UAAU,EAAE,IAAI,CAACC,KAAK,CAACC,YAAY;OACnCC,OAAO,EAAE,oCAAoC;OAC7CC,QAAQ,EAAE,KAAK;OACfC,YAAY,EAAE,IAAI;OAClBC,WAAW,EAAE,IAAI;OACjBC,YAAY,EAAE,IAAI;OAClBC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE,IAAI;OACZC,QAAQ,EAAE,CAAC;SACVf,EAAE,EAAE;QACJ,CAAC;OACFgB,gBAAgB,EAAE,CACjB,CAAC,MAAM,EAAE,IAAI,CAACvD,MAAM,CAAC,CACrB;OACDwD,iBAAiB,EAAE,CAClB,CAAC,MAAM,EAAE,IAAI,CAACxD,MAAM,CAAC,CACrB;OACDyD,MAAM,EAAE;SACP,QAAQ,EAAE,IAAI,CAAC3C,YAAY;SAC3B,QAAQ,EAAE,IAAI,CAACC,YAAY;SAC3B,eAAe,EAAE,IAAI,CAACC,YAAY;SAClC,iBAAiB,EAAE,IAAI,CAACc;;MAEzB,CAAC;IACF;GAEDlC,QAAQ,EAAG;;;;;;;;;;;;;;;;CAgBZ,CAAC;;CCnKD,MAAM8D,mBAAmB,GAAG,GAAG;AAE/B,CAAO,MAAMhC,MAAM,GAAG;GACrBC,6BAA6B,EAAE;CAChC,CAAC;AAED,CAAO,MAAMgC,UAAU,GAAG;GACzBC,UAAU,EAAE;KACX5F,mBAAmB;KACnB6B,yBAAyB;KACzBE;IACA;GAED9B,KAAK,EAAE;KACN4F,OAAO,EAAErF,QAAQ;KACjBsF,mBAAmB,EAAEtF,QAAQ;KAC7BuF,mBAAmB,EAAEvF,QAAQ;KAC7BwF,QAAQ,EAAEC,IAAI;KACdC,kBAAkB,EAAE;OACnB/F,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;MACT;KACD6F,iBAAiB,EAAEC,KAAK;KACxBC,SAAS,EAAEC,OAAO;KAClBC,WAAW,EAAEC;IACb;GAED9F,IAAI,GACJ;KAAA;KACC,OAAO;OACND,WAAW,EAAE,IAAI,CAACyF,kBAAkB;OACpCO,eAAe,oBAAE,IAAI,CAACT,QAAQ,2DAAI,IAAIC,IAAI,EAAE;OAC5CrC,iBAAiB,EAAE,IAAI,CAAC2C,WAAW,CAACvE,MAAM;OAC1C0E,gBAAgB,EAAE,KAAK;OACvBC,gBAAgB,EAAE;MAClB;IACD;GAED/F,QAAQ,EAAE;KACTgG,iBAAiB,GACjB;OACC,MAAMC,SAAS,GAAG,IAAIC,oCAAiB,CAAC,IAAI,CAACL,eAAe,CAAC;OAE7D,OAAOI,SAAS,CAACE,gBAAgB,CAAC;SAAEC,aAAa,EAAE,IAAI;SAAEC,SAAS,EAAC;QAAM,CAAC;;IAE3E;GAEDC,KAAK,EAAE;KACNzG,WAAW,GACX;OACC0G,aAAG,CAACC,KAAK,CAAC,IAAI,CAACvC,KAAK,CAACwC,QAAQ,EAAE,QAAQ,EAAE,MAAM,CAAC;OAChD,KAAK,IAAI,CAACC,SAAS,CAAC,MAAM;SACzB,MAAMC,qBAAqB,GAAG,IAAI,CAAC1C,KAAK,CAACwC,QAAQ,CAACG,YAAY;SAC9DL,aAAG,CAACC,KAAK,CAAC,IAAI,CAACvC,KAAK,CAACwC,QAAQ,EAAE,QAAQ,EAAG,GAAEE,qBAAsB,IAAG,CAAC;SACtE,IAAI,IAAI,CAAClB,SAAS,KAAK,IAAI,EAC3B;WACC,IAAI,CAACM,gBAAgB,GAAGY,qBAAqB,GAAG7B,mBAAmB;;QAEpE,CAAC;;IAEH;GAED5E,OAAO,EAAE;KACR2G,gBAAgB,GAChB;OACC,IAAI,CAAChH,WAAW,GAAG,EAAE;OACrB0G,aAAG,CAACC,KAAK,CAAC,IAAI,CAACvC,KAAK,CAACwC,QAAQ,EAAE,QAAQ,EAAE,MAAM,CAAC;MAChD;KAEDK,cAAc,CAACjH,WAAW,EAC1B;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW;MAC9B;KAEDkH,eAAe,GACf;OACC,IAAI,CAAC9B,OAAO,EAAE;MACd;KAED+B,iBAAiB,CAAC5G,KAAK,EACvB;OACC,IAAIA,KAAK,CAAC6G,OAAO,KAAK,EAAE,EACxB;SACC;;OAGD,MAAMC,gBAAgB,GAAGC,iBAAO,CAACC,KAAK,EAAE,KAAKhH,KAAK,CAACiH,OAAO,KAAK,IAAI,IAAIjH,KAAK,CAACkH,MAAM,KAAK,IAAI,CAAC;OAE7F,IAAIlH,KAAK,CAACmH,OAAO,KAAK,IAAI,IAAIL,gBAAgB,EAC9C;SACC,IAAI,CAAC/B,mBAAmB,EAAE;;MAE3B;KAEDqC,kBAAkB,GAClB;OACC,IAAI,CAACvD,KAAK,CAACwC,QAAQ,CAACgB,KAAK,EAAE;MAC3B;KAEDC,eAAe,GACf;OACCC,EAAE,CAACC,QAAQ,CAAC;SACXC,IAAI,EAAE,IAAI,CAAC5D,KAAK,CAACmB,QAAQ;SACzB0C,KAAK,EAAE,IAAI;SACXC,SAAS,EAAE,KAAK;SAChBC,SAAS,EAAE,KAAK;SAChBC,KAAK,EAAEC,wBAAc,CAACC,MAAM,CAACjC,oCAAiB,CAACkC,qBAAqB,EAAE,EAAE,IAAI,CAACvC,eAAe,CAAC;SAC7FwC,QAAQ,EAAE,IAAI,CAACC,WAAW,CAACC,IAAI,CAAC,IAAI;QACpC,CAAC;MACF;KAEDD,WAAW,CAACE,WAAW,EACvB;OACC,IAAI,CAAC3C,eAAe,GAAG2C,WAAW;MAClC;KAEDC,uBAAuB,CAACrI,KAAgB,EACxC;OACC,MAAMN,IAAI,GAAGM,KAAK,CAACkC,OAAO,EAAE;OAC5B,IAAIxC,IAAI,EACR;SACC,IAAI,CAAC4I,oBAAoB,CAAC5I,IAAI,CAACkD,iBAAiB,CAAC;;MAElD;KAED0F,oBAAoB,CAACtH,MAAc,EACnC;OACC,IAAI,CAAC4B,iBAAiB,GAAG5B,MAAM;MAC/B;KAEDuH,6BAA6B,GAC7B;OACC,IAAI,CAACD,oBAAoB,CAAC,IAAI,CAAC/C,WAAW,CAACvE,MAAM,CAAC;OAElD,MAAM8C,YAAY,GAAG,IAAI,CAACD,KAAK,CAACC,YAAY;OAC5C,IAAIA,YAAY,EAChB;SACCA,YAAY,CAACV,cAAc,EAAE;;MAE9B;KAEDlB,OAAO,GACP;OACC,OAAO;SACNzC,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BuF,QAAQ,EAAE,IAAI,CAACS,eAAe;SAC9B7C,iBAAiB,EAAE,IAAI,CAACA;QACxB;MACD;KAED4F,eAAe,CAACxI,KAAK,EACrB;OACC,IAAI,CAAC0G,cAAc,CAAC1G,KAAK,CAACI,MAAM,CAACyH,KAAK,CAAC;OACvC,IAAI,CAAC/C,mBAAmB,CAAC9E,KAAK,CAACI,MAAM,CAACyH,KAAK,CAAC;;IAE7C;GAEDnE,OAAO,GACP;KACC,IAAI,CAACnB,OAAO,CAACC,YAAY,CAACiG,SAAS,CAAC/F,MAAM,CAACC,6BAA6B,EAAE,IAAI,CAAC0F,uBAAuB,CAAC;IACvG;GAEDK,aAAa,GACb;KACC,IAAI,CAACnG,OAAO,CAACC,YAAY,CAACmG,WAAW,CAACjG,MAAM,CAACC,6BAA6B,EAAE,IAAI,CAAC0F,uBAAuB,CAAC;IACzG;GAEDzH,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA2CZ,CAAC;;KC3NYgI,qBAAqB;GAAA;CAAA;CAGjC,4BAHYA,qBAAqB,aAChB,SAAS;CAAA,4BADdA,qBAAqB,aAEhB,SAAS;;;;;;ACF3B,OA4CaC,cAAc,GAAG;GAC7BC,GAAG,EAAE,KAAK;GACVC,MAAM,EAAE;CACT,CAAC;;CAED;CACA;CACA;CAFA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAGA,KAAapE,YAAU;;CAGvB;CACA;CACA;CACA;;GAwBC,uBAAYqE,MAAwB,EACpC;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;OAAA;OAAA,OAtB0B;;KAAI;OAAA;OAAA,OACjB;;KAAI;OAAA;OAAA,OACE;;KAAI;OAAA;OAAA,OACK;;KAAI;OAAA;OAAA,OAEhBH,cAAc,CAACC;;KAAG;OAAA;OAAA,OACX;;KAAI;OAAA;OAAA,OACR;;KAAI;OAAA;OAAA,OACA;;KAAI;OAAA;OAAA,OACG;;KAAI;OAAA;OAAA,OAChB;;KAAI;OAAA;OAAA,OACM;;KAAI;OAAA;OAAA,OACjB;;KAAE;OAAA;OAAA,OACK;;KAAI;OAAA;OAAA,OACI;;KAAI;OAAA;OAAA,OACM;;KAAI;OAAA;OAAA,OACF;;KAAI;OAAA;OAAA,OAC1B;;KAAE;OAAA;OAAA,OACS;;KAAK;OAAA;OAAA,OACd;;KAIrB,IAAI,CAACG,cAAI,CAACC,SAAS,CAACF,MAAM,CAACG,SAAS,CAAC,EACrC;OACC,MAAM,IAAIC,KAAK,CAAC,yCAAyC,CAAC;;KAE3D,sCAAI,cAAcJ,MAAM,CAACG,SAAS;KAClC,sCAAI,gBACH,2BAAI,kDAAJ,IAAI,EAAqBH,MAAM,CAACK,WAAW,IACzCL,MAAM,CAACK,WAAW,GAClB1E,aAAU,CAAC2E,WAAW,CAACC,OAAO;KAEjCpD,aAAG,CAACqD,QAAQ,mCAAC,IAAI,sCAAa,IAAI,sCAAJ,IAAI,EAAiB;KAEnD,IAAI,CAACP,cAAI,CAACQ,QAAQ,CAACT,MAAM,CAACU,WAAW,CAAC,EACtC;OACC,MAAM,IAAIN,KAAK,CAAC,yBAAyB,CAAC;;KAE3C,sCAAI,gBAAgBJ,MAAM,CAACU,WAAW;KAEtC,IAAI,CAACT,cAAI,CAACQ,QAAQ,CAACT,MAAM,CAACW,OAAO,CAAC,EAClC;OACC,MAAM,IAAIP,KAAK,CAAC,qBAAqB,CAAC;;KAEvC,sCAAI,YAAYJ,MAAM,CAACW,OAAO;KAE9B,IAAI,CAACV,cAAI,CAACW,QAAQ,CAACZ,MAAM,CAACzD,WAAW,CAAC,EACtC;OACC,MAAM,IAAI6D,KAAK,CAAC,0BAA0B,CAAC;;KAE5C,sCAAI,gBAAgBJ,MAAM,CAACzD,WAAW;KAEtC,sCAAI,uBAAuB0D,cAAI,CAACY,QAAQ,CAACb,MAAM,CAAC9D,kBAAkB,CAAC,GAAG8D,MAAM,CAAC9D,kBAAkB,0BAAG,IAAI,wDAAJ,IAAI,CAAyB;KAE/H,sCAAI,aAAa+D,cAAI,CAACa,MAAM,CAACd,MAAM,CAAChE,QAAQ,CAAC,GAAGgE,MAAM,CAAChE,QAAQ,GAAG,IAAI;KAEtE,IAAI,mCAAC,IAAI,YAAU,EACnB;OACC,IAAI,CAAC+E,kBAAkB,CAAC,KAAK,CAAC;;KAG/B,sCAAI,iBAAiB,IAAIC,6BAAY;KACrC,sCAAI,iBAAeC,iBAAiB,CAAC,yBAAyB,CAAC;KAE/D,IAAIhB,cAAI,CAACW,QAAQ,CAACZ,MAAM,CAACvE,MAAM,CAAC,EAChC;OACC,KAAK,MAAMyF,SAAS,IAAIlB,MAAM,CAACvE,MAAM,EACrC;SACC,IAAIwE,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACvE,MAAM,CAACyF,SAAS,CAAC,CAAC,EAC7C;WACC,sCAAI,iBAAezB,SAAS,CAACyB,SAAS,EAAElB,MAAM,CAACvE,MAAM,CAACyF,SAAS,CAAC,CAAC;;;;KAKpE,sCAAI,uBAAuBjB,cAAI,CAACmB,SAAS,CAACpB,MAAM,CAACqB,kBAAkB,CAAC,GAAGrB,MAAM,CAACqB,kBAAkB,GAAG,KAAK;KACxG,sCAAI,cAAcpB,cAAI,CAACmB,SAAS,CAACpB,MAAM,CAAC3D,SAAS,CAAC,GAAG2D,MAAM,CAAC3D,SAAS,GAAG,KAAK;;GAC7E;KAAA;KAAA,wBAEOiF,IAAY,EACpB;OACC,IAAI,CAAC9E,MAAM,CAAC+E,MAAM,CAAC1B,cAAc,CAAC,CAAC2B,IAAI,CAAC3C,KAAK,IAAIA,KAAK,KAAKyC,IAAI,CAAC,EAChE;SACC,MAAM,IAAIlB,KAAK,CAAE,2BAA0BkB,IAAK,EAAC,CAAC;;OAGnD,sCAAI,SAASA,IAAI;OAEjB,OAAO,IAAI;;;KACX;KAAA,uBAGD;OACC,sCAAI,cAAcG,iBAAS,CAACC,SAAS,CAACC,UAAmB,EAAE;SAC1D3F,QAAQ,oCAAE,IAAI,YAAU;SACxBE,kBAAkB,oCAAE,IAAI,sBAAoB;SAC5CL,OAAO,EAAE,2BAAI,iCAAesD,IAAI,CAAC,IAAI,CAAC;SACtCrD,mBAAmB,EAAE,2BAAI,+CAAsBqD,IAAI,CAAC,IAAI,CAAC;SACzDpD,mBAAmB,EAAE,2BAAI,+CAAsBoD,IAAI,CAAC,IAAI,CAAC;SACzDhD,iBAAiB,yBAAE,IAAI,sDAAJ,IAAI,CAAwB;SAC/CE,SAAS,oCAAE,IAAI,aAAW;SAC1BE,WAAW,oCAAE,IAAI;QACjB,CAAC;OAEF,sCAAI,oBAAoB,sCAAI,cAAYqF,KAAK,mCAAC,IAAI,cAAY;;;KAC9D;KAAA,iCA6CgBC,QAAgB,EACjC;OACC,IAAI,CAACC,WAAW,CAACD,QAAQ,CAAC;OAE1B,IAAIA,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAErD,QAAQ,EACtB;SACC,IAAI,CAACuD,wBAAwB,CAACF,QAAQ,CAAC,UAAU,CAAC,CAACG,IAAI,CAAC;;;;KAEzD;KAAA,4BAEWH,QAAgB,GAAG,EAAE,EACjC;OACC,sCAAI,aAAaA,QAAQ;;;KACzB;KAAA,uBAkBD;OACC,sCAAI,IAAI,oBACR;SACC,yCAAO,IAAI;;;;OAIZ,sCAAI,mBAAmB,IAAII,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;SACvD,2BAAI,gDAAJ,IAAI,EAAsBC,IAAI,CAAC1L,IAAI,IAAI;WACtC2L,cAAI,CACFC,SAAS,wBAAC,IAAI,gDAAJ,IAAI,GAAuB;aAAE5L;YAAM,CAAC,CAC9C0L,IAAI,CAACF,OAAO,CAAC,CACbK,KAAK,CAACJ,MAAM,CAAC;UAEf,CAAC;QACF,CAAC,CAACI,KAAK,CAAEC,QAAQ,IAAK;SACtBC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7B1L,OAAO,EAAEsL,QAAQ,CAACK,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO;WACnCC,aAAa,EAAE;UACf,CAAC;;;SAGF,MAAMP,QAAQ;QACd,CAAC,CAACQ,OAAO,CAAC,MAAM;SAChB,sCAAI,mBAAmB,IAAI;QAC3B,CAAC;OAEF,yCAAO,IAAI;;;KACX;KAAA,8BA2JD;OAAA;OACC,4FAAO,IAAI,8EAAJ,uBAAuB9J,OAAO,EAAE,CAAC,UAAU,CAAC,yEAAI,IAAI;;;KAC3D;KAAA,iCAGD;OAAA;OACC,6FAAO,IAAI,8EAAJ,uBAAuBA,OAAO,EAAE,CAAC,aAAa,CAAC,2EAAI,EAAE;;;KAC5D;KAAA,oCAEmB+J,UAAkB,EACtC;OACC,sCAAI,qBAAqBA,UAAU;OAEnC,OAAO,IAAI;;;KACX;KAAA,8BAEaA,UAAkB,EAChC;OACC,sCAAI,eAAeA,UAAU;OAE7B,OAAO,IAAI;;;KACX;KAAA,4BAEWC,QAAgB,EAC5B;OACC,MAAMrE,KAAK,GAAGC,wBAAc,CAACqE,KAAK,CAACD,QAAQ,CAAC;OAC5C,IAAIjD,cAAI,CAACa,MAAM,CAACjC,KAAK,CAAC,EACtB;SACC,sCAAI,oBAAkBK,WAAW,CAACL,KAAK,CAAC;SACxC,sCAAI,aAAaA,KAAK;;OAGvB,OAAO,IAAI;;;KACX;KAAA,yCAEwBuE,SAAiB,EAC1C;OACC,MAAMvE,KAAK,GAAG,IAAI5C,IAAI,CAACmH,SAAS,GAAG,IAAI,CAAC;OACxC,sCAAI,oBAAkBlE,WAAW,CAACL,KAAK,CAAC;OACxC,sCAAI,aAAaA,KAAK;OAEtB,OAAO,IAAI;;;KACX;KAAA,mCAEkBwE,kBAA2B,GAAG,IAAI,EACrD;OACC,IAAIC,WAAW,GAAG/E,EAAE,CAACgF,SAAS,CAACC,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,CAAC;OAC3F,IAAIxD,cAAI,CAACa,MAAM,CAACwC,WAAW,CAAC,EAC5B;SACC,sCAAI,aAAaA,WAAW;QAC5B,MAED;SACC,sCAAI,aAAa,IAAIrH,IAAI,EAAE;SAC3B,sCAAI,aAAWyH,UAAU,CAAC,CAAC,CAAC;SAC5B,sCAAI,aAAWC,OAAO,CAAC,sCAAI,aAAWC,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;;;OAGnE,IAAIP,kBAAkB,EACtB;SACC,sCAAI,oBAAkBnE,WAAW,mCAAC,IAAI,aAAW;;OAGlD,OAAO,IAAI;;;KACX;KAAA,6BAGD;OACC,sCAAI,oBAAkBd,kBAAkB,EAAE;;;KAC1C;KAAA,+BAEc3H,WAAmB,EAClC;OACC,sCAAI,oBAAkBiH,cAAc,CAACjH,WAAW,CAAC;OAEjD,OAAO,IAAI;;;KACX;KAAA,6BAGD;OACC,sCAAI,oBAAkBgH,gBAAgB,EAAE;OACxC,sCAAI,qBAAqB,IAAI;OAC7B,IAAI,CAACsD,kBAAkB,EAAE;OACzB,sCAAI,oBAAkBxB,6BAA6B,EAAE;OACrDpC,aAAG,CAAC0G,WAAW,mCAAC,IAAI,eAAa,WAAW,CAAC;OAC7C,sCAAI,IAAI,kBACR;SACC1G,aAAG,CAAC0G,WAAW,CAAC,sCAAI,iBAAeC,YAAY,EAAE,EAAE,gBAAgB,CAAC;;OAGrE,sCAAI,iBAAiB,IAAI;OACzB,sCAAI,kBAAkB,IAAI;OAE1B,OAAO,IAAI7B,OAAO,CAAEC,OAAO,IAAK;SAC/B5K,UAAU,CAAC4K,OAAO,EAAE,EAAE,CAAC;QACvB,CAAC;;;KACF;KAAA,kCAGD;OACC,sCAAI,oBAAkBxE,cAAc,wBAAC,IAAI,wDAAJ,IAAI,EAA0B;OACnE,IAAI,CAACqD,kBAAkB,EAAE;OACzB,sCAAI,oBAAkBxB,6BAA6B,EAAE;OAErDpC,aAAG,CAAC0G,WAAW,mCAAC,IAAI,eAAa,WAAW,CAAC;OAC7C,sCAAI,IAAI,kBACR;SACC1G,aAAG,CAAC0G,WAAW,CAAC,sCAAI,iBAAeC,YAAY,EAAE,EAAE,gBAAgB,CAAC;;OAGrE,sCAAI,iBAAiB,IAAI;OACzB,sCAAI,kBAAkB,IAAI;OAE1B,OAAO,IAAI7B,OAAO,CAAEC,OAAO,IAAK;SAC/B5K,UAAU,CAAC4K,OAAO,EAAE,EAAE,CAAC;QACvB,CAAC;;;KACF;KAAA,qCAmDoB6B,GAAU,EAC/B;OACC,IAAI,CAACC,gBAAgB,CAACD,GAAG,CAAC;;;KAC1B;KAAA,iCAEgBE,KAAY,GAAG,EAAE,EAClC;OACC,IAAI,mCAAC,IAAI,gBAAc,EACvB;SACC,sCAAI,iBAAiB,IAAIC,sCAAsB,CAAC;WAC/CC,aAAa,oCAAE,IAAI,aAAW;WAC9B1I,MAAM,EAAE;aACP,eAAe,EAAGzE,KAAK,IAAK;eAC3B,sCAAI,iBAAeyC,IAAI,CAAC,+BAA+B,CAAC;cACxD;aACD,eAAe,EAAGzC,KAAK,IAAK;eAC3B,sCAAI,iBAAeyC,IAAI,CAAC,+BAA+B,CAAC;;;;;YAKzD;;WACDkH,OAAO,oCAAE,IAAI,WAAS;WACtBD,WAAW,oCAAE,IAAI,eAAa;WAC9BuC,UAAU,oCAAE,IAAI,cAAY;WAC5BgB;UACA,CAAC;;OAGH,MAAMG,qBAAqB,GAAG,sCAAI,iBAAeN,YAAY,EAAE;OAC/D,MAAMO,cAAc,GAAG,gBAAgB;OAEvC,IAAIJ,KAAK,IAAI,CAAC9G,aAAG,CAACmH,QAAQ,CAACF,qBAAqB,EAAEC,cAAc,CAAC,EACjE;SACClH,aAAG,CAACqD,QAAQ,CAAC4D,qBAAqB,EAAEC,cAAc,CAAC;QACnD,MAED;SACClH,aAAG,CAACoH,WAAW,CAACH,qBAAqB,EAAEC,cAAc,CAAC;;OAGvD,sCAAI,iBAAe5K,IAAI,CAAC,+BAA+B,CAAC;;;GACxD;CAAA;CACD,kCAldA;GACC,MAAM+K,OAAO,GAAG,EAAE;GAElB,sCAAI,IAAI,wBACR;KACCA,OAAO,CAACC,IAAI,wBAAC,IAAI,gDAAJ,IAAI,EAAsB;;GAGxCD,OAAO,CAACC,IAAI,wBAAC,IAAI,wDAAJ,IAAI,EAA0B;GAE3C,OAAOD,OAAO;CACf;CAAC,+BAGD;GACC,OAAO;KACNjK,EAAE,EAAE,UAAU;KACdrE,IAAI,EAAE,UAAU;KAChBO,WAAW,EAAE+M,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;KACrElN,MAAM,EAAE,2BAAI,mDAAwB4I,IAAI,CAAC,IAAI;IAC7C;CACF;CAAC,mCAGD;GACC,IAAI,mCAAC,IAAI,iBAAe,EACxB;KACC,sCAAI,kBAAkB,IAAIuF,wCAAuB,CAAC;OACjDC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB,CAACxF,IAAI,CAAC,IAAI,CAAC;OAClDyF,QAAQ,yBAAE,IAAI,kDAAJ,IAAI,CAAsB;OACpC/C,QAAQ,oCAAE,IAAI;MACd,CAAC;;GAGH,sCAAI,IAAI,qBACR;KACC,sCAAI,kBAAgBgD,YAAY,CAAC,sCAAI,oBAAkB3L,OAAO,EAAE,CAAC;;GAGlE,sCAAI,kBAAgB3B,IAAI,EAAE;CAC3B;AAAC,CAoBA,mCAGD;GACC,OAAO;KACNgD,EAAE,EAAE,eAAe;KACnBrE,IAAI,EAAE,QAAQ;KACdO,WAAW,EAAE+M,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;KACxElN,MAAM,EAAE,2BAAI,uDAA0B4I,IAAI,CAAC,IAAI;IAC/C;CACF;CAAC,+BAkCD;GACC,OAAO,IAAI8C,OAAO,CAACC,OAAO,IAAI;KAC7B,2BAAI,gEAAJ,IAAI,EAA8BE,IAAI,CAACP,QAAQ,IAAI;OAClD,MAAMiD,QAAQ,GAAG,sCAAI,oBAAkB5L,OAAO,EAAE;OAChD,MAAMxC,IAAI,GAAG;SACZgK,WAAW,oCAAE,IAAI,eAAa;SAC9BC,OAAO,oCAAE,IAAI,WAAS;SACtBlK,WAAW,EAAEqO,QAAQ,CAACrO,WAAW;SACjCsO,aAAa,EAAED,QAAQ,CAAClL,iBAAiB;SACzCoC,QAAQ,EAAE8C,wBAAc,CAACC,MAAM,CAACjC,oCAAiB,CAACkC,qBAAqB,EAAE,EAAE8F,QAAQ,CAAC9I,QAAQ,CAAC;SAC7FgJ,gBAAgB,oCAAE,IAAI,oBAAkB;SACxCC,UAAU,EAAE,sCAAI,mBAAiB,sCAAI,iBAAeC,gBAAgB,EAAE,GAAG,EAAE;SAC3ErD;QACA;OAED,IAAI,sCAAI,aAAWhC,cAAc,CAACE,MAAM,EACxC;SACCrJ,IAAI,CAAC6D,EAAE,qCAAG,IAAI,cAAY;;OAG3B2H,OAAO,CAACxL,IAAI,CAAC;MACb,CAAC;IACF,CAAC;CACH;CAAC,+BAGD;GACC,OAAQ,sCAAI,aAAWmJ,cAAc,CAACC,GAAG,GAAG,uBAAuB,GAAG,0BAA0B;CACjG;CAAC,uCAGD;GACC,sCAAI,IAAI,mBACR;KACC,8BAAO,IAAI,gGAAJ,IAAI;;GAGZ,8BAAO,IAAI,8EAAJ,IAAI;CACZ;CAAC,uDAGD;GACC,sCAAI,IAAI,qBACR;KACC,sCAAI,kBAAgB+E,YAAY,CAAC,sCAAI,oBAAkB3L,OAAO,EAAE,CAAC;;;;GAIlE,OAAO,IAAI+I,OAAO,CAACC,OAAO,IAAI;KAC7B5K,UAAU,CAAC,MAAI;OACd4K,OAAO,CAAC,sCAAI,kBAAgBiD,WAAW,EAAE,CAAC;MAC1C,EAAE,CAAC,CAAC;IACL,CAAC;CACH;CAAC,8CAGD;GACC,MAAMC,MAAM,GAAG,EAAE;GAEjB,2BAAI,kDAAJ,IAAI,EAAuBC,OAAO,CAACC,OAAO,IAAI;KAC7C,IAAI,CAACA,OAAO,CAACC,MAAM,EACnB;OACC;;KAGD,MAAMC,eAAe,GAAGF,OAAO,CAACtF,MAAM;KACtCwF,eAAe,CAACjL,EAAE,GAAG+K,OAAO,CAAC/K,EAAE;KAC/B6K,MAAM,CAACX,IAAI,CAACe,eAAe,CAAC;IAC5B,CAAC;GAEF,OAAOvD,OAAO,CAACC,OAAO,CAACkD,MAAM,CAAC;CAC/B;CAAC,gCAGD;GACC,MAAMK,IAAI,GAAG;KACZlL,EAAE,EAAEmL,+BAAiB,CAAC5O,OAAO,CAAC+C,KAAK,EAAE;KACrC8L,SAAS,EAAED,+BAAiB;KAC5BH,MAAM,EAAE,IAAI;KACZK,kBAAkB,EAAE;IACpB;GAED,MAAMpH,QAAQ,GAAG;KAChBjE,EAAE,EAAEsL,mCAAqB,CAAC/O,OAAO,CAAC+C,KAAK,EAAE;KACzC8L,SAAS,EAAEE;IACX;GAED,sCAAI,IAAI,mBACR;KACC,MAAMhE,QAAQ,GAAG,sCAAI,kBAAgBsD,WAAW,EAAE;KAElD,IAAItD,QAAQ,CAAC4D,IAAI,EACjB;OACC,MAAMK,YAAY,GAAGjE,QAAQ,CAAC4D,IAAI;OAClCA,IAAI,CAACzF,MAAM,GAAG;SACbjG,aAAa,EAAE+L,YAAY,CAAC/L;QAC5B;OACD0L,IAAI,CAACF,MAAM,GAAG,IAAI;OAClBE,IAAI,CAACG,kBAAkB,GAAG,KAAK;;KAGhC,IAAI/D,QAAQ,CAACrD,QAAQ,EACrB;OACC,MAAMuH,gBAAgB,GAAGlE,QAAQ,CAACrD,QAAQ;OAC1CA,QAAQ,CAACwB,MAAM,GAAG;SACjBgC,IAAI,EAAE+D,gBAAgB,CAAC/D,IAAI;SAC3BgE,EAAE,EAAED,gBAAgB,CAACC,EAAE;SACvBC,QAAQ,EAAEF,gBAAgB,CAACE;QAC3B;OACDzH,QAAQ,CAAC+G,MAAM,GAAG,IAAI;;;GAIxB,IAAI,CAACE,IAAI,CAACzF,MAAM,EAChB;KACCyF,IAAI,CAACzF,MAAM,0BAAG,IAAI,sDAAJ,IAAI,CAAwB;;GAG3C,IAAI,CAACxB,QAAQ,CAACwB,MAAM,EACpB;KACCxB,QAAQ,CAACwB,MAAM,0BAAG,IAAI,8DAAJ,IAAI,CAA4B;KAClDxB,QAAQ,CAAC+G,MAAM,GAAG,KAAK;;GAGxB,OAAO,CACNE,IAAI,EACJjH,QAAQ,CACR;CACF;CAAC,sCAGD;GACC,MAAM0H,QAAQ,GAAG,IAAI,CAACC,WAAW,EAAE,sCAAI,IAAI,YAAU;GACrD,MAAMnE,IAAI,GAAGkE,QAAQ,CAACtC,OAAO,EAAE,GAAG,IAAI;GACtC,MAAMqC,QAAQ,GAAG,IAAI;GACrB,MAAMD,EAAE,GAAGhE,IAAI,GAAGiE,QAAQ;GAE1B,OAAQ;KACPjE,IAAI;KACJiE,QAAQ;KACRD;IACA;CACF;CAAC,kCAGD;GACC,OAAQ;KACPjM,aAAa,EAAE,CAAC,0BAA0B,EAAE,eAAe;IAC3D;CACF;CAAC,mCA0HD;GACC,IAAIqM,aAAa,GAAG,6CAA6C;GACjE,0CAAQ,IAAI;KAEX,KAAK7H,EAAE,CAAC8H,aAAa,CAACC,WAAW,CAACC,IAAI;OACrCH,aAAa,GAAG,kDAAkD;;GAGpE,OAAO5C,aAAG,CAACC,UAAU,CAAC2C,aAAa,CAAC;CACrC;CAAC,0BAGD;GACCjJ,aAAG,CAACqD,QAAQ,mCAAC,IAAI,eAAa,WAAW,CAAC;GAC1C,sCAAI,iBAAe/G,IAAI,CAAC,SAAS,CAAC;CACnC;CAAC,+BAEoBhD,WAAW,EAChC;GACC,MAAMO,KAAK,GAAG,IAAIwP,0BAAS,CAAC;KAC3B9P,IAAI,EAAE;OACLD;;IAED,CAAC;GAEF,sCAAI,iBAAegD,IAAI,CAAC,qBAAqB,EAAEzC,KAAK,CAAC;CACtD;CAAC,iCAGD;GACC,sCAAI,iBAAeyC,IAAI,CAAC,qBAAqB,CAAC;CAC/C;CAAC,8BAEmB4G,WAAmB,EACvC;GACC,OAAOJ,cAAI,CAACY,QAAQ,CAACR,WAAW,CAAC,IAAI1E,YAAU,CAAC2E,WAAW,CAACD,WAAW,CAACoG,WAAW,EAAE,CAAC;CACvF;CAAC,0BAGD;GACC,OAAQ,sCAAmC,kCAAE,IAAI,eAAc,EAAC;CACjE;CAAC,qCAGD;GACC,IAAI,CAACzC,gBAAgB,EAAE;CACxB;CAAC,4BA3hBWrI,YAAU,iBAODiE,qBAAqB;CAmkB3C,MAAM8G,SAAS,GAAGC,oBAAU,CAACD,SAAS,CAAC,iBAAiB,CAAC;CAEzDA,SAAS,CAAC/K,UAAU,GAAGA,YAAU;;;;;;;;;"}