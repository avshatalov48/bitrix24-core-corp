{"version":3,"file":"todo-editor.bundle.js","sources":["../src/components/todo-editor-action-btn.js","../src/components/todo-editor-action-delimiter.js","../src/components/todo-editor-ping-selector.js","../src/components/todo-editor-responsible-user-selector.js","../src/components/todo-editor.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nexport const TodoEditorActionBtn = {\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\taction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t\tdefault: () => {}\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t}\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tpopup: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\ticonClassname(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-btn-icon',\n\t\t\t\t`--${this.icon}`,\n\t\t\t]\n\t\t}\n\t},\n\n\tmethods: {\n\t\tonMouseEnter(event: BaseEvent): void\n\t\t{\n\t\t\tif (!this.description) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tcontent: this.description,\n\t\t\t\tbindElement: event.target,\n\t\t\t\tdarkMode: true,\n\t\t\t});\n\n\t\t\tsetTimeout((): void => {\n\t\t\t\tif (!this.popup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.popup.show();\n\t\t\t}, 400);\n\t\t},\n\n\t\tonMouseLeave(): void\n\t\t{\n\t\t\tif (!this.popup || !this.description)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup.close();\n\t\t\tthis.popup = null;\n\t\t},\n\n\t\tonButtonClick(): void\n\t\t{\n\t\t\tthis.action.call(this);\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\t@mouseenter=\"onMouseEnter\"\n\t\t\t@mouseleave=\"onMouseLeave\"\n\t\t\t@click=\"onButtonClick\"\n\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t>\n\t\t\t<i :class=\"iconClassname\"></i>\n\t\t</button>\n\t`\n}\n","export const TodoEditorActionDelimiter = {\n\tcomputed: {\n\t\tclassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-delimiter',\n\t\t\t]\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<span :class=\"className\">\n\t\t\t<i class=\"crm-activity__todo-editor_action-delimiter-icon\"></i>\n\t\t</span>\n\t`\n};\n","import { ItemSelector } from 'crm.field.item-selector';\n\nexport const TodoEditorPingSelector = {\n\tprops: {\n\t\tvaluesList: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tselectedValues: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tmethods: {\n\t\tgetValue(): Array\n\t\t{\n\t\t\tif (this.itemSelector)\n\t\t\t{\n\t\t\t\treturn this.itemSelector.getValue();\n\t\t\t}\n\n\t\t\treturn [];\n\t\t},\n\n\t\tsetValue(values: Array): void\n\t\t{\n\t\t\tif (this.itemSelector)\n\t\t\t{\n\t\t\t\tthis.itemSelector.setValue(values);\n\t\t\t}\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.itemSelector = new ItemSelector({\n\t\t\ttarget: this.$el,\n\t\t\tvaluesList: this.valuesList,\n\t\t\tselectedValues: this.selectedValues,\n\t\t});\n\t},\n\n\ttemplate: `<div style=\"width: 100%;\"></div>`,\n};\n","import { Text } from \"main.core\";\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { Events } from './todo-editor'\n\nexport const TodoEditorResponsibleUserSelector = {\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tdefault: 0,\n\t\t},\n\t\tuserName: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\timageUrl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tisTickFlipped: false,\n\t\t\tuserAvatarUrl: this.imageUrl,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tuserIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-icon',\n\t\t\t\t'ui-icon-common-user',\n\t\t\t\t'crm-timeline__user-icon'\n\t\t\t]\n\t\t},\n\n\t\ttickIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-activity__todo-editor_action-user-selector-tick',\n\t\t\t\t'crm-activity__todo-editor_action-user-selector-tick-icon', {\n\t\t\t\t\t'--flipped': this.isTickFlipped,\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\tuserIconStyles(): Object\n\t\t{\n\t\t\tif (!this.userAvatarUrl)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: \"url('\" + encodeURI(Text.encode(this.userAvatarUrl)) + \"')\",\n\t\t\t\tbackgroundSize: '21px'\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonDialogShow(event: BaseEvent): void\n\t\t{\n\t\t\tthis.isTickFlipped = true;\n\t\t},\n\n\t\tonDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tthis.isTickFlipped = false;\n\t\t},\n\n\t\tonSelectUser(event: BaseEvent): void\n\t\t{\n\t\t\tconst selectedItem = event.getData().item.getDialog().getSelectedItems()[0];\n\t\t\tif (selectedItem)\n\t\t\t{\n\t\t\t\tthis.userAvatarUrl = selectedItem.getAvatar();\n\t\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_RESPONSIBLE_USER_CHANGE, {\n\t\t\t\t\tresponsibleUserId: selectedItem.getId()\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tonDeselectUser(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst selectedItems = this.userSelectorDialog.getSelectedItems();\n\t\t\t\tif (selectedItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_RESPONSIBLE_USER_CHANGE, {responsibleUserId: this.userId });\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\n\t\tshowUserDialog(): void\n\t\t{\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.userSelectorDialog.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tconst defaultUserItem = this.userSelectorDialog.getItem({id: this.userId, entityId: 'user'});\n\t\t\t\tif (defaultUserItem)\n\t\t\t\t{\n\t\t\t\t\tdefaultUserItem.select(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.userSelectorDialog = new Dialog({\n\t\t\tid: 'responsible-user-selector-dialog',\n\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\tcontext: 'CRM_ACTIVITY_TODO_RESPONSIBLE_USER',\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tshowAvatars: true,\n\t\t\tenableSearch: true,\n\t\t\twidth: 450,\n\t\t\tzIndex: 2500,\n\t\t\tentities: [{\n\t\t\t\tid: 'user',\n\t\t\t}],\n\t\t\tpreselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tundeselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'onShow': this.onDialogShow,\n\t\t\t\t'onHide': this.onDialogHide,\n\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t},\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"crm-activity__todo-editor_responsible-user-selector\"\n\t\t\tref=\"userSelector\"\n\t\t\t@click=\"showUserDialog\"\n\t\t>\n\t\t\t<span :class=\"userIconClassName\">\n\t\t\t\t<i :style=\"userIconStyles\"></i>\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\t:class=\"tickIconClassName\"\n\t\t\t\tref=\"tickIcon\"\n\t\t\t>\n\t\t\t</span>\n\t\t</div>\n\t`\n};\n","import { DatetimeConverter } from 'crm.timeline.tools';\nimport { Browser, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { TodoEditorActionBtn } from './todo-editor-action-btn';\nimport { TodoEditorActionDelimiter } from './todo-editor-action-delimiter';\nimport { TodoEditorPingSelector } from './todo-editor-ping-selector';\nimport { TodoEditorResponsibleUserSelector } from './todo-editor-responsible-user-selector';\n\nconst TEXTAREA_MAX_HEIGHT = 126;\n\nexport const Events = {\n\tEVENT_RESPONSIBLE_USER_CHANGE: 'crm:timeline:todo:responsible-user-changed',\n};\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorActionBtn,\n\t\tTodoEditorActionDelimiter,\n\t\tTodoEditorResponsibleUserSelector,\n\t\tTodoEditorPingSelector,\n\t},\n\n\tprops: {\n\t\tonFocus: Function,\n\t\tonChangeDescription: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tadditionalButtons: Array,\n\t\tpopupMode: Boolean,\n\t\tcurrentUser: Object,\n\t\tpingSettings: Object,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline: this.deadline ?? new Date(),\n\t\t\tpingOffsets: this.pingSettings.selectedValues,\n\t\t\tresponsibleUserId: this.currentUser.userId,\n\t\t\tshowFileUploader: false,\n\t\t\tisTextareaToLong: false,\n\t\t\twasUsed: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tconst converter = new DatetimeConverter(this.currentDeadline);\n\n\t\t\treturn converter.toDatetimeString({ withDayOfWeek: true, delimiter:', ' });\n\t\t}\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst currentTextareaHeight = this.$refs.textarea.scrollHeight;\n\t\t\t\tDom.style(this.$refs.textarea, 'height', `${currentTextareaHeight}px`);\n\t\t\t\tif (this.popupMode === true)\n\t\t\t\t{\n\t\t\t\t\tthis.isTextareaToLong = currentTextareaHeight > TEXTAREA_MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\tmethods: {\n\t\tclearDescription(): void\n\t\t{\n\t\t\tthis.description = '';\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\n\t\tsetDescription(description): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t},\n\n\t\tonTextareaFocus(): void\n\t\t{\n\t\t\tthis.wasUsed = true;\n\t\t\tthis.onFocus();\n\t\t},\n\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (event.keyCode !== 13)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isMacCtrlKeydown = Browser.isMac() && (event.metaKey === true || event.altKey === true);\n\n\t\t\tif (event.ctrlKey === true || isMacCtrlKeydown)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.wasUsed = true;\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.setDeadline.bind(this),\n\t\t\t});\n\t\t},\n\n\t\tsetDeadline(newDeadline): void\n\t\t{\n\t\t\tthis.currentDeadline = newDeadline;\n\t\t},\n\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.setResponsibleUserId(data.responsibleUserId);\n\t\t\t}\n\t\t},\n\n\t\tsetPingOffsets(offsets: Array): void\n\t\t{\n\t\t\tthis.pingOffsets = offsets;\n\t\t},\n\n\t\tsetResponsibleUserId(userId: Number): void\n\t\t{\n\t\t\tthis.responsibleUserId = userId;\n\t\t},\n\n\t\tresetPingOffsetsToDefault(): void\n\t\t{\n\t\t\tthis.setPingOffsets(this.pingSettings.selectedValues);\n\t\t\tthis.$refs.pingSelector?.setValue(this.pingSettings.selectedValues);;\n\t\t},\n\n\t\tresetResponsibleUserToDefault(): void\n\t\t{\n\t\t\tthis.setResponsibleUserId(this.currentUser.userId);\n\n\t\t\tconst userSelector = this.$refs.userSelector;\n\t\t\tif (userSelector)\n\t\t\t{\n\t\t\t\tuserSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId,\n\t\t\t\tpingOffsets: this.$refs.pingSelector?.getValue(),\n\t\t\t};\n\t\t},\n\n\t\tonTextareaInput(event)\n\t\t{\n\t\t\tthis.setDescription(event.target.value);\n\t\t\tthis.onChangeDescription(event.target.value);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t},\n\n\ttemplate: `\n\t\t<label class=\"crm-activity__todo-editor_body\">\n\t\t\t<textarea\n\t\t\t\trows=\"1\"\n\t\t\t\tref=\"textarea\"\n\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\tclass=\"crm-activity__todo-editor_textarea\"\n\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_PLACEHOLDER')\"\n\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t:value=\"description\"\n\t\t\t\t:class=\"{ '--has-scroll': isTextareaToLong }\"\n\t\t\t></textarea>\n\t\t\t<div class=\"crm-activity__todo-editor_tools\" v-if=\"wasUsed\">\n\t\t\t\t<div class=\"crm-activity__todo-editor_left_tools\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"deadline\"\n\t\t\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor_deadline\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-icon\"><i></i></span>\n\t\t\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-pill\">\n\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t\t\t\t\t<span class=\"crm-timeline__date-pill_caret\"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-activity__todo-editor_ping_selector_wrapper\">\n\t\t\t\t\t\t<span class=\"crm-activity__todo-editor_ping-selector-icon\"><i></i></span>\n\t\t\t\t\t\t<TodoEditorPingSelector\n\t\t\t\t\t\t\tref=\"pingSelector\"\n\t\t\t\t\t\t\t:valuesList=\"pingSettings.valuesList\"\n\t\t\t\t\t\t\t:selectedValues=\"pingSettings.selectedValues\"\n\t\t\t\t\t\t\tclass=\"crm-activity__todo-editor_ping_selector\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</TodoEditorPingSelector>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor_action-btns\">\n\t\t\t\t\t<TodoEditorActionBtn\n\t\t\t\t\t\tv-for=\"btn in additionalButtons\"\n\t\t\t\t\t\t:key=\"btn.id\"\n\t\t\t\t\t\t:icon=\"btn.icon\"\n\t\t\t\t\t\t:description=\"btn.description\"\n\t\t\t\t\t\t:action=\"btn.action\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorActionDelimiter/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId=\"currentUser.userId\"\n\t\t\t\t\t\t:userName=\"currentUser.title\"\n\t\t\t\t\t\t:imageUrl=\"currentUser.imageUrl\"\n\t\t\t\t\t\tref=\"userSelector\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor_action-btn\"\n\t\t\t\t\t>\n\t\t\t\t\t</TodoEditorResponsibleUserSelector>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</label>\n\t`\n};\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import { FileUploader as TodoEditorFileUploader } from 'crm.activity.file-uploader';\nimport {\n\tCalendar as SettingsPopupCalendar,\n\tSettingsPopup as TodoEditorSettingsPopup,\n} from 'crm.activity.settings-popup';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { ajax as Ajax, Dom, Loc, Reflection, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { UI } from 'ui.notification';\nimport { BitrixVue } from 'ui.vue3';\nimport { TodoEditor as TodoEditorComponent } from './components/todo-editor';\nimport { TodoEditorBorderColor } from './enums/border-color';\n\nimport './todo-editor.css';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\tcurrentUser?: Object,\n\tpingSettings?: Object,\n\townerTypeId: number,\n\tborderColor: string,\n\tenableCalendarSync: boolean,\n\tpopupMode: boolean,\n};\n\ntype TodoEditorAdditionalButton = {\n\tid: string,\n\ticon: string,\n\tdescription: string,\n\taction: () => {},\n}\n\nexport type SectionSettings = {\n\tid: string,\n\tactive: boolean,\n\tcomponent: Object,\n\tparams: Object,\n}\n\nexport const TodoEditorMode = {\n\tADD: 'add',\n\tUPDATE: 'update',\n}\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditor\n{\n/**\n * @event onFocus\n * @event onChangeDescription\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#mode: String = TodoEditorMode.ADD;\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#currentUser: Object = null;\n\t#pingSettings: Object = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\t#activityId: Number = null;\n\t#eventEmitter: EventEmitter = null;\n\t#fileUploader: TodoEditorFileUploader = null;\n\t#settingsPopup: TodoEditorSettingsPopup = null;\n\t#settings: Object = {};\n\t#enableCalendarSync: boolean = false;\n\t#popupMode: boolean = false;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor =\n\t\t\tthis.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditor.BorderColor.DEFAULT\n\t\t;\n\t\tDom.addClass(this.#container, this.#getClassname());\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new Error('OwnerTypeId must be set');\n\t\t}\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new Error('OwnerId must be set');\n\t\t}\n\t\tthis.#ownerId = params.ownerId;\n\n\t\tif (!Type.isObjectLike(params.currentUser))\n\t\t{\n\t\t\tthrow new Error('Current user must be set');\n\t\t}\n\t\tthis.#currentUser = params.currentUser;\n\n\t\tif (!Type.isObjectLike(params.pingSettings) || Object.keys(params.pingSettings).length === 0)\n\t\t{\n\t\t\tthrow new Error('Ping settings must be set');\n\t\t}\n\t\tthis.#pingSettings = params.pingSettings || {};\n\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription) ? params.defaultDescription : this.#getDefaultDescription();\n\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tthis.#eventEmitter = new EventEmitter;\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tfor (const eventName in params.events)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName])\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#enableCalendarSync = Type.isBoolean(params.enableCalendarSync) ? params.enableCalendarSync : false;\n\t\tthis.#popupMode = Type.isBoolean(params.popupMode) ? params.popupMode : false;\n\t}\n\n\tsetMode(mode: String): self\n\t{\n\t\tif (!Object.values(TodoEditorMode).some(value => value === mode) )\n\t\t{\n\t\t\tthrow new Error(`Unknown TodoEditor mode ${mode}`);\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\tadditionalButtons: this.#getAdditionalButtons(),\n\t\t\tpopupMode: this.#popupMode,\n\t\t\tcurrentUser: this.#currentUser,\n\t\t\tpingSettings: this.#pingSettings\n\t\t});\n\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\t#getAdditionalButtons(): ReadonlyArray<TodoEditorAdditionalButton>\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.#enableCalendarSync)\n\t\t{\n\t\t\tbuttons.push(this.#getSettingsButton());\n\t\t}\n\n\t\tbuttons.push(this.#getFileUploaderButton());\n\n\t\treturn buttons;\n\t}\n\n\t#getSettingsButton(): TodoEditorAdditionalButton\n\t{\n\t\treturn {\n\t\t\tid: 'settings',\n\t\t\ticon: 'settings',\n\t\t\tdescription: Loc.getMessage('CRM_ACTIVITY_TODO_SETTINGS_BUTTON_HINT'),\n\t\t\taction: this.#onSettingsButtonClick.bind(this),\n\t\t}\n\t}\n\n\t#onSettingsButtonClick(): void\n\t{\n\t\tif (!this.#settingsPopup)\n\t\t{\n\t\t\tthis.#settingsPopup = new TodoEditorSettingsPopup({\n\t\t\t\tonSettingsChange: this.onSettingsChange.bind(this),\n\t\t\t\tsections: this.#getSectionSettings(),\n\t\t\t\tsettings: this.#settings,\n\t\t\t});\n\t\t}\n\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#settingsPopup.syncSettings(this.#layoutComponent.getData());\n\t\t}\n\n\t\tthis.#settingsPopup.show();\n\t}\n\n\tonSettingsChange(settings: Object): void\n\t{\n\t\tthis.setSettings(settings);\n\n\t\tif (settings?.calendar)\n\t\t{\n\t\t\tthis.setDeadlineFromTimestamp(settings['calendar'].from);\n\t\t}\n\t}\n\n\tsetSettings(settings: Object = {}): void\n\t{\n\t\tthis.#settings = settings;\n\t}\n\n\t#getSettingsSection(name: String): ?Object\n\t{\n\t\treturn (this.#settings[name] || null);\n\t}\n\n\t#getFileUploaderButton(): TodoEditorAdditionalButton\n\t{\n\t\treturn {\n\t\t\tid: 'file-uploader',\n\t\t\ticon: 'attach',\n\t\t\tdescription: Loc.getMessage('CRM_ACTIVITY_TODO_UPLOAD_FILE_BUTTON_HINT'),\n\t\t\taction: this.#onFileUploadButtonClick.bind(this),\n\t\t}\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#getSaveActionData().then(data => {\n\t\t\t\tAjax\n\t\t\t\t\t.runAction(this.#getSaveActionPath(), { data })\n\t\t\t\t\t.then(resolve)\n\t\t\t\t\t.catch(reject)\n\t\t\t\t;\n\t\t\t})\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t//so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\t#getSaveActionData(): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tthis.#getSaveActionDataSettings().then(settings => {\n\t\t\t\tconst userData = this.#layoutComponent.getData();\n\t\t\t\tconst data = {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tresponsibleId: userData.responsibleUserId,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId,\n\t\t\t\t\tfileTokens: this.#fileUploader ? this.#fileUploader.getServerFileIds() : [],\n\t\t\t\t\tsettings,\n\t\t\t\t\tpingOffsets: userData.pingOffsets,\n\t\t\t\t}\n\n\t\t\t\tif (this.#mode === TodoEditorMode.UPDATE)\n\t\t\t\t{\n\t\t\t\t\tdata.id = this.#activityId;\n\t\t\t\t}\n\n\t\t\t\tresolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\t#getSaveActionPath(): String\n\t{\n\t\treturn (this.#mode === TodoEditorMode.ADD ? 'crm.activity.todo.add' : 'crm.activity.todo.update');\n\t}\n\n\t#getSaveActionDataSettings(): Promise\n\t{\n\t\tif (this.#settingsPopup)\n\t\t{\n\t\t\treturn this.#syncAndGetSaveActionDataSettingsFromPopup();\n\t\t}\n\n\t\treturn this.#getSaveActionDefaultDataSettings();\n\t}\n\n\t#syncAndGetSaveActionDataSettingsFromPopup(): Promise\n\t{\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#settingsPopup.syncSettings(this.#layoutComponent.getData());\n\t\t}\n\n\t\t// must first work out vue reactivity in nested components\n\t\treturn new Promise(resolve => {\n\t\t\tsetTimeout(()=>{\n\t\t\t\tresolve(this.#settingsPopup.getSettings());\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\t#getSaveActionDefaultDataSettings(): Promise\n\t{\n\t\tconst result = [];\n\n\t\tthis.#getSectionSettings().forEach(section => {\n\t\t\tif (!section.active)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst sectionSettings = section.params;\n\t\t\tsectionSettings.id = section.id;\n\t\t\tresult.push(sectionSettings);\n\t\t});\n\n\t\treturn Promise.resolve(result);\n\t}\n\n\t#getSectionSettings(): ReadonlyArray<SectionSettings>\n\t{\n\t\tconst calendar = {\n\t\t\tid: SettingsPopupCalendar.methods.getId(),\n\t\t\tcomponent: SettingsPopupCalendar,\n\t\t};\n\n\t\tif (this.#settingsPopup)\n\t\t{\n\t\t\tconst settings = this.#settingsPopup.getSettings();\n\t\t\tif (settings.calendar)\n\t\t\t{\n\t\t\t\tconst calendarSettings = settings.calendar;\n\t\t\t\tcalendar.params = {\n\t\t\t\t\tfrom: calendarSettings.from,\n\t\t\t\t\tto: calendarSettings.to,\n\t\t\t\t\tduration: calendarSettings.duration,\n\t\t\t\t}\n\t\t\t\tcalendar.active = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!calendar.params)\n\t\t{\n\t\t\tcalendar.params = this.#getDefaultCalendarParams();\n\t\t\tcalendar.active = false;\n\t\t}\n\n\t\treturn [\n\t\t\tcalendar,\n\t\t];\n\t}\n\n\t#getDefaultCalendarParams(): Object\n\t{\n\t\tconst fromDate = this.getDeadline() || this.#deadline;\n\t\tconst from = fromDate.getTime() / 1000;\n\t\tconst duration = 3600;\n\t\tconst to = from + duration;\n\n\t\treturn  {\n\t\t\tfrom,\n\t\t\tduration,\n\t\t\tto,\n\t\t}\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent?.getData()['deadline'] ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent?.getData()['description'] ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): self\n\t{\n\t\tthis.#parentActivityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetActivityId(activityId: Number): self\n\t{\n\t\tthis.#activityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetDeadline(deadLine: String): self\n\t{\n\t\tconst value = DateTimeFormat.parse(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetDeadlineFromTimestamp(timestamp: Number): self\n\t{\n\t\tconst value = new Date(timestamp * 1000);\n\t\tthis.#layoutComponent.setDeadline(value);\n\t\tthis.#deadline = value;\n\n\t\treturn this;\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): self\n\t{\n\t\tlet defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(this.#deadline);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tsetDescription(description: String): self\n\t{\n\t\tthis.#layoutComponent.setDescription(description);\n\n\t\treturn this;\n\t}\n\n\tclearValue(): Promise\n\t{\n\t\tthis.#layoutComponent.clearDescription();\n\t\tthis.#parentActivityId = null;\n\n\t\treturn this.#clearData();\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\n\t\treturn this.#clearData();\n\t}\n\n\t#clearData(): Promise\n\t{\n\t\tthis.setDefaultDeadLine();\n\t\tthis.#layoutComponent.resetPingOffsetsToDefault();\n\t\tthis.#layoutComponent.resetResponsibleUserToDefault();\n\n\t\tDom.removeClass(this.#container, '--is-edit');\n\t\tif (this.#fileUploader)\n\t\t{\n\t\t\tDom.removeClass(this.#fileUploader.getContainer(), '--is-displayed');\n\t\t}\n\n\t\tthis.#fileUploader = null;\n\t\tthis.#settingsPopup = null;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onChangeDescription(description): void\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription\n\t\t\t},\n\t\t});\n\n\t\tthis.#eventEmitter.emit('onChangeDescription', event);\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditor.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor --border-${this.#borderColor}`;\n\t}\n\n\t#onFileUploadButtonClick(): void\n\t{\n\t\tthis.initFileUploader();\n\t}\n\n\tsetStorageElementIds(ids: Array): void\n\t{\n\t\tthis.initFileUploader(ids);\n\t}\n\n\tinitFileUploader(files: Array = []): void\n\t{\n\t\tif (!this.#fileUploader)\n\t\t{\n\t\t\tthis.#fileUploader = new TodoEditorFileUploader({\n\t\t\t\tbaseContainer: this.#container,\n\t\t\t\tevents: {\n\t\t\t\t\t'File:onRemove': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t'onUploadStart': (event) => {\n\t\t\t\t\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t\t\t\t\t},\n\t\t\t\t\t// TODO: not implemented yet\n\t\t\t\t\t//\t\t'File:onComplete'\n\t\t\t\t\t//\t\t'onUploadComplete'\n\t\t\t\t},\n\t\t\t\townerId: this.#ownerId,\n\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\tactivityId: this.#activityId,\n\t\t\t\tfiles,\n\t\t\t});\n\t\t}\n\n\t\tconst fileUploaderContainer = this.#fileUploader.getContainer();\n\t\tconst displayedClass = '--is-displayed';\n\n\t\tif (files && !Dom.hasClass(fileUploaderContainer, displayedClass))\n\t\t{\n\t\t\tDom.addClass(fileUploaderContainer, displayedClass);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(fileUploaderContainer, displayedClass);\n\t\t}\n\n\t\tthis.#eventEmitter.emit('onChangeUploaderContainerSize');\n\t}\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Activity');\n\nnamespace.TodoEditor = TodoEditor;\n"],"names":["TodoEditorActionBtn","props","icon","type","String","required","default","action","Function","description","data","popup","computed","iconClassname","methods","onMouseEnter","event","Popup","content","bindElement","target","darkMode","setTimeout","show","onMouseLeave","close","onButtonClick","call","template","TodoEditorActionDelimiter","className","TodoEditorPingSelector","valuesList","Array","selectedValues","getValue","itemSelector","setValue","values","mounted","ItemSelector","$el","TodoEditorResponsibleUserSelector","userId","Number","userName","imageUrl","isTickFlipped","userAvatarUrl","userIconClassName","tickIconClassName","userIconStyles","backgroundImage","encodeURI","Text","encode","backgroundSize","onDialogShow","onDialogHide","onSelectUser","selectedItem","getData","item","getDialog","getSelectedItems","getAvatar","$Bitrix","eventEmitter","emit","Events","EVENT_RESPONSIBLE_USER_CHANGE","responsibleUserId","getId","onDeselectUser","selectedItems","userSelectorDialog","length","hide","showUserDialog","resetToDefault","defaultUserItem","getItem","id","entityId","select","Dialog","targetNode","$refs","userSelector","context","multiple","dropdownMode","showAvatars","enableSearch","width","zIndex","entities","preselectedItems","undeselectedItems","events","TEXTAREA_MAX_HEIGHT","TodoEditor","components","onFocus","onChangeDescription","onSaveHotkeyPressed","deadline","Date","defaultDescription","additionalButtons","popupMode","Boolean","currentUser","Object","pingSettings","currentDeadline","pingOffsets","showFileUploader","isTextareaToLong","wasUsed","deadlineFormatted","converter","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","watch","Dom","style","textarea","$nextTick","currentTextareaHeight","scrollHeight","clearDescription","setDescription","onTextareaFocus","onTextareaKeydown","keyCode","isMacCtrlKeydown","Browser","isMac","metaKey","altKey","ctrlKey","setTextareaFocused","focus","onDeadlineClick","BX","calendar","node","bTime","bHideTime","bSetFocus","value","DateTimeFormat","format","getSiteDateTimeFormat","callback","setDeadline","bind","newDeadline","onResponsibleUserChange","setResponsibleUserId","setPingOffsets","offsets","resetPingOffsetsToDefault","pingSelector","resetResponsibleUserToDefault","onTextareaInput","subscribe","beforeUnmount","unsubscribe","TodoEditorBorderColor","TodoEditorMode","ADD","UPDATE","params","Type","isDomNode","container","Error","borderColor","BorderColor","DEFAULT","addClass","isNumber","ownerTypeId","ownerId","isObjectLike","keys","isString","isDate","setDefaultDeadLine","EventEmitter","setEventNamespace","isObject","eventName","isFunction","isBoolean","enableCalendarSync","mode","some","BitrixVue","createApp","TodoEditorComponent","mount","settings","setSettings","setDeadlineFromTimestamp","from","Promise","resolve","reject","then","Ajax","runAction","catch","response","UI","Notification","Center","notify","errors","message","autoHideDelay","finally","activityId","deadLine","parse","timestamp","isNeedUpdateLayout","defaultDate","parseDate","Loc","getMessage","setMinutes","setTime","getTime","ids","initFileUploader","files","TodoEditorFileUploader","baseContainer","fileUploaderContainer","getContainer","displayedClass","hasClass","toggleClass","buttons","push","TodoEditorSettingsPopup","onSettingsChange","sections","syncSettings","userData","responsibleId","parentActivityId","fileTokens","getServerFileIds","getSettings","result","forEach","section","active","sectionSettings","SettingsPopupCalendar","component","calendarSettings","to","duration","fromDate","getDeadline","removeClass","messagePhrase","CrmEntityType","enumeration","deal","BaseEvent","toUpperCase","namespace","Reflection"],"mappings":"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"}