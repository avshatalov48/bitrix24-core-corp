{"version":3,"file":"todo-notification-skip.bundle.js","sources":["../src/todo-notification-skip.js"],"sourcesContent":["import {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ajax as Ajax, Loc, Type} from \"main.core\";\nimport {UI} from \"ui.notification\";\n\ndeclare type TodoNotificationSkipParams = {\n\tentityTypeId: number,\n\tonSkippedPeriodChange: ?function,\n};\n\nexport class TodoNotificationSkip\n{\n\t#entityTypeId: number = null;\n\t#onSkippedPeriodChange: ?function = null;\n\n\tconstructor(params: TodoNotificationSkipParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#onSkippedPeriodChange = params.onSkippedPeriodChange;\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('onLocalStorageSet', this.#onExternalEvent.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.Activity.TodoNotification:SetSkipPeriod', this.#onSetSkipPeriod.bind(this));\n\t}\n\n\t#onExternalEvent(event: BaseEvent): void\n\t{\n\t\tconst [data] = event.getData();\n\n\t\tif (data.key === 'BX.Crm.onCrmEntityTodoNotificationSkip')\n\t\t{\n\t\t\tconst eventParams = data.value;\n\t\t\tif (eventParams.entityTypeId === this.#entityTypeId)\n\t\t\t{\n\t\t\t\tthis.#onSkippedPeriodChangeCallback(eventParams.period);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onSetSkipPeriod(event: BaseEvent): void\n\t{\n\t\tthis.#onSkippedPeriodChangeCallback(event.getData().period);\n\t}\n\n\t#onSkippedPeriodChangeCallback(period: string)\n\t{\n\t\tif (Type.isFunction(this.#onSkippedPeriodChange))\n\t\t{\n\t\t\tthis.#onSkippedPeriodChange(period);\n\t\t}\n\t}\n\n\tsaveSkippedPeriod(skippedPeriod: string): Promise\n\t{\n\t\tBX.localStorage.set(\n\t\t\t'BX.Crm.onCrmEntityTodoNotificationSkip',\n\t\t\t{\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tperiod: skippedPeriod\n\t\t\t},\n\t\t\t5\n\t\t);\n\n\t\tEventEmitter.emit('BX.Crm.Activity.TodoNotification:SetSkipPeriod', {\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tperiod: skippedPeriod,\n\t\t});\n\n\t\treturn Ajax.runAction('crm.activity.todo.skipEntityDetailsNotification', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tperiod: skippedPeriod,\n\t\t\t}\n\t\t}).then(() => {\n\t\t\treturn skippedPeriod;\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors.map(item => item.message).join(', '),\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCancelPeriodNotification()\n\t{\n\t\tconst self = this;\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCELED_TEXT'),\n\t\t\tautoHideDelay: 3000,\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCELED_BUTTON'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: function(event, balloon, action) {\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\tself.saveSkippedPeriod('');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n}\n"],"names":["TodoNotificationSkip","constructor","params","entityTypeId","onSkippedPeriodChange","saveSkippedPeriod","skippedPeriod","BX","localStorage","set","period","EventEmitter","emit","Ajax","runAction","data","then","catch","response","UI","Notification","Center","notify","content","errors","map","item","message","join","autoHideDelay","showCancelPeriodNotification","self","Loc","getMessage","actions","title","events","click","event","balloon","action","close","subscribe","bind","getData","key","eventParams","value","Type","isFunction"],"mappings":";;;;;CAEmC;CAAA;CAAA;CAAA;CAAA;CAAA;AAOnC,CAAO,MAAMA,oBAAoB,CACjC;GAICC,WAAW,CAACC,MAAkC,EAC9C;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJwB;;KAAI;OAAA;OAAA,OACQ;;KAInC,4CAAI,kCAAiBA,MAAM,CAACC,YAAY;KACxC,4CAAI,oDAA0BD,MAAM,CAACE,qBAAqB;KAE1D,4CAAI;;GAoCLC,iBAAiB,CAACC,aAAqB,EACvC;KACCC,EAAE,CAACC,YAAY,CAACC,GAAG,CAClB,wCAAwC,EACxC;OACCN,YAAY,0CAAE,IAAI,+BAAc;OAChCO,MAAM,EAAEJ;MACR,EACD,CAAC,CACD;KAEDK,6BAAY,CAACC,IAAI,CAAC,gDAAgD,EAAE;OACnET,YAAY,0CAAE,IAAI,+BAAc;OAChCO,MAAM,EAAEJ;MACR,CAAC;KAEF,OAAOO,cAAI,CAACC,SAAS,CAAC,iDAAiD,EAAE;OACxEC,IAAI,EAAE;SACLZ,YAAY,0CAAE,IAAI,+BAAc;SAChCO,MAAM,EAAEJ;;MAET,CAAC,CAACU,IAAI,CAAC,MAAM;OACb,OAAOV,aAAa;MACpB,CAAC,CAACW,KAAK,CAAEC,QAAQ,IAAK;OACtBC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7BC,OAAO,EAAEL,QAAQ,CAACM,MAAM,CAACC,GAAG,CAACC,IAAI,IAAIA,IAAI,CAACC,OAAO,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;SAC7DC,aAAa,EAAE;QACf,CAAC;MACF,CAAC;;GAGHC,4BAA4B,GAC5B;KACC,MAAMC,IAAI,GAAG,IAAI;KACjBZ,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAC7BC,OAAO,EAAES,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;OACvEJ,aAAa,EAAE,IAAI;OACnBK,OAAO,EAAE,CAAC;SACTC,KAAK,EAAEH,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;SACvEG,MAAM,EAAE;WACPC,KAAK,EAAE,UAASC,KAAK,EAAEC,OAAO,EAAEC,MAAM,EAAE;aACvCD,OAAO,CAACE,KAAK,EAAE;aACfV,IAAI,CAAC1B,iBAAiB,CAAC,EAAE,CAAC;;;QAG5B;MACD,CAAC;;CAEJ;CAAC,wBAhFA;GACCM,6BAAY,CAAC+B,SAAS,CAAC,mBAAmB,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7EhC,6BAAY,CAAC+B,SAAS,CAAC,gDAAgD,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI,CAAC,CAAC;CAC3G;CAAC,2BAEgBL,KAAgB,EACjC;GACC,MAAM,CAACvB,IAAI,CAAC,GAAGuB,KAAK,CAACM,OAAO,EAAE;GAE9B,IAAI7B,IAAI,CAAC8B,GAAG,KAAK,wCAAwC,EACzD;KACC,MAAMC,WAAW,GAAG/B,IAAI,CAACgC,KAAK;KAC9B,IAAID,WAAW,CAAC3C,YAAY,6CAAK,IAAI,+BAAc,EACnD;OACC,4CAAI,kEAAgC2C,WAAW,CAACpC,MAAM;;;CAGzD;CAAC,2BAEgB4B,KAAgB,EACjC;GACC,4CAAI,kEAAgCA,KAAK,CAACM,OAAO,EAAE,CAAClC,MAAM;CAC3D;CAAC,yCAE8BA,MAAc,EAC7C;GACC,IAAIsC,cAAI,CAACC,UAAU,yCAAC,IAAI,kDAAwB,EAChD;KACC,4CAAI,kDAAwBvC,MAAM;;CAEpC;;;;;;;;"}