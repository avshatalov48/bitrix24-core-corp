{"version":3,"file":"todo-notification-skip.bundle.js","sources":["../src/todo-notification-skip.js"],"sourcesContent":["import {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ajax as Ajax, Loc, Type} from \"main.core\";\nimport {UI} from \"ui.notification\";\n\ndeclare type TodoNotificationSkipParams = {\n\tentityTypeId: number,\n\tonSkippedPeriodChange: ?function,\n};\n\nexport class TodoNotificationSkip\n{\n\t#entityTypeId: number = null;\n\t#onSkippedPeriodChange: ?function = null;\n\n\tconstructor(params: TodoNotificationSkipParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#onSkippedPeriodChange = params.onSkippedPeriodChange;\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('onLocalStorageSet', this.#onExternalEvent.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.Activity.TodoNotification:SetSkipPeriod', this.#onSetSkipPeriod.bind(this));\n\t}\n\n\t#onExternalEvent(event: BaseEvent): void\n\t{\n\t\tconst [data] = event.getData();\n\n\t\tif (data.key === 'BX.Crm.onCrmEntityTodoNotificationSkip')\n\t\t{\n\t\t\tconst eventParams = data.value;\n\t\t\tif (eventParams.entityTypeId === this.#entityTypeId)\n\t\t\t{\n\t\t\t\tthis.#onSkippedPeriodChangeCallback(eventParams.period);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onSetSkipPeriod(event: BaseEvent): void\n\t{\n\t\tthis.#onSkippedPeriodChangeCallback(event.getData().period);\n\t}\n\n\t#onSkippedPeriodChangeCallback(period: string)\n\t{\n\t\tif (Type.isFunction(this.#onSkippedPeriodChange))\n\t\t{\n\t\t\tthis.#onSkippedPeriodChange(period);\n\t\t}\n\t}\n\n\tsaveSkippedPeriod(skippedPeriod: string): Promise\n\t{\n\t\tBX.localStorage.set(\n\t\t\t'BX.Crm.onCrmEntityTodoNotificationSkip',\n\t\t\t{\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tperiod: skippedPeriod\n\t\t\t},\n\t\t\t5\n\t\t);\n\n\t\tEventEmitter.emit('BX.Crm.Activity.TodoNotification:SetSkipPeriod', {\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tperiod: skippedPeriod,\n\t\t});\n\n\t\treturn Ajax.runAction('crm.activity.todo.skipEntityDetailsNotification', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tperiod: skippedPeriod,\n\t\t\t}\n\t\t}).then(() => {\n\t\t\treturn skippedPeriod;\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors.map(item => item.message).join(', '),\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCancelPeriodNotification()\n\t{\n\t\tconst self = this;\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCELED_TEXT'),\n\t\t\tautoHideDelay: 3000,\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCELED_BUTTON'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: function(event, balloon, action) {\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\tself.saveSkippedPeriod('');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n}\n"],"names":["TodoNotificationSkip","constructor","params","entityTypeId","onSkippedPeriodChange","saveSkippedPeriod","skippedPeriod","BX","localStorage","set","period","EventEmitter","emit","Ajax","runAction","data","then","catch","response","UI","Notification","Center","notify","content","errors","map","item","message","join","autoHideDelay","showCancelPeriodNotification","self","Loc","getMessage","actions","title","events","click","event","balloon","action","close","subscribe","bind","getData","key","eventParams","value","Type","isFunction"],"mappings":";;;;;;;;;;;;;;;;;AASA,CAAO,MAAMA,oBAAN,CACP;GAICC,WAAW,CAACC,MAAD,EACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJwB;;KAIxB;OAAA;OAAA,OAHoC;;KAInC,8EAAqBA,MAAM,CAACC,YAA5B;KACA,gGAA8BD,MAAM,CAACE,qBAArC;;KAEA;;;GAoCDC,iBAAiB,CAACC,aAAD,EACjB;KACCC,EAAE,CAACC,YAAH,CAAgBC,GAAhB,CACC,wCADD,EAEC;OACCN,YAAY,0CAAE,IAAF,+BADb;OAECO,MAAM,EAAEJ;MAJV,EAMC,CAND;KASAK,6BAAY,CAACC,IAAb,CAAkB,gDAAlB,EAAoE;OACnET,YAAY,0CAAE,IAAF,+BADuD;OAEnEO,MAAM,EAAEJ;MAFT;KAKA,OAAOO,cAAI,CAACC,SAAL,CAAe,iDAAf,EAAkE;OACxEC,IAAI,EAAE;SACLZ,YAAY,0CAAE,IAAF,+BADP;SAELO,MAAM,EAAEJ;;MAHH,EAKJU,IALI,CAKC,MAAM;OACb,OAAOV,aAAP;MANM,EAOJW,KAPI,CAOGC,QAAD,IAAc;OACtBC,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;SAC7BC,OAAO,EAAEL,QAAQ,CAACM,MAAT,CAAgBC,GAAhB,CAAoBC,IAAI,IAAIA,IAAI,CAACC,OAAjC,EAA0CC,IAA1C,CAA+C,IAA/C,CADoB;SAE7BC,aAAa,EAAE;QAFhB;MARM,CAAP;;;GAeDC,4BAA4B,GAC5B;KACC,MAAMC,IAAI,GAAG,IAAb;KACAZ,kBAAE,CAACC,YAAH,CAAgBC,MAAhB,CAAuBC,MAAvB,CAA8B;OAC7BC,OAAO,EAAES,aAAG,CAACC,UAAJ,CAAe,8CAAf,CADoB;OAE7BJ,aAAa,EAAE,IAFc;OAG7BK,OAAO,EAAE,CAAC;SACTC,KAAK,EAAEH,aAAG,CAACC,UAAJ,CAAe,gDAAf,CADE;SAETG,MAAM,EAAE;WACPC,KAAK,EAAE,UAASC,KAAT,EAAgBC,OAAhB,EAAyBC,MAAzB,EAAiC;aACvCD,OAAO,CAACE,KAAR;aACAV,IAAI,CAAC1B,iBAAL,CAAuB,EAAvB;;;QALM;MAHV;;;CA/EF;;yBAaC;GACCM,6BAAY,CAAC+B,SAAb,CAAuB,mBAAvB,EAA4C,kFAAsBC,IAAtB,CAA2B,IAA3B,CAA5C;GACAhC,6BAAY,CAAC+B,SAAb,CAAuB,gDAAvB,EAAyE,kFAAsBC,IAAtB,CAA2B,IAA3B,CAAzE;CACA;;4BAEgBL,OACjB;GACC,MAAM,CAACvB,IAAD,IAASuB,KAAK,CAACM,OAAN,EAAf;;GAEA,IAAI7B,IAAI,CAAC8B,GAAL,KAAa,wCAAjB,EACA;KACC,MAAMC,WAAW,GAAG/B,IAAI,CAACgC,KAAzB;;KACA,IAAID,WAAW,CAAC3C,YAAZ,6CAA6B,IAA7B,+BAAJ,EACA;OACC,8GAAoC2C,WAAW,CAACpC,MAAhD;;;CAGF;;4BAEgB4B,OACjB;GACC,8GAAoCA,KAAK,CAACM,OAAN,GAAgBlC,MAApD;CACA;;0CAE8BA,QAC/B;GACC,IAAIsC,cAAI,CAACC,UAAL,yCAAgB,IAAhB,kDAAJ,EACA;KACC,8FAA4BvC,MAA5B;;CAED;;;;;;;;"}