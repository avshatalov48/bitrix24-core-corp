{"version":3,"file":"file-uploader.bundle.js","sources":["../src/file-uploader.js"],"sourcesContent":["import { Dom, Tag, Type } from 'main.core';\nimport { TileWidget } from 'ui.uploader.tile-widget';\n\nimport type { FileUploaderOptions } from './file-uploader-options';\n\nimport 'ui.design-tokens';\nimport './file-uploader.css';\n\nconst MAX_UPLOAD_FILE_SIZE = 1024 * 1024 * 50; // 50M;\n\nexport class FileUploader\n{\n\t#container: ?HTMLElement = null;\n\t#widget: ?TileWidget = null;\n\n\tconstructor(params: FileUploaderOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#widget = new TileWidget({\n\t\t\tcontroller: 'crm.fileUploader.todoActivityUploaderController',\n\t\t\tcontrollerOptions: {\n\t\t\t\tentityId: params.ownerId,\n\t\t\t\tentityTypeId: params.ownerTypeId,\n\t\t\t\tactivityId: params.activityId\n\t\t\t},\n\t\t\tfiles: Type.isArrayFilled(params.files) ? params.files : [],\n\t\t\tevents: Type.isPlainObject(params.events) ? params.events : {},\n\t\t\tmultiple: true,\n\t\t\tautoUpload: true,\n\t\t\tmaxFileSize: MAX_UPLOAD_FILE_SIZE\n\t\t});\n\n\t\tif (Type.isDomNode(params.baseContainer))\n\t\t{\n\t\t\tthis.#container = Tag.render`<div class=\"crm-activity__todo-editor-file-uploader-wrapper\"></div>`;\n\n\t\t\tconst baseContainer = params.baseContainer;\n\n\t\t\tDom.insertAfter(this.#container, baseContainer);\n\n\t\t\tthis.#widget.renderTo(this.#container);\n\t\t}\n\t}\n\n\tgetWidget(): TileWidget\n\t{\n\t\treturn this.#widget;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\trenderTo(container: HTMLElement): void\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('FileUploader container must be a DOM Node');\n\t\t}\n\n\t\tthis.#container = container;\n\t\tthis.#widget.renderTo(container);\n\t}\n\n\tgetFiles(): Array\n\t{\n\t\treturn this.#widget.getUploader().getFiles();\n\t}\n\n\tgetServerFileIds(): Array\n\t{\n\t\tconst files = this.#widget.getUploader().getFiles();\n\t\tif (files.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst completedFiles = files.filter(file => file.isComplete());\n\t\tif (completedFiles.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn completedFiles.map(file => file.getServerId());\n\t}\n\n\t#assertValidParams(params: FileUploaderOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Activity.FileUploader: The \"params\" argument must be object.');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Activity.FileUploader: The \"ownerId\" argument must be set.');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Activity.FileUploader: The \"ownerTypeId\" argument must be set.');\n\t\t}\n\t}\n}\n"],"names":["MAX_UPLOAD_FILE_SIZE","FileUploader","constructor","params","TileWidget","controller","controllerOptions","entityId","ownerId","entityTypeId","ownerTypeId","activityId","files","Type","isArrayFilled","events","isPlainObject","multiple","autoUpload","maxFileSize","isDomNode","baseContainer","Tag","render","Dom","insertAfter","renderTo","getWidget","getContainer","container","Error","getFiles","getUploader","getServerFileIds","length","completedFiles","filter","file","isComplete","map","getServerId","isNumber"],"mappings":";;;;;;;AAAA,CAQA,MAAMA,oBAAoB,GAAG,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;CAAC;CAAA;CAAA;AAE/C,CAAO,MAAMC,YAAY,CACzB;GAICC,WAAW,CAACC,OAA2B,EACvC;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJ2B;;KAAI;OAAA;OAAA,OACR;;KAItB,4CAAI,0CAAoBA,OAAM;KAE9B,4CAAI,sBAAW,IAAIC,iCAAU,CAAC;OAC7BC,UAAU,EAAE,iDAAiD;OAC7DC,iBAAiB,EAAE;SAClBC,QAAQ,EAAEJ,OAAM,CAACK,OAAO;SACxBC,YAAY,EAAEN,OAAM,CAACO,WAAW;SAChCC,UAAU,EAAER,OAAM,CAACQ;QACnB;OACDC,KAAK,EAAEC,cAAI,CAACC,aAAa,CAACX,OAAM,CAACS,KAAK,CAAC,GAAGT,OAAM,CAACS,KAAK,GAAG,EAAE;OAC3DG,MAAM,EAAEF,cAAI,CAACG,aAAa,CAACb,OAAM,CAACY,MAAM,CAAC,GAAGZ,OAAM,CAACY,MAAM,GAAG,EAAE;OAC9DE,QAAQ,EAAE,IAAI;OACdC,UAAU,EAAE,IAAI;OAChBC,WAAW,EAAEnB;MACb,CAAC;KAEF,IAAIa,cAAI,CAACO,SAAS,CAACjB,OAAM,CAACkB,aAAa,CAAC,EACxC;OACC,4CAAI,4BAAcC,aAAG,CAACC,MAAM,cAAC,qEAAmE,EAAC;OAEjG,MAAMF,aAAa,GAAGlB,OAAM,CAACkB,aAAa;OAE1CG,aAAG,CAACC,WAAW,yCAAC,IAAI,2BAAaJ,aAAa,CAAC;OAE/C,4CAAI,oBAASK,QAAQ,yCAAC,IAAI,0BAAY;;;GAIxCC,SAAS,GACT;KACC,+CAAO,IAAI;;GAGZC,YAAY,GACZ;KACC,+CAAO,IAAI;;GAGZF,QAAQ,CAACG,SAAsB,EAC/B;KACC,IAAI,CAAChB,cAAI,CAACO,SAAS,CAACS,SAAS,CAAC,EAC9B;OACC,MAAM,IAAIC,KAAK,CAAC,2CAA2C,CAAC;;KAG7D,4CAAI,4BAAcD,SAAS;KAC3B,4CAAI,oBAASH,QAAQ,CAACG,SAAS,CAAC;;GAGjCE,QAAQ,GACR;KACC,OAAO,4CAAI,oBAASC,WAAW,EAAE,CAACD,QAAQ,EAAE;;GAG7CE,gBAAgB,GAChB;KACC,MAAMrB,KAAK,GAAG,4CAAI,oBAASoB,WAAW,EAAE,CAACD,QAAQ,EAAE;KACnD,IAAInB,KAAK,CAACsB,MAAM,KAAK,CAAC,EACtB;OACC,OAAO,EAAE;;KAGV,MAAMC,cAAc,GAAGvB,KAAK,CAACwB,MAAM,CAACC,IAAI,IAAIA,IAAI,CAACC,UAAU,EAAE,CAAC;KAC9D,IAAIH,cAAc,CAACD,MAAM,KAAK,CAAC,EAC/B;OACC,OAAO,EAAE;;KAGV,OAAOC,cAAc,CAACI,GAAG,CAACF,IAAI,IAAIA,IAAI,CAACG,WAAW,EAAE,CAAC;;CAoBvD;CAAC,6BAjBmBrC,MAA2B,EAC9C;GACC,IAAI,CAACU,cAAI,CAACG,aAAa,CAACb,MAAM,CAAC,EAC/B;KACC,MAAM,IAAI2B,KAAK,CAAC,qEAAqE,CAAC;;GAGvF,IAAI,CAACjB,cAAI,CAAC4B,QAAQ,CAACtC,MAAM,CAACK,OAAO,CAAC,EAClC;KACC,MAAM,IAAIsB,KAAK,CAAC,mEAAmE,CAAC;;GAGrF,IAAI,CAACjB,cAAI,CAAC4B,QAAQ,CAACtC,MAAM,CAACO,WAAW,CAAC,EACtC;KACC,MAAM,IAAIoB,KAAK,CAAC,uEAAuE,CAAC;;CAE1F;;;;;;;;"}