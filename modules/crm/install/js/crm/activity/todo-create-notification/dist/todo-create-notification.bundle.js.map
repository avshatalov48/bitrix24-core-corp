{"version":3,"file":"todo-create-notification.bundle.js","sources":["../src/todo-create-notification.js"],"sourcesContent":["import {Loc, Tag} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {PopupManager, Popup} from 'main.popup';\nimport {TodoEditor} from 'crm.activity.todo-editor';\nimport {SaveButton, CancelButton, Button, ButtonColor, ButtonState} from 'ui.buttons';\nimport {TodoNotificationSkip}  from 'crm.activity.todo-notification-skip';\nimport {TodoNotificationSkipMenu}  from 'crm.activity.todo-notification-skip-menu';\n\nimport './todo-create-notification.css';\n\ndeclare type TodoCreateNotificationParams = {\n\tentityTypeId: number,\n\tentityId: number,\n\tentityStageId: string,\n\tstageIdField: string,\n\tfinalStages: Array<string>,\n\tskipPeriod: ?string,\n}\n\nconst SAVE_BUTTON_ID = 'save';\nconst CANCEL_BUTTON_ID = 'cancel';\nconst SKIP_BUTTON_ID = 'skip';\n\nexport class TodoCreateNotification\n{\n\t#timeline: ?Object = null;\n\t#entityTypeId: string = null;\n\t#entityId: string = null;\n\t#entityStageId: string = null;\n\t#stageIdField: string = null;\n\t#finalStages: Array<string> = null;\n\n\t#allowCloseSlider: boolean = false;\n\t#isSkipped: boolean = false;\n\t#popup: ?Popup = null;\n\t#toDoEditor: ?TodoEditor = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\t#skipMenu: ?TodoNotificationSkipMenu = null;\n\n\tconstructor(params: TodoCreateNotificationParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityStageId = params.entityStageId;\n\t\tthis.#stageIdField = params.stageIdField;\n\t\tthis.#finalStages = params.finalStages;\n\t\tthis.#isSkipped = !!params.skipPeriod;\n\n\t\tif (BX.CrmTimelineManager)\n\t\t{\n\t\t\tthis.#timeline = BX.CrmTimelineManager.getDefault();\n\t\t}\n\n\t\tthis.#bindEvents();\n\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t\tthis.#skipMenu = new TodoNotificationSkipMenu({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tselectedValue: params.skipPeriod,\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (this.#getSliderInstance())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.#getSliderInstance(), 'SidePanel.Slider:onClose', this.#onCloseSlider.bind(this));\n\t\t\tEventEmitter.subscribe('Crm.EntityModel.Change', this.#onEntityModelChange.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.#onEntityUpdate.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityDelete', this.#onEntityDelete.bind(this));\n\t\t}\n\t\tEventEmitter.subscribe('Crm.InterfaceToolbar.MenuBuild', this.#onToolbarMenuBuild.bind(this));\n\t}\n\n\t#getSliderInstance(): BX.SidePanel.Slider | null\n\t{\n\t\tif (top.BX && top.BX.SidePanel)\n\t\t{\n\t\t\tconst slider = top.BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t\tif (slider && slider.isOpen())\n\t\t\t{\n\t\t\t\treturn slider;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onCloseSlider(event: BaseEvent): void\n\t{\n\t\tif (this.#allowCloseSlider || this.#isSkipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getSlider() !== top.BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!sliderEvent.isActionAllowed())\n\t\t{\n\t\t\treturn; // editor has unsaved fields\n\t\t}\n\n\t\tif (!this.#timeline || this.#timeline.hasScheduledItems())\n\t\t{\n\t\t\treturn; // timeline already has scheduled activities\n\t\t}\n\n\t\tif (this.#finalStages.indexOf(this.#entityStageId) > -1)\n\t\t{\n\t\t\treturn; // element has final stage\n\t\t}\n\n\t\tsliderEvent.denyAction();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#showTodoCreationNotification();\n\t\t}, 100);\n\t}\n\n\t#onEntityUpdate(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (eventParams.hasOwnProperty('entityData') && eventParams.entityData.hasOwnProperty(this.#stageIdField))\n\t\t{\n\t\t\tthis.#entityStageId = eventParams.entityData[this.#stageIdField];\n\t\t}\n\n\t}\n\n\t#onEntityDelete(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (eventParams.hasOwnProperty('id') && eventParams.id == this.#entityId)\n\t\t{\n\t\t\tthis.#allowCloseSlider = true;\n\t\t}\n\t}\n\n\t#onEntityModelChange(event: BaseEvent): void\n\t{\n\t\tconst [model, eventParams]  = event.getCompatData();\n\n\t\tif (eventParams.fieldName === this.#stageIdField)\n\t\t{\n\t\t\tthis.#entityStageId = model.getStringField(this.#stageIdField, this.#entityStageId);\n\t\t}\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#isSkipped = !!period;\n\t}\n\n\t#onToolbarMenuBuild(event: BaseEvent): void\n\t{\n\t\tconst [, {items}] = event.getData();\n\t\titems.push({ delimiter: true });\n\t\tfor (const skipItem of this.#skipMenu.getItems())\n\t\t{\n\t\t\titems.push(skipItem);\n\t\t}\n\t}\n\n\t#onChangeDescription(event: BaseEvent): void\n\t{\n\t\tconst {description} = event.getData();\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!description.length && !saveButton.getState())\n\t\t{\n\t\t\tsaveButton.setState(ButtonState.DISABLED);\n\t\t}\n\t\telse if (description.length && saveButton.getState() === ButtonState.DISABLED)\n\t\t{\n\t\t\tsaveButton.setState(null);\n\t\t}\n\t}\n\n\t#onSaveHotkeyPressed(event: BaseEvent): void\n\t{\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!saveButton.getState()) // if save button is not disabled\n\t\t{\n\t\t\tthis.#saveTodo();\n\t\t}\n\t}\n\n\t#onSkipMenuItemSelect(period): void\n\t{\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.getMenuWindow()?.close();\n\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.WAITING);\n\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#isSkipped = !!period;\n\t\t\tthis.#skipMenu.setSelectedValue(period);\n\t\t\tthis.#revertButtonsState();\n\t\t\tthis.#allowCloseSlider = true;\n\t\t\tthis.#showCancelNotificationInParentWindow();\n\t\t\tthis.#getSliderInstance()?.close();\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#saveTodo(): void\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.WAITING);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\n\t\tthis.#toDoEditor.save().then((result) => {\n\t\t\tthis.#revertButtonsState();\n\t\t\tif (!(result.hasOwnProperty('errors') && result.errors.length))\n\t\t\t{\n\t\t\t\tthis.#allowCloseSlider = true;\n\t\t\t\tthis.#closePopup();\n\t\t\t\tthis.#getSliderInstance()?.close();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#revertButtonsState()\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(null);\n\t}\n\n\t#closePopup(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\t#closeSlider(): void\n\t{\n\t\tthis.#allowCloseSlider = true;\n\t\tthis.#getSliderInstance()?.close();\n\t}\n\n\t#showTodoCreationNotification(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tconst htmlStyles = getComputedStyle(document.documentElement);\n\t\t\tconst popupPadding = htmlStyles.getPropertyValue('--ui-space-inset-sm');\n\t\t\tconst popupPaddingNumberValue = parseFloat(popupPadding) || 12;\n\t\t\tconst popupOverlayColor = htmlStyles.getPropertyValue('--ui-color-base-solid') || '#000000';\n\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: 'todo-create-confirm-' + this.#entityTypeId + '-' + this.#entityId,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tpadding: popupPaddingNumberValue,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 40,\n\t\t\t\t\tbackgroundColor: popupOverlayColor,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getPopupContent(),\n\t\t\t\tbuttons: this.#getPopupButtons(),\n\t\t\t\twidth: 545,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.#closeSlider.bind(this)\n\t\t\t\t},\n\t\t\t\tclassName: 'crm-activity__todo-create-notification-popup'\n\t\t\t});\n\t\t}\n\n\t\tthis.#popup.show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#toDoEditor.setFocused();\n\t\t}, 10);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#popup.setClosingByEsc(true);\n\t\t}, 300);\n\t}\n\n\t#getPopupTitle(): string\n\t{\n\t\treturn Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_TITLE');\n\t}\n\n\t#getPopupDescription(): string\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION';\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst editorContainer = Tag.render`<div></div>`;\n\n\t\tconst content = Tag.render`<div class=\"crm-activity__todo-create-notification\">\n\t\t\t<div class=\"crm-activity__todo-create-notification_title\">${this.#getPopupTitle()}</div>\n\t\t\t<div class=\"crm-activity__todo-create-notification_content\">\n\t\t\t\t<div class=\"crm-activity__todo-create-notification_description\">${this.#getPopupDescription()}</div>\n\t\t\t\t${editorContainer}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis.#toDoEditor = new TodoEditor({\n\t\t\tcontainer: editorContainer,\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t\tevents: {\n\t\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\t},\n\t\t\tborderColor: TodoEditor.BorderColor.PRIMARY,\n\t\t});\n\t\tthis.#toDoEditor.show();\n\n\t\treturn content;\n\t}\n\n\t#getPopupButtons(): Array<Button>\n\t{\n\t\treturn [\n\t\t\tnew SaveButton({\n\t\t\t\tid: SAVE_BUTTON_ID,\n\t\t\t\tround: true,\n\t\t\t\tstate: this.#toDoEditor.getDescription() ? null : ButtonState.DISABLED,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.#saveTodo.bind(this),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew CancelButton({\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL'),\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tid: CANCEL_BUTTON_ID,\n\t\t\t\tround: true,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.#closePopup.bind(this),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew Button({\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP'),\n\t\t\t\tcolor: ButtonColor.LINK,\n\t\t\t\tid: SKIP_BUTTON_ID,\n\t\t\t\tdropdown: true,\n\t\t\t\tmenu: {\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\titems: this.#getSkipMenuItems(),\n\t\t\t\t\tminWidth: 233,\n\t\t\t\t},\n\t\t\t}),\n\t\t]\n\t}\n\n\t#getSkipMenuItems(): Array\n\t{\n\t\tconst menuItems = [];\n\n\t\tmenuItems.push({\n\t\t\tid: 'day',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'week',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'month',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'forever',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever')\n\t\t});\n\n\t\treturn menuItems;\n\t}\n\n\t#showCancelNotificationInParentWindow()\n\t{\n\t\tif (top.BX && top.BX.Runtime)\n\t\t{\n\t\t\tconst entityTypeId = this.#entityTypeId;\n\t\t\ttop.BX.Runtime.loadExtension('crm.activity.todo-notification-skip').then((exports) => {\n\t\t\t\tconst skipProvider = new exports.TodoNotificationSkip({\n\t\t\t\t\tentityTypeId\n\t\t\t\t});\n\t\t\t\tskipProvider.showCancelPeriodNotification();\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["SAVE_BUTTON_ID","CANCEL_BUTTON_ID","SKIP_BUTTON_ID","TodoCreateNotification","constructor","params","entityTypeId","entityId","entityStageId","stageIdField","finalStages","skipPeriod","BX","CrmTimelineManager","getDefault","TodoNotificationSkip","onSkippedPeriodChange","bind","TodoNotificationSkipMenu","selectedValue","EventEmitter","subscribe","top","SidePanel","slider","Instance","getSliderByWindow","window","isOpen","event","sliderEvent","getCompatData","getSlider","isActionAllowed","hasScheduledItems","indexOf","denyAction","setTimeout","eventParams","hasOwnProperty","entityData","id","model","fieldName","getStringField","period","items","getData","push","delimiter","skipItem","getItems","description","saveButton","getButton","length","getState","setState","ButtonState","DISABLED","getMenuWindow","close","WAITING","saveSkippedPeriod","then","setSelectedValue","catch","save","result","errors","htmlStyles","getComputedStyle","document","documentElement","popupPadding","getPropertyValue","popupPaddingNumberValue","parseFloat","popupOverlayColor","PopupManager","create","closeIcon","padding","overlay","opacity","backgroundColor","content","buttons","width","events","onClose","className","show","setFocused","setClosingByEsc","Loc","getMessage","messagePhrase","CrmEntityType","enumeration","lead","deal","editorContainer","Tag","render","TodoEditor","container","ownerTypeId","ownerId","onChangeDescription","onSaveHotkeyPressed","borderColor","BorderColor","PRIMARY","SaveButton","round","state","getDescription","click","CancelButton","text","color","ButtonColor","LIGHT_BORDER","Button","LINK","dropdown","menu","closeByEsc","minWidth","menuItems","onclick","Runtime","loadExtension","exports","skipProvider","showCancelPeriodNotification"],"mappings":"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"}