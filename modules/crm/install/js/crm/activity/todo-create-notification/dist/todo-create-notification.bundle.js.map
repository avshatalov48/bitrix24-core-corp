{"version":3,"file":"todo-create-notification.bundle.js","sources":["../src/todo-create-notification.js"],"sourcesContent":["import { Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { TodoEditor } from 'crm.activity.todo-editor';\nimport { Button, ButtonColor, ButtonState, CancelButton, SaveButton } from 'ui.buttons';\nimport { TodoNotificationSkip } from 'crm.activity.todo-notification-skip';\nimport { TodoNotificationSkipMenu } from 'crm.activity.todo-notification-skip-menu';\n\nimport './todo-create-notification.css';\n\ndeclare type TodoCreateNotificationParams = {\n\tentityTypeId: number,\n\tentityId: number,\n\tentityStageId: string,\n\tstageIdField: string,\n\tfinalStages: Array<string>,\n\tskipPeriod: ?string,\n}\n\nconst SAVE_BUTTON_ID = 'save';\nconst CANCEL_BUTTON_ID = 'cancel';\nconst SKIP_BUTTON_ID = 'skip';\n\nexport class TodoCreateNotification\n{\n\t#timeline: ?Object = null;\n\t#entityTypeId: string = null;\n\t#entityId: string = null;\n\t#entityStageId: string = null;\n\t#stageIdField: string = null;\n\t#finalStages: Array<string> = null;\n\n\t#allowCloseSlider: boolean = false;\n\t#isSkipped: boolean = false;\n\t#popup: ?Popup = null;\n\t#toDoEditor: ?TodoEditor = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\t#skipMenu: ?TodoNotificationSkipMenu = null;\n\n\tconstructor(params: TodoCreateNotificationParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityStageId = params.entityStageId;\n\t\tthis.#stageIdField = params.stageIdField;\n\t\tthis.#finalStages = params.finalStages;\n\t\tthis.#isSkipped = !!params.skipPeriod;\n\n\t\tif (BX.CrmTimelineManager)\n\t\t{\n\t\t\tthis.#timeline = BX.CrmTimelineManager.getDefault();\n\t\t}\n\n\t\tthis.#bindEvents();\n\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t\tthis.#skipMenu = new TodoNotificationSkipMenu({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tselectedValue: params.skipPeriod,\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (this.#getSliderInstance())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.#getSliderInstance(), 'SidePanel.Slider:onClose', this.#onCloseSlider.bind(this));\n\t\t\tEventEmitter.subscribe('Crm.EntityModel.Change', this.#onEntityModelChange.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.#onEntityUpdate.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityDelete', this.#onEntityDelete.bind(this));\n\t\t}\n\t\tEventEmitter.subscribe('Crm.InterfaceToolbar.MenuBuild', this.#onToolbarMenuBuild.bind(this));\n\t}\n\n\t#getSliderInstance(): BX.SidePanel.Slider | null\n\t{\n\t\tif (top.BX && top.BX.SidePanel)\n\t\t{\n\t\t\tconst slider = top.BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t\tif (slider && slider.isOpen())\n\t\t\t{\n\t\t\t\treturn slider;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onCloseSlider(event: BaseEvent): void\n\t{\n\t\tif (this.#allowCloseSlider || this.#isSkipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getSlider() !== top.BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!sliderEvent.isActionAllowed())\n\t\t{\n\t\t\treturn; // editor has unsaved fields\n\t\t}\n\n\t\tif (!this.#timeline || this.#timeline.hasScheduledItems())\n\t\t{\n\t\t\treturn; // timeline already has scheduled activities\n\t\t}\n\n\t\tif (this.#finalStages.indexOf(this.#entityStageId) > -1)\n\t\t{\n\t\t\treturn; // element has final stage\n\t\t}\n\n\t\tsliderEvent.denyAction();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#showTodoCreationNotification();\n\t\t}, 100);\n\t}\n\n\t#onEntityUpdate(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (eventParams.hasOwnProperty('entityData') && eventParams.entityData.hasOwnProperty(this.#stageIdField))\n\t\t{\n\t\t\tthis.#entityStageId = eventParams.entityData[this.#stageIdField];\n\t\t}\n\n\t}\n\n\t#onEntityDelete(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (eventParams.hasOwnProperty('id') && eventParams.id == this.#entityId)\n\t\t{\n\t\t\tthis.#allowCloseSlider = true;\n\t\t}\n\t}\n\n\t#onEntityModelChange(event: BaseEvent): void\n\t{\n\t\tconst [model, eventParams]  = event.getCompatData();\n\n\t\tif (eventParams.fieldName === this.#stageIdField)\n\t\t{\n\t\t\tthis.#entityStageId = model.getStringField(this.#stageIdField, this.#entityStageId);\n\t\t}\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#isSkipped = !!period;\n\t}\n\n\t#onToolbarMenuBuild(event: BaseEvent): void\n\t{\n\t\tconst [, {items}] = event.getData();\n\t\titems.push({ delimiter: true });\n\t\tfor (const skipItem of this.#skipMenu.getItems())\n\t\t{\n\t\t\titems.push(skipItem);\n\t\t}\n\t}\n\n\t#onChangeDescription(event: BaseEvent): void\n\t{\n\t\tconst {description} = event.getData();\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!description.length && !saveButton.getState())\n\t\t{\n\t\t\tsaveButton.setState(ButtonState.DISABLED);\n\t\t}\n\t\telse if (description.length && saveButton.getState() === ButtonState.DISABLED)\n\t\t{\n\t\t\tsaveButton.setState(null);\n\t\t}\n\t}\n\n\t#onSaveHotkeyPressed(event: BaseEvent): void\n\t{\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!saveButton.getState()) // if save button is not disabled\n\t\t{\n\t\t\tthis.#saveTodo();\n\t\t}\n\t}\n\n\t#onChangeUploaderContainerSize()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.adjustPosition();\n\t\t}\n\t}\n\n\t#onSkipMenuItemSelect(period): void\n\t{\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.getMenuWindow()?.close();\n\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.WAITING);\n\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#isSkipped = !!period;\n\t\t\tthis.#skipMenu.setSelectedValue(period);\n\t\t\tthis.#revertButtonsState();\n\t\t\tthis.#allowCloseSlider = true;\n\t\t\tthis.#showCancelNotificationInParentWindow();\n\t\t\tthis.#getSliderInstance()?.close();\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#saveTodo(): void\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.WAITING);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\n\t\tthis.#toDoEditor.save().then((result) => {\n\t\t\tthis.#revertButtonsState();\n\t\t\tif (!(result.hasOwnProperty('errors') && result.errors.length))\n\t\t\t{\n\t\t\t\tthis.#allowCloseSlider = true;\n\t\t\t\tthis.#closePopup();\n\t\t\t\tthis.#getSliderInstance()?.close();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#revertButtonsState()\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(null);\n\t}\n\n\t#closePopup(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\t#closeSlider(): void\n\t{\n\t\tthis.#allowCloseSlider = true;\n\t\tthis.#getSliderInstance()?.close();\n\t}\n\n\t#showTodoCreationNotification(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tconst htmlStyles = getComputedStyle(document.documentElement);\n\t\t\tconst popupPadding = htmlStyles.getPropertyValue('--ui-space-inset-sm');\n\t\t\tconst popupPaddingNumberValue = parseFloat(popupPadding) || 12;\n\t\t\tconst popupOverlayColor = htmlStyles.getPropertyValue('--ui-color-base-solid') || '#000000';\n\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: 'todo-create-confirm-' + this.#entityTypeId + '-' + this.#entityId,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tpadding: popupPaddingNumberValue,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 40,\n\t\t\t\t\tbackgroundColor: popupOverlayColor,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getPopupContent(),\n\t\t\t\tbuttons: this.#getPopupButtons(),\n\t\t\t\twidth: 545,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.#closeSlider.bind(this)\n\t\t\t\t},\n\t\t\t\tclassName: 'crm-activity__todo-create-notification-popup'\n\t\t\t});\n\t\t}\n\n\t\tthis.#popup.show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#toDoEditor.setFocused();\n\t\t}, 10);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#popup.setClosingByEsc(true);\n\t\t}, 300);\n\t}\n\n\t#getPopupTitle(): string\n\t{\n\t\treturn Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_TITLE');\n\t}\n\n\t#getPopupDescription(): string\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION';\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst editorContainer = Tag.render`<div></div>`;\n\n\t\tconst content = Tag.render`<div class=\"crm-activity__todo-create-notification\">\n\t\t\t<div class=\"crm-activity__todo-create-notification_title\">${this.#getPopupTitle()}</div>\n\t\t\t<div class=\"crm-activity__todo-create-notification_content\">\n\t\t\t\t<div class=\"crm-activity__todo-create-notification_description\">${this.#getPopupDescription()}</div>\n\t\t\t\t${editorContainer}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis.#toDoEditor = new TodoEditor({\n\t\t\tcontainer: editorContainer,\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t\tcurrentUser: this.#timeline.getCurrentUser(),\n\t\t\tevents: {\n\t\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\t\tonChangeUploaderContainerSize: this.#onChangeUploaderContainerSize.bind(this),\n\t\t\t},\n\t\t\tborderColor: TodoEditor.BorderColor.PRIMARY,\n\t\t});\n\t\tthis.#toDoEditor.show();\n\n\t\treturn content;\n\t}\n\n\t#getPopupButtons(): Array<Button>\n\t{\n\t\treturn [\n\t\t\tnew SaveButton({\n\t\t\t\tid: SAVE_BUTTON_ID,\n\t\t\t\tround: true,\n\t\t\t\tstate: this.#toDoEditor.getDescription() ? null : ButtonState.DISABLED,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.#saveTodo.bind(this),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew CancelButton({\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL'),\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tid: CANCEL_BUTTON_ID,\n\t\t\t\tround: true,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.#closePopup.bind(this),\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew Button({\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP'),\n\t\t\t\tcolor: ButtonColor.LINK,\n\t\t\t\tid: SKIP_BUTTON_ID,\n\t\t\t\tdropdown: true,\n\t\t\t\tmenu: {\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\titems: this.#getSkipMenuItems(),\n\t\t\t\t\tminWidth: 233,\n\t\t\t\t},\n\t\t\t}),\n\t\t]\n\t}\n\n\t#getSkipMenuItems(): Array\n\t{\n\t\tconst menuItems = [];\n\n\t\tmenuItems.push({\n\t\t\tid: 'day',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'week',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'month',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month')\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: 'forever',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER'),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever')\n\t\t});\n\n\t\treturn menuItems;\n\t}\n\n\t#showCancelNotificationInParentWindow()\n\t{\n\t\tif (top.BX && top.BX.Runtime)\n\t\t{\n\t\t\tconst entityTypeId = this.#entityTypeId;\n\t\t\ttop.BX.Runtime.loadExtension('crm.activity.todo-notification-skip').then((exports) => {\n\t\t\t\tconst skipProvider = new exports.TodoNotificationSkip({\n\t\t\t\t\tentityTypeId\n\t\t\t\t});\n\t\t\t\tskipProvider.showCancelPeriodNotification();\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["SAVE_BUTTON_ID","CANCEL_BUTTON_ID","SKIP_BUTTON_ID","TodoCreateNotification","constructor","params","entityTypeId","entityId","entityStageId","stageIdField","finalStages","skipPeriod","BX","CrmTimelineManager","getDefault","TodoNotificationSkip","onSkippedPeriodChange","bind","TodoNotificationSkipMenu","selectedValue","EventEmitter","subscribe","top","SidePanel","slider","Instance","getSliderByWindow","window","isOpen","event","sliderEvent","getCompatData","getSlider","isActionAllowed","hasScheduledItems","indexOf","denyAction","setTimeout","eventParams","hasOwnProperty","entityData","id","model","fieldName","getStringField","period","items","getData","push","delimiter","skipItem","getItems","description","saveButton","getButton","length","getState","setState","ButtonState","DISABLED","adjustPosition","getMenuWindow","close","WAITING","saveSkippedPeriod","then","setSelectedValue","catch","save","result","errors","htmlStyles","getComputedStyle","document","documentElement","popupPadding","getPropertyValue","popupPaddingNumberValue","parseFloat","popupOverlayColor","PopupManager","create","closeIcon","padding","overlay","opacity","backgroundColor","content","buttons","width","events","onClose","className","show","setFocused","setClosingByEsc","Loc","getMessage","messagePhrase","CrmEntityType","enumeration","lead","deal","editorContainer","Tag","render","TodoEditor","container","ownerTypeId","ownerId","currentUser","getCurrentUser","onChangeDescription","onSaveHotkeyPressed","onChangeUploaderContainerSize","borderColor","BorderColor","PRIMARY","SaveButton","round","state","getDescription","click","CancelButton","text","color","ButtonColor","LIGHT_BORDER","Button","LINK","dropdown","menu","closeByEsc","minWidth","menuItems","onclick","Runtime","loadExtension","exports","skipProvider","showCancelPeriodNotification"],"mappings":"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"}