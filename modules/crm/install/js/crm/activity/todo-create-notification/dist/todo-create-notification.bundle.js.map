{"version":3,"file":"todo-create-notification.bundle.js","sources":["../src/todo-create-notification.js"],"sourcesContent":["import { TodoEditorV2 } from 'crm.activity.todo-editor-v2';\nimport { TodoNotificationSkip } from 'crm.activity.todo-notification-skip';\nimport { TodoNotificationSkipMenu } from 'crm.activity.todo-notification-skip-menu';\nimport { Event, Loc, Tag, Cache } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button, ButtonColor, ButtonState } from 'ui.buttons';\n\nimport './todo-create-notification.css';\n\ndeclare type TodoCreateNotificationParams = {\n\tentityTypeId: number,\n\tentityId: number,\n\tentityStageId: string,\n\tstageIdField: string,\n\tfinalStages: Array<string>,\n\tskipPeriod: ?string,\n\tanalytics?: Object,\n}\n\nconst SAVE_BUTTON_ID = 'save';\nconst CANCEL_BUTTON_ID = 'cancel';\nconst SKIP_BUTTON_ID = 'skip';\n\nexport class TodoCreateNotification\n{\n\t#timeline: ?Object = null;\n\t#entityTypeId: string = null;\n\t#entityId: string = null;\n\t#entityStageId: string = null;\n\t#stageIdField: string = null;\n\t#finalStages: Array<string> = null;\n\n\t#allowCloseSlider: boolean = false;\n\t#isSkipped: boolean = false;\n\t#popup: ?Popup = null;\n\t#toDoEditor: ?TodoEditorV2 = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\t#skipMenu: ?TodoNotificationSkipMenu = null;\n\t#sliderIsMinimizing: boolean = false;\n\t#analytics: Object = null;\n\t#refs: typeof(Cache.MemoryCache) = new Cache.MemoryCache();\n\n\tconstructor(params: TodoCreateNotificationParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityStageId = params.entityStageId;\n\t\tthis.#stageIdField = params.stageIdField;\n\t\tthis.#finalStages = params.finalStages;\n\t\tthis.#isSkipped = Boolean(params.skipPeriod);\n\t\tthis.#analytics = params.analytics ?? {};\n\n\t\tif (BX.CrmTimelineManager)\n\t\t{\n\t\t\tthis.#timeline = BX.CrmTimelineManager.getDefault();\n\t\t}\n\n\t\tthis.#bindEvents();\n\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t\tthis.#skipMenu = new TodoNotificationSkipMenu({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tselectedValue: params.skipPeriod,\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (this.#getSliderInstance())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.#getSliderInstance(), 'SidePanel.Slider:onClose', this.#onCloseSlider.bind(this));\n\t\t\tEventEmitter.subscribe('Crm.EntityModel.Change', this.#onEntityModelChange.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.#onEntityUpdate.bind(this));\n\t\t\tEventEmitter.subscribe('onCrmEntityDelete', this.#onEntityDelete.bind(this));\n\t\t}\n\n\t\tEventEmitter.subscribe('Crm.InterfaceToolbar.MenuBuild', this.#onToolbarMenuBuild.bind(this));\n\t}\n\n\t#getSliderInstance(): BX.SidePanel.Slider | null\n\t{\n\t\tif (top.BX && top.BX.SidePanel)\n\t\t{\n\t\t\tconst slider = top.BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t\tif (slider && slider.isOpen())\n\t\t\t{\n\t\t\t\treturn slider;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#isSliderMinimizeAvailable(): boolean\n\t{\n\t\treturn Object.hasOwn(BX.SidePanel.Slider.prototype, 'minimize')\n\t\t\t&& Object.hasOwn(BX.SidePanel.Slider.prototype, 'isMinimizing')\n\t\t;\n\t}\n\n\t#onCloseSlider(event: BaseEvent): void\n\t{\n\t\tif (this.#allowCloseSlider || this.#isSkipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getSlider() !== top.BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!sliderEvent.isActionAllowed())\n\t\t{\n\t\t\treturn; // editor has unsaved fields\n\t\t}\n\n\t\tif (!this.#timeline || this.#timeline.hasScheduledItems())\n\t\t{\n\t\t\treturn; // timeline already has scheduled activities\n\t\t}\n\n\t\tif (this.#finalStages.includes(this.#entityStageId))\n\t\t{\n\t\t\treturn; // element has final stage\n\t\t}\n\n\t\tthis.#sliderIsMinimizing = this.#isSliderMinimizeAvailable() && sliderEvent.getSlider()?.isMinimizing();\n\t\tsliderEvent.denyAction();\n\n\t\tsetTimeout(async () => {\n\t\t\tthis.#showTodoCreationNotification();\n\t\t}, 100);\n\t}\n\n\t#onEntityUpdate(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (\n\t\t\tObject.hasOwn(eventParams, 'entityData')\n\t\t\t&& Object.hasOwn(eventParams.entityData, this.#stageIdField)\n\t\t)\n\t\t{\n\t\t\tthis.#entityStageId = eventParams.entityData[this.#stageIdField];\n\t\t}\n\t}\n\n\t#onEntityDelete(event: BaseEvent): void\n\t{\n\t\tconst [eventParams] = event.getCompatData();\n\t\tif (\n\t\t\tObject.hasOwn(eventParams, 'id')\n\t\t\t&& Text.toString(eventParams.id) === Text.toString(this.#entityId)\n\t\t)\n\t\t{\n\t\t\tthis.#allowCloseSlider = true;\n\t\t}\n\t}\n\n\t#onEntityModelChange(event: BaseEvent): void\n\t{\n\t\tconst [model, eventParams] = event.getCompatData();\n\n\t\tif (eventParams.fieldName === this.#stageIdField)\n\t\t{\n\t\t\tthis.#entityStageId = model.getStringField(this.#stageIdField, this.#entityStageId);\n\t\t}\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#isSkipped = Boolean(period);\n\t}\n\n\t#onToolbarMenuBuild(event: BaseEvent): void\n\t{\n\t\tconst [, { items }] = event.getData();\n\t\titems.push({ delimiter: true });\n\t\tfor (const skipItem of this.#skipMenu.getItems())\n\t\t{\n\t\t\titems.push(skipItem);\n\t\t}\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tconst saveButton = this.#popup?.getButton(SAVE_BUTTON_ID);\n\t\tif (!saveButton.getState()) // if save button is not disabled\n\t\t{\n\t\t\tthis.#saveTodo();\n\t\t}\n\t}\n\n\t#onChangeUploaderContainerSize()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.adjustPosition();\n\t\t}\n\t}\n\n\t#onSkipMenuItemSelect(period): void\n\t{\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.getMenuWindow()?.close();\n\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.WAITING);\n\n\t\tthis.getTodoEditor().cancel({\n\t\t\tanalytics: {\n\t\t\t\t...this.#analytics,\n\t\t\t\telement: TodoEditorV2.AnalyticsElement.skipPeriodButton,\n\t\t\t\tnotificationSkipPeriod: period,\n\t\t\t},\n\t\t});\n\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#isSkipped = Boolean(period);\n\t\t\tthis.#skipMenu.setSelectedValue(period);\n\t\t\tthis.#revertButtonsState();\n\t\t\tthis.#allowCloseSlider = true;\n\t\t\tthis.#showCancelNotificationInParentWindow();\n\t\t\tthis.#getSliderInstance()?.close();\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#saveTodo(): void\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(ButtonState.WAITING);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(ButtonState.DISABLED);\n\n\t\tthis.getTodoEditor().save().then((result) => {\n\t\t\tthis.#revertButtonsState();\n\n\t\t\tif (!(Object.hasOwn(result, 'errors') && result.errors.length > 0))\n\t\t\t{\n\t\t\t\tthis.#allowCloseSlider = true;\n\t\t\t\tthis.#closePopup();\n\t\t\t\tthis.#getSliderInstance()?.close();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.#revertButtonsState();\n\t\t});\n\t}\n\n\t#cancel(): void\n\t{\n\t\tvoid this.getTodoEditor().cancel({\n\t\t\tanalytics: {\n\t\t\t\t...this.#analytics,\n\t\t\t\telement: TodoEditorV2.AnalyticsElement.cancelButton,\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tthis.#closePopup();\n\t\t});\n\t}\n\n\t#revertButtonsState()\n\t{\n\t\tthis.#popup?.getButton(SAVE_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(CANCEL_BUTTON_ID)?.setState(null);\n\t\tthis.#popup?.getButton(SKIP_BUTTON_ID)?.setState(null);\n\t}\n\n\t#closePopup(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\t#closeSlider(): void\n\t{\n\t\tthis.#allowCloseSlider = true;\n\t\tif (this.#isSliderMinimizeAvailable() && this.#sliderIsMinimizing)\n\t\t{\n\t\t\tthis.#getSliderInstance()?.minimize();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getSliderInstance()?.close();\n\t}\n\n\t#showTodoCreationNotification(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tconst htmlStyles = getComputedStyle(document.documentElement);\n\t\t\tconst popupPadding = htmlStyles.getPropertyValue('--ui-space-inset-sm');\n\t\t\tconst popupPaddingNumberValue = parseFloat(popupPadding) || 12;\n\t\t\tconst popupOverlayColor = htmlStyles.getPropertyValue('--ui-color-base-solid') || '#000000';\n\n\t\t\tconst { innerWidth } = window;\n\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: `todo-create-confirm-${this.#entityTypeId}-${this.#entityId}`,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tpadding: popupPaddingNumberValue,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 40,\n\t\t\t\t\tbackgroundColor: popupOverlayColor,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getPopupContent(),\n\t\t\t\tminWidth: 537,\n\t\t\t\twidth: Math.round(innerWidth * 0.45),\n\t\t\t\tmaxWidth: 737,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.#closeSlider.bind(this),\n\t\t\t\t\tonFirstShow: () => {\n\t\t\t\t\t\tthis.getTodoEditor().show();\n\t\t\t\t\t\tthis.getTodoEditor().setFocused();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tclassName: 'crm-activity__todo-create-notification-popup',\n\t\t\t});\n\t\t}\n\n\t\tthis.#popup.show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.getTodoEditor().setFocused();\n\t\t}, 10);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#popup.setClosingByEsc(true);\n\n\t\t\tEvent.bind(document, 'keyup', (event) => {\n\t\t\t\tif (event.key === 'Escape')\n\t\t\t\t{\n\t\t\t\t\tvoid this.getTodoEditor().cancel({\n\t\t\t\t\t\tanalytics: {\n\t\t\t\t\t\t\t...this.#analytics,\n\t\t\t\t\t\t\telement: TodoEditorV2.AnalyticsElement.cancelButton,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}, 300);\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\treturn this.#refs.remember('content', () => {\n\t\t\tconst buttonsContainer = Tag.render`\n\t\t\t\t<div class=\"crm-activity__todo-create-notification_footer\">\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_buttons-container\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t\tonclick=\"${this.#saveTodo.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_OK_BUTTON_V2')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-link\"\n\t\t\t\t\t\t\tonclick=\"${this.#cancel.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL_BUTTON_V2')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getPreparedForV2NotificationSkipButton().render()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"crm-activity__todo-create-notification_title --v2\">\n\t\t\t\t\t\t${this.#getNotificationTitle()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t${this.#getTodoEditorContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${buttonsContainer}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getTodoEditorContainer(): HTMLElement\n\t{\n\t\treturn this.#refs.remember('editor', () => {\n\t\t\treturn Tag.render`<div></div>`;\n\t\t});\n\t}\n\n\t#getNotificationTitle(): string\n\t{\n\t\tlet code = null;\n\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_DEAL';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2';\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getPreparedForV2NotificationSkipButton(): Button\n\t{\n\t\treturn this.#createNotificationSkipButton()\n\t\t\t.setNoCaps()\n\t\t\t.addClass('crm-activity__todo-create-notification_skip-button')\n\t\t;\n\t}\n\n\tgetTodoEditor(): TodoEditorV2\n\t{\n\t\tif (this.#toDoEditor !== null)\n\t\t{\n\t\t\treturn this.#toDoEditor;\n\t\t}\n\n\t\tconst params = {\n\t\t\tcontainer: this.#getTodoEditorContainer(),\n\t\t\townerTypeId: this.#entityTypeId,\n\t\t\townerId: this.#entityId,\n\t\t\tcurrentUser: this.#timeline.getCurrentUser(),\n\t\t\tpingSettings: this.#timeline.getPingSettings(),\n\t\t\tevents: {\n\t\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\t\tonChangeUploaderContainerSize: this.#onChangeUploaderContainerSize.bind(this),\n\t\t\t},\n\t\t\tborderColor: TodoEditorV2.BorderColor.PRIMARY,\n\t\t};\n\n\t\tparams.calendarSettings = this.#timeline.getCalendarSettings();\n\t\tparams.colorSettings = this.#timeline.getColorSettings();\n\t\tparams.defaultDescription = '';\n\t\tparams.analytics = this.#analytics;\n\n\t\tthis.#toDoEditor = new TodoEditorV2(params);\n\n\t\treturn this.#toDoEditor;\n\t}\n\n\t#createNotificationSkipButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_V2'),\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\tid: SKIP_BUTTON_ID,\n\t\t\tdropdown: true,\n\t\t\tmenu: {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\titems: this.#getSkipMenuItems(),\n\t\t\t\tminWidth: 233,\n\t\t\t},\n\t\t});\n\t}\n\n\t#getSkipMenuItems(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'day',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'week',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'month',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'forever',\n\t\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER'),\n\t\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever'),\n\t\t\t},\n\t\t];\n\t}\n\n\t#showCancelNotificationInParentWindow()\n\t{\n\t\tif (top.BX && top.BX.Runtime)\n\t\t{\n\t\t\tconst entityTypeId = this.#entityTypeId;\n\t\t\tvoid top.BX.Runtime.loadExtension('crm.activity.todo-notification-skip')\n\t\t\t\t.then((exports) => {\n\t\t\t\t\tconst skipProvider = new exports.TodoNotificationSkip({\n\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t});\n\t\t\t\t\tskipProvider.showCancelPeriodNotification();\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n}\n"],"names":["SAVE_BUTTON_ID","CANCEL_BUTTON_ID","SKIP_BUTTON_ID","TodoCreateNotification","constructor","params","Cache","MemoryCache","entityTypeId","entityId","entityStageId","stageIdField","finalStages","Boolean","skipPeriod","analytics","BX","CrmTimelineManager","getDefault","TodoNotificationSkip","onSkippedPeriodChange","bind","TodoNotificationSkipMenu","selectedValue","getTodoEditor","container","ownerTypeId","ownerId","currentUser","getCurrentUser","pingSettings","getPingSettings","events","onSaveHotkeyPressed","onChangeUploaderContainerSize","borderColor","TodoEditorV2","BorderColor","PRIMARY","calendarSettings","getCalendarSettings","colorSettings","getColorSettings","defaultDescription","EventEmitter","subscribe","top","SidePanel","slider","Instance","getSliderByWindow","window","isOpen","Object","hasOwn","Slider","prototype","event","sliderEvent","getCompatData","getSlider","isActionAllowed","hasScheduledItems","includes","isMinimizing","denyAction","setTimeout","eventParams","entityData","Text","toString","id","model","fieldName","getStringField","period","items","getData","push","delimiter","skipItem","getItems","saveButton","getButton","getState","adjustPosition","getMenuWindow","close","setState","ButtonState","DISABLED","WAITING","cancel","element","AnalyticsElement","skipPeriodButton","notificationSkipPeriod","saveSkippedPeriod","then","setSelectedValue","catch","save","result","errors","length","cancelButton","minimize","htmlStyles","getComputedStyle","document","documentElement","popupPadding","getPropertyValue","popupPaddingNumberValue","parseFloat","popupOverlayColor","innerWidth","PopupManager","create","closeIcon","padding","overlay","opacity","backgroundColor","content","minWidth","width","Math","round","maxWidth","onClose","onFirstShow","show","setFocused","className","setClosingByEsc","Event","key","remember","buttonsContainer","Tag","render","Loc","getMessage","code","CrmEntityType","enumeration","lead","deal","setNoCaps","addClass","Button","text","color","ButtonColor","LINK","dropdown","menu","closeByEsc","onclick","Runtime","loadExtension","exports","skipProvider","showCancelPeriodNotification"],"mappings":"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"}