this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,i,l,a,o,r){"use strict";let n=e=>e,b,d;const c="save";const v="cancel";const p="skip";var u=babelHelpers.classPrivateFieldLooseKey("timeline");var P=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var h=babelHelpers.classPrivateFieldLooseKey("entityId");var B=babelHelpers.classPrivateFieldLooseKey("entityStageId");var L=babelHelpers.classPrivateFieldLooseKey("stageIdField");var F=babelHelpers.classPrivateFieldLooseKey("finalStages");var H=babelHelpers.classPrivateFieldLooseKey("allowCloseSlider");var y=babelHelpers.classPrivateFieldLooseKey("isSkipped");var f=babelHelpers.classPrivateFieldLooseKey("popup");var I=babelHelpers.classPrivateFieldLooseKey("toDoEditor");var O=babelHelpers.classPrivateFieldLooseKey("skipProvider");var g=babelHelpers.classPrivateFieldLooseKey("skipMenu");var T=babelHelpers.classPrivateFieldLooseKey("sliderIsMinimizing");var C=babelHelpers.classPrivateFieldLooseKey("bindEvents");var S=babelHelpers.classPrivateFieldLooseKey("getSliderInstance");var m=babelHelpers.classPrivateFieldLooseKey("isSliderMinimizeAvailable");var _=babelHelpers.classPrivateFieldLooseKey("onCloseSlider");var w=babelHelpers.classPrivateFieldLooseKey("onEntityUpdate");var D=babelHelpers.classPrivateFieldLooseKey("onEntityDelete");var E=babelHelpers.classPrivateFieldLooseKey("onEntityModelChange");var K=babelHelpers.classPrivateFieldLooseKey("onSkippedPeriodChange");var A=babelHelpers.classPrivateFieldLooseKey("onToolbarMenuBuild");var j=babelHelpers.classPrivateFieldLooseKey("onChangeDescription");var M=babelHelpers.classPrivateFieldLooseKey("onSaveHotkeyPressed");var N=babelHelpers.classPrivateFieldLooseKey("onChangeUploaderContainerSize");var k=babelHelpers.classPrivateFieldLooseKey("onSkipMenuItemSelect");var X=babelHelpers.classPrivateFieldLooseKey("saveTodo");var R=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var V=babelHelpers.classPrivateFieldLooseKey("closePopup");var Y=babelHelpers.classPrivateFieldLooseKey("closeSlider");var x=babelHelpers.classPrivateFieldLooseKey("showTodoCreationNotification");var z=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var W=babelHelpers.classPrivateFieldLooseKey("getPopupDescription");var U=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var G=babelHelpers.classPrivateFieldLooseKey("getPopupButtons");var $=babelHelpers.classPrivateFieldLooseKey("getSkipMenuItems");var q=babelHelpers.classPrivateFieldLooseKey("showCancelNotificationInParentWindow");class J{constructor(e){Object.defineProperty(this,q,{value:ye});Object.defineProperty(this,$,{value:He});Object.defineProperty(this,G,{value:Fe});Object.defineProperty(this,U,{value:Le});Object.defineProperty(this,W,{value:Be});Object.defineProperty(this,z,{value:he});Object.defineProperty(this,x,{value:Pe});Object.defineProperty(this,Y,{value:ue});Object.defineProperty(this,V,{value:pe});Object.defineProperty(this,R,{value:ve});Object.defineProperty(this,X,{value:ce});Object.defineProperty(this,k,{value:de});Object.defineProperty(this,N,{value:be});Object.defineProperty(this,M,{value:ne});Object.defineProperty(this,j,{value:re});Object.defineProperty(this,A,{value:oe});Object.defineProperty(this,K,{value:ae});Object.defineProperty(this,E,{value:le});Object.defineProperty(this,D,{value:ie});Object.defineProperty(this,w,{value:te});Object.defineProperty(this,_,{value:se});Object.defineProperty(this,m,{value:ee});Object.defineProperty(this,S,{value:Z});Object.defineProperty(this,C,{value:Q});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:false});Object.defineProperty(this,y,{writable:true,value:false});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,g,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.entityStageId;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.stageIdField;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.finalStages;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e.skipPeriod;if(BX.CrmTimelineManager){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=BX.CrmTimelineManager.getDefault()}babelHelpers.classPrivateFieldLooseBase(this,C)[C]();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new o.TodoNotificationSkip({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onSkippedPeriodChange:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this)});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new r.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],selectedValue:e.skipPeriod})}}function Q(){if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]()){t.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),"SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this));t.EventEmitter.subscribe("Crm.EntityModel.Change",babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this));t.EventEmitter.subscribe("onCrmEntityUpdate",babelHelpers.classPrivateFieldLooseBase(this,w)[w].bind(this));t.EventEmitter.subscribe("onCrmEntityDelete",babelHelpers.classPrivateFieldLooseBase(this,D)[D].bind(this))}t.EventEmitter.subscribe("Crm.InterfaceToolbar.MenuBuild",babelHelpers.classPrivateFieldLooseBase(this,A)[A].bind(this))}function Z(){if(top.BX&&top.BX.SidePanel){const e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){return e}}return null}function ee(){return Object.hasOwn(BX.SidePanel.Slider.prototype,"minimize")&&Object.hasOwn(BX.SidePanel.Slider.prototype,"isMinimizing")}function se(e){var s;if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]||babelHelpers.classPrivateFieldLooseBase(this,y)[y]){return}const[t]=e.getCompatData();if(t.getSlider()!==top.BX.SidePanel.Instance.getSliderByWindow(window)){return}if(!t.isActionAllowed()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]||babelHelpers.classPrivateFieldLooseBase(this,u)[u].hasScheduledItems()){return}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].indexOf(babelHelpers.classPrivateFieldLooseBase(this,B)[B])>-1){return}babelHelpers.classPrivateFieldLooseBase(this,T)[T]=babelHelpers.classPrivateFieldLooseBase(this,m)[m]()&&((s=t.getSlider())==null?void 0:s.isMinimizing());t.denyAction();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}),100)}function te(e){const[s]=e.getCompatData();if(s.hasOwnProperty("entityData")&&s.entityData.hasOwnProperty(babelHelpers.classPrivateFieldLooseBase(this,L)[L])){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.entityData[babelHelpers.classPrivateFieldLooseBase(this,L)[L]]}}function ie(e){const[s]=e.getCompatData();if(s.hasOwnProperty("id")&&s.id==babelHelpers.classPrivateFieldLooseBase(this,h)[h]){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true}}function le(e){const[s,t]=e.getCompatData();if(t.fieldName===babelHelpers.classPrivateFieldLooseBase(this,L)[L]){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.getStringField(babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,B)[B])}}function ae(e){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e}function oe(e){const[,{items:s}]=e.getData();s.push({delimiter:true});for(const e of babelHelpers.classPrivateFieldLooseBase(this,g)[g].getItems()){s.push(e)}}function re(e){var s;const{description:t}=e.getData();const i=(s=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:s.getButton(c);if(!t.length&&!i.getState()){i.setState(a.ButtonState.DISABLED)}else if(t.length&&i.getState()===a.ButtonState.DISABLED){i.setState(null)}}function ne(e){var s;const t=(s=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:s.getButton(c);if(!t.getState()){babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}}function be(){if(babelHelpers.classPrivateFieldLooseBase(this,f)[f]){babelHelpers.classPrivateFieldLooseBase(this,f)[f].adjustPosition()}}function de(e){var s,t,i,l,o,r,n,b,d;(s=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(t=s.getButton(p))==null?void 0:(i=t.getMenuWindow())==null?void 0:i.close();(l=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(o=l.getButton(c))==null?void 0:o.setState(a.ButtonState.DISABLED);(r=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(n=r.getButton(v))==null?void 0:n.setState(a.ButtonState.DISABLED);(b=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(d=b.getButton(p))==null?void 0:d.setState(a.ButtonState.WAITING);babelHelpers.classPrivateFieldLooseBase(this,O)[O].saveSkippedPeriod(e).then((()=>{var s;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e;babelHelpers.classPrivateFieldLooseBase(this,g)[g].setSelectedValue(e);babelHelpers.classPrivateFieldLooseBase(this,R)[R]();babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;babelHelpers.classPrivateFieldLooseBase(this,q)[q]();(s=babelHelpers.classPrivateFieldLooseBase(this,S)[S]())==null?void 0:s.close()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}))}function ce(){var e,s,t,i,l,o;(e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(s=e.getButton(c))==null?void 0:s.setState(a.ButtonState.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(i=t.getButton(v))==null?void 0:i.setState(a.ButtonState.DISABLED);(l=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(o=l.getButton(p))==null?void 0:o.setState(a.ButtonState.DISABLED);babelHelpers.classPrivateFieldLooseBase(this,I)[I].save().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]();if(!(e.hasOwnProperty("errors")&&e.errors.length)){var s;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;babelHelpers.classPrivateFieldLooseBase(this,V)[V]();(s=babelHelpers.classPrivateFieldLooseBase(this,S)[S]())==null?void 0:s.close()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}))}function ve(){var e,s,t,i,l,a;(e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(s=e.getButton(c))==null?void 0:s.setState(null);(t=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(i=t.getButton(v))==null?void 0:i.setState(null);(l=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:(a=l.getButton(p))==null?void 0:a.setState(null)}function pe(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:e.close()}function ue(){var e;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]()&&babelHelpers.classPrivateFieldLooseBase(this,T)[T]){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,S)[S]())==null?void 0:s.minimize();return}(e=babelHelpers.classPrivateFieldLooseBase(this,S)[S]())==null?void 0:e.close()}function Pe(){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const l=e.getPropertyValue("--ui-color-base-solid")||"#000000";babelHelpers.classPrivateFieldLooseBase(this,f)[f]=i.PopupManager.create({id:"todo-create-confirm-"+babelHelpers.classPrivateFieldLooseBase(this,P)[P]+"-"+babelHelpers.classPrivateFieldLooseBase(this,h)[h],closeIcon:true,padding:t,overlay:{opacity:40,backgroundColor:l},content:babelHelpers.classPrivateFieldLooseBase(this,U)[U](),buttons:babelHelpers.classPrivateFieldLooseBase(this,G)[G](),width:545,events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this)},className:"crm-activity__todo-create-notification-popup"})}babelHelpers.classPrivateFieldLooseBase(this,f)[f].show();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I].setFocused()}),10);setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f].setClosingByEsc(true)}),300)}function he(){return s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_TITLE")}function Be(){let e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION";switch(babelHelpers.classPrivateFieldLooseBase(this,P)[P]){case BX.CrmEntityType.enumeration.lead:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD";break;case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL";break}return s.Loc.getMessage(e)}function Le(){const e=s.Tag.render(b||(b=n`<div></div>`));const t=s.Tag.render(d||(d=n`<div class="crm-activity__todo-create-notification">
			<div class="crm-activity__todo-create-notification_title">${0}</div>
			<div class="crm-activity__todo-create-notification_content">
				<div class="crm-activity__todo-create-notification_description">${0}</div>
				${0}
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,z)[z](),babelHelpers.classPrivateFieldLooseBase(this,W)[W](),e);babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new l.TodoEditor({container:e,ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],ownerId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],currentUser:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getCurrentUser(),pingSettings:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getPingSettings(),events:{onChangeDescription:babelHelpers.classPrivateFieldLooseBase(this,j)[j].bind(this),onSaveHotkeyPressed:babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this),onChangeUploaderContainerSize:babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this)},borderColor:l.TodoEditor.BorderColor.PRIMARY});babelHelpers.classPrivateFieldLooseBase(this,I)[I].show();return t}function Fe(){return[new a.SaveButton({id:c,round:true,state:babelHelpers.classPrivateFieldLooseBase(this,I)[I].getDescription()?null:a.ButtonState.DISABLED,events:{click:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this)}}),new a.CancelButton({text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL"),color:a.ButtonColor.LIGHT_BORDER,id:v,round:true,events:{click:babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this)}}),new a.Button({text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP"),color:a.ButtonColor.LINK,id:p,dropdown:true,menu:{closeByEsc:true,items:babelHelpers.classPrivateFieldLooseBase(this,$)[$](),minWidth:233}})]}function He(){const e=[];e.push({id:"day",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY"),onclick:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this,"day")});e.push({id:"week",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK"),onclick:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this,"week")});e.push({id:"month",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH"),onclick:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this,"month")});e.push({id:"forever",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER"),onclick:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this,"forever")});return e}function ye(){if(top.BX&&top.BX.Runtime){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P];top.BX.Runtime.loadExtension("crm.activity.todo-notification-skip").then((s=>{const t=new s.TodoNotificationSkip({entityTypeId:e});t.showCancelPeriodNotification()}))}}e.TodoCreateNotification=J})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX,BX.Event,BX.Main,BX.Crm.Activity,BX.UI,BX.Crm.Activity,BX.Crm.Activity);
//# sourceMappingURL=todo-create-notification.bundle.map.js