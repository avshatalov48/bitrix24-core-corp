this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,i,a,l,o,r){"use strict";let n=e=>e,b,d,c;const v="save";const p="cancel";const u="skip";var P=babelHelpers.classPrivateFieldLooseKey("timeline");var h=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var B=babelHelpers.classPrivateFieldLooseKey("entityId");var F=babelHelpers.classPrivateFieldLooseKey("entityStageId");var L=babelHelpers.classPrivateFieldLooseKey("stageIdField");var H=babelHelpers.classPrivateFieldLooseKey("finalStages");var y=babelHelpers.classPrivateFieldLooseKey("allowCloseSlider");var f=babelHelpers.classPrivateFieldLooseKey("isSkipped");var T=babelHelpers.classPrivateFieldLooseKey("popup");var O=babelHelpers.classPrivateFieldLooseKey("toDoEditor");var g=babelHelpers.classPrivateFieldLooseKey("skipProvider");var I=babelHelpers.classPrivateFieldLooseKey("skipMenu");var m=babelHelpers.classPrivateFieldLooseKey("sliderIsMinimizing");var C=babelHelpers.classPrivateFieldLooseKey("analytics");var S=babelHelpers.classPrivateFieldLooseKey("refs");var _=babelHelpers.classPrivateFieldLooseKey("bindEvents");var E=babelHelpers.classPrivateFieldLooseKey("getSliderInstance");var w=babelHelpers.classPrivateFieldLooseKey("isSliderMinimizeAvailable");var K=babelHelpers.classPrivateFieldLooseKey("onCloseSlider");var j=babelHelpers.classPrivateFieldLooseKey("onEntityUpdate");var A=babelHelpers.classPrivateFieldLooseKey("onEntityDelete");var N=babelHelpers.classPrivateFieldLooseKey("onEntityModelChange");var M=babelHelpers.classPrivateFieldLooseKey("onSkippedPeriodChange");var k=babelHelpers.classPrivateFieldLooseKey("onToolbarMenuBuild");var D=babelHelpers.classPrivateFieldLooseKey("onSaveHotkeyPressed");var V=babelHelpers.classPrivateFieldLooseKey("onChangeUploaderContainerSize");var X=babelHelpers.classPrivateFieldLooseKey("onSkipMenuItemSelect");var R=babelHelpers.classPrivateFieldLooseKey("saveTodo");var Y=babelHelpers.classPrivateFieldLooseKey("cancel");var x=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var W=babelHelpers.classPrivateFieldLooseKey("closePopup");var $=babelHelpers.classPrivateFieldLooseKey("closeSlider");var U=babelHelpers.classPrivateFieldLooseKey("showTodoCreationNotification");var z=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var G=babelHelpers.classPrivateFieldLooseKey("getTodoEditorContainer");var q=babelHelpers.classPrivateFieldLooseKey("getNotificationTitle");var J=babelHelpers.classPrivateFieldLooseKey("getPreparedForV2NotificationSkipButton");var Q=babelHelpers.classPrivateFieldLooseKey("createNotificationSkipButton");var Z=babelHelpers.classPrivateFieldLooseKey("getSkipMenuItems");var ee=babelHelpers.classPrivateFieldLooseKey("showCancelNotificationInParentWindow");class se{constructor(e){var s;Object.defineProperty(this,ee,{value:Ie});Object.defineProperty(this,Z,{value:ge});Object.defineProperty(this,Q,{value:Oe});Object.defineProperty(this,J,{value:Te});Object.defineProperty(this,q,{value:fe});Object.defineProperty(this,G,{value:ye});Object.defineProperty(this,z,{value:He});Object.defineProperty(this,U,{value:Le});Object.defineProperty(this,$,{value:Fe});Object.defineProperty(this,W,{value:Be});Object.defineProperty(this,x,{value:he});Object.defineProperty(this,Y,{value:Pe});Object.defineProperty(this,R,{value:ue});Object.defineProperty(this,X,{value:pe});Object.defineProperty(this,V,{value:ve});Object.defineProperty(this,D,{value:ce});Object.defineProperty(this,k,{value:de});Object.defineProperty(this,M,{value:be});Object.defineProperty(this,N,{value:ne});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,j,{value:oe});Object.defineProperty(this,K,{value:le});Object.defineProperty(this,w,{value:ae});Object.defineProperty(this,E,{value:ie});Object.defineProperty(this,_,{value:te});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:false});Object.defineProperty(this,f,{writable:true,value:false});Object.defineProperty(this,T,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,g,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,m,{writable:true,value:false});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:new a.Cache.MemoryCache});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.entityStageId;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.stageIdField;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=e.finalStages;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e.skipPeriod);babelHelpers.classPrivateFieldLooseBase(this,C)[C]=(s=e.analytics)!=null?s:{};if(BX.CrmTimelineManager){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=BX.CrmTimelineManager.getDefault()}babelHelpers.classPrivateFieldLooseBase(this,_)[_]();babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new t.TodoNotificationSkip({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],onSkippedPeriodChange:babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this)});babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new i.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],selectedValue:e.skipPeriod})}getTodoEditor(){if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]!==null){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}const e={container:babelHelpers.classPrivateFieldLooseBase(this,G)[G](),ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],ownerId:babelHelpers.classPrivateFieldLooseBase(this,B)[B],currentUser:babelHelpers.classPrivateFieldLooseBase(this,P)[P].getCurrentUser(),pingSettings:babelHelpers.classPrivateFieldLooseBase(this,P)[P].getPingSettings(),events:{onSaveHotkeyPressed:babelHelpers.classPrivateFieldLooseBase(this,D)[D].bind(this),onChangeUploaderContainerSize:babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this)},borderColor:s.TodoEditorV2.BorderColor.PRIMARY};e.calendarSettings=babelHelpers.classPrivateFieldLooseBase(this,P)[P].getCalendarSettings();e.colorSettings=babelHelpers.classPrivateFieldLooseBase(this,P)[P].getColorSettings();e.defaultDescription="";e.analytics=babelHelpers.classPrivateFieldLooseBase(this,C)[C];babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new s.TodoEditorV2(e);return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}}function te(){if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]()){l.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,E)[E](),"SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this));l.EventEmitter.subscribe("Crm.EntityModel.Change",babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this));l.EventEmitter.subscribe("onCrmEntityUpdate",babelHelpers.classPrivateFieldLooseBase(this,j)[j].bind(this));l.EventEmitter.subscribe("onCrmEntityDelete",babelHelpers.classPrivateFieldLooseBase(this,A)[A].bind(this))}l.EventEmitter.subscribe("Crm.InterfaceToolbar.MenuBuild",babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this))}function ie(){if(top.BX&&top.BX.SidePanel){const e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){return e}}return null}function ae(){return Object.hasOwn(BX.SidePanel.Slider.prototype,"minimize")&&Object.hasOwn(BX.SidePanel.Slider.prototype,"isMinimizing")}function le(e){var s;if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]||babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return}const[t]=e.getCompatData();if(t.getSlider()!==top.BX.SidePanel.Instance.getSliderByWindow(window)){return}if(!t.isActionAllowed()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]||babelHelpers.classPrivateFieldLooseBase(this,P)[P].hasScheduledItems()){return}if(babelHelpers.classPrivateFieldLooseBase(this,H)[H].includes(babelHelpers.classPrivateFieldLooseBase(this,F)[F])){return}babelHelpers.classPrivateFieldLooseBase(this,m)[m]=babelHelpers.classPrivateFieldLooseBase(this,w)[w]()&&((s=t.getSlider())==null?void 0:s.isMinimizing());t.denyAction();setTimeout((async()=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U]()}),100)}function oe(e){const[s]=e.getCompatData();if(Object.hasOwn(s,"entityData")&&Object.hasOwn(s.entityData,babelHelpers.classPrivateFieldLooseBase(this,L)[L])){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.entityData[babelHelpers.classPrivateFieldLooseBase(this,L)[L]]}}function re(e){const[s]=e.getCompatData();if(Object.hasOwn(s,"id")&&Text.toString(s.id)===Text.toString(babelHelpers.classPrivateFieldLooseBase(this,B)[B])){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=true}}function ne(e){const[s,t]=e.getCompatData();if(t.fieldName===babelHelpers.classPrivateFieldLooseBase(this,L)[L]){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.getStringField(babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,F)[F])}}function be(e){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e)}function de(e){const[,{items:s}]=e.getData();s.push({delimiter:true});for(const e of babelHelpers.classPrivateFieldLooseBase(this,I)[I].getItems()){s.push(e)}}function ce(){var e;const s=(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:e.getButton(v);if(!s.getState()){babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}}function ve(){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]){babelHelpers.classPrivateFieldLooseBase(this,T)[T].adjustPosition()}}function pe(e){var t,i,a,l,o,n,b,d,c;(t=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(i=t.getButton(u))==null?void 0:(a=i.getMenuWindow())==null?void 0:a.close();(l=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(o=l.getButton(v))==null?void 0:o.setState(r.ButtonState.DISABLED);(n=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(b=n.getButton(p))==null?void 0:b.setState(r.ButtonState.DISABLED);(d=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(c=d.getButton(u))==null?void 0:c.setState(r.ButtonState.WAITING);this.getTodoEditor().cancel({analytics:{...babelHelpers.classPrivateFieldLooseBase(this,C)[C],element:s.TodoEditorV2.AnalyticsElement.skipPeriodButton,notificationSkipPeriod:e}});babelHelpers.classPrivateFieldLooseBase(this,g)[g].saveSkippedPeriod(e).then((()=>{var s;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e);babelHelpers.classPrivateFieldLooseBase(this,I)[I].setSelectedValue(e);babelHelpers.classPrivateFieldLooseBase(this,x)[x]();babelHelpers.classPrivateFieldLooseBase(this,y)[y]=true;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]();(s=babelHelpers.classPrivateFieldLooseBase(this,E)[E]())==null?void 0:s.close()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}))}function ue(){var e,s,t,i,a,l;(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(s=e.getButton(v))==null?void 0:s.setState(r.ButtonState.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(i=t.getButton(p))==null?void 0:i.setState(r.ButtonState.DISABLED);(a=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(l=a.getButton(u))==null?void 0:l.setState(r.ButtonState.DISABLED);this.getTodoEditor().save().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]();if(!(Object.hasOwn(e,"errors")&&e.errors.length>0)){var s;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=true;babelHelpers.classPrivateFieldLooseBase(this,W)[W]();(s=babelHelpers.classPrivateFieldLooseBase(this,E)[E]())==null?void 0:s.close()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}))}function Pe(){void this.getTodoEditor().cancel({analytics:{...babelHelpers.classPrivateFieldLooseBase(this,C)[C],element:s.TodoEditorV2.AnalyticsElement.cancelButton}}).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,W)[W]()}))}function he(){var e,s,t,i,a,l;(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(s=e.getButton(v))==null?void 0:s.setState(null);(t=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(i=t.getButton(p))==null?void 0:i.setState(null);(a=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(l=a.getButton(u))==null?void 0:l.setState(null)}function Be(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:e.close()}function Fe(){var e;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=true;if(babelHelpers.classPrivateFieldLooseBase(this,w)[w]()&&babelHelpers.classPrivateFieldLooseBase(this,m)[m]){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,E)[E]())==null?void 0:s.minimize();return}(e=babelHelpers.classPrivateFieldLooseBase(this,E)[E]())==null?void 0:e.close()}function Le(){if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const i=e.getPropertyValue("--ui-color-base-solid")||"#000000";const{innerWidth:a}=window;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=o.PopupManager.create({id:`todo-create-confirm-${babelHelpers.classPrivateFieldLooseBase(this,h)[h]}-${babelHelpers.classPrivateFieldLooseBase(this,B)[B]}`,closeIcon:false,padding:t,overlay:{opacity:40,backgroundColor:i},content:babelHelpers.classPrivateFieldLooseBase(this,z)[z](),minWidth:537,width:Math.round(a*.45),maxWidth:737,events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this),onFirstShow:()=>{this.getTodoEditor().show();this.getTodoEditor().setFocused()}},className:"crm-activity__todo-create-notification-popup"})}babelHelpers.classPrivateFieldLooseBase(this,T)[T].show();setTimeout((()=>{this.getTodoEditor().setFocused()}),10);setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,T)[T].setClosingByEsc(true);a.Event.bind(document,"keyup",(e=>{if(e.key==="Escape"){void this.getTodoEditor().cancel({analytics:{...babelHelpers.classPrivateFieldLooseBase(this,C)[C],element:s.TodoEditorV2.AnalyticsElement.cancelButton}})}}))}),300)}function He(){return babelHelpers.classPrivateFieldLooseBase(this,S)[S].remember("content",(()=>{const e=a.Tag.render(b||(b=n`
				<div class="crm-activity__todo-create-notification_footer">
					<div class="crm-activity__todo-create-notification_buttons-container">
						<button 
							class="ui-btn ui-btn-xs ui-btn-primary ui-btn-round"
							onclick="${0}"
						>
							${0}
						</button>
						<button
							class="ui-btn ui-btn-xs ui-btn-link"
							onclick="${0}"
						>
							${0}
						</button>
					</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,R)[R].bind(this),a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_OK_BUTTON_V2"),babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this),a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL_BUTTON_V2"),babelHelpers.classPrivateFieldLooseBase(this,J)[J]().render());return a.Tag.render(d||(d=n`
				<div>
					<div class="crm-activity__todo-create-notification_title --v2">
						${0}
					</div>
					<div>
						${0}
					</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,q)[q](),babelHelpers.classPrivateFieldLooseBase(this,G)[G](),e)}))}function ye(){return babelHelpers.classPrivateFieldLooseBase(this,S)[S].remember("editor",(()=>a.Tag.render(c||(c=n`<div></div>`))))}function fe(){let e=null;switch(babelHelpers.classPrivateFieldLooseBase(this,h)[h]){case BX.CrmEntityType.enumeration.lead:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_LEAD";break;case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_DEAL";break;default:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2"}return a.Loc.getMessage(e)}function Te(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().setNoCaps().addClass("crm-activity__todo-create-notification_skip-button")}function Oe(){return new r.Button({text:a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_V2"),color:r.ButtonColor.LINK,id:u,dropdown:true,menu:{closeByEsc:true,items:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](),minWidth:233}})}function ge(){return[{id:"day",text:a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY"),onclick:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this,"day")},{id:"week",text:a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK"),onclick:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this,"week")},{id:"month",text:a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH"),onclick:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this,"month")},{id:"forever",text:a.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER"),onclick:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this,"forever")}]}function Ie(){if(top.BX&&top.BX.Runtime){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h];void top.BX.Runtime.loadExtension("crm.activity.todo-notification-skip").then((s=>{const t=new s.TodoNotificationSkip({entityTypeId:e});t.showCancelPeriodNotification()}))}}e.TodoCreateNotification=se})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX.Crm.Activity,BX.Crm.Activity,BX,BX.Event,BX.Main,BX.UI);
//# sourceMappingURL=todo-create-notification.bundle.map.js