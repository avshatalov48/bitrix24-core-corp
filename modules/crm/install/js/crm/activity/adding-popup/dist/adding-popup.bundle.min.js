this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,a,l){"use strict";function n(e,t){o(e,t);t.add(e)}function r(e,t,i){o(e,t);t.set(e,i)}function o(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function c(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var h=new WeakMap;var b=new WeakMap;var v=new WeakMap;var u=new WeakMap;var d=new WeakMap;var p=new WeakSet;var f=new WeakSet;var P=new WeakSet;var w=new WeakSet;var S=new WeakSet;let H=function(){function e(i,s,a){babelHelpers.classCallCheck(this,e);n(this,S);n(this,w);n(this,P);n(this,f);n(this,p);r(this,h,{writable:true,value:null});r(this,b,{writable:true,value:null});r(this,v,{writable:true,value:null});r(this,u,{writable:true,value:null});r(this,d,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,h,t.Text.toInteger(s));babelHelpers.classPrivateFieldSet(this,b,t.Text.toInteger(i));babelHelpers.classPrivateFieldSet(this,d,new l.EventEmitter);babelHelpers.classPrivateFieldGet(this,d).setEventNamespace("Crm.Activity.AddingPopup");if(!t.Type.isPlainObject(a)){a={}}if(t.Type.isObject(a.events)){for(const e in a.events){if(t.Type.isFunction(a.events[e])){babelHelpers.classPrivateFieldGet(this,d).subscribe(e,a.events[e])}}}}babelHelpers.createClass(e,[{key:"show",value:function e(t){const i=c(this,p,F).call(this);i.setBindElement(t);if(i.isShown()){return}if(!i.getContentContainer().hasChildNodes()){babelHelpers.classPrivateFieldSet(this,u,new a.TodoEditor({container:i.getContentContainer(),ownerTypeId:babelHelpers.classPrivateFieldGet(this,b),ownerId:babelHelpers.classPrivateFieldGet(this,h),events:{onChangeDescription:c(this,w,G).bind(this),onSaveHotkeyPressed:c(this,S,C).bind(this)}}));i.setButtons([new s.SaveButton({id:"save",color:s.ButtonColor.PRIMARY,size:s.ButtonSize.EXTRA_SMALL,round:true,events:{click:c(this,f,B).bind(this)}}),new s.CancelButton({id:"cancel",size:s.ButtonSize.EXTRA_SMALL,round:true,events:{click:()=>i.close()}})]);i.subscribeOnce("onFirstShow",(()=>babelHelpers.classPrivateFieldGet(this,u).show()));i.subscribe("onAfterShow",(()=>{c(this,P,g).call(this,babelHelpers.classPrivateFieldGet(this,u).getDescription());babelHelpers.classPrivateFieldGet(this,u).setFocused()}));i.subscribe("onAfterClose",(()=>{babelHelpers.classPrivateFieldGet(this,u).resetToDefaults();babelHelpers.classPrivateFieldGet(this,d).emit("onClose")}))}i.show()}}]);return e}();function F(){if(!babelHelpers.classPrivateFieldGet(this,v)){babelHelpers.classPrivateFieldSet(this,v,i.PopupManager.create({id:`kanban_planner_menu_${babelHelpers.classPrivateFieldGet(this,h)}`,overlay:{opacity:0},isScrollBlock:true,className:"crm-activity-adding-popup",closeByEsc:true,closeIcon:false,angle:{offset:27},minWidth:500,padding:16,minHeight:150}))}return babelHelpers.classPrivateFieldGet(this,v)}function B(){if(babelHelpers.classPrivateFieldGet(this,v)){const e=babelHelpers.classPrivateFieldGet(this,v).getButton("save");if(e.getState()){return}e===null||e===void 0?void 0:e.setWaiting(true);babelHelpers.classPrivateFieldGet(this,u).save().then((()=>{babelHelpers.classPrivateFieldGet(this,v).close();babelHelpers.classPrivateFieldGet(this,d).emit("onSave")})).catch((()=>{})).finally((()=>e===null||e===void 0?void 0:e.setWaiting(false)))}}function g(e){if(babelHelpers.classPrivateFieldGet(this,v)&&babelHelpers.classPrivateFieldGet(this,v).isShown()){babelHelpers.classPrivateFieldGet(this,v).adjustPosition({forceBindPosition:true});const t=babelHelpers.classPrivateFieldGet(this,v).getButton("save");if(!e.length&&t&&!t.getState()){t.setState(s.ButtonState.DISABLED)}else if(e.length&&t&&t.getState()===s.ButtonState.DISABLED){t.setState(null)}}}function G(e){const{description:t}=e.getData();c(this,P,g).call(this,t)}function C(){c(this,f,B).call(this)}e.AddingPopup=H})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX,BX.Main,BX.UI,BX.Crm.Activity,BX.Event);
//# sourceMappingURL=adding-popup.bundle.map.js