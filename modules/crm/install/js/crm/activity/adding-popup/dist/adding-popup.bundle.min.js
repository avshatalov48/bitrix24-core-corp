this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,a,l){"use strict";let n=e=>e,r;function c(e,t){h(e,t);t.add(e)}function o(e,t,i){h(e,t);t.set(e,i)}function h(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function b(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var v=new WeakMap;var d=new WeakMap;var u=new WeakMap;var p=new WeakMap;var P=new WeakMap;var f=new WeakMap;var H=new WeakSet;var w=new WeakSet;var F=new WeakSet;var S=new WeakSet;var B=new WeakSet;var g=new WeakSet;let G=function(){function e(i,s,a){babelHelpers.classCallCheck(this,e);c(this,g);c(this,B);c(this,S);c(this,F);c(this,w);c(this,H);o(this,v,{writable:true,value:null});o(this,d,{writable:true,value:null});o(this,u,{writable:true,value:null});o(this,p,{writable:true,value:null});o(this,P,{writable:true,value:null});o(this,f,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,v,t.Text.toInteger(s));babelHelpers.classPrivateFieldSet(this,d,t.Text.toInteger(i));babelHelpers.classPrivateFieldSet(this,f,new l.EventEmitter);babelHelpers.classPrivateFieldGet(this,f).setEventNamespace("Crm.Activity.AddingPopup");if(!t.Type.isPlainObject(a)){a={}}if(t.Type.isObject(a.events)){for(const e in a.events){if(t.Type.isFunction(a.events[e])){babelHelpers.classPrivateFieldGet(this,f).subscribe(e,a.events[e])}}}}babelHelpers.createClass(e,[{key:"show",value:function e(t){const i=b(this,H,m).call(this);i.setBindElement(t);if(i.isShown()){return}if(!babelHelpers.classPrivateFieldGet(this,p).hasChildNodes()){babelHelpers.classPrivateFieldSet(this,P,new a.TodoEditor({container:babelHelpers.classPrivateFieldGet(this,p),ownerTypeId:babelHelpers.classPrivateFieldGet(this,d),ownerId:babelHelpers.classPrivateFieldGet(this,v),events:{onChangeDescription:b(this,S,C).bind(this),onSaveHotkeyPressed:b(this,B,W).bind(this),onChangeUploaderContainerSize:b(this,g,A).bind(this)}}));i.setButtons([new s.SaveButton({id:"save",color:s.ButtonColor.PRIMARY,size:s.ButtonSize.EXTRA_SMALL,round:true,events:{click:b(this,w,k).bind(this)}}),new s.CancelButton({id:"cancel",size:s.ButtonSize.EXTRA_SMALL,round:true,events:{click:()=>i.close()}})]);i.subscribeOnce("onFirstShow",(()=>babelHelpers.classPrivateFieldGet(this,P).show()));i.subscribe("onAfterShow",(()=>{b(this,F,y).call(this,babelHelpers.classPrivateFieldGet(this,P).getDescription());babelHelpers.classPrivateFieldGet(this,P).setFocused()}));i.subscribe("onAfterClose",(()=>{babelHelpers.classPrivateFieldGet(this,P).resetToDefaults();babelHelpers.classPrivateFieldGet(this,f).emit("onClose")}))}i.show()}}]);return e}();function m(){if(!babelHelpers.classPrivateFieldGet(this,u)){babelHelpers.classPrivateFieldSet(this,p,t.Tag.render(r||(r=n`<div class="crm-activity-adding-popup-container"></div>`)));babelHelpers.classPrivateFieldSet(this,u,i.PopupManager.create({id:`kanban_planner_menu_${babelHelpers.classPrivateFieldGet(this,v)}`,overlay:{opacity:0},content:babelHelpers.classPrivateFieldGet(this,p),isScrollBlock:true,className:"crm-activity-adding-popup",closeByEsc:true,closeIcon:false,angle:{offset:27},padding:16,minWidth:500,maxWidth:550,minHeight:150,maxHeight:400}))}return babelHelpers.classPrivateFieldGet(this,u)}function k(){if(babelHelpers.classPrivateFieldGet(this,u)){const e=babelHelpers.classPrivateFieldGet(this,u).getButton("save");if(e.getState()){return}e===null||e===void 0?void 0:e.setWaiting(true);babelHelpers.classPrivateFieldGet(this,P).save().then((()=>{babelHelpers.classPrivateFieldGet(this,u).close();babelHelpers.classPrivateFieldGet(this,f).emit("onSave")})).catch((()=>{})).finally((()=>e===null||e===void 0?void 0:e.setWaiting(false)))}}function y(e){if(babelHelpers.classPrivateFieldGet(this,u)&&babelHelpers.classPrivateFieldGet(this,u).isShown()){babelHelpers.classPrivateFieldGet(this,u).adjustPosition({forceBindPosition:true});const t=babelHelpers.classPrivateFieldGet(this,u).getButton("save");if(!e.length&&t&&!t.getState()){t.setState(s.ButtonState.DISABLED)}else if(e.length&&t&&t.getState()===s.ButtonState.DISABLED){t.setState(null)}}}function C(e){const{description:t}=e.getData();b(this,F,y).call(this,t)}function W(){b(this,w,k).call(this)}function A(){if(babelHelpers.classPrivateFieldGet(this,u)){babelHelpers.classPrivateFieldGet(this,u).adjustPosition()}}e.AddingPopup=G})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX,BX.Main,BX.UI,BX.Crm.Activity,BX.Event);
//# sourceMappingURL=adding-popup.bundle.map.js