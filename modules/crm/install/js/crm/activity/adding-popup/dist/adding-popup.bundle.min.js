this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,a,l,r){"use strict";let n=e=>e,o,c,d;function b(e,t){v(e,t);t.add(e)}function h(e,t,i){v(e,t);t.set(e,i)}function v(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function u(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var p=new WeakMap;var P=new WeakMap;var w=new WeakMap;var H=new WeakMap;var F=new WeakMap;var f=new WeakMap;var S=new WeakMap;var G=new WeakMap;var y=new WeakMap;var m=new WeakMap;var g=new WeakMap;var T=new WeakMap;var k=new WeakSet;var W=new WeakSet;var M=new WeakSet;var A=new WeakSet;var B=new WeakSet;var C=new WeakSet;var E=new WeakSet;var I=new WeakSet;var D=new WeakSet;var X=new WeakSet;var _=new WeakSet;let j=function(){function e(t,a,l,r,n){babelHelpers.classCallCheck(this,e);b(this,_);b(this,X);b(this,D);b(this,I);b(this,E);b(this,C);b(this,B);b(this,A);b(this,M);b(this,W);b(this,k);h(this,p,{writable:true,value:null});h(this,P,{writable:true,value:null});h(this,w,{writable:true,value:null});h(this,H,{writable:true,value:null});h(this,F,{writable:true,value:null});h(this,f,{writable:true,value:null});h(this,S,{writable:true,value:null});h(this,G,{writable:true,value:null});h(this,y,{writable:true,value:null});h(this,m,{writable:true,value:null});h(this,g,{writable:true,value:null});h(this,T,{writable:true,value:{}});babelHelpers.classPrivateFieldSet(this,p,i.Text.toInteger(a));babelHelpers.classPrivateFieldSet(this,P,i.Text.toInteger(t));babelHelpers.classPrivateFieldSet(this,w,l);babelHelpers.classPrivateFieldSet(this,g,new s.EventEmitter);babelHelpers.classPrivateFieldGet(this,g).setEventNamespace("Crm.Activity.AddingPopup");if(i.Type.isObject(r)){var o,c,d;babelHelpers.classPrivateFieldSet(this,H,(o=r.pingSettings)!==null&&o!==void 0?o:null);babelHelpers.classPrivateFieldSet(this,F,(c=r.calendarSettings)!==null&&c!==void 0?c:null);babelHelpers.classPrivateFieldSet(this,f,(d=r.colorSettings)!==null&&d!==void 0?d:null)}if(!i.Type.isPlainObject(n)){n={}}if(i.Type.isObject(n.events)){for(const e in n.events){if(i.Type.isFunction(n.events[e])){babelHelpers.classPrivateFieldGet(this,g).subscribe(e,n.events[e])}}}if(i.Type.isPlainObject(n.context)){babelHelpers.classPrivateFieldSet(this,T,n.context)}}babelHelpers.createClass(e,[{key:"show",value:async function e(i=t.TodoEditorMode.ADD){const s=u(this,A,U).call(this);if(s.isShown()){return}if(!babelHelpers.classPrivateFieldGet(this,y).hasChildNodes()){await u(this,k,x).call(this);s.setButtons([new l.SaveButton({id:"save",color:l.ButtonColor.PRIMARY,size:l.ButtonSize.EXTRA_SMALL,round:true,events:{click:u(this,E,R).bind(this)}}),new l.CancelButton({id:"cancel",size:l.ButtonSize.EXTRA_SMALL,round:true,events:{click:()=>s.close()}})]);s.subscribeOnce("onFirstShow",(e=>{e.target.getZIndexComponent().setZIndex(1400);babelHelpers.classPrivateFieldGet(this,m).show()}));s.subscribe("onAfterShow",(()=>{u(this,I,$).call(this);babelHelpers.classPrivateFieldGet(this,m).setFocused()}));s.subscribe("onAfterClose",(()=>{void babelHelpers.classPrivateFieldGet(this,m).resetToDefaults().then((()=>{babelHelpers.classPrivateFieldGet(this,g).emit("onClose")}))}));s.subscribe("onShow",(()=>{const{mode:e,activity:i}=s.params;if(e===t.TodoEditorMode.UPDATE&&i){babelHelpers.classPrivateFieldGet(this,m).setMode(e).setActivityId(i.id).setDescription(i.description).setDeadline(i.deadline)}}))}u(this,W,z).call(this,s,i)}}]);return e}();async function x(){var e,i,s,a;const l={container:babelHelpers.classPrivateFieldGet(this,y),ownerTypeId:babelHelpers.classPrivateFieldGet(this,P),ownerId:babelHelpers.classPrivateFieldGet(this,p),currentUser:babelHelpers.classPrivateFieldGet(this,w),pingSettings:babelHelpers.classPrivateFieldGet(this,H),events:{onSaveHotkeyPressed:u(this,D,V).bind(this),onChangeUploaderContainerSize:u(this,X,Y).bind(this),onFocus:u(this,_,Z).bind(this)},popupMode:true};const r=(e=(i=babelHelpers.classPrivateFieldGet(this,T))===null||i===void 0?void 0:i.analytics)!==null&&e!==void 0?e:{};const n=(s=r.c_section)!==null&&s!==void 0?s:null;const o=(a=r.c_sub_section)!==null&&a!==void 0?a:null;l.calendarSettings=babelHelpers.classPrivateFieldGet(this,F);l.colorSettings=babelHelpers.classPrivateFieldGet(this,f);l.defaultDescription="";l.analytics={section:n,subSection:o};babelHelpers.classPrivateFieldSet(this,m,new t.TodoEditorV2(l))}function z(e,i=t.TodoEditorMode.ADD){e.params.mode=i;if(i===t.TodoEditorMode.ADD){e.show();return}if(i===t.TodoEditorMode.UPDATE){void u(this,M,L).call(this).then((t=>{if(t){e.params.activity=t;e.show()}}));return}console.error("Wrong TodoEditor mode")}function L(){const e={ownerTypeId:babelHelpers.classPrivateFieldGet(this,P),ownerId:babelHelpers.classPrivateFieldGet(this,p)};return new Promise(((t,s)=>{i.ajax.runAction("crm.activity.todo.getNearest",{data:e}).then((({data:e})=>t(e))).catch((e=>{r.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3});s()}))}))}function U(){if(!babelHelpers.classPrivateFieldGet(this,S)||babelHelpers.classPrivateFieldGet(this,S).isDestroyed()){babelHelpers.classPrivateFieldSet(this,y,i.Tag.render(o||(o=n`<div></div>`)));babelHelpers.classPrivateFieldSet(this,G,i.Tag.render(c||(c=n`
				<div class="crm-activity-adding-popup-container">
					${0}
					${0}
				</div>
			`),u(this,B,N).call(this),babelHelpers.classPrivateFieldGet(this,y)));babelHelpers.classPrivateFieldSet(this,S,new a.Popup(u(this,C,O).call(this)))}return babelHelpers.classPrivateFieldGet(this,S)}function N(){return i.Tag.render(d||(d=n`
			<div class="crm-activity-adding-popup-title">
				${0}
			</div>
		`),i.Loc.getMessage("CRM_ACTIVITY_ADDING_POPUP_TITLE"))}function O(){const{innerWidth:e}=window;return{id:`kanban_planner_menu_${babelHelpers.classPrivateFieldGet(this,p)}`,content:babelHelpers.classPrivateFieldGet(this,G),cacheable:false,isScrollBlock:true,className:"crm-activity-adding-popup",closeByEsc:true,closeIcon:false,padding:16,minWidth:537,width:Math.round(e*.45),maxWidth:737,minHeight:150,maxHeight:482,overlay:{opacity:50}}}function R(){if(babelHelpers.classPrivateFieldGet(this,S)){const e=babelHelpers.classPrivateFieldGet(this,S).getButton("save");if(e.getState()){return}e===null||e===void 0?void 0:e.setWaiting(true);babelHelpers.classPrivateFieldGet(this,m).save().then((()=>{babelHelpers.classPrivateFieldGet(this,S).close();babelHelpers.classPrivateFieldGet(this,g).emit("onSave")})).catch((()=>{})).finally((()=>e===null||e===void 0?void 0:e.setWaiting(false)))}}function $(e){if(babelHelpers.classPrivateFieldGet(this,S)&&babelHelpers.classPrivateFieldGet(this,S).isShown()){babelHelpers.classPrivateFieldGet(this,g).emit("onActualizePopupLayout",{entityId:babelHelpers.classPrivateFieldGet(this,p)});babelHelpers.classPrivateFieldGet(this,S).adjustPosition({forceBindPosition:true})}}function V(){u(this,E,R).call(this)}function Y(){if(babelHelpers.classPrivateFieldGet(this,S)){babelHelpers.classPrivateFieldGet(this,g).emit("onActualizePopupLayout",{entityId:babelHelpers.classPrivateFieldGet(this,p)});babelHelpers.classPrivateFieldGet(this,S).adjustPosition()}}function Z(){setTimeout((()=>{const e=u(this,A,U).call(this);e.adjustPosition({forceBindPosition:true})}),0)}e.AddingPopup=j})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX,BX.Event,BX.Main,BX.UI,BX);
//# sourceMappingURL=adding-popup.bundle.map.js