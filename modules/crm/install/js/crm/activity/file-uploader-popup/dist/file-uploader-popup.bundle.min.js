this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,l,t,a){"use strict";let i=e=>e,o,r;const d="save";const c="cancel";var n=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var b=babelHelpers.classPrivateFieldLooseKey("entityId");var v=babelHelpers.classPrivateFieldLooseKey("files");var p=babelHelpers.classPrivateFieldLooseKey("ownerTypeId");var u=babelHelpers.classPrivateFieldLooseKey("ownerId");var P=babelHelpers.classPrivateFieldLooseKey("popup");var h=babelHelpers.classPrivateFieldLooseKey("fileUploader");var B=babelHelpers.classPrivateFieldLooseKey("updateFiles");var L=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var F=babelHelpers.classPrivateFieldLooseKey("closePopup");var y=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var H=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var f=babelHelpers.classPrivateFieldLooseKey("getPopupButtons");var I=babelHelpers.classPrivateFieldLooseKey("changeUploaderContainerSize");class g{constructor(e){Object.defineProperty(this,I,{value:C});Object.defineProperty(this,f,{value:j});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,y,{value:O});Object.defineProperty(this,F,{value:m});Object.defineProperty(this,L,{value:S});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,n,{writable:true,value:null});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,v,{writable:true,value:[]});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=s.Type.isArrayFilled(e.files)?e.files:[];babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.ownerTypeId;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.ownerId}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const a=e.getPropertyValue("--ui-color-base-solid")||"#000000";babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new l.Popup({className:"crm-activity__file-uploader-popup",closeIcon:true,closeByEsc:true,padding:t,overlay:{opacity:40,backgroundColor:a},cacheable:false,content:babelHelpers.classPrivateFieldLooseBase(this,y)[y](),buttons:babelHelpers.classPrivateFieldLooseBase(this,f)[f](),minWidth:650,width:650,maxHeight:650})}babelHelpers.classPrivateFieldLooseBase(this,P)[P].show()}}function w(){var e,l,a,i;(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(l=e.getButton(d))==null?void 0:l.setState(t.ButtonState.WAITING);(a=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(i=a.getButton(c))==null?void 0:i.setState(t.ButtonState.DISABLED);s.ajax.runAction("crm.activity.todo.updateFiles",{data:{ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,p)[p],ownerId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],id:babelHelpers.classPrivateFieldLooseBase(this,b)[b],fileTokens:babelHelpers.classPrivateFieldLooseBase(this,h)[h]?babelHelpers.classPrivateFieldLooseBase(this,h)[h].getServerFileIds():[]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]();if(!(e.hasOwnProperty("errors")&&e.errors.length)){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}))}function S(){var e,s,l,t;(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(s=e.getButton(d))==null?void 0:s.setState(null);(l=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(t=l.getButton(c))==null?void 0:t.setState(null)}function m(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:e.close()}function O(){const e=s.Tag.render(o||(o=i`<div></div>`));const l=s.Tag.render(r||(r=i`<div class="crm-activity__file-uploader">
			<div class="crm-activity__file-uploader_title">${0}</div>
			<div class="crm-activity__file-uploader_content">
				${0}
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,H)[H](),e);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new a.FileUploader({events:{"File:onComplete":e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]()},"File:onRemove":e=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,L)[L]()},onUploadStart:e=>{var s,l,a,i;babelHelpers.classPrivateFieldLooseBase(this,I)[I]();(s=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(l=s.getButton(d))==null?void 0:l.setState(t.ButtonState.DISABLED);(a=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(i=a.getButton(c))==null?void 0:i.setState(t.ButtonState.DISABLED)}},ownerId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,p)[p],activityId:babelHelpers.classPrivateFieldLooseBase(this,b)[b],files:babelHelpers.classPrivateFieldLooseBase(this,v)[v]});babelHelpers.classPrivateFieldLooseBase(this,h)[h].renderTo(e);return l}function _(){return s.Loc.getMessage("CRM_FILE_UPLOADER_POPUP_TITLE_2")}function j(){return[new t.SaveButton({id:d,round:true,state:t.ButtonState.DISABLED,events:{click:babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this)}}),new t.CancelButton({id:c,round:true,events:{click:babelHelpers.classPrivateFieldLooseBase(this,F)[F].bind(this)},text:s.Loc.getMessage("CRM_FILE_UPLOADER_POPUP_CANCEL"),color:t.ButtonColor.LIGHT_BORDER})]}function C(){if(babelHelpers.classPrivateFieldLooseBase(this,P)[P]){babelHelpers.classPrivateFieldLooseBase(this,P)[P].adjustPosition()}}e.FileUploaderPopup=g})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX,BX.Main,BX.UI,BX.Crm.Activity);
//# sourceMappingURL=file-uploader-popup.bundle.map.js