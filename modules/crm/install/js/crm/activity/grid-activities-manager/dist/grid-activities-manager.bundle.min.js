this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s){"use strict";const i=s.Reflection.namespace("BX.util");var t=babelHelpers.classPrivateFieldLooseKey("activityTypes");var a=babelHelpers.classPrivateFieldLooseKey("showProviderSix");var r=babelHelpers.classPrivateFieldLooseKey("showRestApp");var o=babelHelpers.classPrivateFieldLooseKey("showCalendarSharing");var l=babelHelpers.classPrivateFieldLooseKey("showTask");var n=babelHelpers.classPrivateFieldLooseKey("getCurrentUserId");var c=babelHelpers.classPrivateFieldLooseKey("fetchActivity");class d{constructor(){Object.defineProperty(this,c,{value:P});Object.defineProperty(this,n,{value:y});Object.defineProperty(this,l,{value:u});Object.defineProperty(this,o,{value:b});Object.defineProperty(this,r,{value:v});Object.defineProperty(this,a,{value:p});this.activityAddingPopup={}}async showAddPopup(e,i,t,a,r,o){s.Dom.addClass(e,"--active");const l=`${t}_${a}`;const n=await s.Runtime.loadExtension("crm.activity.adding-popup");if(!n||!n.AddingPopup){return}if(!Object.hasOwn(this.activityAddingPopup,l)){this.activityAddingPopup[l]=new n.AddingPopup(t,a,r,o,{events:{onClose(){BX.Dom.removeClass(e,"--active")},onSave(){const e=BX.Main.gridManager.getById(i);if(e){e.instance.reload()}}}})}this.activityAddingPopup[l].show()}async viewActivity(e,s,i){try{const e=await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s);if(!e){return}if(e.customViewLink){BX.Crm.Page.open(e.customViewLink)}else{this.openActivityDialog(e,i)}}catch(e){console.error(e)}}openActivityDialog(e,s){const i=parseInt(e.typeID,10);if(i===babelHelpers.classPrivateFieldLooseBase(d,t)[t].provider&&BX.CrmActivityProvider){babelHelpers.classPrivateFieldLooseBase(this,a)[a](e,s)}else if(i===babelHelpers.classPrivateFieldLooseBase(d,t)[t].task){babelHelpers.classPrivateFieldLooseBase(this,l)[l](e,s)}}}function p(e,s){const i=e.providerID;switch(i){case"CRM_TASKS_TASK":case"CRM_TASKS_TASK_COMMENT":babelHelpers.classPrivateFieldLooseBase(this,l)[l](e,s);break;case"REST_APP":case"CONFIGURABLE_REST_APP":babelHelpers.classPrivateFieldLooseBase(this,r)[r](e);break;case"CRM_CALENDAR_SHARING":babelHelpers.classPrivateFieldLooseBase(this,o)[o](e);break;default:}}function v(e){BX.rest.AppLayout.openApplication(e.associatedEntityID||0,{action:"view_activity",activity_id:e.ID||0})}function b(e){const s=parseInt(e.calendarEventId,10);if(!s){return}if((window.top.BX||window.BX).Calendar.SliderLoader){const e=`crm-calendar-slider-${s}-${Math.floor(Math.random()*1e3)}`;new(window.top.BX||window.BX).Calendar.SliderLoader(s,{sliderId:e}).show()}}function u(e,s){const i=parseInt(e.associatedEntityID,10);if(i<=0){return}let t=s?"/company/personal/user/#user_id#/tasks/task/edit/#task_id#/":"/company/personal/user/#user_id#/tasks/task/view/#task_id#/";t=t.replace("#user_id#",babelHelpers.classPrivateFieldLooseBase(this,n)[n]());t=t.replace("#task_id#",i);if(BX.SidePanel){BX.SidePanel.Instance.open(t)}else{window.top.location.href=t}}function y(){return BX.message("USER_ID")}async function P(e){return new Promise(((t,a)=>{const r=i.add_url_param("/bitrix/components/bitrix/crm.activity.editor/ajax.php",{id:e,action:"get_activity",sessid:BX.bitrix_sessid()});s.ajax({url:r,method:"POST",dataType:"json",data:{ACTION:"GET_ACTIVITY",ID:e},onsuccess:e=>{if(e.ERROR){a(e.ERROR)}else{t(e.ACTIVITY||null)}},onfailure:e=>{a(e)}})}))}Object.defineProperty(d,t,{writable:true,value:{task:3,provider:6}});var h=babelHelpers.classPrivateFieldLooseKey("instance");class w{static showActivityAddingPopup(e,s,i,t,a,r){void w.getManagerInstance().showAddPopup(e,s,i,t,a,r)}static viewActivity(e,s,i){void w.getManagerInstance().viewActivity(e,s,i)}static getManagerInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,h)[h]){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new d}return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}}Object.defineProperty(w,h,{writable:true,value:null});e.GridActivitiesManager=w})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX);
//# sourceMappingURL=grid-activities-manager.bundle.map.js