{"version":3,"file":"todo-ping-settings-menu.bundle.js","sources":["../src/todo-ping-settings-menu.js"],"sourcesContent":["import { Dom, Loc, Type } from 'main.core';\nimport { MenuItem } from 'main.popup';\n\nimport 'ui.hint';\n\ndeclare type TodoPingSettingsMenuParams = {\n\tentityTypeId: number,\n\tsettings: {\n\t\toptionName: string,\n\t\toffsetList: Array,\n\t\tcurrentOffsets: Array,\n\t}\n}\n\nconst MENU_ITEM_CLASS_ACTIVE = 'menu-popup-item-accept';\nconst MENU_ITEM_CLASS_INACTIVE = 'menu-popup-item-none';\nconst SAVE_OFFSETS_REQUEST_DELAY = 750;\n\nexport class TodoPingSettingsMenu\n{\n\t#entityTypeId: number = null;\n\t#settings: Object = null;\n\t#selectedOffsets: ?Array<number> = null;\n\t#isLoadingMenuItem: Boolean = false;\n\n\tconstructor(params: TodoPingSettingsMenuParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#settings = params.settings;\n\t\tif (!Type.isStringFilled(this.#settings.optionName))\n\t\t{\n\t\t\tthrow new Error('Option name are not defined.');\n\t\t}\n\n\t\tthis.#selectedOffsets = this.#settings.currentOffsets || [];\n\t\tthis.#selectedOffsets = this.#selectedOffsets.map((element) => parseInt(element, 10));\n\t\tif (!Type.isArrayFilled(this.#settings.currentOffsets))\n\t\t{\n\t\t\tthrow new Error('Offsets are not defined.');\n\t\t}\n\t}\n\n\tsetSelectedValues(values: Array): void\n\t{\n\t\tthis.#selectedOffsets = values.map((element) => parseInt(element, 10));\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tconst items = [];\n\t\titems.push({\n\t\t\tid: 'askForSetupTodoPing',\n\t\t\ttext: Loc.getMessage('CRM_ACTIVITY_TODO_PING_SETTINGS_MENU_ITEM'),\n\t\t\tclassName: MENU_ITEM_CLASS_INACTIVE,\n\t\t\titems: this.#getPintSettingsMenuItems(),\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getPintSettingsMenuItems(): Array\n\t{\n\t\tif (\n\t\t\tType.isNull(this.#settings.offsetList)\n\t\t\t|| !Type.isArrayFilled(this.#settings.offsetList)\n\t\t)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.#settings.offsetList.forEach((item) => {\n\t\t\titems.push({\n\t\t\t\tid: item.id,\n\t\t\t\ttext: item.title,\n\t\t\t\tclassName: this.#getMenuItemClass(parseInt(item.offset, 10)),\n\t\t\t\tdisabled: this.#isLoading(),\n\t\t\t\tonclick: this.#onMenuItemClick.bind(this, parseInt(item.offset, 10)),\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuItemClass(offset: number): string\n\t{\n\t\treturn this.#selectedOffsets.includes(offset)\n\t\t\t? MENU_ITEM_CLASS_ACTIVE\n\t\t\t: MENU_ITEM_CLASS_INACTIVE;\n\t}\n\n\t#isLoading(): boolean\n\t{\n\t\treturn this.#isLoadingMenuItem;\n\t}\n\n\t#onMenuItemClick(offset: number, event: PointerEvent, item: MenuItem): void\n\t{\n\t\tthis.#isLoadingMenuItem = true;\n\n\t\tif (this.#selectedOffsets.includes(offset))\n\t\t{\n\t\t\tif (this.#selectedOffsets.length === 1)\n\t\t\t{\n\t\t\t\tBX.UI.Hint.show(\n\t\t\t\t\titem.getContainer(),\n\t\t\t\t\tLoc.getMessage('CRM_ACTIVITY_TODO_PING_SETTINGS_MENU_ITEM_TOOLTIP'),\n\t\t\t\t);\n\n\t\t\t\tthis.#isLoadingMenuItem = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#selectedOffsets = this.#selectedOffsets.filter((value) => value !== offset);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#selectedOffsets.push(offset);\n\n\t\t\tDom.removeClass(item.getContainer(), MENU_ITEM_CLASS_INACTIVE);\n\t\t\tDom.addClass(item.getContainer(), MENU_ITEM_CLASS_ACTIVE);\n\t\t}\n\n\t\tif (this.#selectedOffsets.length === 0)\n\t\t{\n\t\t\tthrow new Error('Offsets are not defined.');\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tBX.userOptions.save('crm', this.#settings.optionName, 'offsets', this.#selectedOffsets.join(','));\n\n\t\t\tthis.#isLoadingMenuItem = false;\n\t\t}, SAVE_OFFSETS_REQUEST_DELAY);\n\t}\n}\n"],"names":["MENU_ITEM_CLASS_ACTIVE","MENU_ITEM_CLASS_INACTIVE","SAVE_OFFSETS_REQUEST_DELAY","TodoPingSettingsMenu","constructor","params","entityTypeId","settings","Type","isStringFilled","optionName","Error","currentOffsets","map","element","parseInt","isArrayFilled","setSelectedValues","values","getItems","items","push","id","text","Loc","getMessage","className","isNull","offsetList","forEach","item","title","offset","disabled","onclick","bind","includes","event","length","BX","UI","Hint","show","getContainer","filter","value","Dom","removeClass","addClass","setTimeout","userOptions","save","join"],"mappings":"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"}