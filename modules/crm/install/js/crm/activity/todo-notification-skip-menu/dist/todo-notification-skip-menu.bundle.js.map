{"version":3,"file":"todo-notification-skip-menu.bundle.js","sources":["../src/todo-notification-skip-menu.js"],"sourcesContent":["import {MenuItem} from 'main.popup';\nimport {Loc} from \"main.core\";\nimport {TodoNotificationSkip}  from 'crm.activity.todo-notification-skip';\n\ndeclare type TodoNotificationSkipMenuParams = {\n\tselectedValue: ?string,\n\tentityTypeId: number,\n}\n\nexport class TodoNotificationSkipMenu\n{\n\t#selectedMenuItemId: ?string = null;\n\t#entityTypeId: number = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\n\tconstructor(params: TodoNotificationSkipMenuParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tif (params.selectedValue)\n\t\t{\n\t\t\tthis.#selectedMenuItemId = params.selectedValue;\n\t\t}\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t}\n\n\tsetSelectedValue(value)\n\t{\n\t\tthis.#selectedMenuItemId = value;\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#selectedMenuItemId = period;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tconst items = [];\n\t\titems.push({\n\t\t\tid: 'askForCreateTodo',\n\t\t\ttext: this.#getMenuItemText(),\n\t\t\tclassName: 'menu-popup-item-none',\n\t\t\titems: this.#getSkipPeriodsMenuItems()\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuItemText(): string\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM';\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM_DEAL';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#getSkipPeriodsMenuItems(): Array\n\t{\n\t\tconst activeClass = 'menu-popup-item-accept';\n\t\tconst inactiveClass = 'menu-popup-item-none';\n\t\tconst items = [];\n\t\titems.push({\n\t\t\tid: 'activate',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_ACTIVATE'),\n\t\t\tclassName: this.#selectedMenuItemId ? inactiveClass : activeClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, ''),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'day',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_DAY'),\n\t\t\tclassName: this.#selectedMenuItemId === 'day' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'week',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_WEEK'),\n\t\t\tclassName: this.#selectedMenuItemId === 'week' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'month',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_MONTH'),\n\t\t\tclassName: this.#selectedMenuItemId === 'month' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'forever',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_FOREVER'),\n\t\t\tclassName: this.#selectedMenuItemId === 'forever' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever'),\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#isLoading(): boolean\n\t{\n\t\treturn this.#selectedMenuItemId === 'loading';\n\t}\n\n\t#onSkipMenuItemSelect(period: string, event: PointerEvent, item: MenuItem): void\n\t{\n\t\titem.getMenuWindow()?.getRootMenuWindow()?.close();\n\n\t\tthis.#selectedMenuItemId = 'loading';\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#selectedMenuItemId = period;\n\t\t});\n\t}\n}\n"],"names":["TodoNotificationSkipMenu","constructor","params","entityTypeId","selectedValue","TodoNotificationSkip","onSkippedPeriodChange","bind","setSelectedValue","value","getItems","items","push","id","text","className","period","messagePhrase","BX","CrmEntityType","enumeration","lead","deal","Loc","getMessage","activeClass","inactiveClass","disabled","onclick","event","item","getMenuWindow","getRootMenuWindow","close","saveSkippedPeriod","then"],"mappings":"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"}