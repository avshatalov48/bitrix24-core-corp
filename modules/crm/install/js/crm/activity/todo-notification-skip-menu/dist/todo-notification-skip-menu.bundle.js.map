{"version":3,"file":"todo-notification-skip-menu.bundle.js","sources":["../src/todo-notification-skip-menu.js"],"sourcesContent":["import {MenuItem} from 'main.popup';\nimport {Loc} from \"main.core\";\nimport {TodoNotificationSkip}  from 'crm.activity.todo-notification-skip';\n\ndeclare type TodoNotificationSkipMenuParams = {\n\tselectedValue: ?string,\n\tentityTypeId: number,\n}\n\nexport class TodoNotificationSkipMenu\n{\n\t#selectedMenuItemId: ?string = null;\n\t#entityTypeId: number = null;\n\t#skipProvider: TodoNotificationSkip = null;\n\n\tconstructor(params: TodoNotificationSkipMenuParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tif (params.selectedValue)\n\t\t{\n\t\t\tthis.#selectedMenuItemId = params.selectedValue;\n\t\t}\n\t\tthis.#skipProvider = new TodoNotificationSkip({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tonSkippedPeriodChange: this.#onSkippedPeriodChange.bind(this),\n\t\t});\n\t}\n\n\tsetSelectedValue(value)\n\t{\n\t\tthis.#selectedMenuItemId = value;\n\t}\n\n\t#onSkippedPeriodChange(period: string): void\n\t{\n\t\tthis.#selectedMenuItemId = period;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tconst items = [];\n\t\titems.push({\n\t\t\tid: 'askForCreateTodo',\n\t\t\ttext: this.#getMenuItemText(),\n\t\t\tclassName: 'menu-popup-item-none',\n\t\t\titems: this.#getSkipPeriodsMenuItems()\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuItemText(): string\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM';\n\t\tswitch (this.#entityTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.lead:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM_LEAD';\n\t\t\t\tbreak;\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_MENU_ITEM_DEAL';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#getSkipPeriodsMenuItems(): Array\n\t{\n\t\tconst activeClass = 'menu-popup-item-accept';\n\t\tconst inactiveClass = 'menu-popup-item-none';\n\t\tconst items = [];\n\t\titems.push({\n\t\t\tid: 'activate',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_ACTIVATE'),\n\t\t\tclassName: this.#selectedMenuItemId ? inactiveClass : activeClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, ''),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'day',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_DAY'),\n\t\t\tclassName: this.#selectedMenuItemId === 'day' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'day'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'week',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_WEEK'),\n\t\t\tclassName: this.#selectedMenuItemId === 'week' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'week'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'month',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_MONTH'),\n\t\t\tclassName: this.#selectedMenuItemId === 'month' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'month'),\n\t\t});\n\t\titems.push({\n\t\t\tid: 'forever',\n\t\t\ttext:  Loc.getMessage('CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_PERIOD_FOREVER'),\n\t\t\tclassName: this.#selectedMenuItemId === 'forever' ? activeClass : inactiveClass,\n\t\t\tdisabled: this.#isLoading(),\n\t\t\tonclick: this.#onSkipMenuItemSelect.bind(this, 'forever'),\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#isLoading(): boolean\n\t{\n\t\treturn this.#selectedMenuItemId === 'loading';\n\t}\n\n\t#onSkipMenuItemSelect(period: string, event: PointerEvent, item: MenuItem): void\n\t{\n\t\titem.getMenuWindow()?.getRootMenuWindow()?.close();\n\n\t\tthis.#selectedMenuItemId = 'loading';\n\t\tthis.#skipProvider.saveSkippedPeriod(period).then(() => {\n\t\t\tthis.#selectedMenuItemId = period;\n\t\t});\n\t}\n}\n"],"names":["TodoNotificationSkipMenu","constructor","params","entityTypeId","selectedValue","TodoNotificationSkip","onSkippedPeriodChange","bind","setSelectedValue","value","getItems","items","push","id","text","className","period","messagePhrase","BX","CrmEntityType","enumeration","lead","deal","Loc","getMessage","activeClass","inactiveClass","disabled","onclick","event","item","getMenuWindow","getRootMenuWindow","close","saveSkippedPeriod","then"],"mappings":"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"}