(function(){"use strict";if(typeof webPacker==="undefined"){return}window.b24Tracker=window.b24Tracker||{};if(window.b24Tracker.guest){return}window.b24Tracker.guest={cookieName:"b24_crm_guest_id",returnCookieName:"b24_crm_guest_id_returned",domain:"",requestUrl:"",isInit:false,init:function(){if(this.isInit){return}this.isInit=true;this.requestUrl=(webPacker.getAddress()+"/").match(/((http|https):\/\/[^\/]+?)\//)[1]+"/pub/guest.php";t.collect();e.collect();this.checkReturn()},checkReturn:function(){if(!this.getGidCookie()||webPacker.cookie.get(this.returnCookieName)){return}i.query(this.requestUrl,{a:"event",e:"Return"},this.onAjaxResponse.bind(this));webPacker.cookie.set(this.returnCookieName,"y",3600*6)},storeTrace:function(e){i.query(this.requestUrl,{a:"storeTrace",d:{trace:e}})},link:function(e){if(!e||this.getGidCookie()){return}i.query(this.requestUrl,{a:"link",gid:e},this.onAjaxResponse.bind(this))},register:function(){if(this.getGidCookie()){return}i.query(this.requestUrl,{a:"register"},this.onAjaxResponse.bind(this))},onAjaxResponse:function(e){e=e||{};e.data=e.data||{};if(this.getGidCookie()==null&&!!e.data.gid){webPacker.cookie.set(this.cookieName,e.data.gid);webPacker.cookie.set(this.returnCookieName,"y",3600*6)}},getPages:function(){return t.list()},getTags:function(){return e.list()},getTrace:function(i){i=i||{};var r={url:window.location.href,ref:document.referrer,device:{isMobile:webPacker.browser.isMobile()},tags:e.getData(),pages:{list:t.list()},gid:this.getGidCookie()};if(i.channels){r.channels=i.channels}return JSON.stringify(r)},getUtmSource:function(){return this.getTags().utm_source||""},getGidCookie:function(){return webPacker.cookie.get(this.cookieName)}};var e={lifespan:28,lsPageKey:"b24_crm_guest_utm",tags:["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],list:function(){return this.getData().list||{}},getGCLid:function(){return this.getData().gclid||null},getTimestamp:function(e){return(e?null:parseInt(this.getData().ts))||parseInt(Date.now()/1e3)},getData:function(){return(webPacker.ls.isSupported()?webPacker.ls.getItem(this.lsPageKey):webPacker.cookie.getItem(this.lsPageKey))||{}},clear:function(){webPacker.ls.removeItem(this.lsPageKey)},collect:function(){var e=this.getTimestamp();var t=webPacker.url.parameter.getList().filter(function(e){return this.tags.indexOf(e.name)>-1},this);if(t.length>0){t=t.filter(function(e){return e.value.trim().length>0}).reduce(function(e,t){e[t.name]=decodeURIComponent(t.value);return e},{});e=this.getTimestamp(true)}else{t=this.list()}var i=webPacker.url.parameter.getList().filter(function(e){return e.name==="gclid"},this).map(function(e){return e.value});i=i[0]||this.getGCLid();if(this.getTimestamp(true)-e>this.lifespan*3600*24){this.clear();return}var r={ts:e,list:t,gclid:i};webPacker.ls.isSupported()?webPacker.ls.setItem(this.lsPageKey,r):webPacker.cookie.setItem(this.lsPageKey,r)}};var t={maxCount:5,lsPageKey:"b24_crm_guest_pages",list:function(){return webPacker.ls.getItem(this.lsPageKey)},clear:function(){webPacker.ls.removeItem(this.lsPageKey)},collect:function(){var e=document.body.querySelector("h1");e=e?e.textContent.trim():"";if(e.length===0){e=document.head.querySelector("title");e=e?e.textContent.trim():""}e=e.substring(0,40);var t=window.location.href;var i=webPacker.ls.getItem(this.lsPageKey);i=i instanceof Array?i:[];var r=-1;i.forEach(function(e,i){if(e[0]===t)r=i});if(r>-1){i=i.slice(0,r).concat(i.slice(r+1))}while(i.length>=this.maxCount){i.shift()}var n=new Date;i.push([t,Math.round(n.getTime()/1e3)+n.getTimezoneOffset()*60,e]);webPacker.ls.setItem(this.lsPageKey,i)}};var i={query:function(e,t,i){this.ajax=null;if(window.XMLHttpRequest){this.ajax=new XMLHttpRequest}else if(window.ActiveXObject){this.ajax=new window.ActiveXObject("Microsoft.XMLHTTP")}"withCredentials"in this.ajax?this.post(e,t,i):this.get(e,t)},get:function(e,t){var i=document.createElement("script");i.type="text/javascript";i.src=e+"?"+this.stringify(t);i.async=true;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)},post:function(e,t,i){var r=this.ajax;r.open("POST",e,true);r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.withCredentials=true;r.onreadystatechange=function(){if(i&&r.readyState===4&&r.status===200){i.apply(this,[JSON.parse(this.responseText)])}};r.send(this.stringify(t))},stringify:function(e){var t=[];if(Object.prototype.toString.call(e)==="[object Array]"){}else if(typeof e==="object"){for(var i in e){if(!e.hasOwnProperty(i)){continue}var r=e[i];if(typeof r==="object"){r=JSON.stringify(r)}t.push(i+"="+encodeURIComponent(r))}}return t.join("&")},getAjax:function(){if(this.ajax){return this.ajax}if(window.XMLHttpRequest){this.ajax=new XMLHttpRequest}else if(window.ActiveXObject){this.ajax=new window.ActiveXObject("Microsoft.XMLHTTP")}return this.ajax}};window.b24Tracker.guest.init()})();
//# sourceMappingURL=script.map.js