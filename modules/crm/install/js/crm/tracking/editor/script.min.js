(function(){"use strict";var e={context:null,urlParameters:null,getNode:function(e){return this.context.querySelector('[data-role="'+e+'"]')},changeClass:function(e,t,i){if(i===true){e.classList.add(t)}else if(i===false){e.classList.remove(t)}else{e.classList.toggle(t)}},getPosition:function(e){var t;try{var i=e.getBoundingClientRect();t={top:i.top,left:i.left,width:i.width,height:i.height,right:i.right,bottom:i.bottom}}catch(i){t={top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight,right:e.offsetLeft+e.offsetWidth,bottom:e.offsetTop+e.offsetHeight}}var s=document.documentElement;var o=document.body;t.top+=s.scrollTop||o.scrollTop;t.left+=s.scrollLeft||o.scrollLeft;t.right+=s.scrollLeft||o.scrollLeft;t.bottom+=s.scrollTop||o.scrollTop;t.width=t.right-t.left;t.height=t.bottom-t.top;for(var n in t){if(t.hasOwnProperty(n)){t[n]=Math.round(t[n])}}return t},addEventListener:function(e,t,i){e=e||window;if(window.addEventListener){e.addEventListener(t,i,false)}else{e.attachEvent("on"+t,i)}},removeUrlParam:function(e,t){if(t&&Object.prototype.toString.call(t)==="[object Array]"){for(var i=0;i<t.length;i++){e=BX.util.remove_url_param(e,t[i])}}else{var s,o;if((s=e.indexOf("?"))>=0&&s!==e.length-1){o=e.substr(s+1);e=e.substr(0,s+1);o=o.replace(new RegExp("(^|&)"+t+"=[^&#]*","i"),"");o=o.replace(/^&/,"");if(o&&o!==""){e=e+o}else{e=e.substr(0,e.length-1)}}}return e}};var t={createNode:function(t){return e.getNode("tracker/tmpl/"+t).cloneNode(true)},createItemSimpleNode:function(e){var t=this.createNode("item/simple");t.children[0].textContent=e;return t},createItemReplaceNode:function(e,t,i){var s=this.createNode("item/replace");var o=s.children[0];o.children[0].textContent=e;o.children[1].textContent=t;if(i){o.children[1].classList.add(i)}return s},createItemIconNode:function(e,t){t=t||"";var i=this.createNode("item/icon");i.children[0].textContent=e;i.children[0].classList.add(t.trim()||"b24-tracker-item-name-empty");return i}};var i={shadowNode:null,edgeNode:null,classShadowShow:"b24-tracker-shadow-show",classShadowHide:"b24-tracker-shadow-hide",classHighlight:"b24-tracker-shadow-highlight",init:function(){this.shadowNode=e.getNode("tracker/shadow");this.edgeNode=e.getNode("tracker/shadow/filter")},highlight:function(e,t,i){if(i){i.preventDefault();i.stopPropagation()}if(e.nodeName==="#text"){e=e.parentNode}var s=this;t=t||false;if(t){this.isShadowShowed=true;this.animateScrollTo(e,800,function(){var t=e.getBoundingClientRect();s.edgeNode.setAttribute("x",t.left-5);s.edgeNode.setAttribute("y",t.top-5);s.edgeNode.setAttribute("width",t.width+10);s.edgeNode.setAttribute("height",t.height+10)});this.shadowNode.classList.add(this.classShadowShow);this.shadowNode.classList.remove(this.classShadowHide);e.classList.add(this.classHighlight)}else{this.isShadowShowed=false;setTimeout(function(){if(!s.isShadowShowed){s.shadowNode.classList.add(s.classShadowHide);s.shadowNode.classList.remove(s.classShadowShow)}},0);e.classList.remove(this.classHighlight)}},animateScrollTo:function(t,i,s){var o=window.pageYOffset||document.documentElement.scrollTop;var n=document.documentElement.clientHeight;var r=e.getPosition(t).top-n/2+t.offsetHeight/2;this.easing({duration:i||800,start:o,finish:r,step:function(e){window.scrollTo(0,e);if(s){s()}},onFinish:function(){}})},easing:function(e){if(!window.requestAnimationFrame){e.step(e.finish);return}var t=function(e){return Math.pow(e,2)};var i=function(e){return 1-t(1-e)};var s=null;(function(e){var t=function(o){if(!s){s=o}var n=(o-s)/e.duration;if(n>1){n=1}e.step(Math.round(e.start+(e.finish-e.start)*i(n)));if(n<1){window.requestAnimationFrame(t)}else if(e.onFinish){e.onFinish()}};window.requestAnimationFrame(t)})(e)}};var s={classClosed:"b24-tracker-list-closed",classDisabled:"b24-tracker-selector-disabled",attributeDisabled:"data-disabled",toggle:function(t){e.changeClass(t,this.classClosed,this.isDisabled(t)?true:null)},isDisabled:function(e){return e.getAttribute(this.attributeDisabled)==="y"},changeDisabled:function(t,i){t.setAttribute(this.attributeDisabled,i?"y":"n");e.changeClass(t,this.classDisabled,i)},close:function(t){e.changeClass(t,this.classClosed,true)},select:function(e,t){t.innerHTML="";t.appendChild(e.children[0].cloneNode(true))},init:function(t){e.addEventListener(t,"click",this.toggle.bind(this,t));e.addEventListener(window,"click",function(e){if(!t.contains(e.target)){s.close(t)}})}};var o={isInit:false,init:function(i){this.selectorNode=e.getNode("tracker/phone");this.containerNode=e.getNode("tracker/phone/items");this.selectedNode=e.getNode("tracker/phone/selected");this.countPhone=0;this.countEmail=0;this.containerNode.innerHTML="";if(i.length===0){s.select(t.createItemIconNode(module.message("notFound")),this.selectedNode);this.disable();return}i.forEach(this.addItem,this);s.select(t.createItemSimpleNode(module.message("foundItems").replace("%phones%",this.countPhone).replace("%emails%",this.countEmail)),this.selectedNode);if(!this.isInit){s.init(this.selectorNode)}this.isInit=true},disable:function(){s.changeDisabled(this.selectorNode,true)},enable:function(){s.changeDisabled(this.selectorNode,false)},isDisabled:function(){s.isDisabled(this.selectorNode)},addItem:function(s){this.countPhone+=s.values[0].type==="phone"?1:0;this.countEmail+=s.values[0].type==="email"?1:0;var o;if(s.replaced){o=t.createItemReplaceNode(s.replaced.from,s.replaced.to)}else{o=t.createItemSimpleNode(s.values[0].value)}this.containerNode.appendChild(o);e.addEventListener(o,"click",this.onClick.bind(this));e.addEventListener(o,"mouseenter",i.highlight.bind(i,s.node,true));e.addEventListener(o,"mouseleave",i.highlight.bind(i,s.node,false))},onClick:function(e){e.preventDefault();e.stopPropagation()}};var n={parameter:"utm_source",current:"",changed:false,isInit:false,init:function(i){this.selectorNode=e.getNode("tracker/source");this.containerNode=e.getNode("tracker/source/items");this.selectedNode=e.getNode("tracker/source/selected");this.current=a.getCurrentSource()||"";var o=i||[];if(o.length===0){this.disable();s.select(t.createItemIconNode(module.message("sourcesNotConfigured")),this.selectedNode);return}o=[{code:null,name:module.message("notSelected")}].concat(o);this.containerNode.innerHTML="";o.forEach(this.addItem,this);if(!this.isInit){s.init(this.selectorNode)}this.isInit=true},disable:function(){s.changeDisabled(this.selectorNode,true)},enable:function(){s.changeDisabled(this.selectorNode,true)},isDisabled:function(){s.isDisabled(this.selectorNode)},addItem:function(i){i.node=t.createItemIconNode(i.name,i.code);this.containerNode.appendChild(i.node);e.addEventListener(i.node,"click",this.onClick.bind(this,i));if(i.code===this.current){s.select(i.node,this.selectedNode)}},onClick:function(e){s.select(e.node,this.selectedNode);var t=e.code?e.code:"";this.changed=this.current!==t;this.current=t;r.updateLocation(t)}};var r={parameter:"utm_source",hideClass:"b24-source-tracker-viewer-hide",bodyClass:"b24-tracker-body-scroll-off",deviceActiveClass:"b24-tracker-btn-active",mobile:false,init:function(){this.container=e.getNode("tracker/viewer");this.frame=e.getNode("tracker/viewer/frame");this.desktopBtn=e.getNode("tracker/viewer/device/desktop");this.mobileBtn=e.getNode("tracker/viewer/device/mobile");e.addEventListener(this.desktopBtn,"click",this.onChangeDevice.bind(this,false));e.addEventListener(this.mobileBtn,"click",this.onChangeDevice.bind(this,true))},changeDisplay:function(t){e.changeClass(this.container,this.hideClass,!t);e.changeClass(document.body,this.bodyClass,t)},onChangeDevice:function(t){e.changeClass(this.desktopBtn,this.deviceActiveClass,!t);e.changeClass(this.mobileBtn,this.deviceActiveClass,t);this.changeDisplay(t);if(t){window.scrollTo(0,0)}this.mobile=t;this.updateLocation(null);this.mobile?o.disable():o.enable()},isMobile:function(){return this.mobile},updateLocation:function(t){var i=this.frame.src;if(!this.mobile||!i){i=window.location.href.split("#")[0]}if(t!==null){i=e.removeUrlParam(i,this.parameter);i+=(i.indexOf("?")>-1?"&":"?")+(this.parameter+"="+t)}if(this.mobile){this.frame.src=i}else if(n.changed){window.location.assign(i)}}};var a={classSwitchDown:"b24-tracker-wrapper-down",status:null,init:function(t){this.connector=new b24Tracker.Connector({addressee:webPacker.getAddress(),responders:{"b24.portal.refresh":function(){window.location.reload()}}});this.connector.request(window.opener,"tracking.editor.getData",{},this.load.bind(this));this.status=t.status;this.context=document.getElementById("b24-source-tracker-editor");e.context=this.context;i.init(this.context);r.init(t);this.items=t.items;this.margin=e.getNode("tracker/margin");this.buttonClose=e.getNode("tracker/btn/close");this.buttonSwitch=e.getNode("tracker/btn/switch");if(this.buttonClose){e.addEventListener(this.buttonClose,"click",this.close.bind(this))}if(this.buttonSwitch){e.addEventListener(this.buttonSwitch,"click",this.switch.bind(this))}if(this.status.fields.get("bottom")){this.switch()}},load:function(e){window.b24Tracker.Manager.Instance.run(e);o.init(this.items||[]);n.init(e.sources)},close:function(){if(this.status){this.status.stop()}window.close()},switch:function(){this.context.classList.toggle(this.classSwitchDown);var e=this.context.classList.contains(this.classSwitchDown);if(e){document.body.appendChild(this.margin)}else{this.context.insertBefore(this.margin,this.context.firstChild)}if(this.status){this.status.fields.set("bottom",e)}},getCurrentSource:function(){return this.status?this.status.fields.get("source"):null}};if(!window.b24Tracker)window.b24Tracker={};if(!b24Tracker.Editor)b24Tracker.Editor={};if(b24Tracker.Editor.Manager)return;b24Tracker.Editor.Manager=a;if(b24Tracker.Editor.Status){b24Tracker.Editor.Status.onEditorInit()}})();
//# sourceMappingURL=script.map.js