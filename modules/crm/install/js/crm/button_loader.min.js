(function(t){if(!t.BX){t.BX={}}else if(t.BX.SiteButton){return}t.BX.SiteButton={isShown:false,init:function(e){this.loadBxAnalytics();this.userParams=t.Bitrix24WidgetObject||{};this.config=e;this.handlers=this.userParams.handlers||{};this.eventHandlers=[];this.loadGuestTracker();this.execEventHandler("init",[this]);if(!this.check()){return}this.load();if(this.config.delay){var i=this;t.setTimeout(function(){i.show()},1e3*this.config.delay)}else{this.show()}},check:function(){if(!this.config.isActivated){return false}if(this.config.widgets.length==0){return false}if(this.config.disableOnMobile&&this.util.isMobile()){return false}if(!this.wm.checkPagesAll(this)){return false}if(!this.wm.checkWorkTimeAll(this)){return false}else{return true}},loadGuestTracker:function(){var e="b24CrmGuestData";t[e]=t[e]||{name:"b24CrmGuest",ref:this.config.serverAddress+"/"};this.loadResources("manual","guest_tracker.js")},loadBxAnalytics:function(){if(typeof t._ba!="undefined"){return}var e=document.location.hostname;t._ba=t._ba||[];t._ba.push(["aid","ext:"+e]);t._ba.push(["host",e]);(function(){var t=document.createElement("script");t.type="text/javascript";t.async=true;t.src=(document.location.protocol=="https:"?"https://":"http://")+"bitrix.info/ba.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)})()},loadResources:function(t,e){this.config.resources.forEach(function(i){i.loadMode=i.loadMode||"auto";if(i.loadMode!=t){return}if(e&&e!=i.name){return}switch(i.type){case"text/javascript":this.util.evalGlobal(i.content);break;case"text/css":this.util.addCss(i.content);break}},this)},load:function(){this.execEventHandler("load",[this]);if(this.util.isIOS())this.addClass(document.documentElement,"bx-ios");if(this.util.isMobile())this.addClass(document.documentElement,"bx-touch");this.loadResources("auto");this.context=this.util.getNodeFromText(this.config.layout);if(!this.context){return}document.body.appendChild(this.context);this.container=this.context.querySelector("[data-b24-crm-button-cont]");this.shadow.init({caller:this,shadowNode:this.context.querySelector("[data-b24-crm-button-shadow]")});this.buttons.init({caller:this,container:this.container.querySelector("[data-b24-crm-button-block]"),blankButtonNode:this.context.querySelector("[data-b24-crm-button-widget-blank]"),openerButtonNode:this.context.querySelector("[data-b24-crm-button-block-button]")});this.wm.init({caller:this});this.hacks.init({caller:this});this.hello.init({caller:this,context:this.container.querySelector("[data-b24-crm-hello-cont]")});this.wm.loadAll();this.execEventHandler("loaded",[this])},setPulse:function(t){t=t||false;var e=this.context.querySelector("[data-b24-crm-button-pulse]");if(!e){return}e.style.display=t?"":"none"},show:function(){this.removeClass(this.container,"b24-widget-button-disable");this.addClass(this.container,"b24-widget-button-visible");this.execEventHandler("show",[this]);if(!this.isShown){this.execEventHandler("first-show",[this])}this.isShown=true},hide:function(){this.addClass(this.container,"b24-widget-button-disable");this.execEventHandler("hide",[this])},addEventHandler:function(t,e){if(!t||!e){return}this.eventHandlers.push({eventName:t,handler:e})},execEventHandler:function(e,i){i=i||[];if(!e){return}this.eventHandlers.forEach(function(t){if(t.eventName==e){t.handler.apply(this,i)}},this);if(this.handlers[e]){this.handlers[e].apply(this,i)}var n="b24-sitebutton-"+e;if(t.BX.onCustomEvent){t.BX.onCustomEvent(document,n,i)}if(t.jQuery&&typeof t.jQuery==="function"){var s=t.jQuery(document);if(s&&s.trigger)s.trigger(n,i)}},onWidgetFormInit:function(t){this.execEventHandler("form-init",[t])},onWidgetClose:function(){this.buttons.hide();this.show()},addClass:function(t,e){if(t&&typeof t.className=="string"&&t.className.indexOf(e)===-1){t.className+=" "+e;t.className=t.className.replace("  "," ")}},removeClass:function(t,e){if(!t||!t.className){return}t.className=t.className.replace(e,"").replace("  "," ")},addEventListener:function(e,i,n){e=e||t;if(t.addEventListener){e.addEventListener(i,n,false)}else{e.attachEvent("on"+i,n)}},buttons:{isShown:false,isInit:false,wasOnceShown:false,wasOnceClick:false,blankButtonNode:null,list:[],animatedNodes:[],attributeAnimateNode:"data-b24-crm-button-icon",init:function(t){this.c=t.caller;this.container=t.container;this.blankButtonNode=t.blankButtonNode;this.openerButtonNode=t.openerButtonNode;this.openerClassName=this.c.config.location>3?"b24-widget-button-bottom":"b24-widget-button-top";var e=this;this.c.addEventListener(this.openerButtonNode,"click",function(t){if(e.list.length==1&&e.list[0].onclick&&!e.list[0].href){e.list[0].onclick.apply(this,[])}else{e.toggle()}});this.isInit=true;this.list.forEach(function(t){if(!t.node)this.insert(t)},this);this.initAnimation();this.startPulseAnimation()},startPulseAnimation:function(){this.c.addClass(this.c.context.querySelector("[data-b24-crm-button-pulse]"),"b24-widget-button-pulse-animate")},stopPulseAnimation:function(){this.c.removeClass(this.c.context.querySelector("[data-b24-crm-button-pulse]"),"b24-widget-button-pulse-animate")},startIconAnimation:function(){this.animate()},stopIconAnimation:function(){clearTimeout(this.iconAnimationTimeout)},initAnimation:function(){var t=this.c.util.nodeListToArray(this.c.context.querySelectorAll("["+this.attributeAnimateNode+"]"));this.animatedNodes=t.filter(function(t){var e=t.getAttribute(this.attributeAnimateNode);var i=!this.getByType(e);t.style.display=i?"none":"";return!i},this);this.animate()},animate:function(){var t="b24-widget-button-icon-animation";var e=0;this.animatedNodes.forEach(function(i,n){if(this.c.util.hasClass(i,t))e=n;this.c.removeClass(i,t)},this);e++;e=e<this.animatedNodes.length?e:0;this.c.addClass(this.animatedNodes[e],t);if(this.animatedNodes.length>1){var i=this;this.iconAnimationTimeout=setTimeout(function(){i.animate()},1500)}},getByType:function(t){var e=this.list.filter(function(e){return t==e.type},this);return e.length>0?e[0]:null},toggle:function(){this.isShown?this.hide():this.show()},show:function(){if(this.c.util.isIOS())this.c.addClass(document.documentElement,"bx-ios-fix-frame-focus");{this.c.shadow.show()}this.isShown=true;this.wasOnceShown=true;this.c.addClass(this.c.container,this.openerClassName);this.c.addClass(this.container,"b24-widget-button-show");this.c.removeClass(this.container,"b24-widget-button-hide");this.c.hello.hide()},hide:function(){if(this.c.util.isIOS())this.c.removeClass(document.documentElement,"bx-ios-fix-frame-focus");this.isShown=false;this.c.addClass(this.container,"b24-widget-button-hide");this.c.removeClass(this.container,"b24-widget-button-show");this.c.removeClass(this.c.container,this.openerClassName);this.c.hello.hide();this.c.shadow.hide()},displayButton:function(t,e){this.list.forEach(function(i){if(i.id!=t)return;if(!i.node)return;i.node.style.display=e?"":"none"})},sortOut:function(){this.list.sort(function(t,e){return t.sort>e.sort?1:-1});this.list.forEach(function(t){if(!t.node)return;t.node.parentNode.appendChild(t.node)})},add:function(t){this.list.push(t);return this.insert(t)},insert:function(e){if(!this.isInit){e.node=null;return null}var i=this.blankButtonNode.cloneNode(true);e.node=i;e.sort=e.sort||100;i.setAttribute("data-b24-crm-button-widget",e.id);i.setAttribute("data-b24-widget-sort",e.sort);if(e.classList&&e.classList.length>0){e.classList.forEach(function(t){this.c.addClass(i,t)},this)}if(e.title){var n=i.querySelector("[data-b24-crm-button-tooltip]");if(n){n.innerText=e.title}else{i.title=e.title}}if(e.icon){i.style["background-image"]="url("+e.icon+")"}else{if(e.iconColor){setTimeout(function(){var n="background-image";if(!t.getComputedStyle){return}var s=t.getComputedStyle(i,null).getPropertyValue(n);i.style[n]=(s||"").replace("FFF",e.iconColor.substring(1))},1e3)}if(e.bgColor){i.style["background-color"]=e.bgColor}}if(e.href){i.href=e.href;i.target=e.target?e.target:"_blank"}if(e.onclick){var s=this;this.c.addEventListener(i,"click",function(t){s.wasOnceClick=true;e.onclick.apply(s,[])})}this.container.appendChild(i);this.sortOut();this.initAnimation();return i}},shadow:{clickHandler:null,shadowNode:null,autoClose:true,displayed:false,init:function(e){this.c=e.caller;this.shadowNode=e.shadowNode;this.c.addEventListener(this.shadowNode,"click",this.onClick.bind());this.c.addEventListener(document,"keyup",function(e){e=e||t.e;if(e.keyCode===27){this.onClick()}}.bind(this))},onClick:function(){if(!this.autoClose){return}this.c.wm.hide();this.c.buttons.hide();if(!this.clickHandler){return}this.clickHandler.apply(this,[]);this.clickHandler=null},show:function(t){this.clickHandler=t;this.c.addClass(this.shadowNode,"b24-widget-button-show");this.c.removeClass(this.shadowNode,"b24-widget-button-hide");this.c.hacks.saveScrollPos();this.c.addClass(document.documentElement,"crm-widget-button-mobile");this.displayed=true},hide:function(){if(this.displayed){this.c.addClass(this.shadowNode,"b24-widget-button-hide")}this.c.removeClass(this.shadowNode,"b24-widget-button-show");this.c.removeClass(document.documentElement,"crm-widget-button-mobile");this.c.hacks.restoreScrollPos();this.displayed=false},setAutoClose:function(t){this.autoClose=t!==false}},util:{getNodeFromText:function(t){var e=document.createElement("div");e.innerHTML=t;return e.children[0]},hasClass:function(t,e){var i=this.nodeListToArray(t.classList);var n=i.filter(function(t){return t==e});return n.length>0},nodeListToArray:function(t){var e=[];if(!t)return e;for(var i=0;i<t.length;i++){e.push(t.item(i))}return e},isIOS:function(){return/(iPad;)|(iPhone;)/i.test(navigator.userAgent)},isOpera:function(){return navigator.userAgent.toLowerCase().indexOf("opera")!=-1},isIE:function(){return document.attachEvent&&!this.isOpera()},isMobile:function(){return/(ipad|iphone|android|mobile|touch)/i.test(navigator.userAgent)},isArray:function(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isString:function(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},evalGlobal:function(t){if(!t){return}var e=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.type="text/javascript";if(!this.isIE()){i.appendChild(document.createTextNode(t))}else{i.text=t}e.insertBefore(i,e.firstChild);e.removeChild(i)},addCss:function(t){var e=document.createElement("STYLE");e.setAttribute("type","text/css");if(e.styleSheet){e.styleSheet.cssText=resource.content}else{e.appendChild(document.createTextNode(t))}document.head.appendChild(e)},isCurPageInList:function(e){var i=e.filter(function(e){e=encodeURI(e);var i=this.prepareUrl(e).split("*").map(function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}).join(".*");i="^"+i+"$";return new RegExp(i).test(this.prepareUrl(t.location.href))},this);return i.length>0},prepareUrl:function(t){var e;if(t.substring(0,5)==="http:"){e=t.substring(7)}else if(t.substring(0,6)==="https:"){e=t.substring(8)}else{e=t}return e},getCookie:function(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):undefined},setCookie:function(t,e,i){i=i||{};if(!i.path){i.path="/"}var n=i.expires;if(typeof n==="number"&&n){var s=new Date;s.setTime(s.getTime()+n*1e3);n=i.expires=s}if(n&&n.toUTCString){i.expires=n.toUTCString()}e=encodeURIComponent(e);var o=t+"="+e;for(var r in i){if(!i.hasOwnProperty(r)){continue}o+="; "+r;var a=i[r];if(a!==true){o+="="+a}}document.cookie=o}},hacks:{scrollPos:0,init:function(t){this.c=t.caller},saveScrollPos:function(){this.scrollPos=t.pageYOffset},restoreScrollPos:function(){if(!this.c.util.isMobile()){return}t.scrollTo(0,this.scrollPos)}},wm:{showedWidget:null,loadedCount:0,init:function(t){this.c=t.caller},getList:function(){return this.c.config.widgets.filter(function(t){return t.isLoaded},this)},getById:function(t){var e=this.c.config.widgets.filter(function(e){return t==e.id&&e.isLoaded},this);return e.length>0?e[0]:null},hide:function(){if(!this.showedWidget){return}if(this.showedWidget.hide){this.c.util.evalGlobal(this.showedWidget.hide)}this.c.onWidgetClose();this.c.shadow.hide();this.showedWidget=null},show:function(t){if(!t.show||!this.c.util.isString(t.show)){return}this.showedWidget=t;this.c.shadow.show();this.c.util.evalGlobal(t.show);this.c.hide()},checkPagesAll:function(t){this.c=t;return this.c.config.widgets.some(this.checkPages,this)},checkPages:function(t){var e=this.c.util.isCurPageInList(t.pages.list);if(t.pages.mode=="EXCLUDE"){return!e}else{return e}},checkWorkTimeAll:function(t){this.c=t;return this.c.config.widgets.some(this.checkWorkTime,this)},checkWorkTime:function(t){if(!t.workTime){t.isWorkTimeNow=true;t.isWorkTimeChecked=true}if(t.isWorkTimeChecked){return t.isWorkTimeNow}var e=t.workTime;var i=new Date;if(this.c.config.serverTimeStamp){i=new Date(this.c.config.serverTimeStamp)}var n=e.timeZoneOffset+i.getTimezoneOffset();i=new Date(i.valueOf()+n*6e4);var s=i.getMinutes();s=s>=10?s:"0"+s;var o=parseFloat(i.getHours()+"."+s);var r=true;if(e.dayOff){var a=i.getDay();if(e.dayOff.some(function(t){return t===a})){r=false}}if(r&&e.holidays){var c=(i.getMonth()+1).toString();c=(c.length==1?"0":"")+c;c=i.getDate()+"."+c;if(e.holidays.some(function(t){return t===c})){r=false}}if(r){var h=e.timeTo<e.timeFrom;if(h){if(o>e.timeTo&&o<e.timeFrom){r=false}}else{if(o<e.timeFrom||o>e.timeTo){r=false}}}t.isWorkTimeChecked=true;t.isWorkTimeActionRule=false;if(!r&&!!e.actionRule){r=true;t.isWorkTimeActionRule=true}t.isWorkTimeNow=r;return r},loadAll:function(){this.c.config.widgets.forEach(this.load,this)},load:function(e){e.isLoaded=false;this.c.execEventHandler("load-widget-"+e.id,[e]);if(!this.checkPages(e)){return}if(!this.checkWorkTime(e)){return}if(e.workTime&&e.isWorkTimeActionRule){switch(e.workTime.actionRule){case"text":if(e.type==="callback"){this.c.addEventHandler("form-init",function(i){if(!i.isCallbackForm)return;t.Bitrix24FormLoader.addEventHandler(i,"init-frame-params",function(t,i){i.resultSuccessText=e.workTime.actionText;i.stopCallBack=true})})}break}}e.buttonNode=this.c.buttons.add({id:e.id,type:e.type,href:this.getButtonUrl(e),sort:e.sort,classList:typeof e.classList!="undefined"?e.classList:null,title:typeof e.title!="undefined"?e.title:null,onclick:this.getButtonHandler(e),bgColor:e.useColors?this.c.config.bgColor:null,iconColor:e.useColors?this.c.config.iconColor:null});this.loadScript(e);e.isLoaded=true;this.loadedCount++},getButtonHandler:function(t){var e=this;return function(){e.show(t)}},getButtonUrl:function(t){if(t.script||!t.show){return null}if(this.c.util.isString(t.show)||!t.show.url){return null}var e=null;if(this.c.util.isMobile()&&t.show.url.mobile)e=t.show.url.mobile;else if(!this.c.util.isMobile()&&t.show.url.desktop)e=t.show.url.desktop;else if(this.c.util.isString(t.show.url))e=t.show.url;return e},loadScript:function(t){if(!t.script){return}var e="";var i=false;var n=t.script.match(/<script\b[^>]*>(.*?)<\/script>/i);if(n&&n[1]){e=n[1];i=true}else{t.node=this.c.util.getNodeFromText(t.script);if(!t.node){return}i=false;if(typeof t.caption!="undefined"){var s=t.node.querySelector("[data-bx-crm-widget-caption]");if(s){s.innerText=t.caption}}}if(i){t.node=document.createElement("script");try{t.node.appendChild(document.createTextNode(e))}catch(i){t.node.text=e}document.head.appendChild(t.node)}else{document.body.insertBefore(t.node,document.body.firstChild)}}},hello:{isInit:false,wasOnceShown:false,condition:null,cookieName:"b24_sitebutton_hello",init:function(t){this.c=t.caller;if(this.isInit){return}this.context=t.context;this.showClassName="b24-widget-button-popup-show";this.config=this.c.config.hello;this.delay=this.config.delay;this.buttonHideNode=this.context.querySelector("[data-b24-hello-btn-hide]");this.iconNode=this.context.querySelector("[data-b24-hello-icon]");this.nameNode=this.context.querySelector("[data-b24-hello-name]");this.textNode=this.context.querySelector("[data-b24-hello-text]");this.initHandlers();this.isInit=true;if(this.c.util.getCookie(this.cookieName)=="y"){return}if(!this.config||!this.config.conditions||this.config.conditions.length==0){return}if(!this.condition){this.setConditions(this.config.conditions,true)}this.c.addEventHandler("first-show",this.initCondition.bind(this))},setConditions:function(t,e){this.condition=this.findCondition(t);if(!e){this.initCondition()}},initCondition:function(){if(!this.condition){return}if(!this.isInit){return}if(this.condition.icon){this.iconNode.style["background-image"]="url("+this.condition.icon+")"}if(this.condition.name){this.nameNode.innerText=this.condition.name}if(this.condition.text){this.textNode.innerText=this.condition.text}if(this.condition.delay){this.delay=this.condition.delay}this.planShowing()},initHandlers:function(){var e=this;this.c.addEventListener(this.buttonHideNode,"click",function(i){e.hide();if(!i)i=t.event;if(i.stopPropagation){i.preventDefault();i.stopPropagation()}else{i.cancelBubble=true;i.returnValue=false}});this.c.addEventListener(this.context,"click",function(){e.showWidget()})},planShowing:function(){if(this.wasOnceShown||this.c.buttons.wasOnceClick){return}var t=this.delay||10;var e=this;setTimeout(function(){e.show()},t*1e3)},findCondition:function(t){if(!t){return}var e;e=t.filter(function(t){if(!t.pages||t.pages.MODE=="EXCLUDE"||t.pages.LIST.length==0){return false}return this.c.util.isCurPageInList(t.pages.LIST)},this);if(e.length>0){return e[0]}e=t.filter(function(t){if(!t.pages||t.pages.MODE=="INCLUDE"){return false}return!this.c.util.isCurPageInList(t.pages.LIST)},this);if(e.length>0){return e[0]}e=t.filter(function(t){return!t.pages},this);if(e.length>0){return e[0]}return null},showWidget:function(){this.hide();var t=null;if(this.condition&&this.condition.showWidgetId){t=this.c.wm.getById(this.condition.showWidgetId)}if(!t){t=this.c.wm.getById(this.config.showWidgetId)}if(!t){var e=this.c.wm.getList();if(e.length>0){t=e[0]}}if(t){this.c.wm.show(t)}},showImmediately:function(t){t=t||null;if(t){this.setConditions([{icon:t.icon,name:t.name,text:t.text,page:"",delay:0}])}this.show(true)},show:function(t){if(!this.condition){return}t=t||false;if(!t&&this.c.buttons.isShown){this.planShowing();return}this.wasOnceShown=true;this.c.addClass(this.context,this.showClassName)},hide:function(){this.c.removeClass(this.context,this.showClassName);this.c.util.setCookie(this.cookieName,"y",{expires:60*60*6})}}}})(window);
//# sourceMappingURL=button_loader.map.js