{"version":3,"file":"channel-selector.bundle.js","sources":["../src/channel-selector.js"],"sourcesContent":["import {Dom, Tag, Text, Type, Loc, Reflection} from \"main.core\";\nimport {Menu, MenuManager} from \"main.popup\";\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Router} from 'crm.router';\nimport {Loader} from 'main.loader';\nimport {Menu as MenuConfigurable} from 'ui.menu-configurable';\nimport \"ui.icons.service\";\nimport \"ui.notification\";\n\nconst CrmActivityEditor = Reflection.namespace('BX.CrmActivityEditor');\nconst UserOptions = Reflection.namespace('BX.userOptions');\nconst NotificationCenter = Reflection.namespace('BX.UI.Notification.Center');\n\nconst CHANNEL_TYPE_PHONE = 'PHONE';\nconst CHANNEL_TYPE_EMAIL = 'EMAIL';\nconst CHANNEL_TYPE_IM = 'IM';\n\nconst MAX_VISIBLE_ITEMS = 4;\n\nexport type ChannelSelectorParameters = {\n\tid: ?string,\n\ttitle: ?string,\n\tbody: ?string,\n\tentityTypeId: number,\n\tentityId: number,\n\tchannels: Array<ChannelData>,\n\tcommunications: Object<string, CommunicationData>,\n\tlink: ?string,\n\tisLinkObtainable: boolean,\n\tfiles: Array<number>,\n\tstorageTypeId: ?number,\n\tactivityEditorId: ?string,\n\tsmsUrl: ?string,\n\thasVisibleChannels: boolean,\n\tchannelIcons: Array<string>,\n\tcontactCenterUrl: ?string,\n};\n\nexport type ChannelData = {\n\tid: string,\n\ttitle: string,\n\ttype: string,\n\tisAvailable: boolean,\n\tisHidden: ?boolean,\n\ticon: ?string,\n}\n\nexport type CommunicationData = {\n\tENTITY_ID: string,\n\tELEMENT_ID: number,\n\tTYPE_ID: string,\n\tVALUE: string,\n};\n\nconst items = new Map();\n\n/**\n * @memberof BX.Crm.ChannelSelector\n */\nexport class List extends EventEmitter\n{\n\tlayout: {\n\t\tcontainer: HTMLElement,\n\t\tlist: HTMLElement,\n\t\ttitle: HTMLElement,\n\t\tsettings: HTMLElement,\n\t\tfooter: HTMLElement,\n\t\tlink: ?HTMLElement,\n\t\tchannels: Object<string,HTMLElement>,\n\t};\n\ttitle: string;\n\tbody: string;\n\t#link: string;\n\tisLinkObtainable: boolean;\n\tentityTypeId: number;\n\tentityId: number;\n\tchannels: Array<ChannelData>;\n\tfiles: Array<number>;\n\tstorageTypeId: number;\n\tactivityEditorId: string;\n\tsmsUrl: string;\n\tcommunications: Object<string, CommunicationData>;\n\t#loader: ?Loader;\n\t#getLinkPromise: ?Promise;\n\t#menu: Menu;\n\t#menuConfigurable: MenuConfigurable;\n\n\tconstructor(parameters: ChannelSelectorParameters)\n\t{\n\t\tsuper();\n\t\tthis.title = Type.isStringFilled(parameters.title) ? parameters.title : Loc.getMessage('CRM_CHANNEL_SELECTOR_DEFAULT_TITLE');\n\t\tthis.body = String(parameters.body);\n\t\tthis.#link = String(parameters.link);\n\t\tthis.isLinkObtainable = Text.toBoolean(parameters.isLinkObtainable);\n\t\tthis.entityTypeId = Text.toInteger(parameters.entityTypeId);\n\t\tthis.entityId = Text.toInteger(parameters.entityId);\n\t\tthis.id = Type.isStringFilled(parameters.id) ? parameters.id : this.entityTypeId + '_' + this.entityId + '_' + Math.random().toString().substring(2)\n\t\tthis.storageTypeId = Text.toInteger(parameters.storageTypeId);\n\t\tthis.files = Type.isArray(parameters.files) ? parameters.files : [];\n\t\tthis.activityEditorId = String(parameters.activityEditorId);\n\t\tthis.smsUrl = String(parameters.smsUrl);\n\t\tthis.setChannels(parameters.channels);\n\t\tthis.communications = Type.isPlainObject(parameters.communications) ? parameters.communications : {};\n\t\tthis.hasVisibleChannels = Text.toBoolean(parameters.hasVisibleChannels);\n\t\tthis.channelIcons = Type.isArray(parameters.channelIcons) ? parameters.channelIcons : [];\n\t\tthis.contactCenterUrl = Type.isStringFilled(parameters.contactCenterUrl) ? parameters.contactCenterUrl : '/contact_center/';\n\t\tthis.layout = {\n\t\t\tchannels: {},\n\t\t};\n\t\tthis.setEventNamespace('BX.Crm.ChannelSelector.List');\n\n\t\tif (items.size === 0)\n\t\t{\n\t\t\titems.set('default', this);\n\t\t}\n\t\titems.set(this.id, this);\n\t}\n\n\tsetChannels(channels: Array<ChannelData>)\n\t{\n\t\tthis.channels = [];\n\t\tif (Type.isArray(channels))\n\t\t{\n\t\t\tchannels.forEach((channel: ChannelData) => {\n\t\t\t\tthis.channels.push(channel);\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.layout.container)\n\t\t{\n\t\t\treturn this.layout.container;\n\t\t}\n\t\tthis.layout.title = Tag.render`<div class=\"crm__channel-selector--title\">${Text.encode(this.title)}</div>`;\n\t\tif (this.#link || this.isLinkObtainable)\n\t\t{\n\t\t\tthis.layout.link = Tag.render`<input type=\"text\" class=\"crm__channel-selector--footer-link-hidden\" value=\"${Text.encode(this.#link)}\" />`\n\t\t\t// class=\"crm__channel-selector--footer --disabled\"\n\t\t\tthis.layout.footer = Tag.render`<div class=\"crm__channel-selector--footer\" onclick=\"${this.#handleFooterClick.bind(this)}\">\n\t\t\t\t<div class=\"crm__channel-selector--footer-copy-link\">\n\t\t\t\t\t<span class=\"crm__channel-selector--footer-text\">${Loc.getMessage('CRM_CHANNEL_FOOTER_TITLE')}</span>\n\t\t\t\t\t${this.layout.link}\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.footer = null;\n\t\t}\n\n\t\tthis.layout.settings = null;\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tthis.layout.settings = Tag.render`<button class=\"ui-btn ui-btn-xs ui-btn-link ui-btn-icon-setting crm__channel-selector--setting-btn\" onclick=\"${this.#handleSettingsClick.bind(this)}\"></button>`;\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--list\"></div>`;\n\n\t\t\tthis.channels.forEach((channel: ChannelData) =>\n\t\t\t{\n\t\t\t\tconst channelNode = this.#renderChannel(channel);\n\t\t\t\tif (channelNode)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.channels[channel.id] = channelNode;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--body\">\n\t\t\t<div class=\"crm__channel-selector--networks\">\n\t\t\t\t<div class=\"crm__channel-selector--networks-title\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_NO_ACTIVE_CHANNELS_TEXT')}</div>\n\t\t\t\t<div class=\"crm__channel-selector--networks-block\">\n\t\t\t\t\t${this.channelIcons.map(icon => Tag.render`<span class=\"crm__channel-selector--network-link --${icon}\" onclick=\"${this.#openContactCenter.bind(this)}\"></span>`)}\n\t\t\t\t\t<span class=\"crm__channel-selector--network-link --link\" onclick=\"${this.#openContactCenter.bind(this)}\">+ 15</span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round\" onclick=\"${this.#openContactCenter.bind(this)};\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_ACTIVATE_CHANNELS')}</span>\n\t\t\t</div>\n\t\t</div>`\n\t\t}\n\n\t\tthis.layout.container = Tag.render`<div class=\"crm__channel-selector--container\">\n\t\t\t<div class=\"crm__channel-selector--header\">\n\t\t\t\t${this.layout.title}\n\t\t\t\t${this.layout.settings}\n\t\t\t</div>\n\t\t\t${this.layout.list}\n\t\t</div>`;\n\n\t\tif (this.layout.footer)\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.layout.footer);\n\t\t}\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this.layout.container;\n\t}\n\n\t#renderChannel(channel: ChannelData): HTMLElement\n\t{\n\t\tconst channelHandler = (() => {\n\t\t\tthis.#handleChannelClick(channel);\n\t\t});\n\n\t\tlet icon = this.getChannelIcon(channel);\n\n\t\treturn Tag.render`<div \n\t\t\tclass=\"crm__channel-selector--channel\"\n\t\t\tonclick=\"${channelHandler}\"\n\t\t>\n\t\t\t${(icon ? Tag.render`<div class=\"crm__channel-selector--channel-icon ${icon}\"></div>` : '')}\n\t\t\t<div class=\"crm__channel-selector--channel-text\">\n\t\t\t\t${Text.encode(channel.title)}\n\t\t\t</div>\n\t\t\t<div class=\"crm__channel-selector--channel-helper\">\n\t\t\t\t<span class=\"crm__channel-selector--channel-helper-text\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_SEND_BUTTON')}</span>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tadjustAppearance(): void\n\t{\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tDom.clean(this.layout.list);\n\t\t\tlet allChannelsAreHidden = true;\n\t\t\tthis.channels.forEach((channel: ChannelData) =>\n\t\t\t{\n\t\t\t\tconst node = this.layout.channels[channel.id];\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.list.append(node);\n\t\t\t\t\tif (this.#isChannelAvailable(channel))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\tif (channel.isHidden)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t\tallChannelsAreHidden = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (allChannelsAreHidden)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t}\n\t}\n\n\t#getChannelById(id: string): ?ChannelData\n\t{\n\t\treturn this.channels.find(channel => channel.id === id);\n\t}\n\n\t#isChannelAvailable(channel: ChannelData): boolean\n\t{\n\t\tif (!channel.isAvailable)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst hasLink = this.isLinkObtainable || Boolean(this.#link);\n\t\tconst hasFiles = CrmActivityEditor && this.storageTypeId > 0 && this.files.length > 0;\n\t\tif (channel.type === CHANNEL_TYPE_PHONE || channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn hasLink;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn hasLink || hasFiles;\n\t\t}\n\t\tif (\n\t\t\tchannel.type === CHANNEL_TYPE_EMAIL\n\t\t\t&& !CrmActivityEditor?.items[this.activityEditorId]\n\t\t)\n\t\t{\n\t\t\tconsole.log('Email channel is disabled because the CrmActivityEditor instance is not found');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn channel.isAvailable;\n\t}\n\n\t#getLink(): Promise<string>\n\t{\n\t\tif (this.#link)\n\t\t{\n\t\t\treturn Promise.resolve(this.#link);\n\t\t}\n\t\tif (!this.isLinkObtainable)\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\t\tif (this.#getLinkPromise)\n\t\t{\n\t\t\treturn this.#getLinkPromise;\n\t\t}\n\t\tthis.#getLinkPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#showLoader();\n\t\t\tthis.emitAsync('getLink').then((result: Array) => {\n\t\t\t\tresult.forEach((link) => {\n\t\t\t\t\tthis.setLink(link);\n\t\t\t\t});\n\t\t\t\tif (!this.#link)\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(this.#link);\n\t\t\t\t}\n\t\t\t}).catch(reject)\n\t\t\t.finally(() => {\n\t\t\t\tthis.#getLinkPromise = null;\n\t\t\t\tthis.#hideLoader();\n\t\t\t});\n\t\t});\n\n\t\treturn this.#getLinkPromise;\n\t}\n\n\t#handleFooterClick(): void\n\t{\n\t\tif (!this.layout.link)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#getLink().then((link) => {\n\t\t\tthis.layout.link.value = link;\n\t\t\tthis.layout.link.focus();\n\t\t\tthis.layout.link.setSelectionRange(0, this.layout.link.value.length);\n\t\t\tdocument.execCommand(\"copy\");\n\n\t\t\tthis.#showNotice(Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_COPIED_NOTIFICATION_MESSAGE'));\n\t\t}).catch((reason: ?string) => {\n\t\t\tthis.#showGetLinkErrorNotification(this.layout.footer, reason);\n\t\t});\n\t}\n\n\t#handleSettingsClick(): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tthis.emit('onSettingsClick', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#openMenu();\n\t}\n\n\t#openMenu(): void\n\t{\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInViewMode(): Array\n\t{\n\t\tconst settingsItems = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\tif (channel.isHidden)\n\t\t\t{\n\t\t\t\tsettingsItems.push({\n\t\t\t\t\ttext: channel.title,\n\t\t\t\t\tid: channel.id,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#handleChannelClick(channel);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tsettingsItems.push({\n\t\t\tdelimiter: true\n\t\t});\n\t\tsettingsItems.push({\n\t\t\ttext: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tid: 'configure',\n\t\t\tonclick: this.#switchMenuToEditMode.bind(this),\n\t\t});\n\n\t\treturn settingsItems;\n\t}\n\n\t#getMenu(): Menu\n\t{\n\t\tif (!this.#menu)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: this.id + '-settings-popup',\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\titems: this.#getMenuItemsInViewMode(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#switchMenuToEditMode(): void\n\t{\n\t\tthis.#getMenu().close();\n\t\tthis.#getMenuConfigurable().open().then((result) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Type.isArray(result.items))\n\t\t\t{\n\t\t\t\tthis.#saveSettings(result.items);\n\t\t\t\tthis.#openMenu();\n\t\t\t}\n\t\t});\n\t}\n\n\t#saveSettings(items: Array<{id: string, isHidden: boolean}>): void\n\t{\n\t\tconst channels = [];\n\t\titems.forEach((item) => {\n\t\t\tconst channel = this.#getChannelById(item.id);\n\t\t\tif (channel)\n\t\t\t{\n\t\t\t\tchannel.isHidden = item.isHidden;\n\t\t\t\tchannels.push(channel);\n\t\t\t}\n\t\t});\n\t\tthis.setChannels(channels);\n\t\tthis.adjustAppearance();\n\t\tthis.#menu.destroy();\n\t\tthis.#menu = null;\n\n\t\tUserOptions.save(\"crm\", \"channel-selector\", \"items\", JSON.stringify(items));\n\t}\n\n\t#switchMenuToViewMode(): void\n\t{\n\t\tthis.#menuConfigurable?.close();\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInEditMode(): Array\n\t{\n\t\tconst items = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\titems.push({\n\t\t\t\ttext: channel.title,\n\t\t\t\tid: channel.id,\n\t\t\t\tisHidden: channel.isHidden,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuConfigurable(): MenuConfigurable\n\t{\n\t\tconst items = this.#getMenuItemsInEditMode();\n\t\tif (!this.#menuConfigurable)\n\t\t{\n\t\t\tthis.#menuConfigurable = new MenuConfigurable({\n\t\t\t\titems,\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\tmaxVisibleItems: MAX_VISIBLE_ITEMS,\n\t\t\t});\n\t\t\tthis.#menuConfigurable.subscribe('Cancel', () => {\n\t\t\t\tthis.#openMenu();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#menuConfigurable.setItems(items);\n\t\t}\n\n\t\treturn this.#menuConfigurable;\n\t}\n\n\t#showGetLinkErrorNotification(bindElement: HTMLElement, text: ?string)\n\t{\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\ttext = Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_NOT_AVAILABLE_NOTIFICATION_MESSAGE');\n\t\t}\n\n\t\tthis.#showNotice(text);\n\t}\n\n\t#showNotice(content: string)\n\t{\n\t\tif (NotificationCenter)\n\t\t{\n\t\t\tNotificationCenter.notify({\n\t\t\t\tcontent,\n\t\t\t});\n\t\t}\n\t};\n\n\t#handleChannelClick(channel: ChannelData): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tevent.setData({channel, communications: this.communications[channel.type]});\n\t\tthis.emit('onChannelClick', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#isChannelAvailable(channel))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\tthis.sendEmail(channel);\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_PHONE)\n\t\t{\n\t\t\tthis.sendSms(channel);\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\tthis.openMessenger(channel);\n\t\t}\n\t}\n\n\tsetFiles(files: number[]): this\n\t{\n\t\tthis.files = Type.isArray(files) ? files : [];\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsetLink(link: string): this\n\t{\n\t\tthis.#link = link ?? null;\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsendEmail(channel: ChannelData): void\n\t{\n\t\tif (this.files.length <= 0 || Number(this.storageTypeId) <= 0)\n\t\t{\n\t\t\tconst channelNode = this.layout.channels[channel.id];\n\t\t\tthis.#getLink().then((link) => {\n\t\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\t\t'subject': this.body,\n\t\t\t\t\t'body': Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t\t\t'#MESSAGE#': this.body,\n\t\t\t\t\t\t'#LINK#': link,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}).catch((reason) => {\n\t\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\t'subject': this.body,\n\t\t\t\t'diskfiles': this.files,\n\t\t\t\t'storageTypeID': this.storageTypeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tsendSms(channel: ChannelData): void\n\t{\n\t\tconst channelNode = this.layout.channels[channel.id];\n\t\tif (!this.smsUrl)\n\t\t{\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, 'No sms url');\n\t\t\treturn;\n\t\t}\n\t\tthis.#getLink().then((link) => {\n\t\t\tRouter.openSlider(this.smsUrl, {\n\t\t\t\twidth: 443,\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tentityId: this.entityId,\n\t\t\t\t\ttext: Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t\t\t'#MESSAGE#': this.body,\n\t\t\t\t\t\t'#LINK#': link,\n\t\t\t\t\t}),\n\t\t\t\t\tproviderId: channel.id,\n\t\t\t\t\tisProviderFixed: 'Y',\n\t\t\t\t}\n\t\t\t});\n\t\t}).catch((reason) => {\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t});\n\t}\n\n\topenMessenger(channel: ChannelData): void\n\t{\n\t\tif (!top.BXIM)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.communications[channel.type])\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttop.BXIM.openMessenger(this.communications[channel.type].VALUE, {RECENT: \"N\", MENU: \"N\"});\n\t}\n\n\t#openContactCenter(): void\n\t{\n\t\tRouter.openSlider(this.contactCenterUrl).then(() => {\n\t\t\tlocation.reload();\n\t\t});\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tstatic getDefault(): ?List\n\t{\n\t\treturn items.get('default');\n\t}\n\n\tstatic getById(id: string): ?List\n\t{\n\t\treturn items.get(id);\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.show(this.layout.container);\n\t\t}\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.hide();\n\t\t}\n\t}\n\n\t#getLoader(): ?Loader\n\t{\n\t\tif(!this.#loader && Loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({size: 100, offset: {left: \"35%\", top: \"-25%\"}});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\tgetChannelIcon(channel: ChannelData): ?string\n\t{\n\t\tlet icon = channel.icon;\n\t\tif (!icon)\n\t\t{\n\t\t\ticon = List.getIconByChannelId(channel.id);\n\t\t}\n\n\t\treturn icon;\n\t}\n\n\tstatic getIconByChannelId(id: string): ?string\n\t{\n\t\tif (id === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn '--service-email';\n\t\t}\n\t\tif (id === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn '--service-livechat';\n\t\t}\n\t\tif (id === 'twilio')\n\t\t{\n\t\t\treturn '--service-whatsapp';\n\t\t}\n\t\tif (id === 'ednaru' || id === 'ednaruimhpx')\n\t\t{\n\t\t\treturn '--service-edna';\n\t\t}\n\n\t\treturn '--service-sms';\n\t}\n}\n"],"names":["CrmActivityEditor","Reflection","namespace","UserOptions","NotificationCenter","CHANNEL_TYPE_PHONE","CHANNEL_TYPE_EMAIL","CHANNEL_TYPE_IM","MAX_VISIBLE_ITEMS","items","Map","List","EventEmitter","constructor","parameters","title","Type","isStringFilled","Loc","getMessage","body","String","link","isLinkObtainable","Text","toBoolean","entityTypeId","toInteger","entityId","id","Math","random","toString","substring","storageTypeId","files","isArray","activityEditorId","smsUrl","setChannels","channels","communications","isPlainObject","hasVisibleChannels","channelIcons","contactCenterUrl","layout","setEventNamespace","size","set","forEach","channel","push","render","container","Tag","encode","footer","bind","settings","list","channelNode","map","icon","appendChild","adjustAppearance","Dom","clean","allChannelsAreHidden","node","append","removeClass","addClass","isHidden","setFiles","setLink","sendEmail","length","Number","then","addEmail","catch","reason","sendSms","Router","openSlider","width","requestMethod","requestParams","text","providerId","isProviderFixed","openMessenger","top","BXIM","type","VALUE","RECENT","MENU","getId","getDefault","get","getById","getChannelIcon","getIconByChannelId","channelHandler","find","isAvailable","hasLink","Boolean","hasFiles","console","log","Promise","resolve","reject","emitAsync","result","finally","value","focus","setSelectionRange","document","execCommand","event","BaseEvent","emit","isDefaultPrevented","show","settingsItems","onclick","delimiter","MenuManager","create","bindElement","close","open","isCanceled","item","destroy","save","JSON","stringify","MenuConfigurable","maxVisibleItems","subscribe","setItems","content","notify","setData","location","reload","loader","hide","Loader","offset","left"],"mappings":"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"}