{"version":3,"file":"channel-selector.bundle.js","sources":["../src/channel-selector.js"],"sourcesContent":["import { Dom, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { Menu, MenuItem, MenuManager } from 'main.popup';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Router } from 'crm.router';\nimport { Loader } from 'main.loader';\nimport { Menu as MenuConfigurable } from 'ui.menu-configurable';\nimport 'ui.icons.service';\nimport 'ui.notification';\n\nconst CrmActivityEditor = Reflection.namespace('BX.CrmActivityEditor');\nconst UserOptions = Reflection.namespace('BX.userOptions');\nconst NotificationCenter = Reflection.namespace('BX.UI.Notification.Center');\n\nconst CHANNEL_TYPE_PHONE = 'PHONE';\nconst CHANNEL_TYPE_EMAIL = 'EMAIL';\nconst CHANNEL_TYPE_IM = 'IM';\n\nconst MAX_VISIBLE_ITEMS = 4;\nconst MARKET_LINK = '/market/category/crm_robot_sms/';\n\nexport type ChannelSelectorParameters = {\n\tid: ?string,\n\ttitle: ?string,\n\tbody: ?string,\n\tentityTypeId: number,\n\tentityId: number,\n\tchannels: Array<ChannelData>,\n\tcommunications: Object<string, CommunicationData>,\n\tlink: ?string,\n\tisLinkObtainable: boolean,\n\tfiles: Array<number>,\n\tstorageTypeId: ?number,\n\tactivityEditorId: ?string,\n\tsmsUrl: ?string,\n\thasVisibleChannels: boolean,\n\tchannelIcons: Array<string>,\n\tcontactCenterUrl: ?string,\n};\n\nexport type ChannelData = {\n\tid: string,\n\ttitle: string,\n\ttype: string,\n\tisAvailable: boolean,\n\tisHidden: ?boolean,\n\ticon: ?string,\n}\n\nexport type CommunicationData = {\n\tENTITY_ID: string,\n\tELEMENT_ID: number,\n\tTYPE_ID: string,\n\tVALUE: string,\n};\n\nconst items = new Map();\n\n/**\n * @memberof BX.Crm.ChannelSelector\n */\nexport class List extends EventEmitter\n{\n\tlayout: {\n\t\tcontainer: HTMLElement,\n\t\tlist: HTMLElement,\n\t\ttitle: HTMLElement,\n\t\tsettings: HTMLElement,\n\t\tfooter: HTMLElement,\n\t\tlink: ?HTMLElement,\n\t\tchannels: Object<string,HTMLElement>,\n\t};\n\ttitle: string;\n\tbody: string;\n\t#link: string;\n\tisLinkObtainable: boolean;\n\tentityTypeId: number;\n\tentityId: number;\n\tchannels: Array<ChannelData>;\n\tfiles: Array<number>;\n\tstorageTypeId: number;\n\tactivityEditorId: string;\n\tsmsUrl: string;\n\tcommunications: Object<string, CommunicationData>;\n\t#loader: ?Loader;\n\t#getLinkPromise: ?Promise;\n\t#menu: Menu;\n\t#menuConfigurable: MenuConfigurable;\n\n\tconstructor(parameters: ChannelSelectorParameters)\n\t{\n\t\tsuper();\n\t\tthis.title = Type.isStringFilled(parameters.title) ? parameters.title : Loc.getMessage('CRM_CHANNEL_SELECTOR_DEFAULT_TITLE');\n\t\tthis.body = String(parameters.body);\n\t\tthis.#link = String(parameters.link);\n\t\tthis.isLinkObtainable = Text.toBoolean(parameters.isLinkObtainable);\n\t\tthis.entityTypeId = Text.toInteger(parameters.entityTypeId);\n\t\tthis.entityId = Text.toInteger(parameters.entityId);\n\t\tthis.id = Type.isStringFilled(parameters.id) ? parameters.id : this.entityTypeId + '_' + this.entityId + '_' + Math.random().toString().substring(2)\n\t\tthis.storageTypeId = Text.toInteger(parameters.storageTypeId);\n\t\tthis.files = Type.isArray(parameters.files) ? parameters.files : [];\n\t\tthis.activityEditorId = String(parameters.activityEditorId);\n\t\tthis.smsUrl = String(parameters.smsUrl);\n\t\tthis.setChannels(parameters.channels);\n\t\tthis.communications = Type.isPlainObject(parameters.communications) ? parameters.communications : {};\n\t\tthis.hasVisibleChannels = Text.toBoolean(parameters.hasVisibleChannels);\n\t\tthis.channelIcons = Type.isArray(parameters.channelIcons) ? parameters.channelIcons : [];\n\t\tthis.contactCenterUrl = Type.isStringFilled(parameters.contactCenterUrl) ? parameters.contactCenterUrl : '/contact_center/';\n\t\tthis.layout = {\n\t\t\tchannels: {},\n\t\t};\n\t\tthis.setEventNamespace('BX.Crm.ChannelSelector.List');\n\n\t\tif (items.size === 0)\n\t\t{\n\t\t\titems.set('default', this);\n\t\t}\n\t\titems.set(this.id, this);\n\t}\n\n\tsetChannels(channels: Array<ChannelData>)\n\t{\n\t\tthis.channels = [];\n\t\tif (Type.isArray(channels))\n\t\t{\n\t\t\tchannels.forEach((channel: ChannelData) => {\n\t\t\t\tthis.channels.push(channel);\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.layout.container)\n\t\t{\n\t\t\treturn this.layout.container;\n\t\t}\n\t\tthis.layout.title = Tag.render`<div class=\"crm__channel-selector--title\">${Text.encode(this.title)}</div>`;\n\t\tif (this.#link || this.isLinkObtainable)\n\t\t{\n\t\t\tthis.layout.link = Tag.render`<input type=\"text\" class=\"crm__channel-selector--footer-link-hidden\" value=\"${Text.encode(this.#link)}\" />`\n\t\t\t// class=\"crm__channel-selector--footer --disabled\"\n\t\t\tthis.layout.footer = Tag.render`<div class=\"crm__channel-selector--footer\" onclick=\"${this.#handleFooterClick.bind(this)}\">\n\t\t\t\t<div class=\"crm__channel-selector--footer-copy-link\">\n\t\t\t\t\t<span class=\"crm__channel-selector--footer-text\">${Loc.getMessage('CRM_CHANNEL_FOOTER_TITLE')}</span>\n\t\t\t\t\t${this.layout.link}\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.footer = null;\n\t\t}\n\n\t\tthis.layout.settings = null;\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tthis.layout.settings = Tag.render`<button class=\"ui-btn ui-btn-xs ui-btn-link ui-btn-icon-setting crm__channel-selector--setting-btn\" onclick=\"${this.#handleSettingsClick.bind(this)}\"></button>`;\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--list\"></div>`;\n\n\t\t\tthis.channels.forEach((channel: ChannelData) =>\n\t\t\t{\n\t\t\t\tconst channelNode = this.#renderChannel(channel);\n\t\t\t\tif (channelNode)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.channels[channel.id] = channelNode;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--body\">\n\t\t\t<div class=\"crm__channel-selector--networks\">\n\t\t\t\t<div class=\"crm__channel-selector--networks-title\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_NO_ACTIVE_CHANNELS_TEXT')}</div>\n\t\t\t\t<div class=\"crm__channel-selector--networks-block\">\n\t\t\t\t\t${this.channelIcons.map(icon => Tag.render`<span class=\"crm__channel-selector--network-link --${icon}\" onclick=\"${this.#openContactCenter.bind(this)}\"></span>`)}\n\t\t\t\t\t<span class=\"crm__channel-selector--network-link --link\" onclick=\"${this.#openContactCenter.bind(this)}\">+ 15</span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round\" onclick=\"${this.#openContactCenter.bind(this)};\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_ACTIVATE_CHANNELS')}</span>\n\t\t\t</div>\n\t\t</div>`\n\t\t}\n\n\t\tthis.layout.container = Tag.render`<div class=\"crm__channel-selector--container\">\n\t\t\t<div class=\"crm__channel-selector--header\">\n\t\t\t\t${this.layout.title}\n\t\t\t\t${this.layout.settings}\n\t\t\t</div>\n\t\t\t${this.layout.list}\n\t\t</div>`;\n\n\t\tif (this.layout.footer)\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.layout.footer);\n\t\t}\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this.layout.container;\n\t}\n\n\t#renderChannel(channel: ChannelData): HTMLElement\n\t{\n\t\tconst channelHandler = (() => {\n\t\t\tthis.#handleChannelClick(channel);\n\t\t});\n\n\t\tlet icon = this.getChannelIcon(channel);\n\n\t\treturn Tag.render`<div \n\t\t\tclass=\"crm__channel-selector--channel\"\n\t\t\tonclick=\"${channelHandler}\"\n\t\t>\n\t\t\t${(icon ? Tag.render`<div class=\"crm__channel-selector--channel-icon ${icon}\"></div>` : '')}\n\t\t\t<div class=\"crm__channel-selector--channel-text\">\n\t\t\t\t${Text.encode(channel.title)}\n\t\t\t</div>\n\t\t\t<div class=\"crm__channel-selector--channel-helper\">\n\t\t\t\t<span class=\"crm__channel-selector--channel-helper-text\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_SEND_BUTTON')}</span>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tadjustAppearance(): void\n\t{\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tDom.clean(this.layout.list);\n\t\t\tlet allChannelsAreHidden = true;\n\t\t\tthis.channels.forEach((channel: ChannelData) =>\n\t\t\t{\n\t\t\t\tconst node = this.layout.channels[channel.id];\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.list.append(node);\n\t\t\t\t\tif (this.#isChannelAvailable(channel))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\tif (channel.isHidden)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t\tallChannelsAreHidden = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (allChannelsAreHidden)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t}\n\t}\n\n\t#getChannelById(id: string): ?ChannelData\n\t{\n\t\treturn this.channels.find(channel => channel.id === id);\n\t}\n\n\t#isChannelAvailable(channel: ChannelData): boolean\n\t{\n\t\tif (!channel.isAvailable)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst hasLink = this.isLinkObtainable || Boolean(this.#link);\n\t\tconst hasFiles = CrmActivityEditor && this.storageTypeId > 0 && this.files.length > 0;\n\t\tif (channel.type === CHANNEL_TYPE_PHONE || channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn hasLink;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn hasLink || hasFiles;\n\t\t}\n\t\tif (\n\t\t\tchannel.type === CHANNEL_TYPE_EMAIL\n\t\t\t&& !CrmActivityEditor?.items[this.activityEditorId]\n\t\t)\n\t\t{\n\t\t\tconsole.log('Email channel is disabled because the CrmActivityEditor instance is not found');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn channel.isAvailable;\n\t}\n\n\t#getLink(): Promise<string>\n\t{\n\t\tif (this.#link)\n\t\t{\n\t\t\treturn Promise.resolve(this.#link);\n\t\t}\n\t\tif (!this.isLinkObtainable)\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\t\tif (this.#getLinkPromise)\n\t\t{\n\t\t\treturn this.#getLinkPromise;\n\t\t}\n\t\tthis.#getLinkPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#showLoader();\n\t\t\tthis.emitAsync('getLink').then((result: Array) => {\n\t\t\t\tresult.forEach((link) => {\n\t\t\t\t\tthis.setLink(link);\n\t\t\t\t});\n\t\t\t\tif (!this.#link)\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(this.#link);\n\t\t\t\t}\n\t\t\t}).catch(reject)\n\t\t\t.finally(() => {\n\t\t\t\tthis.#getLinkPromise = null;\n\t\t\t\tthis.#hideLoader();\n\t\t\t});\n\t\t});\n\n\t\treturn this.#getLinkPromise;\n\t}\n\n\t#handleFooterClick(): void\n\t{\n\t\tif (!this.layout.link)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#getLink().then((link) => {\n\t\t\tthis.layout.link.value = link;\n\t\t\tthis.layout.link.focus();\n\t\t\tthis.layout.link.setSelectionRange(0, this.layout.link.value.length);\n\t\t\tdocument.execCommand(\"copy\");\n\n\t\t\tthis.#showNotice(Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_COPIED_NOTIFICATION_MESSAGE'));\n\t\t}).catch((reason: ?string) => {\n\t\t\tthis.#showGetLinkErrorNotification(this.layout.footer, reason);\n\t\t});\n\t}\n\n\t#handleSettingsClick(): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tthis.emit('onSettingsClick', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#openMenu();\n\t}\n\n\t#openMenu(): void\n\t{\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInViewMode(): Array\n\t{\n\t\tconst settingsItems = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\tif (channel.isHidden)\n\t\t\t{\n\t\t\t\tsettingsItems.push({\n\t\t\t\t\ttext: channel.title,\n\t\t\t\t\tid: channel.id,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#handleChannelClick(channel);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tsettingsItems.push({\n\t\t\tdelimiter: true,\n\t\t});\n\t\tsettingsItems.push({\n\t\t\ttext: Loc.getMessage('CRM_CHANNEL_SELECTOR_CHOOSE_FROM_MARKET'),\n\t\t\tid: 'market',\n\t\t\thref: MARKET_LINK,\n\t\t\tonclick: (event: PointerEvent, item: MenuItem) => {\n\t\t\t\tconst menu = item.getMenuWindow()?.getRootMenuWindow() || item.getMenuWindow();\n\t\t\t\tmenu?.close();\n\t\t\t},\n\t\t});\n\n\t\tsettingsItems.push({\n\t\t\tdelimiter: true\n\t\t});\n\t\tsettingsItems.push({\n\t\t\ttext: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tid: 'configure',\n\t\t\tonclick: this.#switchMenuToEditMode.bind(this),\n\t\t});\n\n\t\treturn settingsItems;\n\t}\n\n\t#getMenu(): Menu\n\t{\n\t\tif (!this.#menu)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: this.id + '-settings-popup',\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\titems: this.#getMenuItemsInViewMode(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#switchMenuToEditMode(): void\n\t{\n\t\tthis.#getMenu().close();\n\t\tthis.#getMenuConfigurable().open().then((result) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Type.isArray(result.items))\n\t\t\t{\n\t\t\t\tthis.#saveSettings(result.items);\n\t\t\t\tthis.#openMenu();\n\t\t\t}\n\t\t});\n\t}\n\n\t#saveSettings(items: Array<{id: string, isHidden: boolean}>): void\n\t{\n\t\tconst channels = [];\n\t\titems.forEach((item) => {\n\t\t\tconst channel = this.#getChannelById(item.id);\n\t\t\tif (channel)\n\t\t\t{\n\t\t\t\tchannel.isHidden = item.isHidden;\n\t\t\t\tchannels.push(channel);\n\t\t\t}\n\t\t});\n\t\tthis.setChannels(channels);\n\t\tthis.adjustAppearance();\n\t\tthis.#menu.destroy();\n\t\tthis.#menu = null;\n\n\t\tUserOptions.save(\"crm\", \"channel-selector\", \"items\", JSON.stringify(items));\n\t}\n\n\t#switchMenuToViewMode(): void\n\t{\n\t\tthis.#menuConfigurable?.close();\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInEditMode(): Array\n\t{\n\t\tconst items = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\titems.push({\n\t\t\t\ttext: channel.title,\n\t\t\t\tid: channel.id,\n\t\t\t\tisHidden: channel.isHidden,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuConfigurable(): MenuConfigurable\n\t{\n\t\tconst items = this.#getMenuItemsInEditMode();\n\t\tif (!this.#menuConfigurable)\n\t\t{\n\t\t\tthis.#menuConfigurable = new MenuConfigurable({\n\t\t\t\titems,\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\tmaxVisibleItems: MAX_VISIBLE_ITEMS,\n\t\t\t});\n\t\t\tthis.#menuConfigurable.subscribe('Cancel', () => {\n\t\t\t\tthis.#openMenu();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#menuConfigurable.setItems(items);\n\t\t}\n\n\t\treturn this.#menuConfigurable;\n\t}\n\n\t#showGetLinkErrorNotification(bindElement: HTMLElement, text: ?string)\n\t{\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\ttext = Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_NOT_AVAILABLE_NOTIFICATION_MESSAGE');\n\t\t}\n\n\t\tthis.#showNotice(text);\n\t}\n\n\t#showNotice(content: string)\n\t{\n\t\tif (NotificationCenter)\n\t\t{\n\t\t\tNotificationCenter.notify({\n\t\t\t\tcontent,\n\t\t\t});\n\t\t}\n\t};\n\n\t#handleChannelClick(channel: ChannelData): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tevent.setData({channel, communications: this.communications[channel.type]});\n\t\tthis.emit('onChannelClick', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#isChannelAvailable(channel))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\tthis.sendEmail(channel);\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_PHONE)\n\t\t{\n\t\t\tthis.sendSms(channel);\n\t\t\treturn;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\tthis.openMessenger(channel);\n\t\t}\n\t}\n\n\tsetFiles(files: number[]): this\n\t{\n\t\tthis.files = Type.isArray(files) ? files : [];\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsetLink(link: string): this\n\t{\n\t\tthis.#link = link ?? null;\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsendEmail(channel: ChannelData): void\n\t{\n\t\tif (this.files.length <= 0 || Number(this.storageTypeId) <= 0)\n\t\t{\n\t\t\tconst channelNode = this.layout.channels[channel.id];\n\t\t\tthis.#getLink().then((link) => {\n\t\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\t\t'subject': this.body,\n\t\t\t\t\t'body': Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t\t\t'#MESSAGE#': this.body,\n\t\t\t\t\t\t'#LINK#': link,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}).catch((reason) => {\n\t\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\t'subject': this.body,\n\t\t\t\t'diskfiles': this.files,\n\t\t\t\t'storageTypeID': this.storageTypeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tsendSms(channel: ChannelData): void\n\t{\n\t\tconst channelNode = this.layout.channels[channel.id];\n\t\tif (!this.smsUrl)\n\t\t{\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, 'No sms url');\n\t\t\treturn;\n\t\t}\n\t\tthis.#getLink().then((link) => {\n\t\t\tRouter.openSlider(this.smsUrl, {\n\t\t\t\twidth: 443,\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tentityId: this.entityId,\n\t\t\t\t\ttext: Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t\t\t'#MESSAGE#': this.body,\n\t\t\t\t\t\t'#LINK#': link,\n\t\t\t\t\t}),\n\t\t\t\t\tproviderId: channel.id,\n\t\t\t\t\tisProviderFixed: 'Y',\n\t\t\t\t}\n\t\t\t});\n\t\t}).catch((reason) => {\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t});\n\t}\n\n\topenMessenger(channel: ChannelData): void\n\t{\n\t\tif (!top.BXIM)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.communications[channel.type])\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttop.BXIM.openMessenger(this.communications[channel.type].VALUE, {RECENT: \"N\", MENU: \"N\"});\n\t}\n\n\t#openContactCenter(): void\n\t{\n\t\tRouter.openSlider(this.contactCenterUrl).then(() => {\n\t\t\tlocation.reload();\n\t\t});\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tstatic getDefault(): ?List\n\t{\n\t\treturn items.get('default');\n\t}\n\n\tstatic getById(id: string): ?List\n\t{\n\t\treturn items.get(id);\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.show(this.layout.container);\n\t\t}\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.hide();\n\t\t}\n\t}\n\n\t#getLoader(): ?Loader\n\t{\n\t\tif(!this.#loader && Loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({size: 100, offset: {left: \"35%\", top: \"-25%\"}});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\tgetChannelIcon(channel: ChannelData): ?string\n\t{\n\t\tlet icon = channel.icon;\n\t\tif (!icon)\n\t\t{\n\t\t\ticon = List.getIconByChannelId(channel.id);\n\t\t}\n\n\t\treturn icon;\n\t}\n\n\tstatic getIconByChannelId(id: string): ?string\n\t{\n\t\tif (id === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn '--service-email';\n\t\t}\n\t\tif (id === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn '--service-livechat';\n\t\t}\n\t\tif (id === 'twilio')\n\t\t{\n\t\t\treturn '--service-whatsapp';\n\t\t}\n\t\tif (id === 'ednaru' || id === 'ednaruimhpx')\n\t\t{\n\t\t\treturn '--service-edna';\n\t\t}\n\n\t\treturn '--service-sms';\n\t}\n}\n"],"names":["CrmActivityEditor","Reflection","namespace","UserOptions","NotificationCenter","CHANNEL_TYPE_PHONE","CHANNEL_TYPE_EMAIL","CHANNEL_TYPE_IM","MAX_VISIBLE_ITEMS","MARKET_LINK","items","Map","List","EventEmitter","constructor","parameters","title","Type","isStringFilled","Loc","getMessage","body","String","link","isLinkObtainable","Text","toBoolean","entityTypeId","toInteger","entityId","id","Math","random","toString","substring","storageTypeId","files","isArray","activityEditorId","smsUrl","setChannels","channels","communications","isPlainObject","hasVisibleChannels","channelIcons","contactCenterUrl","layout","setEventNamespace","size","set","forEach","channel","push","render","container","Tag","encode","footer","bind","settings","list","channelNode","map","icon","appendChild","adjustAppearance","Dom","clean","allChannelsAreHidden","node","append","removeClass","addClass","isHidden","setFiles","setLink","sendEmail","length","Number","then","addEmail","catch","reason","sendSms","Router","openSlider","width","requestMethod","requestParams","text","providerId","isProviderFixed","openMessenger","top","BXIM","type","VALUE","RECENT","MENU","getId","getDefault","get","getById","getChannelIcon","getIconByChannelId","channelHandler","find","isAvailable","hasLink","Boolean","hasFiles","console","log","Promise","resolve","reject","emitAsync","result","finally","value","focus","setSelectionRange","document","execCommand","event","BaseEvent","emit","isDefaultPrevented","show","settingsItems","onclick","delimiter","href","item","menu","getMenuWindow","getRootMenuWindow","close","MenuManager","create","bindElement","open","isCanceled","destroy","save","JSON","stringify","MenuConfigurable","maxVisibleItems","subscribe","setItems","content","notify","setData","location","reload","loader","hide","Loader","offset","left"],"mappings":";;;;;;;;;;;;;;;;AAAA,CASA,MAAMA,iBAAiB,GAAGC,oBAAU,CAACC,SAAS,CAAC,sBAAsB,CAAC;CACtE,MAAMC,WAAW,GAAGF,oBAAU,CAACC,SAAS,CAAC,gBAAgB,CAAC;CAC1D,MAAME,kBAAkB,GAAGH,oBAAU,CAACC,SAAS,CAAC,2BAA2B,CAAC;CAE5E,MAAMG,kBAAkB,GAAG,OAAO;CAClC,MAAMC,kBAAkB,GAAG,OAAO;CAClC,MAAMC,eAAe,GAAG,IAAI;CAE5B,MAAMC,iBAAiB,GAAG,CAAC;CAC3B,MAAMC,WAAW,GAAG,iCAAiC;CAqCrD,MAAMC,KAAK,GAAG,IAAIC,GAAG,EAAE;;CAEvB;CACA;CACA;CAFA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAGA,CAAO,MAAMC,IAAI,SAASC,6BAAY,CACtC;GA2BCC,WAAW,CAACC,UAAqC,EACjD;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACR,IAAI,CAACC,KAAK,GAAGC,cAAI,CAACC,cAAc,CAACH,UAAU,CAACC,KAAK,CAAC,GAAGD,UAAU,CAACC,KAAK,GAAGG,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KAC5H,IAAI,CAACC,IAAI,GAAGC,MAAM,CAACP,UAAU,CAACM,IAAI,CAAC;KACnC,4CAAI,kBAASC,MAAM,CAACP,UAAU,CAACQ,IAAI,CAAC;KACpC,IAAI,CAACC,gBAAgB,GAAGC,cAAI,CAACC,SAAS,CAACX,UAAU,CAACS,gBAAgB,CAAC;KACnE,IAAI,CAACG,YAAY,GAAGF,cAAI,CAACG,SAAS,CAACb,UAAU,CAACY,YAAY,CAAC;KAC3D,IAAI,CAACE,QAAQ,GAAGJ,cAAI,CAACG,SAAS,CAACb,UAAU,CAACc,QAAQ,CAAC;KACnD,IAAI,CAACC,EAAE,GAAGb,cAAI,CAACC,cAAc,CAACH,UAAU,CAACe,EAAE,CAAC,GAAGf,UAAU,CAACe,EAAE,GAAG,IAAI,CAACH,YAAY,GAAG,GAAG,GAAG,IAAI,CAACE,QAAQ,GAAG,GAAG,GAAGE,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,EAAE,CAACC,SAAS,CAAC,CAAC,CAAC;KACpJ,IAAI,CAACC,aAAa,GAAGV,cAAI,CAACG,SAAS,CAACb,UAAU,CAACoB,aAAa,CAAC;KAC7D,IAAI,CAACC,KAAK,GAAGnB,cAAI,CAACoB,OAAO,CAACtB,UAAU,CAACqB,KAAK,CAAC,GAAGrB,UAAU,CAACqB,KAAK,GAAG,EAAE;KACnE,IAAI,CAACE,gBAAgB,GAAGhB,MAAM,CAACP,UAAU,CAACuB,gBAAgB,CAAC;KAC3D,IAAI,CAACC,MAAM,GAAGjB,MAAM,CAACP,UAAU,CAACwB,MAAM,CAAC;KACvC,IAAI,CAACC,WAAW,CAACzB,UAAU,CAAC0B,QAAQ,CAAC;KACrC,IAAI,CAACC,cAAc,GAAGzB,cAAI,CAAC0B,aAAa,CAAC5B,UAAU,CAAC2B,cAAc,CAAC,GAAG3B,UAAU,CAAC2B,cAAc,GAAG,EAAE;KACpG,IAAI,CAACE,kBAAkB,GAAGnB,cAAI,CAACC,SAAS,CAACX,UAAU,CAAC6B,kBAAkB,CAAC;KACvE,IAAI,CAACC,YAAY,GAAG5B,cAAI,CAACoB,OAAO,CAACtB,UAAU,CAAC8B,YAAY,CAAC,GAAG9B,UAAU,CAAC8B,YAAY,GAAG,EAAE;KACxF,IAAI,CAACC,gBAAgB,GAAG7B,cAAI,CAACC,cAAc,CAACH,UAAU,CAAC+B,gBAAgB,CAAC,GAAG/B,UAAU,CAAC+B,gBAAgB,GAAG,kBAAkB;KAC3H,IAAI,CAACC,MAAM,GAAG;OACbN,QAAQ,EAAE;MACV;KACD,IAAI,CAACO,iBAAiB,CAAC,6BAA6B,CAAC;KAErD,IAAItC,KAAK,CAACuC,IAAI,KAAK,CAAC,EACpB;OACCvC,KAAK,CAACwC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC;;KAE3BxC,KAAK,CAACwC,GAAG,CAAC,IAAI,CAACpB,EAAE,EAAE,IAAI,CAAC;;GAGzBU,WAAW,CAACC,QAA4B,EACxC;KACC,IAAI,CAACA,QAAQ,GAAG,EAAE;KAClB,IAAIxB,cAAI,CAACoB,OAAO,CAACI,QAAQ,CAAC,EAC1B;OACCA,QAAQ,CAACU,OAAO,CAAEC,OAAoB,IAAK;SAC1C,IAAI,CAACX,QAAQ,CAACY,IAAI,CAACD,OAAO,CAAC;QAC3B,CAAC;;KAGH,OAAO,IAAI;;GAGZE,MAAM,GACN;KACC,IAAI,IAAI,CAACP,MAAM,CAACQ,SAAS,EACzB;OACC,OAAO,IAAI,CAACR,MAAM,CAACQ,SAAS;;KAE7B,IAAI,CAACR,MAAM,CAAC/B,KAAK,GAAGwC,aAAG,CAACF,MAAM,cAAC,6CAA0C,CAA0B,QAAM,GAA9B7B,cAAI,CAACgC,MAAM,CAAC,IAAI,CAACzC,KAAK,CAAC,CAAQ;KAC1G,IAAI,4CAAI,mBAAU,IAAI,CAACQ,gBAAgB,EACvC;OACC,IAAI,CAACuB,MAAM,CAACxB,IAAI,GAAGiC,aAAG,CAACF,MAAM,gBAAC,+EAA4E,CAA0B,MAAI,GAA5B7B,cAAI,CAACgC,MAAM,yCAAC,IAAI,gBAAO,CAAM;;OAEzI,IAAI,CAACV,MAAM,CAACW,MAAM,GAAGF,aAAG,CAACF,MAAM,gBAAC,uDAAoD,CAAqC;;wDAEtE,CAA6C;OAC9F,CAAmB;;UAEf,GALgF,4CAAI,0CAAoBK,IAAI,CAAC,IAAI,CAAC,EAEnExC,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,EAC3F,IAAI,CAAC2B,MAAM,CAACxB,IAAI,CAEb;MACP,MAED;OACC,IAAI,CAACwB,MAAM,CAACW,MAAM,GAAG,IAAI;;KAG1B,IAAI,CAACX,MAAM,CAACa,QAAQ,GAAG,IAAI;KAC3B,IAAI,IAAI,CAAChB,kBAAkB,EAC3B;OACC,IAAI,CAACG,MAAM,CAACa,QAAQ,GAAGJ,aAAG,CAACF,MAAM,gBAAC,gHAA6G,CAAuC,aAAW,GAAhD,4CAAI,8CAAsBK,IAAI,CAAC,IAAI,CAAC,CAAa;OAClM,IAAI,CAACZ,MAAM,CAACc,IAAI,GAAGL,aAAG,CAACF,MAAM,gBAAC,iDAA+C,EAAC;OAE9E,IAAI,CAACb,QAAQ,CAACU,OAAO,CAAEC,OAAoB,IAC3C;SACC,MAAMU,WAAW,2CAAG,IAAI,kCAAgBV,OAAO,CAAC;SAChD,IAAIU,WAAW,EACf;WACC,IAAI,CAACf,MAAM,CAACN,QAAQ,CAACW,OAAO,CAACtB,EAAE,CAAC,GAAGgC,WAAW;;QAE/C,CAAC;MACF,MAED;OACC,IAAI,CAACf,MAAM,CAACc,IAAI,GAAGL,aAAG,CAACF,MAAM,gBAAC;;yDAEsB,CAAiE;;OAEnH,CAAiK;yEAC/F,CAAqC;;yFAErB,CAAqC,MAAG,CAA2D;;SAElL,GAPiDnC,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EAEhH,IAAI,CAACyB,YAAY,CAACkB,GAAG,CAACC,IAAI,IAAIR,aAAG,CAACF,MAAM,gBAAC,sDAAmD,CAAO,cAAW,CAAqC,WAAS,GAA9DU,IAAI,EAAc,4CAAI,0CAAoBL,IAAI,CAAC,IAAI,CAAC,CAAW,CAAC,EAC5F,4CAAI,0CAAoBA,IAAI,CAAC,IAAI,CAAC,EAElB,4CAAI,0CAAoBA,IAAI,CAAC,IAAI,CAAC,EAAMxC,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC,CAEhL;;KAGP,IAAI,CAAC2B,MAAM,CAACQ,SAAS,GAAGC,aAAG,CAACF,MAAM,gBAAC;;MAEjC,CAAoB;MACpB,CAAuB;;KAExB,CAAmB;SACd,GAJF,IAAI,CAACP,MAAM,CAAC/B,KAAK,EACjB,IAAI,CAAC+B,MAAM,CAACa,QAAQ,EAErB,IAAI,CAACb,MAAM,CAACc,IAAI,CACZ;KAEP,IAAI,IAAI,CAACd,MAAM,CAACW,MAAM,EACtB;OACC,IAAI,CAACX,MAAM,CAACQ,SAAS,CAACU,WAAW,CAAC,IAAI,CAAClB,MAAM,CAACW,MAAM,CAAC;;KAGtD,IAAI,CAACQ,gBAAgB,EAAE;KAEvB,OAAO,IAAI,CAACnB,MAAM,CAACQ,SAAS;;GAyB7BW,gBAAgB,GAChB;KACC,IAAI,IAAI,CAACtB,kBAAkB,EAC3B;OACCuB,aAAG,CAACC,KAAK,CAAC,IAAI,CAACrB,MAAM,CAACc,IAAI,CAAC;OAC3B,IAAIQ,oBAAoB,GAAG,IAAI;OAC/B,IAAI,CAAC5B,QAAQ,CAACU,OAAO,CAAEC,OAAoB,IAC3C;SACC,MAAMkB,IAAI,GAAG,IAAI,CAACvB,MAAM,CAACN,QAAQ,CAACW,OAAO,CAACtB,EAAE,CAAC;SAC7C,IAAIwC,IAAI,EACR;WACC,IAAI,CAACvB,MAAM,CAACc,IAAI,CAACU,MAAM,CAACD,IAAI,CAAC;WAC7B,4CAAI,IAAI,4CAAqBlB,OAAO,GACpC;aACCe,aAAG,CAACK,WAAW,CAACF,IAAI,EAAE,yCAAyC,CAAC;YAChE,MAED;aACCH,aAAG,CAACM,QAAQ,CAACH,IAAI,EAAE,yCAAyC,CAAC;;WAE9D,IAAIlB,OAAO,CAACsB,QAAQ,EACpB;aACCP,aAAG,CAACM,QAAQ,CAACH,IAAI,EAAE,uCAAuC,CAAC;YAC3D,MAED;aACCH,aAAG,CAACK,WAAW,CAACF,IAAI,EAAE,uCAAuC,CAAC;aAC9DD,oBAAoB,GAAG,KAAK;;;QAG9B,CAAC;OACF,IAAIA,oBAAoB,EACxB;SACCF,aAAG,CAACM,QAAQ,CAAC,IAAI,CAAC1B,MAAM,CAACc,IAAI,EAAE,SAAS,CAAC;QACzC,MAED;SACCM,aAAG,CAACK,WAAW,CAAC,IAAI,CAACzB,MAAM,CAACc,IAAI,EAAE,SAAS,CAAC;;;;GAoS/Cc,QAAQ,CAACvC,KAAe,EACxB;KACC,IAAI,CAACA,KAAK,GAAGnB,cAAI,CAACoB,OAAO,CAACD,KAAK,CAAC,GAAGA,KAAK,GAAG,EAAE;KAE7C,IAAI,CAAC8B,gBAAgB,EAAE;KAEvB,OAAO,IAAI;;GAGZU,OAAO,CAACrD,IAAY,EACpB;KACC,4CAAI,kBAASA,IAAI,WAAJA,IAAI,GAAI,IAAI;KAEzB,IAAI,CAAC2C,gBAAgB,EAAE;KAEvB,OAAO,IAAI;;GAGZW,SAAS,CAACzB,OAAoB,EAC9B;KACC,IAAI,IAAI,CAAChB,KAAK,CAAC0C,MAAM,IAAI,CAAC,IAAIC,MAAM,CAAC,IAAI,CAAC5C,aAAa,CAAC,IAAI,CAAC,EAC7D;OACC,MAAM2B,WAAW,GAAG,IAAI,CAACf,MAAM,CAACN,QAAQ,CAACW,OAAO,CAACtB,EAAE,CAAC;OACpD,4CAAI,wBAAYkD,IAAI,CAAEzD,IAAI,IAAK;SAAA;SAC9BvB,iBAAiB,6CAAjBA,iBAAiB,CAAEU,KAAK,CAAC,IAAI,CAAC4B,gBAAgB,CAAC,qBAA/C,sBAAiD2C,QAAQ,CAAC;WACzD,SAAS,EAAE,IAAI,CAAC5D,IAAI;WACpB,MAAM,EAAEF,aAAG,CAACC,UAAU,CAAC,wCAAwC,EAAE;aAChE,WAAW,EAAE,IAAI,CAACC,IAAI;aACtB,QAAQ,EAAEE;YACV;UACD,CAAC;QACF,CAAC,CAAC2D,KAAK,CAAEC,MAAM,IAAK;SACpB,4CAAI,gEAA+BrB,WAAW,EAAEqB,MAAM;QACtD,CAAC;MACF,MAED;OAAA;OACCnF,iBAAiB,8CAAjBA,iBAAiB,CAAEU,KAAK,CAAC,IAAI,CAAC4B,gBAAgB,CAAC,qBAA/C,uBAAiD2C,QAAQ,CAAC;SACzD,SAAS,EAAE,IAAI,CAAC5D,IAAI;SACpB,WAAW,EAAE,IAAI,CAACe,KAAK;SACvB,eAAe,EAAE,IAAI,CAACD;QACtB,CAAC;;;GAIJiD,OAAO,CAAChC,OAAoB,EAC5B;KACC,MAAMU,WAAW,GAAG,IAAI,CAACf,MAAM,CAACN,QAAQ,CAACW,OAAO,CAACtB,EAAE,CAAC;KACpD,IAAI,CAAC,IAAI,CAACS,MAAM,EAChB;OACC,4CAAI,gEAA+BuB,WAAW,EAAE,YAAY;OAC5D;;KAED,4CAAI,wBAAYkB,IAAI,CAAEzD,IAAI,IAAK;OAC9B8D,iBAAM,CAACC,UAAU,CAAC,IAAI,CAAC/C,MAAM,EAAE;SAC9BgD,KAAK,EAAE,GAAG;SACVC,aAAa,EAAE,MAAM;SACrBC,aAAa,EAAE;WACd9D,YAAY,EAAE,IAAI,CAACA,YAAY;WAC/BE,QAAQ,EAAE,IAAI,CAACA,QAAQ;WACvB6D,IAAI,EAAEvE,aAAG,CAACC,UAAU,CAAC,wCAAwC,EAAE;aAC9D,WAAW,EAAE,IAAI,CAACC,IAAI;aACtB,QAAQ,EAAEE;YACV,CAAC;WACFoE,UAAU,EAAEvC,OAAO,CAACtB,EAAE;WACtB8D,eAAe,EAAE;;QAElB,CAAC;MACF,CAAC,CAACV,KAAK,CAAEC,MAAM,IAAK;OACpB,4CAAI,gEAA+BrB,WAAW,EAAEqB,MAAM;MACtD,CAAC;;GAGHU,aAAa,CAACzC,OAAoB,EAClC;KACC,IAAI,CAAC0C,GAAG,CAACC,IAAI,EACb;OACC;;KAED,IAAI,CAAC,IAAI,CAACrD,cAAc,CAACU,OAAO,CAAC4C,IAAI,CAAC,EACtC;OACC;;KAEDF,GAAG,CAACC,IAAI,CAACF,aAAa,CAAC,IAAI,CAACnD,cAAc,CAACU,OAAO,CAAC4C,IAAI,CAAC,CAACC,KAAK,EAAE;OAACC,MAAM,EAAE,GAAG;OAAEC,IAAI,EAAE;MAAI,CAAC;;GAU1FC,KAAK,GACL;KACC,OAAO,IAAI,CAACtE,EAAE;;GAGf,OAAOuE,UAAU,GACjB;KACC,OAAO3F,KAAK,CAAC4F,GAAG,CAAC,SAAS,CAAC;;GAG5B,OAAOC,OAAO,CAACzE,EAAU,EACzB;KACC,OAAOpB,KAAK,CAAC4F,GAAG,CAACxE,EAAE,CAAC;;GA+BrB0E,cAAc,CAACpD,OAAoB,EACnC;KACC,IAAIY,IAAI,GAAGZ,OAAO,CAACY,IAAI;KACvB,IAAI,CAACA,IAAI,EACT;OACCA,IAAI,GAAGpD,IAAI,CAAC6F,kBAAkB,CAACrD,OAAO,CAACtB,EAAE,CAAC;;KAG3C,OAAOkC,IAAI;;GAGZ,OAAOyC,kBAAkB,CAAC3E,EAAU,EACpC;KACC,IAAIA,EAAE,KAAKxB,kBAAkB,EAC7B;OACC,OAAO,iBAAiB;;KAEzB,IAAIwB,EAAE,KAAKvB,eAAe,EAC1B;OACC,OAAO,oBAAoB;;KAE5B,IAAIuB,EAAE,KAAK,QAAQ,EACnB;OACC,OAAO,oBAAoB;;KAE5B,IAAIA,EAAE,KAAK,QAAQ,IAAIA,EAAE,KAAK,aAAa,EAC3C;OACC,OAAO,gBAAgB;;KAGxB,OAAO,eAAe;;CAExB;CAAC,yBAvgBesB,OAAoB,EACnC;GACC,MAAMsD,cAAc,GAAI,MAAM;KAC7B,4CAAI,4CAAqBtD,OAAO;IAC/B;GAEF,IAAIY,IAAI,GAAG,IAAI,CAACwC,cAAc,CAACpD,OAAO,CAAC;GAEvC,OAAOI,aAAG,CAACF,MAAM,gBAAC;;cAER,CAAiB;;KAE1B,CAA4F;;MAE3F,CAA6B;;;+DAG4B,CAAqD;;SAE1G,GATMoD,cAAc,EAEtB1C,IAAI,GAAGR,aAAG,CAACF,MAAM,kBAAC,mDAAgD,CAAO,UAAQ,GAAbU,IAAI,IAAa,EAAE,EAEvFvC,cAAI,CAACgC,MAAM,CAACL,OAAO,CAACpC,KAAK,CAAC,EAG+BG,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;CAGhH;CAAC,0BA4CeU,EAAU,EAC1B;GACC,OAAO,IAAI,CAACW,QAAQ,CAACkE,IAAI,CAACvD,OAAO,IAAIA,OAAO,CAACtB,EAAE,KAAKA,EAAE,CAAC;CACxD;CAAC,8BAEmBsB,OAAoB,EACxC;GACC,IAAI,CAACA,OAAO,CAACwD,WAAW,EACxB;KACC,OAAO,KAAK;;GAEb,MAAMC,OAAO,GAAG,IAAI,CAACrF,gBAAgB,IAAIsF,OAAO,yCAAC,IAAI,gBAAO;GAC5D,MAAMC,QAAQ,GAAG/G,iBAAiB,IAAI,IAAI,CAACmC,aAAa,GAAG,CAAC,IAAI,IAAI,CAACC,KAAK,CAAC0C,MAAM,GAAG,CAAC;GACrF,IAAI1B,OAAO,CAAC4C,IAAI,KAAK3F,kBAAkB,IAAI+C,OAAO,CAAC4C,IAAI,KAAKzF,eAAe,EAC3E;KACC,OAAOsG,OAAO;;GAEf,IAAIzD,OAAO,CAAC4C,IAAI,KAAK1F,kBAAkB,EACvC;KACC,OAAOuG,OAAO,IAAIE,QAAQ;;GAE3B,IACC3D,OAAO,CAAC4C,IAAI,KAAK1F,kBAAkB,IAChC,EAACN,iBAAiB,YAAjBA,iBAAiB,CAAEU,KAAK,CAAC,IAAI,CAAC4B,gBAAgB,CAAC,GAEpD;KACC0E,OAAO,CAACC,GAAG,CAAC,+EAA+E,CAAC;KAC5F,OAAO,KAAK;;GAGb,OAAO7D,OAAO,CAACwD,WAAW;CAC3B;CAAC,qBAGD;GACC,4CAAI,IAAI,iBACR;KACC,OAAOM,OAAO,CAACC,OAAO,yCAAC,IAAI,gBAAO;;GAEnC,IAAI,CAAC,IAAI,CAAC3F,gBAAgB,EAC1B;KACC,OAAO0F,OAAO,CAACE,MAAM,EAAE;;GAExB,4CAAI,IAAI,qCACR;KACC,+CAAO,IAAI;;GAEZ,4CAAI,sCAAmB,IAAIF,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvD,4CAAI;KACJ,IAAI,CAACC,SAAS,CAAC,SAAS,CAAC,CAACrC,IAAI,CAAEsC,MAAa,IAAK;OACjDA,MAAM,CAACnE,OAAO,CAAE5B,IAAI,IAAK;SACxB,IAAI,CAACqD,OAAO,CAACrD,IAAI,CAAC;QAClB,CAAC;OACF,IAAI,yCAAC,IAAI,eAAM,EACf;SACC6F,MAAM,EAAE;QACR,MAED;SACCD,OAAO,yCAAC,IAAI,gBAAO;;MAEpB,CAAC,CAACjC,KAAK,CAACkC,MAAM,CAAC,CACfG,OAAO,CAAC,MAAM;OACd,4CAAI,sCAAmB,IAAI;OAC3B,4CAAI;MACJ,CAAC;IACF,CAAC;GAEF,+CAAO,IAAI;CACZ;CAAC,+BAGD;GACC,IAAI,CAAC,IAAI,CAACxE,MAAM,CAACxB,IAAI,EACrB;KACC;;GAED,4CAAI,wBAAYyD,IAAI,CAAEzD,IAAI,IAAK;KAC9B,IAAI,CAACwB,MAAM,CAACxB,IAAI,CAACiG,KAAK,GAAGjG,IAAI;KAC7B,IAAI,CAACwB,MAAM,CAACxB,IAAI,CAACkG,KAAK,EAAE;KACxB,IAAI,CAAC1E,MAAM,CAACxB,IAAI,CAACmG,iBAAiB,CAAC,CAAC,EAAE,IAAI,CAAC3E,MAAM,CAACxB,IAAI,CAACiG,KAAK,CAAC1C,MAAM,CAAC;KACpE6C,QAAQ,CAACC,WAAW,CAAC,MAAM,CAAC;KAE5B,4CAAI,4BAAazG,aAAG,CAACC,UAAU,CAAC,qDAAqD,CAAC;IACtF,CAAC,CAAC8D,KAAK,CAAEC,MAAe,IAAK;KAC7B,4CAAI,gEAA+B,IAAI,CAACpC,MAAM,CAACW,MAAM,EAAEyB,MAAM;IAC7D,CAAC;CACH;CAAC,iCAGD;GACC,MAAM0C,KAAK,GAAG,IAAIC,0BAAS,EAAE;GAC7B,IAAI,CAACC,IAAI,CAAC,iBAAiB,EAAEF,KAAK,CAAC;GACnC,IAAIA,KAAK,CAACG,kBAAkB,EAAE,EAC9B;KACC;;GAGD,4CAAI;CACL;CAAC,sBAGD;GACC,4CAAI,wBAAYC,IAAI,EAAE;CACvB;CAAC,oCAGD;GACC,MAAMC,aAAa,GAAG,EAAE;GACxB,IAAI,CAACzF,QAAQ,CAACU,OAAO,CAAEC,OAAoB,IAAK;KAC/C,IAAIA,OAAO,CAACsB,QAAQ,EACpB;OACCwD,aAAa,CAAC7E,IAAI,CAAC;SAClBqC,IAAI,EAAEtC,OAAO,CAACpC,KAAK;SACnBc,EAAE,EAAEsB,OAAO,CAACtB,EAAE;SACdqG,OAAO,EAAE,MAAM;WACd,4CAAI,4CAAqB/E,OAAO;;QAEjC,CAAC;;IAEH,CAAC;GAEF8E,aAAa,CAAC7E,IAAI,CAAC;KAClB+E,SAAS,EAAE;IACX,CAAC;GACFF,aAAa,CAAC7E,IAAI,CAAC;KAClBqC,IAAI,EAAEvE,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;KAC/DU,EAAE,EAAE,QAAQ;KACZuG,IAAI,EAAE5H,WAAW;KACjB0H,OAAO,EAAE,CAACN,KAAmB,EAAES,IAAc,KAAK;OAAA;OACjD,MAAMC,IAAI,GAAG,wBAAAD,IAAI,CAACE,aAAa,EAAE,qBAApB,oBAAsBC,iBAAiB,EAAE,KAAIH,IAAI,CAACE,aAAa,EAAE;OAC9ED,IAAI,oBAAJA,IAAI,CAAEG,KAAK,EAAE;;IAEd,CAAC;GAEFR,aAAa,CAAC7E,IAAI,CAAC;KAClB+E,SAAS,EAAE;IACX,CAAC;GACFF,aAAa,CAAC7E,IAAI,CAAC;KAClBqC,IAAI,EAAEvE,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;KAChDU,EAAE,EAAE,WAAW;KACfqG,OAAO,EAAE,4CAAI,gDAAuBxE,IAAI,CAAC,IAAI;IAC7C,CAAC;GAEF,OAAOuE,aAAa;CACrB;CAAC,qBAGD;GACC,IAAI,yCAAC,IAAI,eAAM,EACf;KACC,4CAAI,kBAASS,sBAAW,CAACC,MAAM,CAAC;OAC/B9G,EAAE,EAAE,IAAI,CAACA,EAAE,GAAG,iBAAiB;OAC/B+G,WAAW,EAAE,IAAI,CAAC9F,MAAM,CAACa,QAAQ;OACjClD,KAAK,0CAAE,IAAI;MACX,CAAC;;GAGH,+CAAO,IAAI;CACZ;CAAC,kCAGD;GACC,4CAAI,wBAAYgI,KAAK,EAAE;GACvB,4CAAI,gDAAwBI,IAAI,EAAE,CAAC9D,IAAI,CAAEsC,MAAM,IAAK;KACnD,IAAIA,MAAM,CAACyB,UAAU,EACrB;OACC;;KAED,IAAI9H,cAAI,CAACoB,OAAO,CAACiF,MAAM,CAAC5G,KAAK,CAAC,EAC9B;OACC,4CAAI,gCAAe4G,MAAM,CAAC5G,KAAK;OAC/B,4CAAI;;IAEL,CAAC;CACH;CAAC,wBAEaA,KAA6C,EAC3D;GACC,MAAM+B,QAAQ,GAAG,EAAE;GACnB/B,KAAK,CAACyC,OAAO,CAAEmF,IAAI,IAAK;KACvB,MAAMlF,OAAO,2CAAG,IAAI,oCAAiBkF,IAAI,CAACxG,EAAE,CAAC;KAC7C,IAAIsB,OAAO,EACX;OACCA,OAAO,CAACsB,QAAQ,GAAG4D,IAAI,CAAC5D,QAAQ;OAChCjC,QAAQ,CAACY,IAAI,CAACD,OAAO,CAAC;;IAEvB,CAAC;GACF,IAAI,CAACZ,WAAW,CAACC,QAAQ,CAAC;GAC1B,IAAI,CAACyB,gBAAgB,EAAE;GACvB,4CAAI,gBAAO8E,OAAO,EAAE;GACpB,4CAAI,kBAAS,IAAI;GAEjB7I,WAAW,CAAC8I,IAAI,CAAC,KAAK,EAAE,kBAAkB,EAAE,OAAO,EAAEC,IAAI,CAACC,SAAS,CAACzI,KAAK,CAAC,CAAC;CAC5E;CAAC,kCAGD;GAAA;GACC,qEAAI,4DAAJ,sBAAwBgI,KAAK,EAAE;GAC/B,4CAAI,wBAAYT,IAAI,EAAE;CACvB;CAAC,oCAGD;GACC,MAAMvH,KAAK,GAAG,EAAE;GAChB,IAAI,CAAC+B,QAAQ,CAACU,OAAO,CAAEC,OAAoB,IAAK;KAC/C1C,KAAK,CAAC2C,IAAI,CAAC;OACVqC,IAAI,EAAEtC,OAAO,CAACpC,KAAK;OACnBc,EAAE,EAAEsB,OAAO,CAACtB,EAAE;OACd4C,QAAQ,EAAEtB,OAAO,CAACsB;MAClB,CAAC;IACF,CAAC;GAEF,OAAOhE,KAAK;CACb;CAAC,iCAGD;GACC,MAAMA,KAAK,2CAAG,IAAI,qDAA0B;GAC5C,IAAI,yCAAC,IAAI,uCAAkB,EAC3B;KACC,4CAAI,0CAAqB,IAAI0I,wBAAgB,CAAC;OAC7C1I,KAAK;OACLmI,WAAW,EAAE,IAAI,CAAC9F,MAAM,CAACa,QAAQ;OACjCyF,eAAe,EAAE7I;MACjB,CAAC;KACF,4CAAI,wCAAmB8I,SAAS,CAAC,QAAQ,EAAE,MAAM;OAChD,4CAAI;MACJ,CAAC;IACF,MAED;KACC,4CAAI,wCAAmBC,QAAQ,CAAC7I,KAAK,CAAC;;GAGvC,+CAAO,IAAI;CACZ;CAAC,wCAE6BmI,WAAwB,EAAEnD,IAAa,EACrE;GACC,IAAI,CAACzE,cAAI,CAACC,cAAc,CAACwE,IAAI,CAAC,EAC9B;KACCA,IAAI,GAAGvE,aAAG,CAACC,UAAU,CAAC,4DAA4D,CAAC;;GAGpF,4CAAI,4BAAasE,IAAI;CACtB;CAAC,sBAEW8D,OAAe,EAC3B;GACC,IAAIpJ,kBAAkB,EACtB;KACCA,kBAAkB,CAACqJ,MAAM,CAAC;OACzBD;MACA,CAAC;;CAEJ;CAAC,8BAEmBpG,OAAoB,EACxC;GACC,MAAMyE,KAAK,GAAG,IAAIC,0BAAS,EAAE;GAC7BD,KAAK,CAAC6B,OAAO,CAAC;KAACtG,OAAO;KAAEV,cAAc,EAAE,IAAI,CAACA,cAAc,CAACU,OAAO,CAAC4C,IAAI;IAAE,CAAC;GAC3E,IAAI,CAAC+B,IAAI,CAAC,gBAAgB,EAAEF,KAAK,CAAC;GAClC,IAAIA,KAAK,CAACG,kBAAkB,EAAE,EAC9B;KACC;;GAED,IAAI,yCAAC,IAAI,4CAAqB5E,OAAO,CAAC,EACtC;KACC;;GAED,IAAIA,OAAO,CAAC4C,IAAI,KAAK1F,kBAAkB,EACvC;KACC,IAAI,CAACuE,SAAS,CAACzB,OAAO,CAAC;KACvB;;GAED,IAAIA,OAAO,CAAC4C,IAAI,KAAK3F,kBAAkB,EACvC;KACC,IAAI,CAAC+E,OAAO,CAAChC,OAAO,CAAC;KACrB;;GAED,IAAIA,OAAO,CAAC4C,IAAI,KAAKzF,eAAe,EACpC;KACC,IAAI,CAACsF,aAAa,CAACzC,OAAO,CAAC;;CAE7B;CAAC,+BAyFD;GACCiC,iBAAM,CAACC,UAAU,CAAC,IAAI,CAACxC,gBAAgB,CAAC,CAACkC,IAAI,CAAC,MAAM;KACnD2E,QAAQ,CAACC,MAAM,EAAE;IACjB,CAAC;CACH;CAAC,wBAkBD;GACC,MAAMC,MAAM,2CAAG,IAAI,2BAAa;GAChC,IAAIA,MAAM,EACV;KACCA,MAAM,CAAC5B,IAAI,CAAC,IAAI,CAAClF,MAAM,CAACQ,SAAS,CAAC;;CAEpC;CAAC,wBAGD;GACC,MAAMsG,MAAM,2CAAG,IAAI,2BAAa;GAChC,IAAIA,MAAM,EACV;KACCA,MAAM,CAACC,IAAI,EAAE;;CAEf;CAAC,uBAGD;GACC,IAAG,yCAAC,IAAI,mBAAQ,IAAIC,kBAAM,EAC1B;KACC,4CAAI,sBAAW,IAAIA,kBAAM,CAAC;OAAC9G,IAAI,EAAE,GAAG;OAAE+G,MAAM,EAAE;SAACC,IAAI,EAAE,KAAK;SAAEnE,GAAG,EAAE;;MAAQ,CAAC;;GAG3E,+CAAO,IAAI;CACZ;;;;;;;;"}