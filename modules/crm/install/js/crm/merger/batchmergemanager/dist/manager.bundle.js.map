{"version":3,"file":"manager.bundle.js","sources":["../src/manager.js"],"sourcesContent":["import {Loc, Type} from \"main.core\";\n\nexport class BatchMergeManager\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\n\t\tthis._grid = null;\n\t\tthis._kanban = null;\n\t\tthis._entityTypeId = BX.CrmEntityType.enumeration.undefined;\n\t\tthis._entityIds = null;\n\n\t\tthis._errors = null;\n\t\tthis._isRunning = false;\n\n\t\tthis._documentUnloadHandler = BX.delegate(this.onDocumentUnload, this);\n\t\tthis._requestCompleteHandler = BX.delegate(this.onRequestComplete, this);\n\t\tthis._externalEventHandler = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = Type.isStringFilled(id) ? id : \"crm_batch_merge_mgr_\" + Math.random().toString().substring(2);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tconst gridId = BX.prop.getString(this._settings, \"gridId\", null);\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tthis._grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\t}\n\t\tthis._kanban = BX.prop.get(this._settings, \"kanban\", null);\n\n\t\tthis._entityTypeId = BX.prop.getInteger(\n\t\t\tthis._settings,\n\t\t\t\"entityTypeId\",\n\t\t\tBX.CrmEntityType.enumeration.undefined\n\t\t);\n\t\tthis._errors = [];\n\t}\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\tgetMessage (name)\n\t{\n\t\tconst entityTypeName = BX.CrmEntityType.resolveName(this._entityTypeId).toUpperCase();\n\t\treturn BX.prop.getString(\n\t\t\tBX.prop.getObject(this._settings, \"messages\", BX.Crm.BatchMergeManager.messages),\n\t\t\tname,\n\t\t\tLoc.getMessage('CRM_BATCH_MERGER_MANAGER_' + entityTypeName + '_' + name.toUpperCase())\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYFAILED\n\t\t);\n\t}\n\tgetEntityIds()\n\t{\n\t\treturn this._entityIds;\n\t}\n\tsetEntityIds(entityIds)\n\t{\n\t\tthis._entityIds = Type.isArray(entityIds) ? entityIds : [];\n\t}\n\tresetEntityIds()\n\t{\n\t\tthis._entityIds = [];\n\t}\n\tgetErrors()\n\t{\n\t\treturn this._errors ? this._errors : [];\n\t}\n\texecute()\n\t{\n\t\tlet dialogId = this._id.toLowerCase();\n\t\tlet dialog = BX.Crm.ConfirmationDialog.get(dialogId);\n\t\tif(!dialog)\n\t\t{\n\t\t\tdialog = BX.Crm.ConfirmationDialog.create(\n\t\t\t\tdialogId,\n\t\t\t\t{\n\t\t\t\t\ttitle: this.getMessage(\"title\"),\n\t\t\t\t\tcontent: this.getMessage(\"confirmation\")\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif(!dialog.isOpened())\n\t\t{\n\t\t\tdialog.open().then(\n\t\t\t\tfunction(result)\n\t\t\t\t{\n\t\t\t\t\tif(!BX.prop.getBoolean(result, \"cancel\", true))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.startRequest();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\tisRunning()\n\t{\n\t\treturn this._isRunning;\n\t}\n\tstartRequest()\n\t{\n\t\tif(this._isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isRunning = true;\n\n\t\tthis.disableItemsList();\n\t\tBX.bind(window, \"beforeunload\", this._documentUnloadHandler);\n\n\t\tlet params =\n\t\t\t{\n\t\t\t\tentityTypeId: this._entityTypeId,\n\t\t\t\textras: BX.prop.getObject(this._settings, \"extras\", {})\n\t\t\t};\n\n\t\tif(Type.isArray(this._entityIds) && this._entityIds.length > 0)\n\t\t{\n\t\t\tparams[\"entityIds\"] = this._entityIds;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.entity.mergeBatch\",\n\t\t\t{ data: { params:  params } }\n\t\t).then(\n\t\t\tthis._requestCompleteHandler\n\t\t).catch(\n\t\t\tthis._requestCompleteHandler\n\t\t);\n\t}\n\tdisableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableFade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeOut();\n\t\t}\n\t}\n\tenableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableUnfade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeIn();\n\t\t}\n\t}\n\treloadItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.reload();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.reload();\n\t\t}\n\t}\n\tonRequestComplete(response)\n\t{\n\t\tthis.enableItemsList();\n\t\tBX.unbind(window, \"beforeunload\", this._documentUnloadHandler);\n\t\tthis._isRunning = false;\n\t\tthis._errors = [];\n\n\t\tlet status = BX.prop.getString(response, \"status\", \"\");\n\t\tlet data = BX.prop.getObject(response, \"data\", {});\n\n\t\tif(status === \"error\")\n\t\t{\n\t\t\tif(BX.prop.getString(data, \"STATUS\", \"\") === \"CONFLICT\")\n\t\t\t{\n\t\t\t\tthis.openMerger();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet errorInfos = BX.prop.getArray(response, \"errors\", []);\n\t\t\tfor(let i = 0, length = errorInfos.length; i < length; i++)\n\t\t\t{\n\t\t\t\tthis._errors.push(BX.prop.getString(errorInfos[i], \"message\"));\n\t\t\t}\n\t\t}\n\n\t\tthis.displaySummary();\n\t\tif(this._errors.length === 0)\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tthis.complete.bind(this),\n\t\t\t\t0\n\t\t\t);\n\t\t}\n\t}\n\tdisplaySummary()\n\t{\n\t\tlet messages = [this.getMessage(\"summaryCaption\")];\n\t\tif(this._errors.length > 0)\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summaryFailed\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t\tmessages = messages.concat(this._errors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summarySucceeded\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify(\n\t\t\t{\n\t\t\t\tcontent: messages.join(\"<br/>\"),\n\t\t\t\tposition: \"top-center\",\n\t\t\t\tautoHideDelay: 5000\n\t\t\t}\n\t\t);\n\t}\n\topenMerger()\n\t{\n\t\tthis._contextId = this._id + \"_\" + BX.util.getRandomString(6).toUpperCase();\n\n\t\tBX.Crm.Page.open(\n\t\t\tBX.util.add_url_param(\n\t\t\t\tBX.prop.getString(this._settings, \"mergerUrl\", \"\"),\n\t\t\t\t{\n\t\t\t\t\texternalContextId: this._contextId,\n\t\t\t\t\tid: this._entityIds\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tif(!this._externalEventHandler)\n\t\t{\n\t\t\tthis._externalEventHandler = BX.delegate(this.onExternalEvent, this);\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\t}\n\t}\n\tcomplete()\n\t{\n\t\tBX.onCustomEvent(\n\t\t\twindow,\n\t\t\t\"BX.Crm.BatchMergeManager:onComplete\",\n\t\t\t[ this ]\n\t\t);\n\n\t\tthis.reloadItemsList();\n\t}\n\tonDocumentUnload(e)\n\t{\n\t\treturn(e.returnValue = this.getMessage(\"windowCloseConfirm\"));\n\t}\n\tonExternalEvent(params)\n\t{\n\t\tlet eventName = BX.prop.getString(params, \"key\", \"\");\n\n\t\tif(eventName !== \"onCrmEntityMergeComplete\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = BX.prop.getObject(params, \"value\", {});\n\n\t\tif(this._contextId !== BX.prop.getString(value, \"context\", \"\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\tthis._externalEventHandler = null;\n\n\t\tthis.displaySummary();\n\t\twindow.setTimeout(\n\t\t\tthis.complete.bind(this),\n\t\t\t0\n\t\t);\n\t}\n\n\tstatic getItem(id)\n\t{\n\t\treturn BX.prop.get(this.items, id, null);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new BatchMergeManager();\n\t\tself.initialize(id, settings);\n\t\tthis.items[self.getId()] = self;\n\t\treturn self;\n\t}\n}\n\nBatchMergeManager.messages = {};\nBatchMergeManager.items = {};"],"names":["BatchMergeManager","_id","_settings","_grid","_kanban","_entityTypeId","BX","CrmEntityType","enumeration","undefined","_entityIds","_errors","_isRunning","_documentUnloadHandler","delegate","onDocumentUnload","_requestCompleteHandler","onRequestComplete","_externalEventHandler","id","settings","Type","isStringFilled","Math","random","toString","substring","gridId","prop","getString","Main","gridManager","getInstanceById","get","getInteger","name","entityTypeName","resolveName","toUpperCase","getObject","Crm","messages","Loc","getMessage","entityIds","isArray","dialogId","toLowerCase","dialog","ConfirmationDialog","create","title","content","isOpened","open","then","result","getBoolean","startRequest","bind","disableItemsList","window","params","entityTypeId","extras","length","ajax","runAction","data","catch","tableFade","fadeOut","tableUnfade","fadeIn","reload","response","enableItemsList","unbind","status","openMerger","errorInfos","getArray","i","push","displaySummary","setTimeout","complete","replace","concat","UI","Notification","Center","notify","join","position","autoHideDelay","_contextId","util","getRandomString","Page","add_url_param","externalContextId","onExternalEvent","addCustomEvent","onCustomEvent","reloadItemsList","e","returnValue","eventName","value","removeCustomEvent","items","self","initialize","getId"],"mappings":"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"}