{"version":3,"file":"manager.bundle.js","sources":["../src/manager.js"],"sourcesContent":["import {Loc, Type} from \"main.core\";\n\nexport class BatchMergeManager\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\n\t\tthis._grid = null;\n\t\tthis._kanban = null;\n\t\tthis._entityTypeId = BX.CrmEntityType.enumeration.undefined;\n\t\tthis._entityIds = null;\n\n\t\tthis._errors = null;\n\t\tthis._isRunning = false;\n\n\t\tthis._documentUnloadHandler = BX.delegate(this.onDocumentUnload, this);\n\t\tthis._requestCompleteHandler = BX.delegate(this.onRequestComplete, this);\n\t\tthis._externalEventHandler = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = Type.isStringFilled(id) ? id : \"crm_batch_merge_mgr_\" + Math.random().toString().substring(2);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tconst gridId = BX.prop.getString(this._settings, \"gridId\", null);\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tthis._grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\t}\n\t\tthis._kanban = BX.prop.get(this._settings, \"kanban\", null);\n\n\t\tthis._entityTypeId = BX.prop.getInteger(\n\t\t\tthis._settings,\n\t\t\t\"entityTypeId\",\n\t\t\tBX.CrmEntityType.enumeration.undefined\n\t\t);\n\t\tthis._errors = [];\n\t}\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\tgetMessage (name)\n\t{\n\t\tconst entityTypeName = BX.CrmEntityType.resolveName(this._entityTypeId).toUpperCase();\n\t\treturn BX.prop.getString(\n\t\t\tBX.prop.getObject(this._settings, \"messages\", BX.Crm.BatchMergeManager.messages),\n\t\t\tname,\n\t\t\tLoc.getMessage('CRM_BATCH_MERGER_MANAGER_' + entityTypeName + '_' + name.toUpperCase())\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_LEAD_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_DEAL_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_CONTACT_SUMMARYFAILED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_TITLE\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_CONFIRMATION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYCAPTION\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYSUCCEEDED\n\t\t\t// CRM_BATCH_MERGER_MANAGER_COMPANY_SUMMARYFAILED\n\t\t);\n\t}\n\tgetEntityIds()\n\t{\n\t\treturn this._entityIds;\n\t}\n\tsetEntityIds(entityIds)\n\t{\n\t\tthis._entityIds = Type.isArray(entityIds) ? entityIds : [];\n\t}\n\tresetEntityIds()\n\t{\n\t\tthis._entityIds = [];\n\t}\n\tgetErrors()\n\t{\n\t\treturn this._errors ? this._errors : [];\n\t}\n\texecute()\n\t{\n\t\tlet dialogId = this._id.toLowerCase();\n\t\tlet dialog = BX.Crm.ConfirmationDialog.get(dialogId);\n\t\tif(!dialog)\n\t\t{\n\t\t\tdialog = BX.Crm.ConfirmationDialog.create(\n\t\t\t\tdialogId,\n\t\t\t\t{\n\t\t\t\t\ttitle: this.getMessage(\"title\"),\n\t\t\t\t\tcontent: this.getMessage(\"confirmation\")\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif(!dialog.isOpened())\n\t\t{\n\t\t\tdialog.open().then(\n\t\t\t\tfunction(result)\n\t\t\t\t{\n\t\t\t\t\tif(!BX.prop.getBoolean(result, \"cancel\", true))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.startRequest();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\tisRunning()\n\t{\n\t\treturn this._isRunning;\n\t}\n\tstartRequest()\n\t{\n\t\tif(this._isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isRunning = true;\n\n\t\tthis.disableItemsList();\n\t\tBX.bind(window, \"beforeunload\", this._documentUnloadHandler);\n\n\t\tlet params =\n\t\t\t{\n\t\t\t\tentityTypeId: this._entityTypeId,\n\t\t\t\textras: BX.prop.getObject(this._settings, \"extras\", {})\n\t\t\t};\n\n\t\tif(Type.isArray(this._entityIds) && this._entityIds.length > 0)\n\t\t{\n\t\t\tparams[\"entityIds\"] = this._entityIds;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.entity.mergeBatch\",\n\t\t\t{ data: { params:  params } }\n\t\t).then(\n\t\t\tthis._requestCompleteHandler\n\t\t).catch(\n\t\t\tthis._requestCompleteHandler\n\t\t);\n\t}\n\tdisableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableFade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeOut();\n\t\t}\n\t}\n\tenableItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.tableUnfade();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.fadeIn();\n\t\t}\n\t}\n\treloadItemsList()\n\t{\n\t\tif (this._grid)\n\t\t{\n\t\t\tthis._grid.reload();\n\t\t}\n\t\tif (this._kanban)\n\t\t{\n\t\t\tthis._kanban.reload();\n\t\t}\n\t}\n\tonRequestComplete(response)\n\t{\n\t\tthis.enableItemsList();\n\t\tBX.unbind(window, \"beforeunload\", this._documentUnloadHandler);\n\t\tthis._isRunning = false;\n\t\tthis._errors = [];\n\n\t\tlet status = BX.prop.getString(response, \"status\", \"\");\n\t\tlet data = BX.prop.getObject(response, \"data\", {});\n\n\t\tif(status === \"error\")\n\t\t{\n\t\t\tif(BX.prop.getString(data, \"STATUS\", \"\") === \"CONFLICT\")\n\t\t\t{\n\t\t\t\tthis.openMerger();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet errorInfos = BX.prop.getArray(response, \"errors\", []);\n\t\t\tfor(let i = 0, length = errorInfos.length; i < length; i++)\n\t\t\t{\n\t\t\t\tthis._errors.push(BX.prop.getString(errorInfos[i], \"message\"));\n\t\t\t}\n\t\t}\n\n\t\tthis.displaySummary();\n\t\tif(this._errors.length === 0)\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tthis.complete.bind(this),\n\t\t\t\t0\n\t\t\t);\n\t\t}\n\t}\n\tdisplaySummary()\n\t{\n\t\tlet messages = [this.getMessage(\"summaryCaption\")];\n\t\tif(this._errors.length > 0)\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summaryFailed\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t\tmessages = messages.concat(this._errors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessages.push(\n\t\t\t\tthis.getMessage(\"summarySucceeded\").replace(/#number#/gi, this._entityIds.length)\n\t\t\t);\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify(\n\t\t\t{\n\t\t\t\tcontent: messages.join(\"<br/>\"),\n\t\t\t\tposition: \"top-center\",\n\t\t\t\tautoHideDelay: 5000\n\t\t\t}\n\t\t);\n\t}\n\topenMerger()\n\t{\n\t\tthis._contextId = this._id + \"_\" + BX.util.getRandomString(6).toUpperCase();\n\n\t\tBX.Crm.Page.open(\n\t\t\tBX.util.add_url_param(\n\t\t\t\tBX.prop.getString(this._settings, \"mergerUrl\", \"\"),\n\t\t\t\t{\n\t\t\t\t\texternalContextId: this._contextId,\n\t\t\t\t\tid: this._entityIds\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tif(!this._externalEventHandler)\n\t\t{\n\t\t\tthis._externalEventHandler = BX.delegate(this.onExternalEvent, this);\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\t}\n\t}\n\tcomplete()\n\t{\n\t\tBX.onCustomEvent(\n\t\t\twindow,\n\t\t\t\"BX.Crm.BatchMergeManager:onComplete\",\n\t\t\t[ this ]\n\t\t);\n\n\t\tthis.reloadItemsList();\n\t}\n\tonDocumentUnload(e)\n\t{\n\t\treturn(e.returnValue = this.getMessage(\"windowCloseConfirm\"));\n\t}\n\tonExternalEvent(params)\n\t{\n\t\tlet eventName = BX.prop.getString(params, \"key\", \"\");\n\n\t\tif(eventName !== \"onCrmEntityMergeComplete\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = BX.prop.getObject(params, \"value\", {});\n\n\t\tif(this._contextId !== BX.prop.getString(value, \"context\", \"\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\tthis._externalEventHandler = null;\n\n\t\tthis.displaySummary();\n\t\twindow.setTimeout(\n\t\t\tthis.complete.bind(this),\n\t\t\t0\n\t\t);\n\t}\n\n\tstatic getItem(id)\n\t{\n\t\treturn BX.prop.get(this.items, id, null);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new BatchMergeManager();\n\t\tself.initialize(id, settings);\n\t\tthis.items[self.getId()] = self;\n\t\treturn self;\n\t}\n}\n\nBatchMergeManager.messages = {};\nBatchMergeManager.items = {};"],"names":["BatchMergeManager","_id","_settings","_grid","_kanban","_entityTypeId","BX","CrmEntityType","enumeration","undefined","_entityIds","_errors","_isRunning","_documentUnloadHandler","delegate","onDocumentUnload","_requestCompleteHandler","onRequestComplete","_externalEventHandler","id","settings","Type","isStringFilled","Math","random","toString","substring","gridId","prop","getString","Main","gridManager","getInstanceById","get","getInteger","name","entityTypeName","resolveName","toUpperCase","getObject","Crm","messages","Loc","getMessage","entityIds","isArray","dialogId","toLowerCase","dialog","ConfirmationDialog","create","title","content","isOpened","open","then","result","getBoolean","startRequest","bind","disableItemsList","window","params","entityTypeId","extras","length","ajax","runAction","data","tableFade","fadeOut","tableUnfade","fadeIn","reload","response","enableItemsList","unbind","status","openMerger","errorInfos","getArray","i","push","displaySummary","setTimeout","complete","replace","concat","UI","Notification","Center","notify","join","position","autoHideDelay","_contextId","util","getRandomString","Page","add_url_param","externalContextId","onExternalEvent","addCustomEvent","onCustomEvent","reloadItemsList","e","returnValue","eventName","value","removeCustomEvent","items","self","initialize","getId"],"mappings":"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"}