{"version":3,"file":"item-details-component.bundle.js","sources":["../src/item-details-component.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Reflection, Tag, Text, Type, Uri } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\nimport { StageFlow } from 'ui.stageflow';\nimport type { StageModelData } from 'crm.stage-model';\nimport { StageModel } from 'crm.stage-model';\nimport { Loader } from \"main.loader\";\nimport { PopupMenu } from \"main.popup\";\n\nexport type ItemDetailsComponentParams = {\n\tentityTypeId: number,\n\tentityTypeName: string,\n\tserviceUrl: string,\n\tid: number,\n\tcategoryId?: number,\n\tcategories?: Category[],\n\terrorTextContainer: HTMLElement,\n\tstages: StageModelData[],\n\tcurrentStageId: number,\n\tmessages: Object,\n\tsignedParameters: ?string,\n\tdocumentButtonParameters: ?Object,\n\tisPageTitleEditable: boolean,\n\tuserFieldCreateUrl: ?string,\n\teditorGuid: ?string,\n\tisStageFlowActive: ?boolean,\n\tpullTag: ?string,\n\tbizprocStarterConfig: ?Object,\n};\n\ndeclare type Category = {\n\tid: string,\n\tcategoryId: number,\n\ttext: string,\n\thref: string,\n};\n\nconst BACKGROUND_COLOR = 'd3d7dc';\n\nexport class ItemDetailsComponent\n{\n\tentityTypeId: number;\n\tentityTypeName: string;\n\tid: number;\n\tcategoryId: ?number = null;\n\tcategories: ?Category[];\n\terrorTextContainer: HTMLElement;\n\tstages: StageModel[];\n\tstageflowChart: StageFlow.Chart;\n\tcurrentStageId: number;\n\tisProgress: boolean;\n\tcontainer: HTMLElement;\n\tmessages: {[code: string]: string};\n\tsignedParameters: ?string;\n\tdocumentButtonParameters: ?Object;\n\tisPageTitleEditable: boolean;\n\tpartialEntityEditor: ?BX.Crm.PartialEditorDialog;\n\tpartialEditorId: ?string;\n\teditorContext: Object;\n\tuserFieldCreateUrl: ?string;\n\teditorGuid: ?string;\n\tisStageFlowActive: ?boolean;\n\tpullTag: ?string;\n\tbizprocStarterConfig: ?Object;\n\n\tconstructor(params: ItemDetailsComponentParams): void\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.id = Text.toInteger(params.id);\n\t\t\tif (BX.Crm.PartialEditorDialog && params.serviceUrl)\n\t\t\t{\n\t\t\t\tthis.partialEditorId = 'partial_editor_' + this.entityTypeId + '_' + this.id;\n\t\t\t\tBX.Crm.PartialEditorDialog.registerEntityEditorUrl(this.entityTypeId, params.serviceUrl);\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('editorContext'))\n\t\t\t{\n\t\t\t\tthis.editorContext = params.editorContext;\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('categoryId'))\n\t\t\t{\n\t\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\t\t\t\tthis.categories = params.categories;\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif(Type.isArray(params.stages))\n\t\t\t{\n\t\t\t\tthis.stages = [];\n\t\t\t\tparams.stages.forEach((data) => {\n\t\t\t\t\tthis.stages.push(new StageModel(data));\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.currentStageId = params.currentStageId;\n\t\t\tthis.messages = params.messages;\n\t\t\tthis.signedParameters = params.signedParameters;\n\t\t\tthis.documentButtonParameters = params.documentButtonParameters;\n\t\t\tthis.userFieldCreateUrl = params.userFieldCreateUrl;\n\t\t\tthis.editorGuid = params.editorGuid;\n\t\t\tthis.isStageFlowActive = params.isStageFlowActive;\n\t\t\tthis.pullTag = params.pullTag;\n\t\t\tthis.bizprocStarterConfig = params.bizprocStarterConfig;\n\n\t\t\tthis.isPageTitleEditable = Boolean(params.isPageTitleEditable);\n\t\t}\n\n\t\tthis.container = document.querySelector('[data-role=\"crm-item-detail-container\"]');\n\t\tthis.handleClosePartialEntityEditor = this.handleClosePartialEntityEditor.bind(this);\n\t\tthis.handleErrorPartialEntityEditor = this.handleErrorPartialEntityEditor.bind(this);\n\t}\n\n\tgetCurrentCategory(): ?Category\n\t{\n\t\tlet currentCategory = null\n\t\tif(this.categories && this.categoryId)\n\t\t{\n\t\t\tthis.categories.forEach((category) => {\n\t\t\t\tif(category.categoryId === this.categoryId)\n\t\t\t\t{\n\t\t\t\t\tcurrentCategory = category;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn currentCategory;\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tsize: 200,\n\t\t\t\toffset: {\n\t\t\t\t\tleft: '-100px',\n\t\t\t\t\ttop: '-200px',\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.loader.layout.style.zIndex = 300;\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif(!this.getLoader().isShown() && this.container)\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tgetStageById(id: number): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getId() === id)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetStageByStatusId(statusId: string): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getStatusId() === statusId)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.initStageFlow();\n\t\tthis.bindEvents();\n\t\tthis.initDocumentButton();\n\t\tif (this.id > 0)\n\t\t{\n\t\t\tthis.initPageTitleButtons();\n\t\t\tthis.initPull();\n\t\t}\n\t}\n\n\tinitDocumentButton(): void\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(this.documentButtonParameters)\n\t\t\t&& this.documentButtonParameters.buttonId\n\t\t\t&& BX.DocumentGenerator\n\t\t\t&& BX.DocumentGenerator.Button\n\t\t)\n\t\t{\n\t\t\tthis.documentButton = new BX.DocumentGenerator.Button(this.documentButtonParameters.buttonId, this.documentButtonParameters);\n\t\t\tthis.documentButton.init();\n\t\t}\n\t}\n\n\tinitPageTitleButtons(): void\n\t{\n\t\tconst pageTitleButtons = Tag.render`\n\t\t\t<span id=\"pagetitle_btn_wrapper\" class=\"pagetitile-button-container\">\n\t\t\t\t<span id=\"page_url_copy_btn\" class=\"crm-page-link-btn\"></span>\n\t\t\t</span>\n\t\t`;\n\n\t\tif (this.isPageTitleEditable)\n\t\t{\n\t\t\tconst editButton = Tag.render`\n\t\t\t\t<span id=\"pagetitle_edit\" class=\"pagetitle-edit-button\"></span>\n\t\t\t`;\n\t\t\tDom.prepend(editButton, pageTitleButtons);\n\t\t}\n\n\t\tconst pageTitle = document.getElementById('pagetitle');\n\t\tDom.insertAfter(pageTitleButtons, pageTitle);\n\n\t\tif(Type.isArray(this.categories) && this.categories.length > 0)\n\t\t{\n\t\t\tconst currentCategory = this.getCurrentCategory();\n\t\t\tif(currentCategory)\n\t\t\t{\n\t\t\t\tconst categoriesSelector = Tag.render`\n\t\t\t\t\t<div id=\"pagetitle_sub\" class=\"pagetitle-sub\">\n\t\t\t\t\t\t<a href=\"#\" onclick=\"${this.onCategorySelectorClick.bind(this)}\">${currentCategory.text}</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tDom.insertAfter(categoriesSelector, pageTitleButtons);\n\t\t\t}\n\t\t}\n\t}\n\n\tonCategorySelectorClick(event)\n\t{\n\t\tif(!this.categoryId || !this.categories)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst notCurrentCategories = this.categories.filter((category) => {\n\t\t\treturn category.categoryId !== this.categoryId;\n\t\t});\n\t\tnotCurrentCategories.forEach((category) => {\n\t\t\tdelete category.href;\n\t\t\tcategory.onclick = () => {\n\t\t\t\tthis.onCategorySelect(category.categoryId);\n\t\t\t}\n\t\t});\n\n\t\tPopupMenu.show({\n\t\t\tid: 'item-detail-' + this.entityTypeId + '-' + this.id,\n\t\t\tbindElement: event.target,\n\t\t\titems: notCurrentCategories\n\t\t});\n\t}\n\n\tonCategorySelect(categoryId)\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsChangeCategory',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tcategoryId\n\t\t\t\t}\n\t\t\t}\n\t\t}).then( () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\t//todo what if editor is changed ?\n\t\t\t\twindow.location.reload();\n\t\t\t}, 500);\n\t\t}).catch(this.showErrorsFromResponse.bind(this))\n\t}\n\n\tinitStageFlow()\n\t{\n\t\tif(this.stages)\n\t\t{\n\t\t\tconst flowStagesData = this.prepareStageFlowStagesData();\n\t\t\tconst stageFlowContainer = document.querySelector('[data-role=\"stageflow-wrap\"]');\n\t\t\tif(stageFlowContainer)\n\t\t\t{\n\t\t\t\tthis.stageflowChart = new StageFlow.Chart({\n\t\t\t\t\tbackgroundColor: BACKGROUND_COLOR,\n\t\t\t\t\tcurrentStage: this.currentStageId,\n\t\t\t\t\tisActive: this.isStageFlowActive === true,\n\t\t\t\t\tonStageChange: this.onStageChange.bind(this),\n\t\t\t\t\tlabels: {\n\t\t\t\t\t\tfinalStageName: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_NAME'),\n\t\t\t\t\t\tfinalStagePopupTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP'),\n\t\t\t\t\t\tfinalStagePopupFail: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\t\t\t\t\t\tfinalStageSelectorTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_SELECTOR'),\n\t\t\t\t\t},\n\t\t\t\t}, flowStagesData);\n\t\t\t\tstageFlowContainer.appendChild(this.stageflowChart.render());\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareStageFlowStagesData(): Array\n\t{\n\t\tconst flowStagesData = [];\n\t\tconst isNew = (this.id <= 0);\n\t\tthis.stages.forEach((stage: StageModel) => {\n\t\t\tconst data = stage.getData();\n\t\t\tlet color = (stage.getColor().indexOf('#') === 0) ? stage.getColor().substr(1) : stage.getColor();\n\t\t\tif(isNew)\n\t\t\t{\n\t\t\t\tcolor = BACKGROUND_COLOR;\n\t\t\t}\n\t\t\tdata.isSuccess = stage.isSuccess();\n\t\t\tdata.isFail = stage.isFailure();\n\t\t\tdata.color = color;\n\t\t\tflowStagesData.push(data);\n\t\t});\n\n\t\treturn flowStagesData;\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickDelete', this.handleItemDelete.bind(this));\n\t\tif (this.bizprocStarterConfig)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.Crm.ItemDetailsComponent:onClickBizprocTemplates',\n\t\t\t\tthis.handleBPTemplatesShow.bind(this),\n\t\t\t);\n\t\t}\n\t\tif (this.editorGuid && this.userFieldCreateUrl && BX.SidePanel && BX.Crm.EntityEditor)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.UI.EntityConfigurationManager:onCreateClick',\n\t\t\t\tthis.handleUserFieldCreationUrlClick.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tconst Pull = BX.PULL;\n\t\tif (!Pull)\n\t\t{\n\t\t\tconsole.error('pull is not initialized');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.pullTag)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: this.pullTag,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (params && params.item && params.item.data)\n\t\t\t\t{\n\t\t\t\t\tconst columnId = params.item.data.columnId;\n\t\t\t\t\tif (this.stageflowChart && this.stageflowChart.isActive)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\t\t\t\t\tif (currentStage && currentStage.statusId !== columnId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst newStage = this.getStageByStatusId(columnId);\n\t\t\t\t\t\t\tif (newStage)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.updateStage(newStage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tPull.extendWatch(this.pullTag);\n\t}\n\n\tgetEditor(): ?BX.Crm.EntityEditor\n\t{\n\t\tif (BX.Crm.EntityEditor)\n\t\t{\n\t\t\tif (this.editorGuid)\n\t\t\t{\n\t\t\t\treturn BX.Crm.EntityEditor.get(this.editorGuid);\n\t\t\t}\n\n\t\t\treturn BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tunBindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tonStageChange(stageFlowStage: StageFlow.Stage)\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst stage = this.getStageById(stageFlowStage.getId());\n\t\tif(!stage)\n\t\t{\n\t\t\tconsole.error('Wrong stage');\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsMoveItem',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstageId: stage.getStatusId()\n\t\t\t\t}\n\t\t\t}\n\t\t}).then( () => {\n\t\t\tthis.stopProgress();\n\n\t\t\tlet currentSlider: ?BX.SidePanel.Slider = null;\n\t\t\tif (Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t\t\t{\n\t\t\t\tcurrentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t}\n\t\t\tif (currentSlider !== null)\n\t\t\t{\n\t\t\t\tif (Reflection.getClass('BX.Crm.EntityEvent'))\n\t\t\t\t{\n\t\t\t\t\tlet eventParams = null;\n\t\t\t\t\tif(currentSlider)\n\t\t\t\t\t{\n\t\t\t\t\t\teventParams = { \"sliderUrl\": currentSlider.getUrl() };\n\t\t\t\t\t}\n\t\t\t\t\tBX.Crm.EntityEvent.fireUpdate(this.entityTypeId, this.id, '', eventParams);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.updateStage(stage);\n\t\t}).catch((response) => {\n\t\t\tthis.stopProgress();\n\n\t\t\tif (!this.partialEditorId)\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst requiredFields = [];\n\t\t\tresponse.errors.forEach(({code, customData}) => {\n\t\t\t\tif (code === 'CRM_FIELD_ERROR_REQUIRED' && customData.fieldName)\n\t\t\t\t{\n\t\t\t\t\trequiredFields.push(customData.fieldName);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(requiredFields.length > 0)\n\t\t\t{\n\t\t\t\tBX.Crm.PartialEditorDialog.close(this.partialEditorId);\n\n\t\t\t\tthis.partialEntityEditor = BX.Crm.PartialEditorDialog.create(\n\t\t\t\t\tthis.partialEditorId,\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: BX.prop.getString(this.messages, \"partialEditorTitle\", \"Please fill in all required fields\"),\n\t\t\t\t\t\tentityTypeName: this.entityTypeName,\n\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\tentityId: this.id,\n\t\t\t\t\t\tfieldNames: requiredFields,\n\t\t\t\t\t\thelpData: null,\n\t\t\t\t\t\tcontext: this.editorContext || null,\n\t\t\t\t\t\tisController: true,\n\t\t\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.bindPartialEntityEditorEvents();\n\t\t\t\tthis.partialEntityEditor.open();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t}\n\t\t})\n\t}\n\n\tupdateStage(stage: StageModel)\n\t{\n\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\tthis.stageflowChart.setCurrentStageId(stage.getId());\n\t\tEventEmitter.emit(\n\t\t\t'BX.Crm.ItemDetailsComponent:onStageChange',\n\t\t\t{\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\tpreviousStageId: currentStage ? currentStage.getStatusId() : null,\n\t\t\t}\n\t\t);\n\t}\n\n\tshowError(error: string): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = error;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tshowErrors(errors: string[]): void\n\t{\n\t\tlet severalErrorsText = '';\n\t\terrors.forEach((message) => {\n\t\t\tseveralErrorsText = severalErrorsText + message + ' ';\n\t\t});\n\n\t\tthis.showError(severalErrorsText);\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tthis.stopProgress();\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\tnormalizeUrl(url: Uri): Uri\n\t{\n\t\t// Allow redirects only in the current domain\n\t\treturn url.setHost('');\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(): void\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tMessageBox.show({\n\t\t\ttitle: this.messages.deleteItemTitle,\n\t\t\tmessage: this.messages.deleteItemMessage,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tthis.startProgress();\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemDetailsDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}).then( ({data}) => {\n\t\t\t\t\tthis.stopProgress();\n\n\t\t\t\t\tlet currentSlider: ?BX.SidePanel.Slider = null;\n\t\t\t\t\tif (Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentSlider !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Reflection.getClass('BX.Crm.EntityEvent'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet eventParams = null;\n\t\t\t\t\t\t\tif(currentSlider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\teventParams = { \"sliderUrl\": currentSlider.getUrl() };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tBX.Crm.EntityEvent.fireDelete(this.entityTypeId, this.id, '', eventParams);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentSlider.close();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst link = data.redirectUrl;\n\t\t\t\t\t\tif (Type.isStringFilled(link))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst url = this.normalizeUrl(new Uri(link));\n\t\t\t\t\t\t\tlocation.href = url.toString();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleBPTemplatesShow(event)\n\t{\n\t\tconst starter = new BX.Bizproc.Starter(this.bizprocStarterConfig);\n\t\tstarter.showTemplatesMenu(event.data.button.button);\n\t}\n\n\thandleClosePartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data.length === 2)\n\t\t{\n\t\t\tconst parameters = data[1];\n\n\t\t\tif(parameters.isCancelled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst stage = this.getStageByStatusId(parameters.stageId);\n\t\t\tif(!stage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateStage(stage);\n\t\t}\n\t}\n\n\thandleErrorPartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data[1] && Type.isArray(data[1].errors))\n\t\t{\n\t\t\tthis.showErrorsFromResponse({errors: data[1].errors});\n\t\t}\n\t}\n\n\thandleUserFieldCreationUrlClick(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif (data.hasOwnProperty('isCanceled'))\n\t\t{\n\t\t\tevent.setData({ ...data, ...{isCanceled: true}});\n\t\t\tBX.SidePanel.Instance.open(this.userFieldCreateUrl, {\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.onCreateUserFieldSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonCreateUserFieldSliderClose(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tconst sliderData = slider.getData();\n\t\tconst userFieldData = sliderData.get('userFieldData');\n\t\tif (userFieldData && Type.isString(userFieldData))\n\t\t{\n\t\t\tthis.reloadPageIfNotChanged();\n\t\t}\n\t}\n\t//endregion\n\n\treloadPageIfNotChanged()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif (editor)\n\t\t{\n\t\t\tif(editor.isChanged())\n\t\t\t{\n\t\t\t\tMessageBox.alert(this.messages.onCreateUserFieldAddMessage);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["BACKGROUND_COLOR","ItemDetailsComponent","params","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","id","BX","Crm","PartialEditorDialog","serviceUrl","partialEditorId","registerEntityEditorUrl","hasOwnProperty","editorContext","categoryId","categories","isElementNode","errorTextContainer","isArray","stages","forEach","data","push","StageModel","currentStageId","messages","signedParameters","documentButtonParameters","userFieldCreateUrl","editorGuid","isStageFlowActive","pullTag","bizprocStarterConfig","isPageTitleEditable","Boolean","container","document","querySelector","handleClosePartialEntityEditor","bind","handleErrorPartialEntityEditor","currentCategory","category","loader","Loader","size","offset","left","top","layout","style","zIndex","isProgress","getLoader","isShown","show","hideErrors","hide","result","key","stage","getId","statusId","getStatusId","initStageFlow","bindEvents","initDocumentButton","initPageTitleButtons","initPull","buttonId","DocumentGenerator","Button","documentButton","init","pageTitleButtons","Tag","render","editButton","Dom","prepend","pageTitle","getElementById","insertAfter","length","getCurrentCategory","categoriesSelector","onCategorySelectorClick","text","event","notCurrentCategories","filter","href","onclick","onCategorySelect","PopupMenu","bindElement","target","items","startProgress","Ajax","runAction","analyticsLabel","fields","then","setTimeout","window","location","reload","catch","showErrorsFromResponse","flowStagesData","prepareStageFlowStagesData","stageFlowContainer","stageflowChart","StageFlow","Chart","backgroundColor","currentStage","isActive","onStageChange","labels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","appendChild","isNew","getData","color","getColor","indexOf","substr","isSuccess","isFail","isFailure","EventEmitter","subscribe","handleItemDelete","handleBPTemplatesShow","SidePanel","EntityEditor","handleUserFieldCreationUrlClick","Pull","PULL","console","error","moduleId","command","callback","item","columnId","getStageById","newStage","getStageByStatusId","updateStage","extendWatch","get","getDefault","unsubscribe","stageFlowStage","stageId","stopProgress","currentSlider","Reflection","getClass","Instance","getTopSlider","eventParams","getUrl","EntityEvent","fireUpdate","response","requiredFields","errors","code","customData","fieldName","close","partialEntityEditor","create","title","prop","getString","entityId","fieldNames","helpData","context","isController","bindPartialEntityEditorEvents","open","setCurrentStageId","emit","previousStageId","innerText","parentElement","display","severalErrorsText","message","showError","showErrors","url","setHost","MessageBox","deleteItemTitle","deleteItemMessage","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","fireDelete","link","redirectUrl","isStringFilled","normalizeUrl","Uri","toString","starter","Bizproc","Starter","showTemplatesMenu","button","unBindPartialEntityEditorEvents","parameters","isCancelled","setData","isCanceled","allowChangeHistory","cacheable","events","onClose","onCreateUserFieldSliderClose","slider","getSlider","sliderData","userFieldData","isString","reloadPageIfNotChanged","editor","getEditor","isChanged","alert","onCreateUserFieldAddMessage"],"mappings":"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"}