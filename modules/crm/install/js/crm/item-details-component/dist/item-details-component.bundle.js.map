{"version":3,"file":"item-details-component.bundle.js","sources":["../src/item-details-component.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Reflection, Tag, Text, Type, Uri } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\nimport { StageFlow } from 'ui.stageflow';\nimport type { StageModelData } from 'crm.stage-model';\nimport { StageModel } from 'crm.stage-model';\nimport { Loader } from \"main.loader\";\nimport { PopupMenu } from \"main.popup\";\n\nexport type ItemDetailsComponentParams = {\n\tentityTypeId: number,\n\tentityTypeName: string,\n\tserviceUrl: string,\n\tid: number,\n\tcategoryId?: number,\n\tcategories?: Category[],\n\terrorTextContainer: HTMLElement,\n\tstages: StageModelData[],\n\tcurrentStageId: number,\n\tmessages: Object,\n\tsignedParameters: ?string,\n\tdocumentButtonParameters: ?Object,\n\tisPageTitleEditable: boolean,\n\tuserFieldCreateUrl: ?string,\n\teditorGuid: ?string,\n\tisStageFlowActive: ?boolean,\n\tpullTag: ?string,\n};\n\ndeclare type Category = {\n\tid: string,\n\tcategoryId: number,\n\ttext: string,\n\thref: string,\n};\n\nconst BACKGROUND_COLOR = 'd3d7dc';\n\nexport class ItemDetailsComponent\n{\n\tentityTypeId: number;\n\tentityTypeName: string;\n\tid: number;\n\tcategoryId: ?number = null;\n\tcategories: ?Category[];\n\terrorTextContainer: HTMLElement;\n\tstages: StageModel[];\n\tstageflowChart: StageFlow.Chart;\n\tcurrentStageId: number;\n\tisProgress: boolean;\n\tcontainer: HTMLElement;\n\tmessages: {[code: string]: string};\n\tsignedParameters: ?string;\n\tdocumentButtonParameters: ?Object;\n\tisPageTitleEditable: boolean;\n\tpartialEntityEditor: ?BX.Crm.PartialEditorDialog;\n\tpartialEditorId: ?string;\n\teditorContext: Object;\n\tuserFieldCreateUrl: ?string;\n\teditorGuid: ?string;\n\tisStageFlowActive: ?boolean;\n\tpullTag: ?string;\n\n\tconstructor(params: ItemDetailsComponentParams): void\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.id = Text.toInteger(params.id);\n\t\t\tif (BX.Crm.PartialEditorDialog && params.serviceUrl)\n\t\t\t{\n\t\t\t\tthis.partialEditorId = 'partial_editor_' + this.entityTypeId + '_' + this.id;\n\t\t\t\tBX.Crm.PartialEditorDialog.registerEntityEditorUrl(this.entityTypeId, params.serviceUrl);\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('editorContext'))\n\t\t\t{\n\t\t\t\tthis.editorContext = params.editorContext;\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('categoryId'))\n\t\t\t{\n\t\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\t\t\t\tthis.categories = params.categories;\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif(Type.isArray(params.stages))\n\t\t\t{\n\t\t\t\tthis.stages = [];\n\t\t\t\tparams.stages.forEach((data) => {\n\t\t\t\t\tthis.stages.push(new StageModel(data));\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.currentStageId = params.currentStageId;\n\t\t\tthis.messages = params.messages;\n\t\t\tthis.signedParameters = params.signedParameters;\n\t\t\tthis.documentButtonParameters = params.documentButtonParameters;\n\t\t\tthis.userFieldCreateUrl = params.userFieldCreateUrl;\n\t\t\tthis.editorGuid = params.editorGuid;\n\t\t\tthis.isStageFlowActive = params.isStageFlowActive;\n\t\t\tthis.pullTag = params.pullTag;\n\n\t\t\tthis.isPageTitleEditable = Boolean(params.isPageTitleEditable);\n\t\t}\n\n\t\tthis.container = document.querySelector('[data-role=\"crm-item-detail-container\"]');\n\t\tthis.handleClosePartialEntityEditor = this.handleClosePartialEntityEditor.bind(this);\n\t\tthis.handleErrorPartialEntityEditor = this.handleErrorPartialEntityEditor.bind(this);\n\t}\n\n\tgetCurrentCategory(): ?Category\n\t{\n\t\tlet currentCategory = null\n\t\tif(this.categories && this.categoryId)\n\t\t{\n\t\t\tthis.categories.forEach((category) => {\n\t\t\t\tif(category.categoryId === this.categoryId)\n\t\t\t\t{\n\t\t\t\t\tcurrentCategory = category;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn currentCategory;\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tsize: 200,\n\t\t\t\toffset: {\n\t\t\t\t\tleft: '-100px',\n\t\t\t\t\ttop: '-200px',\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.loader.layout.style.zIndex = 300;\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif(!this.getLoader().isShown() && this.container)\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tgetStageById(id: number): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getId() === id)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetStageByStatusId(statusId: string): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getStatusId() === statusId)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.initStageFlow();\n\t\tthis.bindEvents();\n\t\tthis.initDocumentButton();\n\t\tif (this.id > 0)\n\t\t{\n\t\t\tthis.initPageTitleButtons();\n\t\t\tthis.initPull();\n\t\t}\n\t}\n\n\tinitDocumentButton(): void\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(this.documentButtonParameters)\n\t\t\t&& this.documentButtonParameters.buttonId\n\t\t\t&& BX.DocumentGenerator\n\t\t\t&& BX.DocumentGenerator.Button\n\t\t)\n\t\t{\n\t\t\tthis.documentButton = new BX.DocumentGenerator.Button(this.documentButtonParameters.buttonId, this.documentButtonParameters);\n\t\t\tthis.documentButton.init();\n\t\t}\n\t}\n\n\tinitPageTitleButtons(): void\n\t{\n\t\tconst pageTitleButtons = Tag.render`\n\t\t\t<span id=\"pagetitle_btn_wrapper\" class=\"pagetitile-button-container\">\n\t\t\t\t<span id=\"page_url_copy_btn\" class=\"crm-page-link-btn\"></span>\n\t\t\t</span>\n\t\t`;\n\n\t\tif (this.isPageTitleEditable)\n\t\t{\n\t\t\tconst editButton = Tag.render`\n\t\t\t\t<span id=\"pagetitle_edit\" class=\"pagetitle-edit-button\"></span>\n\t\t\t`;\n\t\t\tDom.prepend(editButton, pageTitleButtons);\n\t\t}\n\n\t\tconst pageTitle = document.getElementById('pagetitle');\n\t\tDom.insertAfter(pageTitleButtons, pageTitle);\n\n\t\tif(Type.isArray(this.categories) && this.categories.length > 0)\n\t\t{\n\t\t\tconst currentCategory = this.getCurrentCategory();\n\t\t\tif(currentCategory)\n\t\t\t{\n\t\t\t\tconst categoriesSelector = Tag.render`\n\t\t\t\t\t<div id=\"pagetitle_sub\" class=\"pagetitle-sub\">\n\t\t\t\t\t\t<a href=\"#\" onclick=\"${this.onCategorySelectorClick.bind(this)}\">${currentCategory.text}</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tDom.insertAfter(categoriesSelector, pageTitleButtons);\n\t\t\t}\n\t\t}\n\t}\n\n\tonCategorySelectorClick(event)\n\t{\n\t\tif(!this.categoryId || !this.categories)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst notCurrentCategories = this.categories.filter((category) => {\n\t\t\treturn category.categoryId !== this.categoryId;\n\t\t});\n\t\tnotCurrentCategories.forEach((category) => {\n\t\t\tdelete category.href;\n\t\t\tcategory.onclick = () => {\n\t\t\t\tthis.onCategorySelect(category.categoryId);\n\t\t\t}\n\t\t});\n\n\t\tPopupMenu.show({\n\t\t\tid: 'item-detail-' + this.entityTypeId + '-' + this.id,\n\t\t\tbindElement: event.target,\n\t\t\titems: notCurrentCategories\n\t\t});\n\t}\n\n\tonCategorySelect(categoryId)\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsChangeCategory',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tcategoryId\n\t\t\t\t}\n\t\t\t}\n\t\t}).then( () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\t//todo what if editor is changed ?\n\t\t\t\twindow.location.reload();\n\t\t\t}, 500);\n\t\t}).catch(this.showErrorsFromResponse.bind(this))\n\t}\n\n\tinitStageFlow()\n\t{\n\t\tif(this.stages)\n\t\t{\n\t\t\tconst flowStagesData = this.prepareStageFlowStagesData();\n\t\t\tconst stageFlowContainer = document.querySelector('[data-role=\"stageflow-wrap\"]');\n\t\t\tif(stageFlowContainer)\n\t\t\t{\n\t\t\t\tthis.stageflowChart = new StageFlow.Chart({\n\t\t\t\t\tbackgroundColor: BACKGROUND_COLOR,\n\t\t\t\t\tcurrentStage: this.currentStageId,\n\t\t\t\t\tisActive: this.isStageFlowActive === true,\n\t\t\t\t\tonStageChange: this.onStageChange.bind(this),\n\t\t\t\t\tlabels: {\n\t\t\t\t\t\tfinalStageName: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_NAME'),\n\t\t\t\t\t\tfinalStagePopupTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP'),\n\t\t\t\t\t\tfinalStagePopupFail: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\t\t\t\t\t\tfinalStageSelectorTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_SELECTOR'),\n\t\t\t\t\t},\n\t\t\t\t}, flowStagesData);\n\t\t\t\tstageFlowContainer.appendChild(this.stageflowChart.render());\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareStageFlowStagesData(): Array\n\t{\n\t\tconst flowStagesData = [];\n\t\tconst isNew = (this.id <= 0);\n\t\tthis.stages.forEach((stage: StageModel) => {\n\t\t\tconst data = stage.getData();\n\t\t\tlet color = (stage.getColor().indexOf('#') === 0) ? stage.getColor().substr(1) : stage.getColor();\n\t\t\tif(isNew)\n\t\t\t{\n\t\t\t\tcolor = BACKGROUND_COLOR;\n\t\t\t}\n\t\t\tdata.isSuccess = stage.isSuccess();\n\t\t\tdata.isFail = stage.isFailure();\n\t\t\tdata.color = color;\n\t\t\tflowStagesData.push(data);\n\t\t});\n\n\t\treturn flowStagesData;\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickDelete', this.handleItemDelete.bind(this));\n\t\tif (this.editorGuid && this.userFieldCreateUrl && BX.SidePanel && BX.Crm.EntityEditor)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.UI.EntityConfigurationManager:onCreateClick',\n\t\t\t\tthis.handleUserFieldCreationUrlClick.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tconst Pull = BX.PULL;\n\t\tif (!Pull)\n\t\t{\n\t\t\tconsole.error('pull is not initialized');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.pullTag)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: this.pullTag,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (params && params.item && params.item.data)\n\t\t\t\t{\n\t\t\t\t\tconst columnId = params.item.data.columnId;\n\t\t\t\t\tif (this.stageflowChart && this.stageflowChart.isActive)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\t\t\t\t\tif (currentStage && currentStage.statusId !== columnId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst newStage = this.getStageByStatusId(columnId);\n\t\t\t\t\t\t\tif (newStage)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.updateStage(newStage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tPull.extendWatch(this.pullTag);\n\t}\n\n\tbindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tunBindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tonStageChange(stageFlowStage: StageFlow.Stage)\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst stage = this.getStageById(stageFlowStage.getId());\n\t\tif(!stage)\n\t\t{\n\t\t\tconsole.error('Wrong stage');\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsMoveItem',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstageId: stage.getStatusId()\n\t\t\t\t}\n\t\t\t}\n\t\t}).then( () => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.updateStage(stage);\n\t\t}).catch((response) => {\n\t\t\tthis.stopProgress();\n\n\t\t\tif (!this.partialEditorId)\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst requiredFields = [];\n\t\t\tresponse.errors.forEach(({code, customData}) => {\n\t\t\t\tif (code === 'CRM_FIELD_ERROR_REQUIRED' && customData.fieldName)\n\t\t\t\t{\n\t\t\t\t\trequiredFields.push(customData.fieldName);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(requiredFields.length > 0)\n\t\t\t{\n\t\t\t\tBX.Crm.PartialEditorDialog.close(this.partialEditorId);\n\n\t\t\t\tthis.partialEntityEditor = BX.Crm.PartialEditorDialog.create(\n\t\t\t\t\tthis.partialEditorId,\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: BX.prop.getString(this.messages, \"partialEditorTitle\", \"Please fill in all required fields\"),\n\t\t\t\t\t\tentityTypeName: this.entityTypeName,\n\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\tentityId: this.id,\n\t\t\t\t\t\tfieldNames: requiredFields,\n\t\t\t\t\t\thelpData: null,\n\t\t\t\t\t\tcontext: this.editorContext || null,\n\t\t\t\t\t\tisController: true,\n\t\t\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.bindPartialEntityEditorEvents();\n\t\t\t\tthis.partialEntityEditor.open();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t}\n\t\t})\n\t}\n\n\tupdateStage(stage: StageModel)\n\t{\n\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\tthis.stageflowChart.setCurrentStageId(stage.getId());\n\t\tEventEmitter.emit(\n\t\t\t'BX.Crm.ItemDetailsComponent:onStageChange',\n\t\t\t{\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\tpreviousStageId: currentStage ? currentStage.getStatusId() : null,\n\t\t\t}\n\t\t);\n\t}\n\n\tshowError(error: string): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = error;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tshowErrors(errors: string[]): void\n\t{\n\t\tlet severalErrorsText = '';\n\t\terrors.forEach((message) => {\n\t\t\tseveralErrorsText = severalErrorsText + message + ' ';\n\t\t});\n\n\t\tthis.showError(severalErrorsText);\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tthis.stopProgress();\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\tnormalizeUrl(url: Uri): Uri\n\t{\n\t\t// Allow redirects only in the current domain\n\t\treturn url.setHost('');\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(): void\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tMessageBox.show({\n\t\t\ttitle: this.messages.deleteItemTitle,\n\t\t\tmessage: this.messages.deleteItemMessage,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tthis.startProgress();\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemDetailsDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}).then( ({data}) => {\n\t\t\t\t\tthis.stopProgress();\n\n\t\t\t\t\tlet currentSlider: ?BX.SidePanel.Slider = null;\n\t\t\t\t\tif (Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentSlider !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentSlider.close();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst link = data.redirectUrl;\n\t\t\t\t\t\tif (Type.isStringFilled(link))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst url = this.normalizeUrl(new Uri(link));\n\t\t\t\t\t\t\tlocation.href = url.toString();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleClosePartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data.length === 2)\n\t\t{\n\t\t\tconst parameters = data[1];\n\n\t\t\tif(parameters.isCancelled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst stage = this.getStageByStatusId(parameters.stageId);\n\t\t\tif(!stage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateStage(stage);\n\t\t}\n\t}\n\n\thandleErrorPartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data[1] && Type.isArray(data[1].errors))\n\t\t{\n\t\t\tthis.showErrorsFromResponse({errors: data[1].errors});\n\t\t}\n\t}\n\n\thandleUserFieldCreationUrlClick(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif (data.hasOwnProperty('isCanceled'))\n\t\t{\n\t\t\tevent.setData({ ...data, ...{isCanceled: true}});\n\t\t\tBX.SidePanel.Instance.open(this.userFieldCreateUrl, {\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.onCreateUserFieldSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonCreateUserFieldSliderClose(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tconst sliderData = slider.getData();\n\t\tconst userFieldData = sliderData.get('userFieldData');\n\t\tif (userFieldData && Type.isString(userFieldData))\n\t\t{\n\t\t\tthis.reloadPageIfNotChanged();\n\t\t}\n\t}\n\t//endregion\n\n\treloadPageIfNotChanged()\n\t{\n\t\tconst editor = BX.Crm.EntityEditor.getDefault();\n\t\tif (editor)\n\t\t{\n\t\t\tif(editor.isChanged())\n\t\t\t{\n\t\t\t\tMessageBox.alert(this.messages.onCreateUserFieldAddMessage);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["BACKGROUND_COLOR","ItemDetailsComponent","params","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","id","BX","Crm","PartialEditorDialog","serviceUrl","partialEditorId","registerEntityEditorUrl","hasOwnProperty","editorContext","categoryId","categories","isElementNode","errorTextContainer","isArray","stages","forEach","data","push","StageModel","currentStageId","messages","signedParameters","documentButtonParameters","userFieldCreateUrl","editorGuid","isStageFlowActive","pullTag","isPageTitleEditable","Boolean","container","document","querySelector","handleClosePartialEntityEditor","bind","handleErrorPartialEntityEditor","currentCategory","category","loader","Loader","size","offset","left","top","layout","style","zIndex","isProgress","getLoader","isShown","show","hideErrors","hide","result","key","stage","getId","statusId","getStatusId","initStageFlow","bindEvents","initDocumentButton","initPageTitleButtons","initPull","buttonId","DocumentGenerator","Button","documentButton","init","pageTitleButtons","Tag","render","editButton","Dom","prepend","pageTitle","getElementById","insertAfter","length","getCurrentCategory","categoriesSelector","onCategorySelectorClick","text","event","notCurrentCategories","filter","href","onclick","onCategorySelect","PopupMenu","bindElement","target","items","startProgress","Ajax","runAction","analyticsLabel","fields","then","setTimeout","window","location","reload","catch","showErrorsFromResponse","flowStagesData","prepareStageFlowStagesData","stageFlowContainer","stageflowChart","StageFlow","Chart","backgroundColor","currentStage","isActive","onStageChange","labels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","appendChild","isNew","getData","color","getColor","indexOf","substr","isSuccess","isFail","isFailure","EventEmitter","subscribe","handleItemDelete","SidePanel","EntityEditor","handleUserFieldCreationUrlClick","Pull","PULL","console","error","moduleId","command","callback","item","columnId","getStageById","newStage","getStageByStatusId","updateStage","extendWatch","unsubscribe","stageFlowStage","stageId","stopProgress","response","requiredFields","errors","code","customData","fieldName","close","partialEntityEditor","create","title","prop","getString","entityId","fieldNames","helpData","context","isController","bindPartialEntityEditorEvents","open","setCurrentStageId","emit","previousStageId","innerText","parentElement","display","severalErrorsText","message","showError","showErrors","url","setHost","MessageBox","deleteItemTitle","deleteItemMessage","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","currentSlider","Reflection","getClass","Instance","getTopSlider","link","redirectUrl","isStringFilled","normalizeUrl","Uri","toString","unBindPartialEntityEditorEvents","parameters","isCancelled","setData","isCanceled","allowChangeHistory","cacheable","events","onClose","onCreateUserFieldSliderClose","slider","getSlider","sliderData","userFieldData","get","isString","reloadPageIfNotChanged","editor","getDefault","isChanged","alert","onCreateUserFieldAddMessage"],"mappings":"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"}