{"version":3,"file":"report.bundle.js","sources":["../src/report.js"],"sourcesContent":["import './report.css';\n\nimport 'sidepanel';\nimport 'ui.progressbar';\nimport 'ui.fonts.opensans';\nimport { Tag, Runtime, Event, Loc, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events'\nimport { Menu, Popup, PopupOptions } from 'main.popup';\n\ntype Options = {\n\tsourceId: string;\n\tfrom: string;\n\tto: string;\n\tparentId: number;\n\tlevel: number;\n\tgridId: string;\n};\n\nclass Report\n{\n\tui: Object = {\n\t\tcontainer: null,\n\t\tloader: null,\n\t\tloaderText: null,\n\t\tloaderProgressBar: null,\n\t\tloaderActive: false,\n\t\terror: null,\n\t\terrorText: null,\n\t\terrorClose: null,\n\t\tgrid: null,\n\t};\n\n\tloaded: boolean = false;\n\tstatusButtonClassName: string = 'crm-tracking-report-source-status-disabled';\n\n\tconstructor(options)\n\t{\n\t\tthis.load(options);\n\t}\n\n\tstatic open(options: Options): Promise\n\t{\n\t\tif (window === top)\n\t\t{\n\t\t\treturn Promise.resolve(new Report(options));\n\t\t}\n\n\t\treturn top.BX.Runtime.loadExtension('crm.report.tracking.ad.report').then(() => {\n\t\t\treturn new top.BX.Crm.Report.Tracking.Ad.Report(options);\n\t\t});\n\t}\n\n\tload({sourceId, from, to, parentId = 0, level = 0, gridId}: Options)\n\t{\n\t\tthis.gridId = gridId = gridId || `crm-report-tracking-ad-l${level}`;\n\t\tthis.filter = {sourceId, from, to, parentId, level, gridId};\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'crm:api.tracking.ad.report' + `-${sourceId}-${level}`,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tconst container = this.createUiContainer(level);\n\t\t\t\t\tthis.build();\n\t\t\t\t\treturn container;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tbuild ()\n\t{\n\t\tthis.showLoader();\n\t\tif (this.filter.level)\n\t\t{\n\t\t\tthis.loadGrid();\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.build',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\t...this.filter,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(({data}) => {\n\t\t\t\tif (data.label)\n\t\t\t\t{\n\t\t\t\t\tthis.setLoaderText(data.label);\n\t\t\t\t}\n\n\t\t\t\tif (data.complete)\n\t\t\t\t{\n\t\t\t\t\tthis.loadGrid();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.build();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(({errors}) => {\n\t\t\t\tthis.showError(errors[0]);\n\t\t\t})\n\t\t;\n\t}\n\n\tchangeStatus (id, status)\n\t{\n\t\tthis.showLoader();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.changeStatus',\n\t\t\t{\n\t\t\t\tjson: { id, status }\n\t\t\t}\n\t\t)\n\t\t\t.then(() => {\n\t\t\t\tthis.loadGrid();\n\t\t\t})\n\t\t\t.catch(({errors}) => {\n\t\t\t\tthis.showError(errors[0]);\n\t\t\t})\n\t\t;\n\t}\n\n\tloadGrid ()\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.getGrid',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\t...this.filter,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(({data}) => {\n\t\t\t\t//container.innerHTML = data.html;\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\twindow,\n\t\t\t\t\t'Grid::beforeRequest',\n\t\t\t\t\tthis.onBeforeGridRequest.bind(this)\n\t\t\t\t);\n\n\t\t\t\tRuntime.html(this.getNode('grid'), data.html)\n\t\t\t\tthis.initActivators();\n\t\t\t\tthis.hideLoader();\n\t\t\t\tthis.loaded = true;\n\n\t\t\t\tif (!this.filter.level)\n\t\t\t\t{\n\t\t\t\t\tconst popupOptions: PopupOptions = {\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_SETTINGS_HINT'),\n\t\t\t\t\t\tzIndex: 5000,\n\t\t\t\t\t\tmaxWidth: 300,\n\t\t\t\t\t\toffsetLeft: -315,\n\t\t\t\t\t\toffsetTop: -30,\n\t\t\t\t\t\tanimation: 'fading',\n\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\tbindElement: this.ui.hint,\n\t\t\t\t\t};\n\t\t\t\t\tconst popup = new Popup(popupOptions);\n\t\t\t\t\tpopup.show();\n\t\t\t\t\tsetTimeout(() => popup.destroy(), 10000);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tinitActivators ()\n\t{\n\t\tthis.getNodes('grid/activator').forEach((node) => {\n\t\t\tconst options = JSON.parse(node.dataset.options);\n\t\t\tconst statusBtn = node.previousElementSibling;\n\t\t\tif (statusBtn)\n\t\t\t{\n\t\t\t\toptions.enabled\n\t\t\t\t\t? statusBtn.classList.remove(this.statusButtonClassName)\n\t\t\t\t\t: statusBtn.classList.add(this.statusButtonClassName)\n\t\t\t\t;\n\t\t\t\tEvent.bind(statusBtn, 'click', () => {\n\t\t\t\t\tconst popup = new Menu({\n\t\t\t\t\t\tbindElement: statusBtn,\n\t\t\t\t\t\tzIndex: 3010,\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Text.encode(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_STATUS_ENABLED')),\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.changeStatus(options.parentId, true);\n\t\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Text.encode(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_STATUS_PAUSE')),\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.changeStatus(options.parentId, false);\n\t\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tpopup.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.level === null || options.level === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.bind(node, 'click', () => {\n\t\t\t\tnew Report({\n\t\t\t\t\t...this.filter,\n\t\t\t\t\tlevel: options.level,\n\t\t\t\t\tparentId: options.parentId,\n\t\t\t\t\tgridId: this.filter.gridId + '-lvl' + options.level,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tconst selectorTitle = this.getNode('grid/selector/title');\n\t\tconst selector = this.getNode('grid/selector');\n\t\tif (selector)\n\t\t{\n\t\t\tconst container = this.getNode('selector');\n\t\t\tif (container.children.length > 0)\n\t\t\t{\n\t\t\t\tselector.parentElement.removeChild(selector);\n\t\t\t\tselectorTitle.parentElement.removeChild(selectorTitle);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselector.dataset.role = '';\n\t\t\tselectorTitle.dataset.role = '';\n\t\t\tcontainer.appendChild(selectorTitle);\n\t\t\tcontainer.appendChild(selector);\n\n\t\t\tEvent.bind(selector, 'click', () => {\n\t\t\t\tconst options = JSON.parse(selector.dataset.options);\n\t\t\t\tconst popup = new Menu({\n\t\t\t\t\tbindElement: selector,\n\t\t\t\t\tzIndex: 3010,\n\t\t\t\t\titems: options.items.map(item => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttext: Text.encode(item.title),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\tselector.textContent = item.title;\n\t\t\t\t\t\t\t\tthis.filter.parentId = item.parentId;\n\t\t\t\t\t\t\t\tthis.filter.level = item.level;\n\t\t\t\t\t\t\t\tthis.filter.sourceId = item.sourceId;\n\t\t\t\t\t\t\t\tthis.build();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\t\t\t});\n\t\t}\n\t}\n\n\tcreateUiContainer (level)\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-report-tracking-panel\">\n\t\t\t\t<div class=\"crm-report-tracking-panel-title\">\n\t\t\t\t\t<div class=\"crm-report-tracking-panel-title-name\">\n\t\t\t\t\t\t<div class=\"crm-report-tracking-panel-title-line\">\n\t\t\t\t\t\t\t<div data-role=\"title\"></div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t${level ? '' : '<div data-role=\"hint\" class=\"ui-hint-icon crm-report-tracking-panel-hint\"></div>'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-role=\"selector\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-report-tracking-panel-body\">\n\t\t\t\t\t<div data-role=\"loader\" class=\"crm-report-tracking-panel-loader\">\n\t\t\t\t\t\t<div data-role=\"loader/text\" class=\"crm-report-tracking-panel-loader-text\"></div>\n\t\t\t\t\t\t<div data-role=\"loader/bar\" class=\"crm-report-tracking-panel-loader-bar\">\n\t\t\t\t\t\t\t<div data-role=\"error\" class=\"ui-alert ui-alert-danger\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t<span class=\"ui-alert-message\">\n\t\t\t\t\t\t\t\t\t<strong>${Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_ERROR_TITLE')}:</strong>\n\t\t\t\t\t\t\t\t\t<span data-role=\"error/text\"></span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"text-align: center;\">\n\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\tdata-role=\"error/close\" \n\t\t\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-light-border\"\n\t\t\t\t\t\t\t\t\tstyle=\"display: none;\"\n\t\t\t\t\t\t\t\t>${Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_CLOSE')}</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-role=\"grid\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.ui.container = container;\n\t\tthis.ui.title = this.getNode('title');\n\t\tthis.ui.hint = this.getNode('hint');\n\t\tthis.ui.loader = this.getNode('loader');\n\t\tthis.ui.loaderText = this.getNode('loader/text');\n\t\tthis.ui.error = this.getNode('error');\n\t\tthis.ui.errorText = this.getNode('error/text');\n\t\tthis.ui.errorClose = this.getNode('error/close');\n\t\tthis.ui.grid = this.getNode('grid');\n\n\t\tconst progressBar = new BX.UI.ProgressBar({\n\t\t\tvalue: 0,\n\t\t\tmaxValue: 100,\n\t\t\tstatusType: 'none',\n\t\t\tcolumn: true,\n\t\t});\n\n\t\tif (this.ui.hint)\n\t\t{\n\t\t\tthis.ui.hint.addEventListener('click', () => BX.Helper.show(\"redirect=detail&code=12526974\"));\n\t\t}\n\t\tif (this.ui.errorClose)\n\t\t{\n\t\t\tthis.ui.errorClose.addEventListener('click', () => {\n\t\t\t\tif (this.loaded)\n\t\t\t\t{\n\t\t\t\t\tthis.hideError();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.getNode('loader/bar').insertBefore(progressBar.getContainer(), this.getNode('loader/bar').children[0]);\n\t\tthis.ui.loaderProgressBar = progressBar;\n\t\tthis.setLoaderText(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_BUILD'));\n\n\t\tthis.setTitle(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_TITLE_' + this.filter.level));\n\n\t\treturn container;\n\t}\n\n\tsetLoaderText (text)\n\t{\n\t\tthis.ui.loaderProgressBar.setValue(0);\n\t\tthis.ui.loaderProgressBar.setTextBefore(text);\n\t}\n\n\tanimateLoader ()\n\t{\n\t\tif (!this.ui.loaderActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst progressBar = this.ui.loaderProgressBar;\n\t\tconst val = parseInt(progressBar.getValue()) + 1;\n\t\tif (val <= 95)\n\t\t{\n\t\t\tprogressBar.update(val);\n\t\t}\n\n\t\tsetTimeout(() => this.animateLoader(), 100);\n\t}\n\n\tshowError (error: Error)\n\t{\n\t\tthis.ui.errorClose.style.display = '';\n\t\tthis.ui.error.style.display = '';\n\t\tthis.ui.errorText.textContent = error.message;\n\t\tthis.ui.loaderProgressBar.getContainer().style.display = 'none';\n\t}\n\n\thideError ()\n\t{\n\t\tthis.ui.errorClose.style.display = 'none';\n\t\tthis.ui.error.style.display = 'none';\n\t\tthis.ui.errorText.textContent = '';\n\t\tthis.ui.loaderProgressBar.getContainer().style.display = '';\n\n\t\tthis.hideLoader();\n\t}\n\n\tshowLoader ()\n\t{\n\t\tif (!this.ui.loaderActive)\n\t\t{\n\t\t\tsetTimeout(() => this.animateLoader(), 100);\n\t\t}\n\n\t\tthis.ui.loaderActive = true;\n\t\tthis.ui.loader.style.display = '';\n\t}\n\n\thideLoader ()\n\t{\n\t\tconst progressBar = this.ui.loaderProgressBar;\n\t\tif (progressBar)\n\t\t{\n\t\t\tprogressBar.update(0);\n\t\t}\n\t\tthis.ui.loaderActive = false;\n\t\tthis.ui.loader.style.display = 'none';\n\t}\n\n\tsetTitle (title)\n\t{\n\t\treturn this.ui.title.textContent = title;\n\t}\n\n\tgetNode (role)\n\t{\n\t\treturn this.ui.container.querySelector(`[data-role=\"${role}\"]`);\n\t}\n\n\tgetNodes (role)\n\t{\n\t\treturn Array.from(this.ui.container.querySelectorAll(`[data-role=\"${role}\"]`));\n\t}\n\n\tonBeforeGridRequest (grid, eventArgs)\n\t{\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\n\t\tif (!eventArgs.url)\n\t\t{\n\t\t\tconst parameters = Object.keys(this.filter).forEach(key => key + '=' + this.filter[key]);\n\t\t\teventArgs.url = '/bitrix/services/main/ajax.php?action=crm.api.tracking.ad.grid.report.get&' + parameters;\n\t\t}\n\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t};\n\t}\n}\n\n\nexport {Report};"],"names":["Report","options","container","loader","loaderText","loaderProgressBar","loaderActive","error","errorText","errorClose","grid","load","sourceId","from","to","parentId","level","gridId","filter","BX","SidePanel","Instance","open","cacheable","contentCallback","createUiContainer","build","showLoader","loadGrid","ajax","runAction","json","then","data","label","setLoaderText","complete","errors","showError","id","status","EventEmitter","subscribe","window","onBeforeGridRequest","bind","Runtime","html","getNode","initActivators","hideLoader","loaded","popupOptions","content","Loc","getMessage","zIndex","maxWidth","offsetLeft","offsetTop","animation","darkMode","bindElement","ui","hint","popup","Popup","show","setTimeout","destroy","getNodes","forEach","node","JSON","parse","dataset","statusBtn","previousElementSibling","enabled","classList","remove","statusButtonClassName","add","Event","Menu","items","text","Text","encode","onclick","changeStatus","close","undefined","selectorTitle","selector","children","length","parentElement","removeChild","role","appendChild","map","item","title","textContent","Tag","render","progressBar","UI","ProgressBar","value","maxValue","statusType","column","addEventListener","Helper","hideError","insertBefore","getContainer","setTitle","setValue","setTextBefore","val","parseInt","getValue","update","animateLoader","style","display","message","querySelector","Array","querySelectorAll","eventArgs","sessid","bitrix_sessid","method","url","parameters","Object","keys","key","top","Promise","resolve","loadExtension","Crm","Tracking","Ad"],"mappings":"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"}