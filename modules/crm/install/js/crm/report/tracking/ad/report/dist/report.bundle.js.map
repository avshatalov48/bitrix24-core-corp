{"version":3,"file":"report.bundle.js","sources":["../src/report.js"],"sourcesContent":["import './report.css';\n\nimport 'sidepanel';\nimport 'ui.progressbar';\nimport { Tag, Runtime, Event, Loc, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events'\nimport { Menu, Popup, PopupOptions } from 'main.popup'\n\ntype Options = {\n\tsourceId: string;\n\tfrom: string;\n\tto: string;\n\tparentId: number;\n\tlevel: number;\n\tgridId: string;\n};\n\nclass Report\n{\n\tui: Object = {\n\t\tcontainer: null,\n\t\tloader: null,\n\t\tloaderText: null,\n\t\tloaderProgressBar: null,\n\t\tloaderActive: false,\n\t\terror: null,\n\t\terrorText: null,\n\t\terrorClose: null,\n\t\tgrid: null,\n\t};\n\n\tloaded: boolean = false;\n\tstatusButtonClassName: string = 'crm-tracking-report-source-status-disabled';\n\n\tconstructor(options)\n\t{\n\t\tthis.load(options);\n\t}\n\n\tstatic open(options: Options): Promise\n\t{\n\t\tif (window === top)\n\t\t{\n\t\t\treturn Promise.resolve(new Report(options));\n\t\t}\n\n\t\treturn top.BX.Runtime.loadExtension('crm.report.tracking.ad.report').then(() => {\n\t\t\treturn new top.BX.Crm.Report.Tracking.Ad.Report(options);\n\t\t});\n\t}\n\n\tload({sourceId, from, to, parentId = 0, level = 0, gridId}: Options)\n\t{\n\t\tthis.gridId = gridId = gridId || `crm-report-tracking-ad-l${level}`;\n\t\tthis.filter = {sourceId, from, to, parentId, level, gridId};\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'crm:api.tracking.ad.report' + `-${sourceId}-${level}`,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tconst container = this.createUiContainer(level);\n\t\t\t\t\tthis.build();\n\t\t\t\t\treturn container;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tbuild ()\n\t{\n\t\tthis.showLoader();\n\t\tif (this.filter.level)\n\t\t{\n\t\t\tthis.loadGrid();\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.build',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\t...this.filter,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(({data}) => {\n\t\t\t\tif (data.label)\n\t\t\t\t{\n\t\t\t\t\tthis.setLoaderText(data.label);\n\t\t\t\t}\n\n\t\t\t\tif (data.complete)\n\t\t\t\t{\n\t\t\t\t\tthis.loadGrid();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.build();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(({errors}) => {\n\t\t\t\tthis.showError(errors[0]);\n\t\t\t})\n\t\t;\n\t}\n\n\tchangeStatus (id, status)\n\t{\n\t\tthis.showLoader();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.changeStatus',\n\t\t\t{\n\t\t\t\tjson: { id, status }\n\t\t\t}\n\t\t)\n\t\t\t.then(() => {\n\t\t\t\tthis.loadGrid();\n\t\t\t})\n\t\t\t.catch(({errors}) => {\n\t\t\t\tthis.showError(errors[0]);\n\t\t\t})\n\t\t;\n\t}\n\n\tloadGrid ()\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'crm.api.tracking.ad.report.getGrid',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\t...this.filter,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(({data}) => {\n\t\t\t\t//container.innerHTML = data.html;\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\twindow,\n\t\t\t\t\t'Grid::beforeRequest',\n\t\t\t\t\tthis.onBeforeGridRequest.bind(this)\n\t\t\t\t);\n\n\t\t\t\tRuntime.html(this.getNode('grid'), data.html)\n\t\t\t\tthis.initActivators();\n\t\t\t\tthis.hideLoader();\n\t\t\t\tthis.loaded = true;\n\n\t\t\t\tif (!this.filter.level)\n\t\t\t\t{\n\t\t\t\t\tconst popupOptions: PopupOptions = {\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_SETTINGS_HINT'),\n\t\t\t\t\t\tzIndex: 5000,\n\t\t\t\t\t\tmaxWidth: 300,\n\t\t\t\t\t\toffsetLeft: -315,\n\t\t\t\t\t\toffsetTop: -30,\n\t\t\t\t\t\tanimation: 'fading',\n\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\tbindElement: this.ui.hint,\n\t\t\t\t\t};\n\t\t\t\t\tconst popup = new Popup(popupOptions);\n\t\t\t\t\tpopup.show();\n\t\t\t\t\tsetTimeout(() => popup.destroy(), 10000);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tinitActivators ()\n\t{\n\t\tthis.getNodes('grid/activator').forEach((node) => {\n\t\t\tconst options = JSON.parse(node.dataset.options);\n\t\t\tconst statusBtn = node.previousElementSibling;\n\t\t\tif (statusBtn)\n\t\t\t{\n\t\t\t\toptions.enabled\n\t\t\t\t\t? statusBtn.classList.remove(this.statusButtonClassName)\n\t\t\t\t\t: statusBtn.classList.add(this.statusButtonClassName)\n\t\t\t\t;\n\t\t\t\tEvent.bind(statusBtn, 'click', () => {\n\t\t\t\t\tconst popup = new Menu({\n\t\t\t\t\t\tbindElement: statusBtn,\n\t\t\t\t\t\tzIndex: 3010,\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Text.encode(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_STATUS_ENABLED')),\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.changeStatus(options.parentId, true);\n\t\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Text.encode(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_STATUS_PAUSE')),\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.changeStatus(options.parentId, false);\n\t\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tpopup.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.level === null || options.level === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.bind(node, 'click', () => {\n\t\t\t\tnew Report({\n\t\t\t\t\t...this.filter,\n\t\t\t\t\tlevel: options.level,\n\t\t\t\t\tparentId: options.parentId,\n\t\t\t\t\tgridId: this.filter.gridId + '-lvl' + options.level,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tconst selectorTitle = this.getNode('grid/selector/title');\n\t\tconst selector = this.getNode('grid/selector');\n\t\tif (selector)\n\t\t{\n\t\t\tconst container = this.getNode('selector');\n\t\t\tif (container.children.length > 0)\n\t\t\t{\n\t\t\t\tselector.parentElement.removeChild(selector);\n\t\t\t\tselectorTitle.parentElement.removeChild(selectorTitle);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselector.dataset.role = '';\n\t\t\tselectorTitle.dataset.role = '';\n\t\t\tcontainer.appendChild(selectorTitle);\n\t\t\tcontainer.appendChild(selector);\n\n\t\t\tEvent.bind(selector, 'click', () => {\n\t\t\t\tconst options = JSON.parse(selector.dataset.options);\n\t\t\t\tconst popup = new Menu({\n\t\t\t\t\tbindElement: selector,\n\t\t\t\t\tzIndex: 3010,\n\t\t\t\t\titems: options.items.map(item => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttext: Text.encode(item.title),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\tselector.textContent = item.title;\n\t\t\t\t\t\t\t\tthis.filter.parentId = item.parentId;\n\t\t\t\t\t\t\t\tthis.filter.level = item.level;\n\t\t\t\t\t\t\t\tthis.filter.sourceId = item.sourceId;\n\t\t\t\t\t\t\t\tthis.build();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\t\t\t});\n\t\t}\n\t}\n\n\tcreateUiContainer (level)\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-report-tracking-panel\">\n\t\t\t\t<div class=\"crm-report-tracking-panel-title\">\n\t\t\t\t\t<div class=\"crm-report-tracking-panel-title-name\">\n\t\t\t\t\t\t<div class=\"crm-report-tracking-panel-title-line\">\n\t\t\t\t\t\t\t<div data-role=\"title\"></div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t${level ? '' : '<div data-role=\"hint\" class=\"ui-hint-icon crm-report-tracking-panel-hint\"></div>'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-role=\"selector\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-report-tracking-panel-body\">\n\t\t\t\t\t<div data-role=\"loader\" class=\"crm-report-tracking-panel-loader\">\n\t\t\t\t\t\t<div data-role=\"loader/text\" class=\"crm-report-tracking-panel-loader-text\"></div>\n\t\t\t\t\t\t<div data-role=\"loader/bar\" class=\"crm-report-tracking-panel-loader-bar\">\n\t\t\t\t\t\t\t<div data-role=\"error\" class=\"ui-alert ui-alert-danger\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t<span class=\"ui-alert-message\">\n\t\t\t\t\t\t\t\t\t<strong>${Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_ERROR_TITLE')}:</strong>\n\t\t\t\t\t\t\t\t\t<span data-role=\"error/text\"></span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"text-align: center;\">\n\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\tdata-role=\"error/close\" \n\t\t\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-light-border\"\n\t\t\t\t\t\t\t\t\tstyle=\"display: none;\"\n\t\t\t\t\t\t\t\t>${Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_CLOSE')}</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-role=\"grid\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.ui.container = container;\n\t\tthis.ui.title = this.getNode('title');\n\t\tthis.ui.hint = this.getNode('hint');\n\t\tthis.ui.loader = this.getNode('loader');\n\t\tthis.ui.loaderText = this.getNode('loader/text');\n\t\tthis.ui.error = this.getNode('error');\n\t\tthis.ui.errorText = this.getNode('error/text');\n\t\tthis.ui.errorClose = this.getNode('error/close');\n\t\tthis.ui.grid = this.getNode('grid');\n\n\t\tconst progressBar = new BX.UI.ProgressBar({\n\t\t\tvalue: 0,\n\t\t\tmaxValue: 100,\n\t\t\tstatusType: 'none',\n\t\t\tcolumn: true,\n\t\t});\n\n\t\tif (this.ui.hint)\n\t\t{\n\t\t\tthis.ui.hint.addEventListener('click', () => BX.Helper.show(\"redirect=detail&code=12526974\"));\n\t\t}\n\t\tif (this.ui.errorClose)\n\t\t{\n\t\t\tthis.ui.errorClose.addEventListener('click', () => {\n\t\t\t\tif (this.loaded)\n\t\t\t\t{\n\t\t\t\t\tthis.hideError();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.getNode('loader/bar').insertBefore(progressBar.getContainer(), this.getNode('loader/bar').children[0]);\n\t\tthis.ui.loaderProgressBar = progressBar;\n\t\tthis.setLoaderText(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_BUILD'));\n\n\t\tthis.setTitle(Loc.getMessage('CRM_REPORT_TRACKING_AD_REPORT_TITLE_' + this.filter.level));\n\n\t\treturn container;\n\t}\n\n\tsetLoaderText (text)\n\t{\n\t\tthis.ui.loaderProgressBar.setValue(0);\n\t\tthis.ui.loaderProgressBar.setTextBefore(text);\n\t}\n\n\tanimateLoader ()\n\t{\n\t\tif (!this.ui.loaderActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst progressBar = this.ui.loaderProgressBar;\n\t\tconst val = parseInt(progressBar.getValue()) + 1;\n\t\tif (val <= 95)\n\t\t{\n\t\t\tprogressBar.update(val);\n\t\t}\n\n\t\tsetTimeout(() => this.animateLoader(), 100);\n\t}\n\n\tshowError (error: Error)\n\t{\n\t\tthis.ui.errorClose.style.display = '';\n\t\tthis.ui.error.style.display = '';\n\t\tthis.ui.errorText.textContent = error.message;\n\t\tthis.ui.loaderProgressBar.getContainer().style.display = 'none';\n\t}\n\n\thideError ()\n\t{\n\t\tthis.ui.errorClose.style.display = 'none';\n\t\tthis.ui.error.style.display = 'none';\n\t\tthis.ui.errorText.textContent = '';\n\t\tthis.ui.loaderProgressBar.getContainer().style.display = '';\n\n\t\tthis.hideLoader();\n\t}\n\n\tshowLoader ()\n\t{\n\t\tif (!this.ui.loaderActive)\n\t\t{\n\t\t\tsetTimeout(() => this.animateLoader(), 100);\n\t\t}\n\n\t\tthis.ui.loaderActive = true;\n\t\tthis.ui.loader.style.display = '';\n\t}\n\n\thideLoader ()\n\t{\n\t\tconst progressBar = this.ui.loaderProgressBar;\n\t\tif (progressBar)\n\t\t{\n\t\t\tprogressBar.update(0);\n\t\t}\n\t\tthis.ui.loaderActive = false;\n\t\tthis.ui.loader.style.display = 'none';\n\t}\n\n\tsetTitle (title)\n\t{\n\t\treturn this.ui.title.textContent = title;\n\t}\n\n\tgetNode (role)\n\t{\n\t\treturn this.ui.container.querySelector(`[data-role=\"${role}\"]`);\n\t}\n\n\tgetNodes (role)\n\t{\n\t\treturn Array.from(this.ui.container.querySelectorAll(`[data-role=\"${role}\"]`));\n\t}\n\n\tonBeforeGridRequest (grid, eventArgs)\n\t{\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\n\t\tif (!eventArgs.url)\n\t\t{\n\t\t\tconst parameters = Object.keys(this.filter).forEach(key => key + '=' + this.filter[key]);\n\t\t\teventArgs.url = '/bitrix/services/main/ajax.php?action=crm.api.tracking.ad.grid.report.get&' + parameters;\n\t\t}\n\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t};\n\t}\n}\n\n\nexport {Report};"],"names":["Report","options","container","loader","loaderText","loaderProgressBar","loaderActive","error","errorText","errorClose","grid","load","sourceId","from","to","parentId","level","gridId","filter","BX","SidePanel","Instance","open","cacheable","contentCallback","createUiContainer","build","showLoader","loadGrid","ajax","runAction","json","then","data","label","setLoaderText","complete","catch","errors","showError","id","status","EventEmitter","subscribe","window","onBeforeGridRequest","bind","Runtime","html","getNode","initActivators","hideLoader","loaded","popupOptions","content","Loc","getMessage","zIndex","maxWidth","offsetLeft","offsetTop","animation","darkMode","bindElement","ui","hint","popup","Popup","show","setTimeout","destroy","getNodes","forEach","node","JSON","parse","dataset","statusBtn","previousElementSibling","enabled","classList","remove","statusButtonClassName","add","Event","Menu","items","text","Text","encode","onclick","changeStatus","close","undefined","selectorTitle","selector","children","length","parentElement","removeChild","role","appendChild","map","item","title","textContent","Tag","render","progressBar","UI","ProgressBar","value","maxValue","statusType","column","addEventListener","Helper","hideError","insertBefore","getContainer","setTitle","setValue","setTextBefore","val","parseInt","getValue","update","animateLoader","style","display","message","querySelector","Array","querySelectorAll","eventArgs","sessid","bitrix_sessid","method","url","parameters","Object","keys","key","top","Promise","resolve","loadExtension","Crm","Tracking","Ad"],"mappings":"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"}