{"version":3,"file":"onboarding-popup.bundle.js","sources":["../src/components/popup-content.js","../src/onboarding-popup.js"],"sourcesContent":["import { Lottie } from 'ui.lottie';\nimport { BIcon as Icon } from 'ui.icon-set.api.vue';\nimport { Set } from 'ui.icon-set.api.core';\n\nimport 'ui.design-tokens';\nimport WorkflowAnimation from './workflow-animation.json';\nimport '../styles/popup-content.css';\nimport { Button, ButtonColor, ButtonSize, ButtonStyle } from 'ui.buttons';\n\nexport const PopupContent = {\n\tcomponents: {\n\t\tIcon,\n\t},\n\n\tprops: {\n\t\tpopup: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tLottie.loadAnimation({\n\t\t\tcontainer: this.$refs.workflowAnimation,\n\t\t\trenderer: 'svg',\n\t\t\tanimationData: WorkflowAnimation,\n\t\t\tautoplay: true,\n\t\t});\n\t},\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.loc('CRM_PERMISSIONS_ONBOARDING_POPUP_TITLE');\n\t\t},\n\t\tpoints(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.loc('CRM_PERMISSIONS_ONBOARDING_POPUP_POINT_1'),\n\t\t\t\tthis.loc('CRM_PERMISSIONS_ONBOARDING_POPUP_POINT_2'),\n\t\t\t\tthis.loc('CRM_PERMISSIONS_ONBOARDING_POPUP_POINT_3'),\n\t\t\t];\n\t\t},\n\t\ticonCircle(): { name: string, color: string, size: number }\n\t\t{\n\t\t\treturn {\n\t\t\t\tname: Set.CIRCLE_CHECK,\n\t\t\t\tcolor: 'rgba(255, 255, 255, 0.6)',\n\t\t\t\tsize: 20,\n\t\t\t};\n\t\t},\n\t\tstartBtnClass(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\tButton.BASE_CLASS,\n\t\t\t\tButtonColor.SUCCESS,\n\t\t\t\tButtonSize.MEDIUM,\n\t\t\t];\n\t\t},\n\n\t\tmoreBtnClass(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\tButton.BASE_CLASS,\n\t\t\t\tButtonColor.LIGHT_BORDER,\n\t\t\t\tButtonSize.MEDIUM,\n\t\t\t\tButtonStyle.DEPEND_ON_THEME,\n\t\t\t];\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phrase: string): ?string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phrase);\n\t\t},\n\n\t\tclose(): void\n\t\t{\n\t\t\tthis.popup.close();\n\t\t},\n\n\t\topenHelpdesk(): void\n\t\t{\n\t\t\tthis.popup.openHelpdesk();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-permissions-onboarding-popup__wrapper bitrix24-light-theme\">\n\t\t\t<div class=\"crm-permissions-onboarding-popup__info\">\n\t\t\t\t<span class=\"crm-permissions-onboarding-popup__title\" v-html=\"title\" />\n\t\t\t\t<div class=\"crm-permissions-onboarding-popup__points\">\n\t\t\t\t\t<div class=\"crm-permissions-onboarding-popup__point-item\" v-for=\"point in points\">\n\t\t\t\t\t\t<Icon v-bind=\"iconCircle\"/>\n\t\t\t\t\t\t<span class=\"crm-permissions-onboarding-popup__point-text\">{{ point }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-permissions-onboarding-popup__buttons\">\n\t\t\t\t\t<button @click=\"close\" :class=\"startBtnClass\">\n\t\t\t\t\t\t<span class=\"ui-btn-text\">{{ loc('CRM_PERMISSIONS_ONBOARDING_POPUP_START_BUTTON') }}</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button @click=\"openHelpdesk\" :class=\"moreBtnClass\">\n\t\t\t\t\t\t<span class=\"ui-btn-text\">{{ loc('CRM_PERMISSIONS_ONBOARDING_POPUP_MORE_BUTTON') }}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div ref=\"workflowAnimation\" class=\"crm-permissions-onboarding-popup__workflow-animation\"></div>\n\t\t</div>\n\t`,\n};\n","import { Tag, Dom, Type } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { BannerDispatcher, Priority } from 'crm.integration.ui.banner-dispatcher';\nimport { PopupContent } from './components/popup-content';\n\ndeclare type OnboardingPopupOptions = {\n\tcloseOptionCategory: string,\n\tcloseOptionName: string,\n};\n\nconst HELPDESK_CODE = '23240636';\n\nexport class OnboardingPopup\n{\n\t#popup: Popup = null;\n\t#bannerDispatcher: BannerDispatcher;\n\t#popupContentApp: VueCreateAppResult = null;\n\t#targetContainer: HTMLElement = null;\n\t#originalOverflowValue: ?string = null;\n\n\t#optionName: string;\n\t#optionCategory: string;\n\n\t#width: number = 868;\n\t#height: number = 482;\n\n\tconstructor(options: OnboardingPopupOptions)\n\t{\n\t\tif (!Type.isStringFilled(options.closeOptionCategory))\n\t\t{\n\t\t\tthrow new Error(\"Parameter 'options.closeOptionCategory' must be a filled string\");\n\t\t}\n\n\t\tif (!Type.isStringFilled(options.closeOptionName))\n\t\t{\n\t\t\tthrow new Error(\"Parameter 'options.closeOptionName' must be a filled string\");\n\t\t}\n\n\t\tthis.#optionCategory = options.closeOptionCategory;\n\t\tthis.#optionName = options.closeOptionName;\n\n\t\tthis.#bannerDispatcher = new BannerDispatcher();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#setTargetOverflow('hidden');\n\t\tthis.#bannerDispatcher.toQueue(\n\t\t\t(onDone: Function): void => {\n\t\t\t\tthis.getPopup().subscribe('onAfterClose', onDone);\n\t\t\t\tthis.getPopup().show();\n\t\t\t},\n\t\t\tPriority.CRITICAL,\n\t\t);\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.getPopup().close();\n\t}\n\n\tsave(): void\n\t{\n\t\tBX.userOptions.save(this.#optionCategory, this.#optionName, 'closed', 'Y');\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\ttargetContainer: this.#target(),\n\t\t\t\tclassName: 'crm-permissions-onboarding-popup',\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tpadding: 0,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 40,\n\t\t\t\t\tbackgroundColor: '#000000',\n\t\t\t\t},\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\twidth: this.#width,\n\t\t\t\theight: this.#height,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tborderRadius: '24px',\n\t\t\t\tevents: {\n\t\t\t\t\tonAfterClose: () => {\n\t\t\t\t\t\tthis.#resetTargetOverflow();\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\topenHelpdesk(): void\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${HELPDESK_CODE}`);\n\t\t}\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tconst container = Tag.render`<div class=\"crm-permissions-onboarding-popup-content\"></div>`;\n\n\t\tthis.#popupContentApp = BitrixVue.createApp(PopupContent, { popup: this });\n\t\tthis.#popupContentApp.mount(container);\n\n\t\treturn container;\n\t}\n\n\t#setTargetOverflow(value: string): void\n\t{\n\t\tthis.#originalOverflowValue = Dom.style(this.#target(), 'overflow');\n\t\tDom.style(this.#target(), 'overflow', value);\n\t}\n\n\t#resetTargetOverflow(): void\n\t{\n\t\tif (this.#originalOverflowValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#target(), 'overflow', this.#originalOverflowValue);\n\t\tthis.#originalOverflowValue = null;\n\t}\n\n\t#target(): HTMLElement\n\t{\n\t\tif (this.#targetContainer === null)\n\t\t{\n\t\t\tthis.#targetContainer = document.body;\n\t\t}\n\n\t\treturn this.#targetContainer;\n\t}\n}\n"],"names":["PopupContent","components","Icon","props","popup","type","Object","required","mounted","Lottie","loadAnimation","container","this","$refs","workflowAnimation","renderer","animationData","WorkflowAnimation","autoplay","computed","title","loc","points","iconCircle","name","Set","CIRCLE_CHECK","color","size","startBtnClass","Button","BASE_CLASS","ButtonColor","SUCCESS","ButtonSize","MEDIUM","moreBtnClass","LIGHT_BORDER","ButtonStyle","DEPEND_ON_THEME","methods","phrase","$Bitrix","Loc","getMessage","close","openHelpdesk","template","Tag","render","babelHelpers","BitrixVue","createApp","mount","value","Dom","style","document","body","constructor","options","writable","Type","isStringFilled","closeOptionCategory","Error","closeOptionName","BannerDispatcher","show","toQueue","onDone","getPopup","subscribe","Priority","CRITICAL","save","BX","userOptions","Popup","targetContainer","className","closeIcon","closeByEsc","cacheable","padding","overlay","opacity","backgroundColor","content","width","height","animation","borderRadius","events","onAfterClose","top","Helper"],"mappings":"ptUASaA,EAAe,CAC3BC,WAAY,MACXC,SAGDC,MAAO,CACNC,MAAO,CACNC,KAAMC,OACNC,UAAU,IAIZC,UAECC,SAAOC,cAAc,CACpBC,UAAWC,KAAKC,MAAMC,kBACtBC,SAAU,MACVC,cAAeC,EACfC,UAAU,KAIZC,SAAU,CACTC,QAEC,OAAOR,KAAKS,IAAI,2CAEjBC,SAEC,MAAO,CACNV,KAAKS,IAAI,4CACTT,KAAKS,IAAI,4CACTT,KAAKS,IAAI,8CAGXE,WAAU,KAEF,CACNC,KAAMC,MAAIC,aACVC,MAAO,2BACPC,KAAM,KAGRC,cAAa,IAEL,CACNC,SAAOC,WACPC,cAAYC,QACZC,aAAWC,QAIbC,aAAY,IAEJ,CACNN,SAAOC,WACPC,cAAYK,aACZH,aAAWC,OACXG,cAAYC,kBAKfC,QAAS,CACRnB,IAAIoB,GAEH,OAAO7B,KAAK8B,QAAQC,IAAIC,WAAWH,IAGpCI,QAECjC,KAAKR,MAAMyC,SAGZC,eAEClC,KAAKR,MAAM0C,iBAIbC,SAAW,ooCC9EqB,4uBAoIhC,aAlCC,MAAMpC,EAAYqC,MAAIC,cAAO,iEAK7B,OAHAC,mDAAwBC,YAAUC,UAAUpD,EAAc,CAAEI,MAAOQ,OACnEsC,mDAAsBG,MAAM1C,GAErBA,EACP,WAEkB2C,GAElBJ,mDAA8BK,MAAIC,8CAAM5C,aAAgB,YACxD2C,MAAIC,8CAAM5C,aAAgB,WAAY0C,GACtC,aAIoC,OAAhCJ,qDAKJK,MAAIC,8CAAM5C,aAAgB,mDAAYA,YACtCsC,mDAA8B,MAC9B,aASA,OAL8B,OAA1BA,qDAEHA,mDAAwBO,SAASC,8CAG3B9C,6BAhIF,MAcN+C,YAAYC,GAEX,GADDtD,8BAAAgD,UAAAhD,8BAAAgD,UAAAhD,8BAAAgD,UAAAhD,8BAAAgD,UAAAhD,8BAAAuD,YAAAP,MAbgB,OAAIhD,8BAAAuD,YAAAP,eAAAhD,8BAAAuD,YAAAP,MAEmB,OAAIhD,8BAAAuD,YAAAP,MACX,OAAIhD,8BAAAuD,YAAAP,MACF,OAAIhD,8BAAAuD,YAAAP,eAAAhD,8BAAAuD,YAAAP,eAAAhD,8BAAAuD,YAAAP,MAKrB,MAAGhD,8BAAAuD,YAAAP,MACF,OAIZQ,OAAKC,eAAeH,EAAQI,qBAEhC,MAAM,IAAIC,MAAM,mEAGjB,IAAKH,OAAKC,eAAeH,EAAQM,iBAEhC,MAAM,IAAID,MAAM,+DAGjBf,mDAAuBU,EAAQI,oBAC/Bd,mDAAmBU,EAAQM,gBAE3BhB,mDAAyB,IAAIiB,mBAG9BC,OAEClB,mDAAwB,UACxBA,mDAAuBmB,QACrBC,IACA1D,KAAK2D,WAAWC,UAAU,eAAgBF,GAC1C1D,KAAK2D,WAAWH,QAEjBK,WAASC,UAIX7B,QAECjC,KAAK2D,WAAW1B,QAGjB8B,OAECC,GAAGC,YAAYF,6CAAK/D,mDAAsBA,WAAkB,SAAU,KAGvE2D,WA6BC,OA3BoB,OAAhBrB,qDAEHA,mDAAc,IAAI4B,QAAM,CACvBC,wDAAiBnE,aACjBoE,UAAW,mCACXC,WAAW,EACXC,YAAY,EACZC,WAAW,EACXC,QAAS,EACTC,QAAS,CACRC,QAAS,GACTC,gBAAiB,WAElBC,gDAAS5E,aACT6E,8CAAO7E,WACP8E,+CAAQ9E,WACR+E,UAAW,eACXC,aAAc,OACdC,OAAQ,CACPC,aAAc,KACb5C,qDACAtC,KAAK+D,oDAMF/D,WAGRkC,eAEKiD,IAAInB,GAAGoB,QAEVD,IAAInB,GAAGoB,OAAO5B,KAAM"}