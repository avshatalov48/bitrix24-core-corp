{"version":3,"file":"access-rights-wrapper.bundle.js","sources":["../src/access-rights-wrapper.js"],"sourcesContent":["import { AccessRights } from 'ui.accessrights';\n\nexport class AccessRightsWrapper\n{\n\taccessRightsInstance;\n\n\tdraw(userGroups, accessRights, renderTo)\n\t{\n\t\tthis.accessRightsInstance = new AccessRights({\n\t\t\tcomponent: 'bitrix:crm.config.perms.v2',\n\t\t\tactionSave: 'save',\n\t\t\tactionDelete: 'delete',\n\t\t\trenderTo,\n\t\t\tuserGroups,\n\t\t\taccessRights,\n\t\t\tisSaveOnlyChangedRights: true,\n\t\t\tuseEntitySelectorDialogAsPopup: true,\n\t\t\tentitySelectorDialogOptions: {\n\t\t\t\toptions: this.#dialogOptions(),\n\t\t\t\tentitiesIdsEncoder: this.#entitiesIdsEncoder(),\n\t\t\t\tentitiesIdsDecoder: this.#entitiesIdsDecoder(),\n\t\t\t\tnormalizeType: this.#normalizeType(),\n\t\t\t},\n\t\t});\n\n\t\tthis.accessRightsInstance.draw();\n\t}\n\n\tsendActionRequest()\n\t{\n\t\tif (this.accessRightsInstance)\n\t\t{\n\t\t\tthis.accessRightsInstance.sendActionRequest();\n\t\t}\n\t}\n\n\tfireEventReset()\n\t{\n\t\tif (this.accessRightsInstance)\n\t\t{\n\t\t\tthis.accessRightsInstance.fireEventReset();\n\t\t}\n\t}\n\n\t#dialogOptions()\n\t{\n\t\treturn {\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'CRM_PERMS',\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t\tallowSelectRootDepartment: true,\n\t\t\t\t\t\tallowFlatDepartments: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\toptions: { 'all-users': true }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'projectmembers',\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\taddProjectMembersCategories: true,\n\t\t\t\t\t},\n\t\t\t\t\titemOptions: {\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tlink: '',\n\t\t\t\t\t\t\tlinkTitle: '',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'site_groups',\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t#entitiesIdsEncoder()\n\t{\n\t\treturn (code) => {\n\t\t\tif (/^U(\\d+)$/.test(code))\n\t\t\t{\n\t\t\t\tconst match = code.match(/^U(\\d+)$/) || null;\n\t\t\t\tconst userId = match ? match[1] : null;\n\n\t\t\t\treturn { entityName: 'user', id: userId };\n\t\t\t}\n\t\t\telse if (/^DR(\\d+)$/.test(code))\n\t\t\t{\n\t\t\t\tconst match = code.match(/^DR(\\d+)$/) || null;\n\t\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\t\treturn { entityName: 'department', id: `${departmentId}:F` };\n\t\t\t}\n\t\t\telse if (/^D(\\d+)$/.test(code))\n\t\t\t{\n\t\t\t\tconst match = code.match(/^D(\\d+)$/) || null;\n\t\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\t\treturn { entityName: 'department', id: departmentId };\n\t\t\t}\n\t\t\telse if (/^G(\\d+)$/.test(code))\n\t\t\t{\n\t\t\t\treturn { entityName: 'site_groups', id: code };\n\t\t\t}\n\t\t\telse if (/^SG(\\d+)_([AEK])$/.test(code))\n\t\t\t{\n\t\t\t\tconst match = code.match(/^SG(\\d+)_([AEK])$/) || null;\n\n\t\t\t\tconst projectId = match ? match[1] : null;\n\t\t\t\tconst postfix = match ? match[2] : null;\n\n\t\t\t\treturn { entityName: 'project', id: `${projectId}:${postfix}` }\n\t\t\t}\n\n\t\t\treturn { entityName: 'unknown', id: code };\n\t\t};\n\t}\n\n\t#entitiesIdsDecoder()\n\t{\n\t\treturn (item) => {\n\t\t\tconst entityId = item.entityId;\n\n\t\t\tlet code = '';\n\n\t\t\tswitch (entityId)\n\t\t\t{\n\t\t\t\tcase 'user':\n\t\t\t\t\tcode = `U${item.id}`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'department':\n\t\t\t\t\tif (/:F$/.test(item.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst match = item.id.match(/^(\\d+):F$/);\n\t\t\t\t\t\tconst originalId = match ? match[1] : null;\n\t\t\t\t\t\tcode = `DR${originalId}`;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcode = `D${item.id}`;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'site_groups':\n\t\t\t\t\tif (/^(\\d+)$/.test(item.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tcode = `G${item.id}`;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcode = item.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'projectmembers':\n\t\t\t\t\tconst subType = item.customData.get('memberCategory');\n\t\t\t\t\tconst originalId = item.customData.get('parentId');\n\t\t\t\t\tswitch (subType)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'owner':\n\t\t\t\t\t\t\tcode = `SG${originalId}_A`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'moderator':\n\t\t\t\t\t\t\tcode = `SG${originalId}_E`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'all':\n\t\t\t\t\t\t\tcode = `SG${originalId}_K`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn code;\n\t\t};\n\t}\n\n\t#normalizeType()\n\t{\n\t\treturn (originalType) => {\n\t\t\tswitch (originalType)\n\t\t\t{\n\t\t\t\tcase 'user':\n\t\t\t\t\treturn 'users';\n\t\t\t\tcase 'intranet':\n\t\t\t\t\treturn 'departments';\n\t\t\t\tcase 'socnetgroup':\n\t\t\t\t\treturn 'sonetgroups';\n\t\t\t\tcase 'group':\n\t\t\t\t\treturn 'groups';\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n\t}\n}\n"],"names":["AccessRightsWrapper","draw","userGroups","accessRights","renderTo","accessRightsInstance","AccessRights","component","actionSave","actionDelete","isSaveOnlyChangedRights","useEntitySelectorDialogAsPopup","entitySelectorDialogOptions","options","entitiesIdsEncoder","entitiesIdsDecoder","normalizeType","sendActionRequest","fireEventReset","enableSearch","context","entities","id","intranetUsersOnly","emailUsers","inviteEmployeeLink","inviteGuestLink","selectMode","allowSelectRootDepartment","allowFlatDepartments","dynamicLoad","addProjectMembersCategories","itemOptions","default","link","linkTitle","dynamicSearch","code","test","match","userId","entityName","departmentId","projectId","postfix","item","entityId","originalId","subType","customData","get","originalType"],"mappings":"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"}