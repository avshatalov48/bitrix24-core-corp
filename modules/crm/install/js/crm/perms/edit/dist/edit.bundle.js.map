{"version":3,"file":"edit.bundle.js","sources":["../src/utils.js","../src/store/getters.js","../src/store/mutations.js","../src/store/actions.js","../src/store.js","../src/components/permissioncontrol.js","../src/components/expandcontrol.js","../src/components/entitycontrol.js","../src/slider/slider-permissions.js","../src/slider/slider-manager.js","../src/components/row.js","../src/components/desk.js","../src/components/loader.js","../src/components/main.js","../src/app.js"],"sourcesContent":["import { PermissionEntityIdentifier } from './store';\n\nexport function entityHash(entity): string\n{\n\tif (entity.stageField)\n\t{\n\t\treturn `${entity.entityCode}__${entity.stageField}__${entity.stageCode}`;\n\t}\n\n\treturn entity.entityCode;\n}\n\nexport function hashIdentifier(identifier: PermissionEntityIdentifier): string\n{\n\tlet hash = `${identifier.entityCode}__${identifier.permissionCode}`;\n\n\tif (identifier.stageField)\n\t{\n\t\thash = `${hash}__${identifier.stageField}__${identifier.stageCode}`;\n\t}\n\n\treturn btoa(hash);\n}","import { Type } from 'main.core';\nimport {\n\tAssignAttributeParam,\n\tAssignTransitionValues,\n\tMAX_SORT_ORDER_ON_THE_DESK,\n\tPermissionEntityIdentifier,\n\tPermissions,\n} from '../store';\nimport { entityHash } from '../utils';\n\nexport default {\n\tpermissionEntities(state) {\n\t\treturn state.desk.permissionEntities;\n\t},\n\n\tpermissionEntitiesExpanded(state) {\n\t\treturn state.desk.permissionEntities.filter((entity) => {\n\t\t\treturn !(entity.stageField && !state.ui.expandedStageEntities[entity.entityCode]);\n\t\t});\n\t},\n\n\tgetMainPermissionEntityByCode: (state) => (entityCode) => {\n\t\treturn state.desk.permissionEntities.find((item) => {\n\t\t\treturn item.entityCode === entityCode && !item.stageField;\n\t\t});\n\t},\n\n\tgetEntitiesGroupedByPermission: (state, getters) => (entityCode) => {\n\t\tconst rootEntity = getters.getMainPermissionEntityByCode(entityCode);\n\n\t\tconst entities = state.desk.permissionEntities\n\t\t\t.filter((entity) => entity.entityCode === rootEntity.entityCode);\n\n\t\tlet permissions = [];\n\n\t\tfor (const entity of entities)\n\t\t{\n\t\t\tfor (const permCode of Object.keys(entity.permissions))\n\t\t\t{\n\t\t\t\tif (!Object.hasOwn(entity.permissions, permCode))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst values = entity.permissions[permCode];\n\n\t\t\t\tconst permissionConfig: Permissions = state.desk.availablePermissions.find((perm: Permissions) => {\n\t\t\t\t\treturn perm.code === permCode;\n\t\t\t\t});\n\n\t\t\t\tif (permissionConfig.sortOrder <= MAX_SORT_ORDER_ON_THE_DESK)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tpermissions.push({\n\t\t\t\t\tcode: permCode,\n\t\t\t\t\tname: permissionConfig.name,\n\t\t\t\t\tvalues,\n\t\t\t\t\tisEntityStageSupport: entity.hasStages,\n\t\t\t\t\tisPermissionStageSupport: permissionConfig.canAssignPermissionToStages,\n\t\t\t\t\tstageField: entity.stageField,\n\t\t\t\t\tstageCode: entity.stageCode,\n\t\t\t\t\tstateName: entity.name,\n\t\t\t\t\tsortOrder: parseInt(permissionConfig.sortOrder, 10),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpermissions = permissions.sort((a, b) => {\n\t\t\tif (a.sortOrder === b.sortOrder)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn a.sortOrder < b.sortOrder ? -1 : 1;\n\t\t});\n\n\t\treturn permissions;\n\t},\n\n\tavailablePermissions(state) {\n\t\treturn state.desk.availablePermissions;\n\t},\n\n\tgetAssignedAttribute: (state) => (\n\t\t{ permissionCode, entityCode, stageField, stageCode }: PermissionEntityIdentifier,\n\t) => {\n\t\tif (stageField)\n\t\t{\n\t\t\tlet value = state.roleAssignedPermissions?.[entityCode]?.[permissionCode]?.[stageField]?.[stageCode];\n\n\t\t\t// Not assigned value of stage attribute means it is inherited val from root permission entity\n\t\t\tif (Type.isUndefined(value))\n\t\t\t{\n\t\t\t\tvalue = '-';\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\treturn state.roleAssignedPermissions?.[entityCode]?.[permissionCode]?.['-'] || null;\n\t},\n\n\tisStageEntitiesVisible: (state) => (entity) => {\n\t\tconst hash = entityHash(entity);\n\n\t\treturn Boolean(state.ui.expandedStageEntities[hash]);\n\t},\n\n\tpermissionsOnMainView(state) {\n\t\treturn state.desk.availablePermissions.filter((perm) => {\n\t\t\treturn perm.sortOrder <= MAX_SORT_ORDER_ON_THE_DESK;\n\t\t});\n\t},\n\n\thasTariffPermission(state): boolean {\n\t\treturn state.restriction.hasPermission;\n\t},\n\n\tgetRestrictionScript(state): ?string {\n\t\treturn state.restriction.restrictionScript;\n\t},\n\n\tgetAvailablePermissionsOrders(state) {\n\t\treturn state.desk.availablePermissionsOrders;\n\t},\n\n\tgetSaveData(state) {\n\t\tconst toRemove = [];\n\t\tconst toChange = [];\n\n\t\tfor (const hash of Object.keys(state.touched.touchedAttributes))\n\t\t{\n\t\t\tconst touched: AssignAttributeParam = state.touched.touchedAttributes[hash];\n\t\t\tif (touched.identifier.stageField)\n\t\t\t{\n\t\t\t\tif (touched.value === '-')\n\t\t\t\t{\n\t\t\t\t\ttoRemove.push({ ...touched.identifier });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttoChange.push({ ...touched.identifier, value: touched.value });\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (touched.value === '')\n\t\t\t{\n\t\t\t\ttoRemove.push({ ...touched.identifier });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttoChange.push({ ...touched.identifier, value: touched.value });\n\t\t\t}\n\t\t}\n\n\t\tfor (const hash of Object.keys(state.touched.touchedTransitions))\n\t\t{\n\t\t\tconst touched: AssignTransitionValues = state.touched.touchedTransitions[hash];\n\n\t\t\tif (touched.identifier.stageField)\n\t\t\t{\n\t\t\t\tif (touched.values === '-')\n\t\t\t\t{\n\t\t\t\t\ttoRemove.push({ ...touched.identifier });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttoChange.push({ ...touched.identifier, settings: touched.values });\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (touched.values.length === 0 || (touched.values.length === 1 && touched.values[0] === 'INHERIT'))\n\t\t\t{\n\t\t\t\ttoRemove.push({ ...touched.identifier });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttoChange.push({ ...touched.identifier, settings: touched.values });\n\t\t\t}\n\t\t}\n\n\t\tif (state.role.id === 0) // is new role\n\t\t{\n\t\t\tappendDefaultAttributesPermissionsToChange(state, toChange);\n\t\t\tappendDefaultTransitionPermissionsToChange(state, toChange);\n\t\t}\n\n\t\treturn {\n\t\t\tid: state.role.id,\n\t\t\tname: state.role.name,\n\t\t\tpermissions: {\n\t\t\t\ttoRemove,\n\t\t\t\ttoChange,\n\t\t\t},\n\t\t};\n\t},\n\n\tgetRoleName(state) {\n\t\treturn state.role.name;\n\t},\n\n\tgetRoleId(state): number {\n\t\treturn state.role.id;\n\t},\n\n\tisSaveInProgress(state): boolean {\n\t\treturn state.ui.isSaveInProgress;\n\t},\n\n\tgetLastErrorMessage(state): string {\n\t\treturn state.ui.lastErrorMessage;\n\t},\n\n\tsetSaveInProgress(state): boolean {\n\t\treturn state.ui.isSaveInProgress;\n\t},\n\n\tgetTransitionSettings: (state) => (\n\t\t{ permissionCode, entityCode, stageField, stageCode }: PermissionEntityIdentifier,\n\t) => {\n\t\tif (stageField)\n\t\t{\n\t\t\tlet value = state.transitions?.[entityCode]?.[stageField]?.[stageCode];\n\n\t\t\t// Not assigned value of stage attribute means it is inherited val from root permission entity\n\t\t\tif (Type.isUndefined(value))\n\t\t\t{\n\t\t\t\tvalue = ['INHERIT'];\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\treturn state.transitions?.[entityCode]?.['-'] || ['BLOCKED'];\n\t},\n};\n\nfunction appendDefaultAttributesPermissionsToChange(state, toChange): void\n{\n\tObject.keys(state.roleAssignedPermissions).forEach((entityCode) => {\n\t\tconst permissions = state.roleAssignedPermissions[entityCode] ?? {};\n\t\tObject.keys(permissions).forEach((permissionCode) => {\n\t\t\tif (permissionCode === 'TRANSITION')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst permission = permissions[permissionCode];\n\t\t\tconst value = permission?.['-'];\n\t\t\tif (!Type.isString(value))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst hasSelectedPermission = toChange.find(\n\t\t\t\t(item) => item.entityCode === entityCode\n\t\t\t\t\t&& item.permissionCode === permissionCode\n\t\t\t\t\t&& Type.isUndefined(item.stageCode),\n\t\t\t);\n\n\t\t\tif (hasSelectedPermission)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttoChange.push({\n\t\t\t\tentityCode,\n\t\t\t\tpermissionCode,\n\t\t\t\tvalue,\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction appendDefaultTransitionPermissionsToChange(state, toChange): void\n{\n\tconst transitionPermissionCode = 'TRANSITION';\n\tfor (const [entityCode, permission] of Object.entries(state.transitions))\n\t{\n\t\tif (!Object.hasOwn(permission, ['-']))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasSelectedPermission = toChange.find(\n\t\t\t(item) => item.entityCode === entityCode\n\t\t\t\t&& item.permissionCode === transitionPermissionCode\n\t\t\t\t&& Type.isUndefined(item.stageCode),\n\t\t);\n\n\t\tif (hasSelectedPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttoChange.push({\n\t\t\tentityCode,\n\t\t\tpermissionCode: transitionPermissionCode,\n\t\t\tsettings: permission['-'],\n\t\t});\n\t}\n}\n","/* eslint no-param-reassign: off */\nimport { AppData } from '../app';\nimport { AssignAttributeParam, AssignTransitionValues, PermissionEntityIdentifier } from '../store';\nimport { entityHash, hashIdentifier } from '../utils';\nimport { Type } from 'main.core';\n\nexport default {\n\tsetInitData(state, data: AppData) {\n\t\tstate.roleAssignedPermissions = data.roleAssignedPermissions;\n\t\tstate.desk.permissionEntities = data.permissionEntities;\n\t\tstate.restriction.hasPermission = data.restriction.hasPermission;\n\t\tstate.restriction.restrictionScript = data.restriction.restrictionScript;\n\t\tstate.transitions = data.roleAssignedSettings;\n\n\t\tconst availablePermissionsOrders = {};\n\t\tconst availablePermissions = data.availablePermissions.map(item => {\n\t\t\tconst sortOrder = parseInt(item.sortOrder, 10);\n\t\t\tavailablePermissionsOrders[item.code] = sortOrder;\n\n\t\t\treturn {\n\t\t\t\t...item,\n\t\t\t\tsortOrder,\n\t\t\t};\n\t\t});\n\n\t\tstate.desk.availablePermissionsOrders = availablePermissionsOrders;\n\t\tstate.desk.availablePermissions = availablePermissions;\n\n\t\tstate.role.id = parseInt(data.role.id, 10);\n\t\tstate.role.name = data.role.name;\n\n\t\tstate.touched.originalAttributes = structuredClone(data.roleAssignedPermissions);\n\t\tstate.touched.originalTransitions = structuredClone(data.roleAssignedSettings);\n\t},\n\n\tassignPermissionAttribute(state, payload: AssignAttributeParam) {\n\t\tsetAssignedAttributes(state.roleAssignedPermissions, payload.identifier, payload.value);\n\t\tthis.commit('setAttributeTouched', { identifier: payload.identifier, value: payload.value });\n\t},\n\n\tassignTransitions(state, payload: AssignTransitionValues) {\n\t\tsetAssignedTransitions(state.transitions, payload.identifier, payload.values);\n\t\tthis.commit('setTransitionsTouched', { identifier: payload.identifier, values: payload.values });\n\t},\n\n\tsetAttributeTouched(state, payload: AssignAttributeParam) {\n\t\tconst permissionCode = payload.identifier.permissionCode;\n\t\tconst entityCode = payload.identifier.entityCode;\n\t\tconst stageField = payload.identifier.stageField;\n\t\tconst stageCode = payload.identifier.stageCode;\n\n\t\tconst value = payload.value;\n\t\tlet original = '';\n\t\tif (stageField)\n\t\t{\n\t\t\toriginal = state.touched.originalAttributes?.[entityCode]?.[permissionCode]?.[stageField]?.[stageCode];\n\t\t}\n\t\telse\n\t\t{\n\t\t\toriginal = state.touched.originalAttributes?.[entityCode]?.[permissionCode]?.['-'];\n\t\t}\n\n\t\tconst hash = hashIdentifier(payload.identifier);\n\n\t\tif (original === value)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tdelete state.touched.touchedAttributes[hash];\n\t\t\t}\n\t\t\tcatch {}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstate.touched.touchedAttributes[hash] = {\n\t\t\t\tvalue,\n\t\t\t\tidentifier: payload.identifier,\n\t\t\t};\n\t\t}\n\t},\n\n\tsetTransitionsTouched(state, payload: AssignTransitionValues) {\n\t\tconst entityCode = payload.identifier.entityCode;\n\t\tconst stageField = payload.identifier.stageField;\n\t\tconst stageCode = payload.identifier.stageCode;\n\n\t\tconst values = payload.values;\n\t\tlet original = [];\n\t\tif (stageField && stageCode)\n\t\t{\n\t\t\toriginal = state.touched.originalTransitions?.[entityCode]?.[stageField]?.[stageCode];\n\t\t}\n\t\telse\n\t\t{\n\t\t\toriginal = state.touched.originalTransitions?.[entityCode]?.['-'];\n\t\t}\n\n\t\tconst hash = hashIdentifier(payload.identifier);\n\n\t\tif (Type.isArray(original) && isArraysEqual(original, values))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tdelete state.touched.touchedTransitions[hash];\n\t\t\t}\n\t\t\tcatch {}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstate.touched.touchedTransitions[hash] = {\n\t\t\t\tvalues,\n\t\t\t\tidentifier: payload.identifier,\n\t\t\t};\n\t\t}\n\t},\n\n\tresetTouchedAttributes(state) {\n\t\tstate.touched.originalAttributes = JSON.parse(JSON.stringify((state.roleAssignedPermissions)));\n\t\tstate.touched.touchedAttributes = {};\n\t},\n\n\tresetTouchedTransitions(state) {\n\t\tstate.touched.originalTransitions = JSON.parse(JSON.stringify((state.transitions)));\n\t\tstate.touched.touchedTransitions = {};\n\t},\n\n\ttoggleStagesVisibility(state, entity) {\n\t\tconst hash = entityHash(entity);\n\t\tif (state.ui.expandedStageEntities[hash])\n\t\t{\n\t\t\tdelete state.ui.expandedStageEntities[hash];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstate.ui.expandedStageEntities[hash] = true;\n\t\t}\n\t},\n\n\tsetRoleName(state, newName) {\n\t\tstate.role.name = newName;\n\t},\n\n\tsetSaveInProgress(state, value: boolean) {\n\t\tstate.ui.isSaveInProgress = value;\n\t},\n\n\tsetLastErrorMessage(state, message): string {\n\t\tstate.ui.lastErrorMessage = message;\n\t},\n};\n\nfunction setAssignedAttributes(obj, identifier: PermissionEntityIdentifier, value)\n{\n\tconst permissionCode = identifier.permissionCode;\n\tconst entityCode = identifier.entityCode;\n\tconst stageField = identifier.stageField;\n\tconst stageCode = identifier.stageCode;\n\n\tif (!obj[entityCode])\n\t{\n\t\tobj[entityCode] = {};\n\t}\n\n\tif (!obj[entityCode][permissionCode])\n\t{\n\t\tobj[entityCode][permissionCode] = {};\n\t}\n\n\tif (stageField)\n\t{\n\t\tif (!obj[entityCode][permissionCode][stageField])\n\t\t{\n\t\t\tobj[entityCode][permissionCode][stageField] = {};\n\t\t}\n\n\t\tobj[entityCode][permissionCode][stageField][stageCode] = value;\n\n\t\treturn;\n\t}\n\n\tif (value === '')\n\t{\n\t\tdelete obj[entityCode][permissionCode]['-'];\n\t}\n\telse\n\t{\n\t\tobj[entityCode][permissionCode]['-'] = value;\n\t}\n\n\tclearEmptyNodes(obj);\n}\n\nfunction clearEmptyNodes(node, nodeName, parent)\n{\n\tif (!Type.isObject(node))\n\t{\n\t\treturn;\n\t}\n\n\tfor (const [childName, childNode] of Object.entries(node))\n\t{\n\t\tif (isObjectEmpty(childNode))\n\t\t{\n\t\t\tdelete node[childName];\n\t\t\tcontinue;\n\t\t}\n\n\t\tclearEmptyNodes(childNode, childName, node);\n\t}\n\n\tif (parent && isObjectEmpty(node))\n\t{\n\t\tdelete parent[nodeName];\n\t}\n}\n\nfunction isObjectEmpty(obj): boolean\n{\n\tif (!obj)\n\t{\n\t\treturn true;\n\t}\n\n\treturn Object.keys(obj).length === 0;\n}\n\nfunction setAssignedTransitions(obj, identifier: PermissionEntityIdentifier, values)\n{\n\tconst entityCode = identifier.entityCode;\n\tconst stageField = identifier.stageField;\n\tconst stageCode = identifier.stageCode;\n\n\tif (!obj[entityCode])\n\t{\n\t\tobj[entityCode] = {};\n\t}\n\n\tif (stageField && stageCode)\n\t{\n\t\tif (!obj[entityCode][stageField])\n\t\t{\n\t\t\tobj[entityCode][stageField] = {};\n\t\t}\n\n\t\tobj[entityCode][stageField][stageCode] = values;\n\n\t\treturn;\n\t}\n\n\tif (values === '')\n\t{\n\t\tdelete obj[entityCode]['-'];\n\t}\n\telse\n\t{\n\t\tobj[entityCode]['-'] = values;\n\t}\n\n\tclearEmptyNodes(obj);\n}\n\nfunction isArraysEqual(first: Array, second: Array): boolean\n{\n\treturn first.sort().toString() === second.sort().toString();\n}\n","export default {\n\tasync saveRolePermission({ commit, getters }, action: string) {\n\t\tif (getters.setSaveInProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tcommit('setSaveInProgress', true);\n\t\tcommit('setLastErrorMessage', '');\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await BX.ajax.runComponentAction(\n\t\t\t\t'bitrix:crm.config.perms.role.edit.v2',\n\t\t\t\t'save',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tvalues: getters.getSaveData,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst redirectUrl = response?.data?.redirectUrl;\n\t\t\tconst roleUrl = response?.data?.roleUrl;\n\n\t\t\tif (action === 'save' && redirectUrl)\n\t\t\t{\n\t\t\t\twindow.location.href = redirectUrl;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (action === 'apply' && roleUrl && getters.getRoleId === 0)\n\t\t\t{\n\t\t\t\twindow.location.href = roleUrl;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommit('resetTouchedAttributes');\n\t\t\tcommit('resetTouchedTransitions');\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconst errMessage = err?.data?.message;\n\t\t\tcommit('setLastErrorMessage', errMessage);\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tcommit('setSaveInProgress', false);\n\t\t}\n\t},\n\n\tasync deleteRole({ commit, getters}){\n\t\tif (getters.setSaveInProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst roleId = getters.getRoleId;\n\n\t\tif (!roleId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcommit('setSaveInProgress', true);\n\t\tcommit('setLastErrorMessage', '');\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await BX.ajax.runComponentAction(\n\t\t\t\t'bitrix:crm.config.perms.role.edit.v2',\n\t\t\t\t'delete',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tvalues: { roleId },\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tlet redirectUrl = response?.data?.redirectUrl;\n\n\t\t\tif (!redirectUrl)\n\t\t\t{\n\t\t\t\tredirectUrl = '/';\n\t\t\t}\n\n\t\t\twindow.location.href = redirectUrl;\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconst errMessage = err?.data?.message;\n\t\t\tcommit('setLastErrorMessage', errMessage);\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tcommit('setSaveInProgress', false);\n\t\t}\n\t}\n};\n","import getters from './store/getters';\nimport mutations from './store/mutations';\nimport actions from './store/actions';\n\nexport const MAX_SORT_ORDER_ON_THE_DESK = 7;\n\nexport interface PermissionEntityIdentifier {\n\tpermissionCode: string;\n\tentityCode: string;\n\tstageField: ?string;\n\tstageCode: ?string;\n}\n\nexport interface AssignAttributeParam {\n\tidentifier: PermissionEntityIdentifier,\n\tvalue: string\n}\n\nexport interface Permissions {\n\tcode: string;\n\tname: string;\n\tsortOrder: number;\n\tcanAssignPermissionToStages: boolean;\n}\n\nexport interface EntitySelectorValue {\n\tid: string,\n\tentityId: string,\n\ttabs: string,\n\ttitle: string,\n}\n\nexport interface AssignTransitionValues {\n\tidentifier: PermissionEntityIdentifier,\n\tvalues: Transitions\n}\n\ninterface Transition {\n\tkey: string,\n}\n\ntype Transitions = Transition[];\n\nfunction initState()\n{\n\treturn {\n\t\tui: {\n\t\t\texpandedStageEntities: {},\n\t\t\tisSaveInProgress: false,\n\t\t\tlastErrorMessage: '',\n\t\t},\n\t\troleAssignedPermissions: {},\n\t\trestriction: {\n\t\t\thasPermission: null,\n\t\t\trestrictionScript: '',\n\t\t},\n\t\trole: {\n\t\t\tid: 0,\n\t\t\tname: '',\n\t\t},\n\t\tdesk: {\n\t\t\tavailablePermissions: [],\n\t\t\tpermissionEntities: [],\n\t\t\tavailablePermissionsOrders: {},\n\t\t},\n\t\ttouched: {\n\t\t\toriginalAttributes: {},\n\t\t\ttouchedAttributes: {},\n\t\t\toriginalTransitions: {},\n\t\t\ttouchedTransitions: {},\n\t\t},\n\t\ttransitions: {},\n\t};\n}\n\nexport default () => {\n\treturn {\n\t\tstate: initState(),\n\t\tgetters,\n\t\tmutations,\n\t\tactions,\n\t};\n};\n","import '../css/permissioncontrol.css';\nimport { Event, Loc } from 'main.core';\nimport { mapGetters } from 'ui.vue3.vuex';\n\nexport const PermissionControl = {\n\tname: 'PermissionControl',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tvaluesMap: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tpermissionIdentifier: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['valueChanged'],\n\tdata() {\n\t\treturn {\n\t\t\tlabel: {\n\t\t\t\tinherit: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_INHERIT'),\n\t\t\t},\n\t\t\tisEditMode: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters(['getAssignedAttribute']),\n\t\tcurrentPermissionName()\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.permissionIdentifier.permissionCode === 'AUTOMATION'\n\t\t\t\t&& this.isReadOnlyMode\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst forcePerm = 'X';\n\n\t\t\t\treturn this.valuesMap[forcePerm];\n\t\t\t}\n\n\t\t\tif (this.isStageControl && this.model === '-')\n\t\t\t{\n\t\t\t\treturn this.getParentName;\n\t\t\t}\n\n\t\t\treturn this.valuesMap[this.value];\n\t\t},\n\t\tisInherited() {\n\t\t\treturn this.isStageControl && this.model === '-';\n\t\t},\n\t\tmodel: {\n\t\t\tget() {\n\t\t\t\treturn this.value;\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis.$emit('valueChanged', { identifier: this.permissionIdentifier, value });\n\t\t\t},\n\t\t},\n\t\tisStageControl() {\n\t\t\treturn Boolean(this.permissionIdentifier.stageField);\n\t\t},\n\t\tgetParentName() {\n\t\t\tconst parentChose = this.getAssignedAttribute({\n\t\t\t\tpermissionCode: this.permissionIdentifier.permissionCode,\n\t\t\t\tentityCode: this.permissionIdentifier.entityCode,\n\t\t\t}) || '';\n\n\t\t\treturn this.valuesMap[parentChose];\n\t\t},\n\t\tisReadOnlyMode(): boolean {\n\t\t\tif (this.permissionIdentifier.permissionCode === 'AUTOMATION')\n\t\t\t{\n\t\t\t\treturn this.getAssignedAttribute({ permissionCode: 'WRITE', entityCode: 'CONFIG' }) === 'X';\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\tmethods: {\n\t\ttoEditMode(e) {\n\t\t\te.stopPropagation();\n\t\t\tif (this.isReadOnlyMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isEditMode = true;\n\t\t\tEvent.bind(window, 'click', this.windowClickListener);\n\t\t},\n\t\twindowClickListener(event) {\n\t\t\tif (\n\t\t\t\tevent.target !== this.$refs.componentRef\n\t\t\t\t&& !event.composedPath().includes(this.$refs.componentRef)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.isEditMode = false;\n\t\t\t\tEvent.unbind(window, 'click', this.windowClickListener);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-crm-perms-edit-permission_control\"\n\t\t\tref=\"componentRef\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"bx-crm-perms-edit-permission_control-text\"\n\t\t\t\t:class=\"{'--readonly': isReadOnlyMode, '--inherited': isInherited}\"\n\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t\t@click=\"toEditMode\"\n\t\t\t>{{ currentPermissionName }}</div>\n\t\t\t<select \n\t\t\t\tv-model=\"model\" \n\t\t\t\tv-if=\"isEditMode\" \n\t\t\t\tclass=\"bx-crm-perms-edit-permission_control-select\"\n\t\t\t>\n\t\t\t\t<option \n\t\t\t\t\tclass=\"bx-crm-perms-edit-permission_control-select-option__grey\" \n\t\t\t\t\tv-if=\"isStageControl\" \n\t\t\t\t\tvalue=\"-\"\n\t\t\t\t>{{ label.inherit }}</option>\n\t\t\t\t<option v-for=\"val in Object.keys(valuesMap)\" :value=\"val\">\n\t\t\t\t\t{{ valuesMap[val] }}\n\t\t\t\t</option>\n\t\t\t</select>\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport '../css/expandcontrol.css';\n\nexport const ExpandControl = {\n\tname: 'ExpandControl',\n\tprops: {\n\t\tentity: Object,\n\t\tisExpanded: Boolean,\n\t},\n\temits: ['toggle'],\n\tmethods: {\n\t\ttoggleState() {\n\t\t\tthis.$emit('toggle');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"{'--expanded': isExpanded}\"\n\t\t\tclass=\"bx-crm-perms-edit-expand_control\"\n\t\t\t@click=\"toggleState\">\n\t\t</div>\n\t`,\n};\n","import '../css/entitycontrol.css';\nimport 'ui.design-tokens';\nimport { Event, Loc, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { TagSelector } from 'ui.entity-selector';\nimport { EntitySelectorValue } from '../store';\n\nconst ANY_VALUE = 'ANY';\nconst BLOCKED_VALUE = 'BLOCKED';\nconst INHERIT_VALUE = 'INHERIT';\nexport const EntityControl = {\n\tname: 'EntityControl',\n\tentitySelector: null,\n\tprops: {\n\t\tvalues: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tvaluesMap: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tpermissionIdentifier: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['onTransitionValuesChanged'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlabel: {\n\t\t\t\tany: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_ANY'),\n\t\t\t\tblocked: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_BLOCKED'),\n\t\t\t\tinherit: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_INHERIT'),\n\t\t\t\tstages: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_STAGES'),\n\t\t\t},\n\t\t\tisEditMode: false,\n\t\t\tvaluesData: this.values,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisStageControl(): boolean\n\t\t{\n\t\t\treturn Boolean(this.permissionIdentifier.stageField);\n\t\t},\n\t\tisInherited(): void\n\t\t{\n\t\t\treturn this.isStageControl && this.currentValues.some((el): boolean => el.id === INHERIT_VALUE);\n\t\t},\n\t\tcurrentValues: {\n\t\t\tget(): Array | any\n\t\t\t{\n\t\t\t\tif (!Type.isArray(this.valuesData))\n\t\t\t\t{\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\treturn this.availableValues.filter((el) => {\n\t\t\t\t\treturn this.valuesData.includes(el.id);\n\t\t\t\t});\n\t\t\t},\n\t\t\tset(values: Array): void\n\t\t\t{\n\t\t\t\tthis.valuesData = values.map((list) => list.id);\n\t\t\t\tthis.$emit(\n\t\t\t\t\t'onTransitionValuesChanged',\n\t\t\t\t\t{ identifier: this.permissionIdentifier, values: this.valuesData },\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\tavailableValues(): EntitySelectorValue[]\n\t\t{\n\t\t\tconst availableValues = [];\n\t\t\tfor (const [key: string, value: string] of Object.entries(this.valuesMap))\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t(key === INHERIT_VALUE\n\t\t\t\t\t\t&& Type.isUndefined(this.permissionIdentifier.stageField)\n\t\t\t\t\t\t&& Type.isUndefined(this.permissionIdentifier.stageCode))\n\t\t\t\t\t|| key === this.permissionIdentifier.stageCode\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tavailableValues.push({\n\t\t\t\t\tid: key,\n\t\t\t\t\tentityId: 'stages',\n\t\t\t\t\ttabs: 'stages_tab',\n\t\t\t\t\ttitle: value,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn availableValues;\n\t\t},\n\t},\n\tmethods: {\n\t\ttoEditMode(): void\n\t\t{\n\t\t\tthis.isEditMode = true;\n\t\t},\n\t\tonHideDialogEvent(): void\n\t\t{\n\t\t\tif (this.entitySelector.getTags().length === 0)\n\t\t\t{\n\t\t\t\tconst tag = {\n\t\t\t\t\tid: ANY_VALUE,\n\t\t\t\t\tentityId: 'stages',\n\t\t\t\t\ttabs: 'stages_tab',\n\t\t\t\t\ttitle: this.label.any,\n\t\t\t\t};\n\n\t\t\t\tif (this.isStageControl)\n\t\t\t\t{\n\t\t\t\t\ttag.id = INHERIT_VALUE;\n\t\t\t\t\ttag.title = this.label.inherit;\n\t\t\t\t}\n\n\t\t\t\tthis.entitySelector.addTag(tag);\n\t\t\t}\n\t\t\tthis.currentValues = this.entitySelector.getTags();\n\t\t\tthis.isEditMode = this.entitySelector.getDialog().isOpen();\n\t\t},\n\t\treadOnlyLabels(): string\n\t\t{\n\t\t\treturn this.currentValues.map((list) => list.title).join(', ');\n\t\t},\n\t\tclickSomewhere(): void\n\t\t{\n\t\t\tif (this.isEditMode && !this.entitySelector.getDialog().isOpen())\n\t\t\t{\n\t\t\t\tthis.isEditMode = false;\n\t\t\t\tthis.onHideDialogEvent();\n\t\t\t}\n\t\t},\n\t\tgetDialogOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tmultiple: true,\n\t\t\t\titems: this.availableValues,\n\t\t\t\tselectedItems: this.currentValues,\n\t\t\t\tdropdownMode: false,\n\t\t\t\theight: 300,\n\t\t\t\tshowAvatars: false,\n\t\t\t\ttabs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'stages_tab',\n\t\t\t\t\t\ttitle: this.label.stages,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tvisible: false,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonHide: this.onHideDialogEvent,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tselectorOnBeforeTagAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst selector = event.getTarget();\n\t\t\tconst { tag } = event.getData();\n\t\t\tconst singleValues: Set<string> = new Set([ANY_VALUE, INHERIT_VALUE, BLOCKED_VALUE]);\n\t\t\tif (singleValues.has(tag.getId()))\n\t\t\t{\n\t\t\t\tselector.removeTags();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tselector.getTags().forEach((item) => {\n\t\t\t\t\tif (singleValues.has(item.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tselector.removeTag(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.entitySelector = new TagSelector({\n\t\t\tevents: {\n\t\t\t\tonBeforeTagAdd: this.selectorOnBeforeTagAdd,\n\t\t\t\tonAfterTagRemove: this.onHideDialogEvent,\n\t\t\t},\n\t\t\tdialogOptions: this.getDialogOptions(),\n\t\t});\n\t\tthis.entitySelector.renderTo(this.$refs.entitySelectorRef);\n\t},\n\tcreated(): void\n\t{\n\t\tEvent.bind(window, 'click', this.clickSomewhere);\n\t},\n\tdestroyed(): void\n\t{\n\t\tEvent.unbind(window, 'click', this.clickSomewhere);\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-crm-perms-edit-entity_control\">\n\t\t\t<div\n\t\t\t\tclass=\"bx-crm-perms-edit-entity_control-text\"\n\t\t\t\t:class=\"{'--inherited': isInherited}\"\n\t\t\t\tdata-role=\"crm-type-relation-parent-selected-values\"\n\t\t\t\t@click.stop=\"toEditMode\"\n\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t>{{ readOnlyLabels() }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tref=\"entitySelectorRef\"\n\t\t\t\tdata-role=\"crm-type-relation-parent-entity-selector\"\n\t\t\t\tv-show=\"isEditMode\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { mapGetters, mapMutations } from 'ui.vue3.vuex';\nimport { ExpandControl } from '../components/expandcontrol';\nimport { PermissionControl } from '../components/permissioncontrol';\nimport { EntityControl } from '../components/entitycontrol';\nimport { PermissionEntityIdentifier } from '../store';\n\nexport const SliderPermissions = {\n\tname: 'SliderPermissions',\n\tprops: {\n\t\tentityCode: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t},\n\tcomponents: {\n\t\tExpandControl,\n\t\tPermissionControl,\n\t\tEntityControl,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tui: {\n\t\t\t\tstageVisibilityCodes: {},\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters(['getEntitiesGroupedByPermission', 'getAssignedAttribute', 'getTransitionSettings']),\n\t\tpermissions() {\n\t\t\treturn this.getEntitiesGroupedByPermission(this.entityCode);\n\t\t},\n\t\tdisplayList() {\n\t\t\treturn this.permissions.filter((perm) => {\n\t\t\t\tif (!perm.stageField)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn this.ui.stageVisibilityCodes[perm.code];\n\t\t\t});\n\t\t},\n\t\tisShowExpandControl: () => (perm) => {\n\n\t\t\tif (perm.stageField)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!perm.isEntityStageSupport)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!perm.isPermissionStageSupport)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tgetName: () => (perm) => {\n\t\t\tif (!perm.stageField)\n\t\t\t{\n\t\t\t\treturn perm.name;\n\t\t\t}\n\n\t\t\treturn perm.stateName;\n\t\t},\n\t\tidentifier(perm) {\n\t\t\treturn this.getIdentifier(perm.code, perm.stageField, perm.stageCode);\n\t\t},\n\t},\n\tmounted() {},\n\tmethods: {\n\t\t...mapMutations(['assignPermissionAttribute', 'assignTransitions']),\n\t\tonToggleStageVisibility(code) {\n\t\t\tif (this.ui.stageVisibilityCodes[code])\n\t\t\t{\n\t\t\t\tdelete this.ui.stageVisibilityCodes[code];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.ui.stageVisibilityCodes[code] = true;\n\t\t\t}\n\t\t},\n\t\tisExpanded(code) {\n\t\t\treturn this.ui.stageVisibilityCodes[code] || false;\n\t\t},\n\t\tisRowStageRow(perm) {\n\t\t\treturn Boolean(perm.stageField);\n\t\t},\n\t\tgetAttributeValue(identifier: PermissionEntityIdentifier) {\n\t\t\treturn this.getAssignedAttribute(identifier) || '';\n\t\t},\n\t\tonAttributeValueChanged(payload) {\n\t\t\tthis.assignPermissionAttribute({ identifier: payload.identifier, value: payload.value });\n\t\t},\n\t\tgetIdentifier(permissionCode, stageField, stageCode): PermissionEntityIdentifier {\n\t\t\treturn {\n\t\t\t\tpermissionCode,\n\t\t\t\tentityCode: this.entityCode,\n\t\t\t\tstageField,\n\t\t\t\tstageCode,\n\t\t\t};\n\t\t},\n\t\tonTransitionValuesChanged(payload) {\n\t\t\tthis.assignTransitions({ identifier: payload.identifier, values: payload.values });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-crm-perms-edit-entity-permissions\">\n\t\t\t<div\n\t\t\t\tv-for=\"perm of displayList\"\n\t\t\t\tclass=\"bx-crm-perms-edit-entity-permissions-item\"\n\t\t\t\t:data-permission-code=\"perm.code\"\n\t\t\t\t:class=\"{'stage-item': isRowStageRow(perm)}\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-crm-perms-edit-entity-permissions-item__column\">\n\t\t\t\t\t<ExpandControl \n\t\t\t\t\t\tv-if=\"isShowExpandControl(perm)\"\n\t\t\t\t\t\t:is-expanded=\"isExpanded(perm.code)\"\n\t\t\t\t\t\t@toggle=\"onToggleStageVisibility(perm.code)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span :class=\"{'small-label': isRowStageRow(perm)}\">\n\t\t\t\t\t\t{{ getName(perm) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-crm-perms-edit-entity-permissions-item__column\">\n\t\t\t\t\t<PermissionControl\n\t\t\t\t\t\t:value=\"getAttributeValue(getIdentifier(perm.code, perm.stageField, perm.stageCode))\"\n\t\t\t\t\t\t:values-map=\"perm.values\"\n\t\t\t\t\t\t:permission-identifier=\"getIdentifier(perm.code, perm.stageField, perm.stageCode)\"\n\t\t\t\t\t\t@value-changed=\"onAttributeValueChanged\"\n\t\t\t\t\t\tv-if=\"perm.code !== 'TRANSITION'\"\n\t\t\t\t\t/>\n\t\t\t\t\t<EntityControl\n\t\t\t\t\t\tv-if=\"perm.code === 'TRANSITION'\"\n\t\t\t\t\t\t:values=\"getTransitionSettings(getIdentifier(perm.code, perm.stageField, perm.stageCode))\"\n\t\t\t\t\t\t@onTransitionValuesChanged=\"onTransitionValuesChanged\"\n\t\t\t\t\t\t:values-map=\"perm.values\"\n\t\t\t\t\t\t:permission-identifier=\"getIdentifier(perm.code, perm.stageField, perm.stageCode)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport './../css/slider.css';\nimport { Loc } from 'main.core';\nimport { Button } from 'ui.buttons';\nimport { SidePanel } from 'ui.sidepanel';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { BitrixVue } from 'ui.vue3';\nimport { mapGetters, mapMutations } from 'ui.vue3.vuex';\nimport { SliderPermissions } from './slider-permissions';\n\nexport class SliderManager\n{\n\t#url;\n\n\t#containerId;\n\n\t#sliderApplication;\n\n\tconstructor(entityCode, storage)\n\t{\n\t\tconst rnd = Math.round(Math.random() * 10000);\n\n\t\tthis.#url = `bx-crm-perms-role-edit-slider__${Date.now()}`;\n\t\tthis.#containerId = `bx-crm-perms-role-edit-slider-container__${Date.now()}__${rnd}`;\n\t\tthis.#sliderApplication = this.#createApplication(entityCode);\n\t\tthis.#sliderApplication.use(storage);\n\t}\n\n\tasync open() {\n\t\tSidePanel.Instance.open(this.#url, await this.#getOptions());\n\t}\n\n\tclose() {}\n\n\tasync #getOptions() {\n\t\tconst buttons = [\n\t\t\tnew Button({\n\t\t\t\ttext: Loc.getMessage('UI_BUTTONS_CLOSE_BTN_TEXT'),\n\t\t\t\tsize: Button.Size.MEDIUM,\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\tdependOnTheme: false,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#closeApplication();\n\t\t\t\t\tSidePanel.Instance.close();\n\t\t\t\t},\n\t\t\t}),\n\t\t];\n\n\t\tconst layout = await Layout.createLayout({\n\t\t\ttitle: '',\n\t\t\tcontent: () => `<div id=\"${this.#containerId}\"></div>`,\n\t\t\tbuttons: () => buttons,\n\t\t\tdesign: { section: false },\n\t\t});\n\n\t\treturn {\n\t\t\tcontentClassName: '',\n\t\t\tallowChangeTitle: false,\n\t\t\twidth: 800,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\tlabel: '',\n\t\t\tcontentCallback: (slider) => {\n\t\t\t\treturn layout.render();\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonOpenComplete: () => {\n\t\t\t\t\tconst rootNode = document.getElementById(this.#containerId);\n\t\t\t\t\tthis.#sliderApplication.mount(rootNode);\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.#closeApplication();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t#closeApplication() {\n\t\tif (this.#sliderApplication)\n\t\t{\n\t\t\tthis.#sliderApplication.unmount();\n\t\t\tthis.#sliderApplication = null;\n\t\t}\n\t}\n\n\t#createApplication(entityCode) {\n\t\treturn BitrixVue.createApp({\n\t\t\tname: 'CrmConfigPermsRoleEditSlider',\n\t\t\tcomponents: {\n\t\t\t\tSliderPermissions,\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tentityCode: {\n\t\t\t\t\trequired: true,\n\t\t\t\t\ttype: String,\n\t\t\t\t},\n\t\t\t},\n\t\t\tcomputed: {\n\t\t\t\t...mapGetters(['permissionEntities', 'getMainPermissionEntityByCode']),\n\t\t\t\tentity() {\n\t\t\t\t\treturn this.getMainPermissionEntityByCode(this.entityCode);\n\t\t\t\t},\n\t\t\t\tentityName() {\n\t\t\t\t\treturn this?.entity?.name || '';\n\t\t\t\t},\n\t\t\t},\n\t\t\tmethods: {\n\t\t\t\t...mapMutations(['assignPermissionAttribute']),\n\t\t\t},\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"bx-crm-perms-edit-slider\">\n\t\t\t\t\t<h1>{{ entityName }}</h1>\n\t\t\t\t\t<SliderPermissions\n\t\t\t\t\t\t:entity-code=\"entityCode\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t}, { entityCode });\n\t}\n\n\tstatic create(entity, storage) {\n\t\treturn new SliderManager(entity, storage);\n\t}\n}\n","import { Loc } from 'main.core';\nimport { mapGetters, mapMutations } from 'ui.vue3.vuex';\nimport { SliderManager } from '../slider/slider-manager';\nimport { MAX_SORT_ORDER_ON_THE_DESK, PermissionEntityIdentifier, Permissions } from '../store';\nimport { PermissionControl } from './permissioncontrol';\nimport { ExpandControl } from './expandcontrol';\n\nexport default {\n\tname: 'Row',\n\tprops: {\n\t\tentity: Object,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlabels: {\n\t\t\t\tmoreName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_MORE'),\n\t\t\t},\n\t\t\tmaxOrder: 0,\n\t\t};\n\t},\n\tcomponents: {\n\t\tPermissionControl,\n\t\tExpandControl,\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'availablePermissions',\n\t\t\t'isStageEntitiesVisible',\n\t\t\t'getAssignedAttribute',\n\t\t\t'permissionsOnMainView',\n\t\t\t'groupEntityPermission',\n\t\t\t'getAvailablePermissionsOrders',\n\t\t]),\n\t\tisExpandedStages() {\n\t\t\treturn this.isStageEntitiesVisible(this.entity);\n\t\t},\n\t\tisShowMore(): boolean {\n\t\t\treturn this.maxOrder > MAX_SORT_ORDER_ON_THE_DESK;\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tlet maxOrder = 0;\n\t\tfor (const permCode of Object.keys(this.entity.permissions))\n\t\t{\n\t\t\tmaxOrder = Math.max(maxOrder, this.getAvailablePermissionsOrders[permCode] || 0);\n\t\t}\n\n\t\tthis.maxOrder = maxOrder;\n\t},\n\tmethods: {\n\t\t...mapMutations(['toggleStagesVisibility', 'assignPermissionAttribute', 'setEditMode']),\n\t\texpandChanged() {\n\t\t\tthis.toggleStagesVisibility(this.entity);\n\t\t},\n\t\topenSlider() {\n\n\t\t\tSliderManager.create(this.entity.entityCode, this.$store).open();\n\t\t},\n\t\tattributeValue(permissionCode) {\n\t\t\tconst identifier = this.getIdentifier(permissionCode);\n\n\t\t\treturn this.getAssignedAttribute(identifier) || '';\n\t\t},\n\t\tonAttributeValueChanged(payload) {\n\t\t\tthis.assignPermissionAttribute({ identifier: payload.identifier, value: payload.value });\n\t\t},\n\t\tgetIdentifier(permissionCode): PermissionEntityIdentifier {\n\t\t\treturn {\n\t\t\t\tpermissionCode,\n\t\t\t\tentityCode: this.entity.entityCode,\n\t\t\t\tstageField: this.entity.stageField,\n\t\t\t\tstageCode: this.entity.stageCode,\n\t\t\t};\n\t\t},\n\t\tisShowControl(perm: Permissions): boolean {\n\t\t\tif (!this.entity.permissions[perm.code])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.entity.stageField && perm.canAssignPermissionToStages === false)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<tr \n\t\t\tclass=\"bx-crm-perms-desk-row bx-crm-perms-edit-desk__body\"\n\t\t>\n\t\t\t<td class=\"bx-crm-perms-desk-row-item\">\n\t\t\t\t<ExpandControl \n\t\t\t\t\tv-if=\"entity.hasStages\" \n\t\t\t\t\t:is-expanded=\"isExpandedStages\" \n\t\t\t\t\t@toggle=\"expandChanged\" \n\t\t\t\t/> \n\t\t\t\t<span :class=\"{'stage-row': !!entity.stageField}\">{{ entity.name }}</span>\n\t\t\t</td>\n\t\t\t<td\n\t\t\t\tv-for=\"perm of permissionsOnMainView\"\n\t\t\t\tclass=\"bx-crm-perms-desk-row-item\"\n\t\t\t\t:data-permission-code=\"perm.code\"\n\t\t\t\t:data-permission-entity=\"entity.entityCode\"\n\t\t\t\t:data-permission-attr-field=\"entity.stageField\"\n\t\t\t\t:data-permission-attr-value=\"entity.stageCode\"\n\t\t\t>\n\t\t\t\t<PermissionControl\n\t\t\t\t\tv-if=\"isShowControl(perm)\"\n\t\t\t\t\t:value=\"attributeValue(perm.code)\"\n\t\t\t\t\t:values-map=\"entity.permissions[perm.code]\"\n\t\t\t\t\t:permission-identifier=\"getIdentifier(perm.code)\"\n\t\t\t\t\t@value-changed=\"onAttributeValueChanged\"\n\t\t\t\t></PermissionControl>\n\t\t\t</td>\n\t\t\t<td \n\t\t\t\tv-if=\"!entity.stageField\"\n\t\t\t\tclass=\"bx-crm-perms-desk-row-item\"\n\t\t\t\tdata-permission-code=\"MORE\"\n\t\t\t\t:data-permission-entity=\"entity.entityCode\"\n\t\t\t>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"isShowMore\"\n\t\t\t\t\tclass=\"bx-crm-perms-edit-permission_control-text bx-crm-perms-desk-row-more\"\n\t\t\t\t\t@click=\"openSlider\"\n\t\t\t\t>\n\t\t\t\t\t{{ labels.moreName }}\n\t\t\t\t</span>\n\t\t\t</td>\n\t\t</tr>\n\t`,\n};\n","import 'ui.design-tokens';\nimport '../css/desk.css';\nimport { Loc } from 'main.core';\nimport { mapGetters, mapMutations } from 'ui.vue3.vuex';\nimport { MAX_SORT_ORDER_ON_THE_DESK } from './../store';\nimport { PermissionControl } from './permissioncontrol';\nimport Row from './row';\n\nexport const Desk = {\n\tname: 'Desk',\n\tcomponents: {\n\t\tPermissionControl,\n\t\tRow,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlabels: {\n\t\t\t\tallowToChangeConfigName: Loc.getMessage('CRM_PERMS_EDIT_ALLOW_TO_CHANGE_CONFIG'),\n\t\t\t\tsaveName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_SAVE'),\n\t\t\t\tapplyName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_APPLY'),\n\t\t\t\troleName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_ROLE'),\n\t\t\t\tnotAllowedByTariff: Loc.getMessage('CRM_PERMS_EDIT_RESTRICTION'),\n\t\t\t\troleDelete: Loc.getMessage('CRM_PERMS_EDIT_ROLE_DELETE'),\n\t\t\t\tadditionalName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_ADDITIONAL'),\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'permissionEntitiesExpanded',\n\t\t\t'permissionsOnMainView',\n\t\t\t'getAssignedAttribute',\n\t\t]),\n\t\tconfigWrite: {\n\t\t\tget() {\n\t\t\t\treturn this.getAssignedAttribute({ permissionCode: 'WRITE', entityCode: 'CONFIG' }) === 'X';\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis.assignPermissionAttribute({\n\t\t\t\t\tvalue: value ? 'X' : '',\n\t\t\t\t\tidentifier: { permissionCode: 'WRITE', entityCode: 'CONFIG' },\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcolumnsCount() {\n\t\t\treturn MAX_SORT_ORDER_ON_THE_DESK + 2;\n\t\t},\n\n\t},\n\tmethods: {\n\t\t...mapMutations(['assignPermissionAttribute']),\n\t\tgetStages(entity) {\n\t\t\treturn entity.fields.STAGE_ID || {};\n\t\t},\n\t},\n\tmounted() {},\n\ttemplate: `\n\t\t<table class=\"bx-crm-perms-edit-desk\">\n\t\t\t<tr class=\"bx-crm-perms-desk-row bx-crm-perms-edit-desk__head\">\n\t\t\t\t<th class=\"bx-crm-perms-desk-row-item\"></th>\n\t\t\t\t<th\n\t\t\t\t\tv-for=\"perm in permissionsOnMainView\"\n\t\t\t\t\t:key=\"perm.code\"\n\t\t\t\t\tclass=\"bx-crm-perms-desk-row-item\"\n\t\t\t\t>\n\t\t\t\t\t{{ perm.name }}\n\t\t\t\t</th>\n\t\t\t\t<th class=\"bx-crm-perms-desk-row-item\">\n\t\t\t\t\t{{ labels.additionalName }}\n\t\t\t\t</th>\n\t\t\t</tr>\n\n\t\t\t<Row v-for=\"permissionEntity of permissionEntitiesExpanded\" :entity=\"permissionEntity\" />\n\t\t\t\n\t\t\t<tr class=\"bx-crm-perms-desk-row bx-crm-perms-edit-desk__footer\">\n\t\t\t\t<td class=\"bx-crm-perms-desk-row-item\" :colspan=\"columnsCount\">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input name=\"WRITE\" type=\"checkbox\" v-model=\"configWrite\">\n\t\t\t\t\t\t{{ labels.allowToChangeConfigName }}\n\t\t\t\t\t</label>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t`,\n};\n","import '../css/loader.css';\nimport { Loader as BXLoader } from 'ui.loader';\n\nexport const Loader = {\n\tname: 'Loader',\n\tmounted() {\n\t\tconst loader = new BXLoader({\n\t\t\ttarget: this.$refs.loaderRef,\n\t\t\ttype: 'BULLET',\n\t\t\tsize: 'XL',\n\t\t});\n\t\tloader.render();\n\t\tloader.show();\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"bx-crm-perms-edit-loader\"></div>\n\t\t\t<div class=\"bx-crm-perms-edit-loader-progress\" ref=\"loaderRef\"></div>\n\t\t</div>\n\t`,\n};\n","import './../css/main.css';\nimport { Loc } from 'main.core';\nimport { mapActions, mapGetters, mapMutations } from 'ui.vue3.vuex';\nimport { Desk } from './desk';\nimport { Loader } from './loader';\n\nexport const Main = {\n\tname: 'Main',\n\tcomponents: {\n\t\tDesk,\n\t\tLoader,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlabels: {\n\t\t\t\tsaveName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_SAVE'),\n\t\t\t\tapplyName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_APPLY'),\n\t\t\t\troleName: Loc.getMessage('CRM_PERMS_EDIT_ENTITIES_ROLE'),\n\t\t\t\tnotAllowedByTariff: Loc.getMessage('CRM_PERMS_EDIT_RESTRICTION'),\n\t\t\t\troleDelete: Loc.getMessage('CRM_PERMS_EDIT_ROLE_DELETE'),\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'hasTariffPermission',\n\t\t\t'getRoleName',\n\t\t\t'getRestrictionScript',\n\t\t\t'getLastErrorMessage',\n\t\t\t'getRoleId',\n\t\t\t'isSaveInProgress',\n\t\t]),\n\t\troleName: {\n\t\t\tget() {\n\t\t\t\treturn this.getRoleName;\n\t\t\t},\n\t\t\tset(val) {\n\t\t\t\tthis.setRoleName(val);\n\t\t\t},\n\t\t},\n\t\tisShowDeleteBtn(): boolean {\n\t\t\treturn this.getRoleId > 0;\n\t\t},\n\t},\n\tmethods: {\n\t\t...mapMutations(['setRoleName']),\n\t\t...mapActions(['saveRolePermission', 'deleteRole']),\n\t\tasync onPressSave() {\n\t\t\tawait this.performSave('save');\n\t\t},\n\t\tasync onPressApply() {\n\t\t\tawait this.performSave('apply');\n\t\t},\n\t\tasync onPressDeleteRole() {\n\t\t\tif (!this.hasTariffPermission)\n\t\t\t{\n\t\t\t\tthis.executeTariffRestrictionScript();\n\t\t\t}\n\n\t\t\tawait this.deleteRole();\n\t\t},\n\t\tasync performSave(action: string) {\n\t\t\tif (!this.hasTariffPermission)\n\t\t\t{\n\t\t\t\tthis.executeTariffRestrictionScript();\n\t\t\t}\n\n\t\t\tawait this.saveRolePermission(action);\n\t\t},\n\t\texecuteTariffRestrictionScript()\n\t\t{\n\t\t\tconst script = this.getRestrictionScript;\n\n\t\t\tif (script)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-eval\n\t\t\t\teval(script);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-crm-perms-main\">\n\t\t\t<Loader v-if=\"isSaveInProgress\"/>\n\t\t\t<p class=\"bx-crm-perms-desk-error\" v-if=\"getLastErrorMessage\">\n\t\t\t\t{{ getLastErrorMessage }}\n\t\t\t</p>\n\t\n\t\t\t<label>\n\t\t\t\t{{ labels.roleName }}:\n\t\t\t\t<input name=\"NAME\" v-model=\"roleName\" class=\"bx-crm-perms-desk-input-role_name\">\n\t\t\t</label>\n\t\n\t\t\t<Desk/>\n\n\t\t\t<div class=\"bx-crm-perms-desk-footer\">\n\t\t\t\t<div class=\"bx-crm-perms-desk-footer-colleft\">\n\t\t\t\t\t<button @click=\"onPressSave\" class=\"bx-crm-perms-desk-btn\" name=\"save\">{{ labels.saveName }}</button>\n\t\t\t\t\t<button @click=\"onPressApply\" class=\"bx-crm-perms-desk-btn\" name=\"apply\">{{ labels.applyName }}</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-crm-perms-desk-footer-colright\">\n\t\t\t\t\t<span \n\t\t\t\t\t\tv-if=\"isShowDeleteBtn\" \n\t\t\t\t\t\tclass=\"bx-crm-perms-desk-delete\"\n\t\t\t\t\t\t@click=\"onPressDeleteRole\"\n\t\t\t\t\t>{{ labels.roleDelete }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tv-if=\"!hasTariffPermission\"\n\t\t\t\tclass=\"ui-alert ui-alert-warning\"\n\t\t\t\tstyle=\"margin: 15px 0 0 0;\"\n\t\t\t>\n\t\t\t\t<span class=\"ui-alert-message\" v-html=\"labels.notAllowedByTariff\"></span>\n\t\t\t</div>\n\n\t\t</div>\n\t`,\n};\n","import { BitrixVue } from 'ui.vue3';\nimport { createStore } from 'ui.vue3.vuex';\nimport { Main } from './components/main';\nimport store from './store';\n\ninterface EditOptions {\n\tcontainerId: string;\n}\n\nexport interface AppData {\n\trole: {\n\t\tid: number;\n\t\tname: string;\n\t},\n\tavailablePermissions: Object;\n\tpermissionEntities: Object;\n\troleAssignedPermissions: Object;\n\trestriction: {\n\t\thasPermission: boolean;\n\t\trestrictionScript: ?string;\n\t};\n\troleAssignedSettings: Object;\n}\n\nexport class EditApp\n{\n\t#options: EditOptions;\n\n\t#application = null;\n\n\tconstructor(options: EditOptions)\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tstart(data: AppData) {\n\t\tconst storage = createStore(store());\n\t\tthis.#application = BitrixVue.createApp({\n\t\t\tname: 'CrmConfigPermsRoleEdit',\n\t\t\tcomponents: { Main },\n\t\t\ttemplate: `\n\t\t\t\t<Main/>\n\t\t\t`,\n\t\t});\n\n\t\tstorage.commit('setInitData', data);\n\t\tthis.#application.use(storage);\n\n\t\tconst rootNode = document.getElementById(this.#options.containerId);\n\t\tthis.#application.mount(rootNode);\n\t}\n}\n"],"names":["entityHash","entity","stageField","entityCode","stageCode","hashIdentifier","identifier","hash","permissionCode","btoa","permissionEntities","state","desk","permissionEntitiesExpanded","filter","ui","expandedStageEntities","getMainPermissionEntityByCode","find","item","getEntitiesGroupedByPermission","getters","_step","rootEntity","entities","permissions","permCode","Object","hasOwn","values","permissionConfig","availablePermissions","perm","code","sortOrder","MAX_SORT_ORDER_ON_THE_DESK","push","name","isEntityStageSupport","hasStages","isPermissionStageSupport","canAssignPermissionToStages","stateName","parseInt","keys","_iterator","sort","a","b","getAssignedAttribute","value","roleAssignedPermissions","_state$roleAssignedPe","_state$roleAssignedPe2","_state$roleAssignedPe3","_state$roleAssignedPe4","Type","isUndefined","_state$roleAssignedPe5","_state$roleAssignedPe6","_state$roleAssignedPe7","isStageEntitiesVisible","Boolean","permissionsOnMainView","hasTariffPermission","restriction","hasPermission","getRestrictionScript","restrictionScript","getAvailablePermissionsOrders","availablePermissionsOrders","getSaveData","toRemove","toChange","touched","touchedAttributes","touchedTransitions","settings","length","role","id","appendDefaultAttributesPermissionsToChange","appendDefaultTransitionPermissionsToChange","getRoleName","getRoleId","isSaveInProgress","getLastErrorMessage","lastErrorMessage","setSaveInProgress","getTransitionSettings","transitions","_state$transitions","_state$transitions$en","_state$transitions$en2","_state$transitions2","_state$transitions2$e","forEach","permission","isString","v","entries","setInitData","data","roleAssignedSettings","map","originalAttributes","structuredClone","originalTransitions","assignPermissionAttribute","payload","setAssignedAttributes","this","commit","assignTransitions","setAssignedTransitions","setAttributeTouched","original","_state$touched$origin","_state$touched$origin2","_state$touched$origin3","_state$touched$origin4","_state$touched$origin5","_state$touched$origin6","_state$touched$origin7","setTransitionsTouched","_state$touched$origin8","_state$touched$origin9","_state$touched$origin10","_state$touched$origin11","_state$touched$origin12","isArray","isArraysEqual","resetTouchedAttributes","JSON","parse","stringify","resetTouchedTransitions","toggleStagesVisibility","setRoleName","newName","setLastErrorMessage","message","obj","clearEmptyNodes","node","nodeName","parent","isObject","childName","childNode","isObjectEmpty","first","second","toString","saveRolePermission","action","_context","BX","ajax","runComponentAction","mode","json","response","redirectUrl","_response$data","roleUrl","_response$data2","window","location","href","errMessage","_err$data","deleteRole","_context2","roleId","_response$data3","_err$data2","initState","mutations","actions","PermissionControl","props","type","String","required","valuesMap","permissionIdentifier","emits","label","inherit","Loc","getMessage","isEditMode","computed","mapGetters","currentPermissionName","isReadOnlyMode","isStageControl","model","getParentName","isInherited","get","set","$emit","parentChose","methods","toEditMode","e","stopPropagation","Event","bind","windowClickListener","event","target","$refs","componentRef","composedPath","includes","unbind","template","ExpandControl","isExpanded","toggleState","ANY_VALUE","BLOCKED_VALUE","INHERIT_VALUE","EntityControl","entitySelector","Array","any","blocked","stages","valuesData","currentValues","some","el","availableValues","_this","list","key","entityId","tabs","title","onHideDialogEvent","getTags","tag","addTag","getDialog","isOpen","readOnlyLabels","join","clickSomewhere","getDialogOptions","multiple","items","selectedItems","dropdownMode","height","showAvatars","recentTabOptions","visible","events","onHide","selectorOnBeforeTagAdd","selector","getTarget","getData","singleValues","Set","has","getId","removeTags","removeTag","mounted","TagSelector","onBeforeTagAdd","onAfterTagRemove","dialogOptions","renderTo","entitySelectorRef","created","destroyed","SliderPermissions","components","stageVisibilityCodes","displayList","isShowExpandControl","getName","getIdentifier","mapMutations","onToggleStageVisibility","isRowStageRow","getAttributeValue","onAttributeValueChanged","onTransitionValuesChanged","SliderManager","storage","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","rnd","Math","round","random","Date","now","use","SidePanel","Instance","open","_getOptions3","buttons","Button","text","size","Size","MEDIUM","color","Color","LIGHT_BORDER","dependOnTheme","onclick","_classPrivateMethodGet","close","Layout","createLayout","content","design","section","layout","contentClassName","allowChangeTitle","width","cacheable","allowChangeHistory","contentCallback","slider","render","onOpenComplete","rootNode","document","getElementById","mount","onClose","unmount","BitrixVue","createApp","entityName","_this$entity","labels","moreName","maxOrder","isExpandedStages","isShowMore","max","expandChanged","openSlider","create","$store","attributeValue","isShowControl","Desk","Row","allowToChangeConfigName","saveName","applyName","roleName","notAllowedByTariff","roleDelete","additionalName","configWrite","columnsCount","getStages","fields","STAGE_ID","Loader","loader","BXLoader","loaderRef","show","Main","val","isShowDeleteBtn","mapActions","onPressSave","performSave","onPressApply","_this2","onPressDeleteRole","_this3","executeTariffRestrictionScript","_context3","_this4","_context4","script","eval","EditApp","options","createStore","store","containerId"],"mappings":"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"}