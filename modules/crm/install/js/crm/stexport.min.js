BX.namespace("BX.Crm");if(typeof BX.Crm.StExportManager==="undefined"){BX.Crm.StExportManager=function(){this._id="";this._settings={};this._processDialog=null;this._siteId="";this._entityType="";this._sToken="";this._cToken="";this._token="";this._serviceUrl="";this._initialOptions={}};BX.Crm.StExportManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._siteId=this.getSetting("siteId","");if(!BX.type.isNotEmptyString(this._siteId))throw"BX.Crm.StExportManager: parameter 'siteId' is not found.";this._entityType=this.getSetting("entityType","");if(!BX.type.isNotEmptyString(this._entityType))throw"BX.Crm.StExportManager: parameter 'entityType' is not found.";this._sToken=this.getSetting("sToken","");if(!BX.type.isNotEmptyString(this._sToken))throw"BX.Crm.StExportManager: parameter 'sToken' is not found.";this._serviceUrl="/bitrix/components/bitrix/crm."+this._entityType.toLowerCase()+".list/stexport.ajax.php";this._initialOptions=this.getSetting("initialOptions",{})},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},startExport:function(t){if(!BX.type.isNotEmptyString(t))throw"BX.Crm.StExportManager: parameter 'exportType' has invalid value.";this._cToken="c"+Date.now();this._token=this._sToken+this._cToken;var e={SITE_ID:this._siteId,PROCESS_TOKEN:this._token,ENTITY_TYPE_NAME:this._entityType,EXPORT_TYPE:t,COMPONENT_PARAMS:this.getSetting("componentParams",{})};if(this._entityType==="COMPANY")e["MY_COMPANY_MODE"]=this.getSetting("myCompanyMode",false)===true?"Y":"N";var i=t.charAt(0).toUpperCase()+t.slice(1);this._processDialog=BX.CrmLongRunningProcessDialog.create(this._id+"_LrpDlg",{serviceUrl:this._serviceUrl,action:"STEXPORT",params:e,initialOptions:this._initialOptions,title:this.getMessage("stExport"+i+"DlgTitle"),summary:this.getMessage("stExport"+i+"DlgSummary"),isSummaryHtml:false});this._processDialog.show()},destroy:function(){this._id="";this._settings={};this._processDialog=null;this._siteId="";this._entityType="";this._sToken="";this._cToken="";this._token="";this._serviceUrl="";this._initialOptions={}}};BX.Crm.StExportManager.prototype.getMessage=function(t){var e=t;var i=this.getSetting("messages",null);if(i!==null&&typeof i==="object"&&i.hasOwnProperty(t)){e=i[t]}else{i=BX.Crm.StExportManager.messages;if(i!==null&&typeof i==="object"&&i.hasOwnProperty(t)){e=i[t]}}return e};if(typeof BX.Crm.StExportManager.messages==="undefined"){BX.Crm.StExportManager.messages={}}if(typeof BX.Crm.StExportManager.items==="undefined"){BX.Crm.StExportManager.items={}}BX.Crm.StExportManager.create=function(t,e){var i=new BX.Crm.StExportManager;i.initialize(t,e);BX.Crm.StExportManager.items[t]=i;return i};BX.Crm.StExportManager.delete=function(t){if(BX.Crm.StExportManager.items.hasOwnProperty(t)){BX.Crm.StExportManager.items[t].destroy();delete BX.Crm.StExportManager.items[t]}}}