{"version":3,"file":"category-list.bundle.js","sources":["../src/category-list.js"],"sourcesContent":["import { ajax as Ajax, Reflection } from \"main.core\";\nimport { CategoryModel } from \"crm.category-model\";\n\nlet instance = null;\n\n/**\n * @memberOf BX.Crm\n */\nexport class CategoryList {\n\n\t#items: Object<number, CategoryModel[]> = {};\n\t#isProgress: boolean = false;\n\n\tstatic get Instance(): CategoryList\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.CategoryList'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.CategoryList.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new CategoryList();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tgetItems(entityTypeId: number): Promise<CategoryModel[]>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.#items.hasOwnProperty(entityTypeId))\n\t\t\t{\n\t\t\t\tresolve(this.#items[entityTypeId]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#loadItems(entityTypeId).then((categories) => {\n\t\t\t\tthis.#items[entityTypeId] = categories;\n\t\t\t\tresolve(categories);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.#items[entityTypeId] = [];\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetItems(entityTypeId: number, items: CategoryModel[]): CategoryList\n\t{\n\t\tthis.#items[entityTypeId] = items;\n\n\t\treturn this;\n\t}\n\n\t#loadItems(entityTypeId): Promise<CategoryModel[], string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.#isProgress)\n\t\t\t{\n\t\t\t\treject('CategoryList is already loading');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.#isProgress = true;\n\t\t\tAjax.runAction('crm.category.list', {\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tthis.#isProgress = false;\n\t\t\t\tconst categories = [];\n\t\t\t\tresponse.data.categories.forEach((category) => {\n\t\t\t\t\tcategories.push(new CategoryModel(category));\n\t\t\t\t});\n\t\t\t\tresolve(categories);\n\t\t\t}).catch((response) => {\n\t\t\t\tthis.#isProgress = false;\n\t\t\t\treject(\"CategoryList error: \" + response.errors.map(({message}) => message).join(\"; \"));\n\t\t\t});\n\t\t});\n\t}\n}\n"],"names":["instance","CategoryList","entityTypeId","Promise","resolve","reject","hasOwnProperty","then","categories","error","items","window","top","Reflection","getClass","BX","Crm","Instance","Ajax","runAction","data","response","forEach","category","push","CategoryModel","errors","map","message","join"],"mappings":";;;;;;;;;;;CAGA,IAAIA,QAAQ,GAAG,IAAf;CAEA;CACA;CACA;;;;;;;;AACA,KAAaC,YAAb;GAAA;KAAA;;KAAA;;KAAA;OAAA;OAAA,OAE2C;;;KAF3C;OAAA;OAAA,OAGwB;;;;GAHxB;KAAA;KAAA,yBAoBUC,YApBV,EAqBC;OAAA;;OACC,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;SACvC,IAAI,kCAAA,KAAI,SAAJ,CAAYC,cAAZ,CAA2BJ,YAA3B,CAAJ,EACA;WACCE,OAAO,CAAC,kCAAA,KAAI,SAAJ,CAAYF,YAAZ,CAAD,CAAP;WACA;;;SAGD,uBAAA,KAAI,0BAAJ,MAAA,KAAI,EAAYA,YAAZ,CAAJ,CAA8BK,IAA9B,CAAmC,UAACC,UAAD,EAAgB;WAClD,kCAAA,KAAI,SAAJ,CAAYN,YAAZ,IAA4BM,UAA5B;WACAJ,OAAO,CAACI,UAAD,CAAP;UAFD,WAGS,UAACC,KAAD,EAAW;WACnB,kCAAA,KAAI,SAAJ,CAAYP,YAAZ,IAA4B,EAA5B;WACAG,MAAM,CAACI,KAAD,CAAN;UALD;QAPM,CAAP;;;KAtBF;KAAA,yBAuCUP,YAvCV,EAuCgCQ,KAvChC,EAwCC;OACC,gDAAYR,YAAZ,IAA4BQ,KAA5B;OAEA,OAAO,IAAP;;;KA3CF;KAAA,oBAMC;OACC,IAAKC,MAAM,CAACC,GAAP,KAAeD,MAAhB,IAA2BE,oBAAU,CAACC,QAAX,CAAoB,yBAApB,CAA/B,EACA;SACC,OAAOH,MAAM,CAACC,GAAP,CAAWG,EAAX,CAAcC,GAAd,CAAkBf,YAAlB,CAA+BgB,QAAtC;;;OAGD,IAAIjB,QAAQ,KAAK,IAAjB,EACA;SACCA,QAAQ,GAAG,IAAIC,YAAJ,EAAX;;;OAGD,OAAOD,QAAP;;;GAjBF;CAAA;;sBA8CYE,cACX;GAAA;;GACC,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;KACvC,sCAAI,MAAJ,gBACA;OACCA,MAAM,CAAC,iCAAD,CAAN;OACA;;;KAED,kCAAA,MAAI,eAAe,IAAf,CAAJ;KACAa,cAAI,CAACC,SAAL,CAAe,mBAAf,EAAoC;OACnCC,IAAI,EAAE;SACLlB,YAAY,EAAZA;;MAFF,EAIGK,IAJH,CAIQ,UAACc,QAAD,EAAc;OACrB,kCAAA,MAAI,eAAe,KAAf,CAAJ;OACA,IAAMb,UAAU,GAAG,EAAnB;OACAa,QAAQ,CAACD,IAAT,CAAcZ,UAAd,CAAyBc,OAAzB,CAAiC,UAACC,QAAD,EAAc;SAC9Cf,UAAU,CAACgB,IAAX,CAAgB,IAAIC,+BAAJ,CAAkBF,QAAlB,CAAhB;QADD;OAGAnB,OAAO,CAACI,UAAD,CAAP;MAVD,WAWS,UAACa,QAAD,EAAc;OACtB,kCAAA,MAAI,eAAe,KAAf,CAAJ;OACAhB,MAAM,CAAC,yBAAyBgB,QAAQ,CAACK,MAAT,CAAgBC,GAAhB,CAAoB;SAAA,IAAEC,OAAF,QAAEA,OAAF;SAAA,OAAeA,OAAf;QAApB,EAA4CC,IAA5C,CAAiD,IAAjD,CAA1B,CAAN;MAbD;IAPM,CAAP;CAuBA;;;;;;;;"}