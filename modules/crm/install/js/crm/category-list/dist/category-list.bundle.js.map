{"version":3,"file":"category-list.bundle.js","sources":["../src/category-list.js"],"sourcesContent":["import { ajax as Ajax, Reflection } from \"main.core\";\nimport { CategoryModel } from \"crm.category-model\";\n\nlet instance = null;\n\n/**\n * @memberOf BX.Crm\n */\nexport class CategoryList {\n\n\t#items: Object<number, CategoryModel[]> = {};\n\t#isProgress: boolean = false;\n\n\tstatic get Instance(): CategoryList\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.CategoryList'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.CategoryList.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new CategoryList();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tgetItems(entityTypeId: number): Promise<CategoryModel[]>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.#items.hasOwnProperty(entityTypeId))\n\t\t\t{\n\t\t\t\tresolve(this.#items[entityTypeId]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#loadItems(entityTypeId).then((categories) => {\n\t\t\t\tthis.#items[entityTypeId] = categories;\n\t\t\t\tresolve(categories);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.#items[entityTypeId] = [];\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetItems(entityTypeId: number, items: CategoryModel[]): CategoryList\n\t{\n\t\tthis.#items[entityTypeId] = items;\n\n\t\treturn this;\n\t}\n\n\t#loadItems(entityTypeId): Promise<CategoryModel[], string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.#isProgress)\n\t\t\t{\n\t\t\t\treject('CategoryList is already loading');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.#isProgress = true;\n\t\t\tAjax.runAction('crm.category.list', {\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tthis.#isProgress = false;\n\t\t\t\tconst categories = [];\n\t\t\t\tresponse.data.categories.forEach((category) => {\n\t\t\t\t\tcategories.push(new CategoryModel(category));\n\t\t\t\t});\n\t\t\t\tresolve(categories);\n\t\t\t}).catch((response) => {\n\t\t\t\tthis.#isProgress = false;\n\t\t\t\treject(\"CategoryList error: \" + response.errors.map(({message}) => message).join(\"; \"));\n\t\t\t});\n\t\t});\n\t}\n}\n"],"names":["instance","CategoryList","entityTypeId","Promise","resolve","reject","hasOwnProperty","then","categories","catch","error","items","window","top","Reflection","getClass","BX","Crm","Instance","Ajax","runAction","data","response","forEach","category","push","CategoryModel","errors","map","message","join"],"mappings":";;;;;CAGA,IAAIA,QAAQ,GAAG,IAAf;CAEA;;;;;;;;;;AAGA,KAAaC,YAAb;CAAA;CAAA;;CAAA;;CAAA;CAAA;CAAA,aAE2C;CAF3C;;CAAA;CAAA;CAAA,aAGwB;CAHxB;CAAA;;CAAA;CAAA;CAAA,6BAoBUC,YApBV,EAqBC;CAAA;;CACC,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CACvC,YAAI,kCAAA,KAAI,SAAJ,CAAYC,cAAZ,CAA2BJ,YAA3B,CAAJ,EACA;CACCE,UAAAA,OAAO,CAAC,kCAAA,KAAI,SAAJ,CAAYF,YAAZ,CAAD,CAAP;CACA;CACA;;CAED,+BAAA,KAAI,0BAAJ,MAAA,KAAI,EAAYA,YAAZ,CAAJ,CAA8BK,IAA9B,CAAmC,UAACC,UAAD,EAAgB;CAClD,4CAAA,KAAI,SAAJ,CAAYN,YAAZ,IAA4BM,UAA5B;CACAJ,UAAAA,OAAO,CAACI,UAAD,CAAP;CACA,SAHD,EAGGC,KAHH,CAGS,UAACC,KAAD,EAAW;CACnB,4CAAA,KAAI,SAAJ,CAAYR,YAAZ,IAA4B,EAA5B;CACAG,UAAAA,MAAM,CAACK,KAAD,CAAN;CACA,SAND;CAOA,OAdM,CAAP;CAeA;CArCF;CAAA;CAAA,6BAuCUR,YAvCV,EAuCgCS,KAvChC,EAwCC;CACC,sDAAYT,YAAZ,IAA4BS,KAA5B;CAEA,aAAO,IAAP;CACA;CA5CF;CAAA;CAAA,wBAMC;CACC,UAAKC,MAAM,CAACC,GAAP,KAAeD,MAAhB,IAA2BE,oBAAU,CAACC,QAAX,CAAoB,yBAApB,CAA/B,EACA;CACC,eAAOH,MAAM,CAACC,GAAP,CAAWG,EAAX,CAAcC,GAAd,CAAkBhB,YAAlB,CAA+BiB,QAAtC;CACA;;CAED,UAAIlB,QAAQ,KAAK,IAAjB,EACA;CACCA,QAAAA,QAAQ,GAAG,IAAIC,YAAJ,EAAX;CACA;;CAED,aAAOD,QAAP;CACA;CAlBF;CAAA;CAAA;;wCA8CYE,cACX;CAAA;;CACC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CACvC,0CAAI,MAAJ,gBACA;CACCA,MAAAA,MAAM,CAAC,iCAAD,CAAN;CACA;CACA;;CACD,sCAAA,MAAI,eAAe,IAAf,CAAJ;CACAc,IAAAA,cAAI,CAACC,SAAL,CAAe,mBAAf,EAAoC;CACnCC,MAAAA,IAAI,EAAE;CACLnB,QAAAA,YAAY,EAAZA;CADK;CAD6B,KAApC,EAIGK,IAJH,CAIQ,UAACe,QAAD,EAAc;CACrB,wCAAA,MAAI,eAAe,KAAf,CAAJ;CACA,UAAMd,UAAU,GAAG,EAAnB;CACAc,MAAAA,QAAQ,CAACD,IAAT,CAAcb,UAAd,CAAyBe,OAAzB,CAAiC,UAACC,QAAD,EAAc;CAC9ChB,QAAAA,UAAU,CAACiB,IAAX,CAAgB,IAAIC,+BAAJ,CAAkBF,QAAlB,CAAhB;CACA,OAFD;CAGApB,MAAAA,OAAO,CAACI,UAAD,CAAP;CACA,KAXD,EAWGC,KAXH,CAWS,UAACa,QAAD,EAAc;CACtB,wCAAA,MAAI,eAAe,KAAf,CAAJ;CACAjB,MAAAA,MAAM,CAAC,yBAAyBiB,QAAQ,CAACK,MAAT,CAAgBC,GAAhB,CAAoB;CAAA,YAAEC,OAAF,QAAEA,OAAF;CAAA,eAAeA,OAAf;CAAA,OAApB,EAA4CC,IAA5C,CAAiD,IAAjD,CAA1B,CAAN;CACA,KAdD;CAeA,GAtBM,CAAP;CAuBA;;;;;;;;"}