this.BX=this.BX||{};(function(t,e,i,n,a){"use strict";function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var s=[.5,.7,1,1.2,1.5,1.7,2];var u={props:{playbackRateValues:{type:Array,required:false,default:function t(){return s}},isShowPlaybackRateMenu:{type:Boolean,required:false,default:true},recordName:{type:String,required:false,default:""},mini:{type:Boolean,required:false,default:false},context:{required:false,default:window}},data:function t(){return r(r({},this.parentData()),{},{playbackRate:s[2],isSeeking:true})},computed:{containerClassname:function t(){return["crm-audio-player-container","ui-vue-audioplayer-container",{"ui-vue-audioplayer-container-dark":this.isDark,"ui-vue-audioplayer-container-mobile":this.isMobile,"--mini":this.mini}]},controlClassname:function t(){return["ui-vue-audioplayer-control","ui-btn-icon-start",{"ui-vue-audioplayer-control-loader":this.loading,"ui-vue-audioplayer-control-play":!this.loading&&this.state!==this.State.play,"ui-vue-audioplayer-control-pause":!this.loading&&this.state===this.State.play}]},timeCurrentClassname:function t(){return["ui-vue-audioplayer-time","ui-vue-audioplayer-time-current",{"--is-playing":this.state===this.State.play}]},totalTimeClassname:function t(){return["ui-vue-audioplayer-total-time"]},progressPosition:function t(){return"width: ".concat(this.progressInPixel,"px;")},seekPosition:function t(){var e,i;var n=20;var a=(e=(i=this.$refs.seek)===null||i===void 0?void 0:i.offsetWidth)!==null&&e!==void 0?e:n;return"left: ".concat(this.progressInPixel-a/2,"px;")},formatTimeCurrent:function t(){return this.formatTime(this.timeCurrent)},formatTimeTotal:function t(){return this.formatTime(this.timeTotal)},playbackRateMenuItems:function t(){var e=this;return this.playbackRateValues.map((function(t){return e.createPlaybackRateMenuItem({text:e.getPlaybackRateOptionText(t),rate:t,isActive:t===e.playbackRate})}))}},methods:{changePlaybackRate:function t(e){var i,n;this.playbackRate=e;if((i=this.$refs)!==null&&i!==void 0&&(n=i.source)!==null&&n!==void 0&&n.playbackRate){this.$refs.source.playbackRate=e}},createPlaybackRateMenuItem:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=i.rate||1;var a=i.text||"";var o=i.isActive||false;var r="playback-speed-menu-item ".concat(o?"menu-popup-item-accept-sm":"");return{text:a,className:r,onclick:function t(i,a){e.changePlaybackRate(n);a.menuWindow.popupWindow.close();return true}}},getPlaybackRateOptionText:function t(e){return this.isFloat(e)?"".concat(e,"x"):"".concat(e,".0x")},showPlaybackRateMenu:function t(){var e=this;if(this.menu&&this.menu.getPopupWindow().isShown()){return}this.menu=new this.context.BX.Main.Menu({id:"12xx".concat(this.id),className:"crm-audio-player__playback-speed-menu_scope",width:100,bindElement:this.$refs.playbackRateButtonContainer,events:{onPopupShow:function t(){var i=a.Dom.getPosition(e.$refs.playbackRateButtonContainer),n=i.width;var o=e.menu.getPopupWindow();o.setOffset({offsetLeft:n/2});o.adjustPosition()},onPopupClose:function t(){e.menu.destroy();e.menu=null}},angle:{position:"top"},offsetLeft:0,items:this.playbackRateMenuItems});this.menu.show()},isFloat:function t(e){return e%1!==0},startSeeking:function t(e){this.isSeeking=true;var i=e.clientX;if(this.source()){this.source().pause();a.bind(this.context.document,"mouseup",this.finishSeeking);a.bind(this.context.document,"mousemove",this.seeking);this.setSeekByCursor(i)}},seeking:function t(e){if(!this.isSeeking){return}var i=this.$refs.track;var n=e.clientX;var o=a.Dom.getPosition(i),r=o.left,s=o.right,u=o.width;if(n<r){this.seek=0}else if(n>s){this.seek=u-1}else{this.seek=n-r}this.setPosition();e.preventDefault()},finishSeeking:function t(){this.isSeeking=false;this.setPosition();if(this.source()){this.source().play();a.unbind(this.context.document,"mouseup",this.finishSeeking);a.unbind(this.context.document,"mousemove",this.seeking)}},setSeekByCursor:function t(e){var i=this.$refs.track;var n=event,o=n.clientX;var r=a.Dom.getPosition(i),s=r.left,u=r.right,l=r.width;if(o<s){this.seek=0}else if(e>u){this.seek=l}else{this.seek=o-s}},setPosition:function t(e){if(!this.loaded){this.loadFile(true);return}var i=this.$refs.track.offsetWidth/100;this.setProgress(this.seek/i,this.seek);this.source().currentTime=this.timeTotal/100*this.progress},setProgress:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;if(this.mini){return}this.progress=e;this.progressInPixel=i>0?i:Math.round(this.$refs.track.offsetWidth/100*e)},audioEventRouterWrapper:function t(e,i){this.audioEventRouter(e,i)}},template:'\n\t\t<div\n\t\t\t:class="containerClassname"\n\t\t\tref="body"\n\t\t>\n\t\t\t<div class="ui-vue-audioplayer-controls-container">\n\t\t\t\t<button :class="controlClassname" @click="clickToButton">\n\t\t\t\t\t<svg\n\t\t\t\t\t\tv-if="state !== State.play"\n\t\t\t\t\t\tclass="ui-vue-audioplayer-control-icon"\n\t\t\t\t\t\twidth="9"\n\t\t\t\t\t\theight="12"\n\t\t\t\t\t\tviewBox="0 0 9 12"\n\t\t\t\t\t\tfill="none"\n\t\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M8.52196 5.40967L1.77268 0.637568C1.61355 0.523473 1.40621 0.510554 1.23498 0.604066C1.06375 0.697578 0.957151 0.881946 0.958524 1.0822V10.6259C0.956507 10.8265 1.06301 11.0114 1.23449 11.105C1.40597 11.1987 1.61368 11.1854 1.77268 11.0706L8.52196 6.29847C8.66466 6.19871 8.75016 6.0322 8.75016 5.85407C8.75016 5.67593 8.66466 5.50942 8.52196 5.40967Z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<svg\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tclass="ui-vue-audioplayer-control-icon"\n\t\t\t\t\t\twidth="8"\n\t\t\t\t\t\theight="10"\n\t\t\t\t\t\tviewBox="0 0 8 10"\n\t\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t>\n\t\t\t\t\t\t<rect width="2" height="9" x="0%"></rect>\n\t\t\t\t\t\t<rect width="2" height="9" x="55%"></rect>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="ui-vue-audioplayer-timeline-container">\n\t\t\t\t<div v-if="!mini" class="ui-vue-audioplayer-record-name">{{ recordName }}</div>\n\t\t\t\t<div v-if="!mini" class="ui-vue-audioplayer-track-container" @mousedown="startSeeking" ref="track">\n\t\t\t\t\t<div class="ui-vue-audioplayer-track-mask"></div>\n\t\t\t\t\t<div class="ui-vue-audioplayer-track" :style="progressPosition"></div>\n\t\t\t\t\t<div @mousedown="startSeeking" class="ui-vue-audioplayer-track-seek" :style="seekPosition">\n\t\t\t\t\t\t<div ref="seek" class="ui-vue-audioplayer-track-seek-icon"></div>\n\t\t\t\t\t</div>\n\t\x3c!--\t\t\t\t\t<div class="ui-vue-audioplayer-track-event" @mousemove="seeking"></div>--\x3e\n\t\t\t\t</div>\n\t\t\t\t<div :class="totalTimeClassname">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="(mini && timeCurrent > 0) || !mini"\n\t\t\t\t\t\tref="currentTime"\n\t\t\t\t\t\t:class="timeCurrentClassname"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span style="position: absolute; right: 0; top: 0;">\n\t\t\t\t\t\t\t{{formatTimeCurrent}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span style="opacity: 0;">{{formatTimeTotal}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="ui-vue-audioplayer-time-divider" v-if="mini && timeCurrent > 0">&nbsp;/&nbsp;</span>\n\t\t\t\t\t<div ref="totalTime" class="ui-vue-audioplayer-time">{{formatTimeTotal}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="!mini"\n\t\t\t\t@click="showPlaybackRateMenu"\n\t\t\t\tref="playbackRateButtonContainer"\n\t\t\t\tclass="ui-vue-audioplayer_playback-speed-menu-container"\n\t\t\t\tstyle="user-select: none;"\n\t\t\t>\n\t\t\t\t{{ getPlaybackRateOptionText(playbackRate) }}\n\t\t\t</div>\n\t\t\t<audio\n\t\t\t\tv-if="src"\n\t\t\t\t:src="src"\n\t\t\t\tclass="ui-vue-audioplayer-source"\n\t\t\t\tref="source"\n\t\t\t\t:preload="preload"\n\t\t\t\t@abort="audioEventRouter(\'abort\', $event)"\n\t\t\t\t@error="audioEventRouter(\'error\', $event)"\n\t\t\t\t@suspend="audioEventRouter(\'suspend\', $event)"\n\t\t\t\t@canplay="audioEventRouter(\'canplay\', $event)"\n\t\t\t\t@canplaythrough="audioEventRouter(\'canplaythrough\', $event)"\n\t\t\t\t@durationchange="audioEventRouter(\'durationchange\', $event)"\n\t\t\t\t@loadeddata="audioEventRouter(\'loadeddata\', $event)"\n\t\t\t\t@loadedmetadata="audioEventRouter(\'loadedmetadata\', $event)"\n\t\t\t\t@timeupdate="audioEventRouter(\'timeupdate\', $event)"\n\t\t\t\t@play="audioEventRouterWrapper(\'play\', $event)"\n\t\t\t\t@playing="audioEventRouter(\'playing\', $event)"\n\t\t\t\t@pause="audioEventRouterWrapper(\'pause\', $event)"\n\t\t\t></audio>\n\t\t</div>\n\t'};function l(t,e,i){c(t,e);e.set(t,i)}function c(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var d=new WeakMap;var p=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);l(this,d,{writable:true,value:void 0});this.setRootNode(e.rootNode);this.setAudioProps(e.audioProps);var a=t.getComponent({});babelHelpers.classPrivateFieldSet(this,d,i.BitrixVue.createApp({name:"crm-audio-player",components:{AudioPlayerComponent:a},data:function t(){return{audioProps:n.audioProps}},template:'<AudioPlayerComponent v-bind="audioProps" />'}))}babelHelpers.createClass(t,[{key:"attachTemplate",value:function t(){babelHelpers.classPrivateFieldGet(this,d).mount(this.rootNode)}},{key:"detachTemplate",value:function t(){babelHelpers.classPrivateFieldGet(this,d).unmount(this.rootNode)}},{key:"setRootNode",value:function t(e){if(e===null||e===undefined){return}if(a.Type.isString(e)){this.rootNode=document.querySelector("#".concat(e));if(!this.rootNode){throw new Error("Crm.AudioPlayer: 'rootNode' not found")}return}if(a.Type.isElementNode(e)){this.rootNode=e;return}throw new Error("Crm.AudioPlayer: 'rootNode' Must be either a string or an ElementNode")}},{key:"setAudioProps",value:function t(e){this.audioProps=e}}],[{key:"getComponent",value:function t(e){var a=u;Object.keys(e).forEach((function(t){a[t]=a[t]?BX.util.objectMerge(a[t],e[t]):e[t]}));return i.BitrixVue.cloneComponent(n.AudioPlayer,a)}}]);return t}();var v=p.getComponent({});t.AudioPlayer=p;t.AudioPlayerComponent=v})(this.BX.Crm=this.BX.Crm||{},BX.Main,BX.Vue3,BX.Vue3.Components,BX);
//# sourceMappingURL=audio-player.bundle.map.js