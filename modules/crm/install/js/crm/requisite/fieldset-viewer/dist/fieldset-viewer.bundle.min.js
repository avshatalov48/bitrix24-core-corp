this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,n,i,r,s,a){"use strict";function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-requisite-fieldset-viewer-footer">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);o=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="crm-requisite-fieldset-viewer-close-button"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></div>\n\t\t\t']);l=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-requisite-fieldset-viewer-list-item">\n\t\t\t\t<div class="crm-requisite-fieldset-viewer-list-item-left">\n\t\t\t\t\t<div class="crm-requisite-fieldset-viewer-list-item-label">','</div>\n\t\t\t\t\t<div class="crm-requisite-fieldset-viewer-list-item-value">','</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-requisite-fieldset-viewer-list-item-right">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);u=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="ui-btn ui-btn-link" \n\t\t\t\t\t\tonclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"]);c=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-requisite-fieldset-viewer-list-container">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);d=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-requisite-fieldset-viewer-list">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);v=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-requisite-fieldset-viewer-banner">\n\t\t\t\t<div class="crm-requisite-fieldset-viewer-banner-text">\n\t\t\t\t\t<div class="crm-requisite-fieldset-viewer-banner-text-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-requisite-fieldset-viewer-banner-text-description">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);f=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-requisite-fieldset-viewer-content">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);h=function e(){return t};return t}var p=function(t){babelHelpers.inherits(n,t);function n(){var t;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,n);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"cache",new e.Cache.MemoryCache);t.setEventNamespace("BX.Crm.Requisite.FieldsetViewer");t.subscribeFromOptions((i===null||i===void 0?void 0:i.events)||{});t.setOptions(i);e.Event.bind(i.bindElement,"click",t.onBindElementClick.bind(babelHelpers.assertThisInitialized(t)));return t}babelHelpers.createClass(n,[{key:"setData",value:function t(e){this.cache.set("data",e)}},{key:"getData",value:function t(){return this.cache.get("data",{})}},{key:"load",value:function t(){var e=this;return new Promise((function(t){var n=e.getOptions(),i=n.entityTypeId,r=n.entityId;BX.ajax.runAction("crm.api.fieldset.load",{json:{entityTypeId:i,entityId:r}}).then((function(e){t(e.data)}))}))}},{key:"setOptions",value:function t(e){this.cache.set("options",babelHelpers.objectSpread({},e))}},{key:"getOptions",value:function t(){return this.cache.get("options")}},{key:"getPopup",value:function t(){var n=this;return this.cache.remember("popup",(function(){var t=n.getOptions();return new i.Popup(babelHelpers.objectSpread({bindElement:t.bindElement,autoHide:false,width:570,height:478,className:"crm-requisite-fieldset-viewer",noAllPaddings:true},e.Type.isPlainObject(t===null||t===void 0?void 0:t.popupOptions)?t===null||t===void 0?void 0:t.popupOptions:{},{events:{onClose:function t(){n.emit("onClose",{changed:n.getIsChanged()});n.setIsChanged(false)}}}))}))}},{key:"setIsChanged",value:function t(n){this.cache.set("isChanged",e.Text.toBoolean(n))}},{key:"getIsChanged",value:function t(){return this.cache.get("isChanged",false)}},{key:"getLoader",value:function t(){return this.cache.remember("loader",(function(){return new r.Loader}))}},{key:"show",value:function t(){var n=this;var i=this.getPopup();e.Dom.clean(i.getContentContainer());void this.getLoader().show(i.getContentContainer());this.load().then((function(t){n.setData(babelHelpers.objectSpread({},t));i.setContent(n.createPopupContent(t))}));i.show()}},{key:"hide",value:function t(){this.getPopup().close()}},{key:"onBindElementClick",value:function t(e){e.preventDefault();this.show()}},{key:"createPopupContent",value:function t(n){return e.Tag.render(h(),this.createBannerLayout(n),this.createListLayout(n),this.getFooterLayout(),this.createCloseButton())}},{key:"createBannerLayout",value:function t(n){var i=e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_TITLE").replace("{{requisite}}"," <strong>".concat(n===null||n===void 0?void 0:n.title,"</strong>"));var r=function(){var t=e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_DESCRIPTION");if(e.Type.isStringFilled(n===null||n===void 0?void 0:n.more)){t+=' <a class="ui-link" href="'.concat(e.Text.encode(n===null||n===void 0?void 0:n.more),'">\n\t\t\t\t\t\t').concat(e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_MORE_LINK_LABEL"),"\n\t\t\t\t\t</a>")}return t}();return e.Tag.render(f(),i,r)}},{key:"createListLayout",value:function t(n){return e.Tag.render(v(),this.createListContainer(n.fields))}},{key:"createListContainer",value:function t(n){var i=this;return e.Tag.render(d(),n.map((function(t){return i.createListItem(t)})))}},{key:"createListItem",value:function t(n){var i=this;var r=function(){var t;if(e.Type.isStringFilled(n===null||n===void 0?void 0:(t=n.editing)===null||t===void 0?void 0:t.url)){var r=function t(){var e;BX.SidePanel.Instance.open(n===null||n===void 0?void 0:(e=n.editing)===null||e===void 0?void 0:e.url,{events:{onClose:function t(){i.show()}}});i.setIsChanged(true)};return e.Tag.render(c(),r,e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_LIST_ITEM_VALUE_LINK_LABEL"))}return""}();return e.Tag.render(u(),e.Text.encode(n===null||n===void 0?void 0:n.label),e.Text.encode(n===null||n===void 0?void 0:n.value),r)}},{key:"createCloseButton",value:function t(){var n=this;return this.cache.remember("closeButton",(function(){var t=function t(){n.hide()};return e.Tag.render(l(),t)}))}},{key:"getFieldListEditor",value:function t(){var n=this;return this.cache.remember("fieldListEditor",(function(){var t=n.getOptions();return new a.ListEditor(babelHelpers.objectSpread({setId:n.getData().id,title:e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER__SET_EDITOR_TITLE"),editable:{label:{label:e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER__SET_EDITOR_NAME_LABEL"),type:"string"}},autoSave:false,events:{onSave:function t(){return n.show()}}},e.Type.isPlainObject(t.fieldListEditorOptions)?t.fieldListEditorOptions:{}))}))}},{key:"getEditButton",value:function t(){var n=this;return this.cache.remember("editButton",(function(){return new s.Button({text:e.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_EDIT_BUTTON_LABEL"),color:s.Button.Color.LIGHT_BORDER,icon:s.Button.Icon.EDIT,size:s.Button.Size.SMALL,round:true,events:{click:n.onEditButtonClick.bind(n)}})}))}},{key:"onEditButtonClick",value:function t(){this.getFieldListEditor().showSlider();this.setIsChanged(true)}},{key:"getFooterLayout",value:function t(){var n=this;return this.cache.remember("footerLayout",(function(){return e.Tag.render(o(),n.getEditButton().render())}))}}]);return n}(n.EventEmitter);t.FieldsetViewer=p})(this.BX.Crm.Requisite=this.BX.Crm.Requisite||{},BX,BX.Event,BX.Main,BX,BX.UI,BX.Crm.Field);
//# sourceMappingURL=fieldset-viewer.bundle.map.js