this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,n,r,o){"use strict";let l=e=>e,a,d,c,u,h,E,v,g;class I extends i.EventEmitter{constructor(e={}){super();this.cache=new t.Cache.MemoryCache;this.setEventNamespace("BX.Crm.Requisite.FieldsetViewer");this.subscribeFromOptions((e==null?void 0:e.events)||{});this.setOptions(e);t.Event.bind(e.bindElement,"click",this.onBindElementClick.bind(this))}setData(e){this.cache.set("data",e)}getData(){return this.cache.get("data",{})}load(){return new Promise((e=>{const{entityTypeId:t,entityId:i,fieldListEditorOptions:s}=this.getOptions();const n=s?s.fieldsPanelOptions?s.fieldsPanelOptions.presetId:null:null;BX.ajax.runAction("crm.api.fieldset.load",{json:{entityTypeId:t,entityId:i,presetId:n}}).then((t=>{e(t.data)}))}))}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options")}getPopup(){return this.cache.remember("popup",(()=>{const e=this.getOptions();return new s.Popup({bindElement:e.bindElement,autoHide:false,width:570,height:478,className:"crm-requisite-fieldset-viewer",noAllPaddings:true,...t.Type.isPlainObject(e==null?void 0:e.popupOptions)?e==null?void 0:e.popupOptions:{},events:{onClose:()=>{this.emit("onClose",{changed:this.getIsChanged()});this.setIsChanged(false)}}})}))}setIsChanged(e){this.cache.set("isChanged",t.Text.toBoolean(e))}getIsChanged(){return this.cache.get("isChanged",false)}getLoader(){return this.cache.remember("loader",(()=>new n.Loader))}show(){const e=this.getPopup();t.Dom.clean(e.getContentContainer());void this.getLoader().show(e.getContentContainer());this.load().then((t=>{this.setData({...t});e.setContent(this.createPopupContent(t))}));e.show()}hide(){this.getPopup().close()}onBindElementClick(e){e.preventDefault();this.show()}createPopupContent(e){return t.Tag.render(a||(a=l`
			<div class="crm-requisite-fieldset-viewer-content">
				${0}
				${0}
				${0}
				${0}
			</div>
		`),this.createBannerLayout(e),this.createListLayout(e),this.getFooterLayout(),this.createCloseButton())}createBannerLayout(e){const i=t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_TITLE").replace("{{requisite}}",` <strong>${t.Text.encode(e==null?void 0:e.title)}</strong>`);const s=(()=>{let i=t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_DESCRIPTION");if(t.Type.isStringFilled(e==null?void 0:e.more)){i+=` <a class="ui-link" href="${t.Text.encode(e==null?void 0:e.more)}">\n\t\t\t\t\t\t${t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_BANNER_MORE_LINK_LABEL")}\n\t\t\t\t\t</a>`}return i})();return t.Tag.render(d||(d=l`
			<div class="crm-requisite-fieldset-viewer-banner">
				<div class="crm-requisite-fieldset-viewer-banner-text">
					<div class="crm-requisite-fieldset-viewer-banner-text-title">
						${0}
					</div>
					<div class="crm-requisite-fieldset-viewer-banner-text-description">
						${0}
					</div>
				</div>
			</div>
		`),i,s)}createListLayout(e){return t.Tag.render(c||(c=l`
			<div class="crm-requisite-fieldset-viewer-list">
				${0}
			</div>
		`),this.createListContainer(e.fields))}createListContainer(e){return t.Tag.render(u||(u=l`
			<div class="crm-requisite-fieldset-viewer-list-container">
				${0}
			</div>
		`),e.map((e=>this.createListItem(e))))}createListItem(e){const i=(()=>{var i;if(t.Type.isStringFilled(e==null?void 0:(i=e.editing)==null?void 0:i.url)){const i=()=>{var t;BX.SidePanel.Instance.open(e==null?void 0:(t=e.editing)==null?void 0:t.url,{cacheable:false,events:{onClose:()=>{this.show()}}});this.setIsChanged(true)};return t.Tag.render(h||(h=l`
					<span 
						class="ui-btn ui-btn-link" 
						onclick="${0}">
							${0}
					</span>
				`),i,t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_LIST_ITEM_VALUE_LINK_LABEL"))}return""})();return t.Tag.render(E||(E=l`
			<div class="crm-requisite-fieldset-viewer-list-item">
				<div class="crm-requisite-fieldset-viewer-list-item-left">
					<div class="crm-requisite-fieldset-viewer-list-item-label">${0}</div>
					<div class="crm-requisite-fieldset-viewer-list-item-value">${0}</div>
				</div>
				<div class="crm-requisite-fieldset-viewer-list-item-right">
					${0}
				</div>
			</div>
		`),t.Text.encode(e==null?void 0:e.label),t.Text.encode(e==null?void 0:e.value),i)}createCloseButton(){return this.cache.remember("closeButton",(()=>{const e=()=>{this.hide()};return t.Tag.render(v||(v=l`
				<div 
					class="crm-requisite-fieldset-viewer-close-button"
					onclick="${0}"
				></div>
			`),e)}))}getFieldListEditor(){return this.cache.remember("fieldListEditor",(()=>{const e=this.getOptions();return new o.ListEditor({setId:this.getData().id,title:t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER__SET_EDITOR_TITLE"),editable:{label:{label:t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER__SET_EDITOR_NAME_LABEL"),type:"string"},required:{label:t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER__SET_EDITOR_REQUIRED_LABEL"),type:"checkbox"}},autoSave:false,cacheable:false,events:{onSave:()=>this.show()},fieldsPanelOptions:{hideVirtual:1,...t.Type.isPlainObject(e.fieldsPanelOptions)?e.fieldsPanelOptions:{}},...t.Type.isPlainObject(e.fieldListEditorOptions)?e.fieldListEditorOptions:{}})}))}getEditButton(){return this.cache.remember("editButton",(()=>new r.Button({text:t.Loc.getMessage("CRM_REQUISITE_FIELDSET_VIEWER_EDIT_BUTTON_LABEL"),color:r.Button.Color.LIGHT_BORDER,icon:r.Button.Icon.EDIT,size:r.Button.Size.SMALL,round:true,events:{click:this.onEditButtonClick.bind(this)}})))}onEditButtonClick(){this.getFieldListEditor().showSlider();this.setIsChanged(true)}getFooterLayout(){return this.cache.remember("footerLayout",(()=>t.Tag.render(g||(g=l`
				<div class="crm-requisite-fieldset-viewer-footer">
					${0}
				</div>
			`),this.getEditButton().render())))}}e.FieldsetViewer=I})(this.BX.Crm.Requisite=this.BX.Crm.Requisite||{},BX,BX.Event,BX.Main,BX,BX.UI,BX.Crm.Field);
//# sourceMappingURL=fieldset-viewer.bundle.map.js