{"version":3,"file":"toolbar-component.bundle.js","sources":["../src/toolbar-component.js","../src/navigationbar.js"],"sourcesContent":["import { Router } from 'crm.router';\nimport { ajax as Ajax, Dom, Event, Loc, Reflection, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu } from 'main.popup';\nimport { BaseButton, Button, ButtonIcon } from 'ui.buttons';\nimport { Guide } from 'ui.tour';\n\nimport 'ui.hint';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nlet instance = null;\n\nclass ToolbarEvents\n{\n\tstatic TYPE_UPDATED = 'TypeUpdated';\n\tstatic CATEGORIES_UPDATED = 'CategoriesUpdated';\n\tstatic AUTOMATED_SOLUTION_UPDATED = 'CategoriesUpdated';\n}\n\n/**\n * @memberOf BX.Crm\n */\nexport default class ToolbarComponent extends EventEmitter\n{\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.initHints();\n\t\tthis.setEventNamespace('BX.Crm.ToolbarComponent');\n\n\t\tEvent.ready(this.bindEvents.bind(this));\n\t}\n\n\tstatic get Instance(): ToolbarComponent\n\t{\n\t\tif ( (window.top !== window) && Reflection.getClass('top.BX.Crm.ToolbarComponent') )\n\t\t{\n\t\t\treturn window.top.BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new ToolbarComponent();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitHints()\n\t{\n\t\tBX.UI.Hint.init(BX('ui-toolbar-after-title-buttons'));\n\t\tBX.UI.Hint.popupParameters = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tangle: { offset: 60 },\n\t\t\toffsetLeft: 40\n\t\t};\n\t}\n\n\tbindEvents()\n\t{\n\t\tconst buttonNode = document.querySelector('[data-role=\"bx-crm-toolbar-categories-button\"]');\n\t\tif (buttonNode)\n\t\t{\n\t\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\t\tconst button = toolbar.getButton(Dom.attr(buttonNode, 'data-btn-uniqid'));\n\t\t\tconst entityTypeId = Number(buttonNode.dataset.entityTypeId);\n\n\t\t\tif (button.counterNode && button.counterNode.innerText > 99)\n\t\t\t{\n\t\t\t\tbutton.counterNode.innerText = '99+';\n\t\t\t}\n\n\t\t\tif (button && entityTypeId > 0)\n\t\t\t{\n\t\t\t\tthis.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadCategoriesMenu(button, entityTypeId, buttonNode.dataset.categoryId);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#bindAutomationGuide();\n\t}\n\n\t#bindAutomationGuide()\n\t{\n\t\tconst hash = document.location.hash;\n\t\tlet guide;\n\n\t\tif (hash === '#robots')\n\t\t{\n\t\t\tconst robotsBtn = document.querySelector('.crm-robot-btn');\n\t\t\tif (robotsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: robotsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_ROBOTS_GUIDE_TEXT_1'),\n\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (hash === '#scripts')\n\t\t{\n\t\t\tconst scriptsBtn = document.querySelector('.intranet-binding-menu-btn');\n\t\t\tif (scriptsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: scriptsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_SCRIPTS_GUIDE_TEXT'),\n\t\t\t\t\t\t\tarticle: '13281632',\n\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (guide)\n\t\t{\n\t\t\tguide.start();\n\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\tguide.getPopup().setClosingByEsc(true);\n\t\t}\n\t}\n\n\temitTypeUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.TYPE_UPDATED, data);\n\t}\n\n\temitAutomatedSolutionUpdatedEvent(data: Object): void\n\t{\n\t\tthis.emit(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, data);\n\t}\n\n\temitCategoriesUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.CATEGORIES_UPDATED, data);\n\t}\n\n\tsubscribeTypeUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.TYPE_UPDATED, callback);\n\t}\n\n\tsubscribeCategoriesUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.CATEGORIES_UPDATED, callback);\n\t}\n\n\tsubscribeAutomatedSolutionUpdatedEvent(callback): void\n\t{\n\t\tthis.subscribe(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, callback);\n\t}\n\n\tunsubscribeAutomatedSolutionUpdatedEvent(callback): void\n\t{\n\t\tthis.unsubscribe(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, callback);\n\t}\n\n\treloadCategoriesMenu(button: BaseButton, entityTypeId: number, categoryId: ?number)\n\t{\n\t\tconst menu = button.getMenuWindow();\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tAjax.runAction('crm.controller.category.list', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tlet startKey = 0;\n\t\t\tconst items = [];\n\t\t\tconst categories = response.data.categories;\n\t\t\tmenu.menuItems.forEach((item) => {\n\t\t\t\tif (item.id.indexOf('toolbar-category-') !== 0)\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t}\n\t\t\t\telse if (item.id === 'toolbar-category-all')\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t\tstartKey = 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmenu.destroy();\n\t\t\tEvent.unbindAll(button.getContainer(), 'click');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tlet link;\n\t\t\t\tif(entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t\t{\n\t\t\t\t\tlink = '/crm/deal/category/' + category.id + '/';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlink = Router.Instance.getItemListUrlInCurrentView(entityTypeId, category.id);\n\t\t\t\t\tlink = link.toString();\n\t\t\t\t}\n\n\t\t\t\titems.splice(startKey, 0, {\n\t\t\t\t\tid: 'toolbar-category-' + category.id,\n\t\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\t\thref: link ? link : null,\n\t\t\t\t});\n\t\t\t\tif (category.id > 0 && categoryId > 0 && Number(categoryId) === Number(category.id))\n\t\t\t\t{\n\t\t\t\t\tbutton.setText(category.name);\n\t\t\t\t}\n\t\t\t\tstartKey++;\n\t\t\t});\n\t\t\tconst options = menu.params;\n\t\t\toptions.items = items;\n\t\t\tbutton.menuWindow = new Menu(options);\n\t\t\tEvent.bind(button.getContainer(), 'click', button.menuWindow.show.bind(button.menuWindow));\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t{\n\t\t\t\tthis.reloadAddButtonMenu(categories);\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tconsole.log('error trying reload categories', response.errors);\n\t\t});\n\t}\n\n\treloadAddButtonMenu(categories: Array)\n\t{\n\t\tconst addButtonNode = document.querySelector('.ui-btn-split.ui-btn-success');\n\t\tif (!addButtonNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addButtonId = addButtonNode.dataset.btnUniqid;\n\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\tconst button = toolbar.getButton(addButtonId, 'data-btn-uniqid');\n\t\tif (!button)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = button.menuWindow\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItemsIds = menu\n\t\t\t.getMenuItems()\n\t\t\t.map(item => item.id)\n\t\t\t.filter(id => Type.isInteger(id));\n\t\tconst categoryIds = categories.map(item => item.id);\n\t\tconst idsToRemove = menuItemsIds.filter(id => !categoryIds.includes(id));\n\t\tconst newCategories = categories.filter(item => !menuItemsIds.includes(item.id) && item.id > 0);\n\n\t\t// remove menu item(s)\n\t\tif (idsToRemove.length > 0)\n\t\t{\n\t\t\tidsToRemove.forEach(idToRemove => menu.removeMenuItem(idToRemove));\n\t\t}\n\n\t\t// add new item(s)\n\t\tif (newCategories.length > 0)\n\t\t{\n\t\t\tconst targetItemId = menu\n\t\t\t\t.getMenuItems()\n\t\t\t\t.map(item => item.id)\n\t\t\t\t.filter(id => Type.isString(id))\n\t\t\t\t.at(1);\n\n\t\t\tnewCategories.forEach(item => {\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: item.id,\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tonclick: function(event)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.SidePanel.Instance.open('/crm/deal/details/0/?category_id=' + item.id);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}, targetItemId);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetSettingsButton(): ?Button\n\t{\n\t\tconst toolbar: ?BX.UI.Toolbar = BX.UI.ToolbarManager.getDefaultToolbar();\n\t\tif (!toolbar)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const [key: string, button: Button] of Object.entries(toolbar.getButtons()))\n\t\t{\n\t\t\tif (button.getIcon() === ButtonIcon.SETTING)\n\t\t\t{\n\t\t\t\treturn button;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nnamespace.ToolbarComponent = ToolbarComponent;\n","import { Reflection, Type } from 'main.core';\nimport { NavigationPanel } from 'ui.navigationpanel';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nexport default class NavigationBar extends NavigationPanel\n{\n\t#id: string;\n\t#binding: Array;\n\n\tconstructor(options: Object): void\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthrow 'BX.Crm.NavigationBar: The \"options\" argument must be object.';\n\t\t}\n\n\t\toptions.items = Type.isArray(options.items) ? options.items : [];\n\t\toptions.items.forEach(item => {\n\t\t\tif (\n\t\t\t\t!item.hasOwnProperty('active')\n\t\t\t\t&& item.hasOwnProperty('isActive')\n\t\t\t)\n\t\t\t{\n\t\t\t\titem.active = item.isActive;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.lockedCallback))\n\t\t\t{\n\t\t\t\titem.locked = true;\n\t\t\t\titem.url = '';\n\t\t\t\titem.events = {click: () => eval(item.lockedCallback)}\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.url))\n\t\t\t{\n\t\t\t\titem.events = {click: () => this.openUrl(item.id, item.url)}\n\t\t\t}\n\t\t});\n\n\t\tsuper({\n\t\t\ttarget: BX(options.id),\n\t\t\titems: options.items,\n\t\t});\n\n\t\tthis.#id = options.id;\n\t\tthis.#binding = options.binding;\n\t}\n\n\topenUrl(itemId: String, url: String): void\n\t{\n\t\tif (!Type.isStringFilled(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#binding && Type.isPlainObject(this.#binding))\n\t\t{\n\t\t\tconst category = Type.isStringFilled(this.#binding.category)\n\t\t\t\t? this.#binding.category\n\t\t\t\t: '';\n\t\t\tconst name = Type.isStringFilled(this.#binding.name)\n\t\t\t\t? this.#binding.name\n\t\t\t\t: '';\n\t\t\tconst key = Type.isStringFilled(this.#binding.key)\n\t\t\t\t? this.#binding.key\n\t\t\t\t: '';\n\n\t\t\tif (category !== '' && name !== '' && key !== '')\n\t\t\t{\n\t\t\t\tconst value = itemId + \":\" + BX.formatDate(new Date(), 'YYYYMMDD');\n\n\t\t\t\tBX.userOptions.save(category, name, key, value, false);\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(function() { window.location.href = url; }, 150);\n\t}\n}\n\nnamespace.NavigationBar = NavigationBar;\n"],"names":["namespace","Reflection","instance","ToolbarEvents","ToolbarComponent","initHints","setEventNamespace","Event","ready","bindEvents","bind","BX","UI","Hint","init","popupParameters","closeByEsc","autoHide","angle","offset","offsetLeft","buttonNode","document","querySelector","toolbar","ToolbarManager","getDefaultToolbar","button","getButton","Dom","attr","entityTypeId","Number","dataset","counterNode","innerText","subscribeCategoriesUpdatedEvent","reloadCategoriesMenu","categoryId","data","emit","TYPE_UPDATED","AUTOMATED_SOLUTION_UPDATED","CATEGORIES_UPDATED","callback","subscribe","unsubscribe","menu","getMenuWindow","Ajax","runAction","then","response","startKey","items","categories","menuItems","forEach","item","id","indexOf","push","options","destroy","unbindAll","getContainer","category","link","CrmEntityType","enumeration","deal","Router","Instance","getItemListUrlInCurrentView","toString","splice","text","Text","encode","name","href","setText","params","menuWindow","Menu","show","reloadAddButtonMenu","console","log","errors","addButtonNode","addButtonId","btnUniqid","menuItemsIds","getMenuItems","map","filter","Type","isInteger","categoryIds","idsToRemove","includes","newCategories","length","idToRemove","removeMenuItem","targetItemId","isString","at","addMenuItem","onclick","event","SidePanel","open","Object","entries","getButtons","key","getIcon","ButtonIcon","SETTING","window","top","getClass","Crm","EventEmitter","hash","location","guide","robotsBtn","Guide","steps","target","title","Loc","getMessage","onEvents","scriptsBtn","article","start","getPopup","setAutoHide","setClosingByEsc","NavigationBar","isPlainObject","isArray","hasOwnProperty","active","isActive","isStringFilled","lockedCallback","locked","url","events","click","eval","openUrl","binding","itemId","value","formatDate","Date","userOptions","save","setTimeout","NavigationPanel"],"mappings":"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"}