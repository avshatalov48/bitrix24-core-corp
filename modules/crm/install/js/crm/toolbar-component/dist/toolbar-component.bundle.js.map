{"version":3,"file":"toolbar-component.bundle.js","sources":["../src/toolbar-component.js","../src/navigationbar.js"],"sourcesContent":["import {Reflection, Event, ajax as Ajax, Text, Type, Dom} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {BaseButton} from \"ui.buttons\";\nimport {Router} from \"crm.router\";\nimport {Menu} from \"main.popup\";\n\nimport 'ui.hint';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nlet instance = null;\n\nclass ToolbarEvents\n{\n\tstatic TYPE_UPDATED = 'TypeUpdated';\n\tstatic CATEGORIES_UPDATED = 'CategoriesUpdated';\n}\n\nexport default class ToolbarComponent extends EventEmitter\n{\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.initHints();\n\t\tthis.setEventNamespace('BX.Crm.ToolbarComponent');\n\n\t\tEvent.ready(this.bindEvents.bind(this));\n\t}\n\n\tstatic get Instance(): ToolbarComponent\n\t{\n\t\tif ( (window.top !== window) && Reflection.getClass('top.BX.Crm.ToolbarComponent') )\n\t\t{\n\t\t\treturn window.top.BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new ToolbarComponent();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitHints()\n\t{\n\t\tBX.UI.Hint.init(BX('ui-toolbar-after-title-buttons'));\n\t\tBX.UI.Hint.popupParameters = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tangle: { offset: 60 },\n\t\t\toffsetLeft: 40\n\t\t};\n\t}\n\n\tbindEvents()\n\t{\n\t\tconst buttonNode = document.querySelector('[data-role=\"bx-crm-toolbar-categories-button\"]');\n\t\tif (buttonNode)\n\t\t{\n\t\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\t\tconst button = toolbar.getButton(Dom.attr(buttonNode, 'data-btn-uniqid'));\n\t\t\tconst entityTypeId = Number(buttonNode.dataset.entityTypeId);\n\t\t\tif (button && entityTypeId > 0)\n\t\t\t{\n\t\t\t\tthis.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadCategoriesMenu(button, entityTypeId, buttonNode.dataset.categoryId);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\temitTypeUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.TYPE_UPDATED, data);\n\t}\n\n\temitCategoriesUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.CATEGORIES_UPDATED, data);\n\t}\n\n\tsubscribeTypeUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.TYPE_UPDATED, callback);\n\t}\n\n\tsubscribeCategoriesUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.CATEGORIES_UPDATED, callback);\n\t}\n\n\treloadCategoriesMenu(button: BaseButton, entityTypeId: number, categoryId: ?number)\n\t{\n\t\tconst menu = button.getMenuWindow();\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tAjax.runAction('crm.controller.category.list', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tlet startKey = 0;\n\t\t\tconst items = [];\n\t\t\tconst categories = response.data.categories;\n\t\t\tmenu.menuItems.forEach((item) => {\n\t\t\t\tif (item.id.indexOf('toolbar-category-') !== 0)\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t}\n\t\t\t\telse if (item.id === 'toolbar-category-all')\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t\tstartKey = 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmenu.destroy();\n\t\t\tEvent.unbindAll(button.getContainer(), 'click');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tlet link;\n\t\t\t\tif(entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t\t{\n\t\t\t\t\tlink = '/crm/deal/category/' + category.id + '/';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlink = Router.Instance.getItemListUrlInCurrentView(entityTypeId, category.id);\n\t\t\t\t\tlink = link.toString();\n\t\t\t\t}\n\n\t\t\t\titems.splice(startKey, 0, {\n\t\t\t\t\tid: 'toolbar-category-' + category.id,\n\t\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\t\thref: link ? link : null,\n\t\t\t\t});\n\t\t\t\tif (category.id > 0 && categoryId > 0 && Number(categoryId) === Number(category.id))\n\t\t\t\t{\n\t\t\t\t\tbutton.setText(category.name);\n\t\t\t\t}\n\t\t\t\tstartKey++;\n\t\t\t});\n\t\t\tconst options = menu.params;\n\t\t\toptions.items = items;\n\t\t\tbutton.menuWindow = new Menu(options);\n\t\t\tEvent.bind(button.getContainer(), 'click', button.menuWindow.show.bind(button.menuWindow));\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t{\n\t\t\t\tthis.reloadAddButtonMenu(categories);\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tconsole.log('error trying reload categories', response.errors);\n\t\t});\n\t}\n\n\treloadAddButtonMenu(categories: Array)\n\t{\n\t\tconst addButtonNode = document.querySelector('.ui-btn-split.ui-btn-success');\n\t\tif (!addButtonNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addButtonId = addButtonNode.dataset.btnUniqid;\n\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\tconst button = toolbar.getButton(addButtonId, 'data-btn-uniqid');\n\t\tif (!button)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = button.menuWindow\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItemsIds = menu\n\t\t\t.getMenuItems()\n\t\t\t.map(item => item.id)\n\t\t\t.filter(id => Type.isInteger(id));\n\t\tconst categoryIds = categories.map(item => item.id);\n\t\tconst idsToRemove = menuItemsIds.filter(id => !categoryIds.includes(id));\n\t\tconst newCategories = categories.filter(item => !menuItemsIds.includes(item.id) && item.id > 0);\n\n\t\t// remove menu item(s)\n\t\tif (idsToRemove.length > 0)\n\t\t{\n\t\t\tidsToRemove.forEach(idToRemove => menu.removeMenuItem(idToRemove));\n\t\t}\n\n\t\t// add new item(s)\n\t\tif (newCategories.length > 0)\n\t\t{\n\t\t\tconst targetItemId = menu\n\t\t\t\t.getMenuItems()\n\t\t\t\t.map(item => item.id)\n\t\t\t\t.filter(id => Type.isString(id))\n\t\t\t\t.at(1);\n\n\t\t\tnewCategories.forEach(item => {\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: item.id,\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tonclick: function(event)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.SidePanel.Instance.open('/crm/deal/details/0/?category_id=' + item.id);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}, targetItemId);\n\t\t\t});\n\t\t}\n\t}\n}\n\nnamespace.ToolbarComponent = ToolbarComponent;\n","import { Reflection, Type } from 'main.core';\nimport { NavigationPanel } from 'ui.navigationpanel';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nexport default class NavigationBar extends NavigationPanel\n{\n\t#id: string;\n\t#binding: Array;\n\n\tconstructor(options: Object): void\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthrow 'BX.Crm.NavigationBar: The \"options\" argument must be object.';\n\t\t}\n\n\t\toptions.items = Type.isArray(options.items) ? options.items : [];\n\t\toptions.items.forEach(item => {\n\t\t\tif (\n\t\t\t\t!item.hasOwnProperty('active')\n\t\t\t\t&& item.hasOwnProperty('isActive')\n\t\t\t)\n\t\t\t{\n\t\t\t\titem.active = item.isActive;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.url))\n\t\t\t{\n\t\t\t\titem.events = {click: () => this.openUrl(item.id, item.url)}\n\t\t\t}\n\t\t});\n\n\t\tsuper({\n\t\t\ttarget: BX(options.id),\n\t\t\titems: options.items,\n\t\t});\n\n\t\tthis.#id = options.id;\n\t\tthis.#binding = options.binding;\n\t}\n\n\topenUrl(itemId: String, url: String): void\n\t{\n\t\tif (!Type.isStringFilled(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#binding && Type.isPlainObject(this.#binding))\n\t\t{\n\t\t\tconst category = Type.isStringFilled(this.#binding.category)\n\t\t\t\t? this.#binding.category\n\t\t\t\t: '';\n\t\t\tconst name = Type.isStringFilled(this.#binding.name)\n\t\t\t\t? this.#binding.name\n\t\t\t\t: '';\n\t\t\tconst key = Type.isStringFilled(this.#binding.key)\n\t\t\t\t? this.#binding.key\n\t\t\t\t: '';\n\n\t\t\tif (category !== '' && name !== '' && key !== '')\n\t\t\t{\n\t\t\t\tconst value = itemId + \":\" + BX.formatDate(new Date(), 'YYYYMMDD');\n\n\t\t\t\tBX.userOptions.save(category, name, key, value, false);\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(function() { window.location.href = url; }, 150);\n\t}\n}\n\nnamespace.NavigationBar = NavigationBar;\n"],"names":["namespace","Reflection","instance","ToolbarEvents","ToolbarComponent","initHints","setEventNamespace","Event","ready","bindEvents","bind","BX","UI","Hint","init","popupParameters","closeByEsc","autoHide","angle","offset","offsetLeft","buttonNode","document","querySelector","toolbar","ToolbarManager","getDefaultToolbar","button","getButton","Dom","attr","entityTypeId","Number","dataset","subscribeCategoriesUpdatedEvent","reloadCategoriesMenu","categoryId","data","emit","TYPE_UPDATED","CATEGORIES_UPDATED","callback","subscribe","menu","getMenuWindow","Ajax","runAction","then","response","startKey","items","categories","menuItems","forEach","item","id","indexOf","push","options","destroy","unbindAll","getContainer","category","link","CrmEntityType","enumeration","deal","Router","Instance","getItemListUrlInCurrentView","toString","splice","text","Text","encode","name","href","setText","params","menuWindow","Menu","show","reloadAddButtonMenu","console","log","errors","addButtonNode","addButtonId","btnUniqid","menuItemsIds","getMenuItems","map","filter","Type","isInteger","categoryIds","idsToRemove","includes","newCategories","length","idToRemove","removeMenuItem","targetItemId","isString","at","addMenuItem","onclick","event","SidePanel","open","window","top","getClass","Crm","EventEmitter","NavigationBar","isPlainObject","isArray","hasOwnProperty","active","isActive","isStringFilled","url","events","click","openUrl","target","binding","itemId","key","value","formatDate","Date","userOptions","save","setTimeout","location","NavigationPanel"],"mappings":"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"}