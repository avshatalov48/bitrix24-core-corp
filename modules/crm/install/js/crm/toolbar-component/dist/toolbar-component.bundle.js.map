{"version":3,"file":"toolbar-component.bundle.js","sources":["../src/toolbar-component.js","../src/navigationbar.js"],"sourcesContent":["import { ajax as Ajax, Dom, Event, Reflection, Text, Type, Loc } from \"main.core\";\nimport { EventEmitter } from \"main.core.events\";\nimport { BaseButton, Button, ButtonIcon } from \"ui.buttons\";\nimport { Router } from \"crm.router\";\nimport { Menu } from \"main.popup\";\nimport {Guide} from \"ui.tour\";\n\nimport 'ui.hint';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nlet instance = null;\n\nclass ToolbarEvents\n{\n\tstatic TYPE_UPDATED = 'TypeUpdated';\n\tstatic CATEGORIES_UPDATED = 'CategoriesUpdated';\n}\n\n/**\n * @memberOf BX.Crm\n */\nexport default class ToolbarComponent extends EventEmitter\n{\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.initHints();\n\t\tthis.setEventNamespace('BX.Crm.ToolbarComponent');\n\n\t\tEvent.ready(this.bindEvents.bind(this));\n\t}\n\n\tstatic get Instance(): ToolbarComponent\n\t{\n\t\tif ( (window.top !== window) && Reflection.getClass('top.BX.Crm.ToolbarComponent') )\n\t\t{\n\t\t\treturn window.top.BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new ToolbarComponent();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitHints()\n\t{\n\t\tBX.UI.Hint.init(BX('ui-toolbar-after-title-buttons'));\n\t\tBX.UI.Hint.popupParameters = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tangle: { offset: 60 },\n\t\t\toffsetLeft: 40\n\t\t};\n\t}\n\n\tbindEvents()\n\t{\n\t\tconst buttonNode = document.querySelector('[data-role=\"bx-crm-toolbar-categories-button\"]');\n\t\tif (buttonNode)\n\t\t{\n\t\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\t\tconst button = toolbar.getButton(Dom.attr(buttonNode, 'data-btn-uniqid'));\n\t\t\tconst entityTypeId = Number(buttonNode.dataset.entityTypeId);\n\t\t\tif (button && entityTypeId > 0)\n\t\t\t{\n\t\t\t\tthis.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadCategoriesMenu(button, entityTypeId, buttonNode.dataset.categoryId);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#bindAutomationGuide();\n\t}\n\n\t#bindAutomationGuide()\n\t{\n\t\tconst hash = document.location.hash;\n\t\tlet guide;\n\n\t\tif (hash === '#robots')\n\t\t{\n\t\t\tconst robotsBtn = document.querySelector('.crm-robot-btn');\n\t\t\tif (robotsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: robotsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_ROBOTS_GUIDE_TEXT_1'),\n\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (hash === '#scripts')\n\t\t{\n\t\t\tconst scriptsBtn = document.querySelector('.intranet-binding-menu-btn');\n\t\t\tif (scriptsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: scriptsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_SCRIPTS_GUIDE_TEXT'),\n\t\t\t\t\t\t\tarticle: '13281632',\n\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (guide)\n\t\t{\n\t\t\tguide.start();\n\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\tguide.getPopup().setClosingByEsc(true);\n\t\t}\n\t}\n\n\temitTypeUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.TYPE_UPDATED, data);\n\t}\n\n\temitCategoriesUpdatedEvent(data)\n\t{\n\t\tthis.emit(ToolbarEvents.CATEGORIES_UPDATED, data);\n\t}\n\n\tsubscribeTypeUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.TYPE_UPDATED, callback);\n\t}\n\n\tsubscribeCategoriesUpdatedEvent(callback)\n\t{\n\t\tthis.subscribe(ToolbarEvents.CATEGORIES_UPDATED, callback);\n\t}\n\n\treloadCategoriesMenu(button: BaseButton, entityTypeId: number, categoryId: ?number)\n\t{\n\t\tconst menu = button.getMenuWindow();\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tAjax.runAction('crm.controller.category.list', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tlet startKey = 0;\n\t\t\tconst items = [];\n\t\t\tconst categories = response.data.categories;\n\t\t\tmenu.menuItems.forEach((item) => {\n\t\t\t\tif (item.id.indexOf('toolbar-category-') !== 0)\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t}\n\t\t\t\telse if (item.id === 'toolbar-category-all')\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t\tstartKey = 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmenu.destroy();\n\t\t\tEvent.unbindAll(button.getContainer(), 'click');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tlet link;\n\t\t\t\tif(entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t\t{\n\t\t\t\t\tlink = '/crm/deal/category/' + category.id + '/';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlink = Router.Instance.getItemListUrlInCurrentView(entityTypeId, category.id);\n\t\t\t\t\tlink = link.toString();\n\t\t\t\t}\n\n\t\t\t\titems.splice(startKey, 0, {\n\t\t\t\t\tid: 'toolbar-category-' + category.id,\n\t\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\t\thref: link ? link : null,\n\t\t\t\t});\n\t\t\t\tif (category.id > 0 && categoryId > 0 && Number(categoryId) === Number(category.id))\n\t\t\t\t{\n\t\t\t\t\tbutton.setText(category.name);\n\t\t\t\t}\n\t\t\t\tstartKey++;\n\t\t\t});\n\t\t\tconst options = menu.params;\n\t\t\toptions.items = items;\n\t\t\tbutton.menuWindow = new Menu(options);\n\t\t\tEvent.bind(button.getContainer(), 'click', button.menuWindow.show.bind(button.menuWindow));\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t{\n\t\t\t\tthis.reloadAddButtonMenu(categories);\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tconsole.log('error trying reload categories', response.errors);\n\t\t});\n\t}\n\n\treloadAddButtonMenu(categories: Array)\n\t{\n\t\tconst addButtonNode = document.querySelector('.ui-btn-split.ui-btn-success');\n\t\tif (!addButtonNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addButtonId = addButtonNode.dataset.btnUniqid;\n\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\tconst button = toolbar.getButton(addButtonId, 'data-btn-uniqid');\n\t\tif (!button)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = button.menuWindow\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItemsIds = menu\n\t\t\t.getMenuItems()\n\t\t\t.map(item => item.id)\n\t\t\t.filter(id => Type.isInteger(id));\n\t\tconst categoryIds = categories.map(item => item.id);\n\t\tconst idsToRemove = menuItemsIds.filter(id => !categoryIds.includes(id));\n\t\tconst newCategories = categories.filter(item => !menuItemsIds.includes(item.id) && item.id > 0);\n\n\t\t// remove menu item(s)\n\t\tif (idsToRemove.length > 0)\n\t\t{\n\t\t\tidsToRemove.forEach(idToRemove => menu.removeMenuItem(idToRemove));\n\t\t}\n\n\t\t// add new item(s)\n\t\tif (newCategories.length > 0)\n\t\t{\n\t\t\tconst targetItemId = menu\n\t\t\t\t.getMenuItems()\n\t\t\t\t.map(item => item.id)\n\t\t\t\t.filter(id => Type.isString(id))\n\t\t\t\t.at(1);\n\n\t\t\tnewCategories.forEach(item => {\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: item.id,\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tonclick: function(event)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.SidePanel.Instance.open('/crm/deal/details/0/?category_id=' + item.id);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}, targetItemId);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetSettingsButton(): ?Button\n\t{\n\t\tconst toolbar: ?BX.UI.Toolbar = BX.UI.ToolbarManager.getDefaultToolbar();\n\t\tif (!toolbar)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const [key: string, button: Button] of Object.entries(toolbar.getButtons()))\n\t\t{\n\t\t\tif (button.getIcon() === ButtonIcon.SETTING)\n\t\t\t{\n\t\t\t\treturn button;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nnamespace.ToolbarComponent = ToolbarComponent;\n","import { Reflection, Type } from 'main.core';\nimport { NavigationPanel } from 'ui.navigationpanel';\n\nimport './style.css';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nexport default class NavigationBar extends NavigationPanel\n{\n\t#id: string;\n\t#binding: Array;\n\n\tconstructor(options: Object): void\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthrow 'BX.Crm.NavigationBar: The \"options\" argument must be object.';\n\t\t}\n\n\t\toptions.items = Type.isArray(options.items) ? options.items : [];\n\t\toptions.items.forEach(item => {\n\t\t\tif (\n\t\t\t\t!item.hasOwnProperty('active')\n\t\t\t\t&& item.hasOwnProperty('isActive')\n\t\t\t)\n\t\t\t{\n\t\t\t\titem.active = item.isActive;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.lockedCallback))\n\t\t\t{\n\t\t\t\titem.locked = true;\n\t\t\t\titem.url = '';\n\t\t\t\titem.events = {click: () => eval(item.lockedCallback)}\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.url))\n\t\t\t{\n\t\t\t\titem.events = {click: () => this.openUrl(item.id, item.url)}\n\t\t\t}\n\t\t});\n\n\t\tsuper({\n\t\t\ttarget: BX(options.id),\n\t\t\titems: options.items,\n\t\t});\n\n\t\tthis.#id = options.id;\n\t\tthis.#binding = options.binding;\n\t}\n\n\topenUrl(itemId: String, url: String): void\n\t{\n\t\tif (!Type.isStringFilled(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#binding && Type.isPlainObject(this.#binding))\n\t\t{\n\t\t\tconst category = Type.isStringFilled(this.#binding.category)\n\t\t\t\t? this.#binding.category\n\t\t\t\t: '';\n\t\t\tconst name = Type.isStringFilled(this.#binding.name)\n\t\t\t\t? this.#binding.name\n\t\t\t\t: '';\n\t\t\tconst key = Type.isStringFilled(this.#binding.key)\n\t\t\t\t? this.#binding.key\n\t\t\t\t: '';\n\n\t\t\tif (category !== '' && name !== '' && key !== '')\n\t\t\t{\n\t\t\t\tconst value = itemId + \":\" + BX.formatDate(new Date(), 'YYYYMMDD');\n\n\t\t\t\tBX.userOptions.save(category, name, key, value, false);\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(function() { window.location.href = url; }, 150);\n\t}\n}\n\nnamespace.NavigationBar = NavigationBar;\n"],"names":["namespace","Reflection","instance","ToolbarEvents","babelHelpers","classCallCheck","defineProperty","_bindAutomationGuide","WeakSet","ToolbarComponent","_EventEmitter","inherits","_this","possibleConstructorReturn","getPrototypeOf","call","_classPrivateMethodInitSpec","assertThisInitialized","initHints","setEventNamespace","Event","ready","bindEvents","bind","createClass","key","value","BX","UI","Hint","init","popupParameters","closeByEsc","autoHide","angle","offset","offsetLeft","_this2","buttonNode","document","querySelector","toolbar","ToolbarManager","getDefaultToolbar","button","getButton","Dom","attr","entityTypeId","Number","dataset","subscribeCategoriesUpdatedEvent","reloadCategoriesMenu","categoryId","_classPrivateMethodGet","_bindAutomationGuide2","emitTypeUpdatedEvent","data","emit","TYPE_UPDATED","emitCategoriesUpdatedEvent","CATEGORIES_UPDATED","subscribeTypeUpdatedEvent","callback","subscribe","_this3","menu","getMenuWindow","Ajax","runAction","then","response","startKey","items","categories","menuItems","forEach","item","id","indexOf","push","options","destroy","unbindAll","getContainer","category","link","CrmEntityType","enumeration","deal","Router","Instance","getItemListUrlInCurrentView","toString","splice","text","Text","encode","name","href","setText","params","menuWindow","Menu","show","reloadAddButtonMenu","console","log","errors","_this4","addButtonNode","addButtonId","btnUniqid","menuItemsIds","getMenuItems","map","filter","Type","isInteger","categoryIds","idsToRemove","includes","newCategories","length","idToRemove","removeMenuItem","targetItemId","isString","at","addMenuItem","onclick","event","SidePanel","open","getSettingsButton","_i","_Object$entries","Object","entries","getButtons","_Object$entries$_i","slicedToArray","getIcon","ButtonIcon","SETTING","get","window","top","getClass","Crm","EventEmitter","hash","location","guide","robotsBtn","Guide","steps","target","title","Loc","getMessage","onEvents","scriptsBtn","article","start","getPopup","setAutoHide","setClosingByEsc","_id","WeakMap","_binding","NavigationBar","_NavigationPanel","isPlainObject","isArray","hasOwnProperty","active","isActive","isStringFilled","lockedCallback","locked","url","events","click","eval","openUrl","_classPrivateFieldInitSpec","writable","classPrivateFieldSet","binding","itemId","classPrivateFieldGet","formatDate","Date","userOptions","save","setTimeout","NavigationPanel"],"mappings":"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"}