this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,n){"use strict";var l,a,r,s;function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t,e){d(t,e);e.add(t)}function b(t,e,i){d(t,e);e.set(t,i)}function d(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function p(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}function v(t,e,i,n){h(t,e);m(i,"set");f(t,i,n);return n}function f(t,e,i){if(e.set){e.set.call(t,i)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=i}}function g(t,e,i){h(t,e);m(i,"get");return T(t,i)}function m(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function h(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function T(t,e){if(e.get){return e.get.call(t)}return e.value}var I=new WeakMap;var _=new WeakMap;var M=new WeakSet;var L=new WeakSet;var F=new WeakSet;var E=function(t){babelHelpers.inherits(n,t);function n(){var t;var e;babelHelpers.classCallCheck(this,n);for(var i=arguments.length,l=new Array(i),a=0;a<i;a++){l[a]=arguments[a]}e=babelHelpers.possibleConstructorReturn(this,(t=babelHelpers.getPrototypeOf(n)).call.apply(t,[this].concat(l)));u(babelHelpers.assertThisInitialized(e),F);u(babelHelpers.assertThisInitialized(e),L);u(babelHelpers.assertThisInitialized(e),M);b(babelHelpers.assertThisInitialized(e),I,{writable:true,value:{limitMb:undefined,currentBytes:null,canChange:null}});b(babelHelpers.assertThisInitialized(e),_,{writable:true,value:{container:HTMLElement=null,limit:{block:HTMLElement=null,input:HTMLInputElement=null},percentage:{block:HTMLElement=null}}});return e}babelHelpers.createClass(n,[{key:"open",value:function t(){var l;var a=new Promise((function(t){l=t}));var r=n.instance();BX.SidePanel.Instance.open("crm.webform:file-limit",{width:700,cacheable:false,events:{onCloseComplete:function t(){l(o({},r.getValue()))}},contentCallback:function t(){return i.Layout.createContent({extensions:["crm.form.file-limit","ui.forms","ui.sidepanel-content"],title:e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_TITLE"),design:{section:false},content:function t(){return r.load()},buttons:function t(i){var n=i.SaveButton,l=i.closeButton;return[new n({onclick:function t(i){if(!r.canChange()){i.setDisabled(true);BX.UI.Notification.Center.notify({content:e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_ACCESS_DENIED")});return}i.setWaiting(true);r.save().then((function(){i.setWaiting(false);BX.SidePanel.Instance.close()}))["catch"]((function(){i.setWaiting(false)}))}}),l]}})}});return a}},{key:"canChange",value:function t(){return babelHelpers.classPrivateFieldGet(this,I).canChange}},{key:"load",value:function t(){var i=this;return e.ajax.runAction("crm.form.getFileLimit",{json:{}}).then((function(t){babelHelpers.classPrivateFieldSet(i,I,t.data);return p(i,M,H).call(i)}))}},{key:"save",value:function t(){var i,n=this;var l=babelHelpers.classPrivateFieldGet(this,_).limit.input.value;(i=babelHelpers.classPrivateFieldGet(this,_))===null||i===void 0?void 0:i.limit.block.classList.remove("ui-ctl-danger");if(e.Type.isInteger(l)&&l<=0||e.Type.isStringFilled(l&&!e.Type.isInteger(l))){babelHelpers.classPrivateFieldGet(this,_).limit.block.classList.add("ui-ctl-danger");return Promise.reject()}l=e.Type.isStringFilled(l)?Number(l):null;return e.ajax.runAction("crm.form.setFileLimit",{json:{limitMb:l}}).then((function(t){babelHelpers.classPrivateFieldSet(n,I,t.data);n.emit("onSuccessLimitChanged",{limit:babelHelpers.classPrivateFieldGet(n,I).limitMb});return babelHelpers.classPrivateFieldGet(n,I)}))}},{key:"getValue",value:function t(){return babelHelpers.classPrivateFieldGet(this,I)}}],[{key:"instance",value:function t(){if(!g(n,n,C)){v(n,n,C,new n)}return g(n,n,C)}}]);return n}(n.EventEmitter);function H(){var t=babelHelpers.classPrivateFieldGet(this,I).limitMb;babelHelpers.classPrivateFieldGet(this,_).percentage.block=p(this,L,P).call(this);babelHelpers.classPrivateFieldGet(this,_).limit.input=e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input \n\t\t\t\t\ttype="number" \n\t\t\t\t\tname="limit"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\tmin="1"\n\t\t\t\t\tmaxlength="5"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\tonfocus="this.parentElement.classList.remove(\'ui-ctl-danger\')"\n\t\t\t\t>\n\t\t'])),t);babelHelpers.classPrivateFieldGet(this,_).limit.block=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,_).limit.input);babelHelpers.classPrivateFieldGet(this,_).container=e.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="ui-slider-section">\n\t\t\t\t\t<div class="ui-slider-content-box">\n\t\t\t\t\t\t<div class="ui-slider-heading-4">','</div>\n\t\t\t\t\t\t<p class="ui-slider-paragraph-2">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-slider-section">\n\t\t\t\t\t<div class="ui-slider-content-box">\n\t\t\t\t\t\t<div class="ui-slider-heading-4">','</div>\n\t\t\t\t\t\t<p class="ui-slider-paragraph-2">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_DESCRIPTION_TITLE"),e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_DESCRIPTION_TEXT"),babelHelpers.classPrivateFieldGet(this,_).percentage.block,e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_SETTING_TITLE"),e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_SETTING_DISABLE_HINT"),e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_LIMIT_SETTING_TITLE"),babelHelpers.classPrivateFieldGet(this,_).limit.block);return babelHelpers.classPrivateFieldGet(this,_).container}function P(){var t=e.Type.isInteger(babelHelpers.classPrivateFieldGet(this,I).limitMb)?Math.ceil(babelHelpers.classPrivateFieldGet(this,I).currentBytes/(babelHelpers.classPrivateFieldGet(this,I).limitMb*1024*1024)*100):0;var i=e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-alert"></div>\n\t\t'])));if(e.Type.isInteger(babelHelpers.classPrivateFieldGet(this,I).limitMb)){var n="ui-alert-success";if(t>=95){n="ui-alert-danger"}else if(t>=85){n="ui-alert-warning"}BX.addClass(i,n);i.innerText=p(this,F,y).call(this,Math.min(t,100))}else if(e.Type.isNull(babelHelpers.classPrivateFieldGet(this,I).limitMb)){BX.addClass(i,"ui-alert-default");i.innerText=e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_LIMIT_DISABLED")}else{BX.Hide(i)}return i}function y(t){var i=e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_CURRENT_LIMIT_PERCENTAGE_TEXT").replace("%percentage%",t);if(t>=85){i=e.Loc.getMessage("CRM_FORM_FILE_LIMIT_JS_CURRENT_LIMIT_USERS_MIGHT_TROUBLE").replace("%percentage%",t)}return i}var C={writable:true,value:null};t.FileLimit=E})(this.BX.Crm.Form=this.BX.Crm.Form||{},BX,BX.UI.SidePanel,BX.Event);
//# sourceMappingURL=file-limit.bundle.map.js