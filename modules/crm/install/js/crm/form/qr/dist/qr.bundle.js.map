{"version":3,"file":"qr.bundle.js","sources":["../src/qr.js"],"sourcesContent":["import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport \"main.qrcode\";\nimport {Event, Loc, Tag} from 'main.core';\nimport {Popup} from 'main.popup';\nimport 'ui.notification';\nimport './style.css';\n\nexport type QrOptions = {\n\tlink: string;\n};\n\nexport class Qr\n{\n\t#link: string;\n\t#qrNode: HTMLElement = null;\n\t#button: HTMLElement = null;\n\t#containerCopyLink: HTMLElement = null;\n\t#containerInputLink: HTMLElement = null;\n\n\tconstructor(options: QrOptions)\n\t{\n\t\tthis.#link = options.link;\n\t}\n\n\trenderTo(target: HTMLElement): HTMLElement\n\t{\n\t\tconst button = this.#renderButton();\n\t\ttarget.appendChild(button);\n\t\treturn button;\n\t}\n\n\t#renderButton(): HTMLElement\n\t{\n\t\tif (!this.#button)\n\t\t{\n\t\t\tthis.#button = Tag.render`\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"crm-webform-qr-btn ui-btn ui-btn-xs ui-btn-light-border ui-btn-round ui-btn-no-caps ui-btn-icon-share\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('CRM_WEBFORM_QR_OPEN')}\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tthis.#button.addEventListener(\"click\", (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.show();\n\t\t\t});\n\t\t}\n\n\t\treturn this.#button;\n\t}\n\n\t#getImageContainer(): HTMLElement\n\t{\n\t\tif(!this.#qrNode)\n\t\t{\n\t\t\tthis.#qrNode = Tag.render`\n\t\t\t\t<div class=\"crm-webform__popup-image\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#qrNode;\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tconst container = Tag.render`\n\t\t\t\t<div class=\"crm-webform__scope\">\n\t\t\t\t\t<div class=\"crm-webform__popup-container --qr\">\n\t\t\t\t\t\t<div class=\"crm-webform__popup-wrapper\">\n\t\t\t\t\t\t\t<div class=\"crm-webform__popup-content\">\n\t\t\t\t\t\t\t\t<div class=\"crm-webform__popup-text\">${Loc.getMessage('CRM_WEBFORM_QR_TITLE')}</div>\n\t\t\t\t\t\t\t\t${this.#getImageContainer()}\n\t\t\t\t\t\t\t\t<div class=\"crm-webform__popup-text --sm\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_WEBFORM_QR_DESC')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-webform__popup-buttons\">\n\t\t\t\t\t\t\t\t\t<a href=\"${this.#link}\" target=\"_blank\" class=\"ui-btn ui-btn-light-border ui-btn-round\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_WEBFORM_QR_TILE_POPUP_OPEN_SITE')}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-webform__popup-bottom\">\n\t\t\t\t\t\t\t\t<a href=\"${this.#link}\" target=\"_blank\" class=\"crm-webform__popup-url\">\n\t\t\t\t\t\t\t\t\t${this.#link}\n\t\t\t\t\t\t\t\t\t${this.#getContainerInputLink()}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t${this.#getContainerCopyLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tclassName: 'crm-webform__status-popup',\n\t\t\t\tcontent: container,\n\t\t\t\tbindElement: window,\n\t\t\t\twidth: 405,\n\t\t\t\tminWidth: 220,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tcloseIcon: true,\n\t\t\t\tpadding: 0\n\t\t\t});\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#renderImage();\n\t\tif (!this.#getPopup().isShown())\n\t\t{\n\t\t\tthis.#getPopup().show();\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tif (this.#getPopup().isShown())\n\t\t{\n\t\t\tthis.#getPopup().close();\n\t\t}\n\t}\n\n\t#renderImage()\n\t{\n\t\tif (!this.#qrNode)\n\t\t{\n\t\t\tnew QRCode(this.#getImageContainer(), {\n\t\t\t\ttext: this.#link,\n\t\t\t\twidth: 250,\n\t\t\t\theight: 250\n\t\t\t})\n\t\t}\n\t}\n\n\t#getContainerInputLink()\n\t{\n\t\tif(!this.#containerInputLink)\n\t\t{\n\t\t\tthis.#containerInputLink = Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tstyle=\"position: absolute; opacity: 0; pointer-events: none\"\n\t\t\t\t\tvalue=\"${this.#link}\">\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#containerInputLink;\n\t}\n\n\t#getContainerCopyLink()\n\t{\n\t\tif(!this.#containerCopyLink)\n\t\t{\n\t\t\tthis.#containerCopyLink = Tag.render`\n\t\t\t\t<div class=\"crm-webform__popup-copy\">\n\t\t\t\t\t${Loc.getMessage('CRM_WEBFORM_QR_TILE_POPUP_COPY_LINK')}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#containerCopyLink, 'click', ()=> {\n\t\t\t\tthis.#getContainerInputLink().select();\n\t\t\t\tdocument.execCommand('copy');\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('CRM_WEBFORM_QR_TILE_POPUP_COPY_LINK_COMPLETE'),\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn this.#containerCopyLink;\n\t}\n}\n"],"names":["Qr","options","link","target","button","appendChild","isShown","show","close","Tag","render","Loc","getMessage","addEventListener","e","stopPropagation","popup","container","Popup","className","content","bindElement","window","width","minWidth","closeByEsc","autoHide","animation","closeIcon","padding","QRCode","text","height","Event","bind","select","document","execCommand","BX","UI","Notification","Center","notify","autoHideDelay"],"mappings":"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"}