{"version":3,"file":"selector.bundle.js","sources":["../src/backend/backend.js","../src/search/search.js","../src/list-item/list-item.js","../src/selector.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {ajax} from 'main.core';\n\ntype BackendOptions = {\n\tevents: {\n\t\tonError: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Backend extends EventEmitter\n{\n\tconstructor(options: BackendOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Backend');\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\t#request(requestOptions: {action: string, data: {[key: string]: any}}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction(\n\t\t\t\t\t`crm.api.form.fields.selector.${requestOptions.action}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: requestOptions.data,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject);\n\t\t});\n\t}\n\n\tgetData(requestOptions = {}): Promise<any>\n\t{\n\t\treturn this.#request({\n\t\t\taction: 'getData',\n\t\t\tdata: requestOptions,\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Runtime, Text, Type, Loc} from 'main.core';\n\nimport './css/style.css';\n\ntype SearchOptions = {\n\tinitialValue?: string,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t\tonDebouncedChange?: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Search extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: SearchOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Search');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SearchOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\t#getOptions(): SearchOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#onInput()\n\t{\n\t\tthis.emit('onChange', {value: this.#getInput().value});\n\t\tthis.#getDebounceWrapper()();\n\t}\n\n\t#getDebounceWrapper(): () => void\n\t{\n\t\treturn this.#cache.remember('debounceWrapper', () => {\n\t\t\treturn Runtime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\tthis.emit('onDebouncedChange', {value: this.#getInput().value});\n\t\t\t\t},\n\t\t\t\t50,\n\t\t\t)\n\t\t});\n\t}\n\n\t#getInput(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('input', () => {\n\t\t\tconst initialValue = (() => {\n\t\t\t\tif (Type.isStringFilled(this.#getOptions().initialValue))\n\t\t\t\t{\n\t\t\t\t\treturn this.#getOptions().initialValue;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\toninput=\"${this.#onInput.bind(this)}\"\n\t\t\t\t\tvalue=\"${Text.encode(initialValue)}\"\n\t\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SEARCH_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#getInput().value;\n\t}\n\n\t#onClearClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#getInput().value = '';\n\t\tthis.#onInput();\n\t}\n\n\tsetValue(value: string)\n\t{\n\t\tthis.#getInput().value = value;\n\t\tthis.#onInput();\n\t}\n\n\t#getClearButton(): HTMLButtonElement\n\t{\n\t\treturn this.#cache.remember('clearButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button \n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\" \n\t\t\t\t\tonclick=\"${this.#onClearClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-search\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t${this.#getClearButton()}\n\t\t\t\t\t\t${this.#getInput()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Dom, Text, Type} from 'main.core';\n\nimport {type Field} from '../types/field';\n\nimport './css/style.css';\n\ntype ListItemOptions = {\n\tfield: Field,\n\tselected?: boolean,\n\ttargetContainer?: HTMLElement,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t},\n\ttype: $Values<ListItem.Type>,\n\tdisabled?: boolean,\n};\n\nexport default class ListItem extends EventEmitter\n{\n\tstatic Type = {\n\t\tCHECKBOX: 'checkbox',\n\t\tRADIO: 'radio',\n\t};\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: ListItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Field.Selector.ListItem');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\n\t\tconst {targetContainer} = options;\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tthis.renderTo(targetContainer);\n\t\t}\n\t}\n\n\t#setOptions(options: ListItemOptions)\n\t{\n\t\tthis.#cache.set('options', {type: ListItem.Type.CHECKBOX, ...options});\n\t}\n\n\t#getOptions(): ListItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetField(): Field\n\t{\n\t\treturn this.#getOptions().field;\n\t}\n\n\t#onChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\t#getCheckbox(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('checkbox', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"${Text.encode(this.#getOptions().type)}\" \n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tonchange=\"${this.#onChange.bind(this)}\"\n\t\t\t\t\tname=\"CRM_FIELDS_SELECTOR_ITEM\"\n\t\t\t\t\t${this.#getOptions().selected ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisSelected(): boolean\n\t{\n\t\treturn this.#getCheckbox().checked;\n\t}\n\n\t#isDisabled(): boolean\n\t{\n\t\treturn this.#getOptions().disabled ?? false;\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember(`layout`, () => {\n\t\t\tconst fieldDisabledClassName = 'crm-form-fields-selector-field--disabled';\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-field${this.#isDisabled() ? \" \" + fieldDisabledClassName : ''}\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox crm-form-fields-selector-field-checkbox\">\n\t\t\t\t\t\t${this.#getCheckbox()}\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(this.#getOptions().field.caption)}</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(targetContainer: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tDom.append(this.getLayout(), targetContainer);\n\t\t}\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Type, Dom, Reflection, Runtime, Tag, Loc, Text} from 'main.core';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Factory} from 'ui.userfieldfactory';\nimport {Button} from 'ui.buttons';\n\nimport Backend from './backend/backend';\nimport Search from './search/search';\nimport ListItem from './list-item/list-item';\n\nimport type {SelectorOptions, SelectorFilter, FieldsFactoryFilter} from './types/selector-options';\nimport type {FieldsList} from './types/fields-list';\nimport type {Field} from './types/field';\n\nimport './css/style.css';\n\n/**\n * @memberOf BX.Crm.Form.Fields\n */\nexport class Selector extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tstatic #defaultFilter = {\n\t\t'-categories': [\n\t\t\t'CATALOG',\n\t\t\t'ACTIVITY',\n\t\t\t'INVOICE',\n\t\t],\n\t\t'-fields': [\n\t\t\t{name: 'CONTACT_ORIGIN_VERSION'},\n\t\t\t{name: 'CONTACT_LINK'},\n\t\t],\n\t};\n\n\tstatic #defaultFieldsFactoryFilter = {\n\t\t'-types': ['employee', 'datetime'],\n\t};\n\n\tconstructor(options: SelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SelectorOptions)\n\t{\n\t\tthis.#cache.set(\n\t\t\t'options',\n\t\t\t{\n\t\t\t\tfilter: {},\n\t\t\t\tmultiple: true,\n\t\t\t\t...options,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getOptions(): SelectorOptions\n\t{\n\t\treturn Runtime.clone(this.#cache.get('options', {filter: {}}));\n\t}\n\n\t#getBackend(): Backend\n\t{\n\t\treturn this.#cache.remember('backend', () => {\n\t\t\treturn new Backend({\n\t\t\t\tevents: {\n\t\t\t\t\tonError: this.#onBackendError.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#setFieldsList(fieldsList: FieldsList)\n\t{\n\t\tthis.#cache.set('fieldsList', {...fieldsList});\n\t}\n\n\t#applyCategoriesFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t!Type.isArrayFilled(filter['+categories'])\n\t\t\t\t\t|| filter['+categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t\t&& (\n\t\t\t\t\t!Type.isArrayFilled(filter['-categories'])\n\t\t\t\t\t|| !filter['-categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tacc[categoryId] = category;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applyFieldsFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+fields'])\n\t\t\t\t\t|| filter['+fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-fields'])\n\t\t\t\t\t&& filter['-fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t{\n\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t...category,\n\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applySearchFilter(fieldsList: FieldsList, query): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\t\tif (Type.isStringFilled(query))\n\t\t{\n\t\t\tconst preparedQuery = String(query).toLowerCase();\n\t\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isStringFilled(field.caption)\n\t\t\t\t\t\t&& String(field.caption).toLowerCase().includes(preparedQuery)\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t{\n\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t...category,\n\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\tgetFieldsList(): FieldsList\n\t{\n\t\tconst fieldsList = this.#cache.get('fieldsList', {});\n\n\t\tconst filter = this.#getFilter();\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\tconst query = this.#getSearch().getValue();\n\t\t\treturn this.#applySearchFilter(\n\t\t\t\tthis.#applyFieldsFilter(\n\t\t\t\t\tthis.#applyCategoriesFilter(fieldsList, filter),\n\t\t\t\t\tfilter,\n\t\t\t\t),\n\t\t\t\tquery,\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isFunction(filter))\n\t\t{\n\t\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFilter);\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tdefaultFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tconst prefilteredFieldsList = this.#applyFieldsFilter(\n\t\t\t\tthis.#applyCategoriesFilter(fieldsList, defaultFilter),\n\t\t\t\tfilter,\n\t\t\t);\n\n\t\t\treturn filter(Runtime.clone(prefilteredFieldsList));\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#load(): Promise<any>\n\t{\n\t\tconst {controllerOptions = {}} = this.#getOptions();\n\t\treturn this.#getBackend()\n\t\t\t.getData({options: controllerOptions})\n\t\t\t.then(({data}) => {\n\t\t\t\tthis.#setFieldsList(data.fields);\n\t\t\t\tthis.#setIsLeadEnabled(data.options.isLeadEnabled);\n\t\t\t\tthis.#setIsAllowedCreateField(data.options.permissions.userField.add);\n\t\t\t});\n\t}\n\n\t#setIsLeadEnabled(value: boolean)\n\t{\n\t\tthis.#cache.set('isLeadEnabled', value);\n\t}\n\n\t#isLeadEnabled(): boolean\n\t{\n\t\treturn this.#cache.get('isLeadEnabled');\n\t}\n\n\t#setIsAllowedCreateField(value: boolean)\n\t{\n\t\tthis.#cache.set('isAllowedCreateField', value);\n\t}\n\n\t#isAllowedCreateField(): boolean\n\t{\n\t\treturn this.#cache.get('isAllowedCreateField', false);\n\t}\n\n\t#getSidebarItems(): {[key: string]: any}\n\t{\n\t\treturn Object\n\t\t\t.entries(this.getFieldsList())\n\t\t\t.map(([categoryId, category]) => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: category.CAPTION,\n\t\t\t\t\tid: categoryId,\n\t\t\t\t\tonclick: this.#onSidebarItemClick.bind(this, categoryId),\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t#getFilter(): SelectorFilter\n\t{\n\t\tconst customFilter = this.#getOptions().filter;\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tconst defaultFilter = Selector.#defaultFilter;\n\n\t\t\tif (Type.isArray(customFilter['-categories']))\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...customFilter['-categories'],\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tif (Type.isArray(customFilter['-fields']))\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...customFilter['-fields'],\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn customFilter;\n\t}\n\n\t#cleanFieldsList()\n\t{\n\t\tDom.clean(this.#getFieldsListLayout());\n\t}\n\n\t#getSelectedFields(): Array<Field>\n\t{\n\t\treturn this.#cache.get('selectedFields', []);\n\t}\n\n\t#addSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst hasField = selectedFields.some((currentField) => {\n\t\t\treturn currentField.name === field.name;\n\t\t});\n\n\t\tif (!hasField)\n\t\t{\n\t\t\tselectedFields.push(field);\n\t\t\tthis.#setSelectedFields(selectedFields);\n\t\t}\n\t}\n\n\t#removeSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields().filter((currentField) => {\n\t\t\treturn currentField.name !== field.name;\n\t\t});\n\n\t\tthis.#setSelectedFields(selectedFields);\n\t}\n\n\t#setSelectedFields(fields: Array<Field>)\n\t{\n\t\tthis.#cache.set('selectedFields', fields);\n\t}\n\n\t#isMultiple(): boolean\n\t{\n\t\treturn this.#getOptions().multiple;\n\t}\n\n\t#renderCategoryFields(categoryId: string)\n\t{\n\t\tthis.#cleanFieldsList();\n\n\t\tconst fields = this.getFieldsList()[categoryId].FIELDS;\n\t\tif (Type.isArrayFilled(fields))\n\t\t{\n\t\t\tfields.forEach((field) => {\n\t\t\t\tvoid new ListItem({\n\t\t\t\t\tfield,\n\t\t\t\t\ttargetContainer: this.#getFieldsListLayout(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonChange: this.#onListItemChange.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tselected: this.#getSelectedFields().some((selectedField) => {\n\t\t\t\t\t\treturn selectedField.name === field.name;\n\t\t\t\t\t}),\n\t\t\t\t\ttype: this.#isMultiple() ? ListItem.Type.CHECKBOX : ListItem.Type.RADIO,\n\t\t\t\t\tdisabled: this.#isFieldDisabled(field),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#getDisabledFields(): SelectorOptions['disabledFields'] | null\n\t{\n\t\treturn this.#getOptions().disabledFields ?? null;\n\t}\n\n\t#isFieldDisabled(field: Field): boolean\n\t{\n\t\tconst disabledFields = this.#getDisabledFields();\n\t\tif (Type.isNull(disabledFields))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn disabledFields.some(fieldRule =>\n\t\t\t(Type.isString(fieldRule) && field.name === fieldRule)\n\t\t\t|| (Type.isFunction(fieldRule) && fieldRule(field)),\n\t\t);\n\t};\n\n\t#onListItemChange(event: BaseEvent)\n\t{\n\t\tconst listItem: ListItem = event.getTarget();\n\t\tif (this.#isMultiple())\n\t\t{\n\t\t\tif (listItem.isSelected())\n\t\t\t{\n\t\t\t\tthis.#addSelectedField(listItem.getField());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#removeSelectedField(listItem.getField());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setSelectedFields([listItem.getField()]);\n\t\t}\n\t}\n\n\t#onSidebarItemClick(categoryId: string)\n\t{\n\t\tthis.#renderCategoryFields(categoryId);\n\t}\n\n\t#onBackendError(error)\n\t{\n\t\tconsole.error(error);\n\t\tthis.emit('onError', {error});\n\t}\n\n\t#getLayout(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-form-fields-selector\">\n\t\t\t\t${this.#getFieldsListLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onSearchChange()\n\t{\n\t\tconst sliderLayout: Layout = await this.#getSliderLayout();\n\t\tconst sidebarItems = this.#getSidebarItems();\n\t\tsliderLayout.getMenu().setItems(sidebarItems);\n\n\t\tthis.#cleanFieldsList();\n\n\t\tconst [firstSidebarItem] = sidebarItems;\n\t\tif (firstSidebarItem)\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t\tsliderLayout.getMenu().setActiveFirstItem();\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(true);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSearch(): Search\n\t{\n\t\treturn this.#cache.remember('search', () => {\n\t\t\treturn new Search({\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: this.#onSearchChange.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getFieldsListLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('fieldsListLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-fields-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCreateFieldButton(): Button\n\t{\n\t\treturn this.#cache.remember('createFieldButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_CREATE_BUTTON_LABEL'),\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tonclick: this.#onCreateFieldClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tasync #onCreateFieldClick()\n\t{\n\t\tconst sliderLayout = await this.#getSliderLayout();\n\t\tconst sliderMenu = sliderLayout.getMenu();\n\t\tif (sliderMenu.hasActive())\n\t\t{\n\t\t\tconst currentCategoryId = sliderMenu.getActiveItem().getId();\n\t\t\tconst factory = this.#getUserFieldFactory(currentCategoryId);\n\t\t\tconst menu = factory.getMenu();\n\n\t\t\tmenu.open((selectedType) => {\n\t\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\t\tuserField: factory.createUserField(selectedType),\n\t\t\t\t\tonSave: (userField) => {\n\t\t\t\t\t\tDom.addClass(configurator.saveButton, 'ui-btn-wait');\n\n\t\t\t\t\t\treturn userField\n\t\t\t\t\t\t\t.save()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\treturn this.#load();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tDom.removeClass(configurator.saveButton, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t\t\t\tthis.#getSearch().setValue(\n\t\t\t\t\t\t\t\t\tuserField.getData().editFormLabel[Loc.getMessage('LANGUAGE_ID')],\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.#cleanFieldsList();\n\t\t\t\tDom.append(configurator.render(), this.#getFieldsListLayout());\n\t\t\t});\n\t\t}\n\t}\n\n\t#getPreparedCategoryId(categoryId: string): string | number\n\t{\n\t\tif (categoryId.startsWith('DYNAMIC_'))\n\t\t{\n\t\t\tconst fieldsList = this.getFieldsList();\n\t\t\tif (Type.isPlainObject(fieldsList[categoryId]))\n\t\t\t{\n\t\t\t\treturn fieldsList[categoryId].DYNAMIC_ID;\n\t\t\t}\n\t\t}\n\n\t\treturn `CRM_${categoryId}`;\n\t}\n\n\t#getFieldsFactoryTypesFilter(): FieldsFactoryFilter\n\t{\n\t\tdebugger;\n\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFieldsFactoryFilter);\n\t\tconst customFilter = this.#getOptions()?.fieldsFactory?.filter;\n\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tif (Type.isArrayFilled(customFilter['-types']))\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t\t...customFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn customFilter;\n\t\t}\n\n\t\tif (Type.isFunction(customFilter))\n\t\t{\n\t\t\treturn customFilter;\n\t\t}\n\n\t\treturn defaultFilter;\n\t}\n\n\t#applyFieldsFactoryTypesFilter(types, filter): Array<any>\n\t{\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\treturn types.filter((type) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+types'])\n\t\t\t\t\t|| filter['+types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-types'])\n\t\t\t\t\t&& filter['-types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\t\t}\n\n\t\treturn types;\n\t}\n\n\t#getUserFieldFactory(categoryId: string | number): Factory\n\t{\n\t\treturn this.#cache.remember(`factory_${categoryId}`, () => {\n\t\t\tconst rootWindow = window.top;\n\t\t\tconst Factory = (() => {\n\t\t\t\tif (rootWindow.BX.UI.UserFieldFactory)\n\t\t\t\t{\n\t\t\t\t\treturn rootWindow.BX.UI.UserFieldFactory.Factory\n\t\t\t\t}\n\n\t\t\t\treturn BX.UI.UserFieldFactory.Factory;\n\t\t\t})();\n\n\t\t\tconst factory = new Factory(\n\t\t\t\tthis.#getPreparedCategoryId(categoryId),\n\t\t\t\t{\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tbindElement: this.#getCreateFieldButton().render(),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst filter = this.#getFieldsFactoryTypesFilter();\n\t\t\tif (Type.isFunction(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tSelector.#defaultFieldsFactoryFilter,\n\t\t\t\t);\n\t\t\t\tfactory.types = filter(factory.types);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tfilter,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn factory;\n\t\t});\n\t}\n\n\t#getSliderLayout(): Promise<Layout>\n\t{\n\t\treturn this.#cache.remember('sliderLayout', () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tLayout\n\t\t\t\t\t.createLayout({\n\t\t\t\t\t\textensions: ['crm.form.fields.selector'],\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SLIDER_TITLE'),\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\treturn this.#getLayout();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\titems: this.#getSidebarItems(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: () => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tthis.#getSearch().getLayout(),\n\t\t\t\t\t\t\t\tthis.#getCreateFieldButton(),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({SaveButton, closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_APPLY_BUTTON_LABEL'),\n\t\t\t\t\t\t\t\t\tonclick: this.#onSaveClick.bind(this),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#getRenderedSliderLayout(): Promise<any>\n\t{\n\t\treturn this.#cache.remember('renderedSliderLayout', () => {\n\t\t\treturn this.#getSliderLayout().then((layout) => {\n\t\t\t\treturn layout.render();\n\t\t\t});\n\t\t});\n\t}\n\n\t#onSaveClick()\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst result = (() => {\n\t\t\tconst {resultModifier} = this.#getOptions();\n\t\t\tif (Type.isFunction(resultModifier))\n\t\t\t{\n\t\t\t\treturn resultModifier(selectedFields);\n\t\t\t}\n\n\t\t\treturn selectedFields.map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t});\n\t\t})();\n\n\t\tthis.#getPromiseResolver()(result);\n\t\tthis.hide();\n\t}\n\n\t#setPromiseResolver(resolver: () => void)\n\t{\n\t\tthis.#cache.set('promiseResolver', resolver);\n\t}\n\n\t#getPromiseResolver(): () => void\n\t{\n\t\treturn this.#cache.get('promiseResolver', () => {});\n\t}\n\n\t#selectFirstCategory()\n\t{\n\t\tconst [firstSidebarItem] = this.#getSidebarItems();\n\t\tif (Type.isPlainObject(firstSidebarItem))\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.close();\n\t\t}\n\t}\n\n\t#getSliderId(): string\n\t{\n\t\treturn this.#cache.remember('sliderId', () => {\n\t\t\treturn `crm.form.fields.selector-${Text.getRandom()}`\n\t\t});\n\t}\n\n\tshow(): Promise<Array<any>>\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tconst createFieldButton = this.#getCreateFieldButton();\n\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t);\n\n\t\t\tSidePanel.Instance.open(\n\t\t\t\tthis.#getSliderId(),\n\t\t\t\t{\n\t\t\t\t\twidth: 740,\n\t\t\t\t\tcontentCallback: () => {\n\t\t\t\t\t\treturn this.#load()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t\t\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tthis.#selectFirstCategory();\n\n\t\t\t\t\t\t\t\treturn this.#getRenderedSliderLayout();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(({errors}) => {\n\t\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t\t<div class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-alert-message\">${errors.map((item) => Text.encode(item.message)).join('\\n')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonCloseComplete: () => this.#onSliderCloseComplete(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#setPromiseResolver(resolve);\n\t\t});\n\t}\n\n\t#onSliderCloseComplete(): void\n\t{\n\t\tthis.emit('onSliderCloseComplete');\n\t\tthis.#setSelectedFields([]);\n\t}\n}\n"],"names":["Backend","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","getData","requestOptions","action","data","Promise","resolve","reject","ajax","runAction","json","then","catch","Search","Cache","MemoryCache","getValue","value","setValue","getLayout","remember","Tag","render","set","get","emit","Runtime","debounce","initialValue","Type","isStringFilled","bind","Text","encode","Loc","getMessage","event","preventDefault","ListItem","targetContainer","isDomNode","renderTo","getField","field","isSelected","checked","fieldDisabledClassName","caption","Dom","append","type","CHECKBOX","selected","disabled","RADIO","Selector","getFieldsList","fieldsList","filter","isPlainObject","query","isFunction","defaultFilter","clone","push","prefilteredFieldsList","hide","SidePanel","Reflection","getClass","Instance","close","show","createFieldButton","setDisabled","open","width","contentCallback","errors","map","item","message","join","onCloseComplete","multiple","onError","fieldsEntries","Object","entries","reduce","acc","categoryId","category","isArrayFilled","includes","filteredFields","FIELDS","allowed","some","condition","every","key","disallowed","preparedQuery","String","toLowerCase","controllerOptions","fields","isLeadEnabled","permissions","userField","add","label","CAPTION","id","onclick","customFilter","isArray","clean","selectedFields","hasField","currentField","name","forEach","onChange","selectedField","disabledFields","isNull","fieldRule","isString","listItem","getTarget","error","console","sliderLayout","sidebarItems","getMenu","setItems","firstSidebarItem","setActiveFirstItem","Button","text","color","Color","SUCCESS","sliderMenu","hasActive","currentCategoryId","getActiveItem","getId","factory","menu","selectedType","configurator","getConfigurator","createUserField","onSave","addClass","saveButton","save","removeClass","editFormLabel","onCancel","startsWith","DYNAMIC_ID","fieldsFactory","types","rootWindow","window","top","Factory","BX","UI","UserFieldFactory","moduleId","bindElement","Layout","createLayout","extensions","title","content","items","toolbar","buttons","SaveButton","closeButton","result","layout","resultModifier","resolver","getRandom"],"mappings":"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"}