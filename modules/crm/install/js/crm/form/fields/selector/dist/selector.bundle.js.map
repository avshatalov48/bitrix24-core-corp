{"version":3,"file":"selector.bundle.js","sources":["../src/backend/backend.js","../src/search/search.js","../src/list-item/list-item.js","../src/selector.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {ajax} from 'main.core';\n\ntype BackendOptions = {\n\tevents: {\n\t\tonError: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Backend extends EventEmitter\n{\n\tconstructor(options: BackendOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Backend');\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\t#request(requestOptions: {action: string, data: {[key: string]: any}}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction(\n\t\t\t\t\t`crm.api.form.fields.selector.${requestOptions.action}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: requestOptions.data,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject);\n\t\t});\n\t}\n\n\tgetData(requestOptions = {}): Promise<any>\n\t{\n\t\treturn this.#request({\n\t\t\taction: 'getData',\n\t\t\tdata: requestOptions,\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Runtime, Text, Type, Loc} from 'main.core';\n\nimport './css/style.css';\n\ntype SearchOptions = {\n\tinitialValue?: string,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t\tonDebouncedChange?: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Search extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: SearchOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Search');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SearchOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\t#getOptions(): SearchOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#onInput()\n\t{\n\t\tthis.emit('onChange', {value: this.#getInput().value});\n\t\tthis.#getDebounceWrapper()();\n\t}\n\n\t#getDebounceWrapper(): () => void\n\t{\n\t\treturn this.#cache.remember('debounceWrapper', () => {\n\t\t\treturn Runtime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\tthis.emit('onDebouncedChange', {value: this.#getInput().value});\n\t\t\t\t},\n\t\t\t\t50,\n\t\t\t)\n\t\t});\n\t}\n\n\t#getInput(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('input', () => {\n\t\t\tconst initialValue = (() => {\n\t\t\t\tif (Type.isStringFilled(this.#getOptions().initialValue))\n\t\t\t\t{\n\t\t\t\t\treturn this.#getOptions().initialValue;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\toninput=\"${this.#onInput.bind(this)}\"\n\t\t\t\t\tvalue=\"${Text.encode(initialValue)}\"\n\t\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SEARCH_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#getInput().value;\n\t}\n\n\t#onClearClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#getInput().value = '';\n\t\tthis.#onInput();\n\t}\n\n\tsetValue(value: string)\n\t{\n\t\tthis.#getInput().value = Text.encode(value);\n\t\tthis.#onInput();\n\t}\n\n\t#getClearButton(): HTMLButtonElement\n\t{\n\t\treturn this.#cache.remember('clearButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button \n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\" \n\t\t\t\t\tonclick=\"${this.#onClearClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-search\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t${this.#getClearButton()}\n\t\t\t\t\t\t${this.#getInput()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Dom, Text, Type} from 'main.core';\n\nimport {type Field} from '../types/field';\n\nimport './css/style.css';\n\ntype ListItemOptions = {\n\tfield: Field,\n\tselected?: boolean,\n\ttargetContainer?: HTMLElement,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t},\n\ttype: $Values<ListItem.Type>,\n};\n\nexport default class ListItem extends EventEmitter\n{\n\tstatic Type = {\n\t\tCHECKBOX: 'checkbox',\n\t\tRADIO: 'radio',\n\t};\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: ListItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Field.Selector.ListItem');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\n\t\tconst {targetContainer} = options;\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tthis.renderTo(targetContainer);\n\t\t}\n\t}\n\n\t#setOptions(options: ListItemOptions)\n\t{\n\t\tthis.#cache.set('options', {type: ListItem.Type.CHECKBOX, ...options});\n\t}\n\n\t#getOptions(): ListItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetField(): Field\n\t{\n\t\treturn this.#getOptions().field;\n\t}\n\n\t#onChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\t#getCheckbox(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('checkbox', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"${Text.encode(this.#getOptions().type)}\" \n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tonchange=\"${this.#onChange.bind(this)}\"\n\t\t\t\t\tname=\"CRM_FIELDS_SELECTOR_ITEM\"\n\t\t\t\t\t${this.#getOptions().selected ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisSelected(): boolean\n\t{\n\t\treturn this.#getCheckbox().checked;\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-field\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox crm-form-fields-selector-field-checkbox\">\n\t\t\t\t\t\t${this.#getCheckbox()}\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(this.#getOptions().field.caption)}</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(targetContainer: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tDom.append(this.getLayout(), targetContainer);\n\t\t}\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Type, Dom, Reflection, Runtime, Tag, Loc, Text} from 'main.core';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Factory} from 'ui.userfieldfactory';\nimport {Button} from 'ui.buttons';\n\nimport Backend from './backend/backend';\nimport Search from './search/search';\nimport ListItem from './list-item/list-item';\n\nimport type {SelectorOptions, SelectorFilter, FieldsFactoryFilter} from './types/selector-options';\nimport type {FieldsList} from './types/fields-list';\nimport type {Field} from './types/field';\n\nimport './css/style.css';\n\n/**\n * @memberOf BX.Crm.Form.Fields\n */\nexport class Selector extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tstatic #defaultFilter = {\n\t\t'-categories': [\n\t\t\t'CATALOG',\n\t\t\t'ACTIVITY',\n\t\t\t'INVOICE',\n\t\t],\n\t\t'-fields': [\n\t\t\t{name: 'CONTACT_ORIGIN_VERSION'},\n\t\t\t{name: 'CONTACT_LINK'},\n\t\t],\n\t};\n\n\tstatic #defaultFieldsFactoryFilter = {\n\t\t'-types': ['employee'],\n\t};\n\n\tconstructor(options: SelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SelectorOptions)\n\t{\n\t\tthis.#cache.set(\n\t\t\t'options',\n\t\t\t{\n\t\t\t\tfilter: {},\n\t\t\t\tmultiple: true,\n\t\t\t\t...options,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getOptions(): SelectorOptions\n\t{\n\t\treturn Runtime.clone(this.#cache.get('options', {filter: {}}));\n\t}\n\n\t#getBackend(): Backend\n\t{\n\t\treturn this.#cache.remember('backend', () => {\n\t\t\treturn new Backend({\n\t\t\t\tevents: {\n\t\t\t\t\tonError: this.#onBackendError.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#setFieldsList(fieldsList: FieldsList)\n\t{\n\t\tthis.#cache.set('fieldsList', {...fieldsList});\n\t}\n\n\t#applyCategoriesFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t!Type.isArrayFilled(filter['+categories'])\n\t\t\t\t\t|| filter['+categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t\t&& (\n\t\t\t\t\t!Type.isArrayFilled(filter['-categories'])\n\t\t\t\t\t|| !filter['-categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tacc[categoryId] = category;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applyFieldsFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+fields'])\n\t\t\t\t\t|| filter['+fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-fields'])\n\t\t\t\t\t&& filter['-fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t{\n\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t...category,\n\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applySearchFilter(fieldsList: FieldsList, query): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\t\tif (Type.isStringFilled(query))\n\t\t{\n\t\t\tconst preparedQuery = String(query).toLowerCase();\n\t\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isStringFilled(field.caption)\n\t\t\t\t\t\t&& String(field.caption).toLowerCase().includes(preparedQuery)\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t{\n\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t...category,\n\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#getFieldsList(): FieldsList\n\t{\n\t\tconst fieldsList = this.#cache.get('fieldsList', {});\n\n\t\tconst filter = this.#getFilter();\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\tconst query = this.#getSearch().getValue();\n\t\t\treturn this.#applySearchFilter(\n\t\t\t\tthis.#applyFieldsFilter(\n\t\t\t\t\tthis.#applyCategoriesFilter(fieldsList, filter),\n\t\t\t\t\tfilter,\n\t\t\t\t),\n\t\t\t\tquery,\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isFunction(filter))\n\t\t{\n\t\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFilter);\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tdefaultFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tconst prefilteredFieldsList = this.#applyFieldsFilter(\n\t\t\t\tthis.#applyCategoriesFilter(fieldsList, defaultFilter),\n\t\t\t\tfilter,\n\t\t\t);\n\n\t\t\treturn filter(Runtime.clone(prefilteredFieldsList));\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#load(): Promise<any>\n\t{\n\t\tconst {controllerOptions = {}} = this.#getOptions();\n\t\treturn this.#getBackend()\n\t\t\t.getData({options: controllerOptions})\n\t\t\t.then(({data}) => {\n\t\t\t\tthis.#setFieldsList(data.fields);\n\t\t\t\tthis.#setIsLeadEnabled(data.options.isLeadEnabled);\n\t\t\t\tthis.#setIsAllowedCreateField(data.options.permissions.userField.add);\n\t\t\t});\n\t}\n\n\t#setIsLeadEnabled(value: boolean)\n\t{\n\t\tthis.#cache.set('isLeadEnabled', value);\n\t}\n\n\t#isLeadEnabled(): boolean\n\t{\n\t\treturn this.#cache.get('isLeadEnabled');\n\t}\n\n\t#setIsAllowedCreateField(value: boolean)\n\t{\n\t\tthis.#cache.set('isAllowedCreateField', value);\n\t}\n\n\t#isAllowedCreateField(): boolean\n\t{\n\t\treturn this.#cache.get('isAllowedCreateField', false);\n\t}\n\n\t#getSidebarItems(): {[key: string]: any}\n\t{\n\t\treturn Object\n\t\t\t.entries(this.#getFieldsList())\n\t\t\t.map(([categoryId, category]) => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: category.CAPTION,\n\t\t\t\t\tid: categoryId,\n\t\t\t\t\tonclick: this.#onSidebarItemClick.bind(this, categoryId),\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t#getFilter(): SelectorFilter\n\t{\n\t\tconst customFilter = this.#getOptions().filter;\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tconst defaultFilter = Selector.#defaultFilter;\n\n\t\t\tif (Type.isArray(customFilter['-categories']))\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...customFilter['-categories'],\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tif (Type.isArray(customFilter['-fields']))\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...customFilter['-fields'],\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn customFilter;\n\t}\n\n\t#cleanFieldsList()\n\t{\n\t\tDom.clean(this.#getFieldsListLayout());\n\t}\n\n\t#getSelectedFields(): Array<Field>\n\t{\n\t\treturn this.#cache.get('selectedFields', []);\n\t}\n\n\t#addSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst hasField = selectedFields.some((currentField) => {\n\t\t\treturn currentField.name === field.name;\n\t\t});\n\n\t\tif (!hasField)\n\t\t{\n\t\t\tselectedFields.push(field);\n\t\t\tthis.#setSelectedFields(selectedFields);\n\t\t}\n\t}\n\n\t#removeSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields().filter((currentField) => {\n\t\t\treturn currentField.name !== field.name;\n\t\t});\n\n\t\tthis.#setSelectedFields(selectedFields);\n\t}\n\n\t#setSelectedFields(fields: Array<Field>)\n\t{\n\t\tthis.#cache.set('selectedFields', fields);\n\t}\n\n\t#isMultiple(): boolean\n\t{\n\t\treturn this.#getOptions().multiple;\n\t}\n\n\t#renderCategoryFields(categoryId: string)\n\t{\n\t\tthis.#cleanFieldsList();\n\n\t\tconst fields = this.#getFieldsList()[categoryId].FIELDS;\n\t\tif (Type.isArrayFilled(fields))\n\t\t{\n\t\t\tfields.forEach((field) => {\n\t\t\t\tvoid new ListItem({\n\t\t\t\t\tfield,\n\t\t\t\t\ttargetContainer: this.#getFieldsListLayout(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonChange: this.#onListItemChange.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tselected: this.#getSelectedFields().some((selectedField) => {\n\t\t\t\t\t\treturn selectedField.name === field.name;\n\t\t\t\t\t}),\n\t\t\t\t\ttype: this.#isMultiple() ? ListItem.Type.CHECKBOX : ListItem.Type.RADIO,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#onListItemChange(event: BaseEvent)\n\t{\n\t\tconst listItem: ListItem = event.getTarget();\n\t\tif (this.#isMultiple())\n\t\t{\n\t\t\tif (listItem.isSelected())\n\t\t\t{\n\t\t\t\tthis.#addSelectedField(listItem.getField());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#removeSelectedField(listItem.getField());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setSelectedFields([listItem.getField()]);\n\t\t}\n\t}\n\n\t#onSidebarItemClick(categoryId: string)\n\t{\n\t\tthis.#renderCategoryFields(categoryId);\n\t}\n\n\t#onBackendError(error)\n\t{\n\t\tconsole.error(error);\n\t\tthis.emit('onError', {error});\n\t}\n\n\t#getLayout(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-form-fields-selector\">\n\t\t\t\t${this.#getFieldsListLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onSearchChange()\n\t{\n\t\tconst sliderLayout: Layout = await this.#getSliderLayout();\n\t\tconst sidebarItems = this.#getSidebarItems();\n\t\tsliderLayout.getMenu().setItems(sidebarItems);\n\n\t\tthis.#cleanFieldsList();\n\n\t\tconst [firstSidebarItem] = sidebarItems;\n\t\tif (firstSidebarItem)\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t\tsliderLayout.getMenu().setActiveFirstItem();\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(true);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSearch(): Search\n\t{\n\t\treturn this.#cache.remember('search', () => {\n\t\t\treturn new Search({\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: this.#onSearchChange.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getFieldsListLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('fieldsListLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-fields-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCreateFieldButton(): Button\n\t{\n\t\treturn this.#cache.remember('createFieldButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_CREATE_BUTTON_LABEL'),\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tonclick: this.#onCreateFieldClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tasync #onCreateFieldClick()\n\t{\n\t\tconst sliderLayout = await this.#getSliderLayout();\n\t\tconst sliderMenu = sliderLayout.getMenu();\n\t\tif (sliderMenu.hasActive())\n\t\t{\n\t\t\tconst currentCategoryId = sliderMenu.getActiveItem().getId();\n\t\t\tconst factory = this.#getUserFieldFactory(currentCategoryId);\n\t\t\tconst menu = factory.getMenu();\n\n\t\t\tmenu.open((selectedType) => {\n\t\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\t\tuserField: factory.createUserField(selectedType),\n\t\t\t\t\tonSave: (userField) => {\n\t\t\t\t\t\tDom.addClass(configurator.saveButton, 'ui-btn-wait');\n\n\t\t\t\t\t\treturn userField\n\t\t\t\t\t\t\t.save()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\treturn this.#load();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tDom.removeClass(configurator.saveButton, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t\t\t\tthis.#getSearch().setValue(\n\t\t\t\t\t\t\t\t\tuserField.getData().editFormLabel[Loc.getMessage('LANGUAGE_ID')],\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.#cleanFieldsList();\n\t\t\t\tDom.append(configurator.render(), this.#getFieldsListLayout());\n\t\t\t});\n\t\t}\n\t}\n\n\t#getPreparedCategoryId(categoryId: string): string | number\n\t{\n\t\tif (categoryId.startsWith('DYNAMIC_'))\n\t\t{\n\t\t\tconst fieldsList = this.#getFieldsList();\n\t\t\tif (Type.isPlainObject(fieldsList[categoryId]))\n\t\t\t{\n\t\t\t\treturn fieldsList[categoryId].DYNAMIC_ID;\n\t\t\t}\n\t\t}\n\n\t\treturn `CRM_${categoryId}`;\n\t}\n\n\t#getFieldsFactoryTypesFilter(): FieldsFactoryFilter\n\t{\n\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFieldsFactoryFilter);\n\t\tconst customFilter = this.#getOptions()?.fieldsFactory?.filter;\n\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tif (Type.isArrayFilled(customFilter['-types']))\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t\t...customFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn customFilter;\n\t\t}\n\n\t\tif (Type.isFunction(customFilter))\n\t\t{\n\t\t\treturn customFilter;\n\t\t}\n\n\t\treturn defaultFilter;\n\t}\n\n\t#applyFieldsFactoryTypesFilter(types, filter): Array<any>\n\t{\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\treturn types.filter((type) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+types'])\n\t\t\t\t\t|| filter['+types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-types'])\n\t\t\t\t\t&& filter['-types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\t\t}\n\n\t\treturn types;\n\t}\n\n\t#getUserFieldFactory(categoryId: string | number): Factory\n\t{\n\t\treturn this.#cache.remember(`factory_${categoryId}`, () => {\n\t\t\tconst rootWindow = window.top;\n\t\t\tconst Factory = (() => {\n\t\t\t\tif (rootWindow.BX.UI.UserFieldFactory)\n\t\t\t\t{\n\t\t\t\t\treturn rootWindow.BX.UI.UserFieldFactory.Factory\n\t\t\t\t}\n\n\t\t\t\treturn BX.UI.UserFieldFactory.Factory;\n\t\t\t})();\n\n\t\t\tconst factory = new Factory(\n\t\t\t\tthis.#getPreparedCategoryId(categoryId),\n\t\t\t\t{\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tbindElement: this.#getCreateFieldButton().render(),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst filter = this.#getFieldsFactoryTypesFilter();\n\t\t\tif (Type.isFunction(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tSelector.defaultFieldsFactoryFilter,\n\t\t\t\t);\n\t\t\t\tfactory.types = filter(factory.types);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tfilter,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn factory;\n\t\t});\n\t}\n\n\t#getSliderLayout(): Promise<Layout>\n\t{\n\t\treturn this.#cache.remember('sliderLayout', () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tLayout\n\t\t\t\t\t.createLayout({\n\t\t\t\t\t\textensions: ['crm.form.fields.selector'],\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SLIDER_TITLE'),\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\treturn this.#getLayout();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\titems: this.#getSidebarItems(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: () => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tthis.#getSearch().getLayout(),\n\t\t\t\t\t\t\t\tthis.#getCreateFieldButton(),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({SaveButton, closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_APPLY_BUTTON_LABEL'),\n\t\t\t\t\t\t\t\t\tonclick: this.#onSaveClick.bind(this),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#getRenderedSliderLayout(): Promise<any>\n\t{\n\t\treturn this.#cache.remember('renderedSliderLayout', () => {\n\t\t\treturn this.#getSliderLayout().then((layout) => {\n\t\t\t\treturn layout.render();\n\t\t\t});\n\t\t});\n\t}\n\n\t#onSaveClick()\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst result = (() => {\n\t\t\tconst {resultModifier} = this.#getOptions();\n\t\t\tif (Type.isFunction(resultModifier))\n\t\t\t{\n\t\t\t\treturn resultModifier(selectedFields);\n\t\t\t}\n\n\t\t\treturn selectedFields.map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t});\n\t\t})();\n\n\t\tthis.#getPromiseResolver()(result);\n\t\tthis.hide();\n\t}\n\n\t#setPromiseResolver(resolver: () => void)\n\t{\n\t\tthis.#cache.set('promiseResolver', resolver);\n\t}\n\n\t#getPromiseResolver(): () => void\n\t{\n\t\treturn this.#cache.get('promiseResolver', () => {});\n\t}\n\n\t#selectFirstCategory()\n\t{\n\t\tconst [firstSidebarItem] = this.#getSidebarItems();\n\t\tif (Type.isPlainObject(firstSidebarItem))\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.close();\n\t\t}\n\t}\n\n\t#getSliderId(): string\n\t{\n\t\treturn this.#cache.remember('sliderId', () => {\n\t\t\treturn `crm.form.fields.selector-${Text.getRandom()}`\n\t\t});\n\t}\n\n\tshow(): Promise<Array<any>>\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tconst createFieldButton = this.#getCreateFieldButton();\n\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t);\n\n\t\t\tSidePanel.Instance.open(\n\t\t\t\tthis.#getSliderId(),\n\t\t\t\t{\n\t\t\t\t\twidth: 740,\n\t\t\t\t\tcontentCallback: () => {\n\t\t\t\t\t\treturn this.#load()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t\t\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tthis.#selectFirstCategory();\n\n\t\t\t\t\t\t\t\treturn this.#getRenderedSliderLayout();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(({errors}) => {\n\t\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t\t<div class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-alert-message\">${errors.map((item) => Text.encode(item.message)).join('\\n')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.#setSelectedFields([]);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#setPromiseResolver(resolve);\n\t\t});\n\t}\n}"],"names":["Backend","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","getData","requestOptions","action","data","Promise","resolve","reject","ajax","runAction","json","then","catch","Search","Cache","MemoryCache","getValue","value","setValue","Text","encode","getLayout","remember","Tag","render","set","get","emit","Runtime","debounce","initialValue","Type","isStringFilled","bind","Loc","getMessage","event","preventDefault","ListItem","targetContainer","isDomNode","renderTo","getField","field","isSelected","checked","caption","Dom","append","type","CHECKBOX","selected","RADIO","Selector","hide","SidePanel","Reflection","getClass","Instance","close","show","createFieldButton","setDisabled","open","width","contentCallback","errors","map","item","message","join","onClose","filter","multiple","clone","onError","fieldsList","fieldsEntries","Object","entries","reduce","acc","categoryId","category","isArrayFilled","includes","filteredFields","FIELDS","allowed","some","condition","isFunction","isPlainObject","every","key","disallowed","query","preparedQuery","String","toLowerCase","defaultFilter","push","prefilteredFieldsList","controllerOptions","fields","isLeadEnabled","permissions","userField","add","label","CAPTION","id","onclick","customFilter","isArray","clean","selectedFields","hasField","currentField","name","forEach","onChange","selectedField","listItem","getTarget","error","console","sliderLayout","sidebarItems","getMenu","setItems","firstSidebarItem","setActiveFirstItem","Button","text","color","Color","SUCCESS","sliderMenu","hasActive","currentCategoryId","getActiveItem","getId","factory","menu","selectedType","configurator","getConfigurator","createUserField","onSave","addClass","saveButton","save","removeClass","editFormLabel","onCancel","startsWith","DYNAMIC_ID","fieldsFactory","types","rootWindow","window","top","Factory","BX","UI","UserFieldFactory","moduleId","bindElement","defaultFieldsFactoryFilter","Layout","createLayout","extensions","title","content","items","toolbar","buttons","SaveButton","closeButton","result","layout","resultModifier","resolver","getRandom"],"mappings":"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"}