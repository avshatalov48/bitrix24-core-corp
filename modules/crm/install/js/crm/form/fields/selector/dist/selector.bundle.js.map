{"version":3,"file":"selector.bundle.js","sources":["../src/backend/backend.js","../src/search/search.js","../src/list-item/list-item.js","../src/selector.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {ajax} from 'main.core';\n\ntype BackendOptions = {\n\tevents: {\n\t\tonError: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Backend extends EventEmitter\n{\n\tconstructor(options: BackendOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Backend');\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\t#request(requestOptions: {action: string, data: {[key: string]: any}}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction(\n\t\t\t\t\t`crm.api.form.fields.selector.${requestOptions.action}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: requestOptions.data,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject);\n\t\t});\n\t}\n\n\tgetData(requestOptions = {}): Promise<any>\n\t{\n\t\treturn this.#request({\n\t\t\taction: 'getData',\n\t\t\tdata: requestOptions,\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Runtime, Text, Type, Loc} from 'main.core';\n\nimport './css/style.css';\n\ntype SearchOptions = {\n\tinitialValue?: string,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t\tonDebouncedChange?: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Search extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: SearchOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector.Search');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SearchOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\t#getOptions(): SearchOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#onInput()\n\t{\n\t\tthis.emit('onChange', {value: this.#getInput().value});\n\t\tthis.#getDebounceWrapper()();\n\t}\n\n\t#getDebounceWrapper(): () => void\n\t{\n\t\treturn this.#cache.remember('debounceWrapper', () => {\n\t\t\treturn Runtime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\tthis.emit('onDebouncedChange', {value: this.#getInput().value});\n\t\t\t\t},\n\t\t\t\t50,\n\t\t\t)\n\t\t});\n\t}\n\n\t#getInput(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('input', () => {\n\t\t\tconst initialValue = (() => {\n\t\t\t\tif (Type.isStringFilled(this.#getOptions().initialValue))\n\t\t\t\t{\n\t\t\t\t\treturn this.#getOptions().initialValue;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\toninput=\"${this.#onInput.bind(this)}\"\n\t\t\t\t\tvalue=\"${Text.encode(initialValue)}\"\n\t\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SEARCH_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#getInput().value;\n\t}\n\n\t#onClearClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#getInput().value = '';\n\t\tthis.#onInput();\n\t}\n\n\tsetValue(value: string)\n\t{\n\t\tthis.#getInput().value = Text.encode(value);\n\t\tthis.#onInput();\n\t}\n\n\t#getClearButton(): HTMLButtonElement\n\t{\n\t\treturn this.#cache.remember('clearButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button \n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\" \n\t\t\t\t\tonclick=\"${this.#onClearClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-search\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t${this.#getClearButton()}\n\t\t\t\t\t\t${this.#getInput()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Dom, Text, Type} from 'main.core';\n\nimport {type Field} from '../types/field';\n\nimport './css/style.css';\n\ntype ListItemOptions = {\n\tfield: Field,\n\tselected?: boolean,\n\ttargetContainer?: HTMLElement,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t},\n\ttype: $Values<ListItem.Type>,\n};\n\nexport default class ListItem extends EventEmitter\n{\n\tstatic Type = {\n\t\tCHECKBOX: 'checkbox',\n\t\tRADIO: 'radio',\n\t};\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: ListItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Field.Selector.ListItem');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\n\t\tconst {targetContainer} = options;\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tthis.renderTo(targetContainer);\n\t\t}\n\t}\n\n\t#setOptions(options: ListItemOptions)\n\t{\n\t\tthis.#cache.set('options', {type: ListItem.Type.CHECKBOX, ...options});\n\t}\n\n\t#getOptions(): ListItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetField(): Field\n\t{\n\t\treturn this.#getOptions().field;\n\t}\n\n\t#onChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\t#getCheckbox(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('checkbox', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"${Text.encode(this.#getOptions().type)}\" \n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tonchange=\"${this.#onChange.bind(this)}\"\n\t\t\t\t\tname=\"CRM_FIELDS_SELECTOR_ITEM\"\n\t\t\t\t\t${this.#getOptions().selected ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisSelected(): boolean\n\t{\n\t\treturn this.#getCheckbox().checked;\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-field\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox crm-form-fields-selector-field-checkbox\">\n\t\t\t\t\t\t${this.#getCheckbox()}\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(this.#getOptions().field.caption)}</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(targetContainer: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tDom.append(this.getLayout(), targetContainer);\n\t\t}\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Type, Dom, Reflection, Runtime, Tag, Loc, Text} from 'main.core';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Factory} from 'ui.userfieldfactory';\nimport {Button} from 'ui.buttons';\n\nimport Backend from './backend/backend';\nimport Search from './search/search';\nimport ListItem from './list-item/list-item';\n\nimport type {SelectorOptions, SelectorFilter, FieldsFactoryFilter} from './types/selector-options';\nimport type {FieldsList} from './types/fields-list';\nimport type {Field} from './types/field';\n\nimport './css/style.css';\n\n/**\n * @memberOf BX.Crm.Form.Fields\n */\nexport class Selector extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tstatic #defaultFilter = {\n\t\t'-categories': [\n\t\t\t'CATALOG',\n\t\t\t'ACTIVITY',\n\t\t\t'INVOICE',\n\t\t],\n\t\t'-fields': [\n\t\t\t{name: 'CONTACT_ORIGIN_VERSION'},\n\t\t\t{name: 'CONTACT_LINK'},\n\t\t],\n\t};\n\n\tstatic #defaultFieldsFactoryFilter = {\n\t\t'-types': ['employee'],\n\t};\n\n\tconstructor(options: SelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Form.Fields.Selector');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SelectorOptions)\n\t{\n\t\tthis.#cache.set(\n\t\t\t'options',\n\t\t\t{\n\t\t\t\tfilter: {},\n\t\t\t\tmultiple: true,\n\t\t\t\t...options,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getOptions(): SelectorOptions\n\t{\n\t\treturn Runtime.clone(this.#cache.get('options', {filter: {}}));\n\t}\n\n\t#getBackend(): Backend\n\t{\n\t\treturn this.#cache.remember('backend', () => {\n\t\t\treturn new Backend({\n\t\t\t\tevents: {\n\t\t\t\t\tonError: this.#onBackendError.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#setFieldsList(fieldsList: FieldsList)\n\t{\n\t\tthis.#cache.set('fieldsList', {...fieldsList});\n\t}\n\n\t#applyCategoriesFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t!Type.isArrayFilled(filter['+categories'])\n\t\t\t\t\t|| filter['+categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t\t&& (\n\t\t\t\t\t!Type.isArrayFilled(filter['-categories'])\n\t\t\t\t\t|| !filter['-categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tacc[categoryId] = category;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applyFieldsFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+fields'])\n\t\t\t\t\t|| filter['+fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-fields'])\n\t\t\t\t\t&& filter['-fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t{\n\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t...category,\n\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applySearchFilter(fieldsList: FieldsList, query): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\t\tif (Type.isStringFilled(query))\n\t\t{\n\t\t\tconst preparedQuery = String(query).toLowerCase();\n\t\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isStringFilled(field.caption)\n\t\t\t\t\t\t&& String(field.caption).toLowerCase().includes(preparedQuery)\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t{\n\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t...category,\n\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#getFieldsList(): FieldsList\n\t{\n\t\tconst fieldsList = this.#cache.get('fieldsList', {});\n\n\t\tconst filter = this.#getFilter();\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\tconst query = this.#getSearch().getValue();\n\t\t\treturn this.#applySearchFilter(\n\t\t\t\tthis.#applyFieldsFilter(\n\t\t\t\t\tthis.#applyCategoriesFilter(fieldsList, filter),\n\t\t\t\t\tfilter,\n\t\t\t\t),\n\t\t\t\tquery,\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isFunction(filter))\n\t\t{\n\t\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFilter);\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tdefaultFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tconst prefilteredFieldsList = this.#applyFieldsFilter(\n\t\t\t\tthis.#applyCategoriesFilter(fieldsList, defaultFilter),\n\t\t\t\tfilter,\n\t\t\t);\n\n\t\t\treturn filter(Runtime.clone(prefilteredFieldsList));\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#load(): Promise<any>\n\t{\n\t\tconst {controllerOptions = {}} = this.#getOptions();\n\t\treturn this.#getBackend()\n\t\t\t.getData({options: controllerOptions})\n\t\t\t.then(({data}) => {\n\t\t\t\tthis.#setFieldsList(data.fields);\n\t\t\t\tthis.#setIsLeadEnabled(data.options.isLeadEnabled);\n\t\t\t\tthis.#setIsAllowedCreateField(data.options.permissions.userField.add);\n\t\t\t});\n\t}\n\n\t#setIsLeadEnabled(value: boolean)\n\t{\n\t\tthis.#cache.set('isLeadEnabled', value);\n\t}\n\n\t#isLeadEnabled(): boolean\n\t{\n\t\treturn this.#cache.get('isLeadEnabled');\n\t}\n\n\t#setIsAllowedCreateField(value: boolean)\n\t{\n\t\tthis.#cache.set('isAllowedCreateField', value);\n\t}\n\n\t#isAllowedCreateField(): boolean\n\t{\n\t\treturn this.#cache.get('isAllowedCreateField', false);\n\t}\n\n\t#getSidebarItems(): {[key: string]: any}\n\t{\n\t\treturn Object\n\t\t\t.entries(this.#getFieldsList())\n\t\t\t.map(([categoryId, category]) => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: category.CAPTION,\n\t\t\t\t\tid: categoryId,\n\t\t\t\t\tonclick: this.#onSidebarItemClick.bind(this, categoryId),\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t#getFilter(): SelectorFilter\n\t{\n\t\tconst customFilter = this.#getOptions().filter;\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tconst defaultFilter = Selector.#defaultFilter;\n\n\t\t\tif (Type.isArray(customFilter['-categories']))\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...customFilter['-categories'],\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tif (Type.isArray(customFilter['-fields']))\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...customFilter['-fields'],\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn customFilter;\n\t}\n\n\t#cleanFieldsList()\n\t{\n\t\tDom.clean(this.#getFieldsListLayout());\n\t}\n\n\t#getSelectedFields(): Array<Field>\n\t{\n\t\treturn this.#cache.get('selectedFields', []);\n\t}\n\n\t#addSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst hasField = selectedFields.some((currentField) => {\n\t\t\treturn currentField.name === field.name;\n\t\t});\n\n\t\tif (!hasField)\n\t\t{\n\t\t\tselectedFields.push(field);\n\t\t\tthis.#setSelectedFields(selectedFields);\n\t\t}\n\t}\n\n\t#removeSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields().filter((currentField) => {\n\t\t\treturn currentField.name !== field.name;\n\t\t});\n\n\t\tthis.#setSelectedFields(selectedFields);\n\t}\n\n\t#setSelectedFields(fields: Array<Field>)\n\t{\n\t\tthis.#cache.set('selectedFields', fields);\n\t}\n\n\t#isMultiple(): boolean\n\t{\n\t\treturn this.#getOptions().multiple;\n\t}\n\n\t#renderCategoryFields(categoryId: string)\n\t{\n\t\tthis.#cleanFieldsList();\n\n\t\tconst fields = this.#getFieldsList()[categoryId].FIELDS;\n\t\tif (Type.isArrayFilled(fields))\n\t\t{\n\t\t\tfields.forEach((field) => {\n\t\t\t\tvoid new ListItem({\n\t\t\t\t\tfield,\n\t\t\t\t\ttargetContainer: this.#getFieldsListLayout(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonChange: this.#onListItemChange.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tselected: this.#getSelectedFields().some((selectedField) => {\n\t\t\t\t\t\treturn selectedField.name === field.name;\n\t\t\t\t\t}),\n\t\t\t\t\ttype: this.#isMultiple() ? ListItem.Type.CHECKBOX : ListItem.Type.RADIO,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#onListItemChange(event: BaseEvent)\n\t{\n\t\tconst listItem: ListItem = event.getTarget();\n\t\tif (this.#isMultiple())\n\t\t{\n\t\t\tif (listItem.isSelected())\n\t\t\t{\n\t\t\t\tthis.#addSelectedField(listItem.getField());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#removeSelectedField(listItem.getField());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setSelectedFields([listItem.getField()]);\n\t\t}\n\t}\n\n\t#onSidebarItemClick(categoryId: string)\n\t{\n\t\tthis.#renderCategoryFields(categoryId);\n\t}\n\n\t#onBackendError(error)\n\t{\n\t\tconsole.error(error);\n\t\tthis.emit('onError', {error});\n\t}\n\n\t#getLayout(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-form-fields-selector\">\n\t\t\t\t${this.#getFieldsListLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onSearchChange()\n\t{\n\t\tconst sliderLayout: Layout = await this.#getSliderLayout();\n\t\tconst sidebarItems = this.#getSidebarItems();\n\t\tsliderLayout.getMenu().setItems(sidebarItems);\n\n\t\tthis.#cleanFieldsList();\n\n\t\tconst [firstSidebarItem] = sidebarItems;\n\t\tif (firstSidebarItem)\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t\tsliderLayout.getMenu().setActiveFirstItem();\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(true);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSearch(): Search\n\t{\n\t\treturn this.#cache.remember('search', () => {\n\t\t\treturn new Search({\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: this.#onSearchChange.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getFieldsListLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('fieldsListLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-form-fields-selector-fields-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCreateFieldButton(): Button\n\t{\n\t\treturn this.#cache.remember('createFieldButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_CREATE_BUTTON_LABEL'),\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tonclick: this.#onCreateFieldClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tasync #onCreateFieldClick()\n\t{\n\t\tconst sliderLayout = await this.#getSliderLayout();\n\t\tconst sliderMenu = sliderLayout.getMenu();\n\t\tif (sliderMenu.hasActive())\n\t\t{\n\t\t\tconst currentCategoryId = sliderMenu.getActiveItem().getId();\n\t\t\tconst factory = this.#getUserFieldFactory(currentCategoryId);\n\t\t\tconst menu = factory.getMenu();\n\n\t\t\tmenu.open((selectedType) => {\n\t\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\t\tuserField: factory.createUserField(selectedType),\n\t\t\t\t\tonSave: (userField) => {\n\t\t\t\t\t\tDom.addClass(configurator.saveButton, 'ui-btn-wait');\n\n\t\t\t\t\t\treturn userField\n\t\t\t\t\t\t\t.save()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\treturn this.#load();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tDom.removeClass(configurator.saveButton, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t\t\t\tthis.#getSearch().setValue(\n\t\t\t\t\t\t\t\t\tuserField.getData().editFormLabel[Loc.getMessage('LANGUAGE_ID')],\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.#cleanFieldsList();\n\t\t\t\tDom.append(configurator.render(), this.#getFieldsListLayout());\n\t\t\t});\n\t\t}\n\t}\n\n\t#getPreparedCategoryId(categoryId: string): string | number\n\t{\n\t\tif (categoryId.startsWith('DYNAMIC_'))\n\t\t{\n\t\t\tconst fieldsList = this.#getFieldsList();\n\t\t\tif (Type.isPlainObject(fieldsList[categoryId]))\n\t\t\t{\n\t\t\t\treturn fieldsList[categoryId].DYNAMIC_ID;\n\t\t\t}\n\t\t}\n\n\t\treturn `CRM_${categoryId}`;\n\t}\n\n\t#getFieldsFactoryTypesFilter(): FieldsFactoryFilter\n\t{\n\t\tconst defaultFilter = Runtime.clone(Selector.#defaultFieldsFactoryFilter);\n\t\tconst customFilter = this.#getOptions()?.fieldsFactory?.filter;\n\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tif (Type.isArrayFilled(customFilter['-types']))\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t\t...customFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn customFilter;\n\t\t}\n\n\t\tif (Type.isFunction(customFilter))\n\t\t{\n\t\t\treturn customFilter;\n\t\t}\n\n\t\treturn defaultFilter;\n\t}\n\n\t#applyFieldsFactoryTypesFilter(types, filter): Array<any>\n\t{\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\treturn types.filter((type) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+types'])\n\t\t\t\t\t|| filter['+types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-types'])\n\t\t\t\t\t&& filter['-types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\t\t}\n\n\t\treturn types;\n\t}\n\n\t#getUserFieldFactory(categoryId: string | number): Factory\n\t{\n\t\treturn this.#cache.remember(`factory_${categoryId}`, () => {\n\t\t\tconst rootWindow = window.top;\n\t\t\tconst Factory = (() => {\n\t\t\t\tif (rootWindow.BX.UI.UserFieldFactory)\n\t\t\t\t{\n\t\t\t\t\treturn rootWindow.BX.UI.UserFieldFactory.Factory\n\t\t\t\t}\n\n\t\t\t\treturn BX.UI.UserFieldFactory.Factory;\n\t\t\t})();\n\n\t\t\tconst factory = new Factory(\n\t\t\t\tthis.#getPreparedCategoryId(categoryId),\n\t\t\t\t{\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tbindElement: this.#getCreateFieldButton().render(),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst filter = this.#getFieldsFactoryTypesFilter();\n\t\t\tif (Type.isFunction(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tSelector.defaultFieldsFactoryFilter,\n\t\t\t\t);\n\t\t\t\tfactory.types = filter(factory.types);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tfilter,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn factory;\n\t\t});\n\t}\n\n\t#getSliderLayout(): Promise<Layout>\n\t{\n\t\treturn this.#cache.remember('sliderLayout', () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tLayout\n\t\t\t\t\t.createLayout({\n\t\t\t\t\t\textensions: ['crm.form.fields.selector'],\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_SLIDER_TITLE'),\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\treturn this.#getLayout();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\titems: this.#getSidebarItems(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: () => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tthis.#getSearch().getLayout(),\n\t\t\t\t\t\t\t\tthis.#getCreateFieldButton(),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({SaveButton, closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_FIELDS_SELECTOR_APPLY_BUTTON_LABEL'),\n\t\t\t\t\t\t\t\t\tonclick: this.#onSaveClick.bind(this),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#getRenderedSliderLayout(): Promise<any>\n\t{\n\t\treturn this.#cache.remember('renderedSliderLayout', () => {\n\t\t\treturn this.#getSliderLayout().then((layout) => {\n\t\t\t\treturn layout.render();\n\t\t\t});\n\t\t});\n\t}\n\n\t#onSaveClick()\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst result = (() => {\n\t\t\tconst {resultModifier} = this.#getOptions();\n\t\t\tif (Type.isFunction(resultModifier))\n\t\t\t{\n\t\t\t\treturn resultModifier(selectedFields);\n\t\t\t}\n\n\t\t\treturn selectedFields.map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t});\n\t\t})();\n\n\t\tthis.#getPromiseResolver()(result);\n\t\tthis.hide();\n\t}\n\n\t#setPromiseResolver(resolver: () => void)\n\t{\n\t\tthis.#cache.set('promiseResolver', resolver);\n\t}\n\n\t#getPromiseResolver(): () => void\n\t{\n\t\treturn this.#cache.get('promiseResolver', () => {});\n\t}\n\n\t#selectFirstCategory()\n\t{\n\t\tconst [firstSidebarItem] = this.#getSidebarItems();\n\t\tif (Type.isPlainObject(firstSidebarItem))\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.close();\n\t\t}\n\t}\n\n\t#getSliderId(): string\n\t{\n\t\treturn this.#cache.remember('sliderId', () => {\n\t\t\treturn `crm.form.fields.selector-${Text.getRandom()}`\n\t\t});\n\t}\n\n\tshow(): Promise<Array<any>>\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tconst createFieldButton = this.#getCreateFieldButton();\n\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t);\n\n\t\t\tSidePanel.Instance.open(\n\t\t\t\tthis.#getSliderId(),\n\t\t\t\t{\n\t\t\t\t\twidth: 740,\n\t\t\t\t\tcontentCallback: () => {\n\t\t\t\t\t\treturn this.#load()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tcreateFieldButton.setDisabled(\n\t\t\t\t\t\t\t\t\t!this.#isAllowedCreateField(),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tthis.#selectFirstCategory();\n\n\t\t\t\t\t\t\t\treturn this.#getRenderedSliderLayout();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.#setSelectedFields([]);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#setPromiseResolver(resolve);\n\t\t});\n\t}\n}"],"names":["Backend","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","getData","requestOptions","action","data","Promise","resolve","reject","ajax","runAction","json","then","catch","Search","Cache","MemoryCache","getValue","value","setValue","Text","encode","getLayout","remember","Tag","render","set","get","emit","Runtime","debounce","initialValue","Type","isStringFilled","bind","Loc","getMessage","event","preventDefault","ListItem","targetContainer","isDomNode","renderTo","getField","field","isSelected","checked","caption","Dom","append","type","CHECKBOX","selected","RADIO","Selector","hide","SidePanel","Reflection","getClass","Instance","close","show","createFieldButton","setDisabled","open","width","contentCallback","onClose","filter","multiple","clone","onError","fieldsList","fieldsEntries","Object","entries","reduce","acc","categoryId","category","isArrayFilled","includes","filteredFields","FIELDS","allowed","some","condition","isFunction","isPlainObject","every","key","disallowed","query","preparedQuery","String","toLowerCase","defaultFilter","push","prefilteredFieldsList","controllerOptions","fields","isLeadEnabled","permissions","userField","add","map","label","CAPTION","id","onclick","customFilter","isArray","clean","selectedFields","hasField","currentField","name","forEach","onChange","selectedField","listItem","getTarget","error","console","sliderLayout","sidebarItems","getMenu","setItems","firstSidebarItem","setActiveFirstItem","Button","text","color","Color","SUCCESS","sliderMenu","hasActive","currentCategoryId","getActiveItem","getId","factory","menu","selectedType","configurator","getConfigurator","createUserField","onSave","addClass","saveButton","save","removeClass","editFormLabel","onCancel","startsWith","DYNAMIC_ID","fieldsFactory","types","rootWindow","window","top","Factory","BX","UI","UserFieldFactory","moduleId","bindElement","defaultFieldsFactoryFilter","Layout","createLayout","extensions","title","content","items","toolbar","buttons","SaveButton","closeButton","result","layout","resultModifier","resolver","getRandom"],"mappings":"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"}