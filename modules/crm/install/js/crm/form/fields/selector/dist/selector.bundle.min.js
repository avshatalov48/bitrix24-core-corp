this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.Form=this.BX.Crm.Form||{};(function(e,s,t,l,i,a){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("request");class o extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,r,{value:c});this.setEventNamespace("BX.Crm.Form.Fields.Selector.Backend");this.subscribeFromOptions(e.events)}getData(e={}){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]({action:"getData",data:e})}}function c(e){return new Promise(((s,t)=>{a.ajax.runAction(`crm.api.form.fields.selector.${e.action}`,{json:e.data}).then(s).catch(t)}))}let n=e=>e,b,d,p;var v=babelHelpers.classPrivateFieldLooseKey("cache");var u=babelHelpers.classPrivateFieldLooseKey("setOptions");var F=babelHelpers.classPrivateFieldLooseKey("getOptions");var P=babelHelpers.classPrivateFieldLooseKey("onInput");var h=babelHelpers.classPrivateFieldLooseKey("getDebounceWrapper");var L=babelHelpers.classPrivateFieldLooseKey("getInput");var y=babelHelpers.classPrivateFieldLooseKey("onClearClick");var f=babelHelpers.classPrivateFieldLooseKey("getClearButton");class H extends i.EventEmitter{constructor(e={}){super();Object.defineProperty(this,f,{value:j});Object.defineProperty(this,y,{value:T});Object.defineProperty(this,L,{value:C});Object.defineProperty(this,h,{value:O});Object.defineProperty(this,P,{value:g});Object.defineProperty(this,F,{value:m});Object.defineProperty(this,u,{value:B});Object.defineProperty(this,v,{writable:true,value:new a.Cache.MemoryCache});this.setEventNamespace("BX.Crm.Form.Fields.Selector.Search");this.subscribeFromOptions(e.events);babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}getValue(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]().value}setValue(e){babelHelpers.classPrivateFieldLooseBase(this,L)[L]().value=a.Text.encode(e);babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].remember("layout",(()=>a.Tag.render(b||(b=n`
				<div class="crm-form-fields-selector-search">
					<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon">
						<div class="ui-ctl-before ui-ctl-icon-search"></div>
						${0}
						${0}
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,f)[f](),babelHelpers.classPrivateFieldLooseBase(this,L)[L]())))}}function B(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v].set("options",{...e})}function m(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].get("options",{})}function g(){this.emit("onChange",{value:babelHelpers.classPrivateFieldLooseBase(this,L)[L]().value});babelHelpers.classPrivateFieldLooseBase(this,h)[h]()()}function O(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].remember("debounceWrapper",(()=>a.Runtime.debounce((()=>{this.emit("onDebouncedChange",{value:babelHelpers.classPrivateFieldLooseBase(this,L)[L]().value})}),50)))}function C(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].remember("input",(()=>{const e=(()=>{if(a.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,F)[F]().initialValue)){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]().initialValue}return""})();return a.Tag.render(d||(d=n`
				<input 
					type="text" 
					class="ui-ctl-element" 
					oninput="${0}"
					value="${0}"
					placeholder="${0}"
				>
			`),babelHelpers.classPrivateFieldLooseBase(this,P)[P].bind(this),a.Text.encode(e),a.Loc.getMessage("CRM_FORM_FIELDS_SELECTOR_SEARCH_PLACEHOLDER"))}))}function T(e){e.preventDefault();babelHelpers.classPrivateFieldLooseBase(this,L)[L]().value="";babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}function j(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].remember("clearButton",(()=>a.Tag.render(p||(p=n`
				<button 
					class="ui-ctl-after ui-ctl-icon-clear" 
					onclick="${0}"
				></button>
			`),babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this))))}let K=e=>e,E,S;var I=babelHelpers.classPrivateFieldLooseKey("cache");var D=babelHelpers.classPrivateFieldLooseKey("setOptions");var A=babelHelpers.classPrivateFieldLooseKey("getOptions");var R=babelHelpers.classPrivateFieldLooseKey("onChange");var _=babelHelpers.classPrivateFieldLooseKey("getCheckbox");var w=babelHelpers.classPrivateFieldLooseKey("isDisabled");class M extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,w,{value:$});Object.defineProperty(this,_,{value:N});Object.defineProperty(this,R,{value:k});Object.defineProperty(this,A,{value:x});Object.defineProperty(this,D,{value:X});Object.defineProperty(this,I,{writable:true,value:new a.Cache.MemoryCache});this.setEventNamespace("BX.Crm.Form.Field.Selector.ListItem");this.subscribeFromOptions(e.events);babelHelpers.classPrivateFieldLooseBase(this,D)[D](e);const{targetContainer:s}=e;if(a.Type.isDomNode(s)){this.renderTo(s)}}getField(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]().field}isSelected(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]().checked}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I].remember(`layout`,(()=>{const e="crm-form-fields-selector-field--disabled";return a.Tag.render(E||(E=K`
				<div class="crm-form-fields-selector-field${0}">
					<label class="ui-ctl ui-ctl-checkbox crm-form-fields-selector-field-checkbox">
						${0}
						<div class="ui-ctl-label-text">${0}</div>
					</label>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,w)[w]()?" "+e:"",babelHelpers.classPrivateFieldLooseBase(this,_)[_](),a.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,A)[A]().field.caption))}))}renderTo(e){if(a.Type.isDomNode(e)){a.Dom.append(this.getLayout(),e)}}}function X(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I].set("options",{type:M.Type.CHECKBOX,...e})}function x(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I].get("options",{})}function k(){this.emit("onChange")}function N(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I].remember("checkbox",(()=>a.Tag.render(S||(S=K`
				<input 
					type="${0}" 
					class="ui-ctl-element"
					onchange="${0}"
					name="CRM_FIELDS_SELECTOR_ITEM"
					${0}
				>
			`),a.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,A)[A]().type),babelHelpers.classPrivateFieldLooseBase(this,R)[R].bind(this),babelHelpers.classPrivateFieldLooseBase(this,A)[A]().selected?"checked":"")))}function $(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,A)[A]().disabled)!=null?e:false}M.Type={CHECKBOX:"checkbox",RADIO:"radio"};let U=e=>e,V,G,Y;var W=babelHelpers.classPrivateFieldLooseKey("cache");var q=babelHelpers.classPrivateFieldLooseKey("defaultFilter");var z=babelHelpers.classPrivateFieldLooseKey("defaultFieldsFactoryFilter");var J=babelHelpers.classPrivateFieldLooseKey("setOptions");var Q=babelHelpers.classPrivateFieldLooseKey("getOptions");var Z=babelHelpers.classPrivateFieldLooseKey("getBackend");var ee=babelHelpers.classPrivateFieldLooseKey("setFieldsList");var se=babelHelpers.classPrivateFieldLooseKey("applyCategoriesFilter");var te=babelHelpers.classPrivateFieldLooseKey("applyFieldsFilter");var le=babelHelpers.classPrivateFieldLooseKey("applySearchFilter");var ie=babelHelpers.classPrivateFieldLooseKey("load");var ae=babelHelpers.classPrivateFieldLooseKey("setIsLeadEnabled");var re=babelHelpers.classPrivateFieldLooseKey("isLeadEnabled");var oe=babelHelpers.classPrivateFieldLooseKey("setIsAllowedCreateField");var ce=babelHelpers.classPrivateFieldLooseKey("isAllowedCreateField");var ne=babelHelpers.classPrivateFieldLooseKey("getSidebarItems");var be=babelHelpers.classPrivateFieldLooseKey("getFilter");var de=babelHelpers.classPrivateFieldLooseKey("cleanFieldsList");var pe=babelHelpers.classPrivateFieldLooseKey("getSelectedFields");var ve=babelHelpers.classPrivateFieldLooseKey("addSelectedField");var ue=babelHelpers.classPrivateFieldLooseKey("removeSelectedField");var Fe=babelHelpers.classPrivateFieldLooseKey("setSelectedFields");var Pe=babelHelpers.classPrivateFieldLooseKey("isMultiple");var he=babelHelpers.classPrivateFieldLooseKey("renderCategoryFields");var Le=babelHelpers.classPrivateFieldLooseKey("getDisabledFields");var ye=babelHelpers.classPrivateFieldLooseKey("isFieldDisabled");var fe=babelHelpers.classPrivateFieldLooseKey("onListItemChange");var He=babelHelpers.classPrivateFieldLooseKey("onSidebarItemClick");var Be=babelHelpers.classPrivateFieldLooseKey("onBackendError");var me=babelHelpers.classPrivateFieldLooseKey("getLayout");var ge=babelHelpers.classPrivateFieldLooseKey("onSearchChange");var Oe=babelHelpers.classPrivateFieldLooseKey("getSearch");var Ce=babelHelpers.classPrivateFieldLooseKey("getFieldsListLayout");var Te=babelHelpers.classPrivateFieldLooseKey("getCreateFieldButton");var je=babelHelpers.classPrivateFieldLooseKey("onCreateFieldClick");var Ke=babelHelpers.classPrivateFieldLooseKey("getPreparedCategoryId");var Ee=babelHelpers.classPrivateFieldLooseKey("getFieldsFactoryTypesFilter");var Se=babelHelpers.classPrivateFieldLooseKey("applyFieldsFactoryTypesFilter");var Ie=babelHelpers.classPrivateFieldLooseKey("getUserFieldFactory");var De=babelHelpers.classPrivateFieldLooseKey("getSliderLayout");var Ae=babelHelpers.classPrivateFieldLooseKey("getRenderedSliderLayout");var Re=babelHelpers.classPrivateFieldLooseKey("onSaveClick");var _e=babelHelpers.classPrivateFieldLooseKey("setPromiseResolver");var we=babelHelpers.classPrivateFieldLooseKey("getPromiseResolver");var Me=babelHelpers.classPrivateFieldLooseKey("selectFirstCategory");var Xe=babelHelpers.classPrivateFieldLooseKey("getSliderId");class xe extends i.EventEmitter{constructor(e={}){super();Object.defineProperty(this,Xe,{value:Ks});Object.defineProperty(this,Me,{value:js});Object.defineProperty(this,we,{value:Ts});Object.defineProperty(this,_e,{value:Cs});Object.defineProperty(this,Re,{value:Os});Object.defineProperty(this,Ae,{value:gs});Object.defineProperty(this,De,{value:ms});Object.defineProperty(this,Ie,{value:Bs});Object.defineProperty(this,Se,{value:Hs});Object.defineProperty(this,Ee,{value:fs});Object.defineProperty(this,Ke,{value:ys});Object.defineProperty(this,je,{value:Ls});Object.defineProperty(this,Te,{value:hs});Object.defineProperty(this,Ce,{value:Ps});Object.defineProperty(this,Oe,{value:Fs});Object.defineProperty(this,ge,{value:us});Object.defineProperty(this,me,{value:vs});Object.defineProperty(this,Be,{value:ps});Object.defineProperty(this,He,{value:ds});Object.defineProperty(this,fe,{value:bs});Object.defineProperty(this,ye,{value:ns});Object.defineProperty(this,Le,{value:cs});Object.defineProperty(this,he,{value:os});Object.defineProperty(this,Pe,{value:rs});Object.defineProperty(this,Fe,{value:as});Object.defineProperty(this,ue,{value:is});Object.defineProperty(this,ve,{value:ls});Object.defineProperty(this,pe,{value:ts});Object.defineProperty(this,de,{value:ss});Object.defineProperty(this,be,{value:es});Object.defineProperty(this,ne,{value:Ze});Object.defineProperty(this,ce,{value:Qe});Object.defineProperty(this,oe,{value:Je});Object.defineProperty(this,re,{value:ze});Object.defineProperty(this,ae,{value:qe});Object.defineProperty(this,ie,{value:We});Object.defineProperty(this,le,{value:Ye});Object.defineProperty(this,te,{value:Ge});Object.defineProperty(this,se,{value:Ve});Object.defineProperty(this,ee,{value:Ue});Object.defineProperty(this,Z,{value:$e});Object.defineProperty(this,Q,{value:Ne});Object.defineProperty(this,J,{value:ke});Object.defineProperty(this,W,{writable:true,value:new a.Cache.MemoryCache});this.setEventNamespace("BX.Crm.Form.Fields.Selector");this.subscribeFromOptions(e.events);babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)}getFieldsList(){const e=babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("fieldsList",{});const s=babelHelpers.classPrivateFieldLooseBase(this,be)[be]();if(a.Type.isPlainObject(s)){const t=babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]().getValue();return babelHelpers.classPrivateFieldLooseBase(this,le)[le](babelHelpers.classPrivateFieldLooseBase(this,te)[te](babelHelpers.classPrivateFieldLooseBase(this,se)[se](e,s),s),t)}if(a.Type.isFunction(s)){const t=a.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(xe,q)[q]);if(!babelHelpers.classPrivateFieldLooseBase(this,re)[re]()){t["-categories"].push("LEAD")}const l=babelHelpers.classPrivateFieldLooseBase(this,te)[te](babelHelpers.classPrivateFieldLooseBase(this,se)[se](e,t),s);return s(a.Runtime.clone(l))}return e}hide(){const e=a.Reflection.getClass("BX.SidePanel");if(e.Instance){e.Instance.close()}}show(){const e=a.Reflection.getClass("BX.SidePanel");if(e.Instance){const s=babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();s.setDisabled(!babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]());e.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe](),{width:740,contentCallback:()=>babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]().then((()=>{s.setDisabled(!babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]());babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]();return babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]()})).catch((({errors:e})=>a.Tag.render(V||(V=U`
									<div class="ui-alert ui-alert-danger">
										<span class="ui-alert-message">${0}</span>
									</div>
								`),e.map((e=>a.Text.encode(e.message))).join("\n")))),events:{onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]([])}}})}return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](e)}))}}function ke(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("options",{filter:{},multiple:true,...e})}function Ne(){return a.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("options",{filter:{}}))}function $e(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("backend",(()=>new o({events:{onError:babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].bind(this)}})))}function Ue(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("fieldsList",{...e})}function Ve(e,s){const t=Object.entries(e);return t.reduce(((e,[t,l])=>{if((!a.Type.isArrayFilled(s["+categories"])||s["+categories"].includes(t))&&(!a.Type.isArrayFilled(s["-categories"])||!s["-categories"].includes(t))){e[t]=l}return e}),{})}function Ge(e,s){const t=Object.entries(e);return t.reduce(((e,[t,l])=>{const i=l.FIELDS.filter((e=>{const t=!a.Type.isArrayFilled(s["+fields"])||s["+fields"].some((s=>{if(a.Type.isStringFilled(s)){return e.type===s}if(a.Type.isFunction(s)){return s(e)}if(a.Type.isPlainObject(s)){return Object.entries(s).every((([s,t])=>e[s]===t))}return false}));const l=a.Type.isArrayFilled(s["-fields"])&&s["-fields"].some((s=>{if(a.Type.isStringFilled(s)){return e.type===s}if(a.Type.isFunction(s)){return s(e)}if(a.Type.isPlainObject(s)){return Object.entries(s).every((([s,t])=>e[s]===t))}return false}));return t&&!l}));if(a.Type.isArrayFilled(i)){e[t]={...l,FIELDS:i}}return e}),{})}function Ye(e,s){const t=Object.entries(e);if(a.Type.isStringFilled(s)){const e=String(s).toLowerCase();return t.reduce(((s,[t,l])=>{const i=l.FIELDS.filter((s=>a.Type.isStringFilled(s.caption)&&String(s.caption).toLowerCase().includes(e)));if(a.Type.isArrayFilled(i)){s[t]={...l,FIELDS:i}}return s}),{})}return e}function We(){const{controllerOptions:e={}}=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]().getData({options:e}).then((({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e.fields);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e.options.isLeadEnabled);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e.options.permissions.userField.add)}))}function qe(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("isLeadEnabled",e)}function ze(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("isLeadEnabled")}function Je(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("isAllowedCreateField",e)}function Qe(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("isAllowedCreateField",false)}function Ze(){return Object.entries(this.getFieldsList()).map((([e,s])=>({label:s.CAPTION,id:e,onclick:babelHelpers.classPrivateFieldLooseBase(this,He)[He].bind(this,e)})))}function es(){const e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().filter;if(a.Type.isPlainObject(e)){const s=babelHelpers.classPrivateFieldLooseBase(xe,q)[q];if(a.Type.isArray(e["-categories"])){e["-categories"]=[...e["-categories"],...s["-categories"]]}else{e["-categories"]=[...s["-categories"]]}if(!babelHelpers.classPrivateFieldLooseBase(this,re)[re]()){e["-categories"].push("LEAD")}if(a.Type.isArray(e["-fields"])){e["-fields"]=[...e["-fields"],...s["-fields"]]}else{e["-fields"]=[...s["-fields"]]}}return e}function ss(){a.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]())}function ts(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("selectedFields",[])}function ls(e){const s=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();const t=s.some((s=>s.name===e.name));if(!t){s.push(e);babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](s)}}function is(e){const s=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]().filter((s=>s.name!==e.name));babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](s)}function as(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("selectedFields",e)}function rs(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().multiple}function os(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de]();const s=this.getFieldsList()[e].FIELDS;if(a.Type.isArrayFilled(s)){s.forEach((e=>{void new M({field:e,targetContainer:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](),events:{onChange:babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].bind(this)},selected:babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]().some((s=>s.name===e.name)),type:babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()?M.Type.CHECKBOX:M.Type.RADIO,disabled:babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](e)})}))}}function cs(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().disabledFields)!=null?e:null}function ns(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();if(a.Type.isNull(s)){return false}return s.some((s=>a.Type.isString(s)&&e.name===s||a.Type.isFunction(s)&&s(e)))}function bs(e){const s=e.getTarget();if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()){if(s.isSelected()){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](s.getField())}else{babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](s.getField())}}else{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]([s.getField()])}}function ds(e){babelHelpers.classPrivateFieldLooseBase(this,he)[he](e)}function ps(e){console.error(e);this.emit("onError",{error:e})}function vs(){return a.Tag.render(G||(G=U`
			<div class="crm-form-fields-selector">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]())}async function us(){const e=await babelHelpers.classPrivateFieldLooseBase(this,De)[De]();const s=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]();e.getMenu().setItems(s);babelHelpers.classPrivateFieldLooseBase(this,de)[de]();const[t]=s;if(t){babelHelpers.classPrivateFieldLooseBase(this,He)[He](t.id);e.getMenu().setActiveFirstItem();if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()){babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]().setDisabled(false)}}else{if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()){babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]().setDisabled(true)}}}function Fs(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("search",(()=>new H({events:{onChange:babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this)}})))}function Ps(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("fieldsListLayout",(()=>a.Tag.render(Y||(Y=U`
				<div class="crm-form-fields-selector-fields-list"></div>
			`))))}function hs(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("createFieldButton",(()=>new l.Button({text:a.Loc.getMessage("CRM_FORM_FIELDS_SELECTOR_CREATE_BUTTON_LABEL"),color:l.Button.Color.SUCCESS,onclick:babelHelpers.classPrivateFieldLooseBase(this,je)[je].bind(this)})))}async function Ls(){const e=await babelHelpers.classPrivateFieldLooseBase(this,De)[De]();const s=e.getMenu();if(s.hasActive()){const e=s.getActiveItem().getId();const t=babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](e);const l=t.getMenu();l.open((s=>{const l=t.getConfigurator({userField:t.createUserField(s),onSave:s=>{a.Dom.addClass(l.saveButton,"ui-btn-wait");return s.save().then((()=>babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]())).then((()=>{a.Dom.removeClass(l.saveButton,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,He)[He](e);babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]().setValue(s.getData().editFormLabel[a.Loc.getMessage("LANGUAGE_ID")])}))},onCancel:()=>{babelHelpers.classPrivateFieldLooseBase(this,He)[He](e)}});babelHelpers.classPrivateFieldLooseBase(this,de)[de]();a.Dom.append(l.render(),babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]())}))}}function ys(e){if(e.startsWith("DYNAMIC_")){const s=this.getFieldsList();if(a.Type.isPlainObject(s[e])){return s[e].DYNAMIC_ID}}return`CRM_${e}`}function fs(){var e,s;const t=a.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(xe,z)[z]);const l=(e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]())==null?void 0:(s=e.fieldsFactory)==null?void 0:s.filter;if(a.Type.isPlainObject(l)){if(a.Type.isArrayFilled(l["-types"])){l["-types"]=[...t["-types"],...l["-types"]]}else{l["-types"]=[...t["-types"]]}return l}if(a.Type.isFunction(l)){return l}return t}function Hs(e,s){if(a.Type.isPlainObject(s)){return e.filter((e=>{const t=!a.Type.isArrayFilled(s["+types"])||s["+types"].some((s=>{if(a.Type.isStringFilled(s)){return e.name===s}if(a.Type.isFunction(s)){return s(e)}return false}));const l=a.Type.isArrayFilled(s["-types"])&&s["-types"].some((s=>{if(a.Type.isStringFilled(s)){return e.name===s}if(a.Type.isFunction(s)){return s(e)}return false}));return t&&!l}))}return e}function Bs(e){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember(`factory_${e}`,(()=>{const s=window.top;const t=(()=>{if(s.BX.UI.UserFieldFactory){return s.BX.UI.UserFieldFactory.Factory}return BX.UI.UserFieldFactory.Factory})();const l=new t(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](e),{moduleId:"crm",bindElement:babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]().render()});const i=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(a.Type.isFunction(i)){l.types=babelHelpers.classPrivateFieldLooseBase(this,Se)[Se](l.types,xe.defaultFieldsFactoryFilter);l.types=i(l.types)}if(a.Type.isPlainObject(i)){l.types=babelHelpers.classPrivateFieldLooseBase(this,Se)[Se](l.types,i)}return l}))}function ms(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("sliderLayout",(()=>new Promise((e=>{s.Layout.createLayout({extensions:["crm.form.fields.selector"],title:a.Loc.getMessage("CRM_FORM_FIELDS_SELECTOR_SLIDER_TITLE"),content:()=>babelHelpers.classPrivateFieldLooseBase(this,me)[me](),menu:{items:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()},toolbar:()=>[babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]().getLayout(),babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]()],buttons:({SaveButton:e,closeButton:s})=>[new e({text:a.Loc.getMessage("CRM_FORM_FIELDS_SELECTOR_APPLY_BUTTON_LABEL"),onclick:babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].bind(this)}),s]}).then((s=>{e(s)}))}))))}function gs(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("renderedSliderLayout",(()=>babelHelpers.classPrivateFieldLooseBase(this,De)[De]().then((e=>e.render()))))}function Os(){const e=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();const s=(()=>{const{resultModifier:s}=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();if(a.Type.isFunction(s)){return s(e)}return e.map((e=>e.name))})();babelHelpers.classPrivateFieldLooseBase(this,we)[we]()(s);this.hide()}function Cs(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set("promiseResolver",e)}function Ts(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].get("promiseResolver",(()=>{}))}function js(){const[e]=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]();if(a.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,He)[He](e.id)}}function Ks(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].remember("sliderId",(()=>`crm.form.fields.selector-${a.Text.getRandom()}`))}Object.defineProperty(xe,q,{writable:true,value:{"-categories":["CATALOG","ACTIVITY","INVOICE"],"-fields":[{name:"CONTACT_ORIGIN_VERSION"},{name:"CONTACT_LINK"}]}});Object.defineProperty(xe,z,{writable:true,value:{"-types":["employee"]}});e.Selector=xe})(this.BX.Crm.Form.Fields=this.BX.Crm.Form.Fields||{},BX.UI.SidePanel,BX.UI.UserFieldFactory,BX.UI,BX.Event,BX);
//# sourceMappingURL=selector.bundle.map.js