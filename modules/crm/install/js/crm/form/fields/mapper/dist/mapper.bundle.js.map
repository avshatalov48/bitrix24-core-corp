{"version":3,"file":"mapper.bundle.js","sources":["../src/mapper.js"],"sourcesContent":["import 'ui.sidepanel-content';\nimport './mapper.css';\nimport {Tag, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'landing.ui.collection.buttoncollection';\nimport 'landing.ui.collection.formcollection';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\n\ntype MapItem = {\n\tinputMultiple: ?boolean;\n\tinputType: ?string;\n\tinputCode: string;\n\tinputName: string;\n\toutputCode: ?string;\n\toutputName: ?string;\n};\n\ntype Entity = {\n\tcaption: string;\n};\n\ntype Options = {\n\tfields: Array<Object>;\n\tmap: Array<MapItem>;\n\tfrom: Entity;\n};\n\nexport class Mapper extends EventEmitter\n{\n\t#fields = {};\n\t#map = [];\n\t#from: Entity = {};\n\t#container;\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.#fields = options.fields;\n\t\tthis.#from = options.from;\n\t\tthis.setMap(options.map);\n\t}\n\n\tsetMap(map: Array<MapItem>)\n\t{\n\t\tthis.#map = map;\n\t\tthis.#map.forEach((item: MapItem) => this.#appendOutputData(item, item.outputCode));\n\t\tthis.render();\n\t\treturn this;\n\t}\n\n\tgetMap()\n\t{\n\t\treturn this.#map;\n\t}\n\n\t#getEntityNameByField(fieldName)\n\t{\n\t\tlet entityNameParts = fieldName.split('_');\n\t\tlet entityName = entityNameParts[0];\n\t\tif (entityName === 'DYNAMIC')\n\t\t{\n\t\t\tentityName = entityNameParts[0] + '_' + entityNameParts[1];\n\t\t}\n\n\t\treturn entityName;\n\t}\n\n\t#getFieldByName(name)\n\t{\n\t\tconst entityName = this.#getEntityNameByField(name);\n\t\tconst entity = this.#fields[entityName];\n\t\treturn entity.FIELDS.filter(field => field.name === name)[0] || null;\n\t}\n\n/*\t#onClickAddAuto(item: MapItem)\n\t{\n\t\titem.outputCode = '';\n\t\titem.outputName = '';\n\t\tthis.render();\n\t}*/\n\n\t#onClickChange(item: MapItem)\n\t{\n\t\tconst selectorOptions = {\n\t\t\tmultiple: false,\n\t\t\tallowedTypes: [],\n\t\t\tallowedCategories: [],\n\t\t};\n\t\tif (['email', 'phone'].includes(item.inputType))\n\t\t{\n\t\t\tselectorOptions.allowedTypes = [\n\t\t\t\t{type: 'typed_string', entityFieldName: 'PHONE'},\n\t\t\t\t{type: 'typed_string', entityFieldName: 'EMAIL'},\n\t\t\t];\n\t\t\tselectorOptions.allowedCategories = ['LEAD', 'CONTACT', 'COMPANY'];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tselectorOptions.allowedTypes = ['string', 'text'];\n\t\t}\n\n\t\tselectorOptions.disabledFields = this.getMap().map((item: MapItem) => item.outputCode);\n\n\t\tFieldsPanel\n\t\t\t.getInstance()\n\t\t\t.show(selectorOptions)\n\t\t\t.then(selectedNames => {\n\t\t\t\tthis.#appendOutputData(item, selectedNames[0])\n\t\t\t\tthis.render();\n\t\t\t\tthis.emit('change');\n\t\t\t})\n\t\t;\n\t}\n\n\t#appendOutputData(item, name)\n\t{\n\t\tif (!name)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst entityName = this.#getEntityNameByField(name);\n\t\tconst entity = this.#fields[entityName];\n\t\tconst field = this.#getFieldByName(name);\n\t\tif (!field)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.outputCode = name;\n\t\titem.outputName = `${field.caption} - ${entity.CAPTION}`;\n\t}\n\n\trender()\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#container.innerHTML = '';\n\t\tthis.getMap().forEach(field => {\n\t\t\tconst changeHandler = () => this.#onClickChange(field);\n\t\t\tconst element = Tag.render`\n\t\t\t\t\t<div class=\"ui-form-row\" style=\"background: #eef2f4;\">\n\t\t\t\t\t\t<div class=\"ui-form\" style=\"width: 100%; padding: 20px;\">\n\t\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Tag.safe`${field.inputName}`} - ${Tag.safe`${this.#from.caption}`}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t\t<div class=\"crm-form-fields-mapper-row\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"crm-form-fields-mapper-row-label ${field.outputName ? '' : 'crm-form-fields-mapper-row-label-error'}\"\n\t\t\t\t\t\t\t\t\t\tdata-role=\"caption\"\n\t\t\t\t\t\t\t\t\t>${Tag.safe`${field.outputName}` || Loc.getMessage('CRM_FORM_FIELDS_MAPPER_NOT_SELECTED')}</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<a class=\"ui-btn ui-btn-xs ui-btn-light-border\"\n\t\t\t\t\t\t\t\t\t\t\tonclick=\"${changeHandler}\"\n\t\t\t\t\t\t\t\t\t\t>${Loc.getMessage('CRM_FORM_FIELDS_MAPPER_CHOOSE_FIELD')}</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tfield.element = element;\n\t\t\tthis.#container.appendChild(element);\n\t\t});\n\n\t\treturn this.#container;\n\t}\n}\n"],"names":["Mapper","options","fields","from","setMap","map","forEach","item","outputCode","render","Tag","innerHTML","getMap","field","changeHandler","element","safe","inputName","caption","outputName","Loc","getMessage","appendChild","EventEmitter","fieldName","entityNameParts","split","entityName","name","entity","FIELDS","filter","selectorOptions","multiple","allowedTypes","allowedCategories","includes","inputType","type","entityFieldName","disabledFields","FieldsPanel","getInstance","show","then","selectedNames","emit","CAPTION"],"mappings":"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"}