{"version":3,"file":"integration.bundle.js","sources":["../src/integration.js"],"sourcesContent":["import 'ui.sidepanel-content';\nimport './integration.css';\nimport {Loc, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {FormDictionary, FormOptions} from \"crm.form.type\";\nimport {Mapper} from 'crm.form.fields.mapper';\nimport {Alert} from 'ui.alerts';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport 'ui.dropdown';\nimport {ajax} from \"main.core.ajax\";\nimport {Loader} from \"main.loader\";\nimport { LoginFactory } from 'seo.ads.login';\n\ntype Options = {\n\ttype: String;\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n};\n\nlet instances = [];\n\n/**\n * Crm-From Integration\n *\n * @memberOf BX.Crm.Form\n */\nexport class Integration extends EventEmitter\n{\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n\ttype: String;\n\t#container: HTMLElement;\n\t#profileContainer: HTMLElement;\n\t#pagesContainer: HTMLElement;\n\t#formsContainer: HTMLElement;\n\t#mapperContainer: HTMLElement;\n\t#adForms: Array|null = null;\n\t#adFormsErrors: Array|null = null;\n\t#adAccounts: Array|null = null;\n\t#seoEventHandler: Function;\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.type = options.type;\n\t\tthis.form = options.form;\n\t\tthis.fields = options.fields;\n\t\tthis.#seoEventHandler = (options) => {\n\t\t\tthis.#onLogedIn(options);\n\t\t\toptions.reload = false;\n\t\t};\n\n\t\tthis.dictionary = options.dictionary;\n\t\tBX.addCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\n\t\tinstances.forEach(instance => instance.destroy());\n\t\tinstances = [];\n\t\tinstances.push(this);\n\t}\n\n\tdestroy()\n\t{\n\t\tBX.removeCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\t}\n\n\tgetCase()\n\t{\n\t\tlet item = this.form.integration.cases.filter(item => item.providerCode === this.type)[0] || null;\n\t\tif (!item)\n\t\t{\n\t\t\tconst profile = (this.getProvider() || {}).profile || {};\n\t\t\titem = {\n\t\t\t\tlinkDirection: 1,\n\t\t\t\tproviderCode: this.type,\n\t\t\t\tdate: null,\n\t\t\t\taccount: {\n\t\t\t\t\tid: profile.id || null,\n\t\t\t\t\tname: profile.name || null,\n\t\t\t\t},\n\t\t\t\tform: {\n\t\t\t\t\tid: null,\n\t\t\t\t\tname: null,\n\t\t\t\t},\n\t\t\t\tfieldsMapping: [],\n\t\t\t};\n\n\t\t\tthis.form.integration.cases.push(item);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetProvider()\n\t{\n\t\treturn this.dictionary.integration.providers.filter(item => item.type === this.type)[0] || null;\n\t}\n\n\tgetTypeTitle()\n\t{\n\t\treturn Loc.getMessage('CRM_FORM_INTEGRATION_JS_PROVIDER_' + this.type.toUpperCase());\n\t}\n\n\tgetAdForm(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().form.id + '';\n\t\t}\n\n\t\treturn (this.#adForms || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\tgetAdAccount(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().account.id;\n\t\t}\n\n\t\treturn (this.#adAccounts || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\n\tgetAdFormId()\n\t{\n\t\tconst obj = this.getAdForm();\n\t\tif (obj && this.#adForms.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetAdAccountId()\n\t{\n\t\tconst obj = this.getAdAccount();\n\t\tif (obj && this.#adAccounts.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onClickChangeDirection()\n\t{\n\t\tthis.getCase().linkDirection = 1;\n\t\tthis.emit('change');\n\t\tthis.render();\n\t}\n\n\t#onLogedIn(options)\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runAction('crm.api.form.getDict', {json: {}})\n\t\t\t.then(response => response.data)\n\t\t\t.then(data => {\n\t\t\t\tthis.dictionary.integration = data.integration;\n\t\t\t\tif (/.group/.test(options.engine || ''))\n\t\t\t\t{\n\t\t\t\t\tthis.#renderPageSelector();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\n\t\t\t\t\tthis.#renderProfileSelector();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#loginProfile()\n\t{\n\t\tLoginFactory.getLoginObject({\n\t\t\tTYPE: this.type,\n\t\t\tENGINE_CODE: this.getProvider().engineCode,\n\t\t\tAUTH_URL: this.getProvider().authUrl,\n\t\t}).login();\n\t}\n\n\t#logoutProfile()\n\t{\n\t\tajax.runAction('crm.api.ads.leadads.service.logout',{\n\t\t\tdata: {\n\t\t\t\ttype: this.type\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.#adAccounts = null;\n\t\t\t\tthis.getProvider().profile = null;\n\t\t\t\tthis.#renderProfileSelector();\n\t\t\t})\n\t}\n\n\t#loginGroup()\n\t{\n\t\tconst popup = BX.util.popup('', 800, 600);\n\t\tajax.runAction('crm.api.ads.leadads.service.registerGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroup: this.getAdAccountId(),\n\t\t\t}\n\t\t})\n\t\t\t.then(response => {\n\t\t\t\tpopup.location = response.data.authUrl;\n\t\t\t})\n\t\t;\n\t}\n\n\t#logoutGroup()\n\t{\n\t\tconst group = this.getProvider().group;\n\t\tif (!group.groupId)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn ajax.runAction('crm.api.ads.leadads.service.logoutGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroupId: group.groupId,\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tthis.getProvider().group.hasAuth = false;\n\t\t\tthis.#renderPageSelector();\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#container.innerHTML = '';\n\t\tif (!this.dictionary.integration.canUse)\n\t\t{\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tconst currentCase = this.getCase();\n\t\tif (currentCase && currentCase.linkDirection === 0)\n\t\t{\n\t\t\t// show alert and button for changing direction\n\t\t\tthis.#container.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tthis.#container.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#onClickChangeDirection(),\n\t\t\t})).render());\n\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tthis.#container.appendChild(this.#renderProfileSelector());\n\t\treturn this.#container;\n\t}\n\n\t#renderProfileSelector()\n\t{\n\t\tif (!this.#profileContainer)\n\t\t{\n\t\t\tthis.#profileContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#profileContainer.innerHTML = '';\n\n\t\tconst provider = this.getProvider();\n\t\tif (!provider.profile)\n\t\t{\n\t\t\tthis.#profileContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: `\n\t\t\t\t\t<div class=\"ui-slider-heading-3\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_TITLE', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"ui-slider-paragraph-2\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_DESC', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</p>\n\t\t\t\t`,\n\t\t\t})).render());\n\t\t\tthis.#profileContainer.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#loginProfile(),\n\t\t\t})).render());\n\t\t\treturn this.#profileContainer;\n\t\t}\n\n\t\tthis.#profileContainer.appendChild(Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"crm-ads-conversion-block\">\n\t\t\t\t\t<div class=\"crm-ads-conversion-social crm-ads-conversion-social-facebook\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-avatar-icon\"\n\t\t\t\t\t\t\t\tstyle=\"background-image: url(${Tag.safe`${provider.profile.picture}`})\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-user\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t${provider.profile.url ? 'href=\"' + Tag.safe`${provider.profile.url}` + '\"' : \"\"}\n\t\t\t\t\t\t\t\ttarget=\"_top\"\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-user-link\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${Tag.safe`${provider.profile.name}`}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-shutoff\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-shutoff-link\"\n\t\t\t\t\t\t\t\tonclick=\"${this.#logoutProfile.bind(this)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGOUT_BTN')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.#profileContainer.appendChild(this.#renderPageSelector());\n\t\treturn this.#profileContainer;\n\t}\n\n\t#setPageId(id)\n\t{\n\t\tthis.getCase().account.id = id || '';\n\t\tthis.getCase().account.name = (this.getAdAccount(id) || {}).name;\n\t\tthis.emit('change');\n\n\t\tthis.#adForms = null;\n\t\tthis.#renderPageSelector();\n\t}\n\n\t#renderPageSelector()\n\t{\n\t\tif (!this.#pagesContainer)\n\t\t{\n\t\t\tthis.#pagesContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#pagesContainer.innerHTML = '';\n\t\tif (!this.#adAccounts)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.account.getAccounts', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adAccounts = response.data.accounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: item.id + '',\n\t\t\t\t\t\tname: item.name + '',\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tthis.#renderPageSelector();\n\t\t\t});\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tif (this.#adAccounts.length === 0)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tconst id = this.getAdAccountId();\n\t\tconst pagesDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'page-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_' + this.type.toUpperCase()),\n\t\t\tcontent: id,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adAccounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\t\tpagesDropdown.subscribe('onChange', () => {\n\t\t\tthis.#setPageId(pagesDropdown.getValue());\n\t\t});\n\n\t\tconst container = Tag.render`<div class=\"crm-form-integration-page-container\"></div>`;\n\t\tconst selectorContainer = Tag.render`<div class=\"crm-form-integration-page-selector\"></div>`;\n\t\tselectorContainer.appendChild(pagesDropdown.getNode());\n\t\tcontainer.appendChild(selectorContainer);\n\n\t\tthis.#pagesContainer.appendChild(container);\n\n\t\tconst group = this.getProvider().group;\n\t\tconst hasAuthGroup = group.isAuthUsed && group.hasAuth && group.groupId;\n\t\tif (hasAuthGroup && id && id !== group.groupId)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_VKONTAKTE_RESTRICTED',\n\t\t\t\t\t{\n\t\t\t\t\t\t'%groupName%': (this.getAdAccount(group.groupId) || {}).name,\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_DISCONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tgroupConnectBtn.setWaiting(true);\n\t\t\t\t\tthis.#logoutGroup()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#pagesContainer.appendChild(groupConnectBtn.render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\n\t\tif (id && group.isAuthUsed && !group.hasAuth)\n\t\t{\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => this.#loginGroup(),\n\t\t\t});\n\t\t\tcontainer.appendChild(groupConnectBtn.render());\n\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_INFO'),\n\t\t\t})).render());\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tthis.#pagesContainer.appendChild(this.#renderFormSelector());\n\t\treturn this.#pagesContainer;\n\t}\n\n\t#renderFormSelector()\n\t{\n\t\tif (!this.#formsContainer)\n\t\t{\n\t\t\tthis.#formsContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#formsContainer.innerHTML = '';\n\n\t\tconst accountId = this.getAdAccountId();\n\t\tif (!accountId)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CHOOSE'),\n\t\t\t})).render());\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (!this.#adForms)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.form.list', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\taccountId,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adForms = response.data.forms.map(item => {\n\t\t\t\t\titem.id += '';\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t}).catch(response => {\n\t\t\t\tthis.#adFormsErrors = response.errors;\n\t\t\t\tthis.#adForms = [];\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t});\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (this.#adForms.length === 0)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: this.#adFormsErrors.length > 0 ? this.#adFormsErrors[0].message : Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_FORM_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tconst formsDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'form-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM'),\n\t\t\tcontent: this.getAdFormId(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adForms.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\n\t\tformsDropdown.subscribe('onChange', () => {\n\t\t\tconst formId = formsDropdown.getValue();\n\t\t\tthis.getCase().form.id = formId;\n\t\t\tthis.getCase().form.name = (this.getAdForm(formId) || {}).name;\n\t\t\tthis.getCase().fieldsMapping = [];\n\n\t\t\tthis.emit('change');\n\t\t\tthis.#renderMapper();\n\t\t});\n\n\t\tthis.#formsContainer.appendChild(formsDropdown.getNode());\n\t\tthis.#formsContainer.appendChild(this.#renderMapper());\n\n\t\treturn this.#formsContainer;\n\t}\n\n\t#renderLoader()\n\t{\n\t\tconst container = Tag.render`<div style=\"position: relative; min-height: 100px;\"></div>`;\n\t\t(new Loader()).show(container).then(() => {});\n\t\treturn container;\n\t}\n\n\t#renderMapper()\n\t{\n\t\tif (!this.#mapperContainer)\n\t\t{\n\t\t\tthis.#mapperContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#mapperContainer.innerHTML = '';\n\t\tif (!this.getAdForm())\n\t\t{\n\t\t\tthis.#mapperContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM_CHOOSE'),\n\t\t\t})).render());\n\n\t\t\treturn this.#mapperContainer;\n\t\t}\n\n\t\tconst mappingMessageContainer = Tag.render`<div style=\"margin-bottom: 40px\"></div>`;\n\t\t(new Alert({\n\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FIELD_MAP'),\n\t\t})).renderTo(mappingMessageContainer);\n\t\tthis.#mapperContainer.appendChild(mappingMessageContainer);\n\n\t\tconst mapper = new Mapper({\n\t\t\tfrom: {\n\t\t\t\tcaption: this.getTypeTitle(),\n\t\t\t},\n\t\t\tfields: this.fields,\n\t\t\tmap: this.getAdForm().fields.map(field => {\n\t\t\t\tlet outputCode = this.getCase()\n\t\t\t\t\t.fieldsMapping\n\t\t\t\t\t.filter(item => item.adsFieldKey === field.key)[0]\n\t\t\t\t;\n\t\t\t\toutputCode = (outputCode || {}).crmFieldKey || '';\n\t\t\t\tif (!outputCode)\n\t\t\t\t{\n\t\t\t\t\toutputCode = this.getProvider()\n\t\t\t\t\t\t.defaultMapping\n\t\t\t\t\t\t.filter(item => {\n\t\t\t\t\t\t\treturn item.adsFieldType.toLowerCase() === (field.type || '').toLowerCase();\n\t\t\t\t\t\t})[0]\n\t\t\t\t\t;\n\t\t\t\t\toutputCode = (outputCode || {}).crmFieldType || '';\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinputType: (field.type || '').toLowerCase(),\n\t\t\t\t\tinputCode: field.key,\n\t\t\t\t\tinputName: field.label,\n\t\t\t\t\toutputCode,\n\t\t\t\t\toutputName: '',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\titems: field.options || [],\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t})\n\t\t});\n\n\t\tconst emitChangeEvent = () => {\n\t\t\tconst eventFields = [];\n\t\t\tthis.getCase().fieldsMapping =  mapper.getMap()\n\t\t\t\t.map(item => {\n\t\t\t\t\tif (item.outputCode)\n\t\t\t\t\t{\n\t\t\t\t\t\teventFields.push({name: item.outputCode});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcrmFieldKey: item.outputCode,\n\t\t\t\t\t\tadsFieldKey: item.inputCode,\n\t\t\t\t\t\titems: item.data.items || [],\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.filter(item => item.crmFieldKey)\n\t\t\t;\n\n\t\t\tthis.emit('change', {fields: eventFields});\n\t\t};\n\t\temitChangeEvent();\n\t\tmapper.subscribe('change', emitChangeEvent);\n\n\t\tthis.#mapperContainer.appendChild(mapper.render());\n\t\treturn this.#mapperContainer;\n\t}\n}\n"],"names":["instances","Integration","options","type","form","fields","reload","dictionary","BX","addCustomEvent","window","forEach","instance","destroy","push","removeCustomEvent","item","integration","cases","filter","providerCode","profile","getProvider","linkDirection","date","account","id","name","fieldsMapping","providers","Loc","getMessage","toUpperCase","getCase","obj","getAdForm","some","getAdAccount","Tag","render","innerHTML","canUse","currentCase","appendChild","Alert","color","Color","WARNING","text","getTypeTitle","Button","ButtonColor","PRIMARY","onclick","EventEmitter","emit","ajax","runAction","json","then","response","data","test","engine","LoginFactory","getLoginObject","TYPE","ENGINE_CODE","engineCode","AUTH_URL","authUrl","login","popup","util","group","getAdAccountId","location","groupId","Promise","resolve","hasAuth","provider","safe","picture","url","bind","proxyId","accounts","map","length","pagesDropdown","Landing","UI","Field","Dropdown","selector","title","content","items","value","subscribe","getValue","container","selectorContainer","getNode","hasAuthGroup","isAuthUsed","groupConnectBtn","className","setWaiting","accountId","forms","errors","message","formsDropdown","getAdFormId","formId","Loader","show","mappingMessageContainer","renderTo","mapper","Mapper","from","caption","field","outputCode","adsFieldKey","key","crmFieldKey","defaultMapping","adsFieldType","toLowerCase","crmFieldType","inputType","inputCode","inputName","label","outputName","emitChangeEvent","eventFields","getMap"],"mappings":"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"}