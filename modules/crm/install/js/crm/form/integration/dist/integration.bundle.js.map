{"version":3,"file":"integration.bundle.js","sources":["../src/integration.js"],"sourcesContent":["import 'ui.sidepanel-content';\nimport './integration.css';\nimport {Loc, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {FormDictionary, FormOptions} from \"crm.form.type\";\nimport {Mapper} from 'crm.form.fields.mapper';\nimport {Alert} from 'ui.alerts';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport 'ui.dropdown';\nimport {ajax} from \"main.core.ajax\";\nimport {Loader} from \"main.loader\";\nimport { LoginFactory } from 'seo.ads.login';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\ntype Options = {\n\ttype: String;\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n};\n\nlet instances = [];\n\n/**\n * Crm-From Integration\n *\n * @memberOf BX.Crm.Form\n */\nexport class Integration extends EventEmitter\n{\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n\ttype: String;\n\t#container: HTMLElement;\n\t#profileContainer: HTMLElement;\n\t#pagesContainer: HTMLElement;\n\t#formsContainer: HTMLElement;\n\t#mapperContainer: HTMLElement;\n\t#adForms: Array|null = null;\n\t#adFormsErrors: Array|null = null;\n\t#adAccounts: Array|null = null;\n\t#seoEventHandler: Function;\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.type = options.type;\n\t\tthis.form = options.form;\n\t\tthis.fields = options.fields;\n\t\tthis.#seoEventHandler = (options) => {\n\t\t\tthis.#onLogedIn(options);\n\t\t\toptions.reload = false;\n\t\t};\n\n\t\tthis.dictionary = options.dictionary;\n\t\tBX.addCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\n\t\tinstances.forEach(instance => instance.destroy());\n\t\tinstances = [];\n\t\tinstances.push(this);\n\t}\n\n\tdestroy()\n\t{\n\t\tBX.removeCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\t}\n\n\tgetCase()\n\t{\n\t\tlet item = this.form.integration.cases.filter(item => item.providerCode === this.type)[0] || null;\n\t\tif (!item)\n\t\t{\n\t\t\tconst profile = (this.getProvider() || {}).profile || {};\n\t\t\titem = {\n\t\t\t\tlinkDirection: 1,\n\t\t\t\tproviderCode: this.type,\n\t\t\t\tdate: null,\n\t\t\t\taccount: {\n\t\t\t\t\tid: profile.id || null,\n\t\t\t\t\tname: profile.name || null,\n\t\t\t\t},\n\t\t\t\tform: {\n\t\t\t\t\tid: null,\n\t\t\t\t\tname: null,\n\t\t\t\t},\n\t\t\t\tfieldsMapping: [],\n\t\t\t};\n\n\t\t\tthis.form.integration.cases.push(item);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetProvider()\n\t{\n\t\treturn this.dictionary.integration.providers.filter(item => item.type === this.type)[0] || null;\n\t}\n\n\tgetTypeTitle()\n\t{\n\t\treturn Loc.getMessage('CRM_FORM_INTEGRATION_JS_PROVIDER_' + this.type.toUpperCase());\n\t}\n\n\tgetAdForm(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().form.id + '';\n\t\t}\n\n\t\treturn (this.#adForms || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\tgetAdAccount(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().account.id;\n\t\t}\n\n\t\treturn (this.#adAccounts || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\n\tgetAdFormId()\n\t{\n\t\tconst obj = this.getAdForm();\n\t\tif (obj && this.#adForms.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetAdAccountId()\n\t{\n\t\tconst obj = this.getAdAccount();\n\t\tif (obj && this.#adAccounts.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onClickChangeDirection()\n\t{\n\t\tthis.getCase().linkDirection = 1;\n\t\tthis.emit('change');\n\t\tthis.render();\n\t}\n\n\t#onLogedIn(options)\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runAction('crm.api.form.getDict', {json: {}})\n\t\t\t.then(response => response.data)\n\t\t\t.then(data => {\n\t\t\t\tthis.dictionary.integration = data.integration;\n\t\t\t\tif (/.group/.test(options.engine || ''))\n\t\t\t\t{\n\t\t\t\t\tthis.#renderPageSelector();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#renderProfileSelector();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tajax.runAction('crm.api.ads.leadads.account.loginCompletion', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t}\n\t\t}).then((data) => {\n\n\t\t}, (error) => {\n\t\t\tthis.handleLoginCompletionError(error);\n\t\t});\n\t}\n\n\t#loginProfile()\n\t{\n\t\tLoginFactory.getLoginObject({\n\t\t\tTYPE: this.type,\n\t\t\tENGINE_CODE: this.getProvider().engineCode,\n\t\t\tAUTH_URL: this.getProvider().authUrl,\n\t\t}).login();\n\t}\n\n\t#logoutProfile()\n\t{\n\t\tajax.runAction('crm.api.ads.leadads.service.logout',{\n\t\t\tdata: {\n\t\t\t\ttype: this.type\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.#requestAuthUrl();\n\t\t\tthis.#adAccounts = null;\n\t\t\tthis.getProvider().profile = null;\n\t\t\tthis.#renderProfileSelector();\n\t\t\tthis.#adForms = null;\n\t\t})\n\t}\n\n\t#loginGroup()\n\t{\n\t\tconst popup = BX.util.popup('', 800, 600);\n\t\tajax.runAction('crm.api.ads.leadads.service.registerGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroup: this.getAdAccountId(),\n\t\t\t}\n\t\t})\n\t\t\t.then(response => {\n\t\t\t\tpopup.location = response.data.authUrl;\n\t\t\t})\n\t\t;\n\t}\n\n\t#logoutGroup()\n\t{\n\t\tconst group = this.getProvider().group;\n\t\tif (!group.groupId)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn ajax.runAction('crm.api.ads.leadads.service.logoutGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroupId: group.groupId,\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tthis.getProvider().group.hasAuth = false;\n\t\t\tthis.#renderPageSelector();\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#container.innerHTML = '';\n\t\tif (!this.dictionary.integration.canUse)\n\t\t{\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tconst currentCase = this.getCase();\n\t\tif (currentCase && currentCase.linkDirection === 0)\n\t\t{\n\t\t\t// show alert and button for changing direction\n\t\t\tthis.#container.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tthis.#container.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#onClickChangeDirection(),\n\t\t\t})).render());\n\n\t\t\treturn this.#container;\n\t\t}\n\t\tthis.#container.appendChild(this.#renderProfileSelector());\n\t\treturn this.#container;\n\t}\n\n\t#renderProfileSelector()\n\t{\n\t\tif (!this.#profileContainer)\n\t\t{\n\t\t\tthis.#profileContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#profileContainer.innerHTML = '';\n\n\t\tconst provider = this.getProvider();\n\t\tif (!provider.profile)\n\t\t{\n\t\t\tthis.#profileContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: `\n\t\t\t\t\t<div class=\"ui-slider-heading-3\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_TITLE', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"ui-slider-paragraph-2\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_DESC', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</p>\n\t\t\t\t`,\n\t\t\t})).render());\n\t\t\tthis.#profileContainer.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#loginProfile(),\n\t\t\t})).render());\n\t\t\treturn this.#profileContainer;\n\t\t}\n\n\t\tthis.#profileContainer.appendChild(Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"crm-ads-conversion-block\">\n\t\t\t\t\t<div class=\"crm-ads-conversion-social crm-ads-conversion-social-facebook\"  style=\"padding-bottom: 15px; height: 58px;\">\n\t\t\t\t\t\t${this.showAvatar(provider)}\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-user\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t${provider.profile.url ? 'href=\"' + Tag.safe`${provider.profile.url}` + '\"' : \"\"}\n\t\t\t\t\t\t\t\ttarget=\"_top\"\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-user-link\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${Tag.safe`${provider.profile.name}`}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-shutoff\">\n\t\t\t\t\t\t\t${this.createLogoutProfileButton().render()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tif (this.type === 'vkontakte')\n\t\t{\n\t\t\tthis.#profileContainer.appendChild(this.#renderFormSelector());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#profileContainer.appendChild((this.#renderPageSelector()));\n\t\t}\n\n\t\tif (this.type === 'vkontakte')\n\t\t{\n\t\t\tthis.#checkNewProfile()\n\t\t}\n\n\t\treturn this.#profileContainer;\n\t}\n\n\tshowBannerForOldProfile()\n\t{\n\t\tconst message = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('CRM_FORM_INTEGRATION_JS_ALERT_POPUP_MESSAGE'),\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_ALERT_POPUP_TITLE'),\n\t\t\tminWidth: 517,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_ALERT_POPUP_BTN_YES'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tonclick: () => this.#loginProfile(),\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_ALERT_POPUP_BTN_OK'),\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tmessage.close()\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t\tmessage.show();\n\t}\n\n\tshowAvatar(provider)\n\t{\n\t\tif (provider.profile.picture !== undefined)\n\t\t{\n\t\t\treturn Tag.render`<div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"crm-ads-conversion-social-avatar-icon\"\n\t\t\t\t\tstyle=\"background-image: url(${Tag.safe`${provider.profile.picture}`})\"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\t}\n\n\t#setPageId(id)\n\t{\n\t\tthis.getCase().account.id = id || '';\n\t\tthis.getCase().account.name = (this.getAdAccount(id) || {}).name;\n\t\tthis.emit('change');\n\n\t\tthis.#adForms = null;\n\t\tthis.#renderPageSelector();\n\t}\n\n\t#renderPageSelector()\n\t{\n\t\tif (!this.#pagesContainer)\n\t\t{\n\t\t\tthis.#pagesContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#pagesContainer.innerHTML = '';\n\t\tif (!this.#adAccounts)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.account.getAccounts', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adAccounts = response.data.accounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: item.id + '',\n\t\t\t\t\t\tname: item.name + '',\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tthis.#renderPageSelector();\n\t\t\t});\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tif (this.#adAccounts.length === 0)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tconst id = this.getAdAccountId();\n\t\tconst pagesDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'page-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_' + this.type.toUpperCase()),\n\t\t\tcontent: id,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adAccounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\t\tpagesDropdown.subscribe('onChange', () => {\n\t\t\tthis.#setPageId(pagesDropdown.getValue());\n\t\t});\n\n\t\tconst container = Tag.render`<div class=\"crm-form-integration-page-container\"></div>`;\n\t\tconst selectorContainer = Tag.render`<div class=\"crm-form-integration-page-selector\"></div>`;\n\t\tselectorContainer.appendChild(pagesDropdown.getNode());\n\t\tcontainer.appendChild(selectorContainer);\n\n\t\tthis.#pagesContainer.appendChild(container);\n\n\t\tconst group = this.getProvider().group;\n\t\tconst hasAuthGroup = group.isAuthUsed && group.hasAuth && group.groupId;\n\t\tif (hasAuthGroup && id && id !== group.groupId)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_VKONTAKTE_RESTRICTED',\n\t\t\t\t\t{\n\t\t\t\t\t\t'%groupName%': (this.getAdAccount(group.groupId) || {}).name,\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_DISCONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tgroupConnectBtn.setWaiting(true);\n\t\t\t\t\tthis.#logoutGroup()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#pagesContainer.appendChild(groupConnectBtn.render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\n\t\tif (id && group.isAuthUsed && !group.hasAuth)\n\t\t{\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => this.#loginGroup(),\n\t\t\t});\n\t\t\tcontainer.appendChild(groupConnectBtn.render());\n\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_INFO'),\n\t\t\t})).render());\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tthis.#pagesContainer.appendChild(this.#renderFormSelector());\n\t\treturn this.#pagesContainer;\n\t}\n\n\t#renderFormSelector()\n\t{\n\t\tif (!this.#formsContainer)\n\t\t{\n\t\t\tthis.#formsContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#formsContainer.innerHTML = '';\n\n\t\t// hack for vk\n\t\tif (!this.getCase().account.id && this.type === 'vkontakte')\n\t\t{\n\t\t\tthis.#formsContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.account.getProfile', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adAccounts = [{\n\t\t\t\t\tid: response.data.profile.id + '',\n\t\t\t\t\tname: response.data.profile.name + '',\n\t\t\t\t}];\n\n\t\t\t\tthis.getCase().account.id = this.#adAccounts[0].id;\n\t\t\t\tthis.getCase().account.name = this.#adAccounts[0].name;\n\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t});\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (this.getProvider().hasPages)\n\t\t{\n\t\t\tconst accountId = this.getAdAccountId();\n\t\t\tif (!accountId)\n\t\t\t{\n\t\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CHOOSE'),\n\t\t\t\t})).render());\n\n\t\t\t\treturn this.#formsContainer;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.#adForms)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.form.list', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\taccountId: this.getAdAccountId() || 0,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adForms = response.data.forms.map(item => {\n\t\t\t\t\titem.id += '';\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t}).catch(response => {\n\t\t\t\tthis.#adFormsErrors = response.errors;\n\t\t\t\tthis.#adForms = [];\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t});\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (this.#adForms.length === 0)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: this.#adFormsErrors.length > 0 ? this.#adFormsErrors[0].message : Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_FORM_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tconst formsDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'form-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM'),\n\t\t\tcontent: this.getAdFormId(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adForms.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\n\t\tformsDropdown.subscribe('onChange', () => {\n\t\t\tconst formId = formsDropdown.getValue();\n\t\t\tthis.getCase().form.id = formId;\n\t\t\tthis.getCase().form.name = (this.getAdForm(formId) || {}).name;\n\t\t\tthis.getCase().fieldsMapping = [];\n\n\t\t\tthis.emit('change');\n\t\t\tthis.#renderMapper();\n\t\t});\n\n\t\tthis.#formsContainer.appendChild(formsDropdown.getNode());\n\n\t\tthis.#formsContainer.appendChild(this.#renderMapper());\n\n\t\treturn this.#formsContainer;\n\t}\n\n\t#renderLoader()\n\t{\n\t\tconst container = Tag.render`<div style=\"position: relative; min-height: 100px;\"></div>`;\n\t\t(new Loader()).show(container).then(() => {});\n\t\treturn container;\n\t}\n\n\t#renderMapper()\n\t{\n\t\tif (!this.#mapperContainer)\n\t\t{\n\t\t\tthis.#mapperContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#mapperContainer.innerHTML = '';\n\t\tif (!this.getAdForm())\n\t\t{\n\t\t\tthis.#mapperContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM_CHOOSE'),\n\t\t\t})).render());\n\n\t\t\treturn this.#mapperContainer;\n\t\t}\n\n\t\tconst mappingMessageContainer = Tag.render`<div style=\"margin-bottom: 29px\"></div>`;\n\t\t(new Alert({\n\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FIELD_MAP'),\n\t\t})).renderTo(mappingMessageContainer);\n\t\tthis.#mapperContainer.appendChild(mappingMessageContainer);\n\n\t\tif (this.getAdForm()?.fields === undefined)\n\t\t{\n\t\t\tthis.#mapperContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.form.get', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\taccountId: this.getAdAccountId() || 0,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t\tformId: this.getAdForm().id,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.getAdForm().fields = response.data.form.fields;\n\t\t\t\tthis.#renderMapper();\n\t\t\t}).catch(response => {\n\t\t\t\tthis.#adFormsErrors = response.errors;\n\t\t\t\tthis.#renderMapper();\n\t\t\t});\n\n\t\t\treturn this.#mapperContainer;\n\t\t}\n\t\tconst mapper = new Mapper({\n\t\t\tfrom: {\n\t\t\t\tcaption: this.getTypeTitle(),\n\t\t\t},\n\t\t\tfields: this.fields,\n\t\t\tmap: this.getAdForm().fields.map(field => {\n\t\t\t\tlet outputCode = this.getCase()\n\t\t\t\t\t.fieldsMapping\n\t\t\t\t\t.filter(item => item.adsFieldKey === field.key)[0]\n\t\t\t\t;\n\t\t\t\toutputCode = (outputCode || {}).crmFieldKey || '';\n\t\t\t\tif (!outputCode)\n\t\t\t\t{\n\t\t\t\t\toutputCode = this.getProvider()\n\t\t\t\t\t\t.defaultMapping\n\t\t\t\t\t\t.filter(item => {\n\t\t\t\t\t\t\treturn item.adsFieldType.toLowerCase() === (field.type || '').toLowerCase();\n\t\t\t\t\t\t})[0]\n\t\t\t\t\t;\n\t\t\t\t\toutputCode = (outputCode || {}).crmFieldType || '';\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinputType: (field.type || '').toLowerCase(),\n\t\t\t\t\tinputCode: field.key,\n\t\t\t\t\tinputName: field.label,\n\t\t\t\t\toutputCode,\n\t\t\t\t\toutputName: '',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\titems: field.options || [],\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t})\n\t\t});\n\n\t\tconst emitChangeEvent = () => {\n\t\t\tconst eventFields = [];\n\t\t\tthis.getCase().fieldsMapping =  mapper.getMap()\n\t\t\t\t.map(item => {\n\t\t\t\t\tif (item.outputCode)\n\t\t\t\t\t{\n\t\t\t\t\t\teventFields.push({name: item.outputCode});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcrmFieldKey: item.outputCode,\n\t\t\t\t\t\tadsFieldKey: item.inputCode,\n\t\t\t\t\t\titems: item.data.items || [],\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.filter(item => item.crmFieldKey)\n\t\t\t;\n\n\t\t\tthis.emit('change', {fields: eventFields});\n\t\t};\n\t\temitChangeEvent();\n\t\tmapper.subscribe('change', emitChangeEvent);\n\n\t\tthis.#mapperContainer.appendChild(mapper.render());\n\t\treturn this.#mapperContainer;\n\t}\n\n\thandleLoginCompletionError(error)\n\t{\n\t\t//show banner\n\t}\n\n\tcreateLogoutProfileButton()\n\t{\n\t\treturn new Button({\n\t\t\ttext : Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGOUT_BTN'),\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tround: true,\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\tonclick: this.#logoutProfile.bind(this),\n\t\t});\n\t}\n\n\t#checkNewProfile()\n\t{\n\t\tajax.runAction('crm.api.ads.leadads.service.checkProfile',{\n\t\t\tdata: {\n\t\t\t\ttype: this.type\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {},\n\t\t\t(error) => {\n\t\t\t\tthis.#logoutProfile();\n\t\t\t\tthis.showBannerForOldProfile();\n\t\t\t}\n\t\t)\n\t}\n\n\t#requestAuthUrl()\n\t{\n\t\tajax.runAction('crm.api.ads.leadads.service.getAuthUrl', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tthis.getProvider().authUrl = response.data.authUrl;\n\t\t});\n\n\t}\n}\n"],"names":["instances","Integration","options","type","form","fields","reload","dictionary","BX","addCustomEvent","window","forEach","instance","destroy","push","removeCustomEvent","item","integration","cases","filter","providerCode","profile","getProvider","linkDirection","date","account","id","name","fieldsMapping","providers","Loc","getMessage","toUpperCase","getCase","obj","getAdForm","some","getAdAccount","Tag","render","innerHTML","canUse","currentCase","appendChild","Alert","color","Color","WARNING","text","getTypeTitle","Button","ButtonColor","PRIMARY","onclick","message","MessageBox","create","title","minWidth","buttons","SUCCESS","LIGHT_BORDER","close","show","provider","picture","undefined","safe","error","round","size","Size","EXTRA_SMALL","bind","EventEmitter","emit","ajax","runAction","json","then","response","data","test","engine","handleLoginCompletionError","LoginFactory","getLoginObject","TYPE","ENGINE_CODE","engineCode","AUTH_URL","authUrl","login","popup","util","group","getAdAccountId","location","groupId","Promise","resolve","hasAuth","showAvatar","url","createLogoutProfileButton","proxyId","accounts","map","length","pagesDropdown","Landing","UI","Field","Dropdown","selector","content","items","value","subscribe","getValue","container","selectorContainer","getNode","hasAuthGroup","isAuthUsed","groupConnectBtn","className","setWaiting","hasPages","accountId","forms","errors","formsDropdown","getAdFormId","formId","Loader","mappingMessageContainer","renderTo","mapper","Mapper","from","caption","field","outputCode","adsFieldKey","key","crmFieldKey","defaultMapping","adsFieldType","toLowerCase","crmFieldType","inputType","inputCode","inputName","label","outputName","emitChangeEvent","eventFields","getMap","showBannerForOldProfile"],"mappings":"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"}