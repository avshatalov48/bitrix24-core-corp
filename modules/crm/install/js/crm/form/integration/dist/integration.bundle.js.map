{"version":3,"file":"integration.bundle.js","sources":["../src/integration.js"],"sourcesContent":["import 'ui.sidepanel-content';\nimport './integration.css';\nimport {Loc, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {FormDictionary, FormOptions} from \"crm.form.type\";\nimport {Mapper} from 'crm.form.fields.mapper';\nimport {Alert} from 'ui.alerts';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport 'ui.dropdown';\nimport {ajax} from \"main.core.ajax\";\nimport {Loader} from \"main.loader\";\nimport { LoginFactory } from 'seo.ads.login';\nimport { ClientSelector } from 'seo.ads.client_selector';\n\ntype Options = {\n\ttype: String;\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n};\n\nlet instances = [];\n\n/**\n * Crm-From Integration\n *\n * @memberOf BX.Crm.Form\n */\nexport class Integration extends EventEmitter\n{\n\tdictionary: FormDictionary;\n\tfields: Array<Object>;\n\tform: FormOptions;\n\ttype: String;\n\t#container: HTMLElement;\n\t#profileContainer: HTMLElement;\n\t#pagesContainer: HTMLElement;\n\t#formsContainer: HTMLElement;\n\t#mapperContainer: HTMLElement;\n\t#adForms: Array|null = null;\n\t#adFormsErrors: Array|null = null;\n\t#adAccounts: Array|null = null;\n\t#seoEventHandler: Function;\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.type = options.type;\n\t\tthis.form = options.form;\n\t\tthis.fields = options.fields;\n\t\tthis.#seoEventHandler = (options) => {\n\t\t\tthis.#onLogedIn(options);\n\t\t\toptions.reload = false;\n\t\t};\n\n\t\tthis.dictionary = options.dictionary;\n\t\tBX.addCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\n\t\tinstances.forEach(instance => instance.destroy());\n\t\tinstances = [];\n\t\tinstances.push(this);\n\t}\n\n\tdestroy()\n\t{\n\t\tBX.removeCustomEvent(window, 'seo-client-auth-result', this.#seoEventHandler);\n\t}\n\n\tgetCase()\n\t{\n\t\tlet item = this.form.integration.cases.filter(item => item.providerCode === this.type)[0] || null;\n\t\tif (!item)\n\t\t{\n\t\t\tconst profile = (this.getProvider() || {}).profile || {};\n\t\t\titem = {\n\t\t\t\tlinkDirection: 1,\n\t\t\t\tproviderCode: this.type,\n\t\t\t\tdate: null,\n\t\t\t\taccount: {\n\t\t\t\t\tid: profile.id || null,\n\t\t\t\t\tname: profile.name || null,\n\t\t\t\t},\n\t\t\t\tform: {\n\t\t\t\t\tid: null,\n\t\t\t\t\tname: null,\n\t\t\t\t},\n\t\t\t\tfieldsMapping: [],\n\t\t\t};\n\n\t\t\tthis.form.integration.cases.push(item);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetProvider()\n\t{\n\t\treturn this.dictionary.integration.providers.filter(item => item.type === this.type)[0] || null;\n\t}\n\n\tgetTypeTitle()\n\t{\n\t\treturn Loc.getMessage('CRM_FORM_INTEGRATION_JS_PROVIDER_' + this.type.toUpperCase());\n\t}\n\n\tgetAdForm(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().form.id + '';\n\t\t}\n\n\t\treturn (this.#adForms || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\tgetAdAccount(id: string = null)\n\t{\n\t\tif (id === null)\n\t\t{\n\t\t\tid = this.getCase().account.id;\n\t\t}\n\n\t\treturn (this.#adAccounts || []).filter(item => item.id === id)[0] || null;\n\t}\n\n\n\tgetAdFormId()\n\t{\n\t\tconst obj = this.getAdForm();\n\t\tif (obj && this.#adForms.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetAdAccountId()\n\t{\n\t\tconst obj = this.getAdAccount();\n\t\tif (obj && this.#adAccounts.some(item => item.id === obj.id))\n\t\t{\n\t\t\treturn obj.id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onClickChangeDirection()\n\t{\n\t\tthis.getCase().linkDirection = 1;\n\t\tthis.emit('change');\n\t\tthis.render();\n\t}\n\n\t#onLogedIn(options)\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runAction('crm.api.form.getDict', {json: {}})\n\t\t\t.then(response => response.data)\n\t\t\t.then(data => {\n\t\t\t\tthis.dictionary.integration = data.integration;\n\t\t\t\tif (/.group/.test(options.engine || ''))\n\t\t\t\t{\n\t\t\t\t\tthis.#renderPageSelector();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\n\t\t\t\t\tthis.#renderProfileSelector();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#loginProfile()\n\t{\n\t\tLoginFactory.getLoginObject({\n\t\t\tTYPE: this.type,\n\t\t\tENGINE_CODE: this.getProvider().engineCode,\n\t\t\tAUTH_URL: this.getProvider().authUrl,\n\t\t}).login();\n\t}\n\n\t#logoutProfile()\n\t{\n\t\tajax.runAction('crm.api.ads.leadads.service.logout',{\n\t\t\tdata: {\n\t\t\t\ttype: this.type\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.#adAccounts = null;\n\t\t\t\tthis.getProvider().profile = null;\n\t\t\t\tthis.#renderProfileSelector();\n\t\t\t})\n\t}\n\n\t#loginGroup()\n\t{\n\t\tconst popup = BX.util.popup('', 800, 600);\n\t\tajax.runAction('crm.api.ads.leadads.service.registerGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroup: this.getAdAccountId(),\n\t\t\t}\n\t\t})\n\t\t\t.then(response => {\n\t\t\t\tpopup.location = response.data.authUrl;\n\t\t\t})\n\t\t;\n\t}\n\n\t#logoutGroup()\n\t{\n\t\tconst group = this.getProvider().group;\n\t\tif (!group.groupId)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn ajax.runAction('crm.api.ads.leadads.service.logoutGroup', {\n\t\t\tdata: {\n\t\t\t\ttype: this.type,\n\t\t\t\tgroupId: group.groupId,\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tthis.getProvider().group.hasAuth = false;\n\t\t\tthis.#renderPageSelector();\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#container.innerHTML = '';\n\t\tif (!this.dictionary.integration.canUse)\n\t\t{\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tconst currentCase = this.getCase();\n\t\tif (currentCase && currentCase.linkDirection === 0)\n\t\t{\n\t\t\t// show alert and button for changing direction\n\t\t\tthis.#container.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tthis.#container.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NEW_INTEGRATION_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#onClickChangeDirection(),\n\t\t\t})).render());\n\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tthis.#container.appendChild(this.#renderProfileSelector());\n\t\treturn this.#container;\n\t}\n\n\t#renderProfileSelector()\n\t{\n\t\tif (!this.#profileContainer)\n\t\t{\n\t\t\tthis.#profileContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#profileContainer.innerHTML = '';\n\n\t\tconst provider = this.getProvider();\n\t\tif (!provider.profile)\n\t\t{\n\t\t\tthis.#profileContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: `\n\t\t\t\t\t<div class=\"ui-slider-heading-3\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_TITLE', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"ui-slider-paragraph-2\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_DESC', {'%providerName%': this.getTypeTitle()})}\n\t\t\t\t\t</p>\n\t\t\t\t`,\n\t\t\t})).render());\n\t\t\tthis.#profileContainer.appendChild((new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGIN_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tonclick: () => this.#loginProfile(),\n\t\t\t})).render());\n\t\t\treturn this.#profileContainer;\n\t\t}\n\n\t\tthis.#profileContainer.appendChild(Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"crm-ads-conversion-block\">\n\t\t\t\t\t<div class=\"crm-ads-conversion-social crm-ads-conversion-social-facebook\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-avatar-icon\"\n\t\t\t\t\t\t\t\tstyle=\"background-image: url(${Tag.safe`${provider.profile.picture}`})\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-user\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t${provider.profile.url ? 'href=\"' + Tag.safe`${provider.profile.url}` + '\"' : \"\"}\n\t\t\t\t\t\t\t\ttarget=\"_top\"\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-user-link\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${Tag.safe`${provider.profile.name}`}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-ads-conversion-social-shutoff\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"crm-ads-conversion-social-shutoff-link\"\n\t\t\t\t\t\t\t\tonclick=\"${this.#logoutProfile.bind(this)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_INTEGRATION_JS_LOGOUT_BTN')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.#profileContainer.appendChild(this.#renderPageSelector());\n\t\treturn this.#profileContainer;\n\t}\n\n\t#setPageId(id)\n\t{\n\t\tthis.getCase().account.id = id || '';\n\t\tthis.getCase().account.name = (this.getAdAccount(id) || {}).name;\n\t\tthis.emit('change');\n\n\t\tthis.#adForms = null;\n\t\tthis.#renderPageSelector();\n\t}\n\n\t#renderPageSelector()\n\t{\n\t\tif (!this.#pagesContainer)\n\t\t{\n\t\t\tthis.#pagesContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#pagesContainer.innerHTML = '';\n\t\tif (!this.#adAccounts)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.account.getAccounts', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adAccounts = response.data.accounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: item.id + '',\n\t\t\t\t\t\tname: item.name + '',\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tthis.#renderPageSelector();\n\t\t\t});\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tif (this.#adAccounts.length === 0)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tconst id = this.getAdAccountId();\n\t\tconst pagesDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'page-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_' + this.type.toUpperCase()),\n\t\t\tcontent: id,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adAccounts.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\t\tpagesDropdown.subscribe('onChange', () => {\n\t\t\tthis.#setPageId(pagesDropdown.getValue());\n\t\t});\n\n\t\tconst container = Tag.render`<div class=\"crm-form-integration-page-container\"></div>`;\n\t\tconst selectorContainer = Tag.render`<div class=\"crm-form-integration-page-selector\"></div>`;\n\t\tselectorContainer.appendChild(pagesDropdown.getNode());\n\t\tcontainer.appendChild(selectorContainer);\n\n\t\tthis.#pagesContainer.appendChild(container);\n\n\t\tconst group = this.getProvider().group;\n\t\tconst hasAuthGroup = group.isAuthUsed && group.hasAuth && group.groupId;\n\t\tif (hasAuthGroup && id && id !== group.groupId)\n\t\t{\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.WARNING,\n\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_PAGE_VKONTAKTE_RESTRICTED',\n\t\t\t\t\t{\n\t\t\t\t\t\t'%groupName%': (this.getAdAccount(group.groupId) || {}).name,\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t})).render());\n\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_DISCONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tgroupConnectBtn.setWaiting(true);\n\t\t\t\t\tthis.#logoutGroup()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tgroupConnectBtn.setWaiting(false);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#pagesContainer.appendChild(groupConnectBtn.render());\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\n\t\tif (id && group.isAuthUsed && !group.hasAuth)\n\t\t{\n\t\t\tconst groupConnectBtn = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_BTN'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tclassName: '',\n\t\t\t\tonclick: () => this.#loginGroup(),\n\t\t\t});\n\t\t\tcontainer.appendChild(groupConnectBtn.render());\n\n\t\t\tthis.#pagesContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CONNECT_INFO'),\n\t\t\t})).render());\n\n\t\t\treturn this.#pagesContainer;\n\t\t}\n\n\t\tthis.#pagesContainer.appendChild(this.#renderFormSelector());\n\t\treturn this.#pagesContainer;\n\t}\n\n\t#renderFormSelector()\n\t{\n\t\tif (!this.#formsContainer)\n\t\t{\n\t\t\tthis.#formsContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#formsContainer.innerHTML = '';\n\n\t\tconst accountId = this.getAdAccountId();\n\t\tif (!accountId)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_PAGE_CHOOSE'),\n\t\t\t})).render());\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (!this.#adForms)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild(this.#renderLoader());\n\t\t\tajax.runAction('crm.api.ads.leadads.form.list', {\n\t\t\t\tdata: {\n\t\t\t\t\ttype: this.type,\n\t\t\t\t\taccountId,\n\t\t\t\t\tproxyId: null,\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tthis.#adForms = response.data.forms.map(item => {\n\t\t\t\t\titem.id += '';\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t}).catch(response => {\n\t\t\t\tthis.#adFormsErrors = response.errors;\n\t\t\t\tthis.#adForms = [];\n\t\t\t\tthis.#renderFormSelector();\n\t\t\t});\n\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tif (this.#adForms.length === 0)\n\t\t{\n\t\t\tthis.#formsContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: this.#adFormsErrors.length > 0 ? this.#adFormsErrors[0].message : Loc.getMessage(\n\t\t\t\t\t'CRM_FORM_INTEGRATION_JS_FORM_EMPTY',\n\t\t\t\t\t{'%providerName%': this.getTypeTitle()}\n\t\t\t\t),\n\t\t\t})).render());\n\t\t\treturn this.#formsContainer;\n\t\t}\n\n\t\tconst formsDropdown = new BX.Landing.UI.Field.Dropdown({\n\t\t\tselector: 'form-list',\n\t\t\ttitle: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM'),\n\t\t\tcontent: this.getAdFormId(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('CRM_FORM_INTEGRATION_JS_NOT_SELECTED'),\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t...this.#adForms.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t});\n\n\t\tformsDropdown.subscribe('onChange', () => {\n\t\t\tconst formId = formsDropdown.getValue();\n\t\t\tthis.getCase().form.id = formId;\n\t\t\tthis.getCase().form.name = (this.getAdForm(formId) || {}).name;\n\t\t\tthis.getCase().fieldsMapping = [];\n\n\t\t\tthis.emit('change');\n\t\t\tthis.#renderMapper();\n\t\t});\n\n\t\tthis.#formsContainer.appendChild(formsDropdown.getNode());\n\t\tthis.#formsContainer.appendChild(this.#renderMapper());\n\n\t\treturn this.#formsContainer;\n\t}\n\n\t#renderLoader()\n\t{\n\t\tconst container = Tag.render`<div style=\"position: relative; min-height: 100px;\"></div>`;\n\t\t(new Loader()).show(container).then(() => {});\n\t\treturn container;\n\t}\n\n\t#renderMapper()\n\t{\n\t\tif (!this.#mapperContainer)\n\t\t{\n\t\t\tthis.#mapperContainer = Tag.render`<div></div>`;\n\t\t}\n\n\t\tthis.#mapperContainer.innerHTML = '';\n\t\tif (!this.getAdForm())\n\t\t{\n\t\t\tthis.#mapperContainer.appendChild((new Alert({\n\t\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FORM_CHOOSE'),\n\t\t\t})).render());\n\n\t\t\treturn this.#mapperContainer;\n\t\t}\n\n\t\tconst mappingMessageContainer = Tag.render`<div style=\"margin-bottom: 40px\"></div>`;\n\t\t(new Alert({\n\t\t\tcolor: Alert.Color.PRIMARY,\n\t\t\ttext: Loc.getMessage('CRM_FORM_INTEGRATION_JS_FIELD_MAP'),\n\t\t})).renderTo(mappingMessageContainer);\n\t\tthis.#mapperContainer.appendChild(mappingMessageContainer);\n\n\t\tconst mapper = new Mapper({\n\t\t\tfrom: {\n\t\t\t\tcaption: this.getTypeTitle(),\n\t\t\t},\n\t\t\tfields: this.fields,\n\t\t\tmap: this.getAdForm().fields.map(field => {\n\t\t\t\tlet outputCode = this.getCase()\n\t\t\t\t\t.fieldsMapping\n\t\t\t\t\t.filter(item => item.adsFieldKey === field.key)[0]\n\t\t\t\t;\n\t\t\t\toutputCode = (outputCode || {}).crmFieldKey || '';\n\t\t\t\tif (!outputCode)\n\t\t\t\t{\n\t\t\t\t\toutputCode = this.getProvider()\n\t\t\t\t\t\t.defaultMapping\n\t\t\t\t\t\t.filter(item => {\n\t\t\t\t\t\t\treturn item.adsFieldType.toLowerCase() === (field.type || '').toLowerCase();\n\t\t\t\t\t\t})[0]\n\t\t\t\t\t;\n\t\t\t\t\toutputCode = (outputCode || {}).crmFieldType || '';\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinputType: (field.type || '').toLowerCase(),\n\t\t\t\t\tinputCode: field.key,\n\t\t\t\t\tinputName: field.label,\n\t\t\t\t\toutputCode,\n\t\t\t\t\toutputName: '',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\titems: field.options || [],\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t})\n\t\t});\n\n\t\tconst emitChangeEvent = () => {\n\t\t\tconst eventFields = [];\n\t\t\tthis.getCase().fieldsMapping =  mapper.getMap()\n\t\t\t\t.map(item => {\n\t\t\t\t\tif (item.outputCode)\n\t\t\t\t\t{\n\t\t\t\t\t\teventFields.push({name: item.outputCode});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcrmFieldKey: item.outputCode,\n\t\t\t\t\t\tadsFieldKey: item.inputCode,\n\t\t\t\t\t\titems: item.data.items || [],\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.filter(item => item.crmFieldKey)\n\t\t\t;\n\n\t\t\tthis.emit('change', {fields: eventFields});\n\t\t};\n\t\temitChangeEvent();\n\t\tmapper.subscribe('change', emitChangeEvent);\n\n\t\tthis.#mapperContainer.appendChild(mapper.render());\n\t\treturn this.#mapperContainer;\n\t}\n}\n"],"names":["instances","Integration","options","type","form","fields","reload","dictionary","BX","addCustomEvent","window","forEach","instance","destroy","push","removeCustomEvent","item","integration","cases","filter","providerCode","profile","getProvider","linkDirection","date","account","id","name","fieldsMapping","providers","Loc","getMessage","toUpperCase","getCase","obj","getAdForm","some","getAdAccount","Tag","render","innerHTML","canUse","currentCase","appendChild","Alert","color","Color","WARNING","text","getTypeTitle","Button","ButtonColor","PRIMARY","onclick","EventEmitter","emit","ajax","runAction","json","then","response","data","test","engine","LoginFactory","getLoginObject","TYPE","ENGINE_CODE","engineCode","AUTH_URL","authUrl","login","popup","util","group","getAdAccountId","location","groupId","Promise","resolve","hasAuth","provider","safe","picture","url","bind","proxyId","accounts","map","length","pagesDropdown","Landing","UI","Field","Dropdown","selector","title","content","items","value","subscribe","getValue","container","selectorContainer","getNode","hasAuthGroup","isAuthUsed","groupConnectBtn","className","setWaiting","accountId","forms","errors","message","formsDropdown","getAdFormId","formId","Loader","show","mappingMessageContainer","renderTo","mapper","Mapper","from","caption","field","outputCode","adsFieldKey","key","crmFieldKey","defaultMapping","adsFieldType","toLowerCase","crmFieldType","inputType","inputCode","inputName","label","outputName","emitChangeEvent","eventFields","getMap"],"mappings":"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"}