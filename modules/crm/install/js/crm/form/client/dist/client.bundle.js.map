{"version":3,"file":"client.bundle.js","sources":["../src/internal/request.js","../src/client.js"],"sourcesContent":["import {ajax, Type} from 'main.core';\n\nexport type RequestOptions = {\n\taction: string,\n\tdata: {[key: string]: any},\n};\n\nexport type RequestErrorItem = {\n\tcode: string,\n\tmessage: string,\n\tcustomData: any,\n};\n\nexport type RequestError = Array<RequestErrorItem>;\n\nexport default function request<T>(options: RequestOptions): Promise<T, RequestError>\n{\n\tconst action = options.action.replace('crm.api.form.', '');\n\tconst data = Type.isPlainObject(options.data) ? options.data : {};\n\n\treturn new Promise((resolve, reject) => {\n\t\tajax\n\t\t\t.runAction(`crm.api.form.${action}`, {json: data})\n\t\t\t.then((response) => {\n\t\t\t\tresolve(response.data);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\treject(error.errors);\n\t\t\t});\n\t});\n}","import {Cache, Type} from 'main.core';\nimport type {FormDictionary, PreparingOptions, FormOptions} from 'crm.form.type';\nimport request from './internal/request';\nimport type {RequestError} from './internal/request';\n\nconst instance = Symbol('instance');\n\n/**\n * Crm-From client\n * Implements singleton pattern\n *\n * @example\n * import {Client} from 'crm.form.client';\n * const client = Client.getInstance();\n *\n * client\n * \t\t.loadOptionsById(formId)\n * \t\t.then((options) => {\n * \t\t\t// ...\n * \t\t});\n *\n * @memberOf BX.Crm.Form\n */\nexport class FormClient\n{\n\tstatic getInstance(): FormClient\n\t{\n\t\tif (!FormClient[instance])\n\t\t{\n\t\t\tFormClient[instance] = new FormClient();\n\t\t}\n\n\t\treturn FormClient[instance];\n\t}\n\n\tcache = new Cache.MemoryCache();\n\n\tgetOptions(formId: number): Promise<FormOptions, RequestError>\n\t{\n\t\treturn this.cache.remember(`formOptions#${formId}`, () => {\n\t\t\treturn request({\n\t\t\t\taction: 'get',\n\t\t\t\tdata: {id: formId},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDictionary(): Promise<FormDictionary, RequestError>\n\t{\n\t\treturn this.cache.remember('formDictionary', () => {\n\t\t\treturn request({action: 'getDict'});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tprepareOptions(options: FormOptions, preparing: PreparingOptions): Promise<any>\n\t{\n\t\treturn request({action: 'prepare', data: {options, preparing}});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tsaveOptions(options: FormOptions): Promise<any, RequestError>\n\t{\n\t\treturn request({action: 'save', data: {options}});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tcheckFields(options: FormOptions): Promise<any>\n\t{\n\t\treturn request({action: 'check', data: {options}});\n\t}\n\n\tresetCache(formId?: number)\n\t{\n\t\tif (Type.isNumber(formId) || Type.isStringFilled(formId))\n\t\t{\n\t\t\tthis.cache.delete(`formOptions#${formId}`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.cache.keys()\n\t\t\t\t.filter((key) => {\n\t\t\t\t\treturn key.startsWith('formOptions#');\n\t\t\t\t})\n\t\t\t\t.forEach((key) => {\n\t\t\t\t\tthis.cache.delete(key);\n\t\t\t\t});\n\t\t}\n\t}\n\n\tcheck(options): Promise<any>\n\t{\n\t\treturn request({action: 'check', data: {options}});\n\t}\n}"],"names":["request","options","action","replace","data","Type","isPlainObject","Promise","resolve","reject","ajax","runAction","json","then","response","catch","error","errors","instance","Symbol","FormClient","Cache","MemoryCache","formId","cache","remember","id","preparing","isNumber","isStringFilled","delete","keys","filter","key","startsWith","forEach"],"mappings":";;;;;CAee,SAASA,OAAT,CAAoBC,OAApB,EACf;CACC,MAAMC,MAAM,GAAGD,OAAO,CAACC,MAAR,CAAeC,OAAf,CAAuB,eAAvB,EAAwC,EAAxC,CAAf;CACA,MAAMC,IAAI,GAAGC,cAAI,CAACC,aAAL,CAAmBL,OAAO,CAACG,IAA3B,IAAmCH,OAAO,CAACG,IAA3C,GAAkD,EAA/D;CAEA,SAAO,IAAIG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CACvCC,IAAAA,cAAI,CACFC,SADF,wBAC4BT,MAD5B,GACsC;CAACU,MAAAA,IAAI,EAAER;CAAP,KADtC,EAEES,IAFF,CAEO,UAACC,QAAD,EAAc;CACnBN,MAAAA,OAAO,CAACM,QAAQ,CAACV,IAAV,CAAP;CACA,KAJF,EAKEW,KALF,CAKQ,UAACC,KAAD,EAAW;CACjBP,MAAAA,MAAM,CAACO,KAAK,CAACC,MAAP,CAAN;CACA,KAPF;CAQA,GATM,CAAP;CAUA;;CCzBD,IAAMC,QAAQ,GAAGC,MAAM,CAAC,UAAD,CAAvB;CAEA;;;;;;;;;;;;;;;;;AAgBA,KAAaC,UAAb;CAAA;CAAA;CAAA,+CAYS,IAAIC,eAAK,CAACC,WAAV,EAZT;CAAA;;CAAA;CAAA;CAAA,+BAcYC,MAdZ,EAeC;CACC,aAAO,KAAKC,KAAL,CAAWC,QAAX,uBAAmCF,MAAnC,GAA6C,YAAM;CACzD,eAAOvB,OAAO,CAAC;CACdE,UAAAA,MAAM,EAAE,KADM;CAEdE,UAAAA,IAAI,EAAE;CAACsB,YAAAA,EAAE,EAAEH;CAAL;CAFQ,SAAD,CAAd;CAIA,OALM,CAAP;CAMA;CAtBF;CAAA;CAAA,oCAyBC;CACC,aAAO,KAAKC,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC,YAAM;CAClD,eAAOzB,OAAO,CAAC;CAACE,UAAAA,MAAM,EAAE;CAAT,SAAD,CAAd;CACA,OAFM,CAAP;CAGA,KA7BF;;CAAA;CAAA;CAAA,mCAgCgBD,OAhChB,EAgCsC0B,SAhCtC,EAiCC;CACC,aAAO3B,OAAO,CAAC;CAACE,QAAAA,MAAM,EAAE,SAAT;CAAoBE,QAAAA,IAAI,EAAE;CAACH,UAAAA,OAAO,EAAPA,OAAD;CAAU0B,UAAAA,SAAS,EAATA;CAAV;CAA1B,OAAD,CAAd;CACA,KAnCF;;CAAA;CAAA;CAAA,gCAsCa1B,OAtCb,EAuCC;CACC,aAAOD,OAAO,CAAC;CAACE,QAAAA,MAAM,EAAE,MAAT;CAAiBE,QAAAA,IAAI,EAAE;CAACH,UAAAA,OAAO,EAAPA;CAAD;CAAvB,OAAD,CAAd;CACA,KAzCF;;CAAA;CAAA;CAAA,gCA4CaA,OA5Cb,EA6CC;CACC,aAAOD,OAAO,CAAC;CAACE,QAAAA,MAAM,EAAE,OAAT;CAAkBE,QAAAA,IAAI,EAAE;CAACH,UAAAA,OAAO,EAAPA;CAAD;CAAxB,OAAD,CAAd;CACA;CA/CF;CAAA;CAAA,+BAiDYsB,MAjDZ,EAkDC;CAAA;;CACC,UAAIlB,cAAI,CAACuB,QAAL,CAAcL,MAAd,KAAyBlB,cAAI,CAACwB,cAAL,CAAoBN,MAApB,CAA7B,EACA;CACC,aAAKC,KAAL,CAAWM,MAAX,uBAAiCP,MAAjC;CACA,OAHD,MAKA;CACC,aAAKC,KAAL,CAAWO,IAAX,GACEC,MADF,CACS,UAACC,GAAD,EAAS;CAChB,iBAAOA,GAAG,CAACC,UAAJ,CAAe,cAAf,CAAP;CACA,SAHF,EAIEC,OAJF,CAIU,UAACF,GAAD,EAAS;CACjB,UAAA,KAAI,CAACT,KAAL,CAAWM,MAAX,CAAkBG,GAAlB;CACA,SANF;CAOA;CACD;CAjEF;CAAA;CAAA,0BAmEOhC,OAnEP,EAoEC;CACC,aAAOD,OAAO,CAAC;CAACE,QAAAA,MAAM,EAAE,OAAT;CAAkBE,QAAAA,IAAI,EAAE;CAACH,UAAAA,OAAO,EAAPA;CAAD;CAAxB,OAAD,CAAd;CACA;CAtEF;CAAA;CAAA,kCAGC;CACC,UAAI,CAACmB,UAAU,CAACF,QAAD,CAAf,EACA;CACCE,QAAAA,UAAU,CAACF,QAAD,CAAV,GAAuB,IAAIE,UAAJ,EAAvB;CACA;;CAED,aAAOA,UAAU,CAACF,QAAD,CAAjB;CACA;CAVF;CAAA;CAAA;;;;;;;;"}