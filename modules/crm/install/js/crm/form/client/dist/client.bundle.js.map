{"version":3,"file":"client.bundle.js","sources":["../src/internal/request.js","../src/client.js"],"sourcesContent":["import {ajax, Type} from 'main.core';\n\nexport type RequestOptions = {\n\taction: string,\n\tdata: {[key: string]: any},\n};\n\nexport type RequestErrorItem = {\n\tcode: string,\n\tmessage: string,\n\tcustomData: any,\n};\n\nexport type RequestError = Array<RequestErrorItem>;\n\nexport default function request<T>(options: RequestOptions): Promise<T, RequestError>\n{\n\tconst action = options.action.replace('crm.api.form.', '');\n\tconst data = Type.isPlainObject(options.data) ? options.data : {};\n\n\treturn new Promise((resolve, reject) => {\n\t\tajax\n\t\t\t.runAction(`crm.api.form.${action}`, {json: data})\n\t\t\t.then((response) => {\n\t\t\t\tresolve(response.data);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\treject(error.errors);\n\t\t\t});\n\t});\n}","import {Cache, Type} from 'main.core';\nimport type {FormDictionary, PreparingOptions, FormOptions} from 'crm.form.type';\nimport request from './internal/request';\nimport type {RequestError} from './internal/request';\n\nconst instance = Symbol('instance');\n\n/**\n * Crm-From client\n * Implements singleton pattern\n *\n * @example\n * import {Client} from 'crm.form.client';\n * const client = Client.getInstance();\n *\n * client\n * \t\t.loadOptionsById(formId)\n * \t\t.then((options) => {\n * \t\t\t// ...\n * \t\t});\n *\n * @memberOf BX.Crm.Form\n */\nexport class FormClient\n{\n\tstatic getInstance(): FormClient\n\t{\n\t\tif (!FormClient[instance])\n\t\t{\n\t\t\tFormClient[instance] = new FormClient();\n\t\t}\n\n\t\treturn FormClient[instance];\n\t}\n\n\tcache = new Cache.MemoryCache();\n\n\tgetOptions(formId: number): Promise<FormOptions, RequestError>\n\t{\n\t\treturn this.cache.remember(`formOptions#${formId}`, () => {\n\t\t\treturn request({\n\t\t\t\taction: 'get',\n\t\t\t\tdata: {id: formId},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDictionary(): Promise<FormDictionary, RequestError>\n\t{\n\t\treturn this.cache.remember('formDictionary', () => {\n\t\t\treturn request({action: 'getDict'});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tprepareOptions(options: FormOptions, preparing: PreparingOptions): Promise<any>\n\t{\n\t\treturn request({action: 'prepare', data: {options, preparing}});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tsaveOptions(options: FormOptions): Promise<any, RequestError>\n\t{\n\t\treturn request({action: 'save', data: {options}});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tcheckFields(options: FormOptions): Promise<any>\n\t{\n\t\treturn request({action: 'check', data: {options}});\n\t}\n\n\tresetCache(formId?: number)\n\t{\n\t\tif (Type.isNumber(formId) || Type.isStringFilled(formId))\n\t\t{\n\t\t\tthis.cache.delete(`formOptions#${formId}`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.cache.keys()\n\t\t\t\t.filter((key) => {\n\t\t\t\t\treturn key.startsWith('formOptions#');\n\t\t\t\t})\n\t\t\t\t.forEach((key) => {\n\t\t\t\t\tthis.cache.delete(key);\n\t\t\t\t});\n\t\t}\n\t}\n\n\tcheck(options): Promise<any>\n\t{\n\t\treturn request({action: 'check', data: {options}});\n\t}\n}"],"names":["request","options","action","replace","data","Type","isPlainObject","Promise","resolve","reject","ajax","runAction","json","then","response","error","errors","instance","Symbol","FormClient","Cache","MemoryCache","formId","cache","remember","id","preparing","isNumber","isStringFilled","keys","filter","key","startsWith","forEach"],"mappings":";;;;;CAee,SAASA,OAAT,CAAoBC,OAApB,EACf;GACC,IAAMC,MAAM,GAAGD,OAAO,CAACC,MAAR,CAAeC,OAAf,CAAuB,eAAvB,EAAwC,EAAxC,CAAf;GACA,IAAMC,IAAI,GAAGC,cAAI,CAACC,aAAL,CAAmBL,OAAO,CAACG,IAA3B,IAAmCH,OAAO,CAACG,IAA3C,GAAkD,EAA/D;GAEA,OAAO,IAAIG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;KACvCC,cAAI,CACFC,SADF,wBAC4BT,MAD5B,GACsC;OAACU,IAAI,EAAER;MAD7C,EAEES,IAFF,CAEO,UAACC,QAAD,EAAc;OACnBN,OAAO,CAACM,QAAQ,CAACV,IAAV,CAAP;MAHF,WAKQ,UAACW,KAAD,EAAW;OACjBN,MAAM,CAACM,KAAK,CAACC,MAAP,CAAN;MANF;IADM,CAAP;CAUA;;CCzBD,IAAMC,QAAQ,GAAGC,MAAM,CAAC,UAAD,CAAvB;CAEA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;;AACA,KAAaC,UAAb;GAAA;KAAA;KAAA,2CAYS,IAAIC,eAAK,CAACC,WAAV,EAZT;;;GAAA;KAAA;KAAA,2BAcYC,MAdZ,EAeC;OACC,OAAO,KAAKC,KAAL,CAAWC,QAAX,uBAAmCF,MAAnC,GAA6C,YAAM;SACzD,OAAOtB,OAAO,CAAC;WACdE,MAAM,EAAE,KADM;WAEdE,IAAI,EAAE;aAACqB,EAAE,EAAEH;;UAFE,CAAd;QADM,CAAP;;;KAhBF;KAAA,gCAyBC;OACC,OAAO,KAAKC,KAAL,CAAWC,QAAX,CAAoB,gBAApB,EAAsC,YAAM;SAClD,OAAOxB,OAAO,CAAC;WAACE,MAAM,EAAE;UAAV,CAAd;QADM,CAAP;MA1BF;;;KAAA;KAAA,+BAgCgBD,OAhChB,EAgCsCyB,SAhCtC,EAiCC;OACC,OAAO1B,OAAO,CAAC;SAACE,MAAM,EAAE,SAAT;SAAoBE,IAAI,EAAE;WAACH,OAAO,EAAPA,OAAD;WAAUyB,SAAS,EAATA;;QAArC,CAAd;MAlCF;;;KAAA;KAAA,4BAsCazB,OAtCb,EAuCC;OACC,OAAOD,OAAO,CAAC;SAACE,MAAM,EAAE,MAAT;SAAiBE,IAAI,EAAE;WAACH,OAAO,EAAPA;;QAAzB,CAAd;MAxCF;;;KAAA;KAAA,4BA4CaA,OA5Cb,EA6CC;OACC,OAAOD,OAAO,CAAC;SAACE,MAAM,EAAE,OAAT;SAAkBE,IAAI,EAAE;WAACH,OAAO,EAAPA;;QAA1B,CAAd;;;KA9CF;KAAA,2BAiDYqB,MAjDZ,EAkDC;OAAA;;OACC,IAAIjB,cAAI,CAACsB,QAAL,CAAcL,MAAd,KAAyBjB,cAAI,CAACuB,cAAL,CAAoBN,MAApB,CAA7B,EACA;SACC,KAAKC,KAAL,iCAAiCD,MAAjC;QAFD,MAKA;SACC,KAAKC,KAAL,CAAWM,IAAX,GACEC,MADF,CACS,UAACC,GAAD,EAAS;WAChB,OAAOA,GAAG,CAACC,UAAJ,CAAe,cAAf,CAAP;UAFF,EAIEC,OAJF,CAIU,UAACF,GAAD,EAAS;WACjB,KAAI,CAACR,KAAL,WAAkBQ,GAAlB;UALF;;;;KAzDH;KAAA,sBAmEO9B,OAnEP,EAoEC;OACC,OAAOD,OAAO,CAAC;SAACE,MAAM,EAAE,OAAT;SAAkBE,IAAI,EAAE;WAACH,OAAO,EAAPA;;QAA1B,CAAd;;;KArEF;KAAA,8BAGC;OACC,IAAI,CAACkB,UAAU,CAACF,QAAD,CAAf,EACA;SACCE,UAAU,CAACF,QAAD,CAAV,GAAuB,IAAIE,UAAJ,EAAvB;;;OAGD,OAAOA,UAAU,CAACF,QAAD,CAAjB;;;GATF;CAAA;;;;;;;;"}