{"version":3,"file":"captcha.bundle.js","sources":["../src/captcha.js"],"sourcesContent":["import {Tag, Type, Loc, ajax} from 'main.core';\nimport {Layout} from \"ui.sidepanel.layout\";\nimport \"ui.notification\";\n\nexport class Captcha\n{\n\tstatic open(): Promise\n\t{\n\t\tlet resolver;\n\t\tconst promise = new Promise(resolve => {\n\t\t\tresolver = resolve;\n\t\t});\n\n\t\tconst instance = new Captcha;\n\t\tBX.SidePanel.Instance.open(\"crm.webform:captcha\", {\n\t\t\twidth: 700,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonCloseComplete: () => {\n\t\t\t\t\tresolver({...instance.getValue()});\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['crm.form.captcha', 'ui.forms', 'ui.sidepanel-content'],\n\t\t\t\t\ttitle: Loc.getMessage('CRM_FORM_CAPTCHA_JS_TITLE'),\n\t\t\t\t\tdesign: {\n\t\t\t\t\t\tsection: false,\n\t\t\t\t\t},\n\t\t\t\t\tcontent ()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn instance.load();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons ({SaveButton, closeButton})\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\tonclick: btn => {\n\n\t\t\t\t\t\t\t\t\tif (!instance.canChange())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tbtn.setDisabled(true);\n\t\t\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_FORM_CAPTCHA_JS_ACCESS_DENIED'),\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbtn.setWaiting(true);\n\t\t\t\t\t\t\t\t\tinstance.save()\n\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\tbtn.setWaiting(false);\n\t\t\t\t\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\t\t\t\tbtn.setWaiting(false);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tcloseButton\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\t#data: Object = {\n\t\tkey: null,\n\t\tsecret: null,\n\t\tcanChange: false,\n\t\thasDefaults: false,\n\t};\n\t#container: HTMLElement;\n\n\t#render(): HTMLElement\n\t{\n\t\tconst key = Tag.safe`${this.#data.key}`;\n\t\tconst secret = Tag.safe`${this.#data.secret}`;\n\t\tthis.#container = Tag.render`\t\t\t\t\n\t\t\t<div>\n\t\t\t\t<div class=\"ui-slider-section\" ${this.#data.hasDefaults ? '' : 'hidden'}>\n\t\t\t\t\t<div class=\"ui-slider-content-box\">\n\t\t\t\t\t\t<div class=\"ui-slider-heading-4\">${Loc.getMessage('CRM_FORM_CAPTCHA_JS_STD_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"ui-alert ui-alert-success\">\n\t\t\t\t\t\t\t<span class=\"ui-alert-message\">${Loc.getMessage('CRM_FORM_CAPTCHA_JS_STD_TEXT')}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t\t<div class=\"ui-slider-content-box\">\n\t\t\t\t\t\t<div class=\"ui-slider-heading-4\">${Loc.getMessage('CRM_FORM_CAPTCHA_JS_CUSTOM_TITLE')}</div>\n\t\t\t\t\t\t<p class=\"ui-slider-paragraph-2\">\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_FORM_CAPTCHA_JS_CUSTOM_TEXT')}\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<a href=\"https://www.google.com/recaptcha/about/\" target=\"_blank\">${Loc.getMessage('CRM_FORM_CAPTCHA_JS_CUSTOM_HOWTO')}</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">Key</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\t\t\tname=\"key\"\n\t\t\t\t\t\t\t\t\t\tvalue=\"${key}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\t\tonfocus=\"this.parentElement.classList.remove('ui-ctl-danger')\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">Secret</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\t\t\tname=\"secret\"\n\t\t\t\t\t\t\t\t\t\tvalue=\"${secret}\"\n\t\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\t\tonfocus=\"this.parentElement.classList.remove('ui-ctl-danger')\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\treturn this.#container;\n\t}\n\n\thasKeys(): boolean\n\t{\n\t\tconst data = this.#data;\n\t\treturn data.hasDefaults || (data.key && data.secret);\n\t}\n\n\tcanChange(): boolean\n\t{\n\t\treturn this.#data.canChange;\n\t}\n\n\tload(): Promise\n\t{\n\t\treturn ajax.runAction('crm.form.getCaptcha', {json: {}}).then(response => {\n\t\t\tthis.#data = response.data;\n\t\t\treturn this.#render();\n\t\t});\n\t}\n\n\tsave(): Promise\n\t{\n\t\tconst keyNode = this.#container.querySelector('input[name=\"key\"]');\n\t\tconst secretNode = this.#container.querySelector('input[name=\"secret\"]');\n\n\t\tconst key = keyNode.value || '';\n\t\tconst secret = secretNode.value || '';\n\n\t\tkeyNode.parentElement.classList.remove('ui-ctl-danger');\n\t\tsecretNode.parentElement.classList.remove('ui-ctl-danger');\n\t\tif (Type.isStringFilled(key) !== Type.isStringFilled(secret))\n\t\t{\n\t\t\tif (!key)\n\t\t\t{\n\t\t\t\tkeyNode.parentElement.classList.add('ui-ctl-danger');\n\t\t\t}\n\n\t\t\tif (!secret)\n\t\t\t{\n\t\t\t\tsecretNode.parentElement.classList.add('ui-ctl-danger');\n\t\t\t}\n\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\treturn ajax\n\t\t\t.runAction('crm.form.setCaptcha', {json: {key, secret}})\n\t\t\t.then(response => {\n\t\t\t\tthis.#data = response.data;\n\t\t\t\treturn this.#data;\n\t\t\t})\n\t\t;\n\t}\n\n\tgetValue(): {[key: string]: any}\n\t{\n\t\treturn this.#data;\n\t}\n}"],"names":["Captcha","key","secret","canChange","hasDefaults","data","ajax","runAction","json","then","response","keyNode","querySelector","secretNode","value","parentElement","classList","remove","Type","isStringFilled","add","Promise","reject","resolver","promise","resolve","instance","BX","SidePanel","Instance","open","width","cacheable","events","onCloseComplete","getValue","contentCallback","Layout","createContent","extensions","title","Loc","getMessage","design","section","content","load","buttons","SaveButton","closeButton","onclick","btn","setDisabled","UI","Notification","Center","notify","setWaiting","save","close","catch","Tag","safe","render"],"mappings":"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"}