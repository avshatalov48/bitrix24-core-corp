this.BX=this.BX||{};(function(e,t,a,i){"use strict";var l,r;var o=function(e){babelHelpers.inherits(o,e);function o(){var e;babelHelpers.classCallCheck(this,o);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(o).call(this));e._autocomplete=null;e._autocompleteData=null;return e}babelHelpers.createClass(o,[{key:"doInitialize",value:function e(){var a=this._schemeElement.getData();var l=BX.prop.getBoolean(a,"enabled",false);this._autocomplete=i.RequisiteAutocompleteField.create(this.getName(),{placeholderText:BX.prop.getString(a,"placeholder",""),enabled:l,featureRestrictionCallback:BX.prop.getString(a,"featureRestrictionCallback",""),searchAction:"crm.requisite.entity.search",feedbackFormParams:BX.prop.getObject(a,"feedback_form",{}),showFeedbackLink:!l,clientResolverPlacementParams:BX.prop.getObject(a,"clientResolverPlacementParams",null)});this._autocomplete.subscribe("onSelectValue",this.onSelectAutocompleteValue.bind(this));this._autocomplete.subscribe("onClear",this.onClearAutocompleteValue.bind(this));this._autocomplete.subscribe("onInstallDefaultApp",this.onInstallDefaultApp.bind(this));t.EventEmitter.subscribe("BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp",this.onInstallDefaultAppGlobal.bind(this))}},{key:"createTitleMarker",value:function e(){if(this._mode===BX.UI.EntityEditorMode.view){return null}var t=BX.prop.getString(this._schemeElement.getData(),"featureRestrictionCallback","");if(t===""){return babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"createTitleMarker",this).call(this)}var i=a.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral([' <span class="tariff-lock"></span>'])));i.setAttribute("onclick",t);return i}},{key:"layout",value:function e(t){if(this._hasLayout){return}if(this._mode===BX.UI.EntityEditorMode.view){if(!this._wrapper){this._wrapper=BX.create("div")}}else{this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper()}if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}if(this.isDragEnabled()){a.Dom.append(this.createDragButton(),this._wrapper)}a.Dom.append(this.createTitleNode(this.getTitle()),this._wrapper);if(this._mode===BX.UI.EntityEditorMode.edit){var i=a.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block"></div>'])));this._autocomplete.layout(i);this.updateAutocompleteState();a.Dom.append(i,this._wrapper)}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}},{key:"isNeedToDisplay",value:function e(){return babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"isNeedToDisplay",this).call(this)&&this._mode===BX.UI.EntityEditorMode.edit}},{key:"updateAutocompleteState",value:function e(){var t=null;try{t=JSON.parse(this.getValue())}catch(e){}this._autocomplete.setState(t);this._autocomplete.setContext(this.getAutocompleteContext())}},{key:"setUserFieldValue",value:function e(t,i){if(this._editor){var l=["string","double","boolean","datetime"];var r=this._editor.getControlByIdRecursive(t);var o=r.getFieldType();if(r instanceof BX.UI.EntityEditorUserField&&l.indexOf(o)>=0){var s;var n;switch(o){case"string":if(a.Type.isStringFilled(i)){s=r.getFieldNode();if(a.Type.isDomNode(s)){n=s.querySelector('input[type="text"][name="'.concat(t,'"]'));if(n){n.value=i}}}break;case"double":var c;c=""+i;if(/^[\-+]?\d*[.,]?\d+?$/.test(c)){s=r.getFieldNode();if(a.Type.isDomNode(s)){n=s.querySelector('input[type="text"][name="'.concat(t,'"]'));if(n){n.value=c}}}break;case"boolean":s=r.getFieldNode();if(a.Type.isDomNode(s)){n=s.querySelector('input[type="checkbox"][name="'.concat(t,'"]'));if(n){var u=!!(a.Type.isNumber(i)?i:parseInt(i));n.value=u?1:0;n.checked=u}}break;case"datetime":s=r.getFieldNode();if(a.Type.isDomNode(s)&&a.Type.isStringFilled(i)){var p=i;n=s.querySelector('input[type="text"][name="'.concat(t,'"]'));if(n){n.value=p;BX.fireEvent(n,"change")}}break}}}}},{key:"onSelectAutocompleteValue",value:function e(t){this._autocompleteData=t.getData();if(a.Type.isPlainObject(this._autocompleteData["fields"])){var i=this._autocompleteData["fields"];for(var l in i){if(a.Type.isString(l)&&l.length>3&&l.substr(0,3)==="UF_"&&i.hasOwnProperty(l)){this.setUserFieldValue(l,i[l]);delete i[l]}}}this.markAsChanged()}},{key:"onClearAutocompleteValue",value:function e(t){this._autocomplete.setCurrentItem(null);this._autocompleteData=null}},{key:"onInstallDefaultApp",value:function e(){BX.onGlobalCustomEvent("BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp")}},{key:"onInstallDefaultAppGlobal",value:function e(){var t=this;var i=this._schemeElement.getData();if(a.Type.isPlainObject(i)&&i.hasOwnProperty("clientResolverPlacementParams")&&a.Type.isPlainObject(i["clientResolverPlacementParams"])){var l=BX.prop.getInteger(i["clientResolverPlacementParams"],"countryId",0);if(l>0){BX.ajax.runAction("crm.requisite.schemedata.getRequisiteAutocompleteSchemeData",{data:{countryId:l}}).then((function(e){if(a.Type.isPlainObject(e)&&e.hasOwnProperty("data")&&a.Type.isPlainObject(e["data"])){t._schemeElement.setData(e["data"]);if(t._autocomplete){if(a.Type.isStringFilled(e["data"]["placeholder"])){t._autocomplete.setPlaceholderText(e["data"]["placeholder"])}if(a.Type.isPlainObject(e["data"]["clientResolverPlacementParams"])){t._autocomplete.setClientResolverPlacementParams(e["data"]["clientResolverPlacementParams"])}}}}))}}}},{key:"getAutocompleteData",value:function e(){return this._autocompleteData}},{key:"getAutocompleteContext",value:function e(){return{typeId:"ITIN",presetId:this._editor.getControlById("PRESET_ID").getValue()}}}],[{key:"create",value:function e(t,a){var i=new this(t,a);i.initialize(t,a);return i}},{key:"onInitializeEditorControlFactory",value:function e(t){var a=t.getData();if(a[0]){a[0].methods["requisite_autocomplete"]=function(e,t,a){if(e==="requisite_autocomplete"){return o.create(t,a)}return null}}t.setData(a)}}]);return o}(BX.UI.EntityEditorField);t.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",o.onInitializeEditorControlFactory);e.EntityEditorRequisiteAutocomplete=o})(this.BX.Crm=this.BX.Crm||{},BX.Event,BX,BX.Crm);
//# sourceMappingURL=requisite-autocomplete.bundle.map.js