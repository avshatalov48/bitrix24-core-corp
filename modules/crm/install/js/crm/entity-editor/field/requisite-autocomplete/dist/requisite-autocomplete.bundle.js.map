{"version":3,"file":"requisite-autocomplete.bundle.js","sources":["../src/requisite-autocomplete.js"],"sourcesContent":["import {EventEmitter} from \"main.core.events\";\nimport {Dom, Tag, Type} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\n\nexport class EntityEditorRequisiteAutocomplete extends BX.UI.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._autocomplete = null;\n\t\tthis._autocompleteData = null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tlet params = this._schemeElement.getData();\n\t\tlet enabled = BX.prop.getBoolean(params, \"enabled\", false);\n\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tplaceholderText: BX.prop.getString(params, \"placeholder\", \"\"),\n\t\t\tenabled: enabled,\n\t\t\tfeatureRestrictionCallback: BX.prop.getString(params, \"featureRestrictionCallback\", ''),\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tfeedbackFormParams: BX.prop.getObject(params, \"feedback_form\", {}),\n\t\t\tshowFeedbackLink: !enabled,\n\t\t\tclientResolverPlacementParams: BX.prop.getObject(params, \"clientResolverPlacementParams\", null)\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onInstallDefaultApp', this.onInstallDefaultApp.bind(this));\n\t\tEventEmitter.subscribe(\n\t\t\t\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\",\n\t\t\tthis.onInstallDefaultAppGlobal.bind(this)\n\t\t);\n\t}\n\n\tcreateTitleMarker()\n\t{\n\t\tif(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet restrictionCallback = BX.prop.getString(this._schemeElement.getData(), \"featureRestrictionCallback\", '');\n\t\tif (restrictionCallback === '')\n\t\t{\n\t\t\treturn super.createTitleMarker();\n\t\t}\n\t\tlet lockIcon = Tag.render` <span class=\"tariff-lock\"></span>`;\n\t\tlockIcon.setAttribute('onclick', restrictionCallback);\n\t\treturn lockIcon;\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tif(!this._wrapper)\n\t\t\t{\n\t\t\t\tthis._wrapper = BX.create(\"div\");\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.ensureWrapperCreated({ classNames: [ \"ui-entity-editor-field-text\" ] });\n\t\t\tthis.adjustWrapper();\n\t\t}\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tlet autocompleteContainer = Tag.render`<div class=\"ui-entity-editor-content-block\"></div>`;\n\t\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\t\tthis.updateAutocompleteState();\n\t\t\tDom.append(autocompleteContainer, this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tisNeedToDisplay()\n\t{\n\t\treturn super.isNeedToDisplay() && this._mode === BX.UI.EntityEditorMode.edit;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteState = null;\n\t\ttry\n\t\t{\n\t\t\tautocompleteState = JSON.parse(this.getValue());\n\t\t}\n\t\tcatch (e)\n\t\t{}\n\t\tthis._autocomplete.setState(autocompleteState);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tsetUserFieldValue(fieldName, fieldValue)\n\t{\n\t\tif (this._editor)\n\t\t{\n\t\t\tconst allowedFieldTypes = [\"string\", \"double\", \"boolean\", \"datetime\"];\n\t\t\tconst control = this._editor.getControlByIdRecursive(fieldName);\n\t\t\tconst fieldType = control.getFieldType();\n\t\t\tif (control instanceof BX.UI.EntityEditorUserField && allowedFieldTypes.indexOf(fieldType) >= 0)\n\t\t\t{\n\t\t\t\tlet fieldNode;\n\t\t\t\tlet valueControl;\n\t\t\t\tswitch (fieldType)\n\t\t\t\t{\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\tif (Type.isStringFilled(fieldValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvalueControl.value = fieldValue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"double\":\n\t\t\t\t\t\tlet numberValue;\n\t\t\t\t\t\tnumberValue = \"\" + fieldValue;\n\t\t\t\t\t\tif (/^[\\-+]?\\d*[.,]?\\d+?$/.test(numberValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvalueControl.value = numberValue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"boolean\":\n\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t`input[type=\\\"checkbox\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet booleanValue = !!(Type.isNumber(fieldValue) ? fieldValue : parseInt(fieldValue));\n\t\t\t\t\t\t\t\tvalueControl.value = booleanValue ? 1 : 0;\n\t\t\t\t\t\t\t\tvalueControl.checked = booleanValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"datetime\":\n\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\tif (Type.isDomNode(fieldNode) && Type.isStringFilled(fieldValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet datetimeValue = fieldValue;\n\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl.value = datetimeValue;\n\t\t\t\t\t\t\t\tBX.fireEvent(valueControl, 'change');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tthis._autocompleteData = event.getData();\n\t\tif (Type.isPlainObject(this._autocompleteData[\"fields\"]))\n\t\t{\n\t\t\tconst fields = this._autocompleteData[\"fields\"];\n\t\t\tfor (let fieldName in fields)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tType.isString(fieldName)\n\t\t\t\t\t&& fieldName.length > 3\n\t\t\t\t\t&& fieldName.substr(0, 3) === \"UF_\"\n\t\t\t\t\t&& fields.hasOwnProperty(fieldName)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.setUserFieldValue(fieldName, fields[fieldName])\n\t\t\t\t\tdelete fields[fieldName];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.markAsChanged();\n\t}\n\n\tonClearAutocompleteValue(event)\n\t{\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tthis._autocompleteData = null;\n\t}\n\n\tonInstallDefaultApp()\n\t{\n\t\tBX.onGlobalCustomEvent(\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\");\n\t}\n\n\tonInstallDefaultAppGlobal()\n\t{\n\t\tconst data = this._schemeElement.getData();\n\t\tif (\n\t\t\tType.isPlainObject(data)\n\t\t\t&& data.hasOwnProperty(\"clientResolverPlacementParams\")\n\t\t\t&& Type.isPlainObject(data[\"clientResolverPlacementParams\"])\n\t\t)\n\t\t{\n\t\t\tconst countryId = BX.prop.getInteger(data[\"clientResolverPlacementParams\"], \"countryId\", 0);\n\t\t\tif (countryId > 0)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'crm.requisite.schemedata.getRequisiteAutocompleteSchemeData',\n\t\t\t\t\t{ data: { \"countryId\": countryId } }\n\t\t\t\t).then(\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t\t\t&& data.hasOwnProperty(\"data\")\n\t\t\t\t\t\t\t&& Type.isPlainObject(data[\"data\"])\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._schemeElement.setData(data[\"data\"]);\n\t\t\t\t\t\t\tif (this._autocomplete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (Type.isStringFilled(data[\"data\"][\"placeholder\"]))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._autocomplete.setPlaceholderText(data[\"data\"][\"placeholder\"]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (Type.isPlainObject(data[\"data\"][\"clientResolverPlacementParams\"]))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._autocomplete.setClientResolverPlacementParams(\n\t\t\t\t\t\t\t\t\t\tdata[\"data\"][\"clientResolverPlacementParams\"]\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\treturn this._autocompleteData;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\treturn {\n\t\t\t'typeId': 'ITIN',\n\t\t\t'presetId': this._editor.getControlById('PRESET_ID').getValue()\n\t\t};\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tstatic onInitializeEditorControlFactory(event)\n\t{\n\t\tlet data = event.getData();\n\t\tif (data[0])\n\t\t{\n\t\t\tdata[0].methods[\"requisite_autocomplete\"] = (type, controlId, settings) => {\n\t\t\t\tif (type === \"requisite_autocomplete\")\n\t\t\t\t{\n\t\t\t\t\treturn EntityEditorRequisiteAutocomplete.create(controlId, settings);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\tevent.setData(data);\n\t}\n\n}\n\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', EntityEditorRequisiteAutocomplete.onInitializeEditorControlFactory);"],"names":["EntityEditorRequisiteAutocomplete","_autocomplete","_autocompleteData","params","_schemeElement","getData","enabled","BX","prop","getBoolean","RequisiteAutocompleteField","create","getName","placeholderText","getString","featureRestrictionCallback","searchAction","feedbackFormParams","getObject","showFeedbackLink","clientResolverPlacementParams","subscribe","onSelectAutocompleteValue","bind","onClearAutocompleteValue","onInstallDefaultApp","EventEmitter","onInstallDefaultAppGlobal","_mode","UI","EntityEditorMode","view","restrictionCallback","lockIcon","Tag","render","setAttribute","options","_hasLayout","_wrapper","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","Dom","append","createDragButton","createTitleNode","getTitle","edit","autocompleteContainer","layout","updateAutocompleteState","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","autocompleteState","JSON","parse","getValue","e","setState","setContext","getAutocompleteContext","fieldName","fieldValue","_editor","allowedFieldTypes","control","getControlByIdRecursive","fieldType","getFieldType","EntityEditorUserField","indexOf","fieldNode","valueControl","Type","isStringFilled","getFieldNode","isDomNode","querySelector","value","numberValue","test","booleanValue","isNumber","parseInt","checked","datetimeValue","fireEvent","event","isPlainObject","fields","isString","length","substr","hasOwnProperty","setUserFieldValue","markAsChanged","setCurrentItem","onGlobalCustomEvent","data","countryId","getInteger","ajax","runAction","then","setData","setPlaceholderText","setClientResolverPlacementParams","getControlById","id","settings","self","initialize","methods","type","controlId","EntityEditorField","onInitializeEditorControlFactory"],"mappings":"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"}