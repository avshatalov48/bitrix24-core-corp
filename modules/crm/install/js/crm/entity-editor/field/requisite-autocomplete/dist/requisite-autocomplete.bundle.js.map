{"version":3,"file":"requisite-autocomplete.bundle.js","sources":["../src/requisite-autocomplete.js"],"sourcesContent":["import {EventEmitter} from \"main.core.events\";\nimport {Dom, Tag, Type} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\n\nexport class EntityEditorRequisiteAutocomplete extends BX.UI.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._autocomplete = null;\n\t\tthis._autocompleteData = null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tlet params = this._schemeElement.getData();\n\t\tlet enabled = BX.prop.getBoolean(params, \"enabled\", false);\n\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tplaceholderText: BX.prop.getString(params, \"placeholder\", \"\"),\n\t\t\tenabled: enabled,\n\t\t\tfeatureRestrictionCallback: BX.prop.getString(params, \"featureRestrictionCallback\", ''),\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tfeedbackFormParams: BX.prop.getObject(params, \"feedback_form\", {}),\n\t\t\tshowFeedbackLink: !enabled,\n\t\t\tclientResolverPlacementParams: BX.prop.getObject(params, \"clientResolverPlacementParams\", null)\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onInstallDefaultApp', this.onInstallDefaultApp.bind(this));\n\t\tEventEmitter.subscribe(\n\t\t\t\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\",\n\t\t\tthis.onInstallDefaultAppGlobal.bind(this)\n\t\t);\n\t}\n\n\tcreateTitleMarker()\n\t{\n\t\tif(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet restrictionCallback = BX.prop.getString(this._schemeElement.getData(), \"featureRestrictionCallback\", '');\n\t\tif (restrictionCallback === '')\n\t\t{\n\t\t\treturn super.createTitleMarker();\n\t\t}\n\t\tlet lockIcon = Tag.render` <span class=\"tariff-lock\"></span>`;\n\t\tlockIcon.setAttribute('onclick', restrictionCallback);\n\t\treturn lockIcon;\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tif(!this._wrapper)\n\t\t\t{\n\t\t\t\tthis._wrapper = BX.create(\"div\");\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.ensureWrapperCreated({ classNames: [ \"ui-entity-editor-field-text\" ] });\n\t\t\tthis.adjustWrapper();\n\t\t}\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tlet autocompleteContainer = Tag.render`<div class=\"ui-entity-editor-content-block\"></div>`;\n\t\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\t\tthis.updateAutocompleteState();\n\t\t\tDom.append(autocompleteContainer, this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tisNeedToDisplay()\n\t{\n\t\treturn super.isNeedToDisplay() && this._mode === BX.UI.EntityEditorMode.edit;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteState = null;\n\t\ttry\n\t\t{\n\t\t\tautocompleteState = JSON.parse(this.getValue());\n\t\t}\n\t\tcatch (e)\n\t\t{}\n\t\tthis._autocomplete.setState(autocompleteState);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tsetUserFieldValue(fieldName, fieldValue)\n\t{\n\t\tif (this._editor)\n\t\t{\n\t\t\tconst allowedFieldTypes = [\"string\", \"double\", \"boolean\", \"datetime\"];\n\t\t\tconst control = this._editor.getControlByIdRecursive(fieldName);\n\t\t\tconst fieldType = control.getFieldType();\n\t\t\tif (control instanceof BX.UI.EntityEditorUserField && allowedFieldTypes.indexOf(fieldType) >= 0)\n\t\t\t{\n\t\t\t\tlet fieldNode;\n\t\t\t\tlet valueControl;\n\t\t\t\tswitch (fieldType)\n\t\t\t\t{\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\tif (Type.isStringFilled(fieldValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvalueControl.value = fieldValue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"double\":\n\t\t\t\t\t\tlet numberValue;\n\t\t\t\t\t\tnumberValue = \"\" + fieldValue;\n\t\t\t\t\t\tif (/^[\\-+]?\\d*[.,]?\\d+?$/.test(numberValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvalueControl.value = numberValue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"boolean\":\n\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\tif (Type.isDomNode(fieldNode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t`input[type=\\\"checkbox\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet booleanValue = !!(Type.isNumber(fieldValue) ? fieldValue : parseInt(fieldValue));\n\t\t\t\t\t\t\t\tvalueControl.value = booleanValue ? 1 : 0;\n\t\t\t\t\t\t\t\tvalueControl.checked = booleanValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"datetime\":\n\t\t\t\t\t\tfieldNode = control.getFieldNode();\n\t\t\t\t\t\tif (Type.isDomNode(fieldNode) && Type.isStringFilled(fieldValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet datetimeValue = fieldValue;\n\t\t\t\t\t\t\tvalueControl = fieldNode.querySelector(\n\t\t\t\t\t\t\t\t`input[type=\\\"text\\\"][name=\\\"${fieldName}\\\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (valueControl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalueControl.value = datetimeValue;\n\t\t\t\t\t\t\t\tBX.fireEvent(valueControl, 'change');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tthis._autocompleteData = event.getData();\n\t\tif (Type.isPlainObject(this._autocompleteData[\"fields\"]))\n\t\t{\n\t\t\tconst fields = this._autocompleteData[\"fields\"];\n\t\t\tfor (let fieldName in fields)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tType.isString(fieldName)\n\t\t\t\t\t&& fieldName.length > 3\n\t\t\t\t\t&& fieldName.substr(0, 3) === \"UF_\"\n\t\t\t\t\t&& fields.hasOwnProperty(fieldName)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.setUserFieldValue(fieldName, fields[fieldName])\n\t\t\t\t\tdelete fields[fieldName];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.markAsChanged();\n\t}\n\n\tonClearAutocompleteValue(event)\n\t{\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tthis._autocompleteData = null;\n\t}\n\n\tonInstallDefaultApp()\n\t{\n\t\tBX.onGlobalCustomEvent(\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\");\n\t}\n\n\tonInstallDefaultAppGlobal()\n\t{\n\t\tconst data = this._schemeElement.getData();\n\t\tif (\n\t\t\tType.isPlainObject(data)\n\t\t\t&& Object.hasOwn(data, \"clientResolverPlacementParams\")\n\t\t\t&& Type.isPlainObject(data[\"clientResolverPlacementParams\"])\n\t\t)\n\t\t{\n\t\t\tconst countryId = BX.prop.getInteger(data[\"clientResolverPlacementParams\"], \"countryId\", 0);\n\t\t\tif (countryId > 0)\n\t\t\t{\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'crm.requisite.schemedata.getRequisiteAutocompleteSchemeData',\n\t\t\t\t\t{ data: { \"countryId\": countryId } }\n\t\t\t\t).then(\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t\t\t&& Object.hasOwn(data, \"data\")\n\t\t\t\t\t\t\t&& Type.isPlainObject(data[\"data\"])\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._schemeElement.setData(data[\"data\"]);\n\t\t\t\t\t\t\tif (this._autocomplete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (Type.isStringFilled(data[\"data\"][\"placeholder\"]))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._autocomplete.setPlaceholderText(data[\"data\"][\"placeholder\"]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (Type.isPlainObject(data[\"data\"][\"clientResolverPlacementParams\"]))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._autocomplete.setClientResolverPlacementParams(\n\t\t\t\t\t\t\t\t\t\tdata[\"data\"][\"clientResolverPlacementParams\"]\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\treturn this._autocompleteData;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\tconst result = {\n\t\t\t'typeId': 'ITIN',\n\t\t\t'presetId': 0\n\t\t};\n\n\t\tconst control = this._editor.getControlById('PRESET_ID');\n\t\tif (control)\n\t\t{\n\t\t\tresult.presetId = control.getValue();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst editorContext = this._editor.getContext();\n\t\t\tif (\n\t\t\t\tObject.hasOwn(editorContext, \"resolverProperty\")\n\t\t\t\t&& Type.isPlainObject(editorContext[\"resolverProperty\"])\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst property = editorContext[\"resolverProperty\"];\n\t\t\t\tconst schemeData = this._schemeElement.getData();\n\t\t\t\tif (\n\t\t\t\t\tObject.hasOwn(property, \"VALUE\")\n\t\t\t\t\t&& Type.isStringFilled(property[\"VALUE\"])\n\t\t\t\t\t&& Object.hasOwn(schemeData, \"presetId\")\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst presetId = parseInt(schemeData[\"presetId\"]);\n\t\t\t\t\tif (!isNaN(presetId))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.typeId = property[\"VALUE\"];\n\t\t\t\t\t\tresult.presetId = presetId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tstatic onInitializeEditorControlFactory(event)\n\t{\n\t\tlet data = event.getData();\n\t\tif (data[0])\n\t\t{\n\t\t\tdata[0].methods[\"requisite_autocomplete\"] = (type, controlId, settings) => {\n\t\t\t\tif (type === \"requisite_autocomplete\")\n\t\t\t\t{\n\t\t\t\t\treturn EntityEditorRequisiteAutocomplete.create(controlId, settings);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\tevent.setData(data);\n\t}\n\n}\n\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', EntityEditorRequisiteAutocomplete.onInitializeEditorControlFactory);"],"names":["EntityEditorRequisiteAutocomplete","_autocomplete","_autocompleteData","params","_schemeElement","getData","enabled","BX","prop","getBoolean","RequisiteAutocompleteField","create","getName","placeholderText","getString","featureRestrictionCallback","searchAction","feedbackFormParams","getObject","showFeedbackLink","clientResolverPlacementParams","subscribe","onSelectAutocompleteValue","bind","onClearAutocompleteValue","onInstallDefaultApp","EventEmitter","onInstallDefaultAppGlobal","_mode","UI","EntityEditorMode","view","restrictionCallback","lockIcon","Tag","render","setAttribute","options","_hasLayout","_wrapper","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","Dom","append","createDragButton","createTitleNode","getTitle","edit","autocompleteContainer","layout","updateAutocompleteState","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","autocompleteState","JSON","parse","getValue","e","setState","setContext","getAutocompleteContext","fieldName","fieldValue","_editor","allowedFieldTypes","control","getControlByIdRecursive","fieldType","getFieldType","EntityEditorUserField","indexOf","fieldNode","valueControl","Type","isStringFilled","getFieldNode","isDomNode","querySelector","value","numberValue","test","booleanValue","isNumber","parseInt","checked","datetimeValue","fireEvent","event","isPlainObject","fields","isString","length","substr","hasOwnProperty","setUserFieldValue","markAsChanged","setCurrentItem","onGlobalCustomEvent","data","Object","hasOwn","countryId","getInteger","ajax","runAction","then","setData","setPlaceholderText","setClientResolverPlacementParams","result","getControlById","presetId","editorContext","getContext","property","schemeData","isNaN","typeId","id","settings","self","initialize","methods","type","controlId","EntityEditorField","onInitializeEditorControlFactory"],"mappings":"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"}