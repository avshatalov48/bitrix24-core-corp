this.BX=this.BX||{};(function(e,t,r,i){"use strict";var a,n,s;function o(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var a=function e(){};return{s:a,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,s=false,o;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();n=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!n&&r["return"]!=null)r["return"]()}finally{if(s)throw o}}}}function l(e,t){if(!e)return;if(typeof e==="string")return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}function d(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}var u=function(e){babelHelpers.inherits(l,e);function l(){var e;babelHelpers.classCallCheck(this,l);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(l).call(this));e._field=null;e._autocompleteEnabled=false;e._restrictionsCallback=null;return e}babelHelpers.createClass(l,[{key:"initialize",value:function e(r,a){babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"initialize",this).call(this,r,a);var n=this._schemeElement.getData();this._autocompleteEnabled=BX.prop.getBoolean(n,"autocompleteEnabled",false);if(!this._autocompleteEnabled){this._restrictionsCallback=BX.prop.getString(n,"featureRestrictionCallback","")}a.enableAutocomplete=this._autocompleteEnabled;a.hideDefaultAddressType=true;a.addressZoneConfig=BX.prop.getObject(n,"addressZoneConfig",{});a.defaultAddressTypeByCategory=BX.prop.getInteger(n,"defaultAddressTypeByCategory",0);this._field=t.EntityEditorBaseAddressField.create(r,a);this._field.setMultiple(true);this._field.setTypesList(BX.prop.getObject(n,"types",{}));i.EventEmitter.subscribe(this._field,"onUpdate",this.onAddressListUpdate.bind(this));i.EventEmitter.subscribe(this._field,"onStartLoadAddress",this.onStartLoadAddress.bind(this));i.EventEmitter.subscribe(this._field,"onAddressLoaded",this.onAddressLoaded.bind(this));i.EventEmitter.subscribe(this._field,"onError",this.onError.bind(this));this._valueNode=null;this._modelTypes=[];this.initializeFromModel()}},{key:"initializeFromModel",value:function e(){var t=this.prepareValue(this.getValue());this._modelTypes=Object.keys(t);this._field.setValue(t)}},{key:"prepareValue",value:function e(t){return r.Type.isPlainObject(t)?t:{}}},{key:"onBeforeSubmit",value:function e(){if(!r.Type.isDomNode(this._valueNode)){return}r.Dom.clean(this._valueNode);var t={};var i=o(this._modelTypes),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;t[s]=""}}catch(e){i.e(e)}finally{i.f()}var l=o(this._field.getValue()),d;try{for(l.s();!(d=l.n()).done;){var u=d.value;if(u.value.length){t[u.type]=u.value}}}catch(e){l.e(e)}finally{l.f()}var c=this.getName();for(var h in t){if(!t.hasOwnProperty(h)){continue}var p=t[h];var f="";if(r.Type.isStringFilled(p)){f="".concat(c,"[").concat(h,"]")}else{f="".concat(c,"[").concat(h,"][DELETED]");p="Y"}var y=r.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));y.name=f;y.value=p;r.Dom.append(y,this._valueNode)}}},{key:"refreshLayout",value:function e(t){this.initializeFromModel();babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"refreshLayout",this).call(this,t)}},{key:"layout",value:function e(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-address crm-entity-widget-content-block"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}if(this.isDragEnabled()){r.Dom.append(this.createDragButton(),this._wrapper)}r.Dom.append(this.createTitleNode(this.getTitle()),this._wrapper);var i=this._field.layout(this._mode===BX.UI.EntityEditorMode.edit);i.classList.add("ui-entity-editor-content-block");this._wrapper.appendChild(i);this._valueNode=r.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(["<span></span>"])));this._wrapper.appendChild(this._valueNode);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}},{key:"createTitleMarker",value:function e(){if(this._mode===BX.UI.EntityEditorMode.view){return null}if(this._restrictionsCallback&&this._restrictionsCallback.length){var t=r.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral([' <span class="tariff-lock"></span>'])));t.setAttribute("onclick",this._restrictionsCallback);return t}return babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"createTitleMarker",this).call(this)}},{key:"onAddressListUpdate",value:function e(){this.markAsChanged()}},{key:"onStartLoadAddress",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(true)}}},{key:"onAddressLoaded",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(false)}}},{key:"onError",value:function e(t){var r=t.getData();this.showError(r.error);var i=this.getEditor()._toolPanel;if(i){i.setLocked(false)}}}],[{key:"onInitializeEditorControlFactory",value:function e(t){var r=t.getData();if(r[0]){r[0].methods["crm_address"]=function(e,t,r){if(e==="crm_address"){return l.create(t,r)}return null}}t.setData(r)}},{key:"create",value:function e(t,r){var i=new this(t,r);i.initialize(t,r);return i}}]);return l}(BX.UI.EntityEditorField);i.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",u.onInitializeEditorControlFactory);e.EntityEditorUiAddressField=u})(this.BX.Crm=this.BX.Crm||{},BX.Crm,BX,BX.Event);
//# sourceMappingURL=address.bundle.map.js