this.BX=this.BX||{};(function(e,t,i,r){"use strict";var s,a,n,l;function o(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=d(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var s=function e(){};return{s:s,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,n=false,l;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){n=true;l=t},f:function e(){try{if(!a&&i["return"]!=null)i["return"]()}finally{if(n)throw l}}}}function d(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}var h=function(e){babelHelpers.inherits(d,e);function d(){var e;babelHelpers.classCallCheck(this,d);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(d).call(this));e._field=null;e._isMultiple=null;e._autocompleteEnabled=false;e._restrictionsCallback=null;return e}babelHelpers.createClass(d,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"initialize",this).call(this,s,a);var n=this._schemeElement.getData();this._isMultiple=BX.prop.getBoolean(n,"multiple",false);this._autocompleteEnabled=BX.prop.getBoolean(n,"autocompleteEnabled",false);if(!this._autocompleteEnabled){this._restrictionsCallback=BX.prop.getString(n,"featureRestrictionCallback","")}a=i.Type.isPlainObject(a)?a:{};a.crmCompatibilityMode=true;a.enableAutocomplete=this._autocompleteEnabled;a.hideDefaultAddressType=this._isMultiple;a.showAddressTypeInViewMode=this._isMultiple;a.addressZoneConfig=BX.prop.getObject(n,"addressZoneConfig",{});a.countryId=0;a.defaultAddressTypeByCategory=BX.prop.getInteger(n,"defaultAddressTypeByCategory",0);this._field=t.EntityEditorBaseAddressField.create(s,a);this._field.setMultiple(this._isMultiple);if(this._isMultiple){this._field.setTypesList(BX.prop.getObject(n,"types",{}))}r.EventEmitter.subscribe(this._field,"onUpdate",this.onAddressListUpdate.bind(this));r.EventEmitter.subscribe(this._field,"onStartLoadAddress",this.onStartLoadAddress.bind(this));r.EventEmitter.subscribe(this._field,"onAddressLoaded",this.onAddressLoaded.bind(this));r.EventEmitter.subscribe(this._field,"onAddressDataInputting",this.onAddressDataInputting.bind(this));r.EventEmitter.subscribe(this._field,"onError",this.onError.bind(this));this.initializeFromModel()}},{key:"setupFromModel",value:function e(t,i){babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"setupFromModel",this).call(this,t,i);this.initializeFromModel()}},{key:"initializeFromModel",value:function e(){this.setAddressList(this.getValue(this._isMultiple?{}:""))}},{key:"setAddressList",value:function e(t){if(this._field.setValue(t)){this.refreshLayout()}}},{key:"getCountryId",value:function e(){return this._field.getCountryId()}},{key:"setCountryId",value:function e(t){this._field.setCountryId(t)}},{key:"layout",value:function e(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["crm-entity-widget-content-block-field-address"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}if(this.isDragEnabled()){i.Dom.append(this.createDragButton(),this._wrapper)}i.Dom.append(this.createTitleNode(this.getTitle()),this._wrapper);if(!this.hasValue()&&this._mode===BX.UI.EntityEditorMode.view){i.Dom.append(i.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-entity-editor-content-block" onclick="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>"])),this.onViewModeClick.bind(this),BX.UI.EntityEditorField.messages.isEmpty),this._wrapper)}else{var r=this._field.layout(this._mode===BX.UI.EntityEditorMode.edit);r.classList.add("ui-entity-editor-content-block");if(this._mode===BX.UI.EntityEditorMode.view){i.Event.bind(r,"click",this.onViewModeClick.bind(this))}i.Dom.append(r,this._wrapper)}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}},{key:"reset",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"reset",this).call(this);this.initializeFromModel()}},{key:"doClearLayout",value:function e(t){if(BX.prop.getBoolean(t,"release",false)){this._field.release()}else{this._field.resetView()}}},{key:"hasContentToDisplay",value:function e(){return this.hasValue()}},{key:"hasValue",value:function e(){if(!i.Type.isObject(this._field)){return false}return this._isMultiple?!!this._field.getValue().filter((function(e){return i.Type.isStringFilled(e.value)})).length:!!this._field.getValue()}},{key:"createTitleMarker",value:function e(){if(this._mode===BX.Crm.EntityEditorMode.view){return null}if(this._restrictionsCallback&&this._restrictionsCallback.length){var t=i.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral([' <span class="tariff-lock"></span>'])));t.setAttribute("onclick",this._restrictionsCallback);return t}return babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"createTitleMarker",this).call(this)}},{key:"rollback",value:function e(){this.initializeFromModel()}},{key:"save",value:function e(){if(this.isVirtual()){return}if(!i.Type.isDomNode(this._wrapper)){return}if(this._isMultiple){var t=this.getName();var r=o(this._field.getValue()),s;try{for(r.s();!(s=r.n()).done;){var a=s.value;var d=a.type;var u=a.value;var h="".concat(t,"[").concat(d,"]");var p=i.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));p.name=h;p.value=u;i.Dom.append(p,this._wrapper)}}catch(e){r.e(e)}finally{r.f()}}else{var c=this._field.getValue();var f=i.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));f.name=this.getName();f.value=c?c:"";i.Dom.append(f,this._wrapper)}}},{key:"onViewModeClick",value:function e(){if(!this.getEditor().isReadOnly()){this.switchToSingleEditMode()}}},{key:"onAddressListUpdate",value:function e(t){this.markAsChanged()}},{key:"onStartLoadAddress",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(true)}}},{key:"onAddressLoaded",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(false)}}},{key:"onAddressDataInputting",value:function e(){this.markAsChanged()}},{key:"onError",value:function e(t){var i=t.getData();this.showError(i.error);var r=this.getEditor()._toolPanel;if(r){r.setLocked(false)}}}],[{key:"create",value:function e(t,i){var r=new this(t,i);r.initialize(t,i);return r}}]);return d}(BX.Crm.EntityEditorField);e.EntityEditorAddressField=h})(this.BX.Crm=this.BX.Crm||{},BX.Crm,BX,BX.Event);
//# sourceMappingURL=address.bundle.map.js