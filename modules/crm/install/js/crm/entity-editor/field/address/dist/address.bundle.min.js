this.BX=this.BX||{};(function(e,t,i,r){"use strict";function n(){var e=babelHelpers.taggedTemplateLiteral(['<input type="hidden">']);n=function t(){return e};return e}function a(){var e=babelHelpers.taggedTemplateLiteral(['<input type="hidden">']);a=function t(){return e};return e}function s(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=l(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!a&&i.return!=null)i.return()}finally{if(s)throw o}}}}function l(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function u(){var e=babelHelpers.taggedTemplateLiteral([' <span class="tariff-lock"></span>']);u=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="crm-entity-widget-content-block-inner" onclick="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>"]);d=function t(){return e};return e}var h=function(e){babelHelpers.inherits(l,e);function l(){var e;babelHelpers.classCallCheck(this,l);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(l).call(this));e._field=null;e._isMultiple=null;e._autocompleteEnabled=false;e._restrictionsCallback=null;return e}babelHelpers.createClass(l,[{key:"initialize",value:function e(n,a){babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"initialize",this).call(this,n,a);var s=this._schemeElement.getData();this._isMultiple=BX.prop.getBoolean(s,"multiple",false);this._autocompleteEnabled=BX.prop.getBoolean(s,"autocompleteEnabled",false);if(!this._autocompleteEnabled){this._restrictionsCallback=BX.prop.getString(s,"featureRestrictionCallback","")}a=i.Type.isPlainObject(a)?a:{};a.crmCompatibilityMode=true;a.enableAutocomplete=this._autocompleteEnabled;this._field=t.EntityEditorBaseAddressField.create(n,a);this._field.setMultiple(this._isMultiple);if(this._isMultiple){this._field.setTypesList(BX.prop.getObject(s,"types",{}))}r.EventEmitter.subscribe(this._field,"onUpdate",this.onAddressListUpdate.bind(this));r.EventEmitter.subscribe(this._field,"onStartLoadAddress",this.onStartLoadAddress.bind(this));r.EventEmitter.subscribe(this._field,"onAddressLoaded",this.onAddressLoaded.bind(this));r.EventEmitter.subscribe(this._field,"onError",this.onError.bind(this));this.initializeFromModel()}},{key:"setupFromModel",value:function e(t,i){babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"setupFromModel",this).call(this,t,i);this.initializeFromModel()}},{key:"initializeFromModel",value:function e(){this.setAddressList(this.getValue(this._isMultiple?{}:""))}},{key:"setAddressList",value:function e(t){if(this._field.setValue(t)){this.refreshLayout()}}},{key:"layout",value:function e(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["crm-entity-widget-content-block-field-address"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}if(this.isDragEnabled()){i.Dom.append(this.createDragButton(),this._wrapper)}i.Dom.append(this.createTitleNode(this.getTitle()),this._wrapper);if(!this.hasValue()&&this._mode===BX.Crm.EntityEditorMode.view){i.Dom.append(i.Tag.render(d(),this.onViewModeClick.bind(this),BX.Crm.EntityEditorField.messages.isEmpty),this._wrapper)}else{var r=this._field.layout(this._mode===BX.Crm.EntityEditorMode.edit);r.classList.add("crm-entity-widget-content-block-inner");if(this._mode===BX.Crm.EntityEditorMode.view){i.Event.bind(r,"click",this.onViewModeClick.bind(this))}i.Dom.append(r,this._wrapper)}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}},{key:"doClearLayout",value:function e(t){if(BX.prop.getBoolean(t,"release",false)){this._field.release()}}},{key:"hasValue",value:function e(){if(!i.Type.isObject(this._field)){return false}return this._isMultiple?!!this._field.getValue().filter(function(e){return i.Type.isStringFilled(e.value)}).length:!!this._field.getValue()}},{key:"createTitleMarker",value:function e(){if(this._mode===BX.Crm.EntityEditorMode.view){return null}if(this._restrictionsCallback&&this._restrictionsCallback.length){var t=i.Tag.render(u());t.setAttribute("onclick",this._restrictionsCallback);return t}return babelHelpers.get(babelHelpers.getPrototypeOf(l.prototype),"createTitleMarker",this).call(this)}},{key:"rollback",value:function e(){this.initializeFromModel()}},{key:"save",value:function e(){if(this.isVirtual()){return}if(!i.Type.isDomNode(this._wrapper)){return}if(this._isMultiple){var t=this.getName();var r=s(this._field.getValue()),l;try{for(r.s();!(l=r.n()).done;){var o=l.value;var u=o.type;var d=o.value;var h="".concat(t,"[").concat(u,"]");var c=i.Tag.render(a());c.name=h;c.value=d;i.Dom.append(c,this._wrapper)}}catch(e){r.e(e)}finally{r.f()}}else{var p=this._field.getValue();var f=i.Tag.render(n());f.name=this.getName();f.value=p?p:"";i.Dom.append(f,this._wrapper)}}},{key:"onViewModeClick",value:function e(){if(!this.getEditor().isReadOnly()){this.switchToSingleEditMode()}}},{key:"onAddressListUpdate",value:function e(t){this.markAsChanged()}},{key:"onStartLoadAddress",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(true)}}},{key:"onAddressLoaded",value:function e(){var t=this.getEditor()._toolPanel;if(t){t.setLocked(false)}}},{key:"onError",value:function e(t){var i=t.getData();this.showError(i.error);var r=this.getEditor()._toolPanel;if(r){r.setLocked(false)}}}],[{key:"create",value:function e(t,i){var r=new this(t,i);r.initialize(t,i);return r}}]);return l}(BX.Crm.EntityEditorField);e.EntityEditorAddressField=h})(this.BX.Crm=this.BX.Crm||{},BX.Crm,BX,BX.Event);
//# sourceMappingURL=address.bundle.map.js