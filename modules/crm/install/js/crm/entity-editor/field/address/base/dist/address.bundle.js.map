{"version":3,"file":"address.bundle.js","sources":["../src/address.js"],"sourcesContent":["import {Text, Tag, Dom, Type, Loc} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport \"./address.css\"\nimport {MenuManager, PopupManager} from \"main.popup\";\n\nexport class EntityEditorBaseAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._isMultiple = false;\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._typesList = [];\n\t\tthis._availableTypesIds = [];\n\t\tthis._allowedTypeIds = [];\n\t\tthis._addressList = [];\n\t\tthis._wrapper = null;\n\t\tthis._isEditMode = true;\n\t\tthis._showFirstItemOnly = BX.prop.getBoolean(settings, 'showFirstItemOnly', false);\n\t\tthis._enableAutocomplete = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._hideDefaultAddressType = BX.prop.getBoolean(this._settings, 'hideDefaultAddressType', false);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(this._settings, 'showAddressTypeInViewMode', false);\n\t\tthis._addrZoneConfig = BX.prop.getObject(this._settings, 'addressZoneConfig', {});\n\t\tthis._countryId = BX.prop.getInteger(\n\t\t\tthis._settings,\n\t\t\t'countryId',\n\t\t\tBX.prop.getInteger(this._addrZoneConfig, \"countryId\", 0)\n\t\t);\n\t\tthis._defaultAddressType = BX.prop.getInteger(this._addrZoneConfig, 'defaultAddressType', 0);\n\t\tthis.updateAllowedTypes();\n\t}\n\n\tsetMultiple(isMultiple)\n\t{\n\t\tthis._isMultiple = !!isMultiple;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet items = Type.isPlainObject(value) ? value : {};\n\t\t\tlet types = Object.keys(items);\n\n\t\t\tlet isSame = (this._addressList.length > 0 && types.length == this._addressList.length);\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\tfor (let addressItem of this._addressList)\n\t\t\t\t{\n\t\t\t\t\tlet type = addressItem.getType();\n\t\t\t\t\tif (!items.hasOwnProperty(type) || items[type] !== addressItem.getValue())\n\t\t\t\t\t{\n\t\t\t\t\t\tisSame = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( // if new value is empty and old value has only one empty element\n\t\t\t\t!isSame &&\n\t\t\t\t!types.length &&\n\t\t\t\tthis._addressList.length === 1 &&\n\t\t\t\t!this._addressList[0].getValue().length\n\t\t\t)\n\t\t\t{\n\t\t\t\tisSame = true;\n\t\t\t}\n\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\treturn false; // update is not required\n\t\t\t}\n\n\t\t\tthis.removeAllAddresses();\n\t\t\tfor (let type of types)\n\t\t\t{\n\t\t\t\tthis.addAddress(type, items[type]);\n\t\t\t}\n\t\t\tif (!types.length)\n\t\t\t{\n\t\t\t\tthis.addAddress(this.getDefaultType(), null);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeAllAddresses();\n\t\t\tlet address = Type.isStringFilled(value) ? value : null;\n\t\t\tthis.addAddress(null, address);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet result = [];\n\t\t\tfor (let addressItem of this._addressList)\n\t\t\t{\n\t\t\t\tlet value = addressItem.getValue();\n\t\t\t\tif (Type.isString(value))\n\t\t\t\t{\n\t\t\t\t\tresult.push({type: addressItem.getType(), value});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._addressList && this._addressList[0] && Type.isString(this._addressList[0].getValue()))\n\t\t\t{\n\t\t\t\treturn this._addressList[0].getValue();\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetTypesList(list)\n\t{\n\t\tthis._typesList = [];\n\t\tif (Type.isPlainObject(list))\n\t\t{\n\t\t\tfor (let id of Object.keys(list))\n\t\t\t{\n\t\t\t\tthis._typesList.push(list[id]);\n\t\t\t}\n\t\t}\n\t\tthis.initAvailableTypes();\n\t}\n\n\tgetTypesList()\n\t{\n\t\tlet types = [];\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet name = BX.prop.getString(item, \"DESCRIPTION\", \"\");\n\n\t\t\ttypes.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn types;\n\t}\n\n\tsetAllowedTypes(typeIds)\n\t{\n\t\tthis._allowedTypeIds = [];\n\t\tif (Type.isArray(typeIds))\n\t\t{\n\t\t\tthis._allowedTypeIds = typeIds;\n\t\t}\n\t}\n\n\tgetAllowedTypes()\n\t{\n\t\treturn this._allowedTypeIds;\n\t}\n\n\tsetCountryId(countryId)\n\t{\n\t\tlet needUpdateAllowedTypes = false;\n\n\t\tcountryId = parseInt(countryId);\n\t\tif (this._countryId !== countryId)\n\t\t{\n\t\t\tneedUpdateAllowedTypes = true;\n\t\t}\n\t\tthis._countryId = countryId;\n\n\t\tif (needUpdateAllowedTypes)\n\t\t{\n\t\t\tthis.updateAllowedTypes();\n\t\t}\n\t}\n\n\tgetCountryId()\n\t{\n\t\treturn this._countryId;\n\t}\n\n\tgetAddressZoneConfig()\n\t{\n\t\treturn this._addrZoneConfig\n\t}\n\n\tgetValueTypes()\n\t{\n\t\tlet result = [];\n\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\tlet addressType = parseInt(addressItem.getType());\n\t\t\tif (result.indexOf(addressType) < 0)\n\t\t\t{\n\t\t\t\tresult.push(addressType);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tupdateAllowedTypes()\n\t{\n\t\tlet allowedTypeList = [];\n\t\tlet typeValues = this.getValueTypes();\n\t\tlet countryId = this.getCountryId();\n\t\tlet config = this.getAddressZoneConfig();\n\n\t\tif (Type.isPlainObject(config))\n\t\t{\n\t\t\tif (config.hasOwnProperty(\"currentZoneAddressTypes\")\n\t\t\t\t&& Type.isArray(config[\"currentZoneAddressTypes\"]))\n\t\t\t{\n\t\t\t\tlet i;\n\t\t\t\tlet typeId;\n\t\t\t\tlet curZoneAddrTypes = config[\"currentZoneAddressTypes\"];\n\t\t\t\tfor (i = 0; i < curZoneAddrTypes.length; i++)\n\t\t\t\t{\n\t\t\t\t\ttypeId = parseInt(curZoneAddrTypes[i]);\n\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (countryId > 0\n\t\t\t\t\t&& config.hasOwnProperty(\"countryAddressTypeMap\")\n\t\t\t\t\t&& Type.isPlainObject(config[\"countryAddressTypeMap\"])\n\t\t\t\t\t&& config[\"countryAddressTypeMap\"].hasOwnProperty(countryId)\n\t\t\t\t\t&& Type.isArray(config[\"countryAddressTypeMap\"][countryId]))\n\t\t\t\t{\n\t\t\t\t\tlet addrTypeMap = config[\"countryAddressTypeMap\"][countryId];\n\t\t\t\t\tfor (i = 0; i < addrTypeMap.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\ttypeId = parseInt(addrTypeMap[i]);\n\t\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (i = 0; i < typeValues.length; i++)\n\t\t\t\t{\n\t\t\t\t\ttypeId = parseInt(typeValues[i]);\n\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._allowedTypeIds = allowedTypeList;\n\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAllowedTypesIds([...this._allowedTypeIds]);\n\t\t}\n\t}\n\n\tgetDefaultType()\n\t{\n\t\tlet defAddrType = this._defaultAddressType.toString();\n\t\tif (defAddrType > 0\n\t\t\t&& this._availableTypesIds.indexOf(defAddrType) >= 0\n\t\t\t&& this._allowedTypeIds.indexOf(parseInt(defAddrType)) >= 0)\n\t\t{\n\t\t\treturn  defAddrType;\n\t\t}\n\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet isDefault = BX.prop.getString(item, \"IS_DEFAULT\", false);\n\n\t\t\tif (isDefault\n\t\t\t\t&& this._availableTypesIds.indexOf(value) >= 0\n\t\t\t\t&& this._allowedTypeIds.indexOf(parseInt(value)) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tif (this._availableTypesIds.indexOf(value) >= 0\n\t\t\t\t&& this._allowedTypeIds.indexOf(parseInt(value)) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tlayout(isEditMode)\n\t{\n\t\tthis._isEditMode = isEditMode;\n\n\t\tthis._wrapper = Tag.render`<div class=\"crm-address-control-wrap ${this._isEditMode ? 'crm-address-control-wrap-edit' : ''}\"></div>`;\n\t\tthis.refreshLayout();\n\n\t\treturn this._wrapper;\n\t}\n\n\trefreshLayout()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tlet addrCounter = true;\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setEditMode(this._isEditMode);\n\t\t\tif (!this._isEditMode && this._showFirstItemOnly && addrCounter > 1)\n\t\t\t{\n\t\t\t\tlet showMore = Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onShowMoreMouseUp.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_ADDRESS_SHOW_ALL')}\n\t\t\t\t\t</span>`;\n\t\t\t\tDom.append(showMore, this._wrapper);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(addressItem.layout(), this._wrapper);\n\t\t\t}\n\t\t\taddrCounter++;\n\t\t}\n\t\tif (this._isEditMode && this._isMultiple && !Type.isNull(this.getDefaultType()))\n\t\t{\n\t\t\tlet crmCompatibilityMode = BX.prop.getBoolean(this._settings, 'crmCompatibilityMode', false);\n\t\t\tlet addButtonWrapClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-block-add-field' : 'ui-entity-widget-content-block-add-field';\n\t\t\tlet addButtonClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-add-field' : 'ui-entity-editor-content-add-lnk';\n\t\t\tDom.append(Tag.render`\n\t\t\t\t<div class=\"${addButtonWrapClass}\"><span class=\"${addButtonClass}\" onclick=\"${this.onAddNewAddress.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_ADD')}</span></div>\n\t\t\t`, this._wrapper);\n\t\t}\n\t}\n\n\trelease()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tthis.removeAllAddresses();\n\t}\n\n\tremoveAllAddresses()\n\t{\n\t\tlet ids = this._addressList.map((item) => item.getId());\n\t\tfor (let id of ids)\n\t\t{\n\t\t\tthis.removeAddress(id);\n\t\t}\n\t}\n\n\taddAddress(type, value = null)\n\t{\n\t\tlet addressItem = new AddressItem(Text.getRandom(8), {\n\t\t\ttypesList: this.getTypesList(),\n\t\t\tavailableTypesIds: [...this._availableTypesIds],\n\t\t\tallowedTypesIds: [...this._allowedTypeIds],\n\t\t\tcanChangeType: this._isMultiple,\n\t\t\tenableAutocomplete: this._enableAutocomplete,\n\t\t\tshowAddressTypeInViewMode: this._isMultiple && this._showAddressTypeInViewMode,\n\t\t\ttype,\n\t\t\tvalue\n\t\t});\n\t\taddressItem.subscribe('onUpdateAddress', this.onUpdateAddress.bind(this));\n\t\taddressItem.subscribe('onUpdateAddressType', this.onUpdateAddressType.bind(this));\n\t\taddressItem.subscribe('onDelete', this.onDeleteAddress.bind(this));\n\t\taddressItem.subscribe('onStartLoadAddress', this.onStartLoadAddress.bind(this));\n\t\taddressItem.subscribe('onAddressLoaded', this.onAddressLoaded.bind(this));\n\t\taddressItem.subscribe('onAddressDataInputting', this.onAddressDataInputting.bind(this));\n\t\taddressItem.subscribe('onError', this.onError.bind(this));\n\t\taddressItem.subscribe('onCopyAddress', this.onCopyAddress.bind(this));\n\t\tthis.updateAvailableTypes(type, null);\n\t\tthis._addressList.push(addressItem);\n\t\tthis.updateAllowedTypes();\n\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\treturn addressItem;\n\t}\n\n\tremoveAddress(id)\n\t{\n\t\tlet addressItem = this.getAddressById(id);\n\t\tif (addressItem)\n\t\t{\n\t\t\tlet type = addressItem.getType();\n\t\t\tthis._addressList.splice(this._addressList.indexOf(addressItem), 1);\n\t\t\tthis.updateAvailableTypes(null, type);\n\t\t\tthis.updateAllowedTypes();\n\t\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\t\taddressItem.destroy();\n\t\t}\n\t}\n\n\tgetAddressById(id)\n\t{\n\t\treturn this._addressList\n\t\t\t.filter((item) => item.getId() === id)\n\t\t\t.reduce((prev, item) => prev ? prev : item, null);\n\t}\n\n\tinitAvailableTypes()\n\t{\n\t\tthis._availableTypesIds = [];\n\t\tfor (let type of this._typesList)\n\t\t{\n\t\t\tthis._availableTypesIds.push(BX.prop.getString(type, \"ID\", \"\"));\n\t\t}\n\t}\n\n\tupdateAvailableTypes(removedType, addedType)\n\t{\n\t\tif (!Type.isNull(addedType) && this._availableTypesIds.indexOf(addedType) < 0)\n\t\t{\n\t\t\tthis._availableTypesIds.push(addedType);\n\t\t}\n\t\tif (!Type.isNull(removedType) && this._availableTypesIds.indexOf(removedType) >= 0)\n\t\t{\n\t\t\tthis._availableTypesIds.splice(this._availableTypesIds.indexOf(removedType), 1);\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAvailableTypesIds([...this._availableTypesIds]);\n\t\t}\n\t}\n\n\tupdateTypeSelectorVisibility(showTypeSelector)\n\t{\n\t\tif (!this._hideDefaultAddressType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setTypeSelectorVisibility(showTypeSelector);\n\t\t}\n\t}\n\n\temitUpdateEvent()\n\t{\n\t\tEventEmitter.emit(this, 'onUpdate', {value: this.getValue()});\n\t}\n\n\tonAddNewAddress()\n\t{\n\t\tthis.addAddress(this.getDefaultType());\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddress(event)\n\t{\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonDeleteAddress(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet id = data.id;\n\t\tif (this._addressList.length <= 1)\n\t\t{\n\t\t\t// should be at least one address, so just clear it\n\t\t\tlet addressItem = this.getAddressById(id);\n\t\t\tif (addressItem)\n\t\t\t{\n\t\t\t\taddressItem.clearValue();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.removeAddress(id);\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddressType(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet prevType = data.prevType;\n\t\tlet type = data.type;\n\t\tthis.updateAvailableTypes(type, prevType);\n\t\tthis.updateAllowedTypes();\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonShowMoreMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis._showFirstItemOnly = false;\n\t\tthis.refreshLayout();\n\t\treturn false;\n\t}\n\n\tonStartLoadAddress(event)\n\t{\n\t\tEventEmitter.emit(this, 'onStartLoadAddress');\n\t}\n\n\tonAddressLoaded(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressLoaded');\n\t}\n\n\tonAddressDataInputting(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressDataInputting');\n\t}\n\n\tonError(event)\n\t{\n\t\tEventEmitter.emit(this, 'onError', event);\n\t}\n\n\tonCopyAddress(event)\n\t{\n\t\tconst data = event.getData();\n\t\tlet sourceAddress = this.getAddressById(data.sourceId);\n\t\tif (!sourceAddress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst sourceAddressData = sourceAddress.getValue();\n\t\tif (!(sourceAddressData).length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i=0; i < data.destinationTypes.length; i++)\n\t\t{\n\t\t\tconst type = data.destinationTypes[i];\n\t\t\tlet destinationAddress = this._addressList\n\t\t\t\t.filter((item) => item.getType() == type)\n\t\t\t\t.reduce((prev, cur) => prev ? prev : cur, null);\n\t\t\tif (destinationAddress)\n\t\t\t{\n\t\t\t\tdestinationAddress.setValue(sourceAddressData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdestinationAddress = this.addAddress(type, sourceAddressData);\n\t\t\t}\n\t\t\tdestinationAddress.markAsNew();\n\n\t\t\tthis.refreshLayout();\n\t\t}\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tresetView(): void\n\t{\n\t\tfor (const addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.resetView();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorBaseAddressField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass AddressItem extends EventEmitter\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.AddressItem');\n\n\t\tthis._id = id;\n\t\tthis._value = BX.prop.getString(settings, 'value', \"\");\n\t\tthis._isTypesMenuOpened = false;\n\t\tthis._typesList = BX.prop.getArray(settings, 'typesList', []);\n\t\tthis._availableTypesIds = BX.prop.getArray(settings, 'availableTypesIds', []);\n\t\tthis._allowedTypesIds = BX.prop.getArray(settings, 'allowedTypesIds', []);\n\t\tthis._canChangeType = BX.prop.getBoolean(settings, 'canChangeType', false);\n\t\tthis.typesMenuId = 'address_type_menu_' + this._id;\n\t\tthis._type = BX.prop.getString(settings, 'type', \"\");\n\t\tthis._isEditMode = true;\n\t\tthis._isTypeSelectorVisible = BX.prop.getBoolean(settings, 'isTypeSelectorVisible', true);\n\t\tthis._isAutocompleteEnabled = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(settings, 'showAddressTypeInViewMode', true);\n\t\tthis._showDetails = !this._isAutocompleteEnabled || BX.prop.getBoolean(settings, 'showDetails', false);\n\t\tthis._isLoading = false;\n\t\tthis._icon = null;\n\t\tthis._isDropdownLoading = false;\n\t\tthis._addressWidget = null;\n\t\tthis._wrapper = null;\n\t\tthis._domNodes = {};\n\t\tthis._selectedCopyDestinations = [];\n\n\t\tthis._isLocationModuleInstalled =\n\t\t\t!Type.isUndefined(BX.Location) &&\n\t\t\t!Type.isUndefined(BX.Location.Core)&&\n\t\t\t!Type.isUndefined(BX.Location.Widget);\n\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tinitializeAddressWidget()\n\t{\n\t\tif (!this._isLocationModuleInstalled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = this.getValue();\n\n\t\tlet address = null;\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new BX.Location.Core.Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t}\n\t\t}\n\n\t\tlet widgetFactory = new BX.Location.Widget.Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view,\n\t\t\tpopupBindOptions: {position: 'right'}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));\n\t\tthis._addressWidget.subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.onError.bind(this));\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this._value;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.destroy();\n\t\tthis._value = value;\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tmarkAsNew()\n\t{\n\t\tlet address = this.getAddress();\n\t\tif (address)\n\t\t{\n\t\t\taddress.id = 0;\n\t\t\taddress.clearLinks();\n\t\t}\n\t\tthis._value = address ? address.toJson() : '';\n\t}\n\n\tsetEditMode(isEditMode)\n\t{\n\t\tthis._isEditMode = !!isEditMode;\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.mode = isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view;\n\t\t}\n\t}\n\n\tsetAvailableTypesIds(ids)\n\t{\n\t\tthis._availableTypesIds = ids;\n\t}\n\n\tsetAllowedTypesIds(ids)\n\t{\n\t\tthis._allowedTypesIds = ids;\n\t}\n\n\tgetTypeListByIds(ids)\n\t{\n\t\tlet result = [];\n\n\t\tif (Type.isArray(ids) && ids.length > 0)\n\t\t{\n\t\t\tlet typeMap = {};\n\t\t\tfor (let item of this._typesList)\n\t\t\t{\n\t\t\t\ttypeMap[\"a\" + item.value] = item;\n\t\t\t}\n\t\t\tfor (let typeId of ids)\n\t\t\t{\n\t\t\t\tlet index = \"a\" + typeId;\n\t\t\t\tif (typeMap.hasOwnProperty(index))\n\t\t\t\t{\n\t\t\t\t\tresult.push(typeMap[index]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tlayout()\n\t{\n\t\tif (Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._wrapper = Tag.render`<div>Location module is not installed</div>`;\n\t\t\treturn this._wrapper;\n\t\t}\n\t\tlet addressWidgetParams = {};\n\t\tconst addressString = this.convertAddressToString(this.getAddress());\n\t\tif (this._isEditMode)\n\t\t{\n\t\t\tthis._wrapper = this.getEditHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.edit;\n\t\t\taddressWidgetParams.inputNode = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.mapBindElement = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.fieldsContainer = this._domNodes.detailsContainer;\n\t\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._wrapper = this.getViewHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.view;\n\t\t\taddressWidgetParams.mapBindElement = this._wrapper;\n\t\t}\n\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\treturn this._wrapper;\n\t}\n\n\topenTypesMenu(bindElement)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = [];\n\t\tlet allowedTypes = [...this._allowedTypesIds];\n\t\tlet selectedTypeId = parseInt(this._type);\n\t\tif (allowedTypes.indexOf(selectedTypeId) < 0)\n\t\t{\n\t\t\tallowedTypes.push(selectedTypeId);\n\t\t}\n\t\tfor (let item of this.getTypeListByIds(allowedTypes))\n\t\t{\n\t\t\tlet selected = (selectedTypeId === parseInt(item.value));\n\t\t\tif (this._availableTypesIds.indexOf(item.value) < 0 && !selected)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\t//className: selected ? \"menu-popup-item-accept\" : \"menu-popup-item-none\",\n\t\t\t\t\tonclick: this.onChangeType.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.typesMenuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tlet createdMenu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (createdMenu && Type.isDomNode(this._domNodes.addressTypeSelector)\n\t\t\t&& this._domNodes.addressTypeSelector.offsetWidth > 200)\n\t\t{\n\t\t\tcreatedMenu.getPopupWindow().setWidth(this._domNodes.addressTypeSelector.offsetWidth);\n\t\t}\n\t};\n\n\tcloseTypesMenu()\n\t{\n\t\tlet menu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tsetTypeSelectorVisibility(visible)\n\t{\n\t\tthis._isTypeSelectorVisible = !!visible;\n\t}\n\n\tgetEditHtml(addressString)\n\t{\n\t\tthis._domNodes.typeName = Tag.render`<div class=\"ui-ctl-element\"></div>`;\n\t\tthis._domNodes.searchInput = Tag.render`\n\t\t\t<input type=\"text\" class=\"ui-ctl-element ui-ctl-textbox\" value=\"${addressString}\" ${this._isAutocompleteEnabled ? '' : 'readonly'}>`;\n\t\tthis._domNodes.icon = Tag.render`<span></span>`;\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t<div class=\"crm-address-search-control-block\">\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t${this._domNodes.icon}\n\t\t\t\t${this._domNodes.searchInput}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis._domNodes.detailsContainer = Tag.render`\n\t\t\t<div class=\"location-fields-control-block\"></div>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tif (this._isTypeSelectorVisible)\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-inline ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w25\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\t\t\t\tthis._domNodes.addressTypeContainer = null;\n\n\t\t\t\tDom.addClass(this._domNodes.addressContainer, ['ui-ctl-inline', 'ui-ctl-w75']);\n\t\t\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl-inline ui-ctl-w100\">\n\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\n\t\t\t\tthis._domNodes.addressTypeContainer = Tag.render`\n\t\t\t\t\t<div class=\"location-fields-control-block crm-address-type-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${Loc.getMessage('CRM_ADDRESS_TYPE')}</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t}\n\t\t\tthis.refreshTypeName();\n\t\t}\n\n\t\tthis.refreshIcon();\n\n\t\tthis._domNodes.detailsToggler =\n\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onToggleDetailsVisibility.bind(this)}\"></span>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tthis._domNodes.copyButton =\n\t\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onCopyButtonClick.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_COPY1')}</span>`;\n\t\t}\n\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.setDetailsVisibility(this._showDetails);\n\n\t\tlet result = Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t<div class=\"crm-address-control-mode-switch\">\n\t\t\t\t\t${this._domNodes.copyButton ? this._domNodes.copyButton : ''}\n\t\t\t\t\t${this._domNodes.detailsToggler}\n\t\t\t\t</div>\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t${this._domNodes.detailsContainer}\n\t\t\t</div>`;\n\n\t\tif (this._canChangeType && Type.isDomNode(this._domNodes.addressTypeContainer))\n\t\t{\n\t\t\tDom.append(this._domNodes.addressTypeContainer, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetViewHtml(addressString)\n\t{\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>\n\t\t\t</div>`;\n\n\t\tlet addressType = '';\n\t\tif (this._showAddressTypeInViewMode)\n\t\t{\n\t\t\tlet typeName = this._typesList\n\t\t\t\t.filter((item) => item.value == this._type)\n\t\t\t\t.map((item) => item.name)\n\t\t\t\t.join('')\n\n\t\t\taddressType = Tag.render`<span class=\"ui-link ui-link-secondary\">${Text.encode(typeName)}:</span>`\n\t\t}\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t${addressType}\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t</div>`;\n\t}\n\n\trefreshTypeName()\n\t{\n\t\tif (Type.isDomNode(this._domNodes.typeName))\n\t\t{\n\t\t\tlet typeName =\n\t\t\t\tthis._typesList\n\t\t\t\t\t.filter((item) => item.value === this._type)\n\t\t\t\t\t.map((item) => item.name)\n\t\t\t\t\t.join('');\n\n\t\t\tthis._domNodes.typeName.textContent = typeName;\n\t\t\tthis._domNodes.typeName.title = typeName;\n\t\t}\n\t}\n\n\trefreshIcon()\n\t{\n\t\tlet newIcon = this.getNewIcon();\n\t\tif (this._icon !== newIcon)\n\t\t{\n\t\t\tlet node = this._domNodes.icon;\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tlet newNode;\n\t\t\t\tif (newIcon === 'loading')\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ui-ctl-icon-loader\"></span>`;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (newIcon === 'clear')\n\t\t\t\t\t{\n\t\t\t\t\t\tnewNode = Tag.render`<button type=\"button\" class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onDelete.bind(this)}\"></button>`;\n\t\t\t\t\t}\n\t\t\t\t\telse if (newIcon === 'search')\n\t\t\t\t\t{\n\t\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ${this._isAutocompleteEnabled ? 'ui-ctl-icon-search' : ''}\"></span>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tDom.replace(node, newNode);\n\t\t\t\tthis._domNodes.icon = newNode;\n\t\t\t}\n\n\t\t\tthis._icon = newIcon;\n\t\t}\n\t}\n\n\tgetNewIcon()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\treturn 'loading';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.getAddress() ? 'clear' : 'search';\n\t\t}\n\t}\n\n\trefreshCopyButtonVisibility()\n\t{\n\t\tlet node = this._domNodes.copyButton;\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tlet isVisible = !!this.getAddress();\n\t\t\tDom.style(node, 'display', isVisible ? '' : 'none');\n\t\t}\n\t}\n\n\tconvertAddressToString(address)\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.getAddressFormat());\n\t}\n\n\tgetAddress()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.address;\n\t}\n\n\tgetAddressFormat()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.addressFormat;\n\t}\n\n\tclearValue()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.resetView();\n\t\t\tthis._addressWidget.address = null;\n\t\t}\n\t\tif (Type.isDomNode(this._domNodes.searchInput))\n\t\t{\n\t\t\tthis._domNodes.searchInput.value = '';\n\t\t}\n\t\tthis._value = \"\";\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\t}\n\n\tsetDetailsVisibility(visible)\n\t{\n\t\tthis._showDetails = !!visible;\n\t\tif (this._showDetails)\n\t\t{\n\t\t\tDom.addClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_SHORT');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.addClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_DETAILED');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.removeClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t}\n\n\tshowCopyDestinationPopup()\n\t{\n\t\tlet popup = PopupManager.create({\n\t\t\tid: this._id + '_copy_dst_popup',\n\t\t\tcacheable: false,\n\t\t\tautoHide: true,\n\t\t\ttitleBar: Loc.getMessage('CRM_ADDRESS_COPY_TITLE'),\n\t\t\tcontent: this.getCopyDestinationLayout(),\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tid: 'copy',\n\t\t\t\t\ttext: Loc.getMessage('CRM_ADDRESS_COPY2'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: BX.UI.ButtonState.DISABLED,\n\t\t\t\t\tonclick:(button) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t\tthis.emit('onCopyAddress', {\n\t\t\t\t\t\t\tsourceId: this.getId(),\n\t\t\t\t\t\t\tdestinationTypes: this._selectedCopyDestinations});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\tgetCopyDestinationLayout()\n\t{\n\t\tlet types = this.getTypeListByIds(this._allowedTypesIds).filter((item) => item.value !== this._type);\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"ui-title-7\">${Loc.getMessage('CRM_ADDRESS_COPY_TO')}</div>\n\t\t\t\t<div>\n\t\t\t\t\t${types.map((item) => Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t<label>\n\t\t\t\t\t<input onclick=\"${this.onChangeCopyDestination.bind(this)}\" type=\"checkbox\" value=\"${item.value}\">\n\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">${Text.encode(item.name)}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t`)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.destroy();\n\t\t}\n\t}\n\n\tonToggleDetailsVisibility()\n\t{\n\t\tthis.setDetailsVisibility(!this._showDetails);\n\t}\n\n\tonDelete()\n\t{\n\t\tthis.clearValue();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonCopyButtonClick()\n\t{\n\t\tthis.showCopyDestinationPopup();\n\t}\n\n\tonChangeCopyDestination(e)\n\t{\n\t\tlet input = e.target;\n\t\tlet value = input ? input.value : null;\n\t\tlet isChecked = input ? input.checked : false;\n\t\tif (isChecked && this._selectedCopyDestinations.indexOf(value) < 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.push(value);\n\t\t}\n\t\tif (!isChecked && this._selectedCopyDestinations.indexOf(value) >= 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.splice(this._selectedCopyDestinations.indexOf(value), 1);\n\t\t}\n\t\tlet popup = PopupManager.getPopupById(this._id + '_copy_dst_popup');\n\t\tif (popup)\n\t\t{\n\t\t\tlet button = popup.getButton('copy');\n\t\t\tif (button)\n\t\t\t{\n\t\t\t\tbutton.setDisabled(!this._selectedCopyDestinations.length);\n\t\t\t}\n\t\t}\n\t}\n\n\tonToggleTypesMenu(event)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\tthis.closeTypesMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTypesMenu(event.target);\n\t\t}\n\t}\n\n\tonChangeType(e, item)\n\t{\n\t\tthis.closeTypesMenu();\n\t\tif (this._type !== item.value)\n\t\t{\n\t\t\tlet prevType = this._type;\n\t\t\tthis._type = item.value;\n\t\t\tthis.refreshTypeName();\n\t\t\tthis.emit('onUpdateAddressType', {id: this.getId(), type: this.getType(), prevType});\n\t\t}\n\t}\n\n\tonAddressWidgetChangedState(event)\n\t{\n\t\tlet data = event.getData(),\n\t\t\tstate = data.state;\n\n\t\tlet wasLoading = this._isLoading;\n\n\t\tthis.computeIsLoading();\n\n\t\tif (wasLoading !== this._isLoading)\n\t\t{\n\t\t\tthis.refreshIcon();\n\t\t\tthis.refreshCopyButtonVisibility();\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADING)\n\t\t{\n\t\t\tthis.emit('onStartLoadAddress', {id: this.getId()});\n\t\t}\n\t\telse if (state === BX.Location.Widget.State.DATA_LOADED)\n\t\t{\n\t\t\tthis.emit('onAddressLoaded', {id: this.getId()});\n\t\t}\n\t\telse if (state === BX.Location.Widget.State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.emit('onAddressDataInputting', {id: this.getId()});\n\t\t}\n\t}\n\n\tonAddressChanged(event)\n\t{\n\t\tthis._isLoading = false;\n\n\t\tlet data = event.getData();\n\t\tthis._value = Type.isObject(data.address) ? data.address.toJson() : '';\n\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonFeatureEvent(event)\n\t{\n\t\tlet data = event.getData();\n\n\t\tif (data.feature instanceof BX.Location.Widget.AutocompleteFeature)\n\t\t{\n\t\t\tthis._isDropdownLoading = (data.eventCode === BX.Location.Widget.AutocompleteFeature.searchStartedEvent);\n\n\t\t\tlet wasLoading = this._isLoading;\n\n\t\t\tthis.computeIsLoading();\n\n\t\t\tif (wasLoading !== this._isLoading)\n\t\t\t{\n\t\t\t\tthis.refreshIcon();\n\t\t\t\tthis.refreshCopyButtonVisibility();\n\t\t\t}\n\t\t}\n\t}\n\n\tonError(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\t\tlet errorMessage = errors\n\t\t\t.map((error) => error.message + (error.code.length ? `${error.code}` : ''))\n\t\t\t.join(', ');\n\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\n\t\tthis.emit('onError', {id: this.getId(), error: errorMessage});\n\t}\n\n\tcomputeIsLoading()\n\t{\n\t\tthis._isLoading = (this._addressWidget.state === BX.Location.Widget.State.DATA_LOADING\n\t\t\t|| this._isDropdownLoading\n\t\t);\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis._addressWidget.resetView();\n\t}\n}"],"names":["EntityEditorBaseAddressField","id","settings","_id","BX","type","isNotEmptyString","util","getRandomString","_isMultiple","_settings","_typesList","_availableTypesIds","_allowedTypeIds","_addressList","_wrapper","_isEditMode","_showFirstItemOnly","prop","getBoolean","_enableAutocomplete","_hideDefaultAddressType","_showAddressTypeInViewMode","_addrZoneConfig","getObject","_countryId","getInteger","_defaultAddressType","updateAllowedTypes","isMultiple","value","items","Type","isPlainObject","types","Object","keys","isSame","length","addressItem","getType","hasOwnProperty","getValue","removeAllAddresses","addAddress","getDefaultType","address","isStringFilled","result","isString","push","list","initAvailableTypes","item","getString","name","typeIds","isArray","countryId","needUpdateAllowedTypes","parseInt","addressType","indexOf","allowedTypeList","typeValues","getValueTypes","getCountryId","config","getAddressZoneConfig","i","typeId","curZoneAddrTypes","addrTypeMap","setAllowedTypesIds","defAddrType","toString","isDefault","isEditMode","Tag","render","refreshLayout","Dom","clean","addrCounter","setEditMode","showMore","onShowMoreMouseUp","bind","Loc","getMessage","append","layout","isNull","crmCompatibilityMode","addButtonWrapClass","addButtonClass","onAddNewAddress","ids","map","getId","removeAddress","AddressItem","Text","getRandom","typesList","getTypesList","availableTypesIds","allowedTypesIds","canChangeType","enableAutocomplete","showAddressTypeInViewMode","subscribe","onUpdateAddress","onUpdateAddressType","onDeleteAddress","onStartLoadAddress","onAddressLoaded","onAddressDataInputting","onError","onCopyAddress","updateAvailableTypes","updateTypeSelectorVisibility","getAddressById","splice","destroy","filter","reduce","prev","removedType","addedType","setAvailableTypesIds","showTypeSelector","setTypeSelectorVisibility","EventEmitter","emit","event","emitUpdateEvent","data","getData","clearValue","prevType","stopPropagation","sourceAddress","sourceId","sourceAddressData","destinationTypes","destinationAddress","cur","setValue","markAsNew","resetView","self","initialize","setEventNamespace","_value","_isTypesMenuOpened","getArray","_allowedTypesIds","_canChangeType","typesMenuId","_type","_isTypeSelectorVisible","_isAutocompleteEnabled","_showDetails","_isLoading","_icon","_isDropdownLoading","_addressWidget","_domNodes","_selectedCopyDestinations","_isLocationModuleInstalled","isUndefined","Location","Core","Widget","initializeAddressWidget","Address","JSON","parse","e","widgetFactory","Factory","createAddressWidget","mode","ControlMode","edit","view","popupBindOptions","position","subscribeOnStateChangedEvent","onAddressWidgetChangedState","subscribeOnAddressChangedEvent","onAddressChanged","subscribeOnFeatureEvent","onFeatureEvent","subscribeOnErrorEvent","getAddress","clearLinks","toJson","typeMap","index","addressWidgetParams","addressString","convertAddressToString","getEditHtml","inputNode","searchInput","mapBindElement","fieldsContainer","detailsContainer","controlWrapper","addressContainer","getViewHtml","bindElement","menu","allowedTypes","selectedTypeId","getTypeListByIds","selected","text","onclick","onChangeType","MenuManager","show","angle","cacheable","events","onPopupShow","onPopupClose","createdMenu","getMenuById","isDomNode","addressTypeSelector","offsetWidth","getPopupWindow","setWidth","close","visible","typeName","icon","onToggleTypesMenu","addressTypeContainer","addClass","refreshTypeName","refreshIcon","detailsToggler","onToggleDetailsVisibility","copyButton","onCopyButtonClick","refreshCopyButtonVisibility","setDetailsVisibility","join","encode","textContent","title","newIcon","getNewIcon","node","newNode","onDelete","replace","isVisible","style","getAddressFormat","addressFormat","removeClass","popup","PopupManager","create","autoHide","titleBar","content","getCopyDestinationLayout","closeIcon","closeByEsc","buttons","UI","Button","color","Color","PRIMARY","state","ButtonState","DISABLED","button","getContext","onChangeCopyDestination","showCopyDestinationPopup","input","target","isChecked","checked","getPopupById","getButton","setDisabled","closeTypesMenu","openTypesMenu","wasLoading","computeIsLoading","State","DATA_LOADING","DATA_LOADED","DATA_INPUTTING","isObject","feature","AutocompleteFeature","eventCode","searchStartedEvent","errors","errorMessage","error","message","code"],"mappings":"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"}