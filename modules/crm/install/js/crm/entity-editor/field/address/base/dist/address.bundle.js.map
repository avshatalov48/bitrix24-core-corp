{"version":3,"file":"address.bundle.js","sources":["../src/address.js"],"sourcesContent":["/* eslint-disable no-underscore-dangle, @bitrix24/bitrix24-rules/no-pseudo-private */\n\nimport { Text, Tag, Dom, Type, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport './address.css';\nimport { MenuManager, PopupManager } from 'main.popup';\n\nexport class EntityEditorBaseAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._isMultiple = false;\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._typesList = [];\n\t\tthis._availableTypesIds = [];\n\t\tthis._allowedTypeIds = [];\n\t\tthis._addressList = [];\n\t\tthis._wrapper = null;\n\t\tthis._isEditMode = true;\n\t\tthis._showFirstItemOnly = BX.prop.getBoolean(settings, 'showFirstItemOnly', false);\n\t\tthis._enableAutocomplete = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._hideDefaultAddressType = BX.prop.getBoolean(this._settings, 'hideDefaultAddressType', false);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(this._settings, 'showAddressTypeInViewMode', false);\n\t\tthis._addrZoneConfig = BX.prop.getObject(this._settings, 'addressZoneConfig', {});\n\t\tthis._countryId = BX.prop.getInteger(\n\t\t\tthis._settings,\n\t\t\t'countryId',\n\t\t\tBX.prop.getInteger(this._addrZoneConfig, \"countryId\", 0)\n\t\t);\n\t\tthis._defaultAddressType = BX.prop.getInteger(this._settings, 'defaultAddressTypeByCategory', 0);\n\t\tif (this._defaultAddressType <= 0)\n\t\t{\n\t\t\tthis._defaultAddressType = BX.prop.getInteger(this._addrZoneConfig, 'defaultAddressType', 0)\n\t\t}\n\n\t\tthis.updateAllowedTypes();\n\t}\n\n\tsetMultiple(isMultiple)\n\t{\n\t\tthis._isMultiple = !!isMultiple;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet items = Type.isPlainObject(value) ? value : {};\n\t\t\tlet types = Object.keys(items);\n\n\t\t\tlet isSame = (this._addressList.length > 0 && types.length == this._addressList.length);\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\tfor (let addressItem of this._addressList)\n\t\t\t\t{\n\t\t\t\t\tlet type = addressItem.getType();\n\t\t\t\t\tif (!items.hasOwnProperty(type) || items[type] !== addressItem.getValue())\n\t\t\t\t\t{\n\t\t\t\t\t\tisSame = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( // if new value is empty and old value has only one empty element\n\t\t\t\t!isSame &&\n\t\t\t\t!types.length &&\n\t\t\t\tthis._addressList.length === 1 &&\n\t\t\t\t!this._addressList[0].getValue().length\n\t\t\t)\n\t\t\t{\n\t\t\t\tisSame = true;\n\t\t\t}\n\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\treturn false; // update is not required\n\t\t\t}\n\n\t\t\tthis.removeAllAddresses();\n\t\t\tfor (let type of types)\n\t\t\t{\n\t\t\t\tthis.addAddress(type, items[type]);\n\t\t\t}\n\t\t\tif (!types.length)\n\t\t\t{\n\t\t\t\tthis.addAddress(this.getDefaultType(), null);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeAllAddresses();\n\t\t\tlet address = Type.isStringFilled(value) ? value : null;\n\t\t\tthis.addAddress(null, address);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet result = [];\n\t\t\tfor (let addressItem of this._addressList)\n\t\t\t{\n\t\t\t\tlet value = addressItem.getValue();\n\t\t\t\tif (Type.isString(value))\n\t\t\t\t{\n\t\t\t\t\tresult.push({type: addressItem.getType(), value});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._addressList && this._addressList[0] && Type.isString(this._addressList[0].getValue()))\n\t\t\t{\n\t\t\t\treturn this._addressList[0].getValue();\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetTypesList(list)\n\t{\n\t\tthis._typesList = [];\n\t\tif (Type.isPlainObject(list))\n\t\t{\n\t\t\tfor (let id of Object.keys(list))\n\t\t\t{\n\t\t\t\tthis._typesList.push(list[id]);\n\t\t\t}\n\t\t}\n\t\tthis.initAvailableTypes();\n\t}\n\n\tgetTypesList()\n\t{\n\t\tlet types = [];\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet name = BX.prop.getString(item, \"DESCRIPTION\", \"\");\n\n\t\t\ttypes.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn types;\n\t}\n\n\tsetAllowedTypes(typeIds)\n\t{\n\t\tthis._allowedTypeIds = [];\n\t\tif (Type.isArray(typeIds))\n\t\t{\n\t\t\tthis._allowedTypeIds = typeIds;\n\t\t}\n\t}\n\n\tgetAllowedTypes()\n\t{\n\t\treturn this._allowedTypeIds;\n\t}\n\n\tsetCountryId(countryId)\n\t{\n\t\tlet needUpdateAllowedTypes = false;\n\n\t\tcountryId = parseInt(countryId);\n\t\tif (this._countryId !== countryId)\n\t\t{\n\t\t\tneedUpdateAllowedTypes = true;\n\t\t}\n\t\tthis._countryId = countryId;\n\n\t\tif (needUpdateAllowedTypes)\n\t\t{\n\t\t\tthis.updateAllowedTypes();\n\t\t}\n\t}\n\n\tgetCountryId()\n\t{\n\t\treturn this._countryId;\n\t}\n\n\tgetAddressZoneConfig()\n\t{\n\t\treturn this._addrZoneConfig\n\t}\n\n\tgetValueTypes()\n\t{\n\t\tlet result = [];\n\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\tlet addressType = parseInt(addressItem.getType());\n\t\t\tif (result.indexOf(addressType) < 0)\n\t\t\t{\n\t\t\t\tresult.push(addressType);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tupdateAllowedTypes()\n\t{\n\t\tlet allowedTypeList = [];\n\t\tlet typeValues = this.getValueTypes();\n\t\tlet countryId = this.getCountryId();\n\t\tlet config = this.getAddressZoneConfig();\n\n\t\tif (Type.isPlainObject(config))\n\t\t{\n\t\t\tif (config.hasOwnProperty(\"currentZoneAddressTypes\")\n\t\t\t\t&& Type.isArray(config[\"currentZoneAddressTypes\"]))\n\t\t\t{\n\t\t\t\tlet i;\n\t\t\t\tlet typeId;\n\t\t\t\tlet curZoneAddrTypes = config[\"currentZoneAddressTypes\"];\n\t\t\t\tfor (i = 0; i < curZoneAddrTypes.length; i++)\n\t\t\t\t{\n\t\t\t\t\ttypeId = parseInt(curZoneAddrTypes[i]);\n\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (countryId > 0\n\t\t\t\t\t&& config.hasOwnProperty(\"countryAddressTypeMap\")\n\t\t\t\t\t&& Type.isPlainObject(config[\"countryAddressTypeMap\"])\n\t\t\t\t\t&& config[\"countryAddressTypeMap\"].hasOwnProperty(countryId)\n\t\t\t\t\t&& Type.isArray(config[\"countryAddressTypeMap\"][countryId]))\n\t\t\t\t{\n\t\t\t\t\tlet addrTypeMap = config[\"countryAddressTypeMap\"][countryId];\n\t\t\t\t\tfor (i = 0; i < addrTypeMap.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\ttypeId = parseInt(addrTypeMap[i]);\n\t\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (i = 0; i < typeValues.length; i++)\n\t\t\t\t{\n\t\t\t\t\ttypeId = parseInt(typeValues[i]);\n\t\t\t\t\tif (allowedTypeList.indexOf(typeId) < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tallowedTypeList.push(typeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._allowedTypeIds = allowedTypeList;\n\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAllowedTypesIds([...this._allowedTypeIds]);\n\t\t}\n\t}\n\n\tgetDefaultType(): string | null\n\t{\n\t\tconst defaultAddressTypeId = this._defaultAddressType.toString();\n\t\tif (\n\t\t\tdefaultAddressTypeId > 0\n\t\t\t&& this._availableTypesIds.includes(defaultAddressTypeId)\n\t\t\t&& this._allowedTypeIds.includes(Text.toInteger(defaultAddressTypeId))\n\t\t)\n\t\t{\n\t\t\treturn defaultAddressTypeId;\n\t\t}\n\n\t\tfor (const allowedTypeId: number of this._allowedTypeIds)\n\t\t{\n\t\t\tconst strAllowedTypeId: string = allowedTypeId.toString();\n\t\t\tif (this._availableTypesIds.includes(strAllowedTypeId))\n\t\t\t{\n\t\t\t\tconst type = this._typesList.find((typeValue: Object): ?Object => {\n\t\t\t\t\treturn typeValue.ID === strAllowedTypeId;\n\t\t\t\t});\n\n\t\t\t\treturn type?.ID ?? null;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tlayout(isEditMode)\n\t{\n\t\tthis._isEditMode = isEditMode;\n\n\t\tthis._wrapper = Tag.render`<div class=\"crm-address-control-wrap ${this._isEditMode ? 'crm-address-control-wrap-edit' : ''}\"></div>`;\n\t\tthis.refreshLayout();\n\n\t\treturn this._wrapper;\n\t}\n\n\trefreshLayout()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tlet addrCounter = true;\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setEditMode(this._isEditMode);\n\t\t\tif (!this._isEditMode && this._showFirstItemOnly && addrCounter > 1)\n\t\t\t{\n\t\t\t\tlet showMore = Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onShowMoreMouseUp.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_ADDRESS_SHOW_ALL')}\n\t\t\t\t\t</span>`;\n\t\t\t\tDom.append(showMore, this._wrapper);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(addressItem.layout(), this._wrapper);\n\t\t\t}\n\t\t\taddrCounter++;\n\t\t}\n\t\tif (this._isEditMode && this._isMultiple && !Type.isNull(this.getDefaultType()))\n\t\t{\n\t\t\tlet crmCompatibilityMode = BX.prop.getBoolean(this._settings, 'crmCompatibilityMode', false);\n\t\t\tlet addButtonWrapClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-block-add-field' : 'ui-entity-widget-content-block-add-field';\n\t\t\tlet addButtonClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-add-field' : 'ui-entity-editor-content-add-lnk';\n\t\t\tDom.append(Tag.render`\n\t\t\t\t<div class=\"${addButtonWrapClass}\"><span class=\"${addButtonClass}\" onclick=\"${this.onAddNewAddress.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_ADD')}</span></div>\n\t\t\t`, this._wrapper);\n\t\t}\n\t}\n\n\trelease()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tthis.removeAllAddresses();\n\t}\n\n\tremoveAllAddresses()\n\t{\n\t\tlet ids = this._addressList.map((item) => item.getId());\n\t\tfor (let id of ids)\n\t\t{\n\t\t\tthis.removeAddress(id);\n\t\t}\n\t}\n\n\taddAddress(type, value = null)\n\t{\n\t\tlet addressItem = new AddressItem(Text.getRandom(8), {\n\t\t\ttypesList: this.getTypesList(),\n\t\t\tavailableTypesIds: [...this._availableTypesIds],\n\t\t\tallowedTypesIds: [...this._allowedTypeIds],\n\t\t\tcanChangeType: this._isMultiple,\n\t\t\tenableAutocomplete: this._enableAutocomplete,\n\t\t\tshowAddressTypeInViewMode: this._isMultiple && this._showAddressTypeInViewMode,\n\t\t\ttype,\n\t\t\tvalue\n\t\t});\n\t\taddressItem.subscribe('onUpdateAddress', this.onUpdateAddress.bind(this));\n\t\taddressItem.subscribe('onUpdateAddressType', this.onUpdateAddressType.bind(this));\n\t\taddressItem.subscribe('onDelete', this.onDeleteAddress.bind(this));\n\t\taddressItem.subscribe('onStartLoadAddress', this.onStartLoadAddress.bind(this));\n\t\taddressItem.subscribe('onAddressLoaded', this.onAddressLoaded.bind(this));\n\t\taddressItem.subscribe('onAddressDataInputting', this.onAddressDataInputting.bind(this));\n\t\taddressItem.subscribe('onError', this.onError.bind(this));\n\t\taddressItem.subscribe('onCopyAddress', this.onCopyAddress.bind(this));\n\t\tthis.updateAvailableTypes(type, null);\n\t\tthis._addressList.push(addressItem);\n\t\tthis.updateAllowedTypes();\n\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\treturn addressItem;\n\t}\n\n\tremoveAddress(id)\n\t{\n\t\tlet addressItem = this.getAddressById(id);\n\t\tif (addressItem)\n\t\t{\n\t\t\tlet type = addressItem.getType();\n\t\t\tthis._addressList.splice(this._addressList.indexOf(addressItem), 1);\n\t\t\tthis.updateAvailableTypes(null, type);\n\t\t\tthis.updateAllowedTypes();\n\t\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\t\taddressItem.destroy();\n\t\t}\n\t}\n\n\tgetAddressById(id)\n\t{\n\t\treturn this._addressList\n\t\t\t.filter((item) => item.getId() === id)\n\t\t\t.reduce((prev, item) => prev ? prev : item, null);\n\t}\n\n\tinitAvailableTypes()\n\t{\n\t\tthis._availableTypesIds = [];\n\t\tfor (let type of this._typesList)\n\t\t{\n\t\t\tthis._availableTypesIds.push(BX.prop.getString(type, \"ID\", \"\"));\n\t\t}\n\t}\n\n\tupdateAvailableTypes(removedType, addedType)\n\t{\n\t\tif (!Type.isNull(addedType) && this._availableTypesIds.indexOf(addedType) < 0)\n\t\t{\n\t\t\tthis._availableTypesIds.push(addedType);\n\t\t}\n\t\tif (!Type.isNull(removedType) && this._availableTypesIds.indexOf(removedType) >= 0)\n\t\t{\n\t\t\tthis._availableTypesIds.splice(this._availableTypesIds.indexOf(removedType), 1);\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAvailableTypesIds([...this._availableTypesIds]);\n\t\t}\n\t}\n\n\tupdateTypeSelectorVisibility(showTypeSelector)\n\t{\n\t\tif (!this._hideDefaultAddressType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setTypeSelectorVisibility(showTypeSelector);\n\t\t}\n\t}\n\n\temitUpdateEvent()\n\t{\n\t\tEventEmitter.emit(this, 'onUpdate', {value: this.getValue()});\n\t}\n\n\tonAddNewAddress()\n\t{\n\t\tthis.addAddress(this.getDefaultType());\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddress(event)\n\t{\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonDeleteAddress(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet id = data.id;\n\t\tif (this._addressList.length <= 1)\n\t\t{\n\t\t\t// should be at least one address, so just clear it\n\t\t\tlet addressItem = this.getAddressById(id);\n\t\t\tif (addressItem)\n\t\t\t{\n\t\t\t\taddressItem.clearValue();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.removeAddress(id);\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddressType(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet prevType = data.prevType;\n\t\tlet type = data.type;\n\t\tthis.updateAvailableTypes(type, prevType);\n\t\tthis.updateAllowedTypes();\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonShowMoreMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis._showFirstItemOnly = false;\n\t\tthis.refreshLayout();\n\t\treturn false;\n\t}\n\n\tonStartLoadAddress(event)\n\t{\n\t\tEventEmitter.emit(this, 'onStartLoadAddress');\n\t}\n\n\tonAddressLoaded(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressLoaded');\n\t}\n\n\tonAddressDataInputting(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressDataInputting');\n\t}\n\n\tonError(event)\n\t{\n\t\tEventEmitter.emit(this, 'onError', event);\n\t}\n\n\tonCopyAddress(event)\n\t{\n\t\tconst data = event.getData();\n\t\tlet sourceAddress = this.getAddressById(data.sourceId);\n\t\tif (!sourceAddress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst sourceAddressData = sourceAddress.getValue();\n\t\tif (!(sourceAddressData).length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i=0; i < data.destinationTypes.length; i++)\n\t\t{\n\t\t\tconst type = data.destinationTypes[i];\n\t\t\tlet destinationAddress = this._addressList\n\t\t\t\t.filter((item) => item.getType() == type)\n\t\t\t\t.reduce((prev, cur) => prev ? prev : cur, null);\n\t\t\tif (destinationAddress)\n\t\t\t{\n\t\t\t\tdestinationAddress.setValue(sourceAddressData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdestinationAddress = this.addAddress(type, sourceAddressData);\n\t\t\t}\n\t\t\tdestinationAddress.markAsNew();\n\n\t\t\tthis.refreshLayout();\n\t\t}\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tresetView(): void\n\t{\n\t\tfor (const addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.resetView();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorBaseAddressField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass AddressItem extends EventEmitter\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.AddressItem');\n\n\t\tthis._id = id;\n\t\tthis._value = BX.prop.getString(settings, 'value', \"\");\n\t\tthis._isTypesMenuOpened = false;\n\t\tthis._typesList = BX.prop.getArray(settings, 'typesList', []);\n\t\tthis._availableTypesIds = BX.prop.getArray(settings, 'availableTypesIds', []);\n\t\tthis._allowedTypesIds = BX.prop.getArray(settings, 'allowedTypesIds', []);\n\t\tthis._canChangeType = BX.prop.getBoolean(settings, 'canChangeType', false);\n\t\tthis.typesMenuId = 'address_type_menu_' + this._id;\n\t\tthis._type = BX.prop.getString(settings, 'type', \"\");\n\t\tthis._isEditMode = true;\n\t\tthis._isTypeSelectorVisible = BX.prop.getBoolean(settings, 'isTypeSelectorVisible', true);\n\t\tthis._isAutocompleteEnabled = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(settings, 'showAddressTypeInViewMode', true);\n\t\tthis._showDetails = !this._isAutocompleteEnabled || BX.prop.getBoolean(settings, 'showDetails', false);\n\t\tthis._isLoading = false;\n\t\tthis._icon = null;\n\t\tthis._isDropdownLoading = false;\n\t\tthis._addressWidget = null;\n\t\tthis._wrapper = null;\n\t\tthis._domNodes = {};\n\t\tthis._selectedCopyDestinations = [];\n\n\t\tthis._isLocationModuleInstalled =\n\t\t\t!Type.isUndefined(BX.Location) &&\n\t\t\t!Type.isUndefined(BX.Location.Core)&&\n\t\t\t!Type.isUndefined(BX.Location.Widget);\n\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tinitializeAddressWidget()\n\t{\n\t\tif (!this._isLocationModuleInstalled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = this.getValue();\n\n\t\tlet address = null;\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new BX.Location.Core.Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t}\n\t\t}\n\n\t\tlet widgetFactory = new BX.Location.Widget.Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view,\n\t\t\tpopupBindOptions: {position: 'right'}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));\n\t\tthis._addressWidget.subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.onError.bind(this));\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this._value;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.destroy();\n\t\tthis._value = value;\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tmarkAsNew()\n\t{\n\t\tlet address = this.getAddress();\n\t\tif (address)\n\t\t{\n\t\t\taddress.id = 0;\n\t\t\taddress.clearLinks();\n\t\t}\n\t\tthis._value = address ? address.toJson() : '';\n\t}\n\n\tsetEditMode(isEditMode)\n\t{\n\t\tthis._isEditMode = !!isEditMode;\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.mode = isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view;\n\t\t}\n\t}\n\n\tsetAvailableTypesIds(ids)\n\t{\n\t\tthis._availableTypesIds = ids;\n\t}\n\n\tsetAllowedTypesIds(ids)\n\t{\n\t\tthis._allowedTypesIds = ids;\n\t}\n\n\tgetTypeListByIds(ids)\n\t{\n\t\tlet result = [];\n\n\t\tif (Type.isArray(ids) && ids.length > 0)\n\t\t{\n\t\t\tlet typeMap = {};\n\t\t\tfor (let item of this._typesList)\n\t\t\t{\n\t\t\t\ttypeMap[\"a\" + item.value] = item;\n\t\t\t}\n\t\t\tfor (let typeId of ids)\n\t\t\t{\n\t\t\t\tlet index = \"a\" + typeId;\n\t\t\t\tif (typeMap.hasOwnProperty(index))\n\t\t\t\t{\n\t\t\t\t\tresult.push(typeMap[index]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tlayout()\n\t{\n\t\tif (Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._wrapper = Tag.render`<div>Location module is not installed</div>`;\n\t\t\treturn this._wrapper;\n\t\t}\n\t\tlet addressWidgetParams = {};\n\t\tconst addressString = this.convertAddressToString(this.getAddress());\n\t\tif (this._isEditMode)\n\t\t{\n\t\t\tthis._wrapper = this.getEditHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.edit;\n\t\t\taddressWidgetParams.inputNode = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.mapBindElement = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.fieldsContainer = this._domNodes.detailsContainer;\n\t\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._wrapper = this.getViewHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.view;\n\t\t\taddressWidgetParams.mapBindElement = this._wrapper;\n\t\t}\n\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\treturn this._wrapper;\n\t}\n\n\topenTypesMenu(bindElement)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = [];\n\t\tlet allowedTypes = [...this._allowedTypesIds];\n\t\tlet selectedTypeId = parseInt(this._type);\n\t\tif (allowedTypes.indexOf(selectedTypeId) < 0)\n\t\t{\n\t\t\tallowedTypes.push(selectedTypeId);\n\t\t}\n\t\tfor (let item of this.getTypeListByIds(allowedTypes))\n\t\t{\n\t\t\tlet selected = (selectedTypeId === parseInt(item.value));\n\t\t\tif (this._availableTypesIds.indexOf(item.value) < 0 && !selected)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\t//className: selected ? \"menu-popup-item-accept\" : \"menu-popup-item-none\",\n\t\t\t\t\tonclick: this.onChangeType.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.typesMenuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tlet createdMenu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (createdMenu && Type.isDomNode(this._domNodes.addressTypeSelector)\n\t\t\t&& this._domNodes.addressTypeSelector.offsetWidth > 200)\n\t\t{\n\t\t\tcreatedMenu.getPopupWindow().setWidth(this._domNodes.addressTypeSelector.offsetWidth);\n\t\t}\n\t};\n\n\tcloseTypesMenu()\n\t{\n\t\tlet menu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tsetTypeSelectorVisibility(visible)\n\t{\n\t\tthis._isTypeSelectorVisible = !!visible;\n\t}\n\n\tgetEditHtml(addressString)\n\t{\n\t\tthis._domNodes.typeName = Tag.render`<div class=\"ui-ctl-element\"></div>`;\n\t\tthis._domNodes.searchInput = Tag.render`\n\t\t\t<input type=\"text\" class=\"ui-ctl-element ui-ctl-textbox\" value=\"${addressString}\" ${this._isAutocompleteEnabled ? '' : 'readonly'}>`;\n\t\tthis._domNodes.icon = Tag.render`<span></span>`;\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t<div class=\"crm-address-search-control-block\">\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t${this._domNodes.icon}\n\t\t\t\t${this._domNodes.searchInput}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis._domNodes.detailsContainer = Tag.render`\n\t\t\t<div class=\"location-fields-control-block\"></div>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tif (this._isTypeSelectorVisible)\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-inline ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w25\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\t\t\t\tthis._domNodes.addressTypeContainer = null;\n\n\t\t\t\tDom.addClass(this._domNodes.addressContainer, ['ui-ctl-inline', 'ui-ctl-w75']);\n\t\t\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl-inline ui-ctl-w100\">\n\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\n\t\t\t\tthis._domNodes.addressTypeContainer = Tag.render`\n\t\t\t\t\t<div class=\"location-fields-control-block crm-address-type-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${Loc.getMessage('CRM_ADDRESS_TYPE')}</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t}\n\t\t\tthis.refreshTypeName();\n\t\t}\n\n\t\tthis.refreshIcon();\n\n\t\tthis._domNodes.detailsToggler =\n\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onToggleDetailsVisibility.bind(this)}\"></span>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tthis._domNodes.copyButton =\n\t\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onCopyButtonClick.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_COPY1')}</span>`;\n\t\t}\n\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.setDetailsVisibility(this._showDetails);\n\n\t\tlet result = Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t<div class=\"crm-address-control-mode-switch\">\n\t\t\t\t\t${this._domNodes.copyButton ? this._domNodes.copyButton : ''}\n\t\t\t\t\t${this._domNodes.detailsToggler}\n\t\t\t\t</div>\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t${this._domNodes.detailsContainer}\n\t\t\t</div>`;\n\n\t\tif (this._canChangeType && Type.isDomNode(this._domNodes.addressTypeContainer))\n\t\t{\n\t\t\tDom.append(this._domNodes.addressTypeContainer, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetViewHtml(addressString)\n\t{\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>\n\t\t\t</div>`;\n\n\t\tlet addressType = '';\n\t\tif (this._showAddressTypeInViewMode)\n\t\t{\n\t\t\tlet typeName = this._typesList\n\t\t\t\t.filter((item) => item.value == this._type)\n\t\t\t\t.map((item) => item.name)\n\t\t\t\t.join('')\n\n\t\t\taddressType = Tag.render`<span class=\"ui-link ui-link-secondary\">${Text.encode(typeName)}:</span>`\n\t\t}\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t${addressType}\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t</div>`;\n\t}\n\n\trefreshTypeName()\n\t{\n\t\tif (Type.isDomNode(this._domNodes.typeName))\n\t\t{\n\t\t\tlet typeName =\n\t\t\t\tthis._typesList\n\t\t\t\t\t.filter((item) => item.value === this._type)\n\t\t\t\t\t.map((item) => item.name)\n\t\t\t\t\t.join('');\n\n\t\t\tthis._domNodes.typeName.textContent = typeName;\n\t\t\tthis._domNodes.typeName.title = typeName;\n\t\t}\n\t}\n\n\trefreshIcon()\n\t{\n\t\tlet newIcon = this.getNewIcon();\n\t\tif (this._icon !== newIcon)\n\t\t{\n\t\t\tlet node = this._domNodes.icon;\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tlet newNode;\n\t\t\t\tif (newIcon === 'loading')\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ui-ctl-icon-loader\"></span>`;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (newIcon === 'clear')\n\t\t\t\t\t{\n\t\t\t\t\t\tnewNode = Tag.render`<button type=\"button\" class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onDelete.bind(this)}\"></button>`;\n\t\t\t\t\t}\n\t\t\t\t\telse if (newIcon === 'search')\n\t\t\t\t\t{\n\t\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ${this._isAutocompleteEnabled ? 'ui-ctl-icon-search' : ''}\"></span>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tDom.replace(node, newNode);\n\t\t\t\tthis._domNodes.icon = newNode;\n\t\t\t}\n\n\t\t\tthis._icon = newIcon;\n\t\t}\n\t}\n\n\tgetNewIcon()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\treturn 'loading';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.getAddress() ? 'clear' : 'search';\n\t\t}\n\t}\n\n\trefreshCopyButtonVisibility()\n\t{\n\t\tlet node = this._domNodes.copyButton;\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tlet isVisible = !!this.getAddress();\n\t\t\tDom.style(node, 'display', isVisible ? '' : 'none');\n\t\t}\n\t}\n\n\tconvertAddressToString(address)\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.getAddressFormat());\n\t}\n\n\tgetAddress()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.address;\n\t}\n\n\tgetAddressFormat()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.addressFormat;\n\t}\n\n\tclearValue()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.resetView();\n\t\t\tthis._addressWidget.address = null;\n\t\t}\n\t\tif (Type.isDomNode(this._domNodes.searchInput))\n\t\t{\n\t\t\tthis._domNodes.searchInput.value = '';\n\t\t}\n\t\tthis._value = \"\";\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\t}\n\n\tsetDetailsVisibility(visible)\n\t{\n\t\tthis._showDetails = !!visible;\n\t\tif (this._showDetails)\n\t\t{\n\t\t\tDom.addClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_SHORT_MSGVER_1');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.addClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_DETAILED_MSGVER_1');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.removeClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t}\n\n\tshowCopyDestinationPopup()\n\t{\n\t\tlet popup = PopupManager.create({\n\t\t\tid: this._id + '_copy_dst_popup',\n\t\t\tcacheable: false,\n\t\t\tautoHide: true,\n\t\t\ttitleBar: Loc.getMessage('CRM_ADDRESS_COPY_TITLE'),\n\t\t\tcontent: this.getCopyDestinationLayout(),\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tid: 'copy',\n\t\t\t\t\ttext: Loc.getMessage('CRM_ADDRESS_COPY2'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: BX.UI.ButtonState.DISABLED,\n\t\t\t\t\tonclick:(button) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t\tthis.emit('onCopyAddress', {\n\t\t\t\t\t\t\tsourceId: this.getId(),\n\t\t\t\t\t\t\tdestinationTypes: this._selectedCopyDestinations});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\tgetCopyDestinationLayout()\n\t{\n\t\tlet types = this.getTypeListByIds(this._allowedTypesIds).filter((item) => item.value !== this._type);\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"ui-title-7\">${Loc.getMessage('CRM_ADDRESS_COPY_TO')}</div>\n\t\t\t\t<div>\n\t\t\t\t\t${types.map((item) => Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t<label>\n\t\t\t\t\t<input onclick=\"${this.onChangeCopyDestination.bind(this)}\" type=\"checkbox\" value=\"${item.value}\">\n\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">${Text.encode(item.name)}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t`)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.destroy();\n\t\t}\n\t}\n\n\tonToggleDetailsVisibility()\n\t{\n\t\tthis.setDetailsVisibility(!this._showDetails);\n\t}\n\n\tonDelete()\n\t{\n\t\tthis.clearValue();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonCopyButtonClick()\n\t{\n\t\tthis.showCopyDestinationPopup();\n\t}\n\n\tonChangeCopyDestination(e)\n\t{\n\t\tlet input = e.target;\n\t\tlet value = input ? input.value : null;\n\t\tlet isChecked = input ? input.checked : false;\n\t\tif (isChecked && this._selectedCopyDestinations.indexOf(value) < 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.push(value);\n\t\t}\n\t\tif (!isChecked && this._selectedCopyDestinations.indexOf(value) >= 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.splice(this._selectedCopyDestinations.indexOf(value), 1);\n\t\t}\n\t\tlet popup = PopupManager.getPopupById(this._id + '_copy_dst_popup');\n\t\tif (popup)\n\t\t{\n\t\t\tlet button = popup.getButton('copy');\n\t\t\tif (button)\n\t\t\t{\n\t\t\t\tbutton.setDisabled(!this._selectedCopyDestinations.length);\n\t\t\t}\n\t\t}\n\t}\n\n\tonToggleTypesMenu(event)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\tthis.closeTypesMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTypesMenu(event.target);\n\t\t}\n\t}\n\n\tonChangeType(e, item)\n\t{\n\t\tthis.closeTypesMenu();\n\t\tif (this._type !== item.value)\n\t\t{\n\t\t\tlet prevType = this._type;\n\t\t\tthis._type = item.value;\n\t\t\tthis.refreshTypeName();\n\t\t\tthis.emit('onUpdateAddressType', {id: this.getId(), type: this.getType(), prevType});\n\t\t}\n\t}\n\n\tonAddressWidgetChangedState(event)\n\t{\n\t\tlet data = event.getData(),\n\t\t\tstate = data.state;\n\n\t\tlet wasLoading = this._isLoading;\n\n\t\tthis.computeIsLoading();\n\n\t\tif (wasLoading !== this._isLoading)\n\t\t{\n\t\t\tthis.refreshIcon();\n\t\t\tthis.refreshCopyButtonVisibility();\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADING)\n\t\t{\n\t\t\tthis.emit('onStartLoadAddress', {id: this.getId()});\n\t\t}\n\t\telse if (state === BX.Location.Widget.State.DATA_LOADED)\n\t\t{\n\t\t\tthis.emit('onAddressLoaded', {id: this.getId()});\n\t\t}\n\t\telse if (state === BX.Location.Widget.State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.emit('onAddressDataInputting', {id: this.getId()});\n\t\t}\n\t}\n\n\tonAddressChanged(event)\n\t{\n\t\tthis._isLoading = false;\n\n\t\tlet data = event.getData();\n\t\tthis._value = Type.isObject(data.address) ? data.address.toJson() : '';\n\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonFeatureEvent(event)\n\t{\n\t\tlet data = event.getData();\n\n\t\tif (data.feature instanceof BX.Location.Widget.AutocompleteFeature)\n\t\t{\n\t\t\tthis._isDropdownLoading = (data.eventCode === BX.Location.Widget.AutocompleteFeature.searchStartedEvent);\n\n\t\t\tlet wasLoading = this._isLoading;\n\n\t\t\tthis.computeIsLoading();\n\n\t\t\tif (wasLoading !== this._isLoading)\n\t\t\t{\n\t\t\t\tthis.refreshIcon();\n\t\t\t\tthis.refreshCopyButtonVisibility();\n\t\t\t}\n\t\t}\n\t}\n\n\tonError(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\t\tlet errorMessage = errors\n\t\t\t.map((error) => error.message + (error.code.length ? `${error.code}` : ''))\n\t\t\t.join(', ');\n\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\n\t\tthis.emit('onError', {id: this.getId(), error: errorMessage});\n\t}\n\n\tcomputeIsLoading()\n\t{\n\t\tthis._isLoading = (this._addressWidget.state === BX.Location.Widget.State.DATA_LOADING\n\t\t\t|| this._isDropdownLoading\n\t\t);\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis._addressWidget.resetView();\n\t}\n}"],"names":["EntityEditorBaseAddressField","id","settings","_id","BX","type","isNotEmptyString","util","getRandomString","_isMultiple","_settings","_typesList","_availableTypesIds","_allowedTypeIds","_addressList","_wrapper","_isEditMode","_showFirstItemOnly","prop","getBoolean","_enableAutocomplete","_hideDefaultAddressType","_showAddressTypeInViewMode","_addrZoneConfig","getObject","_countryId","getInteger","_defaultAddressType","updateAllowedTypes","isMultiple","value","items","Type","isPlainObject","types","Object","keys","isSame","length","addressItem","getType","hasOwnProperty","getValue","removeAllAddresses","addAddress","getDefaultType","address","isStringFilled","result","isString","push","list","initAvailableTypes","item","getString","name","typeIds","isArray","countryId","needUpdateAllowedTypes","parseInt","addressType","indexOf","allowedTypeList","typeValues","getValueTypes","getCountryId","config","getAddressZoneConfig","i","typeId","curZoneAddrTypes","addrTypeMap","setAllowedTypesIds","defaultAddressTypeId","toString","includes","Text","toInteger","allowedTypeId","strAllowedTypeId","find","typeValue","ID","isEditMode","Tag","render","refreshLayout","Dom","clean","addrCounter","setEditMode","showMore","onShowMoreMouseUp","bind","Loc","getMessage","append","layout","isNull","crmCompatibilityMode","addButtonWrapClass","addButtonClass","onAddNewAddress","ids","map","getId","removeAddress","AddressItem","getRandom","typesList","getTypesList","availableTypesIds","allowedTypesIds","canChangeType","enableAutocomplete","showAddressTypeInViewMode","subscribe","onUpdateAddress","onUpdateAddressType","onDeleteAddress","onStartLoadAddress","onAddressLoaded","onAddressDataInputting","onError","onCopyAddress","updateAvailableTypes","updateTypeSelectorVisibility","getAddressById","splice","destroy","filter","reduce","prev","removedType","addedType","setAvailableTypesIds","showTypeSelector","setTypeSelectorVisibility","EventEmitter","emit","event","emitUpdateEvent","data","getData","clearValue","prevType","stopPropagation","sourceAddress","sourceId","sourceAddressData","destinationTypes","destinationAddress","cur","setValue","markAsNew","resetView","self","initialize","setEventNamespace","_value","_isTypesMenuOpened","getArray","_allowedTypesIds","_canChangeType","typesMenuId","_type","_isTypeSelectorVisible","_isAutocompleteEnabled","_showDetails","_isLoading","_icon","_isDropdownLoading","_addressWidget","_domNodes","_selectedCopyDestinations","_isLocationModuleInstalled","isUndefined","Location","Core","Widget","initializeAddressWidget","Address","JSON","parse","e","widgetFactory","Factory","createAddressWidget","mode","ControlMode","edit","view","popupBindOptions","position","subscribeOnStateChangedEvent","onAddressWidgetChangedState","subscribeOnAddressChangedEvent","onAddressChanged","subscribeOnFeatureEvent","onFeatureEvent","subscribeOnErrorEvent","getAddress","clearLinks","toJson","typeMap","index","addressWidgetParams","addressString","convertAddressToString","getEditHtml","inputNode","searchInput","mapBindElement","fieldsContainer","detailsContainer","controlWrapper","addressContainer","getViewHtml","bindElement","menu","allowedTypes","selectedTypeId","getTypeListByIds","selected","text","onclick","onChangeType","MenuManager","show","angle","cacheable","events","onPopupShow","onPopupClose","createdMenu","getMenuById","isDomNode","addressTypeSelector","offsetWidth","getPopupWindow","setWidth","close","visible","typeName","icon","onToggleTypesMenu","addressTypeContainer","addClass","refreshTypeName","refreshIcon","detailsToggler","onToggleDetailsVisibility","copyButton","onCopyButtonClick","refreshCopyButtonVisibility","setDetailsVisibility","join","encode","textContent","title","newIcon","getNewIcon","node","newNode","onDelete","replace","isVisible","style","getAddressFormat","addressFormat","removeClass","popup","PopupManager","create","autoHide","titleBar","content","getCopyDestinationLayout","closeIcon","closeByEsc","buttons","UI","Button","color","Color","PRIMARY","state","ButtonState","DISABLED","button","getContext","onChangeCopyDestination","showCopyDestinationPopup","input","target","isChecked","checked","getPopupById","getButton","setDisabled","closeTypesMenu","openTypesMenu","wasLoading","computeIsLoading","State","DATA_LOADING","DATA_LOADED","DATA_INPUTTING","isObject","feature","AutocompleteFeature","eventCode","searchStartedEvent","errors","errorMessage","error","message","code"],"mappings":"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"}