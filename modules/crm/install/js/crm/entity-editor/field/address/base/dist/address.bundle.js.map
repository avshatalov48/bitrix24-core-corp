{"version":3,"file":"address.bundle.js","sources":["../src/address.js"],"sourcesContent":["import {Text, Tag, Dom, Type, Loc} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport \"./address.css\"\nimport {MenuManager, PopupManager} from \"main.popup\";\n\nexport class EntityEditorBaseAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._isMultiple = false;\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._typesList = [];\n\t\tthis._availableTypesIds = [];\n\t\tthis._addressList = [];\n\t\tthis._wrapper = null;\n\t\tthis._isEditMode = true;\n\t\tthis._showFirstItemOnly = BX.prop.getBoolean(settings, 'showFirstItemOnly', false);\n\t\tthis._enableAutocomplete = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._hideDefaultAddressType = BX.prop.getBoolean(this._settings, 'hideDefaultAddressType', false);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(this._settings, 'showAddressTypeInViewMode', false);\n\t}\n\n\tsetMultiple(isMultiple)\n\t{\n\t\tthis._isMultiple = !!isMultiple;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet items = Type.isPlainObject(value) ? value : {};\n\t\t\tlet types = Object.keys(items);\n\n\t\t\tlet isSame = (this._addressList.length > 0 && types.length == this._addressList.length);\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\tfor (let addressItem of this._addressList)\n\t\t\t\t{\n\t\t\t\t\tlet type = addressItem.getType();\n\t\t\t\t\tif (!items.hasOwnProperty(type) || items[type] !== addressItem.getValue())\n\t\t\t\t\t{\n\t\t\t\t\t\tisSame = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( // if new value is empty and old value has only one empty element\n\t\t\t\t!isSame &&\n\t\t\t\t!types.length &&\n\t\t\t\tthis._addressList.length === 1 &&\n\t\t\t\t!this._addressList[0].getValue().length\n\t\t\t)\n\t\t\t{\n\t\t\t\tisSame = true;\n\t\t\t}\n\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\treturn false; // update is not required\n\t\t\t}\n\n\t\t\tthis.removeAllAddresses();\n\t\t\tfor (let type of types)\n\t\t\t{\n\t\t\t\tthis.addAddress(type, items[type]);\n\t\t\t}\n\t\t\tif (!types.length)\n\t\t\t{\n\t\t\t\tthis.addAddress(this.getDefaultType(), null);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeAllAddresses();\n\t\t\tlet address = Type.isStringFilled(value) ? value : null;\n\t\t\tthis.addAddress(null, address);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet result = [];\n\t\t\tfor (let addressItem of this._addressList)\n\t\t\t{\n\t\t\t\tlet value = addressItem.getValue();\n\t\t\t\tif (Type.isString(value))\n\t\t\t\t{\n\t\t\t\t\tresult.push({type: addressItem.getType(), value});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._addressList && this._addressList[0] && Type.isString(this._addressList[0].getValue()))\n\t\t\t{\n\t\t\t\treturn this._addressList[0].getValue();\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetTypesList(list)\n\t{\n\t\tthis._typesList = [];\n\t\tif (Type.isPlainObject(list))\n\t\t{\n\t\t\tfor (let id of Object.keys(list))\n\t\t\t{\n\t\t\t\tthis._typesList.push(list[id]);\n\t\t\t}\n\t\t}\n\t\tthis.initAvailableTypes();\n\t}\n\n\tgetTypesList()\n\t{\n\t\tlet types = [];\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet name = BX.prop.getString(item, \"DESCRIPTION\", \"\");\n\n\t\t\ttypes.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn types;\n\t}\n\n\tgetDefaultType()\n\t{\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet isDefault = BX.prop.getString(item, \"IS_DEFAULT\", false);\n\n\t\t\tif (isDefault && this._availableTypesIds.indexOf(value) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tif (this._availableTypesIds.indexOf(value) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tlayout(isEditMode)\n\t{\n\t\tthis._isEditMode = isEditMode;\n\n\t\tthis._wrapper = Tag.render`<div class=\"crm-address-control-wrap ${this._isEditMode ? 'crm-address-control-wrap-edit' : ''}\"></div>`;\n\t\tthis.refreshLayout();\n\n\t\treturn this._wrapper;\n\t}\n\n\trefreshLayout()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tlet addrCounter = true;\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setEditMode(this._isEditMode);\n\t\t\tif (!this._isEditMode && this._showFirstItemOnly && addrCounter > 1)\n\t\t\t{\n\t\t\t\tlet showMore = Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onShowMoreMouseUp.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_ADDRESS_SHOW_ALL')}\n\t\t\t\t\t</span>`;\n\t\t\t\tDom.append(showMore, this._wrapper);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(addressItem.layout(), this._wrapper);\n\t\t\t}\n\t\t\taddrCounter++;\n\t\t}\n\t\tif (this._isEditMode && this._isMultiple && !Type.isNull(this.getDefaultType()))\n\t\t{\n\t\t\tlet crmCompatibilityMode = BX.prop.getBoolean(this._settings, 'crmCompatibilityMode', false);\n\t\t\tlet addButtonWrapClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-block-add-field' : 'ui-entity-widget-content-block-add-field';\n\t\t\tlet addButtonClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-add-field' : 'ui-entity-editor-content-add-lnk';\n\t\t\tDom.append(Tag.render`\n\t\t\t\t<div class=\"${addButtonWrapClass}\"><span class=\"${addButtonClass}\" onclick=\"${this.onAddNewAddress.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_ADD')}</span></div>\n\t\t\t`, this._wrapper);\n\t\t}\n\t}\n\n\trelease()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tthis.removeAllAddresses();\n\t}\n\n\tremoveAllAddresses()\n\t{\n\t\tlet ids = this._addressList.map((item) => item.getId());\n\t\tfor (let id of ids)\n\t\t{\n\t\t\tthis.removeAddress(id);\n\t\t}\n\t}\n\n\taddAddress(type, value = null)\n\t{\n\t\tlet addressItem = new AddressItem(Text.getRandom(8), {\n\t\t\ttypesList: this.getTypesList(),\n\t\t\tavailableTypesIds: [...this._availableTypesIds],\n\t\t\tcanChangeType: this._isMultiple,\n\t\t\tenableAutocomplete: this._enableAutocomplete,\n\t\t\tshowAddressTypeInViewMode: this._isMultiple && this._showAddressTypeInViewMode,\n\t\t\ttype,\n\t\t\tvalue\n\t\t});\n\t\taddressItem.subscribe('onUpdateAddress', this.onUpdateAddress.bind(this));\n\t\taddressItem.subscribe('onUpdateAddressType', this.onUpdateAddressType.bind(this));\n\t\taddressItem.subscribe('onDelete', this.onDeleteAddress.bind(this));\n\t\taddressItem.subscribe('onStartLoadAddress', this.onStartLoadAddress.bind(this));\n\t\taddressItem.subscribe('onAddressLoaded', this.onAddressLoaded.bind(this));\n\t\taddressItem.subscribe('onError', this.onError.bind(this));\n\t\taddressItem.subscribe('onCopyAddress', this.onCopyAddress.bind(this));\n\t\tthis.updateAvailableTypes(type, null);\n\t\tthis._addressList.push(addressItem);\n\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\treturn addressItem;\n\t}\n\n\tremoveAddress(id)\n\t{\n\t\tlet addressItem = this.getAddressById(id);\n\t\tif (addressItem)\n\t\t{\n\t\t\tlet type = addressItem.getType();\n\t\t\tthis._addressList.splice(this._addressList.indexOf(addressItem), 1);\n\t\t\tthis.updateAvailableTypes(null, type);\n\t\t\tthis.updateTypeSelectorVisibility(this._addressList.length > 1);\n\t\t\taddressItem.destroy();\n\t\t}\n\t}\n\n\tgetAddressById(id)\n\t{\n\t\treturn this._addressList\n\t\t\t.filter((item) => item.getId() === id)\n\t\t\t.reduce((prev, item) => prev ? prev : item, null);\n\t}\n\n\tinitAvailableTypes()\n\t{\n\t\tthis._availableTypesIds = [];\n\t\tfor (let type of this._typesList)\n\t\t{\n\t\t\tthis._availableTypesIds.push(BX.prop.getString(type, \"ID\", \"\"));\n\t\t}\n\t}\n\n\tupdateAvailableTypes(removedType, addedType)\n\t{\n\t\tif (!Type.isNull(addedType) && this._availableTypesIds.indexOf(addedType) < 0)\n\t\t{\n\t\t\tthis._availableTypesIds.push(addedType);\n\t\t}\n\t\tif (!Type.isNull(removedType) && this._availableTypesIds.indexOf(removedType) >= 0)\n\t\t{\n\t\t\tthis._availableTypesIds.splice(this._availableTypesIds.indexOf(removedType), 1);\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAvailableTypesIds([...this._availableTypesIds]);\n\t\t}\n\t}\n\n\tupdateTypeSelectorVisibility(showTypeSelector)\n\t{\n\t\tif (!this._hideDefaultAddressType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setTypeSelectorVisibility(showTypeSelector);\n\t\t}\n\t}\n\n\temitUpdateEvent()\n\t{\n\t\tEventEmitter.emit(this, 'onUpdate', {value: this.getValue()});\n\t}\n\n\tonAddNewAddress()\n\t{\n\t\tthis.addAddress(this.getDefaultType());\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddress(event)\n\t{\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonDeleteAddress(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet id = data.id;\n\t\tif (this._addressList.length <= 1)\n\t\t{\n\t\t\t// should be at least one address, so just clear it\n\t\t\tlet addressItem = this.getAddressById(id);\n\t\t\tif (addressItem)\n\t\t\t{\n\t\t\t\taddressItem.clearValue();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.removeAddress(id);\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddressType(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet prevType = data.prevType;\n\t\tlet type = data.type;\n\t\tthis.updateAvailableTypes(type, prevType);\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonShowMoreMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis._showFirstItemOnly = false;\n\t\tthis.refreshLayout();\n\t\treturn false;\n\t}\n\n\tonStartLoadAddress(event)\n\t{\n\t\tEventEmitter.emit(this, 'onStartLoadAddress');\n\t}\n\n\tonAddressLoaded(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressLoaded');\n\t}\n\n\tonError(event)\n\t{\n\t\tEventEmitter.emit(this, 'onError', event);\n\t}\n\n\tonCopyAddress(event)\n\t{\n\t\tconst data = event.getData();\n\t\tlet sourceAddress = this.getAddressById(data.sourceId);\n\t\tif (!sourceAddress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst sourceAddressData = sourceAddress.getValue();\n\t\tif (!(sourceAddressData).length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i=0; i < data.destinationTypes.length; i++)\n\t\t{\n\t\t\tconst type = data.destinationTypes[i];\n\t\t\tlet destinationAddress = this._addressList\n\t\t\t\t.filter((item) => item.getType() == type)\n\t\t\t\t.reduce((prev, cur) => prev ? prev : cur, null);\n\t\t\tif (destinationAddress)\n\t\t\t{\n\t\t\t\tdestinationAddress.setValue(sourceAddressData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdestinationAddress = this.addAddress(type, sourceAddressData);\n\t\t\t}\n\t\t\tdestinationAddress.markAsNew();\n\n\t\t\tthis.refreshLayout();\n\t\t}\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tresetView(): void\n\t{\n\t\tfor (const addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.resetView();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorBaseAddressField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass AddressItem extends EventEmitter\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.AddressItem');\n\n\t\tthis._id = id;\n\t\tthis._value = BX.prop.getString(settings, 'value', \"\");\n\t\tthis._isTypesMenuOpened = false;\n\t\tthis._typesList = BX.prop.getArray(settings, 'typesList', []);\n\t\tthis._availableTypesIds = BX.prop.getArray(settings, 'availableTypesIds', []);\n\t\tthis._canChangeType = BX.prop.getBoolean(settings, 'canChangeType', false);\n\t\tthis.typesMenuId = 'address_type_menu_' + this._id;\n\t\tthis._type = BX.prop.getString(settings, 'type', \"\");\n\t\tthis._isEditMode = true;\n\t\tthis._isTypeSelectorVisible = BX.prop.getBoolean(settings, 'isTypeSelectorVisible', true);\n\t\tthis._isAutocompleteEnabled = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._showAddressTypeInViewMode = BX.prop.getBoolean(settings, 'showAddressTypeInViewMode', true);\n\t\tthis._showDetails = !this._isAutocompleteEnabled || BX.prop.getBoolean(settings, 'showDetails', false);\n\t\tthis._isLoading = false;\n\t\tthis._isDropdownLoading = false;\n\t\tthis._addressWidget = null;\n\t\tthis._wrapper = null;\n\t\tthis._domNodes = {};\n\t\tthis._selectedCopyDestinations = [];\n\n\t\tthis._isLocationModuleInstalled =\n\t\t\t!Type.isUndefined(BX.Location) &&\n\t\t\t!Type.isUndefined(BX.Location.Core)&&\n\t\t\t!Type.isUndefined(BX.Location.Widget);\n\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tinitializeAddressWidget()\n\t{\n\t\tif (!this._isLocationModuleInstalled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = this.getValue();\n\n\t\tlet address = null;\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new BX.Location.Core.Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t}\n\t\t}\n\n\t\tlet widgetFactory = new BX.Location.Widget.Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view,\n\t\t\tpopupBindOptions: {position: 'right'}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));\n\t\tthis._addressWidget.subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.onError.bind(this));\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this._value;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.destroy();\n\t\tthis._value = value;\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tmarkAsNew()\n\t{\n\t\tlet address = this.getAddress();\n\t\tif (address)\n\t\t{\n\t\t\taddress.id = 0;\n\t\t\taddress.clearLinks();\n\t\t}\n\t\tthis._value = address ? address.toJson() : '';\n\t}\n\n\tsetEditMode(isEditMode)\n\t{\n\t\tthis._isEditMode = !!isEditMode;\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.mode = isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view;\n\t\t}\n\t}\n\n\tsetAvailableTypesIds(ids)\n\t{\n\t\tthis._availableTypesIds = ids;\n\t}\n\n\tlayout()\n\t{\n\t\tif (Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._wrapper = Tag.render`<div>Location module is not installed</div>`;\n\t\t\treturn this._wrapper;\n\t\t}\n\t\tlet addressWidgetParams = {};\n\t\tconst addressString = this.convertAddressToString(this.getAddress());\n\t\tif (this._isEditMode)\n\t\t{\n\t\t\tthis._wrapper = this.getEditHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.edit;\n\t\t\taddressWidgetParams.inputNode = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.mapBindElement = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.fieldsContainer = this._domNodes.detailsContainer;\n\t\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._wrapper = this.getViewHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.view;\n\t\t\taddressWidgetParams.mapBindElement = this._wrapper;\n\t\t}\n\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\treturn this._wrapper;\n\t}\n\n\topenTypesMenu(bindElement)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = [];\n\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet selected = (item.value === this._type);\n\t\t\tif (this._availableTypesIds.indexOf(item.value) < 0 && !selected)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\t//className: selected ? \"menu-popup-item-accept\" : \"menu-popup-item-none\",\n\t\t\t\t\tonclick: this.onChangeType.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.typesMenuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tlet createdMenu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (createdMenu && Type.isDomNode(this._domNodes.addressTypeSelector)\n\t\t\t&& this._domNodes.addressTypeSelector.offsetWidth > 200)\n\t\t{\n\t\t\tcreatedMenu.getPopupWindow().setWidth(this._domNodes.addressTypeSelector.offsetWidth);\n\t\t}\n\t};\n\n\tcloseTypesMenu()\n\t{\n\t\tlet menu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tsetTypeSelectorVisibility(visible)\n\t{\n\t\tthis._isTypeSelectorVisible = !!visible;\n\t}\n\n\tgetEditHtml(addressString)\n\t{\n\t\tthis._domNodes.typeName = Tag.render`<div class=\"ui-ctl-element\"></div>`;\n\t\tthis._domNodes.searchInput = Tag.render`\n\t\t\t<input type=\"text\" class=\"ui-ctl-element ui-ctl-textbox\" value=\"${addressString}\" ${this._isAutocompleteEnabled ? '' : 'readonly'}>`;\n\t\tthis._domNodes.icon = Tag.render`<span></span>`;\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t<div class=\"crm-address-search-control-block\">\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t${this._domNodes.icon}\n\t\t\t\t${this._domNodes.searchInput}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis._domNodes.detailsContainer = Tag.render`\n\t\t\t<div class=\"location-fields-control-block\"></div>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tif (this._isTypeSelectorVisible)\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-inline ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w25\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\t\t\t\tthis._domNodes.addressTypeContainer = null;\n\n\t\t\t\tDom.addClass(this._domNodes.addressContainer, ['ui-ctl-inline', 'ui-ctl-w75']);\n\t\t\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl-inline ui-ctl-w100\">\n\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t${this._domNodes.typeName}\n\t\t\t\t\t</div>`;\n\n\t\t\t\tthis._domNodes.addressTypeContainer = Tag.render`\n\t\t\t\t\t<div class=\"location-fields-control-block crm-address-type-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${Loc.getMessage('CRM_ADDRESS_TYPE')}</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t}\n\t\t\tthis.refreshTypeName();\n\t\t}\n\n\t\tthis.refreshIcon();\n\n\t\tthis._domNodes.detailsToggler =\n\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onToggleDetailsVisibility.bind(this)}\"></span>`;\n\n\t\tthis._domNodes.copyButton =\n\t\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onCopyButtonClick.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_COPY1')}</span>`;\n\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.setDetailsVisibility(this._showDetails);\n\n\t\tlet result = Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t<div class=\"crm-address-control-mode-switch\">\n\t\t\t\t\t${this._domNodes.copyButton ? this._domNodes.copyButton : ''}\n\t\t\t\t\t${this._domNodes.detailsToggler}\n\t\t\t\t</div>\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t${this._domNodes.detailsContainer}\n\t\t\t</div>`;\n\n\t\tif (this._canChangeType && Type.isDomNode(this._domNodes.addressTypeContainer))\n\t\t{\n\t\t\tDom.append(this._domNodes.addressTypeContainer, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetViewHtml(addressString)\n\t{\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>\n\t\t\t</div>`;\n\n\t\tlet addressType = '';\n\t\tif (this._showAddressTypeInViewMode)\n\t\t{\n\t\t\tlet typeName = this._typesList\n\t\t\t\t.filter((item) => item.value == this._type)\n\t\t\t\t.map((item) => item.name)\n\t\t\t\t.join('')\n\n\t\t\taddressType = Tag.render`<span class=\"ui-link ui-link-secondary\">${Text.encode(typeName)}:</span>`\n\t\t}\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t${addressType}\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t</div>`;\n\t}\n\n\trefreshTypeName()\n\t{\n\t\tif (Type.isDomNode(this._domNodes.typeName))\n\t\t{\n\t\t\tlet typeName =\n\t\t\t\tthis._typesList\n\t\t\t\t\t.filter((item) => item.value === this._type)\n\t\t\t\t\t.map((item) => item.name)\n\t\t\t\t\t.join('');\n\n\t\t\tthis._domNodes.typeName.textContent = typeName;\n\t\t\tthis._domNodes.typeName.title = typeName;\n\t\t}\n\t}\n\n\trefreshIcon()\n\t{\n\t\tlet node = this._domNodes.icon;\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tlet newNode;\n\t\t\tif (this._isLoading)\n\t\t\t{\n\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ui-ctl-icon-loader\"></span>`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet address = this.getAddress();\n\t\t\t\tif (address)\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onDelete.bind(this)}\"></button>`;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ${this._isAutocompleteEnabled ? 'ui-ctl-icon-search' : ''}\"></span>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDom.replace(node, newNode);\n\t\t\tthis._domNodes.icon = newNode;\n\t\t}\n\t}\n\n\tgetIconState()\n\t{\n\t\tlet isAddressSet = !!this.getAddress();\n\n\t\treturn this._isLoading.toString() + isAddressSet.toString();\n\t}\n\n\trefreshCopyButtonVisibility()\n\t{\n\t\tlet node = this._domNodes.copyButton;\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tlet isVisible = !!this.getAddress();\n\t\t\tif (isVisible)\n\t\t\t{\n\n\t\t\t}\n\t\t\tDom.style(node, 'display', isVisible ? '' : 'none');\n\t\t}\n\t}\n\n\tconvertAddressToString(address)\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.getAddressFormat());\n\t}\n\n\tgetAddress()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.address;\n\t}\n\n\tgetAddressFormat()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.addressFormat;\n\t}\n\n\tclearValue()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.resetView();\n\t\t\tthis._addressWidget.address = null;\n\t\t}\n\t\tif (Type.isDomNode(this._domNodes.searchInput))\n\t\t{\n\t\t\tthis._domNodes.searchInput.value = '';\n\t\t}\n\t\tthis._value = \"\";\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\t}\n\n\tsetDetailsVisibility(visible)\n\t{\n\t\tthis._showDetails = !!visible;\n\t\tif (this._showDetails)\n\t\t{\n\t\t\tDom.addClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_SHORT');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.addClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_DETAILED');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.removeClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t}\n\n\tshowCopyDestinationPopup()\n\t{\n\t\tlet popup = PopupManager.create({\n\t\t\tid: this._id + '_copy_dst_popup',\n\t\t\tcacheable: false,\n\t\t\tautoHide: true,\n\t\t\ttitleBar: Loc.getMessage('CRM_ADDRESS_COPY_TITLE'),\n\t\t\tcontent: this.getCopyDestinationLayout(),\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tid: 'copy',\n\t\t\t\t\ttext: Loc.getMessage('CRM_ADDRESS_COPY2'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tstate: BX.UI.ButtonState.DISABLED,\n\t\t\t\t\tonclick:(button) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t\tthis.emit('onCopyAddress', {\n\t\t\t\t\t\t\tsourceId: this.getId(),\n\t\t\t\t\t\t\tdestinationTypes: this._selectedCopyDestinations});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\tgetCopyDestinationLayout()\n\t{\n\t\tlet types = this._typesList.filter((item) => item.value != this._type);\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"ui-title-7\">${Loc.getMessage('CRM_ADDRESS_COPY_TO')}</div>\n\t\t\t\t<div>\n\t\t\t\t\t${types.map((item) => Tag.render`\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<input onclick=\"${this.onChangeCopyDestination.bind(this)}\" type=\"checkbox\" value=\"${item.value}\">\n\t\t\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">${Text.encode(item.name)}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.destroy();\n\t\t}\n\t}\n\n\tonToggleDetailsVisibility()\n\t{\n\t\tthis.setDetailsVisibility(!this._showDetails);\n\t}\n\n\tonDelete()\n\t{\n\t\tthis.clearValue();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonCopyButtonClick()\n\t{\n\t\tthis.showCopyDestinationPopup()\n\t}\n\n\tonChangeCopyDestination(e)\n\t{\n\t\tlet input = e.target;\n\t\tlet value = input ? input.value : null;\n\t\tlet isChecked = input ? input.checked : false;\n\t\tif (isChecked && this._selectedCopyDestinations.indexOf(value) < 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.push(value);\n\t\t}\n\t\tif (!isChecked && this._selectedCopyDestinations.indexOf(value) >= 0)\n\t\t{\n\t\t\tthis._selectedCopyDestinations.splice(this._selectedCopyDestinations.indexOf(value), 1);\n\t\t}\n\t\tlet popup = PopupManager.getPopupById(this._id + '_copy_dst_popup');\n\t\tif (popup)\n\t\t{\n\t\t\tlet button = popup.getButton('copy');\n\t\t\tif (button)\n\t\t\t{\n\t\t\t\tbutton.setDisabled(!this._selectedCopyDestinations.length);\n\t\t\t}\n\t\t}\n\t}\n\n\tonToggleTypesMenu(event)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\tthis.closeTypesMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTypesMenu(event.target);\n\t\t}\n\t}\n\n\tonChangeType(e, item)\n\t{\n\t\tthis.closeTypesMenu();\n\t\tif (this._type !== item.value)\n\t\t{\n\t\t\tlet prevType = this._type;\n\t\t\tthis._type = item.value;\n\t\t\tthis.refreshTypeName();\n\t\t\tthis.emit('onUpdateAddressType', {id: this.getId(), type: this.getType(), prevType});\n\t\t}\n\t}\n\n\tonAddressWidgetChangedState(event)\n\t{\n\t\tlet data = event.getData(),\n\t\t\tstate = data.state;\n\n\t\tlet wasLoading = this._isLoading;\n\n\t\tthis.computeIsLoading();\n\n\t\tif (wasLoading !== this._isLoading)\n\t\t{\n\t\t\tthis.refreshIcon();\n\t\t\tthis.refreshCopyButtonVisibility();\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADING)\n\t\t{\n\t\t\tthis.emit('onStartLoadAddress', {id: this.getId()});\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADED)\n\t\t{\n\t\t\tthis.emit('onAddressLoaded', {id: this.getId()});\n\t\t}\n\t}\n\n\tonAddressChanged(event)\n\t{\n\t\tlet oldIconState = this.getIconState();\n\n\t\tthis._isLoading = false;\n\n\t\tlet data = event.getData();\n\t\tthis._value = Type.isObject(data.address) ? data.address.toJson() : '';\n\n\t\tif (oldIconState !== this.getIconState())\n\t\t{\n\t\t\tthis.refreshIcon();\n\t\t}\n\n\t\tthis.refreshCopyButtonVisibility();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonFeatureEvent(event)\n\t{\n\t\tlet data = event.getData();\n\n\t\tif (data.feature instanceof BX.Location.Widget.AutocompleteFeature)\n\t\t{\n\t\t\tthis._isDropdownLoading = (data.eventCode === BX.Location.Widget.AutocompleteFeature.searchStartedEvent);\n\n\t\t\tlet wasLoading = this._isLoading;\n\n\t\t\tthis.computeIsLoading();\n\n\t\t\tif (wasLoading !== this._isLoading)\n\t\t\t{\n\t\t\t\tthis.refreshIcon();\n\t\t\t\tthis.refreshCopyButtonVisibility();\n\t\t\t}\n\t\t}\n\t}\n\n\tonError(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\t\tlet errorMessage = errors\n\t\t\t.map((error) => error.message + (error.code.length ? `${error.code}` : ''))\n\t\t\t.join(', ');\n\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t\tthis.refreshCopyButtonVisibility();\n\n\t\tthis.emit('onError', {id: this.getId(), error: errorMessage});\n\t}\n\n\tcomputeIsLoading()\n\t{\n\t\tthis._isLoading = (this._addressWidget.state === BX.Location.Widget.State.DATA_LOADING\n\t\t\t|| this._isDropdownLoading\n\t\t);\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis._addressWidget.resetView();\n\t}\n}\n"],"names":["EntityEditorBaseAddressField","id","settings","_id","BX","type","isNotEmptyString","util","getRandomString","_isMultiple","_settings","_typesList","_availableTypesIds","_addressList","_wrapper","_isEditMode","_showFirstItemOnly","prop","getBoolean","_enableAutocomplete","_hideDefaultAddressType","_showAddressTypeInViewMode","isMultiple","value","items","Type","isPlainObject","types","Object","keys","isSame","length","addressItem","getType","hasOwnProperty","getValue","removeAllAddresses","addAddress","getDefaultType","address","isStringFilled","result","isString","push","list","initAvailableTypes","item","getString","name","isDefault","indexOf","isEditMode","Tag","render","refreshLayout","Dom","clean","addrCounter","setEditMode","showMore","onShowMoreMouseUp","bind","Loc","getMessage","append","layout","isNull","crmCompatibilityMode","addButtonWrapClass","addButtonClass","onAddNewAddress","ids","map","getId","removeAddress","AddressItem","Text","getRandom","typesList","getTypesList","availableTypesIds","canChangeType","enableAutocomplete","showAddressTypeInViewMode","subscribe","onUpdateAddress","onUpdateAddressType","onDeleteAddress","onStartLoadAddress","onAddressLoaded","onError","onCopyAddress","updateAvailableTypes","updateTypeSelectorVisibility","getAddressById","splice","destroy","filter","reduce","prev","removedType","addedType","setAvailableTypesIds","showTypeSelector","setTypeSelectorVisibility","EventEmitter","emit","event","emitUpdateEvent","data","getData","clearValue","prevType","stopPropagation","sourceAddress","sourceId","sourceAddressData","i","destinationTypes","destinationAddress","cur","setValue","markAsNew","resetView","self","initialize","setEventNamespace","_value","_isTypesMenuOpened","getArray","_canChangeType","typesMenuId","_type","_isTypeSelectorVisible","_isAutocompleteEnabled","_showDetails","_isLoading","_isDropdownLoading","_addressWidget","_domNodes","_selectedCopyDestinations","_isLocationModuleInstalled","isUndefined","Location","Core","Widget","initializeAddressWidget","Address","JSON","parse","e","widgetFactory","Factory","createAddressWidget","mode","ControlMode","edit","view","popupBindOptions","position","subscribeOnStateChangedEvent","onAddressWidgetChangedState","subscribeOnAddressChangedEvent","onAddressChanged","subscribeOnFeatureEvent","onFeatureEvent","subscribeOnErrorEvent","getAddress","clearLinks","toJson","addressWidgetParams","addressString","convertAddressToString","getEditHtml","inputNode","searchInput","mapBindElement","fieldsContainer","detailsContainer","controlWrapper","addressContainer","getViewHtml","bindElement","menu","selected","text","onclick","onChangeType","MenuManager","show","angle","cacheable","events","onPopupShow","onPopupClose","createdMenu","getMenuById","isDomNode","addressTypeSelector","offsetWidth","getPopupWindow","setWidth","close","visible","typeName","icon","onToggleTypesMenu","addressTypeContainer","addClass","refreshTypeName","refreshIcon","detailsToggler","onToggleDetailsVisibility","copyButton","onCopyButtonClick","refreshCopyButtonVisibility","setDetailsVisibility","addressType","join","encode","textContent","title","node","newNode","onDelete","replace","isAddressSet","toString","isVisible","style","getAddressFormat","addressFormat","removeClass","popup","PopupManager","create","autoHide","titleBar","content","getCopyDestinationLayout","closeIcon","closeByEsc","buttons","UI","Button","color","Color","PRIMARY","state","ButtonState","DISABLED","button","getContext","onChangeCopyDestination","showCopyDestinationPopup","input","target","isChecked","checked","getPopupById","getButton","setDisabled","closeTypesMenu","openTypesMenu","wasLoading","computeIsLoading","State","DATA_LOADING","DATA_LOADED","oldIconState","getIconState","isObject","feature","AutocompleteFeature","eventCode","searchStartedEvent","errors","errorMessage","error","message","code"],"mappings":"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"}