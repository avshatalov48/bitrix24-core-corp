{"version":3,"file":"address.bundle.js","sources":["../src/address.js"],"sourcesContent":["import {Text, Tag, Dom, Type, Loc} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport \"./address.css\"\nimport {MenuManager} from \"main.popup\";\n\nexport class EntityEditorBaseAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._isMultiple = false;\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._typesList = [];\n\t\tthis._availableTypesIds = [];\n\t\tthis._addressList = [];\n\t\tthis._wrapper = null;\n\t\tthis._isEditMode = true;\n\t\tthis._showFirstItemOnly = BX.prop.getBoolean(settings, 'showFirstItemOnly', false);\n\t\tthis._enableAutocomplete = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t}\n\n\tsetMultiple(isMultiple)\n\t{\n\t\tthis._isMultiple = !!isMultiple;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet items = Type.isPlainObject(value) ? value : {};\n\t\t\tlet types = Object.keys(items);\n\n\t\t\tlet isSame = (this._addressList.length > 0 && types.length == this._addressList.length);\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\tfor (let addressItem of this._addressList)\n\t\t\t\t{\n\t\t\t\t\tlet type = addressItem.getType();\n\t\t\t\t\tif (!items.hasOwnProperty(type) || items[type] !== addressItem.getValue())\n\t\t\t\t\t{\n\t\t\t\t\t\tisSame = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( // if new value is empty and old value has only one empty element\n\t\t\t\t!isSame &&\n\t\t\t\t!types.length &&\n\t\t\t\tthis._addressList.length === 1 &&\n\t\t\t\t!this._addressList[0].getValue().length\n\t\t\t)\n\t\t\t{\n\t\t\t\tisSame = true;\n\t\t\t}\n\n\t\t\tif (isSame)\n\t\t\t{\n\t\t\t\treturn false; // update is not required\n\t\t\t}\n\n\t\t\tthis.removeAllAddresses();\n\t\t\tfor (let type of types)\n\t\t\t{\n\t\t\t\tthis.addAddress(type, items[type]);\n\t\t\t}\n\t\t\tif (!types.length)\n\t\t\t{\n\t\t\t\tthis.addAddress(this.getDefaultType(), null);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeAllAddresses();\n\t\t\tlet address = Type.isStringFilled(value) ? value : null;\n\t\t\tthis.addAddress(null, address);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this._isMultiple)\n\t\t{\n\t\t\tlet result = [];\n\t\t\tfor (let addressItem of this._addressList)\n\t\t\t{\n\t\t\t\tlet value = addressItem.getValue();\n\t\t\t\tif (Type.isString(value))\n\t\t\t\t{\n\t\t\t\t\tresult.push({type: addressItem.getType(), value});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._addressList && this._addressList[0] && Type.isString(this._addressList[0].getValue()))\n\t\t\t{\n\t\t\t\treturn this._addressList[0].getValue();\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetTypesList(list)\n\t{\n\t\tthis._typesList = [];\n\t\tif (Type.isPlainObject(list))\n\t\t{\n\t\t\tfor (let id of Object.keys(list))\n\t\t\t{\n\t\t\t\tthis._typesList.push(list[id]);\n\t\t\t}\n\t\t}\n\t\tthis.initAvailableTypes();\n\t}\n\n\tgetTypesList()\n\t{\n\t\tlet types = [];\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet name = BX.prop.getString(item, \"DESCRIPTION\", \"\");\n\n\t\t\ttypes.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn types;\n\t}\n\n\tgetDefaultType()\n\t{\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tlet isDefault = BX.prop.getString(item, \"IS_DEFAULT\", false);\n\n\t\t\tif (isDefault && this._availableTypesIds.indexOf(value) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"ID\", \"\");\n\t\t\tif (this._availableTypesIds.indexOf(value) >= 0)\n\t\t\t{\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tlayout(isEditMode)\n\t{\n\t\tthis._isEditMode = isEditMode;\n\n\t\tthis._wrapper = Tag.render`<div class=\"crm-address-control-wrap ${this._isEditMode ? 'crm-address-control-wrap-edit' : ''}\"></div>`;\n\t\tthis.refreshLayout();\n\n\t\treturn this._wrapper;\n\t}\n\n\trefreshLayout()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tlet addrCounter = true;\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setEditMode(this._isEditMode);\n\t\t\tif (!this._isEditMode && this._showFirstItemOnly && addrCounter > 1)\n\t\t\t{\n\t\t\t\tlet showMore = Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onShowMoreMouseUp.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_ADDRESS_SHOW_ALL')}\n\t\t\t\t\t</span>`;\n\t\t\t\tDom.append(showMore, this._wrapper);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(addressItem.layout(), this._wrapper);\n\t\t\t}\n\t\t\taddrCounter++;\n\t\t}\n\t\tif (this._isEditMode && this._isMultiple && !Type.isNull(this.getDefaultType()))\n\t\t{\n\t\t\tlet crmCompatibilityMode = BX.prop.getBoolean(this._settings, 'crmCompatibilityMode', false);\n\t\t\tlet addButtonWrapClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-block-add-field' : 'ui-entity-widget-content-block-add-field';\n\t\t\tlet addButtonClass = crmCompatibilityMode ?\n\t\t\t\t'crm-entity-widget-content-add-field' : 'ui-entity-editor-content-add-lnk';\n\t\t\tDom.append(Tag.render`\n\t\t\t\t<div class=\"${addButtonWrapClass}\"><span class=\"${addButtonClass}\" onclick=\"${this.onAddNewAddress.bind(this)}\">${Loc.getMessage('CRM_ADDRESS_ADD')}</span></div>\n\t\t\t`, this._wrapper);\n\t\t}\n\t}\n\n\trelease()\n\t{\n\t\tDom.clean(this._wrapper);\n\t\tthis.removeAllAddresses();\n\t}\n\n\tremoveAllAddresses()\n\t{\n\t\tlet ids = this._addressList.map((item) => item.getId());\n\t\tfor (let id of ids)\n\t\t{\n\t\t\tthis.removeAddress(id);\n\t\t}\n\t}\n\n\taddAddress(type, value = null)\n\t{\n\t\tlet addressItem = new AddressItem(Text.getRandom(8), {\n\t\t\ttypesList: this.getTypesList(),\n\t\t\tavailableTypesIds: [...this._availableTypesIds],\n\t\t\tcanChangeType: this._isMultiple,\n\t\t\tenableAutocomplete: this._enableAutocomplete,\n\t\t\ttype,\n\t\t\tvalue\n\t\t});\n\t\taddressItem.subscribe('onUpdateAddress', this.onUpdateAddress.bind(this));\n\t\taddressItem.subscribe('onUpdateAddressType', this.onUpdateAddressType.bind(this));\n\t\taddressItem.subscribe('onDelete', this.onDeleteAddress.bind(this));\n\t\taddressItem.subscribe('onStartLoadAddress', this.onStartLoadAddress.bind(this));\n\t\taddressItem.subscribe('onAddressLoaded', this.onAddressLoaded.bind(this));\n\t\taddressItem.subscribe('onError', this.onError.bind(this));\n\t\tthis.updateAvailableTypes(type, null);\n\t\tthis._addressList.push(addressItem);\n\t}\n\n\tremoveAddress(id)\n\t{\n\t\tlet addressItem = this.getAddressById(id);\n\t\tif (addressItem)\n\t\t{\n\t\t\tlet type = addressItem.getType();\n\t\t\tthis._addressList.splice(this._addressList.indexOf(addressItem), 1);\n\t\t\tthis.updateAvailableTypes(null, type);\n\t\t\taddressItem.destroy();\n\t\t}\n\t}\n\n\tgetAddressById(id)\n\t{\n\t\treturn this._addressList\n\t\t\t.filter((item) => item.getId() === id)\n\t\t\t.reduce((prev, item) => prev ? prev : item, null);\n\t}\n\n\tinitAvailableTypes()\n\t{\n\t\tthis._availableTypesIds = [];\n\t\tfor (let type of this._typesList)\n\t\t{\n\t\t\tthis._availableTypesIds.push(BX.prop.getString(type, \"ID\", \"\"));\n\t\t}\n\t}\n\n\tupdateAvailableTypes(removedType, addedType)\n\t{\n\t\tif (!Type.isNull(addedType) && this._availableTypesIds.indexOf(addedType) < 0)\n\t\t{\n\t\t\tthis._availableTypesIds.push(addedType);\n\t\t}\n\t\tif (!Type.isNull(removedType) && this._availableTypesIds.indexOf(removedType) >= 0)\n\t\t{\n\t\t\tthis._availableTypesIds.splice(this._availableTypesIds.indexOf(removedType), 1);\n\t\t}\n\t\tfor (let addressItem of this._addressList)\n\t\t{\n\t\t\taddressItem.setAvailableTypesIds([...this._availableTypesIds]);\n\t\t}\n\t}\n\n\temitUpdateEvent()\n\t{\n\t\tEventEmitter.emit(this, 'onUpdate', {value: this.getValue()});\n\t}\n\n\tonAddNewAddress()\n\t{\n\t\tthis.addAddress(this.getDefaultType());\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddress(event)\n\t{\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonDeleteAddress(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet id = data.id;\n\t\tif (this._addressList.length <= 1)\n\t\t{\n\t\t\t// should be at least one address, so just clear it\n\t\t\tlet addressItem = this.getAddressById(id);\n\t\t\tif (addressItem)\n\t\t\t{\n\t\t\t\taddressItem.clearValue();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.removeAddress(id);\n\t\tthis.refreshLayout();\n\t}\n\n\tonUpdateAddressType(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet prevType = data.prevType;\n\t\tlet type = data.type;\n\t\tthis.updateAvailableTypes(type, prevType);\n\t\tthis.emitUpdateEvent();\n\t}\n\n\tonShowMoreMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis._showFirstItemOnly = false;\n\t\tthis.refreshLayout();\n\t\treturn false;\n\t}\n\n\tonStartLoadAddress(event)\n\t{\n\t\tEventEmitter.emit(this, 'onStartLoadAddress');\n\t}\n\n\tonAddressLoaded(event)\n\t{\n\t\tEventEmitter.emit(this, 'onAddressLoaded');\n\t}\n\n\tonError(event)\n\t{\n\t\tEventEmitter.emit(this, 'onError', event);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorBaseAddressField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass AddressItem extends EventEmitter\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.AddressItem');\n\n\t\tthis._id = id;\n\t\tthis._value = BX.prop.getString(settings, 'value', \"\");\n\t\tthis._isTypesMenuOpened = false;\n\t\tthis._typesList = BX.prop.getArray(settings, 'typesList', []);\n\t\tthis._availableTypesIds = BX.prop.getArray(settings, 'availableTypesIds', []);\n\t\tthis._canChangeType = BX.prop.getBoolean(settings, 'canChangeType', false);\n\t\tthis.typesMenuId = 'address_type_menu_' + this._id;\n\t\tthis._type = BX.prop.getString(settings, 'type', \"\");\n\t\tthis._isEditMode = true;\n\t\tthis._isAutocompleteEnabled = BX.prop.getBoolean(settings, 'enableAutocomplete', true);\n\t\tthis._showDetails = !this._isAutocompleteEnabled || BX.prop.getBoolean(settings, 'showDetails', false);\n\t\tthis._isLoading = false;\n\t\tthis._addressWidget = null;\n\t\tthis._wrapper = null;\n\t\tthis._domNodes = {};\n\n\t\tthis._isLocationModuleInstalled =\n\t\t\t!Type.isUndefined(BX.Location) &&\n\t\t\t!Type.isUndefined(BX.Location.Core)&&\n\t\t\t!Type.isUndefined(BX.Location.Widget);\n\n\t\tthis.initializeAddressWidget();\n\t}\n\n\tinitializeAddressWidget()\n\t{\n\t\tif (!this._isLocationModuleInstalled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = this.getValue();\n\n\t\tlet address = null;\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new BX.Location.Core.Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t}\n\t\t}\n\n\t\tlet widgetFactory = new BX.Location.Widget.Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view,\n\t\t\tpopupBindOptions: {position: 'right'}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.onError.bind(this));\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this._value;\n\t}\n\n\tsetEditMode(isEditMode)\n\t{\n\t\tthis._isEditMode = !!isEditMode;\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.mode = isEditMode ? BX.Location.Core.ControlMode.edit : BX.Location.Core.ControlMode.view;\n\t\t}\n\t}\n\n\tsetAvailableTypesIds(ids)\n\t{\n\t\tthis._availableTypesIds = ids;\n\t}\n\n\tlayout()\n\t{\n\t\tif (Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._wrapper = Tag.render`<div>Location module is not installed</div>`;\n\t\t\treturn this._wrapper;\n\t\t}\n\t\tlet addressWidgetParams = {};\n\t\tconst addressString = this.convertAddressToString(this.getAddress());\n\t\tif (this._isEditMode)\n\t\t{\n\t\t\tthis._wrapper = this.getEditHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.edit;\n\t\t\taddressWidgetParams.inputNode = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.mapBindElement = this._domNodes.searchInput;\n\t\t\taddressWidgetParams.fieldsContainer = this._domNodes.detailsContainer;\n\t\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._wrapper = this.getViewHtml(addressString);\n\t\t\taddressWidgetParams.mode = BX.Location.Core.ControlMode.view;\n\t\t\taddressWidgetParams.mapBindElement = this._wrapper;\n\t\t}\n\t\taddressWidgetParams.controlWrapper = this._domNodes.addressContainer;\n\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\treturn this._wrapper;\n\t}\n\n\topenTypesMenu(bindElement)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = [];\n\n\t\tfor (let item of this._typesList)\n\t\t{\n\t\t\tlet selected = (item.value === this._type);\n\t\t\tif (this._availableTypesIds.indexOf(item.value) < 0 && !selected)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\t//className: selected ? \"menu-popup-item-accept\" : \"menu-popup-item-none\",\n\t\t\t\t\tonclick: this.onChangeType.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.typesMenuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isTypesMenuOpened = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tlet createdMenu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (createdMenu && Type.isDomNode(this._domNodes.addressTypeSelector))\n\t\t{\n\t\t\tcreatedMenu.getPopupWindow().setWidth(this._domNodes.addressTypeSelector.offsetWidth);\n\t\t}\n\t};\n\n\tcloseTypesMenu()\n\t{\n\t\tlet menu = MenuManager.getMenuById(this.typesMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tgetEditHtml(addressString)\n\t{\n\t\tthis._domNodes.typeName = Tag.render`<div class=\"ui-ctl-element\"></div>`;\n\t\tthis._domNodes.searchInput = Tag.render`\n\t\t\t<input type=\"text\" class=\"ui-ctl-element ui-ctl-textbox\" value=\"${addressString}\" ${this._isAutocompleteEnabled ? '' : 'readonly'}>`;\n\t\tthis._domNodes.icon = Tag.render`<span></span>`;\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t<div class=\"crm-address-search-control-block\">\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t${this._domNodes.icon}\n\t\t\t\t${this._domNodes.searchInput}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tthis._domNodes.detailsContainer = Tag.render`\n\t\t\t<div class=\"location-fields-control-block\"></div>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tthis._domNodes.addressTypeSelector = Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\" onclick=\"${this.onToggleTypesMenu.bind(this)}\">\n\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t${this._domNodes.typeName}\n\t\t\t</div>`;\n\n\t\t\tthis._domNodes.addressTypeContainer = Tag.render`\n\t\t\t<div class=\"location-fields-control-block crm-address-type-block\">\n\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${Loc.getMessage('CRM_ADDRESS_TYPE')}</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this._domNodes.addressTypeSelector}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t\tthis.refreshTypeName();\n\t\t}\n\n\t\tthis.refreshIcon();\n\n\t\tthis._domNodes.detailsToggler =\n\t\t\tTag.render`<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\" onclick=\"${this.onToggleDetailsVisibility.bind(this)}\"></span>`;\n\n\t\tthis.setDetailsVisibility(this._showDetails);\n\n\t\tlet result = Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t<div class=\"crm-address-control-mode-switch\">\n\t\t\t\t\t${this._domNodes.detailsToggler}\n\t\t\t\t</div>\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t\t${this._domNodes.detailsContainer}\n\t\t\t</div>`;\n\n\t\tif (this._canChangeType)\n\t\t{\n\t\t\tDom.append(this._domNodes.addressTypeContainer, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetViewHtml(addressString)\n\t{\n\t\tthis._domNodes.addressContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>\n\t\t\t</div>`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-address-control-item\">\n\t\t\t\t${this._domNodes.addressContainer}\n\t\t\t</div>`;\n\t}\n\n\trefreshTypeName()\n\t{\n\t\tif (Type.isDomNode(this._domNodes.typeName))\n\t\t{\n\t\t\tthis._domNodes.typeName.textContent =\n\t\t\t\tthis._typesList\n\t\t\t\t\t.filter((item) => item.value === this._type)\n\t\t\t\t\t.map((item) => item.name)\n\t\t\t\t\t.join('');\n\t\t}\n\t}\n\n\trefreshIcon()\n\t{\n\t\tlet node = this._domNodes.icon;\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tlet newNode;\n\t\t\tif (this._isLoading)\n\t\t\t{\n\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ui-ctl-icon-loader\"></span>`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet address = this.getAddress();\n\t\t\t\tif (address)\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onDelete.bind(this)}\"></button>`;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewNode = Tag.render`<span class=\"ui-ctl-after ${this._isAutocompleteEnabled ? 'ui-ctl-icon-search' : ''}\"></span>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDom.replace(node, newNode);\n\t\t\tthis._domNodes.icon = newNode;\n\t\t}\n\t}\n\n\tconvertAddressToString(address)\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this.getAddressFormat());\n\t}\n\n\tgetAddress()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.address;\n\t}\n\n\tgetAddressFormat()\n\t{\n\t\treturn Type.isNull(this._addressWidget) ? null : this._addressWidget.addressFormat;\n\t}\n\n\tclearValue()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.resetView();\n\t\t\tthis._addressWidget.address = null;\n\t\t}\n\t\tif (Type.isDomNode(this._domNodes.searchInput))\n\t\t{\n\t\t\tthis._domNodes.searchInput.value = '';\n\t\t}\n\t\tthis._value = \"\";\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\t}\n\n\tsetDetailsVisibility(visible)\n\t{\n\t\tthis._showDetails = !!visible;\n\t\tif (this._showDetails)\n\t\t{\n\t\t\tDom.addClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_SHORT');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.addClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this._domNodes.detailsContainer, 'visible');\n\t\t\tif (Type.isDomNode(this._domNodes.detailsToggler))\n\t\t\t{\n\t\t\t\tthis._domNodes.detailsToggler.textContent = Loc.getMessage('CRM_ADDRESS_MODE_DETAILED');\n\t\t\t}\n\t\t\tif (this._canChangeType)\n\t\t\t{\n\t\t\t\tDom.removeClass(this._domNodes.addressTypeContainer, 'visible');\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (!Type.isNull(this._addressWidget))\n\t\t{\n\t\t\tthis._addressWidget.destroy();\n\t\t}\n\t}\n\n\tonToggleDetailsVisibility()\n\t{\n\t\tthis.setDetailsVisibility(!this._showDetails);\n\t}\n\n\tonDelete()\n\t{\n\t\tthis.clearValue();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonToggleTypesMenu(event)\n\t{\n\t\tif (this._isTypesMenuOpened)\n\t\t{\n\t\t\tthis.closeTypesMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTypesMenu(event.target);\n\t\t}\n\t}\n\n\tonChangeType(e, item)\n\t{\n\t\tthis.closeTypesMenu();\n\t\tif (this._type !== item.value)\n\t\t{\n\t\t\tlet prevType = this._type;\n\t\t\tthis._type = item.value;\n\t\t\tthis.refreshTypeName();\n\t\t\tthis.emit('onUpdateAddressType', {id: this.getId(), type: this.getType(), prevType});\n\t\t}\n\t}\n\n\tonAddressWidgetChangedState(event)\n\t{\n\t\tlet data = event.getData(),\n\t\t\tstate = data.state;\n\n\t\tlet wasLoading = this._isLoading;\n\t\tthis._isLoading = (state === BX.Location.Widget.State.DATA_LOADING);\n\n\t\tif (wasLoading !== this._isLoading)\n\t\t{\n\t\t\tthis.refreshIcon();\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADING)\n\t\t{\n\t\t\tthis.emit('onStartLoadAddress', {id: this.getId()});\n\t\t}\n\t\tif (state === BX.Location.Widget.State.DATA_LOADED)\n\t\t{\n\t\t\tthis.emit('onAddressLoaded', {id: this.getId()});\n\t\t}\n\t}\n\n\tonAddressChanged(event)\n\t{\n\t\tthis._isLoading = false;\n\n\t\tlet data = event.getData();\n\t\tthis._value = Type.isObject(data.address) ? data.address.toJson() : '';\n\n\t\tthis.refreshIcon();\n\t\tthis.emit('onUpdateAddress', {id: this.getId(), value: this.getValue()});\n\t}\n\n\tonError(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\t\tlet errorMessage = errors\n\t\t\t.map((error) => error.message + (error.code.length ? `${error.code}` : ''))\n\t\t\t.join(', ');\n\n\t\tthis._isLoading = false;\n\t\tthis.refreshIcon();\n\n\t\tthis.emit('onError', {id: this.getId(), error: errorMessage});\n\t}\n}"],"names":["EntityEditorBaseAddressField","id","settings","_id","BX","type","isNotEmptyString","util","getRandomString","_isMultiple","_settings","_typesList","_availableTypesIds","_addressList","_wrapper","_isEditMode","_showFirstItemOnly","prop","getBoolean","_enableAutocomplete","isMultiple","value","items","Type","isPlainObject","types","Object","keys","isSame","length","addressItem","getType","hasOwnProperty","getValue","removeAllAddresses","addAddress","getDefaultType","address","isStringFilled","result","isString","push","list","initAvailableTypes","item","getString","name","isDefault","indexOf","isEditMode","Tag","render","refreshLayout","Dom","clean","addrCounter","setEditMode","showMore","onShowMoreMouseUp","bind","Loc","getMessage","append","layout","isNull","crmCompatibilityMode","addButtonWrapClass","addButtonClass","onAddNewAddress","ids","map","getId","removeAddress","AddressItem","Text","getRandom","typesList","getTypesList","availableTypesIds","canChangeType","enableAutocomplete","subscribe","onUpdateAddress","onUpdateAddressType","onDeleteAddress","onStartLoadAddress","onAddressLoaded","onError","updateAvailableTypes","getAddressById","splice","destroy","filter","reduce","prev","removedType","addedType","setAvailableTypesIds","EventEmitter","emit","event","emitUpdateEvent","data","getData","clearValue","prevType","stopPropagation","self","initialize","setEventNamespace","_value","_isTypesMenuOpened","getArray","_canChangeType","typesMenuId","_type","_isAutocompleteEnabled","_showDetails","_isLoading","_addressWidget","_domNodes","_isLocationModuleInstalled","isUndefined","Location","Core","Widget","initializeAddressWidget","Address","JSON","parse","e","widgetFactory","Factory","createAddressWidget","mode","ControlMode","edit","view","popupBindOptions","position","subscribeOnStateChangedEvent","onAddressWidgetChangedState","subscribeOnAddressChangedEvent","onAddressChanged","subscribeOnErrorEvent","addressWidgetParams","addressString","convertAddressToString","getAddress","getEditHtml","inputNode","searchInput","mapBindElement","fieldsContainer","detailsContainer","controlWrapper","addressContainer","getViewHtml","bindElement","menu","selected","text","onclick","onChangeType","MenuManager","show","angle","cacheable","events","onPopupShow","onPopupClose","createdMenu","getMenuById","isDomNode","addressTypeSelector","getPopupWindow","setWidth","offsetWidth","close","typeName","icon","onToggleTypesMenu","addressTypeContainer","refreshTypeName","refreshIcon","detailsToggler","onToggleDetailsVisibility","setDetailsVisibility","textContent","join","node","newNode","onDelete","replace","toString","getAddressFormat","addressFormat","resetView","visible","addClass","removeClass","closeTypesMenu","openTypesMenu","target","state","wasLoading","State","DATA_LOADING","DATA_LOADED","isObject","toJson","errors","errorMessage","error","message","code"],"mappings":"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"}