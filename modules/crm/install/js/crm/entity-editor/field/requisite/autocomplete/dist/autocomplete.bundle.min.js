this.BX=this.BX||{};(function(e,t,i){"use strict";function s(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);s=function t(){return e};return e}function n(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-rq-popup-wrapper">\n\t\t\t\t\t<div class="crm-rq-popup-items-list">',"</div>\n\t\t\t\t</div>\n\t\t\t"]);n=function t(){return e};return e}function r(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="crm-rq-popup-item crm-rq-popup-item-add-new">\n\t\t\t\t\t\t<button class="crm-rq-popup-item-add-new-btn">\n\t\t\t\t\t\t\t<span class="ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round" onclick="','"></span>\n\t\t\t\t\t\t\t<span class="crm-rq-popup-item-add-new-btn-text" onclick="','">',"</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>"]);r=function t(){return e};return e}function o(){var e=babelHelpers.taggedTemplateLiteral(['<a href="" onclick="','">',"</a>"]);o=function t(){return e};return e}function a(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-rq-popup-item crm-rq-popup-item-helper"></div>']);a=function t(){return e};return e}function l(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">\n\t\t\t',"\n\t\t\t","\n\t\t\t","\n\t\t</div>"]);l=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="text" placeholder="','" class="ui-ctl-element ui-ctl-textbox" />']);d=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-search" onclick="','"></button>']);c=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" onclick="','"></button>']);u=function t(){return e};return e}var h=function(e){babelHelpers.inherits(s,e);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.setEventNamespace("BX.Crm.Requisite.Autocomplete");e._id="";e._settings={};e._placeholderText=null;e._isLoading=false;e._isEnabled=false;e._context={};e._currentItem=null;e._domNodes={};e._dropdown=null;return e}babelHelpers.createClass(s,[{key:"initialize",value:function e(t,i){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=i?i:{};this._placeholderText=BX.prop.getString(this._settings,"placeholderText","");this._context=BX.prop.getObject(this._settings,"context",{});this._isEnabled=BX.prop.getBoolean(this._settings,"enabled",false);this._featureRestrictionCallback=BX.prop.getString(this._settings,"featureRestrictionCallback","");this._isPermitted=this._featureRestrictionCallback==="";this._showFeedbackLink=this._isPermitted?BX.prop.getBoolean(this._settings,"showFeedbackLink",false):false;this.doInitialize()}},{key:"doInitialize",value:function e(){}},{key:"layout",value:function e(i){if(!t.Type.isDomNode(i)){return}this._domNodes.requisiteClearButton=t.Tag.render(u(),this.onSearchStringClear.bind(this));this._domNodes.requisiteSearchButton=t.Tag.render(c(),this.onSearchButtonClick.bind(this));var s=this._placeholderText.length?t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_FILL_IN").replace("#FIELD_NAME#",this._placeholderText):"";this._domNodes.requisiteSearchString=t.Tag.render(d(),s);if(!this._isPermitted){this._domNodes.requisiteSearchString.setAttribute("onclick",this._featureRestrictionCallback)}this.refreshLayout();t.Dom.append(t.Tag.render(l(),this._domNodes.requisiteSearchButton,this._domNodes.requisiteClearButton,this._domNodes.requisiteSearchString),i);this.initDropdown();this.refreshLayout()}},{key:"initDropdown",value:function e(){if(!this._dropdown){this._dropdown=new p({searchAction:BX.prop.getString(this._settings,"searchAction",""),items:[],enableCreation:true,enableCreationOnBlur:false,autocompleteDelay:1e3,messages:{creationLegend:t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_ADD_REQUISITE"),notFound:t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_NOT_FOUND")}});i.EventEmitter.subscribe(this._dropdown,"BX.UI.Dropdown:onSelect",this.onEntitySelect.bind(this));i.EventEmitter.subscribe(this._dropdown,"BX.UI.Dropdown:onAdd",this.onEntityAdd.bind(this));i.EventEmitter.subscribe(this._dropdown,"BX.UI.Dropdown:onReset",this.onEntityReset.bind(this));i.EventEmitter.subscribe(this._dropdown,"BX.UI.Dropdown:onBeforeSearchStart",this.onEntitySearchStart.bind(this));i.EventEmitter.subscribe(this._dropdown,"BX.UI.Dropdown:onSearchComplete",this.onEntitySearchComplete.bind(this))}this._dropdown.searchOptions=this._context;this._dropdown.targetElement=this._domNodes.requisiteSearchString;this._dropdown.init();this.setEnabled(this._isEnabled);this.setShowFeedbackLink(this._showFeedbackLink)}},{key:"setCurrentItem",value:function e(i){this._currentItem=t.Type.isPlainObject(i)?i:null;this.refreshLayout()}},{key:"setShowFeedbackLink",value:function e(t){this._showFeedbackLink=!!t;if(this._dropdown){this._dropdown.setFeedbackFormParams(this._showFeedbackLink?BX.prop.getObject(this._settings,"feedbackFormParams",{}):{})}}},{key:"refreshLayout",value:function e(){if(!t.Type.isDomNode(this._domNodes.requisiteSearchString)||!t.Type.isDomNode(this._domNodes.requisiteSearchButton)||!t.Type.isDomNode(this._domNodes.requisiteClearButton)){return}var i="";if(t.Type.isObject(this._currentItem)&&this._isPermitted){var s=[this._currentItem.title];if(t.Type.isStringFilled(this._currentItem.subTitle)){s.push(this._currentItem.subTitle)}i=s.join(", ");t.Dom.style(this._domNodes.requisiteSearchButton,"display","none");t.Dom.style(this._domNodes.requisiteClearButton,"display","");if(this._dropdown){this._dropdown.setCanAddRequisite(false)}}else{t.Dom.style(this._domNodes.requisiteClearButton,"display","none");if(this._isEnabled||!this._isPermitted){t.Dom.style(this._domNodes.requisiteSearchButton,"display","")}else{t.Dom.style(this._domNodes.requisiteSearchButton,"display","none")}if(this._dropdown){this._dropdown.setCanAddRequisite(this._isPermitted&&BX.prop.getBoolean(this._settings,"canAddRequisite",false))}}this._domNodes.requisiteSearchString.value=i;this.setLoading(false)}},{key:"getState",value:function e(){var i={currentItem:this._currentItem,searchQuery:t.Type.isDomNode(this._domNodes.requisiteSearchString)?this._domNodes.requisiteSearchString.value:null,items:t.Type.isObject(this._dropdown)?this._dropdown.getItems():[]};return i}},{key:"setState",value:function e(i){if(!t.Type.isPlainObject(i)){return}this.setCurrentItem(t.Type.isPlainObject(i.currentItem)?i.currentItem:null);if(t.Type.isString(i.searchQuery)&&t.Type.isDomNode(this._domNodes.requisiteSearchString)&&this._isPermitted){this._domNodes.requisiteSearchString.value=i.searchQuery}if(t.Type.isArray(i.items)){this._dropdown.setItems(i.items)}}},{key:"setContext",value:function e(i){this._context=t.Type.isPlainObject(i)?i:{};if(this._dropdown){this._dropdown.searchOptions=this._context}}},{key:"setPlaceholderText",value:function e(i){this._placeholderText=t.Type.isStringFilled(i)?i:"";if(t.Type.isDomNode(this._domNodes.requisiteSearchString)){var s=this._placeholderText.length?t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_FILL_IN").replace("#FIELD_NAME#",this._placeholderText):"";this._domNodes.requisiteSearchString.placeholder=s}}},{key:"setEnabled",value:function e(t){this._isEnabled=!!t;if(this._dropdown){this._dropdown.setMinSearchStringLength(this._isEnabled?3:99999)}}},{key:"setLoading",value:function e(i){i=!!i;if(i===this._isLoading){return}this._isLoading=i;var s=this._domNodes.requisiteSearchButton;if(t.Type.isDomNode(s)){if(i){s.classList.remove("ui-ctl-icon-search");s.classList.add("ui-ctl-icon-loader")}else{s.classList.remove("ui-ctl-icon-loader");s.classList.add("ui-ctl-icon-search")}}var n=this._domNodes.requisiteClearButton;if(t.Type.isDomNode(n)){if(i){n.classList.remove("ui-ctl-icon-clear");n.classList.add("ui-ctl-icon-loader")}else{n.classList.remove("ui-ctl-icon-loader");n.classList.add("ui-ctl-icon-clear")}}}},{key:"onSearchStringClear",value:function e(){this.emit("onClear")}},{key:"onSearchButtonClick",value:function e(){if(t.Type.isObject(this._dropdown)){this._dropdown.handleTypeInField()}}},{key:"onEntitySelect",value:function e(t){var i=t.getData();var s=i[0];var n=i[1];s.getPopupWindow().close();this.setCurrentItem(n);this.emit("onSelectValue",n)}},{key:"onEntityAdd",value:function e(t){var i=t.getData();var s=i[0];s.getPopupWindow().close();this.emit("onCreateNewItem")}},{key:"onEntityReset",value:function e(){this.setCurrentItem(null)}},{key:"onEntitySearchStart",value:function e(){this.setLoading(true);this._dropdown.setItems([])}},{key:"onEntitySearchComplete",value:function e(){this.setLoading(false)}}],[{key:"create",value:function e(t,i){var n=new s;n.initialize(t,i);return n}}]);return s}(i.EventEmitter);var p=function(e){babelHelpers.inherits(i,e);function i(e){var t;babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e));t.feedbackFormParams=BX.prop.getObject(e,"feedbackFormParams",{});t.canAddRequisite=BX.prop.getBoolean(e,"canAddRequisite",false);return t}babelHelpers.createClass(i,[{key:"isTargetElementChanged",value:function e(){return false}},{key:"getItemsListContainer",value:function e(){if(!this.itemListContainer){this.itemListContainer=BX.create("div",{attrs:{className:"ui-dropdown-container rq-dropdown-container"}})}return this.itemListContainer}},{key:"setFeedbackFormParams",value:function e(i){this.feedbackFormParams=t.Type.isPlainObject(i)?i:{}}},{key:"setCanAddRequisite",value:function e(t){this.canAddRequisite=!!t}},{key:"setMinSearchStringLength",value:function e(t){this.minSearchStringLength=t}},{key:"getPopupAlertContainer",value:function e(){if(!this.popupAlertContainer){var i=[];var l=Object.keys(this.getFeedbackFormParams()).length>0;if(l){var d=t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE").split("#ADVICE_NEW_SERVICE_LINK#");var c=t.Tag.render(a());if(d[0]&&d[0].length){t.Dom.append(document.createTextNode(d[0]),c)}t.Dom.append(t.Tag.render(o(),this.showFeedbackForm.bind(this),t.Loc.getMessage("REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE_LINK")),c);if(d[1]&&d[1].length){t.Dom.append(document.createTextNode(d[1]),c)}i.push(c)}if(this.canAddRequisite){i.push(t.Tag.render(r(),this.onEmptyValueEvent.bind(this),this.onEmptyValueEvent.bind(this),BX.prop.getString(this.messages,"creationLegend")))}this.popupAlertContainer=i.length?t.Tag.render(n(),i):t.Tag.render(s())}this.togglePopupAlertVisibility();return this.popupAlertContainer}},{key:"togglePopupAlertVisibility",value:function e(){if(t.Type.isDomNode(this.popupAlertContainer)){this.popupAlertContainer.style.display=this.getItems().length>0?"none":""}}},{key:"setItems",value:function e(t){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"setItems",this).call(this,t);this.togglePopupAlertVisibility()}},{key:"getNewAlertContainer",value:function e(t){return null}},{key:"disableTargetElement",value:function e(){}},{key:"getFeedbackFormParams",value:function e(){return this.feedbackFormParams}},{key:"showFeedbackForm",value:function e(t){t.preventDefault();this.getPopupWindow().close();if(!this._feedbackForm){this._feedbackForm=new BX.UI.Feedback.Form(this.getFeedbackFormParams())}this._feedbackForm.openPanel()}}]);return i}(BX.UI.Dropdown);e.RequisiteAutocompleteField=h})(this.BX.Crm=this.BX.Crm||{},BX,BX.Event);
//# sourceMappingURL=autocomplete.bundle.map.js