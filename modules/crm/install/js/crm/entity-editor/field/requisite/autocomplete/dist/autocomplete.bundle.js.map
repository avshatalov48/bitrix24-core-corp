{"version":3,"file":"autocomplete.bundle.js","sources":["../src/autocomplete.js"],"sourcesContent":["import {Dom, Loc, Tag, Text, Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport 'ui.design-tokens';\nimport {DetailSearch as DetailSearchPlacement} from \"crm.placement.detailsearch\"\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\"\nimport \"./autocomplete.css\"\n\nexport class RequisiteAutocompleteField extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Requisite.Autocomplete');\n\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._placeholderText = null;\n\t\tthis._isLoading = false;\n\t\tthis._isEnabled = false;\n\t\tthis._context = {};\n\t\tthis._currentItem = null;\n\n\t\tthis._domNodes = {};\n\t\tthis._dropdown = null;\n\n\t\tthis.currentSearchQueryText = \"\";\n\t\tthis.detailAutocompletePlacement = null;\n\t\tthis.entitySearchPopupCloseHandler = null;\n\t\tthis.placementsParamsHandler = null;\n\t\tthis.searchQueryInputHandler = null;\n\t\tthis.beforeAddPlacementItemsHandler = null;\n\t\tthis.placementSearchParamsHandler = null;\n\t\tthis.placementSetFoundItemsHandler = null;\n\t\tthis.placementEntitySelectHandler = null;\n\t\tthis.externalSearchHandler = null;\n\t\tthis.externalSearchResultHandlerList = null;\n\n\t\tthis.beforeEntitySearchPopupCloseHandler = null;\n\t\tthis.onDocumentClickConfirm = null;\n\n\t\tthis.creatingItem = null;\n\n\t\tthis.clientResolverPlacementParams = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._placeholderText = BX.prop.getString(this._settings, \"placeholderText\", \"\");\n\t\tthis._context = BX.prop.getObject(this._settings, \"context\", {});\n\t\tthis._isEnabled = BX.prop.getBoolean(this._settings, \"enabled\", false);\n\t\tthis._featureRestrictionCallback = BX.prop.getString(this._settings, \"featureRestrictionCallback\", '');\n\t\tthis._isPermitted = (this._featureRestrictionCallback === '');\n\t\tthis._showFeedbackLink = this._isPermitted ? BX.prop.getBoolean(this._settings, \"showFeedbackLink\", false) : false;\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(\n\t\t\tBX.prop.getObject(this._settings, \"clientResolverPlacementParams\", null)\n\t\t);\n\t\tthis.externalSearchHandler = this.onExternalSearch.bind(this);\n\t\tthis.externalSearchResultHandlerList = new Map();\n\n\t\tthis.doInitialize();\n\t}\n\n\tfilterclientResolverPlacementParams(params)\n\t{\n\t\tif (!Type.isObject(params))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisPlacement: BX.prop.getBoolean(params, \"isPlacement\", false),\n\t\t\tplacementCode: BX.prop.getString(params, \"placementCode\", \"\"),\n\t\t\tnumberOfPlacements: BX.prop.getInteger(params, \"numberOfPlacements\", 0),\n\t\t\tcountryId: BX.prop.getInteger(params, \"countryId\", 0),\n\t\t\tdefaultAppInfo: BX.prop.getObject(params, \"defaultAppInfo\", {}),\n\t\t};\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tlayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._domNodes.requisiteClearButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onSearchStringClear.bind(this)}\"></button>`;\n\n\t\tthis._domNodes.requisiteSearchButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-search\" onclick=\"${this.onSearchButtonClick.bind(this)}\"></button>`;\n\n\t\tlet placeholder = this._placeholderText;\n\t\tthis._domNodes.requisiteSearchString = Tag.render`\n\t\t\t<input type=\"text\" placeholder=\"${Text.encode(placeholder)}\" class=\"ui-ctl-element ui-ctl-textbox\" />`;\n\n\t\tif (!this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.setAttribute('onclick', this._featureRestrictionCallback);\n\t\t}\n\t\tthis.refreshLayout();\n\n\t\tDom.append(Tag.render`\n\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t${this._domNodes.requisiteSearchButton}\n\t\t\t${this._domNodes.requisiteClearButton}\n\t\t\t${this._domNodes.requisiteSearchString}\n\t\t</div>`, container);\n\n\t\tthis.initDropdown();\n\n\t\tthis.refreshLayout();\n\t}\n\n\tinitDropdown()\n\t{\n\t\tif (!this._dropdown)\n\t\t{\n\t\t\tconst isPlacement = BX.prop.getBoolean(this.clientResolverPlacementParams, \"isPlacement\", false);\n\t\t\tthis._dropdown = new Dropdown(\n\t\t\t\t{\n\t\t\t\t\tisDisabled: !this._isPermitted,\n\t\t\t\t\tsearchAction: BX.prop.getString(this._settings, \"searchAction\", \"\"),\n\t\t\t\t\texternalSearchHandler: isPlacement ? this.externalSearchHandler : null,\n\t\t\t\t\titems: [],\n\t\t\t\t\tenableCreation: true,\n\t\t\t\t\tenableCreationOnBlur: true,\n\t\t\t\t\tautocompleteDelay: 1500,\n\t\t\t\t\tmessages:\n\t\t\t\t\t{\n\t\t\t\t\t\tcreationLegend: Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADD_REQUISITE'),\n\t\t\t\t\t\tnotFound: Loc.getMessage('REQUISITE_AUTOCOMPLETE_NOT_FOUND'),\n\t\t\t\t\t},\n\t\t\t\t\tplacementParams: this.clientResolverPlacementParams\n\t\t\t\t}\n\t\t\t);\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSelect', this.onEntitySelect.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onAdd', this.onEntityAdd.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onReset', this.onEntityReset.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onBeforeSearchStart', this.onEntitySearchStart.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onEntitySearchComplete.bind(this));\n\t\t\tBX.addCustomEvent(this._dropdown, 'Dropdown:onGetPopupAlertContainer', this.onGetPopupAlertContainer.bind(this));\n\t\t\tBX.addCustomEvent(this._dropdown, 'Dropdown:onAfterInstallDefaultApp', this.onAfterInstallDefaultApp.bind(this));\n\t\t}\n\t\tthis._dropdown.searchOptions = this._context;\n\t\tthis._dropdown.targetElement = this._domNodes.requisiteSearchString;\n\t\tthis._dropdown.init();\n\n\t\tthis.setEnabled(this._isEnabled);\n\t\tthis.setShowFeedbackLink(this._showFeedbackLink);\n\t}\n\n\tgetDropdownPopup(tryCreate = false)\n\t{\n\t\tif (tryCreate)\n\t\t{\n\t\t\treturn this._dropdown.getPopupWindow();\n\t\t}\n\n\t\treturn this._dropdown.popupWindow;\n\t}\n\n\tcloseDropdownPopup()\n\t{\n\t\tconst dropownPopup = this.getDropdownPopup();\n\t\tif (dropownPopup)\n\t\t{\n\t\t\tdropownPopup.close();\n\t\t}\n\t}\n\n\tsetCurrentItem(autocompleteItem)\n\t{\n\t\tthis._currentItem = Type.isPlainObject(autocompleteItem) ? autocompleteItem : null;\n\t\tthis.refreshLayout();\n\t}\n\n\tsetShowFeedbackLink(show)\n\t{\n\t\tthis._showFeedbackLink = !!show;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setFeedbackFormParams(this._showFeedbackLink ? BX.prop.getObject(this._settings, \"feedbackFormParams\", {}) : {});\n\t\t}\n\t}\n\n\trefreshLayout()\n\t{\n\n\t\tif (!Type.isDomNode(this._domNodes.requisiteSearchString) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteSearchButton) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteClearButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = '';\n\n\t\tif (Type.isObject(this._currentItem) && this._isPermitted)\n\t\t{\n\t\t\tlet textParts = [this._currentItem.title];\n\t\t\tif (Type.isStringFilled(this._currentItem.subTitle))\n\t\t\t{\n\t\t\t\ttextParts.push(this._currentItem.subTitle);\n\t\t\t}\n\t\t\ttext = textParts.join(', ');\n\n\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"\");\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"none\");\n\t\t\tif (this._isEnabled || !this._isPermitted)\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\t}\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(this._isPermitted && BX.prop.getBoolean(this._settings, \"canAddRequisite\", false));\n\t\t\t}\n\t\t}\n\n\t\tthis._domNodes.requisiteSearchString.value = text;\n\t\tthis.onSearchQueryInput();\n\t\tthis.setLoading(false);\n\t}\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcurrentItem: this._currentItem,\n\t\t\tsearchQuery: Type.isDomNode(this._domNodes.requisiteSearchString) ?\n\t\t\t\tthis._domNodes.requisiteSearchString.value : null,\n\t\t\titems: Type.isObject(this._dropdown) ? this._dropdown.getItems() : []\n\t\t};\n\t}\n\n\tsetState(state)\n\t{\n\t\tif (!Type.isPlainObject(state))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentItem(Type.isPlainObject(state.currentItem) ? state.currentItem : null);\n\t\tif (Type.isString(state.searchQuery) && Type.isDomNode(this._domNodes.requisiteSearchString) && this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.value = state.searchQuery;\n\t\t\tthis.onSearchQueryInput();\n\t\t}\n\t\tif (Type.isArray(state.items))\n\t\t{\n\t\t\tthis._dropdown.setItems(state.items);\n\t\t}\n\t}\n\n\tsetContext(context)\n\t{\n\t\tthis._context = Type.isPlainObject(context) ? context : {};\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.searchOptions = this._context;\n\t\t}\n\t}\n\n\tsetPlaceholderText(text)\n\t{\n\t\tthis._placeholderText = Type.isStringFilled(text) ? text : \"\";\n\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.placeholder = this._placeholderText;\n\t\t}\n\t}\n\n\tsetClientResolverPlacementParams(params)\n\t{\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(params);\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setPlacementParams(this.clientResolverPlacementParams);\n\t\t\tconst isPlacement = BX.prop.getBoolean(this.clientResolverPlacementParams, \"isPlacement\", false);\n\t\t\tif (isPlacement)\n\t\t\t{\n\t\t\t\tthis._dropdown.setExternalSearchHandler(this.externalSearchHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEnabled(enabled)\n\t{\n\t\tthis._isEnabled = !!enabled;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setMinSearchStringLength(this._isEnabled ? 3: 99999);\n\t\t}\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tisLoading = !!isLoading;\n\t\tif (isLoading === this._isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isLoading = isLoading;\n\t\tlet searchBtn = this._domNodes.requisiteSearchButton;\n\t\tif (Type.isDomNode(searchBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-search');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-search');\n\t\t\t}\n\t\t}\n\n\t\tlet clearBtn = this._domNodes.requisiteClearButton;\n\t\tif (Type.isDomNode(clearBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-clear');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-clear');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPlacementCode()\n\t{\n\t\tconst placementCode = BX.prop.getString(this.clientResolverPlacementParams, \"placementCode\", \"\");\n\n\t\treturn (placementCode === \"\" ? \"CRM_REQUISITE_AUTOCOMPLETE\" : placementCode);\n\t}\n\n\tonSearchStringClear()\n\t{\n\t\tthis.emit('onClear');\n\t}\n\n\tonSearchButtonClick()\n\t{\n\t\tif (Type.isObject(this._dropdown))\n\t\t{\n\t\t\tthis._dropdown.handleTypeInField();\n\t\t}\n\t}\n\n\tonEntitySelect(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tlet selected = data[1];\n\n\t\tif (dropdown === this._dropdown && selected[\"appSid\"] && !selected[\"created\"])\n\t\t{\n\t\t\tif (!this.creatingItem)\n\t\t\t{\n\t\t\t\tthis.creatingItem = selected;\n\t\t\t\tselected._loader = new BX.Loader({\n\t\t\t\t\ttarget: selected.node,\n\t\t\t\t\tsize: 40\n\t\t\t\t});\n\t\t\t\tselected.node.classList.add('client-editor-active');\n\t\t\t\tselected.node.parentNode.classList.add('client-editor-inactive');\n\t\t\t\tselected._loader.show();\n\n\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:pick\",\n\t\t\t\t\t[{appSid: selected[\"appSid\"], data: selected}]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectEntity(selected);\n\t}\n\n\tselectEntity(selected)\n\t{\n\t\tif (this.creatingItem)\n\t\t{\n\t\t\tfor (let prop in selected)\n\t\t\t{\n\t\t\t\tif (selected.hasOwnProperty(prop))\n\t\t\t\t{\n\t\t\t\t\tthis.creatingItem[prop] = selected[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.creatingItem[\"created\"] = true;\n\t\t\tthis.creatingItem = null;\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\tthis.onDocumentClickConfirm.close();\n\t\t\tthis.onDocumentClickConfirm = null;\n\t\t}\n\n\t\tthis.closeDropdownPopup();\n\n\t\tthis.setCurrentItem(selected);\n\t\tthis.emit('onSelectValue', selected);\n\t}\n\n\tonEntityAdd(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tdropdown.getPopupWindow().close();\n\t\tthis.emit('onCreateNewItem');\n\t}\n\n\tonEntityReset()\n\t{\n\t\tthis.setCurrentItem(null);\n\t}\n\n\tonEntitySearchStart()\n\t{\n\t\tthis.setLoading(true);\n\t\tthis._dropdown.setItems([]);\n\t}\n\n\tonExternalSearch()\n\t{\n\t\treturn new Promise(\n\t\t\t(resolve) => {\n\t\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t\t{\n\t\t\t\t\tconst params = {appId: 0};\n\t\t\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:startDefaultSearch\", [params]);\n\t\t\t\t\tif (Type.isInteger(params[\"appId\"]) && params[\"appId\"] > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.externalSearchResultHandlerList.has(params[\"appId\"]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.externalSearchResultHandlerList.set(params[\"appId\"], (result) => { resolve(result) });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve([]);\n\t\t\t}\n\t\t);\n\t}\n\n\tinitPlacement(searchControl, container)\n\t{\n\t\tif (!this.detailAutocompletePlacement)\n\t\t{\n\t\t\tlet isAutocompletePlacementEnabled = (\n\t\t\t\tType.isPlainObject(this.clientResolverPlacementParams)\n\t\t\t\t&& this.clientResolverPlacementParams.hasOwnProperty(\"numberOfPlacements\")\n\t\t\t\t&& Type.isNumber(this.clientResolverPlacementParams[\"numberOfPlacements\"])\n\t\t\t\t&& this.clientResolverPlacementParams[\"numberOfPlacements\"] > 0\n\t\t\t);\n\n\t\t\tif (isAutocompletePlacementEnabled)\n\t\t\t{\n\t\t\t\tthis.detailAutocompletePlacement = new DetailSearchPlacement(this.getPlacementCode());\n\t\t\t}\n\n\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t{\n\t\t\t\tconst dropdownPopup = this.getDropdownPopup(true);\n\n\t\t\t\tif (dropdownPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.beforeEntitySearchPopupCloseHandler = this.onBeforeEntitySearchPopupClose.bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tdropdownPopup._tryCloseByEvent.bind(dropdownPopup)\n\t\t\t\t\t);\n\t\t\t\t\tdropdownPopup._tryCloseByEvent = this.beforeEntitySearchPopupCloseHandler;\n\n\t\t\t\t\tthis.entitySearchPopupCloseHandler = this.onEntitySearchPopupClose.bind(this);\n\t\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\t\tdropdownPopup,\n\t\t\t\t\t\t'onPopupClose',\n\t\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t\t);\n\n\t\t\t\t\tdropdownPopup.show();\n\t\t\t\t}\n\n\t\t\t\tthis.placementsParamsHandler = this.onPlacementsParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:params\",\n\t\t\t\t\tthis.placementsParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.beforeAddPlacementItemsHandler = this.onBeforeAppendPlacementItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSearchParamsHandler = this.onPlacamentSearchParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:searchParams\",\n\t\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSetFoundItemsHandler = this.onPlacementSetFoundItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementEntitySelectHandler = this.onPlacementEntitySelect.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:select\",\n\t\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t\t);\n\n\t\t\t\tthis.detailAutocompletePlacement.show(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tcontainer.querySelector('div.crm-rq-popup-item-add-new'),\n\t\t\t\t\t{\n\t\t\t\t\t\thideLoader: true\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t\t{\n\t\t\t\tif (!this.searchQueryInputHandler)\n\t\t\t\t{\n\t\t\t\t\tthis.searchQueryInputHandler = this.onSearchQueryInput.bind(this);\n\t\t\t\t}\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchQueryInput()\n\t{\n\t\tif (this._domNodes.requisiteSearchString.value !== this.currentSearchQueryText)\n\t\t{\n\t\t\tthis.currentSearchQueryText = this._domNodes.requisiteSearchString.value;\n\t\t\tthis.fireChangeSearchQueryEvent();\n\t\t}\n\t}\n\n\tfireChangeSearchQueryEvent()\n\t{\n\t\tif (this.detailAutocompletePlacement && Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tBX.onCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:changeQuery\",\n\t\t\t\t[{currentSearchQuery: this._domNodes.requisiteSearchString.value}]\n\t\t\t);\n\t\t}\n\t}\n\n\tonEntitySearchComplete(/*dropdown, items*/)\n\t{\n\t\tthis.setLoading(false);\n\t}\n\n\tonGetPopupAlertContainer(searchControl, container)\n\t{\n\t\tthis.initPlacement(searchControl, container);\n\t}\n\n\tonAfterInstallDefaultApp(dropdown)\n\t{\n\t\tthis.emit(\"onInstallDefaultApp\");\n\t}\n\n\tonBeforeEntitySearchPopupClose(originalHandler, event)\n\t{\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\tconst eventResult = {active: false};\n\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:active\", [eventResult]);\n\t\tif (eventResult.active)\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\tconst f = function(messageBox, e) {\n\t\t\t\tBX.bind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\t\tmessageBox.close();\n\t\t\t\tthis.onDocumentClickConfirm = null;\n\t\t\t\tBX.eventCancelBubble(e);\n\t\t\t}.bind(this);\n\t\t\tthis.onDocumentClickConfirm = MessageBox.create({\n\t\t\t\tmessage: BX.message('CRM_EDITOR_PLACEMENT_CAUTION') || 'Dow you want to terminate process?',\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tmodal: true,\n\t\t\t\tonOk: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t\tthis._dropdown.documentClickHandler(e);\n\t\t\t\t\toriginalHandler(e);\n\t\t\t\t}.bind(this),\n\t\t\t\tonCancel: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t}\n\t\t\t});\n\t\t\tBX.eventCancelBubble(event);\n\t\t\tthis.onDocumentClickConfirm.show();\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\toriginalHandler(event);\n\t}\n\n\tonEntitySearchPopupClose()\n\t{\n\t\tthis.destroyPlacement();\n\t}\n\n\tdestroyPlacement()\n\t{\n\t\tif (this.searchQueryInputHandler) {\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\tthis.searchQueryInputHandler = null;\n\t\t}\n\n\t\tif (this._dropdown && this._dropdown.hasOwnProperty(\"documentClickHandler\"))\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t}\n\t\tif (this.detailAutocompletePlacement)\n\t\t{\n\t\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\t\tif (dropdownPopup)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\n\t\t\t\t\tdropdownPopup,\n\t\t\t\t\t\"onPopupClose\",\n\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.entitySearchPopupCloseHandler = null;\n\n\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:destroy\");\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:params\",\n\t\t\t\tthis.placementsParamsHandler\n\t\t\t);\n\t\t\tthis.placementsParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t);\n\t\t\tthis.beforeAddPlacementItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:searchParams\",\n\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t);\n\t\t\tthis.placementSearchParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t);\n\t\t\tthis.placementSetFoundItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:select\",\n\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t);\n\t\t\tthis.placementEntitySelectHandler = null;\n\n\t\t\tthis.detailAutocompletePlacement = null;\n\n\t\t\tthis.creatingItem = null;\n\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\t}\n\n\tonPlacementsParams(params)\n\t{\n\t\tif (Type.isObject(params))\n\t\t{\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setPlacementParams(this.clientResolverPlacementParams);\n\t\t\t}\n\n\t\t\tif (this.clientResolverPlacementParams)\n\t\t\t{\n\t\t\t\tif (params.hasOwnProperty(\"placementParams\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"placementParams\"] = this.clientResolverPlacementParams;\n\t\t\t\t}\n\t\t\t\tif (params.hasOwnProperty(\"currentSearchQuery\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"currentSearchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonBeforeAppendPlacementItems()\n\t{\n\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\tif (dropdownPopup)\n\t\t{\n\t\t\tBX.addClass(dropdownPopup.popupContainer, \"client-editor-popup\");\n\t\t}\n\t}\n\n\tonPlacamentSearchParams(params)\n\t{\n\t\tparams[\"searchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t}\n\n\tonPlacementSetFoundItems(placementItem, results)\n\t{\n\t\tconst items = [];\n\t\tresults.forEach(function(result) {\n\t\t\titems.push({\n\t\t\t\tid: result.id,\n\t\t\t\ttitle: result.name,\n\t\t\t\tappSid: placementItem[\"appSid\"],\n\t\t\t\tmodule: 'crm',\n\t\t\t\tsubModule: 'rest',\n\t\t\t\tsubTitle: placementItem[\"title\"],\n\t\t\t\tattributes: {\n\t\t\t\t\tphone: result.phone ? [{value: result.phone}] : '',\n\t\t\t\t\temail: result.email ? [{value: result.email}] : '',\n\t\t\t\t\tweb: result.web ? [{value: result.web}] : ''\n\t\t\t\t}\n\t\t\t});\n\t\t}.bind(this));\n\n\t\tlet appId = parseInt(placementItem[\"placementInfo\"][\"id\"]);\n\t\tif (appId > 0 && this.externalSearchResultHandlerList.has(appId))\n\t\t{\n\t\t\tthis.externalSearchResultHandlerList.get(appId)(items);\n\t\t\tthis.externalSearchResultHandlerList.delete(appId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._dropdown.setItems(items);\n\t\t}\n\t}\n\n\tonPlacementEntitySelect(data) {\n\t\tconst entityData = {\n\t\t\ttype: data[\"entityType\"],\n\t\t\tid: data[\"id\"],\n\t\t\ttitle: data[\"title\"],\n\t\t\tfields: data[\"fields\"]\n\t\t};\n\t\tif (\n\t\t\tType.isPlainObject(entityData[\"fields\"])\n\t\t\t&& entityData[\"fields\"].hasOwnProperty(\"RQ_ADDR\")\n\t\t\t&& Type.isPlainObject(entityData[\"fields\"][\"RQ_ADDR\"])\n\t\t)\n\t\t{\n\t\t\tconst responseHandler = function(response)\n\t\t\t{\n\t\t\t\tconst status = BX.prop.getString(response, \"status\", \"\");\n\t\t\t\tconst data = BX.prop.getObject(response, \"data\", {});\n\t\t\t\tconst messages = [];\n\n\t\t\t\tif (status === \"error\")\n\t\t\t\t{\n\t\t\t\t\tconst errors = BX.prop.getArray(response, \"errors\", []);\n\t\t\t\t\tfor (let i = 0; i < errors.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tmessages.push(BX.prop.getString(errors[i], \"message\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (messages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontent: messages.join(\"<br>\"),\n\t\t\t\t\t\t\tposition: \"top-center\",\n\t\t\t\t\t\t\tautoHideDelay: 10000\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tdelete entityData[\"fields\"][\"RQ_ADDR\"];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tentityData[\"fields\"][\"RQ_ADDR\"] = data;\n\t\t\t\t}\n\t\t\t\tthis.selectEntity(entityData);\n\t\t\t}.bind(this);\n\n\t\t\tBX.ajax.runAction(\n\t\t\t\t'crm.requisite.address.getLocationAddressJsonByFields',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taddresses: entityData[\"fields\"][\"RQ_ADDR\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(responseHandler, responseHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectEntity(entityData);\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new RequisiteAutocompleteField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass Dropdown extends BX.UI.Dropdown\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.feedbackFormParams = BX.prop.getObject(options, \"feedbackFormParams\", {});\n\t\tthis.canAddRequisite = BX.prop.getBoolean(options, \"canAddRequisite\", false);\n\t\tthis.externalSearchHandler = BX.prop.getFunction(options, \"externalSearchHandler\", null);\n\t\tthis.placementParams = BX.prop.getObject(options, \"placementParams\", {});\n\t\tthis.installDefaultAppHandler = this.onClickInstallDefaultApp.bind(this);\n\t\tthis.installDefaultAppTimeout = 7000;\n\t\tthis.afterInstallDefaultAppHandler = this.onAfterInstallDefaultApp.bind(this);\n\t\tthis.popupAlertContainer = null;\n\t\tthis.defaultAppInstallLoader = null;\n\t\tthis.isDefaultAppInstalled = false;\n\t}\n\n\tsetPlacementParams(params)\n\t{\n\t\tthis.placementParams = params;\n\t}\n\n\tsetExternalSearchHandler(handler)\n\t{\n\t\tthis.externalSearchHandler = handler\n\t}\n\n\tisTargetElementChanged()\n\t{\n\t\treturn false;\n\t}\n\n\tgetItemsListContainer()\n\t{\n\t\tif (!this.itemListContainer)\n\t\t{\n\t\t\tthis.itemListContainer = BX.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'ui-dropdown-container rq-dropdown-container'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this.itemListContainer;\n\t}\n\n\tsetFeedbackFormParams(feedbackFormParams)\n\t{\n\t\tthis.feedbackFormParams = Type.isPlainObject(feedbackFormParams) ? feedbackFormParams : {};\n\t}\n\n\tsetCanAddRequisite(canAdd)\n\t{\n\t\tthis.canAddRequisite = !!canAdd;\n\t}\n\n\tsetMinSearchStringLength(length)\n\t{\n\t\tthis.minSearchStringLength = length;\n\t}\n\t\n\tgetDefaultAppInfo()\n\t{\n\t\treturn BX.prop.getObject(this.placementParams, \"defaultAppInfo\", {});\n\t}\n\t\n\tisDefaultAppCanInstall()\n\t{\n\t\tconst defaultAppInfo = this.getDefaultAppInfo();\n\t\t\n\t\treturn (\n\t\t\tType.isStringFilled(BX.prop.get(defaultAppInfo, \"code\", \"\"))\n\t\t\t&& Type.isStringFilled(BX.prop.get(defaultAppInfo, \"title\", \"\"))\n\t\t\t&& BX.prop.get(defaultAppInfo, \"isAvailable\", \"N\") === \"Y\"\n\t\t\t/*&& BX.prop.get(defaultAppInfo, \"isInstalled\", \"N\") !== \"Y\"*/\n\t\t);\n\t}\n\n\tgetPopupAlertContainer()\n\t{\n\t\tif (!this.popupAlertContainer)\n\t\t{\n\t\t\tlet items = [];\n\n\t\t\tif (this.isDefaultAppCanInstall())\n\t\t\t{\n\t\t\t\tconst appTitleText = Text.encode(this.getDefaultAppInfo()[\"title\"]);\n\t\t\t\tconst appInstallText = Text.encode(Loc.getMessage('REQUISITE_AUTOCOMPLETE_INSTALL'));\n\t\t\t\titems.push(\n\t\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"crm-rq-popup-item-add-inst-app-btn\"><span></span><span\n\t\t\t\t\t\t\t\tclass=\"crm-rq-popup-item-add-new-btn-text\"><span>${appTitleText}</span><span\n\t\t\t\t\t\t\t\tstyle=\"margin-left: 20px; width: 100px;\"><a\n\t\t\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\t\t\tonclick=\"${this.installDefaultAppHandler}\">${appInstallText}</a>\n\t\t\t\t\t\t\t</span></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlet feedbackAvailable = (Object.keys(this.getFeedbackFormParams()).length > 0);\n\t\t\tif (feedbackAvailable)\n\t\t\t{\n\t\t\t\tconst textParts =\n\t\t\t\t\tLoc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE').split('#ADVICE_NEW_SERVICE_LINK#')\n\t\t\t\t;\n\t\t\t\tconst item = Tag.render`<div class=\"crm-rq-popup-item crm-rq-popup-item-helper\"></div>`;\n\n\t\t\t\tif (textParts[0] && textParts[0].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[0]), item);\n\t\t\t\t}\n\t\t\t\tconst newServiceLinkText = Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE_LINK');\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<a href=\"\" onclick=\"${this.showFeedbackForm.bind(this)}\">${newServiceLinkText}</a>`,\n\t\t\t\t\titem\n\t\t\t\t);\n\n\t\t\t\tif (textParts[1] && textParts[1].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[1]), item);\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\tif (this.canAddRequisite)\n\t\t\t{\n\t\t\t\titems.push(Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button class=\"crm-rq-popup-item-add-new-btn\">\n\t\t\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"></span>\n\t\t\t\t\t\t\t<span class=\"crm-rq-popup-item-add-new-btn-text\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"\n\t\t\t\t\t\t\t\t>${BX.prop.getString(this.messages, \"creationLegend\")}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`);\n\t\t\t}\n\n\t\t\tthis.popupAlertContainer = items.length ? Tag.render`\n\t\t\t\t<div class=\"crm-rq-popup-wrapper\">\n\t\t\t\t\t<div class=\"crm-rq-popup-items-list\">${items}</div>\n\t\t\t\t</div>\n\t\t\t` : Tag.render`<div></div>`;\n\n\t\t\tBX.onCustomEvent(this, \"Dropdown:onGetPopupAlertContainer\", [this, this.popupAlertContainer]);\n\t\t}\n\n\t\tthis.togglePopupAlertVisibility();\n\n\t\treturn this.popupAlertContainer;\n\t}\n\n\tgetTargetElementValue()\n\t{\n\t\tif (this.targetElement !== \"undefined\" && Type.isStringFilled(this.targetElement[\"value\"]))\n\t\t{\n\t\t\treturn this.targetElement[\"value\"].trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\ttogglePopupAlertVisibility()\n\t{\n\t\tif (Type.isDomNode(this.popupAlertContainer))\n\t\t{\n\t\t\tconst numberOfPlacements = BX.prop.getInteger(this.placementParams, \"numberOfPlacements\", 0);\n\t\t\tconst isVisible = (numberOfPlacements > 0 || this.getItems().length <= 0);\n\t\t\tthis.popupAlertContainer.style.display = isVisible ? \"\" : \"none\";\n\t\t}\n\t}\n\n\tsetItems(items)\n\t{\n\t\tsuper.setItems([{id: 1, name: \"N\", title: \"T\"}]);\n\t\tthis.togglePopupAlertVisibility();\n\t\tsuper.setItems(items);\n\t}\n\n\tgetNewAlertContainer(/*items*/)\n\t{\n\t\treturn null;\n\t}\n\n\tdisableTargetElement()\n\t{\n\t\t// cancel original handler\n\t}\n\n\tgetFeedbackFormParams()\n\t{\n\t\treturn this.feedbackFormParams;\n\t}\n\n\tshowFeedbackForm(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getPopupWindow().close();\n\t\tif (!this._feedbackForm)\n\t\t{\n\t\t\tthis._feedbackForm = new BX.UI.Feedback.Form(this.getFeedbackFormParams());\n\t\t}\n\t\tthis._feedbackForm.openPanel();\n\t}\n\n\tsearchItemsByStr(target)\n\t{\n\t\tif (this.externalSearchHandler)\n\t\t{\n\t\t\treturn this.externalSearchHandler().then((result) => {return result;});\n\t\t}\n\n\t\treturn super.searchItemsByStr(target);\n\t}\n\n\tonClickInstallDefaultApp(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tif (this.defaultAppInstallLoader)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(event.target) && Type.isDomNode(event.target.parentNode))\n\t\t{\n\t\t\tconst parent = event.target.parentNode;\n\n\t\t\tDom.hide(event.target);\n\n\t\t\tthis.defaultAppInstallLoader = (\n\t\t\t\tthis.defaultAppInstallLoader\n\t\t\t\t|| new BX.Loader({\n\t\t\t\t\ttarget: parent,\n\t\t\t\t\tsize: 30,\n\t\t\t\t\toffset: { top: \"-23px\" }\n\t\t\t\t})\n\t\t\t);\n\t\t\tthis.defaultAppInstallLoader.show();\n\t\t}\n\n\t\tif (this.isDefaultAppCanInstall())\n\t\t{\n\t\t\tthis.isDefaultAppInstalled = false;\n\t\t\tBX.loadExt('marketplace').then(\n\t\t\t\t() => {\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (!this.isDefaultAppInstalled)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.finalInstallDefaultApp();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.installDefaultAppTimeout\n\t\t\t\t\t);\n\t\t\t\t\ttop.BX.addCustomEvent(\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\t\"Rest:AppLayout:ApplicationInstall\",\n\t\t\t\t\t\tthis.afterInstallDefaultAppHandler\n\t\t\t\t\t);\n\t\t\t\t\tBX.rest.Marketplace.install(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tCODE: this.placementParams[\"defaultAppInfo\"][\"code\"],\n\t\t\t\t\t\t\tSILENT_INSTALL: \"Y\",\n\t\t\t\t\t\t\tDO_NOTHING: \"Y\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\t() => {\n\t\t\t\t\ttop.BX.removeCustomEvent(\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\t\"Rest:AppLayout:ApplicationInstall\",\n\t\t\t\t\t\tthis.afterInstallDefaultAppHandler\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\twait(ms)\n\t{\n\t\treturn new Promise((resolve) => setTimeout(resolve, parseInt(ms)));\n\t}\n\n\tcheckDefAppHandler()\n\t{\n\t\tconst countryId = BX.prop.getInteger(this.placementParams, \"countryId\", 0);\n\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'crm.requisite.autocomplete.checkDefaultAppHandler',\n\t\t\t\t\t{ data: { countryId: countryId } }\n\t\t\t\t).then(\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t\t\t&& data.hasOwnProperty(\"data\")\n\t\t\t\t\t\t\t&& data.hasOwnProperty(\"status\")\n\t\t\t\t\t\t\t&& data[\"status\"] === \"success\"\n\t\t\t\t\t\t\t&& Type.isBoolean(data[\"data\"])\n\t\t\t\t\t\t\t&& data[\"data\"]\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t}\n\n\tawaitHandler(context)\n\t{\n\t\tthis.wait(context.waitTime)\n\t\t\t.then(() => {\n\t\t\t\tthis.checkDefAppHandler()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.finalInstallDefaultAppSuccess();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tif (--context.numberOfTimes > 0) {\n\t\t\t\t\t\t\tthis.awaitHandler(context)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthis.finalInstallDefaultApp();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonAfterInstallDefaultApp(installed, eventResult)\n\t{\n\t\tthis.isDefaultAppInstalled = true;\n\t\ttop.BX.removeCustomEvent(top, \"Rest:AppLayout:ApplicationInstall\", this.afterInstallDefaultAppHandler);\n\n\t\tconst numberOfTimes = 3;\n\t\tconst waitTime = Math.floor(this.installDefaultAppTimeout / numberOfTimes);\n\t\tif (!!installed)\n\t\t{\n\t\t\tthis.awaitHandler({waitTime: waitTime, numberOfTimes: 3})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.finalInstallDefaultApp();\n\t\t}\n\t}\n\n\tfinalInstallDefaultAppSuccess()\n\t{\n\t\tBX.onCustomEvent(this, \"Dropdown:onAfterInstallDefaultApp\", [this]);\n\t\tthis.finalInstallDefaultApp();\n\t}\n\n\tfinalInstallDefaultApp()\n\t{\n\t\tif (this.defaultAppInstallLoader)\n\t\t{\n\t\t\tthis.defaultAppInstallLoader.destroy();\n\t\t\tthis.defaultAppInstallLoader = null;\n\t\t}\n\n\t\tif (this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.close();\n\t\t}\n\t}\n}"],"names":["RequisiteAutocompleteField","setEventNamespace","_id","_settings","_placeholderText","_isLoading","_isEnabled","_context","_currentItem","_domNodes","_dropdown","currentSearchQueryText","detailAutocompletePlacement","entitySearchPopupCloseHandler","placementsParamsHandler","searchQueryInputHandler","beforeAddPlacementItemsHandler","placementSearchParamsHandler","placementSetFoundItemsHandler","placementEntitySelectHandler","externalSearchHandler","externalSearchResultHandlerList","beforeEntitySearchPopupCloseHandler","onDocumentClickConfirm","creatingItem","clientResolverPlacementParams","id","settings","BX","type","isNotEmptyString","util","getRandomString","prop","getString","getObject","getBoolean","_featureRestrictionCallback","_isPermitted","_showFeedbackLink","filterclientResolverPlacementParams","onExternalSearch","bind","Map","doInitialize","params","Type","isObject","isPlacement","placementCode","numberOfPlacements","getInteger","countryId","defaultAppInfo","container","isDomNode","requisiteClearButton","Tag","render","onSearchStringClear","requisiteSearchButton","onSearchButtonClick","placeholder","requisiteSearchString","Text","encode","setAttribute","refreshLayout","Dom","append","initDropdown","Dropdown","isDisabled","searchAction","items","enableCreation","enableCreationOnBlur","autocompleteDelay","messages","creationLegend","Loc","getMessage","notFound","placementParams","EventEmitter","subscribe","onEntitySelect","onEntityAdd","onEntityReset","onEntitySearchStart","onEntitySearchComplete","addCustomEvent","onGetPopupAlertContainer","onAfterInstallDefaultApp","searchOptions","targetElement","init","setEnabled","setShowFeedbackLink","tryCreate","getPopupWindow","popupWindow","dropownPopup","getDropdownPopup","close","autocompleteItem","isPlainObject","show","setFeedbackFormParams","text","textParts","title","isStringFilled","subTitle","push","join","style","setCanAddRequisite","value","onSearchQueryInput","setLoading","currentItem","searchQuery","getItems","state","setCurrentItem","isString","isArray","setItems","context","setPlacementParams","setExternalSearchHandler","enabled","setMinSearchStringLength","isLoading","searchBtn","classList","remove","add","clearBtn","emit","handleTypeInField","event","data","getData","dropdown","selected","_loader","Loader","target","node","size","parentNode","onCustomEvent","appSid","selectEntity","hasOwnProperty","closeDropdownPopup","Promise","resolve","appId","isInteger","has","set","result","searchControl","isAutocompletePlacementEnabled","isNumber","DetailSearchPlacement","getPlacementCode","dropdownPopup","onBeforeEntitySearchPopupClose","_tryCloseByEvent","onEntitySearchPopupClose","onPlacementsParams","onBeforeAppendPlacementItems","onPlacamentSearchParams","onPlacementSetFoundItems","onPlacementEntitySelect","querySelector","hideLoader","addEventListener","fireChangeSearchQueryEvent","currentSearchQuery","initPlacement","originalHandler","eventReturnFalse","eventResult","active","unbind","document","documentClickHandler","f","messageBox","e","eventCancelBubble","MessageBox","create","message","buttons","MessageBoxButtons","OK_CANCEL","modal","onOk","button","onCancel","destroyPlacement","removeEventListener","removeCustomEvent","addClass","popupContainer","placementItem","results","forEach","name","module","subModule","attributes","phone","email","web","parseInt","get","entityData","fields","responseHandler","response","status","errors","getArray","i","length","UI","Notification","Center","notify","content","position","autoHideDelay","ajax","runAction","addresses","then","self","initialize","options","feedbackFormParams","canAddRequisite","getFunction","installDefaultAppHandler","onClickInstallDefaultApp","installDefaultAppTimeout","afterInstallDefaultAppHandler","popupAlertContainer","defaultAppInstallLoader","isDefaultAppInstalled","handler","itemListContainer","attrs","className","canAdd","minSearchStringLength","getDefaultAppInfo","isDefaultAppCanInstall","appTitleText","appInstallText","feedbackAvailable","Object","keys","getFeedbackFormParams","split","item","createTextNode","newServiceLinkText","showFeedbackForm","onEmptyValueEvent","togglePopupAlertVisibility","trim","isVisible","display","preventDefault","_feedbackForm","Feedback","Form","openPanel","stopPropagation","parent","hide","offset","top","loadExt","setTimeout","finalInstallDefaultApp","rest","Marketplace","install","CODE","SILENT_INSTALL","DO_NOTHING","ms","reject","isBoolean","wait","waitTime","checkDefAppHandler","finalInstallDefaultAppSuccess","numberOfTimes","awaitHandler","installed","Math","floor","destroy"],"mappings":"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"}