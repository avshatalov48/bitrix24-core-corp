{"version":3,"file":"autocomplete.bundle.js","sources":["../src/autocomplete.js"],"sourcesContent":["import {Dom, Loc, Tag, Text, Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport \"./autocomplete.css\"\n\nexport class RequisiteAutocompleteField extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Requisite.Autocomplete');\n\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._placeholderText = null;\n\t\tthis._isLoading = false;\n\t\tthis._isEnabled = false;\n\t\tthis._context = {};\n\t\tthis._currentItem = null;\n\n\t\tthis._domNodes = {};\n\t\tthis._dropdown = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._placeholderText = BX.prop.getString(this._settings, \"placeholderText\", \"\");\n\t\tthis._context = BX.prop.getObject(this._settings, \"context\", {});\n\t\tthis._isEnabled = BX.prop.getBoolean(this._settings, \"enabled\", false);\n\t\tthis._featureRestrictionCallback = BX.prop.getString(this._settings, \"featureRestrictionCallback\", '');\n\t\tthis._isPermitted = (this._featureRestrictionCallback === '');\n\t\tthis._showFeedbackLink = this._isPermitted ? BX.prop.getBoolean(this._settings, \"showFeedbackLink\", false) : false;\n\n\t\tthis.doInitialize();\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tlayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._domNodes.requisiteClearButton = Tag.render`\n\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onSearchStringClear.bind(this)}\"></button>`;\n\n\t\tthis._domNodes.requisiteSearchButton = Tag.render`\n\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-search\" onclick=\"${this.onSearchButtonClick.bind(this)}\"></button>`;\n\n\t\tlet placeholder = this._placeholderText.length ?\n\t\t\tLoc.getMessage('REQUISITE_AUTOCOMPLETE_FILL_IN').replace('#FIELD_NAME#', this._placeholderText) : \"\";\n\t\tthis._domNodes.requisiteSearchString = Tag.render`\n\t\t\t<input type=\"text\" placeholder=\"${Text.encode(placeholder)}\" class=\"ui-ctl-element ui-ctl-textbox\" />`;\n\n\t\tif (!this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.setAttribute('onclick', this._featureRestrictionCallback);\n\t\t}\n\t\tthis.refreshLayout();\n\n\t\tDom.append(Tag.render`\n\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t${this._domNodes.requisiteSearchButton}\n\t\t\t${this._domNodes.requisiteClearButton}\n\t\t\t${this._domNodes.requisiteSearchString}\n\t\t</div>`, container);\n\n\t\tthis.initDropdown();\n\n\t\tthis.refreshLayout();\n\t}\n\n\tinitDropdown()\n\t{\n\t\tif (!this._dropdown)\n\t\t{\n\t\t\tthis._dropdown = new Dropdown(\n\t\t\t\t{\n\t\t\t\t\tsearchAction: BX.prop.getString(this._settings, \"searchAction\", \"\"),\n\t\t\t\t\titems: [],\n\t\t\t\t\tenableCreation: true,\n\t\t\t\t\tenableCreationOnBlur: false,\n\t\t\t\t\tautocompleteDelay: 1000,\n\t\t\t\t\tmessages:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcreationLegend: Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADD_REQUISITE'),\n\t\t\t\t\t\t\tnotFound: Loc.getMessage('REQUISITE_AUTOCOMPLETE_NOT_FOUND'),\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSelect', this.onEntitySelect.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onAdd', this.onEntityAdd.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onReset', this.onEntityReset.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onBeforeSearchStart', this.onEntitySearchStart.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onEntitySearchComplete.bind(this));\n\t\t}\n\t\tthis._dropdown.searchOptions = this._context;\n\t\tthis._dropdown.targetElement = this._domNodes.requisiteSearchString;\n\t\tthis._dropdown.init();\n\t\tthis.setEnabled(this._isEnabled);\n\t\tthis.setShowFeedbackLink(this._showFeedbackLink);\n\t}\n\n\tsetCurrentItem(autocompleteItem)\n\t{\n\t\tthis._currentItem = Type.isPlainObject(autocompleteItem) ? autocompleteItem : null;\n\t\tthis.refreshLayout();\n\t}\n\n\tsetShowFeedbackLink(show)\n\t{\n\t\tthis._showFeedbackLink = !!show;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setFeedbackFormParams(this._showFeedbackLink ? BX.prop.getObject(this._settings, \"feedbackFormParams\", {}) : {});\n\t\t}\n\t}\n\n\trefreshLayout()\n\t{\n\n\t\tif (!Type.isDomNode(this._domNodes.requisiteSearchString) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteSearchButton) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteClearButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = '';\n\n\t\tif (Type.isObject(this._currentItem) && this._isPermitted)\n\t\t{\n\t\t\tlet textParts = [this._currentItem.title];\n\t\t\tif (Type.isStringFilled(this._currentItem.subTitle))\n\t\t\t{\n\t\t\t\ttextParts.push(this._currentItem.subTitle);\n\t\t\t}\n\t\t\ttext = textParts.join(', ');\n\n\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"\");\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"none\");\n\t\t\tif (this._isEnabled || !this._isPermitted)\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\t}\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(this._isPermitted && BX.prop.getBoolean(this._settings, \"canAddRequisite\", false));\n\t\t\t}\n\t\t}\n\n\t\tthis._domNodes.requisiteSearchString.value = text;\n\t\tthis.setLoading(false);\n\t}\n\n\tgetState()\n\t{\n\t\tlet state = {\n\t\t\tcurrentItem: this._currentItem,\n\t\t\tsearchQuery: Type.isDomNode(this._domNodes.requisiteSearchString) ?\n\t\t\t\tthis._domNodes.requisiteSearchString.value : null,\n\t\t\titems: Type.isObject(this._dropdown) ? this._dropdown.getItems() : []\n\t\t};\n\t\treturn state;\n\t}\n\n\tsetState(state)\n\t{\n\t\tif (!Type.isPlainObject(state))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentItem(Type.isPlainObject(state.currentItem) ? state.currentItem : null);\n\t\tif (Type.isString(state.searchQuery) && Type.isDomNode(this._domNodes.requisiteSearchString) && this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.value = state.searchQuery;\n\t\t}\n\t\tif (Type.isArray(state.items))\n\t\t{\n\t\t\tthis._dropdown.setItems(state.items);\n\t\t}\n\t}\n\n\tsetContext(context)\n\t{\n\t\tthis._context = Type.isPlainObject(context) ? context : {};\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.searchOptions = this._context;\n\t\t}\n\t}\n\n\tsetPlaceholderText(text)\n\t{\n\t\tthis._placeholderText = Type.isStringFilled(text) ? text : \"\";\n\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tlet placeholder = this._placeholderText.length ?\n\t\t\t\tLoc.getMessage('REQUISITE_AUTOCOMPLETE_FILL_IN').replace('#FIELD_NAME#', this._placeholderText) : \"\";\n\n\t\t\tthis._domNodes.requisiteSearchString.placeholder = placeholder;\n\t\t}\n\t}\n\n\tsetEnabled(enabled)\n\t{\n\t\tthis._isEnabled = !!enabled;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setMinSearchStringLength(this._isEnabled ? 3: 99999);\n\t\t}\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tisLoading = !!isLoading;\n\t\tif (isLoading === this._isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isLoading = isLoading;\n\t\tlet searchBtn = this._domNodes.requisiteSearchButton;\n\t\tif (Type.isDomNode(searchBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-search');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-search');\n\t\t\t}\n\t\t}\n\n\t\tlet clearBtn = this._domNodes.requisiteClearButton;\n\t\tif (Type.isDomNode(clearBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-clear');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-clear');\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchStringClear()\n\t{\n\t\tthis.emit('onClear');\n\t}\n\n\tonSearchButtonClick()\n\t{\n\t\tif (Type.isObject(this._dropdown))\n\t\t{\n\t\t\tthis._dropdown.handleTypeInField();\n\t\t}\n\t}\n\n\tonEntitySelect(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tlet selected = data[1];\n\n\t\tdropdown.getPopupWindow().close();\n\t\tthis.setCurrentItem(selected);\n\n\t\tthis.emit('onSelectValue', selected);\n\t}\n\n\tonEntityAdd(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tdropdown.getPopupWindow().close();\n\t\tthis.emit('onCreateNewItem');\n\t}\n\n\tonEntityReset()\n\t{\n\t\tthis.setCurrentItem(null);\n\t}\n\n\tonEntitySearchStart()\n\t{\n\t\tthis.setLoading(true);\n\t\tthis._dropdown.setItems([]);\n\t}\n\n\tonEntitySearchComplete()\n\t{\n\t\tthis.setLoading(false);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new RequisiteAutocompleteField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass Dropdown extends BX.UI.Dropdown\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.feedbackFormParams = BX.prop.getObject(options, \"feedbackFormParams\", {});\n\t\tthis.canAddRequisite = BX.prop.getBoolean(options, \"canAddRequisite\", false);\n\t}\n\n\tisTargetElementChanged()\n\t{\n\t\treturn false;\n\t}\n\n\tgetItemsListContainer()\n\t{\n\t\tif (!this.itemListContainer)\n\t\t{\n\t\t\tthis.itemListContainer = BX.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'ui-dropdown-container rq-dropdown-container'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this.itemListContainer;\n\t}\n\n\tsetFeedbackFormParams(feedbackFormParams)\n\t{\n\t\tthis.feedbackFormParams = Type.isPlainObject(feedbackFormParams) ? feedbackFormParams : {};\n\t}\n\n\tsetCanAddRequisite(canAdd)\n\t{\n\t\tthis.canAddRequisite = !!canAdd;\n\t}\n\n\tsetMinSearchStringLength(length)\n\t{\n\t\tthis.minSearchStringLength = length;\n\t}\n\n\tgetPopupAlertContainer()\n\t{\n\t\tif (!this.popupAlertContainer)\n\t\t{\n\t\t\tlet items = [];\n\t\t\tlet feedbackAvailable = (Object.keys(this.getFeedbackFormParams()).length > 0);\n\t\t\tif (feedbackAvailable)\n\t\t\t{\n\t\t\t\tlet textParts = Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE').split('#ADVICE_NEW_SERVICE_LINK#');\n\t\t\t\tlet item = Tag.render`<div class=\"crm-rq-popup-item crm-rq-popup-item-helper\"></div>`;\n\n\t\t\t\tif (textParts[0] && textParts[0].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[0]), item);\n\t\t\t\t}\n\n\t\t\t\tDom.append(Tag.render`<a href=\"\" onclick=\"${this.showFeedbackForm.bind(this)}\">${Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE_LINK')}</a>`, item);\n\n\t\t\t\tif (textParts[1] && textParts[1].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[1]), item);\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\tif (this.canAddRequisite)\n\t\t\t{\n\t\t\t\titems.push(Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button class=\"crm-rq-popup-item-add-new-btn\">\n\t\t\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\" onclick=\"${this.onEmptyValueEvent.bind(this)}\"></span>\n\t\t\t\t\t\t\t<span class=\"crm-rq-popup-item-add-new-btn-text\" onclick=\"${this.onEmptyValueEvent.bind(this)}\">${BX.prop.getString(this.messages, \"creationLegend\")}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`);\n\t\t\t}\n\n\t\t\tthis.popupAlertContainer = items.length ? Tag.render`\n\t\t\t\t<div class=\"crm-rq-popup-wrapper\">\n\t\t\t\t\t<div class=\"crm-rq-popup-items-list\">${items}</div>\n\t\t\t\t</div>\n\t\t\t` : Tag.render`<div></div>`;\n\t\t}\n\t\tthis.togglePopupAlertVisibility();\n\t\treturn this.popupAlertContainer;\n\t}\n\n\ttogglePopupAlertVisibility()\n\t{\n\t\tif (Type.isDomNode(this.popupAlertContainer))\n\t\t{\n\t\t\tthis.popupAlertContainer.style.display = (this.getItems().length > 0) ? \"none\" : \"\";\n\t\t}\n\t}\n\n\tsetItems(items)\n\t{\n\t\tsuper.setItems(items);\n\t\tthis.togglePopupAlertVisibility();\n\t}\n\n\tgetNewAlertContainer(items)\n\t{\n\t\treturn null;\n\t}\n\n\tdisableTargetElement()\n\t{\n\t\t// cancel original handler\n\t}\n\n\tgetFeedbackFormParams()\n\t{\n\t\treturn this.feedbackFormParams;\n\t}\n\n\tshowFeedbackForm(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getPopupWindow().close();\n\t\tif (!this._feedbackForm)\n\t\t{\n\t\t\tthis._feedbackForm = new BX.UI.Feedback.Form(this.getFeedbackFormParams());\n\t\t}\n\t\tthis._feedbackForm.openPanel();\n\t}\n}"],"names":["RequisiteAutocompleteField","setEventNamespace","_id","_settings","_placeholderText","_isLoading","_isEnabled","_context","_currentItem","_domNodes","_dropdown","id","settings","BX","type","isNotEmptyString","util","getRandomString","prop","getString","getObject","getBoolean","_featureRestrictionCallback","_isPermitted","_showFeedbackLink","doInitialize","container","Type","isDomNode","requisiteClearButton","Tag","render","onSearchStringClear","bind","requisiteSearchButton","onSearchButtonClick","placeholder","length","Loc","getMessage","replace","requisiteSearchString","Text","encode","setAttribute","refreshLayout","Dom","append","initDropdown","Dropdown","searchAction","items","enableCreation","enableCreationOnBlur","autocompleteDelay","messages","creationLegend","notFound","EventEmitter","subscribe","onEntitySelect","onEntityAdd","onEntityReset","onEntitySearchStart","onEntitySearchComplete","searchOptions","targetElement","init","setEnabled","setShowFeedbackLink","autocompleteItem","isPlainObject","show","setFeedbackFormParams","text","isObject","textParts","title","isStringFilled","subTitle","push","join","style","setCanAddRequisite","value","setLoading","state","currentItem","searchQuery","getItems","setCurrentItem","isString","isArray","setItems","context","enabled","setMinSearchStringLength","isLoading","searchBtn","classList","remove","add","clearBtn","emit","handleTypeInField","event","data","getData","dropdown","selected","getPopupWindow","close","self","initialize","options","feedbackFormParams","canAddRequisite","itemListContainer","create","attrs","className","canAdd","minSearchStringLength","popupAlertContainer","feedbackAvailable","Object","keys","getFeedbackFormParams","split","item","document","createTextNode","showFeedbackForm","onEmptyValueEvent","togglePopupAlertVisibility","display","preventDefault","_feedbackForm","UI","Feedback","Form","openPanel"],"mappings":"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"}