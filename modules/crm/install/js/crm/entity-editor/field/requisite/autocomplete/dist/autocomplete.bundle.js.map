{"version":3,"file":"autocomplete.bundle.js","sources":["../src/autocomplete.js"],"sourcesContent":["import {Dom, Loc, Tag, Text, Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport 'ui.design-tokens';\nimport {DetailSearch as DetailSearchPlacement} from \"crm.placement.detailsearch\"\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\"\nimport \"./autocomplete.css\"\n\nexport class RequisiteAutocompleteField extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Requisite.Autocomplete');\n\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._placeholderText = null;\n\t\tthis._isLoading = false;\n\t\tthis._isEnabled = false;\n\t\tthis._context = {};\n\t\tthis._currentItem = null;\n\n\t\tthis._domNodes = {};\n\t\tthis._dropdown = null;\n\n\t\tthis.currentSearchQueryText = \"\";\n\t\tthis.detailAutocompletePlacement = null;\n\t\tthis.entitySearchPopupCloseHandler = null;\n\t\tthis.placementsParamsHandler = null;\n\t\tthis.searchQueryInputHandler = null;\n\t\tthis.beforeAddPlacementItemsHandler = null;\n\t\tthis.placementSearchParamsHandler = null;\n\t\tthis.placementSetFoundItemsHandler = null;\n\t\tthis.placementEntitySelectHandler = null;\n\t\tthis.externalSearchHandler = null;\n\t\tthis.externalSearchResultHandlerList = null;\n\n\t\tthis.beforeEntitySearchPopupCloseHandler = null;\n\t\tthis.onDocumentClickConfirm = null;\n\n\t\tthis.creatingItem = null;\n\n\t\tthis.clientResolverPlacementParams = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._placeholderText = BX.prop.getString(this._settings, \"placeholderText\", \"\");\n\t\tthis._context = BX.prop.getObject(this._settings, \"context\", {});\n\t\tthis._isEnabled = BX.prop.getBoolean(this._settings, \"enabled\", false);\n\t\tthis._featureRestrictionCallback = BX.prop.getString(this._settings, \"featureRestrictionCallback\", '');\n\t\tthis._isPermitted = (this._featureRestrictionCallback === '');\n\t\tthis._showFeedbackLink = this._isPermitted ? BX.prop.getBoolean(this._settings, \"showFeedbackLink\", false) : false;\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(\n\t\t\tBX.prop.getObject(this._settings, \"clientResolverPlacementParams\", null)\n\t\t);\n\t\tthis.externalSearchHandler = this.onExternalSearch.bind(this);\n\t\tthis.externalSearchResultHandlerList = new Map();\n\n\t\tthis.doInitialize();\n\t}\n\n\tfilterclientResolverPlacementParams(params)\n\t{\n\t\tif (!Type.isObject(params))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisPlacement: BX.prop.getBoolean(params, \"isPlacement\", false),\n\t\t\tnumberOfPlacements: BX.prop.getInteger(params, \"numberOfPlacements\", 0),\n\t\t\tcountryId: BX.prop.getInteger(params, \"countryId\", 0),\n\t\t};\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tlayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._domNodes.requisiteClearButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onSearchStringClear.bind(this)}\"></button>`;\n\n\t\tthis._domNodes.requisiteSearchButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-search\" onclick=\"${this.onSearchButtonClick.bind(this)}\"></button>`;\n\n\t\tlet placeholder = this._placeholderText;\n\t\tthis._domNodes.requisiteSearchString = Tag.render`\n\t\t\t<input type=\"text\" placeholder=\"${Text.encode(placeholder)}\" class=\"ui-ctl-element ui-ctl-textbox\" />`;\n\n\t\tif (!this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.setAttribute('onclick', this._featureRestrictionCallback);\n\t\t}\n\t\tthis.refreshLayout();\n\n\t\tDom.append(Tag.render`\n\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t${this._domNodes.requisiteSearchButton}\n\t\t\t${this._domNodes.requisiteClearButton}\n\t\t\t${this._domNodes.requisiteSearchString}\n\t\t</div>`, container);\n\n\t\tthis.initDropdown();\n\n\t\tthis.refreshLayout();\n\t}\n\n\tinitDropdown()\n\t{\n\t\tif (!this._dropdown)\n\t\t{\n\t\t\tconst isPlacement = BX.prop.getBoolean(this.clientResolverPlacementParams, \"isPlacement\", false);\n\t\t\tthis._dropdown = new Dropdown(\n\t\t\t\t{\n\t\t\t\t\tisDisabled: !this._isPermitted,\n\t\t\t\t\tsearchAction: BX.prop.getString(this._settings, \"searchAction\", \"\"),\n\t\t\t\t\texternalSearchHandler: isPlacement ? this.externalSearchHandler : null,\n\t\t\t\t\titems: [],\n\t\t\t\t\tenableCreation: true,\n\t\t\t\t\tenableCreationOnBlur: true,\n\t\t\t\t\tautocompleteDelay: 1000,\n\t\t\t\t\tmessages:\n\t\t\t\t\t{\n\t\t\t\t\t\tcreationLegend: Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADD_REQUISITE'),\n\t\t\t\t\t\tnotFound: Loc.getMessage('REQUISITE_AUTOCOMPLETE_NOT_FOUND'),\n\t\t\t\t\t},\n\t\t\t\t\tplacementParams: this.clientResolverPlacementParams\n\t\t\t\t}\n\t\t\t);\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSelect', this.onEntitySelect.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onAdd', this.onEntityAdd.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onReset', this.onEntityReset.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onBeforeSearchStart', this.onEntitySearchStart.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onEntitySearchComplete.bind(this));\n\t\t\tBX.addCustomEvent(this._dropdown, 'Dropdown:onGetPopupAlertContainer', this.onGetPopupAlertContainer.bind(this));\n\t\t}\n\t\tthis._dropdown.searchOptions = this._context;\n\t\tthis._dropdown.targetElement = this._domNodes.requisiteSearchString;\n\t\tthis._dropdown.init();\n\n\t\tthis.setEnabled(this._isEnabled);\n\t\tthis.setShowFeedbackLink(this._showFeedbackLink);\n\t}\n\n\tgetDropdownPopup()\n\t{\n\t\treturn this._dropdown.getPopupWindow();\n\t}\n\n\tcloseDropdownPopup()\n\t{\n\t\tconst dropownPopup = this.getDropdownPopup();\n\t\tif (dropownPopup)\n\t\t{\n\t\t\tdropownPopup.close();\n\t\t}\n\t}\n\n\tsetCurrentItem(autocompleteItem)\n\t{\n\t\tthis._currentItem = Type.isPlainObject(autocompleteItem) ? autocompleteItem : null;\n\t\tthis.refreshLayout();\n\t}\n\n\tsetShowFeedbackLink(show)\n\t{\n\t\tthis._showFeedbackLink = !!show;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setFeedbackFormParams(this._showFeedbackLink ? BX.prop.getObject(this._settings, \"feedbackFormParams\", {}) : {});\n\t\t}\n\t}\n\n\trefreshLayout()\n\t{\n\n\t\tif (!Type.isDomNode(this._domNodes.requisiteSearchString) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteSearchButton) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteClearButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = '';\n\n\t\tif (Type.isObject(this._currentItem) && this._isPermitted)\n\t\t{\n\t\t\tlet textParts = [this._currentItem.title];\n\t\t\tif (Type.isStringFilled(this._currentItem.subTitle))\n\t\t\t{\n\t\t\t\ttextParts.push(this._currentItem.subTitle);\n\t\t\t}\n\t\t\ttext = textParts.join(', ');\n\n\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"\");\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"none\");\n\t\t\tif (this._isEnabled || !this._isPermitted)\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\t}\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(this._isPermitted && BX.prop.getBoolean(this._settings, \"canAddRequisite\", false));\n\t\t\t}\n\t\t}\n\n\t\tthis._domNodes.requisiteSearchString.value = text;\n\t\tthis.onSearchQueryInput();\n\t\tthis.setLoading(false);\n\t}\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcurrentItem: this._currentItem,\n\t\t\tsearchQuery: Type.isDomNode(this._domNodes.requisiteSearchString) ?\n\t\t\t\tthis._domNodes.requisiteSearchString.value : null,\n\t\t\titems: Type.isObject(this._dropdown) ? this._dropdown.getItems() : []\n\t\t};\n\t}\n\n\tsetState(state)\n\t{\n\t\tif (!Type.isPlainObject(state))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentItem(Type.isPlainObject(state.currentItem) ? state.currentItem : null);\n\t\tif (Type.isString(state.searchQuery) && Type.isDomNode(this._domNodes.requisiteSearchString) && this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.value = state.searchQuery;\n\t\t\tthis.onSearchQueryInput();\n\t\t}\n\t\tif (Type.isArray(state.items))\n\t\t{\n\t\t\tthis._dropdown.setItems(state.items);\n\t\t}\n\t}\n\n\tsetContext(context)\n\t{\n\t\tthis._context = Type.isPlainObject(context) ? context : {};\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.searchOptions = this._context;\n\t\t}\n\t}\n\n\tsetPlaceholderText(text)\n\t{\n\t\tthis._placeholderText = Type.isStringFilled(text) ? text : \"\";\n\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.placeholder = this._placeholderText;\n\t\t}\n\t}\n\n\tsetClientResolverPlacementParams(params)\n\t{\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(params);\n\t}\n\n\tsetEnabled(enabled)\n\t{\n\t\tthis._isEnabled = !!enabled;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setMinSearchStringLength(this._isEnabled ? 3: 99999);\n\t\t}\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tisLoading = !!isLoading;\n\t\tif (isLoading === this._isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isLoading = isLoading;\n\t\tlet searchBtn = this._domNodes.requisiteSearchButton;\n\t\tif (Type.isDomNode(searchBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-search');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-search');\n\t\t\t}\n\t\t}\n\n\t\tlet clearBtn = this._domNodes.requisiteClearButton;\n\t\tif (Type.isDomNode(clearBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-clear');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-clear');\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchStringClear()\n\t{\n\t\tthis.emit('onClear');\n\t}\n\n\tonSearchButtonClick()\n\t{\n\t\tif (Type.isObject(this._dropdown))\n\t\t{\n\t\t\tthis._dropdown.handleTypeInField();\n\t\t}\n\t}\n\n\tonEntitySelect(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tlet selected = data[1];\n\n\t\tif (dropdown === this._dropdown && selected[\"appSid\"] && !selected[\"created\"])\n\t\t{\n\t\t\tif (!this.creatingItem)\n\t\t\t{\n\t\t\t\tthis.creatingItem = selected;\n\t\t\t\tselected._loader = new BX.Loader({\n\t\t\t\t\ttarget: selected.node,\n\t\t\t\t\tsize: 40\n\t\t\t\t});\n\t\t\t\tselected.node.classList.add('client-editor-active');\n\t\t\t\tselected.node.parentNode.classList.add('client-editor-inactive');\n\t\t\t\tselected._loader.show();\n\n\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:pick\",\n\t\t\t\t\t[{appSid: selected[\"appSid\"], data: selected}]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectEntity(selected);\n\t}\n\n\tselectEntity(selected)\n\t{\n\t\tif (this.creatingItem)\n\t\t{\n\t\t\tfor (let prop in selected)\n\t\t\t{\n\t\t\t\tif (selected.hasOwnProperty(prop))\n\t\t\t\t{\n\t\t\t\t\tthis.creatingItem[prop] = selected[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.creatingItem[\"created\"] = true;\n\t\t\tthis.creatingItem = null;\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\tthis.onDocumentClickConfirm.close();\n\t\t\tthis.onDocumentClickConfirm = null;\n\t\t}\n\n\t\tthis.closeDropdownPopup();\n\n\t\tthis.setCurrentItem(selected);\n\t\tthis.emit('onSelectValue', selected);\n\t}\n\n\tonEntityAdd(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tdropdown.getPopupWindow().close();\n\t\tthis.emit('onCreateNewItem');\n\t}\n\n\tonEntityReset()\n\t{\n\t\tthis.setCurrentItem(null);\n\t}\n\n\tonEntitySearchStart()\n\t{\n\t\tthis.setLoading(true);\n\t\tthis._dropdown.setItems([]);\n\t}\n\n\tonExternalSearch()\n\t{\n\t\treturn new Promise(\n\t\t\t(resolve) => {\n\t\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t\t{\n\t\t\t\t\tconst params = {appId: 0};\n\t\t\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:startDefaultSearch\", [params]);\n\t\t\t\t\tif (Type.isInteger(params[\"appId\"]) && params[\"appId\"] > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.externalSearchResultHandlerList.has(params[\"appId\"]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.externalSearchResultHandlerList.set(params[\"appId\"], (result) => { resolve(result) });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve([]);\n\t\t\t}\n\t\t);\n\t}\n\n\tinitPlacement(searchControl, container)\n\t{\n\t\tif (!this.detailAutocompletePlacement)\n\t\t{\n\t\t\tlet isAutocompletePlacementEnabled = (\n\t\t\t\tType.isPlainObject(this.clientResolverPlacementParams)\n\t\t\t\t&& this.clientResolverPlacementParams.hasOwnProperty(\"numberOfPlacements\")\n\t\t\t\t&& Type.isNumber(this.clientResolverPlacementParams[\"numberOfPlacements\"])\n\t\t\t\t&& this.clientResolverPlacementParams[\"numberOfPlacements\"] > 0\n\t\t\t);\n\n\t\t\tif (isAutocompletePlacementEnabled)\n\t\t\t{\n\t\t\t\tthis.detailAutocompletePlacement = new DetailSearchPlacement(\"CRM_REQUISITE_AUTOCOMPLETE\");\n\t\t\t}\n\n\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t{\n\t\t\t\tif (!this.dropdownPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.dropdownPopup = this._dropdown.getPopupWindow();\n\t\t\t\t}\n\n\t\t\t\tthis.beforeEntitySearchPopupCloseHandler = this.onBeforeEntitySearchPopupClose.bind(\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.dropdownPopup._tryCloseByEvent.bind(this.dropdownPopup)\n\t\t\t\t);\n\t\t\t\tthis.dropdownPopup._tryCloseByEvent = this.beforeEntitySearchPopupCloseHandler;\n\n\t\t\t\tthis.entitySearchPopupCloseHandler = this.onEntitySearchPopupClose.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.dropdownPopup,\n\t\t\t\t\t'onPopupClose',\n\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementsParamsHandler = this.onPlacementsParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:params\",\n\t\t\t\t\tthis.placementsParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.beforeAddPlacementItemsHandler = this.onBeforeAppendPlacementItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSearchParamsHandler = this.onPlacamentSearchParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:searchParams\",\n\t\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSetFoundItemsHandler = this.onPlacementSetFoundItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementEntitySelectHandler = this.onPlacementEntitySelect.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:select\",\n\t\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t\t);\n\n\t\t\t\tthis.detailAutocompletePlacement.show(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tcontainer.querySelector('div.crm-rq-popup-item-add-new'),\n\t\t\t\t\t{\n\t\t\t\t\t\thideLoader: true\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t\t{\n\t\t\t\tif (!this.searchQueryInputHandler)\n\t\t\t\t{\n\t\t\t\t\tthis.searchQueryInputHandler = this.onSearchQueryInput.bind(this);\n\t\t\t\t}\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchQueryInput()\n\t{\n\t\tif (this._domNodes.requisiteSearchString.value !== this.currentSearchQueryText)\n\t\t{\n\t\t\tthis.currentSearchQueryText = this._domNodes.requisiteSearchString.value;\n\t\t\tthis.fireChangeSearchQueryEvent();\n\t\t}\n\t}\n\n\tfireChangeSearchQueryEvent()\n\t{\n\t\tif (this.detailAutocompletePlacement && Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tBX.onCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:changeQuery\",\n\t\t\t\t[{currentSearchQuery: this._domNodes.requisiteSearchString.value}]\n\t\t\t);\n\t\t}\n\t}\n\n\tonEntitySearchComplete(/*dropdown, items*/)\n\t{\n\t\tthis.setLoading(false);\n\t}\n\n\tonGetPopupAlertContainer(searchControl, container)\n\t{\n\t\tthis.initPlacement(searchControl, container);\n\t}\n\t\n\tonBeforeEntitySearchPopupClose(originalHandler, event)\n\t{\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\tconst eventResult = {active: false};\n\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:active\", [eventResult]);\n\t\tif (eventResult.active)\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\tconst f = function(messageBox, e) {\n\t\t\t\tBX.bind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\t\tmessageBox.close();\n\t\t\t\tthis.onDocumentClickConfirm = null;\n\t\t\t\tBX.eventCancelBubble(e);\n\t\t\t}.bind(this);\n\t\t\tthis.onDocumentClickConfirm = MessageBox.create({\n\t\t\t\tmessage: BX.message('CRM_EDITOR_PLACEMENT_CAUTION') || 'Dow you want to terminate process?',\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tmodal: true,\n\t\t\t\tonOk: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t\tthis._dropdown.documentClickHandler(e);\n\t\t\t\t\toriginalHandler(e);\n\t\t\t\t}.bind(this),\n\t\t\t\tonCancel: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t}\n\t\t\t});\n\t\t\tBX.eventCancelBubble(event);\n\t\t\tthis.onDocumentClickConfirm.show();\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\toriginalHandler(event);\n\t}\n\n\tonEntitySearchPopupClose()\n\t{\n\t\tthis.destroyPlacement();\n\t}\n\n\tdestroyPlacement() {\n\t\tif (this.searchQueryInputHandler) {\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\tthis.searchQueryInputHandler = null;\n\t\t}\n\n\t\tif (this._dropdown && this._dropdown.hasOwnProperty(\"documentClickHandler\"))\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t}\n\t\tif (this.detailAutocompletePlacement)\n\t\t{\n\t\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\t\tif (dropdownPopup)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\n\t\t\t\t\tdropdownPopup,\n\t\t\t\t\t\"onPopupClose\",\n\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.entitySearchPopupCloseHandler = null;\n\n\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:destroy\");\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:params\",\n\t\t\t\tthis.placementsParamsHandler\n\t\t\t);\n\t\t\tthis.placementsParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t);\n\t\t\tthis.beforeAddPlacementItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:searchParams\",\n\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t);\n\t\t\tthis.placementSearchParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t);\n\t\t\tthis.placementSetFoundItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:select\",\n\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t);\n\t\t\tthis.placementEntitySelectHandler = null;\n\n\t\t\tthis.detailAutocompletePlacement = null;\n\n\t\t\tthis.creatingItem = null;\n\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\t}\n\n\tonPlacementsParams(params)\n\t{\n\t\tif (Type.isObject(params))\n\t\t{\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setPlacementParams(this.clientResolverPlacementParams);\n\t\t\t}\n\n\t\t\tif (this.clientResolverPlacementParams)\n\t\t\t{\n\t\t\t\tif (params.hasOwnProperty(\"placementParams\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"placementParams\"] = this.clientResolverPlacementParams;\n\t\t\t\t}\n\t\t\t\tif (params.hasOwnProperty(\"currentSearchQuery\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"currentSearchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonBeforeAppendPlacementItems()\n\t{\n\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\tif (dropdownPopup)\n\t\t{\n\t\t\tBX.addClass(dropdownPopup.popupContainer, \"client-editor-popup\");\n\t\t}\n\t}\n\n\tonPlacamentSearchParams(params)\n\t{\n\t\tparams[\"searchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t}\n\n\tonPlacementSetFoundItems(placementItem, results)\n\t{\n\t\tconst items = [];\n\t\tresults.forEach(function(result) {\n\t\t\titems.push({\n\t\t\t\tid: result.id,\n\t\t\t\ttitle: result.name,\n\t\t\t\tappSid: placementItem[\"appSid\"],\n\t\t\t\tmodule: 'crm',\n\t\t\t\tsubModule: 'rest',\n\t\t\t\tsubTitle: placementItem[\"title\"],\n\t\t\t\tattributes: {\n\t\t\t\t\tphone: result.phone ? [{value: result.phone}] : '',\n\t\t\t\t\temail: result.email ? [{value: result.email}] : '',\n\t\t\t\t\tweb: result.web ? [{value: result.web}] : ''\n\t\t\t\t}\n\t\t\t});\n\t\t}.bind(this));\n\n\t\tlet appId = parseInt(placementItem[\"placementInfo\"][\"id\"]);\n\t\tif (appId > 0 && this.externalSearchResultHandlerList.has(appId))\n\t\t{\n\t\t\tthis.externalSearchResultHandlerList.get(appId)(items);\n\t\t\tthis.externalSearchResultHandlerList.delete(appId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._dropdown.setItems(items);\n\t\t}\n\t}\n\n\tonPlacementEntitySelect(data) {\n\t\tconst entityData = {\n\t\t\ttype: data[\"entityType\"],\n\t\t\tid: data[\"id\"],\n\t\t\ttitle: data[\"title\"],\n\t\t\tfields: data[\"fields\"]\n\t\t};\n\t\tif (\n\t\t\tType.isPlainObject(entityData[\"fields\"])\n\t\t\t&& entityData[\"fields\"].hasOwnProperty(\"RQ_ADDR\")\n\t\t\t&& Type.isPlainObject(entityData[\"fields\"][\"RQ_ADDR\"])\n\t\t)\n\t\t{\n\t\t\tconst responseHandler = function(response)\n\t\t\t{\n\t\t\t\tconst status = BX.prop.getString(response, \"status\", \"\");\n\t\t\t\tconst data = BX.prop.getObject(response, \"data\", {});\n\t\t\t\tconst messages = [];\n\n\t\t\t\tif (status === \"error\")\n\t\t\t\t{\n\t\t\t\t\tconst errors = BX.prop.getArray(response, \"errors\", []);\n\t\t\t\t\tfor (let i = 0; i < errors.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tmessages.push(BX.prop.getString(errors[i], \"message\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (messages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontent: messages.join(\"<br>\"),\n\t\t\t\t\t\t\tposition: \"top-center\",\n\t\t\t\t\t\t\tautoHideDelay: 10000\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tdelete entityData[\"fields\"][\"RQ_ADDR\"];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tentityData[\"fields\"][\"RQ_ADDR\"] = data;\n\t\t\t\t}\n\t\t\t\tthis.selectEntity(entityData);\n\t\t\t}.bind(this);\n\n\t\t\tBX.ajax.runAction(\n\t\t\t\t'crm.requisite.address.getLocationAddressJsonByFields',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taddresses: entityData[\"fields\"][\"RQ_ADDR\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(responseHandler, responseHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectEntity(entityData);\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new RequisiteAutocompleteField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass Dropdown extends BX.UI.Dropdown\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.feedbackFormParams = BX.prop.getObject(options, \"feedbackFormParams\", {});\n\t\tthis.canAddRequisite = BX.prop.getBoolean(options, \"canAddRequisite\", false);\n\t\tthis.externalSearchHandler = BX.prop.getFunction(options, \"externalSearchHandler\", null);\n\t\tthis.placementParams = BX.prop.getObject(options, \"placementParams\", null);\n\t}\n\n\tsetPlacementParams(params)\n\t{\n\t\tthis.placementParams = params;\n\t}\n\n\tisTargetElementChanged()\n\t{\n\t\treturn false;\n\t}\n\n\tgetItemsListContainer()\n\t{\n\t\tif (!this.itemListContainer)\n\t\t{\n\t\t\tthis.itemListContainer = BX.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'ui-dropdown-container rq-dropdown-container'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this.itemListContainer;\n\t}\n\n\tsetFeedbackFormParams(feedbackFormParams)\n\t{\n\t\tthis.feedbackFormParams = Type.isPlainObject(feedbackFormParams) ? feedbackFormParams : {};\n\t}\n\n\tsetCanAddRequisite(canAdd)\n\t{\n\t\tthis.canAddRequisite = !!canAdd;\n\t}\n\n\tsetMinSearchStringLength(length)\n\t{\n\t\tthis.minSearchStringLength = length;\n\t}\n\n\tgetPopupAlertContainer()\n\t{\n\t\tif (!this.popupAlertContainer)\n\t\t{\n\t\t\tlet items = [];\n\t\t\tlet feedbackAvailable = (Object.keys(this.getFeedbackFormParams()).length > 0);\n\t\t\tif (feedbackAvailable)\n\t\t\t{\n\t\t\t\tlet textParts = Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE').split('#ADVICE_NEW_SERVICE_LINK#');\n\t\t\t\tlet item = Tag.render`<div class=\"crm-rq-popup-item crm-rq-popup-item-helper\"></div>`;\n\n\t\t\t\tif (textParts[0] && textParts[0].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[0]), item);\n\t\t\t\t}\n\n\t\t\t\tDom.append(Tag.render`<a href=\"\" onclick=\"${this.showFeedbackForm.bind(this)}\">${Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE_LINK')}</a>`, item);\n\n\t\t\t\tif (textParts[1] && textParts[1].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[1]), item);\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\tif (this.canAddRequisite)\n\t\t\t{\n\t\t\t\titems.push(Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button class=\"crm-rq-popup-item-add-new-btn\">\n\t\t\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"></span>\n\t\t\t\t\t\t\t<span class=\"crm-rq-popup-item-add-new-btn-text\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"\n\t\t\t\t\t\t\t\t>${BX.prop.getString(this.messages, \"creationLegend\")}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`);\n\t\t\t}\n\n\t\t\tthis.popupAlertContainer = items.length ? Tag.render`\n\t\t\t\t<div class=\"crm-rq-popup-wrapper\">\n\t\t\t\t\t<div class=\"crm-rq-popup-items-list\">${items}</div>\n\t\t\t\t</div>\n\t\t\t` : Tag.render`<div></div>`;\n\n\t\t\tBX.onCustomEvent(this, \"Dropdown:onGetPopupAlertContainer\", [this, this.popupAlertContainer]);\n\t\t}\n\n\t\tthis.togglePopupAlertVisibility();\n\n\t\treturn this.popupAlertContainer;\n\t}\n\n\tgetTargetElementValue()\n\t{\n\t\tif (this.targetElement !== \"undefined\" && Type.isStringFilled(this.targetElement[\"value\"]))\n\t\t{\n\t\t\treturn this.targetElement[\"value\"].trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\ttogglePopupAlertVisibility()\n\t{\n\t\tif (Type.isDomNode(this.popupAlertContainer))\n\t\t{\n\t\t\tconst numberOfPlacements = BX.prop.getInteger(this.placementParams, \"numberOfPlacements\", 0);\n\t\t\tconst isVisible = (numberOfPlacements > 0 || this.getItems().length <= 0);\n\t\t\tthis.popupAlertContainer.style.display = isVisible ? \"\" : \"none\";\n\t\t}\n\t}\n\n\tsetItems(items)\n\t{\n\t\tsuper.setItems([{id: 1, name: \"N\", title: \"T\"}]);\n\t\tthis.togglePopupAlertVisibility();\n\t\tsuper.setItems(items);\n\t}\n\n\tgetNewAlertContainer(/*items*/)\n\t{\n\t\treturn null;\n\t}\n\n\tdisableTargetElement()\n\t{\n\t\t// cancel original handler\n\t}\n\n\tgetFeedbackFormParams()\n\t{\n\t\treturn this.feedbackFormParams;\n\t}\n\n\tshowFeedbackForm(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getPopupWindow().close();\n\t\tif (!this._feedbackForm)\n\t\t{\n\t\t\tthis._feedbackForm = new BX.UI.Feedback.Form(this.getFeedbackFormParams());\n\t\t}\n\t\tthis._feedbackForm.openPanel();\n\t}\n\n\tsearchItemsByStr(target)\n\t{\n\t\tif (this.externalSearchHandler)\n\t\t{\n\t\t\treturn this.externalSearchHandler().then((result) => {return result;});\n\t\t}\n\n\t\treturn super.searchItemsByStr(target);\n\t}\n}"],"names":["RequisiteAutocompleteField","setEventNamespace","_id","_settings","_placeholderText","_isLoading","_isEnabled","_context","_currentItem","_domNodes","_dropdown","currentSearchQueryText","detailAutocompletePlacement","entitySearchPopupCloseHandler","placementsParamsHandler","searchQueryInputHandler","beforeAddPlacementItemsHandler","placementSearchParamsHandler","placementSetFoundItemsHandler","placementEntitySelectHandler","externalSearchHandler","externalSearchResultHandlerList","beforeEntitySearchPopupCloseHandler","onDocumentClickConfirm","creatingItem","clientResolverPlacementParams","id","settings","BX","type","isNotEmptyString","util","getRandomString","prop","getString","getObject","getBoolean","_featureRestrictionCallback","_isPermitted","_showFeedbackLink","filterclientResolverPlacementParams","onExternalSearch","bind","Map","doInitialize","params","Type","isObject","isPlacement","numberOfPlacements","getInteger","countryId","container","isDomNode","requisiteClearButton","Tag","render","onSearchStringClear","requisiteSearchButton","onSearchButtonClick","placeholder","requisiteSearchString","Text","encode","setAttribute","refreshLayout","Dom","append","initDropdown","Dropdown","isDisabled","searchAction","items","enableCreation","enableCreationOnBlur","autocompleteDelay","messages","creationLegend","Loc","getMessage","notFound","placementParams","EventEmitter","subscribe","onEntitySelect","onEntityAdd","onEntityReset","onEntitySearchStart","onEntitySearchComplete","addCustomEvent","onGetPopupAlertContainer","searchOptions","targetElement","init","setEnabled","setShowFeedbackLink","getPopupWindow","dropownPopup","getDropdownPopup","close","autocompleteItem","isPlainObject","show","setFeedbackFormParams","text","textParts","title","isStringFilled","subTitle","push","join","style","setCanAddRequisite","value","onSearchQueryInput","setLoading","currentItem","searchQuery","getItems","state","setCurrentItem","isString","isArray","setItems","context","enabled","setMinSearchStringLength","isLoading","searchBtn","classList","remove","add","clearBtn","emit","handleTypeInField","event","data","getData","dropdown","selected","_loader","Loader","target","node","size","parentNode","onCustomEvent","appSid","selectEntity","hasOwnProperty","closeDropdownPopup","Promise","resolve","appId","isInteger","has","set","result","searchControl","isAutocompletePlacementEnabled","isNumber","DetailSearchPlacement","dropdownPopup","onBeforeEntitySearchPopupClose","_tryCloseByEvent","onEntitySearchPopupClose","onPlacementsParams","onBeforeAppendPlacementItems","onPlacamentSearchParams","onPlacementSetFoundItems","onPlacementEntitySelect","querySelector","hideLoader","addEventListener","fireChangeSearchQueryEvent","currentSearchQuery","initPlacement","originalHandler","eventReturnFalse","eventResult","active","unbind","document","documentClickHandler","f","messageBox","e","eventCancelBubble","MessageBox","create","message","buttons","MessageBoxButtons","OK_CANCEL","modal","onOk","button","onCancel","destroyPlacement","removeEventListener","removeCustomEvent","setPlacementParams","addClass","popupContainer","placementItem","results","forEach","name","module","subModule","attributes","phone","email","web","parseInt","get","entityData","fields","responseHandler","response","status","errors","getArray","i","length","UI","Notification","Center","notify","content","position","autoHideDelay","ajax","runAction","addresses","then","self","initialize","options","feedbackFormParams","canAddRequisite","getFunction","itemListContainer","attrs","className","canAdd","minSearchStringLength","popupAlertContainer","feedbackAvailable","Object","keys","getFeedbackFormParams","split","item","createTextNode","showFeedbackForm","onEmptyValueEvent","togglePopupAlertVisibility","trim","isVisible","display","preventDefault","_feedbackForm","Feedback","Form","openPanel"],"mappings":"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"}