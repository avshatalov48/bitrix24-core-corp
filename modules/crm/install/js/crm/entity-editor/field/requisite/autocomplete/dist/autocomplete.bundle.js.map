{"version":3,"file":"autocomplete.bundle.js","sources":["../src/autocomplete.js"],"sourcesContent":["import {Dom, Loc, Tag, Text, Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport 'ui.design-tokens';\nimport {DetailSearch as DetailSearchPlacement} from \"crm.placement.detailsearch\"\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\"\nimport \"./autocomplete.css\"\n\nexport class RequisiteAutocompleteField extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.Requisite.Autocomplete');\n\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._placeholderText = null;\n\t\tthis._isLoading = false;\n\t\tthis._isEnabled = false;\n\t\tthis._context = {};\n\t\tthis._currentItem = null;\n\n\t\tthis._domNodes = {};\n\t\tthis._dropdown = null;\n\n\t\tthis.currentSearchQueryText = \"\";\n\t\tthis.detailAutocompletePlacement = null;\n\t\tthis.entitySearchPopupCloseHandler = null;\n\t\tthis.placementsParamsHandler = null;\n\t\tthis.searchQueryInputHandler = null;\n\t\tthis.beforeAddPlacementItemsHandler = null;\n\t\tthis.placementSearchParamsHandler = null;\n\t\tthis.placementSetFoundItemsHandler = null;\n\t\tthis.placementEntitySelectHandler = null;\n\t\tthis.externalSearchHandler = null;\n\t\tthis.externalSearchResultHandlerList = null;\n\n\t\tthis.beforeEntitySearchPopupCloseHandler = null;\n\t\tthis.onDocumentClickConfirm = null;\n\n\t\tthis.creatingItem = null;\n\n\t\tthis.clientResolverPlacementParams = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._placeholderText = BX.prop.getString(this._settings, \"placeholderText\", \"\");\n\t\tthis._context = BX.prop.getObject(this._settings, \"context\", {});\n\t\tthis._isEnabled = BX.prop.getBoolean(this._settings, \"enabled\", false);\n\t\tthis._featureRestrictionCallback = BX.prop.getString(this._settings, \"featureRestrictionCallback\", '');\n\t\tthis._isPermitted = (this._featureRestrictionCallback === '');\n\t\tthis._showFeedbackLink = this._isPermitted ? BX.prop.getBoolean(this._settings, \"showFeedbackLink\", false) : false;\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(\n\t\t\tBX.prop.getObject(this._settings, \"clientResolverPlacementParams\", null)\n\t\t);\n\t\tthis.externalSearchHandler = this.onExternalSearch.bind(this);\n\t\tthis.externalSearchResultHandlerList = new Map();\n\n\t\tthis.doInitialize();\n\t}\n\n\tfilterclientResolverPlacementParams(params)\n\t{\n\t\tif (!Type.isObject(params))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisPlacement: BX.prop.getBoolean(params, \"isPlacement\", false),\n\t\t\tnumberOfPlacements: BX.prop.getInteger(params, \"numberOfPlacements\", 0),\n\t\t\tcountryId: BX.prop.getInteger(params, \"countryId\", 0),\n\t\t\tdefaultAppInfo: BX.prop.getObject(params, \"defaultAppInfo\", {}),\n\t\t};\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tlayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._domNodes.requisiteClearButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.onSearchStringClear.bind(this)}\"></button>`;\n\n\t\tthis._domNodes.requisiteSearchButton = Tag.render`\n\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-search\" onclick=\"${this.onSearchButtonClick.bind(this)}\"></button>`;\n\n\t\tlet placeholder = this._placeholderText;\n\t\tthis._domNodes.requisiteSearchString = Tag.render`\n\t\t\t<input type=\"text\" placeholder=\"${Text.encode(placeholder)}\" class=\"ui-ctl-element ui-ctl-textbox\" />`;\n\n\t\tif (!this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.setAttribute('onclick', this._featureRestrictionCallback);\n\t\t}\n\t\tthis.refreshLayout();\n\n\t\tDom.append(Tag.render`\n\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t${this._domNodes.requisiteSearchButton}\n\t\t\t${this._domNodes.requisiteClearButton}\n\t\t\t${this._domNodes.requisiteSearchString}\n\t\t</div>`, container);\n\n\t\tthis.initDropdown();\n\n\t\tthis.refreshLayout();\n\t}\n\n\tinitDropdown()\n\t{\n\t\tif (!this._dropdown)\n\t\t{\n\t\t\tconst isPlacement = BX.prop.getBoolean(this.clientResolverPlacementParams, \"isPlacement\", false);\n\t\t\tthis._dropdown = new Dropdown(\n\t\t\t\t{\n\t\t\t\t\tisDisabled: !this._isPermitted,\n\t\t\t\t\tsearchAction: BX.prop.getString(this._settings, \"searchAction\", \"\"),\n\t\t\t\t\texternalSearchHandler: isPlacement ? this.externalSearchHandler : null,\n\t\t\t\t\titems: [],\n\t\t\t\t\tenableCreation: true,\n\t\t\t\t\tenableCreationOnBlur: true,\n\t\t\t\t\tautocompleteDelay: 1500,\n\t\t\t\t\tmessages:\n\t\t\t\t\t{\n\t\t\t\t\t\tcreationLegend: Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADD_REQUISITE'),\n\t\t\t\t\t\tnotFound: Loc.getMessage('REQUISITE_AUTOCOMPLETE_NOT_FOUND'),\n\t\t\t\t\t},\n\t\t\t\t\tplacementParams: this.clientResolverPlacementParams\n\t\t\t\t}\n\t\t\t);\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSelect', this.onEntitySelect.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onAdd', this.onEntityAdd.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onReset', this.onEntityReset.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onBeforeSearchStart', this.onEntitySearchStart.bind(this));\n\t\t\tEventEmitter.subscribe(this._dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onEntitySearchComplete.bind(this));\n\t\t\tBX.addCustomEvent(this._dropdown, 'Dropdown:onGetPopupAlertContainer', this.onGetPopupAlertContainer.bind(this));\n\t\t\tBX.addCustomEvent(this._dropdown, 'Dropdown:onAfterInstallDefaultApp', this.onAfterInstallDefaultApp.bind(this));\n\t\t}\n\t\tthis._dropdown.searchOptions = this._context;\n\t\tthis._dropdown.targetElement = this._domNodes.requisiteSearchString;\n\t\tthis._dropdown.init();\n\n\t\tthis.setEnabled(this._isEnabled);\n\t\tthis.setShowFeedbackLink(this._showFeedbackLink);\n\t}\n\n\tgetDropdownPopup(tryCreate = false)\n\t{\n\t\tif (tryCreate)\n\t\t{\n\t\t\treturn this._dropdown.getPopupWindow();\n\t\t}\n\n\t\treturn this._dropdown.popupWindow;\n\t}\n\n\tcloseDropdownPopup()\n\t{\n\t\tconst dropownPopup = this.getDropdownPopup();\n\t\tif (dropownPopup)\n\t\t{\n\t\t\tdropownPopup.close();\n\t\t}\n\t}\n\n\tsetCurrentItem(autocompleteItem)\n\t{\n\t\tthis._currentItem = Type.isPlainObject(autocompleteItem) ? autocompleteItem : null;\n\t\tthis.refreshLayout();\n\t}\n\n\tsetShowFeedbackLink(show)\n\t{\n\t\tthis._showFeedbackLink = !!show;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setFeedbackFormParams(this._showFeedbackLink ? BX.prop.getObject(this._settings, \"feedbackFormParams\", {}) : {});\n\t\t}\n\t}\n\n\trefreshLayout()\n\t{\n\n\t\tif (!Type.isDomNode(this._domNodes.requisiteSearchString) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteSearchButton) ||\n\t\t\t!Type.isDomNode(this._domNodes.requisiteClearButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = '';\n\n\t\tif (Type.isObject(this._currentItem) && this._isPermitted)\n\t\t{\n\t\t\tlet textParts = [this._currentItem.title];\n\t\t\tif (Type.isStringFilled(this._currentItem.subTitle))\n\t\t\t{\n\t\t\t\ttextParts.push(this._currentItem.subTitle);\n\t\t\t}\n\t\t\ttext = textParts.join(', ');\n\n\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"\");\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(this._domNodes.requisiteClearButton, \"display\", \"none\");\n\t\t\tif (this._isEnabled || !this._isPermitted)\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.style(this._domNodes.requisiteSearchButton, \"display\", \"none\");\n\t\t\t}\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setCanAddRequisite(this._isPermitted && BX.prop.getBoolean(this._settings, \"canAddRequisite\", false));\n\t\t\t}\n\t\t}\n\n\t\tthis._domNodes.requisiteSearchString.value = text;\n\t\tthis.onSearchQueryInput();\n\t\tthis.setLoading(false);\n\t}\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcurrentItem: this._currentItem,\n\t\t\tsearchQuery: Type.isDomNode(this._domNodes.requisiteSearchString) ?\n\t\t\t\tthis._domNodes.requisiteSearchString.value : null,\n\t\t\titems: Type.isObject(this._dropdown) ? this._dropdown.getItems() : []\n\t\t};\n\t}\n\n\tsetState(state)\n\t{\n\t\tif (!Type.isPlainObject(state))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentItem(Type.isPlainObject(state.currentItem) ? state.currentItem : null);\n\t\tif (Type.isString(state.searchQuery) && Type.isDomNode(this._domNodes.requisiteSearchString) && this._isPermitted)\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.value = state.searchQuery;\n\t\t\tthis.onSearchQueryInput();\n\t\t}\n\t\tif (Type.isArray(state.items))\n\t\t{\n\t\t\tthis._dropdown.setItems(state.items);\n\t\t}\n\t}\n\n\tsetContext(context)\n\t{\n\t\tthis._context = Type.isPlainObject(context) ? context : {};\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.searchOptions = this._context;\n\t\t}\n\t}\n\n\tsetPlaceholderText(text)\n\t{\n\t\tthis._placeholderText = Type.isStringFilled(text) ? text : \"\";\n\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tthis._domNodes.requisiteSearchString.placeholder = this._placeholderText;\n\t\t}\n\t}\n\n\tsetClientResolverPlacementParams(params)\n\t{\n\t\tthis.clientResolverPlacementParams = this.filterclientResolverPlacementParams(params);\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setPlacementParams(this.clientResolverPlacementParams);\n\t\t\tconst isPlacement = BX.prop.getBoolean(this.clientResolverPlacementParams, \"isPlacement\", false);\n\t\t\tif (isPlacement)\n\t\t\t{\n\t\t\t\tthis._dropdown.setExternalSearchHandler(this.externalSearchHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEnabled(enabled)\n\t{\n\t\tthis._isEnabled = !!enabled;\n\t\tif (this._dropdown)\n\t\t{\n\t\t\tthis._dropdown.setMinSearchStringLength(this._isEnabled ? 3: 99999);\n\t\t}\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tisLoading = !!isLoading;\n\t\tif (isLoading === this._isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._isLoading = isLoading;\n\t\tlet searchBtn = this._domNodes.requisiteSearchButton;\n\t\tif (Type.isDomNode(searchBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-search');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsearchBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tsearchBtn.classList.add('ui-ctl-icon-search');\n\t\t\t}\n\t\t}\n\n\t\tlet clearBtn = this._domNodes.requisiteClearButton;\n\t\tif (Type.isDomNode(clearBtn))\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-clear');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-loader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearBtn.classList.remove('ui-ctl-icon-loader');\n\t\t\t\tclearBtn.classList.add('ui-ctl-icon-clear');\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchStringClear()\n\t{\n\t\tthis.emit('onClear');\n\t}\n\n\tonSearchButtonClick()\n\t{\n\t\tif (Type.isObject(this._dropdown))\n\t\t{\n\t\t\tthis._dropdown.handleTypeInField();\n\t\t}\n\t}\n\n\tonEntitySelect(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tlet selected = data[1];\n\n\t\tif (dropdown === this._dropdown && selected[\"appSid\"] && !selected[\"created\"])\n\t\t{\n\t\t\tif (!this.creatingItem)\n\t\t\t{\n\t\t\t\tthis.creatingItem = selected;\n\t\t\t\tselected._loader = new BX.Loader({\n\t\t\t\t\ttarget: selected.node,\n\t\t\t\t\tsize: 40\n\t\t\t\t});\n\t\t\t\tselected.node.classList.add('client-editor-active');\n\t\t\t\tselected.node.parentNode.classList.add('client-editor-inactive');\n\t\t\t\tselected._loader.show();\n\n\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:pick\",\n\t\t\t\t\t[{appSid: selected[\"appSid\"], data: selected}]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectEntity(selected);\n\t}\n\n\tselectEntity(selected)\n\t{\n\t\tif (this.creatingItem)\n\t\t{\n\t\t\tfor (let prop in selected)\n\t\t\t{\n\t\t\t\tif (selected.hasOwnProperty(prop))\n\t\t\t\t{\n\t\t\t\t\tthis.creatingItem[prop] = selected[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.creatingItem[\"created\"] = true;\n\t\t\tthis.creatingItem = null;\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\tthis.onDocumentClickConfirm.close();\n\t\t\tthis.onDocumentClickConfirm = null;\n\t\t}\n\n\t\tthis.closeDropdownPopup();\n\n\t\tthis.setCurrentItem(selected);\n\t\tthis.emit('onSelectValue', selected);\n\t}\n\n\tonEntityAdd(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet dropdown = data[0];\n\t\tdropdown.getPopupWindow().close();\n\t\tthis.emit('onCreateNewItem');\n\t}\n\n\tonEntityReset()\n\t{\n\t\tthis.setCurrentItem(null);\n\t}\n\n\tonEntitySearchStart()\n\t{\n\t\tthis.setLoading(true);\n\t\tthis._dropdown.setItems([]);\n\t}\n\n\tonExternalSearch()\n\t{\n\t\treturn new Promise(\n\t\t\t(resolve) => {\n\t\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t\t{\n\t\t\t\t\tconst params = {appId: 0};\n\t\t\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:startDefaultSearch\", [params]);\n\t\t\t\t\tif (Type.isInteger(params[\"appId\"]) && params[\"appId\"] > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.externalSearchResultHandlerList.has(params[\"appId\"]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.externalSearchResultHandlerList.set(params[\"appId\"], (result) => { resolve(result) });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve([]);\n\t\t\t}\n\t\t);\n\t}\n\n\tinitPlacement(searchControl, container)\n\t{\n\t\tif (!this.detailAutocompletePlacement)\n\t\t{\n\t\t\tlet isAutocompletePlacementEnabled = (\n\t\t\t\tType.isPlainObject(this.clientResolverPlacementParams)\n\t\t\t\t&& this.clientResolverPlacementParams.hasOwnProperty(\"numberOfPlacements\")\n\t\t\t\t&& Type.isNumber(this.clientResolverPlacementParams[\"numberOfPlacements\"])\n\t\t\t\t&& this.clientResolverPlacementParams[\"numberOfPlacements\"] > 0\n\t\t\t);\n\n\t\t\tif (isAutocompletePlacementEnabled)\n\t\t\t{\n\t\t\t\tthis.detailAutocompletePlacement = new DetailSearchPlacement(\"CRM_REQUISITE_AUTOCOMPLETE\");\n\t\t\t}\n\n\t\t\tif (this.detailAutocompletePlacement)\n\t\t\t{\n\t\t\t\tconst dropdownPopup = this.getDropdownPopup(true);\n\n\t\t\t\tif (dropdownPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.beforeEntitySearchPopupCloseHandler = this.onBeforeEntitySearchPopupClose.bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tdropdownPopup._tryCloseByEvent.bind(dropdownPopup)\n\t\t\t\t\t);\n\t\t\t\t\tdropdownPopup._tryCloseByEvent = this.beforeEntitySearchPopupCloseHandler;\n\n\t\t\t\t\tthis.entitySearchPopupCloseHandler = this.onEntitySearchPopupClose.bind(this);\n\t\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\t\tdropdownPopup,\n\t\t\t\t\t\t'onPopupClose',\n\t\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t\t);\n\n\t\t\t\t\tdropdownPopup.show();\n\t\t\t\t}\n\n\t\t\t\tthis.placementsParamsHandler = this.onPlacementsParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:params\",\n\t\t\t\t\tthis.placementsParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.beforeAddPlacementItemsHandler = this.onBeforeAppendPlacementItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSearchParamsHandler = this.onPlacamentSearchParams.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:searchParams\",\n\t\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementSetFoundItemsHandler = this.onPlacementSetFoundItems.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t\t);\n\n\t\t\t\tthis.placementEntitySelectHandler = this.onPlacementEntitySelect.bind(this);\n\t\t\t\tBX.addCustomEvent(\n\t\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\t\"Placements:select\",\n\t\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t\t);\n\n\t\t\t\tthis.detailAutocompletePlacement.show(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tcontainer.querySelector('div.crm-rq-popup-item-add-new'),\n\t\t\t\t\t{\n\t\t\t\t\t\thideLoader: true\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t\t{\n\t\t\t\tif (!this.searchQueryInputHandler)\n\t\t\t\t{\n\t\t\t\t\tthis.searchQueryInputHandler = this.onSearchQueryInput.bind(this);\n\t\t\t\t}\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\t\tthis._domNodes.requisiteSearchString.addEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tonSearchQueryInput()\n\t{\n\t\tif (this._domNodes.requisiteSearchString.value !== this.currentSearchQueryText)\n\t\t{\n\t\t\tthis.currentSearchQueryText = this._domNodes.requisiteSearchString.value;\n\t\t\tthis.fireChangeSearchQueryEvent();\n\t\t}\n\t}\n\n\tfireChangeSearchQueryEvent()\n\t{\n\t\tif (this.detailAutocompletePlacement && Type.isDomNode(this._domNodes.requisiteSearchString))\n\t\t{\n\t\t\tBX.onCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:changeQuery\",\n\t\t\t\t[{currentSearchQuery: this._domNodes.requisiteSearchString.value}]\n\t\t\t);\n\t\t}\n\t}\n\n\tonEntitySearchComplete(/*dropdown, items*/)\n\t{\n\t\tthis.setLoading(false);\n\t}\n\n\tonGetPopupAlertContainer(searchControl, container)\n\t{\n\t\tthis.initPlacement(searchControl, container);\n\t}\n\n\tonAfterInstallDefaultApp(dropdown)\n\t{\n\t\tthis.emit(\"onInstallDefaultApp\");\n\t}\n\n\tonBeforeEntitySearchPopupClose(originalHandler, event)\n\t{\n\t\tif (this.onDocumentClickConfirm)\n\t\t{\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\tconst eventResult = {active: false};\n\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:active\", [eventResult]);\n\t\tif (eventResult.active)\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\tconst f = function(messageBox, e) {\n\t\t\t\tBX.bind(document, 'click', this._dropdown.documentClickHandler);\n\t\t\t\tmessageBox.close();\n\t\t\t\tthis.onDocumentClickConfirm = null;\n\t\t\t\tBX.eventCancelBubble(e);\n\t\t\t}.bind(this);\n\t\t\tthis.onDocumentClickConfirm = MessageBox.create({\n\t\t\t\tmessage: BX.message('CRM_EDITOR_PLACEMENT_CAUTION') || 'Dow you want to terminate process?',\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tmodal: true,\n\t\t\t\tonOk: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t\tthis._dropdown.documentClickHandler(e);\n\t\t\t\t\toriginalHandler(e);\n\t\t\t\t}.bind(this),\n\t\t\t\tonCancel: function(messageBox, button, e) {\n\t\t\t\t\tf(messageBox, e);\n\t\t\t\t}\n\t\t\t});\n\t\t\tBX.eventCancelBubble(event);\n\t\t\tthis.onDocumentClickConfirm.show();\n\t\t\treturn BX.eventReturnFalse(event);\n\t\t}\n\t\toriginalHandler(event);\n\t}\n\n\tonEntitySearchPopupClose()\n\t{\n\t\tthis.destroyPlacement();\n\t}\n\n\tdestroyPlacement()\n\t{\n\t\tif (this.searchQueryInputHandler) {\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"input\", this.searchQueryInputHandler);\n\t\t\tthis._domNodes.requisiteSearchString.removeEventListener(\"keyup\", this.searchQueryInputHandler);\n\t\t\tthis.searchQueryInputHandler = null;\n\t\t}\n\n\t\tif (this._dropdown && this._dropdown.hasOwnProperty(\"documentClickHandler\"))\n\t\t{\n\t\t\tBX.unbind(document, 'click', this._dropdown.documentClickHandler);\n\t\t}\n\t\tif (this.detailAutocompletePlacement)\n\t\t{\n\t\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\t\tif (dropdownPopup)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(\n\t\t\t\t\tdropdownPopup,\n\t\t\t\t\t\"onPopupClose\",\n\t\t\t\t\tthis.entitySearchPopupCloseHandler\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.entitySearchPopupCloseHandler = null;\n\n\t\t\tBX.onCustomEvent(this.detailAutocompletePlacement, \"Placements:destroy\");\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:params\",\n\t\t\t\tthis.placementsParamsHandler\n\t\t\t);\n\t\t\tthis.placementsParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:beforeAppendItems\",\n\t\t\t\tthis.beforeAddPlacementItemsHandler\n\t\t\t);\n\t\t\tthis.beforeAddPlacementItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:searchParams\",\n\t\t\t\tthis.placementSearchParamsHandler\n\t\t\t);\n\t\t\tthis.placementSearchParamsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:setFoundItems\",\n\t\t\t\tthis.placementSetFoundItemsHandler\n\t\t\t);\n\t\t\tthis.placementSetFoundItemsHandler = null;\n\n\t\t\tBX.removeCustomEvent(\n\t\t\t\tthis.detailAutocompletePlacement,\n\t\t\t\t\"Placements:select\",\n\t\t\t\tthis.placementEntitySelectHandler\n\t\t\t);\n\t\t\tthis.placementEntitySelectHandler = null;\n\n\t\t\tthis.detailAutocompletePlacement = null;\n\n\t\t\tthis.creatingItem = null;\n\n\t\t\tthis._dropdown.setItems([]);\n\t\t}\n\t}\n\n\tonPlacementsParams(params)\n\t{\n\t\tif (Type.isObject(params))\n\t\t{\n\t\t\tif (this._dropdown)\n\t\t\t{\n\t\t\t\tthis._dropdown.setPlacementParams(this.clientResolverPlacementParams);\n\t\t\t}\n\n\t\t\tif (this.clientResolverPlacementParams)\n\t\t\t{\n\t\t\t\tif (params.hasOwnProperty(\"placementParams\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"placementParams\"] = this.clientResolverPlacementParams;\n\t\t\t\t}\n\t\t\t\tif (params.hasOwnProperty(\"currentSearchQuery\"))\n\t\t\t\t{\n\t\t\t\t\tparams[\"currentSearchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonBeforeAppendPlacementItems()\n\t{\n\t\tconst dropdownPopup = this.getDropdownPopup();\n\n\t\tif (dropdownPopup)\n\t\t{\n\t\t\tBX.addClass(dropdownPopup.popupContainer, \"client-editor-popup\");\n\t\t}\n\t}\n\n\tonPlacamentSearchParams(params)\n\t{\n\t\tparams[\"searchQuery\"] = this._domNodes.requisiteSearchString.value;\n\t}\n\n\tonPlacementSetFoundItems(placementItem, results)\n\t{\n\t\tconst items = [];\n\t\tresults.forEach(function(result) {\n\t\t\titems.push({\n\t\t\t\tid: result.id,\n\t\t\t\ttitle: result.name,\n\t\t\t\tappSid: placementItem[\"appSid\"],\n\t\t\t\tmodule: 'crm',\n\t\t\t\tsubModule: 'rest',\n\t\t\t\tsubTitle: placementItem[\"title\"],\n\t\t\t\tattributes: {\n\t\t\t\t\tphone: result.phone ? [{value: result.phone}] : '',\n\t\t\t\t\temail: result.email ? [{value: result.email}] : '',\n\t\t\t\t\tweb: result.web ? [{value: result.web}] : ''\n\t\t\t\t}\n\t\t\t});\n\t\t}.bind(this));\n\n\t\tlet appId = parseInt(placementItem[\"placementInfo\"][\"id\"]);\n\t\tif (appId > 0 && this.externalSearchResultHandlerList.has(appId))\n\t\t{\n\t\t\tthis.externalSearchResultHandlerList.get(appId)(items);\n\t\t\tthis.externalSearchResultHandlerList.delete(appId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._dropdown.setItems(items);\n\t\t}\n\t}\n\n\tonPlacementEntitySelect(data) {\n\t\tconst entityData = {\n\t\t\ttype: data[\"entityType\"],\n\t\t\tid: data[\"id\"],\n\t\t\ttitle: data[\"title\"],\n\t\t\tfields: data[\"fields\"]\n\t\t};\n\t\tif (\n\t\t\tType.isPlainObject(entityData[\"fields\"])\n\t\t\t&& entityData[\"fields\"].hasOwnProperty(\"RQ_ADDR\")\n\t\t\t&& Type.isPlainObject(entityData[\"fields\"][\"RQ_ADDR\"])\n\t\t)\n\t\t{\n\t\t\tconst responseHandler = function(response)\n\t\t\t{\n\t\t\t\tconst status = BX.prop.getString(response, \"status\", \"\");\n\t\t\t\tconst data = BX.prop.getObject(response, \"data\", {});\n\t\t\t\tconst messages = [];\n\n\t\t\t\tif (status === \"error\")\n\t\t\t\t{\n\t\t\t\t\tconst errors = BX.prop.getArray(response, \"errors\", []);\n\t\t\t\t\tfor (let i = 0; i < errors.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tmessages.push(BX.prop.getString(errors[i], \"message\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (messages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontent: messages.join(\"<br>\"),\n\t\t\t\t\t\t\tposition: \"top-center\",\n\t\t\t\t\t\t\tautoHideDelay: 10000\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tdelete entityData[\"fields\"][\"RQ_ADDR\"];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tentityData[\"fields\"][\"RQ_ADDR\"] = data;\n\t\t\t\t}\n\t\t\t\tthis.selectEntity(entityData);\n\t\t\t}.bind(this);\n\n\t\t\tBX.ajax.runAction(\n\t\t\t\t'crm.requisite.address.getLocationAddressJsonByFields',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taddresses: entityData[\"fields\"][\"RQ_ADDR\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(responseHandler, responseHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectEntity(entityData);\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new RequisiteAutocompleteField();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nclass Dropdown extends BX.UI.Dropdown\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.feedbackFormParams = BX.prop.getObject(options, \"feedbackFormParams\", {});\n\t\tthis.canAddRequisite = BX.prop.getBoolean(options, \"canAddRequisite\", false);\n\t\tthis.externalSearchHandler = BX.prop.getFunction(options, \"externalSearchHandler\", null);\n\t\tthis.placementParams = BX.prop.getObject(options, \"placementParams\", {});\n\t\tthis.installDefaultAppHandler = this.onClickInstallDefaultApp.bind(this);\n\t\tthis.installDefaultAppTimeout = 7000;\n\t\tthis.afterInstallDefaultAppHandler = this.onAfterInstallDefaultApp.bind(this);\n\t\tthis.popupAlertContainer = null;\n\t\tthis.defaultAppInstallLoader = null;\n\t\tthis.isDefaultAppInstalled = false;\n\t}\n\n\tsetPlacementParams(params)\n\t{\n\t\tthis.placementParams = params;\n\t}\n\n\tsetExternalSearchHandler(handler)\n\t{\n\t\tthis.externalSearchHandler = handler\n\t}\n\n\tisTargetElementChanged()\n\t{\n\t\treturn false;\n\t}\n\n\tgetItemsListContainer()\n\t{\n\t\tif (!this.itemListContainer)\n\t\t{\n\t\t\tthis.itemListContainer = BX.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'ui-dropdown-container rq-dropdown-container'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this.itemListContainer;\n\t}\n\n\tsetFeedbackFormParams(feedbackFormParams)\n\t{\n\t\tthis.feedbackFormParams = Type.isPlainObject(feedbackFormParams) ? feedbackFormParams : {};\n\t}\n\n\tsetCanAddRequisite(canAdd)\n\t{\n\t\tthis.canAddRequisite = !!canAdd;\n\t}\n\n\tsetMinSearchStringLength(length)\n\t{\n\t\tthis.minSearchStringLength = length;\n\t}\n\t\n\tgetDefaultAppInfo()\n\t{\n\t\treturn BX.prop.getObject(this.placementParams, \"defaultAppInfo\", {});\n\t}\n\t\n\tisDefaultAppCanInstall()\n\t{\n\t\tconst defaultAppInfo = this.getDefaultAppInfo();\n\t\t\n\t\treturn (\n\t\t\tType.isStringFilled(BX.prop.get(defaultAppInfo, \"code\", \"\"))\n\t\t\t&& Type.isStringFilled(BX.prop.get(defaultAppInfo, \"title\", \"\"))\n\t\t\t&& BX.prop.get(defaultAppInfo, \"isAvailable\", \"N\") === \"Y\"\n\t\t\t/*&& BX.prop.get(defaultAppInfo, \"isInstalled\", \"N\") !== \"Y\"*/\n\t\t);\n\t}\n\n\tgetPopupAlertContainer()\n\t{\n\t\tif (!this.popupAlertContainer)\n\t\t{\n\t\t\tlet items = [];\n\n\t\t\tif (this.isDefaultAppCanInstall())\n\t\t\t{\n\t\t\t\tconst appTitleText = Text.encode(this.getDefaultAppInfo()[\"title\"]);\n\t\t\t\tconst appInstallText = Text.encode(Loc.getMessage('REQUISITE_AUTOCOMPLETE_INSTALL'));\n\t\t\t\titems.push(\n\t\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"crm-rq-popup-item-add-inst-app-btn\"><span></span><span\n\t\t\t\t\t\t\t\tclass=\"crm-rq-popup-item-add-new-btn-text\"><span>${appTitleText}</span><span\n\t\t\t\t\t\t\t\tstyle=\"margin-left: 20px; width: 100px;\"><a\n\t\t\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\t\t\tonclick=\"${this.installDefaultAppHandler}\">${appInstallText}</a>\n\t\t\t\t\t\t\t</span></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlet feedbackAvailable = (Object.keys(this.getFeedbackFormParams()).length > 0);\n\t\t\tif (feedbackAvailable)\n\t\t\t{\n\t\t\t\tconst textParts =\n\t\t\t\t\tLoc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE').split('#ADVICE_NEW_SERVICE_LINK#')\n\t\t\t\t;\n\t\t\t\tconst item = Tag.render`<div class=\"crm-rq-popup-item crm-rq-popup-item-helper\"></div>`;\n\n\t\t\t\tif (textParts[0] && textParts[0].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[0]), item);\n\t\t\t\t}\n\t\t\t\tconst newServiceLinkText = Loc.getMessage('REQUISITE_AUTOCOMPLETE_ADVICE_NEW_SERVICE_LINK');\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<a href=\"\" onclick=\"${this.showFeedbackForm.bind(this)}\">${newServiceLinkText}</a>`,\n\t\t\t\t\titem\n\t\t\t\t);\n\n\t\t\t\tif (textParts[1] && textParts[1].length)\n\t\t\t\t{\n\t\t\t\t\tDom.append(document.createTextNode(textParts[1]), item);\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\tif (this.canAddRequisite)\n\t\t\t{\n\t\t\t\titems.push(Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-popup-item crm-rq-popup-item-add-new\">\n\t\t\t\t\t\t<button class=\"crm-rq-popup-item-add-new-btn\">\n\t\t\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"></span>\n\t\t\t\t\t\t\t<span class=\"crm-rq-popup-item-add-new-btn-text\"\n\t\t\t\t\t\t\t\tonclick=\"${this.onEmptyValueEvent.bind(this)}\"\n\t\t\t\t\t\t\t\t>${BX.prop.getString(this.messages, \"creationLegend\")}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>`);\n\t\t\t}\n\n\t\t\tthis.popupAlertContainer = items.length ? Tag.render`\n\t\t\t\t<div class=\"crm-rq-popup-wrapper\">\n\t\t\t\t\t<div class=\"crm-rq-popup-items-list\">${items}</div>\n\t\t\t\t</div>\n\t\t\t` : Tag.render`<div></div>`;\n\n\t\t\tBX.onCustomEvent(this, \"Dropdown:onGetPopupAlertContainer\", [this, this.popupAlertContainer]);\n\t\t}\n\n\t\tthis.togglePopupAlertVisibility();\n\n\t\treturn this.popupAlertContainer;\n\t}\n\n\tgetTargetElementValue()\n\t{\n\t\tif (this.targetElement !== \"undefined\" && Type.isStringFilled(this.targetElement[\"value\"]))\n\t\t{\n\t\t\treturn this.targetElement[\"value\"].trim();\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\ttogglePopupAlertVisibility()\n\t{\n\t\tif (Type.isDomNode(this.popupAlertContainer))\n\t\t{\n\t\t\tconst numberOfPlacements = BX.prop.getInteger(this.placementParams, \"numberOfPlacements\", 0);\n\t\t\tconst isVisible = (numberOfPlacements > 0 || this.getItems().length <= 0);\n\t\t\tthis.popupAlertContainer.style.display = isVisible ? \"\" : \"none\";\n\t\t}\n\t}\n\n\tsetItems(items)\n\t{\n\t\tsuper.setItems([{id: 1, name: \"N\", title: \"T\"}]);\n\t\tthis.togglePopupAlertVisibility();\n\t\tsuper.setItems(items);\n\t}\n\n\tgetNewAlertContainer(/*items*/)\n\t{\n\t\treturn null;\n\t}\n\n\tdisableTargetElement()\n\t{\n\t\t// cancel original handler\n\t}\n\n\tgetFeedbackFormParams()\n\t{\n\t\treturn this.feedbackFormParams;\n\t}\n\n\tshowFeedbackForm(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getPopupWindow().close();\n\t\tif (!this._feedbackForm)\n\t\t{\n\t\t\tthis._feedbackForm = new BX.UI.Feedback.Form(this.getFeedbackFormParams());\n\t\t}\n\t\tthis._feedbackForm.openPanel();\n\t}\n\n\tsearchItemsByStr(target)\n\t{\n\t\tif (this.externalSearchHandler)\n\t\t{\n\t\t\treturn this.externalSearchHandler().then((result) => {return result;});\n\t\t}\n\n\t\treturn super.searchItemsByStr(target);\n\t}\n\n\tonClickInstallDefaultApp(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tif (this.defaultAppInstallLoader)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(event.target) && Type.isDomNode(event.target.parentNode))\n\t\t{\n\t\t\tconst parent = event.target.parentNode;\n\n\t\t\tDom.hide(event.target);\n\n\t\t\tthis.defaultAppInstallLoader = (\n\t\t\t\tthis.defaultAppInstallLoader\n\t\t\t\t|| new BX.Loader({\n\t\t\t\t\ttarget: parent,\n\t\t\t\t\tsize: 30,\n\t\t\t\t\toffset: { top: \"-23px\" }\n\t\t\t\t})\n\t\t\t);\n\t\t\tthis.defaultAppInstallLoader.show();\n\t\t}\n\n\t\tif (this.isDefaultAppCanInstall())\n\t\t{\n\t\t\tthis.isDefaultAppInstalled = false;\n\t\t\tBX.loadExt('marketplace').then(\n\t\t\t\t() => {\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (!this.isDefaultAppInstalled)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.finalInstallDefaultApp();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.installDefaultAppTimeout\n\t\t\t\t\t);\n\t\t\t\t\ttop.BX.addCustomEvent(\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\t\"Rest:AppLayout:ApplicationInstall\",\n\t\t\t\t\t\tthis.afterInstallDefaultAppHandler\n\t\t\t\t\t);\n\t\t\t\t\tBX.rest.Marketplace.install(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tCODE: this.placementParams[\"defaultAppInfo\"][\"code\"],\n\t\t\t\t\t\t\tSILENT_INSTALL: \"Y\",\n\t\t\t\t\t\t\tDO_NOTHING: \"Y\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\t() => {\n\t\t\t\t\ttop.BX.removeCustomEvent(\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\t\"Rest:AppLayout:ApplicationInstall\",\n\t\t\t\t\t\tthis.afterInstallDefaultAppHandler\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\twait(ms)\n\t{\n\t\treturn new Promise((resolve) => setTimeout(resolve, parseInt(ms)));\n\t}\n\n\tcheckDefAppHandler()\n\t{\n\t\tconst countryId = BX.prop.getInteger(this.placementParams, \"countryId\", 0);\n\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'crm.requisite.autocomplete.checkDefaultAppHandler',\n\t\t\t\t\t{ data: { countryId: countryId } }\n\t\t\t\t).then(\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t\t\t&& data.hasOwnProperty(\"data\")\n\t\t\t\t\t\t\t&& data.hasOwnProperty(\"status\")\n\t\t\t\t\t\t\t&& data[\"status\"] === \"success\"\n\t\t\t\t\t\t\t&& Type.isBoolean(data[\"data\"])\n\t\t\t\t\t\t\t&& data[\"data\"]\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t}\n\n\tawaitHandler(context)\n\t{\n\t\tthis.wait(context.waitTime)\n\t\t\t.then(() => {\n\t\t\t\tthis.checkDefAppHandler()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.finalInstallDefaultAppSuccess();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tif (--context.numberOfTimes > 0) {\n\t\t\t\t\t\t\tthis.awaitHandler(context)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthis.finalInstallDefaultApp();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonAfterInstallDefaultApp(installed, eventResult)\n\t{\n\t\tthis.isDefaultAppInstalled = true;\n\t\ttop.BX.removeCustomEvent(top, \"Rest:AppLayout:ApplicationInstall\", this.afterInstallDefaultAppHandler);\n\n\t\tconst numberOfTimes = 3;\n\t\tconst waitTime = Math.floor(this.installDefaultAppTimeout / numberOfTimes);\n\t\tif (!!installed)\n\t\t{\n\t\t\tthis.awaitHandler({waitTime: waitTime, numberOfTimes: 3})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.finalInstallDefaultApp();\n\t\t}\n\t}\n\n\tfinalInstallDefaultAppSuccess()\n\t{\n\t\tBX.onCustomEvent(this, \"Dropdown:onAfterInstallDefaultApp\", [this]);\n\t\tthis.finalInstallDefaultApp();\n\t}\n\n\tfinalInstallDefaultApp()\n\t{\n\t\tif (this.defaultAppInstallLoader)\n\t\t{\n\t\t\tthis.defaultAppInstallLoader.destroy();\n\t\t\tthis.defaultAppInstallLoader = null;\n\t\t}\n\n\t\tif (this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.close();\n\t\t}\n\t}\n}"],"names":["RequisiteAutocompleteField","setEventNamespace","_id","_settings","_placeholderText","_isLoading","_isEnabled","_context","_currentItem","_domNodes","_dropdown","currentSearchQueryText","detailAutocompletePlacement","entitySearchPopupCloseHandler","placementsParamsHandler","searchQueryInputHandler","beforeAddPlacementItemsHandler","placementSearchParamsHandler","placementSetFoundItemsHandler","placementEntitySelectHandler","externalSearchHandler","externalSearchResultHandlerList","beforeEntitySearchPopupCloseHandler","onDocumentClickConfirm","creatingItem","clientResolverPlacementParams","id","settings","BX","type","isNotEmptyString","util","getRandomString","prop","getString","getObject","getBoolean","_featureRestrictionCallback","_isPermitted","_showFeedbackLink","filterclientResolverPlacementParams","onExternalSearch","bind","Map","doInitialize","params","Type","isObject","isPlacement","numberOfPlacements","getInteger","countryId","defaultAppInfo","container","isDomNode","requisiteClearButton","Tag","render","onSearchStringClear","requisiteSearchButton","onSearchButtonClick","placeholder","requisiteSearchString","Text","encode","setAttribute","refreshLayout","Dom","append","initDropdown","Dropdown","isDisabled","searchAction","items","enableCreation","enableCreationOnBlur","autocompleteDelay","messages","creationLegend","Loc","getMessage","notFound","placementParams","EventEmitter","subscribe","onEntitySelect","onEntityAdd","onEntityReset","onEntitySearchStart","onEntitySearchComplete","addCustomEvent","onGetPopupAlertContainer","onAfterInstallDefaultApp","searchOptions","targetElement","init","setEnabled","setShowFeedbackLink","tryCreate","getPopupWindow","popupWindow","dropownPopup","getDropdownPopup","close","autocompleteItem","isPlainObject","show","setFeedbackFormParams","text","textParts","title","isStringFilled","subTitle","push","join","style","setCanAddRequisite","value","onSearchQueryInput","setLoading","currentItem","searchQuery","getItems","state","setCurrentItem","isString","isArray","setItems","context","setPlacementParams","setExternalSearchHandler","enabled","setMinSearchStringLength","isLoading","searchBtn","classList","remove","add","clearBtn","emit","handleTypeInField","event","data","getData","dropdown","selected","_loader","Loader","target","node","size","parentNode","onCustomEvent","appSid","selectEntity","hasOwnProperty","closeDropdownPopup","Promise","resolve","appId","isInteger","has","set","result","searchControl","isAutocompletePlacementEnabled","isNumber","DetailSearchPlacement","dropdownPopup","onBeforeEntitySearchPopupClose","_tryCloseByEvent","onEntitySearchPopupClose","onPlacementsParams","onBeforeAppendPlacementItems","onPlacamentSearchParams","onPlacementSetFoundItems","onPlacementEntitySelect","querySelector","hideLoader","addEventListener","fireChangeSearchQueryEvent","currentSearchQuery","initPlacement","originalHandler","eventReturnFalse","eventResult","active","unbind","document","documentClickHandler","f","messageBox","e","eventCancelBubble","MessageBox","create","message","buttons","MessageBoxButtons","OK_CANCEL","modal","onOk","button","onCancel","destroyPlacement","removeEventListener","removeCustomEvent","addClass","popupContainer","placementItem","results","forEach","name","module","subModule","attributes","phone","email","web","parseInt","get","entityData","fields","responseHandler","response","status","errors","getArray","i","length","UI","Notification","Center","notify","content","position","autoHideDelay","ajax","runAction","addresses","then","self","initialize","options","feedbackFormParams","canAddRequisite","getFunction","installDefaultAppHandler","onClickInstallDefaultApp","installDefaultAppTimeout","afterInstallDefaultAppHandler","popupAlertContainer","defaultAppInstallLoader","isDefaultAppInstalled","handler","itemListContainer","attrs","className","canAdd","minSearchStringLength","getDefaultAppInfo","isDefaultAppCanInstall","appTitleText","appInstallText","feedbackAvailable","Object","keys","getFeedbackFormParams","split","item","createTextNode","newServiceLinkText","showFeedbackForm","onEmptyValueEvent","togglePopupAlertVisibility","trim","isVisible","display","preventDefault","_feedbackForm","Feedback","Form","openPanel","stopPropagation","parent","hide","offset","top","loadExt","setTimeout","finalInstallDefaultApp","rest","Marketplace","install","CODE","SILENT_INSTALL","DO_NOTHING","ms","reject","isBoolean","wait","waitTime","checkDefAppHandler","finalInstallDefaultAppSuccess","numberOfTimes","awaitHandler","installed","Math","floor","destroy"],"mappings":"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"}