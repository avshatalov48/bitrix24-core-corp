{"version":3,"file":"requisite.bundle.js","sources":["../src/requisite-list.js","../src/requisite-editor.js","../src/requisite-controller.js","../src/preset-menu.js","../src/requisite-tooltip.js","../src/requisite-crm-field.js","../src/address-crm-field.js","../src/client-requisites.js"],"sourcesContent":["import {Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class RequisiteList extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.EntityEditorRequisiteField.RequisiteList');\n\t\tthis._items = [];\n\n\t\tthis.CHANGE_EVENT = 'onChange';\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (!Type.isArray(value))\n\t\t{\n\t\t\tvalue = [];\n\t\t}\n\t\tfor (let item of value)\n\t\t{\n\t\t\tlet listItem = RequisiteListItem.create(item);\n\t\t\tthis._items.push(listItem);\n\t\t}\n\t}\n\n\tgetList()\n\t{\n\t\treturn this._items.filter((item) => !item.isDeleted());\n\t}\n\n\tgetListWithDeleted()\n\t{\n\t\treturn this._items;\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn !this.getList().length;\n\t}\n\n\tgetSelected()\n\t{\n\t\tlet selectedId = this.getSelectedId();\n\t\treturn this.getById(selectedId);\n\t}\n\n\tgetSelectedId()\n\t{\n\t\tlet list = this.getList();\n\t\tif (!list.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tfor (let index = 0; index < list.length; index++)\n\t\t{\n\t\t\tlet requisite = list[index];\n\t\t\tif (requisite.isSelected())\n\t\t\t{\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t\treturn 0; // first element by default\n\t}\n\n\tgetById(id)\n\t{\n\t\tlet list = this.getList();\n\n\t\tif (null === id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (id >= 0 && id < list.length)\n\t\t{\n\t\t\treturn list[id];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetByRequisiteId(requisiteId)\n\t{\n\t\tlet list = this.getList();\n\t\treturn list\n\t\t\t.filter((item) => item.getRequisiteId() == requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tsetSelected(requisiteId, bankDetailsId)\n\t{\n\t\tlet requisite = this.getById(requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tfor (let item of this.getList())\n\t\t\t{\n\t\t\t\tlet selected = (item === requisite);\n\t\t\t\titem.setSelected(selected);\n\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\titem.setSelectedBankDetails(\n\t\t\t\t\t\tType.isNull(bankDetailsId) ? requisite.getSelectedBankDetailId() : bankDetailsId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tgetNewRequisiteId()\n\t{\n\t\tlet maxExistedId = this.getList().reduce((prevId, item) =>\n\t\t{\n\t\t\tlet requisiteId = item.getRequisiteIdAsString();\n\t\t\tlet match = requisiteId ? requisiteId.match(RequisiteListItem.newRequisitePattern) : false;\n\t\t\tlet currentId = match && match[1] ? match[1] : -1;\n\t\t\treturn Math.max(prevId, currentId);\n\t\t}, -1);\n\n\t\treturn 'n' + (parseInt(maxExistedId) + 1);\n\t}\n\n\tindexOf(item)\n\t{\n\t\treturn this._items.indexOf(item);\n\t}\n\n\tadd(item)\n\t{\n\t\tthis._items.push(item);\n\t\tthis.notifyListChanged();\n\t}\n\n\tremove(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis._items.splice(index, 1);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tremovePostponed(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setDeleted(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\thide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(true);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tunhide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(false);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tnotifyListChanged()\n\t{\n\t\tthis.emit(this.CHANGE_EVENT);\n\t}\n\n\texportToModel()\n\t{\n\t\tlet result = [];\n\t\tfor (let item of this._items)\n\t\t{\n\t\t\tlet exportedItem = item.exportToModel();\n\t\t\tresult.push({...exportedItem});\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteList();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nexport class RequisiteListItem\n{\n\tconstructor()\n\t{\n\n\t\tthis._data = null;\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tthis._data = {...value};\n\t\t\tthis._data.isNew = false;\n\t\t\tthis._data.isChanged = false;\n\t\t\tthis._data.isDeleted = false;\n\t\t\tthis._data.isAddressOnly = false;\n\t\t\tthis._data.formData = {};\n\t\t\tthis._data.addressData = {};\n\t\t\tif (!Type.isPlainObject(this._data.autocompleteState))\n\t\t\t{\n\t\t\t\tthis._data.autocompleteState = {};\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{ // new empty requisite\n\t\t\tthis._data = {\n\t\t\t\tisNew: true,\n\t\t\t\tisChanged: false,\n\t\t\t\tisDeleted: false,\n\t\t\t\tisAddressOnly: false,\n\t\t\t\tselected: false,\n\t\t\t\tpresetId: null,\n\t\t\t\trequisiteId: BX.prop.getString(settings, 'newRequisiteId', 'n0'),\n\t\t\t\trequisiteData: '',\n\t\t\t\trequisiteDataSign: '',\n\t\t\t\tbankDetails: [],\n\t\t\t\tbankDetailIdSelected: 0,\n\t\t\t\taddressList: {},\n\t\t\t\tvalue: {},\n\t\t\t\ttitle: '',\n\t\t\t\tsubtitle: '',\n\t\t\t\tautocompleteState: {},\n\t\t\t\tformData: {},\n\t\t\t\taddressData: {}\n\t\t\t};\n\t\t\tlet extraData = BX.prop.getObject(settings, 'newRequisiteExtraFields', {});\n\t\t\tthis._data = {...this._data, ...extraData};\n\t\t}\n\t\tthis._data.initialAddressDdta = null;\n\t\tthis.prepareViewData(this._data);\n\t}\n\n\tprepareViewData()\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis._data.value = this._data.requisiteData ? JSON.parse(this._data.requisiteData) : {};\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis._data.value = {};\n\t\t}\n\t\tthis._data.title = '';\n\t\tthis._data.subtitle = '';\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.viewData))\n\t\t{\n\t\t\tthis._data.title = this._data.value.viewData.title;\n\t\t\tthis._data.subtitle = this._data.value.viewData.subtitle;\n\t\t}\n\n\t\tif (this.getRequisiteIdAsString().match(RequisiteListItem.newRequisitePattern)) // was new requisite\n\t\t{\n\t\t\tlet newRequisiteId = BX.prop.getNumber(this.getFields(), 'ID', 0);\n\t\t\tif (newRequisiteId > 0) // if new requisite was saved\n\t\t\t{\n\t\t\t\tthis.setRequisiteId(newRequisiteId);\n\t\t\t}\n\t\t}\n\t\tthis.setAddressOnly(BX.prop.getString(this.getFields(), 'ADDRESS_ONLY', 'N') === 'Y');\n\n\t\tthis._data.bankDetails = [];\n\t\tif (Type.isPlainObject(this._data.value) && Type.isArray(this._data.value.bankDetailViewDataList))\n\t\t{\n\t\t\tthis._data.bankDetails = this.prepareBankDetailsList(this._data.value.bankDetailViewDataList);\n\t\t}\n\n\t\tthis._data.addressList = {...BX.prop.getObject(this.getFields(), 'RQ_ADDR', {})};\n\t}\n\n\tprepareBankDetailsList(bankDetails)\n\t{\n\t\tlet result = [];\n\t\tfor (let bankDetailsItem of bankDetails)\n\t\t{\n\t\t\tif (bankDetailsItem.deleted)\n\t\t\t{\n\t\t\t\tcontinue; // Deleted items should not be shown\n\t\t\t}\n\t\t\tif (Type.isPlainObject(bankDetailsItem.viewData))\n\t\t\t{\n\t\t\t\tlet item = {\n\t\t\t\t\t'title': bankDetailsItem.viewData.title,\n\t\t\t\t\t'id': bankDetailsItem.pseudoId,\n\t\t\t\t\t'value': '',\n\t\t\t\t\t'selected': !!bankDetailsItem.selected\n\t\t\t\t};\n\t\t\t\tif (Type.isArray(bankDetailsItem.viewData.fields) && bankDetailsItem.viewData.fields.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = bankDetailsItem.viewData.fields\n\t\t\t\t\t\t.filter((item) => Type.isStringFilled(item.textValue))\n\t\t\t\t\t\t.map((item) => item.title + ': ' + item.textValue)\n\t\t\t\t\t\t.join(', ');\n\t\t\t\t}\n\t\t\t\tif (!item.value.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = item.title;\n\t\t\t\t}\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tisSelected()\n\t{\n\t\tif (!this._data.hasOwnProperty('justSelected'))\n\t\t{\n\t\t\treturn BX.prop.getBoolean(this._data, 'selected', false);\n\t\t}\n\t\treturn BX.prop.getBoolean(this._data, 'justSelected', false);\n\t}\n\n\tisChanged()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isChanged', false);\n\t}\n\n\tsetChanged(changed)\n\t{\n\t\tthis._data.isChanged = !!changed;\n\t}\n\n\tisNew()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isNew', false);\n\t}\n\n\tsetNew(isNew)\n\t{\n\t\tthis._data.isNew = !!isNew;\n\t}\n\n\tgetSelectedBankDetailId()\n\t{\n\t\tlet selectedBankDetailId = BX.prop.getInteger(this._data, 'selectedBankDetailId', -1);\n\t\tif (selectedBankDetailId !== -1)\n\t\t{\n\t\t\treturn selectedBankDetailId;\n\t\t}\n\t\tselectedBankDetailId = this.getBankDetails().reduce(\n\t\t\t(selected, item, index) =>\n\t\t\t{\n\t\t\t\treturn item.selected ? index : selected\n\t\t\t}, -1);\n\t\tthis._data.selectedBankDetailId = selectedBankDetailId;\n\n\t\treturn selectedBankDetailId > -1 ? selectedBankDetailId : 0;\n\t}\n\n\tgetBankDetailById(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (bankDetailId >= 0 && bankDetailId < list.length)\n\t\t{\n\t\t\treturn list[bankDetailId];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetBankDetailByBankDetailId(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn list\n\t\t\t.filter((item) => item.id == bankDetailId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'title', \"\");\n\t}\n\n\tgetSubtitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'subtitle', \"\");\n\t}\n\n\tgetPresetId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetId', \"0\");\n\t}\n\n\tgetBankDetails()\n\t{\n\t\treturn BX.prop.getArray(this._data, 'bankDetails', []);\n\t}\n\n\tgetRequisiteId()\n\t{\n\t\treturn this._data.requisiteId;\n\t}\n\n\tgetRequisiteIdAsString()\n\t{\n\t\tlet requisiteId = this.getRequisiteId();\n\t\trequisiteId = Type.isNumber(requisiteId) ? String(requisiteId) : requisiteId;\n\t\treturn Type.isStringFilled(requisiteId) ? requisiteId : '';\n\t}\n\n\tgetRequisiteData()\n\t{\n\t\treturn this._data.requisiteData;\n\t}\n\n\tgetRequisiteDataSign()\n\t{\n\t\treturn this._data.requisiteDataSign;\n\t}\n\n\tgetFields()\n\t{\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.fields))\n\t\t{\n\t\t\treturn {...this._data.value.fields};\n\t\t}\n\t\treturn {};\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\tlet result = null;\n\n\t\tlet autocompleteState = this.getAutocompleteState();\n\t\tlet selectedAutocompleteItem = BX.prop.getObject(autocompleteState, 'currentItem', null);\n\t\tif (Type.isPlainObject(selectedAutocompleteItem))\n\t\t{\n\t\t\tresult = {\n\t\t\t\ttitle: BX.prop.getString(selectedAutocompleteItem, 'title', ''),\n\t\t\t\tsubTitle: BX.prop.getString(selectedAutocompleteItem, 'subTitle', '')\n\t\t\t}\n\t\t}\n\t\telse if (!Type.isUndefined(this._data.value.viewData)  && Type.isArray(this._data.value.viewData.fields))\n\t\t{\n\t\t\tlet fields =  this._data.value.viewData.fields;\n\t\t\tresult = {\n\t\t\t\ttitle: Type.isStringFilled(this._data.title) ? this._data.title : '',\n\t\t\t\tsubTitle: fields\n\t\t\t\t\t.filter((item) => item.name === 'RQ_INN' && item.textValue.length)\n\t\t\t\t\t.map((item) => item.title + ' ' + item.textValue)\n\t\t\t\t\t.join('')\n\t\t\t};\n\t\t}\n\t\treturn result;\n\t}\n\n\tsetAutocompleteState(state)\n\t{\n\t\tthis._data.autocompleteState = Type.isPlainObject(state) ? state : {};\n\t}\n\n\tgetAutocompleteState()\n\t{\n\t\treturn this._data.autocompleteState;\n\t}\n\n\tgetAddressList()\n\t{\n\t\treturn this._data.addressList;\n\t}\n\n\tsetAddressList(addressList)\n\t{\n\t\tthis._data.addressList = addressList;\n\t}\n\n\tsetInitialAddressData(addressData)\n\t{\n\t\tthis._data.initialAddressDdta = addressData;\n\t}\n\n\tgetAddressesForSave()\n\t{\n\t\tlet oldAddressTypes = Type.isPlainObject(this._data.initialAddressDdta) ?\n\t\t\tObject.keys(this._data.initialAddressDdta) : [];\n\n\t\tlet addresses = {};\n\t\tfor (let type of oldAddressTypes)\n\t\t{\n\t\t\taddresses[type] = \"\";\n\t\t}\n\t\tlet addressData = this.getAddressData();\n\t\tfor (let type in addressData)\n\t\t{\n\t\t\tif (addressData.hasOwnProperty(type) && addressData[type].length)\n\t\t\t{\n\t\t\t\taddresses[type] = addressData[type];\n\t\t\t}\n\t\t}\n\t\tfor (let type in addresses)\n\t\t{\n\t\t\tif (Type.isString(addresses[type]) && addresses[type] === \"\")\n\t\t\t{\n\t\t\t\taddresses[type] = {DELETED: 'Y'};\n\t\t\t}\n\t\t}\n\n\t\treturn addresses;\n\t}\n\n\tsetRequisiteId(requisiteId)\n\t{\n\t\tthis._data.requisiteId = requisiteId;\n\t}\n\n\tsetPresetId(presetId)\n\t{\n\t\tthis._data.presetId = presetId;\n\t}\n\n\tsetSelected(selected)\n\t{\n\t\tthis._data.selected = !!selected;\n\t\tthis._data.justSelected = !!selected;\n\t}\n\n\tsetRequisiteData(requisiteData, requisiteDataSign)\n\t{\n\t\tthis._data.requisiteData = requisiteData;\n\t\tif (Type.isStringFilled(requisiteDataSign))\n\t\t{\n\t\t\tthis._data.requisiteDataSign = requisiteDataSign;\n\t\t}\n\t\tthis.prepareViewData();\n\t}\n\n\tsetDeleted(isDeleted)\n\t{\n\t\tthis._data.isDeleted = !!isDeleted;\n\t}\n\n\tisDeleted()\n\t{\n\t\treturn this._data.isDeleted;\n\t}\n\n\tsetAddressOnly(isAddressOnly)\n\t{\n\t\tthis._data.isAddressOnly = !!isAddressOnly;\n\t\tthis.setFormData({...this.getFormData(), 'ADDRESS_ONLY': isAddressOnly ? 'Y':'N'})\n\t}\n\n\tisAddressOnly()\n\t{\n\t\treturn this._data.isAddressOnly;\n\t}\n\n\tisEmptyFormData()\n\t{\n\t\treturn Object.keys(this._data.formData).length <= 0;\n\t}\n\n\tgetFormData()\n\t{\n\t\treturn this._data.formData;\n\t}\n\n\tsetFormData(formData)\n\t{\n\t\tthis._data.formData = formData;\n\t}\n\n\tclearFormData()\n\t{\n\t\tthis.setFormData({});\n\t}\n\n\tisEmptyAddressData()\n\t{\n\t\treturn Object.keys(this._data.addressData).length <= 0;\n\t}\n\n\tgetAddressData()\n\t{\n\t\treturn this._data.addressData;\n\t}\n\n\tsetAddressData(addressData)\n\t{\n\t\tthis._data.addressData = addressData;\n\t}\n\n\tclearAddressData()\n\t{\n\t\tthis.setAddressData({});\n\t}\n\tsetSelectedBankDetails(bankDetailsId)\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isNull(bankDetailsId))\n\t\t{\n\t\t\tbankDetailsId = 0; // first item by default\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = (index === bankDetailsId);\n\t\t}\n\n\t\tthis._data.selectedBankDetailId = bankDetailsId;\n\t}\n\n\tclearSelectedBankDetails()\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = false;\n\t\t}\n\t}\n\n\texportToModel()\n\t{\n\t\tlet exportedItem = {...this._data};\n\t\tdelete (exportedItem.value);\n\t\tdelete (exportedItem.addressList);\n\t\tdelete (exportedItem.bankDetails);\n\t\tdelete (exportedItem.initialAddressDdta);\n\t\tdelete (exportedItem.isAddressOnly);\n\t\treturn exportedItem;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteListItem();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nRequisiteListItem.newRequisitePattern = /n([0-9]+)/;","import {RequisiteListItem} from \"./requisite-list\";\nimport {EventEmitter} from \"main.core.events\";\nimport {Loc, Type} from \"main.core\";\nimport {MessageBox} from \"ui.dialogs.messagebox\";\n\nexport class EntityEditorRequisiteEditor\n{\n\tconstructor()\n\t{\n\t\tthis._requisiteList = null;\n\t\tthis._entityTypeId = null;\n\t\tthis._entityId = null;\n\t\tthis._contextId = null;\n\t\tthis._mode = BX.UI.EntityEditorMode.view;\n\n\t\tthis.currentSliderRequisiste = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._entityTypeId = BX.prop.getInteger(settings, 'entityTypeId', 0);\n\t\tthis._entityId = BX.prop.getInteger(settings, 'entityId', 0);\n\t\tthis._contextId = BX.prop.getString(settings, 'contextId', \"\");\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, 'requisiteEditUrl', \"\");\n\n\t\tEventEmitter.subscribe('onLocalStorageSet', this.onExternalEvent.bind(this));\n\t}\n\n\tsetRequisiteList(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t}\n\n\tsetMode(mode)\n\t{\n\t\tthis._mode = mode;\n\t}\n\n\topen(requisite, options = {})\n\t{\n\t\tif (!(requisite instanceof RequisiteListItem))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentSliderRequisiste = requisite;\n\n\t\tlet sliderOptions = {\n\t\t\twidth: 950,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: this.prepareSliderRequestParams(requisite, options)\n\t\t};\n\t\tBX.Crm.Page.openSlider(this.getSliderUrl(requisite), sliderOptions);\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tlet requisite = this._requisiteList.getById(id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet postData = {...this.prepareSliderRequestParams(requisite)};\n\t\t\tpostData.sessid = BX.bitrix_sessid();\n\t\t\tpostData.mode = 'delete';\n\t\t\tpostData.ACTION = 'SAVE';\n\n\t\t\tBX.ajax.post(this.getSliderUrl(requisite), postData, (data) =>\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet json = JSON.parse(data);\n\t\t\t\t\tif (Type.isStringFilled(json.ERROR))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(json.ERROR);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\t\t\t\t\tlet selectedRemoved = (selectedRequisite === requisite);\n\t\t\t\t\t\tthis._requisiteList.remove(requisite);\n\n\t\t\t\t\t\tEventEmitter.emit(this, 'onAfterDeleteRequisite', {selectedRemoved});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tgetSliderUrl(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\n\t\tlet urlParams =\n\t\t\t{\n\t\t\t\tetype: this._entityTypeId,\n\t\t\t\teid: this._entityId,\n\t\t\t\texternal_context_id: this._contextId\n\t\t\t};\n\n\t\tlet presetId = requisite.getPresetId();\n\t\tif (presetId > 0)\n\t\t{\n\t\t\turlParams[\"pid\"] = presetId;\n\t\t}\n\n\t\treturn BX.util.add_url_param(\n\t\t\tthis.getRequisiteEditUrl(requisiteId),\n\t\t\turlParams\n\t\t);\n\t}\n\n\tprepareSliderRequestParams(requisite, options = {})\n\t{\n\t\tlet requestParams = {};\n\t\tlet requisiteData = requisite.getRequisiteData();\n\t\tif (requisite.isChanged() && Type.isString(requisiteData) && requisiteData.length)\n\t\t{\n\t\t\trequestParams['externalData'] = {\n\t\t\t\t'data': requisiteData,\n\t\t\t\t'sign': requisite.getRequisiteDataSign()\n\t\t\t};\n\t\t}\n\t\tif (requisite.isSelected())\n\t\t{\n\t\t\tlet autocompleteState = requisite.getAutocompleteState();\n\t\t\tif (Object.keys(autocompleteState).length)\n\t\t\t{\n\t\t\t\trequestParams['AUTOCOMPLETE'] = JSON.stringify(autocompleteState);\n\t\t\t\trequestParams['useFormData'] = 'Y';\n\t\t\t}\n\t\t}\n\t\tif (!requisite.isEmptyFormData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...requisite.getFormData()};\n\t\t}\n\t\tif (!requisite.isEmptyAddressData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...{RQ_ADDR: requisite.getAddressesForSave()}};\n\t\t}\n\t\trequestParams['mode'] = requisite.isNew() ? 'create' : 'edit';\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\trequestParams['doSave'] = 'Y';\n\t\t}\n\t\tif (BX.prop.getBoolean(options, 'addBankDetailsItem', false))\n\t\t{\n\t\t\trequestParams['addBankDetailsItem'] = 'Y';\n\t\t}\n\t\tlet overriddenPresetId = BX.prop.getInteger(options, 'overriddenPresetId', 0);\n\t\tif (overriddenPresetId > 0)\n\t\t{\n\t\t\trequestParams['PRESET_ID'] = overriddenPresetId;\n\t\t\trequestParams['useFormData'] = 'Y';\n\t\t}\n\t\treturn requestParams;\n\t}\n\n\tgetRequisiteEditUrl(requisiteId)\n\t{\n\t\treturn this._requisiteEditUrl.replace(/#requisite_id#/gi, requisiteId);\n\t}\n\n\tgetSignRequisitePromise(requisite)\n\t{\n\t\tlet postData = this.prepareSliderRequestParams(requisite);\n\t\tpostData.sessid = BX.bitrix_sessid();\n\t\tpostData.PRESET_ID = requisite.getPresetId();\n\t\tpostData.useFormData = 'Y';\n\t\tpostData.ACTION = 'SAVE';\n\n\t\treturn BX.ajax.promise({\n\t\t\tmethod: 'post',\n\t\t\tdataType: 'json',\n\t\t\turl: this.getSliderUrl(requisite),\n\t\t\tdata: postData\n\t\t});\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._mode === BX.UI.EntityEditorMode.view;\n\t}\n\n\tonExternalEvent(event)\n\t{\n\t\tlet dataArray = event.getData();\n\t\tif (!Type.isArray(dataArray))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet data = dataArray[0];\n\n\t\tlet eventName = BX.prop.getString(data, \"key\", \"\");\n\n\t\tif (eventName !== \"BX.Crm.RequisiteSliderDetails:onCancelEdit\" && eventName !== \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet value = BX.prop.getObject(data, \"value\", {});\n\n\t\tlet contextId = BX.prop.getString(value, \"contextId\", \"\");\n\t\tif (contextId !== this._contextId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onCancelEdit\")\n\t\t{\n\t\t\tthis.currentSliderRequisiste = null;\n\t\t}\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\tlet requisite = this.currentSliderRequisiste;\n\t\t\tif (Type.isObject(requisite))\n\t\t\t{\n\t\t\t\tif (Type.isString(value.requisiteData))\n\t\t\t\t{\n\t\t\t\t\trequisite.setRequisiteData(value.requisiteData, value.requisiteDataSign);\n\t\t\t\t\trequisite.setAutocompleteState({});\n\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(value.presetId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetId(value.presetId);\n\t\t\t\t}\n\t\t\t\tif (this.isViewMode())\n\t\t\t\t{\n\t\t\t\t\trequisite.setNew(false);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\trequisite.setChanged(true);\n\t\t\t\t}\n\t\t\t\trequisite.setDeleted(false);\n\n\t\t\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.notifyListChanged();\n\t\t\t\t}\n\n\t\t\t\tthis.currentSliderRequisiste = null;\n\n\t\t\t\tEventEmitter.emit(this, 'onAfterEditRequisite');\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteEditor();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n}","import {Dom, Loc, Tag, Type} from \"main.core\"\nimport {EventEmitter} from \"main.core.events\"\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\"\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nexport class EntityEditorRequisiteController extends BX.Crm.EntityEditorController\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._requisiteFieldId = null;\n\t\tthis._requisiteField = null;\n\t\tthis._requisiteInitData = null;\n\n\t\tthis._addressFieldId = null;\n\t\tthis._addressField = null;\n\t\tthis._isLoading = false;\n\n\t\tthis._formInputsWrapper = null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._requisiteFieldId = this.getConfigStringParam(\"requisiteFieldId\", \"\");\n\t\tthis._addressFieldId = this.getConfigStringParam(\"addressFieldId\", \"\");\n\n\t\tthis.saveRequisiteInitData();\n\n\t\tEventEmitter.subscribe(this._editor, 'onFieldInit', this.onFieldInit.bind(this));\n\n\t\tthis.initRequisiteEditor();\n\t\tthis.initRequisiteList();\n\t}\n\n\tinitRequisiteList()\n\t{\n\t\tthis._requisiteList = RequisiteList.create(this._requisiteInitData);\n\t\tthis._requisiteList.subscribe(this._requisiteList.CHANGE_EVENT, this.onChangeRequisites.bind(this));\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t}\n\n\tinitRequisiteEditor()\n\t{\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\tentityId: this._editor.getEntityId(),\n\t\t\tcontextId: this._editor.getContextId(),\n\t\t\trequisiteEditUrl: this._editor.getRequisiteEditUrl('#requisite_id#')\n\t\t});\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\t}\n\n\tinitRequisiteField()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.setRequisites(this._requisiteList);\n\t\t}\n\t}\n\n\tinitAddressField()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tlet addressList = {};\n\t\t\tlet selectedRequisite = this._requisiteList ? this._requisiteList.getSelected() : null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tlet requisiteAddressList = selectedRequisite.getAddressList();\n\t\t\t\tfor (let type in requisiteAddressList)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\trequisiteAddressList.hasOwnProperty(type) &&\n\t\t\t\t\t\tBX.prop.getString(requisiteAddressList[type], 'DELETED', 'N') !== 'Y'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\taddressList[type] = requisiteAddressList[type];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._addressField.setAddressList(addressList);\n\t\t}\n\t}\n\n\tsaveRequisiteInitData()\n\t{\n\t\tthis._requisiteInitData = this.getRequisiteFieldValue();\n\t}\n\n\tvalidate(result)\n\t{\n\t\tlet promises = [];\n\t\tfor (let requisite of this._requisiteList.getList())\n\t\t{\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (requisite.isEmptyFormData() && requisite.isEmptyAddressData())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet signPromise = this.signRequisiteFields(requisite);\n\t\t\tsignPromise.then(\n\t\t\t\t(data) =>\n\t\t\t\t{\n\t\t\t\t\tlet error = BX.prop.getString(data, 'ERROR', '');\n\t\t\t\t\tlet entityDataObj = BX.prop.getObject(data, 'ENTITY_DATA', {});\n\t\t\t\t\tlet entityData = BX.prop.getString(entityDataObj, 'REQUISITE_DATA', \"\");\n\t\t\t\t\tlet entityDataSign = BX.prop.getString(entityDataObj, 'REQUISITE_DATA_SIGN', \"\");\n\t\t\t\t\tif (Type.isStringFilled(error))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(error);\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isStringFilled(entityData) && Type.isStringFilled(entityDataSign))\n\t\t\t\t\t{\n\t\t\t\t\t\trequisite.setRequisiteData(entityData, entityDataSign);\n\t\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tpromises.push(signPromise);\n\t\t}\n\n\t\treturn (promises.length > 0) ? Promise.all(promises) : null;\n\t}\n\n\tsetSelectedRequisite(requisiteId, bankDetailId)\n\t{\n\t\tlet entityId = this._editor.getEntityId();\n\t\tif (!entityId)\n\t\t{\n\t\t\t// impossible situation, but...\n\t\t\treturn;\n\t\t}\n\t\tlet newSelectedRequisite = this._requisiteList.getById(requisiteId);\n\t\tif (!newSelectedRequisite || newSelectedRequisite.isNew())\n\t\t{\n\t\t\t// impossible situation too\n\t\t\treturn;\n\t\t}\n\t\tthis._requisiteList.setSelected(requisiteId, bankDetailId);\n\n\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\n\t\tthis.startLoading();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.settings.setSelectedEntityRequisite',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\t\t\tentityId: entityId,\n\t\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\t\tbankDetailId: selectedBankDetailId\n\t\t\t\t}\n\t\t\t}\n\t\t).then((response) =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t}, () =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t});\n\n\t}\n\n\topenEditor(requisite, options = {})\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\tthis._requisiteEditor.open(requisite, options);\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._editor.getMode() === BX.Crm.EntityEditorMode.view;\n\t}\n\n\tsetRequisiteInitAddrData(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\t\tlet rawRequisite = this._requisiteInitData\n\t\t\t.filter((item) => item.requisiteId === requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\n\t\tif (Type.isPlainObject(rawRequisite))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet requisiteData = JSON.parse(rawRequisite.requisiteData);\n\t\t\t\tlet requisiteFields = BX.prop.getObject(requisiteData, 'fields', {});\n\t\t\t\tlet addressData = BX.prop.getObject(requisiteFields, 'RQ_ADDR', null);\n\t\t\t\trequisite.setInitialAddressData(addressData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\trequisite.setInitAddrData(null);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFirstEditModeField()\n\t{\n\t\tif (this._requisiteField && this._requisiteField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._requisiteField;\n\t\t}\n\t\tif (this._addressField && this._addressField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._addressField;\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdateRequisiteFieldModel()\n\t{\n\t\tlet modelValue = this._requisiteList.exportToModel();\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._model.setField(this._requisiteFieldId, modelValue);\n\t\t}\n\t\tthis.saveRequisiteInitData([...modelValue]);\n\t}\n\n\tgetRequisiteFieldValue()\n\t{\n\t\tif (!this._requisiteFieldId)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn this._model.getField(this._requisiteFieldId, []);\n\t}\n\n\taddEditorFormInputs()\n\t{\n\t\tthis._formInputsWrapper = Tag.render`<div></div>`;\n\t\tDom.append(this._formInputsWrapper, this._editor.getFormElement());\n\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DELETED]\" value=\"Y\" >`, this._formInputsWrapper);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet dataInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DATA]\" value=\"${Tag.safe`${requisite.getRequisiteData()}`}\" >`;\n\t\t\tlet signInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][SIGN]\" value=\"${requisite.getRequisiteDataSign()}\" >`;\n\t\t\tDom.append(dataInput, this._formInputsWrapper);\n\t\t\tDom.append(signInput, this._formInputsWrapper);\n\t\t}\n\t}\n\n\tremoveEditorFormInputs()\n\t{\n\t\tif (Type.isDomNode(this._formInputsWrapper))\n\t\t{\n\t\t\tDom.remove(this._formInputsWrapper);\n\t\t\tthis._formInputsWrapper = null;\n\t\t}\n\t}\n\n\tmarkFieldsAsChanged()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.markAsChanged();\n\t\t}\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.markAsChanged();\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tisLoading()\n\t{\n\t\treturn !!this._isLoading;\n\t}\n\n\tstartLoading()\n\t{\n\t\tthis._isLoading = true;\n\t}\n\n\tstopLoading()\n\t{\n\t\tthis._isLoading = false;\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tprepareRequisiteByEventData(eventData)\n\t{\n\t\tlet requisite = this._requisiteList.getById(eventData.id);\n\t\tif (!requisite)\n\t\t{\n\t\t\tlet extraFields = {\n\t\t\t\tselected: this._requisiteList.isEmpty(),\n\t\t\t\tpresetId: eventData.defaultPresetId\n\t\t\t};\n\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\textraFields.autocompleteState = eventData.autocompleteState;\n\t\t\t}\n\n\t\t\trequisite = RequisiteListItem.create(null, {\n\t\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t\t'newRequisiteExtraFields': extraFields\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(eventData.autocompleteState);\n\t\t\t}\n\t\t}\n\t\treturn requisite;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\treturn this._requisiteField.getDefaultPresetId();\n\t\t}\n\t\telse // if requisiteField is hidden\n\t\t{\n\t\t\tlet schemeElement = this._editor.getScheme().getAvailableElements()\n\t\t\t\t.filter((item) => (item.getName() === this._requisiteFieldId))\n\t\t\t\t.reduce((prev, current) => current, null);\n\n\t\t\tif (!schemeElement)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor (let preset of BX.prop.getArray(schemeElement.getData(), \"presets\", []))\n\t\t\t{\n\t\t\t\tif (preset.IS_DEFAULT)\n\t\t\t\t{\n\t\t\t\t\treturn preset.VALUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsignRequisiteFields(requisite)\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\treturn this._requisiteEditor.getSignRequisitePromise(requisite);\n\t}\n\n\tonFieldInit(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet field = eventData.field;\n\t\tif (field)\n\t\t{\n\t\t\tlet fieldId = field.getId();\n\t\t\tif (Type.isStringFilled(this._requisiteFieldId) && fieldId === this._requisiteFieldId)\n\t\t\t{\n\t\t\t\tthis._requisiteField = field;\n\t\t\t\tthis.initRequisiteField();\n\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditNew', this.onEditNewRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditExisted', this.onEditExistedRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onFinishAutocomplete', this.onFinishRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onClearAutocomplete', this.onClearRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onSetDefault', this.onSetDefaultRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onDelete', this.onDeleteRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onHide', this.onHideRequisite.bind(this));\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(this._addressFieldId) && fieldId === this._addressFieldId)\n\t\t\t{\n\t\t\t\tthis._addressField = field;\n\t\t\t\tthis.initAddressField();\n\n\t\t\t\tEventEmitter.subscribe(this._addressField, 'onAddressListUpdate', this.onAddressListUpdate.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis.openEditor(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet options = BX.prop.getObject(params, 'options', {});\n\t\t\tif (Type.isPlainObject(options.autocompleteState))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(options.autocompleteState);\n\t\t\t}\n\t\t\tlet editorOptions = {};\n\t\t\tif (Type.isPlainObject(options.editorOptions))\n\t\t\t{\n\t\t\t\teditorOptions = options.editorOptions;\n\t\t\t}\n\t\t\tthis.openEditor(requisite, editorOptions);\n\t\t}\n\t}\n\n\tonClearRequisiteAutocomplete(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\trequisite.clearFormData();\n\t\t}\n\t}\n\n\tonFinishRequisiteAutocomplete(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet requisite = this.prepareRequisiteByEventData(eventData);\n\t\tlet formData = BX.prop.getObject(BX.prop.getObject(eventData, 'data', {}), 'fields', {});\n\t\tif (formData.hasOwnProperty('RQ_ADDR'))\n\t\t{\n\t\t\tif (Type.isPlainObject(formData.RQ_ADDR))\n\t\t\t{\n\t\t\t\tlet oldAddr = requisite.getAddressList();\n\t\t\t\toldAddr = Type.isPlainObject(oldAddr) ? oldAddr : {};\n\n\t\t\t\tlet addr = {...oldAddr, ...formData.RQ_ADDR};\n\t\t\t\trequisite.setAddressData(addr);\n\t\t\t\trequisite.setAddressList(addr);\n\t\t\t}\n\t\t\tdelete (formData.RQ_ADDR);\n\t\t}\n\t\trequisite.setFormData(formData);\n\t\trequisite.setChanged(true);\n\t\trequisite.setDeleted(false);\n\t\tlet presetId = BX.prop.getInteger(formData, 'PRESET_ID', 0);\n\t\tif (presetId > 0)\n\t\t{\n\t\t\trequisite.setPresetId(presetId);\n\t\t}\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tthis._requisiteList.add(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t\tif (requisite.isAddressOnly())\n\t\t{\n\t\t\tthis._requisiteList.unhide(requisite);\n\t\t}\n\t}\n\n\tonSetDefaultRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet id = eventData.id;\n\t\tlet bankDetailId = eventData.bankDetailId;\n\n\t\tif (this._addressField && this._addressField.isChanged())\n\t\t{\n\t\t\tthis._editor.cancel();\n\t\t\treturn false; // have to save address first\n\t\t}\n\n\t\tthis.setSelectedRequisite(id, bankDetailId);\n\t\tthis.updateRequisiteFieldModel();\n\n\t\treturn true;\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis.setRequisiteInitAddrData(requisite);\n\t\t}\n\t\tif (params.postponed)\n\t\t{\n\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\t\tthis._requisiteEditor.deleteRequisite(params.id);\n\t\t}\n\t}\n\n\tonHideRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteList.hide(requisite);\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tthis.initAddressField();\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\teventData.id = this._requisiteList.getSelectedId();\n\n\t\teventData.defaultPresetId = this.getDefaultPresetId();\n\n\t\tlet requisite = this.prepareRequisiteByEventData(eventData);\n\n\t\tlet addresses = {};\n\t\tlet isEmptyAddress = true;\n\t\tfor (let address of eventData.value)\n\t\t{\n\t\t\taddresses[address.type] = address.value;\n\t\t\tif (Type.isStringFilled(address.value))\n\t\t\t{\n\t\t\t\tisEmptyAddress = false;\n\t\t\t}\n\t\t}\n\n\t\trequisite.setAddressData(addresses);\n\t\trequisite.setAddressList(addresses);\n\n\t\trequisite.setChanged(true);\n\t\tif (!isEmptyAddress)\n\t\t{\n\t\t\trequisite.setDeleted(false);\n\t\t}\n\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tif (!isEmptyAddress)\n\t\t\t{\n\t\t\t\trequisite.setAddressOnly(true);\n\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//  remove requisite if address is empty and requisite contain only address\n\t\t\tif (isEmptyAddress && requisite.isAddressOnly())\n\t\t\t{\n\t\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t\t}\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tsuper.onBeforeSubmit();\n\t\tthis.addEditorFormInputs();\n\t}\n\n\tonBeforesSaveControl(data)\n\t{\n\t\tif (!data.hasOwnProperty('REQUISITES'))\n\t\t{\n\t\t\tdata['REQUISITES'] = {};\n\t\t}\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (!requisite.isChanged() && !requisite.isDeleted())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet requisiteData = {};\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\trequisiteData['DELETED'] = 'Y';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trequisiteData['DATA'] = requisite.getRequisiteData();\n\t\t\t\trequisiteData['SIGN'] = requisite.getRequisiteDataSign();\n\t\t\t}\n\t\t\tdata['REQUISITES'][requisite.getRequisiteId()] = requisiteData;\n\t\t}\n\t\treturn data;\n\t}\n\n\tonAfterSave()\n\t{\n\t\tsuper.onAfterSave();\n\t\tthis.saveRequisiteInitData(this.getRequisiteFieldValue());\n\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\n\t\tthis.removeEditorFormInputs();\n\t}\n\n\tonRequisiteEditorAfterEdit()\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tthis.updateRequisiteFieldModel();\n\t\t}\n\t\tthis.markFieldsAsChanged();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet isEmptyRequisitesList = this._requisiteList.isEmpty();\n\t\tif (!isEmptyRequisitesList && data.selectedRemoved)\n\t\t{\n\t\t\t// set new default requisite\n\t\t\tthis.setSelectedRequisite(0, 0);\n\t\t}\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteController();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {MenuManager} from \"main.popup\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Loc, Text} from \"main.core\";\n\nexport class PresetMenu extends EventEmitter\n{\n\tconstructor(id, presetList)\n\t{\n\t\tsuper();\n\t\tthis._isShown = false;\n\t\tthis.menuId = id;\n\t\tthis.presetList = presetList;\n\t}\n\n\ttoggle(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse if (bindElement)\n\t\t{\n\t\t\tthis.show(bindElement);\n\t\t}\n\t}\n\n\tshow(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.presetList || !this.presetList.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('REQUISITE_LIST_EMPTY_PRESET_LIST'), Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t\t\treturn;\n\t\t}\n\t\tlet menu = [];\n\t\tfor (let item of this.presetList)\n\t\t{\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Text.encode(item.name),\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\tonclick: this.onSelect.bind(this, item)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.menuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = MenuManager.getMenuById(this.menuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.popupWindow.close();\n\t\t}\n\t}\n\n\tisShown()\n\t{\n\t\treturn this._isShown;\n\t}\n\n\tonSelect(item)\n\t{\n\t\tthis.close();\n\t\tthis.emit('onSelect', item);\n\t}\n}","import {PopupManager} from \"main.popup\";\nimport {Tag, Type, Loc, Text} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {PresetMenu} from \"./preset-menu\";\nimport {Loader} from \"main.loader\";\n\nexport class EntityEditorRequisiteTooltip\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tthis._padding = BX.prop.getInteger(this._settings, 'padding', 20);\n\t\tthis._showTimer = false;\n\t\tthis._closeTimer = false;\n\t\tthis._closeTimeout = BX.prop.getInteger(this._settings, 'closeTimeout', 700);\n\t\tthis._showTimeout = BX.prop.getInteger(this._settings, 'showTimeout', 500);\n\t\tthis._popupId = this._id + '_popup';\n\n\t\tthis._isReadonly = BX.prop.getBoolean(this._settings, 'readonly', true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(this._settings, 'canChangeDefaultRequisite', true);\n\n\t\tthis._bindElement = null;\n\t\tthis._wrapper = null;\n\t\tthis._requisiteList = null;\n\n\t\tthis._isLoading = false;\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\n\t\tthis.presetMenu = new PresetMenu(this._id + '_preset_menu', BX.prop.getArray(this._settings, 'presets', []));\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisite.bind(this));\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteTooltip();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis.refreshLayout();\n\t}\n\n\tsetBindElement(bindElement, wrapper)\n\t{\n\t\tthis._bindElement = bindElement;\n\t\tif (!Type.isDomNode(wrapper))\n\t\t{\n\t\t\twrapper = this._bindElement.parentNode ? this._bindElement.parentNode : null;\n\t\t}\n\t\tthis._wrapper = wrapper;\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tthis._isLoading = !!isLoading;\n\t\tthis.refreshLayout();\n\t}\n\n\tshow()\n\t{\n\t\tthis.cancelCloseDebounced();\n\n\t\tlet success = false;\n\t\tif (this._requisiteList && !this._requisiteList.isEmpty())\n\t\t{\n\t\t\tlet popup = PopupManager.create({\n\t\t\t\tid: this._popupId,\n\t\t\t\tcacheable: false,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: this._padding,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tcontent: this.getLayout(),\n\t\t\t\tcloseByEsc: true\n\t\t\t});\n\t\t\tpopup.show();\n\t\t\tthis.adjustPosition();\n\t\t\tsuccess = true;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'onShow', {success});\n\t}\n\n\n\tshowDebounced(delayMultiplier = false)\n\t{\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelShowDebounced();\n\t\tthis.cancelCloseDebounced();\n\t\tthis._showTimer = setTimeout(this.show.bind(this), this._showTimeout * delayMultiplier);\n\t}\n\n\tcancelShowDebounced()\n\t{\n\t\tclearTimeout(this._showTimer);\n\t}\n\n\tcloseDebounced(delayMultiplier = false)\n\t{\n\t\tthis.cancelShowDebounced();\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelCloseDebounced();\n\t\tthis._closeTimer = setTimeout(this.close.bind(this), this._closeTimeout * delayMultiplier);\n\t}\n\n\tcancelCloseDebounced()\n\t{\n\t\tclearTimeout(this._closeTimer);\n\t}\n\n\tadjustPosition()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (!popup || !popup.isShown() || !Type.isDomNode(this._bindElement)\n\t\t\t|| !Type.isDomNode(this._wrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst wrapperRect = this._wrapper.getBoundingClientRect();\n\t\tconst itemRect = this._bindElement.getBoundingClientRect();\n\n\t\tlet offsetLeft = wrapperRect.width - (itemRect.left - wrapperRect.left);\n\n\t\tlet offsetTop = itemRect.height / 2 + this._padding;\n\t\tlet angleOffset = itemRect.height / 2;\n\n\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\tconst popupHeight = popup.getPopupContainer().offsetHeight;\n\t\tconst popupBottom = itemRect.top + popupHeight;\n\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\t// let's try to fit a popup to the browser viewport\n\t\tconst exceeded = popupBottom - clientHeight;\n\t\tif (exceeded > 0)\n\t\t{\n\t\t\tlet roundOffset = Math.ceil(exceeded / itemRect.height) * itemRect.height;\n\t\t\tif (roundOffset > itemRect.top)\n\t\t\t{\n\t\t\t\t// it cannot be higher than the browser viewport.\n\t\t\t\troundOffset -= Math.ceil((roundOffset - itemRect.top) / itemRect.height) * itemRect.height;\n\t\t\t}\n\n\t\t\tif (itemRect.bottom > (popupBottom - roundOffset))\n\t\t\t{\n\t\t\t\t// let's sync bottom boundaries.\n\t\t\t\troundOffset -= itemRect.bottom - (popupBottom - roundOffset) + this._padding;\n\t\t\t}\n\n\t\t\toffsetTop += roundOffset;\n\t\t\tangleOffset += roundOffset + this._padding;\n\t\t}\n\n\t\tpopup.setBindElement(this._bindElement);\n\n\t\tif ((wrapperRect.left + offsetLeft + popupWidth) <= clientWidth)\n\t\t{\n\t\t\tpopup.setAngle({position: 'left', offset: angleOffset});\n\n\t\t\toffsetLeft += popup.angle ? popup.angle.element.offsetWidth : 0;\n\t\t\toffsetTop += popup.angle ? Math.ceil(popup.angle.element.offsetHeight / 2) : 0;\n\t\t\tpopup.setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setAngle(true);\n\t\t}\n\t\tpopup.adjustPosition();\n\t}\n\n\tclose()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tpopup ? popup.close() : null;\n\t\tthis.presetMenu.close();\n\t}\n\n\tremoveDebouncedEvents()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t\tthis.cancelShowDebounced();\n\t}\n\n\trefreshLayout()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.setContent(this.getLayout());\n\t\t}\n\t}\n\n\tgetLayout()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\tlet loader = new Loader();\n\n\t\t\tlet container = Tag.render`<div class=\"crm-rq-wrapper crm-rq-wrapper-loading\"></div>`;\n\t\t\tloader.show(container);\n\t\t\treturn container;\n\t\t}\n\t\tlet requisites = Type.isNull(this._requisiteList) ? [] : this._requisiteList.getList();\n\t\tlet renderRequisiteEditButtonNode = (id) =>\n\t\t{\n\t\t\tif (this._isReadonly)\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_SHOW_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_EDIT')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" data-requisite-id=\"${id}\" onclick=\"${this.onDeleteRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_TOOLTIP_DELETE')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onAddBankDetails.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t};\n\n\t\tlet renderRequisiteBankDetails = (requisite, id) =>\n\t\t{\n\t\t\tlet bandDetails = requisite.getBankDetails();\n\t\t\tlet selectedBankDetailId = requisite.getSelectedBankDetailId();\n\t\t\treturn bandDetails.length ?\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-requisite-container\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-title\">${Loc.getMessage('REQUISITE_TOOLTIP_BANK_DETAILS_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-list\">\n\t\t\t\t\t\t\t${bandDetails.map((bankDetail, index) => Tag.render`\n\t\t\t\t\t\t\t\t<label class=\"crm-rq-org-requisite-item\" onclick=\"${this.onSetSelectedBankDetails.bind(this)}\">\n\t\t\t\t\t\t\t\t\t<input type=\"radio\" data-requisite-id=\"${id}\" data-bankdetails-id=\"${index}\" class=\"crm-rq-org-requisite-btn\" ${requisite.isSelected() && (index === selectedBankDetailId) ? ' checked' : ''} ${this._canChangeDefaultRequisite ? '': ' disabled'}>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-rq-org-requisite-info\">${Text.encode(bankDetail.value)}</span>\n\t\t\t\t\t\t\t\t</label>`)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${renderRequisiteEditButtonNode(id)}\n\t\t\t\t\t</div>`\n\t\t\t\t:\n\t\t\t\trenderRequisiteEditButtonNode(id)\n\t\t};\n\n\t\treturn Tag.render`\n\t\t<div class=\"crm-rq-wrapper\"\n\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\"\n\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\">\n\t\t\t<div class=\"crm-rq-org-list\">\n\t\t\t\t${requisites.map((requisite, index) => Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-item${requisite.isSelected() ? ' crm-rq-org-item-selected' : ''}\" onclick=\"${this.onSetSelectedRequisite.bind(this, index)}\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-info-container\">\n\t\t\t\t\t\t\t<div class=\"crm-rq-org-name\">${Text.encode(requisite.getTitle())}</div>\n\t\t\t\t\t\t\t${requisite.getSubtitle().length ? Tag.render`<div class=\"crm-rq-org-description\">${Text.encode(requisite.getSubtitle())}</div>` : ''}\n\t\t\t\t\t\t\t${renderRequisiteBankDetails(requisite, index)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}\n\t\t\t</div>\n\t\t\t${this._isReadonly ? '' :\n\t\t\tTag.render`<div class=\"crm-rq-btn-container\">\n\t\t\t\t<span class=\"crm-rq-add-rq\" onclick=\"${this.onStartAddRequisite.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"></span> ${Loc.getMessage('REQUISITE_TOOLTIP_ADD')}\n\t\t\t\t</span>\n\t\t\t</div>`}\n\t\t</div>`;\n\t}\n\n\tsetSelectedRequisite(id, bankDetailId)\n\t{\n\t\tlet newSelectedRequisite = this._requisiteList.getById(id);\n\t\tif (!newSelectedRequisite)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\tif (id === this._requisiteList.getSelectedId()) // selected the same requisite\n\t\t{\n\t\t\tlet selectedBankDetails = selectedRequisite.getBankDetails();\n\t\t\tif (selectedBankDetails.length)\n\t\t\t{\n\t\t\t\tfor (let index = 0; index < selectedBankDetails.length; index++)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetails = selectedBankDetails[index];\n\t\t\t\t\tif (Type.isObject(bankDetails) && bankDetails.selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (index === bankDetailId || Type.isNull(bankDetailId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false; // selected same requisite and bank details\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn false; // requisite already selected and hasn't bank details\n\t\t\t}\n\t\t}\n\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {id, bankDetailId});\n\n\t\treturn true;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif (!this.presetMenu.isShown())\n\t\t{\n\t\t\tthis.closeDebounced(1.5);\n\t\t}\n\t}\n\n\tonStartAddRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.presetMenu.toggle(event.target);\n\n\t}\n\n\tonAddRequisite(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.close();\n\t\tEventEmitter.emit(this, 'onAddRequisite', {\n\t\t\tpresetId: data.value\n\t\t});\n\t}\n\n\tonEditRequisite(id, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onEditRequisite', {id});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (Type.isDomNode(element))\n\t\t{\n\t\t\tlet id = element.getAttribute('data-requisite-id');\n\t\t\tEventEmitter.emit(this, 'onDeleteRequisite', {id});\n\t\t}\n\t}\n\n\tonAddBankDetails(requisiteId, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onAddBankDetails', {requisiteId});\n\t}\n\n\tonSetSelectedRequisite(id)\n\t{\n\t\tif (this._canChangeDefaultRequisite)\n\t\t{\n\t\t\tthis.setSelectedRequisite(id, null);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonSetSelectedBankDetails(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (this._canChangeDefaultRequisite && Type.isDomNode(element))\n\t\t{\n\t\t\tif (element.nodeName.toString().toLowerCase() !== 'input')\n\t\t\t{\n\t\t\t\telement = element.querySelector('input');\n\t\t\t\tif (!Type.isDomNode(element))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.checked = false;\n\t\t\tlet id = parseInt(element.getAttribute('data-requisite-id'));\n\t\t\tlet bankDetailsId = parseInt(element.getAttribute('data-bankdetails-id'));\n\t\t\tthis.setSelectedRequisite(id, bankDetailsId);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonChangeRequisites(event)\n\t{\n\t\tthis.refreshLayout();\n\t}\n}","import {Loc, Tag, Dom, Type, Event} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteTooltip} from './requisite-tooltip';\nimport {PresetMenu} from './preset-menu';\n\nexport class EntityEditorRequisiteField extends BX.Crm.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._domNodes = {};\n\t\tthis._requisiteList = null;\n\n\t\tthis.presetMenu = null;\n\t\tthis._autocomplete = null;\n\t\tthis._tooltip = null;\n\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tcanAddRequisite: true,\n\t\t\tfeedbackFormParams: BX.prop.getObject(this._schemeElement.getData(), \"feedback_form\", {}),\n\t\t\tenabled: true,\n\t\t\tshowFeedbackLink: false\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onCreateNewItem', this.onAddRequisiteFromAutocomplete.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\n\t\tthis.presetMenu = new PresetMenu(this.getName() + '_requisite_preset_menu', this.getPresetList());\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisiteFromMenu.bind(this));\n\n\t\tlet isReadonly = this.getEditor().isReadOnly();\n\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this.getName() + '_requisite_details', {\n\t\t\treadonly: isReadonly,\n\t\t\tcanChangeDefaultRequisite: !isReadonly,\n\t\t\tpresets: this.getPresetList()\n\t\t});\n\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onAddRequisiteFromTooltip.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\n\t\tthis.updateAutocompletePlaceholder();\n\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tconst hasRequisites = this.hasRequisites();\n\t\tconst vasEmpty = hasRequisites && this.getRequisites().isEmpty();\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis._tooltip.setRequisites(requisiteList);\n\t\tif (hasRequisites && !vasEmpty && !this.getRequisites().isEmpty())\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayout();\n\t\t}\n\t}\n\n\tgetRequisites()\n\t{\n\t\treturn this._requisiteList;\n\t}\n\n\thasRequisites()\n\t{\n\t\treturn Type.isObject(this._requisiteList);\n\t}\n\n\tisSingleMode()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.getRequisites().getList().length <= 1);\n\t}\n\n\tgetTitle()\n\t{\n\t\tlet title = super.getTitle();\n\t\tif (this.hasRequisites() && !this.isSingleMode())\n\t\t{\n\t\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t\tlet selectedPresetId = selectedRequisite ? selectedRequisite.getPresetId() : null;\n\t\t\tif (selectedRequisite && selectedPresetId)\n\t\t\t{\n\t\t\t\tlet selectedPresetName = this.getPresetList().reduce(\n\t\t\t\t\t(name, item) => ((item.value === selectedPresetId) ? item.name : name), '');\n\n\t\t\t\tif (selectedPresetName.length)\n\t\t\t\t{\n\t\t\t\t\ttitle += ' (' + selectedPresetName + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn title;\n\t}\n\n\tcreateTitleActionControls()\n\t{\n\t\tif (this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tif (!this.isAutocompleteEnabled())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [\n\t\t\tTag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t \tonclick=\"${this.editDefaultRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_TEXT')}</span>`\n\t\t];\n\t}\n\n\tisNeedToDisplay(options)\n\t{\n\t\treturn this.hasRequisites() && super.isNeedToDisplay(options);\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._domNodes = {};\n\t\tthis.ensureWrapperCreated({classNames: [\"crm-entity-widget-content-block-field-requisites\"]});\n\t\tthis.adjustWrapper();\n\t\tthis.bindWrapperEvents();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tif (this.isAutocompleteEnabled())\n\t\t\t{\n\t\t\t\tthis._domNodes.addButton = null;\n\t\t\t\tDom.append(this.renderAutocompleteForm(), this._wrapper);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._domNodes.addButton = this.renderAddButton();\n\t\t\t\tDom.append(this._domNodes.addButton, this._wrapper);\n\t\t\t}\n\t\t}\n\t\telse // if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tDom.append(this.renderSelectedRequisite(), this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tbindWrapperEvents()\n\t{\n\t\tif (!this.wrapperMouseEnterHandler)\n\t\t{\n\t\t\tthis.wrapperMouseEnterHandler = this.onFieldMouseEnter.bind(this);\n\t\t}\n\t\tif (!this.wrapperMouseLeaveHandler)\n\t\t{\n\t\t\tthis.wrapperMouseLeaveHandler = this.onFieldMouseLeave.bind(this);\n\t\t}\n\n\t\tEvent.unbind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.unbind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\n\t\tEvent.bind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.bind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\t}\n\n\trefreshLayoutParts()\n\t{\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.refreshTitleLayout();\n\t\tthis.updateAutocompleteState();\n\t}\n\n\thasContentToDisplay()\n\t{\n\t\treturn this.hasValue();\n\t}\n\n\thasValue()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn  false;\n\t\t}\n\t\tlet list = this.getRequisites().getList();\n\t\tif (list.length > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\t// if list contains only one item, it shouldn't be hidden:\n\t\treturn (list.length === 1 && !list[0].isAddressOnly());\n\t}\n\n\tisAutocompleteEnabled()\n\t{\n\t\tif (!this.hasRequisites() || this.getRequisites().isEmpty())\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\t\treturn true;\n\t}\n\n\trenderSelectedRequisite()\n\t{\n\t\tthis._domNodes.selectedRequisiteView = Tag.render`<span></span>`;\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.updateAutocompleteState();\n\t\tlet container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\" \n\t\t\t\tonclick=\"${this.onViewStringClick.bind(this)}\"\n\t\t\t\tonmouseenter=\"${this.onViewStringMouseEnter.bind(this)}\">\n\t\t\t\t\t${this._domNodes.selectedRequisiteView}\n\t\t\t</div>`;\n\t\tthis._tooltip.setBindElement(container, this.getEditor().getFormElement());\n\t\t return container;\n\t}\n\n\tupdateSelectedRequisiteText()\n\t{\n\t\tif (!this._domNodes.selectedRequisiteView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selectedRequisite = this.hasRequisites() && this.getRequisites().getSelected();\n\t\tif (this.hasValue() && selectedRequisite && selectedRequisite.getTitle().length)\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.add('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = selectedRequisite.getTitle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.remove('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = BX.UI.EntityEditorField.messages.isEmpty;\n\t\t}\n\t}\n\n\trenderAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-content-block crm-entity-widget-content-block-requisites\">\n\t\t\t<span class=\"crm-entity-widget-client-requisites-add-btn\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t</div>`;\n\t}\n\n\trenderAutocompleteForm()\n\t{\n\t\tlet autocompleteContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\"></div>`;\n\t\tlet hasResolvers = !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\tthis._autocomplete.setEnabled(hasResolvers);\n\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\tthis.updateAutocompleteState();\n\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t${autocompleteContainer}\n\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteValue = null;\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite && !selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tautocompleteValue = selectedRequisite.getAutocompleteData();\n\t\t}\n\t\tthis._autocomplete.setCurrentItem(autocompleteValue);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tupdateAutocompletePlaceholder()\n\t{\n\t\tlet selectedPresetId = this.getSelectedPresetId();\n\t\tlet clientResolverProp = this.getClientResolverPropForPreset(selectedPresetId);\n\n\t\tthis._autocomplete.setEnabled(!!clientResolverProp);\n\n\t\tlet title = BX.prop.getString(clientResolverProp, 'TITLE');\n\t\tthis._autocomplete.setPlaceholderText(title);\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.IS_DEFAULT)\n\t\t\t{\n\t\t\t\treturn preset.VALUE;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetSelectedPresetId()\n\t{\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\treturn selectedRequisite.getPresetId();\n\t\t}\n\t\treturn this.getDefaultPresetId();\n\t}\n\n\tgetClientResolverPropForPreset(presetId)\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.VALUE === presetId)\n\t\t\t{\n\t\t\t\treturn BX.prop.get(preset, 'CLIENT_RESOLVER_PROP', null);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\treturn {\n\t\t\tpresetId: this.getSelectedPresetId()\n\t\t};\n\t}\n\n\ttoggleNewRequisitePresetMenu(e)\n\t{\n\t\tthis.presetMenu.toggle(e.target);\n\t};\n\n\tgetPresetList()\n\t{\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._schemeElement.getData(), \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\taddRequisite(params)\n\t{\n\t\tEventEmitter.emit(this, 'onEditNew', params);\n\t}\n\n\teditRequisite(id, options)\n\t{\n\t\tEventEmitter.emit(this, 'onEditExisted', {id, options});\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tthis._tooltip.removeDebouncedEvents();\n\t\tthis._tooltip.close();\n\t\tEventEmitter.emit(this, 'onDelete', {id, postponed: this._mode === BX.UI.EntityEditorMode.edit});\n\t}\n\n\thideRequisite(id)\n\t{\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tEventEmitter.emit(this, 'onHide', {id});\n\t}\n\n\tshowDeleteConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.markAsChanged();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tshowClearConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"hide_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.hideRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\teditDefaultRequisite()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: this.getDefaultPresetId(),\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tif (\n\t\t\t(this._domNodes && Type.isDomNode(this._domNodes.addButton)) ||\n\t\t\t(this.hasRequisites() && this.getRequisites().isEmpty()) ||\n\t\t\t(this.hasRequisites() && this.getRequisites().getSelected().isAddressOnly())\n\t\t)\n\t\t{\n\t\t\tthis.refreshLayout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\tthis.updateAutocompletePlaceholder();\n\t}\n\n\tonAddRequisiteFromMenu(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t// if hidden requisite is selected, it will be used instead of new:\n\t\tif (null !== selectedRequisite && selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tthis.editRequisite(this.getRequisites().indexOf(selectedRequisite), {\n\t\t\t\teditorOptions: {\n\t\t\t\t\toverriddenPresetId: data.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: data.value\n\t\t\t});\n\t\t}\n\t}\n\n\tonAddRequisiteFromTooltip(event)\n\t{\n\t\tthis.addRequisite(event.getData());\n\t}\n\n\tonAddRequisiteFromAutocomplete()\n\t{\n\t\tthis.editDefaultRequisite();\n\t}\n\n\tonEditRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.id, {\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.showDeleteConfirmation(eventData.id);\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.requisiteId, {\n\t\t\teditorOptions: {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t},\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setLoading(true);\n\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tEventEmitter.emit(this, 'onFinishAutocomplete', {\n\t\t\tid: selectedRequisiteId,\n\t\t\tdefaultPresetId: this.getDefaultPresetId(),\n\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\tdata\n\t\t});\n\t}\n\n\tonClearAutocompleteValue()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\t\tlet hasAddresses = false;\n\t\t\tlet addresses = selectedRequisite.getAddressList();\n\t\t\tfor (let addressType in addresses)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\taddresses.hasOwnProperty(addressType) &&\n\t\t\t\t\tType.isStringFilled(addresses[addressType])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\thasAddresses = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasAddresses)\n\t\t\t{\n\t\t\t\tthis.showClearConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDeleteConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewStringClick()\n\t{\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t\tthis.switchToSingleEditMode();\n\t\t}\n\t}\n\n\tonViewStringMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced();\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onSetDefault', eventData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonFieldMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced(5);\n\t\t}\n\t}\n\n\tonFieldMouseLeave()\n\t{\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t}\n}\n","import {EntityEditorAddressField} from \"crm.entity-editor.field.address\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class EntityEditorRequisiteAddressField extends EntityEditorAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\trollback()\n\t{\n\t\t// rollback will be executed in requisite controller\n\t}\n\n\treset()\n\t{\n\t\t// reset will be executed in requisite controller\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tsuper.onAddressListUpdate(event);\n\t\tEventEmitter.emit(this, 'onAddressListUpdate', event);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n","import {Loc, Dom, Type, Tag} from \"main.core\";\nimport {Loader} from \"main.loader\";\nimport {EntityEditorBaseAddressField} from \"crm.entity-editor.field.address.base\";\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteTooltip} from \"./requisite-tooltip\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\";\n\nexport class EntityEditorClientRequisites\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._entityInfo = null;\n\t\tthis._fieldsParams = null;\n\t\tthis._loaderConfig = null;\n\t\tthis._addressConfig = null;\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._readonly = true;\n\t\tthis._requisiteEditUrl = null;\n\t\tthis._addressContainer = null;\n\t\tthis._formElement = null;\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.setEntity(BX.prop.get(settings, \"entityInfo\", null), false);\n\t\tif (!this._entityInfo)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: EntityInfo must be instance of BX.CrmEntityInfo\";\n\t\t}\n\t\tthis._fieldsParams = BX.prop.get(settings, \"fieldsParams\", null);\n\t\tif (!this._fieldsParams)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: Fields params are undefined\";\n\t\t}\n\t\tthis._addressConfig = BX.prop.getObject(this._fieldsParams, 'ADDRESS', null);\n\n\t\tthis._requisitesConfig = BX.prop.getObject(this._fieldsParams, 'REQUISITES', null);\n\n\t\tif (this._requisiteList)\n\t\t{\n\t\t\tlet selectedItem = BX.prop.getObject(settings, \"requisiteBinding\", null);\n\t\t\tif (selectedItem\n\t\t\t\t&& !Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t\t{\n\t\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\t\tif (requisite)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._loaderConfig = BX.prop.getObject(settings, 'loaderConfig', null);\n\n\t\tthis._readonly = BX.prop.getBoolean(settings, \"readonly\", true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(settings, \"canChangeDefaultRequisite\", true);\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, \"requisiteEditUrl\", null);\n\t\tthis._formElement = BX.prop.get(settings, \"formElement\", null);\n\n\t\tif (BX.prop.getBoolean(settings, \"enableTooltip\", true) && !Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this._id + '_client_requisite_details', {\n\t\t\t\treadonly: this._readonly,\n\t\t\t\tcanChangeDefaultRequisite: this._canChangeDefaultRequisite,\n\t\t\t\tpresets: this.getRequisitesPresetList()\n\t\t\t});\n\t\t}\n\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._entityInfo.getTypeId(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\tcontextId: BX.prop.getString(settings, \"contextId\", \"\"),\n\t\t\trequisiteEditUrl: this._requisiteEditUrl\n\t\t});\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onEditNewRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditExistedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onShow', this.onShowTooltip.bind(this));\n\t\t}\n\t}\n\n\tsetEntity(entityInfo, emitNotification)\n\t{\n\t\tthis._entityInfo = entityInfo;\n\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._requisiteList = RequisiteList.create(this._entityInfo.getRequisites());\n\t\t}\n\t\tif (emitNotification)\n\t\t{\n\t\t\tthis.onChangeRequisiteList();\n\t\t}\n\t}\n\n\taddressLayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._addressContainer = Tag.render`<div class=\"crm-entity-widget-client-address\"></div>`;\n\t\tDom.append(this._addressContainer, container);\n\t\tthis.doAddressLayout();\n\t}\n\n\tdoAddressLayout()\n\t{\n\t\tif (!Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this._addressContainer);\n\n\t\tif (!Type.isNull(this._addressConfig))\n\t\t{\n\t\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t\t{\n\t\t\t\tlet defaultRequisite = this._requisiteList.getSelected();\n\t\t\t\tlet addressValue = defaultRequisite ? defaultRequisite.getAddressList() : null;\n\n\t\t\t\tif (!Type.isNull(addressValue) && Object.keys(addressValue).length)\n\t\t\t\t{\n\t\t\t\t\tthis._addressField = EntityEditorBaseAddressField.create(this._entityInfo.getId(), {\n\t\t\t\t\t\tshowFirstItemOnly: true,\n\t\t\t\t\t\tshowAddressTypeInViewMode: true\n\t\t\t\t\t});\n\t\t\t\t\tthis._addressField.setMultiple(true);\n\t\t\t\t\tthis._addressField.setTypesList(BX.prop.getObject(this._addressConfig, \"types\", {}));\n\t\t\t\t\tthis._addressField.setValue(addressValue);\n\t\t\t\t\tDom.append(this._addressField.layout(false), this._addressContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet showAddressLink = Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onLoadAddressMouseUp.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('CLIENT_REQUISITES_ADDRESS_SHOW_ADDRESS')}\n\t\t\t\t</span>`;\n\n\t\t\t\tDom.append(showAddressLink, this._addressContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowTooltip(bindElement)\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tif (this.isRequisiteAddressOnly())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._tooltip.setBindElement(bindElement, this._formElement);\n\t\tthis._tooltip.showDebounced();\n\t}\n\n\tcloseTooltip()\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\trelease()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.release();\n\t\t}\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t}\n\t}\n\n\tloadEntity()\n\t{\n\t\tif (!this._loaderConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\tlet loader = new Loader({size: 19, mode: 'inline'});\n\t\t\tDom.clean(this._addressContainer);\n\t\t\tloader.show(this._addressContainer);\n\t\t}\n\n\t\tBX.CrmDataLoader.create(\n\t\t\tthis._id,\n\t\t\t{\n\t\t\t\tserviceUrl: this._loaderConfig[\"url\"],\n\t\t\t\taction: this._loaderConfig[\"action\"],\n\t\t\t\tparams: {\n\t\t\t\t\t\"ENTITY_TYPE_NAME\": this._entityInfo.getTypeName(),\n\t\t\t\t\t\"ENTITY_ID\": this._entityInfo.getId(),\n\t\t\t\t\t\"NORMALIZE_MULTIFIELDS\": \"Y\"\n\t\t\t\t}\n\t\t\t}\n\t\t).load(this.onEntityInfoLoad.bind(this));\n\t}\n\n\tgetRequisitesPresetList()\n\t{\n\t\tif (Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._requisitesConfig, \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t}\n\t\tthis._requisiteEditor.deleteRequisite(id);\n\t}\n\n\tisRequisiteAddressOnly()\n\t{\n\t\tlet list = this._requisiteList.getList();\n\t\treturn (list.length === 1 && list[0].isAddressOnly());\n\t}\n\n\tonLoadAddressMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis.loadEntity();\n\t}\n\n\tonEntityInfoLoad(sender, result)\n\t{\n\t\tvar entityData = BX.prop.getObject(result, \"DATA\", null);\n\t\tif (entityData)\n\t\t{\n\t\t\tthis.setEntity(BX.CrmEntityInfo.create(entityData), true);\n\t\t\tif (this._tooltip && this._showTooltipOnEntityLoad)\n\t\t\t{\n\t\t\t\tif (!this.isRequisiteAddressOnly())\n\t\t\t\t{\n\t\t\t\t\tthis._tooltip.show();\n\t\t\t\t}\n\t\t\t\tthis._showTooltipOnEntityLoad = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis._requisiteEditor.open(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {});\n\t\t}\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(eventData.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet requisite = this._requisiteList.getById(eventData.requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t});\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis._requisiteList.setSelected(eventData.id, eventData.bankDetailId);\n\n\t\tlet newSelectedRequisite = this._requisiteList.getSelected();\n\t\tif (newSelectedRequisite)\n\t\t{\n\t\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? 0 : selectedBankDetail.id;\n\n\t\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {\n\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\tbankDetailId: selectedBankDetailId\n\t\t\t});\n\t\t}\n\t}\n\n\tonRequisiteEditorAfterEdit(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonChangeRequisiteList()\n\t{\n\t\tthis.doAddressLayout();\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tthis._tooltip.setLoading(false);\n\t\t}\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\n\t\tlet requisiteList = this._requisiteList ? this._requisiteList.exportToModel() : null;\n\n\t\tthis._entityInfo.setRequisites(requisiteList);\n\t\tEventEmitter.emit(this, 'onChangeRequisiteList', {\n\t\t\tentityTypeName: this._entityInfo.getTypeName(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\trequisites: this._requisiteList.exportToModel()\n\t\t});\n\t}\n\n\tonShowTooltip()\n\t{\n\t\tif (!this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tif (this._tooltip)\n\t\t\t{\n\t\t\t\tthis._tooltip.close();\n\t\t\t\tthis._showTooltipOnEntityLoad = true;\n\t\t\t}\n\t\t\tthis.loadEntity();\n\t\t}\n\t\telse if (this.isRequisiteAddressOnly())\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorClientRequisites();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}"],"names":["RequisiteList","setEventNamespace","_items","CHANGE_EVENT","value","settings","Type","isArray","item","listItem","RequisiteListItem","create","push","filter","isDeleted","getList","length","selectedId","getSelectedId","getById","list","index","requisite","isSelected","id","requisiteId","getRequisiteId","reduce","prev","current","bankDetailsId","selected","setSelected","setSelectedBankDetails","isNull","getSelectedBankDetailId","notifyListChanged","maxExistedId","prevId","getRequisiteIdAsString","match","newRequisitePattern","currentId","Math","max","parseInt","indexOf","splice","setDeleted","setAddressOnly","setChanged","emit","result","exportedItem","exportToModel","self","initialize","EventEmitter","_data","isPlainObject","isNew","isChanged","isAddressOnly","formData","addressData","autocompleteState","presetId","BX","prop","getString","requisiteData","requisiteDataSign","bankDetails","bankDetailIdSelected","addressList","title","subtitle","extraData","getObject","initialAddressDdta","prepareViewData","JSON","parse","e","viewData","newRequisiteId","getNumber","getFields","setRequisiteId","bankDetailViewDataList","prepareBankDetailsList","bankDetailsItem","deleted","pseudoId","fields","isStringFilled","textValue","map","join","hasOwnProperty","getBoolean","changed","selectedBankDetailId","getInteger","getBankDetails","bankDetailId","getArray","isNumber","String","getAutocompleteState","selectedAutocompleteItem","subTitle","isUndefined","name","state","oldAddressTypes","Object","keys","addresses","type","getAddressData","isString","DELETED","justSelected","setFormData","getFormData","setAddressData","EntityEditorRequisiteEditor","_requisiteList","_entityTypeId","_entityId","_contextId","_mode","UI","EntityEditorMode","view","currentSliderRequisiste","_requisiteEditUrl","subscribe","onExternalEvent","bind","requisiteList","mode","options","sliderOptions","width","cacheable","allowChangeHistory","requestMethod","requestParams","prepareSliderRequestParams","Crm","Page","openSlider","getSliderUrl","postData","sessid","bitrix_sessid","ACTION","ajax","post","data","json","ERROR","showError","selectedRequisite","getSelected","selectedRemoved","remove","errorMessage","MessageBox","alert","Loc","getMessage","urlParams","etype","eid","external_context_id","getPresetId","util","add_url_param","getRequisiteEditUrl","getRequisiteData","getRequisiteDataSign","stringify","isEmptyFormData","isEmptyAddressData","RQ_ADDR","getAddressesForSave","isViewMode","overriddenPresetId","replace","PRESET_ID","useFormData","promise","method","dataType","url","event","dataArray","getData","eventName","contextId","isObject","setRequisiteData","setAutocompleteState","clearFormData","clearAddressData","setPresetId","setNew","add","EntityEditorRequisiteController","_requisiteEditor","_requisiteFieldId","_requisiteField","_requisiteInitData","_addressFieldId","_addressField","_isLoading","_formInputsWrapper","getConfigStringParam","saveRequisiteInitData","_editor","onFieldInit","initRequisiteEditor","initRequisiteList","onChangeRequisites","setRequisiteList","_id","entityTypeId","getEntityTypeId","entityId","getEntityId","getContextId","requisiteEditUrl","onRequisiteEditorAfterEdit","onRequisiteEditorAfterDelete","setRequisites","requisiteAddressList","getAddressList","setAddressList","getRequisiteFieldValue","promises","signPromise","signRequisiteFields","then","error","entityDataObj","entityData","entityDataSign","addError","EntityValidationError","field","getFirstEditModeField","Promise","resolve","reject","all","newSelectedRequisite","selectedBankDetail","getBankDetailById","startLoading","runAction","response","stopLoading","setRequisiteInitAddrData","setMode","getMode","open","rawRequisite","requisiteFields","setInitialAddressData","setInitAddrData","edit","modelValue","_model","setField","getField","Tag","render","Dom","append","getFormElement","getListWithDeleted","dataInput","safe","signInput","isDomNode","markAsChanged","initRequisiteField","initAddressField","updateRequisiteFieldModel","eventData","extraFields","isEmpty","defaultPresetId","getNewRequisiteId","getDefaultPresetId","schemeElement","getScheme","getAvailableElements","getName","preset","IS_DEFAULT","VALUE","getSignRequisitePromise","fieldId","getId","onEditNewRequisite","onEditExistedRequisite","onFinishRequisiteAutocomplete","onClearRequisiteAutocomplete","onSetDefaultRequisite","onDeleteRequisite","onHideRequisite","onAddressListUpdate","params","openEditor","editorOptions","prepareRequisiteByEventData","oldAddr","addr","unhide","cancel","setSelectedRequisite","postponed","removePostponed","deleteRequisite","hide","isEmptyAddress","address","addEditorFormInputs","removeEditorFormInputs","markFieldsAsChanged","isEmptyRequisitesList","EntityEditorController","PresetMenu","presetList","_isShown","menuId","bindElement","close","show","menu","text","Text","encode","onclick","onSelect","MenuManager","angle","events","onPopupShow","onPopupClose","getMenuById","popupWindow","EntityEditorRequisiteTooltip","isNotEmptyString","getRandomString","_settings","_padding","_showTimer","_closeTimer","_closeTimeout","_showTimeout","_popupId","_isReadonly","_canChangeDefaultRequisite","_bindElement","_wrapper","_changeRequisistesHandler","presetMenu","onAddRequisite","unsubscribe","refreshLayout","wrapper","parentNode","isLoading","cancelCloseDebounced","success","popup","PopupManager","autoHide","padding","contentPadding","content","getLayout","closeByEsc","adjustPosition","delayMultiplier","cancelShowDebounced","setTimeout","clearTimeout","getPopupById","isShown","wrapperRect","getBoundingClientRect","itemRect","offsetLeft","left","offsetTop","height","angleOffset","popupWidth","getPopupContainer","offsetWidth","popupHeight","offsetHeight","popupBottom","top","clientWidth","document","documentElement","clientHeight","exceeded","roundOffset","ceil","bottom","setBindElement","setAngle","position","offset","element","setOffset","setContent","loader","Loader","container","requisites","renderRequisiteEditButtonNode","onEditRequisite","onAddBankDetails","renderRequisiteBankDetails","bandDetails","bankDetail","onSetSelectedBankDetails","onMouseEnter","onMouseLeave","onSetSelectedRequisite","getTitle","getSubtitle","onStartAddRequisite","selectedBankDetails","closeDebounced","stopPropagation","toggle","target","getAttribute","nodeName","toString","toLowerCase","querySelector","checked","EntityEditorRequisiteField","_domNodes","_autocomplete","_tooltip","RequisiteAutocompleteField","searchAction","canAddRequisite","feedbackFormParams","_schemeElement","enabled","showFeedbackLink","onSelectAutocompleteValue","onAddRequisiteFromAutocomplete","onClearAutocompleteValue","getPresetList","onAddRequisiteFromMenu","isReadonly","getEditor","isReadOnly","readonly","canChangeDefaultRequisite","presets","onAddRequisiteFromTooltip","updateAutocompletePlaceholder","hasRequisites","vasEmpty","getRequisites","refreshLayoutParts","isSingleMode","selectedPresetId","selectedPresetName","isAutocompleteEnabled","editDefaultRequisite","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","bindWrapperEvents","isNeedToDisplay","registerLayout","isDragEnabled","createDragButton","createTitleNode","addButton","renderAutocompleteForm","renderAddButton","renderSelectedRequisite","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","wrapperMouseEnterHandler","onFieldMouseEnter","wrapperMouseLeaveHandler","onFieldMouseLeave","Event","unbind","updateSelectedRequisiteText","refreshTitleLayout","updateAutocompleteState","hasValue","getClientResolverPropForPreset","getSelectedPresetId","selectedRequisiteView","onViewStringClick","onViewStringMouseEnter","classList","textContent","EntityEditorField","messages","toggleNewRequisitePresetMenu","autocompleteContainer","hasResolvers","setEnabled","layout","autocompleteValue","getAutocompleteData","setCurrentItem","setContext","getAutocompleteContext","clientResolverProp","setPlaceholderText","get","removeDebouncedEvents","EditorAuxiliaryDialog","buttons","DialogButtonType","accept","callback","button","getDialog","hideRequisite","selectedRequisiteId","editRequisite","getState","addRequisite","showDeleteConfirmation","addBankDetailsItem","setLoading","hasAddresses","addressType","showClearConfirmation","switchToSingleEditMode","showDebounced","EntityEditorRequisiteAddressField","EntityEditorAddressField","EntityEditorClientRequisites","_entityInfo","_fieldsParams","_loaderConfig","_addressConfig","_readonly","_addressContainer","_formElement","_showTooltipOnEntityLoad","setEntity","_requisitesConfig","selectedItem","REQUISITE_ID","BANK_DETAIL_ID","getByRequisiteId","getBankDetailByBankDetailId","getRequisitesPresetList","getTypeId","onShowTooltip","entityInfo","emitNotification","hasEditRequisiteData","onChangeRequisiteList","doAddressLayout","clean","defaultRequisite","addressValue","EntityEditorBaseAddressField","showFirstItemOnly","showAddressTypeInViewMode","setMultiple","setTypesList","setValue","showAddressLink","onLoadAddressMouseUp","isRequisiteAddressOnly","release","size","CrmDataLoader","serviceUrl","action","getTypeName","load","onEntityInfoLoad","loadEntity","sender","CrmEntityInfo","entityTypeName"],"mappings":"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"}