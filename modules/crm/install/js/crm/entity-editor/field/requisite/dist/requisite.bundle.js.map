{"version":3,"file":"requisite.bundle.js","sources":["../src/requisite-list.js","../src/requisite-editor.js","../src/requisite-controller.js","../src/preset-menu.js","../src/requisite-tooltip.js","../src/requisite-crm-field.js","../src/address-crm-field.js","../src/client-requisites.js"],"sourcesContent":["import {Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class RequisiteList extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.EntityEditorRequisiteField.RequisiteList');\n\t\tthis._items = [];\n\n\t\tthis.CHANGE_EVENT = 'onChange';\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (!Type.isArray(value))\n\t\t{\n\t\t\tvalue = [];\n\t\t}\n\t\tfor (let item of value)\n\t\t{\n\t\t\tlet listItem = RequisiteListItem.create(item);\n\t\t\tthis._items.push(listItem);\n\t\t}\n\t}\n\n\tgetList()\n\t{\n\t\treturn this._items.filter((item) => !item.isDeleted());\n\t}\n\n\tgetListWithDeleted()\n\t{\n\t\treturn this._items;\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn !this.getList().length;\n\t}\n\n\tgetSelected()\n\t{\n\t\tlet selectedId = this.getSelectedId();\n\t\treturn this.getById(selectedId);\n\t}\n\n\tgetSelectedId()\n\t{\n\t\tlet list = this.getList();\n\t\tif (!list.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tfor (let index = 0; index < list.length; index++)\n\t\t{\n\t\t\tlet requisite = list[index];\n\t\t\tif (requisite.isSelected())\n\t\t\t{\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t\treturn 0; // first element by default\n\t}\n\n\tgetById(id)\n\t{\n\t\tlet list = this.getList();\n\n\t\tif (null === id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (id >= 0 && id < list.length)\n\t\t{\n\t\t\treturn list[id];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetByRequisiteId(requisiteId)\n\t{\n\t\tlet list = this.getList();\n\t\treturn list\n\t\t\t.filter((item) => item.getRequisiteId() == requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tsetSelected(requisiteId, bankDetailsId)\n\t{\n\t\tlet requisite = this.getById(requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tfor (let item of this.getList())\n\t\t\t{\n\t\t\t\tlet selected = (item === requisite);\n\t\t\t\titem.setSelected(selected);\n\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\titem.setSelectedBankDetails(\n\t\t\t\t\t\tType.isNull(bankDetailsId) ? requisite.getSelectedBankDetailId() : bankDetailsId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tgetNewRequisiteId()\n\t{\n\t\tlet maxExistedId = this.getList().reduce((prevId, item) =>\n\t\t{\n\t\t\tlet requisiteId = item.getRequisiteIdAsString();\n\t\t\tlet match = requisiteId ? requisiteId.match(RequisiteListItem.newRequisitePattern) : false;\n\t\t\tlet currentId = match && match[1] ? match[1] : -1;\n\t\t\treturn Math.max(prevId, currentId);\n\t\t}, -1);\n\n\t\treturn 'n' + (parseInt(maxExistedId) + 1);\n\t}\n\n\tindexOf(item)\n\t{\n\t\treturn this._items.indexOf(item);\n\t}\n\n\tadd(item)\n\t{\n\t\tthis._items.push(item);\n\t\tif (!item.isAddressOnly())\n\t\t{\n\t\t\tthis.setSelected(this._items.indexOf(item));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tremove(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis._items.splice(index, 1);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tremovePostponed(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setDeleted(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\thide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(true);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tunhide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(false);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tnotifyListChanged()\n\t{\n\t\tthis.emit(this.CHANGE_EVENT);\n\t}\n\n\texportToModel()\n\t{\n\t\tlet result = [];\n\t\tfor (let item of this._items)\n\t\t{\n\t\t\tlet exportedItem = item.exportToModel();\n\t\t\tresult.push({...exportedItem});\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteList();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nexport class RequisiteListItem\n{\n\tconstructor()\n\t{\n\n\t\tthis._data = null;\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tthis._data = {...value};\n\t\t\tthis._data.isNew = false;\n\t\t\tthis._data.isChanged = false;\n\t\t\tthis._data.isDeleted = false;\n\t\t\tthis._data.isAddressOnly = false;\n\t\t\tthis._data.formData = {};\n\t\t\tthis._data.addressData = {};\n\t\t\tif (!Type.isPlainObject(this._data.autocompleteState))\n\t\t\t{\n\t\t\t\tthis._data.autocompleteState = {};\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{ // new empty requisite\n\t\t\tthis._data = {\n\t\t\t\tisNew: true,\n\t\t\t\tisChanged: false,\n\t\t\t\tisDeleted: false,\n\t\t\t\tisAddressOnly: false,\n\t\t\t\tselected: false,\n\t\t\t\tpresetId: null,\n\t\t\t\trequisiteId: BX.prop.getString(settings, 'newRequisiteId', 'n0'),\n\t\t\t\trequisiteData: '',\n\t\t\t\trequisiteDataSign: '',\n\t\t\t\tbankDetails: [],\n\t\t\t\tbankDetailIdSelected: 0,\n\t\t\t\taddressList: {},\n\t\t\t\tvalue: {},\n\t\t\t\ttitle: '',\n\t\t\t\tsubtitle: '',\n\t\t\t\tautocompleteState: {},\n\t\t\t\tformData: {},\n\t\t\t\taddressData: {}\n\t\t\t};\n\t\t\tlet extraData = BX.prop.getObject(settings, 'newRequisiteExtraFields', {});\n\t\t\tthis._data = {...this._data, ...extraData};\n\t\t}\n\t\tthis._data.initialAddressDdta = null;\n\t\tthis.prepareViewData(this._data);\n\t}\n\n\tprepareViewData()\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis._data.value = this._data.requisiteData ? JSON.parse(this._data.requisiteData) : {};\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis._data.value = {};\n\t\t}\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.viewData))\n\t\t{\n\t\t\tthis._data.title = this._data.value.viewData.title;\n\t\t\tthis._data.subtitle = this._data.value.viewData.subtitle;\n\t\t}\n\n\t\tif (this.getRequisiteIdAsString().match(RequisiteListItem.newRequisitePattern)) // was new requisite\n\t\t{\n\t\t\tlet newRequisiteId = BX.prop.getNumber(this.getFields(), 'ID', 0);\n\t\t\tif (newRequisiteId > 0) // if new requisite was saved\n\t\t\t{\n\t\t\t\tthis.setRequisiteId(newRequisiteId);\n\t\t\t}\n\t\t}\n\t\tthis.setAddressOnly(BX.prop.getString(this.getFields(), 'ADDRESS_ONLY', 'N') === 'Y');\n\n\t\tthis._data.bankDetails = [];\n\t\tif (Type.isPlainObject(this._data.value) && Type.isArray(this._data.value.bankDetailViewDataList))\n\t\t{\n\t\t\tthis._data.bankDetails = this.prepareBankDetailsList(this._data.value.bankDetailViewDataList);\n\t\t}\n\n\t\tthis._data.addressList = {...BX.prop.getObject(this.getFields(), 'RQ_ADDR', {})};\n\t}\n\n\tprepareBankDetailsList(bankDetails)\n\t{\n\t\tlet result = [];\n\t\tfor (let bankDetailsItem of bankDetails)\n\t\t{\n\t\t\tif (bankDetailsItem.deleted)\n\t\t\t{\n\t\t\t\tcontinue; // Deleted items should not be shown\n\t\t\t}\n\t\t\tif (Type.isPlainObject(bankDetailsItem.viewData))\n\t\t\t{\n\t\t\t\tlet item = {\n\t\t\t\t\t'title': bankDetailsItem.viewData.title,\n\t\t\t\t\t'id': bankDetailsItem.pseudoId,\n\t\t\t\t\t'value': '',\n\t\t\t\t\t'selected': !!bankDetailsItem.selected\n\t\t\t\t};\n\t\t\t\tif (Type.isArray(bankDetailsItem.viewData.fields) && bankDetailsItem.viewData.fields.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = bankDetailsItem.viewData.fields\n\t\t\t\t\t\t.filter((item) => Type.isStringFilled(item.textValue))\n\t\t\t\t\t\t.map((item) => item.title + ': ' + item.textValue)\n\t\t\t\t\t\t.join(', ');\n\t\t\t\t}\n\t\t\t\tif (!item.value.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = item.title;\n\t\t\t\t}\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tisSelected()\n\t{\n\t\tif (!this._data.hasOwnProperty('justSelected'))\n\t\t{\n\t\t\treturn BX.prop.getBoolean(this._data, 'selected', false);\n\t\t}\n\t\treturn BX.prop.getBoolean(this._data, 'justSelected', false);\n\t}\n\n\tisChanged()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isChanged', false);\n\t}\n\n\tsetChanged(changed)\n\t{\n\t\tthis._data.isChanged = !!changed;\n\t}\n\n\tisNew()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isNew', false);\n\t}\n\n\tsetNew(isNew)\n\t{\n\t\tthis._data.isNew = !!isNew;\n\t}\n\n\tgetSelectedBankDetailId()\n\t{\n\t\tlet selectedBankDetailId = BX.prop.getInteger(this._data, 'selectedBankDetailId', -1);\n\t\tif (selectedBankDetailId !== -1)\n\t\t{\n\t\t\treturn selectedBankDetailId;\n\t\t}\n\t\tselectedBankDetailId = this.getBankDetails().reduce(\n\t\t\t(selected, item, index) =>\n\t\t\t{\n\t\t\t\treturn item.selected ? index : selected\n\t\t\t}, -1);\n\t\tthis._data.selectedBankDetailId = selectedBankDetailId;\n\n\t\treturn selectedBankDetailId > -1 ? selectedBankDetailId : 0;\n\t}\n\n\tgetBankDetailById(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (bankDetailId >= 0 && bankDetailId < list.length)\n\t\t{\n\t\t\treturn list[bankDetailId];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetBankDetailByBankDetailId(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn list\n\t\t\t.filter((item) => item.id == bankDetailId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'title', \"\");\n\t}\n\n\tgetSubtitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'subtitle', \"\");\n\t}\n\n\tgetPresetId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetId', \"0\");\n\t}\n\n\tgetPresetCountryId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetCountryId', \"0\");\n\t}\n\n\tgetBankDetails()\n\t{\n\t\treturn BX.prop.getArray(this._data, 'bankDetails', []);\n\t}\n\n\tgetRequisiteId()\n\t{\n\t\treturn this._data.requisiteId;\n\t}\n\n\tgetRequisiteIdAsString()\n\t{\n\t\tlet requisiteId = this.getRequisiteId();\n\t\trequisiteId = Type.isNumber(requisiteId) ? String(requisiteId) : requisiteId;\n\t\treturn Type.isStringFilled(requisiteId) ? requisiteId : '';\n\t}\n\n\tgetRequisiteData()\n\t{\n\t\treturn this._data.requisiteData;\n\t}\n\n\tgetRequisiteDataSign()\n\t{\n\t\treturn this._data.requisiteDataSign;\n\t}\n\n\tgetFields()\n\t{\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.fields))\n\t\t{\n\t\t\treturn {...this._data.value.fields};\n\t\t}\n\t\treturn {};\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\tlet result = null;\n\n\t\tlet autocompleteState = this.getAutocompleteState();\n\t\tlet selectedAutocompleteItem = BX.prop.getObject(autocompleteState, 'currentItem', null);\n\t\tif (Type.isPlainObject(selectedAutocompleteItem))\n\t\t{\n\t\t\tresult = {\n\t\t\t\ttitle: BX.prop.getString(selectedAutocompleteItem, 'title', ''),\n\t\t\t\tsubTitle: BX.prop.getString(selectedAutocompleteItem, 'subTitle', '')\n\t\t\t}\n\t\t}\n\t\telse if (!Type.isUndefined(this._data.value.viewData)  && Type.isArray(this._data.value.viewData.fields))\n\t\t{\n\t\t\tlet fields =  this._data.value.viewData.fields;\n\t\t\tresult = {\n\t\t\t\ttitle: Type.isStringFilled(this._data.title) ? this._data.title : '',\n\t\t\t\tsubTitle: fields\n\t\t\t\t\t.filter((item) => item.name === 'RQ_INN' && item.textValue.length)\n\t\t\t\t\t.map((item) => item.title + ' ' + item.textValue)\n\t\t\t\t\t.join('')\n\t\t\t};\n\t\t}\n\t\treturn result;\n\t}\n\n\tsetAutocompleteState(state)\n\t{\n\t\tthis._data.autocompleteState = Type.isPlainObject(state) ? state : {};\n\t}\n\n\tgetAutocompleteState()\n\t{\n\t\treturn this._data.autocompleteState;\n\t}\n\n\tgetAddressList()\n\t{\n\t\treturn this._data.addressList;\n\t}\n\n\tsetAddressList(addressList)\n\t{\n\t\tthis._data.addressList = addressList;\n\t}\n\n\tsetInitialAddressData(addressData)\n\t{\n\t\tthis._data.initialAddressDdta = addressData;\n\t}\n\n\tgetAddressesForSave()\n\t{\n\t\tlet oldAddressTypes = Type.isPlainObject(this._data.initialAddressDdta) ?\n\t\t\tObject.keys(this._data.initialAddressDdta) : [];\n\n\t\tlet addresses = {};\n\t\tfor (let type of oldAddressTypes)\n\t\t{\n\t\t\taddresses[type] = \"\";\n\t\t}\n\t\tlet addressData = this.getAddressData();\n\t\tfor (let type in addressData)\n\t\t{\n\t\t\tif (addressData.hasOwnProperty(type) && addressData[type].length)\n\t\t\t{\n\t\t\t\taddresses[type] = addressData[type];\n\t\t\t}\n\t\t}\n\t\tfor (let type in addresses)\n\t\t{\n\t\t\tif (Type.isString(addresses[type]) && addresses[type] === \"\")\n\t\t\t{\n\t\t\t\taddresses[type] = {DELETED: 'Y'};\n\t\t\t}\n\t\t}\n\n\t\treturn addresses;\n\t}\n\n\tsetRequisiteId(requisiteId)\n\t{\n\t\tthis._data.requisiteId = requisiteId;\n\t}\n\n\tsetPresetId(presetId)\n\t{\n\t\tthis._data.presetId = presetId;\n\t}\n\n\tsetPresetCountryId(presetCountryId)\n\t{\n\t\tthis._data.presetCountryId = presetCountryId;\n\t}\n\n\tsetSelected(selected)\n\t{\n\t\tthis._data.selected = !!selected;\n\t\tthis._data.justSelected = !!selected;\n\t}\n\n\tsetRequisiteData(requisiteData, requisiteDataSign)\n\t{\n\t\tthis._data.requisiteData = requisiteData;\n\t\tif (Type.isStringFilled(requisiteDataSign))\n\t\t{\n\t\t\tthis._data.requisiteDataSign = requisiteDataSign;\n\t\t}\n\t\tthis.prepareViewData();\n\t}\n\n\tsetDeleted(isDeleted)\n\t{\n\t\tthis._data.isDeleted = !!isDeleted;\n\t}\n\n\tisDeleted()\n\t{\n\t\treturn this._data.isDeleted;\n\t}\n\n\tsetAddressOnly(isAddressOnly)\n\t{\n\t\tthis._data.isAddressOnly = !!isAddressOnly;\n\t\tthis.setFormData({...this.getFormData(), 'ADDRESS_ONLY': isAddressOnly ? 'Y':'N'})\n\t}\n\n\tisAddressOnly()\n\t{\n\t\treturn this._data.isAddressOnly;\n\t}\n\n\tisEmptyFormData()\n\t{\n\t\treturn Object.keys(this._data.formData).length <= 0;\n\t}\n\n\tgetFormData()\n\t{\n\t\treturn this._data.formData;\n\t}\n\n\tsetFormData(formData)\n\t{\n\t\tthis._data.formData = formData;\n\t}\n\n\tclearFormData()\n\t{\n\t\tthis.setFormData({});\n\t}\n\n\tisEmptyAddressData()\n\t{\n\t\treturn Object.keys(this._data.addressData).length <= 0;\n\t}\n\n\tgetAddressData()\n\t{\n\t\treturn this._data.addressData;\n\t}\n\n\tsetAddressData(addressData)\n\t{\n\t\tthis._data.addressData = addressData;\n\t}\n\n\tclearAddressData()\n\t{\n\t\tthis.setAddressData({});\n\t}\n\tsetSelectedBankDetails(bankDetailsId)\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isNull(bankDetailsId))\n\t\t{\n\t\t\tbankDetailsId = 0; // first item by default\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = (index === bankDetailsId);\n\t\t}\n\n\t\tthis._data.selectedBankDetailId = bankDetailsId;\n\t}\n\n\tclearSelectedBankDetails()\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = false;\n\t\t}\n\t}\n\n\texportToModel()\n\t{\n\t\tlet exportedItem = {...this._data};\n\t\tdelete (exportedItem.value);\n\t\tdelete (exportedItem.addressList);\n\t\tdelete (exportedItem.bankDetails);\n\t\tdelete (exportedItem.initialAddressDdta);\n\t\tdelete (exportedItem.isAddressOnly);\n\t\treturn exportedItem;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteListItem();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nRequisiteListItem.newRequisitePattern = /n([0-9]+)/;","import {RequisiteListItem} from \"./requisite-list\";\nimport {EventEmitter} from \"main.core.events\";\nimport {Loc, Type} from \"main.core\";\nimport {MessageBox} from \"ui.dialogs.messagebox\";\n\nexport class EntityEditorRequisiteEditor\n{\n\tconstructor()\n\t{\n\t\tthis._requisiteList = null;\n\t\tthis._entityTypeId = null;\n\t\tthis._entityId = null;\n\t\tthis._contextId = null;\n\t\tthis._mode = BX.UI.EntityEditorMode.view;\n\n\t\tthis.currentSliderRequisiste = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._entityTypeId = BX.prop.getInteger(settings, 'entityTypeId', 0);\n\t\tthis._entityId = BX.prop.getInteger(settings, 'entityId', 0);\n\t\tthis._contextId = BX.prop.getString(settings, 'contextId', \"\");\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, 'requisiteEditUrl', \"\");\n\n\t\tthis._onExternalEventListener = this.onExternalEvent.bind(this);\n\t\tEventEmitter.subscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tsetRequisiteList(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t}\n\n\tsetMode(mode)\n\t{\n\t\tthis._mode = mode;\n\t}\n\n\topen(requisite, options = {})\n\t{\n\t\tif (!(requisite instanceof RequisiteListItem))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentSliderRequisiste = requisite;\n\n\t\tlet sliderOptions = {\n\t\t\twidth: 950,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: this.prepareSliderRequestParams(requisite, options)\n\t\t};\n\t\tBX.Crm.Page.openSlider(this.getSliderUrl(requisite), sliderOptions);\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tlet requisite = this._requisiteList.getById(id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet postData = {...this.prepareSliderRequestParams(requisite)};\n\t\t\tpostData.sessid = BX.bitrix_sessid();\n\t\t\tpostData.mode = 'delete';\n\t\t\tpostData.ACTION = 'SAVE';\n\n\t\t\tBX.ajax.post(this.getSliderUrl(requisite), postData, (data) =>\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet json = JSON.parse(data);\n\t\t\t\t\tif (Type.isStringFilled(json.ERROR))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(json.ERROR);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\t\t\t\t\tlet selectedRemoved = (selectedRequisite === requisite);\n\t\t\t\t\t\tthis._requisiteList.remove(requisite);\n\n\t\t\t\t\t\tEventEmitter.emit(this, 'onAfterDeleteRequisite', {selectedRemoved});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tgetSliderUrl(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\n\t\tlet urlParams =\n\t\t\t{\n\t\t\t\tetype: this._entityTypeId,\n\t\t\t\teid: this._entityId,\n\t\t\t\texternal_context_id: this._contextId\n\t\t\t};\n\n\t\tlet presetId = requisite.getPresetId();\n\t\tif (presetId > 0)\n\t\t{\n\t\t\turlParams[\"pid\"] = presetId;\n\t\t}\n\n\t\treturn BX.util.add_url_param(\n\t\t\tthis.getRequisiteEditUrl(requisiteId),\n\t\t\turlParams\n\t\t);\n\t}\n\n\tprepareSliderRequestParams(requisite, options = {})\n\t{\n\t\tlet requestParams = {};\n\t\tlet requisiteData = requisite.getRequisiteData();\n\t\tif (requisite.isChanged() && Type.isString(requisiteData) && requisiteData.length)\n\t\t{\n\t\t\trequestParams['externalData'] = {\n\t\t\t\t'data': requisiteData,\n\t\t\t\t'sign': requisite.getRequisiteDataSign()\n\t\t\t};\n\t\t}\n\t\tif (requisite.isSelected())\n\t\t{\n\t\t\tlet autocompleteState = requisite.getAutocompleteState();\n\t\t\tif (Object.keys(autocompleteState).length)\n\t\t\t{\n\t\t\t\trequestParams['AUTOCOMPLETE'] = JSON.stringify(autocompleteState);\n\t\t\t\trequestParams['useFormData'] = 'Y';\n\t\t\t}\n\t\t}\n\t\tif (!requisite.isEmptyFormData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...requisite.getFormData()};\n\t\t}\n\t\tif (!requisite.isEmptyAddressData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...{RQ_ADDR: requisite.getAddressesForSave()}};\n\t\t}\n\t\trequestParams['mode'] = requisite.isNew() ? 'create' : 'edit';\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\trequestParams['doSave'] = 'Y';\n\t\t}\n\t\tif (BX.prop.getBoolean(options, 'addBankDetailsItem', false))\n\t\t{\n\t\t\trequestParams['addBankDetailsItem'] = 'Y';\n\t\t}\n\t\tlet overriddenPresetId = BX.prop.getInteger(options, 'overriddenPresetId', 0);\n\t\tif (overriddenPresetId > 0)\n\t\t{\n\t\t\trequestParams['PRESET_ID'] = overriddenPresetId;\n\t\t\trequestParams['useFormData'] = 'Y';\n\t\t}\n\t\treturn requestParams;\n\t}\n\n\tgetRequisiteEditUrl(requisiteId)\n\t{\n\t\treturn this._requisiteEditUrl.replace(/#requisite_id#/gi, requisiteId);\n\t}\n\n\tgetSignRequisitePromise(requisite)\n\t{\n\t\tlet postData = this.prepareSliderRequestParams(requisite);\n\t\tpostData.sessid = BX.bitrix_sessid();\n\t\tpostData.PRESET_ID = requisite.getPresetId();\n\t\tpostData.useFormData = 'Y';\n\t\tpostData.ACTION = 'SAVE';\n\n\t\treturn BX.ajax.promise({\n\t\t\tmethod: 'post',\n\t\t\tdataType: 'json',\n\t\t\turl: this.getSliderUrl(requisite),\n\t\t\tdata: postData\n\t\t});\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._mode === BX.UI.EntityEditorMode.view;\n\t}\n\n\trelease()\n\t{\n\t\tEventEmitter.unsubscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tonExternalEvent(event)\n\t{\n\t\tlet dataArray = event.getData();\n\t\tif (!Type.isArray(dataArray))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet data = dataArray[0];\n\n\t\tlet eventName = BX.prop.getString(data, \"key\", \"\");\n\n\t\tif (eventName !== \"BX.Crm.RequisiteSliderDetails:onCancelEdit\" && eventName !== \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet value = BX.prop.getObject(data, \"value\", {});\n\n\t\tlet contextId = BX.prop.getString(value, \"contextId\", \"\");\n\t\tif (contextId !== this._contextId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onCancelEdit\")\n\t\t{\n\t\t\tthis.currentSliderRequisiste = null;\n\t\t}\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\tlet requisite = this.currentSliderRequisiste;\n\t\t\tif (Type.isObject(requisite))\n\t\t\t{\n\t\t\t\tif (Type.isString(value.requisiteData))\n\t\t\t\t{\n\t\t\t\t\trequisite.setRequisiteData(value.requisiteData, value.requisiteDataSign);\n\t\t\t\t\trequisite.setAutocompleteState({});\n\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(value.presetId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetId(value.presetId);\n\t\t\t\t}\n\t\t\t\tif (Type.isString(value.presetCountryId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetCountryId(value.presetCountryId);\n\t\t\t\t}\n\t\t\t\tif (this.isViewMode())\n\t\t\t\t{\n\t\t\t\t\trequisite.setNew(false);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\trequisite.setChanged(true);\n\t\t\t\t}\n\t\t\t\trequisite.setDeleted(false);\n\n\t\t\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.notifyListChanged();\n\t\t\t\t}\n\n\t\t\t\tthis.currentSliderRequisiste = null;\n\n\t\t\t\tEventEmitter.emit(this, 'onAfterEditRequisite');\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteEditor();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n}","import {Dom, Loc, Tag, Type} from \"main.core\"\nimport {EventEmitter} from \"main.core.events\"\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\"\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nexport class EntityEditorRequisiteController extends BX.Crm.EntityEditorController\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._requisiteFieldId = null;\n\t\tthis._requisiteField = null;\n\t\tthis._requisiteInitData = null;\n\n\t\tthis._addressFieldId = null;\n\t\tthis._addressField = null;\n\t\tthis._isLoading = false;\n\n\t\tthis._formInputsWrapper = null;\n\t\tthis._enableRequisiteSelection = false;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._requisiteFieldId = this.getConfigStringParam(\"requisiteFieldId\", \"\");\n\t\tthis._addressFieldId = this.getConfigStringParam(\"addressFieldId\", \"\");\n\n\t\tthis.saveRequisiteInitData();\n\n\t\tEventEmitter.subscribe(this._editor, 'onFieldInit', this.onFieldInit.bind(this));\n\n\t\tthis.initRequisiteEditor();\n\t\tthis.initRequisiteList();\n\n\t\tlet selectedItem = BX.prop.getObject(this.getConfig(), \"requisiteBinding\", {});\n\t\tif (!Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t{\n\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\tif (requisite)\n\t\t\t{\n\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis._enableRequisiteSelection = BX.prop.getString(this._config, 'enableRequisiteSelection', false);\n\t}\n\n\tinitRequisiteList()\n\t{\n\t\tthis._requisiteList = RequisiteList.create(this._requisiteInitData);\n\t\tthis._requisiteList.subscribe(this._requisiteList.CHANGE_EVENT, this.onChangeRequisites.bind(this));\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t}\n\n\tinitRequisiteEditor()\n\t{\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\tentityId: this._editor.getEntityId(),\n\t\t\tcontextId: this._editor.getContextId(),\n\t\t\trequisiteEditUrl: this._editor.getRequisiteEditUrl('#requisite_id#')\n\t\t});\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\t}\n\n\tinitRequisiteField()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.setRequisites(this._requisiteList);\n\n\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t}\n\t}\n\n\tinitAddressField()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tlet countryId = 0;\n\t\t\tlet addressList = {};\n\t\t\tlet selectedRequisite = this._requisiteList ? this._requisiteList.getSelected() : null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tcountryId = selectedRequisite.getPresetCountryId();\n\t\t\t\tlet requisiteAddressList = selectedRequisite.getAddressList();\n\t\t\t\tfor (let type in requisiteAddressList)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\trequisiteAddressList.hasOwnProperty(type) &&\n\t\t\t\t\t\tBX.prop.getString(requisiteAddressList[type], 'DELETED', 'N') !== 'Y'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\taddressList[type] = requisiteAddressList[type];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._addressField.setCountryId(countryId);\n\t\t\tthis._addressField.setAddressList(addressList);\n\t\t}\n\t}\n\n\tsetSelectModeEnabled(enableRequisiteSelection: boolean): void\n\t{\n\t\tif (this._enableRequisiteSelection !== enableRequisiteSelection)\n\t\t{\n\t\t\tthis._enableRequisiteSelection = enableRequisiteSelection;\n\t\t\tif (this._requisiteField)\n\t\t\t{\n\t\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t\t}\n\t\t}\n\t}\n\n\tsaveRequisiteInitData()\n\t{\n\t\tthis._requisiteInitData = this.getRequisiteFieldValue();\n\t}\n\n\tvalidate(result)\n\t{\n\t\tlet promises = [];\n\t\tfor (let requisite of this._requisiteList.getList())\n\t\t{\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (requisite.isEmptyFormData() && requisite.isEmptyAddressData())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet signPromise = this.signRequisiteFields(requisite);\n\t\t\tsignPromise.then(\n\t\t\t\t(data) =>\n\t\t\t\t{\n\t\t\t\t\tlet error = BX.prop.getString(data, 'ERROR', '');\n\t\t\t\t\tlet entityDataObj = BX.prop.getObject(data, 'ENTITY_DATA', {});\n\t\t\t\t\tlet entityData = BX.prop.getString(entityDataObj, 'REQUISITE_DATA', \"\");\n\t\t\t\t\tlet entityDataSign = BX.prop.getString(entityDataObj, 'REQUISITE_DATA_SIGN', \"\");\n\t\t\t\t\tif (Type.isStringFilled(error))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(error);\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isStringFilled(entityData) && Type.isStringFilled(entityDataSign))\n\t\t\t\t\t{\n\t\t\t\t\t\trequisite.setRequisiteData(entityData, entityDataSign);\n\t\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tpromises.push(signPromise);\n\t\t}\n\n\t\treturn (promises.length > 0) ? Promise.all(promises) : null;\n\t}\n\n\tsetSelectedRequisite(requisiteId, bankDetailId)\n\t{\n\t\tlet entityId = this._editor.getEntityId();\n\t\tif (!entityId)\n\t\t{\n\t\t\t// impossible situation, but...\n\t\t\treturn;\n\t\t}\n\t\tlet newSelectedRequisite = this._requisiteList.getById(requisiteId);\n\t\tif (!newSelectedRequisite || newSelectedRequisite.isNew())\n\t\t{\n\t\t\t// impossible situation too\n\t\t\treturn;\n\t\t}\n\t\tthis._requisiteList.setSelected(requisiteId, bankDetailId);\n\n\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\n\t\tthis.startLoading();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.settings.setSelectedEntityRequisite',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\t\t\tentityId: entityId,\n\t\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t}, () =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t});\n\n\t}\n\n\topenEditor(requisite, options = {})\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\tthis._requisiteEditor.open(requisite, options);\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._editor.getMode() === BX.Crm.EntityEditorMode.view;\n\t}\n\n\tsetRequisiteInitAddrData(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\t\tlet rawRequisite = this._requisiteInitData\n\t\t\t.filter((item) => item.requisiteId === requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\n\t\tif (Type.isPlainObject(rawRequisite))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet requisiteData = JSON.parse(rawRequisite.requisiteData);\n\t\t\t\tlet requisiteFields = BX.prop.getObject(requisiteData, 'fields', {});\n\t\t\t\tlet addressData = BX.prop.getObject(requisiteFields, 'RQ_ADDR', null);\n\t\t\t\trequisite.setInitialAddressData(addressData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\trequisite.setInitAddrData(null);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFirstEditModeField()\n\t{\n\t\tif (this._requisiteField && this._requisiteField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._requisiteField;\n\t\t}\n\t\tif (this._addressField && this._addressField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._addressField;\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdateRequisiteFieldModel()\n\t{\n\t\tlet modelValue = this._requisiteList.exportToModel();\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._model.setField(this._requisiteFieldId, modelValue);\n\t\t}\n\t\tthis.saveRequisiteInitData([...modelValue]);\n\t}\n\n\tgetRequisiteFieldValue()\n\t{\n\t\tif (!this._requisiteFieldId)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn this._model.getField(this._requisiteFieldId, []);\n\t}\n\n\taddEditorFormInputs()\n\t{\n\t\tthis._formInputsWrapper = Tag.render`<div></div>`;\n\t\tDom.append(this._formInputsWrapper, this._editor.getFormElement());\n\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DELETED]\" value=\"Y\" >`, this._formInputsWrapper);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet dataInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DATA]\" value=\"${Tag.safe`${requisite.getRequisiteData()}`}\" >`;\n\t\t\tlet signInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][SIGN]\" value=\"${requisite.getRequisiteDataSign()}\" >`;\n\t\t\tDom.append(dataInput, this._formInputsWrapper);\n\t\t\tDom.append(signInput, this._formInputsWrapper);\n\t\t}\n\t}\n\n\tremoveEditorFormInputs()\n\t{\n\t\tif (Type.isDomNode(this._formInputsWrapper))\n\t\t{\n\t\t\tDom.remove(this._formInputsWrapper);\n\t\t\tthis._formInputsWrapper = null;\n\t\t}\n\t}\n\n\tmarkFieldsAsChanged()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.markAsChanged();\n\t\t}\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.markAsChanged();\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tisLoading()\n\t{\n\t\treturn !!this._isLoading;\n\t}\n\n\tstartLoading()\n\t{\n\t\tthis._isLoading = true;\n\t}\n\n\tstopLoading()\n\t{\n\t\tthis._isLoading = false;\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tprepareRequisiteByEventData(eventData)\n\t{\n\t\tlet requisite = this._requisiteList.getById(eventData.id);\n\t\tif (!requisite)\n\t\t{\n\t\t\tconst extraFields = {\n\t\t\t\tselected: this._requisiteList.isEmpty(),\n\t\t\t\tpresetId: eventData.defaultPresetId,\n\t\t\t};\n\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\textraFields.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\textraFields.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\textraFields.autocompleteState = eventData.autocompleteState;\n\t\t\t}\n\n\t\t\trequisite = RequisiteListItem.create(null, {\n\t\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t\t'newRequisiteExtraFields': extraFields,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(eventData.autocompleteState);\n\t\t\t}\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn requisite;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\treturn this._requisiteField.getDefaultPresetId();\n\t\t}\n\t\telse // if requisiteField is hidden\n\t\t{\n\t\t\tlet schemeElement = this._editor.getScheme().getAvailableElements()\n\t\t\t\t.filter((item) => (item.getName() === this._requisiteFieldId))\n\t\t\t\t.reduce((prev, current) => current, null);\n\n\t\t\tif (!schemeElement)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor (let preset of BX.prop.getArray(schemeElement.getData(), \"presets\", []))\n\t\t\t{\n\t\t\t\tif (preset.IS_DEFAULT)\n\t\t\t\t{\n\t\t\t\t\treturn preset.VALUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsignRequisiteFields(requisite)\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\treturn this._requisiteEditor.getSignRequisitePromise(requisite);\n\t}\n\n\trelease()\n\t{\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tonFieldInit(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet field = eventData.field;\n\t\tif (field)\n\t\t{\n\t\t\tlet fieldId = field.getId();\n\t\t\tif (Type.isStringFilled(this._requisiteFieldId) && fieldId === this._requisiteFieldId)\n\t\t\t{\n\t\t\t\tthis._requisiteField = field;\n\t\t\t\tthis.initRequisiteField();\n\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditNew', this.onEditNewRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditExisted', this.onEditExistedRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onFinishAutocomplete', this.onFinishRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onClearAutocomplete', this.onClearRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onSetDefault', this.onSetDefaultRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onDelete', this.onDeleteRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onHide', this.onHideRequisite.bind(this));\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(this._addressFieldId) && fieldId === this._addressFieldId)\n\t\t\t{\n\t\t\t\tthis._addressField = field;\n\t\t\t\tthis.initAddressField();\n\n\t\t\t\tEventEmitter.subscribe(this._addressField, 'onAddressListUpdate', this.onAddressListUpdate.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis.openEditor(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet options = BX.prop.getObject(params, 'options', {});\n\t\t\tif (Type.isPlainObject(options.autocompleteState))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(options.autocompleteState);\n\t\t\t}\n\t\t\tlet editorOptions = {};\n\t\t\tif (Type.isPlainObject(options.editorOptions))\n\t\t\t{\n\t\t\t\teditorOptions = options.editorOptions;\n\t\t\t}\n\t\t\tthis.openEditor(requisite, editorOptions);\n\t\t}\n\t}\n\n\tonClearRequisiteAutocomplete(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\trequisite.clearFormData();\n\t\t}\n\t}\n\n\tonFinishRequisiteAutocomplete(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst requisite = this.prepareRequisiteByEventData(eventData);\n\t\tconst formData = BX.prop.getObject(BX.prop.getObject(eventData, 'data', {}), 'fields', {});\n\t\tif (formData.hasOwnProperty('RQ_ADDR'))\n\t\t{\n\t\t\tif (Type.isPlainObject(formData.RQ_ADDR))\n\t\t\t{\n\t\t\t\tlet oldAddr = requisite.getAddressList();\n\t\t\t\toldAddr = Type.isPlainObject(oldAddr) ? oldAddr : {};\n\n\t\t\t\tconst addr = {...oldAddr, ...formData.RQ_ADDR};\n\t\t\t\trequisite.setAddressData(addr);\n\t\t\t\trequisite.setAddressList(addr);\n\t\t\t}\n\t\t\tdelete (formData.RQ_ADDR);\n\t\t}\n\t\trequisite.setFormData(formData);\n\t\trequisite.setChanged(true);\n\t\trequisite.setDeleted(false);\n\t\tconst presetId = BX.prop.getInteger(formData, 'PRESET_ID', 0);\n\t\tif (presetId > 0)\n\t\t{\n\t\t\trequisite.setPresetId(presetId);\n\t\t}\n\t\tconst presetCountryId = BX.prop.getInteger(formData, 'PRESET_COUNTRY_ID', 0);\n\t\tif (presetCountryId > 0)\n\t\t{\n\t\t\trequisite.setPresetCountryId(presetCountryId);\n\t\t}\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tthis._requisiteList.add(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t\tif (requisite.isAddressOnly())\n\t\t{\n\t\t\tthis._requisiteList.unhide(requisite);\n\t\t}\n\t}\n\n\tonSetDefaultRequisite(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst id = eventData.id;\n\t\tconst bankDetailId = eventData.bankDetailId;\n\n\t\tif (this._addressField && this._addressField.isChanged())\n\t\t{\n\t\t\tthis._editor.cancel();\n\t\t\treturn false; // have to save address first\n\t\t}\n\n\t\tthis.setSelectedRequisite(id, bankDetailId);\n\t\tthis.updateRequisiteFieldModel();\n\n\t\treturn true;\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis.setRequisiteInitAddrData(requisite);\n\t\t}\n\t\tif (params.postponed)\n\t\t{\n\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\t\tthis._requisiteEditor.deleteRequisite(params.id);\n\t\t}\n\t}\n\n\tonHideRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteList.hide(requisite);\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tthis.initAddressField();\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\teventData.id = this._requisiteList.getSelectedId();\n\n\t\teventData.defaultPresetId = this.getDefaultPresetId();\n\n\t\tlet requisite = this.prepareRequisiteByEventData(eventData);\n\n\t\tlet addresses = {};\n\t\tlet isEmptyAddress = true;\n\t\tfor (let address of eventData.value)\n\t\t{\n\t\t\taddresses[address.type] = address.value;\n\t\t\tif (Type.isStringFilled(address.value))\n\t\t\t{\n\t\t\t\tisEmptyAddress = false;\n\t\t\t}\n\t\t}\n\n\t\trequisite.setAddressData(addresses);\n\t\trequisite.setAddressList(addresses);\n\n\t\trequisite.setChanged(true);\n\t\tif (!isEmptyAddress)\n\t\t{\n\t\t\trequisite.setDeleted(false);\n\t\t}\n\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tif (!isEmptyAddress)\n\t\t\t{\n\t\t\t\trequisite.setAddressOnly(true);\n\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//  remove requisite if address is empty and requisite contain only address\n\t\t\tif (isEmptyAddress && requisite.isAddressOnly())\n\t\t\t{\n\t\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t\t}\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tsuper.onBeforeSubmit();\n\t\tthis.addEditorFormInputs();\n\t}\n\n\tonBeforesSaveControl(data)\n\t{\n\t\tif (!data.hasOwnProperty('REQUISITES'))\n\t\t{\n\t\t\tdata['REQUISITES'] = {};\n\t\t}\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (!requisite.isChanged() && !requisite.isDeleted())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet requisiteData = {};\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\trequisiteData['DELETED'] = 'Y';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trequisiteData['DATA'] = requisite.getRequisiteData();\n\t\t\t\trequisiteData['SIGN'] = requisite.getRequisiteDataSign();\n\t\t\t}\n\t\t\tdata['REQUISITES'][requisite.getRequisiteId()] = requisiteData;\n\t\t}\n\n\t\tif (this._enableRequisiteSelection)\n\t\t{\n\t\t\tconst selectedRequisite = this._requisiteList.getSelected();\n\t\t\tlet selectedRequisiteId = null;\n\t\t\tlet selectedBankDetailId = null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tselectedRequisiteId = selectedRequisite.getRequisiteId();\n\t\t\t\tconst selectedBankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\t\tselectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\t\t\t}\n\n\t\t\tdata['REQUISITES']['BINDING'] = {\n\t\t\t\trequisiteId: selectedRequisiteId,\n\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t};\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tonAfterSave()\n\t{\n\t\tsuper.onAfterSave();\n\t\tthis.saveRequisiteInitData(this.getRequisiteFieldValue());\n\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\n\t\tthis.removeEditorFormInputs();\n\t}\n\n\tonRequisiteEditorAfterEdit()\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tthis.updateRequisiteFieldModel();\n\t\t}\n\t\tthis.markFieldsAsChanged();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet isEmptyRequisitesList = this._requisiteList.isEmpty();\n\t\tif (!isEmptyRequisitesList && data.selectedRemoved)\n\t\t{\n\t\t\t// set new default requisite\n\t\t\tthis.setSelectedRequisite(0, 0);\n\t\t}\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteController();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {MenuManager} from \"main.popup\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Loc, Text} from \"main.core\";\n\nexport class PresetMenu extends EventEmitter\n{\n\tconstructor(id, presetList)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.RequisitePresetMenu');\n\t\tthis._isShown = false;\n\t\tthis.menuId = id;\n\t\tthis.presetList = presetList;\n\t}\n\n\ttoggle(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse if (bindElement)\n\t\t{\n\t\t\tthis.show(bindElement);\n\t\t}\n\t}\n\n\tshow(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.presetList || !this.presetList.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('REQUISITE_LIST_EMPTY_PRESET_LIST'), Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t\t\treturn;\n\t\t}\n\t\tlet menu = [];\n\t\tfor (let item of this.presetList)\n\t\t{\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Text.encode(item.name),\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\tonclick: this.onSelect.bind(this, item)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.menuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = MenuManager.getMenuById(this.menuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.popupWindow.close();\n\t\t}\n\t}\n\n\tisShown()\n\t{\n\t\treturn this._isShown;\n\t}\n\n\tonSelect(item)\n\t{\n\t\tthis.close();\n\t\tthis.emit('onSelect', item);\n\t}\n}","import {PopupManager} from \"main.popup\";\nimport {Tag, Type, Loc, Text} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {PresetMenu} from \"./preset-menu\";\nimport {Loader} from \"main.loader\";\n\nexport class EntityEditorRequisiteTooltip\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tthis._padding = BX.prop.getInteger(this._settings, 'padding', 20);\n\t\tthis._showTimer = false;\n\t\tthis._closeTimer = false;\n\t\tthis._closeTimeout = BX.prop.getInteger(this._settings, 'closeTimeout', 700);\n\t\tthis._showTimeout = BX.prop.getInteger(this._settings, 'showTimeout', 500);\n\t\tthis._popupId = this._id + '_popup';\n\n\t\tthis._isReadonly = BX.prop.getBoolean(this._settings, 'readonly', true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(this._settings, 'canChangeDefaultRequisite', true);\n\n\t\tthis._bindElement = null;\n\t\tthis._wrapper = null;\n\t\tthis._requisiteList = null;\n\n\t\tthis._isLoading = false;\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\n\t\tthis.presetMenu = new PresetMenu(this._id + '_preset_menu', BX.prop.getArray(this._settings, 'presets', []));\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisite.bind(this));\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteTooltip();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis.refreshLayout();\n\t}\n\n\tsetBindElement(bindElement, wrapper)\n\t{\n\t\tthis._bindElement = bindElement;\n\t\tif (!Type.isDomNode(wrapper))\n\t\t{\n\t\t\twrapper = this._bindElement.parentNode ? this._bindElement.parentNode : null;\n\t\t}\n\t\tthis._wrapper = wrapper;\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tthis._isLoading = !!isLoading;\n\t\tthis.refreshLayout();\n\t}\n\n\tshow()\n\t{\n\t\tthis.cancelCloseDebounced();\n\n\t\tlet success = false;\n\t\tif (this._requisiteList && !this._requisiteList.isEmpty())\n\t\t{\n\t\t\tlet popup = PopupManager.create({\n\t\t\t\tid: this._popupId,\n\t\t\t\tcacheable: false,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: this._padding,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tcontent: this.getLayout(),\n\t\t\t\tcloseByEsc: true\n\t\t\t});\n\t\t\tpopup.show();\n\t\t\tthis.adjustPosition();\n\t\t\tsuccess = true;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'onShow', {success});\n\t}\n\n\n\tshowDebounced(delayMultiplier = false)\n\t{\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelShowDebounced();\n\t\tthis.cancelCloseDebounced();\n\t\tthis._showTimer = setTimeout(this.show.bind(this), this._showTimeout * delayMultiplier);\n\t}\n\n\tcancelShowDebounced()\n\t{\n\t\tclearTimeout(this._showTimer);\n\t}\n\n\tcloseDebounced(delayMultiplier = false)\n\t{\n\t\tthis.cancelShowDebounced();\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelCloseDebounced();\n\t\tthis._closeTimer = setTimeout(this.close.bind(this), this._closeTimeout * delayMultiplier);\n\t}\n\n\tcancelCloseDebounced()\n\t{\n\t\tclearTimeout(this._closeTimer);\n\t}\n\n\tadjustPosition()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (!popup || !popup.isShown() || !Type.isDomNode(this._bindElement)\n\t\t\t|| !Type.isDomNode(this._wrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst wrapperRect = this._wrapper.getBoundingClientRect();\n\t\tconst itemRect = this._bindElement.getBoundingClientRect();\n\n\t\tlet offsetLeft = wrapperRect.width - (itemRect.left - wrapperRect.left);\n\n\t\tlet offsetTop = itemRect.height / 2 + this._padding;\n\t\tlet angleOffset = itemRect.height / 2;\n\n\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\tconst popupHeight = popup.getPopupContainer().offsetHeight;\n\t\tconst popupBottom = itemRect.top + popupHeight;\n\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\t// let's try to fit a popup to the browser viewport\n\t\tconst exceeded = popupBottom - clientHeight;\n\t\tif (exceeded > 0)\n\t\t{\n\t\t\tlet roundOffset = Math.ceil(exceeded / itemRect.height) * itemRect.height;\n\t\t\tif (roundOffset > itemRect.top)\n\t\t\t{\n\t\t\t\t// it cannot be higher than the browser viewport.\n\t\t\t\troundOffset -= Math.ceil((roundOffset - itemRect.top) / itemRect.height) * itemRect.height;\n\t\t\t}\n\n\t\t\tif (itemRect.bottom > (popupBottom - roundOffset))\n\t\t\t{\n\t\t\t\t// let's sync bottom boundaries.\n\t\t\t\troundOffset -= itemRect.bottom - (popupBottom - roundOffset) + this._padding;\n\t\t\t}\n\n\t\t\toffsetTop += roundOffset;\n\t\t\tangleOffset += roundOffset + this._padding;\n\t\t}\n\n\t\tpopup.setBindElement(this._bindElement);\n\n\t\tif ((wrapperRect.left + offsetLeft + popupWidth) <= clientWidth)\n\t\t{\n\t\t\tpopup.setAngle({position: 'left', offset: angleOffset});\n\n\t\t\toffsetLeft += popup.angle ? popup.angle.element.offsetWidth : 0;\n\t\t\toffsetTop += popup.angle ? Math.ceil(popup.angle.element.offsetHeight / 2) : 0;\n\t\t\tpopup.setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setAngle(true);\n\t\t}\n\t\tpopup.adjustPosition();\n\t}\n\n\tclose()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tpopup ? popup.close() : null;\n\t\tthis.presetMenu.close();\n\t}\n\n\tremoveDebouncedEvents()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t\tthis.cancelShowDebounced();\n\t}\n\n\trefreshLayout()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.setContent(this.getLayout());\n\t\t}\n\t}\n\n\tgetLayout()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\tlet loader = new Loader();\n\n\t\t\tlet container = Tag.render`<div class=\"crm-rq-wrapper crm-rq-wrapper-loading\"></div>`;\n\t\t\tloader.show(container);\n\t\t\treturn container;\n\t\t}\n\t\tlet requisites = Type.isNull(this._requisiteList) ? [] : this._requisiteList.getList();\n\t\tlet renderRequisiteEditButtonNode = (id) =>\n\t\t{\n\t\t\tif (this._isReadonly)\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_SHOW_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_EDIT')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" data-requisite-id=\"${id}\" onclick=\"${this.onDeleteRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_TOOLTIP_DELETE')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onAddBankDetails.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t};\n\n\t\tlet renderRequisiteBankDetails = (requisite, id) =>\n\t\t{\n\t\t\tlet bandDetails = requisite.getBankDetails();\n\t\t\tlet selectedBankDetailId = requisite.getSelectedBankDetailId();\n\t\t\treturn bandDetails.length ?\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-requisite-container\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-title\">${Loc.getMessage('REQUISITE_TOOLTIP_BANK_DETAILS_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-list\">\n\t\t\t\t\t\t\t${bandDetails.map((bankDetail, index) => Tag.render`\n\t\t\t\t\t\t\t\t<label class=\"crm-rq-org-requisite-item\" onclick=\"${this.onSetSelectedBankDetails.bind(this)}\">\n\t\t\t\t\t\t\t\t\t<input type=\"radio\" data-requisite-id=\"${id}\" data-bankdetails-id=\"${index}\" class=\"crm-rq-org-requisite-btn\" ${requisite.isSelected() && (index === selectedBankDetailId) ? ' checked' : ''} ${this._canChangeDefaultRequisite ? '': ' disabled'}>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-rq-org-requisite-info\">${Text.encode(bankDetail.value)}</span>\n\t\t\t\t\t\t\t\t</label>`)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${renderRequisiteEditButtonNode(id)}\n\t\t\t\t\t</div>`\n\t\t\t\t:\n\t\t\t\trenderRequisiteEditButtonNode(id)\n\t\t};\n\n\t\treturn Tag.render`\n\t\t<div class=\"crm-rq-wrapper\"\n\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\"\n\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\">\n\t\t\t<div class=\"crm-rq-org-list\">\n\t\t\t\t${requisites.map((requisite, index) => Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-item${requisite.isSelected() ? ' crm-rq-org-item-selected' : ''}\" onclick=\"${this.onSetSelectedRequisite.bind(this, index)}\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-info-container\">\n\t\t\t\t\t\t\t<div class=\"crm-rq-org-name\">${Text.encode(requisite.getTitle())}</div>\n\t\t\t\t\t\t\t${requisite.getSubtitle().length ? Tag.render`<div class=\"crm-rq-org-description\">${Text.encode(requisite.getSubtitle())}</div>` : ''}\n\t\t\t\t\t\t\t${renderRequisiteBankDetails(requisite, index)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}\n\t\t\t</div>\n\t\t\t${this._isReadonly ? '' :\n\t\t\tTag.render`<div class=\"crm-rq-btn-container\">\n\t\t\t\t<span class=\"crm-rq-add-rq\" onclick=\"${this.onStartAddRequisite.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"></span> ${Loc.getMessage('REQUISITE_TOOLTIP_ADD')}\n\t\t\t\t</span>\n\t\t\t</div>`}\n\t\t</div>`;\n\t}\n\n\tsetSelectedRequisite(id, bankDetailId)\n\t{\n\t\tlet newSelectedRequisite = this._requisiteList.getById(id);\n\t\tif (!newSelectedRequisite)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\tif (id === this._requisiteList.getSelectedId()) // selected the same requisite\n\t\t{\n\t\t\tlet selectedBankDetails = selectedRequisite.getBankDetails();\n\t\t\tif (selectedBankDetails.length)\n\t\t\t{\n\t\t\t\tfor (let index = 0; index < selectedBankDetails.length; index++)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetails = selectedBankDetails[index];\n\t\t\t\t\tif (Type.isObject(bankDetails) && bankDetails.selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (index === bankDetailId || Type.isNull(bankDetailId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false; // selected same requisite and bank details\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn false; // requisite already selected and hasn't bank details\n\t\t\t}\n\t\t}\n\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {id, bankDetailId});\n\n\t\treturn true;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif (!this.presetMenu.isShown())\n\t\t{\n\t\t\tthis.closeDebounced(1.5);\n\t\t}\n\t}\n\n\tonStartAddRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.presetMenu.toggle(event.target);\n\n\t}\n\n\tonAddRequisite(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.close();\n\t\tEventEmitter.emit(this, 'onAddRequisite', {\n\t\t\tpresetId: data.value\n\t\t});\n\t}\n\n\tonEditRequisite(id, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onEditRequisite', {id});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (Type.isDomNode(element))\n\t\t{\n\t\t\tlet id = element.getAttribute('data-requisite-id');\n\t\t\tEventEmitter.emit(this, 'onDeleteRequisite', {id});\n\t\t}\n\t}\n\n\tonAddBankDetails(requisiteId, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onAddBankDetails', {requisiteId});\n\t}\n\n\tonSetSelectedRequisite(id)\n\t{\n\t\tif (this._canChangeDefaultRequisite)\n\t\t{\n\t\t\tthis.setSelectedRequisite(id, null);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonSetSelectedBankDetails(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (this._canChangeDefaultRequisite && Type.isDomNode(element))\n\t\t{\n\t\t\tif (element.nodeName.toString().toLowerCase() !== 'input')\n\t\t\t{\n\t\t\t\telement = element.querySelector('input');\n\t\t\t\tif (!Type.isDomNode(element))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.checked = false;\n\t\t\tlet id = parseInt(element.getAttribute('data-requisite-id'));\n\t\t\tlet bankDetailsId = parseInt(element.getAttribute('data-bankdetails-id'));\n\t\t\tthis.setSelectedRequisite(id, bankDetailsId);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonChangeRequisites(event)\n\t{\n\t\tthis.refreshLayout();\n\t}\n}","import {Loc, Tag, Dom, Type, Event} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteTooltip} from './requisite-tooltip';\nimport {PresetMenu} from './preset-menu';\n\nexport class EntityEditorRequisiteField extends BX.Crm.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._domNodes = {};\n\t\tthis._requisiteList = null;\n\n\t\tthis.presetMenu = null;\n\t\tthis._autocomplete = null;\n\t\tthis._tooltip = null;\n\t\tthis.isSearchMode = true;\n\t\tthis.requisitesDropdown = null;\n\t\tthis.bankDetailsDropdown = null;\n\t\tthis.selectModeEnabled = false;\n\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tcanAddRequisite: true,\n\t\t\tfeedbackFormParams: BX.prop.getObject(this._schemeElement.getData(), \"feedback_form\", {}),\n\t\t\tenabled: true,\n\t\t\tshowFeedbackLink: false\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onCreateNewItem', this.onAddRequisiteFromAutocomplete.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\n\t\tthis.presetMenu = new PresetMenu(this.getName() + '_requisite_preset_menu', this.getPresetList());\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisiteFromMenu.bind(this));\n\n\t\tconst isReadonly = this.getEditor().isReadOnly();\n\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this.getName() + '_requisite_details', {\n\t\t\treadonly: isReadonly,\n\t\t\tcanChangeDefaultRequisite: !isReadonly,\n\t\t\tpresets: this.getPresetList()\n\t\t});\n\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onAddRequisiteFromTooltip.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\n\t\tthis.updateAutocompletePlaceholder();\n\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\tsetSelectModeEnabled(selectModeEnabled: boolean): void\n\t{\n\t\tif (this.selectModeEnabled !== selectModeEnabled)\n\t\t{\n\t\t\tthis.selectModeEnabled = selectModeEnabled;\n\t\t\tif (this.isSelectModeEnabled())\n\t\t\t{\n\t\t\t\tthis.isSearchMode = false;\n\t\t\t}\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t}\n\n\tisSelectModeEnabled(): boolean\n\t{\n\t\treturn this.selectModeEnabled && this.hasRequisites() && this.getRequisites().getList().length > 0;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tconst hasRequisites = this.hasRequisites();\n\t\tconst vasEmpty = hasRequisites && this.getRequisites().isEmpty();\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis._tooltip.setRequisites(requisiteList);\n\t\tif (hasRequisites && !vasEmpty && !this.getRequisites().isEmpty())\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayout();\n\t\t}\n\t}\n\n\tgetRequisites()\n\t{\n\t\treturn this._requisiteList;\n\t}\n\n\thasRequisites()\n\t{\n\t\treturn Type.isObject(this._requisiteList);\n\t}\n\n\tisSingleMode()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.getRequisites().getList().length <= 1);\n\t}\n\n\tgetTitle()\n\t{\n\t\tlet title = super.getTitle();\n\t\tif (this.hasRequisites() && !this.isSingleMode())\n\t\t{\n\t\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t\tlet selectedPresetId = selectedRequisite ? selectedRequisite.getPresetId() : null;\n\t\t\tif (selectedRequisite && selectedPresetId)\n\t\t\t{\n\t\t\t\tlet selectedPresetName = this.getPresetList().reduce(\n\t\t\t\t\t(name, item) => ((item.value === selectedPresetId) ? item.name : name), '');\n\n\t\t\t\tif (selectedPresetName.length)\n\t\t\t\t{\n\t\t\t\t\ttitle += ' (' + selectedPresetName + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn title;\n\t}\n\n\tcreateTitleActionControls()\n\t{\n\t\tconst actions = [];\n\n\t\tif (this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn actions;\n\t\t}\n\n\t\tif (this.isAutocompleteEnabled() && this.selectModeEnabled)\n\t\t{\n\t\t\tif (this.isSearchMode)\n\t\t\t{\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_SELECT')}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst fieldName = this.getClientResolverTitle();\n\t\t\t\tconst title = fieldName ? Loc.getMessage('REQUISITE_AUTOCOMPLETE_FILL_IN').toLowerCase().replace('#field_name#', fieldName) : '';\n\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${title}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tactions.push(Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t \tonclick=\"${this.editDefaultRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_TEXT')}</span>`\n\t\t\t);\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\ttoggleSearchMode()\n\t{\n\t\tthis.isSearchMode = !this.isSearchMode;\n\n\t\tthis.refreshLayoutParts();\n\t}\n\n\tisNeedToDisplay(options)\n\t{\n\t\treturn this.hasRequisites() && super.isNeedToDisplay(options);\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._domNodes = {};\n\t\tthis.ensureWrapperCreated({classNames: [\"crm-entity-widget-content-block-field-requisites\"]});\n\t\tthis.adjustWrapper();\n\t\tthis.bindWrapperEvents();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._domNodes.addButton = this.renderAddButton();\n\t\t\tthis._domNodes.autocompleteForm = this.renderAutocompleteForm();\n\t\t\tthis._domNodes.requisiteSelectForm = this.renderRequisiteSelectForm();\n\t\t\tthis._domNodes.bankDetailSelectForm = this.renderBankDetailSelectForm();\n\t\t\tDom.append(this._domNodes.autocompleteForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.requisiteSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.bankDetailSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.addButton, this._wrapper);\n\n\t\t\tthis.adjustNodesVisibility();\n\t\t\tthis.updateRequisitesDropdown();\n\t\t\tthis.updateBankDetailsDropdown();\n\t\t\tthis.updateRequisiteSelectorValue();\n\t\t\tthis.updateBankDetailsSelectorValue();\n\t\t}\n\t\telse // if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tDom.append(this.renderSelectedRequisite(), this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tbindWrapperEvents()\n\t{\n\t\tif (!this.wrapperMouseEnterHandler)\n\t\t{\n\t\t\tthis.wrapperMouseEnterHandler = this.onFieldMouseEnter.bind(this);\n\t\t}\n\t\tif (!this.wrapperMouseLeaveHandler)\n\t\t{\n\t\t\tthis.wrapperMouseLeaveHandler = this.onFieldMouseLeave.bind(this);\n\t\t}\n\n\t\tEvent.unbind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.unbind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\n\t\tEvent.bind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.bind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\t}\n\n\trefreshLayoutParts()\n\t{\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.refreshTitleLayout();\n\t\tthis.updateAutocompleteState();\n\t\tthis.adjustNodesVisibility();\n\t\tthis.updateRequisitesDropdown();\n\t\tthis.updateBankDetailsDropdown();\n\t\tthis.updateRequisiteSelectorValue();\n\t\tthis.updateBankDetailsSelectorValue();\n\t}\n\n\thasContentToDisplay()\n\t{\n\t\treturn this.hasValue();\n\t}\n\n\thasValue()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn  false;\n\t\t}\n\t\tlet list = this.getRequisites().getList();\n\t\tif (list.length > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\t// if list contains only one item, it shouldn't be hidden:\n\t\treturn (list.length === 1 && !list[0].isAddressOnly());\n\t}\n\n\tisAutocompleteEnabled()\n\t{\n\t\tif (!this.hasRequisites() || this.getRequisites().isEmpty())\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\t\treturn true;\n\t}\n\n\trenderSelectedRequisite()\n\t{\n\t\tthis._domNodes.selectedRequisiteView = Tag.render`<span></span>`;\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.updateAutocompleteState();\n\t\tlet container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\" \n\t\t\t\tonclick=\"${this.onViewStringClick.bind(this)}\"\n\t\t\t\tonmouseenter=\"${this.onViewStringMouseEnter.bind(this)}\">\n\t\t\t\t\t${this._domNodes.selectedRequisiteView}\n\t\t\t</div>`;\n\t\tthis._tooltip.setBindElement(container, this.getEditor().getFormElement());\n\n\t\treturn container;\n\t}\n\n\tupdateSelectedRequisiteText()\n\t{\n\t\tif (!this._domNodes.selectedRequisiteView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selectedRequisite = this.hasRequisites() && this.getRequisites().getSelected();\n\t\tif (this.hasValue() && selectedRequisite && selectedRequisite.getTitle().length)\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.add('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = selectedRequisite.getTitle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.remove('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = BX.UI.EntityEditorField.messages.isEmpty;\n\t\t}\n\t}\n\n\trenderAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block crm-entity-widget-content-block-requisites\">\n\t\t\t\t<span class=\"crm-entity-widget-client-requisites-add-btn\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t</div>`;\n\t}\n\n\trenderAutocompleteForm()\n\t{\n\t\tconst autocompleteContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\"></div>`;\n\t\tconst hasResolvers = !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\tthis._autocomplete.setEnabled(hasResolvers);\n\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\tthis.updateAutocompleteState();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${autocompleteContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderRequisiteSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.requisitesDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tconst selectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.requisitesDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onRequisiteSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${selectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_REQUISITE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderBankDetailSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.bankDetailsDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tthis._domNodes.bankDetailsSelectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.bankDetailsDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onBankDetailSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${this._domNodes.bankDetailsSelectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.onAddBankDetailsClick.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteValue = null;\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite && !selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tautocompleteValue = selectedRequisite.getAutocompleteData();\n\t\t}\n\t\tthis._autocomplete.setCurrentItem(autocompleteValue);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tupdateAutocompletePlaceholder()\n\t{\n\t\tconst clientResolverPropTitle = this.getClientResolverTitle();\n\t\tthis._autocomplete.setEnabled(!!clientResolverPropTitle);\n\t\tthis._autocomplete.setPlaceholderText(clientResolverPropTitle);\n\t}\n\n\tgetClientResolverTitle()\n\t{\n\t\tconst selectedPresetId = this.getSelectedPresetId();\n\t\tconst clientResolverProp = this.getClientResolverPropForPreset(selectedPresetId);\n\n\t\treturn BX.prop.getString(clientResolverProp, 'TITLE');\n\t}\n\n\tadjustNodesVisibility()\n\t{\n\t\tif (\n\t\t\t!this._domNodes.autocompleteForm\n\t\t\t|| !this._domNodes.requisiteSelectForm\n\t\t\t|| !this._domNodes.bankDetailSelectForm\n\t\t\t|| !this._domNodes.addButton\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSearchMode && this.isAutocompleteEnabled())\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = '';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t\telse if (\n\t\t\tthis.isSelectModeEnabled()\n\t\t\t&& this.hasRequisites()\n\t\t\t&&\n\t\t\t(\n\t\t\t\tthis.getRequisites().getList().length > 1\n\t\t\t \t|| (\n\t\t\t\t\tthis.getRequisites().getList().length > 0)\n\t\t\t\t\t&& !this.getRequisites().getSelected().isAddressOnly()\n\t\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = '';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\n\t\t\tif (this._domNodes.bankDetailsSelectContainer)\n\t\t\t{\n\t\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\t\tif (!bankDetails.length)\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = 'none';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t}\n\n\tgetSelectedRequisiteTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\ttitle = selectedRequisite.getTitle();\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tupdateRequisiteSelectorValue()\n\t{\n\t\tif (!this.requisitesDropdown || !this.requisitesDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requisitesDropdown.targetElement.innerText = this.getSelectedRequisiteTitle();\n\t}\n\n\tupdateBankDetailsSelectorValue()\n\t{\n\t\tif (!this.bankDetailsDropdown || !this.bankDetailsDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.bankDetailsDropdown.targetElement.innerText = this.getSelectedBankDetailTitle();\n\t}\n\n\tgetSelectedBankDetailTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\tconst bankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\tif (bankDetail && bankDetail.title)\n\t\t\t{\n\t\t\t\ttitle = bankDetail.title;\n\t\t\t}\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.IS_DEFAULT)\n\t\t\t{\n\t\t\t\treturn preset.VALUE;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetSelectedPresetId()\n\t{\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\treturn selectedRequisite.getPresetId();\n\t\t}\n\t\treturn this.getDefaultPresetId();\n\t}\n\n\tgetClientResolverPropForPreset(presetId)\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.VALUE === presetId)\n\t\t\t{\n\t\t\t\treturn BX.prop.get(preset, 'CLIENT_RESOLVER_PROP', null);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\treturn {\n\t\t\tpresetId: this.getSelectedPresetId()\n\t\t};\n\t}\n\n\ttoggleNewRequisitePresetMenu(e)\n\t{\n\t\tthis.presetMenu.toggle(e.target);\n\t};\n\n\tgetPresetList()\n\t{\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._schemeElement.getData(), \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\taddRequisite(params)\n\t{\n\t\tEventEmitter.emit(this, 'onEditNew', params);\n\t}\n\n\teditRequisite(id, options)\n\t{\n\t\tEventEmitter.emit(this, 'onEditExisted', {id, options});\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tthis._tooltip.removeDebouncedEvents();\n\t\tthis._tooltip.close();\n\t\tEventEmitter.emit(this, 'onDelete', {id, postponed: this._mode === BX.UI.EntityEditorMode.edit});\n\t}\n\n\thideRequisite(id)\n\t{\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tEventEmitter.emit(this, 'onHide', {id});\n\t}\n\n\tshowDeleteConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.markAsChanged();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tshowClearConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"hide_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.hideRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\teditDefaultRequisite()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: this.getDefaultPresetId(),\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tif (\n\t\t\t(this._domNodes && Type.isDomNode(this._domNodes.addButton) && this._domNodes.addButton.style.display !== 'none') ||\n\t\t\t(this.hasRequisites() && this.getRequisites().isEmpty()) ||\n\t\t\t(this.hasRequisites() && this.getRequisites().getSelected().isAddressOnly())\n\t\t)\n\t\t{\n\t\t\t// this.refreshLayout();\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\tthis.updateAutocompletePlaceholder();\n\t}\n\n\tupdateRequisitesDropdown()\n\t{\n\t\tif (!this.requisitesDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tthis.getRequisites().getList().forEach((requisiteItem, index) => {\n\t\t\t\titems.push({\n\t\t\t\t\tid: requisiteItem.getRequisiteId(),\n\t\t\t\t\ttitle: requisiteItem.getTitle(),\n\t\t\t\t\tsubTitle: requisiteItem.getSubtitle(),\n\t\t\t\t\tindex\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.requisitesDropdown.setItems(items);\n\t}\n\n\tupdateBankDetailsDropdown()\n\t{\n\t\tif (!this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites() && this.getRequisites().getSelected())\n\t\t{\n\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\tif (bankDetails.length)\n\t\t\t{\n\t\t\t\tbankDetails.forEach((bankDetail, index) => {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: bankDetail.id,\n\t\t\t\t\t\ttitle: bankDetail.title,\n\t\t\t\t\t\tsubTitle: bankDetail.value,\n\t\t\t\t\t\tindex\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.setItems(items);\n\t}\n\n\tonRequisiteSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId());\n\t\t\tif (selectedRequisiteId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\t\tif (this.requisitesDropdown)\n\t\t{\n\t\t\tthis.requisitesDropdown.getPopupWindow().close();\n\t\t}\n\t}\n\n\tonBankDetailSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites() || !this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId())\n\t\t\tconst selectedBankDetailId = Number(this.getRequisites().getSelected().getSelectedBankDetailId());\n\t\t\tif (selectedBankDetailId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(selectedRequisiteId, index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.getPopupWindow().close();\n\t}\n\n\tonAddRequisiteFromMenu(event)\n\t{\n\t\tlet data = event.getData();\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t// if hidden requisite is selected, it will be used instead of new:\n\t\tif (null !== selectedRequisite && selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tthis.editRequisite(this.getRequisites().getSelectedId(), {\n\t\t\t\teditorOptions: {\n\t\t\t\t\toverriddenPresetId: data.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: data.value\n\t\t\t});\n\t\t}\n\t}\n\n\tonAddRequisiteFromTooltip(event)\n\t{\n\t\tthis.addRequisite(event.getData());\n\t}\n\n\tonAddRequisiteFromAutocomplete()\n\t{\n\t\tthis.editDefaultRequisite();\n\t}\n\n\tonEditRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.id, {\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.showDeleteConfirmation(eventData.id);\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.requisiteId, {\n\t\t\teditorOptions: {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t},\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setLoading(true);\n\t\tif (this.selectModeEnabled)\n\t\t{\n\t\t\tthis.isSearchMode = false;\n\t\t}\n\t\tconst selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tEventEmitter.emit(this, 'onFinishAutocomplete', {\n\t\t\tid: selectedRequisiteId,\n\t\t\tdefaultPresetId: this.getDefaultPresetId(),\n\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\tdata\n\t\t});\n\t}\n\n\tonClearAutocompleteValue()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\t\tlet hasAddresses = false;\n\t\t\tlet addresses = selectedRequisite.getAddressList();\n\t\t\tfor (let addressType in addresses)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\taddresses.hasOwnProperty(addressType) &&\n\t\t\t\t\tType.isStringFilled(addresses[addressType])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\thasAddresses = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasAddresses)\n\t\t\t{\n\t\t\t\tthis.showClearConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDeleteConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewStringClick()\n\t{\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t\tthis.switchToSingleEditMode();\n\t\t}\n\t}\n\n\tonViewStringMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced();\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onSetDefault', eventData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonFieldMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced(5);\n\t\t}\n\t}\n\n\tonFieldMouseLeave()\n\t{\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t}\n\n\tonAddBankDetailsClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\t\teditorOptions: {\n\t\t\t\t\taddBankDetailsItem: true\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","import {EntityEditorAddressField} from \"crm.entity-editor.field.address\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class EntityEditorRequisiteAddressField extends EntityEditorAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\trollback()\n\t{\n\t\t// rollback will be executed in requisite controller\n\t}\n\n\treset()\n\t{\n\t\t// reset will be executed in requisite controller\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tsuper.onAddressListUpdate(event);\n\t\tEventEmitter.emit(this, 'onAddressListUpdate', event);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n","import {Loc, Dom, Type, Tag} from \"main.core\";\nimport {Loader} from \"main.loader\";\nimport {EntityEditorBaseAddressField} from \"crm.entity-editor.field.address.base\";\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteTooltip} from \"./requisite-tooltip\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\";\n\nexport class EntityEditorClientRequisites\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._entityInfo = null;\n\t\tthis._fieldsParams = null;\n\t\tthis._loaderConfig = null;\n\t\tthis._addressConfig = null;\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._readonly = true;\n\t\tthis._requisiteEditUrl = null;\n\t\tthis._addressContainer = null;\n\t\tthis._formElement = null;\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.setEntity(BX.prop.get(settings, \"entityInfo\", null), false);\n\t\tif (!this._entityInfo)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: EntityInfo must be instance of BX.CrmEntityInfo\";\n\t\t}\n\t\tthis._fieldsParams = BX.prop.get(settings, \"fieldsParams\", null);\n\t\tif (!this._fieldsParams)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: Fields params are undefined\";\n\t\t}\n\t\tthis._addressConfig = BX.prop.getObject(this._fieldsParams, 'ADDRESS', null);\n\n\t\tthis._requisitesConfig = BX.prop.getObject(this._fieldsParams, 'REQUISITES', null);\n\n\t\tif (this._requisiteList)\n\t\t{\n\t\t\tlet selectedItem = BX.prop.getObject(settings, \"requisiteBinding\", null);\n\t\t\tif (selectedItem\n\t\t\t\t&& !Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t\t{\n\t\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\t\tif (requisite)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._loaderConfig = BX.prop.getObject(settings, 'loaderConfig', null);\n\n\t\tthis._readonly = BX.prop.getBoolean(settings, \"readonly\", true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(settings, \"canChangeDefaultRequisite\", true);\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, \"requisiteEditUrl\", null);\n\t\tthis._formElement = BX.prop.get(settings, \"formElement\", null);\n\n\t\tif (BX.prop.getBoolean(settings, \"enableTooltip\", true) && !Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this._id + '_client_requisite_details', {\n\t\t\t\treadonly: this._readonly,\n\t\t\t\tcanChangeDefaultRequisite: this._canChangeDefaultRequisite,\n\t\t\t\tpresets: this.getRequisitesPresetList()\n\t\t\t});\n\t\t}\n\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._entityInfo.getTypeId(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\tcontextId: BX.prop.getString(settings, \"contextId\", \"\"),\n\t\t\trequisiteEditUrl: this._requisiteEditUrl\n\t\t});\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onEditNewRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditExistedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onShow', this.onShowTooltip.bind(this));\n\t\t}\n\t}\n\n\tsetEntity(entityInfo, emitNotification)\n\t{\n\t\tthis._entityInfo = entityInfo;\n\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._requisiteList = RequisiteList.create(this._entityInfo.getRequisites());\n\t\t}\n\t\tif (emitNotification)\n\t\t{\n\t\t\tthis.onChangeRequisiteList();\n\t\t}\n\t}\n\n\taddressLayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._addressContainer = Tag.render`<div class=\"crm-entity-widget-client-address\"></div>`;\n\t\tDom.append(this._addressContainer, container);\n\t\tthis.doAddressLayout();\n\t}\n\n\tdoAddressLayout()\n\t{\n\t\tif (!Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this._addressContainer);\n\n\t\tif (!Type.isNull(this._addressConfig))\n\t\t{\n\t\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t\t{\n\t\t\t\tlet defaultRequisite = this._requisiteList.getSelected();\n\t\t\t\tlet addressValue = defaultRequisite ? defaultRequisite.getAddressList() : null;\n\n\t\t\t\tif (!Type.isNull(addressValue) && Object.keys(addressValue).length)\n\t\t\t\t{\n\t\t\t\t\tlet countryId = 0;\n\t\t\t\t\tif (defaultRequisite)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountryId = parseInt(defaultRequisite.getPresetCountryId());\n\t\t\t\t\t}\n\t\t\t\t\tthis._addressField = EntityEditorBaseAddressField.create(this._entityInfo.getId(), {\n\t\t\t\t\t\tshowFirstItemOnly: true,\n\t\t\t\t\t\tshowAddressTypeInViewMode: true,\n\t\t\t\t\t\taddressZoneConfig: BX.prop.getObject(this._addressConfig, \"addressZoneConfig\", {}),\n\t\t\t\t\t\tcountryId: countryId\n\t\t\t\t\t});\n\t\t\t\t\tthis._addressField.setMultiple(true);\n\t\t\t\t\tthis._addressField.setTypesList(BX.prop.getObject(this._addressConfig, \"types\", {}));\n\t\t\t\t\tthis._addressField.setValue(addressValue);\n\t\t\t\t\tDom.append(this._addressField.layout(false), this._addressContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet showAddressLink = Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onLoadAddressMouseUp.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('CLIENT_REQUISITES_ADDRESS_SHOW_ADDRESS')}\n\t\t\t\t</span>`;\n\n\t\t\t\tDom.append(showAddressLink, this._addressContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowTooltip(bindElement)\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tif (this.isRequisiteAddressOnly())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._tooltip.setBindElement(bindElement, this._formElement);\n\t\tthis._tooltip.showDebounced();\n\t}\n\n\tcloseTooltip()\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\trelease()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.release();\n\t\t}\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t}\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tloadEntity()\n\t{\n\t\tif (!this._loaderConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\tlet loader = new Loader({size: 19, mode: 'inline'});\n\t\t\tDom.clean(this._addressContainer);\n\t\t\tloader.show(this._addressContainer);\n\t\t}\n\n\t\tBX.CrmDataLoader.create(\n\t\t\tthis._id,\n\t\t\t{\n\t\t\t\tserviceUrl: this._loaderConfig[\"url\"],\n\t\t\t\taction: this._loaderConfig[\"action\"],\n\t\t\t\tparams: {\n\t\t\t\t\t\"ENTITY_TYPE_NAME\": this._entityInfo.getTypeName(),\n\t\t\t\t\t\"ENTITY_ID\": this._entityInfo.getId(),\n\t\t\t\t\t\"NORMALIZE_MULTIFIELDS\": \"Y\"\n\t\t\t\t}\n\t\t\t}\n\t\t).load(this.onEntityInfoLoad.bind(this));\n\t}\n\n\tgetRequisitesPresetList()\n\t{\n\t\tif (Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._requisitesConfig, \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t}\n\t\tthis._requisiteEditor.deleteRequisite(id);\n\t}\n\n\tisRequisiteAddressOnly()\n\t{\n\t\tlet list = this._requisiteList.getList();\n\t\treturn (list.length === 1 && list[0].isAddressOnly());\n\t}\n\n\tonLoadAddressMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis.loadEntity();\n\t}\n\n\tonEntityInfoLoad(sender, result)\n\t{\n\t\tvar entityData = BX.prop.getObject(result, \"DATA\", null);\n\t\tif (entityData)\n\t\t{\n\t\t\tthis.setEntity(BX.CrmEntityInfo.create(entityData), true);\n\t\t\tif (this._tooltip && this._showTooltipOnEntityLoad)\n\t\t\t{\n\t\t\t\tif (!this.isRequisiteAddressOnly())\n\t\t\t\t{\n\t\t\t\t\tthis._tooltip.show();\n\t\t\t\t}\n\t\t\t\tthis._showTooltipOnEntityLoad = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis._requisiteEditor.open(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {});\n\t\t}\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(eventData.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet requisite = this._requisiteList.getById(eventData.requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t});\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis._requisiteList.setSelected(eventData.id, eventData.bankDetailId);\n\n\t\tthis.doAddressLayout();\n\n\t\tlet newSelectedRequisite = this._requisiteList.getSelected();\n\t\tif (newSelectedRequisite)\n\t\t{\n\t\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? 0 : selectedBankDetail.id;\n\n\t\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {\n\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\tbankDetailId: selectedBankDetailId\n\t\t\t});\n\t\t}\n\t}\n\n\tonRequisiteEditorAfterEdit(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonChangeRequisiteList()\n\t{\n\t\tthis.doAddressLayout();\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tthis._tooltip.setLoading(false);\n\t\t}\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\n\t\tlet requisiteList = this._requisiteList ? this._requisiteList.exportToModel() : null;\n\n\t\tthis._entityInfo.setRequisites(requisiteList);\n\t\tEventEmitter.emit(this, 'onChangeRequisiteList', {\n\t\t\tentityTypeName: this._entityInfo.getTypeName(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\trequisites: this._requisiteList.exportToModel()\n\t\t});\n\t}\n\n\tonShowTooltip()\n\t{\n\t\tif (!this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tif (this._tooltip)\n\t\t\t{\n\t\t\t\tthis._tooltip.close();\n\t\t\t\tthis._showTooltipOnEntityLoad = true;\n\t\t\t}\n\t\t\tthis.loadEntity();\n\t\t}\n\t\telse if (this.isRequisiteAddressOnly())\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorClientRequisites();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}"],"names":["RequisiteList","setEventNamespace","_items","CHANGE_EVENT","value","settings","Type","isArray","item","listItem","RequisiteListItem","create","push","filter","isDeleted","getList","length","selectedId","getSelectedId","getById","list","index","requisite","isSelected","id","requisiteId","getRequisiteId","reduce","prev","current","bankDetailsId","selected","setSelected","setSelectedBankDetails","isNull","getSelectedBankDetailId","notifyListChanged","maxExistedId","prevId","getRequisiteIdAsString","match","newRequisitePattern","currentId","Math","max","parseInt","indexOf","isAddressOnly","splice","setDeleted","setAddressOnly","setChanged","emit","result","exportedItem","exportToModel","self","initialize","EventEmitter","_data","isPlainObject","isNew","isChanged","formData","addressData","autocompleteState","presetId","BX","prop","getString","requisiteData","requisiteDataSign","bankDetails","bankDetailIdSelected","addressList","title","subtitle","extraData","getObject","initialAddressDdta","prepareViewData","JSON","parse","e","viewData","newRequisiteId","getNumber","getFields","setRequisiteId","bankDetailViewDataList","prepareBankDetailsList","bankDetailsItem","deleted","pseudoId","fields","isStringFilled","textValue","map","join","hasOwnProperty","getBoolean","changed","selectedBankDetailId","getInteger","getBankDetails","bankDetailId","getArray","isNumber","String","getAutocompleteState","selectedAutocompleteItem","subTitle","isUndefined","name","state","oldAddressTypes","Object","keys","addresses","type","getAddressData","isString","DELETED","presetCountryId","justSelected","setFormData","getFormData","setAddressData","EntityEditorRequisiteEditor","_requisiteList","_entityTypeId","_entityId","_contextId","_mode","UI","EntityEditorMode","view","currentSliderRequisiste","_requisiteEditUrl","_onExternalEventListener","onExternalEvent","bind","subscribe","requisiteList","mode","options","sliderOptions","width","cacheable","allowChangeHistory","requestMethod","requestParams","prepareSliderRequestParams","Crm","Page","openSlider","getSliderUrl","postData","sessid","bitrix_sessid","ACTION","ajax","post","data","json","ERROR","showError","selectedRequisite","getSelected","selectedRemoved","remove","errorMessage","MessageBox","alert","Loc","getMessage","urlParams","etype","eid","external_context_id","getPresetId","util","add_url_param","getRequisiteEditUrl","getRequisiteData","getRequisiteDataSign","stringify","isEmptyFormData","isEmptyAddressData","RQ_ADDR","getAddressesForSave","isViewMode","overriddenPresetId","replace","PRESET_ID","useFormData","promise","method","dataType","url","unsubscribe","event","dataArray","getData","eventName","contextId","isObject","setRequisiteData","setAutocompleteState","clearFormData","clearAddressData","setPresetId","setPresetCountryId","setNew","add","EntityEditorRequisiteController","_requisiteEditor","_requisiteFieldId","_requisiteField","_requisiteInitData","_addressFieldId","_addressField","_isLoading","_formInputsWrapper","_enableRequisiteSelection","getConfigStringParam","saveRequisiteInitData","_editor","onFieldInit","initRequisiteEditor","initRequisiteList","selectedItem","getConfig","REQUISITE_ID","BANK_DETAIL_ID","getByRequisiteId","bankDetail","getBankDetailByBankDetailId","_config","onChangeRequisites","setRequisiteList","_id","entityTypeId","getEntityTypeId","entityId","getEntityId","getContextId","requisiteEditUrl","onRequisiteEditorAfterEdit","onRequisiteEditorAfterDelete","setRequisites","setSelectModeEnabled","countryId","getPresetCountryId","requisiteAddressList","getAddressList","setCountryId","setAddressList","enableRequisiteSelection","getRequisiteFieldValue","promises","signPromise","signRequisiteFields","then","error","entityDataObj","entityData","entityDataSign","addError","EntityValidationError","field","getFirstEditModeField","Promise","resolve","reject","all","newSelectedRequisite","selectedBankDetail","getBankDetailById","startLoading","runAction","stopLoading","setRequisiteInitAddrData","setMode","getMode","open","rawRequisite","requisiteFields","setInitialAddressData","setInitAddrData","edit","modelValue","_model","setField","getField","Tag","render","Dom","append","getFormElement","getListWithDeleted","dataInput","safe","signInput","isDomNode","markAsChanged","initRequisiteField","initAddressField","updateRequisiteFieldModel","eventData","extraFields","isEmpty","defaultPresetId","getNewRequisiteId","getDefaultPresetId","schemeElement","getScheme","getAvailableElements","getName","preset","IS_DEFAULT","VALUE","getSignRequisitePromise","release","fieldId","getId","onEditNewRequisite","onEditExistedRequisite","onFinishRequisiteAutocomplete","onClearRequisiteAutocomplete","onSetDefaultRequisite","onDeleteRequisite","onHideRequisite","onAddressListUpdate","params","openEditor","editorOptions","prepareRequisiteByEventData","oldAddr","addr","unhide","cancel","setSelectedRequisite","postponed","removePostponed","deleteRequisite","hide","isEmptyAddress","address","addEditorFormInputs","selectedRequisiteId","removeEditorFormInputs","markFieldsAsChanged","isEmptyRequisitesList","EntityEditorController","PresetMenu","presetList","_isShown","menuId","bindElement","close","show","menu","text","Text","encode","onclick","onSelect","MenuManager","angle","events","onPopupShow","onPopupClose","getMenuById","popupWindow","EntityEditorRequisiteTooltip","isNotEmptyString","getRandomString","_settings","_padding","_showTimer","_closeTimer","_closeTimeout","_showTimeout","_popupId","_isReadonly","_canChangeDefaultRequisite","_bindElement","_wrapper","_changeRequisistesHandler","presetMenu","onAddRequisite","refreshLayout","wrapper","parentNode","isLoading","cancelCloseDebounced","success","popup","PopupManager","autoHide","padding","contentPadding","content","getLayout","closeByEsc","adjustPosition","delayMultiplier","cancelShowDebounced","setTimeout","clearTimeout","getPopupById","isShown","wrapperRect","getBoundingClientRect","itemRect","offsetLeft","left","offsetTop","height","angleOffset","popupWidth","getPopupContainer","offsetWidth","popupHeight","offsetHeight","popupBottom","top","clientWidth","document","documentElement","clientHeight","exceeded","roundOffset","ceil","bottom","setBindElement","setAngle","position","offset","element","setOffset","setContent","loader","Loader","container","requisites","renderRequisiteEditButtonNode","onEditRequisite","onAddBankDetails","renderRequisiteBankDetails","bandDetails","onSetSelectedBankDetails","onMouseEnter","onMouseLeave","onSetSelectedRequisite","getTitle","getSubtitle","onStartAddRequisite","selectedBankDetails","closeDebounced","stopPropagation","toggle","target","getAttribute","nodeName","toString","toLowerCase","querySelector","checked","EntityEditorRequisiteField","_domNodes","_autocomplete","_tooltip","isSearchMode","requisitesDropdown","bankDetailsDropdown","selectModeEnabled","RequisiteAutocompleteField","searchAction","canAddRequisite","feedbackFormParams","_schemeElement","enabled","showFeedbackLink","onSelectAutocompleteValue","onAddRequisiteFromAutocomplete","onClearAutocompleteValue","getPresetList","onAddRequisiteFromMenu","isReadonly","getEditor","isReadOnly","readonly","canChangeDefaultRequisite","presets","onAddRequisiteFromTooltip","updateAutocompletePlaceholder","isSelectModeEnabled","refreshLayoutParts","hasRequisites","getRequisites","vasEmpty","isSingleMode","selectedPresetId","selectedPresetName","actions","isAutocompleteEnabled","toggleSearchMode","fieldName","getClientResolverTitle","editDefaultRequisite","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","bindWrapperEvents","isNeedToDisplay","registerLayout","isDragEnabled","createDragButton","createTitleNode","addButton","renderAddButton","autocompleteForm","renderAutocompleteForm","requisiteSelectForm","renderRequisiteSelectForm","bankDetailSelectForm","renderBankDetailSelectForm","adjustNodesVisibility","updateRequisitesDropdown","updateBankDetailsDropdown","updateRequisiteSelectorValue","updateBankDetailsSelectorValue","renderSelectedRequisite","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","wrapperMouseEnterHandler","onFieldMouseEnter","wrapperMouseLeaveHandler","onFieldMouseLeave","Event","unbind","updateSelectedRequisiteText","refreshTitleLayout","updateAutocompleteState","hasValue","getClientResolverPropForPreset","getSelectedPresetId","selectedRequisiteView","onViewStringClick","onViewStringMouseEnter","classList","textContent","EntityEditorField","messages","toggleNewRequisitePresetMenu","autocompleteContainer","hasResolvers","setEnabled","layout","isOpen","toggleDropdown","showPopupWindow","destroyPopupWindow","selectInput","selectContainer","Dropdown","targetElement","items","isDisabled","onRequisiteSelect","bankDetailsSelectContainer","onBankDetailSelect","onAddBankDetailsClick","autocompleteValue","getAutocompleteData","setCurrentItem","setContext","getAutocompleteContext","clientResolverPropTitle","setPlaceholderText","clientResolverProp","style","display","innerText","getSelectedRequisiteTitle","getSelectedBankDetailTitle","get","removeDebouncedEvents","EditorAuxiliaryDialog","buttons","DialogButtonType","accept","callback","button","getDialog","hideRequisite","editRequisite","getState","addRequisite","forEach","requisiteItem","setItems","sender","undefined","Number","getPopupWindow","showDeleteConfirmation","addBankDetailsItem","setLoading","hasAddresses","addressType","showClearConfirmation","switchToSingleEditMode","showDebounced","preventDefault","EntityEditorRequisiteAddressField","EntityEditorAddressField","EntityEditorClientRequisites","_entityInfo","_fieldsParams","_loaderConfig","_addressConfig","_readonly","_addressContainer","_formElement","_showTooltipOnEntityLoad","setEntity","_requisitesConfig","getRequisitesPresetList","getTypeId","onShowTooltip","entityInfo","emitNotification","hasEditRequisiteData","onChangeRequisiteList","doAddressLayout","clean","defaultRequisite","addressValue","EntityEditorBaseAddressField","showFirstItemOnly","showAddressTypeInViewMode","addressZoneConfig","setMultiple","setTypesList","setValue","showAddressLink","onLoadAddressMouseUp","isRequisiteAddressOnly","size","CrmDataLoader","serviceUrl","action","getTypeName","load","onEntityInfoLoad","loadEntity","CrmEntityInfo","entityTypeName"],"mappings":"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"}