{"version":3,"file":"requisite.bundle.js","sources":["../src/requisite-list.js","../src/requisite-editor.js","../src/requisite-controller.js","../src/preset-menu.js","../src/requisite-tooltip.js","../src/requisite-crm-field.js","../src/address-crm-field.js","../src/client-requisites.js"],"sourcesContent":["import {Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class RequisiteList extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.EntityEditorRequisiteField.RequisiteList');\n\t\tthis._items = [];\n\n\t\tthis.CHANGE_EVENT = 'onChange';\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (!Type.isArray(value))\n\t\t{\n\t\t\tvalue = [];\n\t\t}\n\t\tfor (let item of value)\n\t\t{\n\t\t\tlet listItem = RequisiteListItem.create(item);\n\t\t\tthis._items.push(listItem);\n\t\t}\n\t}\n\n\tgetList()\n\t{\n\t\treturn this._items.filter((item) => !item.isDeleted());\n\t}\n\n\tgetListWithDeleted()\n\t{\n\t\treturn this._items;\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn !this.getList().length;\n\t}\n\n\tgetSelected()\n\t{\n\t\tlet selectedId = this.getSelectedId();\n\t\treturn this.getById(selectedId);\n\t}\n\n\tgetSelectedId()\n\t{\n\t\tlet list = this.getList();\n\t\tif (!list.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tfor (let index = 0; index < list.length; index++)\n\t\t{\n\t\t\tlet requisite = list[index];\n\t\t\tif (requisite.isSelected())\n\t\t\t{\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t\treturn 0; // first element by default\n\t}\n\n\tgetById(id)\n\t{\n\t\tlet list = this.getList();\n\n\t\tif (null === id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (id >= 0 && id < list.length)\n\t\t{\n\t\t\treturn list[id];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetByRequisiteId(requisiteId)\n\t{\n\t\tlet list = this.getList();\n\t\treturn list\n\t\t\t.filter((item) => item.getRequisiteId() == requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tsetSelected(requisiteId, bankDetailsId)\n\t{\n\t\tlet requisite = this.getById(requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tfor (let item of this.getList())\n\t\t\t{\n\t\t\t\tlet selected = (item === requisite);\n\t\t\t\titem.setSelected(selected);\n\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\titem.setSelectedBankDetails(\n\t\t\t\t\t\tType.isNull(bankDetailsId) ? requisite.getSelectedBankDetailId() : bankDetailsId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tgetNewRequisiteId()\n\t{\n\t\tlet maxExistedId = this.getList().reduce((prevId, item) =>\n\t\t{\n\t\t\tlet requisiteId = item.getRequisiteIdAsString();\n\t\t\tlet match = requisiteId ? requisiteId.match(RequisiteListItem.newRequisitePattern) : false;\n\t\t\tlet currentId = match && match[1] ? match[1] : -1;\n\t\t\treturn Math.max(prevId, currentId);\n\t\t}, -1);\n\n\t\treturn 'n' + (parseInt(maxExistedId) + 1);\n\t}\n\n\tindexOf(item)\n\t{\n\t\treturn this._items.indexOf(item);\n\t}\n\n\tadd(item)\n\t{\n\t\tthis._items.push(item);\n\t\tif (!item.isAddressOnly())\n\t\t{\n\t\t\tthis.setSelected(this._items.indexOf(item));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tremove(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis._items.splice(index, 1);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tremovePostponed(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setDeleted(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\thide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(true);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tunhide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(false);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tnotifyListChanged()\n\t{\n\t\tthis.emit(this.CHANGE_EVENT);\n\t}\n\n\texportToModel()\n\t{\n\t\tlet result = [];\n\t\tfor (let item of this._items)\n\t\t{\n\t\t\tlet exportedItem = item.exportToModel();\n\t\t\tresult.push({...exportedItem});\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteList();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nexport class RequisiteListItem\n{\n\tconstructor()\n\t{\n\n\t\tthis._data = null;\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tthis._data = {...value};\n\t\t\tthis._data.isNew = false;\n\t\t\tthis._data.isChanged = false;\n\t\t\tthis._data.isDeleted = false;\n\t\t\tthis._data.isAddressOnly = false;\n\t\t\tthis._data.formData = {};\n\t\t\tthis._data.addressData = {};\n\t\t\tif (!Type.isPlainObject(this._data.autocompleteState))\n\t\t\t{\n\t\t\t\tthis._data.autocompleteState = {};\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{ // new empty requisite\n\t\t\tthis._data = {\n\t\t\t\tisNew: true,\n\t\t\t\tisChanged: false,\n\t\t\t\tisDeleted: false,\n\t\t\t\tisAddressOnly: false,\n\t\t\t\tselected: false,\n\t\t\t\tpresetId: null,\n\t\t\t\trequisiteId: BX.prop.getString(settings, 'newRequisiteId', 'n0'),\n\t\t\t\trequisiteData: '',\n\t\t\t\trequisiteDataSign: '',\n\t\t\t\tbankDetails: [],\n\t\t\t\tbankDetailIdSelected: 0,\n\t\t\t\taddressList: {},\n\t\t\t\tvalue: {},\n\t\t\t\ttitle: '',\n\t\t\t\tsubtitle: '',\n\t\t\t\tautocompleteState: {},\n\t\t\t\tformData: {},\n\t\t\t\taddressData: {}\n\t\t\t};\n\t\t\tlet extraData = BX.prop.getObject(settings, 'newRequisiteExtraFields', {});\n\t\t\tthis._data = {...this._data, ...extraData};\n\t\t}\n\t\tthis._data.initialAddressDdta = null;\n\t\tthis.prepareViewData(this._data);\n\t}\n\n\tprepareViewData()\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis._data.value = this._data.requisiteData ? JSON.parse(this._data.requisiteData) : {};\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis._data.value = {};\n\t\t}\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.viewData))\n\t\t{\n\t\t\tthis._data.title = this._data.value.viewData.title;\n\t\t\tthis._data.subtitle = this._data.value.viewData.subtitle;\n\t\t}\n\n\t\tif (this.getRequisiteIdAsString().match(RequisiteListItem.newRequisitePattern)) // was new requisite\n\t\t{\n\t\t\tlet newRequisiteId = BX.prop.getNumber(this.getFields(), 'ID', 0);\n\t\t\tif (newRequisiteId > 0) // if new requisite was saved\n\t\t\t{\n\t\t\t\tthis.setRequisiteId(newRequisiteId);\n\t\t\t}\n\t\t}\n\t\tthis.setAddressOnly(BX.prop.getString(this.getFields(), 'ADDRESS_ONLY', 'N') === 'Y');\n\n\t\tthis._data.bankDetails = [];\n\t\tif (Type.isPlainObject(this._data.value) && Type.isArray(this._data.value.bankDetailViewDataList))\n\t\t{\n\t\t\tthis._data.bankDetails = this.prepareBankDetailsList(this._data.value.bankDetailViewDataList);\n\t\t}\n\n\t\tthis._data.addressList = {...BX.prop.getObject(this.getFields(), 'RQ_ADDR', {})};\n\t}\n\n\tprepareBankDetailsList(bankDetails)\n\t{\n\t\tlet result = [];\n\t\tfor (let bankDetailsItem of bankDetails)\n\t\t{\n\t\t\tif (bankDetailsItem.deleted)\n\t\t\t{\n\t\t\t\tcontinue; // Deleted items should not be shown\n\t\t\t}\n\t\t\tif (Type.isPlainObject(bankDetailsItem.viewData))\n\t\t\t{\n\t\t\t\tlet item = {\n\t\t\t\t\t'title': bankDetailsItem.viewData.title,\n\t\t\t\t\t'id': bankDetailsItem.pseudoId,\n\t\t\t\t\t'value': '',\n\t\t\t\t\t'selected': !!bankDetailsItem.selected\n\t\t\t\t};\n\t\t\t\tif (Type.isArray(bankDetailsItem.viewData.fields) && bankDetailsItem.viewData.fields.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = bankDetailsItem.viewData.fields\n\t\t\t\t\t\t.filter((item) => Type.isStringFilled(item.textValue))\n\t\t\t\t\t\t.map((item) => item.title + ': ' + item.textValue)\n\t\t\t\t\t\t.join(', ');\n\t\t\t\t}\n\t\t\t\tif (!item.value.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = item.title;\n\t\t\t\t}\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tisSelected()\n\t{\n\t\tif (!this._data.hasOwnProperty('justSelected'))\n\t\t{\n\t\t\treturn BX.prop.getBoolean(this._data, 'selected', false);\n\t\t}\n\t\treturn BX.prop.getBoolean(this._data, 'justSelected', false);\n\t}\n\n\tisChanged()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isChanged', false);\n\t}\n\n\tsetChanged(changed)\n\t{\n\t\tthis._data.isChanged = !!changed;\n\t}\n\n\tisNew()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isNew', false);\n\t}\n\n\tsetNew(isNew)\n\t{\n\t\tthis._data.isNew = !!isNew;\n\t}\n\n\tgetSelectedBankDetailId()\n\t{\n\t\tlet selectedBankDetailId = BX.prop.getInteger(this._data, 'selectedBankDetailId', -1);\n\t\tif (selectedBankDetailId !== -1)\n\t\t{\n\t\t\treturn selectedBankDetailId;\n\t\t}\n\t\tselectedBankDetailId = this.getBankDetails().reduce(\n\t\t\t(selected, item, index) =>\n\t\t\t{\n\t\t\t\treturn item.selected ? index : selected\n\t\t\t}, -1);\n\t\tthis._data.selectedBankDetailId = selectedBankDetailId;\n\n\t\treturn selectedBankDetailId > -1 ? selectedBankDetailId : 0;\n\t}\n\n\tgetBankDetailById(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (bankDetailId >= 0 && bankDetailId < list.length)\n\t\t{\n\t\t\treturn list[bankDetailId];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetBankDetailByBankDetailId(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn list\n\t\t\t.filter((item) => item.id == bankDetailId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'title', \"\");\n\t}\n\n\tgetSubtitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'subtitle', \"\");\n\t}\n\n\tgetPresetId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetId', \"0\");\n\t}\n\n\tgetPresetCountryId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetCountryId', \"0\");\n\t}\n\n\tgetBankDetails()\n\t{\n\t\treturn BX.prop.getArray(this._data, 'bankDetails', []);\n\t}\n\n\tgetRequisiteId()\n\t{\n\t\treturn this._data.requisiteId;\n\t}\n\n\tgetRequisiteIdAsString()\n\t{\n\t\tlet requisiteId = this.getRequisiteId();\n\t\trequisiteId = Type.isNumber(requisiteId) ? String(requisiteId) : requisiteId;\n\t\treturn Type.isStringFilled(requisiteId) ? requisiteId : '';\n\t}\n\n\tgetRequisiteData()\n\t{\n\t\treturn this._data.requisiteData;\n\t}\n\n\tgetRequisiteDataSign()\n\t{\n\t\treturn this._data.requisiteDataSign;\n\t}\n\n\tgetFields()\n\t{\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.fields))\n\t\t{\n\t\t\treturn {...this._data.value.fields};\n\t\t}\n\t\treturn {};\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\tlet result = null;\n\n\t\tlet autocompleteState = this.getAutocompleteState();\n\t\tlet selectedAutocompleteItem = BX.prop.getObject(autocompleteState, 'currentItem', null);\n\t\tif (Type.isPlainObject(selectedAutocompleteItem))\n\t\t{\n\t\t\tresult = {\n\t\t\t\ttitle: BX.prop.getString(selectedAutocompleteItem, 'title', ''),\n\t\t\t\tsubTitle: BX.prop.getString(selectedAutocompleteItem, 'subTitle', '')\n\t\t\t}\n\t\t}\n\t\telse if (!Type.isUndefined(this._data.value.viewData)  && Type.isArray(this._data.value.viewData.fields))\n\t\t{\n\t\t\tlet fields =  this._data.value.viewData.fields;\n\t\t\tresult = {\n\t\t\t\ttitle: Type.isStringFilled(this._data.title) ? this._data.title : '',\n\t\t\t\tsubTitle: fields\n\t\t\t\t\t.filter((item) => item.name === 'RQ_INN' && item.textValue.length)\n\t\t\t\t\t.map((item) => item.title + ' ' + item.textValue)\n\t\t\t\t\t.join('')\n\t\t\t};\n\t\t}\n\t\treturn result;\n\t}\n\n\tsetAutocompleteState(state)\n\t{\n\t\tthis._data.autocompleteState = Type.isPlainObject(state) ? state : {};\n\t}\n\n\tgetAutocompleteState()\n\t{\n\t\treturn this._data.autocompleteState;\n\t}\n\n\tgetAddressList()\n\t{\n\t\treturn this._data.addressList;\n\t}\n\n\tsetAddressList(addressList)\n\t{\n\t\tthis._data.addressList = addressList;\n\t}\n\n\tsetInitialAddressData(addressData)\n\t{\n\t\tthis._data.initialAddressDdta = addressData;\n\t}\n\n\tgetAddressesForSave()\n\t{\n\t\tlet oldAddressTypes = Type.isPlainObject(this._data.initialAddressDdta) ?\n\t\t\tObject.keys(this._data.initialAddressDdta) : [];\n\n\t\tlet addresses = {};\n\t\tfor (let type of oldAddressTypes)\n\t\t{\n\t\t\taddresses[type] = \"\";\n\t\t}\n\t\tlet addressData = this.getAddressData();\n\t\tfor (let type in addressData)\n\t\t{\n\t\t\tif (addressData.hasOwnProperty(type) && addressData[type].length)\n\t\t\t{\n\t\t\t\taddresses[type] = addressData[type];\n\t\t\t}\n\t\t}\n\t\tfor (let type in addresses)\n\t\t{\n\t\t\tif (Type.isString(addresses[type]) && addresses[type] === \"\")\n\t\t\t{\n\t\t\t\taddresses[type] = {DELETED: 'Y'};\n\t\t\t}\n\t\t}\n\n\t\treturn addresses;\n\t}\n\n\tsetRequisiteId(requisiteId)\n\t{\n\t\tthis._data.requisiteId = requisiteId;\n\t}\n\n\tsetPresetId(presetId)\n\t{\n\t\tthis._data.presetId = presetId;\n\t}\n\n\tsetPresetCountryId(presetCountryId)\n\t{\n\t\tthis._data.presetCountryId = presetCountryId;\n\t}\n\n\tsetSelected(selected)\n\t{\n\t\tthis._data.selected = !!selected;\n\t\tthis._data.justSelected = !!selected;\n\t}\n\n\tsetRequisiteData(requisiteData, requisiteDataSign)\n\t{\n\t\tthis._data.requisiteData = requisiteData;\n\t\tif (Type.isStringFilled(requisiteDataSign))\n\t\t{\n\t\t\tthis._data.requisiteDataSign = requisiteDataSign;\n\t\t}\n\t\tthis.prepareViewData();\n\t}\n\n\tsetDeleted(isDeleted)\n\t{\n\t\tthis._data.isDeleted = !!isDeleted;\n\t}\n\n\tisDeleted()\n\t{\n\t\treturn this._data.isDeleted;\n\t}\n\n\tsetAddressOnly(isAddressOnly)\n\t{\n\t\tthis._data.isAddressOnly = !!isAddressOnly;\n\t\tthis.setFormData({...this.getFormData(), 'ADDRESS_ONLY': isAddressOnly ? 'Y':'N'})\n\t}\n\n\tisAddressOnly()\n\t{\n\t\treturn this._data.isAddressOnly;\n\t}\n\n\tisEmptyFormData()\n\t{\n\t\treturn Object.keys(this._data.formData).length <= 0;\n\t}\n\n\tgetFormData()\n\t{\n\t\treturn this._data.formData;\n\t}\n\n\tsetFormData(formData)\n\t{\n\t\tthis._data.formData = formData;\n\t}\n\n\tclearFormData()\n\t{\n\t\tthis.setFormData({});\n\t}\n\n\tisEmptyAddressData()\n\t{\n\t\treturn Object.keys(this._data.addressData).length <= 0;\n\t}\n\n\tgetAddressData()\n\t{\n\t\treturn this._data.addressData;\n\t}\n\n\tsetAddressData(addressData)\n\t{\n\t\tthis._data.addressData = addressData;\n\t}\n\n\tclearAddressData()\n\t{\n\t\tthis.setAddressData({});\n\t}\n\tsetSelectedBankDetails(bankDetailsId)\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isNull(bankDetailsId))\n\t\t{\n\t\t\tbankDetailsId = 0; // first item by default\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = (index === bankDetailsId);\n\t\t}\n\n\t\tthis._data.selectedBankDetailId = bankDetailsId;\n\t}\n\n\tclearSelectedBankDetails()\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = false;\n\t\t}\n\t}\n\n\texportToModel()\n\t{\n\t\tlet exportedItem = {...this._data};\n\t\tdelete (exportedItem.value);\n\t\tdelete (exportedItem.addressList);\n\t\tdelete (exportedItem.bankDetails);\n\t\tdelete (exportedItem.initialAddressDdta);\n\t\tdelete (exportedItem.isAddressOnly);\n\t\treturn exportedItem;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteListItem();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nRequisiteListItem.newRequisitePattern = /n([0-9]+)/;","import {RequisiteListItem} from \"./requisite-list\";\nimport {EventEmitter} from \"main.core.events\";\nimport {Loc, Type} from \"main.core\";\nimport {MessageBox} from \"ui.dialogs.messagebox\";\n\nexport class EntityEditorRequisiteEditor\n{\n\tconstructor()\n\t{\n\t\tthis._requisiteList = null;\n\t\tthis._entityTypeId = null;\n\t\tthis._entityId = null;\n\t\tthis._entityCategoryId = null;\n\t\tthis._permissionToken = null;\n\t\tthis._contextId = null;\n\t\tthis._mode = BX.UI.EntityEditorMode.view;\n\n\t\tthis.currentSliderRequisiste = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._entityTypeId = BX.prop.getInteger(settings, 'entityTypeId', 0);\n\t\tthis._entityId = BX.prop.getInteger(settings, 'entityId', 0);\n\t\tthis._entityCategoryId = BX.prop.getInteger(settings, 'entityCategoryId', null);\n\t\tthis._contextId = BX.prop.getString(settings, 'contextId', \"\");\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, 'requisiteEditUrl', \"\");\n\t\tthis._permissionToken = BX.prop.getString(settings, 'permissionToken', null);\n\n\t\tthis._onExternalEventListener = this.onExternalEvent.bind(this);\n\t\tEventEmitter.subscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tsetRequisiteList(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t}\n\n\tsetMode(mode)\n\t{\n\t\tthis._mode = mode;\n\t}\n\n\topen(requisite, options = {})\n\t{\n\t\tif (!(requisite instanceof RequisiteListItem))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentSliderRequisiste = requisite;\n\n\t\tlet sliderOptions = {\n\t\t\twidth: 950,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: this.prepareSliderRequestParams(requisite, options)\n\t\t};\n\t\tBX.Crm.Page.openSlider(this.getSliderUrl(requisite), sliderOptions);\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tlet requisite = this._requisiteList.getById(id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet postData = {...this.prepareSliderRequestParams(requisite)};\n\t\t\tpostData.sessid = BX.bitrix_sessid();\n\t\t\tpostData.mode = 'delete';\n\t\t\tpostData.ACTION = 'SAVE';\n\n\t\t\tBX.ajax.post(this.getSliderUrl(requisite), postData, (data) =>\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet json = JSON.parse(data);\n\t\t\t\t\tif (Type.isStringFilled(json.ERROR))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(json.ERROR);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\t\t\t\t\tlet selectedRemoved = (selectedRequisite === requisite);\n\t\t\t\t\t\tthis._requisiteList.remove(requisite);\n\n\t\t\t\t\t\tEventEmitter.emit(this, 'onAfterDeleteRequisite', {selectedRemoved});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tgetSliderUrl(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\n\t\tlet urlParams =\n\t\t\t{\n\t\t\t\tetype: this._entityTypeId,\n\t\t\t\teid: this._entityId,\n\t\t\t\texternal_context_id: this._contextId\n\t\t\t};\n\n\t\tlet presetId = requisite.getPresetId();\n\t\tif (presetId > 0)\n\t\t{\n\t\t\turlParams[\"pid\"] = presetId;\n\t\t}\n\t\tif (!Type.isNull(this._entityCategoryId))\n\t\t{\n\t\t\turlParams.cid = this._entityCategoryId;\n\t\t}\n\n\t\treturn BX.util.add_url_param(\n\t\t\tthis.getRequisiteEditUrl(requisiteId),\n\t\t\turlParams\n\t\t);\n\t}\n\n\tprepareSliderRequestParams(requisite, options = {})\n\t{\n\t\tlet requestParams = {};\n\t\tlet requisiteData = requisite.getRequisiteData();\n\t\tif (requisite.isChanged() && Type.isString(requisiteData) && requisiteData.length)\n\t\t{\n\t\t\trequestParams['externalData'] = {\n\t\t\t\t'data': requisiteData,\n\t\t\t\t'sign': requisite.getRequisiteDataSign()\n\t\t\t};\n\t\t}\n\t\tif (requisite.isSelected())\n\t\t{\n\t\t\tlet autocompleteState = requisite.getAutocompleteState();\n\t\t\tif (Object.keys(autocompleteState).length)\n\t\t\t{\n\t\t\t\trequestParams['AUTOCOMPLETE'] = JSON.stringify(autocompleteState);\n\t\t\t\trequestParams['useFormData'] = 'Y';\n\t\t\t}\n\t\t}\n\t\tif (!requisite.isEmptyFormData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...requisite.getFormData()};\n\t\t}\n\t\tif (!requisite.isEmptyAddressData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...{RQ_ADDR: requisite.getAddressesForSave()}};\n\t\t}\n\t\trequestParams['mode'] = requisite.isNew() ? 'create' : 'edit';\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\trequestParams['doSave'] = 'Y';\n\t\t}\n\t\tif (BX.prop.getBoolean(options, 'addBankDetailsItem', false))\n\t\t{\n\t\t\trequestParams['addBankDetailsItem'] = 'Y';\n\t\t}\n\t\tlet overriddenPresetId = BX.prop.getInteger(options, 'overriddenPresetId', 0);\n\t\tif (overriddenPresetId > 0)\n\t\t{\n\t\t\trequestParams['PRESET_ID'] = overriddenPresetId;\n\t\t\trequestParams['useFormData'] = 'Y';\n\t\t}\n\t\tif (!Type.isNull(this._permissionToken))\n\t\t{\n\t\t\trequestParams['permissionToken'] = this._permissionToken;\n\t\t}\n\n\t\treturn requestParams;\n\t}\n\n\tgetRequisiteEditUrl(requisiteId)\n\t{\n\t\treturn this._requisiteEditUrl.replace(/#requisite_id#/gi, requisiteId);\n\t}\n\n\tgetSignRequisitePromise(requisite)\n\t{\n\t\tlet postData = this.prepareSliderRequestParams(requisite);\n\t\tpostData.sessid = BX.bitrix_sessid();\n\t\tpostData.PRESET_ID = requisite.getPresetId();\n\t\tpostData.useFormData = 'Y';\n\t\tpostData.ACTION = 'SAVE';\n\n\t\treturn BX.ajax.promise({\n\t\t\tmethod: 'post',\n\t\t\tdataType: 'json',\n\t\t\turl: this.getSliderUrl(requisite),\n\t\t\tdata: postData\n\t\t});\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._mode === BX.UI.EntityEditorMode.view;\n\t}\n\n\trelease()\n\t{\n\t\tEventEmitter.unsubscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tonExternalEvent(event)\n\t{\n\t\tlet dataArray = event.getData();\n\t\tif (!Type.isArray(dataArray))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet data = dataArray[0];\n\n\t\tlet eventName = BX.prop.getString(data, \"key\", \"\");\n\n\t\tif (eventName !== \"BX.Crm.RequisiteSliderDetails:onCancelEdit\" && eventName !== \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet value = BX.prop.getObject(data, \"value\", {});\n\n\t\tlet contextId = BX.prop.getString(value, \"contextId\", \"\");\n\t\tif (contextId !== this._contextId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onCancelEdit\")\n\t\t{\n\t\t\tthis.currentSliderRequisiste = null;\n\t\t}\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\tlet requisite = this.currentSliderRequisiste;\n\t\t\tif (Type.isObject(requisite))\n\t\t\t{\n\t\t\t\tif (Type.isString(value.requisiteData))\n\t\t\t\t{\n\t\t\t\t\trequisite.setRequisiteData(value.requisiteData, value.requisiteDataSign);\n\t\t\t\t\trequisite.setAutocompleteState({});\n\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(value.presetId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetId(value.presetId);\n\t\t\t\t}\n\t\t\t\tif (Type.isString(value.presetCountryId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetCountryId(value.presetCountryId);\n\t\t\t\t}\n\t\t\t\tif (this.isViewMode())\n\t\t\t\t{\n\t\t\t\t\trequisite.setNew(false);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\trequisite.setChanged(true);\n\t\t\t\t}\n\t\t\t\trequisite.setDeleted(false);\n\n\t\t\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.notifyListChanged();\n\t\t\t\t}\n\n\t\t\t\tthis.currentSliderRequisiste = null;\n\n\t\t\t\tEventEmitter.emit(this, 'onAfterEditRequisite');\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteEditor();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n}","import {Dom, Loc, Tag, Type} from \"main.core\"\nimport {EventEmitter} from \"main.core.events\"\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\"\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nexport class EntityEditorRequisiteController extends BX.Crm.EntityEditorController\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._requisiteFieldId = null;\n\t\tthis._requisiteField = null;\n\t\tthis._requisiteInitData = null;\n\n\t\tthis._addressFieldId = null;\n\t\tthis._addressField = null;\n\t\tthis._isLoading = false;\n\n\t\tthis._formInputsWrapper = null;\n\t\tthis._enableRequisiteSelection = false;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._requisiteFieldId = this.getConfigStringParam(\"requisiteFieldId\", \"\");\n\t\tthis._addressFieldId = this.getConfigStringParam(\"addressFieldId\", \"\");\n\n\t\tthis.saveRequisiteInitData();\n\n\t\tEventEmitter.subscribe(this._editor, 'onFieldInit', this.onFieldInit.bind(this));\n\n\t\tthis.initRequisiteEditor();\n\t\tthis.initRequisiteList();\n\n\t\tlet selectedItem = BX.prop.getObject(this.getConfig(), \"requisiteBinding\", {});\n\t\tif (!Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t{\n\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\tif (requisite)\n\t\t\t{\n\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis._enableRequisiteSelection = BX.prop.getString(this._config, 'enableRequisiteSelection', false);\n\t}\n\n\tinitRequisiteList()\n\t{\n\t\tthis._requisiteList = RequisiteList.create(this._requisiteInitData);\n\t\tthis._requisiteList.subscribe(this._requisiteList.CHANGE_EVENT, this.onChangeRequisites.bind(this));\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t}\n\n\tinitRequisiteEditor()\n\t{\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\tentityId: this._editor.getEntityId(),\n\t\t\tcontextId: this._editor.getContextId(),\n\t\t\trequisiteEditUrl: this._editor.getRequisiteEditUrl('#requisite_id#'),\n\t\t\tpermissionToken: this.getConfigStringParam('permissionToken', null),\n\t\t\tentityCategoryId: BX.prop.getString(this.getConfig(), 'entityCategoryId', 0)\n\t\t});\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\t}\n\n\tinitRequisiteField()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.setRequisites(this._requisiteList);\n\n\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t}\n\t}\n\n\tinitAddressField()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tlet countryId = 0;\n\t\t\tlet addressList = {};\n\t\t\tlet selectedRequisite = this._requisiteList ? this._requisiteList.getSelected() : null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tcountryId = selectedRequisite.getPresetCountryId();\n\t\t\t\tlet requisiteAddressList = selectedRequisite.getAddressList();\n\t\t\t\tfor (let type in requisiteAddressList)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\trequisiteAddressList.hasOwnProperty(type) &&\n\t\t\t\t\t\tBX.prop.getString(requisiteAddressList[type], 'DELETED', 'N') !== 'Y'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\taddressList[type] = requisiteAddressList[type];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._addressField.setCountryId(countryId);\n\t\t\tthis._addressField.setAddressList(addressList);\n\t\t}\n\t}\n\n\tsetSelectModeEnabled(enableRequisiteSelection: boolean): void\n\t{\n\t\tif (this._enableRequisiteSelection !== enableRequisiteSelection)\n\t\t{\n\t\t\tthis._enableRequisiteSelection = enableRequisiteSelection;\n\t\t\tif (this._requisiteField)\n\t\t\t{\n\t\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t\t}\n\t\t}\n\t}\n\n\tsaveRequisiteInitData()\n\t{\n\t\tthis._requisiteInitData = this.getRequisiteFieldValue();\n\t}\n\n\tvalidate(result)\n\t{\n\t\tlet promises = [];\n\t\tfor (let requisite of this._requisiteList.getList())\n\t\t{\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (requisite.isEmptyFormData() && requisite.isEmptyAddressData())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet signPromise = this.signRequisiteFields(requisite);\n\t\t\tsignPromise.then(\n\t\t\t\t(data) =>\n\t\t\t\t{\n\t\t\t\t\tlet error = BX.prop.getString(data, 'ERROR', '');\n\t\t\t\t\tlet entityDataObj = BX.prop.getObject(data, 'ENTITY_DATA', {});\n\t\t\t\t\tlet entityData = BX.prop.getString(entityDataObj, 'REQUISITE_DATA', \"\");\n\t\t\t\t\tlet entityDataSign = BX.prop.getString(entityDataObj, 'REQUISITE_DATA_SIGN', \"\");\n\t\t\t\t\tif (Type.isStringFilled(error))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(error);\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isStringFilled(entityData) && Type.isStringFilled(entityDataSign))\n\t\t\t\t\t{\n\t\t\t\t\t\trequisite.setRequisiteData(entityData, entityDataSign);\n\t\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tpromises.push(signPromise);\n\t\t}\n\n\t\treturn (promises.length > 0) ? Promise.all(promises) : null;\n\t}\n\n\tsetSelectedRequisite(requisiteId, bankDetailId)\n\t{\n\t\tlet entityId = this._editor.getEntityId();\n\t\tif (!entityId)\n\t\t{\n\t\t\t// impossible situation, but...\n\t\t\treturn;\n\t\t}\n\t\tlet newSelectedRequisite = this._requisiteList.getById(requisiteId);\n\t\tif (!newSelectedRequisite || newSelectedRequisite.isNew())\n\t\t{\n\t\t\t// impossible situation too\n\t\t\treturn;\n\t\t}\n\t\tthis._requisiteList.setSelected(requisiteId, bankDetailId);\n\n\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\n\t\tthis.startLoading();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.settings.setSelectedEntityRequisite',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\t\t\tentityId: entityId,\n\t\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t}, () =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t});\n\n\t}\n\n\topenEditor(requisite, options = {})\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\tthis._requisiteEditor.open(requisite, options);\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._editor.getMode() === BX.Crm.EntityEditorMode.view;\n\t}\n\n\tsetRequisiteInitAddrData(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\t\tlet rawRequisite = this._requisiteInitData\n\t\t\t.filter((item) => item.requisiteId === requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\n\t\tif (Type.isPlainObject(rawRequisite))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet requisiteData = JSON.parse(rawRequisite.requisiteData);\n\t\t\t\tlet requisiteFields = BX.prop.getObject(requisiteData, 'fields', {});\n\t\t\t\tlet addressData = BX.prop.getObject(requisiteFields, 'RQ_ADDR', null);\n\t\t\t\trequisite.setInitialAddressData(addressData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\trequisite.setInitAddrData(null);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFirstEditModeField()\n\t{\n\t\tif (this._requisiteField && this._requisiteField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._requisiteField;\n\t\t}\n\t\tif (this._addressField && this._addressField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._addressField;\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdateRequisiteFieldModel()\n\t{\n\t\tlet modelValue = this._requisiteList.exportToModel();\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._model.setField(this._requisiteFieldId, modelValue);\n\t\t}\n\t\tthis.saveRequisiteInitData([...modelValue]);\n\t}\n\n\tgetRequisiteFieldValue()\n\t{\n\t\tif (!this._requisiteFieldId)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn this._model.getField(this._requisiteFieldId, []);\n\t}\n\n\taddEditorFormInputs()\n\t{\n\t\tthis._formInputsWrapper = Tag.render`<div></div>`;\n\t\tDom.append(this._formInputsWrapper, this._editor.getFormElement());\n\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DELETED]\" value=\"Y\" >`, this._formInputsWrapper);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet dataInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DATA]\" value=\"${Tag.safe`${requisite.getRequisiteData()}`}\" >`;\n\t\t\tlet signInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][SIGN]\" value=\"${requisite.getRequisiteDataSign()}\" >`;\n\t\t\tDom.append(dataInput, this._formInputsWrapper);\n\t\t\tDom.append(signInput, this._formInputsWrapper);\n\t\t}\n\t}\n\n\tremoveEditorFormInputs()\n\t{\n\t\tif (Type.isDomNode(this._formInputsWrapper))\n\t\t{\n\t\t\tDom.remove(this._formInputsWrapper);\n\t\t\tthis._formInputsWrapper = null;\n\t\t}\n\t}\n\n\tmarkFieldsAsChanged()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.markAsChanged();\n\t\t}\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.markAsChanged();\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tisLoading()\n\t{\n\t\treturn !!this._isLoading;\n\t}\n\n\tstartLoading()\n\t{\n\t\tthis._isLoading = true;\n\t}\n\n\tstopLoading()\n\t{\n\t\tthis._isLoading = false;\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tprepareRequisiteByEventData(eventData)\n\t{\n\t\tlet requisite = this._requisiteList.getById(eventData.id);\n\t\tif (!requisite)\n\t\t{\n\t\t\tconst extraFields = {\n\t\t\t\tselected: this._requisiteList.isEmpty(),\n\t\t\t\tpresetId: eventData.defaultPresetId,\n\t\t\t};\n\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\textraFields.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\textraFields.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\textraFields.autocompleteState = eventData.autocompleteState;\n\t\t\t}\n\n\t\t\trequisite = RequisiteListItem.create(null, {\n\t\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t\t'newRequisiteExtraFields': extraFields,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(eventData.autocompleteState);\n\t\t\t}\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn requisite;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\treturn this._requisiteField.getDefaultPresetId();\n\t\t}\n\t\telse // if requisiteField is hidden\n\t\t{\n\t\t\tlet schemeElement = this._editor.getScheme().getAvailableElements()\n\t\t\t\t.filter((item) => (item.getName() === this._requisiteFieldId))\n\t\t\t\t.reduce((prev, current) => current, null);\n\n\t\t\tif (!schemeElement)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor (let preset of BX.prop.getArray(schemeElement.getData(), \"presets\", []))\n\t\t\t{\n\t\t\t\tif (preset.IS_DEFAULT)\n\t\t\t\t{\n\t\t\t\t\treturn preset.VALUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsignRequisiteFields(requisite)\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\treturn this._requisiteEditor.getSignRequisitePromise(requisite);\n\t}\n\n\trelease()\n\t{\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tonFieldInit(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet field = eventData.field;\n\t\tif (field)\n\t\t{\n\t\t\tlet fieldId = field.getId();\n\t\t\tif (Type.isStringFilled(this._requisiteFieldId) && fieldId === this._requisiteFieldId)\n\t\t\t{\n\t\t\t\tthis._requisiteField = field;\n\t\t\t\tthis.initRequisiteField();\n\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditNew', this.onEditNewRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditExisted', this.onEditExistedRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onFinishAutocomplete', this.onFinishRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onClearAutocomplete', this.onClearRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onSetDefault', this.onSetDefaultRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onDelete', this.onDeleteRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onHide', this.onHideRequisite.bind(this));\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(this._addressFieldId) && fieldId === this._addressFieldId)\n\t\t\t{\n\t\t\t\tthis._addressField = field;\n\t\t\t\tthis.initAddressField();\n\n\t\t\t\tEventEmitter.subscribe(this._addressField, 'onAddressListUpdate', this.onAddressListUpdate.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis.openEditor(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet options = BX.prop.getObject(params, 'options', {});\n\t\t\tif (Type.isPlainObject(options.autocompleteState))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(options.autocompleteState);\n\t\t\t}\n\t\t\tlet editorOptions = {};\n\t\t\tif (Type.isPlainObject(options.editorOptions))\n\t\t\t{\n\t\t\t\teditorOptions = options.editorOptions;\n\t\t\t}\n\t\t\tthis.openEditor(requisite, editorOptions);\n\t\t}\n\t}\n\n\tonClearRequisiteAutocomplete(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\trequisite.clearFormData();\n\t\t}\n\t}\n\n\tonFinishRequisiteAutocomplete(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst requisite = this.prepareRequisiteByEventData(eventData);\n\t\tconst formData = BX.prop.getObject(BX.prop.getObject(eventData, 'data', {}), 'fields', {});\n\t\tif (formData.hasOwnProperty('RQ_ADDR'))\n\t\t{\n\t\t\tif (Type.isPlainObject(formData.RQ_ADDR))\n\t\t\t{\n\t\t\t\tlet oldAddr = requisite.getAddressList();\n\t\t\t\toldAddr = Type.isPlainObject(oldAddr) ? oldAddr : {};\n\n\t\t\t\tconst addr = {...oldAddr, ...formData.RQ_ADDR};\n\t\t\t\trequisite.setAddressData(addr);\n\t\t\t\trequisite.setAddressList(addr);\n\t\t\t}\n\t\t\tdelete (formData.RQ_ADDR);\n\t\t}\n\t\trequisite.setFormData(formData);\n\t\trequisite.setChanged(true);\n\t\trequisite.setDeleted(false);\n\t\tconst presetId = BX.prop.getInteger(formData, 'PRESET_ID', 0);\n\t\tif (presetId > 0)\n\t\t{\n\t\t\trequisite.setPresetId(presetId);\n\t\t}\n\t\tconst presetCountryId = BX.prop.getInteger(formData, 'PRESET_COUNTRY_ID', 0);\n\t\tif (presetCountryId > 0)\n\t\t{\n\t\t\trequisite.setPresetCountryId(presetCountryId);\n\t\t}\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tthis._requisiteList.add(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t\tif (requisite.isAddressOnly())\n\t\t{\n\t\t\tthis._requisiteList.unhide(requisite);\n\t\t}\n\t}\n\n\tonSetDefaultRequisite(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst id = eventData.id;\n\t\tconst bankDetailId = eventData.bankDetailId;\n\n\t\tif (this._addressField && this._addressField.isChanged())\n\t\t{\n\t\t\tthis._editor.cancel();\n\t\t\treturn false; // have to save address first\n\t\t}\n\n\t\tthis.setSelectedRequisite(id, bankDetailId);\n\t\tthis.updateRequisiteFieldModel();\n\n\t\treturn true;\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis.setRequisiteInitAddrData(requisite);\n\t\t}\n\t\tif (params.postponed)\n\t\t{\n\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\t\tthis._requisiteEditor.deleteRequisite(params.id);\n\t\t}\n\t}\n\n\tonHideRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteList.hide(requisite);\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tthis.initAddressField();\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\teventData.id = this._requisiteList.getSelectedId();\n\n\t\teventData.defaultPresetId = this.getDefaultPresetId();\n\n\t\tlet requisite = this.prepareRequisiteByEventData(eventData);\n\n\t\tlet addresses = {};\n\t\tlet isEmptyAddress = true;\n\t\tfor (let address of eventData.value)\n\t\t{\n\t\t\taddresses[address.type] = address.value;\n\t\t\tif (Type.isStringFilled(address.value))\n\t\t\t{\n\t\t\t\tisEmptyAddress = false;\n\t\t\t}\n\t\t}\n\n\t\trequisite.setAddressData(addresses);\n\t\trequisite.setAddressList(addresses);\n\n\t\trequisite.setChanged(true);\n\t\tif (!isEmptyAddress)\n\t\t{\n\t\t\trequisite.setDeleted(false);\n\t\t}\n\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tif (!isEmptyAddress)\n\t\t\t{\n\t\t\t\trequisite.setAddressOnly(true);\n\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//  remove requisite if address is empty and requisite contain only address\n\t\t\tif (isEmptyAddress && requisite.isAddressOnly())\n\t\t\t{\n\t\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t\t}\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tsuper.onBeforeSubmit();\n\t\tthis.addEditorFormInputs();\n\t}\n\n\tonBeforesSaveControl(data)\n\t{\n\t\tif (!data.hasOwnProperty('REQUISITES'))\n\t\t{\n\t\t\tdata['REQUISITES'] = {};\n\t\t}\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (!requisite.isChanged() && !requisite.isDeleted())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet requisiteData = {};\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\trequisiteData['DELETED'] = 'Y';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trequisiteData['DATA'] = requisite.getRequisiteData();\n\t\t\t\trequisiteData['SIGN'] = requisite.getRequisiteDataSign();\n\t\t\t}\n\t\t\tdata['REQUISITES'][requisite.getRequisiteId()] = requisiteData;\n\t\t}\n\n\t\tif (this._enableRequisiteSelection)\n\t\t{\n\t\t\tconst selectedRequisite = this._requisiteList.getSelected();\n\t\t\tlet selectedRequisiteId = null;\n\t\t\tlet selectedBankDetailId = null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tselectedRequisiteId = selectedRequisite.getRequisiteId();\n\t\t\t\tconst selectedBankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\t\tselectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\t\t\t}\n\n\t\t\tdata['REQUISITES']['BINDING'] = {\n\t\t\t\trequisiteId: selectedRequisiteId,\n\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t};\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tonAfterSave()\n\t{\n\t\tsuper.onAfterSave();\n\t\tthis.saveRequisiteInitData(this.getRequisiteFieldValue());\n\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\n\t\tthis.removeEditorFormInputs();\n\t}\n\n\tonRequisiteEditorAfterEdit()\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tthis.updateRequisiteFieldModel();\n\t\t}\n\t\tthis.markFieldsAsChanged();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet isEmptyRequisitesList = this._requisiteList.isEmpty();\n\t\tif (!isEmptyRequisitesList && data.selectedRemoved)\n\t\t{\n\t\t\t// set new default requisite\n\t\t\tthis.setSelectedRequisite(0, 0);\n\t\t}\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteController();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {MenuManager} from \"main.popup\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Loc, Text} from \"main.core\";\n\nexport class PresetMenu extends EventEmitter\n{\n\tconstructor(id, presetList)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.RequisitePresetMenu');\n\t\tthis._isShown = false;\n\t\tthis.menuId = id;\n\t\tthis.presetList = presetList;\n\t}\n\n\ttoggle(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse if (bindElement)\n\t\t{\n\t\t\tthis.show(bindElement);\n\t\t}\n\t}\n\n\tshow(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.presetList || !this.presetList.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('REQUISITE_LIST_EMPTY_PRESET_LIST'), Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t\t\treturn;\n\t\t}\n\t\tlet menu = [];\n\t\tfor (let item of this.presetList)\n\t\t{\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Text.encode(item.name),\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\tonclick: this.onSelect.bind(this, item)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.menuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = MenuManager.getMenuById(this.menuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.popupWindow.close();\n\t\t}\n\t}\n\n\tisShown()\n\t{\n\t\treturn this._isShown;\n\t}\n\n\tonSelect(item)\n\t{\n\t\tthis.close();\n\t\tthis.emit('onSelect', item);\n\t}\n}","import {PopupManager} from \"main.popup\";\nimport {Tag, Type, Loc, Text} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {PresetMenu} from \"./preset-menu\";\nimport {Loader} from \"main.loader\";\n\nexport class EntityEditorRequisiteTooltip\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tthis._padding = BX.prop.getInteger(this._settings, 'padding', 20);\n\t\tthis._showTimer = false;\n\t\tthis._closeTimer = false;\n\t\tthis._closeTimeout = BX.prop.getInteger(this._settings, 'closeTimeout', 700);\n\t\tthis._showTimeout = BX.prop.getInteger(this._settings, 'showTimeout', 500);\n\t\tthis._popupId = this._id + '_popup';\n\n\t\tthis._isReadonly = BX.prop.getBoolean(this._settings, 'readonly', true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(this._settings, 'canChangeDefaultRequisite', true);\n\n\t\tthis._bindElement = null;\n\t\tthis._wrapper = null;\n\t\tthis._requisiteList = null;\n\n\t\tthis._isLoading = false;\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\n\t\tthis.presetMenu = new PresetMenu(this._id + '_preset_menu', BX.prop.getArray(this._settings, 'presets', []));\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisite.bind(this));\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteTooltip();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis.refreshLayout();\n\t}\n\n\tsetBindElement(bindElement, wrapper)\n\t{\n\t\tthis._bindElement = bindElement;\n\t\tif (!Type.isDomNode(wrapper))\n\t\t{\n\t\t\twrapper = this._bindElement.parentNode ? this._bindElement.parentNode : null;\n\t\t}\n\t\tthis._wrapper = wrapper;\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tthis._isLoading = !!isLoading;\n\t\tthis.refreshLayout();\n\t}\n\n\tshow()\n\t{\n\t\tthis.cancelCloseDebounced();\n\n\t\tlet success = false;\n\t\tif (this._requisiteList && !this._requisiteList.isEmpty())\n\t\t{\n\t\t\tlet popup = PopupManager.create({\n\t\t\t\tid: this._popupId,\n\t\t\t\tcacheable: false,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: this._padding,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tcontent: this.getLayout(),\n\t\t\t\tcloseByEsc: true\n\t\t\t});\n\t\t\tpopup.show();\n\t\t\tthis.adjustPosition();\n\t\t\tsuccess = true;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'onShow', {success});\n\t}\n\n\n\tshowDebounced(delayMultiplier = false)\n\t{\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelShowDebounced();\n\t\tthis.cancelCloseDebounced();\n\t\tthis._showTimer = setTimeout(this.show.bind(this), this._showTimeout * delayMultiplier);\n\t}\n\n\tcancelShowDebounced()\n\t{\n\t\tclearTimeout(this._showTimer);\n\t}\n\n\tcloseDebounced(delayMultiplier = false)\n\t{\n\t\tthis.cancelShowDebounced();\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelCloseDebounced();\n\t\tthis._closeTimer = setTimeout(this.close.bind(this), this._closeTimeout * delayMultiplier);\n\t}\n\n\tcancelCloseDebounced()\n\t{\n\t\tclearTimeout(this._closeTimer);\n\t}\n\n\tadjustPosition()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (!popup || !popup.isShown() || !Type.isDomNode(this._bindElement)\n\t\t\t|| !Type.isDomNode(this._wrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst wrapperRect = this._wrapper.getBoundingClientRect();\n\t\tconst itemRect = this._bindElement.getBoundingClientRect();\n\n\t\tlet offsetLeft = wrapperRect.width - (itemRect.left - wrapperRect.left);\n\n\t\tlet offsetTop = itemRect.height / 2 + this._padding;\n\t\tlet angleOffset = itemRect.height / 2;\n\n\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\tconst popupHeight = popup.getPopupContainer().offsetHeight;\n\t\tconst popupBottom = itemRect.top + popupHeight;\n\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\t// let's try to fit a popup to the browser viewport\n\t\tconst exceeded = popupBottom - clientHeight;\n\t\tif (exceeded > 0)\n\t\t{\n\t\t\tlet roundOffset = Math.ceil(exceeded / itemRect.height) * itemRect.height;\n\t\t\tif (roundOffset > itemRect.top)\n\t\t\t{\n\t\t\t\t// it cannot be higher than the browser viewport.\n\t\t\t\troundOffset -= Math.ceil((roundOffset - itemRect.top) / itemRect.height) * itemRect.height;\n\t\t\t}\n\n\t\t\tif (itemRect.bottom > (popupBottom - roundOffset))\n\t\t\t{\n\t\t\t\t// let's sync bottom boundaries.\n\t\t\t\troundOffset -= itemRect.bottom - (popupBottom - roundOffset) + this._padding;\n\t\t\t}\n\n\t\t\toffsetTop += roundOffset;\n\t\t\tangleOffset += roundOffset + this._padding;\n\t\t}\n\n\t\tpopup.setBindElement(this._bindElement);\n\n\t\tif ((wrapperRect.left + offsetLeft + popupWidth) <= clientWidth)\n\t\t{\n\t\t\tpopup.setAngle({position: 'left', offset: angleOffset});\n\n\t\t\toffsetLeft += popup.angle ? popup.angle.element.offsetWidth : 0;\n\t\t\toffsetTop += popup.angle ? Math.ceil(popup.angle.element.offsetHeight / 2) : 0;\n\t\t\tpopup.setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setAngle(true);\n\t\t}\n\t\tpopup.adjustPosition();\n\t}\n\n\tclose()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tpopup ? popup.close() : null;\n\t\tthis.presetMenu.close();\n\t}\n\n\tremoveDebouncedEvents()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t\tthis.cancelShowDebounced();\n\t}\n\n\trefreshLayout()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.setContent(this.getLayout());\n\t\t}\n\t}\n\n\tgetLayout()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\tlet loader = new Loader();\n\n\t\t\tlet container = Tag.render`<div class=\"crm-rq-wrapper crm-rq-wrapper-loading\"></div>`;\n\t\t\tloader.show(container);\n\t\t\treturn container;\n\t\t}\n\t\tlet requisites = Type.isNull(this._requisiteList) ? [] : this._requisiteList.getList();\n\t\tlet renderRequisiteEditButtonNode = (id) =>\n\t\t{\n\t\t\tif (this._isReadonly)\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_SHOW_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_EDIT')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" data-requisite-id=\"${id}\" onclick=\"${this.onDeleteRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_TOOLTIP_DELETE')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onAddBankDetails.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t};\n\n\t\tlet renderRequisiteBankDetails = (requisite, id) =>\n\t\t{\n\t\t\tlet bandDetails = requisite.getBankDetails();\n\t\t\tlet selectedBankDetailId = requisite.getSelectedBankDetailId();\n\t\t\treturn bandDetails.length ?\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-requisite-container\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-title\">${Loc.getMessage('REQUISITE_TOOLTIP_BANK_DETAILS_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-list\">\n\t\t\t\t\t\t\t${bandDetails.map((bankDetail, index) => Tag.render`\n\t\t\t\t\t\t\t\t<label class=\"crm-rq-org-requisite-item\" onclick=\"${this.onSetSelectedBankDetails.bind(this)}\">\n\t\t\t\t\t\t\t\t\t<input type=\"radio\" data-requisite-id=\"${id}\" data-bankdetails-id=\"${index}\" class=\"crm-rq-org-requisite-btn\" ${requisite.isSelected() && (index === selectedBankDetailId) ? ' checked' : ''} ${this._canChangeDefaultRequisite ? '': ' disabled'}>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-rq-org-requisite-info\">${Text.encode(bankDetail.value)}</span>\n\t\t\t\t\t\t\t\t</label>`)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${renderRequisiteEditButtonNode(id)}\n\t\t\t\t\t</div>`\n\t\t\t\t:\n\t\t\t\trenderRequisiteEditButtonNode(id)\n\t\t};\n\n\t\treturn Tag.render`\n\t\t<div class=\"crm-rq-wrapper\"\n\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\"\n\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\">\n\t\t\t<div class=\"crm-rq-org-list\">\n\t\t\t\t${requisites.map((requisite, index) => Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-item${requisite.isSelected() ? ' crm-rq-org-item-selected' : ''}\" onclick=\"${this.onSetSelectedRequisite.bind(this, index)}\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-info-container\">\n\t\t\t\t\t\t\t<div class=\"crm-rq-org-name\">${Text.encode(requisite.getTitle())}</div>\n\t\t\t\t\t\t\t${requisite.getSubtitle().length ? Tag.render`<div class=\"crm-rq-org-description\">${Text.encode(requisite.getSubtitle())}</div>` : ''}\n\t\t\t\t\t\t\t${renderRequisiteBankDetails(requisite, index)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}\n\t\t\t</div>\n\t\t\t${this._isReadonly ? '' :\n\t\t\tTag.render`<div class=\"crm-rq-btn-container\">\n\t\t\t\t<span class=\"crm-rq-add-rq\" onclick=\"${this.onStartAddRequisite.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"></span> ${Loc.getMessage('REQUISITE_TOOLTIP_ADD')}\n\t\t\t\t</span>\n\t\t\t</div>`}\n\t\t</div>`;\n\t}\n\n\tsetSelectedRequisite(id, bankDetailId)\n\t{\n\t\tlet newSelectedRequisite = this._requisiteList.getById(id);\n\t\tif (!newSelectedRequisite)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\tif (id === this._requisiteList.getSelectedId()) // selected the same requisite\n\t\t{\n\t\t\tlet selectedBankDetails = selectedRequisite.getBankDetails();\n\t\t\tif (selectedBankDetails.length)\n\t\t\t{\n\t\t\t\tfor (let index = 0; index < selectedBankDetails.length; index++)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetails = selectedBankDetails[index];\n\t\t\t\t\tif (Type.isObject(bankDetails) && bankDetails.selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (index === bankDetailId || Type.isNull(bankDetailId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false; // selected same requisite and bank details\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn false; // requisite already selected and hasn't bank details\n\t\t\t}\n\t\t}\n\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {id, bankDetailId});\n\n\t\treturn true;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif (!this.presetMenu.isShown())\n\t\t{\n\t\t\tthis.closeDebounced(1.5);\n\t\t}\n\t}\n\n\tonStartAddRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.presetMenu.toggle(event.target);\n\n\t}\n\n\tonAddRequisite(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.close();\n\t\tEventEmitter.emit(this, 'onAddRequisite', {\n\t\t\tpresetId: data.value\n\t\t});\n\t}\n\n\tonEditRequisite(id, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onEditRequisite', {id});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (Type.isDomNode(element))\n\t\t{\n\t\t\tlet id = element.getAttribute('data-requisite-id');\n\t\t\tEventEmitter.emit(this, 'onDeleteRequisite', {id});\n\t\t}\n\t}\n\n\tonAddBankDetails(requisiteId, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onAddBankDetails', {requisiteId});\n\t}\n\n\tonSetSelectedRequisite(id)\n\t{\n\t\tif (this._canChangeDefaultRequisite)\n\t\t{\n\t\t\tthis.setSelectedRequisite(id, null);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonSetSelectedBankDetails(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (this._canChangeDefaultRequisite && Type.isDomNode(element))\n\t\t{\n\t\t\tif (element.nodeName.toString().toLowerCase() !== 'input')\n\t\t\t{\n\t\t\t\telement = element.querySelector('input');\n\t\t\t\tif (!Type.isDomNode(element))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.checked = false;\n\t\t\tlet id = parseInt(element.getAttribute('data-requisite-id'));\n\t\t\tlet bankDetailsId = parseInt(element.getAttribute('data-bankdetails-id'));\n\t\t\tthis.setSelectedRequisite(id, bankDetailsId);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonChangeRequisites(event)\n\t{\n\t\tthis.refreshLayout();\n\t}\n}","import {Loc, Tag, Dom, Type, Event} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteTooltip} from './requisite-tooltip';\nimport {PresetMenu} from './preset-menu';\n\nexport class EntityEditorRequisiteField extends BX.Crm.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._domNodes = {};\n\t\tthis._requisiteList = null;\n\n\t\tthis.presetMenu = null;\n\t\tthis._autocomplete = null;\n\t\tthis._tooltip = null;\n\t\tthis.isSearchMode = true;\n\t\tthis.requisitesDropdown = null;\n\t\tthis.bankDetailsDropdown = null;\n\t\tthis.selectModeEnabled = false;\n\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tcanAddRequisite: true,\n\t\t\tfeedbackFormParams: BX.prop.getObject(this._schemeElement.getData(), \"feedback_form\", {}),\n\t\t\tenabled: true,\n\t\t\tshowFeedbackLink: false\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onCreateNewItem', this.onAddRequisiteFromAutocomplete.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onInstallDefaultApp', this.onInstallDefaultApp.bind(this));\n\t\tEventEmitter.subscribe(\n\t\t\t\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\",\n\t\t\tthis.onInstallDefaultAppGlobal.bind(this)\n\t\t);\n\n\t\tthis.presetMenu = new PresetMenu(this.getName() + '_requisite_preset_menu', this.getPresetList());\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisiteFromMenu.bind(this));\n\n\t\tconst isReadonly = this.getEditor().isReadOnly();\n\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this.getName() + '_requisite_details', {\n\t\t\treadonly: isReadonly,\n\t\t\tcanChangeDefaultRequisite: !isReadonly,\n\t\t\tpresets: this.getPresetList()\n\t\t});\n\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onAddRequisiteFromTooltip.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\n\t\tthis.updateAutocompletePlaceholder();\n\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\n\t\tconst schemeElementData = this.getSchemeElement().getData();\n\t\tif (schemeElementData.hasOwnProperty('isEditMode') && schemeElementData['isEditMode'] === true)\n\t\t{\n\t\t\tschemeElementData['isEditMode'] = false;\n\t\t\tif (this.getEditor().getMode() === BX.UI.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.editDefaultRequisite();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSelectModeEnabled(selectModeEnabled: boolean): void\n\t{\n\t\tif (this.selectModeEnabled !== selectModeEnabled)\n\t\t{\n\t\t\tthis.selectModeEnabled = selectModeEnabled;\n\t\t\tif (this.isSelectModeEnabled())\n\t\t\t{\n\t\t\t\tthis.isSearchMode = false;\n\t\t\t}\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t}\n\n\tisSelectModeEnabled(): boolean\n\t{\n\t\treturn this.selectModeEnabled && this.hasRequisites() && this.getRequisites().getList().length > 0;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tconst hasRequisites = this.hasRequisites();\n\t\tconst vasEmpty = hasRequisites && this.getRequisites().isEmpty();\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis._tooltip.setRequisites(requisiteList);\n\t\tif (hasRequisites && !vasEmpty && !this.getRequisites().isEmpty())\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayout();\n\t\t}\n\t}\n\n\tgetRequisites()\n\t{\n\t\treturn this._requisiteList;\n\t}\n\n\thasRequisites()\n\t{\n\t\treturn Type.isObject(this._requisiteList);\n\t}\n\n\tisSingleMode()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.getRequisites().getList().length <= 1);\n\t}\n\n\tgetTitle()\n\t{\n\t\tlet title = super.getTitle();\n\t\tif (this.hasRequisites() && !this.isSingleMode())\n\t\t{\n\t\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t\tlet selectedPresetId = selectedRequisite ? selectedRequisite.getPresetId() : null;\n\t\t\tif (selectedRequisite && selectedPresetId)\n\t\t\t{\n\t\t\t\tlet selectedPresetName = this.getPresetList().reduce(\n\t\t\t\t\t(name, item) => ((item.value === selectedPresetId) ? item.name : name), '');\n\n\t\t\t\tif (selectedPresetName.length)\n\t\t\t\t{\n\t\t\t\t\ttitle += ' (' + selectedPresetName + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn title;\n\t}\n\n\tcreateTitleActionControls()\n\t{\n\t\tconst actions = [];\n\n\t\tif (this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn actions;\n\t\t}\n\n\t\tif (this.isAutocompleteEnabled() && this.selectModeEnabled)\n\t\t{\n\t\t\tif (this.isSearchMode)\n\t\t\t{\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_SELECT')}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst title = this.getClientResolverTitle();\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${title}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tactions.push(Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t \tonclick=\"${this.editDefaultRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_TEXT')}</span>`\n\t\t\t);\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\ttoggleSearchMode()\n\t{\n\t\tthis.isSearchMode = !this.isSearchMode;\n\n\t\tthis.refreshLayoutParts();\n\t}\n\n\tisNeedToDisplay(options)\n\t{\n\t\treturn this.hasRequisites() && super.isNeedToDisplay(options);\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._domNodes = {};\n\t\tthis.ensureWrapperCreated({classNames: [\"crm-entity-widget-content-block-field-requisites\"]});\n\t\tthis.adjustWrapper();\n\t\tthis.bindWrapperEvents();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._domNodes.addButton = this.renderAddButton();\n\t\t\tthis._domNodes.autocompleteForm = this.renderAutocompleteForm();\n\t\t\tthis._domNodes.requisiteSelectForm = this.renderRequisiteSelectForm();\n\t\t\tthis._domNodes.bankDetailSelectForm = this.renderBankDetailSelectForm();\n\t\t\tDom.append(this._domNodes.autocompleteForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.requisiteSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.bankDetailSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.addButton, this._wrapper);\n\n\t\t\tthis.adjustNodesVisibility();\n\t\t\tthis.updateRequisitesDropdown();\n\t\t\tthis.updateBankDetailsDropdown();\n\t\t\tthis.updateRequisiteSelectorValue();\n\t\t\tthis.updateBankDetailsSelectorValue();\n\t\t}\n\t\telse // if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tDom.append(this.renderSelectedRequisite(), this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tbindWrapperEvents()\n\t{\n\t\tif (!this.wrapperMouseEnterHandler)\n\t\t{\n\t\t\tthis.wrapperMouseEnterHandler = this.onFieldMouseEnter.bind(this);\n\t\t}\n\t\tif (!this.wrapperMouseLeaveHandler)\n\t\t{\n\t\t\tthis.wrapperMouseLeaveHandler = this.onFieldMouseLeave.bind(this);\n\t\t}\n\n\t\tEvent.unbind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.unbind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\n\t\tEvent.bind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.bind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\t}\n\n\trefreshLayoutParts()\n\t{\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.refreshTitleLayout();\n\t\tthis.updateAutocompleteState();\n\t\tthis.adjustNodesVisibility();\n\t\tthis.updateRequisitesDropdown();\n\t\tthis.updateBankDetailsDropdown();\n\t\tthis.updateRequisiteSelectorValue();\n\t\tthis.updateBankDetailsSelectorValue();\n\t}\n\n\thasContentToDisplay()\n\t{\n\t\treturn this.hasValue();\n\t}\n\n\thasValue()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn  false;\n\t\t}\n\t\tlet list = this.getRequisites().getList();\n\t\tif (list.length > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\t// if list contains only one item, it shouldn't be hidden:\n\t\treturn (list.length === 1 && !list[0].isAddressOnly());\n\t}\n\n\tisAutocompleteEnabled()\n\t{\n\t\tif (\n\t\t\t!this.hasRequisites()\n\t\t\t|| this.getRequisites().isEmpty()\n\t\t\t|| this.getRequisites().getSelected().isAddressOnly()\n\t\t)\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trenderSelectedRequisite()\n\t{\n\t\tthis._domNodes.selectedRequisiteView = Tag.render`<span></span>`;\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.updateAutocompleteState();\n\t\tlet container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\" \n\t\t\t\tonclick=\"${this.onViewStringClick.bind(this)}\"\n\t\t\t\tonmouseenter=\"${this.onViewStringMouseEnter.bind(this)}\">\n\t\t\t\t\t${this._domNodes.selectedRequisiteView}\n\t\t\t</div>`;\n\t\tthis._tooltip.setBindElement(container, this.getEditor().getFormElement());\n\n\t\treturn container;\n\t}\n\n\tupdateSelectedRequisiteText()\n\t{\n\t\tif (!this._domNodes.selectedRequisiteView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selectedRequisite = this.hasRequisites() && this.getRequisites().getSelected();\n\t\tif (this.hasValue() && selectedRequisite && selectedRequisite.getTitle().length)\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.add('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = selectedRequisite.getTitle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.remove('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = BX.UI.EntityEditorField.messages.isEmpty;\n\t\t}\n\t}\n\n\trenderAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block crm-entity-widget-content-block-requisites\">\n\t\t\t\t<span class=\"crm-entity-widget-client-requisites-add-btn\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t</div>`;\n\t}\n\n\trenderAutocompleteForm()\n\t{\n\t\tconst autocompleteContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\"></div>`;\n\t\tconst hasResolvers = !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\tthis._autocomplete.setEnabled(hasResolvers);\n\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\tthis.updateAutocompleteState();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${autocompleteContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderRequisiteSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.requisitesDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tconst selectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.requisitesDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onRequisiteSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${selectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_REQUISITE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderBankDetailSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.bankDetailsDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tthis._domNodes.bankDetailsSelectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.bankDetailsDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onBankDetailSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${this._domNodes.bankDetailsSelectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.onAddBankDetailsClick.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteValue = null;\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite && !selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tautocompleteValue = selectedRequisite.getAutocompleteData();\n\t\t}\n\t\tthis._autocomplete.setCurrentItem(autocompleteValue);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tupdateAutocompletePlaceholder()\n\t{\n\t\tconst clientResolverPropTitle = this.getClientResolverTitle();\n\t\tthis._autocomplete.setEnabled(!!clientResolverPropTitle);\n\t\tthis._autocomplete.setPlaceholderText(clientResolverPropTitle);\n\t}\n\n\tupdateAutocompeteClientResolverPlacementParams()\n\t{\n\t\tthis._autocomplete.setClientResolverPlacementParams(this.getClientResolverPlacementParams());\n\t}\n\n\tgetClientResolverPlacementParams()\n\t{\n\t\tconst clientResolverProp = this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\n\t\treturn (\n\t\t\tclientResolverProp\n\t\t\t\t? {\n\t\t\t\t\t\"isPlacement\": BX.prop.getString(clientResolverProp, \"IS_PLACEMENT\", \"N\") === \"Y\",\n\t\t\t\t\t\"numberOfPlacements\": BX.prop.getArray(clientResolverProp, \"PLACEMENTS\", []).length,\n\t\t\t\t\t\"countryId\": BX.prop.getInteger(clientResolverProp, \"COUNTRY_ID\", 0),\n\t\t\t\t\t\"defaultAppInfo\": BX.prop.getObject(clientResolverProp, \"DEFAULT_APP_INFO\", {})\n\t\t\t\t}\n\t\t\t\t: {}\n\t\t);\n\t}\n\n\tgetClientResolverTitle()\n\t{\n\t\tlet title = \"\";\n\n\t\tconst clientResolverProp = this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\ttitle = BX.prop.getString(clientResolverProp, \"TITLE\", \"\");\n\t\tconst isPlacement = (BX.prop.getString(clientResolverProp, 'IS_PLACEMENT', 'N') === 'Y');\n\t\tif (!isPlacement && Type.isStringFilled(title))\n\t\t{\n\t\t\tconst modifiedTitle = Loc.getMessage('REQUISITE_AUTOCOMPLETE_FILL_IN_01', {'#FIELD_NAME#': title});\n\t\t\tif (Type.isStringFilled(modifiedTitle))\n\t\t\t{\n\t\t\t\ttitle = modifiedTitle;\n\t\t\t}\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tadjustNodesVisibility()\n\t{\n\t\tif (\n\t\t\t!this._domNodes.autocompleteForm\n\t\t\t|| !this._domNodes.requisiteSelectForm\n\t\t\t|| !this._domNodes.bankDetailSelectForm\n\t\t\t|| !this._domNodes.addButton\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSearchMode && this.isAutocompleteEnabled())\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = '';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t\telse if (\n\t\t\tthis.isSelectModeEnabled()\n\t\t\t&& this.hasRequisites()\n\t\t\t&&\n\t\t\t(\n\t\t\t\tthis.getRequisites().getList().length > 1\n\t\t\t \t|| (\n\t\t\t\t\tthis.getRequisites().getList().length > 0)\n\t\t\t\t\t&& !this.getRequisites().getSelected().isAddressOnly()\n\t\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = '';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\n\t\t\tif (this._domNodes.bankDetailsSelectContainer)\n\t\t\t{\n\t\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\t\tif (!bankDetails.length)\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = 'none';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t}\n\n\tgetSelectedRequisiteTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\ttitle = selectedRequisite.getTitle();\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tupdateRequisiteSelectorValue()\n\t{\n\t\tif (!this.requisitesDropdown || !this.requisitesDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requisitesDropdown.targetElement.innerText = this.getSelectedRequisiteTitle();\n\t}\n\n\tupdateBankDetailsSelectorValue()\n\t{\n\t\tif (!this.bankDetailsDropdown || !this.bankDetailsDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.bankDetailsDropdown.targetElement.innerText = this.getSelectedBankDetailTitle();\n\t}\n\n\tgetSelectedBankDetailTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\tconst bankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\tif (bankDetail && bankDetail.title)\n\t\t\t{\n\t\t\t\ttitle = bankDetail.title;\n\t\t\t}\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.IS_DEFAULT)\n\t\t\t{\n\t\t\t\treturn preset.VALUE;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetSelectedPresetId()\n\t{\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\treturn selectedRequisite.getPresetId();\n\t\t}\n\t\treturn this.getDefaultPresetId();\n\t}\n\n\tgetClientResolverPropForPreset(presetId)\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.VALUE === presetId)\n\t\t\t{\n\t\t\t\treturn BX.prop.get(preset, 'CLIENT_RESOLVER_PROP', null);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\treturn {\n\t\t\tpresetId: this.getSelectedPresetId()\n\t\t};\n\t}\n\n\ttoggleNewRequisitePresetMenu(e)\n\t{\n\t\tthis.presetMenu.toggle(e.target);\n\t};\n\n\tgetPresetList()\n\t{\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._schemeElement.getData(), \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\taddRequisite(params)\n\t{\n\t\tEventEmitter.emit(this, 'onEditNew', params);\n\t}\n\n\teditRequisite(id, options)\n\t{\n\t\tEventEmitter.emit(this, 'onEditExisted', {id, options});\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tthis._tooltip.removeDebouncedEvents();\n\t\tthis._tooltip.close();\n\t\tEventEmitter.emit(this, 'onDelete', {id, postponed: this._mode === BX.UI.EntityEditorMode.edit});\n\t}\n\n\thideRequisite(id)\n\t{\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tEventEmitter.emit(this, 'onHide', {id});\n\t}\n\n\tshowDeleteConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.markAsChanged();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tshowClearConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"hide_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.hideRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\teditDefaultRequisite()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: this.getDefaultPresetId(),\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tif (\n\t\t\t(this._domNodes && Type.isDomNode(this._domNodes.addButton) && this._domNodes.addButton.style.display !== 'none') ||\n\t\t\t(this.hasRequisites() && this.getRequisites().isEmpty()) ||\n\t\t\t(this.hasRequisites() && this.getRequisites().getSelected().isAddressOnly())\n\t\t)\n\t\t{\n\t\t\t// this.refreshLayout();\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\tthis.updateAutocompletePlaceholder();\n\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\t}\n\n\tupdateRequisitesDropdown()\n\t{\n\t\tif (!this.requisitesDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tthis.getRequisites().getList().forEach((requisiteItem, index) => {\n\t\t\t\titems.push({\n\t\t\t\t\tid: requisiteItem.getRequisiteId(),\n\t\t\t\t\ttitle: requisiteItem.getTitle(),\n\t\t\t\t\tsubTitle: requisiteItem.getSubtitle(),\n\t\t\t\t\tindex\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.requisitesDropdown.setItems(items);\n\t}\n\n\tupdateBankDetailsDropdown()\n\t{\n\t\tif (!this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites() && this.getRequisites().getSelected())\n\t\t{\n\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\tif (bankDetails.length)\n\t\t\t{\n\t\t\t\tbankDetails.forEach((bankDetail, index) => {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: bankDetail.id,\n\t\t\t\t\t\ttitle: bankDetail.title,\n\t\t\t\t\t\tsubTitle: bankDetail.value,\n\t\t\t\t\t\tindex\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.setItems(items);\n\t}\n\n\tonRequisiteSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId());\n\t\t\tif (selectedRequisiteId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\t\tif (this.requisitesDropdown)\n\t\t{\n\t\t\tthis.requisitesDropdown.getPopupWindow().close();\n\t\t}\n\t}\n\n\tonBankDetailSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites() || !this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId())\n\t\t\tconst selectedBankDetailId = Number(this.getRequisites().getSelected().getSelectedBankDetailId());\n\t\t\tif (selectedBankDetailId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(selectedRequisiteId, index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.getPopupWindow().close();\n\t}\n\n\tonAddRequisiteFromMenu(event)\n\t{\n\t\tlet data = event.getData();\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t// if hidden requisite is selected, it will be used instead of new:\n\t\tif (null !== selectedRequisite && selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tthis.editRequisite(this.getRequisites().getSelectedId(), {\n\t\t\t\teditorOptions: {\n\t\t\t\t\toverriddenPresetId: data.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: data.value\n\t\t\t});\n\t\t}\n\t}\n\n\tonAddRequisiteFromTooltip(event)\n\t{\n\t\tthis.addRequisite(event.getData());\n\t}\n\n\tonAddRequisiteFromAutocomplete()\n\t{\n\t\tthis.editDefaultRequisite();\n\t}\n\n\tonEditRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.id, {\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.showDeleteConfirmation(eventData.id);\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.requisiteId, {\n\t\t\teditorOptions: {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t},\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setLoading(true);\n\t\tif (this.selectModeEnabled)\n\t\t{\n\t\t\tthis.isSearchMode = false;\n\t\t}\n\t\tconst selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tEventEmitter.emit(this, 'onFinishAutocomplete', {\n\t\t\tid: selectedRequisiteId,\n\t\t\tdefaultPresetId: this.getDefaultPresetId(),\n\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\tdata\n\t\t});\n\t}\n\n\tonClearAutocompleteValue()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\t\tlet hasAddresses = false;\n\t\t\tlet addresses = selectedRequisite.getAddressList();\n\t\t\tfor (let addressType in addresses)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\taddresses.hasOwnProperty(addressType) &&\n\t\t\t\t\tType.isStringFilled(addresses[addressType])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\thasAddresses = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasAddresses)\n\t\t\t{\n\t\t\t\tthis.showClearConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDeleteConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t}\n\t}\n\n\tonInstallDefaultApp()\n\t{\n\t\tBX.onGlobalCustomEvent(\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\");\n\t}\n\n\tonInstallDefaultAppGlobal()\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.schemedata.getRequisitesSchemeData',\n\t\t\t{ data: { entityTypeId: this.getEditor().getEntityTypeId() } }\n\t\t).then(\n\t\t\t(data) => {\n\t\t\t\tif (\n\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t&& data.hasOwnProperty(\"data\")\n\t\t\t\t\t&& Type.isPlainObject(data[\"data\"])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis._schemeElement.setData(data[\"data\"]);\n\t\t\t\t\tthis.updateAutocompletePlaceholder();\n\t\t\t\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonViewStringClick()\n\t{\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t\tthis.switchToSingleEditMode();\n\t\t}\n\t}\n\n\tonViewStringMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced();\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onSetDefault', eventData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonFieldMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced(5);\n\t\t}\n\t}\n\n\tonFieldMouseLeave()\n\t{\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t}\n\n\tonAddBankDetailsClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\t\teditorOptions: {\n\t\t\t\t\taddBankDetailsItem: true\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","import {EntityEditorAddressField} from \"crm.entity-editor.field.address\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class EntityEditorRequisiteAddressField extends EntityEditorAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\trollback()\n\t{\n\t\t// rollback will be executed in requisite controller\n\t}\n\n\treset()\n\t{\n\t\t// reset will be executed in requisite controller\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tsuper.onAddressListUpdate(event);\n\t\tEventEmitter.emit(this, 'onAddressListUpdate', event);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n","import {Loc, Dom, Type, Tag} from \"main.core\";\nimport {Loader} from \"main.loader\";\nimport {EntityEditorBaseAddressField} from \"crm.entity-editor.field.address.base\";\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteTooltip} from \"./requisite-tooltip\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\";\n\nexport class EntityEditorClientRequisites\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._entityInfo = null;\n\t\tthis._fieldsParams = null;\n\t\tthis._loaderConfig = null;\n\t\tthis._addressConfig = null;\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\t\tthis._permissionToken = null;\n\n\t\tthis._readonly = true;\n\t\tthis._requisiteEditUrl = null;\n\t\tthis._addressContainer = null;\n\t\tthis._formElement = null;\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.setEntity(BX.prop.get(settings, \"entityInfo\", null), false);\n\t\tif (!this._entityInfo)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: EntityInfo must be instance of BX.CrmEntityInfo\";\n\t\t}\n\t\tthis._fieldsParams = BX.prop.get(settings, \"fieldsParams\", null);\n\t\tif (!this._fieldsParams)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: Fields params are undefined\";\n\t\t}\n\t\tthis._addressConfig = BX.prop.getObject(this._fieldsParams, 'ADDRESS', null);\n\n\t\tthis._requisitesConfig = BX.prop.getObject(this._fieldsParams, 'REQUISITES', null);\n\n\t\tif (this._requisiteList)\n\t\t{\n\t\t\tlet selectedItem = BX.prop.getObject(settings, \"requisiteBinding\", null);\n\t\t\tif (selectedItem\n\t\t\t\t&& !Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t\t{\n\t\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\t\tif (requisite)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._loaderConfig = BX.prop.getObject(settings, 'loaderConfig', null);\n\n\t\tthis._readonly = BX.prop.getBoolean(settings, \"readonly\", true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(settings, \"canChangeDefaultRequisite\", true);\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, \"requisiteEditUrl\", null);\n\t\tthis._formElement = BX.prop.get(settings, \"formElement\", null);\n\t\tthis._permissionToken = BX.prop.getString(settings, \"permissionToken\", null);\n\n\t\tif (BX.prop.getBoolean(settings, \"enableTooltip\", true) && !Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this._id + '_client_requisite_details', {\n\t\t\t\treadonly: this._readonly,\n\t\t\t\tcanChangeDefaultRequisite: this._canChangeDefaultRequisite,\n\t\t\t\tpresets: this.getRequisitesPresetList()\n\t\t\t});\n\t\t}\n\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._entityInfo.getTypeId(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\tcontextId: BX.prop.getString(settings, \"contextId\", \"\"),\n\t\t\trequisiteEditUrl: this._requisiteEditUrl,\n\t\t\tpermissionToken: this._permissionToken\n\t\t});\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onEditNewRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditExistedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onShow', this.onShowTooltip.bind(this));\n\t\t}\n\t}\n\n\tsetEntity(entityInfo, emitNotification)\n\t{\n\t\tthis._entityInfo = entityInfo;\n\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._requisiteList = RequisiteList.create(this._entityInfo.getRequisites());\n\t\t}\n\t\tif (emitNotification)\n\t\t{\n\t\t\tthis.onChangeRequisiteList();\n\t\t}\n\t}\n\n\taddressLayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._addressContainer = Tag.render`<div class=\"crm-entity-widget-client-address\"></div>`;\n\t\tDom.append(this._addressContainer, container);\n\t\tthis.doAddressLayout();\n\t}\n\n\tdoAddressLayout()\n\t{\n\t\tif (!Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this._addressContainer);\n\n\t\tif (!Type.isNull(this._addressConfig))\n\t\t{\n\t\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t\t{\n\t\t\t\tlet defaultRequisite = this._requisiteList.getSelected();\n\t\t\t\tlet addressValue = defaultRequisite ? defaultRequisite.getAddressList() : null;\n\n\t\t\t\tif (!Type.isNull(addressValue) && Object.keys(addressValue).length)\n\t\t\t\t{\n\t\t\t\t\tlet countryId = 0;\n\t\t\t\t\tif (defaultRequisite)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountryId = parseInt(defaultRequisite.getPresetCountryId());\n\t\t\t\t\t}\n\t\t\t\t\tthis._addressField = EntityEditorBaseAddressField.create(this._entityInfo.getId(), {\n\t\t\t\t\t\tshowFirstItemOnly: true,\n\t\t\t\t\t\tshowAddressTypeInViewMode: true,\n\t\t\t\t\t\taddressZoneConfig: BX.prop.getObject(this._addressConfig, \"addressZoneConfig\", {}),\n\t\t\t\t\t\tcountryId: countryId,\n\t\t\t\t\t\tdefaultAddressTypeByCategory: BX.prop.getInteger(\n\t\t\t\t\t\t\tthis._addressConfig,\n\t\t\t\t\t\t\t\"defaultAddressTypeByCategory\",\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t)\n\t\t\t\t\t});\n\t\t\t\t\tthis._addressField.setMultiple(true);\n\t\t\t\t\tthis._addressField.setTypesList(BX.prop.getObject(this._addressConfig, \"types\", {}));\n\t\t\t\t\tthis._addressField.setValue(addressValue);\n\t\t\t\t\tDom.append(this._addressField.layout(false), this._addressContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet showAddressLink = Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onLoadAddressMouseUp.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('CLIENT_REQUISITES_ADDRESS_SHOW_ADDRESS')}\n\t\t\t\t</span>`;\n\n\t\t\t\tDom.append(showAddressLink, this._addressContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowTooltip(bindElement)\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tif (this.isRequisiteAddressOnly())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._tooltip.setBindElement(bindElement, this._formElement);\n\t\tthis._tooltip.showDebounced();\n\t}\n\n\tcloseTooltip()\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\trelease()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.release();\n\t\t}\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t}\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tloadEntity()\n\t{\n\t\tif (!this._loaderConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\tlet loader = new Loader({size: 19, mode: 'inline'});\n\t\t\tDom.clean(this._addressContainer);\n\t\t\tloader.show(this._addressContainer);\n\t\t}\n\n\t\tBX.CrmDataLoader.create(\n\t\t\tthis._id,\n\t\t\t{\n\t\t\t\tserviceUrl: this._loaderConfig[\"url\"],\n\t\t\t\taction: this._loaderConfig[\"action\"],\n\t\t\t\tparams: {\n\t\t\t\t\t\"ENTITY_TYPE_NAME\": this._entityInfo.getTypeName(),\n\t\t\t\t\t\"ENTITY_ID\": this._entityInfo.getId(),\n\t\t\t\t\t\"NORMALIZE_MULTIFIELDS\": \"Y\"\n\t\t\t\t}\n\t\t\t}\n\t\t).load(this.onEntityInfoLoad.bind(this));\n\t}\n\n\tgetRequisitesPresetList()\n\t{\n\t\tif (Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._requisitesConfig, \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t}\n\t\tthis._requisiteEditor.deleteRequisite(id);\n\t}\n\n\tisRequisiteAddressOnly()\n\t{\n\t\tlet list = this._requisiteList.getList();\n\t\treturn (list.length === 1 && list[0].isAddressOnly());\n\t}\n\n\tonLoadAddressMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis.loadEntity();\n\t}\n\n\tonEntityInfoLoad(sender, result)\n\t{\n\t\tvar entityData = BX.prop.getObject(result, \"DATA\", null);\n\t\tif (entityData)\n\t\t{\n\t\t\tthis.setEntity(BX.CrmEntityInfo.create(entityData), true);\n\t\t\tif (this._tooltip && this._showTooltipOnEntityLoad)\n\t\t\t{\n\t\t\t\tif (!this.isRequisiteAddressOnly())\n\t\t\t\t{\n\t\t\t\t\tthis._tooltip.show();\n\t\t\t\t}\n\t\t\t\tthis._showTooltipOnEntityLoad = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis._requisiteEditor.open(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {});\n\t\t}\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(eventData.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet requisite = this._requisiteList.getById(eventData.requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t});\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis._requisiteList.setSelected(eventData.id, eventData.bankDetailId);\n\n\t\tthis.doAddressLayout();\n\n\t\tlet newSelectedRequisite = this._requisiteList.getSelected();\n\t\tif (newSelectedRequisite)\n\t\t{\n\t\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? 0 : selectedBankDetail.id;\n\n\t\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {\n\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\tbankDetailId: selectedBankDetailId\n\t\t\t});\n\t\t}\n\t}\n\n\tonRequisiteEditorAfterEdit(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonChangeRequisiteList()\n\t{\n\t\tthis.doAddressLayout();\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tthis._tooltip.setLoading(false);\n\t\t}\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\n\t\tlet requisiteList = this._requisiteList ? this._requisiteList.exportToModel() : null;\n\n\t\tthis._entityInfo.setRequisites(requisiteList);\n\t\tEventEmitter.emit(this, 'onChangeRequisiteList', {\n\t\t\tentityTypeName: this._entityInfo.getTypeName(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\trequisites: this._requisiteList.exportToModel()\n\t\t});\n\t}\n\n\tonShowTooltip()\n\t{\n\t\tif (!this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tif (this._tooltip)\n\t\t\t{\n\t\t\t\tthis._tooltip.close();\n\t\t\t\tthis._showTooltipOnEntityLoad = true;\n\t\t\t}\n\t\t\tthis.loadEntity();\n\t\t}\n\t\telse if (this.isRequisiteAddressOnly())\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorClientRequisites();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}"],"names":["RequisiteList","setEventNamespace","_items","CHANGE_EVENT","value","settings","Type","isArray","item","listItem","RequisiteListItem","create","push","filter","isDeleted","getList","length","selectedId","getSelectedId","getById","list","index","requisite","isSelected","id","requisiteId","getRequisiteId","reduce","prev","current","bankDetailsId","selected","setSelected","setSelectedBankDetails","isNull","getSelectedBankDetailId","notifyListChanged","maxExistedId","prevId","getRequisiteIdAsString","match","newRequisitePattern","currentId","Math","max","parseInt","indexOf","isAddressOnly","splice","setDeleted","setAddressOnly","setChanged","emit","result","exportedItem","exportToModel","self","initialize","EventEmitter","_data","isPlainObject","isNew","isChanged","formData","addressData","autocompleteState","presetId","BX","prop","getString","requisiteData","requisiteDataSign","bankDetails","bankDetailIdSelected","addressList","title","subtitle","extraData","getObject","initialAddressDdta","prepareViewData","JSON","parse","e","viewData","newRequisiteId","getNumber","getFields","setRequisiteId","bankDetailViewDataList","prepareBankDetailsList","bankDetailsItem","deleted","pseudoId","fields","isStringFilled","textValue","map","join","hasOwnProperty","getBoolean","changed","selectedBankDetailId","getInteger","getBankDetails","bankDetailId","getArray","isNumber","String","getAutocompleteState","selectedAutocompleteItem","subTitle","isUndefined","name","state","oldAddressTypes","Object","keys","addresses","type","getAddressData","isString","DELETED","presetCountryId","justSelected","setFormData","getFormData","setAddressData","EntityEditorRequisiteEditor","_requisiteList","_entityTypeId","_entityId","_entityCategoryId","_permissionToken","_contextId","_mode","UI","EntityEditorMode","view","currentSliderRequisiste","_requisiteEditUrl","_onExternalEventListener","onExternalEvent","bind","subscribe","requisiteList","mode","options","sliderOptions","width","cacheable","allowChangeHistory","requestMethod","requestParams","prepareSliderRequestParams","Crm","Page","openSlider","getSliderUrl","postData","sessid","bitrix_sessid","ACTION","ajax","post","data","json","ERROR","showError","selectedRequisite","getSelected","selectedRemoved","remove","errorMessage","MessageBox","alert","Loc","getMessage","urlParams","etype","eid","external_context_id","getPresetId","cid","util","add_url_param","getRequisiteEditUrl","getRequisiteData","getRequisiteDataSign","stringify","isEmptyFormData","isEmptyAddressData","RQ_ADDR","getAddressesForSave","isViewMode","overriddenPresetId","replace","PRESET_ID","useFormData","promise","method","dataType","url","unsubscribe","event","dataArray","getData","eventName","contextId","isObject","setRequisiteData","setAutocompleteState","clearFormData","clearAddressData","setPresetId","setPresetCountryId","setNew","add","EntityEditorRequisiteController","_requisiteEditor","_requisiteFieldId","_requisiteField","_requisiteInitData","_addressFieldId","_addressField","_isLoading","_formInputsWrapper","_enableRequisiteSelection","getConfigStringParam","saveRequisiteInitData","_editor","onFieldInit","initRequisiteEditor","initRequisiteList","selectedItem","getConfig","REQUISITE_ID","BANK_DETAIL_ID","getByRequisiteId","bankDetail","getBankDetailByBankDetailId","_config","onChangeRequisites","setRequisiteList","_id","entityTypeId","getEntityTypeId","entityId","getEntityId","getContextId","requisiteEditUrl","permissionToken","entityCategoryId","onRequisiteEditorAfterEdit","onRequisiteEditorAfterDelete","setRequisites","setSelectModeEnabled","countryId","getPresetCountryId","requisiteAddressList","getAddressList","setCountryId","setAddressList","enableRequisiteSelection","getRequisiteFieldValue","promises","signPromise","signRequisiteFields","then","error","entityDataObj","entityData","entityDataSign","addError","EntityValidationError","field","getFirstEditModeField","Promise","resolve","reject","all","newSelectedRequisite","selectedBankDetail","getBankDetailById","startLoading","runAction","stopLoading","setRequisiteInitAddrData","setMode","getMode","open","rawRequisite","requisiteFields","setInitialAddressData","setInitAddrData","edit","modelValue","_model","setField","getField","Tag","render","Dom","append","getFormElement","getListWithDeleted","dataInput","safe","signInput","isDomNode","markAsChanged","initRequisiteField","initAddressField","updateRequisiteFieldModel","eventData","extraFields","isEmpty","defaultPresetId","getNewRequisiteId","getDefaultPresetId","schemeElement","getScheme","getAvailableElements","getName","preset","IS_DEFAULT","VALUE","getSignRequisitePromise","release","fieldId","getId","onEditNewRequisite","onEditExistedRequisite","onFinishRequisiteAutocomplete","onClearRequisiteAutocomplete","onSetDefaultRequisite","onDeleteRequisite","onHideRequisite","onAddressListUpdate","params","openEditor","editorOptions","prepareRequisiteByEventData","oldAddr","addr","unhide","cancel","setSelectedRequisite","postponed","removePostponed","deleteRequisite","hide","isEmptyAddress","address","addEditorFormInputs","selectedRequisiteId","removeEditorFormInputs","markFieldsAsChanged","isEmptyRequisitesList","EntityEditorController","PresetMenu","presetList","_isShown","menuId","bindElement","close","show","menu","text","Text","encode","onclick","onSelect","MenuManager","angle","events","onPopupShow","onPopupClose","getMenuById","popupWindow","EntityEditorRequisiteTooltip","isNotEmptyString","getRandomString","_settings","_padding","_showTimer","_closeTimer","_closeTimeout","_showTimeout","_popupId","_isReadonly","_canChangeDefaultRequisite","_bindElement","_wrapper","_changeRequisistesHandler","presetMenu","onAddRequisite","refreshLayout","wrapper","parentNode","isLoading","cancelCloseDebounced","success","popup","PopupManager","autoHide","padding","contentPadding","content","getLayout","closeByEsc","adjustPosition","delayMultiplier","cancelShowDebounced","setTimeout","clearTimeout","getPopupById","isShown","wrapperRect","getBoundingClientRect","itemRect","offsetLeft","left","offsetTop","height","angleOffset","popupWidth","getPopupContainer","offsetWidth","popupHeight","offsetHeight","popupBottom","top","clientWidth","document","documentElement","clientHeight","exceeded","roundOffset","ceil","bottom","setBindElement","setAngle","position","offset","element","setOffset","setContent","loader","Loader","container","requisites","renderRequisiteEditButtonNode","onEditRequisite","onAddBankDetails","renderRequisiteBankDetails","bandDetails","onSetSelectedBankDetails","onMouseEnter","onMouseLeave","onSetSelectedRequisite","getTitle","getSubtitle","onStartAddRequisite","selectedBankDetails","closeDebounced","stopPropagation","toggle","target","getAttribute","nodeName","toString","toLowerCase","querySelector","checked","EntityEditorRequisiteField","_domNodes","_autocomplete","_tooltip","isSearchMode","requisitesDropdown","bankDetailsDropdown","selectModeEnabled","RequisiteAutocompleteField","searchAction","canAddRequisite","feedbackFormParams","_schemeElement","enabled","showFeedbackLink","onSelectAutocompleteValue","onAddRequisiteFromAutocomplete","onClearAutocompleteValue","onInstallDefaultApp","onInstallDefaultAppGlobal","getPresetList","onAddRequisiteFromMenu","isReadonly","getEditor","isReadOnly","readonly","canChangeDefaultRequisite","presets","onAddRequisiteFromTooltip","updateAutocompletePlaceholder","updateAutocompeteClientResolverPlacementParams","schemeElementData","getSchemeElement","editDefaultRequisite","isSelectModeEnabled","refreshLayoutParts","hasRequisites","getRequisites","vasEmpty","isSingleMode","selectedPresetId","selectedPresetName","actions","isAutocompleteEnabled","toggleSearchMode","getClientResolverTitle","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","bindWrapperEvents","isNeedToDisplay","registerLayout","isDragEnabled","createDragButton","createTitleNode","addButton","renderAddButton","autocompleteForm","renderAutocompleteForm","requisiteSelectForm","renderRequisiteSelectForm","bankDetailSelectForm","renderBankDetailSelectForm","adjustNodesVisibility","updateRequisitesDropdown","updateBankDetailsDropdown","updateRequisiteSelectorValue","updateBankDetailsSelectorValue","renderSelectedRequisite","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","wrapperMouseEnterHandler","onFieldMouseEnter","wrapperMouseLeaveHandler","onFieldMouseLeave","Event","unbind","updateSelectedRequisiteText","refreshTitleLayout","updateAutocompleteState","hasValue","getClientResolverPropForPreset","getSelectedPresetId","selectedRequisiteView","onViewStringClick","onViewStringMouseEnter","classList","textContent","EntityEditorField","messages","toggleNewRequisitePresetMenu","autocompleteContainer","hasResolvers","setEnabled","layout","isOpen","toggleDropdown","showPopupWindow","destroyPopupWindow","selectInput","selectContainer","Dropdown","targetElement","items","isDisabled","onRequisiteSelect","bankDetailsSelectContainer","onBankDetailSelect","onAddBankDetailsClick","autocompleteValue","getAutocompleteData","setCurrentItem","setContext","getAutocompleteContext","clientResolverPropTitle","setPlaceholderText","setClientResolverPlacementParams","getClientResolverPlacementParams","clientResolverProp","isPlacement","modifiedTitle","style","display","innerText","getSelectedRequisiteTitle","getSelectedBankDetailTitle","get","removeDebouncedEvents","EditorAuxiliaryDialog","buttons","DialogButtonType","accept","callback","button","getDialog","hideRequisite","editRequisite","getState","addRequisite","forEach","requisiteItem","setItems","sender","undefined","Number","getPopupWindow","showDeleteConfirmation","addBankDetailsItem","setLoading","hasAddresses","addressType","showClearConfirmation","onGlobalCustomEvent","setData","switchToSingleEditMode","showDebounced","preventDefault","EntityEditorRequisiteAddressField","EntityEditorAddressField","EntityEditorClientRequisites","_entityInfo","_fieldsParams","_loaderConfig","_addressConfig","_readonly","_addressContainer","_formElement","_showTooltipOnEntityLoad","setEntity","_requisitesConfig","getRequisitesPresetList","getTypeId","onShowTooltip","entityInfo","emitNotification","hasEditRequisiteData","onChangeRequisiteList","doAddressLayout","clean","defaultRequisite","addressValue","EntityEditorBaseAddressField","showFirstItemOnly","showAddressTypeInViewMode","addressZoneConfig","defaultAddressTypeByCategory","setMultiple","setTypesList","setValue","showAddressLink","onLoadAddressMouseUp","isRequisiteAddressOnly","size","CrmDataLoader","serviceUrl","action","getTypeName","load","onEntityInfoLoad","loadEntity","CrmEntityInfo","entityTypeName"],"mappings":"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"}