{"version":3,"file":"requisite.bundle.js","sources":["../src/requisite-list.js","../src/requisite-editor.js","../src/requisite-controller.js","../src/preset-menu.js","../src/requisite-tooltip.js","../src/requisite-crm-field.js","../src/address-crm-field.js","../src/client-requisites.js"],"sourcesContent":["import {Type} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class RequisiteList extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.EntityEditorRequisiteField.RequisiteList');\n\t\tthis._items = [];\n\n\t\tthis.CHANGE_EVENT = 'onChange';\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (!Type.isArray(value))\n\t\t{\n\t\t\tvalue = [];\n\t\t}\n\t\tfor (let item of value)\n\t\t{\n\t\t\tlet listItem = RequisiteListItem.create(item);\n\t\t\tthis._items.push(listItem);\n\t\t}\n\t}\n\n\tgetList()\n\t{\n\t\treturn this._items.filter((item) => !item.isDeleted());\n\t}\n\n\tgetListWithDeleted()\n\t{\n\t\treturn this._items;\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn !this.getList().length;\n\t}\n\n\tgetSelected()\n\t{\n\t\tlet selectedId = this.getSelectedId();\n\t\treturn this.getById(selectedId);\n\t}\n\n\tgetSelectedId()\n\t{\n\t\tlet list = this.getList();\n\t\tif (!list.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tfor (let index = 0; index < list.length; index++)\n\t\t{\n\t\t\tlet requisite = list[index];\n\t\t\tif (requisite.isSelected())\n\t\t\t{\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t\treturn 0; // first element by default\n\t}\n\n\tgetById(id)\n\t{\n\t\tlet list = this.getList();\n\n\t\tif (null === id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (id >= 0 && id < list.length)\n\t\t{\n\t\t\treturn list[id];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetByRequisiteId(requisiteId)\n\t{\n\t\tlet list = this.getList();\n\t\treturn list\n\t\t\t.filter((item) => item.getRequisiteId() == requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tsetSelected(requisiteId, bankDetailsId)\n\t{\n\t\tlet requisite = this.getById(requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tfor (let item of this.getList())\n\t\t\t{\n\t\t\t\tlet selected = (item === requisite);\n\t\t\t\titem.setSelected(selected);\n\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\titem.setSelectedBankDetails(\n\t\t\t\t\t\tType.isNull(bankDetailsId) ? requisite.getSelectedBankDetailId() : bankDetailsId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tgetNewRequisiteId()\n\t{\n\t\tlet maxExistedId = this.getList().reduce((prevId, item) =>\n\t\t{\n\t\t\tlet requisiteId = item.getRequisiteIdAsString();\n\t\t\tlet match = requisiteId ? requisiteId.match(RequisiteListItem.newRequisitePattern) : false;\n\t\t\tlet currentId = match && match[1] ? match[1] : -1;\n\t\t\treturn Math.max(prevId, currentId);\n\t\t}, -1);\n\n\t\treturn 'n' + (parseInt(maxExistedId) + 1);\n\t}\n\n\tindexOf(item)\n\t{\n\t\treturn this._items.indexOf(item);\n\t}\n\n\tadd(item)\n\t{\n\t\tthis._items.push(item);\n\t\tif (!item.isAddressOnly())\n\t\t{\n\t\t\tthis.setSelected(this._items.indexOf(item));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.notifyListChanged();\n\t\t}\n\t}\n\n\tremove(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis._items.splice(index, 1);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tremovePostponed(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setDeleted(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\thide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(true);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tunhide(item)\n\t{\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index >= 0)\n\t\t{\n\t\t\titem.setAddressOnly(false);\n\t\t\titem.setChanged(true);\n\t\t}\n\t\tthis.notifyListChanged();\n\t}\n\n\tnotifyListChanged()\n\t{\n\t\tthis.emit(this.CHANGE_EVENT);\n\t}\n\n\texportToModel()\n\t{\n\t\tlet result = [];\n\t\tfor (let item of this._items)\n\t\t{\n\t\t\tlet exportedItem = item.exportToModel();\n\t\t\tresult.push({...exportedItem});\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteList();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nexport class RequisiteListItem\n{\n\tconstructor()\n\t{\n\n\t\tthis._data = null;\n\t}\n\n\tinitialize(value, settings)\n\t{\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tthis._data = {...value};\n\t\t\tthis._data.isNew = false;\n\t\t\tthis._data.isChanged = false;\n\t\t\tthis._data.isDeleted = false;\n\t\t\tthis._data.isAddressOnly = false;\n\t\t\tthis._data.formData = {};\n\t\t\tthis._data.addressData = {};\n\t\t\tif (!Type.isPlainObject(this._data.autocompleteState))\n\t\t\t{\n\t\t\t\tthis._data.autocompleteState = {};\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{ // new empty requisite\n\t\t\tthis._data = {\n\t\t\t\tisNew: true,\n\t\t\t\tisChanged: false,\n\t\t\t\tisDeleted: false,\n\t\t\t\tisAddressOnly: false,\n\t\t\t\tselected: false,\n\t\t\t\tpresetId: null,\n\t\t\t\trequisiteId: BX.prop.getString(settings, 'newRequisiteId', 'n0'),\n\t\t\t\trequisiteData: '',\n\t\t\t\trequisiteDataSign: '',\n\t\t\t\tbankDetails: [],\n\t\t\t\tbankDetailIdSelected: 0,\n\t\t\t\taddressList: {},\n\t\t\t\tvalue: {},\n\t\t\t\ttitle: '',\n\t\t\t\tsubtitle: '',\n\t\t\t\tautocompleteState: {},\n\t\t\t\tformData: {},\n\t\t\t\taddressData: {}\n\t\t\t};\n\t\t\tlet extraData = BX.prop.getObject(settings, 'newRequisiteExtraFields', {});\n\t\t\tthis._data = {...this._data, ...extraData};\n\t\t}\n\t\tthis._data.initialAddressDdta = null;\n\t\tthis.prepareViewData(this._data);\n\t}\n\n\tprepareViewData()\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis._data.value = this._data.requisiteData ? JSON.parse(this._data.requisiteData) : {};\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis._data.value = {};\n\t\t}\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.viewData))\n\t\t{\n\t\t\tthis._data.title = this._data.value.viewData.title;\n\t\t\tthis._data.subtitle = this._data.value.viewData.subtitle;\n\t\t}\n\n\t\tif (this.getRequisiteIdAsString().match(RequisiteListItem.newRequisitePattern)) // was new requisite\n\t\t{\n\t\t\tlet newRequisiteId = BX.prop.getNumber(this.getFields(), 'ID', 0);\n\t\t\tif (newRequisiteId > 0) // if new requisite was saved\n\t\t\t{\n\t\t\t\tthis.setRequisiteId(newRequisiteId);\n\t\t\t}\n\t\t}\n\t\tthis.setAddressOnly(BX.prop.getString(this.getFields(), 'ADDRESS_ONLY', 'N') === 'Y');\n\n\t\tthis._data.bankDetails = [];\n\t\tif (Type.isPlainObject(this._data.value) && Type.isArray(this._data.value.bankDetailViewDataList))\n\t\t{\n\t\t\tthis._data.bankDetails = this.prepareBankDetailsList(this._data.value.bankDetailViewDataList);\n\t\t}\n\n\t\tthis._data.addressList = {...BX.prop.getObject(this.getFields(), 'RQ_ADDR', {})};\n\t}\n\n\tprepareBankDetailsList(bankDetails)\n\t{\n\t\tlet result = [];\n\t\tfor (let bankDetailsItem of bankDetails)\n\t\t{\n\t\t\tif (bankDetailsItem.deleted)\n\t\t\t{\n\t\t\t\tcontinue; // Deleted items should not be shown\n\t\t\t}\n\t\t\tif (Type.isPlainObject(bankDetailsItem.viewData))\n\t\t\t{\n\t\t\t\tlet item = {\n\t\t\t\t\t'title': bankDetailsItem.viewData.title,\n\t\t\t\t\t'id': bankDetailsItem.pseudoId,\n\t\t\t\t\t'value': '',\n\t\t\t\t\t'selected': !!bankDetailsItem.selected\n\t\t\t\t};\n\t\t\t\tif (Type.isArray(bankDetailsItem.viewData.fields) && bankDetailsItem.viewData.fields.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = bankDetailsItem.viewData.fields\n\t\t\t\t\t\t.filter((item) => Type.isStringFilled(item.textValue))\n\t\t\t\t\t\t.map((item) => item.title + ': ' + item.textValue)\n\t\t\t\t\t\t.join(', ');\n\t\t\t\t}\n\t\t\t\tif (!item.value.length)\n\t\t\t\t{\n\t\t\t\t\titem.value = item.title;\n\t\t\t\t}\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tisSelected()\n\t{\n\t\tif (!this._data.hasOwnProperty('justSelected'))\n\t\t{\n\t\t\treturn BX.prop.getBoolean(this._data, 'selected', false);\n\t\t}\n\t\treturn BX.prop.getBoolean(this._data, 'justSelected', false);\n\t}\n\n\tisChanged()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isChanged', false);\n\t}\n\n\tsetChanged(changed)\n\t{\n\t\tthis._data.isChanged = !!changed;\n\t}\n\n\tisNew()\n\t{\n\t\treturn BX.prop.getBoolean(this._data, 'isNew', false);\n\t}\n\n\tsetNew(isNew)\n\t{\n\t\tthis._data.isNew = !!isNew;\n\t}\n\n\tgetSelectedBankDetailId()\n\t{\n\t\tlet selectedBankDetailId = BX.prop.getInteger(this._data, 'selectedBankDetailId', -1);\n\t\tif (selectedBankDetailId !== -1)\n\t\t{\n\t\t\treturn selectedBankDetailId;\n\t\t}\n\t\tselectedBankDetailId = this.getBankDetails().reduce(\n\t\t\t(selected, item, index) =>\n\t\t\t{\n\t\t\t\treturn item.selected ? index : selected\n\t\t\t}, -1);\n\t\tthis._data.selectedBankDetailId = selectedBankDetailId;\n\n\t\treturn selectedBankDetailId > -1 ? selectedBankDetailId : 0;\n\t}\n\n\tgetBankDetailById(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif (bankDetailId >= 0 && bankDetailId < list.length)\n\t\t{\n\t\t\treturn list[bankDetailId];\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetBankDetailByBankDetailId(bankDetailId)\n\t{\n\t\tlet list = this.getBankDetails();\n\t\tif (null === bankDetailId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn list\n\t\t\t.filter((item) => item.id == bankDetailId)\n\t\t\t.reduce((prev, current) => current, null);\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'title', \"\");\n\t}\n\n\tgetSubtitle()\n\t{\n\t\treturn BX.prop.getString(this._data, 'subtitle', \"\");\n\t}\n\n\tgetPresetId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetId', \"0\");\n\t}\n\n\tgetPresetCountryId()\n\t{\n\t\treturn BX.prop.getString(this._data, 'presetCountryId', \"0\");\n\t}\n\n\tgetBankDetails()\n\t{\n\t\treturn BX.prop.getArray(this._data, 'bankDetails', []);\n\t}\n\n\tgetRequisiteId()\n\t{\n\t\treturn this._data.requisiteId;\n\t}\n\n\tgetRequisiteIdAsString()\n\t{\n\t\tlet requisiteId = this.getRequisiteId();\n\t\trequisiteId = Type.isNumber(requisiteId) ? String(requisiteId) : requisiteId;\n\t\treturn Type.isStringFilled(requisiteId) ? requisiteId : '';\n\t}\n\n\tgetRequisiteData()\n\t{\n\t\treturn this._data.requisiteData;\n\t}\n\n\tgetRequisiteDataSign()\n\t{\n\t\treturn this._data.requisiteDataSign;\n\t}\n\n\tgetFields()\n\t{\n\t\tif (Type.isPlainObject(this._data.value) && Type.isPlainObject(this._data.value.fields))\n\t\t{\n\t\t\treturn {...this._data.value.fields};\n\t\t}\n\t\treturn {};\n\t}\n\n\tgetAutocompleteData()\n\t{\n\t\tlet result = null;\n\n\t\tlet autocompleteState = this.getAutocompleteState();\n\t\tlet selectedAutocompleteItem = BX.prop.getObject(autocompleteState, 'currentItem', null);\n\t\tif (Type.isPlainObject(selectedAutocompleteItem))\n\t\t{\n\t\t\tresult = {\n\t\t\t\ttitle: BX.prop.getString(selectedAutocompleteItem, 'title', ''),\n\t\t\t\tsubTitle: BX.prop.getString(selectedAutocompleteItem, 'subTitle', '')\n\t\t\t}\n\t\t}\n\t\telse if (!Type.isUndefined(this._data.value.viewData)  && Type.isArray(this._data.value.viewData.fields))\n\t\t{\n\t\t\tlet fields =  this._data.value.viewData.fields;\n\t\t\tresult = {\n\t\t\t\ttitle: Type.isStringFilled(this._data.title) ? this._data.title : '',\n\t\t\t\tsubTitle: fields\n\t\t\t\t\t.filter((item) => item.name === 'RQ_INN' && item.textValue.length)\n\t\t\t\t\t.map((item) => item.title + ' ' + item.textValue)\n\t\t\t\t\t.join('')\n\t\t\t};\n\t\t}\n\t\treturn result;\n\t}\n\n\tsetAutocompleteState(state)\n\t{\n\t\tthis._data.autocompleteState = Type.isPlainObject(state) ? state : {};\n\t}\n\n\tgetAutocompleteState()\n\t{\n\t\treturn this._data.autocompleteState;\n\t}\n\n\tgetAddressList()\n\t{\n\t\treturn this._data.addressList;\n\t}\n\n\tsetAddressList(addressList)\n\t{\n\t\tthis._data.addressList = addressList;\n\t}\n\n\tsetInitialAddressData(addressData)\n\t{\n\t\tthis._data.initialAddressDdta = addressData;\n\t}\n\n\tgetAddressesForSave()\n\t{\n\t\tlet oldAddressTypes = Type.isPlainObject(this._data.initialAddressDdta) ?\n\t\t\tObject.keys(this._data.initialAddressDdta) : [];\n\n\t\tlet addresses = {};\n\t\tfor (let type of oldAddressTypes)\n\t\t{\n\t\t\taddresses[type] = \"\";\n\t\t}\n\t\tlet addressData = this.getAddressData();\n\t\tfor (let type in addressData)\n\t\t{\n\t\t\tif (addressData.hasOwnProperty(type) && addressData[type].length)\n\t\t\t{\n\t\t\t\taddresses[type] = addressData[type];\n\t\t\t}\n\t\t}\n\t\tfor (let type in addresses)\n\t\t{\n\t\t\tif (Type.isString(addresses[type]) && addresses[type] === \"\")\n\t\t\t{\n\t\t\t\taddresses[type] = {DELETED: 'Y'};\n\t\t\t}\n\t\t}\n\n\t\treturn addresses;\n\t}\n\n\tsetRequisiteId(requisiteId)\n\t{\n\t\tthis._data.requisiteId = requisiteId;\n\t}\n\n\tsetPresetId(presetId)\n\t{\n\t\tthis._data.presetId = presetId;\n\t}\n\n\tsetPresetCountryId(presetCountryId)\n\t{\n\t\tthis._data.presetCountryId = presetCountryId;\n\t}\n\n\tsetSelected(selected)\n\t{\n\t\tthis._data.selected = !!selected;\n\t\tthis._data.justSelected = !!selected;\n\t}\n\n\tsetRequisiteData(requisiteData, requisiteDataSign)\n\t{\n\t\tthis._data.requisiteData = requisiteData;\n\t\tif (Type.isStringFilled(requisiteDataSign))\n\t\t{\n\t\t\tthis._data.requisiteDataSign = requisiteDataSign;\n\t\t}\n\t\tthis.prepareViewData();\n\t}\n\n\tsetDeleted(isDeleted)\n\t{\n\t\tthis._data.isDeleted = !!isDeleted;\n\t}\n\n\tisDeleted()\n\t{\n\t\treturn this._data.isDeleted;\n\t}\n\n\tsetAddressOnly(isAddressOnly)\n\t{\n\t\tthis._data.isAddressOnly = !!isAddressOnly;\n\t\tthis.setFormData({...this.getFormData(), 'ADDRESS_ONLY': isAddressOnly ? 'Y':'N'})\n\t}\n\n\tisAddressOnly()\n\t{\n\t\treturn this._data.isAddressOnly;\n\t}\n\n\tisEmptyFormData()\n\t{\n\t\treturn Object.keys(this._data.formData).length <= 0;\n\t}\n\n\tgetFormData()\n\t{\n\t\treturn this._data.formData;\n\t}\n\n\tsetFormData(formData)\n\t{\n\t\tthis._data.formData = formData;\n\t}\n\n\tclearFormData()\n\t{\n\t\tthis.setFormData({});\n\t}\n\n\tisEmptyAddressData()\n\t{\n\t\treturn Object.keys(this._data.addressData).length <= 0;\n\t}\n\n\tgetAddressData()\n\t{\n\t\treturn this._data.addressData;\n\t}\n\n\tsetAddressData(addressData)\n\t{\n\t\tthis._data.addressData = addressData;\n\t}\n\n\tclearAddressData()\n\t{\n\t\tthis.setAddressData({});\n\t}\n\tsetSelectedBankDetails(bankDetailsId)\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isNull(bankDetailsId))\n\t\t{\n\t\t\tbankDetailsId = 0; // first item by default\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = (index === bankDetailsId);\n\t\t}\n\n\t\tthis._data.selectedBankDetailId = bankDetailsId;\n\t}\n\n\tclearSelectedBankDetails()\n\t{\n\t\tif (!Type.isArray(this._data.bankDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (let index = 0; index < this._data.bankDetails.length; index++)\n\t\t{\n\t\t\tthis._data.bankDetails[index].selected = false;\n\t\t}\n\t}\n\n\texportToModel()\n\t{\n\t\tlet exportedItem = {...this._data};\n\t\tdelete (exportedItem.value);\n\t\tdelete (exportedItem.addressList);\n\t\tdelete (exportedItem.bankDetails);\n\t\tdelete (exportedItem.initialAddressDdta);\n\t\tdelete (exportedItem.isAddressOnly);\n\t\treturn exportedItem;\n\t}\n\n\tstatic create(value, settings)\n\t{\n\t\tlet self = new RequisiteListItem();\n\t\tself.initialize(value, settings);\n\t\treturn self;\n\t}\n}\n\nRequisiteListItem.newRequisitePattern = /n([0-9]+)/;","import {RequisiteListItem} from \"./requisite-list\";\nimport {EventEmitter} from \"main.core.events\";\nimport {Loc, Type} from \"main.core\";\nimport {MessageBox} from \"ui.dialogs.messagebox\";\n\nexport class EntityEditorRequisiteEditor\n{\n\tconstructor()\n\t{\n\t\tthis._requisiteList = null;\n\t\tthis._entityTypeId = null;\n\t\tthis._entityId = null;\n\t\tthis._entityCategoryId = null;\n\t\tthis._permissionToken = null;\n\t\tthis._contextId = null;\n\t\tthis._mode = BX.UI.EntityEditorMode.view;\n\n\t\tthis.currentSliderRequisiste = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._entityTypeId = BX.prop.getInteger(settings, 'entityTypeId', 0);\n\t\tthis._entityId = BX.prop.getInteger(settings, 'entityId', 0);\n\t\tthis._entityCategoryId = BX.prop.getInteger(settings, 'entityCategoryId', null);\n\t\tthis._contextId = BX.prop.getString(settings, 'contextId', \"\");\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, 'requisiteEditUrl', \"\");\n\t\tthis._permissionToken = BX.prop.getString(settings, 'permissionToken', null);\n\n\t\tthis._onExternalEventListener = this.onExternalEvent.bind(this);\n\t\tEventEmitter.subscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tsetRequisiteList(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t}\n\n\tsetMode(mode)\n\t{\n\t\tthis._mode = mode;\n\t}\n\n\topen(requisite, options = {})\n\t{\n\t\tif (!(requisite instanceof RequisiteListItem))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentSliderRequisiste = requisite;\n\n\t\tlet sliderOptions = {\n\t\t\twidth: 950,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: this.prepareSliderRequestParams(requisite, options)\n\t\t};\n\t\tBX.Crm.Page.openSlider(this.getSliderUrl(requisite), sliderOptions);\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tlet requisite = this._requisiteList.getById(id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet postData = {...this.prepareSliderRequestParams(requisite)};\n\t\t\tpostData.sessid = BX.bitrix_sessid();\n\t\t\tpostData.mode = 'delete';\n\t\t\tpostData.ACTION = 'SAVE';\n\n\t\t\tBX.ajax.post(this.getSliderUrl(requisite), postData, (data) =>\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tlet json = JSON.parse(data);\n\t\t\t\t\tif (Type.isStringFilled(json.ERROR))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(json.ERROR);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\t\t\t\t\tlet selectedRemoved = (selectedRequisite === requisite);\n\t\t\t\t\t\tthis._requisiteList.remove(requisite);\n\n\t\t\t\t\t\tEventEmitter.emit(this, 'onAfterDeleteRequisite', {selectedRemoved});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tgetSliderUrl(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\n\t\tlet urlParams =\n\t\t\t{\n\t\t\t\tetype: this._entityTypeId,\n\t\t\t\teid: this._entityId,\n\t\t\t\texternal_context_id: this._contextId\n\t\t\t};\n\n\t\tlet presetId = requisite.getPresetId();\n\t\tif (presetId > 0)\n\t\t{\n\t\t\turlParams[\"pid\"] = presetId;\n\t\t}\n\t\tif (!Type.isNull(this._entityCategoryId))\n\t\t{\n\t\t\turlParams.cid = this._entityCategoryId;\n\t\t}\n\n\t\treturn BX.util.add_url_param(\n\t\t\tthis.getRequisiteEditUrl(requisiteId),\n\t\t\turlParams\n\t\t);\n\t}\n\n\tprepareSliderRequestParams(requisite, options = {})\n\t{\n\t\tlet requestParams = {};\n\t\tlet requisiteData = requisite.getRequisiteData();\n\t\tif (requisite.isChanged() && Type.isString(requisiteData) && requisiteData.length)\n\t\t{\n\t\t\trequestParams['externalData'] = {\n\t\t\t\t'data': requisiteData,\n\t\t\t\t'sign': requisite.getRequisiteDataSign()\n\t\t\t};\n\t\t}\n\t\tif (requisite.isSelected())\n\t\t{\n\t\t\tlet autocompleteState = requisite.getAutocompleteState();\n\t\t\tif (Object.keys(autocompleteState).length)\n\t\t\t{\n\t\t\t\trequestParams['AUTOCOMPLETE'] = JSON.stringify(autocompleteState);\n\t\t\t\trequestParams['useFormData'] = 'Y';\n\t\t\t}\n\t\t}\n\t\tif (!requisite.isEmptyFormData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...requisite.getFormData()};\n\t\t}\n\t\tif (!requisite.isEmptyAddressData())\n\t\t{\n\t\t\trequestParams = {...requestParams, ...{RQ_ADDR: requisite.getAddressesForSave()}};\n\t\t}\n\t\trequestParams['mode'] = requisite.isNew() ? 'create' : 'edit';\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\trequestParams['doSave'] = 'Y';\n\t\t}\n\t\tif (BX.prop.getBoolean(options, 'addBankDetailsItem', false))\n\t\t{\n\t\t\trequestParams['addBankDetailsItem'] = 'Y';\n\t\t}\n\t\tlet overriddenPresetId = BX.prop.getInteger(options, 'overriddenPresetId', 0);\n\t\tif (overriddenPresetId > 0)\n\t\t{\n\t\t\trequestParams['PRESET_ID'] = overriddenPresetId;\n\t\t\trequestParams['useFormData'] = 'Y';\n\t\t}\n\t\tif (!Type.isNull(this._permissionToken))\n\t\t{\n\t\t\trequestParams['permissionToken'] = this._permissionToken;\n\t\t}\n\n\t\treturn requestParams;\n\t}\n\n\tgetRequisiteEditUrl(requisiteId)\n\t{\n\t\treturn this._requisiteEditUrl.replace(/#requisite_id#/gi, requisiteId);\n\t}\n\n\tgetSignRequisitePromise(requisite)\n\t{\n\t\tlet postData = this.prepareSliderRequestParams(requisite);\n\t\tpostData.sessid = BX.bitrix_sessid();\n\t\tpostData.PRESET_ID = requisite.getPresetId();\n\t\tpostData.useFormData = 'Y';\n\t\tpostData.ACTION = 'SAVE';\n\n\t\treturn BX.ajax.promise({\n\t\t\tmethod: 'post',\n\t\t\tdataType: 'json',\n\t\t\turl: this.getSliderUrl(requisite),\n\t\t\tdata: postData\n\t\t});\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._mode === BX.UI.EntityEditorMode.view;\n\t}\n\n\trelease()\n\t{\n\t\tEventEmitter.unsubscribe('onLocalStorageSet', this._onExternalEventListener);\n\t}\n\n\tonExternalEvent(event)\n\t{\n\t\tlet dataArray = event.getData();\n\t\tif (!Type.isArray(dataArray))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet data = dataArray[0];\n\n\t\tlet eventName = BX.prop.getString(data, \"key\", \"\");\n\n\t\tif (eventName !== \"BX.Crm.RequisiteSliderDetails:onCancelEdit\" && eventName !== \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet value = BX.prop.getObject(data, \"value\", {});\n\n\t\tlet contextId = BX.prop.getString(value, \"contextId\", \"\");\n\t\tif (contextId !== this._contextId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onCancelEdit\")\n\t\t{\n\t\t\tthis.currentSliderRequisiste = null;\n\t\t}\n\t\tif (eventName === \"BX.Crm.RequisiteSliderDetails:onSave\")\n\t\t{\n\t\t\tlet requisite = this.currentSliderRequisiste;\n\t\t\tif (Type.isObject(requisite))\n\t\t\t{\n\t\t\t\tif (Type.isString(value.requisiteData))\n\t\t\t\t{\n\t\t\t\t\trequisite.setRequisiteData(value.requisiteData, value.requisiteDataSign);\n\t\t\t\t\trequisite.setAutocompleteState({});\n\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(value.presetId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetId(value.presetId);\n\t\t\t\t}\n\t\t\t\tif (Type.isString(value.presetCountryId))\n\t\t\t\t{\n\t\t\t\t\trequisite.setPresetCountryId(value.presetCountryId);\n\t\t\t\t}\n\t\t\t\tif (this.isViewMode())\n\t\t\t\t{\n\t\t\t\t\trequisite.setNew(false);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\trequisite.setChanged(true);\n\t\t\t\t}\n\t\t\t\trequisite.setDeleted(false);\n\n\t\t\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._requisiteList.notifyListChanged();\n\t\t\t\t}\n\n\t\t\t\tthis.currentSliderRequisiste = null;\n\n\t\t\t\tEventEmitter.emit(this, 'onAfterEditRequisite');\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteEditor();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n}","import {Dom, Loc, Tag, Type} from \"main.core\"\nimport {EventEmitter} from \"main.core.events\"\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\"\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nexport class EntityEditorRequisiteController extends BX.Crm.EntityEditorController\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\n\t\tthis._requisiteFieldId = null;\n\t\tthis._requisiteField = null;\n\t\tthis._requisiteInitData = null;\n\n\t\tthis._addressFieldId = null;\n\t\tthis._addressField = null;\n\t\tthis._isLoading = false;\n\n\t\tthis._formInputsWrapper = null;\n\t\tthis._enableRequisiteSelection = false;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._requisiteFieldId = this.getConfigStringParam(\"requisiteFieldId\", \"\");\n\t\tthis._addressFieldId = this.getConfigStringParam(\"addressFieldId\", \"\");\n\n\t\tthis.saveRequisiteInitData();\n\n\t\tEventEmitter.subscribe(this._editor, 'onFieldInit', this.onFieldInit.bind(this));\n\n\t\tthis.initRequisiteEditor();\n\t\tthis.initRequisiteList();\n\n\t\tlet selectedItem = BX.prop.getObject(this.getConfig(), \"requisiteBinding\", {});\n\t\tif (!Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t{\n\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\tif (requisite)\n\t\t\t{\n\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis._enableRequisiteSelection = BX.prop.getString(this._config, 'enableRequisiteSelection', false);\n\t}\n\n\tinitRequisiteList()\n\t{\n\t\tthis._requisiteList = RequisiteList.create(this._requisiteInitData);\n\t\tthis._requisiteList.subscribe(this._requisiteList.CHANGE_EVENT, this.onChangeRequisites.bind(this));\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t}\n\n\tinitRequisiteEditor()\n\t{\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\tentityId: this._editor.getEntityId(),\n\t\t\tcontextId: this._editor.getContextId(),\n\t\t\trequisiteEditUrl: this._editor.getRequisiteEditUrl('#requisite_id#'),\n\t\t\tpermissionToken: this.getConfigStringParam('permissionToken', null),\n\t\t\tentityCategoryId: BX.prop.getString(this.getConfig(), 'entityCategoryId', 0)\n\t\t});\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\t}\n\n\tinitRequisiteField()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.setRequisites(this._requisiteList);\n\n\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t}\n\t}\n\n\tinitAddressField()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tlet countryId = 0;\n\t\t\tlet addressList = {};\n\t\t\tlet selectedRequisite = this._requisiteList ? this._requisiteList.getSelected() : null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tcountryId = selectedRequisite.getPresetCountryId();\n\t\t\t\tlet requisiteAddressList = selectedRequisite.getAddressList();\n\t\t\t\tfor (let type in requisiteAddressList)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\trequisiteAddressList.hasOwnProperty(type) &&\n\t\t\t\t\t\tBX.prop.getString(requisiteAddressList[type], 'DELETED', 'N') !== 'Y'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\taddressList[type] = requisiteAddressList[type];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._addressField.setCountryId(countryId);\n\t\t\tthis._addressField.setAddressList(addressList);\n\t\t}\n\t}\n\n\tsetSelectModeEnabled(enableRequisiteSelection: boolean): void\n\t{\n\t\tif (this._enableRequisiteSelection !== enableRequisiteSelection)\n\t\t{\n\t\t\tthis._enableRequisiteSelection = enableRequisiteSelection;\n\t\t\tif (this._requisiteField)\n\t\t\t{\n\t\t\t\tthis._requisiteField.setSelectModeEnabled(this._enableRequisiteSelection);\n\t\t\t}\n\t\t}\n\t}\n\n\tsaveRequisiteInitData()\n\t{\n\t\tthis._requisiteInitData = this.getRequisiteFieldValue();\n\t}\n\n\tvalidate(result)\n\t{\n\t\tlet promises = [];\n\t\tfor (let requisite of this._requisiteList.getList())\n\t\t{\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (requisite.isEmptyFormData() && requisite.isEmptyAddressData())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet signPromise = this.signRequisiteFields(requisite);\n\t\t\tsignPromise.then(\n\t\t\t\t(data) =>\n\t\t\t\t{\n\t\t\t\t\tlet error = BX.prop.getString(data, 'ERROR', '');\n\t\t\t\t\tlet entityDataObj = BX.prop.getObject(data, 'ENTITY_DATA', {});\n\t\t\t\t\tlet entityData = BX.prop.getString(entityDataObj, 'REQUISITE_DATA', \"\");\n\t\t\t\t\tlet entityDataSign = BX.prop.getString(entityDataObj, 'REQUISITE_DATA_SIGN', \"\");\n\t\t\t\t\tif (Type.isStringFilled(error))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(error);\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isStringFilled(entityData) && Type.isStringFilled(entityDataSign))\n\t\t\t\t\t{\n\t\t\t\t\t\trequisite.setRequisiteData(entityData, entityDataSign);\n\t\t\t\t\t\trequisite.clearFormData();\n\t\t\t\t\t\trequisite.clearAddressData();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tresult.addError(BX.Crm.EntityValidationError.create({field: this.getFirstEditModeField()}));\n\t\t\t\t\tthis.showError(Loc.getMessage('CRM_EDITOR_SAVE_ERROR_CONTENT'));\n\t\t\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tpromises.push(signPromise);\n\t\t}\n\n\t\treturn (promises.length > 0) ? Promise.all(promises) : null;\n\t}\n\n\tsetSelectedRequisite(requisiteId, bankDetailId)\n\t{\n\t\tlet entityId = this._editor.getEntityId();\n\t\tif (!entityId)\n\t\t{\n\t\t\t// impossible situation, but...\n\t\t\treturn;\n\t\t}\n\t\tlet newSelectedRequisite = this._requisiteList.getById(requisiteId);\n\t\tif (!newSelectedRequisite || newSelectedRequisite.isNew())\n\t\t{\n\t\t\t// impossible situation too\n\t\t\treturn;\n\t\t}\n\t\tthis._requisiteList.setSelected(requisiteId, bankDetailId);\n\n\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\n\t\tthis.startLoading();\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.settings.setSelectedEntityRequisite',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this._editor.getEntityTypeId(),\n\t\t\t\t\tentityId: entityId,\n\t\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t}, () =>\n\t\t{\n\t\t\tthis.stopLoading();\n\t\t});\n\n\t}\n\n\topenEditor(requisite, options = {})\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\tthis._requisiteEditor.open(requisite, options);\n\t}\n\n\tisViewMode()\n\t{\n\t\treturn this._editor.getMode() === BX.Crm.EntityEditorMode.view;\n\t}\n\n\tsetRequisiteInitAddrData(requisite)\n\t{\n\t\tlet requisiteId = requisite.getRequisiteId();\n\t\tlet rawRequisite = this._requisiteInitData\n\t\t\t.filter((item) => item.requisiteId === requisiteId)\n\t\t\t.reduce((prev, current) => current, null);\n\n\t\tif (Type.isPlainObject(rawRequisite))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet requisiteData = JSON.parse(rawRequisite.requisiteData);\n\t\t\t\tlet requisiteFields = BX.prop.getObject(requisiteData, 'fields', {});\n\t\t\t\tlet addressData = BX.prop.getObject(requisiteFields, 'RQ_ADDR', null);\n\t\t\t\trequisite.setInitialAddressData(addressData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\trequisite.setInitAddrData(null);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFirstEditModeField()\n\t{\n\t\tif (this._requisiteField && this._requisiteField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._requisiteField;\n\t\t}\n\t\tif (this._addressField && this._addressField._mode === BX.Crm.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn this._addressField;\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdateRequisiteFieldModel()\n\t{\n\t\tlet modelValue = this._requisiteList.exportToModel();\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._model.setField(this._requisiteFieldId, modelValue);\n\t\t}\n\t\tthis.saveRequisiteInitData([...modelValue]);\n\t}\n\n\tgetRequisiteFieldValue()\n\t{\n\t\tif (!this._requisiteFieldId)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn this._model.getField(this._requisiteFieldId, []);\n\t}\n\n\taddEditorFormInputs()\n\t{\n\t\tthis._formInputsWrapper = Tag.render`<div></div>`;\n\t\tDom.append(this._formInputsWrapper, this._editor.getFormElement());\n\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DELETED]\" value=\"Y\" >`, this._formInputsWrapper);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!requisite.isChanged())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet dataInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][DATA]\" value=\"${Tag.safe`${requisite.getRequisiteData()}`}\" >`;\n\t\t\tlet signInput = Tag.render`<input type=\"hidden\" name=\"REQUISITES[${requisite.getRequisiteId()}][SIGN]\" value=\"${requisite.getRequisiteDataSign()}\" >`;\n\t\t\tDom.append(dataInput, this._formInputsWrapper);\n\t\t\tDom.append(signInput, this._formInputsWrapper);\n\t\t}\n\t}\n\n\tremoveEditorFormInputs()\n\t{\n\t\tif (Type.isDomNode(this._formInputsWrapper))\n\t\t{\n\t\t\tDom.remove(this._formInputsWrapper);\n\t\t\tthis._formInputsWrapper = null;\n\t\t}\n\t}\n\n\tmarkFieldsAsChanged()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\tthis._requisiteField.markAsChanged();\n\t\t}\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.markAsChanged();\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tisLoading()\n\t{\n\t\treturn !!this._isLoading;\n\t}\n\n\tstartLoading()\n\t{\n\t\tthis._isLoading = true;\n\t}\n\n\tstopLoading()\n\t{\n\t\tthis._isLoading = false;\n\t}\n\n\tshowError(errorMessage)\n\t{\n\t\tMessageBox.alert(errorMessage, Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t}\n\n\tprepareRequisiteByEventData(eventData)\n\t{\n\t\tlet requisite = this._requisiteList.getById(eventData.id);\n\t\tif (!requisite)\n\t\t{\n\t\t\tconst extraFields = {\n\t\t\t\tselected: this._requisiteList.isEmpty(),\n\t\t\t\tpresetId: eventData.defaultPresetId,\n\t\t\t};\n\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\textraFields.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\textraFields.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\textraFields.autocompleteState = eventData.autocompleteState;\n\t\t\t}\n\n\t\t\trequisite = RequisiteListItem.create(null, {\n\t\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t\t'newRequisiteExtraFields': extraFields,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (eventData.hasOwnProperty('autocompleteState'))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(eventData.autocompleteState);\n\t\t\t}\n\t\t\tif (Type.isPlainObject(eventData.data))\n\t\t\t{\n\t\t\t\tif (eventData.data.title)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.title = eventData.data.title;\n\t\t\t\t}\n\t\t\t\tif (eventData.data.subtitle)\n\t\t\t\t{\n\t\t\t\t\trequisite._data.subtitle = eventData.data.subtitle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn requisite;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tif (this._requisiteField)\n\t\t{\n\t\t\treturn this._requisiteField.getDefaultPresetId();\n\t\t}\n\t\telse // if requisiteField is hidden\n\t\t{\n\t\t\tlet schemeElement = this._editor.getScheme().getAvailableElements()\n\t\t\t\t.filter((item) => (item.getName() === this._requisiteFieldId))\n\t\t\t\t.reduce((prev, current) => current, null);\n\n\t\t\tif (!schemeElement)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor (let preset of BX.prop.getArray(schemeElement.getData(), \"presets\", []))\n\t\t\t{\n\t\t\t\tif (preset.IS_DEFAULT)\n\t\t\t\t{\n\t\t\t\t\treturn preset.VALUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsignRequisiteFields(requisite)\n\t{\n\t\tthis.setRequisiteInitAddrData(requisite);\n\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\treturn this._requisiteEditor.getSignRequisitePromise(requisite);\n\t}\n\n\trelease()\n\t{\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tonFieldInit(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet field = eventData.field;\n\t\tif (field)\n\t\t{\n\t\t\tlet fieldId = field.getId();\n\t\t\tif (Type.isStringFilled(this._requisiteFieldId) && fieldId === this._requisiteFieldId)\n\t\t\t{\n\t\t\t\tthis._requisiteField = field;\n\t\t\t\tthis.initRequisiteField();\n\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditNew', this.onEditNewRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onEditExisted', this.onEditExistedRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onFinishAutocomplete', this.onFinishRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onClearAutocomplete', this.onClearRequisiteAutocomplete.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onSetDefault', this.onSetDefaultRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onDelete', this.onDeleteRequisite.bind(this));\n\t\t\t\tEventEmitter.subscribe(this._requisiteField, 'onHide', this.onHideRequisite.bind(this));\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(this._addressFieldId) && fieldId === this._addressFieldId)\n\t\t\t{\n\t\t\t\tthis._addressField = field;\n\t\t\t\tthis.initAddressField();\n\n\t\t\t\tEventEmitter.subscribe(this._addressField, 'onAddressListUpdate', this.onAddressListUpdate.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis.openEditor(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tlet options = BX.prop.getObject(params, 'options', {});\n\t\t\tif (Type.isPlainObject(options.autocompleteState))\n\t\t\t{\n\t\t\t\trequisite.setAutocompleteState(options.autocompleteState);\n\t\t\t}\n\t\t\tlet editorOptions = {};\n\t\t\tif (Type.isPlainObject(options.editorOptions))\n\t\t\t{\n\t\t\t\teditorOptions = options.editorOptions;\n\t\t\t}\n\t\t\tthis.openEditor(requisite, editorOptions);\n\t\t}\n\t}\n\n\tonClearRequisiteAutocomplete(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\trequisite.clearFormData();\n\t\t}\n\t}\n\n\tonFinishRequisiteAutocomplete(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst requisite = this.prepareRequisiteByEventData(eventData);\n\t\tconst formData = BX.prop.getObject(BX.prop.getObject(eventData, 'data', {}), 'fields', {});\n\t\tif (formData.hasOwnProperty('RQ_ADDR'))\n\t\t{\n\t\t\tif (Type.isPlainObject(formData.RQ_ADDR))\n\t\t\t{\n\t\t\t\tlet oldAddr = requisite.getAddressList();\n\t\t\t\toldAddr = Type.isPlainObject(oldAddr) ? oldAddr : {};\n\n\t\t\t\tconst addr = {...oldAddr, ...formData.RQ_ADDR};\n\t\t\t\trequisite.setAddressData(addr);\n\t\t\t\trequisite.setAddressList(addr);\n\t\t\t}\n\t\t\tdelete (formData.RQ_ADDR);\n\t\t}\n\t\trequisite.setFormData(formData);\n\t\trequisite.setChanged(true);\n\t\trequisite.setDeleted(false);\n\t\tconst presetId = BX.prop.getInteger(formData, 'PRESET_ID', 0);\n\t\tif (presetId > 0)\n\t\t{\n\t\t\trequisite.setPresetId(presetId);\n\t\t}\n\t\tconst presetCountryId = BX.prop.getInteger(formData, 'PRESET_COUNTRY_ID', 0);\n\t\tif (presetCountryId > 0)\n\t\t{\n\t\t\trequisite.setPresetCountryId(presetCountryId);\n\t\t}\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tthis._requisiteList.add(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t\tif (requisite.isAddressOnly())\n\t\t{\n\t\t\tthis._requisiteList.unhide(requisite);\n\t\t}\n\t}\n\n\tonSetDefaultRequisite(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst id = eventData.id;\n\t\tconst bankDetailId = eventData.bankDetailId;\n\n\t\tif (this._addressField && this._addressField.isChanged())\n\t\t{\n\t\t\tthis._editor.cancel();\n\t\t\treturn false; // have to save address first\n\t\t}\n\n\t\tthis.setSelectedRequisite(id, bankDetailId);\n\t\tthis.updateRequisiteFieldModel();\n\n\t\treturn true;\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis.setRequisiteInitAddrData(requisite);\n\t\t}\n\t\tif (params.postponed)\n\t\t{\n\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._requisiteEditor.setMode(this._editor.getMode());\n\t\t\tthis._requisiteEditor.deleteRequisite(params.id);\n\t\t}\n\t}\n\n\tonHideRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteList.hide(requisite);\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tthis.initAddressField();\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\teventData.id = this._requisiteList.getSelectedId();\n\n\t\teventData.defaultPresetId = this.getDefaultPresetId();\n\n\t\tlet requisite = this.prepareRequisiteByEventData(eventData);\n\n\t\tlet addresses = {};\n\t\tlet isEmptyAddress = true;\n\t\tfor (let address of eventData.value)\n\t\t{\n\t\t\taddresses[address.type] = address.value;\n\t\t\tif (Type.isStringFilled(address.value))\n\t\t\t{\n\t\t\t\tisEmptyAddress = false;\n\t\t\t}\n\t\t}\n\n\t\trequisite.setAddressData(addresses);\n\t\trequisite.setAddressList(addresses);\n\n\t\trequisite.setChanged(true);\n\t\tif (!isEmptyAddress)\n\t\t{\n\t\t\trequisite.setDeleted(false);\n\t\t}\n\n\t\tif (this._requisiteList.indexOf(requisite) < 0)\n\t\t{\n\t\t\tif (!isEmptyAddress)\n\t\t\t{\n\t\t\t\trequisite.setAddressOnly(true);\n\t\t\t\tthis._requisiteList.add(requisite);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//  remove requisite if address is empty and requisite contain only address\n\t\t\tif (isEmptyAddress && requisite.isAddressOnly())\n\t\t\t{\n\t\t\t\tthis._requisiteList.removePostponed(requisite);\n\t\t\t}\n\t\t\tthis._requisiteList.notifyListChanged();\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tsuper.onBeforeSubmit();\n\t\tthis.addEditorFormInputs();\n\t}\n\n\tonBeforesSaveControl(data)\n\t{\n\t\tif (!data.hasOwnProperty('REQUISITES'))\n\t\t{\n\t\t\tdata['REQUISITES'] = {};\n\t\t}\n\t\tfor (let requisite of this._requisiteList.getListWithDeleted())\n\t\t{\n\t\t\tif (!requisite.isChanged() && !requisite.isDeleted())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet requisiteData = {};\n\t\t\tif (requisite.isDeleted())\n\t\t\t{\n\t\t\t\trequisiteData['DELETED'] = 'Y';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trequisiteData['DATA'] = requisite.getRequisiteData();\n\t\t\t\trequisiteData['SIGN'] = requisite.getRequisiteDataSign();\n\t\t\t}\n\t\t\tdata['REQUISITES'][requisite.getRequisiteId()] = requisiteData;\n\t\t}\n\n\t\tif (this._enableRequisiteSelection)\n\t\t{\n\t\t\tconst selectedRequisite = this._requisiteList.getSelected();\n\t\t\tlet selectedRequisiteId = null;\n\t\t\tlet selectedBankDetailId = null;\n\t\t\tif (selectedRequisite)\n\t\t\t{\n\t\t\t\tselectedRequisiteId = selectedRequisite.getRequisiteId();\n\t\t\t\tconst selectedBankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\t\tselectedBankDetailId = Type.isNull(selectedBankDetail) ? null : selectedBankDetail.id;\n\t\t\t}\n\n\t\t\tdata['REQUISITES']['BINDING'] = {\n\t\t\t\trequisiteId: selectedRequisiteId,\n\t\t\t\tbankDetailId: selectedBankDetailId,\n\t\t\t};\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tonAfterSave()\n\t{\n\t\tsuper.onAfterSave();\n\t\tthis.saveRequisiteInitData(this.getRequisiteFieldValue());\n\n\t\tthis.initRequisiteList();\n\t\tthis.initRequisiteField();\n\t\tthis.initAddressField();\n\n\t\tthis.removeEditorFormInputs();\n\t}\n\n\tonRequisiteEditorAfterEdit()\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tthis.updateRequisiteFieldModel();\n\t\t}\n\t\tthis.markFieldsAsChanged();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tlet data = event.getData();\n\t\tlet isEmptyRequisitesList = this._requisiteList.isEmpty();\n\t\tif (!isEmptyRequisitesList && data.selectedRemoved)\n\t\t{\n\t\t\t// set new default requisite\n\t\t\tthis.setSelectedRequisite(0, 0);\n\t\t}\n\t\tthis.updateRequisiteFieldModel();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteController();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {MenuManager} from \"main.popup\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Loc, Text} from \"main.core\";\n\nexport class PresetMenu extends EventEmitter\n{\n\tconstructor(id, presetList)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Crm.RequisitePresetMenu');\n\t\tthis._isShown = false;\n\t\tthis.menuId = id;\n\t\tthis.presetList = presetList;\n\t}\n\n\ttoggle(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse if (bindElement)\n\t\t{\n\t\t\tthis.show(bindElement);\n\t\t}\n\t}\n\n\tshow(bindElement)\n\t{\n\t\tif (this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.presetList || !this.presetList.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('REQUISITE_LIST_EMPTY_PRESET_LIST'), Loc.getMessage('REQUISITE_LIST_ITEM_ERROR_CAPTION'));\n\t\t\treturn;\n\t\t}\n\t\tlet menu = [];\n\t\tfor (let item of this.presetList)\n\t\t{\n\t\t\tmenu.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Text.encode(item.name),\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\tonclick: this.onSelect.bind(this, item)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.menuId,\n\t\t\tbindElement,\n\t\t\tmenu,\n\t\t\t{\n\t\t\t\tangle: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonPopupClose: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._isShown = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this._isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menu = MenuManager.getMenuById(this.menuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.popupWindow.close();\n\t\t}\n\t}\n\n\tisShown()\n\t{\n\t\treturn this._isShown;\n\t}\n\n\tonSelect(item)\n\t{\n\t\tthis.close();\n\t\tthis.emit('onSelect', item);\n\t}\n}","import {PopupManager} from \"main.popup\";\nimport {Tag, Type, Loc, Text} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {PresetMenu} from \"./preset-menu\";\nimport {Loader} from \"main.loader\";\n\nexport class EntityEditorRequisiteTooltip\n{\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\n\t\tthis._padding = BX.prop.getInteger(this._settings, 'padding', 20);\n\t\tthis._showTimer = false;\n\t\tthis._closeTimer = false;\n\t\tthis._closeTimeout = BX.prop.getInteger(this._settings, 'closeTimeout', 700);\n\t\tthis._showTimeout = BX.prop.getInteger(this._settings, 'showTimeout', 500);\n\t\tthis._popupId = this._id + '_popup';\n\n\t\tthis._isReadonly = BX.prop.getBoolean(this._settings, 'readonly', true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(this._settings, 'canChangeDefaultRequisite', true);\n\n\t\tthis._bindElement = null;\n\t\tthis._wrapper = null;\n\t\tthis._requisiteList = null;\n\n\t\tthis._isLoading = false;\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\n\t\tthis.presetMenu = new PresetMenu(this._id + '_preset_menu', BX.prop.getArray(this._settings, 'presets', []));\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisite.bind(this));\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorRequisiteTooltip();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis.refreshLayout();\n\t}\n\n\tsetBindElement(bindElement, wrapper)\n\t{\n\t\tthis._bindElement = bindElement;\n\t\tif (!Type.isDomNode(wrapper))\n\t\t{\n\t\t\twrapper = this._bindElement.parentNode ? this._bindElement.parentNode : null;\n\t\t}\n\t\tthis._wrapper = wrapper;\n\t}\n\n\tsetLoading(isLoading)\n\t{\n\t\tthis._isLoading = !!isLoading;\n\t\tthis.refreshLayout();\n\t}\n\n\tshow()\n\t{\n\t\tthis.cancelCloseDebounced();\n\n\t\tlet success = false;\n\t\tif (this._requisiteList && !this._requisiteList.isEmpty())\n\t\t{\n\t\t\tlet popup = PopupManager.create({\n\t\t\t\tid: this._popupId,\n\t\t\t\tcacheable: false,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: this._padding,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tcontent: this.getLayout(),\n\t\t\t\tcloseByEsc: true\n\t\t\t});\n\t\t\tpopup.show();\n\t\t\tthis.adjustPosition();\n\t\t\tsuccess = true;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'onShow', {success});\n\t}\n\n\n\tshowDebounced(delayMultiplier = false)\n\t{\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelShowDebounced();\n\t\tthis.cancelCloseDebounced();\n\t\tthis._showTimer = setTimeout(this.show.bind(this), this._showTimeout * delayMultiplier);\n\t}\n\n\tcancelShowDebounced()\n\t{\n\t\tclearTimeout(this._showTimer);\n\t}\n\n\tcloseDebounced(delayMultiplier = false)\n\t{\n\t\tthis.cancelShowDebounced();\n\t\tdelayMultiplier = parseInt(delayMultiplier) > 0 ? parseInt(delayMultiplier) : 1;\n\t\tthis.cancelCloseDebounced();\n\t\tthis._closeTimer = setTimeout(this.close.bind(this), this._closeTimeout * delayMultiplier);\n\t}\n\n\tcancelCloseDebounced()\n\t{\n\t\tclearTimeout(this._closeTimer);\n\t}\n\n\tadjustPosition()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (!popup || !popup.isShown() || !Type.isDomNode(this._bindElement)\n\t\t\t|| !Type.isDomNode(this._wrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst wrapperRect = this._wrapper.getBoundingClientRect();\n\t\tconst itemRect = this._bindElement.getBoundingClientRect();\n\n\t\tlet offsetLeft = wrapperRect.width - (itemRect.left - wrapperRect.left);\n\n\t\tlet offsetTop = itemRect.height / 2 + this._padding;\n\t\tlet angleOffset = itemRect.height / 2;\n\n\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\tconst popupHeight = popup.getPopupContainer().offsetHeight;\n\t\tconst popupBottom = itemRect.top + popupHeight;\n\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\t// let's try to fit a popup to the browser viewport\n\t\tconst exceeded = popupBottom - clientHeight;\n\t\tif (exceeded > 0)\n\t\t{\n\t\t\tlet roundOffset = Math.ceil(exceeded / itemRect.height) * itemRect.height;\n\t\t\tif (roundOffset > itemRect.top)\n\t\t\t{\n\t\t\t\t// it cannot be higher than the browser viewport.\n\t\t\t\troundOffset -= Math.ceil((roundOffset - itemRect.top) / itemRect.height) * itemRect.height;\n\t\t\t}\n\n\t\t\tif (itemRect.bottom > (popupBottom - roundOffset))\n\t\t\t{\n\t\t\t\t// let's sync bottom boundaries.\n\t\t\t\troundOffset -= itemRect.bottom - (popupBottom - roundOffset) + this._padding;\n\t\t\t}\n\n\t\t\toffsetTop += roundOffset;\n\t\t\tangleOffset += roundOffset + this._padding;\n\t\t}\n\n\t\tpopup.setBindElement(this._bindElement);\n\n\t\tif ((wrapperRect.left + offsetLeft + popupWidth) <= clientWidth)\n\t\t{\n\t\t\tpopup.setAngle({position: 'left', offset: angleOffset});\n\n\t\t\toffsetLeft += popup.angle ? popup.angle.element.offsetWidth : 0;\n\t\t\toffsetTop += popup.angle ? Math.ceil(popup.angle.element.offsetHeight / 2) : 0;\n\t\t\tpopup.setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setAngle(true);\n\t\t}\n\t\tpopup.adjustPosition();\n\t}\n\n\tclose()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tpopup ? popup.close() : null;\n\t\tthis.presetMenu.close();\n\t}\n\n\tremoveDebouncedEvents()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t\tthis.cancelShowDebounced();\n\t}\n\n\trefreshLayout()\n\t{\n\t\tlet popup = PopupManager.getPopupById(this._popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.setContent(this.getLayout());\n\t\t}\n\t}\n\n\tgetLayout()\n\t{\n\t\tif (this._isLoading)\n\t\t{\n\t\t\tlet loader = new Loader();\n\n\t\t\tlet container = Tag.render`<div class=\"crm-rq-wrapper crm-rq-wrapper-loading\"></div>`;\n\t\t\tloader.show(container);\n\t\t\treturn container;\n\t\t}\n\t\tlet requisites = Type.isNull(this._requisiteList) ? [] : this._requisiteList.getList();\n\t\tlet renderRequisiteEditButtonNode = (id) =>\n\t\t{\n\t\t\tif (this._isReadonly)\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_SHOW_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rq-org-requisite-btn-container\">\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onEditRequisite.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_EDIT')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" data-requisite-id=\"${id}\" onclick=\"${this.onDeleteRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_TOOLTIP_DELETE')}</span>\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onAddBankDetails.bind(this, id)}\">${Loc.getMessage('REQUISITE_TOOLTIP_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t};\n\n\t\tlet renderRequisiteBankDetails = (requisite, id) =>\n\t\t{\n\t\t\tlet bandDetails = requisite.getBankDetails();\n\t\t\tlet selectedBankDetailId = requisite.getSelectedBankDetailId();\n\t\t\treturn bandDetails.length ?\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-requisite-container\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-title\">${Loc.getMessage('REQUISITE_TOOLTIP_BANK_DETAILS_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"crm-rq-org-requisite-list\">\n\t\t\t\t\t\t\t${bandDetails.map((bankDetail, index) => Tag.render`\n\t\t\t\t\t\t\t\t<label class=\"crm-rq-org-requisite-item\" onclick=\"${this.onSetSelectedBankDetails.bind(this)}\">\n\t\t\t\t\t\t\t\t\t<input type=\"radio\" data-requisite-id=\"${id}\" data-bankdetails-id=\"${index}\" class=\"crm-rq-org-requisite-btn\" ${requisite.isSelected() && (index === selectedBankDetailId) ? ' checked' : ''} ${this._canChangeDefaultRequisite ? '': ' disabled'}>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-rq-org-requisite-info\">${Text.encode(bankDetail.value)}</span>\n\t\t\t\t\t\t\t\t</label>`)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${renderRequisiteEditButtonNode(id)}\n\t\t\t\t\t</div>`\n\t\t\t\t:\n\t\t\t\trenderRequisiteEditButtonNode(id)\n\t\t};\n\n\t\treturn Tag.render`\n\t\t<div class=\"crm-rq-wrapper\"\n\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\"\n\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\">\n\t\t\t<div class=\"crm-rq-org-list\">\n\t\t\t\t${requisites.map((requisite, index) => Tag.render`\n\t\t\t\t\t<div class=\"crm-rq-org-item${requisite.isSelected() ? ' crm-rq-org-item-selected' : ''}\" onclick=\"${this.onSetSelectedRequisite.bind(this, index)}\">\n\t\t\t\t\t\t<div class=\"crm-rq-org-info-container\">\n\t\t\t\t\t\t\t<div class=\"crm-rq-org-name\">${Text.encode(requisite.getTitle())}</div>\n\t\t\t\t\t\t\t${requisite.getSubtitle().length ? Tag.render`<div class=\"crm-rq-org-description\">${Text.encode(requisite.getSubtitle())}</div>` : ''}\n\t\t\t\t\t\t\t${renderRequisiteBankDetails(requisite, index)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}\n\t\t\t</div>\n\t\t\t${this._isReadonly ? '' :\n\t\t\tTag.render`<div class=\"crm-rq-btn-container\">\n\t\t\t\t<span class=\"crm-rq-add-rq\" onclick=\"${this.onStartAddRequisite.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-btn crm-rq-btn ui-btn-icon-custom ui-btn-primary ui-btn-round\"></span> ${Loc.getMessage('REQUISITE_TOOLTIP_ADD')}\n\t\t\t\t</span>\n\t\t\t</div>`}\n\t\t</div>`;\n\t}\n\n\tsetSelectedRequisite(id, bankDetailId)\n\t{\n\t\tlet newSelectedRequisite = this._requisiteList.getById(id);\n\t\tif (!newSelectedRequisite)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet selectedRequisite = this._requisiteList.getSelected();\n\t\tif (id === this._requisiteList.getSelectedId()) // selected the same requisite\n\t\t{\n\t\t\tlet selectedBankDetails = selectedRequisite.getBankDetails();\n\t\t\tif (selectedBankDetails.length)\n\t\t\t{\n\t\t\t\tfor (let index = 0; index < selectedBankDetails.length; index++)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetails = selectedBankDetails[index];\n\t\t\t\t\tif (Type.isObject(bankDetails) && bankDetails.selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (index === bankDetailId || Type.isNull(bankDetailId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false; // selected same requisite and bank details\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn false; // requisite already selected and hasn't bank details\n\t\t\t}\n\t\t}\n\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {id, bankDetailId});\n\n\t\treturn true;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tthis.cancelCloseDebounced();\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif (!this.presetMenu.isShown())\n\t\t{\n\t\t\tthis.closeDebounced(1.5);\n\t\t}\n\t}\n\n\tonStartAddRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.presetMenu.toggle(event.target);\n\n\t}\n\n\tonAddRequisite(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.close();\n\t\tEventEmitter.emit(this, 'onAddRequisite', {\n\t\t\tpresetId: data.value\n\t\t});\n\t}\n\n\tonEditRequisite(id, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onEditRequisite', {id});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (Type.isDomNode(element))\n\t\t{\n\t\t\tlet id = element.getAttribute('data-requisite-id');\n\t\t\tEventEmitter.emit(this, 'onDeleteRequisite', {id});\n\t\t}\n\t}\n\n\tonAddBankDetails(requisiteId, event)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.close();\n\n\t\tEventEmitter.emit(this, 'onAddBankDetails', {requisiteId});\n\t}\n\n\tonSetSelectedRequisite(id)\n\t{\n\t\tif (this._canChangeDefaultRequisite)\n\t\t{\n\t\t\tthis.setSelectedRequisite(id, null);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonSetSelectedBankDetails(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet element = event.target;\n\t\tif (this._canChangeDefaultRequisite && Type.isDomNode(element))\n\t\t{\n\t\t\tif (element.nodeName.toString().toLowerCase() !== 'input')\n\t\t\t{\n\t\t\t\telement = element.querySelector('input');\n\t\t\t\tif (!Type.isDomNode(element))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.checked = false;\n\t\t\tlet id = parseInt(element.getAttribute('data-requisite-id'));\n\t\t\tlet bankDetailsId = parseInt(element.getAttribute('data-bankdetails-id'));\n\t\t\tthis.setSelectedRequisite(id, bankDetailsId);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonChangeRequisites(event)\n\t{\n\t\tthis.refreshLayout();\n\t}\n}","import {Loc, Tag, Dom, Type, Event} from \"main.core\";\nimport {RequisiteAutocompleteField} from \"crm.entity-editor.field.requisite.autocomplete\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteTooltip} from './requisite-tooltip';\nimport {PresetMenu} from './preset-menu';\n\nexport class EntityEditorRequisiteField extends BX.Crm.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._domNodes = {};\n\t\tthis._requisiteList = null;\n\n\t\tthis.presetMenu = null;\n\t\tthis._autocomplete = null;\n\t\tthis._tooltip = null;\n\t\tthis.isSearchMode = true;\n\t\tthis.requisitesDropdown = null;\n\t\tthis.bankDetailsDropdown = null;\n\t\tthis.selectModeEnabled = false;\n\n\t\tthis._changeRequisistesHandler = this.onChangeRequisites.bind(this);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._autocomplete = RequisiteAutocompleteField.create(this.getName(), {\n\t\t\tsearchAction: 'crm.requisite.entity.search',\n\t\t\tcanAddRequisite: true,\n\t\t\tfeedbackFormParams: BX.prop.getObject(this._schemeElement.getData(), \"feedback_form\", {}),\n\t\t\tenabled: true,\n\t\t\tshowFeedbackLink: false\n\t\t});\n\t\tthis._autocomplete.subscribe('onSelectValue', this.onSelectAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onCreateNewItem', this.onAddRequisiteFromAutocomplete.bind(this));\n\t\tthis._autocomplete.subscribe('onClear', this.onClearAutocompleteValue.bind(this));\n\t\tthis._autocomplete.subscribe('onInstallDefaultApp', this.onInstallDefaultApp.bind(this));\n\t\tEventEmitter.subscribe(\n\t\t\t\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\",\n\t\t\tthis.onInstallDefaultAppGlobal.bind(this)\n\t\t);\n\n\t\tthis.presetMenu = new PresetMenu(this.getName() + '_requisite_preset_menu', this.getPresetList());\n\t\tthis.presetMenu.subscribe('onSelect', this.onAddRequisiteFromMenu.bind(this));\n\n\t\tconst isReadonly = this.getEditor().isReadOnly();\n\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this.getName() + '_requisite_details', {\n\t\t\treadonly: isReadonly,\n\t\t\tcanChangeDefaultRequisite: !isReadonly,\n\t\t\tpresets: this.getPresetList()\n\t\t});\n\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onAddRequisiteFromTooltip.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\n\t\tthis.updateAutocompletePlaceholder();\n\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\tsetSelectModeEnabled(selectModeEnabled: boolean): void\n\t{\n\t\tif (this.selectModeEnabled !== selectModeEnabled)\n\t\t{\n\t\t\tthis.selectModeEnabled = selectModeEnabled;\n\t\t\tif (this.isSelectModeEnabled())\n\t\t\t{\n\t\t\t\tthis.isSearchMode = false;\n\t\t\t}\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t}\n\n\tisSelectModeEnabled(): boolean\n\t{\n\t\treturn this.selectModeEnabled && this.hasRequisites() && this.getRequisites().getList().length > 0;\n\t}\n\n\tsetRequisites(requisiteList)\n\t{\n\t\tconst hasRequisites = this.hasRequisites();\n\t\tconst vasEmpty = hasRequisites && this.getRequisites().isEmpty();\n\t\tthis._requisiteList = requisiteList;\n\t\trequisiteList.unsubscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\trequisiteList.subscribe(requisiteList.CHANGE_EVENT, this._changeRequisistesHandler);\n\t\tthis._tooltip.setRequisites(requisiteList);\n\t\tif (hasRequisites && !vasEmpty && !this.getRequisites().isEmpty())\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayout();\n\t\t}\n\t}\n\n\tgetRequisites()\n\t{\n\t\treturn this._requisiteList;\n\t}\n\n\thasRequisites()\n\t{\n\t\treturn Type.isObject(this._requisiteList);\n\t}\n\n\tisSingleMode()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.getRequisites().getList().length <= 1);\n\t}\n\n\tgetTitle()\n\t{\n\t\tlet title = super.getTitle();\n\t\tif (this.hasRequisites() && !this.isSingleMode())\n\t\t{\n\t\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t\tlet selectedPresetId = selectedRequisite ? selectedRequisite.getPresetId() : null;\n\t\t\tif (selectedRequisite && selectedPresetId)\n\t\t\t{\n\t\t\t\tlet selectedPresetName = this.getPresetList().reduce(\n\t\t\t\t\t(name, item) => ((item.value === selectedPresetId) ? item.name : name), '');\n\n\t\t\t\tif (selectedPresetName.length)\n\t\t\t\t{\n\t\t\t\t\ttitle += ' (' + selectedPresetName + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn title;\n\t}\n\n\tcreateTitleActionControls()\n\t{\n\t\tconst actions = [];\n\n\t\tif (this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn actions;\n\t\t}\n\n\t\tif (this.isAutocompleteEnabled() && this.selectModeEnabled)\n\t\t{\n\t\t\tif (this.isSearchMode)\n\t\t\t{\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_SELECT')}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst title = this.getClientResolverTitle();\n\t\t\t\tactions.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t\t\tonclick=\"${this.toggleSearchMode.bind(this)}\">${title}</span>`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tactions.push(Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\"\n\t\t\t\t \tonclick=\"${this.editDefaultRequisite.bind(this)}\">${Loc.getMessage('REQUISITE_LABEL_DETAILS_TEXT')}</span>`\n\t\t\t);\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\ttoggleSearchMode()\n\t{\n\t\tthis.isSearchMode = !this.isSearchMode;\n\n\t\tthis.refreshLayoutParts();\n\t}\n\n\tisNeedToDisplay(options)\n\t{\n\t\treturn this.hasRequisites() && super.isNeedToDisplay(options);\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._domNodes = {};\n\t\tthis.ensureWrapperCreated({classNames: [\"crm-entity-widget-content-block-field-requisites\"]});\n\t\tthis.adjustWrapper();\n\t\tthis.bindWrapperEvents();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(this.getTitle()), this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._domNodes.addButton = this.renderAddButton();\n\t\t\tthis._domNodes.autocompleteForm = this.renderAutocompleteForm();\n\t\t\tthis._domNodes.requisiteSelectForm = this.renderRequisiteSelectForm();\n\t\t\tthis._domNodes.bankDetailSelectForm = this.renderBankDetailSelectForm();\n\t\t\tDom.append(this._domNodes.autocompleteForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.requisiteSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.bankDetailSelectForm, this._wrapper);\n\t\t\tDom.append(this._domNodes.addButton, this._wrapper);\n\n\t\t\tthis.adjustNodesVisibility();\n\t\t\tthis.updateRequisitesDropdown();\n\t\t\tthis.updateBankDetailsDropdown();\n\t\t\tthis.updateRequisiteSelectorValue();\n\t\t\tthis.updateBankDetailsSelectorValue();\n\t\t}\n\t\telse // if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tDom.append(this.renderSelectedRequisite(), this._wrapper);\n\t\t}\n\n\t\tif (this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif (this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tbindWrapperEvents()\n\t{\n\t\tif (!this.wrapperMouseEnterHandler)\n\t\t{\n\t\t\tthis.wrapperMouseEnterHandler = this.onFieldMouseEnter.bind(this);\n\t\t}\n\t\tif (!this.wrapperMouseLeaveHandler)\n\t\t{\n\t\t\tthis.wrapperMouseLeaveHandler = this.onFieldMouseLeave.bind(this);\n\t\t}\n\n\t\tEvent.unbind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.unbind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\n\t\tEvent.bind(this._wrapper, 'mouseenter', this.wrapperMouseEnterHandler);\n\t\tEvent.bind(this._wrapper, 'mouseleave', this.wrapperMouseLeaveHandler);\n\t}\n\n\trefreshLayoutParts()\n\t{\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.refreshTitleLayout();\n\t\tthis.updateAutocompleteState();\n\t\tthis.adjustNodesVisibility();\n\t\tthis.updateRequisitesDropdown();\n\t\tthis.updateBankDetailsDropdown();\n\t\tthis.updateRequisiteSelectorValue();\n\t\tthis.updateBankDetailsSelectorValue();\n\t}\n\n\thasContentToDisplay()\n\t{\n\t\treturn this.hasValue();\n\t}\n\n\thasValue()\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn  false;\n\t\t}\n\t\tlet list = this.getRequisites().getList();\n\t\tif (list.length > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\t// if list contains only one item, it shouldn't be hidden:\n\t\treturn (list.length === 1 && !list[0].isAddressOnly());\n\t}\n\n\tisAutocompleteEnabled()\n\t{\n\t\tif (\n\t\t\t!this.hasRequisites()\n\t\t\t|| this.getRequisites().isEmpty()\n\t\t\t|| this.getRequisites().getSelected().isAddressOnly()\n\t\t)\n\t\t{\n\t\t\treturn !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trenderSelectedRequisite()\n\t{\n\t\tthis._domNodes.selectedRequisiteView = Tag.render`<span></span>`;\n\t\tthis.updateSelectedRequisiteText();\n\t\tthis.updateAutocompleteState();\n\t\tlet container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\" \n\t\t\t\tonclick=\"${this.onViewStringClick.bind(this)}\"\n\t\t\t\tonmouseenter=\"${this.onViewStringMouseEnter.bind(this)}\">\n\t\t\t\t\t${this._domNodes.selectedRequisiteView}\n\t\t\t</div>`;\n\t\tthis._tooltip.setBindElement(container, this.getEditor().getFormElement());\n\n\t\treturn container;\n\t}\n\n\tupdateSelectedRequisiteText()\n\t{\n\t\tif (!this._domNodes.selectedRequisiteView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet selectedRequisite = this.hasRequisites() && this.getRequisites().getSelected();\n\t\tif (this.hasValue() && selectedRequisite && selectedRequisite.getTitle().length)\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.add('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = selectedRequisite.getTitle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.selectedRequisiteView.classList.remove('ui-link', 'ui-link-dark', 'ui-link-dotted');\n\t\t\tthis._domNodes.selectedRequisiteView.textContent = BX.UI.EntityEditorField.messages.isEmpty;\n\t\t}\n\t}\n\n\trenderAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block crm-entity-widget-content-block-requisites\">\n\t\t\t\t<span class=\"crm-entity-widget-client-requisites-add-btn\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t</div>`;\n\t}\n\n\trenderAutocompleteForm()\n\t{\n\t\tconst autocompleteContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\"></div>`;\n\t\tconst hasResolvers = !!this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\tthis._autocomplete.setEnabled(hasResolvers);\n\t\tthis._autocomplete.layout(autocompleteContainer);\n\t\tthis.updateAutocompleteState();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${autocompleteContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderRequisiteSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.requisitesDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.requisitesDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tconst selectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.requisitesDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onRequisiteSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${selectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.toggleNewRequisitePresetMenu.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_REQUISITE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderBankDetailSelectForm()\n\t{\n\t\tlet isOpen = false;\n\t\tconst toggleDropdown = () => {\n\t\t\tif (this.bankDetailsDropdown)\n\t\t\t{\n\t\t\t\tif (!isOpen)\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.showPopupWindow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.bankDetailsDropdown.destroyPopupWindow();\n\t\t\t\t}\n\t\t\t\tisOpen = !isOpen;\n\t\t\t}\n\t\t};\n\n\t\tconst selectInput = Tag.render`<div class=\"ui-ctl-element\" onclick=\"${toggleDropdown}\"></div>`;\n\n\t\tthis._domNodes.bankDetailsSelectContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-field-requisites\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">\n\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-angle\" onclick=\"${toggleDropdown}\"></button>\n\t\t\t\t\t${selectInput}\n\t\t\t\t</div>\t\t\t\n\t\t\t</div>`;\n\n\t\tthis.bankDetailsDropdown = new BX.UI.Dropdown(\n\t\t\t{\n\t\t\t\ttargetElement: selectInput,\n\t\t\t\titems: [],\n\t\t\t\tisDisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onBankDetailSelect.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t${this._domNodes.bankDetailsSelectContainer}\n\t\t\t\t<div class=\"crm-entity-widget-content-block-add-field\">\n\t\t\t\t\t<span class=\"crm-entity-widget-content-add-field\" onclick=\"${this.onAddBankDetailsClick.bind(this)}\">${Loc.getMessage('CRM_EDITOR_ADD_BANK_DETAILS')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\tupdateAutocompleteState()\n\t{\n\t\tlet autocompleteValue = null;\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite && !selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tautocompleteValue = selectedRequisite.getAutocompleteData();\n\t\t}\n\t\tthis._autocomplete.setCurrentItem(autocompleteValue);\n\t\tthis._autocomplete.setContext(this.getAutocompleteContext());\n\t}\n\n\tupdateAutocompletePlaceholder()\n\t{\n\t\tconst clientResolverPropTitle = this.getClientResolverTitle();\n\t\tthis._autocomplete.setEnabled(!!clientResolverPropTitle);\n\t\tthis._autocomplete.setPlaceholderText(clientResolverPropTitle);\n\t}\n\n\tupdateAutocompeteClientResolverPlacementParams()\n\t{\n\t\tthis._autocomplete.setClientResolverPlacementParams(this.getClientResolverPlacementParams());\n\t}\n\n\tgetClientResolverPlacementParams()\n\t{\n\t\tconst clientResolverProp = this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\n\t\treturn (\n\t\t\tclientResolverProp\n\t\t\t\t? {\n\t\t\t\t\t\"isPlacement\": BX.prop.getString(clientResolverProp, \"IS_PLACEMENT\", \"N\") === \"Y\",\n\t\t\t\t\t\"numberOfPlacements\": BX.prop.getArray(clientResolverProp, \"PLACEMENTS\", []).length,\n\t\t\t\t\t\"countryId\": BX.prop.getInteger(clientResolverProp, \"COUNTRY_ID\", 0),\n\t\t\t\t\t\"defaultAppInfo\": BX.prop.getObject(clientResolverProp, \"DEFAULT_APP_INFO\", {})\n\t\t\t\t}\n\t\t\t\t: {}\n\t\t);\n\t}\n\n\tgetClientResolverTitle()\n\t{\n\t\tlet title = \"\";\n\n\t\tconst clientResolverProp = this.getClientResolverPropForPreset(this.getSelectedPresetId());\n\t\ttitle = BX.prop.getString(clientResolverProp, \"TITLE\", \"\");\n\t\tconst isPlacement = (BX.prop.getString(clientResolverProp, 'IS_PLACEMENT', 'N') === 'Y');\n\t\tif (!isPlacement && Type.isStringFilled(title))\n\t\t{\n\t\t\ttitle = Loc.getMessage('REQUISITE_AUTOCOMPLETE_FILL_IN').toLowerCase().replace('#field_name#', title);\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tadjustNodesVisibility()\n\t{\n\t\tif (\n\t\t\t!this._domNodes.autocompleteForm\n\t\t\t|| !this._domNodes.requisiteSelectForm\n\t\t\t|| !this._domNodes.bankDetailSelectForm\n\t\t\t|| !this._domNodes.addButton\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSearchMode && this.isAutocompleteEnabled())\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = '';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t\telse if (\n\t\t\tthis.isSelectModeEnabled()\n\t\t\t&& this.hasRequisites()\n\t\t\t&&\n\t\t\t(\n\t\t\t\tthis.getRequisites().getList().length > 1\n\t\t\t \t|| (\n\t\t\t\t\tthis.getRequisites().getList().length > 0)\n\t\t\t\t\t&& !this.getRequisites().getSelected().isAddressOnly()\n\t\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = '';\n\t\t\tthis._domNodes.addButton.style.display = 'none';\n\n\t\t\tif (this._domNodes.bankDetailsSelectContainer)\n\t\t\t{\n\t\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\t\tif (!bankDetails.length)\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = 'none';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._domNodes.bankDetailsSelectContainer.style.display = '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._domNodes.autocompleteForm.style.display = 'none';\n\t\t\tthis._domNodes.requisiteSelectForm.style.display = 'none';\n\t\t\tthis._domNodes.addButton.style.display = '';\n\t\t\tthis._domNodes.bankDetailSelectForm.style.display = 'none';\n\t\t}\n\t}\n\n\tgetSelectedRequisiteTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\ttitle = selectedRequisite.getTitle();\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tupdateRequisiteSelectorValue()\n\t{\n\t\tif (!this.requisitesDropdown || !this.requisitesDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requisitesDropdown.targetElement.innerText = this.getSelectedRequisiteTitle();\n\t}\n\n\tupdateBankDetailsSelectorValue()\n\t{\n\t\tif (!this.bankDetailsDropdown || !this.bankDetailsDropdown.targetElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.bankDetailsDropdown.targetElement.innerText = this.getSelectedBankDetailTitle();\n\t}\n\n\tgetSelectedBankDetailTitle()\n\t{\n\t\tlet title = '';\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst selectedRequisite = this.getRequisites().getSelected();\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\tconst bankDetail = selectedRequisite.getBankDetailById(selectedRequisite.getSelectedBankDetailId());\n\t\t\tif (bankDetail && bankDetail.title)\n\t\t\t{\n\t\t\t\ttitle = bankDetail.title;\n\t\t\t}\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tgetDefaultPresetId()\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.IS_DEFAULT)\n\t\t\t{\n\t\t\t\treturn preset.VALUE;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetSelectedPresetId()\n\t{\n\t\tlet selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\tif (selectedRequisite)\n\t\t{\n\t\t\treturn selectedRequisite.getPresetId();\n\t\t}\n\t\treturn this.getDefaultPresetId();\n\t}\n\n\tgetClientResolverPropForPreset(presetId)\n\t{\n\t\tfor (let preset of BX.prop.getArray(this._schemeElement.getData(), \"presets\", []))\n\t\t{\n\t\t\tif (preset.VALUE === presetId)\n\t\t\t{\n\t\t\t\treturn BX.prop.get(preset, 'CLIENT_RESOLVER_PROP', null);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetAutocompleteContext()\n\t{\n\t\treturn {\n\t\t\tpresetId: this.getSelectedPresetId()\n\t\t};\n\t}\n\n\ttoggleNewRequisitePresetMenu(e)\n\t{\n\t\tthis.presetMenu.toggle(e.target);\n\t};\n\n\tgetPresetList()\n\t{\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._schemeElement.getData(), \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\taddRequisite(params)\n\t{\n\t\tEventEmitter.emit(this, 'onEditNew', params);\n\t}\n\n\teditRequisite(id, options)\n\t{\n\t\tEventEmitter.emit(this, 'onEditExisted', {id, options});\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tthis._tooltip.removeDebouncedEvents();\n\t\tthis._tooltip.close();\n\t\tEventEmitter.emit(this, 'onDelete', {id, postponed: this._mode === BX.UI.EntityEditorMode.edit});\n\t}\n\n\thideRequisite(id)\n\t{\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setCurrentItem(null);\n\t\tEventEmitter.emit(this, 'onHide', {id});\n\t}\n\n\tshowDeleteConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.markAsChanged();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tshowClearConfirmation(requisiteId)\n\t{\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"hide_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_HIDE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.hideRequisite(requisiteId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\teditDefaultRequisite()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: this.getDefaultPresetId(),\n\t\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t\t});\n\t\t}\n\t}\n\n\tonChangeRequisites()\n\t{\n\t\tif (\n\t\t\t(this._domNodes && Type.isDomNode(this._domNodes.addButton) && this._domNodes.addButton.style.display !== 'none') ||\n\t\t\t(this.hasRequisites() && this.getRequisites().isEmpty()) ||\n\t\t\t(this.hasRequisites() && this.getRequisites().getSelected().isAddressOnly())\n\t\t)\n\t\t{\n\t\t\t// this.refreshLayout();\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshLayoutParts();\n\t\t}\n\t\tthis.updateAutocompletePlaceholder();\n\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\t}\n\n\tupdateRequisitesDropdown()\n\t{\n\t\tif (!this.requisitesDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites())\n\t\t{\n\t\t\tthis.getRequisites().getList().forEach((requisiteItem, index) => {\n\t\t\t\titems.push({\n\t\t\t\t\tid: requisiteItem.getRequisiteId(),\n\t\t\t\t\ttitle: requisiteItem.getTitle(),\n\t\t\t\t\tsubTitle: requisiteItem.getSubtitle(),\n\t\t\t\t\tindex\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.requisitesDropdown.setItems(items);\n\t}\n\n\tupdateBankDetailsDropdown()\n\t{\n\t\tif (!this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.hasRequisites() && this.getRequisites().getSelected())\n\t\t{\n\t\t\tconst bankDetails = this.getRequisites().getSelected().getBankDetails();\n\t\t\tif (bankDetails.length)\n\t\t\t{\n\t\t\t\tbankDetails.forEach((bankDetail, index) => {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: bankDetail.id,\n\t\t\t\t\t\ttitle: bankDetail.title,\n\t\t\t\t\t\tsubTitle: bankDetail.value,\n\t\t\t\t\t\tindex\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.setItems(items);\n\t}\n\n\tonRequisiteSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId());\n\t\t\tif (selectedRequisiteId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\t\tif (this.requisitesDropdown)\n\t\t{\n\t\t\tthis.requisitesDropdown.getPopupWindow().close();\n\t\t}\n\t}\n\n\tonBankDetailSelect(sender, {index})\n\t{\n\t\tif (!this.hasRequisites() || !this.bankDetailsDropdown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (index !== undefined)\n\t\t{\n\t\t\tconst selectedRequisiteId = Number(this.getRequisites().getSelectedId())\n\t\t\tconst selectedBankDetailId = Number(this.getRequisites().getSelected().getSelectedBankDetailId());\n\t\t\tif (selectedBankDetailId !== index)\n\t\t\t{\n\t\t\t\tthis.getRequisites().setSelected(selectedRequisiteId, index);\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t}\n\n\t\tthis.bankDetailsDropdown.getPopupWindow().close();\n\t}\n\n\tonAddRequisiteFromMenu(event)\n\t{\n\t\tlet data = event.getData();\n\t\tconst selectedRequisite = this.hasRequisites() ? this.getRequisites().getSelected() : null;\n\t\t// if hidden requisite is selected, it will be used instead of new:\n\t\tif (null !== selectedRequisite && selectedRequisite.isAddressOnly())\n\t\t{\n\t\t\tthis.editRequisite(this.getRequisites().getSelectedId(), {\n\t\t\t\teditorOptions: {\n\t\t\t\t\toverriddenPresetId: data.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRequisite({\n\t\t\t\tpresetId: data.value\n\t\t\t});\n\t\t}\n\t}\n\n\tonAddRequisiteFromTooltip(event)\n\t{\n\t\tthis.addRequisite(event.getData());\n\t}\n\n\tonAddRequisiteFromAutocomplete()\n\t{\n\t\tthis.editDefaultRequisite();\n\t}\n\n\tonEditRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.id, {\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.showDeleteConfirmation(eventData.id);\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis.editRequisite(eventData.requisiteId, {\n\t\t\teditorOptions: {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t},\n\t\t\tautocompleteState: this._autocomplete.getState()\n\t\t});\n\t}\n\n\tonSelectAutocompleteValue(event)\n\t{\n\t\tlet data = event.getData();\n\t\tthis.markAsChanged();\n\t\tthis._autocomplete.setLoading(true);\n\t\tif (this.selectModeEnabled)\n\t\t{\n\t\t\tthis.isSearchMode = false;\n\t\t}\n\t\tconst selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tEventEmitter.emit(this, 'onFinishAutocomplete', {\n\t\t\tid: selectedRequisiteId,\n\t\t\tdefaultPresetId: this.getDefaultPresetId(),\n\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\tdata\n\t\t});\n\t}\n\n\tonClearAutocompleteValue()\n\t{\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tlet selectedRequisite = this.getRequisites().getSelected();\n\t\t\tlet hasAddresses = false;\n\t\t\tlet addresses = selectedRequisite.getAddressList();\n\t\t\tfor (let addressType in addresses)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\taddresses.hasOwnProperty(addressType) &&\n\t\t\t\t\tType.isStringFilled(addresses[addressType])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\thasAddresses = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasAddresses)\n\t\t\t{\n\t\t\t\tthis.showClearConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDeleteConfirmation(selectedRequisiteId);\n\t\t\t}\n\t\t}\n\t}\n\n\tonInstallDefaultApp()\n\t{\n\t\tBX.onGlobalCustomEvent(\"BX.Crm.RequisiteAutocomplete:onAfterInstallDefaultApp\");\n\t}\n\n\tonInstallDefaultAppGlobal()\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'crm.requisite.schemedata.getRequisitesSchemeData',\n\t\t\t{ data: { entityTypeId: this.getEditor().getEntityTypeId() } }\n\t\t).then(\n\t\t\t(data) => {\n\t\t\t\tif (\n\t\t\t\t\tType.isPlainObject(data)\n\t\t\t\t\t&& data.hasOwnProperty(\"data\")\n\t\t\t\t\t&& Type.isPlainObject(data[\"data\"])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis._schemeElement.setData(data[\"data\"]);\n\t\t\t\t\tthis.updateAutocompletePlaceholder();\n\t\t\t\t\tthis.updateAutocompeteClientResolverPlacementParams();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonViewStringClick()\n\t{\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t\tthis.switchToSingleEditMode();\n\t\t}\n\t}\n\n\tonViewStringMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced();\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tif (!this.getEditor().isReadOnly())\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onSetDefault', eventData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonFieldMouseEnter()\n\t{\n\t\tif (this._mode === BX.UI.EntityEditorMode.view && this.hasValue())\n\t\t{\n\t\t\tthis._tooltip.showDebounced(5);\n\t\t}\n\t}\n\n\tonFieldMouseLeave()\n\t{\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t}\n\n\tonAddBankDetailsClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tlet selectedRequisiteId = this.hasRequisites() ? this.getRequisites().getSelectedId() : null;\n\t\tif (null !== selectedRequisiteId)\n\t\t{\n\t\t\tthis.editRequisite(selectedRequisiteId, {\n\t\t\t\tautocompleteState: this._autocomplete.getState(),\n\t\t\t\teditorOptions: {\n\t\t\t\t\taddBankDetailsItem: true\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","import {EntityEditorAddressField} from \"crm.entity-editor.field.address\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class EntityEditorRequisiteAddressField extends EntityEditorAddressField\n{\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tEventEmitter.emit(this.getEditor(), 'onFieldInit', {field: this});\n\t}\n\n\trollback()\n\t{\n\t\t// rollback will be executed in requisite controller\n\t}\n\n\treset()\n\t{\n\t\t// reset will be executed in requisite controller\n\t}\n\n\tonAddressListUpdate(event)\n\t{\n\t\tsuper.onAddressListUpdate(event);\n\t\tEventEmitter.emit(this, 'onAddressListUpdate', event);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n","import {Loc, Dom, Type, Tag} from \"main.core\";\nimport {Loader} from \"main.loader\";\nimport {EntityEditorBaseAddressField} from \"crm.entity-editor.field.address.base\";\nimport {RequisiteList, RequisiteListItem} from \"./requisite-list\";\nimport {EntityEditorRequisiteTooltip} from \"./requisite-tooltip\";\nimport {EventEmitter} from \"main.core.events\";\nimport {EntityEditorRequisiteEditor} from \"./requisite-editor\";\n\nexport class EntityEditorClientRequisites\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._entityInfo = null;\n\t\tthis._fieldsParams = null;\n\t\tthis._loaderConfig = null;\n\t\tthis._addressConfig = null;\n\t\tthis._requisiteList = null;\n\t\tthis._requisiteEditor = null;\n\t\tthis._permissionToken = null;\n\n\t\tthis._readonly = true;\n\t\tthis._requisiteEditUrl = null;\n\t\tthis._addressContainer = null;\n\t\tthis._formElement = null;\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.setEntity(BX.prop.get(settings, \"entityInfo\", null), false);\n\t\tif (!this._entityInfo)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: EntityInfo must be instance of BX.CrmEntityInfo\";\n\t\t}\n\t\tthis._fieldsParams = BX.prop.get(settings, \"fieldsParams\", null);\n\t\tif (!this._fieldsParams)\n\t\t{\n\t\t\tthrow \"EntityEditorClientRequisites: Fields params are undefined\";\n\t\t}\n\t\tthis._addressConfig = BX.prop.getObject(this._fieldsParams, 'ADDRESS', null);\n\n\t\tthis._requisitesConfig = BX.prop.getObject(this._fieldsParams, 'REQUISITES', null);\n\n\t\tif (this._requisiteList)\n\t\t{\n\t\t\tlet selectedItem = BX.prop.getObject(settings, \"requisiteBinding\", null);\n\t\t\tif (selectedItem\n\t\t\t\t&& !Type.isUndefined(selectedItem.REQUISITE_ID) && !Type.isUndefined(selectedItem.BANK_DETAIL_ID))\n\t\t\t{\n\t\t\t\tlet requisite = this._requisiteList.getByRequisiteId(selectedItem.REQUISITE_ID);\n\t\t\t\tif (requisite)\n\t\t\t\t{\n\t\t\t\t\tlet bankDetail = selectedItem.BANK_DETAIL_ID > 0 ?\n\t\t\t\t\t\trequisite.getBankDetailByBankDetailId(selectedItem.BANK_DETAIL_ID) : null;\n\t\t\t\t\tthis._requisiteList.setSelected(\n\t\t\t\t\t\tthis._requisiteList.indexOf(requisite),\n\t\t\t\t\t\tbankDetail ? requisite.getBankDetails().indexOf(bankDetail) : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._loaderConfig = BX.prop.getObject(settings, 'loaderConfig', null);\n\n\t\tthis._readonly = BX.prop.getBoolean(settings, \"readonly\", true);\n\t\tthis._canChangeDefaultRequisite = BX.prop.getBoolean(settings, \"canChangeDefaultRequisite\", true);\n\t\tthis._requisiteEditUrl = BX.prop.getString(settings, \"requisiteEditUrl\", null);\n\t\tthis._formElement = BX.prop.get(settings, \"formElement\", null);\n\t\tthis._permissionToken = BX.prop.getString(settings, \"permissionToken\", null);\n\n\t\tif (BX.prop.getBoolean(settings, \"enableTooltip\", true) && !Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\tthis._tooltip = EntityEditorRequisiteTooltip.create(this._id + '_client_requisite_details', {\n\t\t\t\treadonly: this._readonly,\n\t\t\t\tcanChangeDefaultRequisite: this._canChangeDefaultRequisite,\n\t\t\t\tpresets: this.getRequisitesPresetList()\n\t\t\t});\n\t\t}\n\n\t\tthis._requisiteEditor = EntityEditorRequisiteEditor.create(this._id + '_rq_editor', {\n\t\t\tentityTypeId: this._entityInfo.getTypeId(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\tcontextId: BX.prop.getString(settings, \"contextId\", \"\"),\n\t\t\trequisiteEditUrl: this._requisiteEditUrl,\n\t\t\tpermissionToken: this._permissionToken\n\t\t});\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterEditRequisite', this.onRequisiteEditorAfterEdit.bind(this));\n\t\tEventEmitter.subscribe(this._requisiteEditor, 'onAfterDeleteRequisite', this.onRequisiteEditorAfterDelete.bind(this));\n\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddRequisite', this.onEditNewRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onEditRequisite', this.onEditExistedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onDeleteRequisite', this.onDeleteRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onAddBankDetails', this.onAddBankDetails.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onSetSelectedRequisite', this.onSetSelectedRequisite.bind(this));\n\t\t\tEventEmitter.subscribe(this._tooltip, 'onShow', this.onShowTooltip.bind(this));\n\t\t}\n\t}\n\n\tsetEntity(entityInfo, emitNotification)\n\t{\n\t\tthis._entityInfo = entityInfo;\n\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._requisiteList = RequisiteList.create(this._entityInfo.getRequisites());\n\t\t}\n\t\tif (emitNotification)\n\t\t{\n\t\t\tthis.onChangeRequisiteList();\n\t\t}\n\t}\n\n\taddressLayout(container)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._addressContainer = Tag.render`<div class=\"crm-entity-widget-client-address\"></div>`;\n\t\tDom.append(this._addressContainer, container);\n\t\tthis.doAddressLayout();\n\t}\n\n\tdoAddressLayout()\n\t{\n\t\tif (!Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this._addressContainer);\n\n\t\tif (!Type.isNull(this._addressConfig))\n\t\t{\n\t\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t\t{\n\t\t\t\tlet defaultRequisite = this._requisiteList.getSelected();\n\t\t\t\tlet addressValue = defaultRequisite ? defaultRequisite.getAddressList() : null;\n\n\t\t\t\tif (!Type.isNull(addressValue) && Object.keys(addressValue).length)\n\t\t\t\t{\n\t\t\t\t\tlet countryId = 0;\n\t\t\t\t\tif (defaultRequisite)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountryId = parseInt(defaultRequisite.getPresetCountryId());\n\t\t\t\t\t}\n\t\t\t\t\tthis._addressField = EntityEditorBaseAddressField.create(this._entityInfo.getId(), {\n\t\t\t\t\t\tshowFirstItemOnly: true,\n\t\t\t\t\t\tshowAddressTypeInViewMode: true,\n\t\t\t\t\t\taddressZoneConfig: BX.prop.getObject(this._addressConfig, \"addressZoneConfig\", {}),\n\t\t\t\t\t\tcountryId: countryId\n\t\t\t\t\t});\n\t\t\t\t\tthis._addressField.setMultiple(true);\n\t\t\t\t\tthis._addressField.setTypesList(BX.prop.getObject(this._addressConfig, \"types\", {}));\n\t\t\t\t\tthis._addressField.setValue(addressValue);\n\t\t\t\t\tDom.append(this._addressField.layout(false), this._addressContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet showAddressLink = Tag.render`\n\t\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dotted\" onmouseup=\"${this.onLoadAddressMouseUp.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('CLIENT_REQUISITES_ADDRESS_SHOW_ADDRESS')}\n\t\t\t\t</span>`;\n\n\t\t\t\tDom.append(showAddressLink, this._addressContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowTooltip(bindElement)\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tif (this.isRequisiteAddressOnly())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._tooltip.setBindElement(bindElement, this._formElement);\n\t\tthis._tooltip.showDebounced();\n\t}\n\n\tcloseTooltip()\n\t{\n\t\tif (!this._tooltip)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._tooltip.closeDebounced();\n\t\tthis._tooltip.cancelShowDebounced();\n\t\tthis._showTooltipOnEntityLoad = false;\n\t}\n\n\trelease()\n\t{\n\t\tif (this._addressField)\n\t\t{\n\t\t\tthis._addressField.release();\n\t\t}\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t}\n\t\tif (this._requisiteEditor)\n\t\t{\n\t\t\tthis._requisiteEditor.release();\n\t\t}\n\t}\n\n\tloadEntity()\n\t{\n\t\tif (!this._loaderConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isDomNode(this._addressContainer))\n\t\t{\n\t\t\tlet loader = new Loader({size: 19, mode: 'inline'});\n\t\t\tDom.clean(this._addressContainer);\n\t\t\tloader.show(this._addressContainer);\n\t\t}\n\n\t\tBX.CrmDataLoader.create(\n\t\t\tthis._id,\n\t\t\t{\n\t\t\t\tserviceUrl: this._loaderConfig[\"url\"],\n\t\t\t\taction: this._loaderConfig[\"action\"],\n\t\t\t\tparams: {\n\t\t\t\t\t\"ENTITY_TYPE_NAME\": this._entityInfo.getTypeName(),\n\t\t\t\t\t\"ENTITY_ID\": this._entityInfo.getId(),\n\t\t\t\t\t\"NORMALIZE_MULTIFIELDS\": \"Y\"\n\t\t\t\t}\n\t\t\t}\n\t\t).load(this.onEntityInfoLoad.bind(this));\n\t}\n\n\tgetRequisitesPresetList()\n\t{\n\t\tif (Type.isNull(this._requisitesConfig))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tlet presets = [];\n\t\tfor (let item of BX.prop.getArray(this._requisitesConfig, \"presets\"))\n\t\t{\n\t\t\tlet value = BX.prop.getString(item, \"VALUE\", 0);\n\t\t\tlet name = BX.prop.getString(item, \"NAME\", value);\n\t\t\tpresets.push(\n\t\t\t\t{\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn presets;\n\t}\n\n\tdeleteRequisite(id)\n\t{\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.removeDebouncedEvents();\n\t\t\tthis._tooltip.close();\n\t\t}\n\t\tthis._requisiteEditor.deleteRequisite(id);\n\t}\n\n\tisRequisiteAddressOnly()\n\t{\n\t\tlet list = this._requisiteList.getList();\n\t\treturn (list.length === 1 && list[0].isAddressOnly());\n\t}\n\n\tonLoadAddressMouseUp(event)\n\t{\n\t\tevent.stopPropagation(); // cancel switching client to edit mode\n\t\tthis.loadEntity();\n\t}\n\n\tonEntityInfoLoad(sender, result)\n\t{\n\t\tvar entityData = BX.prop.getObject(result, \"DATA\", null);\n\t\tif (entityData)\n\t\t{\n\t\t\tthis.setEntity(BX.CrmEntityInfo.create(entityData), true);\n\t\t\tif (this._tooltip && this._showTooltipOnEntityLoad)\n\t\t\t{\n\t\t\t\tif (!this.isRequisiteAddressOnly())\n\t\t\t\t{\n\t\t\t\t\tthis._tooltip.show();\n\t\t\t\t}\n\t\t\t\tthis._showTooltipOnEntityLoad = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditNewRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\n\t\tparams.selected = this._requisiteList.isEmpty();\n\t\tlet requisite = RequisiteListItem.create(null, {\n\t\t\t'newRequisiteId': this._requisiteList.getNewRequisiteId(),\n\t\t\t'newRequisiteExtraFields': params\n\t\t});\n\t\trequisite.setRequisiteId(this._requisiteList.getNewRequisiteId());\n\t\tthis._requisiteEditor.open(requisite);\n\t}\n\n\tonEditExistedRequisite(event)\n\t{\n\t\tlet params = event.getData();\n\t\tlet requisite = this._requisiteList.getById(params.id);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {});\n\t\t}\n\t}\n\n\tonDeleteRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tBX.Crm.EditorAuxiliaryDialog.create(\n\t\t\t\"delete_requisite_confirmation\",\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\t\tcontent: Loc.getMessage('REQUISITE_LIST_ITEM_DELETE_CONFIRMATION_CONTENT'),\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"yes\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.accept,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_YES\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t\tthis.deleteRequisite(eventData.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"no\",\n\t\t\t\t\t\t\ttype: BX.Crm.DialogButtonType.cancel,\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_EDITOR_NO\"),\n\t\t\t\t\t\t\tcallback: (button) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbutton.getDialog().close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t}\n\t\t).open();\n\t}\n\n\tonAddBankDetails(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tlet requisite = this._requisiteList.getById(eventData.requisiteId);\n\t\tif (requisite)\n\t\t{\n\t\t\tthis._requisiteEditor.open(requisite, {\n\t\t\t\taddBankDetailsItem: true\n\t\t\t});\n\t\t}\n\t}\n\n\tonSetSelectedRequisite(event)\n\t{\n\t\tlet eventData = event.getData();\n\t\tthis._requisiteList.setSelected(eventData.id, eventData.bankDetailId);\n\n\t\tthis.doAddressLayout();\n\n\t\tlet newSelectedRequisite = this._requisiteList.getSelected();\n\t\tif (newSelectedRequisite)\n\t\t{\n\t\t\tlet selectedBankDetail = newSelectedRequisite.getBankDetailById(newSelectedRequisite.getSelectedBankDetailId());\n\t\t\tlet selectedBankDetailId = Type.isNull(selectedBankDetail) ? 0 : selectedBankDetail.id;\n\n\t\t\tEventEmitter.emit(this, 'onSetSelectedRequisite', {\n\t\t\t\trequisiteId: newSelectedRequisite.getRequisiteId(),\n\t\t\t\tbankDetailId: selectedBankDetailId\n\t\t\t});\n\t\t}\n\t}\n\n\tonRequisiteEditorAfterEdit(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonRequisiteEditorAfterDelete(event)\n\t{\n\t\tthis.onChangeRequisiteList();\n\t}\n\n\tonChangeRequisiteList()\n\t{\n\t\tthis.doAddressLayout();\n\t\tif (this._tooltip)\n\t\t{\n\t\t\tthis._tooltip.setRequisites(this._requisiteList);\n\t\t\tthis._tooltip.setLoading(false);\n\t\t}\n\n\t\tthis._requisiteEditor.setRequisiteList(this._requisiteList);\n\n\t\tlet requisiteList = this._requisiteList ? this._requisiteList.exportToModel() : null;\n\n\t\tthis._entityInfo.setRequisites(requisiteList);\n\t\tEventEmitter.emit(this, 'onChangeRequisiteList', {\n\t\t\tentityTypeName: this._entityInfo.getTypeName(),\n\t\t\tentityId: this._entityInfo.getId(),\n\t\t\trequisites: this._requisiteList.exportToModel()\n\t\t});\n\t}\n\n\tonShowTooltip()\n\t{\n\t\tif (!this._entityInfo.hasEditRequisiteData())\n\t\t{\n\t\t\tif (this._tooltip)\n\t\t\t{\n\t\t\t\tthis._tooltip.close();\n\t\t\t\tthis._showTooltipOnEntityLoad = true;\n\t\t\t}\n\t\t\tthis.loadEntity();\n\t\t}\n\t\telse if (this.isRequisiteAddressOnly())\n\t\t{\n\t\t\tthis._tooltip.close();\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new EntityEditorClientRequisites();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}"],"names":["RequisiteList","setEventNamespace","_items","CHANGE_EVENT","value","settings","Type","isArray","item","listItem","RequisiteListItem","create","push","filter","isDeleted","getList","length","selectedId","getSelectedId","getById","list","index","requisite","isSelected","id","requisiteId","getRequisiteId","reduce","prev","current","bankDetailsId","selected","setSelected","setSelectedBankDetails","isNull","getSelectedBankDetailId","notifyListChanged","maxExistedId","prevId","getRequisiteIdAsString","match","newRequisitePattern","currentId","Math","max","parseInt","indexOf","isAddressOnly","splice","setDeleted","setAddressOnly","setChanged","emit","result","exportedItem","exportToModel","self","initialize","EventEmitter","_data","isPlainObject","isNew","isChanged","formData","addressData","autocompleteState","presetId","BX","prop","getString","requisiteData","requisiteDataSign","bankDetails","bankDetailIdSelected","addressList","title","subtitle","extraData","getObject","initialAddressDdta","prepareViewData","JSON","parse","e","viewData","newRequisiteId","getNumber","getFields","setRequisiteId","bankDetailViewDataList","prepareBankDetailsList","bankDetailsItem","deleted","pseudoId","fields","isStringFilled","textValue","map","join","hasOwnProperty","getBoolean","changed","selectedBankDetailId","getInteger","getBankDetails","bankDetailId","getArray","isNumber","String","getAutocompleteState","selectedAutocompleteItem","subTitle","isUndefined","name","state","oldAddressTypes","Object","keys","addresses","type","getAddressData","isString","DELETED","presetCountryId","justSelected","setFormData","getFormData","setAddressData","EntityEditorRequisiteEditor","_requisiteList","_entityTypeId","_entityId","_entityCategoryId","_permissionToken","_contextId","_mode","UI","EntityEditorMode","view","currentSliderRequisiste","_requisiteEditUrl","_onExternalEventListener","onExternalEvent","bind","subscribe","requisiteList","mode","options","sliderOptions","width","cacheable","allowChangeHistory","requestMethod","requestParams","prepareSliderRequestParams","Crm","Page","openSlider","getSliderUrl","postData","sessid","bitrix_sessid","ACTION","ajax","post","data","json","ERROR","showError","selectedRequisite","getSelected","selectedRemoved","remove","errorMessage","MessageBox","alert","Loc","getMessage","urlParams","etype","eid","external_context_id","getPresetId","cid","util","add_url_param","getRequisiteEditUrl","getRequisiteData","getRequisiteDataSign","stringify","isEmptyFormData","isEmptyAddressData","RQ_ADDR","getAddressesForSave","isViewMode","overriddenPresetId","replace","PRESET_ID","useFormData","promise","method","dataType","url","unsubscribe","event","dataArray","getData","eventName","contextId","isObject","setRequisiteData","setAutocompleteState","clearFormData","clearAddressData","setPresetId","setPresetCountryId","setNew","add","EntityEditorRequisiteController","_requisiteEditor","_requisiteFieldId","_requisiteField","_requisiteInitData","_addressFieldId","_addressField","_isLoading","_formInputsWrapper","_enableRequisiteSelection","getConfigStringParam","saveRequisiteInitData","_editor","onFieldInit","initRequisiteEditor","initRequisiteList","selectedItem","getConfig","REQUISITE_ID","BANK_DETAIL_ID","getByRequisiteId","bankDetail","getBankDetailByBankDetailId","_config","onChangeRequisites","setRequisiteList","_id","entityTypeId","getEntityTypeId","entityId","getEntityId","getContextId","requisiteEditUrl","permissionToken","entityCategoryId","onRequisiteEditorAfterEdit","onRequisiteEditorAfterDelete","setRequisites","setSelectModeEnabled","countryId","getPresetCountryId","requisiteAddressList","getAddressList","setCountryId","setAddressList","enableRequisiteSelection","getRequisiteFieldValue","promises","signPromise","signRequisiteFields","then","error","entityDataObj","entityData","entityDataSign","addError","EntityValidationError","field","getFirstEditModeField","Promise","resolve","reject","all","newSelectedRequisite","selectedBankDetail","getBankDetailById","startLoading","runAction","stopLoading","setRequisiteInitAddrData","setMode","getMode","open","rawRequisite","requisiteFields","setInitialAddressData","setInitAddrData","edit","modelValue","_model","setField","getField","Tag","render","Dom","append","getFormElement","getListWithDeleted","dataInput","safe","signInput","isDomNode","markAsChanged","initRequisiteField","initAddressField","updateRequisiteFieldModel","eventData","extraFields","isEmpty","defaultPresetId","getNewRequisiteId","getDefaultPresetId","schemeElement","getScheme","getAvailableElements","getName","preset","IS_DEFAULT","VALUE","getSignRequisitePromise","release","fieldId","getId","onEditNewRequisite","onEditExistedRequisite","onFinishRequisiteAutocomplete","onClearRequisiteAutocomplete","onSetDefaultRequisite","onDeleteRequisite","onHideRequisite","onAddressListUpdate","params","openEditor","editorOptions","prepareRequisiteByEventData","oldAddr","addr","unhide","cancel","setSelectedRequisite","postponed","removePostponed","deleteRequisite","hide","isEmptyAddress","address","addEditorFormInputs","selectedRequisiteId","removeEditorFormInputs","markFieldsAsChanged","isEmptyRequisitesList","EntityEditorController","PresetMenu","presetList","_isShown","menuId","bindElement","close","show","menu","text","Text","encode","onclick","onSelect","MenuManager","angle","events","onPopupShow","onPopupClose","getMenuById","popupWindow","EntityEditorRequisiteTooltip","isNotEmptyString","getRandomString","_settings","_padding","_showTimer","_closeTimer","_closeTimeout","_showTimeout","_popupId","_isReadonly","_canChangeDefaultRequisite","_bindElement","_wrapper","_changeRequisistesHandler","presetMenu","onAddRequisite","refreshLayout","wrapper","parentNode","isLoading","cancelCloseDebounced","success","popup","PopupManager","autoHide","padding","contentPadding","content","getLayout","closeByEsc","adjustPosition","delayMultiplier","cancelShowDebounced","setTimeout","clearTimeout","getPopupById","isShown","wrapperRect","getBoundingClientRect","itemRect","offsetLeft","left","offsetTop","height","angleOffset","popupWidth","getPopupContainer","offsetWidth","popupHeight","offsetHeight","popupBottom","top","clientWidth","document","documentElement","clientHeight","exceeded","roundOffset","ceil","bottom","setBindElement","setAngle","position","offset","element","setOffset","setContent","loader","Loader","container","requisites","renderRequisiteEditButtonNode","onEditRequisite","onAddBankDetails","renderRequisiteBankDetails","bandDetails","onSetSelectedBankDetails","onMouseEnter","onMouseLeave","onSetSelectedRequisite","getTitle","getSubtitle","onStartAddRequisite","selectedBankDetails","closeDebounced","stopPropagation","toggle","target","getAttribute","nodeName","toString","toLowerCase","querySelector","checked","EntityEditorRequisiteField","_domNodes","_autocomplete","_tooltip","isSearchMode","requisitesDropdown","bankDetailsDropdown","selectModeEnabled","RequisiteAutocompleteField","searchAction","canAddRequisite","feedbackFormParams","_schemeElement","enabled","showFeedbackLink","onSelectAutocompleteValue","onAddRequisiteFromAutocomplete","onClearAutocompleteValue","onInstallDefaultApp","onInstallDefaultAppGlobal","getPresetList","onAddRequisiteFromMenu","isReadonly","getEditor","isReadOnly","readonly","canChangeDefaultRequisite","presets","onAddRequisiteFromTooltip","updateAutocompletePlaceholder","updateAutocompeteClientResolverPlacementParams","isSelectModeEnabled","refreshLayoutParts","hasRequisites","getRequisites","vasEmpty","isSingleMode","selectedPresetId","selectedPresetName","actions","isAutocompleteEnabled","toggleSearchMode","getClientResolverTitle","editDefaultRequisite","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","bindWrapperEvents","isNeedToDisplay","registerLayout","isDragEnabled","createDragButton","createTitleNode","addButton","renderAddButton","autocompleteForm","renderAutocompleteForm","requisiteSelectForm","renderRequisiteSelectForm","bankDetailSelectForm","renderBankDetailSelectForm","adjustNodesVisibility","updateRequisitesDropdown","updateBankDetailsDropdown","updateRequisiteSelectorValue","updateBankDetailsSelectorValue","renderSelectedRequisite","isContextMenuEnabled","appendChild","createContextMenuButton","initializeDragDropAbilities","wrapperMouseEnterHandler","onFieldMouseEnter","wrapperMouseLeaveHandler","onFieldMouseLeave","Event","unbind","updateSelectedRequisiteText","refreshTitleLayout","updateAutocompleteState","hasValue","getClientResolverPropForPreset","getSelectedPresetId","selectedRequisiteView","onViewStringClick","onViewStringMouseEnter","classList","textContent","EntityEditorField","messages","toggleNewRequisitePresetMenu","autocompleteContainer","hasResolvers","setEnabled","layout","isOpen","toggleDropdown","showPopupWindow","destroyPopupWindow","selectInput","selectContainer","Dropdown","targetElement","items","isDisabled","onRequisiteSelect","bankDetailsSelectContainer","onBankDetailSelect","onAddBankDetailsClick","autocompleteValue","getAutocompleteData","setCurrentItem","setContext","getAutocompleteContext","clientResolverPropTitle","setPlaceholderText","setClientResolverPlacementParams","getClientResolverPlacementParams","clientResolverProp","isPlacement","style","display","innerText","getSelectedRequisiteTitle","getSelectedBankDetailTitle","get","removeDebouncedEvents","EditorAuxiliaryDialog","buttons","DialogButtonType","accept","callback","button","getDialog","hideRequisite","editRequisite","getState","addRequisite","forEach","requisiteItem","setItems","sender","undefined","Number","getPopupWindow","showDeleteConfirmation","addBankDetailsItem","setLoading","hasAddresses","addressType","showClearConfirmation","onGlobalCustomEvent","setData","switchToSingleEditMode","showDebounced","preventDefault","EntityEditorRequisiteAddressField","EntityEditorAddressField","EntityEditorClientRequisites","_entityInfo","_fieldsParams","_loaderConfig","_addressConfig","_readonly","_addressContainer","_formElement","_showTooltipOnEntityLoad","setEntity","_requisitesConfig","getRequisitesPresetList","getTypeId","onShowTooltip","entityInfo","emitNotification","hasEditRequisiteData","onChangeRequisiteList","doAddressLayout","clean","defaultRequisite","addressValue","EntityEditorBaseAddressField","showFirstItemOnly","showAddressTypeInViewMode","addressZoneConfig","setMultiple","setTypesList","setValue","showAddressLink","onLoadAddressMouseUp","isRequisiteAddressOnly","size","CrmDataLoader","serviceUrl","action","getTypeName","load","onEntityInfoLoad","loadEntity","CrmEntityInfo","entityTypeName"],"mappings":"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"}