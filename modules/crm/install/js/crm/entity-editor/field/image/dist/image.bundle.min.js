this.BX=this.BX||{};(function(t,e,n){"use strict";var i=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"loadInput",value:function t(){var e=this;var i={};if(this._schemeElement){i.ownerEntityTypeId=this._schemeElement.getDataIntegerParam("ownerEntityTypeId",null);i.ownerEntityId=this._schemeElement.getDataIntegerParam("ownerEntityId",null);i.ownerEntityCategoryId=this._schemeElement.getDataIntegerParam("ownerEntityCategoryId",null);i.permissionToken=this._schemeElement.getDataStringParam("permissionToken",null)}n.ajax.runAction("crm.entity.renderImageInput",{data:{entityTypeName:this._editor.getEntityTypeName(),entityId:this._editor.getEntityId(),fieldName:this.getDataKey(),fieldValue:this.getValue(),context:i}}).then((function(t){var i=t.data.assets;var r=[].concat(babelHelpers.toConsumableArray(i.hasOwnProperty("css")?i.css:[]),babelHelpers.toConsumableArray(i.hasOwnProperty("js")?i.js:[]));BX.load(r,(function(){if(i.hasOwnProperty("string")){Promise.all(i.string.map((function(t){return n.Runtime.html(null,t)}))).then((function(){e.onEditorHtmlLoad(t.data.html)}))}else{e.onEditorHtmlLoad(t.data.html)}}))}),(function(t){e.onEditorHtmlLoad(t.errors[0].message)}))}},{key:"onEditorHtmlLoad",value:function t(e){var i=this;if(this._mode===BX.UI.EntityEditorMode.edit&&this._innerWrapper){n.Runtime.html(this._innerWrapper,e);BX.addCustomEvent(window,"onAfterPopupShow",this._dialogShowHandler);BX.addCustomEvent(window,"onPopupClose",this._dialogCloseHandler);setTimeout((function(){i.bindFileEvents()}),500)}}}],[{key:"create",value:function t(e,n){var i=new BX.Crm.EntityEditorImage;i.initialize(e,n);return i}}]);return e}(BX.UI.EntityEditorImage);e.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",(function(t){var e=t.getData();if(e[0]){e[0].methods["crm_image"]=function(t,e,n){if(t==="crm_image"){return BX.Crm.EntityEditorImage.create(e,n)}return null}}t.setData(e)}));t.EntityEditorImage=i})(this.BX.Crm=this.BX.Crm||{},BX.Event,BX);
//# sourceMappingURL=image.bundle.map.js