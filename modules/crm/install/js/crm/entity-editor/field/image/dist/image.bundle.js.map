{"version":3,"file":"image.bundle.js","sources":["../src/image.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from \"main.core.events\";\nimport {Runtime, ajax as Ajax} from \"main.core\";\n\nexport class EntityEditorImage extends BX.UI.EntityEditorImage\n{\n\tloadInput()\n\t{\n\t\tAjax.runAction(\n\t\t\t'crm.entity.renderImageInput',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeName: this._editor.getEntityTypeName(),\n\t\t\t\t\tentityId: this._editor.getEntityId(),\n\t\t\t\t\tfieldName: this.getDataKey(),\n\t\t\t\t\tfieldValue: this.getValue()\n\t\t\t\t}\n\t\t\t}\n\t\t).then((result) => {\n\t\t\tconst assets = result.data.assets;\n\t\t\tconst assetsToLoad = [\n\t\t\t\t...assets.hasOwnProperty('css')\n\t\t\t\t\t? assets.css\n\t\t\t\t\t: [],\n\t\t\t\t...assets.hasOwnProperty('js')\n\t\t\t\t\t? assets.js\n\t\t\t\t\t: [],\n\t\t\t];\n\t\t\tBX.load(assetsToLoad, () => {\n\t\t\t\tif (assets.hasOwnProperty('string'))\n\t\t\t\t{\n\t\t\t\t\tPromise\n\t\t\t\t\t\t.all(assets.string.map((stringValue) => Runtime.html(null, stringValue)))\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.onEditorHtmlLoad(result.data.html);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.onEditorHtmlLoad(result.data.html);\n\t\t\t\t}\n\t\t\t});\n\t\t}, (result) => {\n\t\t\tthis.onEditorHtmlLoad(result.errors[0].message);\n\t\t});\n\t}\n\tonEditorHtmlLoad(html)\n\t{\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit && this._innerWrapper)\n\t\t{\n\t\t\tRuntime.html(this._innerWrapper, html);\n\n\t\t\tBX.addCustomEvent(window, \"onAfterPopupShow\", this._dialogShowHandler);\n\t\t\tBX.addCustomEvent(window, \"onPopupClose\", this._dialogCloseHandler);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.bindFileEvents();\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new BX.Crm.EntityEditorImage();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\n// crm implementation of image field for ui version of entity editor\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\tconst data = event.getData();\n\tif (data[0])\n\t{\n\t\tdata[0].methods['crm_image'] = (type, controlId, settings) => {\n\t\t\tif (type === 'crm_image')\n\t\t\t{\n\t\t\t\treturn BX.Crm.EntityEditorImage.create(controlId, settings);\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\t}\n\tevent.setData(data);\n});\n"],"names":["EntityEditorImage","Ajax","runAction","data","entityTypeName","_editor","getEntityTypeName","entityId","getEntityId","fieldName","getDataKey","fieldValue","getValue","then","result","assets","assetsToLoad","hasOwnProperty","css","js","BX","load","Promise","all","string","map","stringValue","Runtime","html","onEditorHtmlLoad","errors","message","_mode","UI","EntityEditorMode","edit","_innerWrapper","addCustomEvent","window","_dialogShowHandler","_dialogCloseHandler","setTimeout","bindFileEvents","id","settings","self","Crm","initialize","EventEmitter","subscribe","event","getData","methods","type","controlId","create","setData"],"mappings":"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"}