{"version":3,"file":"fieldset.bundle.js","sources":["../src/fieldset.js"],"sourcesContent":["import {Loc, Tag, Dom, Type} from \"main.core\";\nimport {EventEmitter, BaseEvent} from \"main.core.events\";\nimport './fieldset.css';\n\nexport class EntityEditorFieldsetField extends BX.UI.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._entityEditorList = {};\n\t\tthis._entityId = null;\n\t\tthis._fieldsetContainer = null;\n\n\t\tthis._addEmptyValue = false;\n\n\t\tthis._nextIndex = 0;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._entityId = this._editor.getId() + '_' + this.getId() + '_fields';\n\n\t\tthis._addEmptyValue = this.getDataBooleanParam(\"addEmptyValue\", false);\n\n\t\tlet nextIndex = BX.prop.getInteger(this.getSchemeElement().getData(), \"nextIndex\", 0);\n\t\tthis._nextIndex = (nextIndex > 0) ? nextIndex : 0;\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: [\"ui-entity-editor-content-block-field-fieldset-wrapper\"]});\n\t\tthis.adjustWrapper();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fieldsetContainer = Tag.render`<div class=\"ui-entity-editor-container\"></div>`;\n\t\tDom.append(this._fieldsetContainer, this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tlet addButtonPanel = this.getAddButton();\n\t\t\tDom.append(addButtonPanel, this._wrapper);\n\t\t}\n\t\tsetTimeout(() => this.initializeExistedValues(), 0);\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tclearLayout()\n\t{\n\t\tsuper.clearLayout();\n\t\tthis._entityEditorList = {};\n\t}\n\n\tcreateEntityEditor(id, values = {}, context = {})\n\t{\n\t\tlet containerId = this._entityId + '_container_' + id;\n\t\tDom.append(Tag.render`<div id=\"${containerId}\" class=\"ui-entity-editor-field-fieldset\"></div>`, this._fieldsetContainer);\n\n\t\tlet entityEditorId = this._entityId + '_' + id;\n\t\tlet prefix = this.getName() + '[' + id + ']';\n\t\tlet section = {\n\t\t\t'name': entityEditorId + '_SECTION',\n\t\t\t'type': 'section',\n\t\t\t'enableToggling': false,\n\t\t\t'transferable': false,\n\t\t\t'data': {'isRemovable': false, 'enableTitle': false, 'enableToggling': false},\n\t\t\t'elements': this.getFields(prefix)\n\t\t};\n\n\t\tlet config = BX.UI.EntityConfig.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tdata: [section],\n\t\t\t\tscope: \"C\",\n\t\t\t\tenableScopeToggle: false,\n\t\t\t\tcanUpdatePersonalConfiguration: false,\n\t\t\t\tcanUpdateCommonConfiguration: false,\n\t\t\t\toptions: []\n\t\t\t}\n\t\t);\n\n\t\tlet scheme = BX.UI.EntityScheme.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tcurrent: [section],\n\t\t\t\tavailable: []\n\t\t\t}\n\t\t);\n\n\t\tlet entityEditor = BX.UI.EntityEditor.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tmodel: BX.UI.EntityEditorModelFactory.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\tisIdentifiable: false,\n\t\t\t\t\t\tdata: this.getFieldsValues(prefix, values)\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tconfig: config,\n\t\t\t\tscheme: scheme,\n\t\t\t\tcontext: context,\n\t\t\t\tcontainerId: containerId,\n\t\t\t\tserviceUrl: this._editor.getServiceUrl(),\n\n\t\t\t\tentityTypeName: \"\",\n\t\t\t\tentityId: 0,\n\t\t\t\tvalidators: [],\n\t\t\t\tcontrollers: [],\n\t\t\t\tdetailManagerId: \"\",\n\t\t\t\tinitialMode: BX.UI.EntityEditorMode.getName(this._mode),\n\t\t\t\tenableModeToggle: true,\n\t\t\t\tenableConfigControl: false,\n\t\t\t\tenableVisibilityPolicy: true,\n\t\t\t\tenableToolPanel: true,\n\t\t\t\tenableBottomPanel: false,\n\t\t\t\tenableFieldsContextMenu: true,\n\t\t\t\tenablePageTitleControls: false,\n\t\t\t\treadOnly: (this._mode == BX.UI.EntityEditorMode.view),\n\t\t\t\tenableAjaxForm: false,\n\t\t\t\tenableRequiredUserFieldCheck: true,\n\t\t\t\tenableSectionEdit: false,\n\t\t\t\tenableSectionCreation: false,\n\t\t\t\tenableSectionDragDrop: true,\n\t\t\t\tenableFieldDragDrop: true,\n\t\t\t\tenableSettingsForAll: false,\n\t\t\t\tenableContextDataLayout: false,\n\t\t\t\tformTagName: 'div',\n\t\t\t\texternalContextId: \"\",\n\t\t\t\tcontextId: \"\",\n\t\t\t\toptions: {'show_always': 'Y'},\n\t\t\t\tajaxData: [],\n\t\t\t\tisEmbedded: true\n\t\t\t}\n\t\t);\n\t\tentityEditor._enableCloseConfirmation = false;\n\t\tEventEmitter.subscribe(entityEditor, 'onControlChanged', (event) =>\n\t\t{\n\t\t\tif (!this.isChanged())\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t});\n\n\t\tlet container = entityEditor.getContainer();\n\t\tif (Type.isDomNode(container))\n\t\t{\n\t\t\tDom.prepend(this.getDeleteButton(id), container);\n\t\t}\n\n\t\tif(values.hasOwnProperty(\"DELETED\") && values[\"DELETED\"] === 'Y')\n\t\t{\n\t\t\tthis.layoutDeletedValue(entityEditor, id);\n\t\t}\n\n\t\treturn entityEditor;\n\t}\n\n\tlayoutDeletedValue(entityEditor, id)\n\t{\n\t\tif (entityEditor instanceof BX.UI.EntityEditor)\n\t\t{\n\t\t\tlet container = entityEditor.getContainer();\n\t\t\tif (Type.isDomNode(container))\n\t\t\t{\n\t\t\t\tcontainer.style.display = 'none';\n\n\t\t\t\tlet inputName = `${this.getName()}[${id}][DELETED]`;\n\t\t\t\tif (!container.querySelector(`input[name=\"${inputName}\"]`))\n\t\t\t\t{\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tTag.render`<input type=\"hidden\" name=\"${inputName}\" value=\"Y\" />`,\n\t\t\t\t\t\tcontainer\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonDeleteButtonClick(id)\n\t{\n\t\tif (this._entityEditorList.hasOwnProperty(id))\n\t\t{\n\t\t\tthis.layoutDeletedValue(this._entityEditorList[id], id);\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tonAddButtonClick()\n\t{\n\t\tthis.addEmptyValue();\n\t}\n\n\taddEmptyValue(options)\n\t{\n\t\tlet value = this.getValue();\n\n\t\tlet id = 'n' + this._nextIndex++;\n\n\t\tvalue.push({\n\t\t\t'ID': id\n\t\t});\n\n\t\tthis.getModel().setField(this.getName(), value);\n\n\t\tthis._entityEditorList[id] = this.createEntityEditor(id);\n\t\tthis.markAsChanged();\n\n\t\treturn this._entityEditorList[id];\n\t}\n\n\tgetEditors()\n\t{\n\t\treturn this._entityEditorList;\n\t}\n\n\tgetFields(prefix)\n\t{\n\t\tlet fields = BX.clone(BX.prop.getArray(this.getSchemeElement().getData(), 'fields', []));\n\t\tfor (let index = 0; index < fields.length; index++)\n\t\t{\n\t\t\tfields[index].name = this.getFieldName(fields[index].name, prefix);\n\t\t}\n\t\treturn fields;\n\t};\n\n\tgetFieldsValues(prefix, values)\n\t{\n\t\tlet result = {};\n\t\tfor (let fieldId in values)\n\t\t{\n\t\t\tresult[this.getFieldName(fieldId, prefix)] = values[fieldId];\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetFieldName(originalName, prefix)\n\t{\n\t\treturn prefix + '[' + originalName + ']';\n\t}\n\n\tgetDeleteButton(id)\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-field-fieldset-delete\">\n\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onDeleteButtonClick.bind(this, id)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_DELETE')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tgetAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t<span class=\"ui-entity-card-content-add-field\" onclick=\"${this.onAddButtonClick.bind(this)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_ADD')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tinitializeExistedValues()\n\t{\n\t\tlet existedItems = this.getValue();\n\t\tif (existedItems.length)\n\t\t{\n\t\t\tfor (let item of existedItems)\n\t\t\t{\n\t\t\t\tif (!this._entityEditorList[item.ID])\n\t\t\t\t{\n\t\t\t\t\tthis._entityEditorList[item.ID] = this.createEntityEditor(item.ID, item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this._mode === BX.UI.EntityEditorMode.edit && this._addEmptyValue)\n\t\t{\n\t\t\tthis.addEmptyValue();\n\t\t}\n\t}\n}\n\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\t\tlet data = event.getData();\n\t\tif (data[0])\n\t\t{\n\t\t\tdata[0].methods[\"fieldset\"] = (type, controlId, settings) => {\n\t\t\t\tif (type === \"fieldset\")\n\t\t\t\t{\n\t\t\t\t\treturn EntityEditorFieldsetField.create(controlId, settings);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\tevent.setData(data);\n});\n"],"names":["EntityEditorFieldsetField","_entityEditorList","_entityId","_fieldsetContainer","_addEmptyValue","_nextIndex","_editor","getId","getDataBooleanParam","nextIndex","BX","prop","getInteger","getSchemeElement","getData","options","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","registerLayout","Tag","render","Dom","append","_wrapper","_mode","UI","EntityEditorMode","edit","addButtonPanel","getAddButton","setTimeout","initializeExistedValues","id","values","context","containerId","entityEditorId","prefix","getName","section","getFields","config","EntityConfig","create","data","scope","enableScopeToggle","canUpdatePersonalConfiguration","canUpdateCommonConfiguration","scheme","EntityScheme","current","available","entityEditor","EntityEditor","model","EntityEditorModelFactory","isIdentifiable","getFieldsValues","serviceUrl","getServiceUrl","entityTypeName","entityId","validators","controllers","detailManagerId","initialMode","enableModeToggle","enableConfigControl","enableVisibilityPolicy","enableToolPanel","enableBottomPanel","enableFieldsContextMenu","enablePageTitleControls","readOnly","view","enableAjaxForm","enableRequiredUserFieldCheck","enableSectionEdit","enableSectionCreation","enableSectionDragDrop","enableFieldDragDrop","enableSettingsForAll","enableContextDataLayout","formTagName","externalContextId","contextId","ajaxData","isEmbedded","_enableCloseConfirmation","EventEmitter","subscribe","event","isChanged","markAsChanged","container","getContainer","Type","isDomNode","prepend","getDeleteButton","hasOwnProperty","layoutDeletedValue","style","display","inputName","querySelector","addEmptyValue","value","getValue","push","getModel","setField","createEntityEditor","fields","clone","getArray","index","length","name","getFieldName","result","fieldId","originalName","onDeleteButtonClick","bind","Loc","getMessage","onAddButtonClick","existedItems","item","ID","settings","self","initialize","EntityEditorField","methods","type","controlId","setData"],"mappings":"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"}