{"version":3,"file":"fieldset.bundle.js","sources":["../src/fieldset.js"],"sourcesContent":["import {Loc, Tag, Dom, Type} from \"main.core\";\nimport {EventEmitter, BaseEvent} from \"main.core.events\";\nimport './fieldset.css';\n\nexport class EntityEditorFieldsetField extends BX.UI.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._entityEditorList = {};\n\t\tthis._entityId = null;\n\t\tthis._fieldsetContainer = null;\n\n\t\tthis._addEmptyValue = false;\n\n\t\tthis._nextIndex = 0;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._entityId = this._editor.getId() + '_' + this.getId() + '_fields';\n\n\t\tthis._addEmptyValue = this.getDataBooleanParam(\"addEmptyValue\", false);\n\n\t\tlet nextIndex = BX.prop.getInteger(this.getSchemeElement().getData(), \"nextIndex\", 0);\n\t\tthis._nextIndex = (nextIndex > 0) ? nextIndex : 0;\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: [\"ui-entity-editor-content-block-field-fieldset-wrapper\"]});\n\t\tthis.adjustWrapper();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fieldsetContainer = Tag.render`<div class=\"ui-entity-editor-container\"></div>`;\n\t\tDom.append(this._fieldsetContainer, this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tlet addButtonPanel = this.getAddButton();\n\t\t\tDom.append(addButtonPanel, this._wrapper);\n\t\t}\n\t\tsetTimeout(() => this.initializeExistedValues(), 0);\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tclearLayout()\n\t{\n\t\tsuper.clearLayout();\n\t\tthis._entityEditorList = {};\n\t}\n\n\tcreateEntityEditor(id, values = {}, context = {})\n\t{\n\t\tlet containerId = this._entityId + '_container_' + id;\n\t\tDom.append(Tag.render`<div id=\"${containerId}\" class=\"ui-entity-editor-field-fieldset\"></div>`, this._fieldsetContainer);\n\n\t\tlet entityEditorId = this._entityId + '_' + id;\n\t\tlet prefix = this.getName() + '[' + id + ']';\n\t\tlet section = {\n\t\t\t'name': entityEditorId + '_SECTION',\n\t\t\t'type': 'section',\n\t\t\t'enableToggling': false,\n\t\t\t'transferable': false,\n\t\t\t'data': {'isRemovable': false, 'enableTitle': false, 'enableToggling': false},\n\t\t\t'elements': this.getFields(prefix)\n\t\t};\n\n\t\tlet config = BX.UI.EntityConfig.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tdata: [section],\n\t\t\t\tscope: \"C\",\n\t\t\t\tenableScopeToggle: false,\n\t\t\t\tcanUpdatePersonalConfiguration: false,\n\t\t\t\tcanUpdateCommonConfiguration: false,\n\t\t\t\toptions: []\n\t\t\t}\n\t\t);\n\n\t\tlet scheme = BX.UI.EntityScheme.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tcurrent: [section],\n\t\t\t\tavailable: []\n\t\t\t}\n\t\t);\n\n\t\tlet entityEditor = BX.UI.EntityEditor.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tmodel: BX.UI.EntityEditorModelFactory.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\tisIdentifiable: false,\n\t\t\t\t\t\tdata: this.getFieldsValues(prefix, values)\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tconfig: config,\n\t\t\t\tscheme: scheme,\n\t\t\t\tcontext: context,\n\t\t\t\tcontainerId: containerId,\n\t\t\t\tserviceUrl: this._editor.getServiceUrl(),\n\n\t\t\t\tentityTypeName: \"\",\n\t\t\t\tentityId: 0,\n\t\t\t\tvalidators: [],\n\t\t\t\tcontrollers: [],\n\t\t\t\tdetailManagerId: \"\",\n\t\t\t\tinitialMode: BX.UI.EntityEditorMode.getName(this._mode),\n\t\t\t\tenableModeToggle: true,\n\t\t\t\tenableConfigControl: false,\n\t\t\t\tenableVisibilityPolicy: true,\n\t\t\t\tenableToolPanel: true,\n\t\t\t\tenableBottomPanel: false,\n\t\t\t\tenableFieldsContextMenu: true,\n\t\t\t\tenablePageTitleControls: false,\n\t\t\t\treadOnly: (this._mode == BX.UI.EntityEditorMode.view),\n\t\t\t\tenableAjaxForm: false,\n\t\t\t\tenableRequiredUserFieldCheck: true,\n\t\t\t\tenableSectionEdit: false,\n\t\t\t\tenableSectionCreation: false,\n\t\t\t\tenableSectionDragDrop: true,\n\t\t\t\tenableFieldDragDrop: true,\n\t\t\t\tenableSettingsForAll: false,\n\t\t\t\tenableContextDataLayout: false,\n\t\t\t\tformTagName: 'div',\n\t\t\t\texternalContextId: \"\",\n\t\t\t\tcontextId: \"\",\n\t\t\t\toptions: {'show_always': 'Y'},\n\t\t\t\tajaxData: [],\n\t\t\t\tisEmbedded: true\n\t\t\t}\n\t\t);\n\t\tentityEditor._enableCloseConfirmation = false;\n\t\tEventEmitter.subscribe(entityEditor, 'onControlChanged', (event) =>\n\t\t{\n\t\t\tif (!this.isChanged())\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t});\n\n\t\tlet container = entityEditor.getContainer();\n\t\tif (Type.isDomNode(container))\n\t\t{\n\t\t\tDom.prepend(this.getDeleteButton(id), container);\n\t\t}\n\n\t\tif(values.hasOwnProperty(\"DELETED\") && values[\"DELETED\"] === 'Y')\n\t\t{\n\t\t\tthis.layoutDeletedValue(entityEditor, id);\n\t\t}\n\n\t\treturn entityEditor;\n\t}\n\n\tlayoutDeletedValue(entityEditor, id)\n\t{\n\t\tif (entityEditor instanceof BX.UI.EntityEditor)\n\t\t{\n\t\t\tlet container = entityEditor.getContainer();\n\t\t\tif (Type.isDomNode(container))\n\t\t\t{\n\t\t\t\tcontainer.style.display = 'none';\n\n\t\t\t\tlet inputName = `${this.getName()}[${id}][DELETED]`;\n\t\t\t\tif (!container.querySelector(`input[name=\"${inputName}\"]`))\n\t\t\t\t{\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tTag.render`<input type=\"hidden\" name=\"${inputName}\" value=\"Y\" />`,\n\t\t\t\t\t\tcontainer\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonDeleteButtonClick(id)\n\t{\n\t\tif (this._entityEditorList.hasOwnProperty(id))\n\t\t{\n\t\t\tthis.layoutDeletedValue(this._entityEditorList[id], id);\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tonAddButtonClick()\n\t{\n\t\tthis.addEmptyValue();\n\t}\n\n\taddEmptyValue(options)\n\t{\n\t\tlet value = this.getValue();\n\n\t\tlet id = 'n' + this._nextIndex++;\n\n\t\tvalue.push({\n\t\t\t'ID': id\n\t\t});\n\n\t\tthis.getModel().setField(this.getName(), value);\n\n\t\tthis._entityEditorList[id] = this.createEntityEditor(id);\n\t\tthis.markAsChanged();\n\n\t\treturn this._entityEditorList[id];\n\t}\n\n\tgetEditors()\n\t{\n\t\treturn this._entityEditorList;\n\t}\n\n\tgetFields(prefix)\n\t{\n\t\tlet fields = BX.clone(BX.prop.getArray(this.getSchemeElement().getData(), 'fields', []));\n\t\tfor (let index = 0; index < fields.length; index++)\n\t\t{\n\t\t\tfields[index].name = this.getFieldName(fields[index].name, prefix);\n\t\t}\n\t\treturn fields;\n\t};\n\n\tgetFieldsValues(prefix, values)\n\t{\n\t\tlet result = {};\n\t\tfor (let fieldId in values)\n\t\t{\n\t\t\tresult[this.getFieldName(fieldId, prefix)] = values[fieldId];\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetFieldName(originalName, prefix)\n\t{\n\t\treturn prefix + '[' + originalName + ']';\n\t}\n\n\tgetDeleteButton(id)\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-field-fieldset-delete\">\n\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onDeleteButtonClick.bind(this, id)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_DELETE')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tgetAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t<span class=\"ui-entity-card-content-add-field\" onclick=\"${this.onAddButtonClick.bind(this)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_ADD')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tinitializeExistedValues()\n\t{\n\t\tlet existedItems = this.getValue();\n\t\tif (existedItems.length)\n\t\t{\n\t\t\tfor (let item of existedItems)\n\t\t\t{\n\t\t\t\tif (!this._entityEditorList[item.ID])\n\t\t\t\t{\n\t\t\t\t\tthis._entityEditorList[item.ID] = this.createEntityEditor(item.ID, item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this._mode === BX.UI.EntityEditorMode.edit && this._addEmptyValue)\n\t\t{\n\t\t\tthis.addEmptyValue();\n\t\t}\n\t}\n}\n\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\t\tlet data = event.getData();\n\t\tif (data[0])\n\t\t{\n\t\t\tdata[0].methods[\"fieldset\"] = (type, controlId, settings) => {\n\t\t\t\tif (type === \"fieldset\")\n\t\t\t\t{\n\t\t\t\t\treturn EntityEditorFieldsetField.create(controlId, settings);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\tevent.setData(data);\n});\n"],"names":["EntityEditorFieldsetField","_entityEditorList","_entityId","_fieldsetContainer","_addEmptyValue","_nextIndex","_editor","getId","getDataBooleanParam","nextIndex","BX","prop","getInteger","getSchemeElement","getData","options","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","registerLayout","Tag","render","Dom","append","_wrapper","_mode","UI","EntityEditorMode","edit","addButtonPanel","getAddButton","setTimeout","initializeExistedValues","id","values","context","containerId","entityEditorId","prefix","getName","section","getFields","config","EntityConfig","create","data","scope","enableScopeToggle","canUpdatePersonalConfiguration","canUpdateCommonConfiguration","scheme","EntityScheme","current","available","entityEditor","EntityEditor","model","EntityEditorModelFactory","isIdentifiable","getFieldsValues","serviceUrl","getServiceUrl","entityTypeName","entityId","validators","controllers","detailManagerId","initialMode","enableModeToggle","enableConfigControl","enableVisibilityPolicy","enableToolPanel","enableBottomPanel","enableFieldsContextMenu","enablePageTitleControls","readOnly","view","enableAjaxForm","enableRequiredUserFieldCheck","enableSectionEdit","enableSectionCreation","enableSectionDragDrop","enableFieldDragDrop","enableSettingsForAll","enableContextDataLayout","formTagName","externalContextId","contextId","ajaxData","isEmbedded","_enableCloseConfirmation","EventEmitter","subscribe","event","isChanged","markAsChanged","container","getContainer","Type","isDomNode","prepend","getDeleteButton","hasOwnProperty","layoutDeletedValue","style","display","inputName","querySelector","addEmptyValue","value","getValue","push","getModel","setField","createEntityEditor","fields","clone","getArray","index","length","name","getFieldName","result","fieldId","originalName","onDeleteButtonClick","bind","Loc","getMessage","onAddButtonClick","existedItems","item","ID","settings","self","initialize","EntityEditorField","methods","type","controlId","setData"],"mappings":"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"}