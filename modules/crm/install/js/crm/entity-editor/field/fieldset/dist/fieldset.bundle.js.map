{"version":3,"file":"fieldset.bundle.js","sources":["../src/fieldset.js"],"sourcesContent":["import {Loc, Tag, Dom, Type, Runtime} from \"main.core\";\nimport {EventEmitter, BaseEvent} from \"main.core.events\";\nimport './fieldset.css';\n\nexport class EntityEditorFieldsetField extends BX.UI.EntityEditorField\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._entityEditorList = {};\n\t\tthis._entityId = null;\n\t\tthis._fieldsetContainer = null;\n\n\t\tthis._addEmptyValue = false;\n\n\t\tthis._nextIndex = 0;\n\n\t\tthis._isDeleted = false;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tlet self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\t\tthis._entityId = this._editor.getId() + '_' + this.getId() + '_fields';\n\n\t\tthis._addEmptyValue = this.getDataBooleanParam(\"addEmptyValue\", false);\n\n\t\tconst nextIndex = BX.prop.getInteger(this.getSchemeElement().getData(), \"nextIndex\", 0);\n\t\tthis._nextIndex = (nextIndex > 0) ? nextIndex : 0;\n\n\t\tthis._config = BX.prop.getObject(this.getSchemeElement().getData(), \"config\", {});\n\t}\n\n\tlayout(options)\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: [\"ui-entity-editor-content-block-field-fieldset-wrapper\"]});\n\t\tthis.adjustWrapper();\n\n\t\tif (!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fieldsetContainer = Tag.render`<div class=\"ui-entity-editor-container\"></div>`;\n\t\tDom.append(this._fieldsetContainer, this._wrapper);\n\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tlet addButtonPanel = this.getAddButton();\n\t\t\tDom.append(addButtonPanel, this._wrapper);\n\t\t}\n\t\tsetTimeout(() => this.initializeExistedValues(), 0);\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tclearLayout()\n\t{\n\t\tsuper.clearLayout();\n\t\tthis._entityEditorList = {};\n\t}\n\n\tcreateEntityEditor(id, values = {}, context = {})\n\t{\n\t\tlet containerId = this._entityId + '_container_' + id;\n\t\tDom.append(Tag.render`<div id=\"${containerId}\" class=\"ui-entity-editor-field-fieldset\"></div>`, this._fieldsetContainer);\n\n\t\tlet entityEditorId = this._entityId + '_' + id;\n\t\tlet prefix = this.getName() + '[' + id + ']';\n\t\tlet section = {\n\t\t\t'name': this._entityId + '_SECTION',\n\t\t\t'type': 'section',\n\t\t\t'enableToggling': false,\n\t\t\t'transferable': false,\n\t\t\t'data': {'isRemovable': false, 'enableTitle': false, 'enableToggling': false},\n\t\t\t'elements': this.prepareFieldsWithPrefix(this.getSchemeSectionElements(), prefix)\n\t\t};\n\n\t\tconst configId =\n\t\t\t(\n\t\t\t\tType.isPlainObject(this._config)\n\t\t\t\t&& this._config.hasOwnProperty(\"GUID\")\n\t\t\t\t&& Type.isStringFilled(this._config[\"GUID\"])\n\t\t\t)\n\t\t\t\t? this._config[\"GUID\"]\n\t\t\t\t: entityEditorId\n\t\t;\n\t\tlet config = BX.UI.EntityConfig.create(\n\t\t\tconfigId,\n\t\t\t{\n\t\t\t\tdata: [section],\n\t\t\t\tscope: this._editor.getConfigScope(),\n\t\t\t\tenableScopeToggle: false,\n\t\t\t\tcanUpdatePersonalConfiguration: this._editor._config._canUpdatePersonalConfiguration,\n\t\t\t\tcanUpdateCommonConfiguration: this._editor.canChangeCommonConfiguration(),\n\t\t\t\toptions: {},\n\t\t\t\tsignedParams: BX.prop.getString(this._config, 'ENTITY_CONFIG_SIGNED_PARAMS', '')\n\t\t\t}\n\t\t);\n\n\t\tconst availableFields = this.prepareFieldsWithPrefix(\n\t\t\tBX.clone(BX.prop.getArray(this._config, 'ENTITY_AVAILABLE_FIELDS', [])),\n\t\t\tprefix\n\t\t);\n\t\tlet scheme = BX.UI.EntityScheme.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tcurrent: [section],\n\t\t\t\tavailable: availableFields\n\t\t\t}\n\t\t);\n\n\t\tlet entityEditor = BX.UI.EntityEditor.create(\n\t\t\tentityEditorId,\n\t\t\t{\n\t\t\t\tmodel: BX.UI.EntityEditorModelFactory.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\tisIdentifiable: false,\n\t\t\t\t\t\tdata: this.getFieldsValues(prefix, values)\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tconfig: config,\n\t\t\t\tuserFieldManager: null,\n\t\t\t\tscheme: scheme,\n\t\t\t\tcontext: context,\n\t\t\t\tcontainerId: containerId,\n\t\t\t\tserviceUrl: this._editor.getServiceUrl(),\n\t\t\t\tentityTypeName: \"\",\n\t\t\t\tentityId: 0,\n\t\t\t\tvalidators: [],\n\t\t\t\tcontrollers: [],\n\t\t\t\tdetailManagerId: \"\",\n\t\t\t\tinitialMode: BX.UI.EntityEditorMode.getName(this._mode),\n\t\t\t\tenableModeToggle: true,\n\t\t\t\tenableConfigControl: false,\n\t\t\t\tenableShowAlwaysFeauture: this.getEditor().isShowAlwaysFeautureEnabled(),\n\t\t\t\tenableVisibilityPolicy: true,\n\t\t\t\tenableToolPanel: true,\n\t\t\t\tenableBottomPanel: false,\n\t\t\t\tenableFieldsContextMenu: true,\n\t\t\t\tenablePageTitleControls: false,\n\t\t\t\treadOnly: (this._mode === BX.UI.EntityEditorMode.view),\n\t\t\t\tenableAjaxForm: false,\n\t\t\t\tenableRequiredUserFieldCheck: true,\n\t\t\t\tenableSectionEdit: false,\n\t\t\t\tenableSectionCreation: false,\n\t\t\t\tenableSectionDragDrop: true,\n\t\t\t\tenableFieldDragDrop: true,\n\t\t\t\tenableSettingsForAll: false,\n\t\t\t\tenableContextDataLayout: false,\n\t\t\t\tformTagName: 'div',\n\t\t\t\texternalContextId: \"\",\n\t\t\t\tcontextId: \"\",\n\t\t\t\toptions: {'show_always': 'Y'},\n\t\t\t\tajaxData: [],\n\t\t\t\tisEmbedded: true\n\t\t\t}\n\t\t);\n\t\tentityEditor._enableCloseConfirmation = false;\n\n\t\t// Set CRM attribute manager\n\t\tconst settings = this.getAttributeManagerSettings();\n\t\tif (BX.Type.isPlainObject(settings))\n\t\t{\n\t\t\tconst attributeManager = BX.Crm.EntityFieldAttributeManager.create(\n\t\t\t\tentityEditor.getId() + \"_ATTR_MANAGER\",\n\t\t\t\t{\n\t\t\t\t\tentityTypeId: BX.prop.getInteger(\n\t\t\t\t\t\tsettings,\n\t\t\t\t\t\t\"ENTITY_TYPE_ID\",\n\t\t\t\t\t\tBX.CrmEntityType.enumeration.undefined\n\t\t\t\t\t),\n\t\t\t\t\tentityScope: BX.prop.getString(settings, \"ENTITY_SCOPE\", \"\"),\n\t\t\t\t\tisPermitted: BX.prop.getBoolean(settings, \"IS_PERMITTED\", true),\n\t\t\t\t\tisPhaseDependent: BX.prop.getBoolean(settings, \"IS_PHASE_DEPENDENT\", true),\n\t\t\t\t\tisAttrConfigButtonHidden: BX.prop.getBoolean(\n\t\t\t\t\t\tsettings, \"IS_ATTR_CONFIG_BUTTON_HIDDEN\", true\n\t\t\t\t\t),\n\t\t\t\t\tlockScript: BX.prop.getString(settings, \"LOCK_SCRIPT\", \"\"),\n\t\t\t\t\tcaptions: BX.prop.getObject(settings, \"CAPTIONS\", {}),\n\t\t\t\t\tentityPhases: BX.prop.getArray(settings, 'ENTITY_PHASES', null)\n\t\t\t\t}\n\t\t\t);\n\t\t\tentityEditor.setAttributeManager(attributeManager);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tentityEditor,\n\t\t\t'onControlChanged',\n\t\t\t(event) => {\n\t\t\t\tif (!this.isChanged())\n\t\t\t\t{\n\t\t\t\t\tthis.markAsChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.subscribeEditorEvents(\n\t\t\tentityEditor,\n\t\t\t[\n\t\t\t\t'onControlMove',\n\t\t\t\t'onFieldModify',\n\t\t\t\t'onFieldModifyAttributeConfigs',\n\t\t\t\t'onControlAdd',\n\t\t\t\t'onControlRemove',\n\t\t\t\t'onSchemeSave',\n\t\t\t]\n\t\t);\n\n\t\tlet container = entityEditor.getContainer();\n\t\tif (Type.isDomNode(container))\n\t\t{\n\t\t\tDom.prepend(this.getDeleteButton(id), container);\n\t\t}\n\n\t\tif(values.hasOwnProperty(\"DELETED\") && values[\"DELETED\"] === 'Y')\n\t\t{\n\t\t\tthis._isDeleted = true;\n\t\t\tthis.layoutDeletedValue(entityEditor, id);\n\t\t}\n\n\t\tBX.Crm.RequisiteDetailsManager.create({ entityEditorId });\n\n\t\treturn entityEditor;\n\t}\n\n\tgetCorrespondedControl(eventCode, controlId, editor)\n\t{\n\t\treturn(\n\t\t\t(eventCode === \"add\")\n\t\t\t\t? editor.getAvailableControlByCombinedId(controlId)\n\t\t\t\t: editor.getControlByCombinedIdRecursive(controlId)\n\t\t);\n\t}\n\n\tgetEditorSchemeSectionElements(editor)\n\t{\n\t\tlet elements = [];\n\n\t\tconst schemeElements = editor.getScheme().getElements();\n\t\tif (Type.isArray(schemeElements) && schemeElements.length > 0)\n\t\t{\n\t\t\tconst section = schemeElements[0];\n\t\t\tif (section && section instanceof BX.UI.EntitySchemeElement && section.getType() === \"section\")\n\t\t\t{\n\t\t\t\telements = section.getElements();\n\t\t\t}\n\t\t}\n\n\t\treturn elements;\n\t}\n\n\tprepareSectionElementsBySchemeElements(schemeElements)\n\t{\n\t\tlet elements = [];\n\n\t\tif (Type.isArray(schemeElements))\n\t\t{\n\t\t\tfor (let i = 0; i < schemeElements.length; i++)\n\t\t\t{\n\t\t\t\tconst element = {\n\t\t\t\t\t\"name\": schemeElements[i].getName(),\n\t\t\t\t\t\"title\": schemeElements[i].getTitle(),\n\t\t\t\t\t\"type\": schemeElements[i].getType(),\n\t\t\t\t\t\"required\": schemeElements[i].isRequired(),\n\t\t\t\t\t\"optionFlags\": schemeElements[i].getOptionFlags(),\n\t\t\t\t\t\"options\": schemeElements[i].getOptions()\n\t\t\t\t};\n\t\t\t\telements.push(element);\n\t\t\t}\n\t\t}\n\n\t\treturn elements;\n\t}\n\n\tsyncEditorEvent(eventName, target, params)\n\t{\n\t\tconst eventMap = {\n\t\t\t\"onControlAdd\": \"add\",\n\t\t\t\"onControlMove\": \"move\",\n\t\t\t\"onFieldModify\": \"modify\",\n\t\t\t\"onFieldModifyAttributeConfigs\": \"modifyAttributes\",\n\t\t\t\"onControlRemove\": \"remove\",\n\t\t\t\"onSchemeSave\": \"saveScheme\",\n\t\t};\n\n\t\tif (\n\t\t\tType.isStringFilled(eventName)\n\t\t\t&& eventMap.hasOwnProperty(eventName)\n\t\t\t&& target instanceof BX.UI.EntityEditor\n\t\t)\n\t\t{\n\t\t\tif (eventMap[eventName] === \"saveScheme\")\n\t\t\t{\n\t\t\t\tthis.setSchemeSectionElements(\n\t\t\t\t\tthis.prepareFieldsWithoutPrefix(\n\t\t\t\t\t\tthis.prepareSectionElementsBySchemeElements(\n\t\t\t\t\t\t\tthis.getEditorSchemeSectionElements(target)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\tthis.setSchemeAvailableElements(\n\t\t\t\t\tthis.prepareFieldsWithoutPrefix(\n\t\t\t\t\t\tthis.getEditorAvailableElements(target)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tType.isArray(params)\n\t\t\t\t&& params.length > 1\n\t\t\t\t&& Type.isPlainObject(params[1])\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst eventParams = params[1];\n\t\t\t\tfor (let index in this._entityEditorList)\n\t\t\t\t{\n\t\t\t\t\tif (this._entityEditorList.hasOwnProperty(index))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst editor = this._entityEditorList[index];\n\t\t\t\t\t\tif (editor instanceof BX.UI.EntityEditor && editor !== target)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (eventMap[eventName] === \"modify\" || eventMap[eventName] === \"modifyAttributes\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tconst field = BX.prop.get(eventParams, \"field\", null);\n\t\t\t\t\t\t\t\t\tif (field && field instanceof BX.UI.EntityEditorField)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst control = this.getCorrespondedControl(\n\t\t\t\t\t\t\t\t\t\t\teventMap[eventName],\n\t\t\t\t\t\t\t\t\t\t\tfield.getId(),\n\t\t\t\t\t\t\t\t\t\t\teditor\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tif (control)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tlet needRefreshTitleLayout = false;\n\t\t\t\t\t\t\t\t\t\t\tif (eventMap[eventName] === \"modifyAttributes\")\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tconst exists = [];\n\t\t\t\t\t\t\t\t\t\t\t\tconst configs = BX.prop.getArray(eventParams, \"attrConfigs\", null);\n\t\t\t\t\t\t\t\t\t\t\t\tif (Type.isArray(configs) && configs.length > 0)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor(let i = 0, length = configs.length; i < length; i++)\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst config = configs[i];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst typeId = BX.prop.getInteger(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconfig,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"typeId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tBX.UI.EntityFieldAttributeType.undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeId !== BX.UI.EntityFieldAttributeType.undefined)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texists.push(typeId);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontrol.getSchemeElement()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setAttributeConfiguration(config)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tfor (let index in BX.UI.EntityFieldAttributeType)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (BX.UI.EntityFieldAttributeType.hasOwnProperty(index))\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst typeId = BX.UI.EntityFieldAttributeType[index];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttypeId !== BX.UI.EntityFieldAttributeType.undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& exists.indexOf(typeId) < 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontrol.getSchemeElement()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeAttributeConfiguration(typeId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tneedRefreshTitleLayout = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tconst label = BX.prop.getString(eventParams, \"label\", \"\");\n\t\t\t\t\t\t\t\t\t\t\t\tif (Type.isStringFilled(label))\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontrol.getSchemeElement().setTitle(label);\n\t\t\t\t\t\t\t\t\t\t\t\t\tneedRefreshTitleLayout = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (needRefreshTitleLayout)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tcontrol.refreshTitleLayout();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\t\teventParams.hasOwnProperty(\"control\")\n\t\t\t\t\t\t\t\t&& Type.isObject(eventParams[\"control\"])\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst options = BX.prop.getObject(eventParams, \"params\", {});\n\t\t\t\t\t\t\t\tconst controlId = eventParams[\"control\"].getId();\n\t\t\t\t\t\t\t\tconst control = this.getCorrespondedControl(eventMap[eventName], controlId, editor);\n\t\t\t\t\t\t\t\tif (control)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (eventMap[eventName] === \"add\")\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\teditor.getControlByIndex(0).addChild(\n\t\t\t\t\t\t\t\t\t\t\t\tcontrol,\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tlayout: { forceDisplay: true },\n\t\t\t\t\t\t\t\t\t\t\t\t\tenableSaving: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\tskipEvents: true\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse if (eventMap[eventName] === \"move\")\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst index = BX.prop.getInteger(options, \"index\", -1);\n\t\t\t\t\t\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\tcontrol.getParent().moveChild(\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontrol,\n\t\t\t\t\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ enableSaving: false, skipEvents: true }\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\teditor.processSchemeChange();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse if (eventMap[eventName] === \"remove\")\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tcontrol.hide(\n\t\t\t\t\t\t\t\t\t\t\t\t{ enableSaving: false, skipEvents: true }\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\teditor.processSchemeChange();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsubscribeEditorEvents(editor, eventNames)\n\t{\n\t\tfor (let i = 0; i < eventNames.length; i++)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\teditor,\n\t\t\t\t\"BX.UI.EntityEditor:\" + eventNames[i],\n\t\t\t\t(event) => {\n\t\t\t\t\tthis.syncEditorEvent(eventNames[i], event.getTarget(), event.getData());\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tunsubscribeEditorEvents(editor)\n\t{\n\t\tEventEmitter.unsubscribeAll(editor);\n\t}\n\n\tisDeleted()\n\t{\n\t\treturn this._isDeleted;\n\t}\n\n\tlayoutDeletedValue(entityEditor, id)\n\t{\n\t\tif (entityEditor instanceof BX.UI.EntityEditor)\n\t\t{\n\t\t\tlet container = entityEditor.getContainer();\n\t\t\tif (Type.isDomNode(container))\n\t\t\t{\n\t\t\t\tcontainer.style.display = 'none';\n\n\t\t\t\tlet inputName = `${this.getName()}[${id}][DELETED]`;\n\t\t\t\tif (!container.querySelector(`input[name=\"${inputName}\"]`))\n\t\t\t\t{\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tTag.render`<input type=\"hidden\" name=\"${inputName}\" value=\"Y\" />`,\n\t\t\t\t\t\tcontainer\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonDeleteButtonClick(id)\n\t{\n\t\tif (this._entityEditorList.hasOwnProperty(id))\n\t\t{\n\t\t\tthis.unsubscribeEditorEvents(this._entityEditorList[id]);\n\n\t\t\tthis._isDeleted = true;\n\t\t\tthis.layoutDeletedValue(this._entityEditorList[id], id);\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tonAddButtonClick()\n\t{\n\t\tthis.addEmptyValue();\n\t}\n\n\taddEmptyValue(options)\n\t{\n\t\tlet value = this.getValue();\n\n\t\tlet id = 'n' + this._nextIndex++;\n\n\t\tvalue.push({\n\t\t\t'ID': id\n\t\t});\n\n\t\tthis.getModel().setField(this.getName(), value);\n\n\t\tthis._entityEditorList[id] = this.createEntityEditor(id, {}, this.prepareEntityEditorContext());\n\t\tthis.markAsChanged();\n\n\t\treturn this._entityEditorList[id];\n\t}\n\n\tgetEditors()\n\t{\n\t\treturn this._entityEditorList;\n\t}\n\n\tgetSchemeSection()\n\t{\n\t\tlet section = null;\n\n\t\tconst entityScheme = BX.prop.getArray(this._config, 'ENTITY_SCHEME', []);\n\t\tif (Type.isArray(entityScheme) && entityScheme.length > 0)\n\t\t{\n\t\t\tconst column = entityScheme[0];\n\t\t\tif (\n\t\t\t\tType.isPlainObject(column)\n\t\t\t\t&& column.hasOwnProperty(\"elements\")\n\t\t\t\t&& Type.isArray(column[\"elements\"])\n\t\t\t\t&& column[\"elements\"].length > 0\n\t\t\t\t&& Type.isPlainObject(column[\"elements\"][0])\n\t\t\t)\n\t\t\t{\n\t\t\t\tsection = column[\"elements\"][0];\n\t\t\t}\n\t\t}\n\n\t\treturn section;\n\t}\n\n\tgetEditorAvailableElements(editor)\n\t{\n\t\tlet elements = [];\n\n\t\tif (editor && editor instanceof BX.UI.EntityEditor)\n\t\t{\n\t\t\tconst schemeElements = editor.getAvailableSchemeElements();\n\t\t\tfor (let i = 0; i < schemeElements.length; i++)\n\t\t\t{\n\t\t\t\tconst element = {\n\t\t\t\t\t\"name\": schemeElements[i].getName(),\n\t\t\t\t\t\"title\": schemeElements[i].getTitle(),\n\t\t\t\t\t\"type\": schemeElements[i].getType(),\n\t\t\t\t\t\"required\": schemeElements[i].isRequired(),\n\t\t\t\t};\n\t\t\t\telements.push(element)\n\t\t\t}\n\n\t\t}\n\n\t\treturn elements;\n\t}\n\n\tsetSchemeAvailableElements(availableElements)\n\t{\n\t\tthis._config[\"ENTITY_AVAILABLE_FIELDS\"] = availableElements;\n\t}\n\n\tsetSchemeSectionElements(sectionElements)\n\t{\n\t\tlet section = null;\n\n\t\tif (!Type.isArray(sectionElements))\n\t\t{\n\t\t\tsectionElements = [];\n\t\t}\n\n\t\tconst entityScheme = BX.prop.getArray(this._config, 'ENTITY_SCHEME', []);\n\t\tif (Type.isArray(entityScheme) && entityScheme.length > 0)\n\t\t{\n\t\t\tconst column = entityScheme[0];\n\t\t\tif (\n\t\t\t\tType.isPlainObject(column)\n\t\t\t\t&& column.hasOwnProperty(\"elements\")\n\t\t\t\t&& Type.isArray(column[\"elements\"])\n\t\t\t\t&& column[\"elements\"].length > 0\n\t\t\t\t&& Type.isPlainObject(column[\"elements\"][0])\n\t\t\t)\n\t\t\t{\n\t\t\t\tsection = column[\"elements\"][0];\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isPlainObject(section))\n\t\t{\n\t\t\tsection[\"elements\"] = sectionElements;\n\t\t}\n\t}\n\n\tgetSchemeSectionElements()\n\t{\n\t\tlet elements = [];\n\n\t\tconst section = this.getSchemeSection();\n\t\tif (\n\t\t\tsection\n\t\t\t&& section.hasOwnProperty(\"elements\")\n\t\t\t&& Type.isArray(section[\"elements\"])\n\t\t)\n\t\t{\n\t\t\telements = Runtime.clone(section[\"elements\"]);\n\t\t}\n\n\t\treturn elements;\n\t}\n\n\tsetSchemeSectionElements(elements)\n\t{\n\t\tconst section = this.getSchemeSection();\n\t\tif (section)\n\t\t{\n\t\t\tsection[\"elements\"] = Runtime.clone(elements);\n\t\t}\n\t}\n\n\tgetFields(prefix)\n\t{\n\t\tconst fields = BX.clone(BX.prop.getArray(this.getSchemeElement().getData(), 'fields', []));\n\n\t\treturn this.prepareFieldsWithPrefix(fields, prefix);\n\t};\n\n\tprepareFieldsWithPrefix(fields, prefix)\n\t{\n\t\tfor (let index = 0; index < fields.length; index++)\n\t\t{\n\t\t\tfields[index].name = this.getFieldName(fields[index].name, prefix);\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tprepareFieldsWithoutPrefix(fields)\n\t{\n\t\tfor (let index = 0; index < fields.length; index++)\n\t\t{\n\t\t\tif (Type.isStringFilled(fields[index].name))\n\t\t\t{\n\t\t\t\tconst matches = fields[index].name.match(/\\[(\\w+)]$/);\n\t\t\t\tif (matches && matches.length > 1 && Type.isStringFilled(matches[1]))\n\t\t\t\t{\n\t\t\t\t\tfields[index].name = matches[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tgetFieldsValues(prefix, values)\n\t{\n\t\tlet result = {};\n\t\tfor (let fieldId in values)\n\t\t{\n\t\t\tresult[this.getFieldName(fieldId, prefix)] = values[fieldId];\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetFieldName(originalName, prefix)\n\t{\n\t\treturn prefix + '[' + originalName + ']';\n\t}\n\n\tgetDeleteButton(id)\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-field-fieldset-delete\">\n\t\t\t<span class=\"ui-link ui-link-secondary\" onclick=\"${this.onDeleteButtonClick.bind(this, id)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_DELETE')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tgetAddButton()\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t<span class=\"ui-entity-card-content-add-field\" onclick=\"${this.onAddButtonClick.bind(this)}\">\n\t\t\t\t${Loc.getMessage('UI_ENTITY_EDITOR_ADD')}\n\t\t\t</span>\n\t\t</div>`;\n\t}\n\n\tinitializeExistedValues()\n\t{\n\t\tlet existedItems = this.getValue();\n\t\tif (existedItems.length)\n\t\t{\n\t\t\tfor (let item of existedItems)\n\t\t\t{\n\t\t\t\tif (!this._entityEditorList[item.ID])\n\t\t\t\t{\n\t\t\t\t\tthis._entityEditorList[item.ID] = this.createEntityEditor(\n\t\t\t\t\t\titem.ID,\n\t\t\t\t\t\titem,\n\t\t\t\t\t\tthis.prepareEntityEditorContext()\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this._mode === BX.UI.EntityEditorMode.edit && this._addEmptyValue)\n\t\t{\n\t\t\tthis.addEmptyValue();\n\t\t}\n\t}\n\n\tgetAttributeManagerSettings()\n\t{\n\t\treturn BX.prop.getObject(this._config, \"ATTRIBUTE_CONFIG\", null);\n\t}\n\n\tgetResolverProperty()\n\t{\n\t\treturn BX.prop.getObject(this._settings, \"resolverProperty\", null);\n\t}\n\n\tgetActiveControlById(id)\n\t{\n\t\tfor (let pseudoId in this._entityEditorList)\n\t\t{\n\t\t\tif (this._entityEditorList.hasOwnProperty(pseudoId))\n\t\t\t{\n\t\t\t\tconst control = this._entityEditorList[pseudoId].getActiveControlById(id, true);\n\t\t\t\tif (control)\n\t\t\t\t{\n\t\t\t\t\treturn control;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(this._isDeleted || this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst validator = BX.UI.EntityAsyncValidator.create();\n\t\tfor (let pseudoId in this._entityEditorList)\n\t\t{\n\t\t\tif (this._entityEditorList.hasOwnProperty(pseudoId))\n\t\t\t{\n\t\t\t\tconst field = this._entityEditorList[pseudoId];\n\t\t\t\tif(field.getMode() !== BX.UI.EntityEditorMode.edit)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvalidator.addResult(field.validate(result));\n\t\t\t}\n\t\t}\n\n\t\treturn validator.validate();\n\t}\n\n\tprepareEntityEditorContext()\n\t{\n\t\treturn {};\n\t}\n}\n\nEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\t\tlet data = event.getData();\n\t\tif (data[0])\n\t\t{\n\t\t\tdata[0].methods[\"fieldset\"] = (type, controlId, settings) => {\n\t\t\t\tif (type === \"fieldset\")\n\t\t\t\t{\n\t\t\t\t\treturn EntityEditorFieldsetField.create(controlId, settings);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\tevent.setData(data);\n});\n"],"names":["EntityEditorFieldsetField","_entityEditorList","_entityId","_fieldsetContainer","_addEmptyValue","_nextIndex","_isDeleted","_editor","getId","getDataBooleanParam","nextIndex","BX","prop","getInteger","getSchemeElement","getData","_config","getObject","options","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","registerLayout","Tag","render","Dom","append","_wrapper","_mode","UI","EntityEditorMode","edit","addButtonPanel","getAddButton","setTimeout","initializeExistedValues","id","values","context","containerId","entityEditorId","prefix","getName","section","prepareFieldsWithPrefix","getSchemeSectionElements","configId","Type","isPlainObject","hasOwnProperty","isStringFilled","config","EntityConfig","create","data","scope","getConfigScope","enableScopeToggle","canUpdatePersonalConfiguration","_canUpdatePersonalConfiguration","canUpdateCommonConfiguration","canChangeCommonConfiguration","signedParams","getString","availableFields","clone","getArray","scheme","EntityScheme","current","available","entityEditor","EntityEditor","model","EntityEditorModelFactory","isIdentifiable","getFieldsValues","userFieldManager","serviceUrl","getServiceUrl","entityTypeName","entityId","validators","controllers","detailManagerId","initialMode","enableModeToggle","enableConfigControl","enableShowAlwaysFeauture","getEditor","isShowAlwaysFeautureEnabled","enableVisibilityPolicy","enableToolPanel","enableBottomPanel","enableFieldsContextMenu","enablePageTitleControls","readOnly","view","enableAjaxForm","enableRequiredUserFieldCheck","enableSectionEdit","enableSectionCreation","enableSectionDragDrop","enableFieldDragDrop","enableSettingsForAll","enableContextDataLayout","formTagName","externalContextId","contextId","ajaxData","isEmbedded","_enableCloseConfirmation","settings","getAttributeManagerSettings","attributeManager","Crm","EntityFieldAttributeManager","entityTypeId","CrmEntityType","enumeration","undefined","entityScope","isPermitted","getBoolean","isPhaseDependent","isAttrConfigButtonHidden","lockScript","captions","entityPhases","setAttributeManager","EventEmitter","subscribe","event","isChanged","markAsChanged","subscribeEditorEvents","container","getContainer","isDomNode","prepend","getDeleteButton","layoutDeletedValue","RequisiteDetailsManager","eventCode","controlId","editor","getAvailableControlByCombinedId","getControlByCombinedIdRecursive","elements","schemeElements","getScheme","getElements","isArray","length","EntitySchemeElement","getType","i","element","getTitle","isRequired","getOptionFlags","getOptions","push","eventName","target","params","eventMap","setSchemeSectionElements","prepareFieldsWithoutPrefix","prepareSectionElementsBySchemeElements","getEditorSchemeSectionElements","setSchemeAvailableElements","getEditorAvailableElements","eventParams","index","field","get","EntityEditorField","control","getCorrespondedControl","needRefreshTitleLayout","exists","configs","typeId","EntityFieldAttributeType","setAttributeConfiguration","indexOf","removeAttributeConfiguration","label","setTitle","refreshTitleLayout","isObject","getControlByIndex","addChild","layout","forceDisplay","enableSaving","skipEvents","getParent","moveChild","processSchemeChange","hide","eventNames","syncEditorEvent","getTarget","unsubscribeAll","style","display","inputName","querySelector","unsubscribeEditorEvents","addEmptyValue","value","getValue","getModel","setField","createEntityEditor","prepareEntityEditorContext","entityScheme","column","getAvailableSchemeElements","availableElements","sectionElements","getSchemeSection","Runtime","fields","name","getFieldName","matches","match","result","fieldId","originalName","onDeleteButtonClick","bind","Loc","getMessage","onAddButtonClick","existedItems","item","ID","_settings","pseudoId","getActiveControlById","validator","EntityAsyncValidator","getMode","addResult","validate","self","initialize","methods","type","setData"],"mappings":"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"}