this.BX=this.BX||{};(function(e,t,i){"use strict";function n(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=a(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var r=function e(){};return{s:r,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();l=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!l&&i.return!=null)i.return()}finally{if(o)throw s}}}}function a(e,t){if(!e)return;if(typeof e==="string")return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(e,t)}function r(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}function l(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="ui-entity-editor-content-block-add-field">\n\t\t\t<span class="ui-entity-card-content-add-field" onclick="','">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t</div>"]);l=function t(){return e};return e}function o(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="ui-entity-editor-field-fieldset-delete">\n\t\t\t<span class="ui-link ui-link-secondary" onclick="','">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t</div>"]);o=function t(){return e};return e}function s(){var e=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="Y" />']);s=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['<div id="','" class="ui-entity-editor-field-fieldset"></div>']);d=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-container"></div>']);u=function t(){return e};return e}var f=function(e){babelHelpers.inherits(a,e);function a(){var e;babelHelpers.classCallCheck(this,a);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this));e._entityEditorList={};e._entityId=null;e._fieldsetContainer=null;e._addEmptyValue=false;e._nextIndex=0;return e}babelHelpers.createClass(a,[{key:"doInitialize",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"doInitialize",this).call(this);this._entityId=this._editor.getId()+"_"+this.getId()+"_fields";this._addEmptyValue=this.getDataBooleanParam("addEmptyValue",false);var t=BX.prop.getInteger(this.getSchemeElement().getData(),"nextIndex",0);this._nextIndex=t>0?t:0}},{key:"layout",value:function e(i){var n=this;if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-fieldset-wrapper"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(i);this._hasLayout=true;return}this._fieldsetContainer=t.Tag.render(u());t.Dom.append(this._fieldsetContainer,this._wrapper);if(this._mode===BX.UI.EntityEditorMode.edit){var a=this.getAddButton();t.Dom.append(a,this._wrapper)}setTimeout(function(){return n.initializeExistedValues()},0);this.registerLayout(i);this._hasLayout=true}},{key:"clearLayout",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"clearLayout",this).call(this);this._entityEditorList={}}},{key:"createEntityEditor",value:function e(n){var a=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var l=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var o=this._entityId+"_container_"+n;t.Dom.append(t.Tag.render(d(),o),this._fieldsetContainer);var s=this._entityId+"_"+n;var u=this.getName()+"["+n+"]";var f={name:s+"_SECTION",type:"section",enableToggling:false,transferable:false,data:{isRemovable:false,enableTitle:false,enableToggling:false},elements:this.getFields(u)};var c=BX.UI.EntityConfig.create(s,{data:[f],scope:"C",enableScopeToggle:false,canUpdatePersonalConfiguration:false,canUpdateCommonConfiguration:false,options:[]});var y=BX.UI.EntityScheme.create(s,{current:[f],available:[]});var h=BX.UI.EntityEditor.create(s,{model:BX.UI.EntityEditorModelFactory.create("","",{isIdentifiable:false,data:this.getFieldsValues(u,r)}),config:c,scheme:y,context:l,containerId:o,serviceUrl:this._editor.getServiceUrl(),entityTypeName:"",entityId:0,validators:[],controllers:[],detailManagerId:"",initialMode:BX.UI.EntityEditorMode.getName(this._mode),enableModeToggle:true,enableConfigControl:false,enableVisibilityPolicy:true,enableToolPanel:true,enableBottomPanel:false,enableFieldsContextMenu:true,enablePageTitleControls:false,readOnly:this._mode==BX.UI.EntityEditorMode.view,enableAjaxForm:false,enableRequiredUserFieldCheck:true,enableSectionEdit:false,enableSectionCreation:false,enableSectionDragDrop:true,enableFieldDragDrop:true,enableSettingsForAll:false,enableContextDataLayout:false,formTagName:"div",externalContextId:"",contextId:"",options:{show_always:"Y"},ajaxData:[],isEmbedded:true});h._enableCloseConfirmation=false;i.EventEmitter.subscribe(h,"onControlChanged",function(e){if(!a.isChanged()){a.markAsChanged()}});var g=h.getContainer();if(t.Type.isDomNode(g)){t.Dom.prepend(this.getDeleteButton(n),g)}if(r.hasOwnProperty("DELETED")&&r["DELETED"]==="Y"){this.layoutDeletedValue(h,n)}return h}},{key:"layoutDeletedValue",value:function e(i,n){if(i instanceof BX.UI.EntityEditor){var a=i.getContainer();if(t.Type.isDomNode(a)){a.style.display="none";var r="".concat(this.getName(),"[").concat(n,"][DELETED]");if(!a.querySelector('input[name="'.concat(r,'"]'))){t.Dom.append(t.Tag.render(s(),r),a)}}}}},{key:"onDeleteButtonClick",value:function e(t){if(this._entityEditorList.hasOwnProperty(t)){this.layoutDeletedValue(this._entityEditorList[t],t);this.markAsChanged()}}},{key:"onAddButtonClick",value:function e(){this.addEmptyValue()}},{key:"addEmptyValue",value:function e(t){var i=this.getValue();var n="n"+this._nextIndex++;i.push({ID:n});this.getModel().setField(this.getName(),i);this._entityEditorList[n]=this.createEntityEditor(n);this.markAsChanged();return this._entityEditorList[n]}},{key:"getEditors",value:function e(){return this._entityEditorList}},{key:"getFields",value:function e(t){var i=BX.clone(BX.prop.getArray(this.getSchemeElement().getData(),"fields",[]));for(var n=0;n<i.length;n++){i[n].name=this.getFieldName(i[n].name,t)}return i}},{key:"getFieldsValues",value:function e(t,i){var n={};for(var a in i){n[this.getFieldName(a,t)]=i[a]}return n}},{key:"getFieldName",value:function e(t,i){return i+"["+t+"]"}},{key:"getDeleteButton",value:function e(i){return t.Tag.render(o(),this.onDeleteButtonClick.bind(this,i),t.Loc.getMessage("UI_ENTITY_EDITOR_DELETE"))}},{key:"getAddButton",value:function e(){return t.Tag.render(l(),this.onAddButtonClick.bind(this),t.Loc.getMessage("UI_ENTITY_EDITOR_ADD"))}},{key:"initializeExistedValues",value:function e(){var t=this.getValue();if(t.length){var i=n(t),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;if(!this._entityEditorList[r.ID]){this._entityEditorList[r.ID]=this.createEntityEditor(r.ID,r)}}}catch(e){i.e(e)}finally{i.f()}}else if(this._mode===BX.UI.EntityEditorMode.edit&&this._addEmptyValue){this.addEmptyValue()}}}],[{key:"create",value:function e(t,i){var n=new this(t,i);n.initialize(t,i);return n}}]);return a}(BX.UI.EntityEditorField);i.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",function(e){var t=e.getData();if(t[0]){t[0].methods["fieldset"]=function(e,t,i){if(e==="fieldset"){return f.create(t,i)}return null}}e.setData(t)});e.EntityEditorFieldsetField=f})(this.BX.Crm=this.BX.Crm||{},BX,BX.Event);
//# sourceMappingURL=fieldset.bundle.map.js