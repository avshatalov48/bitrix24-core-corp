this.BX=this.BX||{};(function(e,t,i){"use strict";var n,a,r,l,o;function s(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=d(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,o;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;o=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw o}}}}function d(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var f=function(e){babelHelpers.inherits(d,e);function d(){var e;babelHelpers.classCallCheck(this,d);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(d).call(this));e._entityEditorList={};e._entityId=null;e._fieldsetContainer=null;e._addEmptyValue=false;e._nextIndex=0;return e}babelHelpers.createClass(d,[{key:"doInitialize",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"doInitialize",this).call(this);this._entityId=this._editor.getId()+"_"+this.getId()+"_fields";this._addEmptyValue=this.getDataBooleanParam("addEmptyValue",false);var t=BX.prop.getInteger(this.getSchemeElement().getData(),"nextIndex",0);this._nextIndex=t>0?t:0}},{key:"layout",value:function e(i){var a=this;if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-fieldset-wrapper"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(i);this._hasLayout=true;return}this._fieldsetContainer=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-container"></div>'])));t.Dom.append(this._fieldsetContainer,this._wrapper);if(this._mode===BX.UI.EntityEditorMode.edit){var r=this.getAddButton();t.Dom.append(r,this._wrapper)}setTimeout((function(){return a.initializeExistedValues()}),0);this.registerLayout(i);this._hasLayout=true}},{key:"clearLayout",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(d.prototype),"clearLayout",this).call(this);this._entityEditorList={}}},{key:"createEntityEditor",value:function e(n){var r=this;var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var s=this._entityId+"_container_"+n;t.Dom.append(t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div id="','" class="ui-entity-editor-field-fieldset"></div>'])),s),this._fieldsetContainer);var d=this._entityId+"_"+n;var u=this.getName()+"["+n+"]";var f={name:d+"_SECTION",type:"section",enableToggling:false,transferable:false,data:{isRemovable:false,enableTitle:false,enableToggling:false},elements:this.getFields(u)};var c=BX.UI.EntityConfig.create(d,{data:[f],scope:"C",enableScopeToggle:false,canUpdatePersonalConfiguration:false,canUpdateCommonConfiguration:false,options:[]});var y=BX.UI.EntityScheme.create(d,{current:[f],available:[]});var h=BX.UI.EntityEditor.create(d,{model:BX.UI.EntityEditorModelFactory.create("","",{isIdentifiable:false,data:this.getFieldsValues(u,l)}),config:c,scheme:y,context:o,containerId:s,serviceUrl:this._editor.getServiceUrl(),entityTypeName:"",entityId:0,validators:[],controllers:[],detailManagerId:"",initialMode:BX.UI.EntityEditorMode.getName(this._mode),enableModeToggle:true,enableConfigControl:false,enableVisibilityPolicy:true,enableToolPanel:true,enableBottomPanel:false,enableFieldsContextMenu:true,enablePageTitleControls:false,readOnly:this._mode==BX.UI.EntityEditorMode.view,enableAjaxForm:false,enableRequiredUserFieldCheck:true,enableSectionEdit:false,enableSectionCreation:false,enableSectionDragDrop:true,enableFieldDragDrop:true,enableSettingsForAll:false,enableContextDataLayout:false,formTagName:"div",externalContextId:"",contextId:"",options:{show_always:"Y"},ajaxData:[],isEmbedded:true});h._enableCloseConfirmation=false;i.EventEmitter.subscribe(h,"onControlChanged",(function(e){if(!r.isChanged()){r.markAsChanged()}}));var g=h.getContainer();if(t.Type.isDomNode(g)){t.Dom.prepend(this.getDeleteButton(n),g)}if(l.hasOwnProperty("DELETED")&&l["DELETED"]==="Y"){this.layoutDeletedValue(h,n)}return h}},{key:"layoutDeletedValue",value:function e(i,n){if(i instanceof BX.UI.EntityEditor){var a=i.getContainer();if(t.Type.isDomNode(a)){a.style.display="none";var l="".concat(this.getName(),"[").concat(n,"][DELETED]");if(!a.querySelector('input[name="'.concat(l,'"]'))){t.Dom.append(t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="Y" />'])),l),a)}}}}},{key:"onDeleteButtonClick",value:function e(t){if(this._entityEditorList.hasOwnProperty(t)){this.layoutDeletedValue(this._entityEditorList[t],t);this.markAsChanged()}}},{key:"onAddButtonClick",value:function e(){this.addEmptyValue()}},{key:"addEmptyValue",value:function e(t){var i=this.getValue();var n="n"+this._nextIndex++;i.push({ID:n});this.getModel().setField(this.getName(),i);this._entityEditorList[n]=this.createEntityEditor(n);this.markAsChanged();return this._entityEditorList[n]}},{key:"getEditors",value:function e(){return this._entityEditorList}},{key:"getFields",value:function e(t){var i=BX.clone(BX.prop.getArray(this.getSchemeElement().getData(),"fields",[]));for(var n=0;n<i.length;n++){i[n].name=this.getFieldName(i[n].name,t)}return i}},{key:"getFieldsValues",value:function e(t,i){var n={};for(var a in i){n[this.getFieldName(a,t)]=i[a]}return n}},{key:"getFieldName",value:function e(t,i){return i+"["+t+"]"}},{key:"getDeleteButton",value:function e(i){return t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="ui-entity-editor-field-fieldset-delete">\n\t\t\t<span class="ui-link ui-link-secondary" onclick="','">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t</div>"])),this.onDeleteButtonClick.bind(this,i),t.Loc.getMessage("UI_ENTITY_EDITOR_DELETE"))}},{key:"getAddButton",value:function e(){return t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="ui-entity-editor-content-block-add-field">\n\t\t\t<span class="ui-entity-card-content-add-field" onclick="','">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t</div>"])),this.onAddButtonClick.bind(this),t.Loc.getMessage("UI_ENTITY_EDITOR_ADD"))}},{key:"initializeExistedValues",value:function e(){var t=this.getValue();if(t.length){var i=s(t),n;try{for(i.s();!(n=i.n()).done;){var a=n.value;if(!this._entityEditorList[a.ID]){this._entityEditorList[a.ID]=this.createEntityEditor(a.ID,a)}}}catch(e){i.e(e)}finally{i.f()}}else if(this._mode===BX.UI.EntityEditorMode.edit&&this._addEmptyValue){this.addEmptyValue()}}}],[{key:"create",value:function e(t,i){var n=new this(t,i);n.initialize(t,i);return n}}]);return d}(BX.UI.EntityEditorField);i.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",(function(e){var t=e.getData();if(t[0]){t[0].methods["fieldset"]=function(e,t,i){if(e==="fieldset"){return f.create(t,i)}return null}}e.setData(t)}));e.EntityEditorFieldsetField=f})(this.BX.Crm=this.BX.Crm||{},BX,BX.Event);
//# sourceMappingURL=fieldset.bundle.map.js