{"version":3,"file":"payment-documents.bundle.js","sources":["../src/entity-editor.js","../src/timeline-summary.js"],"sourcesContent":["// @flow\n\nimport {Tag, Loc, Type, ajax, debounce} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MenuManager} from 'main.popup';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Label, LabelColor} from 'ui.label';\n\ndeclare var BX: {[key: string]: any};\n\ntype PaymentDocument = {\n\tID: number,\n\tORDER_ID: number,\n\tFORMATTED_DATE: string,\n\tSUM: number,\n\tTYPE: 'PAYMENT' | 'SHIPMENT',\n\tPAID?: 'Y' | 'N',\n\tSTAGE?: 'NOT_PAID' | 'SENT_NO_VIEWED' | 'VIEWED_NO_PAID' | 'PAID' | 'CANCEL' | 'REFUND',\n\tDELIVERY_NAME?: string,\n\tDEDUCTED?: 'Y' | 'N'\n};\n\ntype EntityEditorPaymentDocumentsOptions = {\n\tCURRENCY_FORMAT: {},\n\tCURRENCY_ID: string,\n\tDEAL_ID: number,\n\tDEAL_AMOUNT: number,\n\tDOCUMENTS: Array<PaymentDocument>,\n\tORDER_IDS: Array<number>,\n\tPARENT_CONTEXT: StartsSalescenterApp,\n\tIS_DELIVERY_AVAILABLE: boolean\n};\n\ntype Destroyable = {\n\tdestroy(): any\n};\n\ntype StartsSalescenterApp = {\n\tstartSalescenterApplication(): any\n};\n\ntype AjaxHandler = (...args: Array<any>) => any;\n\nexport class EntityEditorPaymentDocuments\n{\n\t_options: EntityEditorPaymentDocumentsOptions;\n\t_isDeliveryAvailable: boolean;\n\t_parentContext: StartsSalescenterApp;\n\t_rootNode: HTMLElement;\n\t_menus: Array<Destroyable>;\n\tstatic _rootNodeClass = 'crm-entity-widget-inner crm-entity-widget-inner--payment';\n\n\tconstructor(options: EntityEditorPaymentDocumentsOptions)\n\t{\n\t\tthis._options = options;\n\t\tthis._isDeliveryAvailable = this._options.IS_DELIVERY_AVAILABLE;\n\t\tthis._parentContext = options.PARENT_CONTEXT;\n\t\tthis._rootNode = Tag.render`<div class=\"${this.constructor._rootNodeClass}\"></div>`;\n\t\tthis._menus = [];\n\n\t\tthis._subscribeToGlobalEvents();\n\t}\n\n\thasContent(): boolean\n\t{\n\t\treturn this._docs().length > 0;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis._menus.forEach(menu => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\n\t\tif (this.hasContent())\n\t\t{\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\t\t\tthis._rootNode.append(Tag.render`\n\t\t\t\t<div class=\"crm-entity-widget-content-block-inner-container\">\n\t\t\t\t\t<div class=\"crm-entity-widget-payment\">\n\t\t\t\t\t\t${this._renderTitle()}\n\t\t\t\t\t\t${this._renderDocuments()}\n\t\t\t\t\t\t${this._renderAddDocument()}\n\t\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\n\t\treturn this._rootNode;\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tthis._options = options;\n\t}\n\n\treloadModel(onSuccess?: AjaxHandler, onError?: AjaxHandler)\n\t{\n\t\tif (!this._options.DEAL_ID)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = {\n\t\t\tdata: {\n\t\t\t\tdealId: this._options.DEAL_ID\n\t\t\t}\n\t\t};\n\n\t\tconst successCallback = response => {\n\t\t\tthis._loading(false);\n\t\t\tif (response.data) {\n\t\t\t\tthis.setOptions(response.data);\n\t\t\t\tthis.render();\n\t\t\t\tif (onSuccess && Type.isFunction(onSuccess)) {\n\t\t\t\t\tonSuccess(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._showCommonError();\n\t\t\t\tif (onError && Type.isFunction(onError)) {\n\t\t\t\t\tonError();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst errorCallback = () => {\n\t\t\tthis._loading(false);\n\t\t\tthis._showCommonError();\n\t\t\tif (onError && Type.isFunction(onError)) {\n\t\t\t\tonError();\n\t\t\t}\n\t\t};\n\n\t\tthis._loading(true);\n\n\t\tajax.runAction('crm.api.deal.fetchPaymentDocuments', data).then(successCallback, errorCallback);\n\t}\n\n\t_renderTitle(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-caption\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TITLE')}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDocuments(): HTMLElement[]\n\t{\n\t\tconst nodes = [];\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderPaymentDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderShipmentDocument(doc));\n\t\t\t}\n\t\t});\n\t\treturn nodes;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tlet popupMenu;\n\t\tlet menuItems = [];\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\tonclick: () => this._chooseDeliverySlider(doc.ORDER_ID)\n\t\t\t});\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_RESEND'),\n\t\t\tonclick: () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID)\n\t\t});\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_PAYMENT_STATUS'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, true);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_NOT_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, false);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-no-icon crm-entity-widget-payment-menu-item-remove' : '',\n\t\t\tonclick: () => {\n\t\t\t\tif (doc.PAID === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tpopupMenu.close();\n\t\t\t\tMessageBox.show({\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_CONFIRM_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_CONFIRM_TEXT'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst openSlider = () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-payment-action-' + doc.ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-payment-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_REMOVE_TIP'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title} (${sum})</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderShipmentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\n\t\tlet popupMenu;\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_DELIVERY_STATUS'),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, true);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, false);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\tMessageBox.show({\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_CONFIRM_TITLE'),\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_CONFIRM_TEXT'),\n\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\t\tonOk: messageBox => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-delivery-action-' + doc.ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t${title} (${doc.DELIVERY_NAME}, ${sum})\n\t\t\t\t</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderAddDocument(): HTMLElement\n\t{\n\t\tconst latestOrderId = this._latestOrderId();\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT'),\n\t\t\t\tonclick: () => this._context().startSalescenterApplication(latestOrderId)\n\t\t\t}\n\t\t];\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_DELIVERY'),\n\t\t\t\tonclick: () => this._createDeliverySlider(latestOrderId)\n\t\t\t});\n\t\t}\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tconst popupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-create-document-action',\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-add-box\">\n\t\t\t\t<a href=\"#\" class=\"crm-entity-widget-payment-add\" onclick=\"${openMenu}\">\n\t\t\t\t\t+ ${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_DOCUMENT')}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_calculateTotalSum()\n\t{\n\t\tlet totalSum = parseFloat(this._options.DEAL_AMOUNT);\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT')\n\t\t\t{\n\t\t\t\tif (doc.PAID && doc.PAID === 'Y')\n\t\t\t\t{\n\t\t\t\t\ttotalSum -= parseFloat(doc.SUM);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (totalSum < 0)\n\t\t{\n\t\t\ttotalSum = 0.0;\n\t\t}\n\n\t\treturn totalSum;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tlet totalSum = this._calculateTotalSum();\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-total\">\n\t\t\t\t<span>\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM')}\n\t\t\t\t\t<span data-hint=\"${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM_TOOLTIP')}\"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"crm-entity-widget-payment-text\">${this._renderMoney(totalSum)}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Hint.init(node);\n\n\t\treturn node;\n\t};\n\n\t_renderMoney(sum: number): string\n\t{\n\t\tconst fullPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, true);\n\t\tconst onlyPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, false);\n\t\tconst currency = fullPrice.replace(onlyPrice, '').trim();\n\n\t\treturn fullPrice.replace(currency, `<span class=\"crm-entity-widget-payment-currency\">${currency}</span>`);\n\t}\n\n\t_docs(): Array<PaymentDocument>\n\t{\n\t\tif (this._options && this._options.DOCUMENTS && this._options.DOCUMENTS.length)\n\t\t{\n\t\t\treturn this._options.DOCUMENTS;\n\t\t}\n\t\treturn [];\n\t}\n\n\t_context(): StartsSalescenterApp\n\t{\n\t\treturn this._parentContext;\n\t}\n\n\t_orderIds(): Array<number>\n\t{\n\t\tif (this._options && this._options.ORDER_IDS && this._options.ORDER_IDS.length)\n\t\t{\n\t\t\treturn this._options.ORDER_IDS.map(id => parseInt(id));\n\t\t}\n\t\treturn [];\n\t}\n\n\t// @todo: provide test\n\t_latestOrderId(): number\n\t{\n\t\treturn Math.max(...this._orderIds());\n\t}\n\n\t_dealEntityType(): number\n\t{\n\t\treturn BX.CrmEntityType.enumeration.deal;\n\t}\n\n\t_createDeliverySlider(orderId: number)\n\t{\n\t\tconst options = {\n\t\t\tcontext: 'deal',\n\t\t\ttemplateMode: 'create',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: 'crmDealPaymentDocumentsCreateDeliverySlider',\n\t\t\townerTypeId: this._dealEntityType(),\n\t\t\townerId: this._options.DEAL_ID,\n\t\t\torderId: orderId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_chooseDeliverySlider(orderId: number)\n\t{\n\t\tconst options = {\n\t\t\tcontext: 'deal',\n\t\t\ttemplateMode: 'create',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: 'crmDealPaymentDocumentsChooseDeliverySlider',\n\t\t\townerTypeId: this._dealEntityType(),\n\t\t\townerId: this._options.DEAL_ID,\n\t\t\torderId: orderId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_resendPaymentSlider(orderId: number, paymentId: number)\n\t{\n\t\tconst options = {\n\t\t\tdisableSendButton: '',\n\t\t\tcontext: 'deal',\n\t\t\tmode: 'payment_delivery',\n\t\t\tanalyticsLabel: 'crmDealPaymentDocumentsResendPaymentSlider',\n\t\t\ttemplateMode: 'view',\n\t\t\townerTypeId: this._dealEntityType(),\n\t\t\townerId: this._options.DEAL_ID,\n\t\t\torderId: orderId,\n\t\t\tpaymentId: paymentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_viewDeliverySlider(orderId: number, shipmentId: number)\n\t{\n\t\tconst options = {\n\t\t\tcontext: 'deal',\n\t\t\ttemplateMode: 'view',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: 'crmDealPaymentDocumentsViewDeliverySlider',\n\t\t\townerTypeId: this._dealEntityType(),\n\t\t\townerId: this._options.DEAL_ID,\n\t\t\torderId: orderId,\n\t\t\tshipmentId: shipmentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_setPaymentPaidStatus(payment: PaymentDocument, isPaid: boolean)\n\t{\n\t\tconst strPaid = isPaid ? 'Y' : 'N';\n\t\tconst stage = isPaid ? 'PAID' : 'CANCEL';\n\n\t\tif (payment.PAID && payment.PAID === strPaid) {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT' && doc.ID === payment.ID) {\n\t\t\t\tdoc.PAID = strPaid;\n\t\t\t\tdoc.STAGE = stage;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis.reloadModel();\n\t\t\tthis._showCommonError();\n\t\t};\n\n\t\tajax.runAction('sale.payment.setpaid', {\n\t\t\tdata: {\n\t\t\t\tid: payment.ID,\n\t\t\t\tvalue: strPaid,\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_setShipmentShippedStatus(shipment: PaymentDocument, isShipped: boolean)\n\t{\n\t\tconst strShipped = isShipped ? 'Y' : 'N';\n\n\t\tif (shipment.DEDUCTED && shipment.DEDUCTED === strShipped) {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'SHIPMENT' && doc.ID === shipment.ID) {\n\t\t\t\tdoc.DEDUCTED = strShipped;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis.reloadModel();\n\t\t\tthis._showCommonError();\n\t\t};\n\n\t\tajax.runAction('sale.shipment.setshipped', {\n\t\t\tdata: {\n\t\t\t\tid: shipment.ID,\n\t\t\t\tvalue: strShipped,\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_removeDocument(doc: PaymentDocument)\n\t{\n\t\tlet action;\n\n\t\tif (doc.TYPE === 'PAYMENT') {\n\t\t\taction = 'sale.payment.delete';\n\t\t} else if (doc.TYPE === 'SHIPMENT') {\n\t\t\taction = 'sale.shipment.delete';\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter(item => {\n\t\t\treturn !(item.TYPE === doc.TYPE && item.ID === doc.ID);\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis.reloadModel();\n\t\t\tthis._showCommonError();\n\t\t};\n\n\t\tajax.runAction(action, {\n\t\t\tdata: {\n\t\t\t\tid: doc.ID\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_showCommonError()\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_COMMON_ERROR')\n\t\t});\n\t}\n\n\t_loading(isLoading: boolean)\n\t{\n\t\tif (this._rootNode && this._rootNode.classList)\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.add('is-loading');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.remove('is-loading');\n\t\t\t}\n\t\t}\n\t}\n\n\t_subscribeToGlobalEvents()\n\t{\n\t\tconst events = [\n\t\t\t'salescenter.app:onshipmentcreated',\n\t\t\t'salescenter.app:onpaymentcreated',\n\t\t\t'salescenter.app:onpaymentresend'\n\t\t];\n\t\tconst timeout = 500;\n\t\tconst reloadWidget = debounce(() => {\n\t\t\tthis.reloadModel();\n\t\t}, timeout);\n\t\tconst inCompatMode = {compatMode: true};\n\n\t\tlet sliderJustClosed = false;\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', event => {\n\t\t\tconst eventId = event.getEventId();\n\t\t\tif (events.indexOf(eventId) > -1) {\n\t\t\t\treloadWidget();\n\t\t\t\tsliderJustClosed = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsliderJustClosed = false;\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('oncrmentityupdate', () => {\n\t\t\treloadWidget();\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-crm', (command, params) => {\n\t\t\tif (command !== 'onOrderSave' || sliderJustClosed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet orderId = false;\n\t\t\tconst orderIds = this._orderIds();\n\t\t\tif (params.FIELDS && params.FIELDS.ID)\n\t\t\t{\n\t\t\t\torderId = parseInt(params.FIELDS.ID);\n\t\t\t}\n\t\t\tif (orderId && orderIds.indexOf(orderId) > -1)\n\t\t\t{\n\t\t\t\treloadWidget();\n\t\t\t}\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-salescenter', (command, params) => {\n\t\t\tif (command !== 'onOrderPaymentViewed')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet orderId = false;\n\t\t\tconst orderIds = this._orderIds();\n\t\t\tif (params && params.ORDER_ID)\n\t\t\t{\n\t\t\t\torderId = parseInt(params.ORDER_ID);\n\t\t\t\tif (orderIds.indexOf(orderId) > -1)\n\t\t\t\t{\n\t\t\t\t\treloadWidget();\n\t\t\t\t}\n\t\t\t}\n\t\t}, inCompatMode);\n\t}\n\n\t_setupCurrencyFormat()\n\t{\n\t\tif (this._options)\n\t\t{\n\t\t\tif (this._options.CURRENCY_ID && this._options.CURRENCY_FORMAT)\n\t\t\t{\n\t\t\t\tCurrencyCore.setCurrencyFormat(this._options.CURRENCY_ID, this._options.CURRENCY_FORMAT);\n\t\t\t}\n\t\t}\n\t}\n}\n","import {Loc, Tag} from 'main.core';\nimport {Label, LabelColor} from 'ui.label';\nimport {EntityEditorPaymentDocuments} from './entity-editor';\n\nexport class TimelineSummaryDocuments extends EntityEditorPaymentDocuments\n{\n\tstatic _rootNodeClass = 'crm-entity-stream-content-detail-table crm-entity-stream-content-documents-table';\n\n\t_renderDealTotalSum() {\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DEAL_SUM')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(this._options.DEAL_AMOUNT)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trender(): HTMLElement {\n\t\tthis._menus.forEach((menu) => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\n\t\tif (this.hasContent())\n\t\t{\n\t\t\tthis._filterSuccessfulDocuments();\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\t\t\tthis._rootNode.append(Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t${this._renderDealTotalSum()}\n\t\t\t\t\t${this._renderDocuments()}\n\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\n\t\treturn this._rootNode;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tconst openSlider = () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title}</a>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(doc.SUM)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderShipmentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t\t${title} (${doc.DELIVERY_NAME})\n\t\t\t\t\t</a>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(doc.SUM)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tconst totalSum = this._calculateTotalSum();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(totalSum)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_filterSuccessfulDocuments()\n\t{\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter((item) => {\n\t\t\treturn (\n\t\t\t\t(item.TYPE === 'PAYMENT' && item.PAID === 'Y')\n\t\t\t\t|| (item.TYPE === 'SHIPMENT' && item.DEDUCTED === 'Y')\n\t\t\t);\n\t\t});\n\t}\n}"],"names":["EntityEditorPaymentDocuments","options","_options","_isDeliveryAvailable","IS_DELIVERY_AVAILABLE","_parentContext","PARENT_CONTEXT","_rootNode","Tag","render","constructor","_rootNodeClass","_menus","_subscribeToGlobalEvents","_docs","length","forEach","menu","destroy","innerHTML","_setupCurrencyFormat","hasContent","classList","remove","append","_renderTitle","_renderDocuments","_renderAddDocument","_renderTotalSum","add","onSuccess","onError","DEAL_ID","data","dealId","successCallback","response","_loading","setOptions","Type","isFunction","_showCommonError","errorCallback","ajax","runAction","then","Loc","getMessage","nodes","doc","TYPE","push","_renderPaymentDocument","_renderShipmentDocument","title","replace","FORMATTED_DATE","sum","_renderMoney","SUM","labelOptions","text","STAGE","customClass","color","LabelColor","LIGHT","fill","LIGHT_GREEN","LIGHT_BLUE","PAID","popupMenu","menuItems","onclick","_chooseDeliverySlider","ORDER_ID","_resendPaymentSlider","ID","items","className","_setPaymentPaidStatus","close","MessageBox","show","message","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","_removeDocument","onCancel","openSlider","openMenu","event","preventDefault","MenuManager","create","id","bindElement","target","removeDocumentMenuItem","itemsContainer","querySelector","setAttribute","BX","UI","Hint","init","Label","DEDUCTED","_setShipmentShippedStatus","_viewDeliverySlider","DELIVERY_NAME","latestOrderId","_latestOrderId","_context","startSalescenterApplication","_createDeliverySlider","totalSum","parseFloat","DEAL_AMOUNT","_calculateTotalSum","node","fullPrice","CurrencyCore","currencyFormat","CURRENCY_ID","onlyPrice","currency","trim","DOCUMENTS","ORDER_IDS","map","parseInt","Math","max","_orderIds","CrmEntityType","enumeration","deal","orderId","context","templateMode","mode","analyticsLabel","ownerTypeId","_dealEntityType","ownerId","paymentId","disableSendButton","shipmentId","payment","isPaid","strPaid","stage","doNothingOnSuccess","reloadModelOnError","reloadModel","value","shipment","isShipped","strShipped","action","filter","item","Notification","Center","notify","content","isLoading","events","timeout","reloadWidget","debounce","inCompatMode","compatMode","sliderJustClosed","EventEmitter","subscribe","eventId","getEventId","indexOf","setTimeout","command","params","orderIds","FIELDS","CURRENCY_FORMAT","setCurrencyFormat","TimelineSummaryDocuments","_filterSuccessfulDocuments","_renderDealTotalSum"],"mappings":"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"}