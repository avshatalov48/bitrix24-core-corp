{"version":3,"file":"payment-documents.bundle.js","sources":["../src/document-manager.js","../src/entity-editor.js","../src/timeline-summary.js"],"sourcesContent":["import {Type, Uri} from \"main.core\";\n\nexport default class DocumentManager\n{\n\tstatic openRealizationDetailDocument(id, params = {})\n\t{\n\t\tlet url = DocumentManager.getRealizationDocumentDetailUrl(id, params);\n\t\tlet sliderOptions = params.hasOwnProperty('sliderOptions') ? params.sliderOptions : {};\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tDocumentManager.openSlider(url.toString(), sliderOptions).then((slider) =>\n\t\t\t{\n\t\t\t\tresolve(slider.getData());\n\t\t\t}).catch((reason) =>\n\t\t\t{\n\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic openNewRealizationDocument(params = {})\n\t{\n\t\tlet sliderOptions = {};\n\t\tif (params.hasOwnProperty('sliderOptions'))\n\t\t{\n\t\t\tsliderOptions = params.sliderOptions;\n\t\t\tdelete params.sliderOptions;\n\t\t}\n\n\t\tlet url = DocumentManager.getNewRealizationDocumentUrl(params);\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tDocumentManager.openSlider(url.toString(), sliderOptions).then((slider) =>\n\t\t\t{\n\t\t\t\tresolve(slider.getData());\n\t\t\t}).catch((reason) =>\n\t\t\t{\n\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic openSlider(url, options)\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\n\t\toptions = {...{cacheable: false, allowChangeHistory: false, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getRealizationDocumentDetailUrl(id, params)\n\t{\n\t\tlet url = new Uri('/shop/documents/details/sales_order/' + id + '/');\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\turl.setQueryParams(params);\n\t\t}\n\n\t\treturn url;\n\t}\n\n\tstatic getNewRealizationDocumentUrl(params)\n\t{\n\t\tlet url = new Uri('/shop/documents/details/sales_order/0/?DOCUMENT_TYPE=W');\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\turl.setQueryParams(params);\n\t\t}\n\n\t\treturn url;\n\t}\n}\n","// @flow\n\nimport { Tag, Loc, Type, ajax, debounce, Text, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuManager } from 'main.popup';\nimport { CurrencyCore } from 'currency.currency-core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Label, LabelColor } from 'ui.label';\nimport DocumentManager from './document-manager';\nimport { OneCPlanRestrictionSlider } from 'catalog.tool-availability-manager';\n\ndeclare var BX: {[key: string]: any};\n\ntype PaymentDocument = {\n\tID: number,\n\tORDER_ID: number,\n\tFORMATTED_DATE: string,\n\tSUM: number,\n\tTYPE: 'PAYMENT' | 'SHIPMENT' | 'SHIPMENT_DOCUMENT',\n\tPAID?: 'Y' | 'N',\n\tSTAGE?: 'NOT_PAID' | 'SENT_NO_VIEWED' | 'VIEWED_NO_PAID' | 'PAID' | 'CANCEL' | 'REFUND',\n\tDELIVERY_NAME?: string,\n\tDEDUCTED?: 'Y' | 'N',\n\tEMP_DEDUCTED_ID?: number,\n\tSTATUS?: 'Y' | 'N',\n\tWAS_CANCELLED?: 'Y' | 'N',\n\tACCOUNT_NUMBER?: string,\n};\n\ntype CheckDocument = {\n\tTYPE: 'CHECK',\n\tURL: string,\n\tTITLE: string,\n}\n\ntype OrderDocument = {\n\tID: number,\n\tACCOUNT_NUMBER: string,\n\tTITLE: string,\n\tPRICE_FORMAT: string,\n}\n\ntype CreateRealizationSliderOptions = {\n\torderId?: number,\n\tpaymentId?: number,\n};\n\ntype Phrases = {[string]: string};\n\ntype EntityEditorPaymentDocumentsOptions = {\n\tCONTEXT: string,\n\tCURRENCY_FORMAT: {},\n\tCURRENCY_ID: string,\n\tOWNER_TYPE_ID: number,\n\tOWNER_ID: number,\n\tENTITY_AMOUNT: number,\n\tDOCUMENTS: Array<PaymentDocument | CheckDocument>,\n\tORDERS: Array<OrderDocument>,\n\tORDER_IDS: Array<number>,\n\tPARENT_CONTEXT: StartsSalescenterApp,\n\tIS_DELIVERY_AVAILABLE: boolean,\n\tIS_USED_INVENTORY_MANAGEMENT: boolean,\n\tSALES_ORDERS_RIGHTS: {},\n\tIS_INVENTORY_MANAGEMENT_RESTRICTED: boolean,\n\tIS_WITH_ORDERS_MODE: boolean,\n\tSHOULD_SHOW_CASHBOX_CHECKS: boolean,\n\tPHRASES: Phrases,\n\tPAID_AMOUNT: number,\n\tTOTAL_AMOUNT: number,\n};\n\ntype Destroyable = {\n\tdestroy(): any\n};\n\ntype StartsSalescenterApp = {\n\tstartSalescenterApplication(): any\n};\n\nconst SPECIFIC_REALIZATION_ERROR_CODES = [\n\t'REALIZATION_ACCESS_DENIED',\n\t'REALIZATION_CANNOT_DELETE',\n\t'REALIZATION_ALREADY_DEDUCTED',\n\t'REALIZATION_NOT_DEDUCTED',\n\t'REALIZATION_PRODUCT_NOT_FOUND',\n\t'SHIPMENT_ACCESS_DENIED',\n\t'PAYMENT_ACCESS_DENIED',\n];\n\nconst SPECIFIC_ERROR_CODES = [...SPECIFIC_REALIZATION_ERROR_CODES,\n\t'DEDUCTION_STORE_ERROR1',\n\t'SALE_PROVIDER_SHIPMENT_QUANTITY_NOT_ENOUGH',\n\t'SALE_SHIPMENT_EXIST_SHIPPED',\n\t'SALE_PAYMENT_DELETE_EXIST_PAID',\n\t'DDCT_DEDUCTION_QUANTITY_STORE_ERROR',\n\t'CRM_REALIZATION_NOT_ENOUGH_PRODUCTS',\n\t'BX_ERROR',\n];\n\ntype AjaxHandler = (...args: Array<any>) => any;\n\nexport class EntityEditorPaymentDocuments\n{\n\t_options: EntityEditorPaymentDocumentsOptions;\n\t_isDeliveryAvailable: boolean;\n\t_isTerminalAvailable: boolean;\n\t_parentContext: StartsSalescenterApp;\n\t_callContext: string;\n\t_rootNode: HTMLElement;\n\t_menus: Array<Destroyable>;\n\t_phrases: Phrases;\n\tstatic _rootNodeClass = 'crm-entity-widget-inner crm-entity-widget-inner--payment';\n\n\tconstructor(options: EntityEditorPaymentDocumentsOptions)\n\t{\n\t\tthis._options = options;\n\t\tthis._phrases = {};\n\t\tif (Type.isPlainObject(options.PHRASES))\n\t\t{\n\t\t\tthis._phrases = options.PHRASES;\n\t\t}\n\t\tthis._isDeliveryAvailable = this._options.IS_DELIVERY_AVAILABLE;\n\t\tthis._isTerminalAvailable = this._options.IS_TERMINAL_AVAILABLE;\n\t\tthis._parentContext = options.PARENT_CONTEXT;\n\t\tthis._callContext = options.CONTEXT;\n\t\tthis._rootNode = Tag.render`<div class=\"${this.constructor._rootNodeClass}\"></div>`;\n\t\tthis._menus = [];\n\t\tthis._isUsedInventoryManagement = this._options.IS_USED_INVENTORY_MANAGEMENT;\n\t\tthis._salesOrderRights = this._options.SALES_ORDERS_RIGHTS;\n\t\tthis._isInventoryManagementRestricted = this._options.IS_INVENTORY_MANAGEMENT_RESTRICTED;\n\t\tthis._isInventoryManagement1cRestricted = this._options.IS_1C_PLAN_RESTRICTED;\n\t\tthis._isWithOrdersMode = this._options.IS_WITH_ORDERS_MODE;\n\t\tthis._isInventoryManagementToolEnabled = this._options.IS_INVENTORY_MANAGEMENT_TOOL_ENABLED;\n\t\tthis._isOnecMode = this._options.IS_ONEC_MODE;\n\t\tthis._isSalescenterToolEnabled = this._options.IS_SALESCENTER_TOOL_ENABLED;\n\t\tthis._isTerminalToolEnabled = this._options.IS_TERMINAL_TOOL_ENABLED;\n\t\tthis._shouldShowCashboxChecks = this._options.SHOULD_SHOW_CASHBOX_CHECKS;\n\n\t\tthis._subscribeToGlobalEvents();\n\t}\n\n\thasContent(): boolean\n\t{\n\t\treturn this._docs().length > 0;\n\t}\n\n\tcanAddRealization(): boolean\n\t{\n\t\treturn this._isUsedInventoryManagement\n\t\t\t&& !this._isWithOrdersMode\n\t\t\t&& this._salesOrderRights?.modify;\n\t}\n\n\tsetVisible(visible: boolean): void\n\t{\n\t\tconst isHidden = this._rootNode.classList.contains('is-hidden');\n\n\t\tif (visible && isHidden)\n\t\t{\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\t\t}\n\t\telse if (!visible && !isHidden)\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis._menus.forEach((menu) => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\t\tthis._setEmptyState();\n\n\t\tthis._rootNode.append(Tag.render`\n\t\t\t<div class=\"crm-entity-widget-content-block-inner-container\">\n\t\t\t\t<div class=\"crm-entity-widget-payment\">\n\t\t\t\t\t${this._renderDetail()}\n\t\t\t\t\t${this._renderDocuments()}\n\t\t\t\t\t${this._renderAddDocument()}\n\t\t\t\t\t${this._renderDelimiter()}\n\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\treturn this._rootNode;\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tthis._options = options;\n\t}\n\n\treloadModel(onSuccess?: AjaxHandler, onError?: AjaxHandler)\n\t{\n\t\tif (!this._options.OWNER_ID)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = {\n\t\t\tdata: {\n\t\t\t\townerTypeId: this._options.OWNER_TYPE_ID,\n\t\t\t\townerId: this._options.OWNER_ID,\n\t\t\t},\n\t\t};\n\n\t\tconst successCallback = (response) => {\n\t\t\tthis._loading(false);\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.setOptions(response.data);\n\t\t\t\tthis.render();\n\t\t\t\tif (onSuccess && Type.isFunction(onSuccess))\n\t\t\t\t{\n\t\t\t\t\tonSuccess(response);\n\t\t\t\t}\n\n\t\t\t\tthis._emitChangeDocumentsEvent();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._showCommonError();\n\t\t\t\tif (onError && Type.isFunction(onError))\n\t\t\t\t{\n\t\t\t\t\tonError();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst errorCallback = () => {\n\t\t\tthis._loading(false);\n\t\t\tthis._showCommonError();\n\t\t\tif (onError && Type.isFunction(onError))\n\t\t\t{\n\t\t\t\tonError();\n\t\t\t}\n\t\t};\n\n\t\tthis._loading(true);\n\n\t\tajax.runAction('crm.api.entity.fetchPaymentDocuments', data).then(successCallback, errorCallback);\n\t}\n\n\t_renderDetail(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-caption\">${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TITLE_MSGVER_2')}</div>\n\t\t\t\t${!this.hasContent() ? this._renderEmptyStateDescription() : ''}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderEmptyStateDescription(): HTMLElement\n\t{\n\t\tconst description = this.canAddRealization()\n\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_EMPTYSTATE_DESCRIPTION_WITH_REALIZATION')\n\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_EMPTYSTATE_DESCRIPTION');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail-description\">${description}</div>\n\t\t`;\n\t}\n\n\t_renderDelimiter(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"ui-entity-editor-delimiter\"></div>`;\n\t}\n\n\t_setEmptyState(): void\n\t{\n\t\tconst isSetAsEmpty = this._rootNode.classList.contains('is-empty');\n\n\t\tif (!this.hasContent() && !isSetAsEmpty)\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-empty');\n\t\t}\n\t\telse if (this.hasContent() && isSetAsEmpty)\n\t\t{\n\t\t\tthis._rootNode.classList.remove('is-empty');\n\t\t}\n\t}\n\n\t_renderDocuments(): HTMLElement[]\n\t{\n\t\tconst nodes = [];\n\t\tthis._docs().forEach((doc) => {\n\t\t\tif (doc.TYPE === 'PAYMENT' || doc.TYPE === 'TERMINAL_PAYMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderPaymentDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderDeliveryDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT_DOCUMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderRealizationDocument(doc));\n\t\t\t}\n\t\t});\n\n\t\treturn nodes;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE_MSGVER_2')\n\t\t\t.replaceAll(/#date#/gi, doc.FORMATTED_DATE)\n\t\t\t.replaceAll(/#account_number#/gi, doc.ACCOUNT_NUMBER)\n\t\t\t.replaceAll(/#sum#/gi, this._renderMoney(doc.SUM))\n\t\t;\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tlet popupMenu;\n\t\tconst menuItems = [];\n\t\tif (this._isDeliveryAvailable && doc.TYPE === 'PAYMENT')\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\tonclick: () => this._chooseDeliverySlider(doc.ORDER_ID),\n\t\t\t});\n\t\t}\n\n\t\tconst realizationMenuItem = this._getRealizationMenuItem(\n\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_REALIZATION'),\n\t\t\t() => this._createRealizationSlider({ paymentId: doc.ID }),\n\t\t);\n\t\tif (realizationMenuItem)\n\t\t{\n\t\t\tmenuItems.push(realizationMenuItem);\n\t\t}\n\n\t\tif (doc.TYPE === 'PAYMENT')\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_RESEND'),\n\t\t\t\tonclick: () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID),\n\t\t\t});\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_PAYMENT_STATUS'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, true);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_NOT_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, false);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tif (this._shouldShowCashboxChecks)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CASHBOX_CHECKS'),\n\t\t\t\tonclick: () => this._openPaymentChecksListSlider(doc.ID),\n\t\t\t});\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-no-icon crm-entity-widget-payment-menu-item-remove' : '',\n\t\t\tonclick: () => {\n\t\t\t\tif (doc.PAID === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tpopupMenu.close();\n\t\t\t\tMessageBox.confirm(\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_CONFIRM_TEXT_MSGVER_2'),\n\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t},\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_BUTTON_CONFIRM'),\n\t\t\t\t\t(messageBox) => messageBox.close(),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_BUTTON_BACK'),\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tconst openSlider = () => {\n\t\t\tif (doc.TYPE === 'TERMINAL_PAYMENT')\n\t\t\t{\n\t\t\t\tthis._viewTerminalPaymentSlider(doc.ORDER_ID, doc.ID);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\t\t\t}\n\t\t}\n\n\t\tconst openMenu = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: `payment-documents-payment-action-${doc.ID}`,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-payment-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_REMOVE_TIP_MSGVER_1'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title}</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDeliveryDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE_MSGVER_2')\n\t\t\t.replaceAll(/#date#/gi, doc.FORMATTED_DATE)\n\t\t\t.replaceAll(/#account_number#/gi, doc.ACCOUNT_NUMBER)\n\t\t\t.replaceAll(/#sum#/gi, this._renderMoney(doc.SUM))\n\t\t\t.replaceAll(/#delivery_name#/gi, doc.DELIVERY_NAME)\n\t\t;\n\n\t\tlet popupMenu;\n\t\tconst menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_DELIVERY_STATUS'),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, true);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, false);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-no-icon crm-entity-widget-shipment-menu-item-remove' : '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (doc.DEDUCTED === 'Y')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_CONFIRM_TEXT_MSGVER_2'),\n\t\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_BUTTON_CONFIRM'),\n\t\t\t\t\t\t(messageBox) => messageBox.close(),\n\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_BUTTON_BACK'),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\tconst openMenu = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: `payment-documents-delivery-action-${doc.ID}`,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-shipment-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_REMOVE_TIP_MSGVER_1'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t${title}\n\t\t\t\t</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderRealizationDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse\n\t\tif (doc.EMP_DEDUCTED_ID)\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_ORANGE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT');\n\t\t\tlabelOptions.color = LabelColor.LIGHT;\n\t\t}\n\n\t\tlet title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE_MSGVER_2')\n\t\t\t.replaceAll(/#date#/gi, doc.FORMATTED_DATE)\n\t\t\t.replaceAll(/#document_id#/gi, doc.ACCOUNT_NUMBER)\n\t\t;\n\t\ttitle = BX.util.htmlspecialchars(title);\n\t\ttitle = title.replaceAll(/#sum#/gi, this._renderMoney(doc.SUM));\n\n\t\tlet popupMenu;\n\t\tconst menuItems = [];\n\n\t\tif (this._salesOrderRights?.view)\n\t\t{\n\t\t\tif (doc.DEDUCTED === 'Y' && this._salesOrderRights?.conduct && !this._isOnecMode)\n\t\t\t{\n\t\t\t\tif (this._salesOrderRights?.conduct)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCEL'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setRealizationDeductedStatus(doc, false);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (doc.DEDUCTED !== 'Y' && this._salesOrderRights?.cancel)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CONDUCT'),\n\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setRealizationDeductedStatus(doc, true);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this._salesOrderRights?.delete && !(this._isOnecMode && doc.DEDUCTED === 'Y'))\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-no-icon crm-entity-widget-realization-menu-item-remove' : '',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tif (doc.DEDUCTED === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_TEXT_MSGVER_1'),\n\t\t\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_BUTTON_CONFIRM'),\n\t\t\t\t\t\t\t(messageBox) => messageBox.close(),\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_BUTTON_BACK'),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this._isOnecMode && doc.DEDUCTED === 'Y')\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_OPEN'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\tthis._viewRealizationSlider(doc.ID);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst openSlider = () => this._viewRealizationSlider(doc.ID);\n\n\t\tconst openMenu = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: `payment-documents-realization-action-${doc.ID}`,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-realization-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REALIZATION_REMOVE_TIP_MSGVER_1'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\tconst actionMenu =\t\t\tmenuItems.length > 0\n\t\t\t? Tag.render`\n\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t</div>\n\t\t\t`\n\t\t\t: ''\n\t\t;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t${title}\n\t\t\t\t</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t${actionMenu}\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderAddDocument(): HTMLElement\n\t{\n\t\tconst latestOrderId = this._latestOrderId();\n\n\t\tconst menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT'),\n\t\t\t\tonclick: () => this._createPaymentSlider(latestOrderId),\n\t\t\t}\n\t\t];\n\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT_DELIVERY'),\n\t\t\t\tonclick: () => this._createPaymentDeliverySlider(latestOrderId),\n\t\t\t});\n\t\t}\n\n\t\tif (this._isTerminalAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_TERMINAL_PAYMENT'),\n\t\t\t\tonclick: () => this._createTerminalPaymentSlider(latestOrderId),\n\t\t\t});\n\t\t}\n\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_DELIVERY'),\n\t\t\t\tonclick: () => this._createDeliverySlider(latestOrderId),\n\t\t\t});\n\t\t}\n\n\t\tconst realizationMenuItem = this._getRealizationMenuItem(\n\t\t\tLoc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_SHIPMENT_DOCUMENT'),\n\t\t\t() => this._createRealizationSlider({ orderId: latestOrderId }),\n\t\t);\n\t\tif (realizationMenuItem)\n\t\t{\n\t\t\tmenuItems.push(realizationMenuItem);\n\t\t}\n\n\t\tconst openMenu = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tconst popupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-create-document-action',\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t\tpopupMenu.show();\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-add-box\">\n\t\t\t\t<a href=\"#\" class=\"ui-entity-editor-content-add-lnk\" onclick=\"${openMenu}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_DOCUMENT_MSGVER_2')}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_getRealizationMenuItem(text: string, onclick: Function): ?Object\n\t{\n\t\tconst isAvailableInventoryManagement = this._isUsedInventoryManagement && !this._isWithOrdersMode;\n\t\tif (isAvailableInventoryManagement && this._salesOrderRights?.modify)\n\t\t{\n\t\t\tconst menuItem = {\n\t\t\t\ttext,\n\t\t\t};\n\n\t\t\tif (this._isOnecMode && this._isInventoryManagement1cRestricted)\n\t\t\t{\n\t\t\t\tmenuItem.onclick = () => {\n\t\t\t\t\tOneCPlanRestrictionSlider.show();\n\t\t\t\t};\n\t\t\t\tmenuItem.className = 'realization-document-tariff-lock';\n\t\t\t}\n\t\t\telse if (!this._isOnecMode && this._isInventoryManagementRestricted)\n\t\t\t{\n\t\t\t\tmenuItem.onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t\t\tmenuItem.className = 'realization-document-tariff-lock';\n\t\t\t}\n\t\t\telse if (!this._isInventoryManagementToolEnabled)\n\t\t\t{\n\t\t\t\tmenuItem.onclick = () => {\n\t\t\t\t\tRuntime.loadExtension('catalog.tool-availability-manager').then((exports) => {\n\t\t\t\t\t\tconst { ToolAvailabilityManager } = exports;\n\t\t\t\t\t\tToolAvailabilityManager.openInventoryManagementToolDisabledSlider();\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.onclick = onclick;\n\t\t\t}\n\n\t\t\treturn menuItem;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tconst totalSum = this._options.TOTAL_AMOUNT;\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-total\">\n\t\t\t\t<span>\n\t\t\t\t\t${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM')}\n\t\t\t\t\t<span data-hint=\"${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM_TOOLTIP')}\"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"crm-entity-widget-payment-text\">${this._renderMoney(totalSum)}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Hint.init(node);\n\n\t\treturn node;\n\t}\n\n\t_renderMoney(sum: number): string\n\t{\n\t\tconst fullPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, true);\n\t\tconst onlyPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, false);\n\t\tconst currency = fullPrice.replace(onlyPrice, '').trim();\n\n\t\treturn fullPrice.replace(currency, `<span class=\"crm-entity-widget-payment-currency\">${currency}</span>`);\n\t}\n\n\t_docs(): Array<PaymentDocument | CheckDocument>\n\t{\n\t\tif (this._options && this._options.DOCUMENTS && this._options.DOCUMENTS.length > 0)\n\t\t{\n\t\t\treturn this._options.DOCUMENTS;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t_orders(): Array<OrderDocument>\n\t{\n\t\tif (this._options && this._options.ORDERS && this._options.ORDERS.length > 0)\n\t\t{\n\t\t\treturn this._options.ORDERS;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t_context(): StartsSalescenterApp\n\t{\n\t\treturn this._parentContext;\n\t}\n\n\t_orderIds(): Array<number>\n\t{\n\t\tif (this._options && this._options.ORDER_IDS && this._options.ORDER_IDS.length > 0)\n\t\t{\n\t\t\treturn this._options.ORDER_IDS.map((id) => parseInt(id));\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t// @todo: provide test\n\t_latestOrderId(): number\n\t{\n\t\tconst latestOrder = parseInt(Math.max(...this._orderIds()));\n\n\t\treturn latestOrder > 0 ? latestOrder : 0;\n\t}\n\n\t_ownerTypeId(): number\n\t{\n\t\treturn this._options.OWNER_TYPE_ID || BX.CrmEntityType.enumeration.deal;\n\t}\n\n\t_defaultCreatePaymentDocumentOptions()\n\t{\n\t\treturn {\n\t\t\tcontext: this._callContext,\n\t\t\ttemplateMode: 'create',\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t};\n\t}\n\n\t/**\n\t * @see #getAnalyticLabels for new analytics, this is for old analytics and will be deprecated in the future\n\t * @param labelMode converting to PascalCase before inserting into label template\n\t * @returns {string} final analytics label\n\t * @private\n\t *\n\t * Label template: crm#TYPE#PaymentDocuments#MODE#Slider\n\t * Type: Deal or DynamicType\n\t * Mode: create_payment, create_delivery, view_realization etc.\n\t *\n\t * Mode converts to PascalCase and inserts into label template\n\t *\n\t * Example: crmDealPaymentDocumentsCreateDeliverySlider\n\t */\n\t_generateAnalyticsLabel(labelMode: string)\n\t{\n\t\tconst labelTemplate = 'crm#TYPE#PaymentDocuments#MODE#Slider';\n\n\t\tlet labelEntityType = 'Deal';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tlabelEntityType = 'DynamicType';\n\t\t}\n\t\tconst mode = Text.toPascalCase(labelMode);\n\n\t\treturn labelTemplate.replace('#TYPE#', labelEntityType)\n\t\t\t.replace('#MODE#', mode);\n\t}\n\n\t#getAnalyticLabels(type: string): Object\n\t{\n\t\tconst labels = {\n\t\t\ttool: 'crm',\n\t\t\tcategory: 'payments',\n\t\t\tevent: 'payment_create_click',\n\t\t\tc_section: 'crm',\n\t\t\tc_sub_section: 'web',\n\t\t\ttype,\n\t\t};\n\n\t\treturn labels;\n\t}\n\n\t_createPaymentSlider(orderId: number)\n\t{\n\t\tif (!this._isSalescenterToolEnabled)\n\t\t{\n\t\t\tRuntime.loadExtension('salescenter.tool-availability-manager').then((exports) => {\n\t\t\t\tconst { ToolAvailabilityManager } = exports;\n\t\t\t\tToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._defaultCreatePaymentDocumentOptions();\n\t\toptions.mode = 'payment';\n\t\toptions.analyticsLabel = this._generateAnalyticsLabel('create_payment');\n\t\toptions.st = this.#getAnalyticLabels('payment');\n\t\toptions.orderId = orderId;\n\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_createDeliverySlider(orderId: number)\n\t{\n\t\tif (!this._isSalescenterToolEnabled)\n\t\t{\n\t\t\tRuntime.loadExtension('salescenter.tool-availability-manager').then((exports) => {\n\t\t\t\tconst { ToolAvailabilityManager } = exports;\n\t\t\t\tToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._defaultCreatePaymentDocumentOptions();\n\t\toptions.mode = 'delivery';\n\t\toptions.analyticsLabel = this._generateAnalyticsLabel('create_delivery');\n\t\toptions.orderId = orderId;\n\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_createPaymentDeliverySlider(orderId: number)\n\t{\n\t\tif (!this._isSalescenterToolEnabled)\n\t\t{\n\t\t\tRuntime.loadExtension('salescenter.tool-availability-manager').then((exports) => {\n\t\t\t\tconst { ToolAvailabilityManager } = exports;\n\t\t\t\tToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._defaultCreatePaymentDocumentOptions();\n\t\toptions.mode = 'payment_delivery';\n\t\toptions.analyticsLabel = this._generateAnalyticsLabel('create_payment_delivery');\n\t\toptions.st = this.#getAnalyticLabels('delivery_payment');\n\t\toptions.orderId = orderId;\n\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_createRealizationSlider(createSliderOptions: CreateRealizationSliderOptions)\n\t{\n\t\tconst options = {\n\t\t\tcontext: {\n\t\t\t\tOWNER_TYPE_ID: this._ownerTypeId(),\n\t\t\t\tOWNER_ID: this._options.OWNER_ID,\n\t\t\t\tORDER_ID: createSliderOptions.orderId || 0,\n\t\t\t\tPAYMENT_ID: createSliderOptions.paymentId || 0,\n\t\t\t},\n\t\t\tanalyticsLabel: this._generateAnalyticsLabel('create_realization'),\n\t\t\tdocumentType: 'W',\n\t\t\tsliderOptions: {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\tloader: 'crm-entity-details-loader',\n\t\t\t\trequestMethod: 'post',\n\t\t\t},\n\t\t};\n\n\t\tDocumentManager.openNewRealizationDocument(options).then((result) => {\n\t\t\tthis.reloadModel();\n\t\t\tthis._reloadOwner();\n\t\t});\n\t}\n\n\t_createTerminalPaymentSlider(orderId)\n\t{\n\t\tif (!this._isTerminalToolEnabled)\n\t\t{\n\t\t\tRuntime.loadExtension('ui.info-helper').then(() => {\n\t\t\t\ttop.BX.UI.InfoHelper.show('limit_crm_terminal_off');\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._defaultCreatePaymentDocumentOptions();\n\t\toptions.mode = 'terminal_payment';\n\t\toptions.analyticsLabel = this._generateAnalyticsLabel('create_terminal_payment');\n\t\toptions.st = this.#getAnalyticLabels('terminal_payment');\n\t\toptions.orderId = orderId;\n\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_chooseDeliverySlider(orderId: number)\n\t{\n\t\tconst options = this._defaultCreatePaymentDocumentOptions();\n\t\toptions.mode = 'delivery';\n\t\toptions.analyticsLabel = this._generateAnalyticsLabel('choose_delivery');\n\t\toptions.orderId = orderId;\n\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_openPaymentChecksListSlider(paymentId: number)\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\tBX.Uri.addParam('/crm/payment/checks/list.php', {\n\t\t\t\towner_id: paymentId,\n\t\t\t\towner_type: BX.CrmEntityType.enumeration.orderpayment,\n\t\t\t}),\n\t\t\t{\n\t\t\t\twidth: 1500,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t);\n\t}\n\n\t_resendPaymentSlider(orderId: number, paymentId: number)\n\t{\n\t\tconst options = {\n\t\t\tdisableSendButton: '',\n\t\t\tcontext: 'deal',\n\t\t\tmode: this._ownerTypeId() === BX.CrmEntityType.enumeration.deal ? 'payment_delivery' : 'payment',\n\t\t\tanalyticsLabel: this._generateAnalyticsLabel('resend_payment'),\n\t\t\ttemplateMode: 'view',\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId,\n\t\t\tpaymentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_viewDeliverySlider(orderId: number, shipmentId: number)\n\t{\n\t\tconst options = {\n\t\t\tcontext: this._callContext,\n\t\t\ttemplateMode: 'view',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: this._generateAnalyticsLabel('view_delivery'),\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId,\n\t\t\tshipmentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_viewRealizationSlider(documentId: number)\n\t{\n\t\tconst options = {\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\tanalyticsLabel: this._generateAnalyticsLabel('view_realization'),\n\t\t\tdocumentId: documentId,\n\t\t\tsliderOptions: {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\tloader: 'crm-entity-details-loader',\n\t\t\t},\n\t\t};\n\n\t\tDocumentManager.openRealizationDetailDocument(documentId, options).then((result) => {\n\t\t\tthis._reloadOwner();\n\t\t});\n\t}\n\n\t_viewTerminalPaymentSlider(orderId: number, paymentId: number)\n\t{\n\t\tconst options = {\n\t\t\tcontext: 'deal',\n\t\t\tmode: 'terminal_payment',\n\t\t\tanalyticsLabel: this._generateAnalyticsLabel('view_terminal_payment'),\n\t\t\ttemplateMode: 'view',\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId,\n\t\t\tpaymentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_setPaymentPaidStatus(payment: PaymentDocument, isPaid: boolean)\n\t{\n\t\tconst strPaid = isPaid ? 'Y' : 'N';\n\t\tconst stage = isPaid ? 'PAID' : 'CANCEL';\n\n\t\tif (payment.PAID && payment.PAID === strPaid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach((doc) => {\n\t\t\tif (doc.TYPE === 'PAYMENT' && doc.ID === payment.ID)\n\t\t\t{\n\t\t\t\tdoc.PAID = strPaid;\n\t\t\t\tdoc.STAGE = stage;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst callEventOnSuccess = (response) => {\n\t\t\tEventEmitter.emit('PaymentDocuments.EntityEditor:changePaymentPaidStatus', {\n\t\t\t\tentityTypeId: this._options.OWNER_TYPE_ID,\n\t\t\t\tentityId: this._options.OWNER_ID,\n\t\t\t});\n\n\t\t\tthis._emitChangeDocumentsEvent();\n\t\t};\n\n\t\tconst reloadModelOnError = (response) => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tajax.runAction('crm.order.payment.setPaid', {\n\t\t\tdata: {\n\t\t\t\tid: payment.ID,\n\t\t\t\tvalue: strPaid,\n\t\t\t},\n\t\t}).then(callEventOnSuccess, reloadModelOnError);\n\t}\n\n\t_setShipmentShippedStatus(shipment: PaymentDocument, isShipped: boolean)\n\t{\n\t\tconst strShipped = isShipped ? 'Y' : 'N';\n\n\t\tif (shipment.DEDUCTED && shipment.DEDUCTED === strShipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._docs().forEach((doc) => {\n\t\t\tif (doc.TYPE === 'SHIPMENT' && doc.ID === shipment.ID)\n\t\t\t{\n\t\t\t\tdoc.DEDUCTED = strShipped;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst callEventOnSuccess = (response) => {\n\t\t\tEventEmitter.emit('PaymentDocuments.EntityEditor:changeShipmentShippedStatus', {\n\t\t\t\tentityTypeId: this._options.OWNER_TYPE_ID,\n\t\t\t\tentityId: this._options.OWNER_ID,\n\t\t\t});\n\n\t\t\tthis._emitChangeDocumentsEvent();\n\t\t};\n\n\t\tconst reloadModelOnError = (response) => {\n\t\t\tthis._showShipmentStatusError(response, shipment.ID);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tlet actionName = 'crm.order.shipment.setShipped';\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tactionName = 'crm.api.realizationdocument.setShipped';\n\t\t}\n\n\t\tajax.runAction(actionName, {\n\t\t\tdata: {\n\t\t\t\tid: shipment.ID,\n\t\t\t\tvalue: strShipped,\n\t\t\t},\n\t\t}).then(callEventOnSuccess, reloadModelOnError);\n\t}\n\n\t_setRealizationDeductedStatus(shipment: PaymentDocument, isShipped: boolean)\n\t{\n\t\tconst strShipped = isShipped ? 'Y' : 'N';\n\n\t\tif (shipment.DEDUCTED && shipment.DEDUCTED === strShipped)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._docs().forEach((doc) => {\n\t\t\tif (doc.TYPE === 'SHIPMENT_DOCUMENT' && doc.ID === shipment.ID)\n\t\t\t{\n\t\t\t\tdoc.DEDUCTED = strShipped;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst callEventOnSuccess = (response) => {\n\t\t\tEventEmitter.emit('PaymentDocuments.EntityEditor:changeRealizationDeductedStatus', {\n\t\t\t\tentityTypeId: this._options.OWNER_TYPE_ID,\n\t\t\t\tentityId: this._options.OWNER_ID,\n\t\t\t});\n\n\t\t\tthis._emitChangeDocumentsEvent();\n\t\t};\n\n\t\tconst reloadModelOnError = (response) => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tajax.runAction('crm.api.realizationdocument.setShipped', {\n\t\t\tdata: {\n\t\t\t\tid: shipment.ID,\n\t\t\t\tvalue: strShipped,\n\t\t\t},\n\t\t}).then(callEventOnSuccess, reloadModelOnError);\n\t}\n\n\t_removeDocument(doc: PaymentDocument)\n\t{\n\t\tlet action;\n\t\tconst data = {\n\t\t\tid: doc.ID,\n\t\t};\n\n\t\taction = this._resolveRemoveDocumentActionName(doc.TYPE);\n\t\tif (!action)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (doc.TYPE === 'SHIPMENT_DOCUMENT')\n\t\t{\n\t\t\tdata.value = 'N';\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter((item) => {\n\t\t\treturn !(item.TYPE === doc.TYPE && item.ID === doc.ID);\n\t\t});\n\t\tthis.render();\n\n\t\tconst onSuccess = (response) => {\n\t\t\tthis._reloadOwner();\n\t\t\tthis._emitChangeDocumentsEvent();\n\t\t};\n\n\t\tconst reloadModelOnError = (response) => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tajax.runAction(action, {\n\t\t\tdata,\n\t\t}).then(onSuccess, reloadModelOnError);\n\t}\n\n\t_resolveRemoveDocumentActionName(type: string)\n\t{\n\t\tlet action = '';\n\n\t\tif (type === 'PAYMENT' || type === 'TERMINAL_PAYMENT')\n\t\t{\n\t\t\taction = 'crm.order.payment.delete';\n\t\t}\n\t\telse if (type === 'SHIPMENT')\n\t\t{\n\t\t\taction = 'crm.order.shipment.delete';\n\t\t}\n\t\telse if (type === 'SHIPMENT_DOCUMENT')\n\t\t{\n\t\t\taction = 'crm.api.realizationdocument.setRealization';\n\t\t}\n\n\t\treturn action;\n\t}\n\n\t_showShipmentStatusError(response, shipmentId)\n\t{\n\t\tlet showCommonError = true;\n\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\tif (SPECIFIC_ERROR_CODES.has(error.code))\n\t\t\t\t{\n\t\t\t\t\tshowCommonError = false;\n\n\t\t\t\t\tlet notifyMessage = error.message;\n\t\t\t\t\tif (!SPECIFIC_REALIZATION_ERROR_CODES.includes(error.code))\n\t\t\t\t\t{\n\t\t\t\t\t\tnotifyMessage = BX.util.htmlspecialchars(notifyMessage);\n\t\t\t\t\t}\n\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: notifyMessage,\n\t\t\t\t\t\twidth: 'auto',\n\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_OPEN_REALIZATION_DOCUMENT'),\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\t\t\t\t\tthis._viewRealizationSlider(shipmentId);\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (showCommonError)\n\t\t{\n\t\t\tthis._showCommonError();\n\t\t}\n\t}\n\n\t_showErrorOnAction(response)\n\t{\n\t\tlet showCommonError = true;\n\n\t\tresponse.errors.forEach((error) => {\n\t\t\tif (SPECIFIC_ERROR_CODES.includes(error.code))\n\t\t\t{\n\t\t\t\tshowCommonError = false;\n\t\t\t\tthis._showSpecificError(error.code, error.message);\n\t\t\t}\n\t\t});\n\n\t\tif (showCommonError)\n\t\t{\n\t\t\tthis._showCommonError();\n\t\t}\n\t}\n\n\t_showSpecificError(code, message)\n\t{\n\t\tlet notifyMessage = message;\n\t\tif (!SPECIFIC_REALIZATION_ERROR_CODES.includes(code))\n\t\t{\n\t\t\tnotifyMessage = BX.util.htmlspecialchars(notifyMessage);\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: notifyMessage,\n\t\t});\n\t}\n\n\t_showCommonError()\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_COMMON_ERROR_MSGVER_1'),\n\t\t});\n\t}\n\n\t_loading(isLoading: boolean)\n\t{\n\t\tif (this._rootNode && this._rootNode.classList)\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.add('is-loading');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.remove('is-loading');\n\t\t\t}\n\t\t}\n\t}\n\n\t_emitChangeDocumentsEvent()\n\t{\n\t\tEventEmitter.emit('PaymentDocuments.EntityEditor:changeDocuments', {\n\t\t\tentityTypeId: this._options.OWNER_TYPE_ID,\n\t\t\tentityId: this._options.OWNER_ID,\n\t\t});\n\t}\n\n\t_subscribeToGlobalEvents()\n\t{\n\t\tconst events = new Set([\n\t\t\t'salescenter.app:onshipmentcreated',\n\t\t\t'salescenter.app:onpaymentcreated',\n\t\t\t'salescenter.app:onpaymentresend',\n\t\t\t'salescenter.app:onterminalpaymentcreated',\n\t\t]);\n\t\tconst timeout = 500;\n\t\tconst reloadWidget = debounce(() => {\n\t\t\tthis.reloadModel();\n\t\t}, timeout);\n\t\tconst inCompatMode = { compatMode: true };\n\n\t\tlet sliderJustClosed = false;\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst eventId = event.getEventId();\n\t\t\tif (events.has(eventId))\n\t\t\t{\n\t\t\t\treloadWidget();\n\t\t\t\tsliderJustClosed = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsliderJustClosed = false;\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('oncrmentityupdate', () => {\n\t\t\treloadWidget();\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-crm', (command, params) => {\n\t\t\tif (command !== 'onOrderSave' || sliderJustClosed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treloadWidget();\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-salescenter', (command, params) => {\n\t\t\tif (command !== 'onOrderPaymentViewed')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet orderId = false;\n\t\t\tconst orderIds = this._orderIds();\n\t\t\tif (params && params.ORDER_ID)\n\t\t\t{\n\t\t\t\torderId = parseInt(params.ORDER_ID);\n\t\t\t\tif (orderIds.includes(orderId))\n\t\t\t\t{\n\t\t\t\t\treloadWidget();\n\t\t\t\t}\n\t\t\t}\n\t\t}, inCompatMode);\n\t}\n\n\t_setupCurrencyFormat()\n\t{\n\t\tif (this._options && this._options.CURRENCY_ID && this._options.CURRENCY_FORMAT)\n\t\t{\n\t\t\tCurrencyCore.setCurrencyFormat(this._options.CURRENCY_ID, this._options.CURRENCY_FORMAT);\n\t\t}\n\t}\n\n\t_reloadOwner()\n\t{\n\t\tif (this._parentContext instanceof BX.Crm.EntityEditorMoneyPay)\n\t\t{\n\t\t\tthis._parentContext._editor.reload();\n\t\t\tthis._parentContext._editor.tapController('PRODUCT_LIST', (controller) => {\n\t\t\t\tcontroller.reinitializeProductList();\n\t\t\t});\n\t\t}\n\t}\n\n\t_getMessage(phrase): ?string\n\t{\n\t\tif (Type.isPlainObject(this._phrases) && Type.isString(this._phrases[phrase]))\n\t\t{\n\t\t\tphrase = this._phrases[phrase];\n\t\t}\n\n\t\treturn Loc.getMessage(phrase);\n\t}\n}\n","import {Loc, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Label, LabelColor} from 'ui.label';\nimport {EntityEditorPaymentDocuments} from './entity-editor';\nimport {CurrencyCore} from 'currency.currency-core';\n\nexport class TimelineSummaryDocuments extends EntityEditorPaymentDocuments\n{\n\tstatic _rootNodeClass = 'crm-entity-stream-content-detail-table crm-entity-stream-content-documents-table';\n\n\trender(): HTMLElement {\n\t\tthis._menus.forEach((menu) => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\n\t\tif (this.hasContent())\n\t\t{\n\t\t\tthis._filterSuccessfulDocuments();\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\n\t\t\tif (this._isWithOrdersMode)\n\t\t\t{\n\t\t\t\tthis._renderDocumentWithOrdersMode();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._renderDocumentWithoutOrdersMode();\n\t\t\t}\n\n\t\t\tlet checkExists = this._isCheckExists();\n\t\t\tif (checkExists)\n\t\t\t{\n\t\t\t\tthis._rootNode.append(Tag.render`\n\t\t\t\t\t<div class=\"crm-entity-stream-content-document-table-group\">\n\t\t\t\t\t\t${this._renderChecksDocument()}\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\n\t\tEventEmitter.emit('PaymentDocuments:render', [this]);\n\n\t\treturn this._rootNode;\n\t}\n\n\t_renderDocumentWithOrdersMode()\n\t{\n\t\tlet orderDocument = Tag.render`<div></div>`;\n\n\t\tthis._orders().forEach(order => {\n\t\t\tlet documents = this._renderDocumentsByOrder(order.ID);\n\t\t\tif (documents.length > 0)\n\t\t\t{\n\t\t\t\torderDocument.append(this._renderOrderDetailBlock(order));\n\t\t\t\tdocuments.forEach(document => {\n\t\t\t\t\torderDocument.append(document);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis._rootNode.append(Tag.render`\n\t\t\t<div>\n\t\t\t\t${orderDocument}\n\t\t\t\t<div class=\"crm-entity-stream-content-document-table-group\">\n\t\t\t\t\t${this._renderEntityTotalSum()}\n\t\t\t\t\t${this._renderEntityPaidSum()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-document-table-group\">\n\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t_renderDocumentWithoutOrdersMode()\n\t{\n\t\tthis._rootNode.append(Tag.render`\n\t\t\t<div>\n\t\t\t\t${this._renderDocuments()}\n\t\t\t\t<div class=\"crm-entity-stream-content-document-table-group\">\n\t\t\t\t\t${this._renderEntityTotalSum()}\n\t\t\t\t\t${this._renderEntityPaidSum()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-document-table-group\">\n\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t_renderDocumentsByOrder(orderId: number): HTMLElement[]\n\t{\n\t\tconst nodes = [];\n\n\t\tlet orderDocs = this._docs().filter((item) => {\n\t\t\treturn item.ORDER_ID === orderId;\n\t\t});\n\n\t\torderDocs.forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderPaymentDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderDeliveryDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT_DOCUMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderRealizationDocument(doc));\n\t\t\t}\n\t\t});\n\n\t\treturn nodes;\n\t}\n\n\t_renderEntityTotalSum() {\n\t\tlet phrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DEAL_SUM';\n\t\tif (Number(this._options.OWNER_TYPE_ID) === BX.CrmEntityType.enumeration.smartinvoice)\n\t\t{\n\t\t\tphrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_INVOICE_SUM';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t${Loc.getMessage(phrase)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(this._options.ENTITY_AMOUNT)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderEntityPaidSum() {\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ENTITY_PAID_SUM')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(this._options.PAID_AMOUNT)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage(\n\t\t\t'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE_MSGVER_2',\n\t\t\t{\n\t\t\t\t'#DATE#': doc.FORMATTED_DATE,\n\t\t\t\t'#ACCOUNT_NUMBER#': doc.ACCOUNT_NUMBER,\n\t\t\t\t'#SUM#': this._renderMoney(doc.SUM),\n\t\t\t},\n\t\t);\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tconst openSlider = () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title}</a>\n\t\t\t\t\t<span class=\"crm-entity-stream-content-document-description__label\">\n\t\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDeliveryDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage(\n\t\t\t'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE_MSGVER_2',\n\t\t\t{\n\t\t\t\t'#DATE#': doc.FORMATTED_DATE,\n\t\t\t\t'#ACCOUNT_NUMBER#': doc.ACCOUNT_NUMBER,\n\t\t\t\t'#SUM#': this._renderMoney(doc.SUM),\n\t\t\t\t'#DELIVERY_NAME#': doc.DELIVERY_NAME,\n\t\t\t},\n\t\t);\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t\t${title}\n\t\t\t\t\t</a>\n\t\t\t\t\t<span class=\"crm-entity-stream-content-document-description__label\">\n\t\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderRealizationDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\tfill: true,\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (doc.EMP_DEDUCTED_ID)\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT_ORANGE;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT;\n\t\t\t}\n\t\t}\n\n\t\tlet title = Loc.getMessage(\n\t\t\t'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE_MSGVER_2',\n\t\t\t{\n\t\t\t\t'#DATE#': doc.FORMATTED_DATE,\n\t\t\t\t'#DOCUMENT_ID#': doc.ACCOUNT_NUMBER,\n\t\t\t},\n\t\t);\n\t\ttitle = BX.util.htmlspecialchars(title);\n\t\ttitle = title.replaceAll(/#sum#/gi, this._renderMoney(doc.SUM));\n\n\t\tconst openSlider = () => this._viewRealizationSlider(doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t\t${title}\n\t\t\t\t\t</a>\n\t\t\t\t\t<span class=\"crm-entity-stream-content-document-description__label\">\n\t\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tlet phrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM';\n\t\tif (Number(this._options.OWNER_TYPE_ID) === BX.CrmEntityType.enumeration.smartinvoice)\n\t\t{\n\t\t\tphrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_INVOICE_SUM';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row crm-entity-stream-content-detail-table-row-total\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage(phrase)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderTotalMoney(this._options.TOTAL_AMOUNT)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderTotalMoney(sum: number): string\n\t{\n\t\tlet fullPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, true);\n\t\tconst onlyPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, false);\n\t\tconst currency = fullPrice.replace(onlyPrice, '').trim();\n\n\t\tfullPrice = fullPrice.replace(currency, `<span class=\"crm-entity-widget-payment-currency\">${currency}</span>`);\n\t\tfullPrice = fullPrice.replace(onlyPrice, `<b>${onlyPrice}</b>`);\n\n\t\treturn fullPrice;\n\t}\n\n\t_renderChecksDocument(): HTMLElement[]\n\t{\n\t\tconst nodes = [];\n\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'CHECK')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderCheckDocument(doc));\n\t\t\t}\n\t\t});\n\n\t\treturn nodes;\n\t}\n\n\t_renderCheckDocument(doc: CheckDocument): HTMLElement\n\t{\n\t\tlet link;\n\n\t\tif (doc.URL)\n\t\t{\n\t\t\tlink = Tag.render`<a href=\"${doc.URL}\" target=\"_blank\">${doc.TITLE}</a>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlink = Tag.render`<span>${doc.TITLE}</span>`;\n\t\t}\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-detail-notice\">${link}</div>`;\n\t}\n\n\t_renderOrderDetailBlock(doc: OrderDocument): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-document-table-order-group crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t<span>${doc.TITLE}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span class=\"crm-entity-stream-content-detail-cost-current\">${doc.PRICE_FORMAT}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_filterSuccessfulDocuments()\n\t{\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter((item) => {\n\t\t\treturn (\n\t\t\t\t(item.TYPE === 'PAYMENT' && item.PAID === 'Y')\n\t\t\t\t|| (item.TYPE === 'SHIPMENT' && item.DEDUCTED === 'Y')\n\t\t\t\t|| (item.TYPE === 'SHIPMENT_DOCUMENT' && item.DEDUCTED === 'Y')\n\t\t\t\t|| (item.TYPE === 'CHECK' && item.STATUS === 'Y')\n\t\t\t);\n\t\t});\n\t}\n\n\t_isCheckExists()\n\t{\n\t\tlet checks = this._options.DOCUMENTS.filter((item) => {\n\t\t\treturn item.TYPE === 'CHECK' && item.STATUS === 'Y';\n\t\t});\n\n\t\treturn checks.length > 1;\n\t}\n}"],"names":["DocumentManager","id","params","url","getRealizationDocumentDetailUrl","sliderOptions","hasOwnProperty","Promise","resolve","reject","openSlider","toString","then","slider","getData","reason","getNewRealizationDocumentUrl","options","Type","isPlainObject","cacheable","allowChangeHistory","events","isString","length","onClose","event","getSlider","BX","SidePanel","Instance","open","Uri","setQueryParams","SPECIFIC_REALIZATION_ERROR_CODES","SPECIFIC_ERROR_CODES","EntityEditorPaymentDocuments","_options","_phrases","PHRASES","_isDeliveryAvailable","IS_DELIVERY_AVAILABLE","_isTerminalAvailable","IS_TERMINAL_AVAILABLE","_parentContext","PARENT_CONTEXT","_callContext","CONTEXT","_rootNode","Tag","render","constructor","_rootNodeClass","_menus","_isUsedInventoryManagement","IS_USED_INVENTORY_MANAGEMENT","_salesOrderRights","SALES_ORDERS_RIGHTS","_isInventoryManagementRestricted","IS_INVENTORY_MANAGEMENT_RESTRICTED","_isInventoryManagement1cRestricted","IS_1C_PLAN_RESTRICTED","_isWithOrdersMode","IS_WITH_ORDERS_MODE","_isInventoryManagementToolEnabled","IS_INVENTORY_MANAGEMENT_TOOL_ENABLED","_isOnecMode","IS_ONEC_MODE","_isSalescenterToolEnabled","IS_SALESCENTER_TOOL_ENABLED","_isTerminalToolEnabled","IS_TERMINAL_TOOL_ENABLED","_shouldShowCashboxChecks","SHOULD_SHOW_CASHBOX_CHECKS","_subscribeToGlobalEvents","_docs","modify","visible","isHidden","classList","contains","remove","add","forEach","menu","destroy","innerHTML","_setupCurrencyFormat","_setEmptyState","append","_renderDetail","_renderDocuments","_renderAddDocument","_renderDelimiter","_renderTotalSum","onSuccess","onError","OWNER_ID","data","ownerTypeId","OWNER_TYPE_ID","ownerId","successCallback","response","_loading","setOptions","isFunction","_emitChangeDocumentsEvent","_showCommonError","errorCallback","ajax","runAction","_getMessage","hasContent","_renderEmptyStateDescription","description","canAddRealization","Loc","getMessage","isSetAsEmpty","nodes","doc","TYPE","push","_renderPaymentDocument","_renderDeliveryDocument","_renderRealizationDocument","title","replaceAll","FORMATTED_DATE","ACCOUNT_NUMBER","_renderMoney","SUM","labelOptions","text","STAGE","customClass","color","LabelColor","LIGHT","fill","LIGHT_GREEN","LIGHT_BLUE","PAID","popupMenu","menuItems","onclick","_chooseDeliverySlider","ORDER_ID","realizationMenuItem","_getRealizationMenuItem","_createRealizationSlider","paymentId","ID","_resendPaymentSlider","items","className","_setPaymentPaidStatus","close","_openPaymentChecksListSlider","MessageBox","confirm","messageBox","_removeDocument","_viewTerminalPaymentSlider","openMenu","preventDefault","MenuManager","create","bindElement","target","show","removeDocumentMenuItem","itemsContainer","querySelector","setAttribute","UI","Hint","init","Label","DEDUCTED","DELIVERY_NAME","_setShipmentShippedStatus","_viewDeliverySlider","EMP_DEDUCTED_ID","LIGHT_ORANGE","util","htmlspecialchars","view","conduct","_setRealizationDeductedStatus","cancel","_viewRealizationSlider","actionMenu","latestOrderId","_latestOrderId","_createPaymentSlider","_createPaymentDeliverySlider","_createTerminalPaymentSlider","_createDeliverySlider","orderId","isAvailableInventoryManagement","menuItem","OneCPlanRestrictionSlider","top","InfoHelper","Runtime","loadExtension","exports","ToolAvailabilityManager","openInventoryManagementToolDisabledSlider","totalSum","TOTAL_AMOUNT","node","sum","fullPrice","CurrencyCore","currencyFormat","CURRENCY_ID","onlyPrice","currency","replace","trim","DOCUMENTS","ORDERS","ORDER_IDS","map","parseInt","latestOrder","Math","max","_orderIds","CrmEntityType","enumeration","deal","context","templateMode","_ownerTypeId","labelMode","labelTemplate","labelEntityType","isDynamicTypeByTypeId","mode","Text","toPascalCase","openSalescenterToolDisabledSlider","_defaultCreatePaymentDocumentOptions","analyticsLabel","_generateAnalyticsLabel","st","_context","startSalescenterApplication","createSliderOptions","PAYMENT_ID","documentType","customLeftBoundary","loader","requestMethod","openNewRealizationDocument","result","reloadModel","_reloadOwner","addParam","owner_id","owner_type","orderpayment","width","disableSendButton","shipmentId","documentId","openRealizationDetailDocument","payment","isPaid","strPaid","stage","callEventOnSuccess","EventEmitter","emit","entityTypeId","entityId","reloadModelOnError","_showErrorOnAction","value","shipment","isShipped","strShipped","_showShipmentStatusError","actionName","action","_resolveRemoveDocumentActionName","filter","item","type","showCommonError","errors","error","has","code","notifyMessage","message","includes","Notification","Center","notify","content","actions","click","balloon","_showSpecificError","isLoading","Set","timeout","reloadWidget","debounce","inCompatMode","compatMode","sliderJustClosed","subscribe","eventId","getEventId","setTimeout","command","orderIds","CURRENCY_FORMAT","setCurrencyFormat","Crm","EntityEditorMoneyPay","_editor","reload","tapController","controller","reinitializeProductList","phrase","labels","tool","category","c_section","c_sub_section","TimelineSummaryDocuments","_filterSuccessfulDocuments","_renderDocumentWithOrdersMode","_renderDocumentWithoutOrdersMode","checkExists","_isCheckExists","_renderChecksDocument","orderDocument","_orders","order","documents","_renderDocumentsByOrder","_renderOrderDetailBlock","document","_renderEntityTotalSum","_renderEntityPaidSum","orderDocs","Number","smartinvoice","ENTITY_AMOUNT","PAID_AMOUNT","_renderTotalMoney","_renderCheckDocument","link","URL","TITLE","PRICE_FORMAT","STATUS","checks"],"mappings":"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"}