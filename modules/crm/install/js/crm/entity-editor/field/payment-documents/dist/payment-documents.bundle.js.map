{"version":3,"file":"payment-documents.bundle.js","sources":["../src/document-manager.js","../src/entity-editor.js","../src/timeline-summary.js"],"sourcesContent":["import {Type, Uri} from \"main.core\";\n\nexport default class DocumentManager\n{\n\tstatic openRealizationDetailDocument(id, params = {})\n\t{\n\t\tlet url = DocumentManager.getRealizationDocumentDetailUrl(id, params);\n\t\tlet sliderOptions = params.hasOwnProperty('sliderOptions') ? params.sliderOptions : {};\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tDocumentManager.openSlider(url.toString(), sliderOptions).then((slider) =>\n\t\t\t{\n\t\t\t\tresolve(slider.getData());\n\t\t\t}).catch((reason) =>\n\t\t\t{\n\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic openNewRealizationDocument(params = {})\n\t{\n\t\tlet sliderOptions = {};\n\t\tif (params.hasOwnProperty('sliderOptions'))\n\t\t{\n\t\t\tsliderOptions = params.sliderOptions;\n\t\t\tdelete params.sliderOptions;\n\t\t}\n\n\t\tlet url = DocumentManager.getNewRealizationDocumentUrl(params);\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tDocumentManager.openSlider(url.toString(), sliderOptions).then((slider) =>\n\t\t\t{\n\t\t\t\tresolve(slider.getData());\n\t\t\t}).catch((reason) =>\n\t\t\t{\n\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic openSlider(url, options)\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\n\t\toptions = {...{cacheable: false, allowChangeHistory: false, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getRealizationDocumentDetailUrl(id, params)\n\t{\n\t\tlet url = new Uri('/shop/documents/details/sales_order/' + id + '/');\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\turl.setQueryParams(params);\n\t\t}\n\n\t\treturn url;\n\t}\n\n\tstatic getNewRealizationDocumentUrl(params)\n\t{\n\t\tlet url = new Uri('/shop/documents/details/sales_order/0/?DOCUMENT_TYPE=W');\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\turl.setQueryParams(params);\n\t\t}\n\n\t\treturn url;\n\t}\n}\n","// @flow\n\nimport {Tag, Loc, Type, ajax, debounce} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MenuManager} from 'main.popup';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Label, LabelColor} from 'ui.label';\nimport DocumentManager from \"./document-manager\";\n\ndeclare var BX: {[key: string]: any};\n\ntype PaymentDocument = {\n\tID: number,\n\tORDER_ID: number,\n\tFORMATTED_DATE: string,\n\tSUM: number,\n\tTYPE: 'PAYMENT' | 'SHIPMENT',\n\tPAID?: 'Y' | 'N',\n\tSTAGE?: 'NOT_PAID' | 'SENT_NO_VIEWED' | 'VIEWED_NO_PAID' | 'PAID' | 'CANCEL' | 'REFUND',\n\tDELIVERY_NAME?: string,\n\tDEDUCTED?: 'Y' | 'N',\n\tEMP_DEDUCTED_ID?: number,\n\tSTATUS?: 'Y' | 'N',\n\tWAS_CANCELLED?: 'Y' | 'N',\n\tACCOUNT_NUMBER?: string,\n};\n\ntype Phrases = {[string]: string};\n\ntype EntityEditorPaymentDocumentsOptions = {\n\tCONTEXT: string,\n\tCURRENCY_FORMAT: {},\n\tCURRENCY_ID: string,\n\tOWNER_TYPE_ID: number,\n\tOWNER_ID: number,\n\tENTITY_AMOUNT: number,\n\tDOCUMENTS: Array<PaymentDocument>,\n\tORDER_IDS: Array<number>,\n\tPARENT_CONTEXT: StartsSalescenterApp,\n\tIS_DELIVERY_AVAILABLE: boolean,\n\tIS_USED_INVENTORY_MANAGEMENT: boolean,\n\tIS_INVENTORY_MANAGEMENT_RESTRICTED: boolean,\n\tPHRASES: Phrases,\n};\n\ntype Destroyable = {\n\tdestroy(): any\n};\n\ntype StartsSalescenterApp = {\n\tstartSalescenterApplication(): any\n};\n\nconst SPECIFIC_REALIZATION_ERROR_CODES = [\n\t'REALIZATION_ACCESS_DENIED',\n\t'REALIZATION_CANNOT_DELETE',\n\t'REALIZATION_ALREADY_DEDUCTED',\n\t'REALIZATION_NOT_DEDUCTED',\n\t'REALIZATION_PRODUCT_NOT_FOUND',\n\t'SHIPMENT_ACCESS_DENIED',\n\t'PAYMENT_ACCESS_DENIED',\n];\n\nconst SPECIFIC_ERROR_CODES = SPECIFIC_REALIZATION_ERROR_CODES.concat([\n\t'DEDUCTION_STORE_ERROR1',\n\t'SALE_PROVIDER_SHIPMENT_QUANTITY_NOT_ENOUGH',\n\t'SALE_SHIPMENT_EXIST_SHIPPED',\n\t'SALE_PAYMENT_DELETE_EXIST_PAID',\n\t'DDCT_DEDUCTION_QUANTITY_STORE_ERROR',\n]);\n\ntype AjaxHandler = (...args: Array<any>) => any;\n\nexport class EntityEditorPaymentDocuments\n{\n\t_options: EntityEditorPaymentDocumentsOptions;\n\t_isDeliveryAvailable: boolean;\n\t_parentContext: StartsSalescenterApp;\n\t_callContext: string;\n\t_rootNode: HTMLElement;\n\t_menus: Array<Destroyable>;\n\t_phrases: Phrases;\n\tstatic _rootNodeClass = 'crm-entity-widget-inner crm-entity-widget-inner--payment';\n\n\tconstructor(options: EntityEditorPaymentDocumentsOptions)\n\t{\n\t\tthis._options = options;\n\t\tthis._phrases = {};\n\t\tif (Type.isPlainObject(options.PHRASES))\n\t\t{\n\t\t\tthis._phrases = options.PHRASES;\n\t\t}\n\t\tthis._isDeliveryAvailable = this._options.IS_DELIVERY_AVAILABLE;\n\t\tthis._parentContext = options.PARENT_CONTEXT;\n\t\tthis._callContext = options.CONTEXT;\n\t\tthis._rootNode = Tag.render`<div class=\"${this.constructor._rootNodeClass}\"></div>`;\n\t\tthis._menus = [];\n\t\tthis._isUsedInventoryManagement = this._options.IS_USED_INVENTORY_MANAGEMENT;\n\t\tthis._isInventoryManagementRestricted = this._options.IS_INVENTORY_MANAGEMENT_RESTRICTED;\n\n\t\tthis._subscribeToGlobalEvents();\n\t}\n\n\thasContent(): boolean\n\t{\n\t\treturn this._docs().length > 0;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis._menus.forEach(menu => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\n\t\tif (this._isUsedInventoryManagement || this.hasContent())\n\t\t{\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\t\t\tthis._rootNode.append(Tag.render`\n\t\t\t\t<div class=\"crm-entity-widget-content-block-inner-container\">\n\t\t\t\t\t<div class=\"crm-entity-widget-payment\">\n\t\t\t\t\t\t${this._renderTitle()}\n\t\t\t\t\t\t${this._renderDocuments()}\n\t\t\t\t\t\t${this._renderAddDocument()}\n\t\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\n\t\treturn this._rootNode;\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tthis._options = options;\n\t}\n\n\treloadModel(onSuccess?: AjaxHandler, onError?: AjaxHandler)\n\t{\n\t\tif (!this._options.OWNER_ID)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = {\n\t\t\tdata: {\n\t\t\t\townerTypeId: this._options.OWNER_TYPE_ID,\n\t\t\t\townerId: this._options.OWNER_ID\n\t\t\t}\n\t\t};\n\n\t\tconst successCallback = response => {\n\t\t\tthis._loading(false);\n\t\t\tif (response.data) {\n\t\t\t\tthis.setOptions(response.data);\n\t\t\t\tthis.render();\n\t\t\t\tif (onSuccess && Type.isFunction(onSuccess)) {\n\t\t\t\t\tonSuccess(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._showCommonError();\n\t\t\t\tif (onError && Type.isFunction(onError)) {\n\t\t\t\t\tonError();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst errorCallback = () => {\n\t\t\tthis._loading(false);\n\t\t\tthis._showCommonError();\n\t\t\tif (onError && Type.isFunction(onError)) {\n\t\t\t\tonError();\n\t\t\t}\n\t\t};\n\n\t\tthis._loading(true);\n\n\t\tajax.runAction('crm.api.entity.fetchPaymentDocuments', data).then(successCallback, errorCallback);\n\t}\n\n\t_renderTitle(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-caption\">${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TITLE')}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDocuments(): HTMLElement[]\n\t{\n\t\tconst nodes = [];\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderPaymentDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderDeliveryDocument(doc));\n\t\t\t}\n\t\t\telse if (doc.TYPE === 'SHIPMENT_DOCUMENT')\n\t\t\t{\n\t\t\t\tnodes.push(this._renderRealizationDocument(doc));\n\t\t\t}\n\t\t});\n\t\treturn nodes;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tlet popupMenu;\n\t\tlet menuItems = [];\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY'),\n\t\t\t\tonclick: () => this._chooseDeliverySlider(doc.ORDER_ID)\n\t\t\t});\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_RESEND'),\n\t\t\tonclick: () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID)\n\t\t});\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_PAYMENT_STATUS'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, true);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_NOT_PAID'),\n\t\t\t\t\tclassName: (doc.PAID === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis._setPaymentPaidStatus(doc, false);\n\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\tclassName: (doc.PAID === 'Y') ? 'menu-popup-no-icon crm-entity-widget-payment-menu-item-remove' : '',\n\t\t\tonclick: () => {\n\t\t\t\tif (doc.PAID === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tpopupMenu.close();\n\t\t\t\tMessageBox.show({\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_CONFIRM_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_CONFIRM_TEXT'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst openSlider = () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-payment-action-' + doc.ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-payment-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_REMOVE_TIP'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title} (${sum})</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDeliveryDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\n\t\tlet popupMenu;\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_DELIVERY_STATUS'),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, true);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis._setShipmentShippedStatus(doc, false);\n\t\t\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-no-icon crm-entity-widget-shipment-menu-item-remove' : '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (doc.DEDUCTED === 'Y')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tpopupMenu.close();\n\t\t\t\t\tMessageBox.show({\n\t\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_CONFIRM_TITLE'),\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_CONFIRM_TEXT'),\n\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\t\tonOk: messageBox => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-delivery-action-' + doc.ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-shipment-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_REMOVE_TIP'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t${title} (${doc.DELIVERY_NAME}, ${sum})\n\t\t\t\t</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderRealizationDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (doc.EMP_DEDUCTED_ID)\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT_ORANGE;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT;\n\t\t\t}\n\t\t}\n\n\t\tlet title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\ttitle = title.replace(/#DOCUMENT_ID#/gi, doc.ACCOUNT_NUMBER);\n\t\ttitle = BX.util.htmlspecialchars(title);\n\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\n\t\tlet popupMenu;\n\t\tlet menuItems = [];\n\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCEL'),\n\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? '' : 'menu-popup-item-accept-sm',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis._setRealizationDeductedStatus(doc, false);\n\t\t\t\t\tpopupMenu.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CONDUCT'),\n\t\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-item-accept-sm' : '',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis._setRealizationDeductedStatus(doc, true);\n\t\t\t\t\tpopupMenu.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE'),\n\t\t\tclassName: (doc.DEDUCTED === 'Y') ? 'menu-popup-no-icon crm-entity-widget-realization-menu-item-remove' : '',\n\t\t\tonclick: () => {\n\t\t\t\tif (doc.DEDUCTED === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tpopupMenu.close();\n\t\t\t\tMessageBox.show({\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_CONFIRM_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_TEXT'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis._removeDocument(doc);\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst openSlider = () => this._viewRealizationSlider(doc.ID);\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tpopupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-realization-action-' + doc.ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\n\t\t\tconst removeDocumentMenuItem = popupMenu.itemsContainer.querySelector('.crm-entity-widget-realization-menu-item-remove');\n\t\t\tif (removeDocumentMenuItem)\n\t\t\t{\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint', Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REALIZATION_REMOVE_TIP'));\n\t\t\t\tremoveDocumentMenuItem.setAttribute('data-hint-no-icon', '');\n\t\t\t\tBX.UI.Hint.init(popupMenu.itemsContainer);\n\t\t\t}\n\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-detail\">\n\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t${title} (${sum})\n\t\t\t\t</a>\n\t\t\t\t<div class=\"crm-entity-widget-payment-detail-inner\">\n\t\t\t\t\t<div class=\"ui-label ui-label-md ui-label-light crm-entity-widget-payment-action\" onclick=\"${openMenu}\">\n\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderAddDocument(): HTMLElement\n\t{\n\t\tconst latestOrderId = this._latestOrderId();\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT'),\n\t\t\t\tonclick: () => this._context().startSalescenterApplication(latestOrderId)\n\t\t\t}\n\t\t];\n\t\tif (this._isDeliveryAvailable)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_DELIVERY'),\n\t\t\t\tonclick: () => this._createDeliverySlider(latestOrderId)\n\t\t\t});\n\t\t}\n\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tlet menuItem = {\n\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_SHIPMENT_DOCUMENT'),\n\t\t\t};\n\n\t\t\tif (this._isInventoryManagementRestricted)\n\t\t\t{\n\t\t\t\tmenuItem.onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t\t\tmenuItem.className = 'realization-document-tariff-lock';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.onclick = () => this._createRealizationSlider(latestOrderId);\n\t\t\t}\n\n\t\t\tmenuItems.push(menuItem);\n\t\t}\n\n\t\tconst openMenu = event => {\n\t\t\tevent.preventDefault();\n\t\t\tconst popupMenu = MenuManager.create({\n\t\t\t\tid: 'payment-documents-create-document-action',\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t\tpopupMenu.show();\n\t\t\tthis._menus.push(popupMenu);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-add-box\">\n\t\t\t\t<a href=\"#\" class=\"crm-entity-widget-payment-add\" onclick=\"${openMenu}\">\n\t\t\t\t\t+ ${Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_DOCUMENT')}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_calculateTotalSum()\n\t{\n\t\tlet totalSum = parseFloat(this._options.ENTITY_AMOUNT);\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT')\n\t\t\t{\n\t\t\t\tif (doc.PAID && doc.PAID === 'Y')\n\t\t\t\t{\n\t\t\t\t\ttotalSum -= parseFloat(doc.SUM);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (totalSum < 0)\n\t\t{\n\t\t\ttotalSum = 0.0;\n\t\t}\n\n\t\treturn totalSum;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tlet totalSum = this._calculateTotalSum();\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"crm-entity-widget-payment-total\">\n\t\t\t\t<span>\n\t\t\t\t\t${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM')}\n\t\t\t\t\t<span data-hint=\"${this._getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM_TOOLTIP')}\"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"crm-entity-widget-payment-text\">${this._renderMoney(totalSum)}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Hint.init(node);\n\n\t\treturn node;\n\t};\n\n\t_renderMoney(sum: number): string\n\t{\n\t\tconst fullPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, true);\n\t\tconst onlyPrice = CurrencyCore.currencyFormat(sum, this._options.CURRENCY_ID, false);\n\t\tconst currency = fullPrice.replace(onlyPrice, '').trim();\n\n\t\treturn fullPrice.replace(currency, `<span class=\"crm-entity-widget-payment-currency\">${currency}</span>`);\n\t}\n\n\t_docs(): Array<PaymentDocument>\n\t{\n\t\tif (this._options && this._options.DOCUMENTS && this._options.DOCUMENTS.length)\n\t\t{\n\t\t\treturn this._options.DOCUMENTS;\n\t\t}\n\t\treturn [];\n\t}\n\n\t_context(): StartsSalescenterApp\n\t{\n\t\treturn this._parentContext;\n\t}\n\n\t_orderIds(): Array<number>\n\t{\n\t\tif (this._options && this._options.ORDER_IDS && this._options.ORDER_IDS.length)\n\t\t{\n\t\t\treturn this._options.ORDER_IDS.map(id => parseInt(id));\n\t\t}\n\t\treturn [];\n\t}\n\n\t// @todo: provide test\n\t_latestOrderId(): number\n\t{\n\t\tconst latestOrder = parseInt(Math.max(...this._orderIds()));\n\t\treturn latestOrder > 0 ? latestOrder : 0;\n\t}\n\n\t_ownerTypeId(): number\n\t{\n\t\treturn this._options.OWNER_TYPE_ID || BX.CrmEntityType.enumeration.deal;\n\t}\n\n\t_createDeliverySlider(orderId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsCreateDeliverySlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsCreateDeliverySlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontext: this._callContext,\n\t\t\ttemplateMode: 'create',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId: orderId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_createRealizationSlider(orderId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsCreateRealizationSlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsCreateRealizationSlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontext: {\n\t\t\t\tOWNER_TYPE_ID: this._ownerTypeId(),\n\t\t\t\tOWNER_ID: this._options.OWNER_ID,\n\t\t\t\tORDER_ID: orderId,\n\t\t\t},\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\tdocumentType: 'W',\n\t\t\tsliderOptions: {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\tloader: 'crm-entity-details-loader',\n\t\t\t\trequestMethod: 'post',\n\t\t\t}\n\t\t};\n\n\t\tDocumentManager.openNewRealizationDocument(options).then(function (result) {\n\t\t\tthis.reloadModel();\n\t\t\tthis._reloadOwner();\n\t\t}.bind(this));\n\t}\n\n\t_chooseDeliverySlider(orderId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsChooseDeliverySlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsChooseDeliverySlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontext: this._callContext,\n\t\t\ttemplateMode: 'create',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId: orderId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_resendPaymentSlider(orderId: number, paymentId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsResendPaymentSlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsResendPaymentSlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\tdisableSendButton: '',\n\t\t\tcontext: 'deal',\n\t\t\tmode: this._ownerTypeId() === BX.CrmEntityType.enumeration.deal ? 'payment_delivery' : 'payment',\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\ttemplateMode: 'view',\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId: orderId,\n\t\t\tpaymentId: paymentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_viewDeliverySlider(orderId: number, shipmentId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsViewDeliverySlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsViewDeliverySlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontext: this._callContext,\n\t\t\ttemplateMode: 'view',\n\t\t\tmode: 'delivery',\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\torderId: orderId,\n\t\t\tshipmentId: shipmentId,\n\t\t};\n\t\tthis._context().startSalescenterApplication(orderId, options);\n\t}\n\n\t_viewRealizationSlider(documentId: number)\n\t{\n\t\tlet analyticsLabel = 'crmDealPaymentDocumentsViewRealizationSlider';\n\t\tif (BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId()))\n\t\t{\n\t\t\tanalyticsLabel = 'crmDynamicTypePaymentDocumentsViewRealizationSlider';\n\t\t}\n\n\t\tconst options = {\n\t\t\townerTypeId: this._ownerTypeId(),\n\t\t\townerId: this._options.OWNER_ID,\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t\tdocumentId: documentId,\n\t\t\tsliderOptions: {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\tloader: 'crm-entity-details-loader',\n\t\t\t}\n\t\t};\n\n\t\tDocumentManager.openRealizationDetailDocument(documentId, options).then(function (result) {\n\t\t\tthis._reloadOwner();\n\t\t}.bind(this));\n\t}\n\n\t_setPaymentPaidStatus(payment: PaymentDocument, isPaid: boolean)\n\t{\n\t\tconst strPaid = isPaid ? 'Y' : 'N';\n\t\tconst stage = isPaid ? 'PAID' : 'CANCEL';\n\n\t\tif (payment.PAID && payment.PAID === strPaid) {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'PAYMENT' && doc.ID === payment.ID) {\n\t\t\t\tdoc.PAID = strPaid;\n\t\t\t\tdoc.STAGE = stage;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tlet actionName = 'sale.payment.setpaid';\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tactionName = 'crm.order.payment.setPaid';\n\t\t}\n\n\t\tajax.runAction(actionName, {\n\t\t\tdata: {\n\t\t\t\tid: payment.ID,\n\t\t\t\tvalue: strPaid,\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_setShipmentShippedStatus(shipment: PaymentDocument, isShipped: boolean)\n\t{\n\t\tconst strShipped = isShipped ? 'Y' : 'N';\n\n\t\tif (shipment.DEDUCTED && shipment.DEDUCTED === strShipped) {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'SHIPMENT' && doc.ID === shipment.ID) {\n\t\t\t\tdoc.DEDUCTED = strShipped;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis._showShipmentStatusError(response, shipment.ID);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tlet actionName = 'sale.shipment.setshipped';\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tactionName = 'crm.api.realizationdocument.setShipped';\n\t\t}\n\n\t\tajax.runAction(actionName, {\n\t\t\tdata: {\n\t\t\t\tid: shipment.ID,\n\t\t\t\tvalue: strShipped,\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_setRealizationDeductedStatus(shipment: PaymentDocument, isShipped: boolean)\n\t{\n\t\tconst strShipped = isShipped ? 'Y' : 'N';\n\n\t\tif (shipment.DEDUCTED && shipment.DEDUCTED === strShipped) {\n\t\t\treturn;\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._docs().forEach(doc => {\n\t\t\tif (doc.TYPE === 'SHIPMENT_DOCUMENT' && doc.ID === shipment.ID) {\n\t\t\t\tdoc.DEDUCTED = strShipped;\n\t\t\t}\n\t\t});\n\t\tthis.render();\n\n\t\tconst doNothingOnSuccess = response => {};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tajax.runAction('crm.api.realizationdocument.setShipped', {\n\t\t\tdata: {\n\t\t\t\tid: shipment.ID,\n\t\t\t\tvalue: strShipped,\n\t\t\t}\n\t\t}).then(doNothingOnSuccess, reloadModelOnError);\n\t}\n\n\t_removeDocument(doc: PaymentDocument)\n\t{\n\t\tlet action;\n\t\tlet data = {\n\t\t\tid: doc.ID\n\t\t};\n\n\t\taction = this._resolveRemoveDocumentActionName(doc.TYPE);\n\t\tif (!action)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (doc.TYPE === 'SHIPMENT_DOCUMENT') {\n\t\t\tdata.value = 'N';\n\t\t}\n\n\t\t// positive approach - render success first, then do actual query\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter(item => {\n\t\t\treturn !(item.TYPE === doc.TYPE && item.ID === doc.ID);\n\t\t});\n\t\tthis.render();\n\n\t\tconst onSuccess = response => {\n\t\t\tthis._reloadOwner();\n\t\t};\n\t\tconst reloadModelOnError = response => {\n\t\t\tthis._showErrorOnAction(response);\n\t\t\tthis.reloadModel();\n\t\t};\n\n\t\tajax.runAction(action, {\n\t\t\tdata: data\n\t\t}).then(onSuccess, reloadModelOnError);\n\t}\n\n\t_resolveRemoveDocumentActionName(type: string)\n\t{\n\t\tlet actionBaseName = 'sale';\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tactionBaseName = 'crm.order';\n\t\t}\n\n\t\tlet action = '';\n\n\t\tif (type === 'PAYMENT') {\n\t\t\taction = actionBaseName + '.payment.delete';\n\t\t} else if (type === 'SHIPMENT') {\n\t\t\taction = actionBaseName + '.shipment.delete';\n\t\t} else if (type === 'SHIPMENT_DOCUMENT') {\n\t\t\taction = 'crm.api.realizationdocument.setRealization';\n\t\t}\n\n\t\treturn action;\n\t}\n\n\t_showShipmentStatusError(response, shipmentId)\n\t{\n\t\tlet showCommonError = true;\n\n\t\tif (this._isUsedInventoryManagement)\n\t\t{\n\t\t\tresponse.errors.forEach(error => {\n\t\t\t\tif (SPECIFIC_ERROR_CODES.indexOf(error.code) > -1) {\n\t\t\t\t\tshowCommonError = false;\n\n\t\t\t\t\tlet notifyMessage = error.message;\n\t\t\t\t\tif (SPECIFIC_REALIZATION_ERROR_CODES.indexOf(error.code) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tnotifyMessage = BX.util.htmlspecialchars(notifyMessage);\n\t\t\t\t\t}\n\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: notifyMessage,\n\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_OPEN_REALIZATION_DOCUMENT'),\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: (event, balloon, action) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis._viewRealizationSlider(shipmentId);\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (showCommonError)\n\t\t{\n\t\t\tthis._showCommonError();\n\t\t}\n\t}\n\n\t_showErrorOnAction(response)\n\t{\n\t\tlet showCommonError = true;\n\n\t\tresponse.errors.forEach(error => {\n\t\t\tif (SPECIFIC_ERROR_CODES.indexOf(error.code) > -1) {\n\t\t\t\tshowCommonError = false;\n\t\t\t\tthis._showSpecificError(error.code, error.message);\n\t\t\t}\n\t\t});\n\n\t\tif (showCommonError)\n\t\t{\n\t\t\tthis._showCommonError();\n\t\t}\n\t}\n\n\t_showSpecificError(code, message)\n\t{\n\t\tlet notifyMessage = message;\n\t\tif (SPECIFIC_REALIZATION_ERROR_CODES.indexOf(code) === -1)\n\t\t{\n\t\t\tnotifyMessage = BX.util.htmlspecialchars(notifyMessage);\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: notifyMessage\n\t\t});\n\t}\n\n\t_showCommonError()\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_COMMON_ERROR')\n\t\t});\n\t}\n\n\t_loading(isLoading: boolean)\n\t{\n\t\tif (this._rootNode && this._rootNode.classList)\n\t\t{\n\t\t\tif (isLoading)\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.add('is-loading');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._rootNode.classList.remove('is-loading');\n\t\t\t}\n\t\t}\n\t}\n\n\t_subscribeToGlobalEvents()\n\t{\n\t\tconst events = [\n\t\t\t'salescenter.app:onshipmentcreated',\n\t\t\t'salescenter.app:onpaymentcreated',\n\t\t\t'salescenter.app:onpaymentresend'\n\t\t];\n\t\tconst timeout = 500;\n\t\tconst reloadWidget = debounce(() => {\n\t\t\tthis.reloadModel();\n\t\t}, timeout);\n\t\tconst inCompatMode = {compatMode: true};\n\n\t\tlet sliderJustClosed = false;\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', event => {\n\t\t\tconst eventId = event.getEventId();\n\t\t\tif (events.indexOf(eventId) > -1) {\n\t\t\t\treloadWidget();\n\t\t\t\tsliderJustClosed = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsliderJustClosed = false;\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('oncrmentityupdate', () => {\n\t\t\treloadWidget();\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-crm', (command, params) => {\n\t\t\tif (command !== 'onOrderSave' || sliderJustClosed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treloadWidget();\n\t\t}, inCompatMode);\n\n\t\tEventEmitter.subscribe('onPullEvent-salescenter', (command, params) => {\n\t\t\tif (command !== 'onOrderPaymentViewed')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet orderId = false;\n\t\t\tconst orderIds = this._orderIds();\n\t\t\tif (params && params.ORDER_ID)\n\t\t\t{\n\t\t\t\torderId = parseInt(params.ORDER_ID);\n\t\t\t\tif (orderIds.indexOf(orderId) > -1)\n\t\t\t\t{\n\t\t\t\t\treloadWidget();\n\t\t\t\t}\n\t\t\t}\n\t\t}, inCompatMode);\n\t}\n\n\t_setupCurrencyFormat()\n\t{\n\t\tif (this._options)\n\t\t{\n\t\t\tif (this._options.CURRENCY_ID && this._options.CURRENCY_FORMAT)\n\t\t\t{\n\t\t\t\tCurrencyCore.setCurrencyFormat(this._options.CURRENCY_ID, this._options.CURRENCY_FORMAT);\n\t\t\t}\n\t\t}\n\t}\n\n\t_reloadOwner()\n\t{\n\t\tif (this._parentContext instanceof BX.Crm.EntityEditorMoneyPay)\n\t\t{\n\t\t\tthis._parentContext._editor.reload();\n\t\t\tthis._parentContext._editor.tapController('PRODUCT_LIST', function(controller) {\n\t\t\t\tcontroller.reinitializeProductList();\n\t\t\t});\n\t\t}\n\t}\n\n\t_getMessage(phrase): ?string\n\t{\n\t\tif (Type.isPlainObject(this._phrases) && Type.isString(this._phrases[phrase]))\n\t\t{\n\t\t\tphrase = this._phrases[phrase];\n\t\t}\n\n\t\treturn Loc.getMessage(phrase);\n\t}\n}\n","import {Loc, Tag} from 'main.core';\nimport {Label, LabelColor} from 'ui.label';\nimport {EntityEditorPaymentDocuments} from './entity-editor';\n\nexport class TimelineSummaryDocuments extends EntityEditorPaymentDocuments\n{\n\tstatic _rootNodeClass = 'crm-entity-stream-content-detail-table crm-entity-stream-content-documents-table';\n\n\t_renderDealTotalSum() {\n\t\tlet phrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DEAL_SUM';\n\t\tif (Number(this._options.OWNER_TYPE_ID) === BX.CrmEntityType.enumeration.smartinvoice)\n\t\t{\n\t\t\tphrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_INVOICE_SUM';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t${Loc.getMessage(phrase)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(this._options.ENTITY_AMOUNT)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trender(): HTMLElement {\n\t\tthis._menus.forEach((menu) => menu.destroy());\n\t\tthis._rootNode.innerHTML = '';\n\t\tthis._setupCurrencyFormat();\n\n\t\tif (this.hasContent())\n\t\t{\n\t\t\tthis._filterSuccessfulDocuments();\n\t\t\tthis._rootNode.classList.remove('is-hidden');\n\t\t\tthis._rootNode.append(Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t${this._renderDealTotalSum()}\n\t\t\t\t\t${this._renderDocuments()}\n\t\t\t\t\t${this._renderTotalSum()}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._rootNode.classList.add('is-hidden');\n\t\t}\n\n\t\treturn this._rootNode;\n\t}\n\n\t_renderPaymentDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage(`CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_${doc.STAGE}`),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.STAGE && doc.STAGE === 'PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse if (doc.STAGE && doc.STAGE === 'VIEWED_NO_PAID')\n\t\t{\n\t\t\tlabelOptions.color = LabelColor.LIGHT_BLUE;\n\t\t}\n\n\t\tif (!labelOptions.text)\n\t\t{\n\t\t\tlabelOptions.text = doc.PAID === 'Y'\n\t\t\t\t? Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID')\n\t\t\t\t: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID');\n\t\t}\n\n\t\tconst openSlider = () => this._resendPaymentSlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">${title}</a>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(doc.SUM)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderDeliveryDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\ttext: Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING'),\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t\tcolor: LabelColor.LIGHT,\n\t\t\tfill: true,\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\tconst title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\n\t\tconst openSlider = () => this._viewDeliverySlider(doc.ORDER_ID, doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t\t${title} (${doc.DELIVERY_NAME})\n\t\t\t\t\t</a>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(doc.SUM)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderRealizationDocument(doc: PaymentDocument): HTMLElement\n\t{\n\t\tconst labelOptions = {\n\t\t\tfill: true,\n\t\t\tcustomClass: 'crm-entity-widget-payment-label',\n\t\t};\n\t\tif (doc.DEDUCTED === 'Y')\n\t\t{\n\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED');\n\t\t\tlabelOptions.color = LabelColor.LIGHT_GREEN;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (doc.EMP_DEDUCTED_ID)\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT_ORANGE;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlabelOptions.text = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT');\n\t\t\t\tlabelOptions.color = LabelColor.LIGHT;\n\t\t\t}\n\t\t}\n\n\t\tlet title = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE').replace(/#DATE#/gi, doc.FORMATTED_DATE);\n\t\ttitle = title.replace(/#DOCUMENT_ID#/gi, doc.ACCOUNT_NUMBER);\n\t\ttitle = BX.util.htmlspecialchars(title);\n\n\t\tconst sum = Loc.getMessage('CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_AMOUNT').replace(/#SUM#/gi, this._renderMoney(doc.SUM));\n\n\t\tconst openSlider = () => this._viewRealizationSlider(doc.ID);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-document-description\">\n\t\t\t\t\t<a class=\"ui-link\" onclick=\"${openSlider}\">\n\t\t\t\t\t\t${title} (${sum})\n\t\t\t\t\t</a>\n\t\t\t\t\t${(new Label(labelOptions)).render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(doc.SUM)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_renderTotalSum(): HTMLElement\n\t{\n\t\tconst totalSum = this._calculateTotalSum();\n\n\t\tlet phrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM';\n\t\tif (Number(this._options.OWNER_TYPE_ID) === BX.CrmEntityType.enumeration.smartinvoice)\n\t\t{\n\t\t\tphrase = 'CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_INVOICE_SUM';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-detail-table-row\">\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-description\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage(phrase)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-detail-cost\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${this._renderMoney(totalSum)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t_filterSuccessfulDocuments()\n\t{\n\t\tthis._options.DOCUMENTS = this._options.DOCUMENTS.filter((item) => {\n\t\t\treturn (\n\t\t\t\t(item.TYPE === 'PAYMENT' && item.PAID === 'Y')\n\t\t\t\t|| (item.TYPE === 'SHIPMENT' && item.DEDUCTED === 'Y')\n\t\t\t\t|| (item.TYPE === 'SHIPMENT_DOCUMENT' && item.DEDUCTED === 'Y')\n\t\t\t);\n\t\t});\n\t}\n}"],"names":["DocumentManager","id","params","url","getRealizationDocumentDetailUrl","sliderOptions","hasOwnProperty","Promise","resolve","reject","openSlider","toString","then","slider","getData","catch","reason","getNewRealizationDocumentUrl","options","Type","isPlainObject","cacheable","allowChangeHistory","events","isString","length","onClose","event","getSlider","BX","SidePanel","Instance","open","Uri","setQueryParams","SPECIFIC_REALIZATION_ERROR_CODES","SPECIFIC_ERROR_CODES","concat","EntityEditorPaymentDocuments","_options","_phrases","PHRASES","_isDeliveryAvailable","IS_DELIVERY_AVAILABLE","_parentContext","PARENT_CONTEXT","_callContext","CONTEXT","_rootNode","Tag","render","constructor","_rootNodeClass","_menus","_isUsedInventoryManagement","IS_USED_INVENTORY_MANAGEMENT","_isInventoryManagementRestricted","IS_INVENTORY_MANAGEMENT_RESTRICTED","_subscribeToGlobalEvents","_docs","forEach","menu","destroy","innerHTML","_setupCurrencyFormat","hasContent","classList","remove","append","_renderTitle","_renderDocuments","_renderAddDocument","_renderTotalSum","add","onSuccess","onError","OWNER_ID","data","ownerTypeId","OWNER_TYPE_ID","ownerId","successCallback","response","_loading","setOptions","isFunction","_showCommonError","errorCallback","ajax","runAction","_getMessage","nodes","doc","TYPE","push","_renderPaymentDocument","_renderDeliveryDocument","_renderRealizationDocument","title","Loc","getMessage","replace","FORMATTED_DATE","sum","_renderMoney","SUM","labelOptions","text","STAGE","customClass","color","LabelColor","LIGHT","fill","LIGHT_GREEN","LIGHT_BLUE","PAID","popupMenu","menuItems","onclick","_chooseDeliverySlider","ORDER_ID","_resendPaymentSlider","ID","items","className","_setPaymentPaidStatus","close","MessageBox","show","message","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","_removeDocument","onCancel","openMenu","preventDefault","MenuManager","create","bindElement","target","removeDocumentMenuItem","itemsContainer","querySelector","setAttribute","UI","Hint","init","Label","DEDUCTED","_setShipmentShippedStatus","_viewDeliverySlider","DELIVERY_NAME","EMP_DEDUCTED_ID","LIGHT_ORANGE","ACCOUNT_NUMBER","util","htmlspecialchars","_setRealizationDeductedStatus","_viewRealizationSlider","latestOrderId","_latestOrderId","_context","startSalescenterApplication","_createDeliverySlider","menuItem","top","InfoHelper","_createRealizationSlider","totalSum","parseFloat","ENTITY_AMOUNT","_calculateTotalSum","node","fullPrice","CurrencyCore","currencyFormat","CURRENCY_ID","onlyPrice","currency","trim","DOCUMENTS","ORDER_IDS","map","parseInt","latestOrder","Math","max","_orderIds","CrmEntityType","enumeration","deal","orderId","analyticsLabel","isDynamicTypeByTypeId","_ownerTypeId","context","templateMode","mode","documentType","customLeftBoundary","loader","requestMethod","openNewRealizationDocument","result","reloadModel","_reloadOwner","bind","paymentId","disableSendButton","shipmentId","documentId","openRealizationDetailDocument","payment","isPaid","strPaid","stage","doNothingOnSuccess","reloadModelOnError","_showErrorOnAction","actionName","value","shipment","isShipped","strShipped","_showShipmentStatusError","action","_resolveRemoveDocumentActionName","filter","item","type","actionBaseName","showCommonError","errors","error","indexOf","code","notifyMessage","Notification","Center","notify","content","actions","click","balloon","_showSpecificError","isLoading","timeout","reloadWidget","debounce","inCompatMode","compatMode","sliderJustClosed","EventEmitter","subscribe","eventId","getEventId","setTimeout","command","orderIds","CURRENCY_FORMAT","setCurrencyFormat","Crm","EntityEditorMoneyPay","_editor","reload","tapController","controller","reinitializeProductList","phrase","TimelineSummaryDocuments","Number","smartinvoice","_filterSuccessfulDocuments","_renderDealTotalSum"],"mappings":"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"}