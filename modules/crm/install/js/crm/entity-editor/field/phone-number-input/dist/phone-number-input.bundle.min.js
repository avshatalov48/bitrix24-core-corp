this.BX=this.BX||{};(function(e,t,a){"use strict";var i;function r(e,t){l(e,t);t.add(e)}function s(e,t,a){l(e,t);t.set(e,a)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function n(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var o=t.Reflection.namespace("BX.Crm");var u="/bitrix/js/crm/entity-selector/src/images/";var c="png";var d=24;var h="+";var b="XX";var p="#00789E";var f=new WeakMap;var g=new WeakMap;var y=new WeakMap;var v=new WeakMap;var C=new WeakSet;var m=new WeakSet;var H=function(e){babelHelpers.inherits(i,e);function i(e){var a;babelHelpers.classCallCheck(this,i);e.flagSize=d;if(e.savedCountryCode===""){e.savedCountryCode=b}a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e));r(babelHelpers.assertThisInitialized(a),m);r(babelHelpers.assertThisInitialized(a),C);s(babelHelpers.assertThisInitialized(a),f,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(a),g,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(a),y,{writable:true,value:null});s(babelHelpers.assertThisInitialized(a),v,{writable:true,value:null});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),f,t.Type.isStringFilled(e.searchDialogContextCode)?e.searchDialogContextCode:"");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),g,t.Type.isBoolean(e.isSelectionIndicatorEnabled)?e.isSelectionIndicatorEnabled:false);if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),g)){n(babelHelpers.assertThisInitialized(a),C,F).call(babelHelpers.assertThisInitialized(a))}return a}babelHelpers.createClass(i,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,y)){babelHelpers.classPrivateFieldGet(this,y).destroy()}}},{key:"_onFlagClick",value:function e(i){if(!t.Type.isDomNode(this.flagNode)){return}if(babelHelpers.classPrivateFieldGet(this,y)){babelHelpers.classPrivateFieldGet(this,y).show();return}babelHelpers.classPrivateFieldSet(this,y,new a.Dialog({targetNode:this.flagNode,context:babelHelpers.classPrivateFieldGet(this,f),multiple:false,dropdownMode:true,enableSearch:true,width:350,tagSelectorOptions:{placeholder:t.Loc.getMessage("CRM_PHONE_INPUT_FIELD_TAG_SELECTOR_SEARCH_PLACEHOLDER"),textBoxWidth:"100%"},entities:[{id:"country",options:{isEmptyCountryEnabled:false}}],events:n(this,m,T).call(this)}));babelHelpers.classPrivateFieldGet(this,y).show()}},{key:"drawCountryFlag",value:function e(){if(!t.Type.isDomNode(this.flagNode)){return}var a=this.getCountry();if(!t.Type.isStringFilled(a)){return}this.adjustFlag(a)}},{key:"tryRedrawCountryFlag",value:function e(){var a=!t.Type.isStringFilled(this.inputNode.value)||t.Type.isNull(this.formatter.country)||!this.formatter.isInternational;if(a){this.formatter.replaceCountry(b);this.adjustFlag(b)}else{this.drawCountryFlag()}this.callbacks.countryChange({country:this.getCountry(),countryCode:this.getCountryCode()})}},{key:"setValue",value:function e(a,i){this.waitForInitialization().then(function(){this.inputNode.value=this.formatter.format(a.toString());this.callbacks.change({value:this.getValue(),formattedValue:this.getFormattedValue(),country:this.getCountry(),countryCode:this.getCountryCode()});if(this._countryBefore!==this.getCountry()){this.drawCountryFlag();this.callbacks.countryChange({country:this.getCountry(),countryCode:this.getCountryCode()})}if(t.Type.isStringFilled(i)&&this.formatter.country!==i){this.formatter.replaceCountry(i);this.tryRedrawCountryFlag()}}.bind(this))}},{key:"onCountrySelect",value:function e(t){var a=t.getData().item;if(a){var i=a.getId();if(i===this.getCountry()){return}this.formatter.replaceCountry(i);this.inputNode.value=this.formatter.getFormattedNumber();this.drawCountryFlag();this.callbacks.change({value:this.getValue(),formattedValue:this.getFormattedValue(),country:this.getCountry(),countryCode:this.getCountryCode()});this.callbacks.countryChange({country:this.getCountry(),countryCode:this.getCountryCode()})}}},{key:"adjustFlag",value:function e(a){var i=u+a.toLowerCase()+"."+c;t.Dom.adjust(this.flagNode,{props:{className:this.flagNodeInitialClass+" crm-entity-phone-number-input-flag-"+this.flagSize}});t.Dom.style(this.flagNode,{border:"1px solid rgba(82, 92, 105, 0.2)","background-image":'url("'+i+'")'});if(a===b){t.Dom.style(this.flagNode,{border:0,"background-position":"center","background-size":"contain","background-repeat":"no-repeat"})}}}],[{key:"isCountryCodeOnly",value:function e(t,a){return t===h||t===a||t===h+a}}]);return i}(BX.PhoneNumber.Input);function F(){if(t.Type.isDomNode(this.flagNode)){babelHelpers.classPrivateFieldSet(this,v,t.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<span class="crm-entity-widget-content-country-flag-tick"></span>']))));t.Dom.append(babelHelpers.classPrivateFieldGet(this,v),this.flagNode)}}function T(){var e=this;var a={"Item:onSelect":function t(a){e.onCountrySelect(a)}};a.onLoad=function(t){var a=t.getTarget().getItems();var i=a.filter((function(e){return e.contextSort}));i.forEach((function(e){return e.setTextColor(p)}));var r=e.formatter.country;if(r){var s=a.find((function(e){return e.getId()===r}));if(s){s.select()}}};a.onFirstShow=function(e){var a=e.getTarget().getPopup().getContentContainer();if(t.Type.isDomNode(a)){t.Dom.addClass(a,"crm-entity-country-selector-popup")}};if(babelHelpers.classPrivateFieldGet(this,g)){a.onShow=function(a){if(babelHelpers.classPrivateFieldGet(e,v)){t.Dom.addClass(babelHelpers.classPrivateFieldGet(e,v),"--flipped")}var i=e.formatter.country;if(i){var r=a.getTarget();var s=r.getItems().find((function(e){return e.getId()===i}));if(s){s.select()}}};a.onHide=function(){if(babelHelpers.classPrivateFieldGet(e,v)){t.Dom.removeClass(babelHelpers.classPrivateFieldGet(e,v),"--flipped")}}}return a}o.PhoneNumberInput=H;e.default=H})(this.BX.Crm=this.BX.Crm||{},BX,BX.Crm.EntitySelectorEx);
//# sourceMappingURL=phone-number-input.bundle.map.js