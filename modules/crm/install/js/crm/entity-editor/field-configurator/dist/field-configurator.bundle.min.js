this.BX=this.BX||{};(function(exports,main_core,crm_entitySelector){"use strict";var _templateObject,_templateObject2,_templateObject3;function _classPrivateFieldInitSpec(e,t,i){_checkPrivateRedeclaration(e,t);t.set(e,i)}function _checkPrivateRedeclaration(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var DEFAULT_COUNTRY_CODE="XX";var _countrySelector=new WeakMap;var PhoneNumberInputFieldConfigurator=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++){n[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(n)));_classPrivateFieldInitSpec(babelHelpers.assertThisInitialized(i),_countrySelector,{writable:true,value:null});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_countrySelector)){babelHelpers.classPrivateFieldGet(this,_countrySelector).destroy()}}},{key:"layoutInternal",value:function e(){this._wrapper.appendChild(this.getInputContainer());if(this._typeId==="list"){this.layoutInnerConfigurator(this._field.getInnerConfig(),this._field.getItems())}this._wrapper.appendChild(this.getOptionContainer());if(this._typeId==="multifield"||this._typeId==="client_light"){this._wrapper.appendChild(this.getCountrySelectContainer())}main_core.Dom.append(main_core.Tag.render(_templateObject||(_templateObject=babelHelpers.taggedTemplateLiteral(['<hr class="ui-entity-editor-line">']))),this._wrapper);this._wrapper.appendChild(this.getButtonContainer())}},{key:"prepareSaveParams",value:function e(i){var r=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"prepareSaveParams",this).call(this,this,arguments);if(babelHelpers.classPrivateFieldGet(this,_countrySelector)){var n=babelHelpers.classPrivateFieldGet(this,_countrySelector).getDialog().getSelectedItems();if(n.length<=1){r["defaultCountry"]=n.length===0?DEFAULT_COUNTRY_CODE:n[0].id;this._field.getSchemeElement()._options["defaultCountry"]=r["defaultCountry"]}}return r}},{key:"getCountrySelectContainer",value:function e(){var t=main_core.Tag.render(_templateObject2||(_templateObject2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<span class="ui-entity-editor-block-title-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),main_core.Loc.getMessage("CRM_PHONE_NUMBER_INPUT_FIELD_CONFIGURATOR_TITLE"));var i=main_core.Tag.render(_templateObject3||(_templateObject3=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block crm-entity-country-tag-selector"></div>\n\t\t'])));main_core.Dom.append(i,t);var r=DEFAULT_COUNTRY_CODE;if(this._field&&this._field.getSchemeElement()&&main_core.Type.isPlainObject(this._field.getSchemeElement()._options)&&main_core.Type.isStringFilled(this._field.getSchemeElement()._options.defaultCountry)){r=this._field.getSchemeElement()._options.defaultCountry}babelHelpers.classPrivateFieldSet(this,_countrySelector,new crm_entitySelector.TagSelector({textBoxWidth:"100%",tagMaxWidth:270,placeholder:main_core.Loc.getMessage("CRM_PHONE_NUMBER_INPUT_FIELD_CONFIGURATOR_PLACEHOLDER"),multiple:false,dialogOptions:{width:425,multiple:false,showAvatars:true,dropdownMode:true,preselectedItems:[["country",r]],entities:[{id:"country"}],events:{onFirstShow:function e(t){var i=t.getTarget().getPopup().getContentContainer();if(main_core.Type.isDomNode(i)){main_core.Dom.addClass(i,"crm-entity-country-tag-selector-popup")}}}}}));babelHelpers.classPrivateFieldGet(this,_countrySelector).renderTo(i);return t}}],[{key:"create",value:function e(t,i){var r=new this;r.initialize(t,i);return r}}]);return t}(BX.UI.EntityEditorFieldConfigurator);var EntityConfigurationManager=function(_BX$UI$EntityConfigur){babelHelpers.inherits(EntityConfigurationManager,_BX$UI$EntityConfigur);function EntityConfigurationManager(){babelHelpers.classCallCheck(this,EntityConfigurationManager);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(EntityConfigurationManager).apply(this,arguments))}babelHelpers.createClass(EntityConfigurationManager,[{key:"getSimpleFieldConfigurator",value:function e(t,i){if(!main_core.Type.isPlainObject(t)){throw'EntityConfigurationManager: The "params" argument must be object.'}var r="";var n=BX.prop.get(t,"field",null);if(n){r=n.getType();n.setVisible(false)}else{r=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}if(["PHONE","CLIENT","COMPANY","CONTACT","MYCOMPANY_ID"].indexOf(n.getId())>=0){return this._fieldConfigurator=PhoneNumberInputFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:n,mandatoryConfigurator:t.mandatoryConfigurator})}else{return this._fieldConfigurator=BX.UI.EntityEditorFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:n,mandatoryConfigurator:t.mandatoryConfigurator})}}},{key:"getUserFieldConfigurator",value:function e(t,i){if(!main_core.Type.isPlainObject(t)){throw'EntityConfigurationManager: The "params" argument must be object.'}var r="";var n=BX.prop.get(t,"field",null);if(n){if(!(n instanceof BX.UI.EntityEditorUserField)){throw'EntityConfigurationManager: The "field" param must be EntityEditorUserField.'}r=n.getFieldType();n.setVisible(false)}else{r=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}if(r==="resourcebooking"){var o={editor:this._editor,schemeElement:null,model:i.getModel(),mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:n,showAlways:true,enableMandatoryControl:BX.prop.getBoolean(t,"enableMandatoryControl",true),mandatoryConfigurator:t.mandatoryConfigurator};if(BX.Calendar&&BX.type.isFunction(BX.Calendar.ResourcebookingUserfield)){return BX.Calendar.ResourcebookingUserfield.getCrmFieldConfigurator("",o)}else if(BX.Calendar&&BX.Calendar.UserField&&BX.Calendar.UserField.EntityEditorUserFieldConfigurator){return BX.Calendar.UserField.EntityEditorUserFieldConfigurator.create("",o)}}else{return BX.Crm.EntityEditorUserFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i.getModel(),mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:n,mandatoryConfigurator:t.mandatoryConfigurator,visibilityConfigurator:t.visibilityConfigurator,showAlways:true})}}},{key:"getTypeInfos",value:function getTypeInfos(){var typeInfos=babelHelpers.get(babelHelpers.getPrototypeOf(EntityConfigurationManager.prototype),"getTypeInfos",this).call(this);var ufAddRestriction=this._editor.getRestriction("userFieldAdd");var ufResourceBookingRestriction=this._editor.getRestriction("userFieldResourceBooking");if(ufAddRestriction&&!ufAddRestriction["isPermitted"]&&ufAddRestriction["restrictionCallback"]){for(var i=0,length=typeInfos.length;i<length;i++){typeInfos[i].callback=function(){eval(ufAddRestriction["restrictionCallback"])}}}else if(ufResourceBookingRestriction&&!ufResourceBookingRestriction["isPermitted"]&&ufResourceBookingRestriction["restrictionCallback"]){for(var j=0;j<typeInfos.length;j++){if(typeInfos[j].name==="resourcebooking"){typeInfos[j].callback=function(){eval(ufResourceBookingRestriction["restrictionCallback"])}}}}return typeInfos}}],[{key:"create",value:function e(t,i){var r=new this;r.initialize(t,i);return r}}]);return EntityConfigurationManager}(BX.UI.EntityConfigurationManager);exports.EntityConfigurationManager=EntityConfigurationManager})(this.BX.Crm=this.BX.Crm||{},BX,BX.Crm.EntitySelectorEx);
//# sourceMappingURL=field-configurator.bundle.map.js