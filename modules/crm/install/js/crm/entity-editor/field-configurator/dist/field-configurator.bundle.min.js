this.BX=this.BX||{};(function(exports,crm_entitySelector,main_core_events,main_core){"use strict";var _templateObject,_templateObject2,_templateObject3;function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t);t.add(e)}function _classPrivateFieldInitSpec(e,t,i){_checkPrivateRedeclaration(e,t);t.set(e,i)}function _checkPrivateRedeclaration(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var DEFAULT_COUNTRY_CODE="XX";var _countrySelector=new WeakMap;var _getSelectContainer=new WeakSet;var _getCountrySelector=new WeakSet;var _getDefaultCountry=new WeakSet;var _getSchemeElementOptions=new WeakSet;var PhoneNumberInputFieldConfigurator=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++){a[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));_classPrivateMethodInitSpec(babelHelpers.assertThisInitialized(i),_getSchemeElementOptions);_classPrivateMethodInitSpec(babelHelpers.assertThisInitialized(i),_getDefaultCountry);_classPrivateMethodInitSpec(babelHelpers.assertThisInitialized(i),_getCountrySelector);_classPrivateMethodInitSpec(babelHelpers.assertThisInitialized(i),_getSelectContainer);_classPrivateFieldInitSpec(babelHelpers.assertThisInitialized(i),_countrySelector,{writable:true,value:null});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_countrySelector)){babelHelpers.classPrivateFieldGet(this,_countrySelector).destroy()}}},{key:"layoutInternal",value:function e(){main_core.Dom.append(this.getInputContainer(),this._wrapper);if(this._typeId==="list"){this.layoutInnerConfigurator(this._field.getInnerConfig(),this._field.getItems())}main_core.Dom.append(this.getOptionContainer(),this._wrapper);if(this._typeId==="multifield"||this._typeId==="client_light"){main_core.Dom.append(this.getCountrySelectContent(),this._wrapper)}main_core.Dom.append(main_core.Tag.render(_templateObject||(_templateObject=babelHelpers.taggedTemplateLiteral(['<hr class="ui-entity-editor-line">']))),this._wrapper);main_core.Dom.append(this.getButtonContainer(),this._wrapper)}},{key:"prepareSaveParams",value:function e(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++){r[a]=arguments[a]}var s=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"prepareSaveParams",this).call(this,this,r);if(babelHelpers.classPrivateFieldGet(this,_countrySelector)){var l=babelHelpers.classPrivateFieldGet(this,_countrySelector).getDialog().getSelectedItems();if(l.length<=1){s.defaultCountry=main_core.Type.isArrayFilled(l)?l[0].id:DEFAULT_COUNTRY_CODE;_classPrivateMethodGet(this,_getSchemeElementOptions,_getSchemeElementOptions2).call(this).defaultCountry=s.defaultCountry}}return s}},{key:"getCountrySelectContent",value:function e(){var t=main_core.Tag.render(_templateObject2||(_templateObject2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<span class="ui-entity-editor-block-title-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),main_core.Loc.getMessage("CRM_PHONE_NUMBER_INPUT_FIELD_CONFIGURATOR_TITLE"));main_core.Dom.append(_classPrivateMethodGet(this,_getSelectContainer,_getSelectContainer2).call(this),t);return t}}],[{key:"create",value:function e(t,i){var r=new this;r.initialize(t,i);return r}}]);return t}(BX.UI.EntityEditorFieldConfigurator);function _getSelectContainer2(){var e=main_core.Tag.render(_templateObject3||(_templateObject3=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block crm-entity-country-tag-selector"></div>\n\t\t'])));_classPrivateMethodGet(this,_getCountrySelector,_getCountrySelector2).call(this).renderTo(e);return e}function _getCountrySelector2(){if(!babelHelpers.classPrivateFieldGet(this,_countrySelector)){babelHelpers.classPrivateFieldSet(this,_countrySelector,new crm_entitySelector.TagSelector({textBoxWidth:"100%",tagMaxWidth:270,placeholder:main_core.Loc.getMessage("CRM_PHONE_NUMBER_INPUT_FIELD_CONFIGURATOR_PLACEHOLDER"),multiple:false,dialogOptions:{width:425,multiple:false,showAvatars:true,dropdownMode:true,preselectedItems:[["country",_classPrivateMethodGet(this,_getDefaultCountry,_getDefaultCountry2).call(this)]],entities:[{id:"country"}],events:{onFirstShow:function e(t){var i=t.getTarget().getPopup().getContentContainer();if(main_core.Type.isDomNode(i)){main_core.Dom.addClass(i,"crm-entity-country-tag-selector-popup")}}}}}))}return babelHelpers.classPrivateFieldGet(this,_countrySelector)}function _getDefaultCountry2(){var e=_classPrivateMethodGet(this,_getSchemeElementOptions,_getSchemeElementOptions2).call(this),t=e.defaultCountry;if(main_core.Type.isStringFilled(t)){return t}return DEFAULT_COUNTRY_CODE}function _getSchemeElementOptions2(){var e,t;return this===null||this===void 0?void 0:(e=this._field)===null||e===void 0?void 0:(t=e.getSchemeElement())===null||t===void 0?void 0:t._options}var _templateObject$1,_templateObject2$1,_templateObject3$1,_templateObject4;function _classPrivateMethodInitSpec$1(e,t){_checkPrivateRedeclaration$1(e,t);t.add(e)}function _classPrivateFieldInitSpec$1(e,t,i){_checkPrivateRedeclaration$1(e,t);t.set(e,i)}function _checkPrivateRedeclaration$1(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$1(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var DEFAULT_ADDRESS_TYPE_ID="11";var _addressTypeSelect=new WeakMap;var _allAddressTypes=new WeakMap;var _suitableAddressTypes=new WeakMap;var _setDefaultAddressTypeToSchemeOptions=new WeakSet;var _getDefaultAddressTypeSetterContainer=new WeakSet;var _getAddressTypeSelect=new WeakSet;var _getDefaultAddressType=new WeakSet;var _getPreparedAddressTypesForOptions=new WeakSet;var _getAddressTypeSelectValue=new WeakSet;var _isValidAddressType=new WeakSet;var _getAllAddressTypes=new WeakSet;var _getSuitableAddressTypes=new WeakSet;var _getSchemeData=new WeakSet;var _getSchemeOptions=new WeakSet;var _getSchemeElement=new WeakSet;var _getAddressZoneConfig=new WeakSet;var RequisiteAddressFieldConfigurator=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++){a[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getAddressZoneConfig);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getSchemeElement);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getSchemeOptions);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getSchemeData);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getSuitableAddressTypes);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getAllAddressTypes);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_isValidAddressType);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getAddressTypeSelectValue);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getPreparedAddressTypesForOptions);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getDefaultAddressType);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getAddressTypeSelect);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getDefaultAddressTypeSetterContainer);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_setDefaultAddressTypeToSchemeOptions);_classPrivateFieldInitSpec$1(babelHelpers.assertThisInitialized(i),_addressTypeSelect,{writable:true,value:null});_classPrivateFieldInitSpec$1(babelHelpers.assertThisInitialized(i),_allAddressTypes,{writable:true,value:null});_classPrivateFieldInitSpec$1(babelHelpers.assertThisInitialized(i),_suitableAddressTypes,{writable:true,value:null});return i}babelHelpers.createClass(t,[{key:"layoutInternal",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"layoutInternal",this).call(this);var i=this._wrapper;var r=i.querySelector("hr");main_core.Dom.insertBefore(_classPrivateMethodGet$1(this,_getDefaultAddressTypeSetterContainer,_getDefaultAddressTypeSetterContainer2).call(this),r)}},{key:"prepareSaveParams",value:function e(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++){r[a]=arguments[a]}var s=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"prepareSaveParams",this).call(this,this,r);var l=_classPrivateMethodGet$1(this,_getAddressTypeSelectValue,_getAddressTypeSelectValue2).call(this);if(!_classPrivateMethodGet$1(this,_isValidAddressType,_isValidAddressType2).call(this,l)){return s}_classPrivateMethodGet$1(this,_setDefaultAddressTypeToSchemeOptions,_setDefaultAddressTypeToSchemeOptions2).call(this,l);s.defaultAddressType=l;return s}}],[{key:"create",value:function e(t,i){var r=new this;r.initialize(t,i);return r}}]);return t}(BX.UI.EntityEditorFieldConfigurator);function _setDefaultAddressTypeToSchemeOptions2(e){var t=_classPrivateMethodGet$1(this,_getSchemeOptions,_getSchemeOptions2).call(this);if(t){t.defaultAddressType=e}}function _getDefaultAddressTypeSetterContainer2(){var e=main_core.Loc.getMessage("CRM_REQUISITE_DEFAULT_ADDRESS_TYPE_TITLE");var t=main_core.Tag.render(_templateObject$1||(_templateObject$1=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<span class="ui-entity-editor-block-title-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),main_core.Text.encode(e));var i=main_core.Tag.render(_templateObject2$1||(_templateObject2$1=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block crm-default-requisite-address-type"></div>'])));main_core.Dom.append(_classPrivateMethodGet$1(this,_getAddressTypeSelect,_getAddressTypeSelect2).call(this),i);main_core.Dom.append(i,t);return t}function _getAddressTypeSelect2(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,_addressTypeSelect)){babelHelpers.classPrivateFieldSet(this,_addressTypeSelect,main_core.Tag.render(_templateObject3$1||(_templateObject3$1=babelHelpers.taggedTemplateLiteral(['<select class="main-ui-control main-enum-dialog-input" name="display"></select>']))));_classPrivateMethodGet$1(this,_getPreparedAddressTypesForOptions,_getPreparedAddressTypesForOptions2).call(this).forEach((function(t){var i=main_core.Tag.render(_templateObject4||(_templateObject4=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</option>\n\t\t\t\t"])),main_core.Text.encode(t.value),main_core.Text.encode(t.label));main_core.Dom.append(i,babelHelpers.classPrivateFieldGet(e,_addressTypeSelect))}));babelHelpers.classPrivateFieldGet(this,_addressTypeSelect).value=_classPrivateMethodGet$1(this,_getDefaultAddressType,_getDefaultAddressType2).call(this)}return babelHelpers.classPrivateFieldGet(this,_addressTypeSelect)}function _getDefaultAddressType2(){var e,t;var i=(e=_classPrivateMethodGet$1(this,_getSchemeOptions,_getSchemeOptions2).call(this))!==null&&e!==void 0?e:{},r=i.defaultAddressType;if(_classPrivateMethodGet$1(this,_isValidAddressType,_isValidAddressType2).call(this,r)){return r}var a=(t=_classPrivateMethodGet$1(this,_getAddressZoneConfig,_getAddressZoneConfig2).call(this))!==null&&t!==void 0?t:{},s=a.defaultAddressType;if(_classPrivateMethodGet$1(this,_isValidAddressType,_isValidAddressType2).call(this,s)){return s}return DEFAULT_ADDRESS_TYPE_ID}function _getPreparedAddressTypesForOptions2(){var e=[];var t=_classPrivateMethodGet$1(this,_getSuitableAddressTypes,_getSuitableAddressTypes2).call(this);t.forEach((function(t){e.push({value:t.ID,label:t.DESCRIPTION})}));return e}function _getAddressTypeSelectValue2(){return _classPrivateMethodGet$1(this,_getAddressTypeSelect,_getAddressTypeSelect2).call(this).value}function _isValidAddressType2(e){return main_core.Type.isStringFilled(e)&&_classPrivateMethodGet$1(this,_getSuitableAddressTypes,_getSuitableAddressTypes2).call(this).has(e)}function _getAllAddressTypes2(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,_allAddressTypes)){var t;babelHelpers.classPrivateFieldSet(this,_allAddressTypes,new Map);var i=(t=_classPrivateMethodGet$1(this,_getSchemeData,_getSchemeData2).call(this))!==null&&t!==void 0?t:{},r=i.types;if(r){Object.values(r).forEach((function(t){babelHelpers.classPrivateFieldGet(e,_allAddressTypes).set(t.ID,t)}))}}return babelHelpers.classPrivateFieldGet(this,_allAddressTypes)}function _getSuitableAddressTypes2(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,_suitableAddressTypes)){var t;babelHelpers.classPrivateFieldSet(this,_suitableAddressTypes,new Map);var i=(t=_classPrivateMethodGet$1(this,_getAddressZoneConfig,_getAddressZoneConfig2).call(this))!==null&&t!==void 0?t:{},r=i.currentZoneAddressTypes;if(r){r.forEach((function(t){var i=_classPrivateMethodGet$1(e,_getAllAddressTypes,_getAllAddressTypes2).call(e).get(t);if(i){babelHelpers.classPrivateFieldGet(e,_suitableAddressTypes).set(i.ID,i)}}))}}return babelHelpers.classPrivateFieldGet(this,_suitableAddressTypes)}function _getSchemeData2(){var e;return(e=_classPrivateMethodGet$1(this,_getSchemeElement,_getSchemeElement2).call(this))===null||e===void 0?void 0:e.getData()}function _getSchemeOptions2(){var e;return(e=_classPrivateMethodGet$1(this,_getSchemeElement,_getSchemeElement2).call(this))===null||e===void 0?void 0:e.getOptions()}function _getSchemeElement2(){var e;return(e=this.getField())===null||e===void 0?void 0:e.getSchemeElement()}function _getAddressZoneConfig2(){var e;return(e=_classPrivateMethodGet$1(this,_getSchemeData,_getSchemeData2).call(this))===null||e===void 0?void 0:e.addressZoneConfig}var EntityConfigurationManager=function(_BX$UI$EntityConfigur){babelHelpers.inherits(EntityConfigurationManager,_BX$UI$EntityConfigur);function EntityConfigurationManager(){babelHelpers.classCallCheck(this,EntityConfigurationManager);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(EntityConfigurationManager).apply(this,arguments))}babelHelpers.createClass(EntityConfigurationManager,[{key:"getSimpleFieldConfigurator",value:function e(t,i){if(!main_core.Type.isPlainObject(t)){throw new TypeError('EntityConfigurationManager: The "params" argument must be object.')}var r="";var a=t.field,s=t.mandatoryConfigurator;if(a){r=a.getType();a.setVisible(false)}else{r=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}var l={editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:a,mandatoryConfigurator:s};if(EntityConfigurationManager.PHONE_NUMBER_FIELDS.includes(a.getId())){this._fieldConfigurator=PhoneNumberInputFieldConfigurator.create("",l)}else if(EntityConfigurationManager.REQUISITE_ADDRESS_FIELDS.includes(a.getId())&&r==="requisite_address"){this._fieldConfigurator=RequisiteAddressFieldConfigurator.create("",l)}else{this._fieldConfigurator=BX.UI.EntityEditorFieldConfigurator.create("",l)}return this._fieldConfigurator}},{key:"getUserFieldConfigurator",value:function e(t,i){if(!main_core.Type.isPlainObject(t)){throw'EntityConfigurationManager: The "params" argument must be object.'}var r="";var a=BX.prop.get(t,"field",null);if(a){if(!(a instanceof BX.UI.EntityEditorUserField)){throw'EntityConfigurationManager: The "field" param must be EntityEditorUserField.'}r=a.getFieldType();a.setVisible(false)}else{r=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}if(r==="resourcebooking"){var s={editor:this._editor,schemeElement:null,model:i.getModel(),mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:a,showAlways:true,enableMandatoryControl:BX.prop.getBoolean(t,"enableMandatoryControl",true),mandatoryConfigurator:t.mandatoryConfigurator};if(BX.Calendar&&BX.type.isFunction(BX.Calendar.ResourcebookingUserfield)){return BX.Calendar.ResourcebookingUserfield.getCrmFieldConfigurator("",s)}else if(BX.Calendar&&BX.Calendar.UserField&&BX.Calendar.UserField.EntityEditorUserFieldConfigurator){return BX.Calendar.UserField.EntityEditorUserFieldConfigurator.create("",s)}}else{return BX.Crm.EntityEditorUserFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i.getModel(),mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:r,field:a,mandatoryConfigurator:t.mandatoryConfigurator,visibilityConfigurator:t.visibilityConfigurator,showAlways:true})}}},{key:"getTypeInfos",value:function getTypeInfos(){var typeInfos=babelHelpers.get(babelHelpers.getPrototypeOf(EntityConfigurationManager.prototype),"getTypeInfos",this).call(this);var ufAddRestriction=this._editor.getRestriction("userFieldAdd");var ufResourceBookingRestriction=this._editor.getRestriction("userFieldResourceBooking");if(ufAddRestriction&&!ufAddRestriction["isPermitted"]&&ufAddRestriction["restrictionCallback"]){for(var i=0,length=typeInfos.length;i<length;i++){typeInfos[i].callback=function(){eval(ufAddRestriction["restrictionCallback"])}}}else if(ufResourceBookingRestriction&&!ufResourceBookingRestriction["isPermitted"]&&ufResourceBookingRestriction["restrictionCallback"]){for(var j=0;j<typeInfos.length;j++){if(typeInfos[j].name==="resourcebooking"){typeInfos[j].callback=function(){eval(ufResourceBookingRestriction["restrictionCallback"])}}}}return typeInfos}}],[{key:"create",value:function e(t,i){var r=new this;r.initialize(t,i);return r}}]);return EntityConfigurationManager}(BX.UI.EntityConfigurationManager);babelHelpers.defineProperty(EntityConfigurationManager,"PHONE_NUMBER_FIELDS",["PHONE","CLIENT","COMPANY","CONTACT","MYCOMPANY_ID"]);babelHelpers.defineProperty(EntityConfigurationManager,"REQUISITE_ADDRESS_FIELDS",["ADDRESS"]);exports.EntityConfigurationManager=EntityConfigurationManager})(this.BX.Crm=this.BX.Crm||{},BX.Crm.EntitySelectorEx,BX.Event,BX);
//# sourceMappingURL=field-configurator.bundle.map.js