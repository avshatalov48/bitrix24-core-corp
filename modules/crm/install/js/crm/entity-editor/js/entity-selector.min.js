BX.namespace("BX.Crm");if(typeof BX.Crm.EntitySelector==="undefined"){BX.Crm.EntitySelector=function(){this._entitySelector=null;this._id=null;this._target=null;this._entityTypeName=null;this._entityTypeId=null;this._parentEntityTypeId=null;this._enableMyCompanyOnly=false;this._withRequisites=false;this._enableSearch=true;this._context=null;this._onSelectCallback=null;this._onBeforeEntityLoadCallback=null;this._onAfterEntityLoadCallback=null};BX.Crm.EntitySelector.prototype={initialize:function(t,e){this._id=String(t)?String(t):null;this._target=BX.prop.getElementNode(e,"target",null);this._entityTypeName=BX.prop.getString(e,"entityTypeName",null);this._entityTypeId=BX.CrmEntityType.resolveId(this._entityTypeName);this._enableMyCompanyOnly=BX.prop.getBoolean(e,"enableMyCompanyOnly",false);this._parentEntityTypeId=BX.prop.getInteger(e,"parentEntityTypeId",null);this._withRequisites=BX.prop.getBoolean(e,"withRequisites",false);this._onSelectCallback=BX.prop.getFunction(e,"onSelectCallback",null);this._onBeforeEntityLoadCallback=BX.prop.getFunction(e,"onBeforeEntityLoadCallback",null);this._onAfterEntityLoadCallback=BX.prop.getFunction(e,"onAfterEntityLoadCallback",null);this._context=BX.prop.getString(e,"context",null);this._enableSearch=BX.prop.getBoolean(e,"enableSearch",true);this._entitySelector=this.createEntitySelector(t,e)},createEntitySelector:function(){throw"Should be overwritten in the derived class"},getAdaptedOnSelectCallback:function(t){throw"Should be overwritten in the derived class"},isOpened:function(){throw"Should be overwritten in the derived class"},open:function(){throw"Should be overwritten in the derived class"},close:function(){throw"Should be overwritten in the derived class"}};BX.Crm.EntitySelector.create=function(t,e){var n=BX.Crm.EntitySelector.getSelectorBySettings(e);n.initialize(t,e);return n};BX.Crm.EntitySelector.getSelectorBySettings=function(t){var e=BX.prop.getObject(t,"loader",null);if(e&&BX.type.isNotEmptyObject(e)){return new BX.Crm.EntitySelectorCrmSelector}return new BX.Crm.EntitySelectorUISelector}}if(typeof BX.Crm.EntitySelectorCrmSelector==="undefined"){BX.Crm.EntitySelectorCrmSelector=function(){BX.Crm.EntitySelectorCrmSelector.superclass.constructor.apply(this);this._loaderConfig=null};BX.extend(BX.Crm.EntitySelectorCrmSelector,BX.Crm.EntitySelector);BX.Crm.EntitySelectorCrmSelector.prototype.initialize=function(t,e){BX.Crm.EntitySelectorCrmSelector.superclass.initialize.apply(this,[t,e]);this._loaderConfig=BX.prop.getObject(e,"loader",null)};BX.Crm.EntitySelectorCrmSelector.prototype.createEntitySelector=function(){return BX.Crm.EntityEditorCrmSelector.create(this._id,{entityTypeIds:[this._entityTypeId],enableMyCompanyOnly:this._enableMyCompanyOnly,callback:this.getAdaptedOnSelectCallback(this._onSelectCallback)})};BX.Crm.EntitySelectorCrmSelector.prototype.getAdaptedOnSelectCallback=function(t){var e=function(e,n){var i=BX.prop.getObject(n,"DATA",null);if(i){if(this._onAfterEntityLoadCallback){this._onAfterEntityLoadCallback()}var r=BX.CrmEntityInfo.create(i);t(r)}}.bind(this);return function(t,n){var i=BX.prop.getObject(this._loaderConfig,this._entityTypeName,null);if(i){if(this._onBeforeEntityLoadCallback){this._onBeforeEntityLoadCallback()}var r=BX.prop.getInteger(n,"entityId",0);BX.CrmDataLoader.create(this._id,{serviceUrl:i["url"],action:i["action"],params:{ENTITY_TYPE_NAME:this._entityTypeName,ENTITY_ID:r}}).load(e)}this.close()}.bind(this)};BX.Crm.EntitySelectorCrmSelector.prototype.isOpened=function(){return this._entitySelector.isOpened()};BX.Crm.EntitySelectorCrmSelector.prototype.open=function(){this._entitySelector.open(this._target)};BX.Crm.EntitySelectorCrmSelector.prototype.close=function(){this._entitySelector.close()}}if(typeof BX.Crm.EntitySelectorUISelector==="undefined"){BX.Crm.EntitySelectorUISelector=function(){BX.Crm.EntitySelectorUISelector.superclass.constructor.apply(this)};BX.extend(BX.Crm.EntitySelectorUISelector,BX.Crm.EntitySelector);BX.Crm.EntitySelectorUISelector.prototype.createEntitySelector=function(){var t=String(this._entityTypeName).toLowerCase();return new BX.UI.EntitySelector.Dialog({targetNode:this._target,id:this._id,context:this._context,enableSearch:this._enableSearch,multiple:false,hideOnSelect:true,entities:[{id:t,dynamicLoad:true,dynamicSearch:true,options:{enableMyCompanyOnly:this._enableMyCompanyOnly,withRequisites:this._withRequisites,parentEntityTypeId:this._parentEntityTypeId}}],events:{"Item:onSelect":this.getAdaptedOnSelectCallback(this._onSelectCallback)}})};BX.Crm.EntitySelectorUISelector.prototype.getAdaptedOnSelectCallback=function(t){return function(e){var n=e.getData().item;var i=n.getCustomData().get("entityInfo");t(BX.CrmEntityInfo.create(i))}.bind(this)};BX.Crm.EntitySelectorUISelector.prototype.isOpened=function(){return this._entitySelector.isOpen()};BX.Crm.EntitySelectorUISelector.prototype.open=function(){this._entitySelector.show()};BX.Crm.EntitySelectorUISelector.prototype.close=function(){this._entitySelector.hide()}}
//# sourceMappingURL=entity-selector.map.js