BX.namespace("BX.Crm");if(typeof BX.Crm.EntityEditorFieldSelector==="undefined"){BX.Crm.EntityEditorFieldSelector=function(){this._id="";this._settings={};this._scheme=null;this._excludedNames=null;this._closingNotifier=null;this._contentWrapper=null;this._popup=null};BX.Crm.EntityEditorFieldSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._scheme=BX.prop.get(this._settings,"scheme",null);if(!this._scheme){throw"BX.Crm.EntityEditorFieldSelector. Parameter 'scheme' is not found."}this._excludedNames=BX.prop.getArray(this._settings,"excludedNames",[]);this._closingNotifier=BX.CrmNotifier.create(this)},getMessage:function(t){return BX.prop.getString(BX.Crm.EntityEditorFieldSelector.messages,t,t)},isSchemeElementEnabled:function(t){var e=t.getName();for(var i=0,n=this._excludedNames.length;i<n;i++){if(this._excludedNames[i]===e){return false}}return true},addClosingListener:function(t){this._closingNotifier.addListener(t)},removeClosingListener:function(t){this._closingNotifier.removeListener(t)},isOpened:function(){return this._popup&&this._popup.isShown()},open:function(){if(this.isOpened()){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{},zIndex:1,titleBar:BX.prop.getString(this._settings,"title",""),content:this.prepareContent(),lightShadow:true,contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:this.getMessage("select"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(this.onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancel"),className:"ui-btn ui-btn-link",events:{click:BX.delegate(this.onCancelButtonClick,this)}})]});this._popup.show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},prepareContent:function(){this._contentWrapper=BX.create("div",{props:{className:"crm-entity-field-selector-window"}});var t=BX.create("div",{props:{className:"crm-entity-field-selector-window-list"}});this._contentWrapper.appendChild(t);var e=this._scheme.getElements();for(var i=0;i<e.length;i++){var n=e[i];if(!this.isSchemeElementEnabled(n)){continue}var s=[];var r=n.getElements();var o;for(var a=0;a<r.length;a++){o=r[a];if(o.isTransferable()&&o.getName()!==""){s.push(o)}}if(s.length===0){continue}var l=n.getName();var c=n.getTitle();t.appendChild(BX.create("div",{attrs:{className:"crm-entity-field-selector-window-list-caption"},text:c}));for(var d=0;d<s.length;d++){o=s[d];var p=o.getName();var m=o.getTitle();var u=l+"\\"+p;var h=BX.create("div",{attrs:{className:"crm-entity-field-selector-window-list-item"}});t.appendChild(h);h.appendChild(BX.create("input",{attrs:{id:u,type:"checkbox",className:"crm-entity-field-selector-window-list-checkbox"}}));h.appendChild(BX.create("label",{attrs:{for:u,className:"crm-entity-field-selector-window-list-label"},text:m}))}}return this._contentWrapper},getSelectedItems:function(){if(!this._contentWrapper){return[]}var t=[];var e=this._contentWrapper.querySelectorAll("input.crm-entity-field-selector-window-list-checkbox");for(var i=0,n=e.length;i<n;i++){var s=e[i];if(s.checked){var r=s.id.split("\\");if(r.length>=2){t.push({sectionName:r[0],fieldName:r[1]})}}}return t},onAcceptButtonClick:function(){this._closingNotifier.notify([{isCanceled:false,items:this.getSelectedItems()}]);this.close()},onCancelButtonClick:function(){this._closingNotifier.notify([{isCanceled:true}]);this.close()},onPopupClose:function(){if(this._popup){this._contentWrapper=null;this._popup.destroy()}},onPopupDestroy:function(){if(!this._popup){return}this._contentWrapper=null;this._popup=null}};if(typeof BX.Crm.EntityEditorFieldSelector.messages==="undefined"){BX.Crm.EntityEditorFieldSelector.messages={}}BX.Crm.EntityEditorFieldSelector.create=function(t,e){var i=new BX.Crm.EntityEditorFieldSelector(t,e);i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUserSelector==="undefined"){BX.Crm.EntityEditorUserSelector=function(){this._id="";this._settings={}};BX.Crm.EntityEditorUserSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._isInitialized=false},getId:function(){return this._id},open:function(t){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){return}if(!this._isInitialized){BX.SocNetLogDestination.init({name:this._id,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:t,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.delegate(this.onSelect,this),unSelect:BX.delegate(this.onSelect,this)},showSearchInput:true,departmentSelectDisable:true,items:{users:BX.Crm.EntityEditorUserSelector.users,groups:{},sonetgroups:{},department:BX.Crm.EntityEditorUserSelector.department,departmentRelation:BX.SocNetLogDestination.buildDepartmentRelation(BX.Crm.EntityEditorUserSelector.department)},itemsLast:BX.Crm.EntityEditorUserSelector.last,itemsSelected:{},isCrmFeed:false,useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:true});this._isInitialized=true}BX.SocNetLogDestination.openDialog(this._id,{bindNode:t});this._mainWindow=BX.SocNetLogDestination.containerWindow},close:function(){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null;this._isInitialized=false}},onSelect:function(t,e,i,n){if(e!=="users"){return}var s=BX.prop.getFunction(this._settings,"callback",null);if(s){s(this,t)}}};BX.Crm.EntityEditorUserSelector.items={};BX.Crm.EntityEditorUserSelector.create=function(t,e){var i=new BX.Crm.EntityEditorUserSelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityEditorCrmSelector==="undefined"){BX.Crm.EntityEditorCrmSelector=function(){this._id="";this._settings={};this._entityTypeIds=[];this._supportedItemTypes={}};BX.Crm.EntityEditorCrmSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._isInitialized=false;this._entityTypeIds=BX.prop.getArray(this._settings,"entityTypeIds",[]);this._supportedItemTypes=[];for(var i=0,n=this._entityTypeIds.length;i<n;i++){var s=this._entityTypeIds[i];if(s===BX.CrmEntityType.enumeration.contact){this._supportedItemTypes.push({name:"contacts",altName:"CRMCONTACT"})}else if(s===BX.CrmEntityType.enumeration.company){this._supportedItemTypes.push({name:"companies",altName:"CRMCOMPANY"})}else if(s===BX.CrmEntityType.enumeration.lead){this._supportedItemTypes.push({name:"leads",altName:"CRMLEAD"})}else if(s===BX.CrmEntityType.enumeration.deal){this._supportedItemTypes.push({name:"deals",altName:"CRMDEAL"})}}},getId:function(){return this._id},isOpened:function(){return BX.SocNetLogDestination.isOpenDialog()},open:function(t){if(this.isOpened()){return}if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){return}if(!this._isInitialized){var e={};var i={};var n=[];for(var s=0,r=this._supportedItemTypes.length;s<r;s++){var o=this._supportedItemTypes[s];e[o.name]=BX.Crm.EntityEditorCrmSelector[o.name];i[o.name]=BX.Crm.EntityEditorCrmSelector[o.name+"Last"];n.push(o.altName)}i["crm"]={};var a={name:this._id,extranetUser:false,bindMainPopup:{node:t,offsetTop:"20px",offsetLeft:"20px"},callback:{select:BX.delegate(this.onSelect,this)},showSearchInput:true,departmentSelectDisable:true,items:e,itemsLast:i,itemsSelected:{},useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:false,isCrmFeed:true,CrmTypes:n};if(BX.prop.getBoolean(this._settings,"enableMyCompanyOnly",false)){a["enableMyCrmCompanyOnly"]=true}BX.SocNetLogDestination.init(a);this._isInitialized=true}BX.SocNetLogDestination.openDialog(this._id,{bindNode:t});this._mainWindow=BX.SocNetLogDestination.containerWindow},close:function(){if(!this.isOpened()){return}if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null}},onSelect:function(t,e,i,n,s,r){if(r!=="select"){return}var o=false;for(var a=0,l=this._supportedItemTypes.length;a<l;a++){var c=this._supportedItemTypes[a];if(c.name===e){o=true;break}}if(!o){return}var d=BX.prop.getFunction(this._settings,"callback",null);if(d){d(this,t)}}};if(typeof BX.Crm.EntityEditorCrmSelector.contacts==="undefined"){BX.Crm.EntityEditorCrmSelector.contacts={}}if(typeof BX.Crm.EntityEditorCrmSelector.contactsLast==="undefined"){BX.Crm.EntityEditorCrmSelector.contactsLast={}}if(typeof BX.Crm.EntityEditorCrmSelector.companies==="undefined"){BX.Crm.EntityEditorCrmSelector.companies={}}if(typeof BX.Crm.EntityEditorCrmSelector.companiesLast==="undefined"){BX.Crm.EntityEditorCrmSelector.companiesLast={}}if(typeof BX.Crm.EntityEditorCrmSelector.leads==="undefined"){BX.Crm.EntityEditorCrmSelector.leads={}}if(typeof BX.Crm.EntityEditorCrmSelector.leadsLast==="undefined"){BX.Crm.EntityEditorCrmSelector.leadsLast={}}if(typeof BX.Crm.EntityEditorCrmSelector.deals==="undefined"){BX.Crm.EntityEditorCrmSelector.deals={}}if(typeof BX.Crm.EntityEditorCrmSelector.dealsLast==="undefined"){BX.Crm.EntityEditorCrmSelector.dealsLast={}}BX.Crm.EntityEditorCrmSelector.items={};BX.Crm.EntityEditorCrmSelector.create=function(t,e){var i=new BX.Crm.EntityEditorCrmSelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}
//# sourceMappingURL=field-selector.map.js