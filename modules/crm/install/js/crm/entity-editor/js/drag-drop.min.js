BX.namespace("BX.Crm");if(typeof BX.Crm.EditorDragScope==="undefined"){BX.Crm.EditorDragScope={intermediate:0,parent:1,form:2,getDefault:function(){return this.form}}}if(typeof BX.Crm.EditorDragObjectType==="undefined"){BX.Crm.EditorDragObjectType={intermediate:"",field:"F",section:"S"}}if(typeof BX.Crm.EditorDragItem==="undefined"){BX.Crm.EditorDragItem=function(){};BX.Crm.EditorDragItem.prototype={getType:function(){return BX.Crm.EditorDragObjectType.intermediate},getContextId:function(){return""},createGhostNode:function(){return null},processDragStart:function(){},processDragPositionChange:function(t,r){},processDragStop:function(){}}}if(typeof BX.Crm.EditorFieldDragItem==="undefined"){BX.Crm.EditorFieldDragItem=function(){BX.Crm.EditorFieldDragItem.superclass.constructor.apply(this);this._scope=BX.Crm.EditorDragScope.undefined;this._control=null;this._contextId=""};BX.extend(BX.Crm.EditorFieldDragItem,BX.Crm.EditorDragItem);BX.Crm.EditorFieldDragItem.prototype.initialize=function(t){this._control=BX.prop.get(t,"control");if(!this._control){throw"Crm.EditorFieldDragItem: The 'control' parameter is not defined in settings or empty."}this._scope=BX.prop.getInteger(t,"scope",BX.Crm.EditorDragScope.getDefault());this._contextId=BX.prop.getString(t,"contextId","")};BX.Crm.EditorFieldDragItem.prototype.getType=function(){return BX.Crm.EditorDragObjectType.field};BX.Crm.EditorFieldDragItem.prototype.getControl=function(){return this._control};BX.Crm.EditorFieldDragItem.prototype.getContextId=function(){return this._contextId!==""?this._contextId:BX.Crm.EditorFieldDragItem.contextId};BX.Crm.EditorFieldDragItem.prototype.createGhostNode=function(){return this._control.createGhostNode()};BX.Crm.EditorFieldDragItem.prototype.processDragStart=function(){window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,true);BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,false);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="0.2"};BX.Crm.EditorFieldDragItem.prototype.processDragPositionChange=function(t,r){var e=this._scope===BX.Crm.EditorDragScope.parent?this._control.getParentPosition():this._control.getRootContainerPosition();if(t.y<e.top){t.y=e.top}if(t.y+r.height>e.bottom){t.y=e.bottom-r.height}if(t.x<e.left){t.x=e.left}if(t.x+r.width>e.right){t.x=e.right-r.width}};BX.Crm.EditorFieldDragItem.prototype.processDragStop=function(){window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,true);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="1"};BX.Crm.EditorFieldDragItem.contextId="editor_field";BX.Crm.EditorFieldDragItem.create=function(t){var r=new BX.Crm.EditorFieldDragItem;r.initialize(t);return r}}if(typeof BX.Crm.EditorSectionDragItem==="undefined"){BX.Crm.EditorSectionDragItem=function(){BX.Crm.EditorSectionDragItem.superclass.constructor.apply(this);this._control=null};BX.extend(BX.Crm.EditorSectionDragItem,BX.Crm.EditorDragItem);BX.Crm.EditorSectionDragItem.prototype.initialize=function(t){this._control=BX.prop.get(t,"control");if(!this._control){throw"Crm.EditorSectionDragItem: The 'control' parameter is not defined in settings or empty."}};BX.Crm.EditorSectionDragItem.prototype.getType=function(){return BX.Crm.EditorDragObjectType.section};BX.Crm.EditorSectionDragItem.prototype.getControl=function(){return this._control};BX.Crm.EditorSectionDragItem.prototype.getContextId=function(){return BX.Crm.EditorSectionDragItem.contextId};BX.Crm.EditorSectionDragItem.prototype.createGhostNode=function(){return this._control.createGhostNode()};BX.Crm.EditorSectionDragItem.prototype.processDragStart=function(){BX.addClass(document.body,"crm-entity-widgets-drag");var t=this._control;t.getWrapper().style.opacity="0.2";window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,true);BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,false);BX.Crm.EditorDragContainerController.refreshAll();window.setTimeout(function(){var r=t.getSiblingByIndex(0);if(r!==null&&r!==t){r.getWrapper().scrollIntoView()}},200)})};BX.Crm.EditorSectionDragItem.prototype.processDragStop=function(){BX.removeClass(document.body,"crm-entity-widgets-drag");window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,true);BX.Crm.EditorDragContainerController.refreshAll()});var t=this._control;t.getWrapper().style.opacity="1";window.setTimeout(function(){t.getWrapper().scrollIntoView()},150)};BX.Crm.EditorSectionDragItem.contextId="editor_section";BX.Crm.EditorSectionDragItem.create=function(t){var r=new BX.Crm.EditorSectionDragItem;r.initialize(t);return r}}if(typeof BX.Crm.EditorDragItemController==="undefined"){BX.Crm.EditorDragItemController=function(){BX.Crm.EditorDragItemController.superclass.constructor.apply(this);this._charge=null;this._preserveDocument=true};BX.extend(BX.Crm.EditorDragItemController,BX.CrmCustomDragItem);BX.Crm.EditorDragItemController.prototype.doInitialize=function(){this._charge=this.getSetting("charge");if(!this._charge){throw"Crm.EditorDragItemController: The 'charge' parameter is not defined in settings or empty."}this._startNotifier=BX.CrmNotifier.create(this);this._stopNotifier=BX.CrmNotifier.create(this);this._ghostOffset={x:0,y:-40}};BX.Crm.EditorDragItemController.prototype.addStartListener=function(t){this._startNotifier.addListener(t)};BX.Crm.EditorDragItemController.prototype.removeStartListener=function(t){this._startNotifier.removeListener(t)};BX.Crm.EditorDragItemController.prototype.addStopListener=function(t){this._stopNotifier.addListener(t)};BX.Crm.EditorDragItemController.prototype.removeStopListener=function(t){this._stopNotifier.removeListener(t)};BX.Crm.EditorDragItemController.prototype.getCharge=function(){return this._charge};BX.Crm.EditorDragItemController.prototype.createGhostNode=function(){if(this._ghostNode){return this._ghostNode}this._ghostNode=this._charge.createGhostNode();document.body.appendChild(this._ghostNode)};BX.Crm.EditorDragItemController.prototype.getGhostNode=function(){return this._ghostNode};BX.Crm.EditorDragItemController.prototype.removeGhostNode=function(){if(this._ghostNode){document.body.removeChild(this._ghostNode);this._ghostNode=null}};BX.Crm.EditorDragItemController.prototype.getContextId=function(){return this._charge.getContextId()};BX.Crm.EditorDragItemController.prototype.getContextData=function(){return{contextId:this._charge.getContextId(),charge:this._charge}};BX.Crm.EditorDragItemController.prototype.processDragStart=function(){BX.Crm.EditorDragItemController.current=this;this._charge.processDragStart();BX.Crm.EditorDragContainerController.refresh(this._charge.getContextId());this._startNotifier.notify([])};BX.Crm.EditorDragItemController.prototype.processDrag=function(t,r){};BX.Crm.EditorDragItemController.prototype.processDragPositionChange=function(t){this._charge.processDragPositionChange(t,BX.pos(this.getGhostNode()))};BX.Crm.EditorDragItemController.prototype.processDragStop=function(){BX.Crm.EditorDragItemController.current=null;this._charge.processDragStop();BX.Crm.EditorDragContainerController.refreshAfter(this._charge.getContextId(),300);this._stopNotifier.notify([])};BX.Crm.EditorDragItemController.current=null;BX.Crm.EditorDragItemController.create=function(t,r){var e=new BX.Crm.EditorDragItemController;e.initialize(t,r);return e}}if(typeof BX.Crm.EditorDragContainer==="undefined"){BX.Crm.EditorDragContainer=function(){};BX.Crm.EditorDragContainer.prototype={getContextId:function(){return""},getPriority:function(){return 100},hasPlaceHolder:function(){return false},createPlaceHolder:function(t){return null},getPlaceHolder:function(){return null},removePlaceHolder:function(){},getChildNodes:function(){return[]},getChildNodeCount:function(){return 0}}}if(typeof BX.Crm.EditorFieldDragContainer==="undefined"){BX.Crm.EditorFieldDragContainer=function(){BX.Crm.EditorFieldDragContainer.superclass.constructor.apply(this);this._section=null;this._context=""};BX.extend(BX.Crm.EditorFieldDragContainer,BX.Crm.EditorDragContainer);BX.Crm.EditorFieldDragContainer.prototype.initialize=function(t){this._section=BX.prop.get(t,"section");if(!this._section){throw"Crm.EditorSectionDragContainer: The 'section' parameter is not defined in settings or empty."}this._context=BX.prop.getString(t,"context","")};BX.Crm.EditorFieldDragContainer.prototype.getSection=function(){return this._section};BX.Crm.EditorFieldDragContainer.prototype.getContextId=function(){return this._context!==""?this._context:BX.Crm.EditorFieldDragItem.contextId};BX.Crm.EditorFieldDragContainer.prototype.getPriority=function(){return 10};BX.Crm.EditorFieldDragContainer.prototype.hasPlaceHolder=function(){return this._section.hasPlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.createPlaceHolder=function(t){return this._section.createPlaceHolder(t)};BX.Crm.EditorFieldDragContainer.prototype.getPlaceHolder=function(){return this._section.getPlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.removePlaceHolder=function(){this._section.removePlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.getChildNodes=function(){var t=[];var r=this._section.getChildren();for(var e=0,o=r.length;e<o;e++){t.push(r[e].getWrapper())}return t};BX.Crm.EditorFieldDragContainer.prototype.getChildNodeCount=function(){return this._section.getChildCount()};BX.Crm.EditorFieldDragContainer.create=function(t){var r=new BX.Crm.EditorFieldDragContainer;r.initialize(t);return r}}if(typeof BX.Crm.EditorSectionDragContainer==="undefined"){BX.Crm.EditorSectionDragContainer=function(){BX.Crm.EditorSectionDragContainer.superclass.constructor.apply(this);this._editor=null};BX.extend(BX.Crm.EditorSectionDragContainer,BX.Crm.EditorDragContainer);BX.Crm.EditorSectionDragContainer.prototype.initialize=function(t){this._editor=BX.prop.get(t,"editor");if(!this._editor){throw"Crm.EditorSectionDragContainer: The 'editor' parameter is not defined in settings or empty."}};BX.Crm.EditorSectionDragContainer.prototype.getEditor=function(){return this._editor};BX.Crm.EditorSectionDragContainer.prototype.getContextId=function(){return BX.Crm.EditorSectionDragItem.contextId};BX.Crm.EditorSectionDragContainer.prototype.getPriority=function(){return 20};BX.Crm.EditorSectionDragContainer.prototype.hasPlaceHolder=function(){return this._editor.hasPlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.createPlaceHolder=function(t){return this._editor.createPlaceHolder(t)};BX.Crm.EditorSectionDragContainer.prototype.getPlaceHolder=function(){return this._editor.getPlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.removePlaceHolder=function(){this._editor.removePlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.getChildNodes=function(){var t=[];var r=this._editor.getControls();for(var e=0,o=r.length;e<o;e++){t.push(r[e].getWrapper())}return t};BX.Crm.EditorSectionDragContainer.prototype.getChildNodeCount=function(){return this._editor.getControlCount()};BX.Crm.EditorSectionDragContainer.create=function(t){var r=new BX.Crm.EditorSectionDragContainer;r.initialize(t);return r}}if(typeof BX.Crm.EditorDragContainerController==="undefined"){BX.Crm.EditorDragContainerController=function(){BX.Crm.EditorDragContainerController.superclass.constructor.apply(this);this._charge=null};BX.extend(BX.Crm.EditorDragContainerController,BX.CrmCustomDragContainer);BX.Crm.EditorDragContainerController.prototype.doInitialize=function(){this._charge=this.getSetting("charge");if(!this._charge){throw"Crm.EditorDragContainerController: The 'charge' parameter is not defined in settings or empty."}};BX.Crm.EditorDragContainerController.prototype.getCharge=function(){return this._charge};BX.Crm.EditorDragContainerController.prototype.createPlaceHolder=function(t){var r=BX.pos(BX.Crm.EditorDragItemController.current.getGhostNode());var e=r.top,o=r.top+40;var i=Math.floor((e+o)/2);var n,a;var d=this._charge.getPlaceHolder();if(d){n=d.getPosition();a=Math.floor((n.top+n.bottom)/2);if(e<=n.bottom&&e>=n.top||o>=n.top&&o<=n.bottom||Math.abs(i-a)<=8){if(!d.isActive()){d.setActive(true)}return}}var c=this._charge.getChildNodes();for(var s=0;s<c.length;s++){n=BX.pos(c[s]);a=Math.floor((n.top+n.bottom)/2);if(e<=n.bottom&&e>=n.top||o>=n.top&&o<=n.bottom||Math.abs(i-a)<=8){this._charge.createPlaceHolder(i-a<=0?s:s+1).setActive(true);return}}this._charge.createPlaceHolder(-1).setActive(true);this.refresh()};BX.Crm.EditorDragContainerController.prototype.removePlaceHolder=function(){if(!this._charge.hasPlaceHolder()){return}if(this._charge.getChildNodeCount()>0){this._charge.removePlaceHolder()}else{this._charge.getPlaceHolder().setActive(false)}this.refresh()};BX.Crm.EditorDragContainerController.prototype.getContextId=function(){return this._charge.getContextId()};BX.Crm.EditorDragContainerController.prototype.getPriority=function(){return this._charge.getPriority()};BX.Crm.EditorDragContainerController.prototype.isAllowedContext=function(t){return t===this._charge.getContextId()};BX.Crm.EditorDragContainerController.refresh=function(t){for(var r in this.items){if(!this.items.hasOwnProperty(r)){continue}var e=this.items[r];if(e.getContextId()===t){e.refresh()}}};BX.Crm.EditorDragContainerController.refreshAfter=function(t,r){r=parseInt(r);if(r>0){window.setTimeout(function(){BX.Crm.EditorDragContainerController.refresh(t)},r)}else{this.refresh(t)}};BX.Crm.EditorDragContainerController.refreshAll=function(){for(var t in this.items){if(!this.items.hasOwnProperty(t)){continue}this.items[t].refresh()}};BX.Crm.EditorDragContainerController.enable=function(t,r){for(var e in this.items){if(!this.items.hasOwnProperty(e)){continue}var o=this.items[e];if(o.getContextId()===t){o.enable(r)}}};BX.Crm.EditorDragContainerController.items={};BX.Crm.EditorDragContainerController.create=function(t,r){var e=new BX.Crm.EditorDragContainerController;e.initialize(t,r);this.items[e.getId()]=e;return e}}if(typeof BX.Crm.EditorDragPlaceholder==="undefined"){BX.Crm.EditorDragPlaceholder=function(){this._settings=null;this._container=null;this._node=null;this._isDragOver=false;this._isActive=false;this._index=-1;this._timeoutId=null};BX.Crm.EditorDragPlaceholder.prototype={initialize:function(t){this._settings=t?t:{};this._container=this.getSetting("container",null);this._isActive=this.getSetting("isActive",false);this._index=parseInt(this.getSetting("index",-1))},getSetting:function(t,r){return this._settings.hasOwnProperty(t)?this._settings[t]:r},getContainer:function(){return this._container},setContainer:function(t){this._container=t},isDragOver:function(){return this._isDragOver},isActive:function(){return this._isActive},setActive:function(t,r){if(this._timeoutId!==null){window.clearTimeout(this._timeoutId);this._timeoutId=null}r=parseInt(r);if(r>0){var e=this;window.setTimeout(function(){if(e._timeoutId===null)return;e._timeoutId=null;e.setActive(t,0)},r);return}t=!!t;if(this._isActive===t){return}this._isActive=t;if(this._node){}},getIndex:function(){return this._index},prepareNode:function(){return null},layout:function(){this._node=this.prepareNode();var t=this.getSetting("anchor",null);if(t){this._container.insertBefore(this._node,t)}else{this._container.appendChild(this._node)}BX.bind(this._node,"dragover",BX.delegate(this._onDragOver,this));BX.bind(this._node,"dragleave",BX.delegate(this._onDragLeave,this))},clearLayout:function(){if(this._node){this._node.style.height=0;setTimeout(BX.proxy(function(){this._node=BX.remove(this._node)},this),100)}},getPosition:function(){return BX.pos(this._node)},_onDragOver:function(t){t=t||window.event;this._isDragOver=true;return BX.eventReturnFalse(t)},_onDragLeave:function(t){t=t||window.event;this._isDragOver=false;return BX.eventReturnFalse(t)}}}if(typeof BX.Crm.EditorDragFieldPlaceholder==="undefined"){BX.Crm.EditorDragFieldPlaceholder=function(){};BX.extend(BX.Crm.EditorDragFieldPlaceholder,BX.Crm.EditorDragPlaceholder);BX.Crm.EditorDragFieldPlaceholder.prototype.prepareNode=function(){return BX.create("div",{attrs:{className:"crm-entity-widget-content-block-place"}})};BX.Crm.EditorDragFieldPlaceholder.create=function(t){var r=new BX.Crm.EditorDragFieldPlaceholder;r.initialize(t);return r}}if(typeof BX.Crm.EditorDragSectionPlaceholder==="undefined"){BX.Crm.EditorDragSectionPlaceholder=function(){};BX.extend(BX.Crm.EditorDragSectionPlaceholder,BX.Crm.EditorDragPlaceholder);BX.Crm.EditorDragSectionPlaceholder.prototype.prepareNode=function(){return BX.create("div",{attrs:{className:"crm-entity-card-widget crm-entity-card-widget-place"}})};BX.Crm.EditorDragSectionPlaceholder.create=function(t){var r=new BX.Crm.EditorDragSectionPlaceholder;r.initialize(t);return r}}
//# sourceMappingURL=drag-drop.map.js