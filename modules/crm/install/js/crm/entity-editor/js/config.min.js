BX.namespace("BX.Crm");if(typeof BX.Crm.EntityConfig==="undefined"){BX.Crm.EntityConfig=function(){this._id="";this._settings={};this._scope=BX.Crm.EntityConfigScope.undefined;this._enableScopeToggle=true;this._canUpdatePersonalConfiguration=true;this._canUpdateCommonConfiguration=false;this._data={};this._items=[];this._options={};this._serviceUrl="";this._isChanged=false};BX.Crm.EntityConfig.prototype={initialize:function(t,i){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=i?i:{};this._scope=BX.prop.getString(this._settings,"scope",BX.Crm.EntityConfigScope.personal);this._enableScopeToggle=BX.prop.getBoolean(this._settings,"enableScopeToggle",true);this._canUpdatePersonalConfiguration=BX.prop.getBoolean(this._settings,"canUpdatePersonalConfiguration",true);this._canUpdateCommonConfiguration=BX.prop.getBoolean(this._settings,"canUpdateCommonConfiguration",false);this._data=BX.prop.getArray(this._settings,"data",[]);this._items=[];for(var e=0,n=this._data.length;e<n;e++){var o=this._data[e];var s=BX.prop.getString(o,"type","");if(s==="section"){this._items.push(BX.Crm.EntityConfigSection.create({data:o}))}else{this._items.push(BX.Crm.EntityConfigField.create({data:o}))}}this._options=BX.prop.getObject(this._settings,"options",{});this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","")},findItemByName:function(t){for(var i=0,e=this._items.length;i<e;i++){var n=this._items[i];if(n.getName()===t){return n}}return null},findItemIndexByName:function(t){for(var i=0,e=this._items.length;i<e;i++){var n=this._items[i];if(n.getName()===t){return i}}return-1},toJSON:function(){var t=[];for(var i=0,e=this._items.length;i<e;i++){t.push(this._items[i].toJSON())}return t},addSchemeElementAt:function(t,i){var e=t.createConfigItem();var n=t.getType()==="section"?BX.Crm.EntityConfigSection.create({data:e}):BX.Crm.EntityConfigField.create({data:e});if(i>=0&&i<this._items.length){this._items.splice(i,0,n)}else{this._items.push(n)}this._isChanged=true},moveSchemeElement:function(t,i){var e=this._items.length;var n=e-1;if(i<0||i>e){i=n}var o=this.findItemIndexByName(t.getName());if(o<0||o===i){return}var s=this._items[o];this._items.splice(o,1);e--;if(i<e){this._items.splice(i,0,s)}else{this._items.push(s)}this._isChanged=true},updateSchemeElement:function(t){var i;var e=t.getParent();if(e){var n=this.findItemByName(e.getName());if(n){i=n.findFieldIndexByName(t.getName());if(i>=0){n.setField(BX.Crm.EntityConfigField.create({data:t.createConfigItem()}),i);this._isChanged=true}}}else{i=this.findItemIndexByName(t.getName());if(i>=0){if(t.getType()==="section"){this._items[i]=BX.Crm.EntityConfigSection.create({data:t.createConfigItem()})}else{this._items[i]=BX.Crm.EntityConfigField.create({data:t.createConfigItem()})}this._isChanged=true}}},removeSchemeElement:function(t){var i=this.findItemIndexByName(t.getName());if(i<0){return}this._items.splice(i,1);this._isChanged=true},isChangeable:function(){if(this._scope===BX.Crm.EntityConfigScope.common){return this._canUpdateCommonConfiguration}else if(this._scope===BX.Crm.EntityConfigScope.personal){return this._canUpdatePersonalConfiguration}return false},isChanged:function(){return this._isChanged},isScopeToggleEnabled:function(){return this._enableScopeToggle},getScope:function(){return this._scope},setScope:function(t){var i=new BX.Promise;if(!this._enableScopeToggle||this._scope===t){window.setTimeout(function(){i.fulfill()},0);return i}this._scope=t;this._data=[];this._items=[];BX.ajax.post(this._serviceUrl,{guid:this._id,action:"setScope",scope:this._scope},function(){i.fulfill()});return i},registerField:function(t){var i=t.getParent();if(!i){return}var e=this.findItemByName(i.getName());if(!e){return}e.addField(BX.Crm.EntityConfigField.create({data:t.createConfigItem()}));this.save()},unregisterField:function(t){var i=t.getParent();if(!i){return}var e=this.findItemByName(i.getName());if(!e){return}var n=e.findFieldByName(t.getName());if(!n){return}e.removeFieldByIndex(n.getIndex());this.save()},save:function(t,i){t=!!t;i=!!i;var e=new BX.Promise;if(!this._isChanged&&!t){window.setTimeout(function(){e.fulfill()},0);return e}var n={guid:this._id,action:"save",scope:this._scope,config:this.toJSON()};if(i){n["options"]=this._options}if(this._scope===BX.Crm.EntityConfigScope.personal&&t){n["forAllUsers"]="Y";n["delete"]="Y"}BX.ajax.post(this._serviceUrl,n,function(){e.fulfill()});this._isChanged=false;return e},reset:function(t){var i={guid:this._id,action:"reset",scope:this._scope,config:this.toJSON()};if(t){i["forAllUsers"]="Y"}var e=new BX.Promise;BX.ajax.post(this._serviceUrl,i,function(){e.fulfill()});return e},forceCommonScopeForAll:function(){var t=new BX.Promise;BX.ajax.post(this._serviceUrl,{guid:this._id,action:"forceCommonScopeForAll"},function(){t.fulfill()});return t},getOption:function(t,i){return BX.prop.getString(this._options,t,i)},setOption:function(t,i){if(typeof i==="undefined"||i===null){return}if(BX.prop.getString(this._options,t,null)===i){return}this._options[t]=i;if(this._scope===BX.Crm.EntityConfigScope.common){BX.userOptions.save("crm.entity.editor",this._id+"_common_opts",t,i,true)}else{BX.userOptions.save("crm.entity.editor",this._id+"_opts",t,i,false)}}};BX.Crm.EntityConfig.create=function(t,i){var e=new BX.Crm.EntityConfig;e.initialize(t,i);return e}}if(typeof BX.Crm.EntityConfigItem==="undefined"){BX.Crm.EntityConfigItem=function(){this._settings={};this._data={};this._name="";this._title=""};BX.Crm.EntityConfigItem.prototype={initialize:function(t){this._settings=t?t:{};this._data=BX.prop.getObject(this._settings,"data",[]);this._name=BX.prop.getString(this._data,"name","");this._title=BX.prop.getString(this._data,"title","");this.doInitialize()},doInitialize:function(){},getType:function(){return""},getName:function(){return this._name},getTitle:function(){return this._title},toJSON:function(){return{}}}}if(typeof BX.Crm.EntityConfigSection==="undefined"){BX.Crm.EntityConfigSection=function(){BX.Crm.EntityConfigSection.superclass.constructor.apply(this);this._fields=[]};BX.extend(BX.Crm.EntityConfigSection,BX.Crm.EntityConfigItem);BX.Crm.EntityConfigSection.prototype.doInitialize=function(){this._fields=[];var t=BX.prop.getArray(this._data,"elements",[]);for(var i=0,e=t.length;i<e;i++){var n=BX.Crm.EntityConfigField.create({data:t[i]});n.setIndex(i);this._fields.push(n)}};BX.Crm.EntityConfigSection.prototype.getType=function(){return"section"};BX.Crm.EntityConfigSection.prototype.getFields=function(){return this._fields};BX.Crm.EntityConfigSection.prototype.findFieldByName=function(t){var i=this.findFieldIndexByName(t);return i>=0?this._fields[i]:null};BX.Crm.EntityConfigSection.prototype.findFieldIndexByName=function(t){for(var i=0,e=this._fields.length;i<e;i++){var n=this._fields[i];if(n.getName()===t){return i}}return-1};BX.Crm.EntityConfigSection.prototype.addField=function(t){this._fields.push(t)};BX.Crm.EntityConfigSection.prototype.setField=function(t,i){this._fields[i]=t};BX.Crm.EntityConfigSection.prototype.removeFieldByIndex=function(t){var i=this._fields.length;if(t<0||t>=i){return false}this._fields.splice(t,1);return true};BX.Crm.EntityConfigSection.prototype.toJSON=function(){var t={name:this._name,title:this._title,type:"section",elements:[]};for(var i=0,e=this._fields.length;i<e;i++){t.elements.push(this._fields[i].toJSON())}return t};BX.Crm.EntityConfigSection.create=function(t){var i=new BX.Crm.EntityConfigSection;i.initialize(t);return i}}if(typeof BX.Crm.EntityConfigField==="undefined"){BX.Crm.EntityConfigField=function(){BX.Crm.EntityConfigField.superclass.constructor.apply(this);this._index=-1;this._optionFlags=0};BX.extend(BX.Crm.EntityConfigField,BX.Crm.EntityConfigItem);BX.Crm.EntityConfigField.prototype.doInitialize=function(){this._optionFlags=BX.prop.getInteger(this._data,"optionFlags",0)};BX.Crm.EntityConfigField.prototype.toJSON=function(){var t={name:this._name};if(this._title!==""){t["title"]=this._title}if(this._optionFlags>0){t["optionFlags"]=this._optionFlags}return t};BX.Crm.EntityConfigField.prototype.getIndex=function(){return this._index};BX.Crm.EntityConfigField.prototype.setIndex=function(t){this._index=t};BX.Crm.EntityConfigField.create=function(t){var i=new BX.Crm.EntityConfigField;i.initialize(t);return i}}if(typeof BX.Crm.EntityConfigScope==="undefined"){BX.Crm.EntityConfigScope={undefined:"",personal:"P",common:"C"};if(typeof BX.Crm.EntityConfigScope.captions==="undefined"){BX.Crm.EntityConfigScope.captions={}}BX.Crm.EntityConfigScope.setCaptions=function(t){if(BX.type.isPlainObject(t)){this.captions=t}};BX.Crm.EntityConfigScope.getCaption=function(t){return BX.prop.getString(this.captions,t,t)}}
//# sourceMappingURL=config.map.js