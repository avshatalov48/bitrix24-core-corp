{"version":3,"file":"summary-list.bundle.js","sources":["../src/summary-list.js"],"sourcesContent":["import {Type, Text, Tag, Loc, bind, unbind} from \"main.core\";\nimport {EventEmitter} from 'main.core.events';\nimport {PopupManager} from \"main.popup\";\nimport {Button} from 'ui.buttons';\nimport 'ui.design-tokens';\n\nimport \"./summary-list.css\"\n\ntype Settings = {\n\tcontroller: Object;\n\tanchor: Object;\n\twrapper: Object;\n\tclientSearchBox: Object;\n};\n\nclass ItemInfo\n{\n\t#entityTypeName: \"\";\n\t#entityId: 0;\n\t#entityTypeTitle: \"\";\n\t#entityTitle: \"\";\n\t#isMy: false;\n\t#entityUrl: \"\";\n\t#relatedEntityTitle = \"\";\n\t#communications: {\n\t\tphone: string[],\n\t\temail: string[],\n\t};\n\n\tconstructor()\n\t{\n\t\tthis.#communications = {\n\t\t\tphone: [],\n\t\t\temail: [],\n\t\t};\n\t}\n\n\ttoPlainObject()\n\t{\n\t\treturn {\n\t\t\tentityTypeName: this.#entityTypeName,\n\t\t\tentityId: this.#entityId,\n\t\t\tentityTypeTitle: this.#entityTypeTitle,\n\t\t\tentityTitle: this.#entityTitle,\n\t\t\tisMy: this.#isMy,\n\t\t\tentityUrl: this.#entityUrl,\n\t\t\trelatedEntityTitle: this.#relatedEntityTitle,\n\t\t\tcommunications: this.#communications,\n\t\t};\n\t}\n\n\tset entityTypeName(value: string)\n\t{\n\t\tthis.#entityTypeName = value;\n\t}\n\n\tget entityTypeName(): string\n\t{\n\t\treturn this.#entityTypeName;\n\t}\n\n\tset entityId(value: number)\n\t{\n\t\tthis.#entityId = value;\n\t}\n\n\tget entityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tset entityTypeTitle(value: string)\n\t{\n\t\tthis.#entityTypeTitle = value;\n\t}\n\n\tget entityTypeTitle(): string\n\t{\n\t\treturn this.#entityTypeTitle;\n\t}\n\n\tset entityTitle(value: string)\n\t{\n\t\tthis.#entityTitle = value;\n\t}\n\n\tget entityTitle(): string\n\t{\n\t\treturn this.#entityTitle;\n\t}\n\n\tset isMy(value: boolean)\n\t{\n\t\tthis.#isMy = value;\n\t}\n\n\tget isMy(): boolean\n\t{\n\t\treturn this.#isMy;\n\t}\n\n\tset entityUrl(value: string)\n\t{\n\t\tthis.#entityUrl = value;\n\t}\n\n\tget entityUrl(): string\n\t{\n\t\treturn this.#entityUrl;\n\t}\n\n\tset relatedEntityTitle(value: string)\n\t{\n\t\tthis.#relatedEntityTitle = value;\n\t}\n\n\tget relatedEntityTitle(): string\n\t{\n\t\treturn this.#relatedEntityTitle;\n\t}\n\n\t#addCommunicationValue(communicationType: string, value: string)\n\t{\n\t\tif (this.#communications[communicationType].indexOf(value) < 0)\n\t\t{\n\t\t\tthis.#communications[communicationType].push(value);\n\t\t}\n\t}\n\n\t#addCommunicationList(communicationType: string, list: Array)\n\t{\n\t\tfor (let i = 0; i < list.length; i++)\n\t\t{\n\t\t\tthis.#addCommunicationValue(communicationType, list[i]);\n\t\t}\n\t}\n\t\n\taddPhones(values: Array)\n\t{\n\t\tthis.#addCommunicationList(\"phone\", values);\n\t}\n\n\taddEmails(values: Array)\n\t{\n\t\tthis.#addCommunicationList(\"email\", values);\n\t}\n}\n\nclass SummaryList extends EventEmitter\n{\n\t#handleWindowResize: Function | null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('crm.entity-editor.summary-list.close')\n\n\t\tthis.id = '';\n\t\tthis.popupId = '';\n\t\tthis.settings = {};\n\t\tthis.anchor = null;\n\t\tthis.wrapper = null;\n\t\tthis.clientSearchBox = null;\n\t\tthis.enableEntitySelect = false;\n\t\tthis.items = [];\n\t\tthis.padding = 0;\n\t\tthis.#handleWindowResize = null;\n\t}\n\n\tinitialize(id: string, settings: Settings)\n\t{\n\t\tthis.id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.popupId = this.id + \"_popup\";\n\n\t\tif (Type.isPlainObject(settings))\n\t\t{\n\t\t\tthis.settings = settings;\n\t\t\tthis.anchor = BX.prop.getElementNode(settings, \"anchor\", null);\n\t\t\tthis.wrapper = BX.prop.getElementNode(settings, \"wrapper\", null);\n\t\t\tthis.clientSearchBox = BX.prop.get(settings, \"clientSearchBox\", null);\n\t\t\tthis.enableEntitySelect = BX.prop.getBoolean(settings, \"enableEntitySelect\", false);\n\t\t}\n\n\t\tthis.padding = BX.prop.getInteger(settings, 'padding', 14);\n\t}\n\n\tshow()\n\t{\n\t\tconst popup = PopupManager.create({\n\t\t\tid: this.popupId,\n\t\t\tcacheable: false,\n\t\t\tpadding: this.padding,\n\t\t\tcontentPadding: 0,\n\t\t\tcontent: this.getLayout(),\n\t\t\tcloseIcon: {\n\t\t\t\ttop: '10px',\n\t\t\t\tright: '5px',\n\t\t\t},\n\t\t\tcloseByEsc: false,\n\t\t\tbackground: this.#getPopupBackgroundColor(),\n\t\t\tanimation: {\n\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\tshowClassName: 'crm-dups-popup-open',\n\t\t\t\tcloseClassName: 'crm-dups-popup-close',\n\t\t\t}\n\t\t});\n\n\t\tif (!this.#handleWindowResize)\n\t\t{\n\t\t\tthis.#handleWindowResize = this.adjustPosition.bind(this);\n\n\t\t\tbind(window, 'resize', this.#handleWindowResize);\n\t\t}\n\n\t\tpopup.subscribe('onDestroy', () => {\n\t\t\tthis.emit('close', this);\n\t\t});\n\n\t\tpopup.subscribe(\"onFirstShow\", (event) => {\n\t\t\tevent.target.getZIndexComponent().subscribe(\"onZIndexChange\", (event) => {\n\t\t\t\tif (event.target.getZIndex() !== 850)\n\t\t\t\t{\n\t\t\t\t\tevent.target.setZIndex(850);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tpopup.show();\n\t\tthis.adjustPosition();\n\t}\n\n\tgetController()\n\t{\n\t\tconst controller = BX.prop.get(this.settings, \"controller\", null);\n\n\t\treturn (controller instanceof BX.CrmDupController) ? controller : null;\n\t}\n\n\tgetTargetEntityTypeName()\n\t{\n\t\tconst controller = this.getController();\n\n\t\treturn controller ? controller.getEntityTypeName() : \"\";\n\t}\n\n\tgetDuplicateData()\n\t{\n\t\tconst controller = this.getController();\n\n\t\treturn controller ? controller.getDuplicateData() : {};\n\t}\n\n\tgetGroup(groupId)\n\t{\n\t\tconst controller = Type.isStringFilled(groupId) ? this.getController() : null;\n\n\t\treturn controller ? controller.getGroup(groupId) : null;\n\t}\n\n\tgetGroupSummaryTitle(groupId, groupData)\n\t{\n\t\tif (\n\t\t\tType.isPlainObject(groupData)\n\t\t\t&& groupData.hasOwnProperty(\"totalText\")\n\t\t\t&& Type.isStringFilled(groupData['totalText'])\n\t\t)\n\t\t{\n\t\t\tconst group = this.getGroup(groupId);\n\t\t\tconst title = group ? group.getSummaryTitle() : \"\";\n\t\t\tif (Type.isStringFilled(title))\n\t\t\t{\n\t\t\t\treturn groupData['totalText'] + \" \" + title;\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\tgetLayoutData()\n\t{\n\t\tconst result = {\n\t\t\ttitle: \"\",\n\t\t\tgroups: []\n\t\t};\n\n\t\tconst data = this.getDuplicateData();\n\n\t\tlet totalItemCount = 0;\n\t\tfor (const groupId in data)\n\t\t{\n\t\t\tif (!data.hasOwnProperty(groupId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst groupData = Type.isPlainObject(data[groupId]) ? data[groupId] : {};\n\t\t\tconst items = Type.isArray(groupData[\"items\"]) ? groupData[\"items\"] : [];\n\n\t\t\tconst groupInfo = {\n\t\t\t\ttitle: this.getGroupSummaryTitle(groupId, groupData),\n\t\t\t\titems: []\n\t\t\t};\n\n\t\t\tconst entityTypeIdMap = [];\n\t\t\tfor (let i = 0; i < items.length; i++)\n\t\t\t{\n\t\t\t\tconst item = items[i];\n\t\t\t\tconst entities = Type.isArray(item[\"ENTITIES\"]) ? item[\"ENTITIES\"] : [];\n\t\t\t\tfor (let j = 0; j < entities.length; j++)\n\t\t\t\t{\n\t\t\t\t\tconst entity = entities[j];\n\t\t\t\t\tconst entityTypeId = this.getEntityTypeId(entity);\n\t\t\t\t\tif (!BX.CrmEntityType.isDefined(entityTypeId))\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst entityTypeName = BX.CrmEntityType.resolveName(entityTypeId);\n\t\t\t\t\tconst entityId = this.getEntityId(entity);\n\n\t\t\t\t\tlet needAdd = false;\n\n\t\t\t\t\tif (!entityTypeIdMap.hasOwnProperty(entityTypeName))\n\t\t\t\t\t{\n\t\t\t\t\t\tentityTypeIdMap[entityTypeName] = [entityId];\n\t\t\t\t\t\tneedAdd = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst isExists = (entityTypeIdMap[entityTypeName].indexOf(entityId) >= 0);\n\t\t\t\t\t\tif (!isExists)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentityTypeIdMap[entityTypeName].push(entityId);\n\t\t\t\t\t\t\tneedAdd = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needAdd)\n\t\t\t\t\t{\n\t\t\t\t\t\tgroupInfo.items.push(this.prepareItemInfo(entity));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (groupInfo.items.length > 0)\n\t\t\t{\n\t\t\t\ttotalItemCount += groupInfo.items.length;\n\t\t\t\tresult.groups.push(groupInfo);\n\t\t\t}\n\t\t}\n\n\t\tresult.title = Loc.getMessage(\n\t\t\t\"DUPLICATE_SUMMARY_LIST_TOTAL_COUNT_TITLE\",\n\t\t\t{ \"#COUNT#\": totalItemCount }\n\t\t);\n\n\t\treturn result;\n\t}\n\n\tgetEntityTypeId(entity: Object)\n\t{\n\t\treturn Type.isStringFilled(entity[\"ENTITY_TYPE_ID\"]) ? parseInt(entity[\"ENTITY_TYPE_ID\"]) : 0;\n\t}\n\n\tgetEntityId(entity: Object)\n\t{\n\t\treturn Type.isStringFilled(entity[\"ENTITY_ID\"]) ? parseInt(entity[\"ENTITY_ID\"]) : 0;\n\t}\n\n\tprepareItemInfo(entity: Object): Object\n\t{\n\t\tconst itemInfo = new ItemInfo();\n\n\t\tconst entityTypeId = this.getEntityTypeId(entity);\n\t\titemInfo.entityTypeName = BX.CrmEntityType.resolveName(entityTypeId)\n\t\titemInfo.entityId = this.getEntityId(entity);\n\t\titemInfo.entityTypeTitle = BX.CrmEntityType.getCaption(entityTypeId)\n\t\titemInfo.entityTitle = BX.prop.getString(entity, \"TITLE\", \"\");\n\t\titemInfo.isMy = (\n\t\t\tentityTypeId === BX.CrmEntityType.enumeration.company\n\t\t\t&& BX.prop.getString(entity, \"IS_MY_COMPANY\", \"\") === \"Y\"\n\t\t);\n\t\titemInfo.entityUrl = BX.prop.getString(entity, \"URL\", \"\");\n\t\titemInfo.addPhones(BX.prop.getArray(entity, \"PHONE\", []));\n\t\titemInfo.addEmails(BX.prop.getArray(entity, \"EMAIL\", []));\n\n\t\treturn itemInfo.toPlainObject();\n\t}\n\n\trenderItemDetails(item: Object): string\n\t{\n\t\tlet content = \"\";\n\n\t\tconst communications = item[\"communications\"];\n\n\t\tlet needDots = false;\n\n\t\t[\"phone\", \"email\"].forEach((type) => {\n\t\t\tif (!needDots && communications[type].length > 5)\n\t\t\t{\n\t\t\t\tneedDots = true;\n\t\t\t}\n\t\t\tif (communications[type].length > 0)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < communications[type].length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (content.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent += \", \";\n\t\t\t\t\t}\n\t\t\t\t\tcontent += communications[type][i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (needDots)\n\t\t{\n\t\t\tcontent += \", ...\";\n\t\t}\n\n\t\treturn content;\n\t}\n\n\tgetLayout()\n\t{\n\t\tconst layoutData = this.getLayoutData();\n\n\t\tif (\n\t\t\t!(\n\t\t\t\tType.isStringFilled(layoutData[\"title\"])\n\t\t\t\t&& Type.isArray(layoutData[\"groups\"])\n\t\t\t\t&& layoutData[\"groups\"].length > 0\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-dups-wrapper\">\n\t\t\t\t<div class=\"crm-dups-header\">${Text.encode(layoutData[\"title\"])}</div>\n\t\t\t\t<div class=\"crm-dups-list\">${layoutData[\"groups\"].map((group) => Tag.render`\n\t\t\t\t\t<div class=\"crm-dups-group\">\n\t\t\t\t\t\t<div class=\"crm-dups-group-header\">${Text.encode(group[\"title\"])}</div>\n\t\t\t\t\t\t<div class=\"crm-dups-group-items\">${group[\"items\"].map((item) => Tag.render`\n\t\t\t\t\t\t\t<div class=\"crm-dups-item\">\n\t\t\t\t\t\t\t\t<div class=\"crm-dups-item-top\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-dups-item-header\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"crm-dups-item-type\">${Text.encode(item[\"entityTypeTitle\"])}</div>\n\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\thref=\"${Text.encode(item[\"entityUrl\"])}\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"crm-dups-item-title\">${Text.encode(item[\"entityTitle\"])}</a>\n\t\t\t\t\t\t\t\t\t\t<div class=\"crm-dups-item-rel-title hidden\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t${this.#renderAddButton({\n\t\t\t\t\t\t\t\t\t\t\"type\": item[\"entityTypeName\"],\n\t\t\t\t\t\t\t\t\t\t\"id\": item[\"entityId\"],\n\t\t\t\t\t\t\t\t\t\t\"title\": item[\"entityTitle\"],\n\t\t\t\t\t\t\t\t\t\t\"isMy\": item[\"isMy\"]\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-dups-item-details\">\n\t\t\t\t\t\t\t\t\t${Text.encode(this.renderItemDetails(item))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`)}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tadjustPosition()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\tif (\n\t\t\t!popup\n\t\t\t|| !popup.isShown()\n\t\t\t|| !Type.isDomNode(this.anchor)\n\t\t\t|| !Type.isDomNode(this.wrapper)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst wrapperRect = this.wrapper.getBoundingClientRect();\n\t\tconst itemRect = this.anchor.getBoundingClientRect();\n\t\tconst viewRect = document.documentElement.getBoundingClientRect();\n\t\tconst viewTop = - viewRect.top;\n\t\tconst viewBottom = viewRect.height - viewRect.top;\n\t\tconst offsetLeft = -viewRect.left + wrapperRect.left + wrapperRect.width + this.padding;\n\t\tconst popupHeight = popup.getPopupContainer().clientHeight;\n\n\t\tlet popupVerticalPosition;\n\t\tlet angleOffset;\n\t\tconst itemVerticalCenter = viewTop + itemRect.top + itemRect.height / 2;\n\t\tif (itemVerticalCenter < viewTop)\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop + itemRect.top - this.padding;\n\t\t\tangleOffset = this.padding + itemRect.height / 2;\n\t\t}\n\t\telse if (itemVerticalCenter > viewBottom)\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop + itemRect.bottom + this.padding - popupHeight;\n\t\t\tangleOffset = popupHeight - this.padding - itemRect.height / 2;\n\t\t}\n\t\telse if (popupHeight < viewRect.height)\n\t\t{\n\t\t\tlet verticalOffset = 0;\n\t\t\tpopupVerticalPosition = itemVerticalCenter - popupHeight / 2;\n\t\t\tif (popupVerticalPosition < viewTop)\n\t\t\t{\n\t\t\t\tverticalOffset = viewTop - popupVerticalPosition\n\t\t\t}\n\t\t\telse if (viewBottom < popupVerticalPosition + popupHeight)\n\t\t\t{\n\t\t\t\tverticalOffset = viewBottom - popupVerticalPosition - popupHeight;\n\t\t\t}\n\t\t\tpopupVerticalPosition += verticalOffset;\n\t\t\tangleOffset = itemVerticalCenter - popupVerticalPosition;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop;\n\t\t\tangleOffset = itemVerticalCenter - popupVerticalPosition;\n\t\t\tif (angleOffset < 0)\n\t\t\t{\n\t\t\t\tangleOffset += popupHeight;\n\t\t\t}\n\t\t}\n\t\tangleOffset -= this.padding;\n\n\t\tpopup.setBindElement({left: offsetLeft, top: popupVerticalPosition});\n\t\tpopup.setAngle({position: \"left\", offset: angleOffset});\n\t\tpopup.adjustPosition();\n\t\tsetTimeout(() => popup.getZIndexComponent().setZIndex(850), 0);\n\t}\n\n\tisShown()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\treturn popup && popup.isShown();\n\t}\n\n\tclose()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\tpopup ? popup.close() : null;\n\t\tunbind(document, 'resize', this.#handleWindowResize);\n\t\tthis.#handleWindowResize = null;\n\t}\n\n\t#getPopupBackgroundColor(): string\n\t{\n\t\tconst bodyStyles = getComputedStyle(document.body);\n\t\treturn bodyStyles?.getPropertyValue(\"--ui-color-palette-gray-03\") || '#F5F7F8';\n\t}\n\n\t#renderAddButton(options): HTMLElement|string\n\t{\n\t\tif (\n\t\t\t!this.enableEntitySelect\n\t\t\t|| (\n\t\t\t\toptions.hasOwnProperty(\"isMy\")\n\t\t\t\t&& options[\"isMy\"]\n\t\t\t)\n\t\t\t|| (\n\t\t\t\tType.isPlainObject(options)\n\t\t\t\t&& options.hasOwnProperty(\"type\")\n\t\t\t\t&& options[\"type\"] !== this.getTargetEntityTypeName()\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn \"\";\n\t\t}\n\n\t\tconst btn = new Button({\n\t\t\tround: true,\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\ttext: Loc.getMessage('DUPLICATE_SUMMARY_LIST_ITEM_ADD_BUTTON'),\n\t\t\tcontext: {\n\t\t\t\ttype: options[\"type\"],\n\t\t\t\tid: options[\"id\"],\n\t\t\t\ttitle: BX.prop.getString(options, \"title\", \"\"),\n\t\t\t},\n\t\t\tonclick: (btn, e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.onAddButtonClick(btn.getContext());\n\t\t\t},\n\t\t});\n\n\t\treturn Tag.render`<div class=\"crm-dups-item-add-btn\">${btn.render()}</div>`;\n\t}\n\n\tonAddButtonClick(context)\n\t{\n\t\tif (this.clientSearchBox)\n\t\t{\n\t\t\tEventEmitter.emit(this.clientSearchBox, 'onSelectEntityExternal', context);\n\t\t}\n\t\tthis.close();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new SummaryList();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nexport {\n\tSummaryList\n};\n"],"names":["ItemInfo","phone","email","entityTypeName","entityId","entityTypeTitle","entityTitle","isMy","entityUrl","relatedEntityTitle","communications","values","value","communicationType","indexOf","push","list","i","length","SummaryList","setEventNamespace","id","popupId","settings","anchor","wrapper","clientSearchBox","enableEntitySelect","items","padding","BX","type","isNotEmptyString","util","getRandomString","Type","isPlainObject","prop","getElementNode","get","getBoolean","getInteger","popup","PopupManager","create","cacheable","contentPadding","content","getLayout","closeIcon","top","right","closeByEsc","background","animation","closeAnimationType","showClassName","closeClassName","adjustPosition","bind","window","subscribe","emit","event","target","getZIndexComponent","getZIndex","setZIndex","show","controller","CrmDupController","getController","getEntityTypeName","getDuplicateData","groupId","isStringFilled","getGroup","groupData","hasOwnProperty","group","title","getSummaryTitle","result","groups","data","totalItemCount","isArray","groupInfo","getGroupSummaryTitle","entityTypeIdMap","item","entities","j","entity","entityTypeId","getEntityTypeId","CrmEntityType","isDefined","resolveName","getEntityId","needAdd","isExists","prepareItemInfo","Loc","getMessage","parseInt","itemInfo","getCaption","getString","enumeration","company","addPhones","getArray","addEmails","toPlainObject","needDots","forEach","layoutData","getLayoutData","Tag","render","Text","encode","map","renderItemDetails","getPopupById","isShown","isDomNode","wrapperRect","getBoundingClientRect","itemRect","viewRect","document","documentElement","viewTop","viewBottom","height","offsetLeft","left","width","popupHeight","getPopupContainer","clientHeight","popupVerticalPosition","angleOffset","itemVerticalCenter","bottom","verticalOffset","setBindElement","setAngle","position","offset","setTimeout","close","unbind","context","EventEmitter","self","initialize","bodyStyles","getComputedStyle","body","getPropertyValue","options","getTargetEntityTypeName","btn","Button","round","color","Color","LIGHT_BORDER","size","Size","EXTRA_SMALL","text","onclick","e","stopPropagation","onAddButtonClick","getContext"],"mappings":"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"}