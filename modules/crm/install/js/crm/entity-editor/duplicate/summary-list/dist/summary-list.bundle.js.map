{"version":3,"file":"summary-list.bundle.js","sources":["../src/summary-list.js"],"sourcesContent":["import {Type, Text, Tag, Loc, bind, unbind} from \"main.core\";\nimport {EventEmitter} from 'main.core.events';\nimport {PopupManager} from \"main.popup\";\nimport {Button} from 'ui.buttons';\nimport 'ui.design-tokens';\nimport 'ui.tooltip';\nimport 'ui.hint';\n\nimport \"./summary-list.css\"\n\ntype Settings = {\n\tcontroller: Object;\n\tanchor: Object;\n\twrapper: Object;\n\tclientSearchBox: Object;\n};\n\ntype Responsible = {\n\tid: number;\n\tfullName: string;\n\tprofileUrl: string;\n\tphotoUrl: string;\n};\n\ntype Communications = {\n\tphone: string[],\n\temail: string[],\n};\n\ntype MatchIndex = {\n\tphone: number[],\n\temail: number[],\n};\n\nclass ItemInfo\n{\n\t#entityTypeName: \"\";\n\t#entityId: 0;\n\t#entityTypeTitle: \"\";\n\t#entityTitle: \"\";\n\t#isMy: false;\n\t#isHidden: false;\n\t#entityUrl: \"\";\n\t#relatedEntityTitle = \"\";\n\t#responsible: Responsible;\n\t#communications: Communications;\n\t#matchIndex: MatchIndex;\n\n\tconstructor()\n\t{\n\t\tthis.#communications = {\n\t\t\tphone: [],\n\t\t\temail: [],\n\t\t};\n\n\t\tthis.#matchIndex = {\n\t\t\tphone: [],\n\t\t\temail: [],\n\t\t};\n\n\t\tthis.#responsible = {\n\t\t\tid: 0,\n\t\t\tfullName: \"\",\n\t\t\tprofileUrl: \"\",\n\t\t\tphotoUrl: \"\",\n\t\t};\n\t}\n\n\ttoPlainObject()\n\t{\n\t\treturn {\n\t\t\tentityTypeName: this.#entityTypeName,\n\t\t\tentityId: this.#entityId,\n\t\t\tentityTypeTitle: this.#entityTypeTitle,\n\t\t\tentityTitle: this.#entityTitle,\n\t\t\tisMy: this.#isMy,\n\t\t\tisHidden: this.#isHidden,\n\t\t\tentityUrl: this.#entityUrl,\n\t\t\trelatedEntityTitle: this.#relatedEntityTitle,\n\t\t\tresponsible: this.#responsible,\n\t\t\tcommunications: this.#communications,\n\t\t\tmatchIndex: this.#matchIndex,\n\t\t};\n\t}\n\n\tset entityTypeName(value: string)\n\t{\n\t\tthis.#entityTypeName = value;\n\t}\n\n\tget entityTypeName(): string\n\t{\n\t\treturn this.#entityTypeName;\n\t}\n\n\tset entityId(value: number)\n\t{\n\t\tthis.#entityId = value;\n\t}\n\n\tget entityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tset entityTypeTitle(value: string)\n\t{\n\t\tthis.#entityTypeTitle = value;\n\t}\n\n\tget entityTypeTitle(): string\n\t{\n\t\treturn this.#entityTypeTitle;\n\t}\n\n\tset entityTitle(value: string)\n\t{\n\t\tthis.#entityTitle = value;\n\t}\n\n\tget entityTitle(): string\n\t{\n\t\treturn this.#entityTitle;\n\t}\n\n\tset isMy(value: boolean)\n\t{\n\t\tthis.#isMy = value;\n\t}\n\n\tget isMy(): boolean\n\t{\n\t\treturn this.#isMy;\n\t}\n\n\tset isHidden(value: boolean)\n\t{\n\t\tthis.#isHidden = value;\n\t}\n\n\tget isHidden(): boolean\n\t{\n\t\treturn this.#isHidden;\n\t}\n\n\tset entityUrl(value: string)\n\t{\n\t\tthis.#entityUrl = value;\n\t}\n\n\tget entityUrl(): string\n\t{\n\t\treturn this.#entityUrl;\n\t}\n\n\tset relatedEntityTitle(value: string)\n\t{\n\t\tthis.#relatedEntityTitle = value;\n\t}\n\n\tget relatedEntityTitle(): string\n\t{\n\t\treturn this.#relatedEntityTitle;\n\t}\n\n\tset responsible(value: Responsible)\n\t{\n\t\tthis.#responsible = value;\n\t}\n\n\tget responsible(): Responsible\n\t{\n\t\treturn this.#responsible;\n\t}\n\n\t#addCommunicationValue(communicationType: string, value: string, isMatched: boolean)\n\t{\n\t\tif (this.#communications[communicationType].indexOf(value) < 0)\n\t\t{\n\t\t\tif (isMatched)\n\t\t\t{\n\t\t\t\tthis.#matchIndex[communicationType].push(this.#communications[communicationType].length);\n\t\t\t}\n\t\t\tthis.#communications[communicationType].push(value);\n\t\t}\n\t}\n\n\t#addCommunicationList(communicationType: string, list: Array, matchIndex: Array)\n\t{\n\t\tfor (let i = 0; i < list.length; i++)\n\t\t{\n\t\t\tthis.#addCommunicationValue(communicationType, list[i], matchIndex.includes(i.toString()));\n\t\t}\n\t}\n\n\taddPhones(values: Array, matchIndex: Object)\n\t{\n\t\tconst matchIndexPhone = BX.prop.getArray(matchIndex, \"PHONE\", []);\n\t\tthis.#addCommunicationList(\"phone\", values, matchIndexPhone);\n\t}\n\n\taddEmails(values: Array, matchIndex: Object)\n\t{\n\t\tconst matchIndexEmail = BX.prop.getArray(matchIndex, \"EMAIL\", []);\n\t\tthis.#addCommunicationList(\"email\", values, matchIndexEmail);\n\t}\n}\n\nclass SummaryList extends EventEmitter\n{\n\t#handleWindowResize: Function | null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('crm.entity-editor.summary-list.close')\n\n\t\tthis.id = '';\n\t\tthis.popupId = '';\n\t\tthis.settings = {};\n\t\tthis.anchor = null;\n\t\tthis.wrapper = null;\n\t\tthis.clientSearchBox = null;\n\t\tthis.enableEntitySelect = false;\n\t\tthis.items = [];\n\t\tthis.padding = 0;\n\t\tthis.#handleWindowResize = null;\n\t}\n\n\tinitialize(id: string, settings: Settings)\n\t{\n\t\tthis.id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis.popupId = this.id + \"_popup\";\n\n\t\tif (Type.isPlainObject(settings))\n\t\t{\n\t\t\tthis.settings = settings;\n\t\t\tthis.anchor = BX.prop.getElementNode(settings, \"anchor\", null);\n\t\t\tthis.wrapper = BX.prop.getElementNode(settings, \"wrapper\", null);\n\t\t\tthis.clientSearchBox = BX.prop.get(settings, \"clientSearchBox\", null);\n\t\t\tthis.enableEntitySelect = BX.prop.getBoolean(settings, \"enableEntitySelect\", false);\n\t\t}\n\n\t\tthis.padding = BX.prop.getInteger(settings, 'padding', 11);\n\t}\n\n\tshow()\n\t{\n\t\tconst popup = PopupManager.create({\n\t\t\tid: this.popupId,\n\t\t\tcacheable: false,\n\t\t\tpadding: this.padding,\n\t\t\tcontentPadding: 0,\n\t\t\tcontent: this.getLayout(),\n\t\t\tcloseIcon: {\n\t\t\t\ttop: '11px',\n\t\t\t\tright: '5px',\n\t\t\t},\n\t\t\tborderRadius: '12px',\n\t\t\tcloseByEsc: false,\n\t\t\tbackground: this.#getPopupBackgroundColor(),\n\t\t\tanimation: {\n\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\tshowClassName: 'crm-dups-popup-open',\n\t\t\t\tcloseClassName: 'crm-dups-popup-close',\n\t\t\t}\n\t\t});\n\n\t\tif (!this.#handleWindowResize)\n\t\t{\n\t\t\tthis.#handleWindowResize = this.adjustPosition.bind(this);\n\n\t\t\tbind(window, 'resize', this.#handleWindowResize);\n\t\t}\n\n\t\tpopup.subscribe('onDestroy', () => {\n\t\t\tthis.emit('close', this);\n\t\t});\n\n\t\tpopup.subscribe(\"onFirstShow\", (event) => {\n\t\t\tevent.target.getZIndexComponent().subscribe(\"onZIndexChange\", (event) => {\n\t\t\t\tif (event.target.getZIndex() !== 850)\n\t\t\t\t{\n\t\t\t\t\tevent.target.setZIndex(850);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tpopup.show();\n\t\tthis.adjustPosition();\n\t}\n\n\tgetController()\n\t{\n\t\tconst controller = BX.prop.get(this.settings, \"controller\", null);\n\n\t\treturn (controller instanceof BX.CrmDupController) ? controller : null;\n\t}\n\n\tgetTargetEntityTypeName()\n\t{\n\t\tconst controller = this.getController();\n\n\t\treturn controller ? controller.getEntityTypeName() : \"\";\n\t}\n\n\tgetDuplicateData()\n\t{\n\t\tconst controller = this.getController();\n\n\t\treturn controller ? controller.getDuplicateData() : {};\n\t}\n\n\tgetGroup(groupId)\n\t{\n\t\tconst controller = Type.isStringFilled(groupId) ? this.getController() : null;\n\n\t\treturn controller ? controller.getGroup(groupId) : null;\n\t}\n\n\tgetGroupSummaryTitle(groupId, groupData)\n\t{\n\t\tif (\n\t\t\tType.isPlainObject(groupData)\n\t\t\t&& groupData.hasOwnProperty(\"totalText\")\n\t\t\t&& Type.isStringFilled(groupData['totalText'])\n\t\t)\n\t\t{\n\t\t\tconst group = this.getGroup(groupId);\n\t\t\tconst title = group ? group.getSummaryTitle() : \"\";\n\t\t\tif (Type.isStringFilled(title))\n\t\t\t{\n\t\t\t\treturn groupData['totalText'] + \" \" + title;\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\tgetLayoutData()\n\t{\n\t\tconst result = {\n\t\t\ttitle: \"\",\n\t\t\tgroups: []\n\t\t};\n\n\t\tconst data = this.getDuplicateData();\n\t\tlet totalItemCount = 0;\n\t\tfor (const groupId in data)\n\t\t{\n\t\t\tif (!data.hasOwnProperty(groupId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst groupData = Type.isPlainObject(data[groupId]) ? data[groupId] : {};\n\t\t\tconst items = Type.isArray(groupData[\"items\"]) ? groupData[\"items\"] : [];\n\n\t\t\tconst groupInfo = {\n\t\t\t\ttitle: this.getGroupSummaryTitle(groupId, groupData),\n\t\t\t\titems: []\n\t\t\t};\n\n\t\t\tconst entityTypeIdMap = [];\n\t\t\tfor (let i = 0; i < items.length; i++)\n\t\t\t{\n\t\t\t\tconst item = items[i];\n\t\t\t\tconst entities = Type.isArray(item[\"ENTITIES\"]) ? item[\"ENTITIES\"] : [];\n\t\t\t\tfor (let j = 0; j < entities.length; j++)\n\t\t\t\t{\n\t\t\t\t\tconst entity = entities[j];\n\t\t\t\t\tconst entityTypeId = this.getEntityTypeId(entity);\n\t\t\t\t\tif (!BX.CrmEntityType.isDefined(entityTypeId))\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst entityTypeName = BX.CrmEntityType.resolveName(entityTypeId);\n\t\t\t\t\tconst entityId = this.getEntityId(entity);\n\n\t\t\t\t\tlet needAdd = false;\n\n\t\t\t\t\tif (!entityTypeIdMap.hasOwnProperty(entityTypeName))\n\t\t\t\t\t{\n\t\t\t\t\t\tentityTypeIdMap[entityTypeName] = [entityId];\n\t\t\t\t\t\tneedAdd = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst isExists = (entityTypeIdMap[entityTypeName].indexOf(entityId) >= 0);\n\t\t\t\t\t\tif (!isExists)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentityTypeIdMap[entityTypeName].push(entityId);\n\t\t\t\t\t\t\tneedAdd = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needAdd)\n\t\t\t\t\t{\n\t\t\t\t\t\tgroupInfo.items.push(this.prepareItemInfo(entity));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (groupInfo.items.length > 0)\n\t\t\t{\n\t\t\t\ttotalItemCount += groupInfo.items.length;\n\t\t\t\tresult.groups.push(groupInfo);\n\t\t\t}\n\t\t}\n\n\t\tresult.title = Loc.getMessage(\n\t\t\t\"DUPLICATE_SUMMARY_LIST_TOTAL_COUNT_TITLE\",\n\t\t\t{ \"#COUNT#\": totalItemCount }\n\t\t);\n\n\t\treturn result;\n\t}\n\n\tgetEntityTypeId(entity: Object)\n\t{\n\t\treturn Type.isStringFilled(entity[\"ENTITY_TYPE_ID\"]) ? parseInt(entity[\"ENTITY_TYPE_ID\"]) : 0;\n\t}\n\n\tgetEntityId(entity: Object)\n\t{\n\t\treturn Type.isStringFilled(entity[\"ENTITY_ID\"]) ? parseInt(entity[\"ENTITY_ID\"]) : 0;\n\t}\n\n\tprepareItemInfo(entity: Object): Object\n\t{\n\t\tconst itemInfo = new ItemInfo();\n\n\t\tconst entityTypeId = this.getEntityTypeId(entity);\n\t\titemInfo.entityTypeName = BX.CrmEntityType.resolveName(entityTypeId)\n\t\titemInfo.entityId = this.getEntityId(entity);\n\t\titemInfo.entityTypeTitle = BX.prop.getString(entity, 'CATEGORY_NAME', BX.CrmEntityType.getCaption(entityTypeId));\n\t\titemInfo.entityTitle = BX.prop.getString(entity, \"TITLE\", \"\");\n\t\titemInfo.isMy = (\n\t\t\tentityTypeId === BX.CrmEntityType.enumeration.company\n\t\t\t&& BX.prop.getString(entity, \"IS_MY_COMPANY\", \"\") === \"Y\"\n\t\t);\n\t\titemInfo.isHidden = (BX.prop.getString(entity, \"IS_HIDDEN\", \"\") === \"Y\");\n\t\titemInfo.entityUrl = BX.prop.getString(entity, \"URL\", \"\");\n\t\titemInfo.responsible = {\n\t\t\tid: BX.prop.getInteger(entity, \"RESPONSIBLE_ID\", 0),\n\t\t\tfullName: BX.prop.getString(entity, \"RESPONSIBLE_FULL_NAME\", \"\"),\n\t\t\tprofileUrl: BX.prop.getString(entity, \"RESPONSIBLE_URL\", \"#\"),\n\t\t\tphotoUrl: BX.prop.getString(entity, \"RESPONSIBLE_PHOTO_URL\", \"#\"),\n\t\t};\n\t\tconst matchIndex = BX.prop.getObject(entity, \"MATCH_INDEX\", { PHONE: [], EMAIL: [] });\n\t\titemInfo.addPhones(BX.prop.getArray(entity, \"PHONE\", []), matchIndex);\n\t\titemInfo.addEmails(BX.prop.getArray(entity, \"EMAIL\", []), matchIndex);\n\n\t\treturn itemInfo.toPlainObject();\n\t}\n\n\trenderItemDetails(item: Object): string\n\t{\n\t\tlet content = \"\";\n\n\t\tconst communications = item[\"communications\"];\n\t\tconst matchIndex = BX.prop.getObject(item, \"matchIndex\", {phone: [], email: []});\n\n\t\t[\"phone\", \"email\"].forEach((type) => {\n\t\t\tconst maxItems = 5;\n\t\t\tlet needDots = false;\n\n\t\t\tif (!needDots && communications[type].length > maxItems)\n\t\t\t{\n\t\t\t\tneedDots = true;\n\t\t\t}\n\t\t\tif (communications[type].length > 0)\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < communications[type].length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (i >= maxItems)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (content.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent += \", \";\n\t\t\t\t\t}\n\t\t\t\t\tconst isMatched = (matchIndex[type].includes(i));\n\t\t\t\t\tconst value = Text.encode(communications[type][i]);\n\t\t\t\t\tcontent += (\n\t\t\t\t\t\tisMatched\n\t\t\t\t\t\t\t? \"<span class=\\\"crm-dups-item-details-matched\\\">\" + value + \"</span>\"\n\t\t\t\t\t\t\t: value\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (needDots)\n\t\t\t\t{\n\t\t\t\t\tcontent += \", ...\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn content;\n\t}\n\n\trenderHiddenItem(item: Object): string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-dups-item\">\n\t\t\t\t<div class=\"crm-dups-item-top\">\n\t\t\t\t\t<div class=\"crm-dups-item-header\">\n\t\t\t\t\t\t<div class=\"crm-dups-item-type\">${Text.encode(item[\"entityTypeTitle\"])}</div>\n\t\t\t\t\t\t<span class=\"crm-dups-item-title-hidden\">${Text.encode(item[\"entityTitle\"])}</span>\n\t\t\t\t\t\t<div class=\"crm-dups-item-rel-title hidden\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-dups-item-photo bx-ui-tooltip-photo\">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass=\"bx-ui-tooltip-info-data-photo no-photo\"\n\t\t\t\t\t\t\tstyle=\"width: 20px; height: 20px;\"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-dups-item-details\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderVisibleItem(item: Object): string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-dups-item\">\n\t\t\t\t<div class=\"crm-dups-item-top\">\n\t\t\t\t\t<div class=\"crm-dups-item-header\">\n\t\t\t\t\t\t<div class=\"crm-dups-item-type\">${Text.encode(item[\"entityTypeTitle\"])}</div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"${Text.encode(item[\"entityUrl\"])}\"\n\t\t\t\t\t\t\tclass=\"crm-dups-item-title\">${Text.encode(item[\"entityTitle\"])}</a>\n\t\t\t\t\t\t<div class=\"crm-dups-item-rel-title hidden\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#renderResponsible(item[\"responsible\"])}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-dups-item-details\">\n\t\t\t\t\t${this.renderItemDetails(item)}\n\t\t\t\t</div>\n\t\t\t\t\t${this.#renderAddButton({\n\t\t\t\t\t\t\"type\": item[\"entityTypeName\"],\n\t\t\t\t\t\t\"id\": item[\"entityId\"],\n\t\t\t\t\t\t\"title\": item[\"entityTitle\"],\n\t\t\t\t\t\t\"isMy\": item[\"isMy\"]\n\t\t\t\t\t})}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderItem(item: Object): string\n\t{\n\t\treturn item[\"isHidden\"] ? this.renderHiddenItem(item) : this.renderVisibleItem(item);\n\t}\n\n\tgetLayout()\n\t{\n\t\tconst layoutData = this.getLayoutData();\n\n\t\tif (!(Type.isStringFilled(layoutData[\"title\"]) && Type.isArrayFilled(layoutData[\"groups\"])))\n\t\t{\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-dups-wrapper\">\n\t\t\t\t<div class=\"crm-dups-header\">${Text.encode(layoutData[\"title\"])}</div>\n\t\t\t\t<div class=\"crm-dups-list\">${layoutData[\"groups\"].map((group) => Tag.render`\n\t\t\t\t\t<div class=\"crm-dups-group\">\n\t\t\t\t\t\t<div class=\"crm-dups-group-header\">${Text.encode(group[\"title\"])}</div>\n\t\t\t\t\t\t<div class=\"crm-dups-group-items\">${group[\"items\"].map((item) => Tag.render`\n\t\t\t\t\t\t\t${this.renderItem(item)}\n\t\t\t\t\t\t`)}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`)}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tadjustPosition()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\tif (\n\t\t\t!popup\n\t\t\t|| !popup.isShown()\n\t\t\t|| !Type.isDomNode(this.anchor)\n\t\t\t|| !Type.isDomNode(this.wrapper)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst wrapperRect = this.wrapper.getBoundingClientRect();\n\t\tconst itemRect = this.anchor.getBoundingClientRect();\n\t\tconst viewRect = document.documentElement.getBoundingClientRect();\n\t\tconst viewTop = - viewRect.top;\n\t\tconst viewBottom = viewRect.height - viewRect.top;\n\t\tconst offsetLeft = -viewRect.left + wrapperRect.left + wrapperRect.width + this.padding;\n\t\tconst popupHeight = popup.getPopupContainer().clientHeight;\n\n\t\tlet popupVerticalPosition;\n\t\tlet angleOffset;\n\t\tconst itemVerticalCenter = viewTop + itemRect.top + itemRect.height / 2;\n\t\tif (itemVerticalCenter < viewTop)\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop + itemRect.top - this.padding;\n\t\t\tangleOffset = this.padding + itemRect.height / 2;\n\t\t}\n\t\telse if (itemVerticalCenter > viewBottom)\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop + itemRect.bottom + this.padding - popupHeight;\n\t\t\tangleOffset = popupHeight - this.padding - itemRect.height / 2;\n\t\t}\n\t\telse if (popupHeight < viewRect.height)\n\t\t{\n\t\t\tlet verticalOffset = 0;\n\t\t\tpopupVerticalPosition = itemVerticalCenter - popupHeight / 2;\n\t\t\tif (popupVerticalPosition < viewTop)\n\t\t\t{\n\t\t\t\tverticalOffset = viewTop - popupVerticalPosition\n\t\t\t}\n\t\t\telse if (viewBottom < popupVerticalPosition + popupHeight)\n\t\t\t{\n\t\t\t\tverticalOffset = viewBottom - popupVerticalPosition - popupHeight;\n\t\t\t}\n\t\t\tpopupVerticalPosition += verticalOffset;\n\t\t\tangleOffset = itemVerticalCenter - popupVerticalPosition;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopupVerticalPosition = viewTop;\n\t\t\tangleOffset = itemVerticalCenter - popupVerticalPosition;\n\t\t\tif (angleOffset < 0)\n\t\t\t{\n\t\t\t\tangleOffset += popupHeight;\n\t\t\t}\n\t\t}\n\t\tangleOffset -= this.padding;\n\n\t\tpopup.setBindElement({left: offsetLeft, top: popupVerticalPosition});\n\t\tpopup.setAngle({position: \"left\", offset: angleOffset});\n\t\tpopup.adjustPosition();\n\t\tsetTimeout(() => popup.getZIndexComponent().setZIndex(850), 0);\n\t}\n\n\tisShown()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\treturn popup && popup.isShown();\n\t}\n\n\tclose()\n\t{\n\t\tconst popup = PopupManager.getPopupById(this.popupId);\n\t\tpopup ? popup.close() : null;\n\t\tunbind(document, 'resize', this.#handleWindowResize);\n\t\tthis.#handleWindowResize = null;\n\t}\n\n\t#getPopupBackgroundColor(): string\n\t{\n\t\tconst bodyStyles = getComputedStyle(document.body);\n\t\treturn bodyStyles?.getPropertyValue(\"--ui-color-background-primary\") || '#FFFFFF';\n\t}\n\n\t#renderResponsible(options): HTMLElement|string\n\t{\n\t\tconst isPhoto = (Type.isStringFilled(options[\"photoUrl\"]) && options[\"photoUrl\"] !== \"#\");\n\t\tconst noPhotoClass = isPhoto ? \"\" : \" no-photo\";\n\t\tconst backgroundStyle =\n\t\t\tisPhoto\n\t\t\t\t? ` background: url('${Text.encode(options[\"photoUrl\"])}') no-repeat center; background-size: cover;`\n\t\t\t\t: \"\"\n\t\t;\n\t\tconst responsibleContainer = Tag.render`<div class=\"crm-dups-item-photo bx-ui-tooltip-photo\">\n\t\t\t<a\n\t\t\t\thref=\"${Text.encode(options[\"profileUrl\"])}\"\n\t\t\t\tclass=\"bx-ui-tooltip-info-data-photo${noPhotoClass}\"\n\t\t\t\tstyle=\"width: 20px; height: 20px;${backgroundStyle}\"\n\t\t\t\tdata-hint=\"${Text.encode(options[\"fullName\"])}\"\n\t\t\t\tdata-hint-no-icon\n\t\t\t></a>\n\t\t</div>`;\n\t\tBX.UI.Hint.popupParameters = {\n\t\t\tpadding: 10,\n\t\t};\n\n\t\tBX.UI.Hint.init(responsibleContainer);\n\n\t\treturn responsibleContainer;\n\t}\n\n\t#renderAddButton(options): HTMLElement|string\n\t{\n\t\tif (\n\t\t\t!this.enableEntitySelect\n\t\t\t|| (\n\t\t\t\toptions.hasOwnProperty(\"isMy\")\n\t\t\t\t&& options[\"isMy\"]\n\t\t\t)\n\t\t\t|| (\n\t\t\t\tType.isPlainObject(options)\n\t\t\t\t&& options.hasOwnProperty(\"type\")\n\t\t\t\t&& options[\"type\"] !== this.getTargetEntityTypeName()\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn \"\";\n\t\t}\n\n\t\tconst btn = new Button({\n\t\t\tround: true,\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\ttext: Loc.getMessage('DUPLICATE_SUMMARY_LIST_ITEM_ADD_BUTTON'),\n\t\t\tcontext: {\n\t\t\t\ttype: options[\"type\"],\n\t\t\t\tid: options[\"id\"],\n\t\t\t\ttitle: BX.prop.getString(options, \"title\", \"\"),\n\t\t\t},\n\t\t\tonclick: (btn, e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.onAddButtonClick(btn.getContext());\n\t\t\t},\n\t\t});\n\n\t\treturn Tag.render`<div class=\"crm-dups-item-add-btn\">${btn.render()}</div>`;\n\t}\n\n\tonAddButtonClick(context)\n\t{\n\t\tif (this.clientSearchBox)\n\t\t{\n\t\t\tEventEmitter.emit(this.clientSearchBox, 'onSelectEntityExternal', context);\n\t\t}\n\t\tthis.close();\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new SummaryList();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}\n\nexport {\n\tSummaryList\n};\n"],"names":["ItemInfo","phone","email","id","fullName","profileUrl","photoUrl","entityTypeName","entityId","entityTypeTitle","entityTitle","isMy","isHidden","entityUrl","relatedEntityTitle","responsible","communications","matchIndex","values","matchIndexPhone","BX","prop","getArray","matchIndexEmail","value","communicationType","isMatched","indexOf","push","length","list","i","includes","toString","SummaryList","setEventNamespace","popupId","settings","anchor","wrapper","clientSearchBox","enableEntitySelect","items","padding","type","isNotEmptyString","util","getRandomString","Type","isPlainObject","getElementNode","get","getBoolean","getInteger","popup","PopupManager","create","cacheable","contentPadding","content","getLayout","closeIcon","top","right","borderRadius","closeByEsc","background","animation","closeAnimationType","showClassName","closeClassName","adjustPosition","bind","window","subscribe","emit","event","target","getZIndexComponent","getZIndex","setZIndex","show","controller","CrmDupController","getController","getEntityTypeName","getDuplicateData","groupId","isStringFilled","getGroup","groupData","hasOwnProperty","group","title","getSummaryTitle","result","groups","data","totalItemCount","isArray","groupInfo","getGroupSummaryTitle","entityTypeIdMap","item","entities","j","entity","entityTypeId","getEntityTypeId","CrmEntityType","isDefined","resolveName","getEntityId","needAdd","isExists","prepareItemInfo","Loc","getMessage","parseInt","itemInfo","getString","getCaption","enumeration","company","getObject","PHONE","EMAIL","addPhones","addEmails","toPlainObject","forEach","maxItems","needDots","Text","encode","Tag","render","renderItemDetails","renderHiddenItem","renderVisibleItem","layoutData","getLayoutData","isArrayFilled","map","renderItem","getPopupById","isShown","isDomNode","wrapperRect","getBoundingClientRect","itemRect","viewRect","document","documentElement","viewTop","viewBottom","height","offsetLeft","left","width","popupHeight","getPopupContainer","clientHeight","popupVerticalPosition","angleOffset","itemVerticalCenter","bottom","verticalOffset","setBindElement","setAngle","position","offset","setTimeout","close","unbind","context","EventEmitter","self","initialize","bodyStyles","getComputedStyle","body","getPropertyValue","options","isPhoto","noPhotoClass","backgroundStyle","responsibleContainer","UI","Hint","popupParameters","init","getTargetEntityTypeName","btn","Button","round","color","Color","LIGHT_BORDER","size","Size","EXTRA_SMALL","text","onclick","e","stopPropagation","onAddButtonClick","getContext"],"mappings":"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"}