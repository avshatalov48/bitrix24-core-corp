this.BX=this.BX||{};(function(e,t){"use strict";var r=function(){function e(r,a){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"deleted",false);babelHelpers.defineProperty(this,"progress",false);this.data={};if(t.Type.isPlainObject(r)){this.data=r}this.getParameters={add:{},get:{},update:{},delete:{}};if(t.Type.isPlainObject(a)){this.getParameters=a.getParameters}}babelHelpers.createClass(e,[{key:"compileActionString",value:function e(t){return"crm.api."+this.getModelName()+"."+t}},{key:"getId",value:function e(){return this.data.id}},{key:"getEntityTypeId",value:function e(){return this.data.entityTypeId}},{key:"isSaved",value:function e(){return this.getId()>0}},{key:"isDeleted",value:function e(){return this.deleted}},{key:"setData",value:function e(t){this.data=t;return this}},{key:"getData",value:function e(){return this.data}},{key:"setGetParameters",value:function e(t,r){this.getParameters[t]=r}},{key:"getGetParameters",value:function e(t){return babelHelpers.objectSpread({},{analyticsLabel:"crmModel"+this.getModelName()+t},this.getParameters[t])}},{key:"getModelName",value:function e(){throw new Error('Method "getModelName" should be overridden')}},{key:"setDataFromResponse",value:function e(t){this.setData(t.data[this.getModelName()])}},{key:"load",value:function e(){var r=this;return new Promise(function(e,a){var s=[];if(r.progress){s.push("Another action is in progress");a(s);return}if(!r.isSaved()){s.push("Cant load "+r.getModelName()+" without id");a(s);return}var i=r.actions.get;if(!t.Type.isString(i)||i.length<=0){s.push("Load action is not specified");a(s);return}r.progress=true;t.ajax.runAction(i,{data:{id:r.getId()},getParameters:r.getGetParameters("get")}).then(function(t){r.progress=false;r.setDataFromResponse(t);e(t)}).catch(function(e){r.progress=false;e.errors.forEach(function(e){var t=e.message;s.push(t)});a(s)})})}},{key:"save",value:function e(){var r=this;return new Promise(function(e,a){var s=[];if(r.progress){s.push("Another action is in progress");a(s);return}var i;var n;var o;if(r.isSaved()){i=r.actions.update;n={id:r.getId(),fields:r.getData()};o=r.getGetParameters("update")}else{i=r.actions.add;n={fields:r.getData()};o=r.getGetParameters("add")}if(!t.Type.isString(i)||i.length<=0){s.push("Save action is not specified");a(s);return}r.progress=true;t.ajax.runAction(i,{data:n,getParameters:o}).then(function(t){r.progress=false;r.setDataFromResponse(t);e(t)}).catch(function(e){r.progress=false;s=[].concat(babelHelpers.toConsumableArray(s),babelHelpers.toConsumableArray(r.extractErrorMessages(e)));a(s)})})}},{key:"extractErrorMessages",value:function e(r){var a=r.errors;var s=[];a.forEach(function(e){var r=e.message;if(t.Type.isPlainObject(r)&&r.text){s.push(r.text)}else{s.push(r)}});return s}},{key:"delete",value:function e(){var r=this;return new Promise(function(e,a){var s=[];if(r.progress){s.push("Another action is in progress");a(s);return}if(!r.isSaved()){s.push("Cant delete "+r.getModelName()+" without id");a(s);return}var i=r.actions.delete;if(!t.Type.isString(i)||i.length<=0){s.push("Delete action is not specified");a(s);return}r.progress=true;t.ajax.runAction(i,{data:{id:r.getId()},getParameters:r.getGetParameters("delete")}).then(function(t){r.deleted=true;r.progress=false;e(t)}).catch(function(e){r.progress=false;e.errors.forEach(function(e){var t=e.message;s.push(t)});a(s)})})}},{key:"actions",get:function e(){return{get:this.compileActionString("get"),add:this.compileActionString("add"),update:this.compileActionString("update"),delete:this.compileActionString("delete")}}}]);return e}();e.Model=r})(this.BX.Crm=this.BX.Crm||{},BX);
//# sourceMappingURL=model.bundle.map.js