{"version":3,"file":"tour-manager.bundle.js","sources":["../src/queue.js","../src/tour-manager.js"],"sourcesContent":["import { TourInterface } from './tour.js';\n\nexport default class Queue\n{\n\t#stack: Map<string, TourInterface> = new Map();\n\n\tget(id: string): TourInterface | null\n\t{\n\t\treturn this.#stack.get(id) ?? null;\n\t}\n\n\tpush(tour: TourInterface): void\n\t{\n\t\tthis.#stack.set(tour.getGuide().getId(), tour);\n\t}\n\n\tpop(): TourInterface | null\n\t{\n\t\tconst lastTour = [...this.#stack.values()].pop();\n\t\tif (!lastTour)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.delete(lastTour.getGuide().getId());\n\n\t\treturn lastTour;\n\t}\n\n\tpeek(): TourInterface | null\n\t{\n\t\tconst [firstTour] = this.#stack.values();\n\t\tif (!firstTour)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.delete(firstTour.getGuide().getId());\n\n\t\treturn firstTour;\n\t}\n\n\tdelete(id: string): boolean\n\t{\n\t\treturn this.#stack.delete(id);\n\t}\n\n\tsize(): number\n\t{\n\t\treturn this.#stack.size();\n\t}\n}\n","import { TourInterface } from './tour.js';\nimport { BannerDispatcher } from 'crm.integration.ui.banner-dispatcher';\nimport Queue from './queue.js';\n\nexport class TourManager\n{\n\tstatic TOUR_FINISH_EVENT = 'UI.Tour.Guide:onFinish';\n\n\tstatic instance: ?TourManager = null;\n\t#queue: Queue = new Queue();\n\t#current: ?TourInterface = null;\n\t#bannerDispatcher: BannerDispatcher;\n\n\tstatic getInstance(): TourManager\n\t{\n\t\tif (!TourManager.instance)\n\t\t{\n\t\t\tTourManager.instance = new TourManager();\n\t\t}\n\n\t\treturn TourManager.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#bannerDispatcher = new BannerDispatcher();\n\t}\n\n\tregisterWithLaunch(tour: TourInterface): void\n\t{\n\t\tthis.register(tour);\n\t\tthis.launch();\n\t}\n\n\tlaunch(): void\n\t{\n\t\tif (this.#current || this.#isBannerDispatcherAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#current = this.#queue.peek();\n\t\tthis.#current?.show();\n\t}\n\n\tregister(tour: TourInterface): void\n\t{\n\t\tif (!tour.canShow())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isBannerDispatcherAvailable())\n\t\t{\n\t\t\tthis.#toBannerDispatcherQueue(tour);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#queue.push(tour);\n\t\tthis.#subscribeTourFinish(tour);\n\t}\n\n\t#isBannerDispatcherAvailable(): boolean\n\t{\n\t\treturn this.#bannerDispatcher.isAvailable();\n\t}\n\n\t#toBannerDispatcherQueue(tour: TourInterface): void\n\t{\n\t\tthis.#bannerDispatcher.toQueue((onDone: Function) => {\n\t\t\ttour.getGuide().subscribe(TourManager.TOUR_FINISH_EVENT, onDone);\n\t\t\ttour.show();\n\t\t});\n\t}\n\n\t#subscribeTourFinish(tour: TourInterface): void\n\t{\n\t\ttour.getGuide().subscribe(TourManager.TOUR_FINISH_EVENT, this.#showNextTour.bind(this));\n\t}\n\n\t#showNextTour(): void\n\t{\n\t\tconst nextTour = this.#queue.peek();\n\t\tif (!nextTour)\n\t\t{\n\t\t\tthis.#current = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#current = nextTour;\n\t\tthis.#current.show();\n\t}\n}\n"],"names":["Queue","[object Object]","Object","writable","value","Map","get","id","babelHelpers","push","tour","set","getGuide","getId","pop","lastTour","values","this","delete","peek","firstTour","size","TourManager","instance","constructor","BannerDispatcher","registerWithLaunch","register","launch","_babelHelpers$classPr","show","canShow","isAvailable","toQueue","onDone","subscribe","TOUR_FINISH_EVENT","bind","nextTour"],"mappings":"iDAA0C,sDAE3B,MAAMA,EACrBC,cAAAC,8BAAAC,YAAAC,MACsC,IAAIC,MAEzCC,IAAIC,GACJ,MACC,gBAAOC,mDAAYF,IAAIC,MAAO,KAG/BE,KAAKC,GAEJF,mDAAYG,IAAID,EAAKE,WAAWC,QAASH,GAG1CI,MAEC,MAAMC,EAAW,IAAIP,mDAAYQ,UAAUF,MAC3C,OAAKC,GAKLE,KAAKC,OAAOH,EAASH,WAAWC,SAEzBE,GALC,KAQTI,OAEC,MAAOC,GAAaZ,mDAAYQ,SAChC,OAAKI,GAKLH,KAAKC,OAAOE,EAAUR,WAAWC,SAE1BO,GALC,KAQTF,OAAOX,GAEN,OAAOC,mDAAYU,OAAOX,GAG3Bc,OAEC,OAAOb,mDAAYa,obC7Cd,MAAMC,EASZrB,qBAOC,OALKqB,EAAYC,WAEhBD,EAAYC,SAAW,IAAID,GAGrBA,EAAYC,SAGpBC,cACAtB,8BAAAE,UAAAF,8BAAAE,UAAAF,8BAAAE,UAAAF,8BAAAE,UAAAF,8BAAAC,YAAAC,MAfgB,IAAIJ,IAAOE,8BAAAC,YAAAC,MACA,OAAIF,8BAAAC,YAAAC,eAe9BI,mDAAyB,IAAIiB,mBAG9BC,mBAAmBhB,GAElBO,KAAKU,SAASjB,GACdO,KAAKW,SAGNA,SACA,MACKpB,4FAAiBS,eAKrBT,mDAAgBA,mDAAYW,qEAC5BU,EAAeC,QAGhBH,SAASjB,GAEHA,EAAKqB,oDAKNd,aAEHT,mDAA8BE,IAK/BF,mDAAYC,KAAKC,GACjBF,mDAA0BE,MAkC3B,aA7BC,OAAOF,mDAAuBwB,cAC9B,WAEwBtB,GAExBF,mDAAuByB,QAASC,IAC/BxB,EAAKE,WAAWuB,UAAUb,EAAYc,kBAAmBF,GACzDxB,EAAKoB,SAEN,WAEoBpB,GAEpBA,EAAKE,WAAWuB,UAAUb,EAAYc,kBAAmB5B,mDAAmB6B,KAAKpB,OACjF,aAIA,MAAMqB,EAAW9B,mDAAYW,OACxBmB,GAOL9B,mDAAgB8B,EAChB9B,mDAAcsB,QANbtB,mDAAgB,KAlFNc,EAELc,kBAAoB,yBAFfd,EAILC,SAAyB"}