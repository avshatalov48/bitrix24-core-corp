this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,s,a,l,n,o,r,c,d,p){"use strict";const u={itemClick:"crm:copilot:call-assessment:breadcrumb-item-click"};const _={props:{activeTabId:{type:String}},data(){return{tabs:this.getTabsData()}},methods:{itemTitleClassList(t,e){return["crm-copilot__call-assessment_breadcrumbs-item-title",{"--active":t===this.activeTabId},{"--soon":e}]},getTab(t){return this.getTabsData().find((e=>e.id===t))},getTabsData(){return[{id:"about",title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT")},{id:"client",title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT")},{id:"settings",title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS")},{id:"control",title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL")}]},emitClickEvent(t){const e=this.getTab(t);if(!e.soon){this.$Bitrix.eventEmitter.emit(u.itemClick,{itemId:t})}}},computed:{soonTitle(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_BREADCRUMBS_SOON")}},template:`\n\t\t<div class="crm-copilot__call-assessment_breadcrumbs-wrapper">\n\t\t\t<div\n\t\t\t\tv-for="(tab, index) in tabs"\n\t\t\t\t@click="emitClickEvent(tab.id)"\n\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-item"\n\t\t\t>\n\t\t\t\t<span v-if="tab.soon" class="crm-copilot__call-assessment_breadcrumbs-soon">\n\t\t\t\t\t{{ soonTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span :class="itemTitleClassList(tab.id, tab.soon)">\n\t\t\t\t\t{{ tab.title }}\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-if="index+1 < tabs.length"\n\t\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-divider"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t</div>\n\t`};const h={click:"crm:copilot:call-assessment:navigation-button-click"};const v={props:{id:{type:String,required:true},isEnabled:{type:Boolean,default:true}},mounted(){this.initButton()},watch:{isEnabled(t){this.button.setState(t?s.ButtonState.ACTIVE:s.ButtonState.DISABLED)}},methods:{initButton(){this.button=new s.Button({text:d.Loc.getMessage(`CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_BUTTON_${this.id.toUpperCase()}`),color:this.buttonColor,round:true,size:BX.UI.Button.Size.LARGE,onclick:()=>{this.emitClickEvent()}});if(this.isEnabled!==true){this.button.setState(s.ButtonState.DISABLED)}this.button.setDataSet({id:`crm-copilot-call-assessment-buttons-${this.id.toLowerCase()}`});if(this.$refs.button){this.button.renderTo(this.$refs.button)}},emitClickEvent(){if(this.isEnabled){this.$Bitrix.eventEmitter.emit(h.click,{id:this.id})}}},computed:{buttonColor(){if(this.id==="continue"||this.id==="submit"||this.id==="close"){return s.Button.Color.SUCCESS}if(this.id==="update"){return s.Button.Color.LIGHT_BORDER}return s.Button.Color.LIGHT}},template:`\n\t\t<div ref="button" class="crm-copilot-call-assessment-button"></div>\n\t`};const g="23240682";const b={components:{Button:v},props:{activeTabId:{type:String},isEnabled:{type:Boolean},readOnly:{type:Boolean,default:false},showSaveButton:{type:Boolean,default:false}},data(){return{firstPage:"about",lastPage:"control"}},computed:{help(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_HELP")},buttons(){return["cancel","back","continue","submit","close","update"]}},methods:{showArticle(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${g}`)}},template:`\n\t\t<div class="crm-copilot__call-assessment_navigation-container">\n\t\t\t<div class="crm-copilot__call-assessment_navigation-buttons-wrapper">\n\t\t\t\t<Button v-if="activeTabId !== lastPage" id="continue" :is-enabled="isEnabled" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && !readOnly" id="submit" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && readOnly" id="close" />\n\t\t\t\t<Button v-if="activeTabId === firstPage" id="cancel" />\n\t\t\t\t<Button v-if="activeTabId !== firstPage" id="back" />\n\t\t\t</div>\n\t\t\t<div v-if="showSaveButton && activeTabId !== lastPage">\n\t\t\t\t<Button id="update" :is-enabled="isEnabled" />\n\t\t\t</div>\n\t\t\t<div v-else class="crm-copilot__call-assessment_article" @click="showArticle">\n\t\t\t\t<span class="ui-icon-set --help"></span>\n\t\t\t\t{{ help }}\n\t\t\t</div>\n\t\t</div>\n\t`};const L={components:{TextEditorComponent:l.TextEditorComponent},emits:["change"],props:{textEditor:l.TextEditor},data(){return{textEditorEvents:{onChange:this.emitChangeData}}},mounted(){this.setTextEditorHeight();this.windowResizeHandler=this.windowResizeHandler.bind(this);d.Event.bind(window,"resize",this.windowResizeHandler)},unmounted(){d.Event.unbind(window,"resize",this.windowResizeHandler)},methods:{emitChangeData(){if(!d.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=d.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("change",{prompt:this.textEditor.getText()})},windowResizeHandler(){this.setTextEditorHeight()},setTextEditorHeight(){var t,e,i;const s=this.$el.parentNode.offsetTop;const a=".crm-copilot__call-assessment_navigation-container";const l=(t=(e=document.querySelector(a))==null?void 0:e.offsetTop)!=null?t:0;const n=20;const o=l-s-n;const r=Math.round(o*.5);const c=Math.round(o*.8);if(r<200){var d;(d=this.textEditor)==null?void 0:d.setMinHeight(c)}else{var p;(p=this.textEditor)==null?void 0:p.setMinHeight(r)}(i=this.textEditor)==null?void 0:i.setMaxHeight(c)}},template:`\n\t\t<TextEditorComponent \n\t\t\t:events="textEditorEvents"\n\t\t\t:editor-instance="textEditor"\n\t\t/>\n\t`};const T={MIN:100,MAX:5e3};var E=babelHelpers.classPrivateFieldLooseKey("errorMessage");class C{constructor(){Object.defineProperty(this,E,{writable:true,value:null})}validate(t){if(t.length<T.MIN){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MIN_ERROR",{"#MIN_VALUE#":T.MIN});return false}if(t.length>T.MAX){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MAX_ERROR",{"#MAX_VALUE#":T.MAX});return false}babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}}const m={methods:{showLimitCopilotOffSlider(){var t,e;(t=top.BX.UI)==null?void 0:(e=t.InfoHelper)==null?void 0:e.show("limit_v2_crm_copilot_call_assessment_off")}},computed:{message(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AI_DISABLED")}},template:`\n\t\t<div class="crm-copilot__call-assessment-ai-disabled">\n\t\t\t<span v-html="message"></span>\n\t\t\t<span\n\t\t\t\t@click="showLimitCopilotOffSlider"\n\t\t\t\tclass="ui-icon-set --help"\n\t\t\t></span>\n\t\t</div>\n\t`};const S={components:{Breadcrumbs:_,AiDisabledInSettings:m},props:{readOnly:{type:Boolean,default:false},isEnabled:{type:Boolean,default:true},isActive:{type:Boolean},data:{type:Object,default:{}},settings:{type:Object,default:{}}},data(){return{id:null}},methods:{getId(){return this.id},getData(){return{}},isReadyToMoveOn(){return this.validate()},validate(){return true},onValidationFailed(){o.UI.Notification.Center.notify({content:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_VALIDATION_ERROR"),autoHideDelay:3e3})},emitChangeData(){if(!d.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=d.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("onChange",{id:this.id,data:this.getData()})},getBodyFieldClassList(t=[]){return["crm-copilot__call-assessment_page-section-body-field",...t,{"--read-only":this.isEnabled!==true}]}}};const P={extends:S,components:{TextEditorComponent:l.TextEditorComponent,TextEditorWrapperComponent:L},props:{textEditor:l.TextEditor},data(){return{id:"about",parser:new a.BBCodeParser,promptLengthValidator:new C,promptLengthError:null}},methods:{getData(){return{prompt:this.textEditor.getText()}},isReadyToMoveOn(){return d.Type.isStringFilled(this.textEditor.getText())},validate(){return this.promptLengthValidator.validate(this.getPlainPromptText())},onValidationFailed(){this.promptLengthError=this.promptLengthValidator.getError()},onChange(){this.promptLengthError=null;S.methods.onChange.call(this)},getPlainPromptText(){return this.parser.parse(this.textEditor.getText()).toPlainText().trim()}},computed:{pageTitle(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_TITLE")},pageDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<TextEditorWrapperComponent\n\t\t\t\t\t\t\t:textEditor="textEditor"\n\t\t\t\t\t\t\t@change="onChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div v-if="promptLengthError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ promptLengthError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const I=Object.freeze({new:1,inWork:2,return:3,repeated:4});const y={extends:S,data(){var t;return{id:"client",activeClientTypeIds:(t=this.data.activeClientTypeIds)!=null?t:[]}},methods:{getData(){return{clientTypeIds:[...this.activeClientTypeIds]}},getClientTypeClassList(t){const e=this.clientTypes.find((e=>e.id===t));return["crm-copilot__call-assessment_page-section-body-field-client-type",`--client-${e.id}`,{"--active":this.activeClientTypeIds.includes(t)},{"--readonly":this.readOnly}]},onClientTypeSelect(t){if(this.readOnly){return}if(this.activeClientTypeIds.includes(t)){const e=this.activeClientTypeIds.indexOf(t);this.activeClientTypeIds.splice(e,1)}else{this.activeClientTypeIds.push(t)}this.emitChangeData()},onCheckboxClick(){return!this.readOnly},validate(){return d.Type.isArrayFilled(this.activeClientTypeIds)}},computed:{pageTitle(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TITLE")},pageDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_DESCRIPTION")},clientTypes(){return[{id:I.new,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_TITLE"),description:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_DESCRIPTION")},{id:I.inWork,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_TITLE"),description:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_DESCRIPTION")},{id:I.return,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_TITLE"),description:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_DESCRIPTION")},{id:I.repeated,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_TITLE"),description:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_DESCRIPTION")}]}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<div v-for="(clientType, index) in clientTypes">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t:class=getClientTypeClassList(clientType.id)\n\t\t\t\t\t\t\t\t@click="onClientTypeSelect(clientType.id)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-avatar">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-info">\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-title">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.title }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-description">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.description }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t:class="(readOnly ? 'readonly' : '')"\n\t\t\t\t\t\t\t\t\t:onclick="onCheckboxClick"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tv-model="activeClientTypeIds"\n\t\t\t\t\t\t\t\t\t:value="clientType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<hr\n\t\t\t\t\t\t\t\tv-if="index + 1 < clientTypes.length"\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-client-type-divider"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var A=babelHelpers.classPrivateFieldLooseKey("errorMessage");class O{constructor(){Object.defineProperty(this,A,{writable:true,value:null})}validate(t,e){if(e<t){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_VALIDATION_ERROR");return false}babelHelpers.classPrivateFieldLooseBase(this,A)[A]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}}const f=10;const B={emits:["change"],props:{value:{type:Number,required:true},additionalClass:{type:String}},data(){return{currentValue:this.value}},methods:{onInlineValueKeyDown(t){const{key:e,code:i,ctrlKey:s,metaKey:a}=t;if(a||s){const e=["KeyA","KeyZ","KeyC","KeyV","KeyR","KeyX"];if(!e.includes(i)){t.preventDefault();return false}return true}const l=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace","Delete"];if(l.includes(i)){return true}if(e===" "||Number.isNaN(Number(e))){t.preventDefault();return false}return true},onInlineValueChange(t){const e=Number(this.$refs.input.innerText);this.executeValueChange(e);this.$nextTick((()=>{const t=document.createRange();const e=window.getSelection();t.selectNodeContents(this.$refs.input);t.collapse(false);e.removeAllRanges();e.addRange(t);this.$refs.input.focus()}))},onInlineValueBlur(){const t=this.$refs.input.innerText.replaceAll(/\D/g,"");if(t===""){this.executeValueChange(0)}},changeValue(t){let e=t==="plus"?this.value+f:this.value-f;if(e%f>0){e=Math.ceil(e/f)*10}this.executeValueChange(e)},executeValueChange(t,e=null){this.currentValue=t;this.$refs.input.innerText=t===0?0:this.$refs.input.innerText.replace(/^0+/,"");d.Runtime.debounce((()=>{this.$emit("change",this.currentValue)}),300,this)()}},computed:{title(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PILL_TITLE")},classList(){return["crm-copilot__call-assessment-pill",this.additionalClass]},minusButtonClassList(){return["crm-copilot__call-assessment-pill-minus",{"--disabled":this.currentValue<=0}]},plusButtonClassList(){return["crm-copilot__call-assessment-pill-plus",{"--disabled":this.currentValue>=100}]}},watch:{currentValue(t){if(t<=0){this.currentValue=0}if(t>=100){this.currentValue=100}if(Number.isNaN(t)){this.currentValue=0}this.$refs.input.innerText=this.currentValue}},template:`\n\t\t<div :class="classList">\n\t\t\t<div class="crm-copilot__call-assessment-pill-title" v-html="title">\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-pill-control">\n\t\t\t\t<div\n\t\t\t\t\t:class="minusButtonClassList"\n\t\t\t\t\t@click="changeValue('minus')"\n\t\t\t\t\tref="minus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-copilot__call-assessment-pill-value-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="crm-copilot__call-assessment-pill-value"\n\t\t\t\t\t\tcontenteditable="true"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t@keydown="onInlineValueKeyDown"\n\t\t\t\t\t\t@input="onInlineValueChange"\n\t\t\t\t\t\t@blur="onInlineValueBlur"\n\t\t\t\t\t\tref="input"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ currentValue }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment-pill-percent">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\t:class="plusButtonClassList"\n\t\t\t\t\t@click="changeValue('plus')"\n\t\t\t\t\tref="plus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M={props:{articleCode:{type:String,required:true}},methods:{onClick(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${this.articleCode}`)}},template:`\n\t\t<span class="crm-copilot__call-assessment-help-link" ref="container" @click="onClick">\n\t\t\t${d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_HELP")}\n\t\t</span>\n\t`};const N={components:{HelpLink:M},props:{id:{type:String,required:true},content:{type:String,required:true},dialogTargetId:{type:String,required:false,default:null},articleCode:{type:String,required:true},value:{type:Number},items:{type:Array},tabs:{type:Array},selectedItems:{type:Array}},data(){var t,e;return{status:(t=this.isChecked)!=null?t:false,currentValue:(e=this.value)!=null?e:null}},mounted(){this.initDialog()},updated(){this.initDialog()},watch:{currentValue(t){this.emitSelectItem(t)}},methods:{initDialog(){var t,e,i;if(this.dialogTargetId===null){return}const s=document.getElementById(this.dialogTargetId);this.clientSelectorDialog=new c.Dialog({targetNode:s,context:`CRM_COPILOT_CALL_ASSESSMENT_DIALOG_${this.id}`,multiple:false,dropdownMode:true,showAvatars:false,enableSearch:false,width:450,zIndex:2500,items:(t=this.items)!=null?t:[],tabs:(e=this.tabs)!=null?e:[],selectedItems:(i=this.selectedItems)!=null?i:[],events:{"Item:onSelect":t=>{const{item:{id:e}}=t.getData();this.currentValue=e}}});d.Event.bind(s,"click",(()=>{this.clientSelectorDialog.show()}))},emitSelectItem(t){this.$emit("onSelectItem",t)}},template:`\n\t\t<div>\n\t\t\t<span\n\t\t\t\tclass="crm-copilot__call-assessment_call_count"\n\t\t\t\tv-html="content"\n\t\t\t></span>\n\t\t\t<HelpLink :articleCode="articleCode" />\n\t\t</div>\n\t`};const H={extends:S,components:{TextWithDialog:N,Pill:B},data(){return{id:"control",lowBorder:this.data.lowBorder,highBorder:this.data.highBorder,validator:new O}},methods:{getData(){return{lowBorder:this.lowBorder,highBorder:this.highBorder}},setLowBorder(t){this.lowBorder=t},setHighBorder(t){this.highBorder=t},validate(){return this.validator.validate(this.lowBorder,this.highBorder)},onValidationFailed(){o.UI.Notification.Center.notify({content:this.validator.getError(),autoHideDelay:3e3})}},computed:{pageTitle(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_TITLE")},pageDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id"/>\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --low-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--low"\n\t\t\t\t\t\t\t\t:value="lowBorder"\n\t\t\t\t\t\t\t\t@change="setLowBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --high-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--high"\n\t\t\t\t\t\t\t\t:value="highBorder"\n\t\t\t\t\t\t\t\t@change="setHighBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const R={extends:S,data(){var t,e;let i=0;if((t=this.settings.baas)!=null&&t.hasPackage){var s;i=(s=this.data.autoCheckTypeId)!=null?s:1}return{id:"settings",callTypeId:(e=this.data.callTypeId)!=null?e:1,autoCheckTypeId:i}},methods:{getData(){return{callTypeId:this.callTypeId,autoCheckTypeId:this.autoCheckTypeId}},onAutoCheckTypeIdChange(t){if(this.isBaasHasPackage){return}const{value:e}=t.target;if(e!==0){if(this.packageEmptySliderCode){p.InfoHelper.show(this.packageEmptySliderCode)}void this.$nextTick((()=>{this.autoCheckTypeId=0}))}}},computed:{pageTitle(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_TITLE")},pageDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_DESCRIPTION")},pageSectionSettingsCallType(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE")},pageSectionSettingsCallTypeDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_DESCRIPTION")},callTypes(){return[{id:1,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_ALL")},{id:2,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_INCOMING")},{id:3,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_OUTGOING")}]},pageSectionSettingsCheck(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK")},pageSectionSettingsCheckDescription(){return d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DESCRIPTION")},checkTypes(){return[{value:1,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_FIRST_INCOMING")},{value:2,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_INCOMING")},{value:3,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_OUTGOING")},{value:4,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL")},{value:0,title:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DISABLED")}]},isBaasAvailable(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.isAvailable)!=null?t:false},isBaasHasPackage(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.hasPackage)!=null?t:false},packageEmptySliderCode(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.aiPackagesEmptySliderCode)!=null?t:null}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCallType }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="callTypeId">\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="callType in callTypes"\n\t\t\t\t\t\t\t\t\t:value="callType.id"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && callTypeId !== callType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{callType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCallTypeDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div \n\t\t\t\t\tv-if="isBaasAvailable"\n\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body"\n\t\t\t\t>\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCheck }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tv-model="autoCheckTypeId"\n\t\t\t\t\t\t\t\t@change="onAutoCheckTypeIdChange"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="checkType in checkTypes"\n\t\t\t\t\t\t\t\t\t:value="checkType.value"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && autoCheckTypeId !== checkType.value"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{checkType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCheckDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const F={components:{AboutPage:P,ClientPage:y,SettingsPage:R,ControlPage:H,Navigation:b},props:{settings:{type:Object,default:{}},params:{type:Object,default:{}},textEditor:l.TextEditor},data(){var t;const{data:e}=this.params;let i=null;if(this.settings.isCopy){i=null}else{var s;i=(s=e==null?void 0:e.id)!=null?s:null}return{id:i,pagesData:this.initPagesData(e),activePageId:"about",title:(t=e.title)!=null?t:null,canShowNextPage:false}},watch:{activePageId(t){this.onPageDataChange({id:t,data:this.getPageData(t)})}},methods:{initPagesData(t){var e,i;return{client:{data:{activeClientTypeIds:t==null?void 0:t.clientTypeIds}},settings:{data:{callTypeId:t==null?void 0:t.callTypeId,autoCheckTypeId:t==null?void 0:t.autoCheckTypeId}},control:{data:{lowBorder:(e=t==null?void 0:t.lowBorder)!=null?e:0,highBorder:(i=t==null?void 0:t.highBorder)!=null?i:100}}}},onNavigationButtonClick({data:t}){const{id:e}=t;if(e==="cancel"||e==="close"){this.closeSlider();return}if(e==="back"){const t=this.pagesList.indexOf(this.activePageId);if(t>0){this.activePageId=this.pagesList[t-1]}return}if(!this.isActivePageValid()){this.onActivePageValidationFailed();return}if(e==="continue"){const t=this.pagesList.indexOf(this.activePageId);if(t<this.pagesList.length-1){this.activePageId=this.pagesList[t+1]}return}if(e==="submit"||e==="update"){this.sendData()}},sendData(){let t={title:this.title};this.pagesList.forEach((e=>{var i;t={...t,...(i=this.$refs[e])==null?void 0:i.getData()}}));const e={id:this.id,data:t,eventId:i.QueueManager.registerRandomEventId("crm-copilot-call-assessment")};top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:beforeSave",e);d.ajax.runAction("crm.copilot.callassessment.save",{data:e}).then((t=>{top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:save",{...e,status:t==null?void 0:t.status});if((t==null?void 0:t.status)!=="success"){o.UI.Notification.Center.notify({content:d.Text.encode(t.errors[0].message),autoHideDelay:6e3});return}this.onSaveCallback();this.closeSlider()}),(t=>{var e;const i=((e=t.errors[0])==null?void 0:e.code)==="AI_NOT_AVAILABLE"?"CRM_COPILOT_CALL_ASSESSMENT_PAGE_COPILOT_ERROR":"CRM_COPILOT_CALL_ASSESSMENT_PAGE_SAVE_ERROR";o.UI.Notification.Center.notify({content:d.Loc.getMessage(i),autoHideDelay:6e3})})).catch((t=>{o.UI.Notification.Center.notify({content:d.Text.encode(t.errors[0].message),autoHideDelay:6e3});throw t}))},closeSlider(){top.BX.SidePanel.Instance.getSliderByWindow(window).close()},onSaveCallback(){var t,e;if(d.Type.isFunction((t=this.params)==null?void 0:(e=t.events)==null?void 0:e.onSave)){this.params.events.onSave()}},setActivePageId({data:t}){const e=t.itemId;const i=this.pagesList.indexOf(this.activePageId);const s=this.pagesList.indexOf(e);if(i===s){return}if(s>i&&!this.isActivePageValid()){this.onActivePageValidationFailed();return}this.activePageId=e},isPageActive(t){return this.activePageId===t},onPageDataChange({id:t,data:e}){this.pagesData[t]=e;this.canShowNextPage=this.isActivePageReadyToMoveOn()},getPageData(t){if(d.Type.isObjectLike(this.pagesData[t])){return this.pagesData[t].data}return{}},getPageSettings(t){if(t==="settings"){var e;return{baas:(e=this.settings.baas)!=null?e:{}}}return{}},setTitle(t){this.title=t},isActivePageValid(){return this.getActivePage().validate()},onActivePageValidationFailed(){return this.getActivePage().onValidationFailed()},isActivePageReadyToMoveOn(){return this.getActivePage().isReadyToMoveOn()},getActivePage(){return this.$refs[this.activePageId]}},computed:{pagesList(){return["about","client","settings","control"]},isNew(){var t;return((t=this.params.data)==null?void 0:t.id)<=0},readOnly(){return this.settings.readOnly},isEnabled(){return this.settings.isEnabled}},mounted(){this.canShowNextPage=this.isActivePageReadyToMoveOn();this.$Bitrix.eventEmitter.subscribe(u.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.subscribe(h.click,this.onNavigationButtonClick)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(u.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.unsubscribe(h.click,this.onNavigationButtonClick)},template:`\n\t\t<div class="crm-copilot__call-assessment_container">\n\t\t\t<div class="crm-copilot__call-assessment_page-wrapper">\n\t\t\t\t<AboutPage \n\t\t\t\t\t:is-active="isPageActive('about')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('about')"\n\t\t\t\t\t:text-editor="textEditor"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="about"\n\t\t\t\t/>\n\t\t\t\t<ClientPage \n\t\t\t\t\t:is-active="isPageActive('client')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('client')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="client"\n\t\t\t\t/>\n\t\t\t\t<SettingsPage\n\t\t\t\t\t:is-active="isPageActive('settings')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('settings')"\n\t\t\t\t\t:settings="getPageSettings('settings')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="settings"\n\t\t\t\t/>\n\t\t\t\t<ControlPage\n\t\t\t\t\t:is-active="isPageActive('control')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('control')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="control"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<Navigation \n\t\t\t\t:active-tab-id="activePageId"\n\t\t\t\t:is-enabled="canShowNextPage"\n\t\t\t\t:read-only="readOnly"\n\t\t\t\t:show-save-button="!isNew && !readOnly"\n\t\t\t/>\n\t\t</div>\n\t`};let D=t=>t,w,x;var k=babelHelpers.classPrivateFieldLooseKey("container");var G=babelHelpers.classPrivateFieldLooseKey("app");var V=babelHelpers.classPrivateFieldLooseKey("layoutComponent");var K=babelHelpers.classPrivateFieldLooseKey("titleId");var $=babelHelpers.classPrivateFieldLooseKey("titleEditButtonId");var j=babelHelpers.classPrivateFieldLooseKey("titleInputContainer");var U=babelHelpers.classPrivateFieldLooseKey("titleNode");var X=babelHelpers.classPrivateFieldLooseKey("titleInput");var W=babelHelpers.classPrivateFieldLooseKey("inputEditButton");var Y=babelHelpers.classPrivateFieldLooseKey("title");var z=babelHelpers.classPrivateFieldLooseKey("textEditor");var q=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var Q=babelHelpers.classPrivateFieldLooseKey("isEnabled");var Z=babelHelpers.classPrivateFieldLooseKey("initTitleInlineEditing");var J=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingStart");var tt=babelHelpers.classPrivateFieldLooseKey("appendTitleInput");var et=babelHelpers.classPrivateFieldLooseKey("hideTitle");var it=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingFinish");var st=babelHelpers.classPrivateFieldLooseKey("getInputEditButton");var at=babelHelpers.classPrivateFieldLooseKey("hideInputAndShowTitle");var lt=babelHelpers.classPrivateFieldLooseKey("getTitleNode");var nt=babelHelpers.classPrivateFieldLooseKey("getTextEditor");class ot{constructor(t,i={}){var s,a,l,n,o,r,c,p,u;Object.defineProperty(this,nt,{value:gt});Object.defineProperty(this,lt,{value:vt});Object.defineProperty(this,at,{value:ht});Object.defineProperty(this,st,{value:_t});Object.defineProperty(this,it,{value:ut});Object.defineProperty(this,et,{value:pt});Object.defineProperty(this,tt,{value:dt});Object.defineProperty(this,J,{value:ct});Object.defineProperty(this,Z,{value:rt});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,Y,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,q,{writable:true,value:true});Object.defineProperty(this,Q,{writable:true,value:true});babelHelpers.classPrivateFieldLooseBase(this,k)[k]=document.getElementById(t);if(!d.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,k)[k])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,q)[q]=(s=(a=i.config)==null?void 0:a.readOnly)!=null?s:true;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=(l=(n=i.config)==null?void 0:n.isEnabled)!=null?l:true;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](i);babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.BitrixVue.createApp(F,{textEditor:babelHelpers.classPrivateFieldLooseBase(this,nt)[nt](i.data,(o=i.config)!=null?o:{}),settings:{readOnly:babelHelpers.classPrivateFieldLooseBase(this,q)[q],isEnabled:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q],isCopy:(r=(c=i.config)==null?void 0:c.isCopy)!=null?r:false,baas:(p=(u=i.config)==null?void 0:u.baasSettings)!=null?p:false},params:{data:i.data,events:i.events}});babelHelpers.classPrivateFieldLooseBase(this,V)[V]=babelHelpers.classPrivateFieldLooseBase(this,G)[G].mount(babelHelpers.classPrivateFieldLooseBase(this,k)[k])}onTitleInlineEditingStart(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]();babelHelpers.classPrivateFieldLooseBase(this,et)[et]();babelHelpers.classPrivateFieldLooseBase(this,it)[it]()}onTitleInputBlur(t){this.onTitleInlineEditingFinish(t,false)}onTitleInputEnterPressed(t){if(t.key==="Enter"){this.onTitleInlineEditingFinish(t,false)}}onTitleInlineEditingFinish(t,e=true){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]===null||babelHelpers.classPrivateFieldLooseBase(this,X)[X]===null){return}if(e&&(t.target===babelHelpers.classPrivateFieldLooseBase(this,X)[X]||t.target===babelHelpers.classPrivateFieldLooseBase(this,st)[st]())){return}const i=babelHelpers.classPrivateFieldLooseBase(this,X)[X].value;if(!d.Type.isStringFilled(i)){babelHelpers.classPrivateFieldLooseBase(this,X)[X].focus();return}babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=i;babelHelpers.classPrivateFieldLooseBase(this,V)[V].setTitle(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]);d.Event.unbind(document,"mousedown",this.onTitleInlineEditingFinish);d.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,X)[X],"keyup",this.onTitleInputEnterPressed);d.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,X)[X],"blur",this.onTitleInputBlur);babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}}function rt(t){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]){return}this.onTitleInlineEditingStart=this.onTitleInlineEditingStart.bind(this);this.onTitleInlineEditingFinish=this.onTitleInlineEditingFinish.bind(this);this.onTitleInputEnterPressed=this.onTitleInputEnterPressed.bind(this);this.onTitleInputBlur=this.onTitleInputBlur.bind(this);const{config:e,data:i}=t;const{titleId:s,titleEditButtonId:a}=e!=null?e:{};if(!d.Type.isStringFilled(s)||!d.Type.isStringFilled(a)){return}babelHelpers.classPrivateFieldLooseBase(this,$)[$]=a;babelHelpers.classPrivateFieldLooseBase(this,K)[K]=s;if(d.Type.isString(i==null?void 0:i.title)){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=i.title}babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}function ct(){d.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,st)[st](),"click",this.onTitleInlineEditingStart)}function dt(){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=d.Tag.render(w||(w=D`
			<input value="${0}" type="text" class="crm-copilot__call-assessment_title-item" />
		`),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]));babelHelpers.classPrivateFieldLooseBase(this,j)[j]=d.Tag.render(x||(x=D`
			<div class="crm-copilot__call-assessment_title-wrapper">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,X)[X]);d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,j)[j],babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]().parentNode);babelHelpers.classPrivateFieldLooseBase(this,X)[X].focus();const t=babelHelpers.classPrivateFieldLooseBase(this,X)[X].value.length;babelHelpers.classPrivateFieldLooseBase(this,X)[X].selectionStart=t;babelHelpers.classPrivateFieldLooseBase(this,X)[X].selectionEnd=t;d.Dom.addClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function pt(){d.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](),{display:"none"});d.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,st)[st](),{display:"none"})}function ut(){d.Event.bind(document,"mousedown",this.onTitleInlineEditingFinish);d.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,X)[X],"keyup",this.onTitleInputEnterPressed);d.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,X)[X],"blur",this.onTitleInputBlur)}function _t(){if(babelHelpers.classPrivateFieldLooseBase(this,W)[W]===null){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,$)[$])}return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}function ht(){const t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]();t.innerText=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y];d.Dom.style(t,{display:"inline-block"});d.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,st)[st](),{display:"inline-block"});d.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,j)[j]);babelHelpers.classPrivateFieldLooseBase(this,j)[j]=null;d.Dom.removeClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function vt(){if(babelHelpers.classPrivateFieldLooseBase(this,U)[U]===null){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,K)[K])}return babelHelpers.classPrivateFieldLooseBase(this,U)[U]}function gt({prompt:t},{copilotSettings:e}){if(babelHelpers.classPrivateFieldLooseBase(this,z)[z]!==null){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}const i=babelHelpers.classPrivateFieldLooseBase(this,q)[q]?[]:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","copilot"];babelHelpers.classPrivateFieldLooseBase(this,z)[z]=new l.BasicEditor({editable:!babelHelpers.classPrivateFieldLooseBase(this,q)[q],removePlugins:["BlockToolbar"],minHeight:250,maxHeight:400,content:t,placeholder:d.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER"),paragraphPlaceholder:d.Loc.getMessage(d.Type.isPlainObject(e)?"CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER_WITH_COPILOT":null),toolbar:i,floatingToolbar:[],collapsingMode:false,copilot:{copilotOptions:d.Type.isPlainObject(e)?e:null,triggerBySpace:true}});return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}t.CallAssessment=ot})(this.BX.Crm.Copilot=this.BX.Crm.Copilot||{},BX.Vue3,BX.Pull,BX.UI,BX.UI.BBCode,BX.UI.TextEditor,BX,BX,BX.Event,BX.UI.EntitySelector,BX,BX.UI);
//# sourceMappingURL=call-assessment.bundle.map.js