this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,s,a,n,l,o,r){"use strict";const c={itemClick:"crm:copilot:call-assessment:breadcrumb-item-click"};const d={props:{activeTabId:{type:String}},data(){return{tabs:this.getTabsData()}},methods:{itemTitleClassList(t,e){return["crm-copilot__call-assessment_breadcrumbs-item-title",{"--active":t===this.activeTabId},{"--soon":e}]},getTab(t){return this.getTabsData().find((e=>e.id===t))},getTabsData(){return[{id:"about",title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT")},{id:"client",title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT")},{id:"settings",title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS")},{id:"control",title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL"),soon:true}]},emitClickEvent(t){const e=this.getTab(t);if(!e.soon){this.$Bitrix.eventEmitter.emit(c.itemClick,{itemId:t})}}},computed:{soonTitle(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_BREADCRUMBS_SOON")}},template:`\n\t\t<div class="crm-copilot__call-assessment_breadcrumbs-wrapper">\n\t\t\t<div\n\t\t\t\tv-for="(tab, index) in tabs"\n\t\t\t\t@click="emitClickEvent(tab.id)"\n\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-item"\n\t\t\t>\n\t\t\t\t<span v-if="tab.soon" class="crm-copilot__call-assessment_breadcrumbs-soon">\n\t\t\t\t\t{{ soonTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span :class="itemTitleClassList(tab.id, tab.soon)">\n\t\t\t\t\t{{ tab.title }}\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-if="index+1 < tabs.length"\n\t\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-divider"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t</div>\n\t`};const p={click:"crm:copilot:call-assessment:navigation-button-click"};const u={props:{id:{type:String,required:true},isEnabled:{type:Boolean,default:true}},mounted(){this.initButton()},watch:{isEnabled(t){this.button.setState(t?i.ButtonState.ACTIVE:i.ButtonState.DISABLED)}},methods:{initButton(){this.button=new i.Button({text:o.Loc.getMessage(`CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_BUTTON_${this.id.toUpperCase()}`),color:this.buttonColor,round:true,size:BX.UI.Button.Size.LARGE,onclick:()=>{this.emitClickEvent()}});if(this.isEnabled!==true){this.button.setState(i.ButtonState.DISABLED)}this.button.setDataSet({id:`crm-copilot-call-assessment-buttons-${this.id.toLowerCase()}`});if(this.$refs.button){this.button.renderTo(this.$refs.button)}},emitClickEvent(){if(this.isEnabled){this.$Bitrix.eventEmitter.emit(p.click,{id:this.id})}}},computed:{buttonColor(){if(this.id==="continue"||this.id==="submit"||this.id==="close"){return i.Button.Color.SUCCESS}if(this.id==="update"){return i.Button.Color.LIGHT_BORDER}return i.Button.Color.LIGHT}},template:`\n\t\t<div ref="button" class="crm-copilot-call-assessment-button"></div>\n\t`};const v="23240682";const _={components:{Button:u},props:{activeTabId:{type:String},isEnabled:{type:Boolean},readOnly:{type:Boolean,default:false},showSaveButton:{type:Boolean,default:false}},computed:{help(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_HELP")},buttons(){return["cancel","back","continue","submit","close","update"]}},methods:{showArticle(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${v}`)}},template:`\n\t\t<div class="crm-copilot__call-assessment_navigation-container">\n\t\t\t<div class="crm-copilot__call-assessment_navigation-buttons-wrapper">\n\t\t\t\t<Button v-if="activeTabId !== 'settings'" id="continue" :is-enabled="isEnabled" />\n\t\t\t\t<Button v-if="activeTabId === 'settings' && !readOnly" id="submit" />\n\t\t\t\t<Button v-if="activeTabId === 'settings' && readOnly" id="close" />\n\t\t\t\t<Button v-if="activeTabId === 'about'" id="cancel" />\n\t\t\t\t<Button v-if="activeTabId !== 'about'" id="back" />\n\t\t\t</div>\n\t\t\t<div v-if="showSaveButton && activeTabId !== 'settings'">\n\t\t\t\t<Button id="update" :is-enabled="isEnabled" />\n\t\t\t</div>\n\t\t\t<div v-else class="crm-copilot__call-assessment_article" @click="showArticle">\n\t\t\t\t<span class="ui-icon-set --help"></span>\n\t\t\t\t{{ help }}\n\t\t\t</div>\n\t\t</div>\n\t`};const g={components:{TextEditorComponent:a.TextEditorComponent},emits:["change"],props:{textEditor:a.TextEditor},data(){return{textEditorEvents:{onChange:this.emitChangeData}}},mounted(){var t,e,i;const s=this.$el.parentNode.offsetTop;const a=".crm-copilot__call-assessment_navigation-container";const n=(t=(e=document.querySelector(a))==null?void 0:e.offsetTop)!=null?t:0;const l=20;const o=n-s-l;const r=Math.round(o*.5);const c=Math.round(o*.8);if(r<200){var d;(d=this.textEditor)==null?void 0:d.setMinHeight(c)}else{var p;(p=this.textEditor)==null?void 0:p.setMinHeight(r)}(i=this.textEditor)==null?void 0:i.setMaxHeight(c)},methods:{emitChangeData(){if(!o.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=o.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("change",{prompt:this.textEditor.getText()})}},template:`\n\t\t<TextEditorComponent \n\t\t\t:events="textEditorEvents"\n\t\t\t:editor-instance="textEditor"\n\t\t/>\n\t`};const h={components:{Breadcrumbs:d},props:{readOnly:{type:Boolean,default:false},isActive:{type:Boolean},data:{type:Object,default:{}},settings:{type:Object,default:{}}},data(){return{id:null}},methods:{getId(){return this.id},getData(){return{}},isReadyToMoveOn(){return this.validate()},validate(){return true},onValidationFailed(){n.UI.Notification.Center.notify({content:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_VALIDATION_ERROR"),autoHideDelay:3e3})},emitChangeData(){if(!o.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=o.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("onChange",{id:this.id,data:this.getData()})}}};const b={MIN:100,MAX:5e3};var T=babelHelpers.classPrivateFieldLooseKey("errorMessage");class L{constructor(){Object.defineProperty(this,T,{writable:true,value:null})}validate(t){if(t.length<b.MIN){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MIN_ERROR",{"#MIN_VALUE#":b.MIN});return false}if(t.length>b.MAX){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MAX_ERROR",{"#MAX_VALUE#":b.MAX});return false}babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]}}const E={extends:h,components:{TextEditorComponent:a.TextEditorComponent,TextEditorWrapperComponent:g},props:{textEditor:a.TextEditor},data(){return{id:"about",parser:new l.BBCodeParser,promptLengthValidator:new L,promptLengthError:null}},methods:{getData(){return{prompt:this.textEditor.getText()}},isReadyToMoveOn(){return o.Type.isStringFilled(this.textEditor.getText())},validate(){return this.promptLengthValidator.validate(this.getPlainPromptText())},onValidationFailed(){this.promptLengthError=this.promptLengthValidator.getError()},onChange(){this.promptLengthError=null;h.methods.onChange.call(this)},getPlainPromptText(){return this.parser.parse(this.textEditor.getText()).toPlainText().trim()}},computed:{pageTitle(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_TITLE")},pageDescription(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field">\n\t\t\t\t\t\t<TextEditorWrapperComponent\n\t\t\t\t\t\t\t:textEditor="textEditor"\n\t\t\t\t\t\t\t@change="onChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div v-if="promptLengthError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ promptLengthError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const P=Object.freeze({new:1,inWork:2,return:3,repeated:4});const C={extends:h,data(){var t;return{id:"client",activeClientTypeIds:(t=this.data.activeClientTypeIds)!=null?t:[]}},methods:{getData(){return{clientTypeIds:[...this.activeClientTypeIds]}},getClientTypeClassList(t){const e=this.clientTypes.find((e=>e.id===t));return["crm-copilot__call-assessment_page-section-body-field-client-type",`--client-${e.id}`,{"--active":this.activeClientTypeIds.includes(t)},{"--readonly":this.readOnly}]},onClientTypeSelect(t){if(this.readOnly){return}if(this.activeClientTypeIds.includes(t)){const e=this.activeClientTypeIds.indexOf(t);this.activeClientTypeIds.splice(e,1)}else{this.activeClientTypeIds.push(t)}this.emitChangeData()},onCheckboxClick(){return!this.readOnly},validate(){return o.Type.isArrayFilled(this.activeClientTypeIds)}},computed:{pageTitle(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TITLE")},pageDescription(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_DESCRIPTION")},clientTypes(){return[{id:P.new,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_TITLE"),description:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_DESCRIPTION")},{id:P.inWork,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_TITLE"),description:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_DESCRIPTION")},{id:P.return,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_TITLE"),description:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_DESCRIPTION")},{id:P.repeated,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_TITLE"),description:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_DESCRIPTION")}]}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field">\n\t\t\t\t\t\t<div v-for="(clientType, index) in clientTypes">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t:class=getClientTypeClassList(clientType.id)\n\t\t\t\t\t\t\t\t@click="onClientTypeSelect(clientType.id)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-avatar">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-info">\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-title">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.title }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-description">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.description }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t:class="(readOnly ? 'readonly' : '')"\n\t\t\t\t\t\t\t\t\t:onclick="onCheckboxClick"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tv-model="activeClientTypeIds"\n\t\t\t\t\t\t\t\t\t:value="clientType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<hr\n\t\t\t\t\t\t\t\tv-if="index + 1 < clientTypes.length"\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-client-type-divider"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const S={extends:h,data(){var t,e;let i=0;if((t=this.settings.baas)!=null&&t.hasPackage){var s;i=(s=this.data.autoCheckTypeId)!=null?s:1}return{id:"settings",callTypeId:(e=this.data.callTypeId)!=null?e:1,autoCheckTypeId:i}},methods:{getData(){return{callTypeId:this.callTypeId,autoCheckTypeId:this.autoCheckTypeId}},onAutoCheckTypeIdChange(t){if(this.isBaasHasPackage){return}const{value:e}=t.target;if(e!==0){if(this.packageEmptySliderCode){r.InfoHelper.show(this.packageEmptySliderCode)}void this.$nextTick((()=>{this.autoCheckTypeId=0}))}}},computed:{pageTitle(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_TITLE")},pageDescription(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_DESCRIPTION")},pageSectionSettingsCallType(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE")},pageSectionSettingsCallTypeDescription(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_DESCRIPTION")},callTypes(){return[{id:1,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_ALL")},{id:2,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_INCOMING")},{id:3,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_OUTGOING")}]},pageSectionSettingsCheck(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK")},pageSectionSettingsCheckDescription(){return o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DESCRIPTION")},checkTypes(){return[{value:1,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_FIRST_INCOMING")},{value:2,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_INCOMING")},{value:3,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_OUTGOING")},{value:4,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL")},{value:0,title:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DISABLED")}]},isBaasAvailable(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.isAvailable)!=null?t:false},isBaasHasPackage(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.hasPackage)!=null?t:false},packageEmptySliderCode(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.aiPackagesEmptySliderCode)!=null?t:null}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCallType }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="callTypeId">\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="callType in callTypes"\n\t\t\t\t\t\t\t\t\t:value="callType.id"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && callTypeId !== callType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{callType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCallTypeDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div v-if="isBaasAvailable" class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCheck }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tv-model="autoCheckTypeId"\n\t\t\t\t\t\t\t\t@change="onAutoCheckTypeIdChange"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="checkType in checkTypes"\n\t\t\t\t\t\t\t\t\t:value="checkType.value"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && autoCheckTypeId !== checkType.value"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{checkType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCheckDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const m={components:{AboutPage:E,ClientPage:C,SettingsPage:S,Navigation:_},props:{settings:{type:Object,default:{}},params:{type:Object,default:{}},textEditor:a.TextEditor},data(){var t;const{data:e}=this.params;let i=null;if(this.settings.isCopy){i=null}else{var s;i=(s=e==null?void 0:e.id)!=null?s:null}return{id:i,pagesData:this.initPagesData(e),activePageId:"about",title:(t=e.title)!=null?t:null,canShowNextPage:false}},watch:{activePageId(t){this.onPageDataChange({id:t,data:this.getPageData(t)})}},methods:{initPagesData(t){return{client:{data:{activeClientTypeIds:t==null?void 0:t.clientTypeIds}},settings:{data:{callTypeId:t==null?void 0:t.callTypeId,autoCheckTypeId:t==null?void 0:t.autoCheckTypeId}}}},onNavigationButtonClick({data:t}){const{id:e}=t;if(e==="cancel"||e==="close"){this.closeSlider();return}if(e==="back"){const t=this.pagesList.indexOf(this.activePageId);if(t>0){this.activePageId=this.pagesList[t-1]}return}if(!this.isActivePageValid()){this.onActivePageValidationFailed();return}if(e==="continue"){const t=this.pagesList.indexOf(this.activePageId);if(t<this.pagesList.length-1){this.activePageId=this.pagesList[t+1]}return}if(e==="submit"||e==="update"){this.sendData()}},sendData(){let t={title:this.title};this.pagesList.forEach((e=>{var i;t={...t,...(i=this.$refs[e])==null?void 0:i.getData()}}));o.ajax.runAction("crm.copilot.callassessment.save",{data:{id:this.id,data:t}}).then((t=>{if((t==null?void 0:t.status)!=="success"){n.UI.Notification.Center.notify({content:o.Text.encode(t.errors[0].message),autoHideDelay:6e3});return}this.onSaveCallback();this.closeSlider()}),(t=>{var e;const i=((e=t.errors[0])==null?void 0:e.code)==="AI_NOT_AVAILABLE"?"CRM_COPILOT_CALL_ASSESSMENT_PAGE_COPILOT_ERROR":"CRM_COPILOT_CALL_ASSESSMENT_PAGE_SAVE_ERROR";n.UI.Notification.Center.notify({content:o.Loc.getMessage(i),autoHideDelay:6e3})})).catch((t=>{n.UI.Notification.Center.notify({content:o.Text.encode(t.errors[0].message),autoHideDelay:6e3});throw t}))},closeSlider(){top.BX.SidePanel.Instance.getSliderByWindow(window).close()},onSaveCallback(){var t,e;if(o.Type.isFunction((t=this.params)==null?void 0:(e=t.events)==null?void 0:e.onSave)){this.params.events.onSave()}},setActivePageId({data:t}){const e=t.itemId;const i=this.pagesList.indexOf(this.activePageId);const s=this.pagesList.indexOf(e);if(i===s){return}if(s>i&&!this.isActivePageValid()){this.onActivePageValidationFailed();return}this.activePageId=e},isPageActive(t){return this.activePageId===t},onPageDataChange({id:t,data:e}){this.pagesData[t]=e;this.canShowNextPage=this.isActivePageReadyToMoveOn()},getPageData(t){if(o.Type.isObjectLike(this.pagesData[t])){return this.pagesData[t].data}return{}},getPageSettings(t){if(t==="settings"){var e;return{baas:(e=this.settings.baas)!=null?e:{}}}return{}},setTitle(t){this.title=t},isActivePageValid(){return this.getActivePage().validate()},onActivePageValidationFailed(){return this.getActivePage().onValidationFailed()},isActivePageReadyToMoveOn(){return this.getActivePage().isReadyToMoveOn()},getActivePage(){return this.$refs[this.activePageId]}},computed:{pagesList(){return["about","client","settings"]},isNew(){var t;return((t=this.params.data)==null?void 0:t.id)<=0},readOnly(){return this.settings.readOnly}},mounted(){this.canShowNextPage=this.isActivePageReadyToMoveOn();this.$Bitrix.eventEmitter.subscribe(c.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.subscribe(p.click,this.onNavigationButtonClick)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(c.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.unsubscribe(p.click,this.onNavigationButtonClick)},template:`\n\t\t<div class="crm-copilot__call-assessment_container">\n\t\t\t<div class="crm-copilot__call-assessment_page-wrapper">\n\t\t\t\t<AboutPage \n\t\t\t\t\t:is-active="isPageActive('about')"\n\t\t\t\t\t:data="getPageData('about')"\n\t\t\t\t\t:text-editor="textEditor"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="about"\n\t\t\t\t/>\n\t\t\t\t<ClientPage \n\t\t\t\t\t:is-active="isPageActive('client')"\n\t\t\t\t\t:data="getPageData('client')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="client"\n\t\t\t\t/>\n\t\t\t\t<SettingsPage\n\t\t\t\t\t:is-active="isPageActive('settings')"\n\t\t\t\t\t:data="getPageData('settings')"\n\t\t\t\t\t:settings="getPageSettings('settings')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="settings"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- temporary hidden --\x3e\n\t\t\t\t\x3c!--<ControlPage\n\t\t\t\t\t:is-active="isPageActive('control')"\n\t\t\t\t\t:data="getPageData('control')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="control"\n\t\t\t\t/>\n\t\t\t\t<EncouragementPage\n\t\t\t\t\t:is-active="isPageActive('encouragement')"\n\t\t\t\t\t:data="getPageData('encouragement')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="encouragement"\n\t\t\t\t/>--\x3e\n\t\t\t</div>\n\t\t\t<Navigation \n\t\t\t\t:active-tab-id="activePageId"\n\t\t\t\t:is-enabled="canShowNextPage"\n\t\t\t\t:read-only="readOnly"\n\t\t\t\t:show-save-button="!isNew && !readOnly"\n\t\t\t/>\n\t\t</div>\n\t`};let I=t=>t,y,A;var O=babelHelpers.classPrivateFieldLooseKey("container");var f=babelHelpers.classPrivateFieldLooseKey("app");var B=babelHelpers.classPrivateFieldLooseKey("layoutComponent");var M=babelHelpers.classPrivateFieldLooseKey("titleId");var N=babelHelpers.classPrivateFieldLooseKey("titleEditButtonId");var H=babelHelpers.classPrivateFieldLooseKey("titleInputContainer");var F=babelHelpers.classPrivateFieldLooseKey("titleNode");var R=babelHelpers.classPrivateFieldLooseKey("titleInput");var D=babelHelpers.classPrivateFieldLooseKey("inputEditButton");var x=babelHelpers.classPrivateFieldLooseKey("title");var k=babelHelpers.classPrivateFieldLooseKey("textEditor");var G=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var w=babelHelpers.classPrivateFieldLooseKey("initTitleInlineEditing");var j=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingStart");var K=babelHelpers.classPrivateFieldLooseKey("appendTitleInput");var U=babelHelpers.classPrivateFieldLooseKey("hideTitle");var V=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingFinish");var X=babelHelpers.classPrivateFieldLooseKey("getInputEditButton");var $=babelHelpers.classPrivateFieldLooseKey("hideInputAndShowTitle");var Y=babelHelpers.classPrivateFieldLooseKey("getTitleNode");var W=babelHelpers.classPrivateFieldLooseKey("getTextEditor");class q{constructor(t,i={}){var s,a,n,l,r,c,d;Object.defineProperty(this,W,{value:at});Object.defineProperty(this,Y,{value:st});Object.defineProperty(this,$,{value:it});Object.defineProperty(this,X,{value:et});Object.defineProperty(this,V,{value:tt});Object.defineProperty(this,U,{value:Z});Object.defineProperty(this,K,{value:Q});Object.defineProperty(this,j,{value:J});Object.defineProperty(this,w,{value:z});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:true});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=document.getElementById(t);if(!o.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,O)[O])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,G)[G]=(s=(a=i.config)==null?void 0:a.readOnly)!=null?s:true;babelHelpers.classPrivateFieldLooseBase(this,w)[w](i);babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.BitrixVue.createApp(m,{textEditor:babelHelpers.classPrivateFieldLooseBase(this,W)[W](i.data,(n=i.config)!=null?n:{}),settings:{readOnly:babelHelpers.classPrivateFieldLooseBase(this,G)[G],isCopy:(l=(r=i.config)==null?void 0:r.isCopy)!=null?l:false,baas:(c=(d=i.config)==null?void 0:d.baasSettings)!=null?c:false},params:{data:i.data,events:i.events}});babelHelpers.classPrivateFieldLooseBase(this,B)[B]=babelHelpers.classPrivateFieldLooseBase(this,f)[f].mount(babelHelpers.classPrivateFieldLooseBase(this,O)[O])}onTitleInlineEditingStart(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,U)[U]();babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}onTitleInputBlur(t){this.onTitleInlineEditingFinish(t,false)}onTitleInputEnterPressed(t){if(t.key==="Enter"){this.onTitleInlineEditingFinish(t,false)}}onTitleInlineEditingFinish(t,e=true){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]===null||babelHelpers.classPrivateFieldLooseBase(this,R)[R]===null){return}if(e&&(t.target===babelHelpers.classPrivateFieldLooseBase(this,R)[R]||t.target===babelHelpers.classPrivateFieldLooseBase(this,X)[X]())){return}const i=babelHelpers.classPrivateFieldLooseBase(this,R)[R].value;if(!o.Type.isStringFilled(i)){babelHelpers.classPrivateFieldLooseBase(this,R)[R].focus();return}babelHelpers.classPrivateFieldLooseBase(this,x)[x]=i;babelHelpers.classPrivateFieldLooseBase(this,B)[B].setTitle(babelHelpers.classPrivateFieldLooseBase(this,x)[x]);o.Event.unbind(document,"mousedown",this.onTitleInlineEditingFinish);o.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,R)[R],"keyup",this.onTitleInputEnterPressed);o.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,R)[R],"blur",this.onTitleInputBlur);babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}}function z(t){if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){return}this.onTitleInlineEditingStart=this.onTitleInlineEditingStart.bind(this);this.onTitleInlineEditingFinish=this.onTitleInlineEditingFinish.bind(this);this.onTitleInputEnterPressed=this.onTitleInputEnterPressed.bind(this);this.onTitleInputBlur=this.onTitleInputBlur.bind(this);const{config:e,data:i}=t;const{titleId:s,titleEditButtonId:a}=e!=null?e:{};if(!o.Type.isStringFilled(s)||!o.Type.isStringFilled(a)){return}babelHelpers.classPrivateFieldLooseBase(this,N)[N]=a;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=s;if(o.Type.isString(i==null?void 0:i.title)){babelHelpers.classPrivateFieldLooseBase(this,x)[x]=i.title}babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}function J(){o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,X)[X](),"click",this.onTitleInlineEditingStart)}function Q(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]=o.Tag.render(y||(y=I`
			<input value="${0}" type="text" class="crm-copilot__call-assessment_title-item" />
		`),o.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,x)[x]));babelHelpers.classPrivateFieldLooseBase(this,H)[H]=o.Tag.render(A||(A=I`
			<div class="crm-copilot__call-assessment_title-wrapper">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,R)[R]);o.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,H)[H],babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]().parentNode);babelHelpers.classPrivateFieldLooseBase(this,R)[R].focus();const t=babelHelpers.classPrivateFieldLooseBase(this,R)[R].value.length;babelHelpers.classPrivateFieldLooseBase(this,R)[R].selectionStart=t;babelHelpers.classPrivateFieldLooseBase(this,R)[R].selectionEnd=t;o.Dom.addClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function Z(){o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](),{display:"none"});o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,X)[X](),{display:"none"})}function tt(){o.Event.bind(document,"mousedown",this.onTitleInlineEditingFinish);o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,R)[R],"keyup",this.onTitleInputEnterPressed);o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,R)[R],"blur",this.onTitleInputBlur)}function et(){if(babelHelpers.classPrivateFieldLooseBase(this,D)[D]===null){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,N)[N])}return babelHelpers.classPrivateFieldLooseBase(this,D)[D]}function it(){const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();t.innerText=babelHelpers.classPrivateFieldLooseBase(this,x)[x];o.Dom.style(t,{display:"inline-block"});o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,X)[X](),{display:"inline-block"});o.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,H)[H]);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=null;o.Dom.removeClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function st(){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]===null){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,M)[M])}return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}function at({prompt:t},{copilotSettings:e}){if(babelHelpers.classPrivateFieldLooseBase(this,k)[k]!==null){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new a.BasicEditor({editable:!babelHelpers.classPrivateFieldLooseBase(this,G)[G],removePlugins:["BlockToolbar"],minHeight:250,maxHeight:400,content:t,placeholder:o.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER"),paragraphPlaceholder:o.Loc.getMessage(o.Type.isPlainObject(e)?"CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER_WITH_COPILOT":null),toolbar:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","copilot"],floatingToolbar:[],collapsingMode:false,copilot:{copilotOptions:o.Type.isPlainObject(e)?e:null,triggerBySpace:true}});return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}t.CallAssessment=q})(this.BX.Crm.Copilot=this.BX.Crm.Copilot||{},BX.Vue3,BX.UI,BX,BX.UI.TextEditor,BX,BX.UI.BBCode,BX,BX.UI);
//# sourceMappingURL=call-assessment.bundle.map.js