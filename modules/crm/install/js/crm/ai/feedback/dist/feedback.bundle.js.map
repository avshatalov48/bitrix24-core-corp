{"version":3,"file":"feedback.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { ajax as Ajax, Loc, Type } from 'main.core';\nimport { sendData } from 'ui.analytics';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport './css/feedback-popup.css';\n\n/**\n * @memberof BX.Crm.AI.Feedback\n */\nexport function showSendFeedbackPopupIfFeedbackWasNeverSent(\n\tmergeUuid: number,\n\townerType: string | number,\n\tactivityId: number,\n\tactivityDirection: string,\n): Promise\n{\n\treturn wasFeedbackSent(mergeUuid).then((wasSent) => {\n\t\tif (!wasSent)\n\t\t{\n\t\t\treturn showSendFeedbackPopup(mergeUuid, ownerType, activityId, activityDirection);\n\t\t}\n\n\t\t// eslint-disable-next-line promise/no-return-wrap\n\t\treturn Promise.resolve();\n\t});\n}\n\n/**\n * @memberof BX.Crm.AI.Feedback\n */\nexport function wasFeedbackSent(mergeUuid: number): Promise\n{\n\t// Ajax.runAction returns BX.Promise. I think it's not okay to return it from an exported function\n\treturn new Promise((resolve, reject) => {\n\t\tAjax.runAction('crm.timeline.ai.wasFeedbackSent', {\n\t\t\tdata: {\n\t\t\t\tmergeUuid,\n\t\t\t},\n\t\t})\n\t\t\t.then(({ data }) => {\n\t\t\t\tif (Type.isBoolean(data))\n\t\t\t\t{\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// eslint-disable-next-line prefer-promise-reject-errors\n\t\t\t.catch((...args) => reject(...args))\n\t\t;\n\t});\n}\n\n/**\n * @memberof BX.Crm.AI.Feedback\n */\nexport function sendFeedback(\n\tmergeUuid: number,\n\townerType: string | number,\n\tactivityId: number,\n\tactivityDirection: string,\n): void\n{\n\tAjax.runAction('crm.timeline.ai.sendFeedback', {\n\t\tdata: {\n\t\t\tmergeUuid,\n\t\t},\n\t})\n\t\t.then(() => {\n\t\t\tsendData(\n\t\t\t\tBuilder.AI.CallParsingEvent.createDefault(ownerType, activityId, Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_FEEDBACK_SEND)\n\t\t\t\t\t.setActivityDirection(activityDirection)\n\t\t\t\t\t.buildData(),\n\t\t\t);\n\n\t\t\tsendData(\n\t\t\t\tBuilder.AI.CallParsingEvent.createDefault(ownerType, activityId, Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t.setTool(Dictionary.TOOL_CRM)\n\t\t\t\t\t.setCategory(Dictionary.CATEGORY_AI_OPERATIONS)\n\t\t\t\t\t.setElement(Dictionary.ELEMENT_FEEDBACK_SEND)\n\t\t\t\t\t.setActivityDirection(activityDirection)\n\t\t\t\t\t.buildData(),\n\t\t\t);\n\t\t})\n\t\t.catch(({ errors }) => console.error('Error sending feedback', errors));\n}\n\n/**\n * @memberof BX.Crm.AI.Feedback\n */\nexport function showSendFeedbackPopup(\n\tmergeUuid: number,\n\townerType: string,\n\tactivityId: number,\n\tactivityDirection: string,\n): Promise\n{\n\treturn new Promise((resolve) => {\n\t\tconst messageBox = createFeedbackMessageBox({\n\t\t\tonOk: () => {\n\t\t\t\tsendFeedback(mergeUuid, ownerType, activityId, activityDirection);\n\t\t\t\tmessageBox.close();\n\t\t\t\tresolve();\n\t\t\t},\n\t\t\tonCancel: () => {\n\t\t\t\tmessageBox.close();\n\n\t\t\t\tsendData(\n\t\t\t\t\tBuilder.AI.CallParsingEvent.createDefault(ownerType, activityId, Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t\t.setElement(Dictionary.ELEMENT_FEEDBACK_REFUSED)\n\t\t\t\t\t\t.setActivityDirection(activityDirection)\n\t\t\t\t\t\t.buildData(),\n\t\t\t\t);\n\n\t\t\t\tsendData(\n\t\t\t\t\tBuilder.AI.CallParsingEvent.createDefault(ownerType, activityId, Dictionary.STATUS_SUCCESS)\n\t\t\t\t\t\t.setTool(Dictionary.TOOL_CRM)\n\t\t\t\t\t\t.setCategory(Dictionary.CATEGORY_AI_OPERATIONS)\n\t\t\t\t\t\t.setElement(Dictionary.ELEMENT_FEEDBACK_REFUSED)\n\t\t\t\t\t\t.setActivityDirection(activityDirection)\n\t\t\t\t\t\t.buildData(),\n\t\t\t\t);\n\n\t\t\t\tresolve();\n\t\t\t},\n\t\t});\n\n\t\tmessageBox.show();\n\t});\n}\n\ninterface FeedbackMessageBoxOpts {\n\tonOk: () => void,\n\tonCancel: () => void,\n\tpopupOptions?: {\n\t\ttargetContainer: any,\n\t\tid: string,\n\t}\n}\n\n/**\n * @memberof BX.Crm.AI.Feedback\n */\nexport function createFeedbackMessageBox(options: FeedbackMessageBoxOpts): MessageBox\n{\n\tconst message = `\n\t\t<div class=\"bx-crm-ai-feedback-popup-content\">\n\t\t\t<div class=\"bx-crm-ai-feedback-popup-content__icon\"></div>\n\t\t\t<div class=\"bx-crm-ai-feedback-popup-content__text\">\n\t\t\t\t${Loc.getMessage('CRM_AI_FEEDBACK_POPUP_TEXT')}\n\t\t\t</div>\n\t\t</div>\n\t`;\n\n\treturn MessageBox.create({\n\t\ttitle: Loc.getMessage('CRM_AI_FEEDBACK_POPUP_TITLE'),\n\t\tmessage,\n\t\tokCaption: Loc.getMessage('CRM_AI_FEEDBACK_POPUP_BUTTON_SHARE'),\n\t\tcancelCaption: Loc.getMessage('CRM_AI_FEEDBACK_POPUP_BUTTON_ANOTHER_TIME'),\n\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t...options,\n\t});\n}\n"],"names":["showSendFeedbackPopupIfFeedbackWasNeverSent","mergeUuid","ownerType","activityId","activityDirection","wasFeedbackSent","then","wasSent","showSendFeedbackPopup","Promise","resolve","reject","Ajax","runAction","data","Type","isBoolean","catch","args","sendFeedback","sendData","Builder","AI","CallParsingEvent","createDefault","Dictionary","STATUS_SUCCESS","setElement","ELEMENT_FEEDBACK_SEND","setActivityDirection","buildData","setTool","TOOL_CRM","setCategory","CATEGORY_AI_OPERATIONS","errors","console","error","messageBox","createFeedbackMessageBox","onOk","close","onCancel","ELEMENT_FEEDBACK_REFUSED","show","options","message","Loc","getMessage","MessageBox","create","title","okCaption","cancelCaption","buttons","BX","UI","Dialogs","MessageBoxButtons","OK_CANCEL"],"mappings":"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"}