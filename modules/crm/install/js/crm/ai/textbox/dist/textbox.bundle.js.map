{"version":3,"file":"textbox.bundle.js","sources":["../src/textbox.js"],"sourcesContent":["import { Dom, Loc, Tag, Type, Text, Event } from 'main.core';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport './style.css';\n\nexport class Textbox\n{\n\ttextContainerID = 'crm-copilot-text-container';\n\n\tsearchIcon = 'ui-ctl-icon-search';\n\tclearIcon = 'ui-ctl-icon-clear';\n\n\tsearchInputPlaceholder = Loc.getMessage('CRM_COPILOT_TEXTBOX_SEARCH_PLACEHOLDER');\n\n\tconstructor(options = {}): void\n\t{\n\t\tthis.setText(options.text);\n\t\tthis.title = (Type.isString(options.title)) ? options.title : '';\n\t\tthis.enableSearch = Type.isBoolean(options.enableSearch) ? options.enableSearch : true;\n\t\tthis.previousTextContent = Type.isElementNode(options.previousTextContent) ? options.previousTextContent : null;\n\t}\n\n\tsetText(text)\n\t{\n\t\tthis.text = (Type.isString(text)) ? this.prepareText(text) : '';\n\t}\n\n\tprepareText(text): String\n\t{\n\t\treturn text.replaceAll(/\\r?\\n/g, '<br>');\n\t}\n\n\trender(): void\n\t{\n\t\tthis.rootContainer = Tag.render`<div class=\"crm-copilot-textbox\"></div>`;\n\n\t\tDom.append(this.getHeaderContainer(), this.rootContainer);\n\t\tDom.append(this.getPreviousTextContainer(), this.rootContainer);\n\t\tDom.append(this.getContentContainer(), this.rootContainer);\n\t}\n\n\tget(): HTMLElement\n\t{\n\t\treturn this.rootContainer;\n\t}\n\n\tgetContentContainer(): HTMLElement\n\t{\n\t\tconst contentContainer = Tag.render`<div class=\"crm-copilot-textbox__content\"></div>`;\n\t\tconst textContainer = this.getTextContainer();\n\n\t\tEvent.bind(textContainer, 'beforeinput', (e) => {\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tDom.append(textContainer, contentContainer);\n\n\t\treturn contentContainer;\n\t}\n\n\tgetTextContainer(): HTMLElement\n\t{\n\t\tif (this.textContainer)\n\t\t{\n\t\t\treturn this.textContainer;\n\t\t}\n\n\t\tthis.textContainer = Tag.render`\n\t\t\t<div \n\t\t\t\tid=\"${this.textContainerID}\" \n\t\t\t\tclass=\"crm-copilot-textbox__text-container\" \n\t\t\t\tcontenteditable=\"true\" \n\t\t\t\tspellcheck=\"false\"\n\t\t\t>\n\t\t\t\t${this.text}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.textContainer;\n\t}\n\n\tgetHeaderContainer(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-copilot-textbox__header\">\n\t\t\t\t<div class=\"crm-copilot-textbox__title\">${Text.encode(this.title)}</div>\n\t\t\t\t${this.getSearchContainer()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetSearchContainer(): HTMLElement\n\t{\n\t\tif (!this.enableSearch)\n\t\t{\n\t\t\treturn Tag.render``;\n\t\t}\n\n\t\tconst searchNode = Tag.render`<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-no-border crm-copilot-textbox__search\"></div>`;\n\t\tconst searchBtn = Tag.render`<a class=\"ui-ctl-after ${this.searchIcon} crm-copilot-textbox__search-btn\"></a>`;\n\t\tconst searchInput = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tplaceholder=\"${Text.encode(this.searchInputPlaceholder)}\" \n\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox crm-copilot-textbox__search-input\"\n\t\t\t>\n\t\t`;\n\n\t\tsearchInput.oninput = () => {\n\t\t\tthis.resetTextContainer();\n\n\t\t\tconst value = searchInput.value;\n\t\t\tif (!value)\n\t\t\t{\n\t\t\t\tthis.switchStyle(searchBtn, this.clearIcon, this.searchIcon);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.switchStyle(searchBtn, this.searchIcon, this.clearIcon);\n\n\t\t\t// Highlights pieces of text that are not part of a tag\n\t\t\tconst regexp = new RegExp(`((?<!<[^>]*?)(${value})(?![^<]*?>))`, 'gi');\n\t\t\tconst textContainer = this.getTextContainer();\n\n\t\t\ttextContainer.innerHTML = textContainer.innerHTML.replace(regexp, '<span class=\"search-item\">$&</span>');\n\t\t};\n\n\t\tlet searchInputFocused = false;\n\t\tsearchInput.onblur = (event) => {\n\t\t\tif (searchInput.value.length === 0)\n\t\t\t{\n\t\t\t\tDom.removeClass(searchNode, 'with-input-node');\n\t\t\t\tDom.remove(searchInput);\n\t\t\t\tsearchInputFocused = false;\n\t\t\t}\n\t\t};\n\n\t\tsearchBtn.onclick = () => {\n\t\t\tif (searchNode.contains(searchInput))\n\t\t\t{\n\t\t\t\tif (searchInput.value.length > 0)\n\t\t\t\t{\n\t\t\t\t\tsearchInput.value = '';\n\t\t\t\t\tthis.switchStyle(searchBtn, this.clearIcon, this.searchIcon);\n\t\t\t\t\tthis.resetTextContainer();\n\t\t\t\t}\n\n\t\t\t\tsearchInputFocused = true;\n\t\t\t\tsearchInput.focus();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.append(searchInput, searchNode);\n\t\t\tDom.addClass(searchNode, ['with-input-node']);\n\n\t\t\tsearchInputFocused = true;\n\t\t\tsearchInput.focus();\n\t\t};\n\n\t\tsearchBtn.onmousedown = (event) => {\n\t\t\tif (searchInputFocused)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\tDom.append(searchBtn, searchNode);\n\n\t\treturn searchNode;\n\t}\n\n\tgetPreviousTextContainer(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-copilot-textbox__previous-text\">${this.previousTextContent}</div>`;\n\t}\n\n\tresetTextContainer(): void\n\t{\n\t\tthis.getTextContainer().innerHTML = this.text;\n\t}\n\n\tswitchStyle(node, fromStyle, toStyle): void\n\t{\n\t\tif (Dom.hasClass(node, fromStyle) && !Dom.hasClass(node, toStyle))\n\t\t{\n\t\t\tDom.addClass(node, toStyle);\n\t\t\tDom.removeClass(node, fromStyle);\n\t\t}\n\t}\n}\n"],"names":["Textbox","options","Loc","getMessage","setText","text","title","Type","isString","enableSearch","isBoolean","previousTextContent","isElementNode","prepareText","replaceAll","rootContainer","Tag","render","Dom","append","getHeaderContainer","getPreviousTextContainer","getContentContainer","contentContainer","textContainer","getTextContainer","Event","bind","e","preventDefault","textContainerID","Text","encode","getSearchContainer","searchNode","searchBtn","searchIcon","searchInput","searchInputPlaceholder","oninput","resetTextContainer","value","switchStyle","clearIcon","regexp","RegExp","innerHTML","replace","searchInputFocused","onblur","event","length","removeClass","remove","onclick","contains","focus","addClass","onmousedown","node","fromStyle","toStyle","hasClass"],"mappings":"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"}