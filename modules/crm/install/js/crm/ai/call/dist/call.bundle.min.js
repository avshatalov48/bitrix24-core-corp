this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,r,n,a){"use strict";var o;var l=function(){function e(t){var l,s=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"languageTitle",null);this.initDefaultOptions();this.activityId=t.activityId;this.ownerTypeId=t.ownerTypeId;this.ownerId=t.ownerId;this.languageTitle=(l=t.languageTitle)!==null&&l!==void 0?l:null;var u=a.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<div id="crm-textbox-audio-player"></div>'])));this.audioPlayerApp=new n.AudioPlayer({rootNode:u});this.textbox=new r.Textbox({title:this.textboxTitle,previousTextContent:u,attentions:this.getTextboxAttentions()});this.sliderId="".concat(this.id,"-").concat(Math.floor(Math.random()*1e3));this.wrapperSlider=new i.Slider({url:this.sliderId,sliderTitle:this.sliderTitle,width:this.sliderWidth,extensions:["crm.ai.textbox","crm.audio-player"],events:{onLoad:function e(){s.audioPlayerApp.attachTemplate()},onClose:function e(){s.audioPlayerApp.detachTemplate()}}})}babelHelpers.createClass(e,[{key:"open",value:function e(){var t=this;var i=new Promise((function(e,i){t.getAiJobResultAndCallRecord().then((function(i){var r=t.prepareAudioProps(i);t.audioPlayerApp.setAudioProps(r);var n=t.prepareAiJobResult(i);t.textbox.setText(n);t.textbox.render();e(t.textbox.get())}))["catch"]((function(e){t.showError(e);t.wrapperSlider.destroy()}))}));this.wrapperSlider.setContent(i);this.wrapperSlider.open()}},{key:"getAiJobResultAndCallRecord",value:function e(){var t={data:{activityId:this.activityId,ownerTypeId:this.ownerTypeId,ownerId:this.ownerId}};return BX.ajax.runAction(this.aiJobResultAndCallRecordAction,t)}},{key:"showError",value:function e(i){t.UI.Notification.Center.notify({content:i.errors[0].message,autoHideDelay:5e3})}},{key:"prepareAiJobResult",value:function e(t){return""}},{key:"prepareAudioProps",value:function e(t){var i=t.data.callRecord;return{id:i.id,src:i.src,title:i.title,context:window.top}}},{key:"getTextboxAttentions",value:function e(){var t=[this.getNotAccurateAttention()];var i=this.getJobLanguageAttention();if(i!==null){t.push(i)}return t}},{key:"getNotAccurateAttention",value:function e(){var t="20412666";var i=a.Loc.getMessage(this.getNotAccuratePhraseCode(),{"[helpdesklink]":'<a href="##" onclick="top.BX.Helper.show(\'redirect=detail&code='.concat(t,"');\">"),"[/helpdesklink]":"</a>"});return new r.Attention({content:i})}},{key:"getJobLanguageAttention",value:function e(){if(!a.Type.isStringFilled(this.languageTitle)){return null}var t="20423978";var i=a.Loc.getMessage("CRM_COPILOT_CALL_JOB_LANGUAGE_ATTENTION",{"#LANGUAGE_TITLE#":'<span style="text-transform: lowercase">'.concat(a.Text.encode(this.languageTitle),"</span>"),"[helpdesklink]":'<a href="##" onclick="top.BX.Helper.show(\'redirect=detail&code='.concat(t,"');\">"),"[/helpdesklink]":"</a>"});return new r.Attention({preset:r.AttentionPresets.COPILOT,content:i})}},{key:"getNotAccuratePhraseCode",value:function e(){return""}},{key:"getSliderTitle",value:function e(){return""}},{key:"getTextboxTitle",value:function e(){return""}},{key:"initDefaultOptions",value:function e(){}}]);return e}();var s=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"initDefaultOptions",value:function e(){this.id="crm-copilot-summary";this.aiJobResultAndCallRecordAction="crm.timeline.ai.getCopilotSummaryAndCallRecord";this.sliderTitle=a.Loc.getMessage("CRM_COMMON_COPILOT");this.sliderWidth=520;this.textboxTitle=a.Loc.getMessage("CRM_COPILOT_CALL_SUMMARY_TITLE")}},{key:"getNotAccuratePhraseCode",value:function e(){return"CRM_COPILOT_CALL_SUMMARY_NOT_BE_ACCURATE"}},{key:"prepareAiJobResult",value:function e(t){return t.data.aiJobResult.summary}}]);return t}(l);var u=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"initDefaultOptions",value:function e(){this.id="crm-copilot-transcript";this.aiJobResultAndCallRecordAction="crm.timeline.ai.getCopilotTranscriptAndCallRecord";this.sliderTitle=a.Loc.getMessage("CRM_COMMON_COPILOT");this.sliderWidth=730;this.textboxTitle=a.Loc.getMessage("CRM_COPILOT_CALL_TRANSCRIPT_TITLE")}},{key:"getNotAccuratePhraseCode",value:function e(){return"CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE"}},{key:"prepareAiJobResult",value:function e(t){return t.data.aiJobResult.transcription}}]);return t}(l);var c={Summary:s,Transcription:u};e.Call=c})(this.BX.Crm.AI=this.BX.Crm.AI||{},BX,BX.Crm.AI,BX.Crm.AI,BX.Crm,BX);
//# sourceMappingURL=call.bundle.map.js