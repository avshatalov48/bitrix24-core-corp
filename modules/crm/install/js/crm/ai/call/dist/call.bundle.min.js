this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,n,s,a,l,r,o,c,u,d,p,v,h,_,m){"use strict";var b;var g=function(){function t(e){var s;babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"languageTitle",null);this.initDefaultOptions();this.activityId=e.activityId;this.ownerTypeId=e.ownerTypeId;this.ownerId=e.ownerId;this.languageTitle=(s=e.languageTitle)!==null&&s!==void 0?s:null;this.audioPlayerNode=m.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<div id="crm-textbox-audio-player"></div>'])));this.audioPlayerApp=new a.AudioPlayer({rootNode:this.audioPlayerNode});this.textbox=new n.Textbox({title:this.textboxTitle,previousTextContent:this.audioPlayerNode,attentions:this.getTextboxAttentions()});this.sliderId="".concat(this.id,"-").concat(this.activityId);this.wrapperSlider=new i.Slider({url:this.sliderId,sliderTitle:this.sliderTitle,sliderContentClass:this.getSliderContentClass(),width:this.sliderWidth,extensions:this.getExtensions(),design:this.getSliderDesign(),events:this.getSliderEvents(),toolbar:this.getSliderToolbar()})}babelHelpers.createClass(t,[{key:"getExtensions",value:function t(){return["crm.ai.textbox","crm.audio-player"]}},{key:"getSliderContentClass",value:function t(){return null}},{key:"getSliderDesign",value:function t(){return null}},{key:"getSliderToolbar",value:function t(){return null}},{key:"getSliderEvents",value:function t(){var e=this;return{onLoad:function t(){e.audioPlayerApp.attachTemplate()},onClose:function t(){e.audioPlayerApp.detachTemplate()}}}},{key:"open",value:function t(){var e=this;var i=new Promise((function(t,i){e.getAiJobResultAndCallRecord().then((function(i){var n=e.prepareAudioProps(i);e.audioPlayerApp.setAudioProps(n);var s=e.prepareAiJobResult(i);e.textbox.setText(s);e.textbox.render();t(e.textbox.get())}))["catch"]((function(t){e.showError(t);e.wrapperSlider.destroy()}))}));this.wrapperSlider.setContent(i);this.wrapperSlider.open()}},{key:"getAiJobResultAndCallRecord",value:function t(){var e={data:{activityId:this.activityId,ownerTypeId:this.ownerTypeId,ownerId:this.ownerId}};return BX.ajax.runAction(this.aiJobResultAndCallRecordAction,e)}},{key:"showError",value:function t(e){s.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3})}},{key:"prepareAiJobResult",value:function t(e){return""}},{key:"prepareAudioProps",value:function t(e){var i=e.data.callRecord;return{id:i.id,src:i.src,title:i.title,context:window.top}}},{key:"getTextboxAttentions",value:function t(){var e=[this.getNotAccurateAttention()];var i=this.getJobLanguageAttention();if(i!==null){e.push(i)}return e}},{key:"getNotAccurateAttention",value:function t(){var e="20412666";var i=m.Loc.getMessage(this.getNotAccuratePhraseCode(),{"[helpdesklink]":'<a href="##" onclick="top.BX.Helper.show(\'redirect=detail&code='.concat(e,"');\">"),"[/helpdesklink]":"</a>"});return new n.Attention({content:i})}},{key:"getJobLanguageAttention",value:function t(){if(!m.Type.isStringFilled(this.languageTitle)){return null}var e="20423978";var i=m.Loc.getMessage("CRM_COPILOT_CALL_JOB_LANGUAGE_ATTENTION",{"#LANGUAGE_TITLE#":'<span style="text-transform: lowercase">'.concat(m.Text.encode(this.languageTitle),"</span>"),"[helpdesklink]":'<a href="##" onclick="top.BX.Helper.show(\'redirect=detail&code='.concat(e,"');\">"),"[/helpdesklink]":"</a>"});return new n.Attention({preset:n.AttentionPresets.COPILOT,content:i})}},{key:"getNotAccuratePhraseCode",value:function t(){return""}},{key:"getSliderTitle",value:function t(){return""}},{key:"getTextboxTitle",value:function t(){return""}},{key:"initDefaultOptions",value:function t(){}}]);return t}();function f(t,e,i){T(t,e);e.set(t,i)}function T(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var S="call_scoring_add";var C="call_assessment_update";var A=new WeakMap;var L=new WeakMap;var y=new WeakMap;var I=new WeakMap;var P=function(){function t(e,i){babelHelpers.classCallCheck(this,t);f(this,A,{writable:true,value:void 0});f(this,L,{writable:true,value:void 0});f(this,y,{writable:true,value:null});f(this,I,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,A,e);babelHelpers.classPrivateFieldSet(this,L,i)}babelHelpers.createClass(t,[{key:"init",value:function t(){var e=this;if(!l.PULL){console.error("pull is not initialized");return}babelHelpers.classPrivateFieldSet(this,y,l.PULL.subscribe({moduleId:"crm",command:S,callback:function t(i){if(m.Type.isStringFilled(i.eventId)&&r.QueueManager.eventIds.has(i.eventId)){return}babelHelpers.classPrivateFieldGet(e,A).call(e,i)}}));babelHelpers.classPrivateFieldSet(this,I,l.PULL.subscribe({moduleId:"crm",command:C,callback:function t(i){if(m.Type.isStringFilled(i.eventId)&&r.QueueManager.eventIds.has(i.eventId)){return}babelHelpers.classPrivateFieldGet(e,L).call(e,i)}}));l.PULL.extendWatch(S);l.PULL.extendWatch(C)}},{key:"unsubscribe",value:function t(){babelHelpers.classPrivateFieldGet(this,y).call(this);babelHelpers.classPrivateFieldGet(this,I).call(this)}}]);return t}();var w=Object.freeze({usedNotAssessmentScript:"usedNotAssessmentScript",usedCurrentVersionOfScript:"usedCurrentVersionOfScript",usedOtherVersionOfScript:"usedOtherVersionOfScript",emptyScriptList:"emptyScriptList",assessmentSettingsPending:"assessmentSettingsPending",pending:"pending",error:"error"});var M={props:{title:{type:String,required:true},assessment:{type:Number,default:null},lowBorder:{type:Number,default:30},highBorder:{type:Number,default:70},viewMode:{type:String,default:null}},mounted:function t(){this.startAnimate()},methods:{startAnimate:function t(){if(this.$refs.assessment){this.animateCounter(this.$refs.assessment,this.assessment)}},animateCounter:function t(e,i){var n=0;var s=1500;var a=i/(s/50);var l=setInterval((function(){n+=a;if(n>=i){n=i;clearInterval(l)}e.textContent=Math.floor(n)}),50)}},computed:{classList:function t(){return{"call-quality__compliance__container":true,"--empty-state":!this.isUsedCurrentVersionOfScript,"--low":this.assessment<=this.lowBorder,"--high":this.assessment>=this.highBorder}},isUsedCurrentVersionOfScript:function t(){return this.viewMode===w.usedCurrentVersionOfScript},infoTitle:function t(){return this.viewMode===w.emptyScriptList?m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_TITLE"):m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_COMPLIANCE_TITLE")},valueTitle:function t(){return this.viewMode===w.emptyScriptList?m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_VALUE"):this.title}},template:'\n\t\t<div :class="classList">\n\t\t\t<div class="call-quality__compliance">\n\t\t\t\t<div\n\t\t\t\t\tv-if="isUsedCurrentVersionOfScript"\n\t\t\t\t\tclass="call-quality__compliance__assessment"\n\t\t\t\t>\n\t\t\t\t\t<span ref="assessment" class="call-quality__compliance__assessment-value">\n\t\t\t\t\t\t{{ assessment }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="call-quality__compliance__assessment-measure">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__compliance__info">\n\t\t\t\t\t<span class="call-quality__compliance__info-title">\n\t\t\t\t\t\t{{ infoTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="call-quality__compliance__info-value">\n\t\t\t\t\t\t{{ valueTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var O={mounted:function t(){this.renderLottieAnimation()},methods:{renderLottieAnimation:function t(){var e=o.Lottie.loadAnimation({path:this.getAnimationPath(),container:this.$refs.lottie,renderer:"svg",loop:true,autoplay:true});e.setSpeed(.75);return this.$refs.lottie.root},getAnimationPath:function t(){return"/bitrix/js/crm/ai/call/src/call-quality/lottie/loader.json"}},template:'\n\t\t<div ref="lottie" class="call-quality__explanation-loader__lottie"></div>\n\t'};var E={components:{Loader:O},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text">\n\t\t\t\t\t<div class="call-quality__explanation-loader__container">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class="call-quality__explanation-loader__lottie-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TEXT\') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var x={computed:{title:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TITLE")},text:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TEXT")}},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text" v-html="text">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var N={data:function t(){return{errorText:null}},methods:{setErrorMessage:function t(e){this.errorText=e}},computed:{explanationText:function t(){return m.Type.isStringFilled(this.errorText)?this.errorText:m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_ERROR_TEXT")}},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container --error">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_ERROR_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text">\n\t\t\t\t\t{{ explanationText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var R={methods:{doAssessment:function t(){this.$emit("doAssessment")}},computed:{title:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TITLE")},text:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TEXT")},buttonText:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_ASSESSMENT")}},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container ">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text" v-html="text">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="call-quality__explanation__buttons-container">\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active"\n\t\t\t\t\t@click="doAssessment"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'};var H={methods:{showAssessment:function t(){this.$emit("showAssessment")},doAssessment:function t(){this.$emit("doAssessment")}},computed:{title:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TITLE")},text:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TEXT")},buttonShowText:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_SHOW_ASSESSMENT")},buttonDoText:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_ASSESSMENT")}},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container ">\n\t\t\t\t<div class="call-quality__explanation-title" v-html="title">\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text" v-html="text">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="call-quality__explanation__buttons-container">\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active"\n\t\t\t\t\t@click="doAssessment"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonDoText }}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-no-caps ui-btn-light-border ui-btn-round"\n\t\t\t\t\t@click="showAssessment"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonShowText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'};var k={components:{Loader:O},template:'\n\t\t<div class="call-quality__explanation">\n\t\t\t<div class="call-quality__explanation__container">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_PENDING_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text">\n\t\t\t\t\t<div class="call-quality__explanation-loader__container">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class="call-quality__explanation-loader__lottie-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_PENDING_TEXT\') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var B="23240682";var q="20412666";var U={props:{recommendations:{type:String,default:null},summary:{type:String,default:null},useInRating:{type:Boolean,default:false}},methods:{showArticle:function t(){var e,i;(e=window.top.BX)===null||e===void 0?void 0:(i=e.Helper)===null||i===void 0?void 0:i.show("redirect=detail&code=".concat(B))}},computed:{disclaimer:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_EXPLANATION_DISCLAIMER",{"#LINK_START#":"<a onclick='window.top.BX?.Helper?.show(`redirect=detail&code=".concat(q,'`)\' href="#">'),"#LINK_END#":"</a>"})}},template:'\n\t\t<div class="call-quality__explanation --copilot-content">\n\t\t\t<div class="call-quality__explanation__container ">\n\t\t\t\t<div class="call-quality__explanation-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_EXPLANATION_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-text">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if="!useInRating"\n\t\t\t\t\t\tclass="call-quality__explanation-badge"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_EXPLANATION_NOT_IN_RATING\') }}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="call-quality__explanation-badge-article ui-icon-set --help"\n\t\t\t\t\t\t\t\t@click="showArticle"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ summary }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ recommendations }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__explanation-disclaimer" v-html="disclaimer">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var D,F;function X(t,e){Q(t,e);e.add(t)}function G(t,e,i){Q(t,e);e.set(t,i)}function Q(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Y(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var V=new WeakMap;var W=new WeakMap;var $=new WeakSet;var j=function(){function t(){babelHelpers.classCallCheck(this,t);X(this,$);G(this,V,{writable:true,value:void 0});G(this,W,{writable:true,value:false});babelHelpers.classPrivateFieldSet(this,V,Y(this,$,z).call(this))}babelHelpers.createClass(t,[{key:"getTargetNode",value:function t(){return this.titleNode}},{key:"updateTitle",value:function t(e){this.innerTitleNode.innerText=e;this.innerTitleNode.title=e}},{key:"setLoading",value:function t(e){if(babelHelpers.classPrivateFieldGet(this,W)===e){return}babelHelpers.classPrivateFieldSet(this,W,e);m.Dom.toggleClass(babelHelpers.classPrivateFieldGet(this,V),"--loading")}}]);return t}();function z(){this.innerTitleNode=m.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(["<span></span>"])));this.titleNode=m.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="call-quality__script-selector">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.innerTitleNode);return this.titleNode}var J="23240682";var Z="SUCCESS";var K="PENDING";var tt={props:{assessmentSettingsId:{type:Number,required:true},assessmentSettingsStatus:{type:String,default:Z},assessmentSettingsTitle:{type:String,required:true},isPromptChanged:{type:Boolean,required:true},promptUpdatedAt:{type:String,required:true},prompt:{type:String,required:true},viewMode:{type:String,default:""}},data:function t(){return{callAssessmentSelector:this.getCallAssessmentSelector(),htmlFormatter:new v.HtmlFormatter}},methods:{getCallAssessmentSelector:function t(){return new c.CallAssessmentSelector({currentCallAssessment:{id:this.assessmentSettingsId,title:this.assessmentSettingsId>0?this.assessmentSettingsTitle:m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE")},emptyScriptListTitle:m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE"),displayStrategy:new j,additionalSelectorOptions:{dialog:{events:{"Item:onBeforeSelect":this.onBeforeSelect.bind(this)}},popup:{events:{onShow:function t(e){var i=h.SidePanel.Instance.getTopSlider().getZindex()+1;e.target.getZIndexComponent().setZIndex(i)}}}}})},onBeforeSelect:function t(e){var i;this.$emit("onBeforeSelect",(i=this.callAssessmentSelector.getCurrentCallAssessmentItem())===null||i===void 0?void 0:i.id)},onEditCallAssessmentSettings:function t(e){var i=e.target;if(this.assessmentSettingsStatus===K){this.showDisabledButtonHint(i);return}u.Router.openSlider("/crm/copilot-call-assessment/details/".concat(this.assessmentSettingsId,"/"),{width:700,cacheable:false})},onShowActualPrompt:function t(){this.$emit("onShowActualPrompt")},showArticle:function t(){var e,i;(e=window.top.BX)===null||e===void 0?void 0:(i=e.Helper)===null||i===void 0?void 0:i.show("redirect=detail&code=".concat(J))},formatHtml:function t(e){return this.htmlFormatter.format({source:e})},close:function t(){var e;(e=this.callAssessmentSelector)===null||e===void 0?void 0:e.close()},disable:function t(){var e;(e=this.callAssessmentSelector)===null||e===void 0?void 0:e.disable()},enable:function t(){var e;(e=this.callAssessmentSelector)===null||e===void 0?void 0:e.enable()},doAssessment:function t(e){var i=e.target;if(this.assessmentSettingsStatus===K){this.showDisabledButtonHint(i);return}this.$emit("doAssessment")},showDisabledButtonHint:function t(e){top.BX.UI.Hint.popupParameters={closeByEsc:true,autoHide:true,angle:null,events:{}};m.Runtime.debounce((function(){top.BX.UI.Hint.show(e,m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_SCRIPT_DISABLED_DO_ASSESSMENT_HINT"),true)}),150,this)()},isDisabledAssessmentButton:function t(){return this.assessmentSettingsStatus!==Z},isDisabledEditButton:function t(){return this.assessmentSettingsStatus===K}},mounted:function t(){m.Dom.append(this.callAssessmentSelector.getContainer(),this.$refs.container);if(this.$refs.prompt){m.Dom.append(this.formattedPrompt,this.$refs.prompt)}},computed:{scriptUpdatedAt:function t(){var e=new Date(this.promptUpdatedAt);var i=new d.DatetimeConverter(e);var n=i.toDatetimeString({withDayOfWeek:false,delimiter:", "});return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_UPDATED",{"#UPDATED_AT#":n})},formattedPrompt:function t(){return this.formatHtml(this.prompt)},isShowFooterButtons:function t(){return this.viewMode!==w.usedOtherVersionOfScript&&this.viewMode!==w.usedNotAssessmentScript&&this.viewMode!==w.pending&&this.assessmentSettingsId>0},footerButtonClassList:function t(){return["ui-btn","ui-btn-xs","ui-btn-no-caps","ui-btn-light-border","ui-btn-round",{"ui-btn-disabled":this.isDisabledAssessmentButton()}]},footerEditButtonClassList:function t(){return["ui-btn","ui-btn-xs","ui-btn-no-caps","ui-btn-round","ui-btn-light","edit-button",{"ui-btn-disabled":this.isDisabledEditButton()}]},isEmptyScriptListViewMode:function t(){return this.viewMode===w.emptyScriptList}},watch:{prompt:function t(){m.Dom.clean(this.$refs.prompt);m.Dom.append(this.formattedPrompt,this.$refs.prompt)}},template:'\n\t\t<div>\n\t\t\t<div class="call-quality__script-selector__container">\n\t\t\t\t<div class="call-quality__script-selector__title">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_SCRIPT_SELECTOR_TITLE\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="call-quality__script-selector__selector-container" ref="container"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="call-quality__script-selector__article ui-icon-set --help"\n\t\t\t\t\t\t@click="showArticle"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="this.isPromptChanged && isShowFooterButtons"\n\t\t\t\tclass="call-quality__script-info__container"\n\t\t\t>\n\t\t\t\t<span>{{scriptUpdatedAt}}</span>\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-no-caps ui-btn-round ui-btn-link ui-btn-active"\n\t\t\t\t\t@click="onShowActualPrompt"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_SHOW_NEW_PROMPT\') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="call-quality__script-container">\n\t\t\t\t<div\n\t\t\t\t\tv-if="isEmptyScriptListViewMode"\n\t\t\t\t\tclass="call-quality__script-text"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_PROMPT_TEXT\') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="call-quality__script-text" ref="prompt">\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div\n\t\t\t\t\tv-if="isShowFooterButtons"\n\t\t\t\t\tclass="call-quality__script-footer"\n\t\t\t\t>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class="footerButtonClassList"\n\t\t\t\t\t\t@click="doAssessment"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_SCRIPT_ASSESSMENT_REPLY\') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class="footerEditButtonClassList"\n\t\t\t\t\t\t@click="onEditCallAssessmentSettings"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_COPILOT_CALL_QUALITY_SCRIPT_EDIT\') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function et(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function it(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?et(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):et(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var nt={components:{AudioPlayerComponent:a.AudioPlayerComponent,ScriptSelectorComponent:tt,RecommendationBlock:U,OtherScriptBlock:H,NotAssessmentScriptBlock:R,AssessmentSettingsPendingBlock:E,PendingBlock:k,ErrorBlock:N,EmptyScriptListBlock:x,ComplianceComponent:M},props:{client:{type:Object,required:true},data:{type:Object,required:true},audioProps:{type:Object,required:true},context:{type:Object,required:true}},data:function t(){var e;var i=this.getPreparedQualityProps(this.data);var n=i.prompt;var s=(e=i.id)!==null&&e!==void 0?e:null;var a=null;if(this.data.viewMode===w.usedNotAssessmentScript){a=w.usedNotAssessmentScript}else if(this.data.viewMode===w.pending){a=w.pending}else if(this.data.viewMode===w.emptyScriptList){a=w.emptyScriptList}else if(i.id){var l;a=(l=this.data.viewMode)!==null&&l!==void 0?l:w.usedCurrentVersionOfScript}else{a=w.error}return{quality:i,currentQualityAssessmentId:s,viewMode:a,prompt:n,isShowAudioPlayer:false,direction:this.data.callDirection}},mounted:function t(){top.BX.Event.EventEmitter.subscribe("crm:copilot:callAssessment:beforeSave",this.onBeforeAssessmentSettingsChange);top.BX.Event.EventEmitter.subscribe("crm:copilot:callAssessment:save",this.onAssessmentSettingsChange);this.pull=new P(this.onPullChangeScript,this.onPullChangeAssessment);this.pull.init()},methods:{onBeforeAssessmentSettingsChange:function t(e){var i=e.getData(),n=i.data;if(!this.isPromptChanged(n.prompt)){return}this.quality.assessmentSettingsStatus="PENDING"},onAssessmentSettingsChange:function t(e){var i=e.getData(),n=i.id,s=i.data;if(!this.isPromptChanged(s.prompt)){return}this.onChangeScript(n)},isPromptChanged:function t(e){return this.quality.actualPrompt!==e},showAudioPlayer:function t(){this.isShowAudioPlayer=true},onShowActualPrompt:function t(){this.viewMode=w.usedOtherVersionOfScript;this.prompt=this.quality.actualPrompt},onShowCurrentAssessment:function t(){this.viewMode=w.usedCurrentVersionOfScript;this.prompt=this.quality.prompt},onDoAssessment:function t(){var e,i=this;this.viewMode=w.pending;(e=this.$refs.scriptSelector)===null||e===void 0?void 0:e.disable();var n={data:it(it({},this.context),{},{assessmentSettingsId:this.quality.assessmentSettingsId})};m.ajax.runAction("crm.copilot.callqualityassessment.doAssessment",n).then((function(t){var e;var n=t.status,s=t.data;(e=i.$refs.scriptSelector)===null||e===void 0?void 0:e.enable();if(n!=="success"){i.showError(t);return}p.EventEmitter.emit("crm.ai.callQuality:doAssessment",{data:s})}))["catch"]((function(t){var e;i.showError(t);(e=i.$refs.scriptSelector)===null||e===void 0?void 0:e.enable()}))},onChangeScript:function t(e){var i=this;var n={data:it(it({},this.context),{},{assessmentSettingsId:e})};m.ajax.runAction("crm.copilot.callqualityassessment.get",n).then((function(t){var e;(e=i.$refs.scriptSelector)===null||e===void 0?void 0:e.enable();var n=t.status,s=t.data;if(n!=="success"){i.showError(t);return}if(m.Type.isObject(s)){i.quality=i.getPreparedQualityProps(s);if(!(i.quality.isPromptChanged&&s.viewMode===w.assessmentSettingsPending)){i.viewMode=s.viewMode}}}))["catch"]((function(t){var e;(e=i.$refs.scriptSelector)===null||e===void 0?void 0:e.enable();top.BX.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3})}))},showError:function t(e){var i=this;this.viewMode=w.error;this.$nextTick((function(){var t,n;(t=i.$refs.errorBlock)===null||t===void 0?void 0:t.setErrorMessage((n=e.errors[0])===null||n===void 0?void 0:n.message)}))},getPreparedQualityProps:function t(e){var i,n,s,a,l,r,o,c,u,d,p,v,h,_,b,g,f;var T=e.callQuality;if(!m.Type.isPlainObject(T)){T={}}return{id:Number((i=T.ID)!==null&&i!==void 0?i:0),createdAt:(n=T.CREATED_AT)!==null&&n!==void 0?n:null,assessmentSettingsId:Number((s=T.ASSESSMENT_SETTING_ID)!==null&&s!==void 0?s:0),assessmentSettingsStatus:(a=T.ASSESSMENT_SETTINGS_STATUS)!==null&&a!==void 0?a:null,assessment:Number((l=T.ASSESSMENT)!==null&&l!==void 0?l:0),assessmentAvg:Number((r=T.ASSESSMENT_AVG)!==null&&r!==void 0?r:0),prevAssessmentAvg:Number((o=T.PREV_ASSESSMENT_AVG)!==null&&o!==void 0?o:0),isPromptChanged:Boolean((c=T.IS_PROMPT_CHANGED)!==null&&c!==void 0?c:false),useInRating:Boolean((u=T.USE_IN_RATING)!==null&&u!==void 0?u:false),prompt:(d=T.PROMPT)!==null&&d!==void 0?d:"",actualPrompt:(p=T.ACTUAL_PROMPT)!==null&&p!==void 0?p:"",promptUpdatedAt:(v=T.PROMPT_UPDATED_AT)!==null&&v!==void 0?v:"",title:(h=T.TITLE)!==null&&h!==void 0?h:"",recommendations:(_=T.RECOMMENDATIONS)!==null&&_!==void 0?_:"",summary:(b=T.SUMMARY)!==null&&b!==void 0?b:"",lowBorder:Number((g=T.LOW_BORDER)!==null&&g!==void 0?g:30),highBorder:Number((f=T.HIGH_BORDER)!==null&&f!==void 0?f:70)}},close:function t(){var e;(e=this.$refs.scriptSelector)===null||e===void 0?void 0:e.close();this.pull.unsubscribe();top.BX.Event.EventEmitter.unsubscribe("crm:copilot:callAssessment:beforeSave",this.onBeforeAssessmentSettingsChange);top.BX.Event.EventEmitter.unsubscribe("crm:copilot:callAssessment:save",this.onAssessmentSettingsChange)},onPullChangeScript:function t(e){if(this.context.activityId!==e.activityId){return}if(e.status==="error"||!m.Type.isNumber(e.assessmentSettingsId)){this.viewMode=w.error}else{this.onChangeScript(e.assessmentSettingsId)}},onPullChangeAssessment:function t(e){var i;var n=(i=e.assessmentSettingsId)!==null&&i!==void 0?i:null;var s=this.quality.assessmentSettingsId;if(n!==s){return}this.onChangeScript(n)}},watch:{quality:{handler:function t(e){this.prompt=e.prompt},deep:true}},computed:{clientNameClassList:function t(){return{"call-quality__call-client-name":true,"--incoming":Number(this.direction)===1,"--outgoing":Number(this.direction)===2}},clientName:function t(){return m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_AI_CALL_TITLE",{"[clientname]":'<a href="'.concat(this.client.detailUrl,'">'),"[/clientname]":"</a>","#CLIENT_NAME#":m.Text.encode(this.client.fullName)})},formattedDate:function t(){var e=d.DatetimeConverter.createFromServerTimestamp(this.client.activityCreated);return e.toDatetimeString({withDayOfWeek:false,delimiter:", "})},isUsedCurrentVersionOfScriptViewMode:function t(){return this.viewMode===w.usedCurrentVersionOfScript},isUsedOtherVersionOfScriptViewMode:function t(){return this.viewMode===w.usedOtherVersionOfScript},isUsedNotAssessmentScriptViewMode:function t(){return this.viewMode===w.usedNotAssessmentScript},isAssessmentSettingsPendingViewMode:function t(){return this.viewMode===w.assessmentSettingsPending},isPendingViewMode:function t(){return this.viewMode===w.pending},isErrorViewMode:function t(){return this.viewMode===w.error},isEmptyScriptListViewMode:function t(){return this.viewMode===w.emptyScriptList}},template:'\n\t\t<div class="call-quality__column --info">\n\t\t\t<div>\n\t\t\t\t<div class="call-quality__header">\n\t\t\t\t\t<div class="call-quality__header-row --flex">\n\t\t\t\t\t\t<div :class="clientNameClassList" v-html="clientName">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="call-quality__call-date">\n\t\t\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="call-quality__header-row">\n\t\t\t\t\t\t<div id="crm-textbox-audio-player" ref="audioPlayer">\n\t\t\t\t\t\t\t<AudioPlayerComponent v-if="isShowAudioPlayer" v-bind="audioProps" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<ComplianceComponent \n\t\t\t\t\t:assessment="quality.assessment"\n\t\t\t\t\t:title="quality.title"\n\t\t\t\t\t:viewMode="viewMode"\n\t\t\t\t\t:lowBorder="quality.lowBorder"\n\t\t\t\t\t:highBorder="quality.highBorder"\n\t\t\t\t/>\n\t\t\t\t<RecommendationBlock\n\t\t\t\t\tv-if="isUsedCurrentVersionOfScriptViewMode"\n\t\t\t\t\t:recommendations="quality.recommendations"\n\t\t\t\t\t:summary="quality.summary"\n\t\t\t\t\t:use-in-rating="quality.useInRating"\n\t\t\t\t/>\n\t\t\t\t<OtherScriptBlock\n\t\t\t\t\tv-if="isUsedOtherVersionOfScriptViewMode"\n\t\t\t\t\t@showAssessment="onShowCurrentAssessment"\n\t\t\t\t\t@doAssessment="onDoAssessment"\n\t\t\t\t/>\n\t\t\t\t<NotAssessmentScriptBlock\n\t\t\t\t\tv-if="isUsedNotAssessmentScriptViewMode"\n\t\t\t\t\t@doAssessment="onDoAssessment"\n\t\t\t\t/>\n\t\t\t\t<AssessmentSettingsPendingBlock v-if="isAssessmentSettingsPendingViewMode"/>\n\t\t\t\t<PendingBlock v-if="isPendingViewMode"/>\n\t\t\t\t<ErrorBlock v-if="isErrorViewMode" ref="errorBlock"/>\n\t\t\t\t<EmptyScriptListBlock v-if="isEmptyScriptListViewMode"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="call-quality__column --prompt">\n\t\t\t<ScriptSelectorComponent\n\t\t\t\tref="scriptSelector"\n\t\t\t\t:assessmentSettingsId="quality.assessmentSettingsId"\n\t\t\t\t:assessmentSettingsStatus="quality.assessmentSettingsStatus"\n\t\t\t\t:assessmentSettingsTitle="quality.title"\n\t\t\t\t:isPromptChanged="quality.isPromptChanged"\n\t\t\t\t:promptUpdatedAt="quality.promptUpdatedAt"\n\t\t\t\t:prompt="prompt"\n\t\t\t\t:viewMode="viewMode"\n\t\t\t\t@onBeforeSelect="onChangeScript"\n\t\t\t\t@onShowActualPrompt="onShowActualPrompt"\n\t\t\t\t@doAssessment="onDoAssessment"\n\t\t\t/>\n\t\t</div>\n\t'};var st,at,lt,rt,ot;function ct(t,e){dt(t,e);e.add(t)}function ut(t,e,i){dt(t,e);e.set(t,i)}function dt(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function pt(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var vt=Object.freeze({up:1,down:-1,noChanges:0});var ht="23240682";var _t="rate";var mt=new WeakMap;var bt=new WeakMap;var gt=new WeakMap;var ft=new WeakMap;var Tt=new WeakMap;var St=new WeakMap;var Ct=new WeakMap;var At=new WeakSet;var Lt=new WeakSet;var yt=new WeakSet;var It=new WeakSet;var Pt=new WeakSet;var wt=new WeakSet;var Mt=new WeakSet;var Ot=function(){function t(){babelHelpers.classCallCheck(this,t);ct(this,Mt);ct(this,wt);ct(this,Pt);ct(this,It);ct(this,yt);ct(this,Lt);ct(this,At);ut(this,mt,{writable:true,value:void 0});ut(this,bt,{writable:true,value:null});ut(this,gt,{writable:true,value:null});ut(this,ft,{writable:true,value:null});ut(this,Tt,{writable:true,value:ht});ut(this,St,{writable:true,value:_t});ut(this,Ct,{writable:true,value:true});babelHelpers.classPrivateFieldSet(this,mt,"crm.ai.call.quality-rating-".concat(m.Text.getRandom()))}babelHelpers.createClass(t,[{key:"render",value:function t(){var e=babelHelpers.classPrivateFieldGet(this,Ct)?pt(this,At,Et).call(this):pt(this,Lt,xt).call(this);return m.Tag.render(st||(st=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="call-quality__rating__container">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,mt),e)}},{key:"setRating",value:function t(e){babelHelpers.classPrivateFieldSet(this,bt,e)}},{key:"setPrevRating",value:function t(e){babelHelpers.classPrivateFieldSet(this,gt,e)}},{key:"setUserPhotoUrl",value:function t(e){babelHelpers.classPrivateFieldSet(this,ft,e)}},{key:"setSkeletonMode",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(babelHelpers.classPrivateFieldGet(this,Ct)!==e){babelHelpers.classPrivateFieldSet(this,Ct,e);pt(this,Mt,Bt).call(this)}}}]);return t}();function Et(){return m.Tag.render(at||(at=babelHelpers.taggedTemplateLiteral(["<div></div>"])))}function xt(){return m.Tag.render(lt||(lt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="call-quality__rating__text-container">\n\t\t\t\t','\n\t\t\t\t<div \n\t\t\t\t\tclass="call-quality__rating_article ui-icon-set --help"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class="call-quality__rating__value-container">\n\t\t\t\t','\n\t\t\t\t<div class="call-quality__rating__value">\n\t\t\t\t\t','\n\t\t\t\t\t<span class="call-quality__rating__measure">%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="call-quality__rating__trend ','"></div>\n\t\t\t</div>\n\t\t'])),m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_RATING"),pt(this,wt,kt).bind(this),pt(this,yt,Nt).call(this),babelHelpers.classPrivateFieldGet(this,bt),pt(this,It,Rt).call(this))}function Nt(){if(m.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,ft))){return m.Tag.render(rt||(rt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="call-quality__rating__avatar"\n\t\t\t\t\tstyle="background-image: url(',')"\n\t\t\t\t></div>\n\t\t\t'])),encodeURI(babelHelpers.classPrivateFieldGet(this,ft)))}return m.Tag.render(ot||(ot=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="call-quality__rating__avatar ui-icon ui-icon-common-user">\n\t\t\t\t<i style=""></i>\n\t\t\t</div>\n\t\t'])))}function Rt(){var t=pt(this,Pt,Ht).call(this);if(t===vt.up){return"--up"}if(t===vt.down){return"--down"}return"--no-changes"}function Ht(){if(babelHelpers.classPrivateFieldGet(this,bt)>babelHelpers.classPrivateFieldGet(this,gt)){return vt.up}if(babelHelpers.classPrivateFieldGet(this,bt)<babelHelpers.classPrivateFieldGet(this,gt)){return vt.down}return vt.noChanges}function kt(){var t,e;(t=window.top.BX)===null||t===void 0?void 0:(e=t.Helper)===null||e===void 0?void 0:e.show("redirect=detail&code=".concat(babelHelpers.classPrivateFieldGet(this,Tt),"&anchor=").concat(babelHelpers.classPrivateFieldGet(this,St)))}function Bt(){var t=document.getElementById(babelHelpers.classPrivateFieldGet(this,mt));if(t===null){return}m.Dom.replace(t,this.render())}var qt;function Ut(t,e){Ft(t,e);e.add(t)}function Dt(t,e,i){Ft(t,e);e.set(t,i)}function Ft(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Xt(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var Gt=new WeakMap;var Qt=new WeakMap;var Yt=new WeakMap;var Vt=new WeakMap;var Wt=new WeakMap;var $t=new WeakMap;var jt=new WeakMap;var zt=new WeakMap;var Jt=new WeakSet;var Zt=function(t){babelHelpers.inherits(i,t);function i(t){var e;var n;babelHelpers.classCallCheck(this,i);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,t));Ut(babelHelpers.assertThisInitialized(n),Jt);Dt(babelHelpers.assertThisInitialized(n),Gt,{writable:true,value:null});Dt(babelHelpers.assertThisInitialized(n),Qt,{writable:true,value:null});Dt(babelHelpers.assertThisInitialized(n),Yt,{writable:true,value:void 0});Dt(babelHelpers.assertThisInitialized(n),Vt,{writable:true,value:void 0});Dt(babelHelpers.assertThisInitialized(n),Wt,{writable:true,value:void 0});Dt(babelHelpers.assertThisInitialized(n),$t,{writable:true,value:void 0});Dt(babelHelpers.assertThisInitialized(n),jt,{writable:true,value:void 0});Dt(babelHelpers.assertThisInitialized(n),zt,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),Yt,m.Type.isNumber(t.jobId)?t.jobId:null);n.sliderId="".concat(n.id,"-").concat((e=babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(n),Yt))!==null&&e!==void 0?e:n.activityId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),Vt,m.Type.isStringFilled(t.clientDetailUrl)?t.clientDetailUrl:null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),Wt,m.Type.isStringFilled(t.clientFullName)?t.clientFullName:null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),jt,m.Type.isStringFilled(t.userPhotoUrl)?t.userPhotoUrl:null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),$t,m.Type.isNumber(t.activityCreated)?t.activityCreated:null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(n),zt,m.Type.isNumber(t.assessmentSettingsId)?t.assessmentSettingsId:null);n.rating=new Ot;return n}babelHelpers.createClass(i,[{key:"initDefaultOptions",value:function t(){this.id="crm-copilot-call-quality";this.sliderTitle=m.Loc.getMessage("CRM_COPILOT_CALL_QUALITY_SLIDER_TITLE");var e=Math.round(BX.SidePanel.Instance.getTopSlider().getWidth()*.75);this.sliderWidth=e>0?e:Math.round(window.screen.width*.75);this.textboxTitle=m.Loc.getMessage("CRM_COPILOT_CALL_TRANSCRIPT_TITLE");this.aiJobResultAndCallRecordAction="crm.timeline.ai.getCopilotCallQuality"}},{key:"getExtensions",value:function t(){var e=babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"getExtensions",this).call(this);e.push("crm.ai.call");return e}},{key:"getSliderContentClass",value:function t(){return"crm-copilot-call-quality-wrapper"}},{key:"getSliderDesign",value:function t(){return{margin:0}}},{key:"getSliderToolbar",value:function t(){var e=this;return function(){return[e.rating.render()]}}},{key:"getSliderEvents",value:function t(){var e=this;var n=babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"getSliderEvents",this).call(this);n.onLoad=function(){babelHelpers.classPrivateFieldGet(e,Gt).showAudioPlayer()};n.onClose=function(){babelHelpers.classPrivateFieldGet(e,Gt).close()};return n}},{key:"open",value:function t(){var i=this;var n=new Promise((function(t,n){i.getAiJobResultAndCallRecord().then((function(n){var s=i.prepareAudioProps(n);Xt(i,Jt,Kt).call(i,n.data);var a={activityId:i.activityId,ownerTypeId:i.ownerTypeId,ownerId:i.ownerId,jobId:babelHelpers.classPrivateFieldGet(i,Yt)};babelHelpers.classPrivateFieldSet(i,Qt,e.BitrixVue.createApp(nt,{client:{detailUrl:babelHelpers.classPrivateFieldGet(i,Vt),fullName:babelHelpers.classPrivateFieldGet(i,Wt),activityCreated:babelHelpers.classPrivateFieldGet(i,$t)},data:n.data,audioProps:s,context:a}));var l=m.Tag.render(qt||(qt=babelHelpers.taggedTemplateLiteral(['<div class="call-quality__container"></div>'])));babelHelpers.classPrivateFieldSet(i,Gt,babelHelpers.classPrivateFieldGet(i,Qt).mount(l));p.EventEmitter.subscribe("crm.ai.callQuality:doAssessment",(function(){}));t(l)}))["catch"]((function(t){i.showError(t);i.wrapperSlider.destroy()}))}));this.wrapperSlider.setContent(n);this.wrapperSlider.open()}},{key:"getAiJobResultAndCallRecord",value:function t(){var e={data:{activityId:this.activityId,ownerTypeId:this.ownerTypeId,ownerId:this.ownerId,jobId:babelHelpers.classPrivateFieldGet(this,Yt),assessmentSettingsId:babelHelpers.classPrivateFieldGet(this,zt)}};return BX.ajax.runAction(this.aiJobResultAndCallRecordAction,e)}},{key:"getNotAccuratePhraseCode",value:function t(){return"CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE"}}]);return i}(g);function Kt(t){var e=t.callQuality;if(!m.Type.isPlainObject(e)){return}var i=this.rating;if(e){i.setRating(e===null||e===void 0?void 0:e.ASSESSMENT_AVG);i.setPrevRating(e===null||e===void 0?void 0:e.PREV_ASSESSMENT_AVG)}if(m.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,jt))){i.setUserPhotoUrl(babelHelpers.classPrivateFieldGet(this,jt))}i.setSkeletonMode(false)}var te=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"initDefaultOptions",value:function t(){this.id="crm-copilot-summary";this.aiJobResultAndCallRecordAction="crm.timeline.ai.getCopilotSummaryAndCallRecord";this.sliderTitle=m.Loc.getMessage("CRM_COMMON_COPILOT");this.sliderWidth=520;this.textboxTitle=m.Loc.getMessage("CRM_COPILOT_CALL_SUMMARY_TITLE")}},{key:"getNotAccuratePhraseCode",value:function t(){return"CRM_COPILOT_CALL_SUMMARY_NOT_BE_ACCURATE"}},{key:"prepareAiJobResult",value:function t(e){return e.data.aiJobResult.summary}}]);return e}(g);var ee=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"initDefaultOptions",value:function t(){this.id="crm-copilot-transcript";this.aiJobResultAndCallRecordAction="crm.timeline.ai.getCopilotTranscriptAndCallRecord";this.sliderTitle=m.Loc.getMessage("CRM_COMMON_COPILOT");this.sliderWidth=730;this.textboxTitle=m.Loc.getMessage("CRM_COPILOT_CALL_TRANSCRIPT_TITLE")}},{key:"getNotAccuratePhraseCode",value:function t(){return"CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE"}},{key:"prepareAiJobResult",value:function t(e){return e.data.aiJobResult.transcription}}]);return e}(g);var ie={Summary:te,Transcription:ee,CallQuality:Zt};t.Call=ie})(this.BX.Crm.AI=this.BX.Crm.AI||{},BX.Vue3,BX.Crm.AI,BX.Crm.AI,BX,BX.Crm,BX,BX.Pull,BX.UI,BX.Crm.Copilot,BX.Crm,BX.Crm.Timeline,BX.Event,BX.UI.BBCode.Formatter,BX,BX,BX);
//# sourceMappingURL=call.bundle.map.js