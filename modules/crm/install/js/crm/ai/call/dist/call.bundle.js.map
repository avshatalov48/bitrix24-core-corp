{"version":3,"file":"call.bundle.js","sources":["../src/base.js","../src/summary.js","../src/transcription.js","../src/index.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport { UI } from 'ui.notification';\nimport { Slider } from 'crm.ai.slider';\nimport { Textbox } from 'crm.ai.textbox';\nimport { AudioPlayer } from 'crm.audio-player';\n\nexport class Base\n{\n\tid: string;\n\tsliderTitle: string;\n\tsliderWidth: number;\n\ttextboxTitle: string;\n\taiJobResultAndCallRecordAction: string;\n\n\twrapperSlider: Slider;\n\taudioPlayerApp: AudioPlayer;\n\ttextbox: Textbox;\n\n\tconstructor(data)\n\t{\n\t\tthis.initDefaultOptions();\n\n\t\tthis.activityId = data.activityId;\n\t\tthis.ownerTypeId = data.ownerTypeId;\n\t\tthis.ownerId = data.ownerId;\n\n\t\tconst audioPlayerNode = Tag.render`<div id=\"crm-textbox-audio-player\"></div>`;\n\n\t\tthis.audioPlayerApp = new AudioPlayer({\n\t\t\trootNode: audioPlayerNode,\n\t\t});\n\n\t\tthis.textbox = new Textbox({\n\t\t\ttitle: this.textboxTitle,\n\t\t\tpreviousTextContent: audioPlayerNode,\n\t\t});\n\n\t\tthis.sliderId = `${this.id}-${Math.floor(Math.random() * 1000)}`;\n\t\tthis.wrapperSlider = new Slider({\n\t\t\turl: this.sliderId,\n\t\t\tsliderTitle: this.sliderTitle,\n\t\t\twidth: this.sliderWidth,\n\t\t\textensions: ['crm.ai.textbox', 'crm.audio-player'],\n\t\t\tevents: {\n\t\t\t\tonLoad: () => {\n\t\t\t\t\tthis.audioPlayerApp.attachTemplate();\n\t\t\t\t},\n\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.audioPlayerApp.detachTemplate();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\topen()\n\t{\n\t\tconst content = new Promise((resolve, reject) => {\n\t\t\tthis.getAiJobResultAndCallRecord()\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst audioProps = this.prepareAudioProps(response);\n\t\t\t\t\tthis.audioPlayerApp.setAudioProps(audioProps);\n\n\t\t\t\t\tconst aiJobResult = this.prepareAiJobResult(response);\n\t\t\t\t\tthis.textbox.setText(aiJobResult);\n\t\t\t\t\tthis.textbox.render();\n\n\t\t\t\t\tresolve(this.textbox.get());\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.wrapperSlider.destroy();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.wrapperSlider.setContent(content);\n\t\tthis.wrapperSlider.open();\n\t}\n\n\tgetAiJobResultAndCallRecord(): Promise\n\t{\n\t\tconst actionData = {\n\t\t\tdata: {\n\t\t\t\tactivityId: this.activityId,\n\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\townerId: this.ownerId,\n\t\t\t},\n\t\t};\n\n\t\treturn BX.ajax.runAction(this.aiJobResultAndCallRecordAction, actionData);\n\t}\n\n\tshowError(response)\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: response.errors[0].message,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn '';\n\t}\n\n\tprepareAudioProps(response: Object): Object\n\t{\n\t\tconst callRecord = response.data.callRecord;\n\n\t\treturn {\n\t\t\tid: callRecord.id,\n\t\t\tsrc: callRecord.src,\n\t\t\ttitle: callRecord.title,\n\t\t\tcontext: window.top,\n\t\t};\n\t}\n\n\tgetSliderTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tgetTextboxTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tinitDefaultOptions(): void {}\n}\n","import { Loc } from 'main.core';\nimport { Base } from './base.js';\n\nexport class Summary extends Base\n{\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-summary';\n\t\tthis.aiJobResultAndCallRecordAction = 'crm.timeline.ai.getCopilotSummaryAndCallRecord';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 520;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_SUMMARY_TITLE');\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.summary;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Base } from './base.js';\n\nexport class Transcription extends Base\n{\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-transcript';\n\t\tthis.aiJobResultAndCallRecordAction = 'crm.timeline.ai.getCopilotTranscriptAndCallRecord';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 730;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_TRANSCRIPT_TITLE');\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.transcription;\n\t}\n}\n","import { Summary } from './summary.js';\nimport { Transcription } from './transcription.js';\n\nexport const Call = {\n\tSummary,\n\tTranscription,\n};\n"],"names":["Base","data","initDefaultOptions","activityId","ownerTypeId","ownerId","audioPlayerNode","Tag","render","audioPlayerApp","AudioPlayer","rootNode","textbox","Textbox","title","textboxTitle","previousTextContent","sliderId","id","Math","floor","random","wrapperSlider","Slider","url","sliderTitle","width","sliderWidth","extensions","events","onLoad","attachTemplate","onClose","detachTemplate","content","Promise","resolve","reject","getAiJobResultAndCallRecord","then","response","audioProps","prepareAudioProps","setAudioProps","aiJobResult","prepareAiJobResult","setText","get","showError","destroy","setContent","open","actionData","BX","ajax","runAction","aiJobResultAndCallRecordAction","UI","Notification","Center","notify","errors","message","autoHideDelay","callRecord","src","context","window","top","Summary","Loc","getMessage","summary","Transcription","transcription","Call"],"mappings":";;;;;;;AAAA,KAMaA,IAAI;GAYhB,cAAYC,IAAI,EAChB;KAAA;KAAA;KACC,IAAI,CAACC,kBAAkB,EAAE;KAEzB,IAAI,CAACC,UAAU,GAAGF,IAAI,CAACE,UAAU;KACjC,IAAI,CAACC,WAAW,GAAGH,IAAI,CAACG,WAAW;KACnC,IAAI,CAACC,OAAO,GAAGJ,IAAI,CAACI,OAAO;KAE3B,IAAMC,eAAe,GAAGC,aAAG,CAACC,MAAM,4HAA2C;KAE7E,IAAI,CAACC,cAAc,GAAG,IAAIC,2BAAW,CAAC;OACrCC,QAAQ,EAAEL;MACV,CAAC;KAEF,IAAI,CAACM,OAAO,GAAG,IAAIC,sBAAO,CAAC;OAC1BC,KAAK,EAAE,IAAI,CAACC,YAAY;OACxBC,mBAAmB,EAAEV;MACrB,CAAC;KAEF,IAAI,CAACW,QAAQ,aAAM,IAAI,CAACC,EAAE,cAAIC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,GAAG,IAAI,CAAC,CAAE;KAChE,IAAI,CAACC,aAAa,GAAG,IAAIC,oBAAM,CAAC;OAC/BC,GAAG,EAAE,IAAI,CAACP,QAAQ;OAClBQ,WAAW,EAAE,IAAI,CAACA,WAAW;OAC7BC,KAAK,EAAE,IAAI,CAACC,WAAW;OACvBC,UAAU,EAAE,CAAC,gBAAgB,EAAE,kBAAkB,CAAC;OAClDC,MAAM,EAAE;SACPC,MAAM,EAAE,kBAAM;WACb,KAAI,CAACrB,cAAc,CAACsB,cAAc,EAAE;UACpC;SAEDC,OAAO,EAAE,mBAAM;WACd,KAAI,CAACvB,cAAc,CAACwB,cAAc,EAAE;;;MAGtC,CAAC;;GACF;KAAA;KAAA,uBAGD;OAAA;OACC,IAAMC,OAAO,GAAG,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;SAChD,MAAI,CAACC,2BAA2B,EAAE,CAChCC,IAAI,CAAC,UAACC,QAAQ,EAAK;WACnB,IAAMC,UAAU,GAAG,MAAI,CAACC,iBAAiB,CAACF,QAAQ,CAAC;WACnD,MAAI,CAAC/B,cAAc,CAACkC,aAAa,CAACF,UAAU,CAAC;WAE7C,IAAMG,WAAW,GAAG,MAAI,CAACC,kBAAkB,CAACL,QAAQ,CAAC;WACrD,MAAI,CAAC5B,OAAO,CAACkC,OAAO,CAACF,WAAW,CAAC;WACjC,MAAI,CAAChC,OAAO,CAACJ,MAAM,EAAE;WAErB4B,OAAO,CAAC,MAAI,CAACxB,OAAO,CAACmC,GAAG,EAAE,CAAC;UAC3B,CAAC,SACI,CAAC,UAACP,QAAQ,EAAK;WACpB,MAAI,CAACQ,SAAS,CAACR,QAAQ,CAAC;WACxB,MAAI,CAAClB,aAAa,CAAC2B,OAAO,EAAE;UAC5B,CAAC;QAEH,CAAC;OAEF,IAAI,CAAC3B,aAAa,CAAC4B,UAAU,CAAChB,OAAO,CAAC;OACtC,IAAI,CAACZ,aAAa,CAAC6B,IAAI,EAAE;;;KACzB;KAAA,8CAGD;OACC,IAAMC,UAAU,GAAG;SAClBnD,IAAI,EAAE;WACLE,UAAU,EAAE,IAAI,CAACA,UAAU;WAC3BC,WAAW,EAAE,IAAI,CAACA,WAAW;WAC7BC,OAAO,EAAE,IAAI,CAACA;;QAEf;OAED,OAAOgD,EAAE,CAACC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACC,8BAA8B,EAAEJ,UAAU,CAAC;;;KACzE;KAAA,0BAESZ,QAAQ,EAClB;OACCiB,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7B1B,OAAO,EAAEM,QAAQ,CAACqB,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO;SACnCC,aAAa,EAAE;QACf,CAAC;;;KACF;KAAA,mCAEkBvB,QAAgB,EACnC;OACC,OAAO,EAAE;;;KACT;KAAA,kCAEiBA,QAAgB,EAClC;OACC,IAAMwB,UAAU,GAAGxB,QAAQ,CAACvC,IAAI,CAAC+D,UAAU;OAE3C,OAAO;SACN9C,EAAE,EAAE8C,UAAU,CAAC9C,EAAE;SACjB+C,GAAG,EAAED,UAAU,CAACC,GAAG;SACnBnD,KAAK,EAAEkD,UAAU,CAAClD,KAAK;SACvBoD,OAAO,EAAEC,MAAM,CAACC;QAChB;;;KACD;KAAA,iCAGD;OACC,OAAO,EAAE;;;KACT;KAAA,kCAGD;OACC,OAAO,EAAE;;;KACT;KAAA,qCAE0B;;GAAE;CAAA;;KC7HjBC,OAAO;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,qCAGnB;OACC,IAAI,CAACnD,EAAE,GAAG,qBAAqB;OAC/B,IAAI,CAACsC,8BAA8B,GAAG,gDAAgD;OAEtF,IAAI,CAAC/B,WAAW,GAAG6C,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC;OACvD,IAAI,CAAC5C,WAAW,GAAG,GAAG;OAEtB,IAAI,CAACZ,YAAY,GAAGuD,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;;;KACpE;KAAA,mCAEkB/B,QAAgB,EACnC;OACC,OAAOA,QAAQ,CAACvC,IAAI,CAAC2C,WAAW,CAAC4B,OAAO;;;GACxC;CAAA,EAhB2BxE,IAAI;;KCApByE,aAAa;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,qCAGzB;OACC,IAAI,CAACvD,EAAE,GAAG,wBAAwB;OAClC,IAAI,CAACsC,8BAA8B,GAAG,mDAAmD;OAEzF,IAAI,CAAC/B,WAAW,GAAG6C,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC;OACvD,IAAI,CAAC5C,WAAW,GAAG,GAAG;OAEtB,IAAI,CAACZ,YAAY,GAAGuD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;;;KACvE;KAAA,mCAEkB/B,QAAgB,EACnC;OACC,OAAOA,QAAQ,CAACvC,IAAI,CAAC2C,WAAW,CAAC8B,aAAa;;;GAC9C;CAAA,EAhBiC1E,IAAI;;KCA1B2E,IAAI,GAAG;GACnBN,OAAO,EAAPA,OAAO;GACPI,aAAa,EAAbA;CACD,CAAC;;;;;;;;"}