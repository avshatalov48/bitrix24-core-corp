{"version":3,"file":"call.bundle.js","sources":["../src/base.js","../src/call-quality/pull.js","../src/call-quality/components/common/view-mode.js","../src/call-quality/components/compliance.js","../src/call-quality/components/common/loader.js","../src/call-quality/components/explanation/assessment-settings-pending-block.js","../src/call-quality/components/explanation/empty-script-list-block.js","../src/call-quality/components/explanation/error-block.js","../src/call-quality/components/explanation/not-assessment-script-block.js","../src/call-quality/components/explanation/other-script-block.js","../src/call-quality/components/explanation/pending-block.js","../src/call-quality/components/explanation/recommendation-block.js","../src/call-quality/script-selector-display-strategy.js","../src/call-quality/components/script-selector.js","../src/call-quality/components/call-quality.js","../src/call-quality/rating.js","../src/call-quality/call-quality.js","../src/summary.js","../src/transcription.js","../src/index.js"],"sourcesContent":["import { Slider } from 'crm.ai.slider';\nimport { Attention, AttentionPresets, Textbox } from 'crm.ai.textbox';\nimport { AudioPlayer } from 'crm.audio-player';\nimport { Loc, Tag, Text, Type } from 'main.core';\nimport { UI } from 'ui.notification';\n\nexport type aiCallData = {\n\tactivityId: number,\n\tactivityCreated?: number,\n\townerTypeId: number,\n\townerId: number,\n\tlanguageTitle ?: string,\n\tclientDetailUrl ?: string,\n\tclientFullName ?: string,\n\tuserPhotoUrl ?: string,\n\tjobId ?: number,\n\tassessmentSettingsId ?: number,\n};\n\nexport class Base\n{\n\tactivityId: number;\n\townerTypeId: number;\n\townerId: number;\n\tlanguageTitle: ?string = null;\n\n\taudioPlayerNode: HTMLElement;\n\n\tid: string;\n\tsliderTitle: string;\n\tsliderWidth: number;\n\ttextboxTitle: string;\n\taiJobResultAndCallRecordAction: string;\n\n\twrapperSlider: Slider;\n\taudioPlayerApp: AudioPlayer;\n\ttextbox: Textbox;\n\n\tconstructor(data: aiCallData)\n\t{\n\t\tthis.initDefaultOptions();\n\n\t\tthis.activityId = data.activityId;\n\t\tthis.ownerTypeId = data.ownerTypeId;\n\t\tthis.ownerId = data.ownerId;\n\t\tthis.languageTitle = data.languageTitle ?? null;\n\n\t\tthis.audioPlayerNode = Tag.render`<div id=\"crm-textbox-audio-player\"></div>`;\n\n\t\tthis.audioPlayerApp = new AudioPlayer({\n\t\t\trootNode: this.audioPlayerNode,\n\t\t});\n\n\t\tthis.textbox = new Textbox({\n\t\t\ttitle: this.textboxTitle,\n\t\t\tpreviousTextContent: this.audioPlayerNode,\n\t\t\tattentions: this.getTextboxAttentions(),\n\t\t});\n\n\t\tthis.sliderId = `${this.id}-${this.activityId}`;\n\t\tthis.wrapperSlider = new Slider({\n\t\t\turl: this.sliderId,\n\t\t\tsliderTitle: this.sliderTitle,\n\t\t\tsliderContentClass: this.getSliderContentClass(),\n\t\t\twidth: this.sliderWidth,\n\t\t\textensions: this.getExtensions(),\n\t\t\tdesign: this.getSliderDesign(),\n\t\t\tevents: this.getSliderEvents(),\n\t\t\ttoolbar: this.getSliderToolbar(),\n\t\t});\n\t}\n\n\tgetExtensions(): Array<string>\n\t{\n\t\treturn ['crm.ai.textbox', 'crm.audio-player'];\n\t}\n\n\tgetSliderContentClass(): ?string\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderDesign(): ?Object\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderToolbar(): ?Function\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderEvents(): Object\n\t{\n\t\treturn {\n\t\t\tonLoad: () => {\n\t\t\t\tthis.audioPlayerApp.attachTemplate();\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.audioPlayerApp.detachTemplate();\n\t\t\t},\n\t\t};\n\t}\n\n\topen()\n\t{\n\t\tconst content = new Promise((resolve, reject) => {\n\t\t\tthis.getAiJobResultAndCallRecord()\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst audioProps = this.prepareAudioProps(response);\n\t\t\t\t\tthis.audioPlayerApp.setAudioProps(audioProps);\n\n\t\t\t\t\tconst aiJobResult = this.prepareAiJobResult(response);\n\t\t\t\t\tthis.textbox.setText(aiJobResult);\n\t\t\t\t\tthis.textbox.render();\n\n\t\t\t\t\tresolve(this.textbox.get());\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.wrapperSlider.destroy();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.wrapperSlider.setContent(content);\n\t\tthis.wrapperSlider.open();\n\t}\n\n\tgetAiJobResultAndCallRecord(): Promise\n\t{\n\t\tconst actionData = {\n\t\t\tdata: {\n\t\t\t\tactivityId: this.activityId,\n\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\townerId: this.ownerId,\n\t\t\t},\n\t\t};\n\n\t\treturn BX.ajax.runAction(this.aiJobResultAndCallRecordAction, actionData);\n\t}\n\n\tshowError(response)\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: response.errors[0].message,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn '';\n\t}\n\n\tprepareAudioProps(response: Object): Object\n\t{\n\t\tconst callRecord = response.data.callRecord;\n\n\t\treturn {\n\t\t\tid: callRecord.id,\n\t\t\tsrc: callRecord.src,\n\t\t\ttitle: callRecord.title,\n\t\t\tcontext: window.top,\n\t\t};\n\t}\n\n\tgetTextboxAttentions(): Array\n\t{\n\t\tconst attentions = [this.getNotAccurateAttention()];\n\n\t\tconst jobLanguageAttention = this.getJobLanguageAttention();\n\t\tif (jobLanguageAttention !== null)\n\t\t{\n\t\t\tattentions.push(jobLanguageAttention);\n\t\t}\n\n\t\treturn attentions;\n\t}\n\n\tgetNotAccurateAttention(): Attention\n\t{\n\t\tconst helpdeskCode = '20412666';\n\n\t\tconst content = Loc.getMessage(this.getNotAccuratePhraseCode(), {\n\t\t\t'[helpdesklink]': `<a href=\"##\" onclick=\"top.BX.Helper.show('redirect=detail&code=${helpdeskCode}');\">`,\n\t\t\t'[/helpdesklink]': '</a>',\n\t\t});\n\n\t\treturn new Attention({\n\t\t\tcontent,\n\t\t});\n\t}\n\n\tgetJobLanguageAttention(): ?Attention\n\t{\n\t\tif (!Type.isStringFilled(this.languageTitle))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst helpdeskCode = '20423978';\n\t\tconst content = Loc.getMessage('CRM_COPILOT_CALL_JOB_LANGUAGE_ATTENTION', {\n\t\t\t'#LANGUAGE_TITLE#': `<span style=\"text-transform: lowercase\">${Text.encode(this.languageTitle)}</span>`,\n\t\t\t'[helpdesklink]': `<a href=\"##\" onclick=\"top.BX.Helper.show('redirect=detail&code=${helpdeskCode}');\">`,\n\t\t\t'[/helpdesklink]': '</a>',\n\t\t});\n\n\t\treturn new Attention({\n\t\t\tpreset: AttentionPresets.COPILOT,\n\t\t\tcontent,\n\t\t});\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn '';\n\t}\n\n\tgetSliderTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tgetTextboxTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tinitDefaultOptions(): void {}\n}\n","import { Type } from 'main.core';\nimport { PULL } from 'pull.client';\nimport { QueueManager } from 'pull.queuemanager';\n\nconst CALL_SCORING_ADD_COMMAND = 'call_scoring_add';\nconst CALL_ASSESSMENT_UPDATE_COMMAND = 'call_assessment_update';\n\nexport class Pull\n{\n\t#callScoringCallback: Function;\n\t#callAssessmentCallback: Function;\n\t#unsubscribeFromCallScoring: ?Function = null;\n\t#unsubscribeFromCallAssessment: ?Function = null;\n\n\tconstructor(callScoringCallback: Function, callAssessmentCallback: Function)\n\t{\n\t\tthis.#callScoringCallback = callScoringCallback;\n\t\tthis.#callAssessmentCallback = callAssessmentCallback;\n\t}\n\n\tinit(): void\n\t{\n\t\tif (!PULL)\n\t\t{\n\t\t\tconsole.error('pull is not initialized');\n\n\t\t\treturn;\n\t\t}\n\n\t\t// @todo use only one subscribe with many actions in callback\n\t\tthis.#unsubscribeFromCallScoring = PULL.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: CALL_SCORING_ADD_COMMAND,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (Type.isStringFilled(params.eventId) && QueueManager.eventIds.has(params.eventId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#callScoringCallback(params);\n\t\t\t},\n\t\t});\n\n\t\tthis.#unsubscribeFromCallAssessment = PULL.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: CALL_ASSESSMENT_UPDATE_COMMAND,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (Type.isStringFilled(params.eventId) && QueueManager.eventIds.has(params.eventId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#callAssessmentCallback(params);\n\t\t\t},\n\t\t});\n\n\t\tPULL.extendWatch(CALL_SCORING_ADD_COMMAND);\n\t\tPULL.extendWatch(CALL_ASSESSMENT_UPDATE_COMMAND);\n\t}\n\n\tunsubscribe(): void\n\t{\n\t\tthis.#unsubscribeFromCallScoring();\n\t\tthis.#unsubscribeFromCallAssessment();\n\t}\n}\n","export type ViewModeType = ViewMode.usedNotAssessmentScript\n\t| ViewMode.usedCurrentVersionOfScript\n\t| ViewMode.usedOtherVersionOfScript\n\t| ViewMode.emptyScriptList\n\t| ViewMode.assessmentSettingsPending\n\t| ViewMode.pending\n\t| ViewMode.error\n;\n\n/*\n* @readonly\n* @enum {string}\n*/\nexport const ViewMode: Object<string, string> = Object.freeze({\n\tusedNotAssessmentScript: 'usedNotAssessmentScript',\n\tusedCurrentVersionOfScript: 'usedCurrentVersionOfScript',\n\tusedOtherVersionOfScript: 'usedOtherVersionOfScript',\n\temptyScriptList: 'emptyScriptList',\n\tassessmentSettingsPending: 'assessmentSettingsPending',\n\tpending: 'pending',\n\terror: 'error',\n});\n","import { Loc } from 'main.core';\nimport { ViewMode } from './common/view-mode';\n\nexport const Compliance = {\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tassessment: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\tlowBorder: {\n\t\t\ttype: Number,\n\t\t\tdefault: 30,\n\t\t},\n\t\thighBorder: {\n\t\t\ttype: Number,\n\t\t\tdefault: 70,\n\t\t},\n\t\tviewMode: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.startAnimate();\n\t},\n\n\tmethods: {\n\t\tstartAnimate(): void\n\t\t{\n\t\t\tif (this.$refs.assessment)\n\t\t\t{\n\t\t\t\tthis.animateCounter(this.$refs.assessment, this.assessment);\n\t\t\t}\n\t\t},\n\t\tanimateCounter(counterElement: HTMLElement, targetNumber: number): void\n\t\t{\n\t\t\tlet startNumber = 0;\n\n\t\t\tconst duration = 1500;\n\t\t\tconst increment = targetNumber / (duration / 50);\n\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tstartNumber += increment;\n\n\t\t\t\tif (startNumber >= targetNumber)\n\t\t\t\t{\n\t\t\t\t\tstartNumber = targetNumber;\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tcounterElement.textContent = Math.floor(startNumber);\n\t\t\t}, 50);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tclassList(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'call-quality__compliance__container': true,\n\t\t\t\t'--empty-state': !this.isUsedCurrentVersionOfScript,\n\t\t\t\t'--low': this.assessment <= this.lowBorder,\n\t\t\t\t'--high': this.assessment >= this.highBorder,\n\t\t\t};\n\t\t},\n\t\tisUsedCurrentVersionOfScript(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedCurrentVersionOfScript;\n\t\t},\n\t\tinfoTitle(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode === ViewMode.emptyScriptList\n\t\t\t\t\t? Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_TITLE')\n\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_TITLE')\n\t\t\t);\n\t\t},\n\t\tvalueTitle(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode === ViewMode.emptyScriptList\n\t\t\t\t\t? Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_VALUE')\n\t\t\t\t\t: this.title\n\t\t\t);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div :class=\"classList\">\n\t\t\t<div class=\"call-quality__compliance\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isUsedCurrentVersionOfScript\"\n\t\t\t\t\tclass=\"call-quality__compliance__assessment\"\n\t\t\t\t>\n\t\t\t\t\t<span ref=\"assessment\" class=\"call-quality__compliance__assessment-value\">\n\t\t\t\t\t\t{{ assessment }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"call-quality__compliance__assessment-measure\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__compliance__info\">\n\t\t\t\t\t<span class=\"call-quality__compliance__info-title\">\n\t\t\t\t\t\t{{ infoTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"call-quality__compliance__info-value\">\n\t\t\t\t\t\t{{ valueTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\n\nexport const Loader = {\n\tmounted()\n\t{\n\t\tthis.renderLottieAnimation();\n\t},\n\n\tmethods: {\n\t\trenderLottieAnimation(): HTMLElement\n\t\t{\n\t\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\t\tpath: this.getAnimationPath(),\n\t\t\t\tcontainer: this.$refs.lottie,\n\t\t\t\trenderer: 'svg',\n\t\t\t\tloop: true,\n\t\t\t\tautoplay: true,\n\t\t\t});\n\n\t\t\tmainAnimation.setSpeed(0.75);\n\n\t\t\treturn this.$refs.lottie.root;\n\t\t},\n\t\tgetAnimationPath(): string\n\t\t{\n\t\t\treturn '/bitrix/js/crm/ai/call/src/call-quality/lottie/loader.json';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div ref=\"lottie\" class=\"call-quality__explanation-loader__lottie\"></div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\nimport { Loader } from '../common/loader';\n\nexport const AssessmentSettingsPendingBlock = {\n\tcomponents: {\n\t\tLoader,\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div class=\"call-quality__explanation-loader__container\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class=\"call-quality__explanation-loader__lottie-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TEXT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { Loc } from 'main.core';\n\nexport const EmptyScriptListBlock = {\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TEXT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, Type } from 'main.core';\n\nexport const ErrorBlock = {\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\terrorText: null,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tsetErrorMessage(message: string): void\n\t\t{\n\t\t\tthis.errorText = message;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\texplanationText(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tType.isStringFilled(this.errorText)\n\t\t\t\t\t? this.errorText\n\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ERROR_TEXT')\n\t\t\t);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container --error\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ERROR_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t{{ explanationText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const NotAssessmentScriptBlock = {\n\tmethods: {\n\t\tdoAssessment(): void\n\t\t{\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t},\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TEXT');\n\t\t},\n\t\tbuttonText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_ASSESSMENT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__explanation__buttons-container\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active\"\n\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const OtherScriptBlock = {\n\tmethods: {\n\t\tshowAssessment(): void\n\t\t{\n\t\t\tthis.$emit('showAssessment');\n\t\t},\n\t\tdoAssessment(): void\n\t\t{\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t},\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TEXT');\n\t\t},\n\t\tbuttonShowText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_SHOW_ASSESSMENT');\n\t\t},\n\t\tbuttonDoText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_ASSESSMENT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\" v-html=\"title\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__explanation__buttons-container\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active\"\n\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonDoText }}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-light-border ui-btn-round\"\n\t\t\t\t\t@click=\"showAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonShowText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\nimport { Loader } from '../common/loader';\n\nexport const PendingBlock = {\n\tcomponents: {\n\t\tLoader,\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_PENDING_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div class=\"call-quality__explanation-loader__container\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class=\"call-quality__explanation-loader__lottie-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_PENDING_TEXT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nconst ARTICLE_CODE = '23240682';\nconst DISCLAIMER_ARTICLE_CODE = '20412666';\n\nexport const RecommendationBlock = {\n\tprops: {\n\t\trecommendations: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tsummary: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tuseInRating: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tmethods: {\n\t\tshowArticle(): void\n\t\t{\n\t\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${ARTICLE_CODE}`);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tdisclaimer(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_DISCLAIMER', {\n\t\t\t\t'#LINK_START#': `<a onclick='window.top.BX?.Helper?.show(\\`redirect=detail&code=${DISCLAIMER_ARTICLE_CODE}\\`)' href=\"#\">`,\n\t\t\t\t'#LINK_END#': '</a>',\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation --copilot-content\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"!useInRating\"\n\t\t\t\t\t\tclass=\"call-quality__explanation-badge\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_NOT_IN_RATING') }}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"call-quality__explanation-badge-article ui-icon-set --help\"\n\t\t\t\t\t\t\t\t@click=\"showArticle\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ summary }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ recommendations }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-disclaimer\" v-html=\"disclaimer\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { DisplayStrategy } from 'crm.copilot.call-assessment-selector';\nimport { Dom, Tag } from 'main.core';\n\nexport class ScriptSelectorDisplayStrategy implements DisplayStrategy\n{\n\t#container: HTMLElement;\n\ttitleNode: HTMLElement;\n\tinnerTitleNode: HTMLElement;\n\t#isLoading: boolean = false;\n\n\tconstructor()\n\t{\n\t\tthis.#container = this.#createContainer();\n\t}\n\n\tgetTargetNode(): HTMLElement\n\t{\n\t\treturn this.titleNode;\n\t}\n\n\tupdateTitle(title: string): void\n\t{\n\t\tthis.innerTitleNode.innerText = title;\n\t\tthis.innerTitleNode.title = title;\n\t}\n\n\tsetLoading(isLoading: boolean): void\n\t{\n\t\tif (this.#isLoading === isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isLoading = isLoading;\n\t\tDom.toggleClass(this.#container, '--loading');\n\t}\n\n\t#createContainer(): HTMLElement\n\t{\n\t\tthis.innerTitleNode = Tag.render`<span></span>`;\n\t\tthis.titleNode = Tag.render`\n\t\t\t<div class=\"call-quality__script-selector\">\n\t\t\t\t${this.innerTitleNode}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.titleNode;\n\t}\n}\n","import { CallAssessmentSelector } from 'crm.copilot.call-assessment-selector';\nimport { Router } from 'crm.router';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { Dom, Loc, Runtime } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport { SidePanel } from 'ui.sidepanel';\nimport { ScriptSelectorDisplayStrategy } from '../script-selector-display-strategy';\nimport { ViewMode } from './common/view-mode';\n\nconst ARTICLE_CODE = '23240682';\nconst SUCCESS_STATUS = 'SUCCESS';\nconst PENDING_STATUS = 'PENDING';\n\nexport const ScriptSelector = {\n\tprops: {\n\t\tassessmentSettingsId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tassessmentSettingsStatus: {\n\t\t\ttype: String,\n\t\t\tdefault: SUCCESS_STATUS,\n\t\t},\n\t\tassessmentSettingsTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisPromptChanged: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tpromptUpdatedAt: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tprompt: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tviewMode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcallAssessmentSelector: this.getCallAssessmentSelector(),\n\t\t\thtmlFormatter: new HtmlFormatter(),\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetCallAssessmentSelector(): CallAssessmentSelector\n\t\t{\n\t\t\treturn new CallAssessmentSelector({\n\t\t\t\tcurrentCallAssessment: {\n\t\t\t\t\tid: this.assessmentSettingsId,\n\t\t\t\t\ttitle: (\n\t\t\t\t\t\tthis.assessmentSettingsId > 0\n\t\t\t\t\t\t\t? this.assessmentSettingsTitle\n\t\t\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE')\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\temptyScriptListTitle: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE'),\n\t\t\t\tdisplayStrategy: new ScriptSelectorDisplayStrategy(),\n\t\t\t\tadditionalSelectorOptions: {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t'Item:onBeforeSelect': this.onBeforeSelect.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tpopup: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonShow: (event) => {\n\t\t\t\t\t\t\t\t// @todo maybe there is a better solution?\n\t\t\t\t\t\t\t\tconst zIndex = SidePanel.Instance.getTopSlider().getZindex() + 1;\n\t\t\t\t\t\t\t\tevent.target.getZIndexComponent().setZIndex(zIndex);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tonBeforeSelect(event: BaseEvent)\n\t\t{\n\t\t\tthis.$emit('onBeforeSelect', this.callAssessmentSelector.getCurrentCallAssessmentItem()?.id);\n\t\t},\n\t\tonEditCallAssessmentSettings({ target }): void\n\t\t{\n\t\t\tif (this.assessmentSettingsStatus === PENDING_STATUS)\n\t\t\t{\n\t\t\t\tthis.showDisabledButtonHint(target);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tRouter.openSlider(\n\t\t\t\t`/crm/copilot-call-assessment/details/${this.assessmentSettingsId}/`,\n\t\t\t\t{\n\t\t\t\t\twidth: 700,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tonShowActualPrompt(): void\n\t\t{\n\t\t\tthis.$emit('onShowActualPrompt');\n\t\t},\n\t\tshowArticle(): void\n\t\t{\n\t\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${ARTICLE_CODE}`);\n\t\t},\n\t\tformatHtml(source: string): string\n\t\t{\n\t\t\treturn this.htmlFormatter.format({ source });\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.close();\n\t\t},\n\t\tdisable(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.disable();\n\t\t},\n\t\tenable(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.enable();\n\t\t},\n\t\tdoAssessment({ target }): void\n\t\t{\n\t\t\tif (this.assessmentSettingsStatus === PENDING_STATUS)\n\t\t\t{\n\t\t\t\tthis.showDisabledButtonHint(target);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t\tshowDisabledButtonHint(target: HTMLElement): void\n\t\t{\n\t\t\ttop.BX.UI.Hint.popupParameters = {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: null,\n\t\t\t\tevents: {},\n\t\t\t};\n\n\t\t\tRuntime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\ttop.BX.UI.Hint.show(\n\t\t\t\t\t\ttarget,\n\t\t\t\t\t\tLoc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_DISABLED_DO_ASSESSMENT_HINT'),\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t150,\n\t\t\t\tthis,\n\t\t\t)();\n\t\t},\n\t\tisDisabledAssessmentButton(): boolean\n\t\t{\n\t\t\treturn (this.assessmentSettingsStatus !== SUCCESS_STATUS);\n\t\t},\n\t\tisDisabledEditButton(): boolean\n\t\t{\n\t\t\treturn (this.assessmentSettingsStatus === PENDING_STATUS);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tDom.append(this.callAssessmentSelector.getContainer(), this.$refs.container);\n\n\t\tif (this.$refs.prompt)\n\t\t{\n\t\t\tDom.append(this.formattedPrompt, this.$refs.prompt);\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tscriptUpdatedAt(): string\n\t\t{\n\t\t\tconst date = new Date(this.promptUpdatedAt);\n\t\t\tconst datetimeConverter = new DatetimeConverter(date);\n\n\t\t\tconst dateString = datetimeConverter.toDatetimeString({\n\t\t\t\twithDayOfWeek: false,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_UPDATED',\n\t\t\t\t{\n\t\t\t\t\t'#UPDATED_AT#': dateString,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tformattedPrompt(): string\n\t\t{\n\t\t\treturn this.formatHtml(this.prompt);\n\t\t},\n\t\tisShowFooterButtons(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode !== ViewMode.usedOtherVersionOfScript\n\t\t\t\t&& this.viewMode !== ViewMode.usedNotAssessmentScript\n\t\t\t\t&& this.viewMode !== ViewMode.pending\n\t\t\t\t&& this.assessmentSettingsId > 0\n\t\t\t);\n\t\t},\n\t\tfooterButtonClassList(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-btn',\n\t\t\t\t'ui-btn-xs',\n\t\t\t\t'ui-btn-no-caps',\n\t\t\t\t'ui-btn-light-border',\n\t\t\t\t'ui-btn-round',\n\t\t\t\t{ 'ui-btn-disabled': this.isDisabledAssessmentButton() },\n\t\t\t];\n\t\t},\n\t\tfooterEditButtonClassList(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-btn',\n\t\t\t\t'ui-btn-xs',\n\t\t\t\t'ui-btn-no-caps',\n\t\t\t\t'ui-btn-round',\n\t\t\t\t'ui-btn-light',\n\t\t\t\t'edit-button',\n\t\t\t\t{ 'ui-btn-disabled': this.isDisabledEditButton() },\n\t\t\t];\n\t\t},\n\t\tisEmptyScriptListViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.emptyScriptList;\n\t\t},\n\t},\n\n\twatch: {\n\t\tprompt(): void\n\t\t{\n\t\t\tDom.clean(this.$refs.prompt);\n\t\t\tDom.append(this.formattedPrompt, this.$refs.prompt);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"call-quality__script-selector__container\">\n\t\t\t\t<div class=\"call-quality__script-selector__title\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_SELECTOR_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"call-quality__script-selector__selector-container\" ref=\"container\"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"call-quality__script-selector__article ui-icon-set --help\"\n\t\t\t\t\t\t@click=\"showArticle\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"this.isPromptChanged && isShowFooterButtons\"\n\t\t\t\tclass=\"call-quality__script-info__container\"\n\t\t\t>\n\t\t\t\t<span>{{scriptUpdatedAt}}</span>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-no-caps ui-btn-round ui-btn-link ui-btn-active\"\n\t\t\t\t\t@click=\"onShowActualPrompt\"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_SHOW_NEW_PROMPT') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__script-container\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isEmptyScriptListViewMode\"\n\t\t\t\t\tclass=\"call-quality__script-text\"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_PROMPT_TEXT') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"call-quality__script-text\" ref=\"prompt\">\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isShowFooterButtons\"\n\t\t\t\t\tclass=\"call-quality__script-footer\"\n\t\t\t\t>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class=\"footerButtonClassList\"\n\t\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_ASSESSMENT_REPLY') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class=\"footerEditButtonClassList\"\n\t\t\t\t\t\t@click=\"onEditCallAssessmentSettings\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_EDIT') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { AudioPlayerComponent } from 'crm.audio-player';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { ajax as Ajax, Loc, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Pull } from '../pull';\nimport { ViewMode, ViewModeType } from './common/view-mode';\nimport { Compliance as ComplianceComponent } from './compliance';\nimport { AssessmentSettingsPendingBlock } from './explanation/assessment-settings-pending-block';\nimport { EmptyScriptListBlock } from './explanation/empty-script-list-block';\nimport { ErrorBlock } from './explanation/error-block';\nimport { NotAssessmentScriptBlock } from './explanation/not-assessment-script-block';\nimport { OtherScriptBlock } from './explanation/other-script-block';\nimport { PendingBlock } from './explanation/pending-block';\nimport { RecommendationBlock } from './explanation/recommendation-block';\nimport { ScriptSelector as ScriptSelectorComponent } from './script-selector';\n\ntype Quality = {\n\tid: number;\n\tcreatedAt: number;\n\tassessmentSettingsId: number;\n\tassessmentSettingsStatus: ?string;\n\tassessment: number;\n\tassessmentAvg: number;\n\tprevAssessmentAvg: number;\n\tisPromptChanged: boolean;\n\tuseInRating: boolean;\n\tprompt: string;\n\tactualPrompt: string;\n\tpromptUpdatedAt: string;\n\ttitle: string;\n\trecommendations: string;\n\tsummary: string;\n\tlowBorder: number;\n\thighBorder: number;\n}\n\ntype PullData = {\n\tassessmentSettingsId: ?number;\n\tactivityId: number;\n\tjobId: ?number;\n\tratedUserId: ?number;\n\tstatus?: string;\n}\n\nexport const CallQuality = {\n\tcomponents: {\n\t\tAudioPlayerComponent,\n\t\tScriptSelectorComponent,\n\t\tRecommendationBlock,\n\t\tOtherScriptBlock,\n\t\tNotAssessmentScriptBlock,\n\t\tAssessmentSettingsPendingBlock,\n\t\tPendingBlock,\n\t\tErrorBlock,\n\t\tEmptyScriptListBlock,\n\t\tComplianceComponent,\n\t},\n\n\tprops: {\n\t\tclient: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\taudioProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\tconst quality = this.getPreparedQualityProps(this.data);\n\t\tlet prompt = quality.prompt;\n\n\t\tconst currentQualityAssessmentId = quality.id ?? null;\n\t\tlet viewMode: ?ViewModeType = null;\n\t\tif (this.data.viewMode === ViewMode.usedNotAssessmentScript)\n\t\t{\n\t\t\tviewMode = ViewMode.usedNotAssessmentScript;\n\t\t}\n\t\telse if (this.data.viewMode === ViewMode.pending)\n\t\t{\n\t\t\tviewMode = ViewMode.pending;\n\t\t}\n\t\telse if (this.data.viewMode === ViewMode.emptyScriptList)\n\t\t{\n\t\t\tviewMode = ViewMode.emptyScriptList;\n\t\t}\n\t\telse if (quality.id)\n\t\t{\n\t\t\tviewMode = this.data.viewMode ?? ViewMode.usedCurrentVersionOfScript;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tviewMode = ViewMode.error;\n\t\t}\n\n\t\treturn {\n\t\t\tquality,\n\t\t\tcurrentQualityAssessmentId,\n\t\t\tviewMode,\n\t\t\tprompt,\n\t\t\tisShowAudioPlayer: false,\n\t\t\tdirection: this.data.callDirection,\n\t\t};\n\t},\n\n\tmounted()\n\t{\n\t\ttop.BX.Event.EventEmitter.subscribe(\n\t\t\t'crm:copilot:callAssessment:beforeSave',\n\t\t\tthis.onBeforeAssessmentSettingsChange,\n\t\t);\n\n\t\ttop.BX.Event.EventEmitter.subscribe(\n\t\t\t'crm:copilot:callAssessment:save',\n\t\t\tthis.onAssessmentSettingsChange,\n\t\t);\n\n\t\tthis.pull = new Pull(\n\t\t\tthis.onPullChangeScript,\n\t\t\tthis.onPullChangeAssessment,\n\t\t);\n\t\tthis.pull.init();\n\t},\n\n\tmethods: {\n\t\tonBeforeAssessmentSettingsChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { data } = event.getData();\n\t\t\tif (!this.isPromptChanged(data.prompt))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.quality.assessmentSettingsStatus = 'PENDING';\n\t\t},\n\t\tonAssessmentSettingsChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { id, data } = event.getData();\n\t\t\tif (!this.isPromptChanged(data.prompt))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onChangeScript(id);\n\t\t},\n\t\tisPromptChanged(newPrompt: string): boolean\n\t\t{\n\t\t\treturn this.quality.actualPrompt !== newPrompt;\n\t\t},\n\t\tshowAudioPlayer(): void\n\t\t{\n\t\t\tthis.isShowAudioPlayer = true;\n\t\t},\n\t\tonShowActualPrompt(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.usedOtherVersionOfScript;\n\t\t\tthis.prompt = this.quality.actualPrompt;\n\t\t},\n\t\tonShowCurrentAssessment(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.usedCurrentVersionOfScript;\n\t\t\tthis.prompt = this.quality.prompt;\n\t\t},\n\t\tonDoAssessment(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.pending;\n\t\t\tthis.$refs.scriptSelector?.disable();\n\n\t\t\tconst config = {\n\t\t\t\tdata: {\n\t\t\t\t\t...this.context,\n\t\t\t\t\tassessmentSettingsId: this.quality.assessmentSettingsId,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tAjax\n\t\t\t\t.runAction('crm.copilot.callqualityassessment.doAssessment', config)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst { status, data } = response;\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\n\t\t\t\t\tif (status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(response);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tEventEmitter.emit('crm.ai.callQuality:doAssessment', { data });\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonChangeScript(assessmentSettingsId: number): void\n\t\t{\n\t\t\tconst config = {\n\t\t\t\tdata: {\n\t\t\t\t\t...this.context,\n\t\t\t\t\tassessmentSettingsId,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tAjax\n\t\t\t\t.runAction('crm.copilot.callqualityassessment.get', config)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\n\t\t\t\t\tconst { status, data } = response;\n\n\t\t\t\t\tif (status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(response);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isObject(data))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.quality = this.getPreparedQualityProps(data);\n\n\t\t\t\t\t\tif (!(\n\t\t\t\t\t\t\tthis.quality.isPromptChanged\n\t\t\t\t\t\t\t&& data.viewMode === ViewMode.assessmentSettingsPending\n\t\t\t\t\t\t\t//&& this.viewMode === ViewMode.usedCurrentVersionOfScript\n\t\t\t\t\t\t))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.viewMode = data.viewMode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\t\t\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tshowError(response)\n\t\t{\n\t\t\tthis.viewMode = ViewMode.error;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.errorBlock?.setErrorMessage(response.errors[0]?.message);\n\t\t\t});\n\t\t},\n\t\tgetPreparedQualityProps({ callQuality: quality }): Quality\n\t\t{\n\t\t\tif (!Type.isPlainObject(quality))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tquality = {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: Number(quality.ID ?? 0),\n\t\t\t\tcreatedAt: quality.CREATED_AT ?? null,\n\t\t\t\tassessmentSettingsId: Number(quality.ASSESSMENT_SETTING_ID ?? 0),\n\t\t\t\tassessmentSettingsStatus: quality.ASSESSMENT_SETTINGS_STATUS ?? null,\n\t\t\t\tassessment: Number(quality.ASSESSMENT ?? 0),\n\t\t\t\tassessmentAvg: Number(quality.ASSESSMENT_AVG ?? 0),\n\t\t\t\tprevAssessmentAvg: Number(quality.PREV_ASSESSMENT_AVG ?? 0),\n\t\t\t\tisPromptChanged: Boolean(quality.IS_PROMPT_CHANGED ?? false),\n\t\t\t\tuseInRating: Boolean(quality.USE_IN_RATING ?? false),\n\t\t\t\tprompt: quality.PROMPT ?? '',\n\t\t\t\tactualPrompt: quality.ACTUAL_PROMPT ?? '',\n\t\t\t\tpromptUpdatedAt: quality.PROMPT_UPDATED_AT ?? '',\n\t\t\t\ttitle: quality.TITLE ?? '',\n\t\t\t\trecommendations: quality.RECOMMENDATIONS ?? '',\n\t\t\t\tsummary: quality.SUMMARY ?? '',\n\t\t\t\tlowBorder: Number(quality.LOW_BORDER ?? 30),\n\t\t\t\thighBorder: Number(quality.HIGH_BORDER ?? 70),\n\t\t\t};\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$refs.scriptSelector?.close();\n\t\t\tthis.pull.unsubscribe();\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe(\n\t\t\t\t'crm:copilot:callAssessment:beforeSave',\n\t\t\t\tthis.onBeforeAssessmentSettingsChange,\n\t\t\t);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe(\n\t\t\t\t'crm:copilot:callAssessment:save',\n\t\t\t\tthis.onAssessmentSettingsChange,\n\t\t\t);\n\t\t},\n\t\tonPullChangeScript(params: PullData): void\n\t\t{\n\t\t\tif (this.context.activityId !== params.activityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (params.status === 'error' || !Type.isNumber(params.assessmentSettingsId))\n\t\t\t{\n\t\t\t\tthis.viewMode = ViewMode.error;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.onChangeScript(params.assessmentSettingsId);\n\t\t\t}\n\t\t},\n\t\tonPullChangeAssessment(params: PullData): void\n\t\t{\n\t\t\tconst assessmentSettingsId = params.assessmentSettingsId ?? null;\n\t\t\tconst currentAssessmentSettingsId = this.quality.assessmentSettingsId;\n\n\t\t\tif (assessmentSettingsId !== currentAssessmentSettingsId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onChangeScript(assessmentSettingsId);\n\t\t},\n\t},\n\n\twatch: {\n\t\tquality: {\n\t\t\thandler(quality) {\n\t\t\t\tthis.prompt = quality.prompt;\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tclientNameClassList(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'call-quality__call-client-name': true,\n\t\t\t\t'--incoming': Number(this.direction) === 1,\n\t\t\t\t'--outgoing': Number(this.direction) === 2,\n\t\t\t}\n\t\t},\n\t\tclientName(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_AI_CALL_TITLE', {\n\t\t\t\t'[clientname]': `<a href=\"${this.client.detailUrl}\">`,\n\t\t\t\t'[/clientname]': '</a>',\n\t\t\t\t'#CLIENT_NAME#': Text.encode(this.client.fullName),\n\t\t\t});\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tconst datetimeConverter = DatetimeConverter.createFromServerTimestamp(this.client.activityCreated);\n\n\t\t\treturn datetimeConverter.toDatetimeString({\n\t\t\t\twithDayOfWeek: false,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\t\t},\n\t\tisUsedCurrentVersionOfScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedCurrentVersionOfScript;\n\t\t},\n\t\tisUsedOtherVersionOfScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedOtherVersionOfScript;\n\t\t},\n\t\tisUsedNotAssessmentScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedNotAssessmentScript;\n\t\t},\n\t\tisAssessmentSettingsPendingViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.assessmentSettingsPending;\n\t\t},\n\t\tisPendingViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.pending;\n\t\t},\n\t\tisErrorViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.error;\n\t\t},\n\t\tisEmptyScriptListViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.emptyScriptList;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__column --info\">\n\t\t\t<div>\n\t\t\t\t<div class=\"call-quality__header\">\n\t\t\t\t\t<div class=\"call-quality__header-row --flex\">\n\t\t\t\t\t\t<div :class=\"clientNameClassList\" v-html=\"clientName\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"call-quality__call-date\">\n\t\t\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"call-quality__header-row\">\n\t\t\t\t\t\t<div id=\"crm-textbox-audio-player\" ref=\"audioPlayer\">\n\t\t\t\t\t\t\t<AudioPlayerComponent v-if=\"isShowAudioPlayer\" v-bind=\"audioProps\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<ComplianceComponent \n\t\t\t\t\t:assessment=\"quality.assessment\"\n\t\t\t\t\t:title=\"quality.title\"\n\t\t\t\t\t:viewMode=\"viewMode\"\n\t\t\t\t\t:lowBorder=\"quality.lowBorder\"\n\t\t\t\t\t:highBorder=\"quality.highBorder\"\n\t\t\t\t/>\n\t\t\t\t<RecommendationBlock\n\t\t\t\t\tv-if=\"isUsedCurrentVersionOfScriptViewMode\"\n\t\t\t\t\t:recommendations=\"quality.recommendations\"\n\t\t\t\t\t:summary=\"quality.summary\"\n\t\t\t\t\t:use-in-rating=\"quality.useInRating\"\n\t\t\t\t/>\n\t\t\t\t<OtherScriptBlock\n\t\t\t\t\tv-if=\"isUsedOtherVersionOfScriptViewMode\"\n\t\t\t\t\t@showAssessment=\"onShowCurrentAssessment\"\n\t\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t\t/>\n\t\t\t\t<NotAssessmentScriptBlock\n\t\t\t\t\tv-if=\"isUsedNotAssessmentScriptViewMode\"\n\t\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t\t/>\n\t\t\t\t<AssessmentSettingsPendingBlock v-if=\"isAssessmentSettingsPendingViewMode\"/>\n\t\t\t\t<PendingBlock v-if=\"isPendingViewMode\"/>\n\t\t\t\t<ErrorBlock v-if=\"isErrorViewMode\" ref=\"errorBlock\"/>\n\t\t\t\t<EmptyScriptListBlock v-if=\"isEmptyScriptListViewMode\"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"call-quality__column --prompt\">\n\t\t\t<ScriptSelectorComponent\n\t\t\t\tref=\"scriptSelector\"\n\t\t\t\t:assessmentSettingsId=\"quality.assessmentSettingsId\"\n\t\t\t\t:assessmentSettingsStatus=\"quality.assessmentSettingsStatus\"\n\t\t\t\t:assessmentSettingsTitle=\"quality.title\"\n\t\t\t\t:isPromptChanged=\"quality.isPromptChanged\"\n\t\t\t\t:promptUpdatedAt=\"quality.promptUpdatedAt\"\n\t\t\t\t:prompt=\"prompt\"\n\t\t\t\t:viewMode=\"viewMode\"\n\t\t\t\t@onBeforeSelect=\"onChangeScript\"\n\t\t\t\t@onShowActualPrompt=\"onShowActualPrompt\"\n\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Dom, Loc, Tag, Text, Type } from 'main.core';\n\nconst Trend = Object.freeze({\n\tup: 1,\n\tdown: -1,\n\tnoChanges: 0,\n});\n\ntype TrendValue = Trend.up | Trend.down | Trend.noChanges;\n\nconst ARTICLE_CODE = '23240682';\nconst ARTICLE_ANCHOR = 'rate';\n\nexport class Rating\n{\n\t#id: string;\n\t#rating: ?number = null;\n\t#prevRating: ?number = null;\n\t#userPhotoUrl: ?string = null;\n\t#articleCode: string = ARTICLE_CODE;\n\t#articleAnchor: string = ARTICLE_ANCHOR;\n\t#useSkeletonMode: boolean = true;\n\n\tconstructor()\n\t{\n\t\tthis.#id = `crm.ai.call.quality-rating-${Text.getRandom()}`;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst content = (\n\t\t\tthis.#useSkeletonMode\n\t\t\t\t? this.#getSkeleton()\n\t\t\t\t: this.#getContent()\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div id=\"${this.#id}\" class=\"call-quality__rating__container\">\n\t\t\t\t${content}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t// @todo\n\t#getSkeleton(): HTMLElement\n\t{\n\t\treturn Tag.render`<div></div>`;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"call-quality__rating__text-container\">\n\t\t\t\t${Loc.getMessage('CRM_COPILOT_CALL_QUALITY_RATING')}\n\t\t\t\t<div \n\t\t\t\t\tclass=\"call-quality__rating_article ui-icon-set --help\"\n\t\t\t\t\tonclick=\"${this.#showArticle.bind(this)}\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__rating__value-container\">\n\t\t\t\t${this.#getAvatar()}\n\t\t\t\t<div class=\"call-quality__rating__value\">\n\t\t\t\t\t${this.#rating}\n\t\t\t\t\t<span class=\"call-quality__rating__measure\">%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__rating__trend ${this.#getTrendClass()}\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getAvatar(): HTMLElement\n\t{\n\t\tif (Type.isStringFilled(this.#userPhotoUrl))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"call-quality__rating__avatar\"\n\t\t\t\t\tstyle=\"background-image: url(${encodeURI(this.#userPhotoUrl)})\"\n\t\t\t\t></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"call-quality__rating__avatar ui-icon ui-icon-common-user\">\n\t\t\t\t<i style=\"\"></i>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTrendClass(): string\n\t{\n\t\tconst trend = this.#getTrend();\n\n\t\tif (trend === Trend.up)\n\t\t{\n\t\t\treturn '--up';\n\t\t}\n\n\t\tif (trend === Trend.down)\n\t\t{\n\t\t\treturn '--down';\n\t\t}\n\n\t\treturn '--no-changes';\n\t}\n\n\t#getTrend(): TrendValue\n\t{\n\t\tif (this.#rating > this.#prevRating)\n\t\t{\n\t\t\treturn Trend.up;\n\t\t}\n\n\t\tif (this.#rating < this.#prevRating)\n\t\t{\n\t\t\treturn Trend.down;\n\t\t}\n\n\t\treturn Trend.noChanges;\n\t}\n\n\t#showArticle(): void\n\t{\n\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${this.#articleCode}&anchor=${this.#articleAnchor}`);\n\t}\n\n\tsetRating(rating: number): void\n\t{\n\t\tthis.#rating = rating;\n\t}\n\n\tsetPrevRating(rating: number): void\n\t{\n\t\tthis.#prevRating = rating;\n\t}\n\n\tsetUserPhotoUrl(userPhotoUrl: string): void\n\t{\n\t\tthis.#userPhotoUrl = userPhotoUrl;\n\t}\n\n\tsetSkeletonMode(useSkeletonMode: boolean = true): void\n\t{\n\t\tif (this.#useSkeletonMode !== useSkeletonMode)\n\t\t{\n\t\t\tthis.#useSkeletonMode = useSkeletonMode;\n\t\t\tthis.#layout();\n\t\t}\n\t}\n\n\t#layout(): void\n\t{\n\t\tconst currentContent = document.getElementById(this.#id);\n\t\tif (currentContent === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(currentContent, this.render());\n\t}\n}\n","import { Loc, Tag, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport type { aiCallData } from '../base.js';\nimport { Base } from '../base.js';\nimport './style.css';\nimport { CallQuality as CallQualityComponent } from './components/call-quality';\nimport { Rating } from './rating';\n\nimport 'ui.design-tokens';\n\n/**\n * @memberOf BX.Crm.AI.Call\n *\n */\nexport class CallQuality extends Base\n{\n\t#layoutComponent: ?Object = null;\n\t#app: ?Object = null;\n\trating: Rating;\n\t#jobId: ?number;\n\t#clientDetailUrl: ?string;\n\t#clientFullName: ?string;\n\t#activityCreated: ?number;\n\t#userPhotoUrl: ?string;\n\t#assessmentSettingsId: ?number;\n\n\tconstructor(data: aiCallData)\n\t{\n\t\tsuper(data);\n\n\t\tthis.#jobId = Type.isNumber(data.jobId) ? data.jobId : null;\n\t\tthis.sliderId = `${this.id}-${this.#jobId ?? this.activityId}`;\n\n\t\tthis.#clientDetailUrl = Type.isStringFilled(data.clientDetailUrl) ? data.clientDetailUrl : null;\n\t\tthis.#clientFullName = Type.isStringFilled(data.clientFullName) ? data.clientFullName : null;\n\t\tthis.#userPhotoUrl = Type.isStringFilled(data.userPhotoUrl) ? data.userPhotoUrl : null;\n\t\tthis.#activityCreated = Type.isNumber(data.activityCreated) ? data.activityCreated : null;\n\t\tthis.#assessmentSettingsId = Type.isNumber(data.assessmentSettingsId) ? data.assessmentSettingsId : null;\n\n\t\tthis.rating = new Rating();\n\t}\n\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-call-quality';\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SLIDER_TITLE');\n\n\t\tconst width = Math.round(BX.SidePanel.Instance.getTopSlider().getWidth() * 0.75);\n\t\tthis.sliderWidth = width > 0 ? width : Math.round(window.screen.width * 0.75);\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_TRANSCRIPT_TITLE');\n\n\t\tthis.aiJobResultAndCallRecordAction = 'crm.timeline.ai.getCopilotCallQuality';\n\t}\n\n\tgetExtensions(): Array<string>\n\t{\n\t\tconst extensions = super.getExtensions();\n\n\t\textensions.push('crm.ai.call');\n\n\t\treturn extensions;\n\t}\n\n\tgetSliderContentClass(): ?string\n\t{\n\t\treturn 'crm-copilot-call-quality-wrapper';\n\t}\n\n\tgetSliderDesign(): ?Object\n\t{\n\t\treturn {\n\t\t\tmargin: 0,\n\t\t};\n\t}\n\n\tgetSliderToolbar(): ?Function\n\t{\n\t\treturn () => {\n\t\t\treturn [\n\t\t\t\tthis.rating.render(),\n\t\t\t];\n\t\t};\n\t}\n\n\tgetSliderEvents(): Object\n\t{\n\t\tconst events = super.getSliderEvents();\n\n\t\tevents.onLoad = () => {\n\t\t\tthis.#layoutComponent.showAudioPlayer();\n\t\t};\n\n\t\tevents.onClose = () => {\n\t\t\tthis.#layoutComponent.close();\n\t\t};\n\n\t\treturn events;\n\t}\n\n\t/**\n\t * @override\n\t */\n\topen()\n\t{\n\t\tconst content = new Promise((resolve, reject) => {\n\t\t\tthis.getAiJobResultAndCallRecord()\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst audioProps = this.prepareAudioProps(response);\n\n\t\t\t\t\tthis.#prepareRating(response.data);\n\n\t\t\t\t\tconst context = {\n\t\t\t\t\t\tactivityId: this.activityId,\n\t\t\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\t\t\townerId: this.ownerId,\n\t\t\t\t\t\tjobId: this.#jobId,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#app = BitrixVue.createApp(CallQualityComponent, {\n\t\t\t\t\t\tclient: {\n\t\t\t\t\t\t\tdetailUrl: this.#clientDetailUrl,\n\t\t\t\t\t\t\tfullName: this.#clientFullName,\n\t\t\t\t\t\t\tactivityCreated: this.#activityCreated,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: response.data,\n\t\t\t\t\t\taudioProps,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst container = Tag.render`<div class=\"call-quality__container\"></div>`;\n\t\t\t\t\tthis.#layoutComponent = this.#app.mount(container);\n\n\t\t\t\t\tEventEmitter.subscribe('crm.ai.callQuality:doAssessment', () => {\n\t\t\t\t\t\t// @todo will the slider close?\n\t\t\t\t\t\t//this.wrapperSlider?.close();\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(container);\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.wrapperSlider.destroy();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.wrapperSlider.setContent(content);\n\t\tthis.wrapperSlider.open();\n\t}\n\n\tgetAiJobResultAndCallRecord(): Promise\n\t{\n\t\tconst actionData = {\n\t\t\tdata: {\n\t\t\t\tactivityId: this.activityId,\n\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\townerId: this.ownerId,\n\t\t\t\tjobId: this.#jobId,\n\t\t\t\tassessmentSettingsId: this.#assessmentSettingsId,\n\t\t\t},\n\t\t};\n\n\t\treturn BX.ajax.runAction(this.aiJobResultAndCallRecordAction, actionData);\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE';\n\t}\n\n\t#prepareRating({ callQuality }): void\n\t{\n\t\tif (!Type.isPlainObject(callQuality))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rating } = this;\n\n\t\tif (callQuality)\n\t\t{\n\t\t\trating.setRating(callQuality?.ASSESSMENT_AVG);\n\t\t\trating.setPrevRating(callQuality?.PREV_ASSESSMENT_AVG);\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#userPhotoUrl))\n\t\t{\n\t\t\trating.setUserPhotoUrl(this.#userPhotoUrl);\n\t\t}\n\n\t\trating.setSkeletonMode(false);\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Base } from './base.js';\n\n/**\n * @memberOf BX.Crm.AI.Call\n */\nexport class Summary extends Base\n{\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-summary';\n\t\tthis.aiJobResultAndCallRecordAction = 'crm.timeline.ai.getCopilotSummaryAndCallRecord';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 520;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_SUMMARY_TITLE');\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_SUMMARY_NOT_BE_ACCURATE';\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.summary;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Base } from './base.js';\n\n/**\n * @memberOf BX.Crm.AI.Call\n */\nexport class Transcription extends Base\n{\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-transcript';\n\t\tthis.aiJobResultAndCallRecordAction = 'crm.timeline.ai.getCopilotTranscriptAndCallRecord';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 730;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_TRANSCRIPT_TITLE');\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE';\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.transcription;\n\t}\n}\n","import { CallQuality } from './call-quality/call-quality';\nimport { Summary } from './summary.js';\nimport { Transcription } from './transcription.js';\n\nexport const Call = {\n\tSummary,\n\tTranscription,\n\tCallQuality,\n};\n"],"names":["Base","data","initDefaultOptions","activityId","ownerTypeId","ownerId","languageTitle","audioPlayerNode","Tag","render","audioPlayerApp","AudioPlayer","rootNode","textbox","Textbox","title","textboxTitle","previousTextContent","attentions","getTextboxAttentions","sliderId","id","wrapperSlider","Slider","url","sliderTitle","sliderContentClass","getSliderContentClass","width","sliderWidth","extensions","getExtensions","design","getSliderDesign","events","getSliderEvents","toolbar","getSliderToolbar","onLoad","attachTemplate","onClose","detachTemplate","content","Promise","resolve","reject","getAiJobResultAndCallRecord","then","response","audioProps","prepareAudioProps","setAudioProps","aiJobResult","prepareAiJobResult","setText","get","showError","destroy","setContent","open","actionData","BX","ajax","runAction","aiJobResultAndCallRecordAction","UI","Notification","Center","notify","errors","message","autoHideDelay","callRecord","src","context","window","top","getNotAccurateAttention","jobLanguageAttention","getJobLanguageAttention","push","helpdeskCode","Loc","getMessage","getNotAccuratePhraseCode","Attention","Type","isStringFilled","Text","encode","preset","AttentionPresets","COPILOT","CALL_SCORING_ADD_COMMAND","CALL_ASSESSMENT_UPDATE_COMMAND","Pull","callScoringCallback","callAssessmentCallback","PULL","console","error","subscribe","moduleId","command","callback","params","eventId","QueueManager","eventIds","has","extendWatch","ViewMode","Object","freeze","usedNotAssessmentScript","usedCurrentVersionOfScript","usedOtherVersionOfScript","emptyScriptList","assessmentSettingsPending","pending","Compliance","props","type","String","required","assessment","Number","lowBorder","highBorder","viewMode","mounted","startAnimate","methods","$refs","animateCounter","counterElement","targetNumber","startNumber","duration","increment","interval","setInterval","clearInterval","textContent","Math","floor","computed","classList","isUsedCurrentVersionOfScript","infoTitle","valueTitle","template","Loader","renderLottieAnimation","mainAnimation","Lottie","loadAnimation","path","getAnimationPath","container","lottie","renderer","loop","autoplay","setSpeed","root","AssessmentSettingsPendingBlock","components","EmptyScriptListBlock","text","ErrorBlock","errorText","setErrorMessage","explanationText","NotAssessmentScriptBlock","doAssessment","$emit","buttonText","OtherScriptBlock","showAssessment","buttonShowText","buttonDoText","PendingBlock","ARTICLE_CODE","DISCLAIMER_ARTICLE_CODE","RecommendationBlock","recommendations","summary","useInRating","Boolean","showArticle","Helper","show","disclaimer","ScriptSelectorDisplayStrategy","_classPrivateFieldInitSpec","titleNode","innerTitleNode","innerText","isLoading","Dom","toggleClass","SUCCESS_STATUS","PENDING_STATUS","ScriptSelector","assessmentSettingsId","assessmentSettingsStatus","assessmentSettingsTitle","isPromptChanged","promptUpdatedAt","prompt","callAssessmentSelector","getCallAssessmentSelector","htmlFormatter","HtmlFormatter","CallAssessmentSelector","currentCallAssessment","emptyScriptListTitle","displayStrategy","additionalSelectorOptions","dialog","onBeforeSelect","bind","popup","onShow","event","zIndex","SidePanel","Instance","getTopSlider","getZindex","target","getZIndexComponent","setZIndex","getCurrentCallAssessmentItem","onEditCallAssessmentSettings","showDisabledButtonHint","Router","openSlider","cacheable","onShowActualPrompt","formatHtml","source","format","close","disable","enable","Hint","popupParameters","closeByEsc","autoHide","angle","Runtime","debounce","isDisabledAssessmentButton","isDisabledEditButton","append","getContainer","formattedPrompt","scriptUpdatedAt","date","Date","datetimeConverter","DatetimeConverter","dateString","toDatetimeString","withDayOfWeek","delimiter","isShowFooterButtons","footerButtonClassList","footerEditButtonClassList","isEmptyScriptListViewMode","watch","clean","CallQuality","AudioPlayerComponent","ScriptSelectorComponent","ComplianceComponent","client","quality","getPreparedQualityProps","currentQualityAssessmentId","isShowAudioPlayer","direction","callDirection","Event","EventEmitter","onBeforeAssessmentSettingsChange","onAssessmentSettingsChange","pull","onPullChangeScript","onPullChangeAssessment","init","getData","onChangeScript","newPrompt","actualPrompt","showAudioPlayer","onShowCurrentAssessment","onDoAssessment","scriptSelector","config","Ajax","status","emit","isObject","$nextTick","errorBlock","callQuality","isPlainObject","ID","createdAt","CREATED_AT","ASSESSMENT_SETTING_ID","ASSESSMENT_SETTINGS_STATUS","ASSESSMENT","assessmentAvg","ASSESSMENT_AVG","prevAssessmentAvg","PREV_ASSESSMENT_AVG","IS_PROMPT_CHANGED","USE_IN_RATING","PROMPT","ACTUAL_PROMPT","PROMPT_UPDATED_AT","TITLE","RECOMMENDATIONS","SUMMARY","LOW_BORDER","HIGH_BORDER","unsubscribe","isNumber","currentAssessmentSettingsId","handler","deep","clientNameClassList","clientName","detailUrl","fullName","formattedDate","createFromServerTimestamp","activityCreated","isUsedCurrentVersionOfScriptViewMode","isUsedOtherVersionOfScriptViewMode","isUsedNotAssessmentScriptViewMode","isAssessmentSettingsPendingViewMode","isPendingViewMode","isErrorViewMode","Trend","up","down","noChanges","ARTICLE_ANCHOR","Rating","_classPrivateMethodInitSpec","getRandom","rating","userPhotoUrl","useSkeletonMode","_classPrivateMethodGet","encodeURI","trend","currentContent","document","getElementById","replace","jobId","clientDetailUrl","clientFullName","round","getWidth","screen","margin","BitrixVue","createApp","CallQualityComponent","mount","setRating","setPrevRating","setUserPhotoUrl","setSkeletonMode","Summary","Transcription","transcription","Call"],"mappings":"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"}