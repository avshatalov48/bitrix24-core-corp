{"version":3,"file":"recognition-promo.bundle.js","sources":["../src/recognition-promo.js"],"sourcesContent":["import { Tag, Loc, bind, Dom, Reflection } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { Icon, Main as MainIconSet, Actions as ActionsIconSet } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.actions';\nimport { Lottie } from 'ui.lottie';\n\nimport './recognition-promo.css';\n\nexport type RecognitionPromoOptions = {\n\tevents?: RecognitionPromoEvents;\n};\n\ntype RecognitionPromoEvents = {\n\tonClickOnConnectButton?: Function;\n\tonClickOnRemindLaterButton?: Function;\n\tonShow?: Function;\n\tonHide?: Function;\n};\n\nexport class RecognitionPromo\n{\n\t#popup: ?Popup = null;\n\t#events: RecognitionPromoEvents;\n\n\tconstructor(options: RecognitionPromoOptions)\n\t{\n\t\tthis.#events = options?.events ?? {};\n\t\tthis.#preloadMainLottieAnimation();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = this.#initPopup();\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\t#initPopup(): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tcontent: this.#renderPopupContent(),\n\t\t\tpadding: 0,\n\t\t\twidth: 556,\n\t\t\tnoAllPaddings: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#000',\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tborderRadius: 16,\n\t\t\tbackground: 'transparent',\n\t\t\tcontentBackground: 'transparent',\n\t\t\tanimation: 'fading-slide',\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tif (this.#events.onShow)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#events.onShow();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tif (this.#events.onHide)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#events.onHide();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#popup = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#renderPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm__ai-recognition-promo\">\n\t\t\t\t<div class=\"crm__ai-recognition-promo_inner\">\n\t\t\t\t\t<header class=\"crm__ai-recognition-promo_header\">\n\t\t\t\t\t\t<div class=\"crm__ai-recognition-promo_header-left\">\n\t\t\t\t\t\t\t<div class=\"crm__ai-recognition-promo_header-icon\">\n\t\t\t\t\t\t\t\t${this.#renderHeaderCopilotIcon()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<h4 class=\"crm__ai-recognition-promo_header-title\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('RECOGNITION_PROMO_TITLE')}\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.#renderHidePopupButton()}\n\t\t\t\t\t</header>\n\t\t\t\t\t<main class=\"crm__ai-recognition-promo_content\">\n\t\t\t\t\t\t${this.#renderLottieAnimation()}\n\t\t\t\t\t\t${this.#renderContentText()}\n\t\t\t\t\t</main>\n\t\t\t\t\t<footer class=\"crm__ai-recognition-promo_footer\">\n\t\t\t\t\t\t${this.#renderConnectTelephonyButton()}\n\t\t\t\t\t\t${this.#renderRemindLaterButton()}\n\t\t\t\t\t</footer>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderHeaderCopilotIcon(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: MainIconSet.COPILOT_AI,\n\t\t\tsize: 40,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-copilot-primary') ?? '#8E52EC',\n\t\t});\n\n\t\treturn icon.render();\n\t}\n\n\t#renderHidePopupButton(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: ActionsIconSet.CROSS_40,\n\t\t\tsize: 24,\n\t\t});\n\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"crm__ai-recognition-promo_close-popup-button\">\n\t\t\t\t${icon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tbind(button, 'click', () => {\n\t\t\tthis.hide();\n\t\t});\n\n\t\treturn button;\n\t}\n\n\t#renderLottieAnimation(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm__ai-recognition-promo_video-container\">\n\t\t\t\t<canvas ref=\"canvas\"></canvas>\n\t\t\t\t<div ref=\"lottie\" class=\"crm__ai-recognition-promo_content-lottie\"></div>\n\t\t\t\t<div ref=\"confetti\" class=\"crm__ai-recognition-promo_content-confetti\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\tpath: this.#getMainAnimationPath(),\n\t\t\tcontainer: container.lottie,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t});\n\n\t\tmainAnimation.setSpeed(0.75);\n\n\t\tconst confettiAnimation = Lottie.loadAnimation({\n\t\t\tpath: '/bitrix/js/crm/ai/whatsnew/recognition-promo/lottie/confetti-animation.json',\n\t\t\tcontainer: container.confetti,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: false,\n\t\t});\n\n\t\tconfettiAnimation.setSpeed(1.3);\n\n\t\tDom.style(container.confetti, 'opacity', 0);\n\n\t\tbind(confettiAnimation, 'loopComplete', () => {\n\t\t\tconfettiAnimation.pause();\n\t\t\tDom.style(container.confetti, 'opacity', 0);\n\t\t});\n\n\t\tlet confettiWereShown = false;\n\n\t\tbind(mainAnimation, 'loopComplete', () => {\n\t\t\tconfettiWereShown = false;\n\t\t\tDom.style(container.confetti, 'opacity', 0);\n\t\t});\n\n\t\tbind(mainAnimation, 'enterFrame', (e) => {\n\t\t\tif (confettiWereShown === false && e.currentTime > 200)\n\t\t\t{\n\t\t\t\tconfettiAnimation.play();\n\t\t\t\tDom.style(container.confetti, 'opacity', 1);\n\t\t\t\tconfettiWereShown = true;\n\t\t\t}\n\t\t});\n\n\t\tbind(mainAnimation, 'enterFrame', (e) => {\n\t\t\tif (e.currentTime > 250 && confettiWereShown === false)\n\t\t\t{\n\t\t\t\tconfettiAnimation.play();\n\t\t\t\tDom.style(container.confetti, 'opacity', 1);\n\t\t\t\tconfettiWereShown = true;\n\t\t\t}\n\t\t});\n\n\t\treturn container.root;\n\t}\n\n\t#renderContentText(): HTMLElement\n\t{\n\t\tconst content = Loc.getMessage('RECOGNITION_PROMO_CONTENT', {\n\t\t\t'[P]': '<p>',\n\t\t\t'[/P]': '</p>',\n\t\t\t'[LINK1]': '<a ref=\"link1\" href=\"#\">',\n\t\t\t'[/LINK1]': '</a>',\n\t\t\t'[LINK2]': '<a ref=\"link2\" href=\"#\">',\n\t\t\t'[/LINK2]': '</a>',\n\t\t});\n\n\t\tconst container: { root: HTMLElement, link1: HTMLElement, link2: HTMLElement } = Tag.render`\n\t\t\t<div class=\"crm__ai-recognition-promo_content-description\">\n\t\t\t\t${content}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\tbind(container.link1, 'click', () => {\n\t\t\tconst articleCode = '19092894'; // todo replace with the real article code\n\n\t\t\tHelper?.show(`redirect=detail&code=${articleCode}`);\n\t\t});\n\n\t\tbind(container.link2, 'click', () => {\n\t\t\tconst articleCode = '19092894'; // todo replace with the real article code\n\n\t\t\tHelper?.show(`redirect=detail&code=${articleCode}`);\n\t\t});\n\n\t\treturn container.root;\n\t}\n\n\t#renderConnectTelephonyButton(): HTMLElement\n\t{\n\t\tconst button = new Button({\n\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\ttext: Loc.getMessage('RECOGNITION_PROMO_CONNECT_TELEPHONY'),\n\t\t\tround: true,\n\t\t\tonclick: (btn: Button) => {\n\t\t\t\tif (this.#events?.onClickOnConnectButton)\n\t\t\t\t{\n\t\t\t\t\tthis.#events.onClickOnConnectButton(btn);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn button.render();\n\t}\n\n\t#renderRemindLaterButton(): HTMLElement\n\t{\n\t\tconst button = new Button({\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\ttext: Loc.getMessage('RECOGNITION_PROMO_REMIND_LATER'),\n\t\t\tround: true,\n\t\t\tonclick: (btn: Button) => {\n\t\t\t\tif (this.#events?.onClickOnRemindLaterButton)\n\t\t\t\t{\n\t\t\t\t\tthis.#events.onClickOnRemindLaterButton(btn);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn button.render();\n\t}\n\n\t#preloadMainLottieAnimation(): void\n\t{\n\t\tLottie.loadAnimation({\n\t\t\tpath: this.#getMainAnimationPath(),\n\t\t\trenderer: 'svg',\n\t\t});\n\t}\n\n\t#getMainAnimationPath(): string\n\t{\n\t\treturn Loc.getMessage('LANGUAGE_ID') === 'ru'\n\t\t\t? '/bitrix/js/crm/ai/whatsnew/recognition-promo/lottie/animation-ru.json'\n\t\t\t: '/bitrix/js/crm/ai/whatsnew/recognition-promo/lottie/animation-en.json'\n\t\t;\n\t}\n}\n"],"names":["RecognitionPromo","constructor","options","events","show","hide","close","Popup","content","padding","width","noAllPaddings","overlay","backgroundColor","opacity","cacheable","borderRadius","background","contentBackground","animation","onPopupShow","onShow","onPopupClose","onHide","Tag","render","Loc","getMessage","icon","Icon","MainIconSet","COPILOT_AI","size","color","getComputedStyle","document","body","getPropertyValue","ActionsIconSet","CROSS_40","button","bind","container","mainAnimation","Lottie","loadAnimation","path","lottie","renderer","loop","autoplay","setSpeed","confettiAnimation","confetti","Dom","style","pause","confettiWereShown","e","currentTime","play","root","Helper","Reflection","getClass","link1","articleCode","link2","Button","ButtonColor","SUCCESS","text","round","onclick","btn","onClickOnConnectButton","LINK","onClickOnRemindLaterButton"],"mappings":"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"}