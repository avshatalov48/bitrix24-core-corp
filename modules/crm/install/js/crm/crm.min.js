if(!obCrm){var obCrm={}}CRM=function(e,t,n,o,r,a,i,c,p,m,l){this.crmID=e;this.div=t;this.el=n;this.name=o;this.PopupEntityType=c;this.PopupTabs={};this.PopupElement=r;this.PopupPrefix=a;this.PopupMultiple=i;this.PopupBlock={};this.PopupSearch={};this.PopupSearchInput=null;this.PopupTabsIndex=0;this.PopupTabsIndexId="";this.PopupLocalize=p;this.popup=null;this.onSaveListeners=[];this.disableMarkup=!!m;this.onBeforeSearchListeners=[];this.options={requireRequisiteData:false,searchOptions:{}};if(l&&typeof l==="object"){if(!!l["requireRequisiteData"])this.options.requireRequisiteData=true;if(BX.type.isPlainObject(l["searchOptions"]))this.options.searchOptions=l["searchOptions"]}};CRM.prototype.Init=function(){this.popupShowMarkup();this.PopupTabs=BX.findChildren(BX("crm-"+this.crmID+"_"+this.name+"-tabs"),{className:"crm-block-cont-tabs"});if(this.PopupTabs.length>0){this.PopupTabsIndex=0;this.PopupTabsIndexId=this.PopupTabs[0].id}this.PopupItem={};this.PopupItemSelected={};for(var i in this.PopupElement)this.PopupAddItem(this.PopupElement[i]);this.PopupBlock=BX.findChildren(BX("crm-"+this.crmID+"_"+this.name+"-blocks"),{className:"crm-block-cont-block"});this.PopupSearch=BX.findChildren(BX("crm-"+this.crmID+"_"+this.name+"-block-cont-search"),{className:"crm-block-cont-search-tab"});this.PopupSearchInput=BX("crm-"+this.crmID+"_"+this.name+"-search-input");for(var i=0;i<this.PopupTabs.length;i++)eval('BX.bind(this.PopupTabs[i], "click", function(event){ CRM.PopupShowBlock("'+this.crmID+'", this); BX.PreventDefault(event); })');for(var i=0;i<this.PopupSearch.length;i++)eval('BX.bind(this.PopupSearch[i], "click", function(event){ CRM.PopupShowSearchBlock("'+this.crmID+'", this); BX.PreventDefault(event); })');eval('BX.bind(this.PopupSearchInput, "keyup", function(event){ CRM.SearchChange("'+this.crmID+'")})');this.PopupSave();BX.onCustomEvent(window,"onCrmSelectorInit",[this.crmID,this.name,this])};CRM.prototype.Clear=function(){if(this.popup){this.popup.close();this.popup.destroy()}var e=BX("crm-"+this.crmID+"_"+this.name+"-input-box");if(e){this.div.removeChild(e);BX.remove(e)}var t=BX("crm-"+this.crmID+"_"+this.name+"-text-box");if(t){BX.remove(t)}var n=BX("crm-"+this.crmID+"_"+this.name+"-html-box");if(n){BX.remove(n)}};CRM.Set=function(e,t,n,o,r,a,i,c,p,m){var l=false;if(e&&BX.isNodeInDom(e)){l=e.id+n;if(obCrm[l]){obCrm[l].Clear();delete obCrm[l]}obCrm[l]=new CRM(l,CRM.GetWrapperDivPa(e),e,t,o,r,a,i,c,p,m);obCrm[l].Init()}return l};CRM.GetElementForm=function(e){return BX.findParent(e,{tagName:"FORM"})};CRM.GetWrapperDivPr=function(e,t){return BX.findPreviousSibling(e,{tagName:"DIV",property:{name:"crm-"+t+"-box"}})};CRM.GetWrapperDivN=function(e,t){return BX.findNextSibling(e,{tagName:"DIV",property:{name:"crm-"+t+"-box"}})};CRM.GetWrapperDivPa=function(e,t){while(e.nodeName!="DIV"&&e.name!="crm-"+t+"-box")e=e.parentNode;return e.parentNode};CRM.prototype.Open=function(e){if(!BX.type.isPlainObject(e)){e={}}var t=BX.type.isPlainObject(e["titleBar"])||BX.type.isNotEmptyString(e["titleBar"])?e["titleBar"]:null;var n=BX.type.isPlainObject(e["closeIcon"])?e["closeIcon"]:null;var o=BX.type.isBoolean(e["closeByEsc"])?e["closeByEsc"]:false;var r=BX.type.isBoolean(e["autoHide"])?e["autoHide"]:!this.PopupMultiple;var a=BX.type.isElementNode(e["anchor"])?e["anchor"]:this.el;var i=BX.type.isBoolean(e["gainFocus"])?e["gainFocus"]:true;if(BX.PopupWindowManager._currentPopup!==null&&BX.PopupWindowManager._currentPopup.uniquePopupId=="CRM-"+this.crmID+"-popup"){BX.PopupWindowManager._currentPopup.close()}else{var c=[];if(this.PopupMultiple){c=[new BX.PopupWindowButton({text:this.PopupLocalize["ok"],className:"popup-window-button-accept",events:{click:BX.delegate(this._handleAcceptBtnClick,this)}}),new BX.PopupWindowButtonLink({text:this.PopupLocalize["cancel"],className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]}else{c=[new BX.PopupWindowButton({text:this.PopupLocalize["close"],className:"popup-window-button-accept",events:{click:function(){this.popupWindow.close()}}})]}this.popup=BX.PopupWindowManager.create("CRM-"+this.crmID+"-popup",a,{content:BX("crm-"+this.crmID+"_"+this.name+"-block-content-wrap"),titleBar:t,closeIcon:n,closeByEsc:o,offsetTop:2,offsetLeft:-15,zIndex:5e3,buttons:c,autoHide:r});this.popup.show();if(i){BX.focus(this.PopupSearchInput)}}return false};CRM.PopupSave2=function(e){if(!obCrm[e])return false;obCrm[e].PopupSave()};CRM.prototype._handleAcceptBtnClick=function(){this.PopupSave();this.popup.close()};CRM.prototype.AddOnSaveListener=function(e){if(typeof e!="function"){return}var t=this.onSaveListeners;for(var n=0;n<t.length;n++){if(t[n]==e){return}}t.push(e)};CRM.prototype.RemoveOnSaveListener=function(e){var t=this.onSaveListeners;for(var n=0;n<t.length;n++){if(t[n]==e){t.splice(n,1);break}}};CRM.prototype.AddOnBeforeSearchListener=function(e){if(typeof e!="function"){return}var t=this.onBeforeSearchListeners;for(var n=0;n<t.length;n++){if(t[n]==e){return}}t.push(e)};CRM.prototype.RemoveOnBeforeSearchListener=function(e){var t=this.onBeforeSearchListeners;for(var n=0;n<t.length;n++){if(t[n]==e){t.splice(n,1);break}}};CRM.prototype.PopupSave=function(){var e={};for(var t in this.PopupEntityType){var n=BX.findChildren(BX("crm-"+this.crmID+"_"+this.name+"-block-"+this.PopupEntityType[t]+"-selected"),{className:"crm-block-cont-block-item"});if(n!==null){var o=0;e[this.PopupEntityType[t]]={};for(var r=0;r<n.length;r++){var a="selected-crm-"+this.crmID+"_"+this.name+"-block-item-";var i=n[r].id.substr(a.length);var c={id:this.PopupItem[i]["id"],type:this.PopupEntityType[t],place:this.PopupItem[i]["place"],title:this.PopupItem[i]["title"],desc:this.PopupItem[i]["desc"],url:this.PopupItem[i]["url"],image:this.PopupItem[i]["image"],largeImage:this.PopupItem[i]["largeImage"]};if(typeof this.PopupItem[i]["customData"]!="undefined"){c["customData"]=this.PopupItem[i]["customData"]}if(typeof this.PopupItem[i]["advancedInfo"]!="undefined"){c["advancedInfo"]=this.PopupItem[i]["advancedInfo"]}e[this.PopupEntityType[t]][o]=c;o++}}}var p=this.onSaveListeners;if(p.length>0){for(var m=0;m<p.length;m++){try{p[m](e)}catch(e){}}}if(!this.disableMarkup){this.PopupCreateValue(e)}};CRM.prototype.ClearSelectItems=function(){this.PopupItemSelected={}};CRM.PopupShowBlock=function(e,t,n){if(!obCrm[e])return false;for(var o=0;o<obCrm[e].PopupTabs.length;o++){if(obCrm[e].PopupTabs[o]==t){obCrm[e].PopupTabsIndex=o;obCrm[e].PopupTabsIndexId=obCrm[e].PopupTabs[o].id}obCrm[e].PopupBlock[o].style.display="none";BX.removeClass(obCrm[e].PopupTabs[o],"selected")}if(!n){BX.addClass(t,"selected");obCrm[e].PopupSearchInput.value="";BX("crm-"+e+"_"+obCrm[e].name+"-block-search").innerHTML=""}else BX.addClass(obCrm[e].PopupTabs[obCrm[e].PopupTabsIndex],"selected");obCrm[e].PopupBlock[obCrm[e].PopupTabsIndex].style.display="block";BX("crm-"+e+"_"+obCrm[e].name+"-block-search").style.display="none";BX.removeClass(obCrm[e].PopupSearch[1],"selected");BX.addClass(obCrm[e].PopupSearch[0],"selected");BX.focus(obCrm[e].PopupSearchInput)};CRM.PopupShowSearchBlock=function(e,t){if(!obCrm[e])return false;for(var n=0;n<obCrm[e].PopupBlock.length;n++)obCrm[e].PopupBlock[n].style.display="none";var o=true;if(t==obCrm[e].PopupSearch[0]){CRM.PopupShowBlock(e,BX(obCrm[e].CrmPopupTabsIndexId),o);return false}BX("crm-"+obCrm[e].crmID+"_"+obCrm[e].name+"-block-search").style.display="block";BX.removeClass(obCrm[e].PopupSearch[0],"selected");BX.addClass(t,"selected");BX.focus(obCrm[e].PopupSearchInput)};CRM.PopupSelectItem=function(crmID,element,tab,unsave,select){if(!obCrm[crmID])return false;var flag=element;if(flag.check){if(select===undefined||select==false)CRM.PopupUnselectItem(crmID,element.id,"selected-"+element.id);return false}elementIdLength="crm-"+crmID+"_"+obCrm[crmID].name+"-block-item-";elementId=element.id.substr(elementIdLength.length);var addCrmItems=document.createElement("span");addCrmItems.className="crm-block-cont-block-item";addCrmItems.id="selected-"+element.id;var addCrmDelBut=document.createElement("i");var addCrmLink=document.createElement("a");addCrmLink.href=obCrm[crmID].PopupItem[elementId]["url"];addCrmLink.target="_blank";var blockWrap;if(tab===null){if(obCrm[crmID].PopupTabsIndexId=="crm-"+crmID+"_"+obCrm[crmID].name+"-tab-lead")blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-lead-selected");if(obCrm[crmID].PopupTabsIndexId=="crm-"+crmID+"_"+obCrm[crmID].name+"-tab-contact")blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-contact-selected");if(obCrm[crmID].PopupTabsIndexId=="crm-"+crmID+"_"+obCrm[crmID].name+"-tab-deal")blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-deal-selected");if(obCrm[crmID].PopupTabsIndexId=="crm-"+crmID+"_"+obCrm[crmID].name+"-tab-quote")blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-quote-selected");if(obCrm[crmID].PopupTabsIndexId=="crm-"+crmID+"_"+obCrm[crmID].name+"-tab-company")blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-company-selected")}else blockWrap=BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-"+tab+"-selected");if(blockWrap.querySelector("[id='"+("selected-"+element.id).replace(new RegExp("search$"),tab)+"']")||blockWrap.querySelector("[id='"+("selected-"+element.id).replace(new RegExp(tab+"$"),"search")+"']")){return}if(obCrm[crmID].PopupMultiple){blockTitle=BX.findChild(blockWrap,{className:"crm-block-cont-right-title-count"},true);blockTitle.innerHTML=parseInt(blockTitle.innerHTML)+1;BX.addClass(element,"crm-block-cont-item-selected");BX.addClass(blockWrap,"crm-added-item");flag.check=1}else{for(var i in obCrm[crmID].PopupEntityType){BX.removeClass(BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-"+obCrm[crmID].PopupEntityType[i]+"-selected"),"crm-added-item");elements=BX.findChildren(BX("crm-"+crmID+"_"+obCrm[crmID].name+"-block-"+obCrm[crmID].PopupEntityType[i]+"-selected"),{className:"crm-block-cont-block-item"});if(elements!==null)for(var i in elements)BX.remove(elements[i])}}blockWrap.appendChild(addCrmItems).appendChild(addCrmDelBut);blockWrap.appendChild(addCrmItems).appendChild(addCrmLink).innerHTML=BX.util.htmlspecialchars(obCrm[crmID].PopupItem[elementId]["title"]);eval('BX.bind(addCrmDelBut, "click", function(event) {CRM.PopupUnselectItem("'+crmID+'", element.id, "selected-"+element.id); BX.PreventDefault(event);})');obCrm[crmID].PopupItemSelected[elementId]=element;BX.onCustomEvent(window,"onCrmSelectedItem",[obCrm[crmID].PopupItem[elementId]]);if(!obCrm[crmID].PopupMultiple&&(unsave===undefined||unsave==false)){obCrm[crmID].PopupSave();if(BX.PopupWindowManager._currentPopup!==null&&BX.PopupWindowManager._currentPopup.uniquePopupId=="CRM-"+this.crmID+"-popup"){BX.PopupWindowManager._currentPopup.close()}}};CRM.PopupUnselectItem=function(e,t,n){if(!obCrm[e])return false;if(obCrm[e].PopupMultiple){if(BX(n).parentNode.getElementsByTagName("span").length==3)BX.removeClass(BX(n).parentNode,"crm-added-item");blockTitle=BX.findChild(BX(n).parentNode,{className:"crm-block-cont-right-title-count"},true);blockTitle.innerHTML=parseInt(blockTitle.innerHTML)-1;obj=BX(t);if(obj!==null){obj.check=0;BX.removeClass(obj,"crm-block-cont-item-selected")}}elementIdLength="crm-"+e+"_"+obCrm[e].name+"-block-item-";elementId=t.substr(elementIdLength.length);delete obCrm[e].PopupItemSelected[elementId];BX.remove(BX(n));BX.onCustomEvent(window,"onCrmUnSelectedItem",[obCrm[e].PopupItem[elementId]])};CRM.prototype.SetPopupItems=function(e,t){this.PopupItem={};this.PopupItemSelected={};var n=BX("crm-"+this.crmID+"_"+this.name+"-block-"+e);BX.cleanNode(n);for(var o=0;o<t.length;o++){var r=t[o];r["place"]=e;this.PopupAddItem(r)}};CRM.prototype.PopupSetItem=function(e){ar=e.toString().split("_");if(ar[1]!==undefined){entityShortName=ar[0];entityId=ar[1];if(entityShortName=="L")entityType="lead";else if(entityShortName=="C")entityType="contact";else if(entityShortName=="CO")entityType="company";else if(entityShortName=="D")entityType="deal";else if(entityShortName=="Q")entityType="quote";else if(entityShortName=="O")entityType="order"}else{for(var t in this.PopupEntityType)entityType=this.PopupEntityType[t];entityId=e}var n=this;var o={REQUIRE_REQUISITE_DATA:n.options.requireRequisiteData?"Y":"N"};if(BX.type.isPlainObject(n.options["searchOptions"])){var r=n.options["searchOptions"];for(var a in r){if(r.hasOwnProperty(a))o[a]=r[a]}}BX.ajax({url:"/bitrix/components/bitrix/crm."+entityType+".list/list.ajax.php",method:"POST",dataType:"json",data:{MODE:"SEARCH",VALUE:"["+entityId+"]",MULTI:n.PopupPrefix?"Y":"N",OPTIONS:o},onsuccess:function(e){for(var t in e){e[t]["selected"]="Y";n.PopupAddItem(e[t])}n.PopupSave()},onfailure:function(e){}})};CRM.prototype.PopupAddItem=function(e){if(e["place"]===undefined||e["place"]=="")e["place"]=e["type"];bElementSelected=false;if(this.PopupItemSelected[e["id"]+"-"+e["place"]]!==undefined)bElementSelected=true;itemBody=document.createElement("span");itemBody.id="crm-"+this.crmID+"_"+this.name+"-block-item-"+e["id"]+"-"+e["place"];itemBody.className="crm-block-cont-item"+(bElementSelected?" crm-block-cont-item-selected":"");itemBody.check=bElementSelected?1:0;if(e["type"]=="contact"||e["type"]=="company"){itemAvatar=document.createElement("span");itemAvatar.className="crm-avatar";if(e["image"]!==undefined&&e["image"]!=""){itemAvatar.style.background='url("'+e["image"]+'") no-repeat'}itemBody.appendChild(itemAvatar)}itemTitle=document.createElement("ins");itemTitle.appendChild(document.createTextNode(e["title"]));itemId=document.createElement("var");itemId.className="crm-block-cont-var-id";itemId.appendChild(document.createTextNode(e["id"]));itemUrl=document.createElement("var");itemUrl.className="crm-block-cont-var-url";itemUrl.appendChild(document.createTextNode(e["url"]));var t=document.createElement("span");var n=BX.prop.getString(e,"desc_html","");if(n!==""){n=BX.util.strip_tags(n)}else{n=this.prepareDescriptionHtml(BX.prop.getString(e,"desc",""))}t.innerHTML=n;var o=document.createElement("span");o.className="crm-block-cont-contact-info";o.appendChild(itemTitle);o.appendChild(t);o.appendChild(itemId);o.appendChild(itemUrl);itemBody.appendChild(o);itemBody.appendChild(document.createElement("i"));bDefinedItem=false;if(e["place"]!="search"&&this.PopupItem[e["id"]+"-"+e["place"]]!==undefined)bDefinedItem=true;else this.PopupItem[e["id"]+"-"+e["place"]]=e;var r=BX("crm-"+this.crmID+"_"+this.name+"-block-"+e["place"]);if(r!==null){if(!bDefinedItem)r.appendChild(itemBody);CRM._bindPopupItem(this.crmID,itemBody,e["type"]);if(e["selected"]!==undefined&&e["selected"]=="Y")CRM.PopupSelectItem(this.crmID,itemBody,e["type"],true,true)}};CRM._bindPopupItem=function(e,t,n){BX.bind(t,"click",function(o){CRM.PopupSelectItem(e,t,n);return BX.PreventDefault(o)})};CRM.prototype.prepareDescriptionHtml=function(e){return BX.type.isNotEmptyString(e)?BX.util.htmlspecialchars(e):""};CRM.SearchChange=function(e){if(!obCrm[e])return false;var t=obCrm[e].PopupSearchInput.value;if(t=="")return false;var n="";if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-lead")n="lead";else if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-contact")n="contact";else if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-deal")n="deal";else if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-quote")n="quote";else if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-order")n="order";else if(obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-company")n="company";else n=obCrm[e].PopupEntityType;var o={REQUIRE_REQUISITE_DATA:obCrm[e].options.requireRequisiteData?"Y":"N"};if(BX.type.isPlainObject(obCrm[e].options["searchOptions"])){var r=obCrm[e].options["searchOptions"];for(var a in r){if(r.hasOwnProperty(a))o[a]=r[a]}}var i={MODE:"SEARCH",VALUE:t,MULTI:obCrm[e].PopupPrefix?"Y":"N",OPTIONS:o};if(e==="new_invoice_product_button"){i["ENTITY_TYPE"]="INVOICE"}var c="/bitrix/components/bitrix/crm."+n+".list/list.ajax.php";var p=obCrm[e].onBeforeSearchListeners;if(p&&BX.type.isArray(p)&&p.length>0){var m={entityType:n,postData:i};for(var l=0;l<p.length;l++){try{p[l](m)}catch(e){}i=m["postData"]}}CRM.PopupShowSearchBlock(e,obCrm[e].PopupSearch[1]);setTimeout(function(){if(typeof obCrm[e]==="undefined"){return}if(BX("crm-"+e+"_"+obCrm[e].name+"-block-search").innerHTML==""&&obCrm[e].PopupTabsIndexId=="crm-"+e+"_"+obCrm[e].name+"-tab-"+n){var t=document.createElement("div");t.className="crm-block-cont-search-wait";t.innerHTML=obCrm[e].PopupLocalize["wait"];BX("crm-"+e+"_"+obCrm[e].name+"-block-search").appendChild(t)}},3e3);BX.ajax({url:c,method:"POST",dataType:"json",data:i,onsuccess:function(t){if(obCrm[e].PopupTabsIndexId!="crm-"+e+"_"+obCrm[e].name+"-tab-"+n)return false;BX("crm-"+e+"_"+obCrm[e].name+"-block-search").className="crm-block-cont-block crm-block-cont-block-"+n;BX("crm-"+e+"_"+obCrm[e].name+"-block-search").innerHTML="";el=0;for(var o in t){t[o]["place"]="search";obCrm[e].PopupAddItem(t[o]);el++}if(el==0){var r=document.createElement("div");r.className="crm-block-cont-search-no-result";r.innerHTML=obCrm[e].PopupLocalize["noresult"];BX("crm-"+e+"_"+obCrm[e].name+"-block-search").appendChild(r)}},onfailure:function(e){}})};CRM.prototype.PopupCreateValue=function(arElements){var inputBox=BX("crm-"+this.crmID+"_"+this.name+"-input-box");var textBox=BX("crm-"+this.crmID+"_"+this.name+"-text-box");if(!inputBox||!textBox){return}inputBox.innerHTML="";var textBoxNew=document.createElement("DIV");textBoxNew.id=textBox.id;textBox.parentNode.replaceChild(textBoxNew,textBox);textBox=textBoxNew;var tableObject=document.createElement("table");tableObject.className="field_crm";tableObject.cellPadding="0";tableObject.cellSpacing="0";var tbodyObject=document.createElement("TBODY");var iEl=0;for(var type in arElements){var rowObject=document.createElement("TR");rowObject.className="crmPermTableTrHeader";if(this.PopupEntityType.length>1){var cellObject=document.createElement("TD");cellObject.className="field_crm_entity_type";cellObject.appendChild(document.createTextNode(this.PopupLocalize[type]+":"));rowObject.appendChild(cellObject)}cellObject=document.createElement("TD");cellObject.className="field_crm_entity";var iTypeEl=0;for(var i in arElements[type]){var addInput=document.createElement("input");addInput.type="text";addInput.name=this.name+(this.PopupMultiple?"[]":"");addInput.value=arElements[type][i]["id"];inputBox.appendChild(addInput);var addCrmLink=document.createElement("a");addCrmLink.href=arElements[type][i]["url"];addCrmLink.target="_blank";addCrmLink.appendChild(document.createTextNode(arElements[type][i]["title"]));cellObject.appendChild(addCrmLink);var addCrmDeleteLink=document.createElement("span");addCrmDeleteLink.className="crm-element-item-delete";addCrmDeleteLink.id="deleted-crm-"+this.crmID+"_"+this.name+"-block-item-"+arElements[type][i]["id"]+"-"+arElements[type][i]["place"];eval('BX.bind(addCrmDeleteLink, "click", function(event) { CRM.PopupUnselectItem("'+this.crmID+'", this.id.substr(8), "selected-"+this.id.substr(8)); CRM.PopupSave2("'+this.crmID+'");})');cellObject.appendChild(addCrmDeleteLink);BX.fireEvent(addInput,"change");iTypeEl++;iEl++}if(iTypeEl>0){rowObject.appendChild(cellObject);tbodyObject.appendChild(rowObject)}}if(iEl==0){var addInput=document.createElement("input");addInput.type="text";addInput.name=this.name+(this.PopupMultiple?"[]":"");addInput.value="";inputBox.appendChild(addInput);BX.fireEvent(addInput,"change")}tableObject.appendChild(tbodyObject);textBox.appendChild(tableObject);if(this.el){if(iEl>0){this.el.innerHTML=this.PopupLocalize["edit"]}else{BX.cleanNode(textBox,false);if(BX.browser.IsIE()){textBox.style.fontSize="0px";textBox.style.lineHeight="0px"}this.el.innerHTML=this.PopupLocalize["add"]}}};CRM.prototype.popupShowMarkup=function(){var e=document.createElement("div");e.id="crm-"+this.crmID+"_"+this.name+"-block-content-wrap";e.className="crm-block-content";var t=document.createElement("table");t.className="crm-box-layout";if(!this.PopupMultiple)t.className=t.className+" crm-single-column";t.cellSpacing="0";var n=document.createElement("tbody");var o=document.createElement("TR");var r=document.createElement("TD");r.className="crm-block-cont-left";var a=document.createElement("div");a.id="crm-"+this.crmID+"_"+this.name+"-tabs";a.className="crm-block-cont-tabs-wrap";if(this.PopupEntityType.length==1)a.className=a.className+" crm-single-entity";var i=true;for(var c in this.PopupEntityType){var p=document.createElement("span");p.className="crm-block-cont-tabs"+(i?" selected":"");p.id="crm-"+this.crmID+"_"+this.name+"-tab-"+this.PopupEntityType[c];var m=document.createElement("span");var l=document.createElement("span");l.appendChild(document.createTextNode(this.PopupLocalize[this.PopupEntityType[c]]));m.appendChild(l);p.appendChild(m);a.appendChild(p);i=false}r.appendChild(a);a=document.createElement("div");a.id="crm-"+this.crmID+"_"+this.name+"-block-cont-search";a.className="crm-block-cont-search";var s=document.createElement("input");s.type="text";s.id="crm-"+this.crmID+"_"+this.name+"-search-input";a.appendChild(s);var d=document.createElement("span");d.className="crm-block-cont-search-tab selected";d.appendChild(document.createElement("span"));var u=document.createElement("a");u.href="#";u.appendChild(document.createTextNode(this.PopupLocalize["last"]));d.appendChild(u);d.appendChild(document.createElement("span"));a.appendChild(d);d=document.createElement("span");d.className="crm-block-cont-search-tab";d.appendChild(document.createElement("span"));u=document.createElement("a");u.href="#";u.appendChild(document.createTextNode(this.PopupLocalize["search"]));d.appendChild(u);d.appendChild(document.createElement("span"));a.appendChild(d);r.appendChild(a);a=document.createElement("div");a.className="popup-window-hr popup-window-buttons-hr";a.appendChild(document.createElement("b"));r.appendChild(a);a=document.createElement("div");a.id="crm-"+this.crmID+"_"+this.name+"-blocks";a.className="crm-block-cont-blocks-wrap";i=true;for(var c in this.PopupEntityType){var h=document.createElement("div");h.id="crm-"+this.crmID+"_"+this.name+"-block-"+this.PopupEntityType[c];h.className="crm-block-cont-block crm-block-cont-block-"+this.PopupEntityType[c];h.style.display=i?"block":"none";a.appendChild(h);i=false}h=document.createElement("div");h.id="crm-"+this.crmID+"_"+this.name+"-block-search";h.className="crm-block-cont-block";h.style.display="none";a.appendChild(h);h=document.createElement("div");h.id="crm-"+this.crmID+"_"+this.name+"-block-declared";h.className="crm-block-cont-block";h.style.display="none";a.appendChild(h);r.appendChild(a);o.appendChild(r);var b=document.createElement("TD");b.className="crm-block-cont-right";var C=document.createElement("div");C.className="crm-block-cont-right-wrap-item";for(var c in this.PopupEntityType){var f=document.createElement("div");f.className="crm-block-cont-right-item";f.id="crm-"+this.crmID+"_"+this.name+"-block-"+this.PopupEntityType[c]+"-selected";var I=document.createElement("span");I.className="crm-block-cont-right-title";I.appendChild(document.createTextNode(this.PopupLocalize[this.PopupEntityType[c]]));I.appendChild(document.createTextNode(" ("));var v=document.createElement("span");v.className="crm-block-cont-right-title-count";v.appendChild(document.createTextNode("0"));I.appendChild(v);I.appendChild(document.createTextNode(")"));f.appendChild(I);C.appendChild(f)}b.appendChild(C);o.appendChild(b);n.appendChild(o);t.appendChild(n);e.appendChild(t);var P=document.createElement("div");document.body.appendChild(P);P.id="crm-"+this.crmID+"_"+this.name+"-html-box";P.className="crm-place-holder";P.appendChild(e);if(this.div){var y=document.createElement("div");y.id="crm-"+this.crmID+"_"+this.name+"-input-box";y.style.display="none";this.div.appendChild(y);var B="crm-"+this.crmID+"_"+this.name+"-text-box";if(BX(B)){throw"Already exists "+B}var k=document.createElement("div");this.div.insertBefore(k,this.div.firstChild);k.id="crm-"+this.crmID+"_"+this.name+"-text-box"}};
//# sourceMappingURL=crm.map.js