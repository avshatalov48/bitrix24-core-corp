if(typeof BX.CrmDealStageManager==="undefined"){BX.CrmDealStageManager=function(){};BX.CrmDealStageManager.prototype={getInfos:function(t){if(!BX.type.isNotEmptyString(t)){t="category_0"}return BX.type.isArray(BX.CrmDealStageManager.infos[t])?BX.CrmDealStageManager.infos[t]:[]},isMultiType:function(){return true},getMessage:function(t){var e=BX.CrmDealStageManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null}};BX.CrmDealStageManager.current=new BX.CrmDealStageManager;BX.CrmDealStageManager.infos={category_0:[{id:"NEW",name:"In Progress",sort:10,semantics:"process"},{id:"WON",name:"Is Won",sort:20,semantics:"success"},{id:"LOSE",name:"Is Lost",sort:30,semantics:"failure"}]};BX.CrmDealStageManager.messages={}}if(typeof BX.CrmDealRecurringStageManager==="undefined"){BX.CrmDealRecurringStageManager=function(){};BX.CrmDealRecurringStageManager.prototype={getInfos:function(t){return[]},isMultiType:function(){return false},getMessage:function(t){return""},prepareDialogControls:function(t){return null}};BX.CrmDealRecurringStageManager.current=new BX.CrmDealRecurringStageManager}if(typeof BX.CrmLeadStatusManager==="undefined"){BX.CrmLeadStatusManager=function(){this._admissionPromise=null;this._admissionResult=null};BX.CrmLeadStatusManager.prototype={getInfos:function(t){return BX.CrmLeadStatusManager.infos},isMultiType:function(){return false},getMessage:function(t){return BX.prop.getString(BX.CrmLeadStatusManager.messages,t,t)},admitChange:function(t,e){this._admissionPromise=new BX.Promise;this._admissionResult={succeeded:false,previousId:t,currentId:e};if(t===e||t!=="CONVERTED"){window.setTimeout(function(){this._admissionResult["succeeded"]=true;this._admissionPromise.fulfill(this._admissionResult)}.bind(this),0)}else{var i=BX.Crm.ConfirmationDialog.get("cancelLeadConversion");if(!i){i=BX.Crm.ConfirmationDialog.create("cancelLeadConversion",{title:this.getMessage("conversionCancellationTitle"),content:this.getMessage("conversionCancellationContent")})}i.open().then(function(t){if(this._admissionPromise&&this._admissionResult){this._admissionResult["succeeded"]=!BX.prop.getBoolean(t,"cancel",true);this._admissionPromise.fulfill(this._admissionResult)}}.bind(this))}return this._admissionPromise}};BX.CrmLeadStatusManager.current=new BX.CrmLeadStatusManager;BX.CrmLeadStatusManager.infos=[{id:"NEW",name:"Not Processed",sort:10,semantics:"process"},{id:"CONVERTED",name:"Converted",sort:20,semantics:"success"},{id:"JUNK",name:"Junk",sort:30,semantics:"failure"}];BX.CrmLeadStatusManager.messages={}}if(typeof BX.CrmLeadTerminationControl==="undefined"){BX.CrmLeadTerminationControl=function(){this._id="";this._settings=null;this._entityId="";this._enabled=true;this._schemeData=null;this._selector=null;this._dialogOpenListener=BX.delegate(this.onDialogOpen,this);this._dialogCloseListener=BX.delegate(this.onDialogClose,this)};BX.CrmLeadTerminationControl.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._entityId=parseInt(this.getSetting("entityId",0));this._enabled=this.getSetting("canConvert",true);this._schemeData=this.getSetting("conversionScheme",{})},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){this._settings.setParam(t,e)},getId:function(){return this._id},getEntityId:function(){return this._entityId},isEnabled:function(){return this._enabled},prepareControlId:function(t){return(this._id+"_"+t).toLowerCase()},prepareDialogControls:function(t){var e={};var i=false;var n=t.getSetting("success");if(n){i=true;e["successButton"]=BX.create("SPAN",{attrs:{id:this.prepareControlId("success_btn_wrapper"),className:"webform-small-button-separate-wrap"},children:[BX.create("SPAN",{attrs:{id:this.prepareControlId("success_btn_inner_wrapper"),className:"webform-small-button webform-small-button-accept"},children:[BX.create("SPAN",{text:this._schemeData["schemeCaption"]+": "}),BX.create("SPAN",{attrs:{id:this.prepareControlId("success_btn")},text:this._schemeData["schemeDescription"]})]}),BX.create("SPAN",{attrs:{id:this.prepareControlId("success_btn_menu"),className:"webform-small-button-right-part"}})]})}if(i){t.addOpenListener(this._dialogOpenListener);t.addCloseListener(this._dialogCloseListener)}return e},onDialogOpen:function(t){if(this._selector){this._selector.release()}this._selector=BX.CrmLeadConversionSchemeSelector.create(this.prepareControlId("conv_scheme_selector"),{typeId:this.getSetting("typeId",BX.CrmLeadConversionType.general),entityId:this._entityId,scheme:this._schemeData["schemeName"],containerId:this.prepareControlId("success_btn_inner_wrapper"),labelId:this.prepareControlId("success_btn"),buttonId:this.prepareControlId("success_btn_menu"),originUrl:this._schemeData["originUrl"],enableHint:false})},onDialogClose:function(t){if(this._selector){this._selector.release();this._selector=null}t.removeOpenListener(this._dialogOpenListener);t.removeCloseListener(this._dialogCloseListener)}};BX.CrmLeadTerminationControl.create=function(t,e){var i=new BX.CrmLeadTerminationControl;i.initialize(t,e);return i}}if(typeof BX.CrmQuoteStatusManager==="undefined"){BX.CrmQuoteStatusManager=function(){};BX.CrmQuoteStatusManager.prototype={getInfos:function(t){return BX.CrmQuoteStatusManager.infos},isMultiType:function(){return false},getMessage:function(t){var e=BX.CrmQuoteStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null}};BX.CrmQuoteStatusManager.current=new BX.CrmQuoteStatusManager;BX.CrmQuoteStatusManager.infos=[{id:"DRAFT",name:"In Progress",sort:10,semantics:"process"},{id:"APPROVED",name:"Is Approved",sort:20,semantics:"success"},{id:"DECLAINED",name:"Is Declained",sort:30,semantics:"failure"}];BX.CrmQuoteStatusManager.messages={}}if(typeof BX.CrmOrderShipmentStatusManager==="undefined"){BX.CrmOrderShipmentStatusManager=function(){};BX.CrmOrderShipmentStatusManager.prototype={getInfos:function(t){return BX.CrmOrderShipmentStatusManager.infos},isMultiType:function(){return false},getMessage:function(t){var e=BX.CrmOrderShipmentStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null}};BX.CrmOrderShipmentStatusManager.current=new BX.CrmOrderShipmentStatusManager;BX.CrmOrderShipmentStatusManager.infos=[{id:"DN",name:"In Progress",sort:10,semantics:"process"},{id:"DF",name:"Deducted",sort:20,semantics:"success"}];BX.CrmOrderShipmentStatusManager.messages={}}if(typeof BX.CrmOrderStatusManager==="undefined"){BX.CrmOrderStatusManager=function(){this.dlg=null};BX.CrmOrderStatusManager.prototype={getSetting:function(t,e){return typeof BX.CrmOrderStatusManager.settings[t]!=="undefined"?BX.CrmOrderStatusManager.settings[t]:e},isMultiType:function(){return false},setSetting:function(t,e){BX.CrmOrderStatusManager.settings[t]=e},getInfos:function(t){return BX.CrmOrderStatusManager.infos},getMessage:function(t){var e=BX.CrmOrderStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null}};BX.CrmOrderStatusManager.current=new BX.CrmOrderStatusManager;BX.CrmOrderStatusManager.settings={};BX.CrmOrderStatusManager.statusInfoValues=[];BX.CrmOrderStatusManager.infos=[{id:"N",name:"In Progress",sort:10,semantics:"process"},{id:"F",name:"Is Paid",sort:20,semantics:"success"},{id:"D",name:"Is Dismiss",sort:30,semantics:"failure"}];BX.CrmOrderStatusManager.messages={};BX.CrmOrderStatusManager.failureDialogEventsBinded=false;BX.CrmOrderStatusManager.failureDialogEventsBind=function(){if(!BX.CrmOrderStatusManager.failureDialogEventsBinded){BX.CrmOrderStatusManager.failureDialogEventsBinded=true;BX.addCustomEvent("CrmProcessFailureDialogContentCreated",(function(t){var e=BX.CrmOrderStatusManager.current;var i=t.getEntityType();if(i==="ORDER"){var n=parseInt(t.getEntityId());var s=t.getWrapper();var r="crm_"+i+n+"_params";var a=r+"_failure";e.failureParamsId=a;if(s&&n>0&&i.length>0){var o=BX.CrmOrderStatusManager.statusInfoValues[n],l=BX.create("DIV",{attrs:{id:r},children:[BX.create("DIV",{attrs:{id:a,class:"crm-invoice-term-dialog-params"},children:[BX.create("SPAN",{attrs:{class:"comment-header"},text:e.getMessage("commentLabelText")+":"}),BX.create("TEXTAREA",{attrs:{class:"bx-crm-dialog-invoice-textarea",name:"REASON_CANCELED"},text:o["REASON_CANCELED"]?o["REASON_CANCELED"]:""})]})]});if(l)s.appendChild(l)}}}));BX.addCustomEvent("CrmProgressControlBeforeFailureDialogClose",(function(t,e){var i=e.getEntityType();if(i==="ORDER"){var n=BX.CrmOrderStatusManager.current;var s=BX(n.failureParamsId);n.saveParams={};if(s){var r=[];var a=BX.findChildren(s,{tag:"input"},true);if(a)r=r.concat(a);var o=BX.findChildren(s,{tag:"textarea"},true);if(o)r=r.concat(o);var l;for(var u in r){l=r[u].getAttribute("name");if(l)n.saveParams[l]=r[u].value}}}}));BX.addCustomEvent("CrmProgressControlBeforeSave",(function(t,e){if(t.getEntityType()!=="ORDER")return;var i=BX.CrmOrderStatusManager.current;if(BX.type.isPlainObject(i.saveParams)){var n=t.getEntityId();for(var s in i.saveParams){if(n>0)BX.CrmOrderStatusManager.statusInfoValues[n][s]=i.saveParams[s];e[s]=i.saveParams[s]}}e["STATE_SUCCESS"]=i.isSuccess?"Y":"N"}));BX.addCustomEvent("CrmProgressControlAfterSaveSucces",(function(t,e){if(t.getEntityType()!=="ORDER")return;if(BX.type.isNotEmptyString(e["ERROR"])&&BX.type.isNotEmptyString(e["STATUS_ID"])){t._currentStepId=e["STATUS_ID"];t._layout()}}))}}}if(typeof BX.CrmInvoiceStatusManager==="undefined"){BX.CrmInvoiceStatusManager=function(){this.dlg=null};BX.CrmInvoiceStatusManager.prototype={getSetting:function(t,e){return typeof BX.CrmInvoiceStatusManager.settings[t]!=="undefined"?BX.CrmInvoiceStatusManager.settings[t]:e},setSetting:function(t,e){BX.CrmInvoiceStatusManager.settings[t]=e},getInfos:function(t){return BX.CrmInvoiceStatusManager.infos},getMessage:function(t){var e=BX.CrmInvoiceStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null},_handleDateInputClick:function(t){var e=BX(this.dlgDateControlId);BX.calendar({node:BX(e),field:e,bTime:false,serverTime:this.getSetting("serverTime",""),bHideTimebar:true})},_handleDateImageMouseOver:function(t){BX.addClass(t.target,"calendar-icon-hover")},_handleDateImageMouseOut:function(t){if(!t){t=window.event}BX.removeClass(t.target,"calendar-icon-hover")}};BX.CrmInvoiceStatusManager.current=new BX.CrmInvoiceStatusManager;BX.CrmInvoiceStatusManager.settings={};BX.CrmInvoiceStatusManager.statusInfoValues=[];BX.CrmInvoiceStatusManager.infos=[{id:"N",name:"In Progress",sort:10,semantics:"process"},{id:"F",name:"Is Paid",sort:20,semantics:"success",hasParams:true},{id:"D",name:"Is Dismiss",sort:30,semantics:"failure"}];BX.CrmInvoiceStatusManager.messages={};BX.CrmInvoiceStatusManager.failureDialogEventsBinded=false;BX.CrmInvoiceStatusManager.failureDialogEventsBind=function(){if(!BX.CrmInvoiceStatusManager.failureDialogEventsBinded){BX.CrmInvoiceStatusManager.failureDialogEventsBinded=true;BX.addCustomEvent("CrmProcessFailureDialogContentCreated",(function(t){var e=BX.CrmInvoiceStatusManager.current;var i=t.getEntityType();if(i==="INVOICE"){var n=parseInt(t.getEntityId());var s=t.getWrapper();var r=t.getValue()===t.getSuccessValue();var a="crm_"+i+n+"_params";var o=a+"_success";var l=a+"_failure";var u="crm_"+i+n+"_date_success";var c="crm_"+i+n+"_date_fail";e.isSuccess=r;e.successParamsId=o;e.failureParamsId=l;e.dlgDateControlId=r?u:c;if(s&&n>0&&i.length>0){var d=BX.CrmInvoiceStatusManager.statusInfoValues[n];var h=null;h=BX.create("DIV",{attrs:{id:a},children:[BX.create("DIV",{attrs:{id:o,class:"crm-invoice-term-dialog-params",style:r?"":"display: none;"},children:[BX.create("TABLE",{children:[BX.create("TR",{children:[BX.create("TD",{class:"left-column",text:e.getMessage("dateLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{className:"bx-crm-dialog-input"},props:{type:"text",id:u,name:"PAY_VOUCHER_DATE",value:d["PAY_VOUCHER_DATE"]?d["PAY_VOUCHER_DATE"]:BX.formatDate(null,BX.message("FORMAT_DATE"))},style:{width:"70px"},events:{click:BX.delegate(e._handleDateInputClick,e)}}),BX.create("A",{props:{href:"javascript:void(0);",title:e.getMessage("setDate")},children:[BX.create("IMG",{attrs:{src:e.getSetting("imagePath","")+"calendar.gif",className:"calendar-icon",alt:e.getMessage("setDate")},events:{click:BX.delegate(e._handleDateInputClick,e),mouseover:BX.delegate(e._handleDateImageMouseOver,e),mouseout:BX.delegate(e._handleDateImageMouseOut,e)}})]})]})]}),BX.create("TR",{children:[BX.create("TD",{class:"left-column",text:e.getMessage("payVoucherNumLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{class:"bx-crm-dialog-input",type:"text",name:"PAY_VOUCHER_NUM",value:d["PAY_VOUCHER_NUM"]?d["PAY_VOUCHER_NUM"].substring(0,20):"",maxlength:20,size:20}})]})]})]}),BX.create("DIV",{attrs:{class:"separator"}}),BX.create("SPAN",{attrs:{class:"comment-header"},text:e.getMessage("commentLabelText")+":"}),BX.create("TEXTAREA",{attrs:{class:"bx-crm-dialog-invoice-textarea",name:"REASON_MARKED_SUCCESS"},text:d["REASON_MARKED"]?d["REASON_MARKED"]:""})]}),BX.create("DIV",{attrs:{id:l,class:"crm-invoice-term-dialog-params",style:r?"display: none;":""},children:[BX.create("TABLE",{children:[BX.create("TR",{children:[BX.create("TD",{class:"left-column",text:e.getMessage("dateLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{className:"bx-crm-dialog-input"},props:{type:"text",id:c,name:"DATE_MARKED",value:d["DATE_MARKED"]?d["DATE_MARKED"]:BX.formatDate(null,BX.message("FORMAT_DATE"))},style:{width:"70px"},events:{click:BX.delegate(e._handleDateInputClick,e)}}),BX.create("A",{props:{href:"javascript:void(0);",title:e.getMessage("setDate")},children:[BX.create("IMG",{attrs:{src:e.getSetting("imagePath","")+"calendar.gif",className:"calendar-icon",alt:e.getMessage("setDate")},events:{click:BX.delegate(e._handleDateInputClick,e),mouseover:BX.delegate(e._handleDateImageMouseOver,e),mouseout:BX.delegate(e._handleDateImageMouseOut,e)}})]})]})]})]}),BX.create("DIV",{attrs:{class:"separator"}}),BX.create("SPAN",{attrs:{class:"comment-header"},text:e.getMessage("commentLabelText")+":"}),BX.create("TEXTAREA",{attrs:{class:"bx-crm-dialog-invoice-textarea",name:"REASON_MARKED"},text:d["REASON_MARKED"]?d["REASON_MARKED"]:""})]})]});if(h)s.appendChild(h)}}}));BX.addCustomEvent("CrmProcessFailureDialogValueChanged",(function(t,e){var i=BX.CrmInvoiceStatusManager.current;var n=t.getEntityType();if(n==="INVOICE"){var s=parseInt(t.getEntityId());var r=t.getWrapper();var a=e===t.getSuccessValue();var o="crm_"+n+s+"_params";var l=o+"_success";var u=o+"_failure";var c=BX(l);var d=BX(u);var h="crm_"+n+s+"_date_success";var p="crm_"+n+s+"_date_fail";i.isSuccess=a;i.dlgDateControlId=a?h:p;if(c)c.setAttribute("style",a?"":"display: none;");if(d)d.setAttribute("style",a?"display: none;":"")}}));BX.addCustomEvent("CrmProgressControlBeforeFailureDialogClose",(function(t,e){var i=e.getEntityType();if(i==="INVOICE"){var n=BX.CrmInvoiceStatusManager.current;var s=BX(n.isSuccess?n.successParamsId:n.failureParamsId);n.saveParams={};if(s){var r=[];var a=BX.findChildren(s,{tag:"input"},true);if(a)r=r.concat(a);var o=BX.findChildren(s,{tag:"textarea"},true);if(o)r=r.concat(o);var l;for(var u in r){l=r[u].getAttribute("name");if(l)n.saveParams[l]=r[u].value}}}}));BX.addCustomEvent("CrmProgressControlBeforeSave",(function(t,e){if(t.getEntityType()!=="INVOICE"){return}var i=BX.CrmInvoiceStatusManager.current;if(BX.type.isPlainObject(i.saveParams)){var n=t.getEntityId();var s;for(var r in i.saveParams){if(n>0){if(r==="REASON_MARKED_SUCCESS")s="REASON_MARKED";else s=r;BX.CrmInvoiceStatusManager.statusInfoValues[n][s]=i.saveParams[r]}e[r]=i.saveParams[r]}}e["STATE_SUCCESS"]=i.isSuccess?"Y":"N"}))}}}if(typeof BX.CrmItemStatusManager==="undefined"){BX.CrmItemStatusManager=function(){};BX.CrmItemStatusManager.prototype={getInfos:function(t){if(BX.CrmItemStatusManager.infos===[]){console.log("Error: CrmItemStatusManager has not default stages")}return BX.type.isArray(BX.CrmItemStatusManager.infos[t])?BX.CrmItemStatusManager.infos[t]:[]},isMultiType:function(){return false},getMessage:function(t){var e=BX.CrmItemStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareDialogControls:function(t){return null}};BX.CrmItemStatusManager.current=new BX.CrmItemStatusManager;BX.CrmItemStatusManager.messages={};BX.CrmItemStatusManager.infos=[]}if(typeof BX.CrmProgressManager==="undefined"){BX.CrmProgressManager=function(){};BX.CrmProgressManager.prototype={resolve:function(t){if(t===BX.CrmEntityType.enumeration.deal){return BX.CrmDealStageManager.current}else if(t===BX.CrmEntityType.enumeration.dealrecurring){return BX.CrmDealRecurringStageManager.current}else if(t===BX.CrmEntityType.enumeration.quote){return BX.CrmQuoteStatusManager.current}else if(t===BX.CrmEntityType.enumeration.lead){return BX.CrmLeadStatusManager.current}else if(t===BX.CrmEntityType.enumeration.order){return BX.CrmOrderStatusManager.current}else if(t===BX.CrmEntityType.enumeration.ordershipment){return BX.CrmOrderShipmentStatusManager.current}return null},isMultiType:function(t){var e=this.resolve(t);if(!e){return false}return BX.type.isFunction(e.isMultiType)&&e.isMultiType()}};BX.CrmProgressManager.current=new BX.CrmProgressManager}if(typeof BX.CrmProgressControl==="undefined"){BX.CrmProgressControl=function(){this._id="";this._settings=null;this._container=null;this._legendContainer=null;this._entityId=0;this._entityType=null;this._previousStepId="";this._currentStepId="";this._infoTypeId="";this._manager=null;this._stepInfos=null;this._steps=[];this._terminationControl=null;this._terminationDlg=null;this._failureDlg=null;this._isFrozen=false;this._isReadOnly=false;this._entityEditorDialog=null;this._externalEventHandler=null;this._entityConvertHandler=null;this._entityEditorDialogHandler=BX.delegate(this._onEntityEditorDialogClose,this);this._enableCustomColors=false;this._defaultProcessColor="#ACE9FB";this._defaultSuccessSuccessColor="#DBF199";this._defaultFailureColor="#FFBEBD"};BX.CrmProgressControl.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._container=BX(this.getSetting("containerId"));var i=this.getSetting("legendContainerId");if(BX.type.isNotEmptyString(i)){this._legendContainer=BX(i)}if(!BX.type.isElementNode(this._legendContainer)){this._legendContainer=BX.findNextSibling(this._container,{className:"crm-list-stage-bar-title"})}this._entityId=parseInt(this.getSetting("entityId",0));this._entityType=this.getSetting("entityType");this._currentStepId=this.getSetting("currentStepId");this._infoTypeId=this.getSetting("infoTypeId","");this._enableCustomColors=this.getSetting("enableCustomColors");if(this._entityType==="DEAL"){this._manager=BX.CrmDealStageManager.current}else if(this._entityType==="LEAD"){this._manager=BX.CrmLeadStatusManager.current;this._terminationControl=BX.CrmLeadTerminationControl.create(this._id,BX.CrmParamBag.create({entityId:this._entityId,conversionScheme:this.getSetting("conversionScheme",null),canConvert:this.getSetting("canConvert",true),typeId:this.getSetting("conversionTypeId",BX.CrmLeadConversionType.general)}))}else if(this._entityType==="QUOTE"){this._manager=BX.CrmQuoteStatusManager.current}else if(this._entityType==="ORDER"){this._manager=BX.CrmOrderStatusManager.current}else if(this._entityType==="ORDER_SHIPMENT"){this._manager=BX.CrmOrderShipmentStatusManager.current}else if(this._entityType==="INVOICE"){this._manager=BX.CrmInvoiceStatusManager.current}else if(BX.CrmEntityType.isUseDynamicTypeBasedApproachByName(this._entityType)){this._manager=BX.CrmItemStatusManager.current}var n=this._stepInfos=this._manager.getInfos(this._infoTypeId);var s=this._findStepInfoIndex(this._currentStepId);var r=s>=0?n[s]:null;this._isReadOnly=this.getSetting("readOnly",false);this._isFrozen=this._isReadOnly||(r&&BX.type.isBoolean(r["isFrozen"])?r["isFrozen"]:false);for(var a=0;a<n.length;a++){var o=n[a];var l=this.getStepContainer(o["id"]);if(!l){continue}var u=parseInt(o["sort"]);this._steps.push(BX.CrmProgressStep.create(o["id"],BX.CrmParamBag.create({name:o["name"],hint:BX.type.isNotEmptyString(o["hint"])?o["hint"]:"",sort:u,isPassed:a<=s,isReadOnly:this._isReadOnly,control:this})))}},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){this._settings.setParam(t,e)},getId:function(){return this._id},getEntityType:function(){return this._entityType},getEntityId:function(){return this._entityId},getCurrentStepId:function(){return this._currentStepId},getStepById:function(t){for(var e=0,i=this._steps.length;e<i;e++){var n=this._steps[e];if(n.getId()===t){return n}}return null},isFrozen:function(){return this._isFrozen},isReadOnly:function(){return this._isReadOnly},onExternalEvent:function(t){var e=BX.prop.getString(t,"key","");if(e!=="onCrmEntityConvert"){return}var i=BX.prop.getObject(t,"value",{});if(this._entityType===BX.prop.getString(i,"entityTypeName")&&this._entityId===BX.prop.getInteger(i,"entityId",0)){this._closeTerminationDialog();this._closeFailureDialog()}},onEntityConvert:function(t,e){if(this._entityType===BX.prop.getString(e,"entityTypeName")&&this._entityId===BX.prop.getInteger(e,"entityId",0)){this._closeTerminationDialog();this._closeFailureDialog()}},getStepContainer:function(t){return BX.type.isNotEmptyString(t)?BX.findChild(this._container,{tag:"DIV",class:"crm-stage-"+t.toLowerCase()},true):null},setCurrentStep:function(t){this._closeTerminationDialog();if(!t||this._isReadOnly||this._isFrozen||this._entityEditorDialog!==null){return}if(BX.type.isFunction(this._manager["admitChange"])){this._manager.admitChange(this._currentStepId,t.getId()).then(function(t){if(!BX.prop.getBoolean(t,"succeeded",false)){return}var e=this.getStepById(BX.prop.getString(t,"currentId",""));if(e){this.setupStep(e)}}.bind(this))}else{this.setupStep(t)}},setupStep:function(t){var e=this._findStepInfoIndex(t.getId());if(e<0){return}if(e===this._steps.length-1&&this._findStepInfoBySemantics("success")&&this._findStepInfoBySemantics("failure")){if(!this._terminationControl||this._terminationControl.isEnabled()){this._openTerminationDialog()}return}var i=t.getId();if(this._currentStepId===i){return}this._previousStepId=this._currentStepId;this._currentStepId=i;this._layout();this._save()},setCurrentStepId:function(t){if(this._currentStepId!==t){this._previousStepId=this._currentStepId;this._currentStepId=t;this._layout()}},getCurrentStepInfo:function(){var t=this._findStepInfoIndex(this._currentStepId);return t>=0?this._stepInfos[t]:null},isCustomColorsEnabled:function(){return this._enableCustomColors},setColor:function(t){if(!this._stepInfos[t]||!this._enableCustomColors){return}var e=BX.findChildren(this._container,{tag:"td",attribute:{class:"crm-list-stage-bar-part"}},true);for(var i=0;i<e.length;i++){if(i>t){e[i].style.background=""}else{var n=this._stepInfos[t];var s=BX.type.isNotEmptyString(n["color"])?n["color"]:"";if(s===""){var r=BX.type.isNotEmptyString(n["semantics"])?n["semantics"]:"";if(r==="success"){s=this._defaultSuccessSuccessColor}else if(r==="failure"){s=this._defaultFailureColor}else{s=this._defaultProcessColor}}e[i].style.background=s}}},_layout:function(){var t=this._findStepInfoIndex(this._currentStepId);if(t<0){return}for(var e=0;e<this._steps.length;e++){this._steps[e].setPassed(e<=t)}this.setColor(t);var i=this._stepInfos[t];this._isFrozen=BX.type.isBoolean(i["isFrozen"])?i["isFrozen"]:false;var n=BX.type.isNotEmptyString(i["semantics"])?i["semantics"]:"";if(n==="success"){if(this._enableCustomColors){this._container.style.background=i["color"]}else{BX.addClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}}else if(n==="failure"||n==="apology"){if(this._enableCustomColors){this._container.style.background=i["color"]}else{BX.removeClass(this._container,"crm-list-stage-end-good");BX.addClass(this._container,"crm-list-stage-end-bad")}}else{if(this._enableCustomColors){this._container.style.background=""}else{BX.removeClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}}if(this._legendContainer){this._legendContainer.innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(i["name"])?i["name"]:i["id"])}},_openTerminationDialog:function(){this._enableStepHints(false);if(this._terminationDlg){this._terminationDlg.close();this._terminationDlg=null}var t=this._findAllStepInfoBySemantics("apology");this._terminationDlg=BX.CrmProcessTerminationDialog.create(this._id+"_TERMINATION",BX.CrmParamBag.create({title:this._manager.getMessage("dialogTitle"),failureTitle:t.length>0?this._manager.getMessage("failureTitle"):"",anchor:this._container,success:this._findStepInfoBySemantics("success"),failure:this._findStepInfoBySemantics("failure"),apologies:t,callback:BX.delegate(this._onTerminationDialogClose,this),terminationControl:this._terminationControl}));this._terminationDlg.open();if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}if(!this._entityConvertHandler){this._entityConvertHandler=BX.delegate(this.onEntityConvert,this);BX.addCustomEvent(window,"Crm.EntityConverter.Converted",this._entityConvertHandler)}},_closeTerminationDialog:function(){if(!this._terminationDlg){return}this._terminationDlg.close(false);this._terminationDlg=null;this._enableStepHints(true);if(this._externalEventHandler){BX.removeCustomEvent(window,"onLocalStorageSet",this._externalEventHandler);this._externalEventHandler=null}},_onTerminationDialogClose:function(dialog,params){if(this._terminationDlg!==dialog){return}this._closeTerminationDialog();var stepId=BX.type.isNotEmptyString(params["result"])?params["result"]:"";var index=this._findStepInfoIndex(stepId);if(index<0){return}this._previousStepId=this._currentStepId;this._currentStepId=stepId;var openFailureDialog=false;var info=this._stepInfos[index];var failure=this._findStepInfoBySemantics("failure");if(failure&&failure["id"]===stepId){openFailureDialog=true}else if(info["semantics"]==="success"){if(typeof info["hasParams"]!=="undefined"&&info["hasParams"]===true){openFailureDialog=true}else{var finalScript=this.getSetting("finalScript","");if(finalScript!==""){eval(finalScript);return}var finalUrl=this.getSetting("finalUrl","");if(finalUrl!==""){window.location=finalUrl;return}}}if(openFailureDialog){this._openFailureDialog();return}this._layout();this._save()},_openFailureDialog:function(){this._enableStepHints(false);if(this._failureDlg){this._failureDlg.close();this._failureDlg=null}var t=this._findStepInfoIndex(this._currentStepId);var e=t>=0?this._stepInfos[t]:null;var i=e?e["id"]:"";var n=this._findAllStepInfoBySemantics("apology");this._failureDlg=BX.CrmProcessFailureDialog.create(this._id+"_FAILURE",BX.CrmParamBag.create({entityType:this._entityType,entityId:this._entityId,initValue:i,failureTitle:n.length>0?this._manager.getMessage("failureTitle"):"",selectorTitle:this._manager.getMessage("selectorTitle"),anchor:this._container,success:this._findStepInfoBySemantics("success"),failure:this._findStepInfoBySemantics("failure"),apologies:n,callback:BX.delegate(this._onFailureDialogClose,this)}));this._failureDlg.open();if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}},_closeFailureDialog:function(){if(!this._failureDlg){return}this._failureDlg.close(false);this._failureDlg=null;this._enableStepHints(true);if(this._externalEventHandler){BX.removeCustomEvent(window,"onLocalStorageSet",this._externalEventHandler);this._externalEventHandler=null}},_onFailureDialogClose:function(dialog,params){if(this._failureDlg!==dialog){return}BX.onCustomEvent(this,"CrmProgressControlBeforeFailureDialogClose",[this,this._failureDlg]);this._closeFailureDialog();var bid=BX.type.isNotEmptyString(params["bid"])?params["bid"]:"";if(bid!=="accept"){return}var id=BX.type.isNotEmptyString(params["result"])?params["result"]:"";var index=this._findStepInfoIndex(id);if(index>=0){var info=this._stepInfos[index];if(info["semantics"]==="success"){var finalScript=this.getSetting("finalScript","");if(finalScript!==""){eval(finalScript);return}var finalUrl=this.getSetting("finalUrl","");if(finalUrl!==""){window.location=finalUrl;return}var verboseMode=!!this.getSetting("verboseMode",false);if(verboseMode){this._openTerminationDialog();return}}this._currentStepId=info["id"];this._layout();this._save()}},_save:function(){var t=this.getSetting("serviceUrl");var e=this.getCurrentStepId();var i=this.getEntityType();var n=this.getEntityId();if(t===""||e===""||i===""||n<=0){return}if(BX.CrmEntityType.isUseDynamicTypeBasedApproachByName(i)){BX.ajax.runAction(t,{data:{entityTypeId:BX.CrmEntityType.resolveId(i),id:n,fields:{stageId:this.getCurrentStepId()}}}).then(function(t){this._onSaveRequestSuccess(t.data)}.bind(this)).catch(function(t){var e=false;var i={};var n="";for(var s in t.errors){if(t.errors[s].code==="CRM_FIELD_ERROR_REQUIRED"){i[t.errors[s].customData.fieldName]=t.errors[s].message;e=true}if(n===""){n=t.errors[s].message}else{n=n+", "+t.errors[s].message}}var r={CHECK_ERRORS:i,ERROR:n,ID:this.getEntityId(),TYPE:this.getEntityType(),VALUE:this.getCurrentStepId()};if(e){this._onSaveRequestSuccess(r)}else{console.log(n);this._onSaveRequestFailure(r)}}.bind(this))}else{var s={ACTION:"SAVE_PROGRESS",VALUE:e,TYPE:i,ID:n,sessid:BX.bitrix_sessid()};BX.onCustomEvent(this,"CrmProgressControlBeforeSave",[this,s]);BX.ajax({url:t,method:"POST",dataType:"json",data:s,onsuccess:BX.delegate(this._onSaveRequestSuccess,this),onfailure:BX.delegate(this._onSaveRequestFailure,this)})}},_onSaveRequestSuccess:function(t){var e=BX.prop.getObject(t,"CHECK_ERRORS",null);if(e){this._openEntityEditorDialog({title:this._manager.getMessage("checkErrorTitle"),helpData:{text:this._manager.getMessage("checkErrorHelp"),code:this._manager.getMessage("checkErrorHelpArticleCode")},fieldNames:Object.keys(e),initData:BX.prop.getObject(t,"EDITOR_INIT_DATA",null),context:BX.prop.getObject(t,"CONTEXT",null),isController:BX.CrmEntityType.isUseFactoryBasedApproachByName(this.getEntityType()),stageId:BX.prop.getString(t,"VALUE",null)});return}BX.onCustomEvent(this,"CrmProgressControlAfterSaveSucces",[this,t]);BX.CrmProgressControl._synchronize(this)},_onSaveRequestFailure:function(t){BX.onCustomEvent(self,"CrmProgressControlAfterSaveFailed",[this,t])},_openEntityEditorDialog:function(t){BX.Crm.PartialEditorDialog.close("progressbar-entity-editor");this._entityEditorDialog=BX.Crm.PartialEditorDialog.create("progressbar-entity-editor",{title:BX.prop.getString(t,"title","Please fill in all required fields"),entityTypeName:this._entityType,entityId:this._entityId,fieldNames:BX.prop.getArray(t,"fieldNames",[]),helpData:BX.prop.getObject(t,"helpData",null),context:BX.prop.getObject(t,"context",null),isController:BX.prop.getBoolean(t,"isController",false),stageId:BX.prop.getString(t,"stageId",null)});window.setTimeout(function(){this._entityEditorDialog.open();BX.addCustomEvent(window,"Crm.PartialEditorDialog.Close",this._entityEditorDialogHandler)}.bind(this),150)},_onEntityEditorDialogClose:function(t,e){if(!(this._entityType===BX.prop.getString(e,"entityTypeName",0)&&this._entityId===BX.prop.getInteger(e,"entityId",0))){return}this._entityEditorDialog=null;BX.removeCustomEvent(window,"Crm.PartialEditorDialog.Close",this._entityEditorDialogHandler);if(BX.prop.getBoolean(e,"isCancelled",true)&&this._previousStepId!==""){var i=this._findStepInfoIndex(this._previousStepId);if(i>=0){this._currentStepId=this._previousStepId;this._previousStepId="";this._layout()}}},_findStepInfoBySemantics:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){var n=e[i];var s=BX.type.isNotEmptyString(n["semantics"])?n["semantics"]:"";if(t===s){return n}}return null},_findAllStepInfoBySemantics:function(t){var e=[];var i=this._stepInfos;for(var n=0;n<i.length;n++){var s=i[n];var r=BX.type.isNotEmptyString(s["semantics"])?s["semantics"]:"";if(t===r){e.push(s)}}return e},_findStepInfoIndex:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){if(e[i]["id"]===t){return i}}return-1},_enableStepHints:function(t){for(var e=0;e<this._steps.length;e++){this._steps[e].enableHint(t)}}};BX.CrmProgressControl.items={};BX.CrmProgressControl.create=function(t,e){var i=new BX.CrmProgressControl;i.initialize(t,e);this.items[t]=i;return i};BX.CrmProgressControl._synchronize=function(t){var e=t.getEntityType();var i=t.getEntityId();for(var n in this.items){if(!this.items.hasOwnProperty(n)){continue}var s=this.items[n];if(s===t){continue}if(s.getEntityType()===e&&s.getEntityId()===i){s.setCurrentStepId(t.getCurrentStepId())}}}}if(typeof BX.CrmProgressStep==="undefined"){BX.CrmProgressStep=function(){this._id="";this._settings=null;this._control=null;this._container=null;this._name="";this._hint="";this._isPassed=false;this._isReadOnly=false;this._enableHint=true;this._hintPopup=null;this._hintPopupTimeoutId=null};BX.CrmProgressStep.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._control=this.getSetting("control");this._container=this._control.getStepContainer(this._id);this._name=this.getSetting("name");this._hint=this.getSetting("hint","");this._isPassed=this.getSetting("isPassed",false);this._isReadOnly=this.getSetting("isReadOnly",false);if(!this._isReadOnly){BX.bind(this._container,"mouseover",BX.delegate(this._onMouseOver,this));BX.bind(this._container,"mouseout",BX.delegate(this._onMouseOut,this));BX.bind(this._container,"click",BX.delegate(this._onClick,this))}},getId:function(){return this._id},getName:function(){return this._name},getSetting:function(t,e){return this._settings.getParam(t,e)},isPassed:function(){return this._isPassed},setPassed:function(t){t=!!t;if(this._isPassed===t){return}this._isPassed=t;if(!this._control.isCustomColorsEnabled()){var e=BX.findParent(this._container,{class:"crm-list-stage-bar-part"});if(t){BX.addClass(e,"crm-list-stage-passed")}else{BX.removeClass(e,"crm-list-stage-passed")}}},isReadOnly:function(){return this._isReadOnly},isHintEnabled:function(){return this._enableHint},enableHint:function(t){t=!!t;if(this._enableHint===t){return}this._enableHint=t;if(!t){this.hideStepHint()}},displayStepHint:function(t){if(!this._enableHint||this._hintPopup){return}var e=BX.pos(this._container);this._hintPopup=BX.PopupWindowManager.create("step-hint-"+this._id,t,{angle:{position:"bottom",offset:0},offsetLeft:e["width"]/2,offsetTop:5,content:BX.create("SPAN",{attrs:{class:"crm-list-bar-popup-text"},text:this._hint!==""?this._hint:this._name}),className:"crm-list-bar-popup-table"});this._hintPopup.show()},hideStepHint:function(){if(!this._hintPopup){return}this._hintPopup.close();this._hintPopup.destroy();this._hintPopup=null},_onClick:function(t){if(!this._isReadOnly){this._control.setCurrentStep(this)}},_onMouseOver:function(t){if(this._hintPopupTimeoutId!==null){window.clearTimeout(this._hintPopupTimeoutId)}t=t||window.event;var e=t.target||t.srcElement;var i=this;this._hintPopupTimeoutId=window.setTimeout((function(){i._hintPopupTimeoutId=null;i.displayStepHint(e)}),300)},_onMouseOut:function(t){if(this._hintPopupTimeoutId!==null){window.clearTimeout(this._hintPopupTimeoutId)}if(!this._enableHint){return}var e=this;this._hintPopupTimeoutId=window.setTimeout((function(){e._hintPopupTimeoutId=null;e.hideStepHint()}),300)}};BX.CrmProgressStep.create=function(t,e){var i=new BX.CrmProgressStep;i.initialize(t,e);return i}}if(typeof BX.CrmProcessTerminationDialog==="undefined"){BX.CrmProcessTerminationDialog=function(){this._id="";this._settings=null;this._terminationControl=null;this._popup=null;this._wrapper=null;this._openNotifier=null;this._closeNotifier=null;this._result="";this._enableCallback=true};BX.CrmProcessTerminationDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._terminationControl=this.getSetting("terminationControl",null);this._openNotifier=BX.CrmNotifier.create(this);this._closeNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.getParam(t,e)},getId:function(){return this._id},getResult:function(){return this._result},open:function(){if(!this._popup){this._popup=new BX.PopupWindow(this._id,this.getSetting("anchor"),{closeByEsc:true,autoHide:false,offsetLeft:-50,closeIcon:true,className:"crm-list-end-deal",content:this._prepareContent(),events:{onPopupShow:BX.delegate(this._onPopupShow,this),onPopupClose:BX.delegate(this._onPopupClose,this)}})}this._popup.show()},addOpenListener:function(t){this._openNotifier.addListener(t)},removeOpenListener:function(t){this._openNotifier.removeListener(t)},close:function(t){this._enableCallback=!!t;if(this._popup){this._popup.close()}},addCloseListener:function(t){this._closeNotifier.addListener(t)},removeCloseListener:function(t){this._closeNotifier.removeListener(t)},_onPopupShow:function(){this._openNotifier.notify()},_onPopupClose:function(){if(this._popup){this._popup.destroy();this._popup=null}this._closeNotifier.notify();this._executeCallback()},_prepareContent:function(){this._wrapper=BX.create("DIV");var t=BX.create("TABLE",{attrs:{className:"crm-list-end-deal-block"},props:{cellSpacing:"0",cellPadding:"0",border:"0"}});this._wrapper.appendChild(t);var e=t.insertRow(-1).insertCell(-1);e.className="crm-list-end-deal-text";e.innerHTML=this.getSetting("title","");e=t.insertRow(-1).insertCell(-1);e.className="crm-list-end-deal-buttons-block";var i=this._terminationControl!==null?this._terminationControl.prepareDialogControls(this):null;if(!BX.type.isPlainObject(i)){i={}}if(BX.type.isElementNode(i["successButton"])){e.appendChild(i["successButton"])}else{var n=this.getSetting("success");if(n){var s=BX.type.isNotEmptyString(n["name"])?n["name"]:"Success";var r=BX.create("A",{attrs:{className:"webform-small-button webform-small-button-accept",href:"#"},children:[BX.create("SPAN",{attrs:{className:"webform-small-button-left"}}),BX.create("SPAN",{attrs:{className:"webform-small-button-text"},text:s}),BX.create("SPAN",{attrs:{className:"webform-small-button-right"}})]});e.appendChild(r);var a=BX.type.isNotEmptyString(n["id"])?n["id"]:"success";BX.CrmSubscriber.subscribe(this.getId()+"_"+a,r,"click",BX.delegate(this._onButtonClick,this),BX.CrmParamBag.create({id:a,preventDefault:true}))}}if(BX.type.isElementNode(i["failureButton"])){e.appendChild(i["failureButton"])}else{var o=this.getSetting("failure");if(o){var l=this.getSetting("failureTitle","");if(l===""){l=BX.type.isNotEmptyString(o["name"])?o["name"]:"Failure"}var u=BX.create("A",{attrs:{className:"webform-small-button webform-small-button-decline",href:"#"},children:[BX.create("SPAN",{attrs:{className:"webform-small-button-left"}}),BX.create("SPAN",{attrs:{className:"webform-small-button-text"},text:l}),BX.create("SPAN",{attrs:{className:"webform-small-button-right"}})]});e.appendChild(u);var c=BX.type.isNotEmptyString(o["id"])?o["id"]:"failure";BX.CrmSubscriber.subscribe(this.getId()+"_"+c,u,"click",BX.delegate(this._onButtonClick,this),BX.CrmParamBag.create({id:c,preventDefault:true}))}}return this._wrapper},_onButtonClick:function(t,e){this._result=t.getSetting("id","");this._executeCallback()},_executeCallback:function(){if(this._enableCallback){var t=this.getSetting("callback");if(BX.type.isFunction(t)){t(this,{result:this._result})}}}};BX.CrmProcessTerminationDialog.create=function(t,e){var i=new BX.CrmProcessTerminationDialog;i.initialize(t,e);return i}}if(typeof BX.CrmProcessFailureDialog==="undefined"){BX.CrmProcessFailureDialog=function(){this._id="";this._settings=null;this._popup=null;this._wrapper=null;this._callback=null;this._enableCallback=true;this._value="";this._bid="";this._successInfo=null;this._failureInfo=null;this._apologyInfos=null;this._failureTitle="";this._selectorTitle="";this._radioButtonBlock=null;this._popupMenuId="";this._popupMenu=null};BX.CrmProcessFailureDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._callback=this.getSetting("callback",null);this._successInfo=this.getSetting("success",null);if(!this._successInfo){throw"BX.CrmProcessFailureDialog: 'success' setting is not found!"}this._failureInfo=this.getSetting("failure",null);if(!this._failureInfo){throw"BX.CrmProcessFailureDialog: 'failure' setting is not found!"}this._apologyInfos=this.getSetting("apologies",null);if(!BX.type.isArray(this._apologyInfos)){this._apologyInfos=[]}var i=this.getSetting("initValue","");if(i===""){i=this._failureInfo["id"]}this._value=i;this._failureTitle=this.getSetting("failureTitle","");this._selectorTitle=this.getSetting("selectorTitle","");this._popupMenuId=this._id+"_MENU"},getSetting:function(t,e){return this._settings.getParam(t,e)},getEntityType:function(){return this.getSetting("entityType")},getEntityId:function(){return this.getSetting("entityId")},getId:function(){return this._id},getValue:function(){return this._value},setValue:function(t,e){if(this._value===t){return}this._value=t;if(typeof e==="undefined"){e=true}else{e=!!e}if(e){var i=BX.findChildren(this._wrapper,{className:"crm-list-fail-deal-button"},true);for(var n=0;n<i.length;n++){var s=i[n];s.checked=s.value===t}}BX.onCustomEvent(this,"CrmProcessFailureDialogValueChanged",[this,t])},getSuccessValue:function(){return this._successInfo["id"]},getBid:function(){return this._bid},getWrapper:function(){return this._wrapper},open:function(){if(this._popup){this._popup.show();return}this._popup=new BX.PopupWindow(this._id,this.getSetting("anchor"),{closeByEsc:true,autoHide:true,offsetLeft:-50,closeIcon:true,className:"crm-list-fail-deal",titleBar:{content:this._prepareTitle()},content:this._prepareContent(),events:{onPopupClose:BX.delegate(this._onPopupClose,this)},buttons:[new BX.PopupWindowButton({text:BX.message["JS_CORE_WINDOW_SAVE"],className:"popup-window-button-accept",events:{click:BX.delegate(this._onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message["JS_CORE_WINDOW_CANCEL"],className:"popup-window-button-link-cancel",events:{click:BX.delegate(this._onCancelButtonClick,this)}})]});this._popup.show()},close:function(t){this._enableCallback=!!t;if(this._popup){this._popup.close()}},getFailureTitle:function(){var t=this._failureTitle;if(t==""){t=BX.type.isNotEmptyString(this._failureInfo["name"])?this._failureInfo["name"]:this._failureInfo["id"]}return t},getSuccessTitle:function(){return BX.type.isNotEmptyString(this._successInfo["name"])?this._successInfo["name"]:this._successInfo["id"]},_onPopupClose:function(){this._closePopupMenu();if(this._popup){this._popup.destroy();this._popup=null}this._executeCallback()},_closePopupMenu:function(){if(this._popupMenu){BX.PopupMenu.Data[this._popupMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._popupMenuId];this._popupMenu=null}},_prepareTitle:function(){var t=BX.create("DIV",{attrs:{class:"crm-list-fail-deal-selector-block"}});t.appendChild(BX.create("SPAN",{text:this._selectorTitle+": "}));var e=this._value===this._successInfo["id"];this._selector=BX.create("DIV",{attrs:{className:"crm-list-end-deal-option crm-list-end-deal-option-"+(e?"success":"fail")},events:{click:BX.delegate(this._onSelectorClick,this)},text:e?this.getSuccessTitle():this.getFailureTitle()});t.appendChild(this._selector);return t},_prepareContent:function(){var t=this._wrapper=BX.create("DIV",{attrs:{className:"crm-list-fail-deal-block"}});var e=this.getSetting("title","");if(e!==""){t.appendChild(BX.create("DIV",{attrs:{className:"crm-list-end-deal-text"},text:e}))}this._radioButtonBlock=BX.create("DIV",{attrs:{className:"crm-list-end-deal-block-section"}});var i=[this._failureInfo];var n=this._apologyInfos;if(BX.type.isArray(n)&&n.length>0){for(var s=0;s<n.length;s++){i.push(n[s])}}for(var r=0;r<i.length;r++){var a=BX.create("DIV",{attrs:{className:"crm-list-end-deal-button-wrapper"}});var o=i[r];var l=o["id"];var u=this._id+"_"+l;var c=BX.create("INPUT",{attrs:{id:u,name:this._id,className:"crm-list-fail-deal-button",type:"radio",value:o["id"]}});c.checked=this._value===l;BX.CrmSubscriber.subscribe(this._id+"_"+l,c,"change",BX.delegate(this._onRadioButtonClick,this),BX.CrmParamBag.create({id:l}));a.appendChild(c);a.appendChild(BX.create("LABEL",{attrs:{className:"crm-list-fail-deal-button-label",for:u},text:BX.type.isNotEmptyString(o["name"])?o["name"]:l}));this._radioButtonBlock.appendChild(a)}if(this._value===this._successInfo["id"]||n.length===0){this._radioButtonBlock.style.display="none"}t.appendChild(this._radioButtonBlock);BX.onCustomEvent(this,"CrmProcessFailureDialogContentCreated",[this,t]);return t},_onRadioButtonClick:function(t,e){this.setValue(t.getSetting("id",""),false)},_onAcceptButtonClick:function(t){this._bid="accept";this._executeCallback()},_onCancelButtonClick:function(t){this._bid="cancel";this._value="";this._executeCallback()},_onSelectorClick:function(){if(this._popupMenu){this._closePopupMenu();return}if(typeof BX.PopupMenu.Data[this._popupMenuId]!=="undefined"){BX.PopupMenu.Data[this._popupMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._popupMenuId]}BX.PopupMenu.show(this._popupMenuId,this._selector,[{text:this.getFailureTitle(),onclick:function(){this.setValue(this._failureInfo["id"],true);if(this._radioButtonBlock.style.display==="none"&&this._apologyInfos.length>0){this._radioButtonBlock.style.display=""}this._selector.innerHTML=BX.util.htmlspecialchars(this.getFailureTitle());BX.removeClass(this._selector,"crm-list-end-deal-option-success");BX.addClass(this._selector,"crm-list-end-deal-option-fail");window.setTimeout(function(){this._closePopupMenu()}.bind(this),0)}.bind(this)},{text:this.getSuccessTitle(),onclick:function(){this.setValue(this._successInfo["id"],true);if(this._radioButtonBlock.style.display!=="none"){this._radioButtonBlock.style.display="none"}this._selector.innerHTML=BX.util.htmlspecialchars(this.getSuccessTitle());BX.removeClass(this._selector,"crm-list-end-deal-option-fail");BX.addClass(this._selector,"crm-list-end-deal-option-success");window.setTimeout(function(){this._closePopupMenu()}.bind(this),0)}.bind(this)}],{autoHide:true,offsetTop:0,offsetLeft:-30});this._popupMenu=BX.PopupMenu.Data[this._popupMenuId]},_executeCallback:function(){if(this._enableCallback){var t=this._callback;if(BX.type.isFunction(t)){t(this,{bid:this._bid,result:this._value})}}}};BX.CrmProcessFailureDialog.create=function(t,e){var i=new BX.CrmProcessFailureDialog;i.initialize(t,e);return i}}
//# sourceMappingURL=progress_control.map.js