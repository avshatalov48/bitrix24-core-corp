{"version":3,"file":"communication-rule.bundle.js","sources":["../src/components/rule-action.js","../src/components/rule-actions.js","../src/components/logic-selector.js","../src/components/rule-property.js","../src/components/rule-properties.js","../src/components/queue-config.js","../src/components/communication-rule.js","../src/index.js"],"sourcesContent":["import { Loc } from 'main.core';\n\nexport const RuleAction = {\n\temits: [\n\t\t'removeActionBlock',\n\t\t'addActionBlock',\n\t\t'changeActionBlock',\n\t],\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: Symbol,\n\t\t\trequired: true,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: {},\n\t\t},\n\t\tentities: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentActionCategory: this.data.actionCategory ?? null,\n\t\t\tcurrentSelectedEntityId: this.data.entityTypeId ?? null,\n\t\t\tcurrentSelectedCategoryId: this.data.categoryId ?? null,\n\t\t\tentityReuseMode: this.data.entityReuseMode ?? null,\n\t\t\tsearchStrategy: this.data.searchStrategy ?? null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tcurrentEntity(): ?Object\n\t\t{\n\t\t\treturn this.getEntityById(this.currentSelectedEntityId);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tgetEntityById(entityTypeId: number): ?Object\n\t\t{\n\t\t\treturn this.entities.find((entity) => entity.entityTypeId === Number(entityTypeId)) ?? null;\n\t\t},\n\t\tremoveActionBlock(): void\n\t\t{\n\t\t\tthis.$emit('removeActionBlock', this.id);\n\t\t},\n\t\temitChanged(): void\n\t\t{\n\t\t\tconst data = {\n\t\t\t\tactionCategory: this.currentActionCategory,\n\t\t\t\tentityTypeId: this.currentSelectedEntityId,\n\t\t\t\tcategoryId: this.currentSelectedCategoryId,\n\t\t\t\tentityReuseMode: this.entityReuseMode,\n\t\t\t\tsearchStrategy: this.searchStrategy,\n\t\t\t};\n\n\t\t\tthis.$emit('changeActionBlock', this.id, data);\n\t\t},\n\t},\n\n\twatch: {\n\t\tcurrentSelectedEntityId(): void\n\t\t{\n\t\t\tthis.emitChanged();\n\t\t},\n\t\tcurrentSelectedCategoryId(): void\n\t\t{\n\t\t\tthis.emitChanged();\n\t\t},\n\t\tentityReuseMode(): void\n\t\t{\n\t\t\tthis.emitChanged();\n\t\t},\n\t\tsearchStrategy(): void\n\t\t{\n\t\t\tthis.emitChanged();\n\t\t},\n\t\tcurrentActionCategory(): void\n\t\t{\n\t\t\tthis.emitChanged();\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'data',\n\t\t\t(data: Object) => {\n\t\t\t\tthis.currentActionCategory = data.actionCategory ?? null;\n\t\t\t\tthis.currentSelectedEntityId = data.entityTypeId ?? null;\n\t\t\t\tthis.currentSelectedCategoryId = data.categoryId ?? null;\n\t\t\t\tthis.entityReuseMode = data.entityReuseMode ?? null;\n\t\t\t\tthis.searchStrategy = data.searchStrategy ?? null;\n\t\t\t},\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"communication-rule-action-wrapper\">\n\t\t\t<div\n\t\t\t\tclass=\"communication-rule-property-close\"\n\t\t\t\t@click=\"removeActionBlock\"\n\t\t\t>\n\t\t\t\tX\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_CATEGORY_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"currentActionCategory\">\n\t\t\t\t\t\t\t<option value=\"entity\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_CATEGORY_ITEM_CREATE')}</option>\n\t\t\t\t\t\t\t<option value=\"exit\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_CATEGORY_EXIT')}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"ui-form-row\" v-if=\"currentActionCategory === 'entity'\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_ENTITY_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"currentSelectedEntityId\">\n\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\tv-for=\"entity in entities\"\n\t\t\t\t\t\t\t\t:key=\"entity.entityTypeId\"\n\t\t\t\t\t\t\t\t:value=\"entity.entityTypeId\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ entity.name }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div\n\t\t\t\tv-if=\"currentActionCategory === 'entity' && currentEntity?.categories?.length > 1\"\n\t\t\t\tclass=\"ui-form-row\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_ENTITY_CATEGORY_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"currentSelectedCategoryId\">\n\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\tv-for=\"category in currentEntity?.categories\"\n\t\t\t\t\t\t\t\t:key=\"category.id\"\n\t\t\t\t\t\t\t\t:value=\"category.id\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ category.name }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"ui-form-row\" v-if=\"currentActionCategory === 'entity'\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"entityReuseMode\">\n\t\t\t\t\t\t\t<option value=\"new\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE_NEW')}</option>\n\t\t\t\t\t\t\t<option value=\"exist\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE_EXIST')}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"ui-form-row\" v-if=\"entityReuseMode === 'exist'\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"searchStrategy\">\n\t\t\t\t\t\t\t<option value=\"1\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY_MAX_CREATE')}</option>\n\t\t\t\t\t\t\t<option value=\"2\">${Loc.getMessage('CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY_MAX_UPDATE')}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { Loc } from 'main.core';\nimport { RuleAction } from './rule-action';\n\nexport const RuleActions = {\n\tcomponents: {\n\t\tRuleAction,\n\t},\n\n\tprops: {\n\t\tactions: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tentities: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tpreparedActions: this.getPreparedActions(),\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tcurrentEntity(): ?Object\n\t\t{\n\t\t\treturn this.getEntityById(this.currentSelectedEntityId);\n\t\t},\n\t},\n\n\tmethods: {\n\t\treset(): void\n\t\t{\n\t\t\tthis.preparedActions = this.getPreparedActions();\n\t\t},\n\t\tgetPreparedActions(): Object[]\n\t\t{\n\t\t\tconst preparedActions = [];\n\t\t\tthis.actions.forEach((action) => {\n\t\t\t\tpreparedActions.push({\n\t\t\t\t\tid: Symbol('actionId'),\n\t\t\t\t\t...action,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn preparedActions;\n\t\t},\n\t\tgetEntityById(entityTypeId: number): ?Object\n\t\t{\n\t\t\treturn this.entities.find((entity) => entity.entityTypeId === entityTypeId);\n\t\t},\n\t\taddAction(): void\n\t\t{\n\t\t\tthis.preparedActions.push({\n\t\t\t\tid: Symbol('actionId'),\n\t\t\t\ttype: 'entity',\n\t\t\t\tdata: {},\n\t\t\t});\n\t\t},\n\t\tremoveActionBlock(id: Symbol): void\n\t\t{\n\t\t\tconst index = this.preparedActions.findIndex((action) => action.id === id);\n\t\t\tif (index >= 0)\n\t\t\t{\n\t\t\t\tthis.preparedActions.splice(index, 1);\n\t\t\t}\n\t\t},\n\t\tchangeActionBlock(id: Symbol, data: Object): void\n\t\t{\n\t\t\tconst action = this.preparedActions.find((item) => item.id === id);\n\t\t\tif (action)\n\t\t\t{\n\t\t\t\taction.data = data;\n\t\t\t}\n\t\t},\n\t\tgetData(): Object[]\n\t\t{\n\t\t\tconst data = [];\n\t\t\tthis.preparedActions.forEach((action) => {\n\t\t\t\tdata.push({\n\t\t\t\t\ttype: action.type,\n\t\t\t\t\tdata: action.data,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_ACTIONS_SETTINGS_TITLE')}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<RuleAction\n\t\t\t\t\tv-for=\"action in preparedActions\"\n\t\t\t\t\t:id=\"action.id\"\n\t\t\t\t\t:type=\"action.type\"\n\t\t\t\t\t:data=\"action.data\"\n\t\t\t\t\t:entities=\"entities\"\n\t\t\t\t\t@changeActionBlock=\"changeActionBlock\"\n\t\t\t\t\t@removeActionBlock=\"removeActionBlock\"\n\t\t\t\t/>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"communication-rule-add-rule-property\"\n\t\t\t\t\t@click=\"addAction\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ADD_ACTION')}\n\t\t\t\t</span>\n\t\t\t</div>\t\n\t\t</div>\n\t`,\n};","import { Loc } from 'main.core';\n\nexport const LogicSelector = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: Symbol,\n\t\t\trequired: true,\n\t\t},\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tmethods: {\n\t\tchangeLogicSelector(value: string): void\n\t\t{\n\t\t\tthis.$emit('onChange', this.id, value);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tandClass(): []\n\t\t{\n\t\t\treturn [\n\t\t\t\t'communication-rule-property-logic-selector',\n\t\t\t\t{ '--active': this.value === 'AND' },\n\t\t\t];\n\t\t},\n\t\torClass(): []\n\t\t{\n\t\t\treturn [\n\t\t\t\t'communication-rule-property-logic-selector',\n\t\t\t\t{ '--active': this.value === 'OR' },\n\t\t\t];\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"communication-rule-property-logic-selector-container\">\n\t\t\t<div\n\t\t\t\t:class=\"andClass\"\n\t\t\t\t@click=\"changeLogicSelector('AND')\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_PROPERTY_AND')}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\t:class=\"orClass\"\n\t\t\t\t@click=\"changeLogicSelector('OR')\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_PROPERTY_OR')}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const RuleProperty = {\n\temits: [\n\t\t'appendValue',\n\t\t'removeValue',\n\t\t'inputValue',\n\t\t'removePropertyBlock',\n\t],\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: Symbol,\n\t\t\trequired: true,\n\t\t},\n\t\tproperty: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tvalues: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [null],\n\t\t},\n\t},\n\n\tmethods: {\n\t\tappendValue(): void\n\t\t{\n\t\t\tthis.$emit('appendValue', this.id);\n\t\t},\n\t\tremoveValue(index: number): void\n\t\t{\n\t\t\tthis.$emit('removeValue', this.id, index);\n\t\t},\n\t\tinputValue(value: string, index: number): void\n\t\t{\n\t\t\tthis.$emit('inputValue', this.id, index, value);\n\t\t},\n\t\tremovePropertyBlock(): void\n\t\t{\n\t\t\tthis.$emit('removePropertyBlock', this.id);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"ui-form-row communication-rule-property-wrapper\">\n\t\t\t<div \n\t\t\t\tclass=\"communication-rule-property-close\"\n\t\t\t\t@click=\"removePropertyBlock\"\n\t\t\t>\n\t\t\t\tX\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t{{ property.title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(value, index) in values\"\n\t\t\t\t\tkey=\"index\"\n\t\t\t\t\tclass=\"ui-ctl ui-ctl-row ui-ctl-w100\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"index > 0\"\n\t\t\t\t\t\tclass=\"communication-rule-label-or\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_PROPERTY_OR')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<select\n\t\t\t\t\t\tv-if=\"property.type === 'enumeration'\"\n\t\t\t\t\t\tref=\"values\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t@input=\"inputValue($event.target.value, index)\"\n\t\t\t\t\t\t:value=\"value ?? ''\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for=\"(elementValue, elementIndex) in property.params.list\"\n\t\t\t\t\t\t\t:key=\"elementIndex\"\n\t\t\t\t\t\t\t:value=\"elementIndex\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ elementValue }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tref=\"values\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t@input=\"inputValue($event.target.value, index)\"\n\t\t\t\t\t\t:value=\"value ?? ''\"\n\t\t\t\t\t>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"communication-rule-rule-value-remove\"\n\t\t\t\t\t\tref=\"remove\"\n\t\t\t\t\t\t@click=\"removeValue(index)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_REMOVE_RULE_VALUE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class=\"communication-rule-rule-value-add-wrapper\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"communication-rule-rule-value-add\"\n\t\t\t\t\t\tref=\"add\"\n\t\t\t\t\t\t@click=\"appendValue\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ADD_RULE_VALUE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, Text } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport { LogicSelector } from './logic-selector';\nimport { RuleProperty } from './rule-property';\n\nconst LOGIC_AND = 'AND';\nconst LOGIC_OR = 'OR';\n\nexport const RuleProperties = {\n\tcomponents: {\n\t\tRuleProperty,\n\t\tLogicSelector,\n\t},\n\n\tprops: {\n\t\tproperties: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tdefault: {},\n\t\t},\n\t\trules: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfilledProperties: this.rules || [],\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetPropertyByCode(code: string): ?Object\n\t\t{\n\t\t\treturn this.properties.find((property) => property.code === code) ?? null;\n\t\t},\n\t\tshowRuleSelector(): void\n\t\t{\n\t\t\tconst menuItems = [];\n\t\t\tconst menuParams = {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\t//offsetLeft: 60,\n\t\t\t\tangle: true,\n\t\t\t\tcacheable: false,\n\t\t\t};\n\n\t\t\tthis.properties.forEach((property) => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tid: `rule-selector-menu-id-${property.code}`,\n\t\t\t\t\tonclick: this.onRuleSelectorItemClick.bind(this, property.code),\n\t\t\t\t\thtml: Text.encode(property.title),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.ruleSelector = MenuManager.create(\n\t\t\t\t'communication-rule-selector',\n\t\t\t\tthis.$refs.showRuleSelector,\n\t\t\t\tmenuItems,\n\t\t\t\tmenuParams,\n\t\t\t);\n\n\t\t\tthis.ruleSelector.show();\n\t\t},\n\t\tonRuleSelectorItemClick(code: string)\n\t\t{\n\t\t\tconst id = Symbol('ruleId');\n\n\t\t\tthis.filledProperties.push({\n\t\t\t\tid,\n\t\t\t\tcode,\n\t\t\t\tvalues: [null],\n\t\t\t\tlogic: LOGIC_AND,\n\t\t\t});\n\n\t\t\tthis.ruleSelector.close();\n\t\t},\n\t\tappendValue(id: Symbol)\n\t\t{\n\t\t\tconst filledProperty = this.filledProperties.find((property) => property.id === id);\n\t\t\tfilledProperty?.values.push(null);\n\t\t},\n\t\tremoveValue(id: Symbol, index: number)\n\t\t{\n\t\t\tconst filledProperty = this.filledProperties.find((property) => property.id === id);\n\t\t\tfilledProperty?.values.splice(index, 1);\n\t\t},\n\t\tinputValue(id: Symbol, index: number, value: string)\n\t\t{\n\t\t\tconst filledProperty = this.filledProperties.find((property) => property.id === id);\n\t\t\tif (filledProperty)\n\t\t\t{\n\t\t\t\tfilledProperty.values[index] = value;\n\t\t\t}\n\t\t},\n\t\tremovePropertyBlock(id: Symbol): void\n\t\t{\n\t\t\tconst index = this.filledProperties.findIndex((property) => property.id === id);\n\t\t\tif (index >= 0)\n\t\t\t{\n\t\t\t\tthis.filledProperties.splice(index, 1);\n\t\t\t}\n\t\t},\n\t\tonChangeLogicValue(id: Symbol, value: string): void\n\t\t{\n\t\t\tconst filledProperty = this.filledProperties.find((property) => property.id === id);\n\t\t\tif (filledProperty)\n\t\t\t{\n\t\t\t\tfilledProperty.logic = value;\n\t\t\t}\n\t\t},\n\t\tgetData(): Object[]\n\t\t{\n\t\t\tconst data = [];\n\t\t\tthis.filledProperties.forEach((property) => {\n\t\t\t\tdata.push({\n\t\t\t\t\tvalues: property.values,\n\t\t\t\t\tcode: property.code,\n\t\t\t\t\tlogic: property.logic,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_RULES_SETTINGS_TITLE')}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"communication-rule-property-container\"\n\t\t\t\t\tv-for=\"(filledProperty, index) in filledProperties\"\n\t\t\t\t>\n\t\t\t\t\t<RuleProperty\n\t\t\t\t\t\t:key=\"filledProperty.code\"\n\t\t\t\t\t\t:id=\"filledProperty.id\"\n\t\t\t\t\t\t:property=\"getPropertyByCode(filledProperty.code)\"\n\t\t\t\t\t\t:values=\"filledProperty.values\"\n\t\t\t\t\t\t@appendValue=\"appendValue\"\n\t\t\t\t\t\t@removeValue=\"removeValue\"\n\t\t\t\t\t\t@inputValue=\"inputValue\"\n\t\t\t\t\t\t@removePropertyBlock=\"removePropertyBlock\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"index < filledProperties.length - 1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<LogicSelector\n\t\t\t\t\t\t\t:id=\"filledProperty.id\"\n\t\t\t\t\t\t\t:value=\"filledProperty.logic\"\n\t\t\t\t\t\t\t@onChange=\"onChangeLogicValue\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"communication-rule-add-rule-property\"\n\t\t\t\t\t@click=\"showRuleSelector\"\n\t\t\t\t\tref=\"showRuleSelector\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_ADD_RULE')}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, Type } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\n\nexport const QueueConfig = {\n\tprops: {\n\t\tproperties: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tdefault: {},\n\t\t},\n\t\tconfig: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tdefault: {},\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMembersSelectorReadOnly: false,\n\t\t\tfilledMembers: this.config.MEMBERS || [],\n\t\t\tisForwardTo: this.config.SETTINGS?.FORWARD_TO || false,\n\t\t\tisTimeTracking: this.config.SETTINGS?.TIME_TRACKING || false,\n\t\t\tfilledMemberRequestDistribution: this.config.SETTINGS?.MEMBER_REQUEST_DISTRIBUTION || 'STRICTLY',\n\t\t\tfilledTimeBeforeRequestNextMember: this.config.SETTINGS?.TIME_BEFORE_REQUEST_NEXT_MEMBER || 5,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tisPropertyEnabled(code: string): boolean\n\t\t{\n\t\t\treturn Object.prototype.hasOwnProperty.call(this.properties, code)\n\t\t\t\t&& (\n\t\t\t\t\tthis.properties[code] === true\n\t\t\t\t\t|| Type.isArrayFilled(this.properties[code])\n\t\t\t\t);\n\t\t},\n\n\t\tgetSelectedMembers(): Array\n\t\t{\n\t\t\treturn this.filledMembers.map((item: Object) => {\n\t\t\t\treturn [item.ENTITY_TYPE, parseInt(item.ENTITY_ID, 10)];\n\t\t\t});\n\t\t},\n\n\t\tgetData(): Object[]\n\t\t{\n\t\t\tconst selectedMembers = this.membersSelector.getDialog().getSelectedItems();\n\t\t\tif (Type.isArrayFilled(selectedMembers))\n\t\t\t{\n\t\t\t\tthis.filledMembers = selectedMembers\n\t\t\t\t\t.map((item: Item) => ({ ENTITY_ID: item.getId(), ENTITY_TYPE: item.getEntityId() }))\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmembers: this.filledMembers,\n\t\t\t\tproperties: {\n\t\t\t\t\tFORWARD_TO: this.isForwardTo,\n\t\t\t\t\tTIME_TRACKING: this.isTimeTracking,\n\t\t\t\t\tMEMBER_REQUEST_DISTRIBUTION: this.filledMemberRequestDistribution,\n\t\t\t\t\tTIME_BEFORE_REQUEST_NEXT_MEMBER: this.filledTimeBeforeRequestNextMember,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.membersSelector = new TagSelector({\n\t\t\tid: 'queue-config-members-tag-selector',\n\t\t\tcontext: 'QUEUE_CONFIG_MEMBERS_SELECTOR',\n\t\t\treadonly: this.isMembersSelectorReadOnly,\n\t\t\tdialogOptions: {\n\t\t\t\tid: 'queue-config-members-tag-selector',\n\t\t\t\tpreselectedItems: this.getSelectedMembers(),\n\t\t\t\tentities: [{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tid: 'department',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t},\n\t\t\t\t}],\n\t\t\t},\n\t\t});\n\t\tthis.membersSelector.renderTo(this.$refs.membersSelector);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"ui-form\">\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_SELECTOR_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\" ref=\"membersSelector\"></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isPropertyEnabled('FORWARD_TO')\"\n\t\t\t\tclass=\"ui-form-row\"\n\t\t\t>\n\t\t\t\t<label for=\"isForwardTo\" class=\"communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\tname=\"isForwardTo\"\n\t\t\t\t\t\tv-model=\"isForwardTo\"\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_FORWARD_TO_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isPropertyEnabled('TIME_TRACKING')\"\n\t\t\t\tclass=\"ui-form-row\"\n\t\t\t>\n\t\t\t\t<label for=\"isTimeTracking\" class=\"communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\tname=\"isTimeTracking\"\n\t\t\t\t\t\tv-model=\"isTimeTracking\"\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TIME_TRACKING_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_STRICTLY')\"\n\t\t\t\tclass=\"ui-form-row\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_NAME')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass=\"communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-row ui-ctl-w100 ui-ctl-element\"\n\t\t\t\t\t\tv-model=\"filledMemberRequestDistribution\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option \n\t\t\t\t\t\t\tvalue=\"STRICTLY\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_STRICTLY')}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option \n\t\t\t\t\t\t\tv-if=\"isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_EVENLY')\"\n\t\t\t\t\t\t\tvalue=\"EVENLY\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_EVENLY')}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-if=\"isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_ALL')\"\n\t\t\t\t\t\t\tvalue=\"ALL\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_ALL')}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isPropertyEnabled('TIME_BEFORE_REQUEST_NEXT_MEMBER')\"\n\t\t\t\tclass=\"ui-form-row\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TIME_BEFORE_REQUEST_NEXT_MEMBER_NAME')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass=\"communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-row ui-ctl-w100 ui-ctl-element\"\n\t\t\t\t\t\tv-model=\"filledTimeBeforeRequestNextMember\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option v-for=\"value in this.properties.TIME_BEFORE_REQUEST_NEXT_MEMBER\" :value=\"value\">\n\t\t\t\t\t\t\t{{ value }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Loc, Runtime, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { RuleActions } from './rule-actions';\nimport { RuleProperties } from './rule-properties';\nimport { QueueConfig } from './queue-config';\n\nconst EMPTY = 0;\nconst LEAD = 1;\nconst CONTACT = 3;\nconst COMPANY = 4;\n\nexport const CommunicationRule = {\n\tcomponents: {\n\t\tRuleProperties,\n\t\tRuleActions,\n\t\tQueueConfig,\n\t},\n\n\tprops: {\n\t\trule: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: {},\n\t\t},\n\t\tchannels: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tsearchTargetEntities: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tentities: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tselectedChannelId: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\tconst searchTarget = this.rule?.SEARCH_TARGETS ?? {};\n\n\t\treturn {\n\t\t\tcurrentSelectedChannelId: this.selectedChannelId ?? this.channels[0].id,\n\t\t\tcurrentSelectedTargetEntitySectionId: searchTarget.sectionId,\n\t\t\tcurrentSelectedTargetEntityTypeIds: Runtime.clone(searchTarget.entityTypeIds) ?? [],\n\n\t\t\truleId: this.rule?.ID || null,\n\t\t\tactions: this.rule?.ENTITIES || [],\n\t\t\ttitle: this.rule?.TITLE || [],\n\t\t\trules: this.rule?.RULES || [],\n\t\t\tqueueConfig: this.rule?.QUEUE_CONFIG || [],\n\n\t\t\tskipNextRules: (this.rule?.SETTINGS?.skipNextRules === 'Y') || false,\n\t\t\tmanualItemsCreate: (this.rule?.SETTINGS?.manualItemsCreate === 'Y') || false,\n\t\t\trunWorkflowLater: (this.rule?.SETTINGS?.runWorkflowLater === 'Y') || false,\n\t\t};\n\t},\n\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(BX.UI.ButtonPanel, 'button-click', this.onButtonClick.bind(this));\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(BX.UI.ButtonPanel, 'button-click', this.onButtonClick);\n\t},\n\n\tcomputed: {\n\t\tselectedChannelRuleProperties(): ?Object\n\t\t{\n\t\t\treturn this.getChannelById(this.currentSelectedChannelId)?.properties;\n\t\t},\n\n\t\tselectedChannelQueueConfig(): ?Object\n\t\t{\n\t\t\treturn this.getChannelById(this.currentSelectedChannelId)?.queueConfig;\n\t\t},\n\n\t\ttargetEntitySections(): Array\n\t\t{\n\t\t\tconst sections = [];\n\n\t\t\tthis.searchTargetEntities.forEach((item) => {\n\t\t\t\tsections.push(item.section);\n\t\t\t});\n\n\t\t\treturn sections;\n\t\t},\n\n\t\tcompatibleEntities(): Array\n\t\t{\n\t\t\t// empty -> all excepts repeated lead\n\t\t\tif (this.currentSelectedTargetEntityTypeIds.includes(EMPTY))\n\t\t\t{\n\t\t\t\treturn this.entities.filter((entity) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tentity.entityTypeId !== LEAD\n\t\t\t\t\t\t|| (entity.entityTypeId === LEAD && entity.data?.isReturnCustomer !== true)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// lead -> lead\n\t\t\tif (\n\t\t\t\tthis.currentSelectedTargetEntityTypeIds.includes(LEAD)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.length === 1\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst leadEntity = this.entities.find((entity) => {\n\t\t\t\t\treturn entity.entityTypeId === LEAD && entity.data?.isReturnCustomer !== true;\n\t\t\t\t});\n\n\t\t\t\treturn [leadEntity];\n\t\t\t}\n\n\t\t\t// contact -> repeated lead, contact, deal, dynamics\n\t\t\tif (\n\t\t\t\tthis.currentSelectedTargetEntityTypeIds.includes(CONTACT)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.length === 1\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn this.entities.filter((entity) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t(entity.entityTypeId !== COMPANY && entity.entityTypeId !== LEAD)\n\t\t\t\t\t\t|| (entity.entityTypeId === LEAD && entity.data?.isReturnCustomer === true)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.currentSelectedTargetEntityTypeIds.includes(LEAD)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.includes(CONTACT)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.length === 2\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn this.entities.filter((entity) => {\n\t\t\t\t\treturn entity.entityTypeId !== COMPANY;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.currentSelectedTargetEntityTypeIds.includes(LEAD)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.includes(COMPANY)\n\t\t\t\t&& this.currentSelectedTargetEntityTypeIds.length === 2\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn this.entities.filter((entity) => {\n\t\t\t\t\treturn entity.entityTypeId !== CONTACT;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.currentSelectedTargetEntityTypeIds.length === 0)\n\t\t\t{\n\t\t\t\treturn this.entities.filter((entity) => {\n\t\t\t\t\treturn entity.entityTypeId !== LEAD || entity.data?.isReturnCustomer !== true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.entities;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tasync onButtonClick(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tconst button = data[0] ?? null;\n\n\t\t\tif (!Type.isObject(button))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (button.TYPE === 'save')\n\t\t\t{\n\t\t\t\tawait this.save();\n\t\t\t}\n\t\t\telse if (button.TYPE === 'remove')\n\t\t\t{\n\t\t\t\tawait this.delete();\n\t\t\t}\n\n\t\t\tconst currentSlider = top.BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t\tif (currentSlider)\n\t\t\t{\n\t\t\t\tcurrentSlider.setCacheable(false);\n\t\t\t\tcurrentSlider.close(false);\n\t\t\t}\n\t\t},\n\n\t\tasync save(): Promise\n\t\t{\n\t\t\tconst data = {\n\t\t\t\tid: this.ruleId,\n\t\t\t\ttitle: this.title,\n\t\t\t\tchannelId: this.currentSelectedChannelId,\n\t\t\t\tproperties: this.$refs.properties.getData() ?? [],\n\t\t\t\tqueueConfig: this.$refs.queueConfig.getData() ?? [],\n\t\t\t\tsearchTargets: {\n\t\t\t\t\tsectionId: this.currentSelectedTargetEntitySectionId,\n\t\t\t\t\tentityTypeIds: this.currentSelectedTargetEntityTypeIds,\n\t\t\t\t},\n\t\t\t\tactions: this.$refs.actions.getData() ?? [],\n\t\t\t\tsettings: {\n\t\t\t\t\tskipNextRules: this.skipNextRules ? 'Y' : 'N',\n\t\t\t\t\tmanualItemsCreate: this.manualItemsCreate ? 'Y' : 'N',\n\t\t\t\t\trunWorkflowLater: this.runWorkflowLater ? 'Y' : 'N',\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new Promise(async (resolve, reject) => {\n\t\t\t\tAjax.runAction('crm.controller.communication.rule.save', {\n\t\t\t\t\tdata,\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t}).catch((response) => {\n\t\t\t\t\tconst errors = [];\n\t\t\t\t\tresponse.errors.forEach(({ message }) => {\n\t\t\t\t\t\terrors.push(message);\n\t\t\t\t\t});\n\t\t\t\t\treject(errors);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tasync delete(): Promise\n\t\t{\n\t\t\tconst data = {\n\t\t\t\tid: this.ruleId,\n\t\t\t\twithQueue: true,\n\t\t\t};\n\n\t\t\t// eslint-disable-next-line no-async-promise-executor\n\t\t\treturn new Promise(async (resolve, reject) => {\n\t\t\t\tAjax.runAction('crm.controller.communication.rule.delete', {\n\t\t\t\t\tdata,\n\t\t\t\t}).then((response) => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t}).catch((response) => {\n\t\t\t\t\tconst errors = [];\n\t\t\t\t\tresponse.errors.forEach(({ message }) => {\n\t\t\t\t\t\terrors.push(message);\n\t\t\t\t\t});\n\t\t\t\t\treject(errors);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tgetChannelById(id: string): ?Object\n\t\t{\n\t\t\treturn this.channels.find((channel) => channel.id === id) ?? null;\n\t\t},\n\n\t\tgetTargetEntitiesBySectionId(sectionId: string): Array\n\t\t{\n\t\t\tconst section = this.searchTargetEntities.find((entity) => entity.section.id === sectionId);\n\n\t\t\treturn section?.entities ?? [];\n\t\t},\n\t\tonChangeCurrentSelectedTargetEntityTypeIds(): void\n\t\t{\n\t\t\tthis.actions = [];\n\n\t\t\tif (this.currentSelectedTargetEntityTypeIds.includes(LEAD))\n\t\t\t{\n\t\t\t\tthis.currentSelectedTargetEntityTypeIds = [LEAD];\n\t\t\t}\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.$refs.actions.reset();\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_COMMON_SETTINGS_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_TITLE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_TITLE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"currentSelectedChannelId\">\n\t\t\t\t\t\t\t\t\t<option v-for=\"channel in channels\" :value=\"channel.id\" :key=\"channel.id\">\n\t\t    \t\t\t\t\t\t\t{{ channel.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_CATEGORY')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"currentSelectedTargetEntitySectionId\">\n\t\t\t\t\t\t\t\t\t<option v-for=\"section in targetEntitySections\" :value=\"section.id\" :key=\"section.id\">\n\t\t    \t\t\t\t\t\t\t{{ section.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_ENTITY_TYPE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100\">\n\t\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\t\t\t\t\tv-model=\"currentSelectedTargetEntityTypeIds\"\n\t\t\t\t\t\t\t\t\tmultiple\n\t\t\t\t\t\t\t\t\t@change=\"onChangeCurrentSelectedTargetEntityTypeIds\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option :value=\"0\">\n\t\t    \t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_ENTITY_EMPTY')}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\tv-for=\"entity in getTargetEntitiesBySectionId(currentSelectedTargetEntitySectionId)\"\n\t\t\t\t\t\t\t\t\t\t:value=\"entity.id\"\n\t\t\t\t\t\t\t\t\t\t:key=\"entity.id\"\n\t\t\t\t\t\t\t\t\t>\n\t\t    \t\t\t\t\t\t\t{{ entity.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<RuleProperties\n\t\t\t\t\tref=\"properties\"\n\t\t\t\t\t:properties=\"selectedChannelRuleProperties\"\n\t\t\t\t\t:rules=\"rules\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<QueueConfig\n\t\t\t\t\tref=\"queueConfig\"\n\t\t\t\t\t:properties=\"selectedChannelQueueConfig\"\n\t\t\t\t \t:config=\"queueConfig\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<RuleActions\n\t\t\t\t\tref=\"actions\"\n\t\t\t\t\t:actions=\"actions\"\n\t\t\t\t\t:entities=\"compatibleEntities\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\n\t\t\t<div class=\"communication-rule-block-wrapper\">\n\t\t\t\t<div class=\"communication-rule-title\">\n\t\t\t\t\t<span class=\"communication-rule-title-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CHANNEL_ADDITIONAL_SETTINGS_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<label for=\"skipNextRules\" class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"skipNextRules\"\n\t\t\t\t\t\t\t\t\tv-model=\"skipNextRules\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CS_SKIP_RULES')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<label for=\"manualItemsCreate\" class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"manualItemsCreate\"\n\t\t\t\t\t\t\t\t\tv-model=\"manualItemsCreate\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CS_MANUAL_ITEMS_CREATE')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<label for=\"runWorkflowLater\" class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"runWorkflowLater\"\n\t\t\t\t\t\t\t\t\tv-model=\"runWorkflowLater\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_COMMUNICATION_RULE_CS_RUN_WORKFLOW_LATER')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { CommunicationRule as CommunicationRuleComponent } from './components/communication-rule';\nimport './communication-rule.css';\n\ntype CommunicationRuleParams = {\n\trule: Object,\n\tchannels: Object[],\n\tentities: Object[],\n\tsearchTargetEntities: Object[],\n\tselectedTargetEntitySectionId?: string,\n\tselectedTargetEntityTypeIds?: Array<Object>,\n}\n\nexport class CommunicationRule\n{\n\t#container: HTMLElement;\n\t#app: ?VueCreateAppResult = null;\n\t#channels: Object[];\n\t#entities: Object[];\n\t#rule: Object;\n\t#searchTargetEntities: Object[];\n\t#selectedTargetEntitySectionId: ?string;\n\t#selectedTargetEntityTypeIds: ?Object[];\n\n\tconstructor(containerId: string, params: CommunicationRuleParams)\n\t{\n\t\tthis.#channels = params.channels;\n\t\tthis.#entities = params.entities;\n\t\tthis.#rule = params.rule;\n\t\tthis.#searchTargetEntities = params.searchTargetEntities;\n\n\t\tthis.#selectedTargetEntitySectionId = params.selectedTargetEntitySectionId ?? null;\n\t\tthis.#selectedTargetEntityTypeIds = params.searchTargetEntities ?? [];\n\n\t\tthis.#container = document.getElementById(containerId);\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error('container not found');\n\t\t}\n\n\t\tthis.#app = BitrixVue.createApp(\n\t\t\tCommunicationRuleComponent,\n\t\t\t{\n\t\t\t\trule: this.#rule,\n\t\t\t\tchannels: this.#channels,\n\t\t\t\tentities: this.#entities,\n\t\t\t\tsearchTargetEntities: this.#searchTargetEntities,\n\t\t\t\tselectedTargetEntitySectionId: this.#selectedTargetEntitySectionId,\n\t\t\t\tselectedTargetEntityTypeIds: this.#selectedTargetEntityTypeIds,\n\t\t\t},\n\t\t);\n\n\t\tthis.#app.mount(this.#container);\n\t}\n}\n"],"names":["RuleAction","emits","props","id","type","Symbol","required","String","data","Object","default","entities","Array","currentActionCategory","actionCategory","currentSelectedEntityId","entityTypeId","currentSelectedCategoryId","categoryId","entityReuseMode","searchStrategy","computed","currentEntity","getEntityById","methods","find","entity","Number","removeActionBlock","$emit","emitChanged","watch","created","$watch","deep","template","Loc","getMessage","RuleActions","components","actions","preparedActions","getPreparedActions","reset","forEach","action","push","addAction","index","findIndex","splice","changeActionBlock","item","getData","LogicSelector","value","changeLogicSelector","andClass","orClass","RuleProperty","property","values","appendValue","removeValue","inputValue","removePropertyBlock","LOGIC_AND","RuleProperties","properties","rules","filledProperties","getPropertyByCode","code","showRuleSelector","menuItems","menuParams","closeByEsc","autoHide","angle","cacheable","onclick","onRuleSelectorItemClick","bind","html","Text","encode","title","ruleSelector","MenuManager","create","$refs","show","logic","close","filledProperty","onChangeLogicValue","QueueConfig","config","isMembersSelectorReadOnly","filledMembers","MEMBERS","isForwardTo","SETTINGS","FORWARD_TO","isTimeTracking","TIME_TRACKING","filledMemberRequestDistribution","MEMBER_REQUEST_DISTRIBUTION","filledTimeBeforeRequestNextMember","TIME_BEFORE_REQUEST_NEXT_MEMBER","isPropertyEnabled","prototype","hasOwnProperty","call","Type","isArrayFilled","getSelectedMembers","map","ENTITY_TYPE","parseInt","ENTITY_ID","selectedMembers","membersSelector","getDialog","getSelectedItems","getId","getEntityId","members","mounted","TagSelector","context","readonly","dialogOptions","preselectedItems","options","inviteEmployeeLink","intranetUsersOnly","selectMode","renderTo","EMPTY","LEAD","CONTACT","COMPANY","CommunicationRule","rule","channels","searchTargetEntities","selectedChannelId","searchTarget","SEARCH_TARGETS","currentSelectedChannelId","currentSelectedTargetEntitySectionId","sectionId","currentSelectedTargetEntityTypeIds","Runtime","clone","entityTypeIds","ruleId","ID","ENTITIES","TITLE","RULES","queueConfig","QUEUE_CONFIG","skipNextRules","manualItemsCreate","runWorkflowLater","EventEmitter","subscribe","BX","UI","ButtonPanel","onButtonClick","beforeUnmount","unsubscribe","selectedChannelRuleProperties","getChannelById","selectedChannelQueueConfig","targetEntitySections","sections","section","compatibleEntities","includes","filter","isReturnCustomer","length","leadEntity","event","button","isObject","TYPE","save","delete","currentSlider","top","SidePanel","Instance","getSliderByWindow","window","setCacheable","channelId","searchTargets","settings","Promise","resolve","reject","Ajax","runAction","then","response","catch","errors","message","withQueue","channel","getTargetEntitiesBySectionId","onChangeCurrentSelectedTargetEntityTypeIds","$nextTick","constructor","containerId","params","selectedTargetEntitySectionId","document","getElementById","isDomNode","Error","BitrixVue","createApp","CommunicationRuleComponent","selectedTargetEntityTypeIds","mount"],"mappings":"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"}