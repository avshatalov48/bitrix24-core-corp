this.BX=this.BX||{};(function(t,e,n,i,l,s){"use strict";const r={emits:["removeActionBlock","addActionBlock","changeActionBlock"],props:{id:{type:Symbol,required:true},type:{type:String,required:true},data:{type:Object,required:false,default:{}},entities:{type:Array,required:true,default:[]}},data(){var t,e,n,i,l;return{currentActionCategory:(t=this.data.actionCategory)!=null?t:null,currentSelectedEntityId:(e=this.data.entityTypeId)!=null?e:null,currentSelectedCategoryId:(n=this.data.categoryId)!=null?n:null,entityReuseMode:(i=this.data.entityReuseMode)!=null?i:null,searchStrategy:(l=this.data.searchStrategy)!=null?l:null}},computed:{currentEntity(){return this.getEntityById(this.currentSelectedEntityId)}},methods:{getEntityById(t){var e;return(e=this.entities.find((e=>e.entityTypeId===Number(t))))!=null?e:null},removeActionBlock(){this.$emit("removeActionBlock",this.id)},emitChanged(){const t={actionCategory:this.currentActionCategory,entityTypeId:this.currentSelectedEntityId,categoryId:this.currentSelectedCategoryId,entityReuseMode:this.entityReuseMode,searchStrategy:this.searchStrategy};this.$emit("changeActionBlock",this.id,t)}},watch:{currentSelectedEntityId(){this.emitChanged()},currentSelectedCategoryId(){this.emitChanged()},entityReuseMode(){this.emitChanged()},searchStrategy(){this.emitChanged()},currentActionCategory(){this.emitChanged()}},created(){this.$watch("data",(t=>{var e,n,i,l,s;this.currentActionCategory=(e=t.actionCategory)!=null?e:null;this.currentSelectedEntityId=(n=t.entityTypeId)!=null?n:null;this.currentSelectedCategoryId=(i=t.categoryId)!=null?i:null;this.entityReuseMode=(l=t.entityReuseMode)!=null?l:null;this.searchStrategy=(s=t.searchStrategy)!=null?s:null}),{deep:true})},template:`\n\t\t<div class="communication-rule-action-wrapper">\n\t\t\t<div\n\t\t\t\tclass="communication-rule-property-close"\n\t\t\t\t@click="removeActionBlock"\n\t\t\t>\n\t\t\t\tX\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_CATEGORY_TITLE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="currentActionCategory">\n\t\t\t\t\t\t\t<option value="entity">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_CATEGORY_ITEM_CREATE")}</option>\n\t\t\t\t\t\t\t<option value="exit">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_CATEGORY_EXIT")}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="ui-form-row" v-if="currentActionCategory === 'entity'">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_ENTITY_TITLE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="currentSelectedEntityId">\n\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\tv-for="entity in entities"\n\t\t\t\t\t\t\t\t:key="entity.entityTypeId"\n\t\t\t\t\t\t\t\t:value="entity.entityTypeId"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ entity.name }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div\n\t\t\t\tv-if="currentActionCategory === 'entity' && currentEntity?.categories?.length > 1"\n\t\t\t\tclass="ui-form-row"\n\t\t\t>\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_ENTITY_CATEGORY_TITLE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="currentSelectedCategoryId">\n\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\tv-for="category in currentEntity?.categories"\n\t\t\t\t\t\t\t\t:key="category.id"\n\t\t\t\t\t\t\t\t:value="category.id"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ category.name }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="ui-form-row" v-if="currentActionCategory === 'entity'">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="entityReuseMode">\n\t\t\t\t\t\t\t<option value="new">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE_NEW")}</option>\n\t\t\t\t\t\t\t<option value="exist">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_ENTITY_REUSE_MODE_EXIST")}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="ui-form-row" v-if="entityReuseMode === 'exist'">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="searchStrategy">\n\t\t\t\t\t\t\t<option value="1">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY_MAX_CREATE")}</option>\n\t\t\t\t\t\t\t<option value="2">${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ACTION_SEARCH_STRATEGY_MAX_UPDATE")}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const a={components:{RuleAction:r},props:{actions:{type:Array,required:true,default:[]},entities:{type:Array,required:true,default:[]}},data(){return{preparedActions:this.getPreparedActions()}},computed:{currentEntity(){return this.getEntityById(this.currentSelectedEntityId)}},methods:{reset(){this.preparedActions=this.getPreparedActions()},getPreparedActions(){const t=[];this.actions.forEach((e=>{t.push({id:Symbol("actionId"),...e})}));return t},getEntityById(t){return this.entities.find((e=>e.entityTypeId===t))},addAction(){this.preparedActions.push({id:Symbol("actionId"),type:"entity",data:{}})},removeActionBlock(t){const e=this.preparedActions.findIndex((e=>e.id===t));if(e>=0){this.preparedActions.splice(e,1)}},changeActionBlock(t,e){const n=this.preparedActions.find((e=>e.id===t));if(n){n.data=e}},getData(){const t=[];this.preparedActions.forEach((e=>{t.push({type:e.type,data:e.data})}));return t}},template:`\n\t\t<div>\n\t\t\t<div class="communication-rule-title">\n\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_ACTIONS_SETTINGS_TITLE")}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="ui-form">\n\t\t\t\t<RuleAction\n\t\t\t\t\tv-for="action in preparedActions"\n\t\t\t\t\t:id="action.id"\n\t\t\t\t\t:type="action.type"\n\t\t\t\t\t:data="action.data"\n\t\t\t\t\t:entities="entities"\n\t\t\t\t\t@changeActionBlock="changeActionBlock"\n\t\t\t\t\t@removeActionBlock="removeActionBlock"\n\t\t\t\t/>\n\t\t\t\t<span\n\t\t\t\t\tclass="communication-rule-add-rule-property"\n\t\t\t\t\t@click="addAction"\n\t\t\t\t>\n\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ADD_ACTION")}\n\t\t\t\t</span>\n\t\t\t</div>\t\n\t\t</div>\n\t`};const c={props:{id:{type:Symbol,required:true},value:{type:String,required:true}},methods:{changeLogicSelector(t){this.$emit("onChange",this.id,t)}},computed:{andClass(){return["communication-rule-property-logic-selector",{"--active":this.value==="AND"}]},orClass(){return["communication-rule-property-logic-selector",{"--active":this.value==="OR"}]}},template:`\n\t\t<div class="communication-rule-property-logic-selector-container">\n\t\t\t<div\n\t\t\t\t:class="andClass"\n\t\t\t\t@click="changeLogicSelector('AND')"\n\t\t\t>\n\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_PROPERTY_AND")}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\t:class="orClass"\n\t\t\t\t@click="changeLogicSelector('OR')"\n\t\t\t>\n\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_PROPERTY_OR")}\n\t\t\t</div>\n\t\t</div>\n\t`};const o={emits:["appendValue","removeValue","inputValue","removePropertyBlock"],props:{id:{type:Symbol,required:true},property:{type:Object,required:true},values:{type:Array,required:false,default:[null]}},methods:{appendValue(){this.$emit("appendValue",this.id)},removeValue(t){this.$emit("removeValue",this.id,t)},inputValue(t,e){this.$emit("inputValue",this.id,e,t)},removePropertyBlock(){this.$emit("removePropertyBlock",this.id)}},template:`\n\t\t<div class="ui-form-row communication-rule-property-wrapper">\n\t\t\t<div \n\t\t\t\tclass="communication-rule-property-close"\n\t\t\t\t@click="removePropertyBlock"\n\t\t\t>\n\t\t\t\tX\n\t\t\t</div>\n\t\t\t<div class="ui-form-label">\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t{{ property.title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-form-content">\n\t\t\t\t<div\n\t\t\t\t\tv-for="(value, index) in values"\n\t\t\t\t\tkey="index"\n\t\t\t\t\tclass="ui-ctl ui-ctl-row ui-ctl-w100"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="index > 0"\n\t\t\t\t\t\tclass="communication-rule-label-or"\n\t\t\t\t\t>\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_PROPERTY_OR")}\n\t\t\t\t\t</div>\n\t\t\t\t\t<select\n\t\t\t\t\t\tv-if="property.type === 'enumeration'"\n\t\t\t\t\t\tref="values"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t@input="inputValue($event.target.value, index)"\n\t\t\t\t\t\t:value="value ?? ''"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for="(elementValue, elementIndex) in property.params.list"\n\t\t\t\t\t\t\t:key="elementIndex"\n\t\t\t\t\t\t\t:value="elementIndex"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ elementValue }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tref="values"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t@input="inputValue($event.target.value, index)"\n\t\t\t\t\t\t:value="value ?? ''"\n\t\t\t\t\t>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="communication-rule-rule-value-remove"\n\t\t\t\t\t\tref="remove"\n\t\t\t\t\t\t@click="removeValue(index)"\n\t\t\t\t\t>\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_REMOVE_RULE_VALUE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class="communication-rule-rule-value-add-wrapper">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="communication-rule-rule-value-add"\n\t\t\t\t\t\tref="add"\n\t\t\t\t\t\t@click="appendValue"\n\t\t\t\t\t>\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ADD_RULE_VALUE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const u="AND";const d={components:{RuleProperty:o,LogicSelector:c},props:{properties:{type:Object,required:true,default:{}},rules:{type:Array,required:false,default:[]}},data(){return{filledProperties:this.rules||[]}},methods:{getPropertyByCode(t){var e;return(e=this.properties.find((e=>e.code===t)))!=null?e:null},showRuleSelector(){const t=[];const e={closeByEsc:true,autoHide:true,angle:true,cacheable:false};this.properties.forEach((e=>{t.push({id:`rule-selector-menu-id-${e.code}`,onclick:this.onRuleSelectorItemClick.bind(this,e.code),html:l.Text.encode(e.title)})}));this.ruleSelector=i.MenuManager.create("communication-rule-selector",this.$refs.showRuleSelector,t,e);this.ruleSelector.show()},onRuleSelectorItemClick(t){const e=Symbol("ruleId");this.filledProperties.push({id:e,code:t,values:[null],logic:u});this.ruleSelector.close()},appendValue(t){const e=this.filledProperties.find((e=>e.id===t));e==null?void 0:e.values.push(null)},removeValue(t,e){const n=this.filledProperties.find((e=>e.id===t));n==null?void 0:n.values.splice(e,1)},inputValue(t,e,n){const i=this.filledProperties.find((e=>e.id===t));if(i){i.values[e]=n}},removePropertyBlock(t){const e=this.filledProperties.findIndex((e=>e.id===t));if(e>=0){this.filledProperties.splice(e,1)}},onChangeLogicValue(t,e){const n=this.filledProperties.find((e=>e.id===t));if(n){n.logic=e}},getData(){const t=[];this.filledProperties.forEach((e=>{t.push({values:e.values,code:e.code,logic:e.logic})}));return t}},template:`\n\t\t<div>\n\t\t\t<div class="communication-rule-title">\n\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_RULES_SETTINGS_TITLE")}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="ui-form">\n\t\t\t\t<div\n\t\t\t\t\tclass="communication-rule-property-container"\n\t\t\t\t\tv-for="(filledProperty, index) in filledProperties"\n\t\t\t\t>\n\t\t\t\t\t<RuleProperty\n\t\t\t\t\t\t:key="filledProperty.code"\n\t\t\t\t\t\t:id="filledProperty.id"\n\t\t\t\t\t\t:property="getPropertyByCode(filledProperty.code)"\n\t\t\t\t\t\t:values="filledProperty.values"\n\t\t\t\t\t\t@appendValue="appendValue"\n\t\t\t\t\t\t@removeValue="removeValue"\n\t\t\t\t\t\t@inputValue="inputValue"\n\t\t\t\t\t\t@removePropertyBlock="removePropertyBlock"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="index < filledProperties.length - 1"\n\t\t\t\t\t>\n\t\t\t\t\t\t<LogicSelector\n\t\t\t\t\t\t\t:id="filledProperty.id"\n\t\t\t\t\t\t\t:value="filledProperty.logic"\n\t\t\t\t\t\t\t@onChange="onChangeLogicValue"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tclass="communication-rule-add-rule-property"\n\t\t\t\t\t@click="showRuleSelector"\n\t\t\t\t\tref="showRuleSelector"\n\t\t\t\t>\n\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_ADD_RULE")}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const v={props:{properties:{type:Object,required:true,default:{}},config:{type:Object,required:true,default:{}}},data(){var t,e,n,i;return{isMembersSelectorReadOnly:false,filledMembers:this.config.MEMBERS||[],isForwardTo:((t=this.config.SETTINGS)==null?void 0:t.FORWARD_TO)||false,isTimeTracking:((e=this.config.SETTINGS)==null?void 0:e.TIME_TRACKING)||false,filledMemberRequestDistribution:((n=this.config.SETTINGS)==null?void 0:n.MEMBER_REQUEST_DISTRIBUTION)||"STRICTLY",filledTimeBeforeRequestNextMember:((i=this.config.SETTINGS)==null?void 0:i.TIME_BEFORE_REQUEST_NEXT_MEMBER)||5}},methods:{isPropertyEnabled(t){return Object.prototype.hasOwnProperty.call(this.properties,t)&&(this.properties[t]===true||l.Type.isArrayFilled(this.properties[t]))},getSelectedMembers(){return this.filledMembers.map((t=>[t.ENTITY_TYPE,parseInt(t.ENTITY_ID,10)]))},getData(){const t=this.membersSelector.getDialog().getSelectedItems();if(l.Type.isArrayFilled(t)){this.filledMembers=t.map((t=>({ENTITY_ID:t.getId(),ENTITY_TYPE:t.getEntityId()})))}return{members:this.filledMembers,properties:{FORWARD_TO:this.isForwardTo,TIME_TRACKING:this.isTimeTracking,MEMBER_REQUEST_DISTRIBUTION:this.filledMemberRequestDistribution,TIME_BEFORE_REQUEST_NEXT_MEMBER:this.filledTimeBeforeRequestNextMember}}}},mounted(){this.membersSelector=new s.TagSelector({id:"queue-config-members-tag-selector",context:"QUEUE_CONFIG_MEMBERS_SELECTOR",readonly:this.isMembersSelectorReadOnly,dialogOptions:{id:"queue-config-members-tag-selector",preselectedItems:this.getSelectedMembers(),entities:[{id:"user",options:{inviteEmployeeLink:false,intranetUsersOnly:true}},{id:"department",options:{inviteEmployeeLink:false,selectMode:"usersAndDepartments"}}]}});this.membersSelector.renderTo(this.$refs.membersSelector)},template:`\n\t\t<div class="ui-form">\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_SELECTOR_TITLE")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content" ref="membersSelector"></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isPropertyEnabled('FORWARD_TO')"\n\t\t\t\tclass="ui-form-row"\n\t\t\t>\n\t\t\t\t<label for="isForwardTo" class="communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\tname="isForwardTo"\n\t\t\t\t\t\tv-model="isForwardTo"\n\t\t\t\t\t>\n\t\t\t\t\t<span class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_FORWARD_TO_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isPropertyEnabled('TIME_TRACKING')"\n\t\t\t\tclass="ui-form-row"\n\t\t\t>\n\t\t\t\t<label for="isTimeTracking" class="communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\tname="isTimeTracking"\n\t\t\t\t\t\tv-model="isTimeTracking"\n\t\t\t\t\t>\n\t\t\t\t\t<span class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TIME_TRACKING_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_STRICTLY')"\n\t\t\t\tclass="ui-form-row"\n\t\t\t>\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_NAME")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass="communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-row ui-ctl-w100 ui-ctl-element"\n\t\t\t\t\t\tv-model="filledMemberRequestDistribution"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option \n\t\t\t\t\t\t\tvalue="STRICTLY"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_STRICTLY")}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option \n\t\t\t\t\t\t\tv-if="isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_EVENLY')"\n\t\t\t\t\t\t\tvalue="EVENLY"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_EVENLY")}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-if="isPropertyEnabled('MEMBER_REQUEST_DISTRIBUTION_ALL')"\n\t\t\t\t\t\t\tvalue="ALL"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_MEMBER_REQUEST_DISTRIBUTION_ALL")}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isPropertyEnabled('TIME_BEFORE_REQUEST_NEXT_MEMBER')"\n\t\t\t\tclass="ui-form-row"\n\t\t\t>\n\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TIME_BEFORE_REQUEST_NEXT_MEMBER_NAME")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass="communication-queue-checkbox-block-wrapper ui-ctl ui-ctl-row ui-ctl-w100 ui-ctl-element"\n\t\t\t\t\t\tv-model="filledTimeBeforeRequestNextMember"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option v-for="value in this.properties.TIME_BEFORE_REQUEST_NEXT_MEMBER" :value="value">\n\t\t\t\t\t\t\t{{ value }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const p=0;const E=1;const m=3;const T=4;const I={components:{RuleProperties:d,RuleActions:a,QueueConfig:v},props:{rule:{type:Object,required:false,default:{}},channels:{type:Array,required:true,default:[]},searchTargetEntities:{type:Array,required:true,default:[]},entities:{type:Array,required:true,default:[]},selectedChannelId:{type:Number,required:false,default:null}},data(){var t,e,n,i,s,r,a,c,o,u,d,v,p,E,m;const T=(t=(e=this.rule)==null?void 0:e.SEARCH_TARGETS)!=null?t:{};return{currentSelectedChannelId:(n=this.selectedChannelId)!=null?n:this.channels[0].id,currentSelectedTargetEntitySectionId:T.sectionId,currentSelectedTargetEntityTypeIds:(i=l.Runtime.clone(T.entityTypeIds))!=null?i:[],ruleId:((s=this.rule)==null?void 0:s.ID)||null,actions:((r=this.rule)==null?void 0:r.ENTITIES)||[],title:((a=this.rule)==null?void 0:a.TITLE)||[],rules:((c=this.rule)==null?void 0:c.RULES)||[],queueConfig:((o=this.rule)==null?void 0:o.QUEUE_CONFIG)||[],skipNextRules:((u=this.rule)==null?void 0:(d=u.SETTINGS)==null?void 0:d.skipNextRules)==="Y"||false,manualItemsCreate:((v=this.rule)==null?void 0:(p=v.SETTINGS)==null?void 0:p.manualItemsCreate)==="Y"||false,runWorkflowLater:((E=this.rule)==null?void 0:(m=E.SETTINGS)==null?void 0:m.runWorkflowLater)==="Y"||false}},mounted(){n.EventEmitter.subscribe(BX.UI.ButtonPanel,"button-click",this.onButtonClick.bind(this))},beforeUnmount(){n.EventEmitter.unsubscribe(BX.UI.ButtonPanel,"button-click",this.onButtonClick)},computed:{selectedChannelRuleProperties(){var t;return(t=this.getChannelById(this.currentSelectedChannelId))==null?void 0:t.properties},selectedChannelQueueConfig(){var t;return(t=this.getChannelById(this.currentSelectedChannelId))==null?void 0:t.queueConfig},targetEntitySections(){const t=[];this.searchTargetEntities.forEach((e=>{t.push(e.section)}));return t},compatibleEntities(){if(this.currentSelectedTargetEntityTypeIds.includes(p)){return this.entities.filter((t=>{var e;return t.entityTypeId!==E||t.entityTypeId===E&&((e=t.data)==null?void 0:e.isReturnCustomer)!==true}))}if(this.currentSelectedTargetEntityTypeIds.includes(E)&&this.currentSelectedTargetEntityTypeIds.length===1){const t=this.entities.find((t=>{var e;return t.entityTypeId===E&&((e=t.data)==null?void 0:e.isReturnCustomer)!==true}));return[t]}if(this.currentSelectedTargetEntityTypeIds.includes(m)&&this.currentSelectedTargetEntityTypeIds.length===1){return this.entities.filter((t=>{var e;return t.entityTypeId!==T&&t.entityTypeId!==E||t.entityTypeId===E&&((e=t.data)==null?void 0:e.isReturnCustomer)===true}))}if(this.currentSelectedTargetEntityTypeIds.includes(E)&&this.currentSelectedTargetEntityTypeIds.includes(m)&&this.currentSelectedTargetEntityTypeIds.length===2){return this.entities.filter((t=>t.entityTypeId!==T))}if(this.currentSelectedTargetEntityTypeIds.includes(E)&&this.currentSelectedTargetEntityTypeIds.includes(T)&&this.currentSelectedTargetEntityTypeIds.length===2){return this.entities.filter((t=>t.entityTypeId!==m))}if(this.currentSelectedTargetEntityTypeIds.length===0){return this.entities.filter((t=>{var e;return t.entityTypeId!==E||((e=t.data)==null?void 0:e.isReturnCustomer)!==true}))}return this.entities}},methods:{async onButtonClick(t){var e;const n=t.getData();const i=(e=n[0])!=null?e:null;if(!l.Type.isObject(i)){return}if(i.TYPE==="save"){await this.save()}else if(i.TYPE==="remove"){await this.delete()}const s=top.BX.SidePanel.Instance.getSliderByWindow(window);if(s){s.setCacheable(false);s.close(false)}},async save(){var t,e,n;const i={id:this.ruleId,title:this.title,channelId:this.currentSelectedChannelId,properties:(t=this.$refs.properties.getData())!=null?t:[],queueConfig:(e=this.$refs.queueConfig.getData())!=null?e:[],searchTargets:{sectionId:this.currentSelectedTargetEntitySectionId,entityTypeIds:this.currentSelectedTargetEntityTypeIds},actions:(n=this.$refs.actions.getData())!=null?n:[],settings:{skipNextRules:this.skipNextRules?"Y":"N",manualItemsCreate:this.manualItemsCreate?"Y":"N",runWorkflowLater:this.runWorkflowLater?"Y":"N"}};return new Promise((async(t,e)=>{l.ajax.runAction("crm.controller.communication.rule.save",{data:i}).then((e=>{t(e)})).catch((t=>{const n=[];t.errors.forEach((({message:t})=>{n.push(t)}));e(n)}))}))},async delete(){const t={id:this.ruleId,withQueue:true};return new Promise((async(e,n)=>{l.ajax.runAction("crm.controller.communication.rule.delete",{data:t}).then((t=>{e(t)})).catch((t=>{const e=[];t.errors.forEach((({message:t})=>{e.push(t)}));n(e)}))}))},getChannelById(t){var e;return(e=this.channels.find((e=>e.id===t)))!=null?e:null},getTargetEntitiesBySectionId(t){var e;const n=this.searchTargetEntities.find((e=>e.section.id===t));return(e=n==null?void 0:n.entities)!=null?e:[]},onChangeCurrentSelectedTargetEntityTypeIds(){this.actions=[];if(this.currentSelectedTargetEntityTypeIds.includes(E)){this.currentSelectedTargetEntityTypeIds=[E]}void this.$nextTick((()=>{this.$refs.actions.reset()}))}},template:`\n\t\t<div>\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<div class="communication-rule-title">\n\t\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_COMMON_SETTINGS_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form">\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_TITLE")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_TITLE")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="currentSelectedChannelId">\n\t\t\t\t\t\t\t\t\t<option v-for="channel in channels" :value="channel.id" :key="channel.id">\n\t\t    \t\t\t\t\t\t\t{{ channel.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<div class="communication-rule-title">\n\t\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form">\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_CATEGORY")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="currentSelectedTargetEntitySectionId">\n\t\t\t\t\t\t\t\t\t<option v-for="section in targetEntitySections" :value="section.id" :key="section.id">\n\t\t    \t\t\t\t\t\t\t{{ section.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_ENTITY_TYPE")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\tv-model="currentSelectedTargetEntityTypeIds"\n\t\t\t\t\t\t\t\t\tmultiple\n\t\t\t\t\t\t\t\t\t@change="onChangeCurrentSelectedTargetEntityTypeIds"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option :value="0">\n\t\t    \t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_SEARCH_TARGET_ENTITY_EMPTY")}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\tv-for="entity in getTargetEntitiesBySectionId(currentSelectedTargetEntitySectionId)"\n\t\t\t\t\t\t\t\t\t\t:value="entity.id"\n\t\t\t\t\t\t\t\t\t\t:key="entity.id"\n\t\t\t\t\t\t\t\t\t>\n\t\t    \t\t\t\t\t\t\t{{ entity.title }}\n\t\t  \t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<RuleProperties\n\t\t\t\t\tref="properties"\n\t\t\t\t\t:properties="selectedChannelRuleProperties"\n\t\t\t\t\t:rules="rules"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<div class="communication-rule-title">\n\t\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_QUEUE_CONFIG_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<QueueConfig\n\t\t\t\t\tref="queueConfig"\n\t\t\t\t\t:properties="selectedChannelQueueConfig"\n\t\t\t\t \t:config="queueConfig"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<RuleActions\n\t\t\t\t\tref="actions"\n\t\t\t\t\t:actions="actions"\n\t\t\t\t\t:entities="compatibleEntities"\n\t\t\t\t/>\n\t\t\t</div>\n\t\n\t\t\t<div class="communication-rule-block-wrapper">\n\t\t\t\t<div class="communication-rule-title">\n\t\t\t\t\t<span class="communication-rule-title-text">\n\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CHANNEL_ADDITIONAL_SETTINGS_TITLE")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<label for="skipNextRules" class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tname="skipNextRules"\n\t\t\t\t\t\t\t\t\tv-model="skipNextRules"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CS_SKIP_RULES")}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<label for="manualItemsCreate" class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tname="manualItemsCreate"\n\t\t\t\t\t\t\t\t\tv-model="manualItemsCreate"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CS_MANUAL_ITEMS_CREATE")}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<label for="runWorkflowLater" class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tname="runWorkflowLater"\n\t\t\t\t\t\t\t\t\tv-model="runWorkflowLater"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t${l.Loc.getMessage("CRM_COMMUNICATION_RULE_CS_RUN_WORKFLOW_LATER")}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var h=babelHelpers.classPrivateFieldLooseKey("container");var y=babelHelpers.classPrivateFieldLooseKey("app");var _=babelHelpers.classPrivateFieldLooseKey("channels");var g=babelHelpers.classPrivateFieldLooseKey("entities");var C=babelHelpers.classPrivateFieldLooseKey("rule");var f=babelHelpers.classPrivateFieldLooseKey("searchTargetEntities");var M=babelHelpers.classPrivateFieldLooseKey("selectedTargetEntitySectionId");var R=babelHelpers.classPrivateFieldLooseKey("selectedTargetEntityTypeIds");class b{constructor(t,n){var i,s;Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,R,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_)[_]=n.channels;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=n.entities;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=n.rule;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=n.searchTargetEntities;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=(i=n.selectedTargetEntitySectionId)!=null?i:null;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=(s=n.searchTargetEntities)!=null?s:[];babelHelpers.classPrivateFieldLooseBase(this,h)[h]=document.getElementById(t);if(!l.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,h)[h])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.BitrixVue.createApp(I,{rule:babelHelpers.classPrivateFieldLooseBase(this,C)[C],channels:babelHelpers.classPrivateFieldLooseBase(this,_)[_],entities:babelHelpers.classPrivateFieldLooseBase(this,g)[g],searchTargetEntities:babelHelpers.classPrivateFieldLooseBase(this,f)[f],selectedTargetEntitySectionId:babelHelpers.classPrivateFieldLooseBase(this,M)[M],selectedTargetEntityTypeIds:babelHelpers.classPrivateFieldLooseBase(this,R)[R]});babelHelpers.classPrivateFieldLooseBase(this,y)[y].mount(babelHelpers.classPrivateFieldLooseBase(this,h)[h])}}t.CommunicationRule=b})(this.BX.Crm=this.BX.Crm||{},BX.Vue3,BX.Event,BX.Main,BX,BX.UI.EntitySelector);
//# sourceMappingURL=communication-rule.bundle.map.js