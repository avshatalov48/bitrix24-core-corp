{"version":3,"file":"placement.bundle.js","sources":["../src/placement.js"],"sourcesContent":["import {Runtime, Type} from \"main.core\";\nimport \"./placement.css\"\n\nclass Loader\n{\n\tstatic instances = new Map;\n\n\tconstructor(placementCode, settings)\n\t{\n\t\tthis.placementCode = Type.isStringFilled(placementCode) ? placementCode : \"\";\n\t\tthis.placementInterface = null;\n\t\tthis.settings = settings;\n\t\tthis.queue = [];\n\t\tthis.isActive = false;\n\t\tthis.isInited = false;\n\n\t\tconst appLayout = BX.Reflection.getClass(\"BX.rest.AppLayout\");\n\t\tconst placement = (appLayout ? appLayout.getPlacement(this.placementCode) : null);\n\t\tif (placement)\n\t\t{\n\t\t\tthis.initialize();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t\"bitrix:app.placement\",\n\t\t\t\t\"getComponent\",\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tplacementId: this.placementCode,\n\t\t\t\t\t\tplacementOptions: {}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(function(result) {\n\t\t\t\tconst hiddenDiv = BX.create(\"DIV\", {\n\t\t\t\t\tstyle: {display: \"none\", overflow: \"hidden\"}\n\t\t\t\t});\n\t\t\t\tdocument.body.appendChild(hiddenDiv);\n\t\t\t\tBX.html(hiddenDiv, result.data.html, {\n\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\tsetTimeout(this.initialize.bind(this), 10);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t});\n\t\t\t}.bind(this), this.initialize.bind(this));\n\t\t}\n\t}\n\n\tinitialize()\n\t{\n\t\tthis.isInited = true;\n\t\tthis.placement = (BX[\"rest\"] ? BX.rest.AppLayout.getPlacement(this.placementCode) : null);\n\t\tif (this.placement)\n\t\t{\n\t\t\tthis.placementInterface = BX.rest.AppLayout.initializePlacement(this.placementCode);\n\t\t\tthis.isActive = true;\n\t\t}\n\n\t\tthis.executeCallbacks();\n\t}\n\n\taddCallback(callback)\n\t{\n\t\tthis.queue.push(callback);\n\t\tthis.executeCallbacks();\n\t}\n\n\texecuteCallbacks()\n\t{\n\t\tif (!this.isInited)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet callback;\n\t\twhile ((callback = this.queue.shift()) && Type.isFunction(callback)) {\n\t\t\tcallback(\n\t\t\t\t{\n\t\t\t\t\tsuccess: this.isActive,\n\t\t\t\t\tplacement: this.placement,\n\t\t\t\t\tplacementInterface: this.placementInterface,\n\t\t\t\t\tplacementEventObject: this,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getCallbackFromSettings(settings)\n\t{\n\t\tlet callback = null;\n\n\t\tif (\n\t\t\tType.isPlainObject(settings)\n\t\t\t&& settings.hasOwnProperty(\"callback\")\n\t\t\t&& Type.isFunction(settings[\"callback\"])\n\t\t)\n\t\t{\n\t\t\tcallback = settings[\"callback\"];\n\t\t\tdelete settings[\"callback\"];\n\t\t}\n\n\t\treturn callback;\n\t}\n\n\tstatic create(placementCode, settings)\n\t{\n\t\tconst copiedSettings = Runtime.clone(settings);\n\t\tconst callback = this.getCallbackFromSettings(copiedSettings);\n\n\t\tif (!this.instances.has(placementCode))\n\t\t{\n\t\t\tthis.instances.set(placementCode, new this(placementCode, copiedSettings));\n\t\t}\n\n\t\tconst instance = this.instances.get(placementCode);\n\n\t\tif (callback !== null)\n\t\t{\n\t\t\tinstance.addCallback(callback);\n\t\t}\n\n\t\treturn instance;\n\t}\n}\n\nclass DetailSearchItem\n{\n\tconstructor(placementInfo, eventObject)\n\t{\n\t\tthis.placementInfo = placementInfo;\n\t\tthis.eventObject = eventObject;\n\t\tthis.menuItem = null;\n\t\tthis.menuItemLoader = null;\n\t\tthis.appSid = null;\n\t\tthis.searchResults = null;\n\t\tthis.isActive = false;\n\t\tthis.chaperonTimeoutId = 0;\n\t\tthis.expectedResponseTime = 20000;\n\n\t\tthis.activateHandler = this.activate.bind(this);\n\t\tthis.checkResponseHandler = this.checkResponse.bind(this);\n\t\tthis.checkActiveHandler = this.checkActive.bind(this);\n\t\tthis.destroyHandler = this.destroy.bind(this);\n\n\t\tBX.addCustomEvent(this.eventObject, \"Placements:destroy\", this.destroyHandler);\n\t\tBX.addCustomEvent(this.eventObject, \"Placement:click\", this.checkActiveHandler);\n\t}\n\n\tactivate(event)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tif (event.hasOwnProperty(\"isTrusted\") && !event[\"isTrusted\"])\n\t\t\t{\n\t\t\t\tthis.setActive(false);\n\t\t\t}\n\n\t\t\tBX.PreventDefault(event);\n\t\t}\n\n\t\tif (!this.isActive)\n\t\t{\n\t\t\tBX.onCustomEvent(this.eventObject, \"Placement:click\", [this]);\n\t\t\tthis.setActive(true);\n\t\t\tthis.find();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetActive(isActive)\n\t{\n\t\tthis.isActive = !!isActive;\n\t\tif (this.menuItem)\n\t\t{\n\t\t\tif (this.isActive)\n\t\t\t{\n\t\t\t\tthis.menuItem.layout.item.classList.add(\"menu-popup-item-open\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.menuItem.layout.item.classList.remove(\"menu-popup-item-open\");\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckActive(placementItem)\n\t{\n\t\tif (placementItem !== this)\n\t\t{\n\t\t\tthis.setActive(false);\n\t\t}\n\t}\n\n\tgetMenuItemContainer(someMenu)\n\t{\n\t\tif (!this.menuItem)\n\t\t{\n\t\t\tthis.menuItem = someMenu.addMenuItemInternal({\n\t\t\t\tid: DetailSearch.MENU_ITEM_ID_PREFIX + this.placementInfo.id,\n\t\t\t\ttext: BX.util.htmlspecialchars(this.placementInfo.title),\n\t\t\t\tsubMenuOffsetX: 27,\n\t\t\t\tonclick: this.activateHandler,\n\t\t\t\tallowHtml: true,\n\t\t\t\tcacheable: true,\n\t\t\t\tclassName: this.placementInfo.icon ? \"menu-popup-item-accept\" : \"\"\n\t\t\t});\n\t\t\tif (this.placementInfo.icon)\n\t\t\t{\n\t\t\t\tconst icon = this.menuItem.getContainer().querySelector(\".menu-popup-item-icon\");\n\t\t\t\ticon.style.backgroundImage = \"url('\" + BX.util.htmlspecialchars(this.placementInfo.icon.src) + \"')\";\n\t\t\t\ticon.style.backgroundSize = \"contain\";\n\t\t\t}\n\t\t}\n\t\treturn this.menuItem.getContainer();\n\t}\n\n\tfind()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst data = {\n\t\t\tplacementId: this.placementInfo.id,\n\t\t\tplacementOptions: null\n\t\t};\n\t\tBX.onCustomEvent(this.eventObject, \"Placement:send\", [data]);\n\n\t\tBX.ajax.runComponentAction(\n\t\t\t\"bitrix:app.layout\",\n\t\t\t\"getComponent\",\n\t\t\t{data: data}\n\t\t).then(function(response) {\n\t\t\tif (!this.menuItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!(response && response[\"data\"] && response[\"data\"][\"componentResult\"]))\n\t\t\t{\n\t\t\t\treturn this.makeError(new Error(\"Empty response\"));\n\t\t\t}\n\n\t\t\tconst componentResult = response[\"data\"][\"componentResult\"];\n\n\t\t\tthis.appSid = componentResult[\"APP_SID\"];\n\n\t\t\tBX.addCustomEvent(this.eventObject, \"Placements:found\", this.checkResponseHandler);\n\n\t\t\tconst iframeNode = BX.create(\"DIV\", {\n\t\t\t\tattrs: {\"data-app-sid\" : componentResult[\"APP_SID\"]},\n\t\t\t\tstyle: {\"display\": \"none\", overflow: \"hidden\"}\n\t\t\t});\n\t\t\tdocument.body.appendChild(iframeNode);\n\t\t\tBX.html(iframeNode, response[\"data\"][\"html\"]);\n\t\t\tthis.chaperonTimeoutId = setTimeout(this.chaperon.bind(this), this.expectedResponseTime, this.appSid);\n\t\t}.bind(this), this.makeError.bind(this));\n\t}\n\n\tcheckResponse(applayout, placementSearchResults)\n\t{\n\t\tif (this.appSid === null || this.appSid !== applayout.params.appSid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.removeCustomEvent(this.eventObject, \"Placements:found\", this.checkResponseHandler);\n\n\t\tif (this.chaperonTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.chaperonTimeoutId);\n\t\t\tthis.chaperonTimeoutId = 0;\n\t\t}\n\n\t\tthis.searchResults = (BX.type.isArray(placementSearchResults) ? BX.clone(placementSearchResults, true) : []);\n\n\t\tthis.hideLoader();\n\n\t\tif (this.menuItem)\n\t\t{\n\t\t\tif (this.searchResults.length <= 0)\n\t\t\t{\n\t\t\t\tthis.menuItem.disable();\n\t\t\t}\n\t\t\telse if (this.menuItem.isDisabled())\n\t\t\t{\n\t\t\t\tthis.menuItem.enable();\n\t\t\t}\n\t\t}\n\t\tBX.onCustomEvent(this.eventObject, \"Placement:found\", [this, this.searchResults]);\n\t}\n\n\tchaperon()\n\t{\n\t\tthis.chaperonTimeoutId = 0;\n\t\tthis.makeError(new Error(\"The placement is responding too long.\"));\n\t}\n\n\tmakeError(error)\n\t{\n\t\tthis.hideLoader(true);\n\t\tBX.removeCustomEvent(this.eventObject, \"Placements:found\", this.checkResponseHandler);\n\t\tBX.onCustomEvent(this.eventObject, \"Placement:errored\", [this, error]);\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (!this.menuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.menuItemLoader = (this.menuItemLoader || new BX.Loader({\n\t\t\ttarget: this.menuItem.getContainer(),\n\t\t\tsize: 20,\n\t\t\tmode: \"inline\"\n\t\t}));\n\t\tthis.menuItemLoader.show();\n\t\tthis.menuItem.disable();\n\t}\n\n\thideLoader(errored)\n\t{\n\t\terrored = (errored === true);\n\t\tif (!this.menuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.menuItemLoader)\n\t\t{\n\t\t\tthis.menuItemLoader.hide();\n\t\t}\n\t\tif (errored)\n\t\t{\n\t\t\tthis.menuItem.disable();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tBX.removeCustomEvent(this.eventObject, \"Placements:destroy\", this.destroyHandler);\n\t\tBX.removeCustomEvent(this.eventObject, \"Placement:click\", this.checkActiveHandler);\n\n\t\tif (this.appSid !== null && BX.rest.AppLayout.get(this.appSid))\n\t\t{\n\t\t\tBX.rest.AppLayout.get(this.appSid).destroy();\n\t\t}\n\t\tif (this.menuItemLoader)\n\t\t{\n\t\t\tthis.menuItemLoader.destroy();\n\t\t\tthis.menuItemLoader = null;\n\t\t}\n\t\tif (this.chaperonTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.chaperonTimeoutId);\n\t\t\tthis.chaperonTimeoutId = 0;\n\t\t}\n\t\tthis.menuItem = null;\n\t\tthis.searchResults = null;\n\t\tthis.eventObject = null;\n\t}\n}\n\nclass DetailSearch\n{\n\tstatic MENU_ITEM_ID_PREFIX = \"placement-\";\n\t\n\tconstructor(placementCode: string)\n\t{\n\t\tthis.placementCode = placementCode;\n\t\tthis.searchParams = {};\n\t\tthis.container = BX.create(\"div\", {props: {className: \"placement-container\"}});\n\t\tthis.containerLoader = null;\n\t\tthis.placementList = new Map();\n\t\tthis.firstPlacementAppId = 0;\n\t\tthis.placementInterface = null;\n\t\tthis.placementEventObject = null;\n\t\tthis.isInited = false;\n\t\tthis.isDestroyed = false;\n\t\tthis.isShown = false;\n\t\tthis.active = null;\n\t\tthis.activeProcesses = 0;\n\t\tthis.menu = null;\n\t\tthis.placementParams = null;\n\t\tthis.isLoderEnabled = true;\n\n\t\tthis.restCrmShowFoundEntities = this.restCrmShowFoundEntities.bind(this);\n\t\tthis.restCrmShowCreatedEntity = this.restCrmShowCreatedEntity.bind(this);\n\n\t\tBX.addCustomEvent(this, \"Placements:destroy\", this.destroy.bind(this));\n\n\t\tLoader.create(this.placementCode, {callback: this.init.bind(this)});\n\t}\n\n\tinit(data)\n\t{\n\t\tif (this.isInited === true || this.isDestroyed === true)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.success === true\n\t\t\t&& data.placement\n\t\t\t&& data.placement.param\n\t\t\t&& data.placement.param.extendedList instanceof Map)\n\t\t{\n\t\t\tthis.placementList = data.placement.param.extendedList;\n\t\t\tthis.placementEventObject = data.placementEventObject;\n\t\t\tconst isPlacementInterface = data.hasOwnProperty(\"placementInterface\");\n\t\t\tconst isNeedInitializeInterface = (\n\t\t\t\tisPlacementInterface\n\t\t\t\t&& !data[\"placementInterface\"].hasOwnProperty(\"crmShowFoundEntities\")\n\t\t\t);\n\t\t\tif (isPlacementInterface)\n\t\t\t{\n\t\t\t\tthis.placementInterface =\n\t\t\t\t\t(isNeedInitializeInterface)\n\t\t\t\t\t\t? this.initializeInterface(data[\"placementInterface\"])\n\t\t\t\t\t\t: data[\"placementInterface\"]\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\t\tthis.isInited = true;\n\t\tif (this.isShown)\n\t\t{\n\t\t\tthis.showMenu();\n\t\t}\n\t}\n\n\tinitializeInterface(placementInterface)\n\t{\n\t\tconst placementEventObject = this.placementEventObject;\n\n\t\tplacementInterface.prototype.crmShowFoundEntities = function (data) {\n\t\t\tBX.onCustomEvent(placementEventObject, \"restCrmShowFoundEntities\", [this, data.data]);\n\t\t};\n\t\tplacementInterface.prototype.crmShowCreatedEntity = function (data) {\n\t\t\tBX.onCustomEvent(placementEventObject, \"restCrmShowCreatedEntity\", [this, data]);\n\t\t};\n\t\tplacementInterface.prototype.events.push(\"onCrmEntityIsNeedToCreate\");\n\n\t\treturn placementInterface;\n\t}\n\n\tshow(container, nextSibling, params)\n\t{\n\t\tif (BX.Type.isDomNode(nextSibling))\n\t\t{\n\t\t\tnextSibling.parentNode.insertBefore(this.container, nextSibling);\n\t\t}\n\t\telse if (BX.Type.isDomNode(container))\n\t\t{\n\t\t\tcontainer.appendChild(this.container);\n\t\t}\n\n\t\tthis.isShown = true;\n\n\t\tthis.isLoderEnabled = !BX.prop.getBoolean(params, \"hideLoader\", false);\n\n\t\tif (this.isInited !== true)\n\t\t{\n\t\t\tif (this.isLoderEnabled)\n\t\t\t{\n\t\t\t\tthis.showLoader();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showMenu();\n\t\t}\n\t}\n\n\tshowLoader()\n\t{\n\t\tthis.containerLoader = (this.containerLoader || new BX.Loader({\n\t\t\ttarget: this.container,\n\t\t\tsize: 50\n\t\t}));\n\t\tthis.containerLoader.show();\n\t}\n\n\thideLoader()\n\t{\n\t\tif (this.containerLoader)\n\t\t{\n\t\t\tthis.containerLoader.hide();\n\t\t}\n\t}\n\n\tgetCountryMap(placementData)\n\t{\n\t\tconst result = new Map();\n\n\t\tconst countriesOption = BX.prop.getString(\n\t\t\tBX.prop.getObject(placementData, \"options\", {}),\n\t\t\t\"countries\",\n\t\t\t\"\"\n\t\t);\n\t\tif (Type.isStringFilled(countriesOption) && /^[1-9][0-9]*(,[1-9][0-9]*)*$/.test(countriesOption))\n\t\t{\n\t\t\tcountriesOption.split(',').forEach(\n\t\t\t\t(countryCode) => {\n\t\t\t\t\tconst countryId = parseInt(countryCode);\n\t\t\t\t\tif (!isNaN(countryId) && !result.has(countryId))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.set(countryId, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tshowMenu()\n\t{\n\t\tif (this.isLoderEnabled)\n\t\t{\n\t\t\tthis.hideLoader();\n\t\t}\n\n\t\tconst eventParams = {\n\t\t\tplacementParams: null,\n\t\t\tcurrentSearchQuery: \"\",\n\t\t};\n\t\tBX.onCustomEvent(this, \"Placements:params\", [eventParams]);\n\n\t\tthis.placementParams = Runtime.clone(eventParams[\"placementParams\"]);\n\t\tconst currentSearchQuery = BX.prop.getString(eventParams, \"currentSearchQuery\", \"\");\n\n\t\tif (Type.isObject(this.placementParams))\n\t\t{\n\t\t\tconst isPlacementsAvailable = (this.placementParams[\"numberOfPlacements\"] > 0);\n\t\t\tthis.refreshContainerVisibility(\n\t\t\t\t{\n\t\t\t\t\tcurrentSearchQuery: currentSearchQuery,\n\t\t\t\t\tplacementParams: Runtime.clone(this.placementParams)\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (!isPlacementsAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tBX.adjust(this.container, {\n\t\t\tprops: {className: \"placement-container menu-popup\"}\n\t\t});\n\n\t\tthis.replaceEvents();\n\n\t\tthis.destroyMenu();\n\t\tthis.menu = new BX.PopupMenuWindow({id: \"someId\"});\n\n\t\tBX.onCustomEvent(this, \"Placements:beforeAppendItems\");\n\n\t\tconst itemsNode = BX.create(\"div\", {props: {className: \"menu-popup-items\"}});\n\t\tthis.container.appendChild(itemsNode);\n\t\tthis.firstPlacementAppId = 0;\n\t\tthis.placementList.forEach(\n\t\t\tfunction(placementData) {\n\t\t\t\tconst countries = this.getCountryMap(placementData);\n\t\t\t\tconst countryId = BX.prop.getInteger(this.placementParams, \"countryId\", 0);\n\t\t\t\tif (countries.size === 0 || countries.has(countryId))\n\t\t\t\t{\n\t\t\t\t\tif (this.firstPlacementAppId === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.firstPlacementAppId = parseInt(placementData[\"id\"]);\n\t\t\t\t\t}\n\t\t\t\t\tconst placement = new DetailSearchItem(placementData, this);\n\t\t\t\t\titemsNode.appendChild(placement.getMenuItemContainer(this.menu));\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t);\n\n\t\tif (\n\t\t\tType.isObject(this.placementParams)\n\t\t\t&& this.placementParams[\"isPlacement\"]\n\t\t\t&& this.placementParams[\"numberOfPlacements\"] <= 1\n\t\t)\n\t\t{\n\t\t\tthis.setFirstPlacementMenuItemVisibility(false);\n\t\t}\n\t}\n\n\trestCrmShowFoundEntities(applayout, placementSearchResults)\n\t{\n\t\t// applayout is an instance Of BX.rest.AppLayout\n\t\tBX.onCustomEvent(this, \"Placements:found\", [applayout, placementSearchResults]);\n\t}\n\n\trestCrmEntityCreate(data)\n\t{\n\t\tthis.activeProcesses++;\n\t\tBX.onCustomEvent(\"onCrmEntityIsNeedToCreate\", data);\n\t}\n\n\trestCrmShowCreatedEntity(applayout, createdEntity)\n\t{\n\t\tthis.activeProcesses--;\n\n\t\tBX.onCustomEvent(\n\t\t\tthis,\n\t\t\t\"Placements:select\",\n\t\t\t[createdEntity]\n\t\t);\n\t}\n\n\tonPlacementHasBeenClicked(placementItem)\n\t{\n\t\tif (this.active === placementItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.active = placementItem;\n\t\tthis.activeProcesses++;\n\t}\n\n\tonPlacementIsReadyToSend(params)\n\t{\n\t\tBX.onCustomEvent(this, \"Placements:searchParams\", [this.searchParams]);\n\t\tparams[\"placementOptions\"] = this.searchParams;\n\t}\n\n\tonPlacementHasBeenFound(placementItem, searchResults)\n\t{\n\t\tif (this.active === placementItem)\n\t\t{\n\t\t\tBX.onCustomEvent(this, \"Placements:setFoundItems\", [placementItem, searchResults]);\n\t\t}\n\n\t\tthis.activeProcesses--;\n\t}\n\n\tonPlacementIsErrored(/*placementItem, error*/)\n\t{\n\t\tthis.activeProcesses--;\n\t}\n\n\treplaceEvents() {\n\t\tBX.addCustomEvent(this.placementEventObject, \"restCrmShowFoundEntities\", this.restCrmShowFoundEntities);\n\t\tBX.addCustomEvent(this.placementEventObject, \"restCrmShowCreatedEntity\", this.restCrmShowCreatedEntity);\n\n\t\tBX.addCustomEvent(this, \"Placement:click\", this.onPlacementHasBeenClicked);\n\t\tBX.addCustomEvent(this, \"Placement:send\", this.onPlacementIsReadyToSend.bind(this));\n\t\tBX.addCustomEvent(this, \"Placement:found\", this.onPlacementHasBeenFound.bind(this));\n\t\tBX.addCustomEvent(this, \"Placement:errored\", this.onPlacementIsErrored.bind(this));\n\n\t\tBX.addCustomEvent(this, \"Placements:active\", this.onCheckActive.bind(this));\n\t\tBX.addCustomEvent(this, \"Placements:pick\", this.restCrmEntityCreate.bind(this));\n\t\tBX.addCustomEvent(this, \"Placements:changeQuery\", this.onChangeSearchQuery.bind(this));\n\t\tBX.addCustomEvent(this, \"Placements:startDefaultSearch\", this.onStartDefaultSearch.bind(this));\n\t}\n\n\trestoreEvents()\n\t{\n\t\tBX.removeAllCustomEvents(this, \"Placement:click\");\n\t\tBX.removeAllCustomEvents(this, \"Placement:send\");\n\t\tBX.removeAllCustomEvents(this, \"Placement:found\");\n\t\tBX.removeAllCustomEvents(this, \"Placement:errored\");\n\n\t\tBX.removeAllCustomEvents(this, \"Placements:found\");\n\t\tBX.removeAllCustomEvents(this, \"Placements:active\");\n\t\tBX.removeAllCustomEvents(this, \"Placements:pick\");\n\t\tBX.removeAllCustomEvents(this, \"Placements:changeQuery\");\n\t\tBX.removeAllCustomEvents(this, \"Placements:startDefaultSearch\");\n\t\tBX.removeAllCustomEvents(this, \"Placements:destroy\");\n\n\t\tBX.removeCustomEvent(this.placementEventObject, \"restCrmShowFoundEntities\", this.restCrmShowFoundEntities);\n\t\tBX.removeCustomEvent(this.placementEventObject, \"restCrmShowCreatedEntity\", this.restCrmShowCreatedEntity);\n\t}\n\n\tonCheckActive(result)\n\t{\n\t\tresult.active = (this.activeProcesses > 0);\n\t}\n\n\tonPlacementsDestroy()\n\t{\n\t\tthis.destroy();\n\t}\n\n\tdestroyMenu()\n\t{\n\t\tif (this.menu)\n\t\t{\n\t\t\tthis.menu.destroy();\n\t\t\tthis.menu = null;\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.isDestroyed = true;\n\t\tthis.destroyMenu();\n\t\tthis.restoreEvents();\n\t\tthis.placementInterface = null;\n\t\tthis.placementEventObject = null;\n\t\tif (this.containerLoader)\n\t\t{\n\t\t\tthis.containerLoader.destroy();\n\t\t\tthis.containerLoader = null;\n\t\t}\n\t\tfor (let i in this)\n\t\t{\n\t\t\tif (this.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tdelete this[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tsetFirstPlacementAppId(id)\n\t{\n\t\tthis.firstPlacementAppId = parseInt(id);\n\t}\n\n\tgetFirstPlacementAppId()\n\t{\n\t\treturn this.firstPlacementAppId;\n\t}\n\n\tgetFirstPlacementMenuItemId()\n\t{\n\t\tconst appId = this.getFirstPlacementAppId();\n\t\treturn (appId > 0) ? (DetailSearch.MENU_ITEM_ID_PREFIX + appId) : \"\";\n\t}\n\n\tgetFirstPlacementMenuItem()\n\t{\n\t\tlet menuItem = null;\n\n\t\tconst firstMenuItemId = this.getFirstPlacementMenuItemId();\n\t\tif (Type.isStringFilled(firstMenuItemId) && this.menu)\n\t\t{\n\t\t\tmenuItem = this.menu.getMenuItem(firstMenuItemId);\n\t\t}\n\n\t\treturn menuItem;\n\t}\n\n\trefreshContainerVisibility(params)\n\t{\n\t\tconst placementParams = BX.prop.getObject(params, \"placementParams\", {});\n\t\tconst numberOfPlacements = BX.prop.getInteger(placementParams, \"numberOfPlacements\", 0);\n\t\tconst isPlacementsAvailable = (numberOfPlacements > 0);\n\t\tconst isPlacement = BX.prop.getBoolean(placementParams, \"isPlacement\", false);\n\t\tconst currentSearchQuery = BX.prop.getString(params, \"currentSearchQuery\", \"\");\n\t\tconst isVisible = (\n\t\t\tisPlacementsAvailable\n\t\t\t&& (!isPlacement || (isPlacement && numberOfPlacements > 1))\n\t\t\t&& currentSearchQuery.length > 2\n\t\t);\n\t\tthis.setContainerVisibility(this.container, isVisible);\n\t}\n\n\tsetFirstPlacementMenuItemVisibility(isVisible)\n\t{\n\t\tconst menuItem = this.getFirstPlacementMenuItem();\n\t\tif (menuItem)\n\t\t{\n\t\t\tthis.setContainerVisibility(menuItem.getContainer(), isVisible);\n\t\t}\n\t}\n\n\tsetContainerVisibility(container, isVisible)\n\t{\n\t\tif (Type.isDomNode(container))\n\t\t{\n\t\t\tif (isVisible && container.style.display === \"none\")\n\t\t\t{\n\t\t\t\tcontainer.style.display = \"\";\n\t\t\t}\n\t\t\telse if (!isVisible && container.style.display === \"\")\n\t\t\t{\n\t\t\t\tcontainer.style.display = \"none\";\n\t\t\t}\n\t\t}\n\t}\n\n\tactivateFirstPlacementMenuItem()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tconst menuItem = this.getFirstPlacementMenuItem();\n\t\t\tif (menuItem)\n\t\t\t{\n\t\t\t\tmenuItem.layout.text.dispatchEvent(\n\t\t\t\t\tnew MouseEvent(\n\t\t\t\t\t\t\"click\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t\t\tcancelable: true\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}, 0);\n\t}\n\n\tonChangeSearchQuery(params)\n\t{\n\t\tthis.refreshContainerVisibility(\n\t\t\t{\n\t\t\t\tcurrentSearchQuery: BX.prop.getString(params, \"currentSearchQuery\", \"\"),\n\t\t\t\tplacementParams: Runtime.clone(this.placementParams)\n\t\t\t}\n\t\t);\n\t}\n\n\tonStartDefaultSearch(params)\n\t{\n\t\tif (Type.isPlainObject(params) && params.hasOwnProperty(\"appId\"))\n\t\t{\n\t\t\tparams[\"appId\"] = this.getFirstPlacementAppId();\n\t\t}\n\n\t\tthis.activateFirstPlacementMenuItem();\n\t}\n}\n\nexport {\n\tDetailSearch\n};\n"],"names":["Loader","placementCode","settings","Type","isStringFilled","placementInterface","queue","isActive","isInited","appLayout","BX","Reflection","getClass","getPlacement","this","initialize","ajax","runComponentAction","data","placementId","placementOptions","then","result","hiddenDiv","create","style","display","overflow","document","body","appendChild","html","callback","setTimeout","bind","placement","rest","AppLayout","initializePlacement","executeCallbacks","push","shift","isFunction","success","placementEventObject","isPlainObject","hasOwnProperty","copiedSettings","Runtime","clone","getCallbackFromSettings","instances","has","set","instance","get","addCallback","Map","DetailSearchItem","placementInfo","eventObject","menuItem","menuItemLoader","appSid","searchResults","chaperonTimeoutId","expectedResponseTime","activateHandler","activate","checkResponseHandler","checkResponse","checkActiveHandler","checkActive","destroyHandler","destroy","addCustomEvent","event","setActive","PreventDefault","onCustomEvent","find","layout","item","classList","add","remove","placementItem","someMenu","addMenuItemInternal","id","DetailSearch","MENU_ITEM_ID_PREFIX","text","util","htmlspecialchars","title","subMenuOffsetX","onclick","allowHtml","cacheable","className","icon","getContainer","querySelector","backgroundImage","src","backgroundSize","showLoader","response","makeError","Error","componentResult","iframeNode","attrs","chaperon","applayout","placementSearchResults","params","removeCustomEvent","clearTimeout","type","isArray","hideLoader","length","disable","isDisabled","enable","error","target","size","mode","show","errored","hide","searchParams","container","props","containerLoader","placementList","firstPlacementAppId","isDestroyed","isShown","active","activeProcesses","menu","placementParams","isLoderEnabled","restCrmShowFoundEntities","restCrmShowCreatedEntity","init","param","extendedList","isPlacementInterface","isNeedInitializeInterface","initializeInterface","showMenu","prototype","crmShowFoundEntities","crmShowCreatedEntity","events","nextSibling","isDomNode","parentNode","insertBefore","prop","getBoolean","placementData","countriesOption","getString","getObject","test","split","forEach","countryCode","countryId","parseInt","isNaN","eventParams","currentSearchQuery","isObject","isPlacementsAvailable","refreshContainerVisibility","adjust","replaceEvents","destroyMenu","PopupMenuWindow","itemsNode","countries","getCountryMap","getInteger","getMenuItemContainer","setFirstPlacementMenuItemVisibility","createdEntity","onPlacementHasBeenClicked","onPlacementIsReadyToSend","onPlacementHasBeenFound","onPlacementIsErrored","onCheckActive","restCrmEntityCreate","onChangeSearchQuery","onStartDefaultSearch","removeAllCustomEvents","i","restoreEvents","appId","getFirstPlacementAppId","firstMenuItemId","getFirstPlacementMenuItemId","getMenuItem","numberOfPlacements","isPlacement","isVisible","setContainerVisibility","getFirstPlacementMenuItem","_this","dispatchEvent","MouseEvent","bubbles","cancelable","activateFirstPlacementMenuItem"],"mappings":"+EAGMA,wBAIOC,EAAeC,4CAErBD,cAAgBE,OAAKC,eAAeH,GAAiBA,EAAgB,QACrEI,mBAAqB,UACrBH,SAAWA,OACXI,MAAQ,QACRC,UAAW,OACXC,UAAW,MAEVC,EAAYC,GAAGC,WAAWC,SAAS,sBACtBH,EAAYA,EAAUI,aAAaC,KAAKb,eAAiB,WAGtEc,aAILL,GAAGM,KAAKC,mBACP,uBACA,eACA,CACCC,KAAM,CACLC,YAAaL,KAAKb,cAClBmB,iBAAkB,MAGnBC,KAAK,SAASC,OACTC,EAAYb,GAAGc,OAAO,MAAO,CAClCC,MAAO,CAACC,QAAS,OAAQC,SAAU,YAEpCC,SAASC,KAAKC,YAAYP,GAC1Bb,GAAGqB,KAAKR,EAAWD,EAAOJ,KAAKa,KAAM,CACpCC,SAAU,WACTC,WAAWnB,KAAKC,WAAWmB,KAAKpB,MAAO,KACtCoB,KAAKpB,SAEPoB,KAAKpB,MAAOA,KAAKC,WAAWmB,KAAKpB,kFAM/BN,UAAW,OACX2B,UAAazB,GAAE,KAAWA,GAAG0B,KAAKC,UAAUxB,aAAaC,KAAKb,eAAiB,KAChFa,KAAKqB,iBAEH9B,mBAAqBK,GAAG0B,KAAKC,UAAUC,oBAAoBxB,KAAKb,oBAChEM,UAAW,QAGZgC,uDAGMP,QAEN1B,MAAMkC,KAAKR,QACXO,iEAKAzB,KAAKN,iBAKNwB,GACIA,EAAWlB,KAAKR,MAAMmC,UAAYtC,OAAKuC,WAAWV,IACzDA,EACC,CACCW,QAAS7B,KAAKP,SACd4B,UAAWrB,KAAKqB,UAChB9B,mBAAoBS,KAAKT,mBACzBuC,qBAAsB9B,yDAMKZ,OAE1B8B,EAAW,YAGd7B,OAAK0C,cAAc3C,IAChBA,EAAS4C,eAAe,aACxB3C,OAAKuC,WAAWxC,EAAQ,YAG3B8B,EAAW9B,EAAQ,gBACZA,EAAQ,UAGT8B,iCAGM/B,EAAeC,OAEtB6C,EAAiBC,UAAQC,MAAM/C,GAC/B8B,EAAWlB,KAAKoC,wBAAwBH,GAEzCjC,KAAKqC,UAAUC,IAAInD,SAElBkD,UAAUE,IAAIpD,EAAe,IAAIa,KAAKb,EAAe8C,QAGrDO,EAAWxC,KAAKqC,UAAUI,IAAItD,UAEnB,OAAb+B,GAEHsB,EAASE,YAAYxB,GAGfsB,uCArHHtD,cAEc,IAAIyD,SAuHlBC,wBAEOC,EAAeC,4CAErBD,cAAgBA,OAChBC,YAAcA,OACdC,SAAW,UACXC,eAAiB,UACjBC,OAAS,UACTC,cAAgB,UAChBzD,UAAW,OACX0D,kBAAoB,OACpBC,qBAAuB,SAEvBC,gBAAkBrD,KAAKsD,SAASlC,KAAKpB,WACrCuD,qBAAuBvD,KAAKwD,cAAcpC,KAAKpB,WAC/CyD,mBAAqBzD,KAAK0D,YAAYtC,KAAKpB,WAC3C2D,eAAiB3D,KAAK4D,QAAQxC,KAAKpB,MAExCJ,GAAGiE,eAAe7D,KAAK8C,YAAa,qBAAsB9C,KAAK2D,gBAC/D/D,GAAGiE,eAAe7D,KAAK8C,YAAa,kBAAmB9C,KAAKyD,sFAGpDK,UAEJA,IAECA,EAAM9B,eAAe,eAAiB8B,EAAK,gBAEzCC,WAAU,GAGhBnE,GAAGoE,eAAeF,IAGd9D,KAAKP,WAETG,GAAGqE,cAAcjE,KAAK8C,YAAa,kBAAmB,CAAC9C,YAClD+D,WAAU,QACVG,SAGC,oCAGEzE,QAEJA,WAAaA,EACdO,KAAK+C,WAEJ/C,KAAKP,cAEHsD,SAASoB,OAAOC,KAAKC,UAAUC,IAAI,6BAInCvB,SAASoB,OAAOC,KAAKC,UAAUE,OAAO,6DAKlCC,GAEPA,IAAkBxE,WAEhB+D,WAAU,gDAIIU,OAEfzE,KAAK+C,gBAEJA,SAAW0B,EAASC,oBAAoB,CAC5CC,GAAIC,EAAaC,oBAAsB7E,KAAK6C,cAAc8B,GAC1DG,KAAMlF,GAAGmF,KAAKC,iBAAiBhF,KAAK6C,cAAcoC,OAClDC,eAAgB,GAChBC,QAASnF,KAAKqD,gBACd+B,WAAW,EACXC,WAAW,EACXC,UAAWtF,KAAK6C,cAAc0C,KAAO,yBAA2B,KAE7DvF,KAAK6C,cAAc0C,MACvB,KACOA,EAAOvF,KAAK+C,SAASyC,eAAeC,cAAc,yBACxDF,EAAK5E,MAAM+E,gBAAkB,QAAU9F,GAAGmF,KAAKC,iBAAiBhF,KAAK6C,cAAc0C,KAAKI,KAAO,KAC/FJ,EAAK5E,MAAMiF,eAAiB,iBAGvB5F,KAAK+C,SAASyC,mDAKhBK,iBAECzF,EAAO,CACZC,YAAaL,KAAK6C,cAAc8B,GAChCrE,iBAAkB,MAEnBV,GAAGqE,cAAcjE,KAAK8C,YAAa,iBAAkB,CAAC1C,IAEtDR,GAAGM,KAAKC,mBACP,oBACA,eACA,CAACC,KAAMA,IACNG,KAAK,SAASuF,MACV9F,KAAK+C,eAKJ+C,GAAYA,EAAQ,MAAYA,EAAQ,KAAR,wBAE9B9F,KAAK+F,UAAU,IAAIC,MAAM,uBAG3BC,EAAkBH,EAAQ,KAAR,qBAEnB7C,OAASgD,EAAe,QAE7BrG,GAAGiE,eAAe7D,KAAK8C,YAAa,mBAAoB9C,KAAKuD,0BAEvD2C,EAAatG,GAAGc,OAAO,MAAO,CACnCyF,MAAO,gBAAkBF,EAAe,SACxCtF,MAAO,SAAY,OAAQE,SAAU,YAEtCC,SAASC,KAAKC,YAAYkF,GAC1BtG,GAAGqB,KAAKiF,EAAYJ,EAAQ,KAAR,WACf3C,kBAAoBhC,WAAWnB,KAAKoG,SAAShF,KAAKpB,MAAOA,KAAKoD,qBAAsBpD,KAAKiD,UAC7F7B,KAAKpB,MAAOA,KAAK+F,UAAU3E,KAAKpB,6CAGrBqG,EAAWC,GAEJ,OAAhBtG,KAAKiD,QAAmBjD,KAAKiD,SAAWoD,EAAUE,OAAOtD,SAI7DrD,GAAG4G,kBAAkBxG,KAAK8C,YAAa,mBAAoB9C,KAAKuD,sBAE5DvD,KAAKmD,kBAAoB,IAE5BsD,aAAazG,KAAKmD,wBACbA,kBAAoB,QAGrBD,cAAiBtD,GAAG8G,KAAKC,QAAQL,GAA0B1G,GAAGuC,MAAMmE,GAAwB,GAAQ,QAEpGM,aAED5G,KAAK+C,WAEJ/C,KAAKkD,cAAc2D,QAAU,OAE3B9D,SAAS+D,UAEN9G,KAAK+C,SAASgE,mBAEjBhE,SAASiE,UAGhBpH,GAAGqE,cAAcjE,KAAK8C,YAAa,kBAAmB,CAAC9C,KAAMA,KAAKkD,yDAK7DC,kBAAoB,OACpB4C,UAAU,IAAIC,MAAM,4EAGhBiB,QAEJL,YAAW,GAChBhH,GAAG4G,kBAAkBxG,KAAK8C,YAAa,mBAAoB9C,KAAKuD,sBAChE3D,GAAGqE,cAAcjE,KAAK8C,YAAa,oBAAqB,CAAC9C,KAAMiH,yCAK1DjH,KAAK+C,gBAILC,eAAkBhD,KAAKgD,gBAAkB,IAAIpD,GAAGV,OAAO,CAC3DgI,OAAQlH,KAAK+C,SAASyC,eACtB2B,KAAM,GACNC,KAAM,gBAEFpE,eAAeqE,YACftE,SAAS+D,8CAGJQ,GAEVA,GAAuB,IAAZA,EACNtH,KAAK+C,WAIN/C,KAAKgD,qBAEHA,eAAeuE,OAEjBD,QAEEvE,SAAS+D,6CAMflH,GAAG4G,kBAAkBxG,KAAK8C,YAAa,qBAAsB9C,KAAK2D,gBAClE/D,GAAG4G,kBAAkBxG,KAAK8C,YAAa,kBAAmB9C,KAAKyD,oBAE3C,OAAhBzD,KAAKiD,QAAmBrD,GAAG0B,KAAKC,UAAUkB,IAAIzC,KAAKiD,SAEtDrD,GAAG0B,KAAKC,UAAUkB,IAAIzC,KAAKiD,QAAQW,UAEhC5D,KAAKgD,sBAEHA,eAAeY,eACfZ,eAAiB,MAEnBhD,KAAKmD,kBAAoB,IAE5BsD,aAAazG,KAAKmD,wBACbA,kBAAoB,QAErBJ,SAAW,UACXG,cAAgB,UAChBJ,YAAc,cAIf8B,wBAIOzF,4CAENA,cAAgBA,OAChBqI,aAAe,QACfC,UAAY7H,GAAGc,OAAO,MAAO,CAACgH,MAAO,CAACpC,UAAW,8BACjDqC,gBAAkB,UAClBC,cAAgB,IAAIjF,SACpBkF,oBAAsB,OACtBtI,mBAAqB,UACrBuC,qBAAuB,UACvBpC,UAAW,OACXoI,aAAc,OACdC,SAAU,OACVC,OAAS,UACTC,gBAAkB,OAClBC,KAAO,UACPC,gBAAkB,UAClBC,gBAAiB,OAEjBC,yBAA2BrI,KAAKqI,yBAAyBjH,KAAKpB,WAC9DsI,yBAA2BtI,KAAKsI,yBAAyBlH,KAAKpB,MAEnEJ,GAAGiE,eAAe7D,KAAM,qBAAsBA,KAAK4D,QAAQxC,KAAKpB,OAEhEd,EAAOwB,OAAOV,KAAKb,cAAe,CAAC+B,SAAUlB,KAAKuI,KAAKnH,KAAKpB,sEAGxDI,OAEkB,IAAlBJ,KAAKN,WAA0C,IAArBM,KAAK8H,iBAId,IAAjB1H,EAAKyB,SACLzB,EAAKiB,WACLjB,EAAKiB,UAAUmH,OACfpI,EAAKiB,UAAUmH,MAAMC,wBAAwB9F,IACjD,MACMiF,cAAgBxH,EAAKiB,UAAUmH,MAAMC,kBACrC3G,qBAAuB1B,EAAK0B,yBAC3B4G,EAAuBtI,EAAK4B,eAAe,sBAC3C2G,EACLD,IACItI,EAAI,mBAAuB4B,eAAe,wBAE3C0G,SAEEnJ,mBACHoJ,EACE3I,KAAK4I,oBAAoBxI,EAAI,oBAC7BA,EAAI,yBAILV,UAAW,EACZM,KAAK+H,cAEHc,wDAIatJ,OAEbuC,EAAuB9B,KAAK8B,4BAElCvC,EAAmBuJ,UAAUC,qBAAuB,SAAU3I,GAC7DR,GAAGqE,cAAcnC,EAAsB,2BAA4B,CAAC9B,KAAMI,EAAKA,QAEhFb,EAAmBuJ,UAAUE,qBAAuB,SAAU5I,GAC7DR,GAAGqE,cAAcnC,EAAsB,2BAA4B,CAAC9B,KAAMI,KAE3Eb,EAAmBuJ,UAAUG,OAAOvH,KAAK,6BAElCnC,+BAGHkI,EAAWyB,EAAa3C,GAExB3G,GAAGP,KAAK8J,UAAUD,GAErBA,EAAYE,WAAWC,aAAarJ,KAAKyH,UAAWyB,GAE5CtJ,GAAGP,KAAK8J,UAAU1B,IAE1BA,EAAUzG,YAAYhB,KAAKyH,gBAGvBM,SAAU,OAEVK,gBAAkBxI,GAAG0J,KAAKC,WAAWhD,EAAQ,cAAc,IAE1C,IAAlBvG,KAAKN,SAEJM,KAAKoI,qBAEHvC,kBAKDgD,qDAMDlB,gBAAmB3H,KAAK2H,iBAAmB,IAAI/H,GAAGV,OAAO,CAC7DgI,OAAQlH,KAAKyH,UACbN,KAAM,UAEFQ,gBAAgBN,4CAKjBrH,KAAK2H,sBAEHA,gBAAgBJ,6CAITiC,OAEPhJ,EAAS,IAAImC,IAEb8G,EAAkB7J,GAAG0J,KAAKI,UAC/B9J,GAAG0J,KAAKK,UAAUH,EAAe,UAAW,IAC5C,YACA,WAEGnK,OAAKC,eAAemK,IAAoB,+BAA+BG,KAAKH,IAE/EA,EAAgBI,MAAM,KAAKC,SAC1B,SAACC,OACMC,EAAYC,SAASF,GACtBG,MAAMF,IAAexJ,EAAO8B,IAAI0H,IAEpCxJ,EAAO+B,IAAIyH,GAAW,MAMnBxJ,qCAKHR,KAAKoI,qBAEHxB,iBAGAuD,EAAc,CACnBhC,gBAAiB,KACjBiC,mBAAoB,IAErBxK,GAAGqE,cAAcjE,KAAM,oBAAqB,CAACmK,SAExChC,gBAAkBjG,UAAQC,MAAMgI,EAAW,qBAC1CC,EAAqBxK,GAAG0J,KAAKI,UAAUS,EAAa,qBAAsB,OAE5E9K,OAAKgL,SAASrK,KAAKmI,iBACvB,KACOmC,EAAyBtK,KAAKmI,gBAAL,mBAA6C,UACvEoC,2BACJ,CACCH,mBAAoBA,EACpBjC,gBAAiBjG,UAAQC,MAAMnC,KAAKmI,oBAGjCmC,SAMN1K,GAAG4K,OAAOxK,KAAKyH,UAAW,CACzBC,MAAO,CAACpC,UAAW,yCAGfmF,qBAEAC,mBACAxC,KAAO,IAAItI,GAAG+K,gBAAgB,CAAChG,GAAI,WAExC/E,GAAGqE,cAAcjE,KAAM,oCAEjB4K,EAAYhL,GAAGc,OAAO,MAAO,CAACgH,MAAO,CAACpC,UAAW,2BAClDmC,UAAUzG,YAAY4J,QACtB/C,oBAAsB,OACtBD,cAAckC,QAClB,SAASN,OACFqB,EAAY7K,KAAK8K,cAActB,GAC/BQ,EAAYpK,GAAG0J,KAAKyB,WAAW/K,KAAKmI,gBAAiB,YAAa,MACjD,IAAnB0C,EAAU1D,MAAc0D,EAAUvI,IAAI0H,GAC1C,CACkC,IAA7BhK,KAAK6H,2BAEHA,oBAAsBoC,SAAST,EAAa,SAE5CnI,EAAY,IAAIuB,EAAiB4G,EAAexJ,MACtD4K,EAAU5J,YAAYK,EAAU2J,qBAAqBhL,KAAKkI,SAE1D9G,KAAKpB,OAIPX,OAAKgL,SAASrK,KAAKmI,kBAChBnI,KAAKmI,gBAAL,aACAnI,KAAKmI,gBAAL,oBAA8C,QAG5C8C,qCAAoC,oDAIlB5E,EAAWC,GAGnC1G,GAAGqE,cAAcjE,KAAM,mBAAoB,CAACqG,EAAWC,gDAGpClG,QAEd6H,kBACLrI,GAAGqE,cAAc,4BAA6B7D,oDAGtBiG,EAAW6E,QAE9BjD,kBAELrI,GAAGqE,cACFjE,KACA,oBACA,CAACkL,sDAIuB1G,GAErBxE,KAAKgI,SAAWxD,SAKfwD,OAASxD,OACTyD,oEAGmB1B,GAExB3G,GAAGqE,cAAcjE,KAAM,0BAA2B,CAACA,KAAKwH,eACxDjB,EAAM,iBAAuBvG,KAAKwH,6DAGXhD,EAAetB,GAElClD,KAAKgI,SAAWxD,GAEnB5E,GAAGqE,cAAcjE,KAAM,2BAA4B,CAACwE,EAAetB,SAG/D+E,sEAKAA,0DAILrI,GAAGiE,eAAe7D,KAAK8B,qBAAsB,2BAA4B9B,KAAKqI,0BAC9EzI,GAAGiE,eAAe7D,KAAK8B,qBAAsB,2BAA4B9B,KAAKsI,0BAE9E1I,GAAGiE,eAAe7D,KAAM,kBAAmBA,KAAKmL,2BAChDvL,GAAGiE,eAAe7D,KAAM,iBAAkBA,KAAKoL,yBAAyBhK,KAAKpB,OAC7EJ,GAAGiE,eAAe7D,KAAM,kBAAmBA,KAAKqL,wBAAwBjK,KAAKpB,OAC7EJ,GAAGiE,eAAe7D,KAAM,oBAAqBA,KAAKsL,qBAAqBlK,KAAKpB,OAE5EJ,GAAGiE,eAAe7D,KAAM,oBAAqBA,KAAKuL,cAAcnK,KAAKpB,OACrEJ,GAAGiE,eAAe7D,KAAM,kBAAmBA,KAAKwL,oBAAoBpK,KAAKpB,OACzEJ,GAAGiE,eAAe7D,KAAM,yBAA0BA,KAAKyL,oBAAoBrK,KAAKpB,OAChFJ,GAAGiE,eAAe7D,KAAM,gCAAiCA,KAAK0L,qBAAqBtK,KAAKpB,+CAKxFJ,GAAG+L,sBAAsB3L,KAAM,mBAC/BJ,GAAG+L,sBAAsB3L,KAAM,kBAC/BJ,GAAG+L,sBAAsB3L,KAAM,mBAC/BJ,GAAG+L,sBAAsB3L,KAAM,qBAE/BJ,GAAG+L,sBAAsB3L,KAAM,oBAC/BJ,GAAG+L,sBAAsB3L,KAAM,qBAC/BJ,GAAG+L,sBAAsB3L,KAAM,mBAC/BJ,GAAG+L,sBAAsB3L,KAAM,0BAC/BJ,GAAG+L,sBAAsB3L,KAAM,iCAC/BJ,GAAG+L,sBAAsB3L,KAAM,sBAE/BJ,GAAG4G,kBAAkBxG,KAAK8B,qBAAsB,2BAA4B9B,KAAKqI,0BACjFzI,GAAG4G,kBAAkBxG,KAAK8B,qBAAsB,2BAA4B9B,KAAKsI,gEAGpE9H,GAEbA,EAAOwH,OAAUhI,KAAKiI,gBAAkB,qDAKnCrE,gDAKD5D,KAAKkI,YAEHA,KAAKtE,eACLsE,KAAO,4CAgBR,IAAI0D,UAVJ9D,aAAc,OACd4C,mBACAmB,qBACAtM,mBAAqB,UACrBuC,qBAAuB,KACxB9B,KAAK2H,uBAEHA,gBAAgB/D,eAChB+D,gBAAkB,MAEV3H,KAETA,KAAKgC,eAAe4J,WAEhB5L,KAAK4L,kDAKQjH,QAEjBkD,oBAAsBoC,SAAStF,2DAK7B3E,KAAK6H,8EAKNiE,EAAQ9L,KAAK+L,gCACXD,EAAQ,EAAMlH,EAAaC,oBAAsBiH,EAAS,2DAK9D/I,EAAW,KAETiJ,EAAkBhM,KAAKiM,qCACzB5M,OAAKC,eAAe0M,IAAoBhM,KAAKkI,OAEhDnF,EAAW/C,KAAKkI,KAAKgE,YAAYF,IAG3BjJ,qDAGmBwD,OAEpB4B,EAAkBvI,GAAG0J,KAAKK,UAAUpD,EAAQ,kBAAmB,IAC/D4F,EAAqBvM,GAAG0J,KAAKyB,WAAW5C,EAAiB,qBAAsB,GAC/EmC,EAAyB6B,EAAqB,EAC9CC,EAAcxM,GAAG0J,KAAKC,WAAWpB,EAAiB,eAAe,GACjEiC,EAAqBxK,GAAG0J,KAAKI,UAAUnD,EAAQ,qBAAsB,IACrE8F,EACL/B,KACK8B,GAAgBA,GAAeD,EAAqB,IACtD/B,EAAmBvD,OAAS,OAE3ByF,uBAAuBtM,KAAKyH,UAAW4E,+DAGTA,OAE7BtJ,EAAW/C,KAAKuM,4BAClBxJ,QAEEuJ,uBAAuBvJ,EAASyC,eAAgB6G,kDAIhC5E,EAAW4E,GAE7BhN,OAAK8J,UAAU1B,KAEd4E,GAAyC,SAA5B5E,EAAU9G,MAAMC,QAEhC6G,EAAU9G,MAAMC,QAAU,GAEjByL,GAAyC,KAA5B5E,EAAU9G,MAAMC,UAEtC6G,EAAU9G,MAAMC,QAAU,6EAO5BO,YAAW,eACJ4B,EAAWyJ,EAAKD,4BAClBxJ,GAEHA,EAASoB,OAAOW,KAAK2H,cACpB,IAAIC,WACH,QACA,CACCC,SAAS,EACTC,YAAY,OAKd,+CAGgBrG,QAEdgE,2BACJ,CACCH,mBAAoBxK,GAAG0J,KAAKI,UAAUnD,EAAQ,qBAAsB,IACpE4B,gBAAiBjG,UAAQC,MAAMnC,KAAKmI,gEAKlB5B,GAEhBlH,OAAK0C,cAAcwE,IAAWA,EAAOvE,eAAe,WAEvDuE,EAAM,MAAYvG,KAAK+L,+BAGnBc,sEArcDjI,wBAEwB"}