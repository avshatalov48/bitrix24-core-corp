(function(){var e='<svg xmlns="http://www.w3.org/2000/svg" width="13" height="19" viewBox="0 0 13 19"><path fill="#FFFFFF" fill-rule="evenodd" d="M251.355405,23.7267983 C253.038066,23.7266465 254.402051,22.3680746 254.402051,20.6922437 L254.402051,15.6218277 C254.402124,14.817039 254.081172,14.0451875 253.509807,13.4760902 C252.938442,12.9069929 252.163474,12.5872731 251.355405,12.5872731 C250.547289,12.5872002 249.77225,12.9068878 249.200826,13.475993 C248.629401,14.0450982 248.308411,14.8169914 248.308484,15.6218277 L248.308484,20.6925185 C248.308484,21.4973071 248.629507,22.2691297 249.200923,22.8381755 C249.77234,23.4072212 250.547337,23.7268712 251.355405,23.7267983 L251.355405,23.7267983 Z M245.107036,19.1004903 L245.107036,20.5644527 C245.105683,23.5323492 247.209461,26.0879428 250.131891,26.668464 L250.131891,28.7741294 C249.324768,29.0140467 248.414444,29.758807 248.414444,30.6404273 L254.295263,30.6404273 C254.295263,29.7585322 253.384663,29.0140467 252.577816,28.7741294 L252.577816,26.668464 C255.501098,26.0890873 257.60578,23.5329576 257.603775,20.5644527 L257.603775,19.1004903 C257.603775,18.2065032 256.876123,18.1111409 255.978492,18.1111409 L255.978492,20.5636282 C255.978492,23.1065253 253.908666,25.1679507 251.355405,25.1679507 C248.802145,25.1679507 246.732319,23.1065253 246.732319,20.5636282 L246.732319,18.1111409 C245.834688,18.1111409 245.107036,18.2065032 245.107036,19.1004903 Z" transform="translate(-245 -12)"/></svg>';var t="bx-crm-recorder-default-microphone";var i=function(e){if(!(e instanceof MediaStream))return;if(typeof e.getTracks==="undefined"){e.stop()}else{e.getTracks().forEach(function(e){e.stop()})}};var a={unsupported:"unsupported",deviceReady:"deviceReady",deviceListReady:"deviceListReady",deviceFailure:"deviceFailure",stateChanged:"stateChanged"};var r={idle:"idle",failure:"failure",recording:"recording",paused:"paused"};var o=(new Date).getTime();BX.CrmRecorder=function(t){var i=this;this.elements={main:t.element,container:null,canvas:null};this.callbacks={stop:n};this.state=r.idle;this.microphones={};this.defaultMicrophone=this.__getDefaultMicrophone();this.actualDeviceList=false;this.mediaStream=null;this.recorder=null;this.record=null;this.audioContext=null;this.analyserNode=null;this.mediaStreamNode=null;this.frequencyData=null;this.canvasContext=null;this.mic={image:new Image("data:image/svg+xml,"+e),loaded:false};this.mic.image.onload=function(){i.mic.loaded=true};this.mic.image.src=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}));this.init()};BX.CrmRecorder.prototype.start=function(){if(!BX.CrmRecorder.isSupported()){BX.onCustomEvent(this,a.unsupported,[]);return false}var e=this;var t=0;navigator.mediaDevices.enumerateDevices().then(function(i){i.forEach(function(i){if(i.kind!="audioinput")return;e.microphones[i.deviceId]=i.label;t++});if(t==0){BX.onCustomEvent(e,a.deviceFailure,{})}else{e.getMediaStream()}})};BX.CrmRecorder.prototype.pause=function(){if(this.recorder&&this.state===r.recording){this.recorder.pause();this.__setState(r.paused)}};BX.CrmRecorder.prototype.resume=function(){if(this.recorder&&this.state===r.paused){this.recorder.resume();this.__setState(r.recording)}};BX.CrmRecorder.prototype.stop=function(e){if(!this.recorder)return false;this.recorder.stop();i(this.mediaStream);if(BX.type.isFunction(e))this.callbacks.stop=e;else this.callbacks.stop=n};BX.CrmRecorder.prototype.init=function(){this.__createLayout();this.__bindEvents();this.elements.canvas.width=502;this.elements.canvas.height=43;this.canvasContext=this.elements.canvas.getContext("2d");this.canvasContext.imageSmoothingEnabled=false;this.canvasContext.mozImageSmoothingEnabled=false;this.canvasContext.webkitImageSmoothingEnabled=false};BX.CrmRecorder.prototype.getMediaStream=function(){var e=this;navigator.mediaDevices.getUserMedia(e.__getConstraints()).then(function(t){e.mediaStream=t;if(e.recorder){e.recorder.replaceStream(e.mediaStream)}else{e.recorder=new BX.Recorder(t);BX.addCustomEvent(e.recorder,"stop",e.__onRecorderStopped.bind(e));e.recorder.start()}e.__attachAnalyser();e.__visualize();e.__updateDeviceList();BX.onCustomEvent(e,a.deviceReady,[e])}).catch(function(t){BX.onCustomEvent(e,a.deviceFailure,[t])})};BX.CrmRecorder.prototype.changeMicrophone=function(e){this.defaultMicrophone=e;this.__setDefaultMicrophone(e);this.__detachAnalyser();i(this.mediaStream);this.mediaStream=null;this.getMediaStream()};BX.CrmRecorder.prototype.dispose=function(){if(this.analyserNode){this.analyserNode.disconnect();this.analyserNode=null}if(this.mediaStreamNode){this.mediaStreamNode.disconnect();this.analyserNode=null}if(this.audioContext){this.audioContext.close();this.audioContext=null}if(this.mediaStream){i(this.mediaStream);this.mediaStream=null}if(this.recorder){this.recorder.dispose();this.recorder=null}};BX.CrmRecorder.prototype.__setState=function(e){var t={oldState:this.state,newState:e};this.state=e;BX.onCustomEvent(this,a.stateChanged,[t])};BX.CrmRecorder.prototype.__createLayout=function(){this.elements.container=BX.create("div",{props:{className:"crm-recorder-analyser-container"},children:[this.elements.canvas=BX.create("canvas",{props:{className:"crm-recorder-analyser-canvas"}})]});this.elements.main.appendChild(this.elements.container)};BX.CrmRecorder.prototype.__bindEvents=function(){};BX.CrmRecorder.prototype.__visualize=function(){if(!this.analyserNode)return;window.requestAnimationFrame(this.__visualize.bind(this));var e=(new Date).getTime();if(e-o<50){return}o=e;this.analyserNode.getByteFrequencyData(this.frequencyData);var t=this.elements.canvas.width;var i=this.elements.canvas.height;var a=this.analyserNode.frequencyBinCount;this.canvasContext.clearRect(0,0,t,i);this.canvasContext.beginPath();var r=2;var n;var s=0;var c=Math.ceil(t/2);if(this.mic.loaded){this.canvasContext.drawImage(this.mic.image,c-5,13)}this.canvasContext.fillStyle="#afb2b7";for(var d=0;d<a;d++){n=Math.round(this.frequencyData[d]*i/256);if(n<3)n=3;s=c+17+(r+2)*d;this.canvasContext.fillRect(s,(i-n)/2,r,n);s=c-17-(r+2)*d;this.canvasContext.fillRect(s,(i-n)/2,r,n)}this.canvasContext.closePath()};BX.CrmRecorder.prototype.__getDefaultMicrophone=function(){return localStorage.getItem(t)||""};BX.CrmRecorder.prototype.__setDefaultMicrophone=function(e){localStorage.setItem(t,e)};BX.CrmRecorder.prototype.__getConstraints=function(){var e={audio:{},video:false};if(this.defaultMicrophone!=""){if(BX.browser.IsChrome()){e.audio.mandatory={sourceId:this.defaultMicrophone}}else{e.audio.deviceId={exact:this.defaultMicrophone}}}return e};BX.CrmRecorder.prototype.__attachAnalyser=function(){if(!this.mediaStream)return false;if(!this.audioContext)this.audioContext=new(window.AudioContext||window.webkitAudioContext);if(!this.analyserNode){this.analyserNode=this.audioContext.createAnalyser();this.analyserNode.fftSize=128;this.analyserNode.minDecibels=-80;this.analyserNode.maxDecibels=-10}if(!this.mediaStreamNode){this.mediaStreamNode=this.audioContext.createMediaStreamSource(this.mediaStream);this.mediaStreamNode.connect(this.analyserNode)}this.frequencyData=new Uint8Array(this.analyserNode.frequencyBinCount)};BX.CrmRecorder.prototype.__detachAnalyser=function(){if(this.mediaStreamNode){this.mediaStreamNode.disconnect();this.mediaStreamNode=null}};BX.CrmRecorder.prototype.__onRecorderStopped=function(e){this.record=e;this.callbacks.stop(e)};BX.CrmRecorder.prototype.__updateDeviceList=function(){var e=this;if(this.actualDeviceList)return;navigator.mediaDevices.enumerateDevices().then(function(t){t.forEach(function(t){if(t.kind!="audioinput")return;e.microphones[t.deviceId]=t.label})});BX.onCustomEvent(this,a.deviceListReady,[this.microphones]);this.actualDeviceList=true};BX.CrmRecorder.isSupported=function(){return BX.Recorder.isSupported()&&typeof window.Promise!=="undefined"&&typeof window.localStorage!=="undefined"};var n=function(){}})();
//# sourceMappingURL=recorder.map.js