(function(){"use strict";if(typeof webPacker==="undefined"){return}if(!window.BX){window.BX={}}else if(window.BX.SiteButton){return}var t=webPacker.classes;var e=webPacker.browser;var i=webPacker.type;var n={clickHandler:null,shadowNode:null,displayed:false,init:function(t){this.shadowNode=t.shadowNode;webPacker.addEventListener(this.shadowNode,"click",this.onClick.bind(this));webPacker.addEventListener(document,"keyup",function(t){if((t||window.e).keyCode===27)this.onClick()}.bind(this))},onClick:function(){if(!this.displayed){return}r.hide();o.hide();if(!this.clickHandler){return}this.clickHandler.apply(this,[]);this.clickHandler=null},show:function(e){this.clickHandler=e;t.add(this.shadowNode,"b24-widget-button-show");t.remove(this.shadowNode,"b24-widget-button-hide");h.saveScrollPos();t.add(document.documentElement,"crm-widget-button-mobile",true);this.displayed=true},hide:function(){if(this.displayed){t.add(this.shadowNode,"b24-widget-button-hide")}t.remove(this.shadowNode,"b24-widget-button-show");t.remove(document.documentElement,"crm-widget-button-mobile");h.restoreScrollPos();this.displayed=false}};var o={isShown:false,isInit:false,wasOnceShown:false,wasOnceClick:false,blankButtonNode:null,list:[],frozen:false,init:function(t){this.container=t.container;this.blankButtonNode=t.blankButtonNode;this.openerButtonNode=t.openerButtonNode;this.openerClassName=l.config.location>3?"b24-widget-button-bottom":"b24-widget-button-top";webPacker.addEventListener(this.openerButtonNode,"click",function(){if(this.frozen){this.unfreeze()}else{if(this.list.length===1&&this.list[0].onclick&&!this.list[0].href){this.list[0].onclick.apply(this,[])}else{this.toggle()}}}.bind(this));this.isInit=true;this.list.forEach(function(t){if(!t.node)this.insert(t)},this);s.restart()},getByType:function(t){var e=this.list.filter(function(e){return t===e.type},this);return e.length>0?e[0]:null},toggle:function(){this.isShown?this.hide():this.show()},show:function(){if(e.isIOS()){t.add(document.documentElement,"bx-ios-fix-frame-focus")}{n.show()}this.isShown=true;this.wasOnceShown=true;t.add(l.container,this.openerClassName);t.add(this.container,"b24-widget-button-show");t.remove(this.container,"b24-widget-button-hide");a.hide()},hide:function(){if(e.isIOS()){t.remove(document.documentElement,"bx-ios-fix-frame-focus")}this.isShown=false;t.add(this.container,"b24-widget-button-hide");t.remove(this.container,"b24-widget-button-show");t.remove(l.container,this.openerClassName);a.hide();n.hide()},freeze:function(t){this.hide();if(t){s.freeze(t)}this.frozen=true},unfreeze:function(){s.start();r.hide();this.hide();this.frozen=false},displayButton:function(t,e){this.list.forEach(function(i){if(i.id!==t)return;if(!i.node)return;i.node.style.display=e?"":"none"})},sortOut:function(){this.list.sort(function(t,e){return t.sort>e.sort?1:-1});this.list.forEach(function(t){if(!t.node)return;t.node.parentNode.appendChild(t.node)})},add:function(t){this.list.push(t);return this.insert(t)},insert:function(e){if(!this.isInit){e.node=null;return null}var i=this.blankButtonNode.cloneNode(true);e.node=i;e.sort=e.sort||100;i.setAttribute("data-b24-crm-button-widget",e.id);i.setAttribute("data-b24-widget-sort",e.sort);if(e.classList&&e.classList.length>0){e.classList.forEach(function(e){t.add(i,e)},this)}if(e.title){var n=i.querySelector("[data-b24-crm-button-tooltip]");if(n){n.innerText=e.title}else{i.title=e.title}}if(e.icon){i.style["background-image"]="url("+e.icon+")"}else{if(e.iconColor){setTimeout(function(){var t="background-image";if(!window.getComputedStyle){return}var n=window.getComputedStyle(i,null).getPropertyValue(t);i.style[t]=(n||"").replace("FFF",e.iconColor.substring(1))},1e3)}if(e.bgColor){i.style["background-color"]=e.bgColor}}if(e.href){i.href=e.href;i.target=e.target?e.target:"_blank"}if(e.onclick){webPacker.addEventListener(i,"click",function(){this.wasOnceClick=true;e.onclick.apply(this,[])}.bind(this))}this.container.appendChild(i);this.sortOut();s.restart();return i}};var s={isInit:false,timer:null,timerPeriod:1500,icons:[],pulsar:null,stop:function(){this.rotate(false).pulse(false)},freeze:function(t){this.rotate(t).pulse(false)},start:function(){this.rotate().pulse(true)},rotate:function(e){this.init();if(this.timer)clearTimeout(this.timer);if(e===false){return this}var i="b24-widget-button-icon-animation";var n=0;var o=this.icons.filter(function(t){return!t.hidden});o.forEach(function(e,o){if(t.has(e.node,i))n=o;t.remove(e.node,i)},this);var s;if(e&&!(s=o.filter(function(t){return t.type===e})[0])){throw new Error("Animation.rotate: Unknown type `"+e+"`")}if(!s&&!(s=o.concat(this.icons).slice(n+1)[0])){return this}t.add(s.node,i);if(!e&&o.length>1){this.timer=setTimeout(this.rotate.bind(this),this.timerPeriod)}return this},pulse:function(e){t.change(this.pulsar,"b24-widget-button-pulse-animate",e);return this},restart:function(){this.isInit=false;this.start()},init:function(){if(this.isInit){return this}var t="data-b24-crm-button-icon";this.icons=i.toArray(l.context.querySelectorAll("["+t+"]")).map(function(e){var i=e.getAttribute(t);var n=!o.getByType(i);e.style.display=n?"none":"";return{node:e,type:i,hidden:n}},this).filter(function(t){return!t.hidden},this);this.pulsar=l.context.querySelector("[data-b24-crm-button-pulse]");this.isInit=true;return this}};var r={showedWidget:null,loadedCount:0,getList:function(){return l.config.widgets.filter(function(t){return t.isLoaded},this)},getById:function(t){var e=l.config.widgets.filter(function(e){return t===e.id&&e.isLoaded},this);return e.length>0?e[0]:null},hide:function(){if(!this.showedWidget){return}var t=this.showedWidget;this.showedWidget=null;if(t.hide){c.evalGlobal(t.hide)}l.show();n.hide()},show:function(t){this.storeTrace(t);if(!t.show||!i.isString(t.show)){return}this.showedWidget=t;if(!t.freeze){n.show()}c.evalGlobal(t.show);if(t.freeze){l.freeze(t.type)}else{l.hide()}},storeTrace:function(t){if(!t||!t.tracking||!t.tracking.detecting){return}t.tracking.detecting=false;var e=l.getTrace({channels:[t.tracking.channel]});l.b24Tracker.guest.storeTrace(e)},showById:function(t){var e=this.getById(t);if(e){this.show(e)}},checkAll:function(){return l.config.widgets.some(this.check,this)},check:function(t){return this.checkPages(t)&&this.checkWorkTime(t)},checkPagesAll:function(){return l.config.widgets.some(this.checkPages,this)},checkPages:function(t){var e=c.isCurPageInList(t.pages.list);if(t.pages.mode==="EXCLUDE"){return!e}else{return e}},checkWorkTimeAll:function(){return l.config.widgets.some(this.checkWorkTime,this)},checkWorkTime:function(t){if(!t.workTime){t.isWorkTimeNow=true;t.isWorkTimeChecked=true}if(t.isWorkTimeChecked){return t.isWorkTimeNow}var e=t.workTime;var i=new Date;if(l.config.serverTimeStamp){i=new Date(l.config.serverTimeStamp)}var n=e.timeZoneOffset+i.getTimezoneOffset();i=new Date(i.valueOf()+n*6e4);var o=i.getMinutes();o=o>=10?o:"0"+o;var s=parseFloat(i.getHours()+"."+o);var r=true;if(e.dayOff){var a=i.getDay();if(e.dayOff.some(function(t){return t===a})){r=false}}if(r&&e.holidays){var c=(i.getMonth()+1).toString();c=(c.length===1?"0":"")+c;c=i.getDate()+"."+c;if(e.holidays.some(function(t){return t===c})){r=false}}if(r){var h=e.timeTo<e.timeFrom;if(h){if(s>e.timeTo&&s<e.timeFrom){r=false}}else{if(s<e.timeFrom||s>e.timeTo){r=false}}}t.isWorkTimeChecked=true;t.isWorkTimeActionRule=false;if(!r&&!!e.actionRule){r=true;t.isWorkTimeActionRule=true}t.isWorkTimeNow=r;return r},loadAll:function(){l.config.widgets.forEach(this.load,this)},load:function(t){t.isLoaded=false;l.execEventHandler("load-widget-"+t.id,[t]);if(!this.check(t)){return}if(t.workTime&&t.isWorkTimeActionRule){switch(t.workTime.actionRule){case"text":if(t.type==="callback"){l.addEventHandler("form-init",function(e){if(!e.isCallbackForm)return;window.Bitrix24FormLoader.addEventHandler(e,"init-frame-params",function(e,i){i.resultSuccessText=t.workTime.actionText;i.stopCallBack=true})})}break}}t.buttonNode=o.add({id:t.id,type:t.type,href:this.getButtonUrl(t),sort:t.sort,classList:typeof t.classList!=="undefined"?t.classList:null,title:typeof t.title!=="undefined"?t.title:null,onclick:this.show.bind(this,t),bgColor:t.useColors?l.config.bgColor:null,iconColor:t.useColors?l.config.iconColor:null});this.loadScript(t);t.isLoaded=true;this.loadedCount++},getButtonUrl:function(t){if(t.script||!t.show){return null}if(i.isString(t.show)||!t.show.url){return null}var n=null;if(e.isMobile()&&t.show.url.mobile){n=t.show.url.mobile}else if(!e.isMobile()&&t.show.url.desktop){n=t.show.url.desktop}else if(i.isString(t.show.url)){n=t.show.url}return n},loadScript:function(t){if(!t.script){return}var e="";var i=false;var n=t.script.match(/<script\b[^>]*>(.*?)<\/script>/i);if(n&&n[1]){e=n[1];i=true}else if(!t.freeze){t.node=c.getNodeFromText(t.script);if(!t.node){return}i=false;if(typeof t.caption!=="undefined"){var o=t.node.querySelector("[data-bx-crm-widget-caption]");if(o){o.innerText=t.caption}}}else{e=t.script;i=true}if(i){t.node=document.createElement("script");try{t.node.appendChild(document.createTextNode(e))}catch(i){t.node.text=e}document.head.appendChild(t.node)}else{document.body.insertBefore(t.node,document.body.firstChild)}}};var a={isInit:false,wasOnceShown:false,condition:null,cookieName:"b24_sitebutton_hello",init:function(t){if(this.isInit){return}this.context=t.context;this.showClassName="b24-widget-button-popup-show";this.config=l.config.hello||{};this.delay=this.config.delay;this.buttonHideNode=this.context.querySelector("[data-b24-hello-btn-hide]");this.iconNode=this.context.querySelector("[data-b24-hello-icon]");this.nameNode=this.context.querySelector("[data-b24-hello-name]");this.textNode=this.context.querySelector("[data-b24-hello-text]");this.initHandlers();this.isInit=true;if(webPacker.cookie.get(this.cookieName)==="y"){return}if(!this.config||!this.config.conditions||this.config.conditions.length===0){return}if(!this.condition){this.setConditions(this.config.conditions,true)}l.addEventHandler("first-show",this.initCondition.bind(this))},setConditions:function(t,e){this.condition=this.findCondition(t);if(!e){this.initCondition()}},initCondition:function(){if(!this.condition){return}if(!this.isInit){return}if(this.condition.icon){this.iconNode.style["background-image"]="url("+this.condition.icon+")"}if(this.condition.name){this.nameNode.innerText=this.condition.name}if(this.condition.text){this.textNode.innerText=this.condition.text}if(this.condition.delay){this.delay=this.condition.delay}this.planShowing()},initHandlers:function(){webPacker.addEventListener(this.buttonHideNode,"click",function(t){this.hide();if(!t)t=window.event;if(t.stopPropagation){t.preventDefault();t.stopPropagation()}else{t.cancelBubble=true;t.returnValue=false}}.bind(this));webPacker.addEventListener(this.context,"click",this.showWidget.bind(this))},planShowing:function(){if(this.wasOnceShown||o.wasOnceClick){return}setTimeout(this.show.bind(this),(this.delay||10)*1e3)},findCondition:function(t){if(!t){return}var e;e=t.filter(function(t){if(!t.pages||t.pages.MODE==="EXCLUDE"||t.pages.LIST.length===0){return false}return c.isCurPageInList(t.pages.LIST)},this);if(e.length>0){return e[0]}e=t.filter(function(t){if(!t.pages||t.pages.MODE==="INCLUDE"){return false}return!c.isCurPageInList(t.pages.LIST)},this);if(e.length>0){return e[0]}e=t.filter(function(t){return!t.pages},this);if(e.length>0){return e[0]}return null},showWidget:function(){this.hide();var t=null;if(this.condition&&this.condition.showWidgetId){t=r.getById(this.condition.showWidgetId)}if(!t){t=r.getById(this.config.showWidgetId)}if(!t){var e=r.getList();if(e.length>0){t=e[0]}}if(t){r.show(t)}},showImmediately:function(t){t=t||null;if(t){this.setConditions([{icon:t.icon,name:t.name,text:t.text,page:"",delay:0}])}this.show(true)},show:function(e){if(!this.condition){return}e=e||false;if(!e&&o.isShown){this.planShowing();return}this.wasOnceShown=true;t.add(this.context,this.showClassName)},hide:function(){t.remove(this.context,this.showClassName);webPacker.cookie.set(this.cookieName,"y",60*60*6)}};var c={getNodeFromText:function(t){var e=document.createElement("div");e.innerHTML=t;return e.children[0]},evalGlobal:function(t){webPacker.resource.loadJs(t,false,true)},isCurPageInList:function(t){var e=t.filter(function(t){t=encodeURI(t);var e=this.prepareUrl(t).split("*").map(function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}).join(".*");e="^"+e+"$";return new RegExp(e).test(this.prepareUrl(window.location.href))},this);return e.length>0},prepareUrl:function(t){var e;if(t.substring(0,5)==="http:"){e=t.substring(7)}else if(t.substring(0,6)==="https:"){e=t.substring(8)}else{e=t}return e}};var h={scrollPos:0,saveScrollPos:function(){this.scrollPos=window.pageYOffset},restoreScrollPos:function(){if(!e.isMobile()){return}window.scrollTo(0,this.scrollPos)}};var l=window.BX.SiteButton={buttons:o,animation:s,shadow:n,wm:r,hello:a,util:c,classes:t,hacks:h,isShown:false,init:function(t){this.b24Tracker=window.b24Tracker||{};this.userParams=window.Bitrix24WidgetObject||{};this.config=t;this.handlers=this.userParams.handlers||{};this.eventHandlers=[];this.execEventHandler("init",[this]);if(!this.check()){return}this.load();if(this.config.delay){window.setTimeout(this.show.bind(this),1e3*this.config.delay)}else{this.show()}},check:function(){if(!this.config.isActivated){return false}if(this.config.widgets.length===0){return false}if(this.config.disableOnMobile&&e.isMobile()){return false}return r.checkAll()},loadResources:function(){},load:function(){this.execEventHandler("load",[this]);e.isIOS()?t.add(document.documentElement,"bx-ios"):null;e.isMobile()?t.add(document.documentElement,"bx-touch"):null;this.loadResources();this.container=document.body.querySelector("[data-b24-crm-button-cont]");this.context=this.container.parentNode;this.shadow.init({shadowNode:this.context.querySelector("[data-b24-crm-button-shadow]")});this.buttons.init({container:this.container.querySelector("[data-b24-crm-button-block]"),blankButtonNode:this.context.querySelector("[data-b24-crm-button-widget-blank]"),openerButtonNode:this.context.querySelector("[data-b24-crm-button-block-button]")});this.hello.init({context:this.container.querySelector("[data-b24-crm-hello-cont]")});this.wm.loadAll();this.execEventHandler("loaded",[this])},show:function(){t.remove(this.container,"b24-widget-button-disable");t.add(this.container,"b24-widget-button-visible");this.execEventHandler("show",[this]);if(!this.isShown){this.execEventHandler("first-show",[this])}this.isShown=true},hide:function(){t.add(this.container,"b24-widget-button-disable");this.execEventHandler("hide",[this])},freeze:function(t){setTimeout(function(){o.freeze(t);this.show()}.bind(this))},addEventHandler:function(t,e){if(!t||!e){return}this.eventHandlers.push({eventName:t,handler:e})},execEventHandler:function(t,e){e=e||[];if(!t){return}this.eventHandlers.forEach(function(i){if(i.eventName===t){i.handler.apply(this,e)}},this);if(this.handlers[t]){this.handlers[t].apply(this,e)}var i="b24-sitebutton-"+t;if(window.BX.onCustomEvent){window.BX.onCustomEvent(document,i,e)}if(window.jQuery&&typeof window.jQuery==="function"){var n=window.jQuery(document);if(n&&n.trigger)n.trigger(i,e)}},onWidgetFormInit:function(t){this.execEventHandler("form-init",[t])},onWidgetClose:function(){o.unfreeze();this.show()},getTrace:function(t){if(!this.b24Tracker.guest){return null}t=t||{};t.channels=t.channels||[];t.channels=[this.config.tracking.channel].concat(t.channels);return this.b24Tracker.guest.getTrace(t)}}})();
//# sourceMappingURL=script.map.js