this.BX=this.BX||{};(function(e,t,s){"use strict";const i="client";var a=babelHelpers.classPrivateFieldLooseKey("multiple");var o=babelHelpers.classPrivateFieldLooseKey("getEntityAvatarPath");var r=babelHelpers.classPrivateFieldLooseKey("prepareEvents");class l{static createFromCommunications({targetNode:e,context:t=null,communications:s,multiple:i=false,selected:a=[],events:o={}}){const r=new l({targetNode:e,multiple:i,context:t,events:o});r.items=r.getPhoneSelectorItems(s);r.setSelected(a);return r}static createFromItems({targetNode:e,context:t=null,items:s,multiple:i=false,selected:a=[],events:o={}}){const r=new l({targetNode:e,multiple:i,context:t,events:o});r.items=r.prepareItems(s);r.setSelected(a);return r}constructor({targetNode:e,multiple:s=false,context:i=null,events:l={}}){Object.defineProperty(this,r,{value:c});Object.defineProperty(this,o,{value:n});this.items=[];this.events={};Object.defineProperty(this,a,{writable:true,value:false});this.targetNode=e;babelHelpers.classPrivateFieldLooseBase(this,a)[a]=s;this.context=t.Type.isStringFilled(i)?i:`crm-client-selector-${t.Text.getRandom()}`;this.events=t.Type.isObjectLike(l)?l:{}}setSelected(e){this.items.forEach((t=>t.selected=e.includes(t.id)));return this}setSelectedItemByEntityData(e,t){this.items.forEach((s=>{if(s.customData.entityId===e&&s.customData.entityTypeId===t){s.selected=true}}));return this}getPhoneSelectorItems(e){const t=[];e.forEach((e=>{const{phones:s,entityTypeName:a,entityId:r,entityTypeId:l,caption:n}=e;if(!Array.isArray(s)){return}s.forEach((e=>{const{id:s,valueFormatted:c,typeLabel:d}=e;t.push({id:s,title:n,subtitle:`${c}, ${d}`,entityId:i,tabs:i,avatar:babelHelpers.classPrivateFieldLooseBase(this,o)[o](a),customData:{entityId:r,entityTypeId:l}})}))}));return t}prepareItems(e){return e.map((e=>{var t;e.entityId=i;e.tabs=i;if((t=e.customData)!=null&&t.entityTypeId&&!e.avatar){var s;const{entityTypeId:t}=e.customData;e.avatar=(s=e.avatar)!=null?s:babelHelpers.classPrivateFieldLooseBase(this,o)[o](BX.CrmEntityType.resolveName(t))}return e}))}show(){const{targetNode:e,context:o,items:l}=this;const n=babelHelpers.classPrivateFieldLooseBase(this,r)[r]();const c=[{id:i,title:t.Loc.getMessage("CRM_CLIENT_SELECTOR_TAB_TITLE")}];this.clientSelectorDialog=new s.Dialog({targetNode:e,id:"client-phone-selector-dialog",context:o,multiple:babelHelpers.classPrivateFieldLooseBase(this,a)[a],dropdownMode:true,showAvatars:true,enableSearch:true,width:450,zIndex:2500,items:l,tabs:c,events:n});this.clientSelectorDialog.show()}hide(){if(this.isOpen()){this.clientSelectorDialog.hide()}}isOpen(){return this.clientSelectorDialog&&this.clientSelectorDialog.isOpen()}}function n(e){e=e.toLowerCase();const t=["contact","company","lead"];if(!t.includes(e)){return""}return`/bitrix/images/crm/entity_provider_icons/${e}.svg`}function c(){const{events:{onSelect:e,onDeselect:t,onHide:s,onShow:i}}=this;const a={};if(e){a["Item:onSelect"]=e}if(t){a["Item:onDeselect"]=t}if(s){a.onHide=s}if(i){a.onShow=i}return a}e.ClientSelector=l})(this.BX.Crm=this.BX.Crm||{},BX,BX.UI.EntitySelector);
//# sourceMappingURL=client-selector.bundle.map.js