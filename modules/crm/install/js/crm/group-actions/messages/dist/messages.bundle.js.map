{"version":3,"file":"messages.bundle.js","sources":["../src/http.js","../src/settings-creator.js","../src/components/sms-editor-wrapper.js","../src/template-catalog-creator.js","../src/messages.js"],"sourcesContent":["import { DEFAULT_PROVIDER } from './messages';\nimport { ajax } from 'main.core';\n\nexport interface Templates\n{\n\tFILLED_PLACEHOLDERS: any[];\n\tHEADER: string;\n\tID: string; // json encoded string with template settings\n\tORIGINAL_ID: number;\n\tPLACEHOLDERS: {[string]: string[]};\n\tPREVIEW: string;\n\tTITLE: string;\n}\n\nexport interface FromListItem {\n\tid: string;\n\tname: string;\n\tchannelPhone: string;\n\tisDefault: number;\n}\n\nexport interface ProviderConfig {\n\tid: string;\n\tname: string;\n\tcanUse: boolean;\n\tfromList: FromListItem[]\n}\n\nexport async function fetchTemplates(entityTypeId: number, entityCategoryId: ?number): Promise<Templates[]>\n{\n\tconst resp = await BX.ajax.runAction(\n\t\t'crm.activity.sms.getTemplates',\n\t\t{\n\t\t\tdata: {\n\t\t\t\tsenderId: DEFAULT_PROVIDER,\n\t\t\t\tcontext: {\n\t\t\t\t\tmodule: 'crm',\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tentityCategoryId,\n\t\t\t\t\tentityId: null,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t);\n\n\treturn resp.data.templates;\n}\n\nexport async function fetchSmsProvidersConfig(): Promise<ProviderConfig[]>\n{\n\tconst resp = await ajax.runAction(\n\t\t'crm.api.messagesender.providersConfig',\n\t\t{ data: { providerName: DEFAULT_PROVIDER } },\n\t);\n\n\treturn resp.data || [];\n}\n","import { BaseEvent } from 'main.core.events';\nimport { Loc } from 'main.core';\nimport type { MenuItemOptions, Menu, MenuItem } from 'main.popup';\nimport { MenuManager } from 'main.popup';\nimport { fetchSmsProvidersConfig, FromListItem, ProviderConfig } from './http';\nimport { DEFAULT_PROVIDER } from './messages';\n\n/**\n * Currently only 'ednaru' provider is supported. To extend must implement select provider logic\n */\nexport class SettingsCreator\n{\n\t#instance: Menu = null;\n\n\t#currentFromNumberId: ?string = null;\n\n\t#rawProviders: ProviderConfig[] = [];\n\n\tconstructor(currentFromNumber: ?string)\n\t{\n\t\tthis.#currentFromNumberId = currentFromNumber;\n\t}\n\n\tasync create(): Promise<Menu>\n\t{\n\t\tthis.#rawProviders = await fetchSmsProvidersConfig();\n\n\t\tif (this.#currentFromNumberId === null)\n\t\t{\n\t\t\tthis.#currentFromNumberId = this.#getEdnaProviderFromRaw(this.#rawProviders).fromList[0].id;\n\t\t}\n\n\t\tconst menuId = 'crm-whatsapp-channels-settings-menu';\n\n\t\tthis.#instance = MenuManager.create({\n\t\t\tid: menuId,\n\t\t\tbindElement: document.querySelector('.bx-crm-group-actions-messages-settings-icon'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t\ttext: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_SETTINGS'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'channelSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_SENDER_SELECTOR'),\n\t\t\t\t\titems: this.#createProvidersMenu(this.#rawProviders),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'phoneSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_NUMBER_SELECTOR'),\n\t\t\t\t\titems: this.#createFromNumberMenus(\n\t\t\t\t\t\tthis.#getEdnaProviderFromRaw(this.#rawProviders).fromList,\n\t\t\t\t\t\tthis.#currentFromNumberId,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\treturn this.#instance;\n\t}\n\n\t#getEdnaProviderFromRaw(rawProviders: ProviderConfig[]): ProviderConfig\n\t{\n\t\tif (this.#rawProviders.length !== 1 && rawProviders[0].id !== DEFAULT_PROVIDER)\n\t\t{\n\t\t\tthrow new Error(`Currently only ${DEFAULT_PROVIDER} is supported.`);\n\t\t}\n\n\t\treturn this.#rawProviders[0];\n\t}\n\n\t#createProvidersMenu(providers: ProviderConfig[]): MenuItemOptions[]\n\t{\n\t\tconst ednaProvider = this.#getEdnaProviderFromRaw(providers);\n\n\t\treturn [{\n\t\t\tid: ednaProvider.id,\n\t\t\ttitle: ednaProvider.name,\n\t\t\ttext: ednaProvider.name,\n\t\t\tdisabled: true,\n\t\t\tclassName: 'menu-popup-item-accept',\n\t\t}];\n\t}\n\n\t#createFromNumberMenus(fromList: FromListItem[], currentFromNumber: string): MenuItemOptions[]\n\t{\n\t\treturn fromList.map((fromNumber) => {\n\t\t\tconst className = fromNumber.id === currentFromNumber ? 'menu-popup-item-accept' : 'menu-popup-item-none';\n\n\t\t\treturn {\n\t\t\t\tid: fromNumber.id,\n\t\t\t\ttitle: fromNumber.name,\n\t\t\t\ttext: fromNumber.name,\n\t\t\t\tonclick: this.#onFromNumbersChange.bind(this),\n\t\t\t\tclassName,\n\t\t\t};\n\t\t});\n\t}\n\n\t#onFromNumbersChange(event: BaseEvent, fromMenu: MenuItem)\n\t{\n\t\tconst selectedChannelPhone = fromMenu.id;\n\n\t\tBX.Event.EventEmitter.emit('BX.Crm.GroupActionsWhatsApp.FromPhoneSelected', { phone: selectedChannelPhone });\n\t\tthis.#instance.close();\n\t}\n}\n","import { ajax as Ajax, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loc } from 'main.core';\n\nlet editorInstance = null;\n\nexport function createOrUpdatePlaceholder(\n\ttemplateId: number,\n\tentityTypeId: number,\n\tentityCategoryId: ?number,\n\tparams: Object,\n): void\n{\n\tconst { id, value, entityType, text } = params;\n\n\tAjax.runAction(\n\t\t'crm.activity.smsplaceholder.createOrUpdatePlaceholder',\n\t\t{\n\t\t\tdata: {\n\t\t\t\tplaceholderId: id,\n\t\t\t\tfieldName: Type.isStringFilled(value) ? value : null,\n\t\t\t\tentityType: Type.isStringFilled(entityType) ? entityType : null,\n\t\t\t\tfieldValue: Type.isStringFilled(text) ? text : null,\n\t\t\t\ttemplateId,\n\t\t\t\tentityTypeId,\n\t\t\t\tentityCategoryId,\n\t\t\t},\n\t\t},\n\t);\n}\n\nexport const SmsEditorWrapper = {\n\tname: 'SmsEditorWrapper',\n\tprops: {\n\t\ttemplateParam: Object,\n\t\ttitle: String,\n\t\tentityTypeId: Number,\n\t\tcategoryId: Number,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tcounter: 0,\n\t\t\teditorInstance: null,\n\t\t\tmessages: {\n\t\t\t\tsend: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_SEND'),\n\t\t\t},\n\t\t};\n\t},\n\tmethods: {\n\t\tonSend()\n\t\t{\n\t\t\tif (!editorInstance)\n\t\t\t{\n\t\t\t\tconsole.error('SmsEditorWrapper: editorInstance is null');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet text = '';\n\t\t\tif (editorInstance)\n\t\t\t{\n\t\t\t\tconst tplEditorData = editorInstance.getData();\n\t\t\t\tif (Type.isPlainObject(tplEditorData))\n\t\t\t\t{\n\t\t\t\t\ttext = tplEditorData.body;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (text === '')\n\t\t\t{\n\t\t\t\ttext = this.templateParam.PREVIEW;\n\t\t\t}\n\n\t\t\tconst templateId = this.templateParam.ID;\n\n\t\t\tEventEmitter.emit('BX.Crm.SmsEditorWrapper:click', { text, templateId });\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tconst editorParams = {\n\t\t\ttarget: this.$refs.editorContainerEl,\n\t\t\tcategoryId: this.categoryId,\n\t\t\tentityId: 0,\n\t\t\tentityTypeId: this.entityTypeId,\n\t\t\tonSelect: (params) => { // this callback is called when templates placeholder is changed\n\t\t\t\tcreateOrUpdatePlaceholder(\n\t\t\t\t\tthis.templateParam.ORIGINAL_ID,\n\t\t\t\t\tthis.entityTypeId,\n\t\t\t\t\tthis.categoryId,\n\t\t\t\t\t{\n\t\t\t\t\t\tid: params.id,\n\t\t\t\t\t\tvalue: params.value,\n\t\t\t\t\t\tentityType: params.entityType,\n\t\t\t\t\t\ttext: params.text,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t\tconst preview = this.templateParam.PREVIEW;\n\t\tconst placeholders = this.templateParam.PLACEHOLDERS || {};\n\t\tconst filledPlaceholders = this.templateParam.FILLED_PLACEHOLDERS || [];\n\n\t\teditorInstance = (new BX.Crm.Template.Editor(editorParams))\n\t\t\t.setPlaceholders(placeholders)\n\t\t\t.setFilledPlaceholders(filledPlaceholders)\n\t\t;\n\n\t\teditorInstance.setBody(preview);\n\t},\n\tunmounted()\n\t{\n\t\teditorInstance = null;\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-crm-group-actions-messages__item\">\n\t\t\t<div class=\"bx-crm-group-actions-messages__item-title\">{{ title }}</div>\n\t\t\t<div class=\"bx-crm-group-actions-messages__editor\" ref=\"editorContainerEl\"></div>\n\n\t\t\t<button\n\t\t\t\t@click=\"onSend\"\n\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-md bx-crm-group-actions-messages__button\"\n\t\t\t>{{ messages.send }}</button>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { EntityCatalog } from 'ui.entity-catalog';\nimport { fetchTemplates, Templates } from './http';\nimport { SmsEditorWrapper } from './components/sms-editor-wrapper';\n\nexport class TemplateCatalogCreator\n{\n\t#messages = {\n\t\tstartConversation: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_START'),\n\t\tsendFirst: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_FIRST'),\n\t\thowItWork: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_HOW'),\n\t\tlearnCompliance: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_COMPLIANCE'),\n\t\tlearnMore: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_MORE'),\n\t};\n\n\tasync create(entityTypeId: number, categoryId: ?number): Promise<EntityCatalog>\n\t{\n\t\tconst rawTemplates = await fetchTemplates(entityTypeId, categoryId);\n\n\t\tconst itemsData = this.#getTemplateItems(entityTypeId, categoryId, rawTemplates);\n\n\t\tconst itemSlot = this.#itemSlot();\n\n\t\treturn new EntityCatalog({\n\t\t\tcanDeselectGroups: false,\n\t\t\tshowEmptyGroups: false,\n\t\t\tcustomComponents: {\n\t\t\t\tSmsEditorWrapper,\n\t\t\t},\n\t\t\tslots: {\n\t\t\t\t[EntityCatalog.SLOT_MAIN_CONTENT_ITEM]: itemSlot,\n\t\t\t\t[EntityCatalog.SLOT_MAIN_CONTENT_HEADER]: this.#catalogHeader(),\n\t\t\t\t[EntityCatalog.SLOT_MAIN_CONTENT_FOOTER]: this.#catalogFooter(),\n\t\t\t},\n\t\t\tgroups: itemsData.groups,\n\t\t\titems: itemsData.templateItems,\n\t\t\ttitle: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_POPUP_TITLE'),\n\t\t\tpopupOptions: {\n\t\t\t\toverlay: true,\n\t\t\t},\n\t\t});\n\t}\n\n\t#itemSlot(): string\n\t{\n\t\treturn `\n\t\t\t<div>\n\t\t\t\t<SmsEditorWrapper  \n\t\t\t\t\t:templateParam=\"itemSlotProps.itemData.customData\"\n\t\t\t\t\t:title=\"itemSlotProps.itemData.title\" \n\t\t\t\t\t:entityTypeId=\"itemSlotProps.itemData.entityTypeId\"\n\t\t\t\t\t:categoryId=\"itemSlotProps.itemData.categoryId\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTemplateItems(entityTypeId: number, categoryId: ?number, templates: Templates[])\n\t{\n\t\tconst groups = templates.map((template) => {\n\t\t\treturn {\n\t\t\t\tid: template.ID,\n\t\t\t\tname: template.TITLE,\n\t\t\t};\n\t\t});\n\n\t\tif (groups.length > 0)\n\t\t{\n\t\t\tgroups[0].selected = true;\n\t\t}\n\n\t\tconst templateItems = templates.map((template) => {\n\t\t\treturn {\n\t\t\t\tid: template.ORIGINAL_ID,\n\t\t\t\ttitle: template.TITLE,\n\t\t\t\tentityTypeId,\n\t\t\t\tcategoryId,\n\t\t\t\tgroupIds: [template.ID],\n\t\t\t\tcustomData: {\n\t\t\t\t\ttitle: template.TITLE,\n\t\t\t\t\tFILLED_PLACEHOLDERS: template.FILLED_PLACEHOLDERS || [],\n\t\t\t\t\t...template,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\treturn {\n\t\t\tgroups,\n\t\t\ttemplateItems,\n\t\t};\n\t}\n\n\t#catalogHeader()\n\t{\n\t\treturn `\n\t\t\t<div class=\"bx-crm-group-actions-messages-tpl-header\">\n\t\t\t\t<div class=\"bx-crm-group-actions-messages-tpl-header-left\">\n\t\t\t\t\t<div class=\"bx-crm-group-actions-messages-whatsapp-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-crm-group-actions-messages-tpl-header-center\">\n\t\t\t\t\t<strong \n\t\t\t\t\t\tclass=\"bx-crm-group-actions-messages-tpl-header-center-title\"\n\t\t\t\t\t>${this.#messages.startConversation}</strong><br>\n\t\t\t\t\t<span class=\"bx-crm-group-actions-messages-tpl-header_gray\">${this.#messages.sendFirst}</span><br>\n\t\t\t\t\t<a \n\t\t\t\t\t\t\thref=\"#\" \n\t\t\t\t\t\t\tonclick=\"BX.Event.EventEmitter.emit('BX.Crm.GroupActionsWhatsApp.Settings:help', { code: 20526810});\"\n\t\t\t\t\t\t>${this.#messages.howItWork}</a>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-crm-group-actions-messages-tpl-header-right\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"bx-crm-group-actions-messages-settings-icon\"\n\t\t\t\t\t\tonclick=\"BX.Event.EventEmitter.emit('BX.Crm.GroupActionsWhatsApp.Settings:click');\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#catalogFooter()\n\t{\n\t\treturn `\n\t\t\t<div class=\"bx-crm-group-actions-messages-compliance\">\n\t\t\t\t${this.#messages.learnCompliance}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import './css/messages.css';\nimport { Loc, Reflection } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Menu } from 'main.popup';\nimport { EntityCatalog } from 'ui.entity-catalog';\nimport { BatchWhatsappMessageManager, ProcessRegistry, type ProgressBarRepository } from 'crm.autorun';\nimport { UI } from 'ui.notification';\nimport { SettingsCreator } from './settings-creator';\nimport { TemplateCatalogCreator } from './template-catalog-creator';\nimport 'ui.design-tokens';\n\ninterface Options {\n\tgridId: string;\n\tentityTypeId: number;\n\tselectedIds: number[];\n\tcategoryId: ?number;\n\tforAll: boolean;\n}\n\nexport const DEFAULT_PROVIDER = 'ednaru';\n\nconst SELECTED_FROM_NUMBER_LOCALSTORE_KEY = 'bx.crm.group_actions.messages.selected_from_number';\n\nexport class Messages\n{\n\tstatic #instance: Messages = null;\n\n\t#options: Options;\n\n\t#progressBarRepo: ProgressBarRepository;\n\n\t#catalog: EntityCatalog;\n\n\t#settingsMenu: ?Menu = null;\n\n\t#selectedFromNumber: ?string = null;\n\n\t#messages = {\n\t\tinProgress: Loc.getMessage('CRM_GROUP_ACTIONS_WHATSAPP_MESSAGE_IN_PROGRESS'),\n\t};\n\n\tstatic getInstance(progressBarRepo: ProgressBarRepository, options: Options): Messages\n\t{\n\t\tif (Messages.#instance)\n\t\t{\n\t\t\tMessages.#instance.setOptions(options);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tMessages.#instance = new Messages(progressBarRepo, options);\n\t\t}\n\n\t\treturn Messages.#instance;\n\t}\n\n\tconstructor(progressBarRepo: ProgressBarRepository, options: Options)\n\t{\n\t\tthis.#progressBarRepo = progressBarRepo;\n\t\tthis.#options = options;\n\t\tthis.#selectedFromNumber = this.#restoreLastSelectedFromNumber();\n\t}\n\n\tsetOptions(options: Options)\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tasync execute()\n\t{\n\t\tEventEmitter.subscribeOnce('BX.Crm.SmsEditorWrapper:click', this.#sendMessages.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.GroupActionsWhatsApp.FromPhoneSelected', this.#fromPhoneSelected.bind(this));\n\n\t\tthis.#showGridLoader();\n\n\t\tthis.#catalog = await (new TemplateCatalogCreator())\n\t\t\t.create(this.#options.entityTypeId, this.#options.categoryId);\n\n\t\tthis.#hideGridLoader();\n\n\t\tthis.#catalog.show();\n\n\t\tconst popup = this.#catalog.getPopup();\n\t\tpopup.subscribeOnce('onClose', this.#destroy.bind(this));\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Crm.GroupActionsWhatsApp.Settings:click',\n\t\t\tthis.#showSettingsMenu.bind(this),\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Crm.GroupActionsWhatsApp.Settings:help',\n\t\t\tthis.#showHelpArticle.bind(this),\n\t\t);\n\t}\n\n\tasync #showSettingsMenu(event: BaseEvent): void\n\t{\n\t\tif (this.#settingsMenu !== null)\n\t\t{\n\t\t\tthis.#settingsMenu.close();\n\t\t\tthis.#settingsMenu.destroy();\n\t\t\tthis.#settingsMenu = null;\n\t\t}\n\n\t\tthis.#settingsMenu = await (new SettingsCreator(this.#selectedFromNumber)).create();\n\n\t\tthis.#settingsMenu.show();\n\t}\n\n\t#showHelpArticle(event: BaseEvent)\n\t{\n\t\tconst articleCode = event.getData().code;\n\n\t\tif (!articleCode)\n\t\t{\n\t\t\tthrow new Error('articleCode is not defined');\n\t\t}\n\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\tif (Helper)\n\t\t{\n\t\t\tHelper.show(`redirect=detail&code=${articleCode}`);\n\t\t}\n\t}\n\n\t#destroy()\n\t{\n\t\tEventEmitter.unsubscribeAll('BX.Crm.SmsEditorWrapper:click');\n\t\tEventEmitter.unsubscribeAll('BX.Crm.GroupActionsWhatsApp.Settings:click');\n\t\tEventEmitter.unsubscribeAll('BX.Crm.GroupActionsWhatsApp.Settings:help');\n\t\tEventEmitter.unsubscribeAll('BX.Crm.GroupActionsWhatsApp.FromPhoneSelected');\n\t\tif (this.#catalog)\n\t\t{\n\t\t\tthis.#catalog.getPopup().unsubscribeAll('onClose');\n\t\t\tthis.#catalog.close();\n\t\t\tthis.#catalog = null;\n\t\t}\n\n\t\tif (this.#settingsMenu)\n\t\t{\n\t\t\tthis.#settingsMenu.close();\n\t\t\tthis.#settingsMenu.destroy();\n\t\t\tthis.#settingsMenu = null;\n\t\t}\n\t}\n\n\t#fromPhoneSelected(event: BaseEvent)\n\t{\n\t\tconst fromNumber = event.getData().phone;\n\t\tthis.#storeLastSelectedFromNumber(fromNumber);\n\t\tthis.#selectedFromNumber = fromNumber;\n\t}\n\n\tasync #sendMessages(event: BaseEvent)\n\t{\n\t\tconst gridId = this.#options.gridId;\n\t\tconst entityTypeId = this.#options.entityTypeId;\n\n\t\tconst messageBody = event.getData()?.text || '';\n\t\tconst messageTemplate = event.getData()?.templateId || null;\n\n\t\tconst container = this.#progressBarRepo\n\t\t\t.getOrCreateProgressBarContainer('whatsapp-message').id;\n\n\t\tconst settings = {\n\t\t\tgridId,\n\t\t\tentityTypeId,\n\t\t\tcontainer,\n\t\t};\n\n\t\tconst bwmManager = BatchWhatsappMessageManager.getInstance(gridId, settings);\n\t\tif (bwmManager.isRunning())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (ProcessRegistry.isProcessRunning(gridId))\n\t\t{\n\t\t\tthis.#showAnotherProcessRunningNotification();\n\n\t\t\treturn;\n\t\t}\n\n\t\tbwmManager.setTemplateParams({\n\t\t\tmessageBody,\n\t\t\tmessageTemplate,\n\t\t\tfromPhone: this.#selectedFromNumber,\n\t\t});\n\n\t\tif (this.#options.forAll)\n\t\t{\n\t\t\tbwmManager.resetEntityIds();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbwmManager.setEntityIds(this.#options.selectedIds);\n\t\t}\n\n\t\tbwmManager.execute();\n\n\t\tthis.#destroy();\n\t}\n\n\t#showAnotherProcessRunningNotification()\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: this.#messages.inProgress,\n\t\t\tautoHide: true,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\t#showGridLoader()\n\t{\n\t\tconst gridLoader = this.#getGridLoader();\n\n\t\tif (gridLoader)\n\t\t{\n\t\t\tgridLoader.show();\n\t\t}\n\t}\n\n\t#hideGridLoader()\n\t{\n\t\tconst gridLoader = this.#getGridLoader();\n\t\tif (gridLoader)\n\t\t{\n\t\t\tgridLoader.hide();\n\t\t}\n\t}\n\n\t#getGridLoader(): ?BX.Grid.Loader\n\t{\n\t\treturn BX.Main.gridManager.getById(this.#options.gridId)?.instance?.getLoader();\n\t}\n\n\t#restoreLastSelectedFromNumber(): ?string\n\t{\n\t\treturn localStorage.getItem(SELECTED_FROM_NUMBER_LOCALSTORE_KEY) || null;\n\t}\n\n\t#storeLastSelectedFromNumber(fromNumber: string): void\n\t{\n\t\tlocalStorage.setItem(SELECTED_FROM_NUMBER_LOCALSTORE_KEY, fromNumber);\n\t}\n}\n"],"names":["fetchTemplates","entityTypeId","entityCategoryId","resp","BX","ajax","runAction","data","senderId","DEFAULT_PROVIDER","context","module","entityId","templates","fetchSmsProvidersConfig","providerName","SettingsCreator","constructor","currentFromNumber","create","fromList","id","menuId","MenuManager","bindElement","document","querySelector","items","delimiter","text","Loc","getMessage","rawProviders","length","Error","providers","ednaProvider","title","name","disabled","className","map","fromNumber","onclick","bind","event","fromMenu","selectedChannelPhone","Event","EventEmitter","emit","phone","close","editorInstance","createOrUpdatePlaceholder","templateId","params","value","entityType","Ajax","placeholderId","fieldName","Type","isStringFilled","fieldValue","SmsEditorWrapper","props","templateParam","Object","String","Number","categoryId","counter","messages","send","methods","onSend","console","error","tplEditorData","getData","isPlainObject","body","PREVIEW","ID","mounted","editorParams","target","$refs","editorContainerEl","onSelect","ORIGINAL_ID","preview","placeholders","PLACEHOLDERS","filledPlaceholders","FILLED_PLACEHOLDERS","Crm","Template","Editor","setPlaceholders","setFilledPlaceholders","setBody","unmounted","template","TemplateCatalogCreator","startConversation","sendFirst","howItWork","learnCompliance","learnMore","rawTemplates","itemsData","itemSlot","EntityCatalog","canDeselectGroups","showEmptyGroups","customComponents","slots","SLOT_MAIN_CONTENT_ITEM","SLOT_MAIN_CONTENT_HEADER","SLOT_MAIN_CONTENT_FOOTER","groups","templateItems","popupOptions","overlay","TITLE","selected","groupIds","customData","SELECTED_FROM_NUMBER_LOCALSTORE_KEY","Messages","getInstance","progressBarRepo","options","setOptions","inProgress","execute","subscribeOnce","subscribe","show","popup","getPopup","destroy","articleCode","code","Helper","Reflection","getClass","unsubscribeAll","gridId","messageBody","messageTemplate","container","getOrCreateProgressBarContainer","settings","bwmManager","BatchWhatsappMessageManager","isRunning","ProcessRegistry","isProcessRunning","setTemplateParams","fromPhone","forAll","resetEntityIds","setEntityIds","selectedIds","UI","Notification","Center","notify","content","autoHide","autoHideDelay","gridLoader","hide","Main","gridManager","getById","instance","getLoader","localStorage","getItem","setItem"],"mappings":"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"}