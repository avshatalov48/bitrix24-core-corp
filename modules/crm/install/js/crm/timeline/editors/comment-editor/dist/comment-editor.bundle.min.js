this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.Timeline=this.BX.Crm.Timeline||{};(function(e,s,t,a){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("commentId");var i=babelHelpers.classPrivateFieldLooseKey("editorName");var r=babelHelpers.classPrivateFieldLooseKey("editorContainer");var o=babelHelpers.classPrivateFieldLooseKey("editor");var b=babelHelpers.classPrivateFieldLooseKey("postForm");var d=babelHelpers.classPrivateFieldLooseKey("commentMessage");var n=babelHelpers.classPrivateFieldLooseKey("loader");var c=babelHelpers.classPrivateFieldLooseKey("onEditorHtmlLoad");var h=babelHelpers.classPrivateFieldLooseKey("onRunRequestError");var p=babelHelpers.classPrivateFieldLooseKey("showEditor");var v=babelHelpers.classPrivateFieldLooseKey("showLoader");class P{constructor(e){Object.defineProperty(this,v,{value:B});Object.defineProperty(this,p,{value:H});Object.defineProperty(this,h,{value:F});Object.defineProperty(this,c,{value:L});Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,i,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:null});Object.defineProperty(this,o,{writable:true,value:null});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:""});Object.defineProperty(this,n,{writable:true,value:void 0});if(e<=0){throw new Error("Comment ID must be specified")}babelHelpers.classPrivateFieldLooseBase(this,l)[l]=s.Text.toInteger(e);babelHelpers.classPrivateFieldLooseBase(this,i)[i]="CrmTimeLineComment"+babelHelpers.classPrivateFieldLooseBase(this,l)[l]+BX.util.getRandomString(4)}show(e){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=s.Type.isDomNode(e)?e:null;if(!babelHelpers.classPrivateFieldLooseBase(this,r)[r]){throw new Error("Editor container must be specified")}if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.SetContent(babelHelpers.classPrivateFieldLooseBase(this,d)[d]);babelHelpers.classPrivateFieldLooseBase(this,o)[o].ReInitIframe();return}babelHelpers.classPrivateFieldLooseBase(this,v)[v](true);s.ajax.runAction("crm.api.timeline.loadEditor",{data:{id:babelHelpers.classPrivateFieldLooseBase(this,l)[l],name:babelHelpers.classPrivateFieldLooseBase(this,i)[i]}}).then((e=>{const t=e.data.assets;const a=[...t.hasOwnProperty("css")?t.css:[],...t.hasOwnProperty("js")?t.js:[]];BX.load(a,(()=>{if(t.hasOwnProperty("string")){Promise.all(t.string.map((e=>s.Runtime.html(null,e)))).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,c)[c](e)}))}else{babelHelpers.classPrivateFieldLooseBase(this,c)[c](e)}}))})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)}))}getContent(){let e="";if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.GetContent().trim();babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}if(!s.Type.isStringFilled(e)){a.UI.Notification.Center.notify({content:BX.message("CRM_TIMELINE_EMPTY_COMMENT_MESSAGE")})}return e}getHtmlContent(){let e="";if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.currentViewName==="wysiwyg"?babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.iframeView.GetValue():babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.content}return e}getAttachments(){let e=[];if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){babelHelpers.classPrivateFieldLooseBase(this,b)[b].eventNode.querySelectorAll('input[name="UF_CRM_COMMENT_FILES[]"]').forEach((s=>e.push(s.value)))}return e}}function L(e){if(s.Type.isObject(e)&&s.Type.isObject(e.data)&&s.Type.isStringFilled(e.data.html)){babelHelpers.classPrivateFieldLooseBase(this,v)[v](false);s.Runtime.html(babelHelpers.classPrivateFieldLooseBase(this,r)[r],e.data.html).then((()=>{if(LHEPostForm){setTimeout(babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this),0)}}))}else{babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)}}function F(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v](false);if(s.Type.isObject(e)&&s.Type.isArray(e.errors)&&e.errors.length>0){a.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3})}if(e.status!=="success"){throw new Error("Unable to load editor component")}}function H(){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=LHEPostForm.getHandler(babelHelpers.classPrivateFieldLooseBase(this,i)[i]);babelHelpers.classPrivateFieldLooseBase(this,o)[o]=BXHtmlEditor.Get(babelHelpers.classPrivateFieldLooseBase(this,i)[i]);BX.onCustomEvent(babelHelpers.classPrivateFieldLooseBase(this,b)[b].eventNode,"OnShowLHE",[true]);babelHelpers.classPrivateFieldLooseBase(this,d)[d]=babelHelpers.classPrivateFieldLooseBase(this,b)[b].oEditor.GetContent();if(babelHelpers.classPrivateFieldLooseBase(this,o)[o].dom){babelHelpers.classPrivateFieldLooseBase(this,o)[o].dom.textareaCont.style.opacity=1;babelHelpers.classPrivateFieldLooseBase(this,o)[o].dom.iframeCont.style.opacity=1}setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,o)[o].Focus(true)}),100)}function B(e){if(e){if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]&&t.Loader){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=new t.Loader({size:45,offset:{top:"1%"}})}babelHelpers.classPrivateFieldLooseBase(this,n)[n].show(babelHelpers.classPrivateFieldLooseBase(this,r)[r])}else{if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]&&t.Loader){babelHelpers.classPrivateFieldLooseBase(this,n)[n].hide()}}}e.CommentEditor=P})(this.BX.Crm.Timeline.Editors=this.BX.Crm.Timeline.Editors||{},BX,BX,BX);
//# sourceMappingURL=comment-editor.bundle.map.js