this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(exports,ui_cnt,ui_label,main_core_events,main_loader,crm_timeline_item,ui_vue3_components_audioplayer,main_popup,currency_currencyCore,ui_vue3,ui_alerts,crm_datetime,main_date,crm_router,ui_dialogs_messagebox,crm_timeline_tools,ui_notification,main_core,ui_buttons){"use strict";let Item=function(){function t(){babelHelpers.classCallCheck(this,t);this._id="";this._isTerminated=false;this._wrapper=null}babelHelpers.createClass(t,[{key:"getId",value:function t(){return this._id}},{key:"_setId",value:function t(e){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4)}},{key:"setData",value:function t(e){throw new Error("Item.setData() must be overridden")}},{key:"layout",value:function t(e){throw new Error("Item.layout() must be overridden")}},{key:"refreshLayout",value:function t(){const e=this._wrapper.previousSibling;this.clearLayout();this.layout({anchor:e})}},{key:"clearLayout",value:function t(){main_core.Dom.remove(this._wrapper);this._wrapper=undefined}},{key:"destroy",value:function t(){this.clearLayout()}},{key:"getWrapper",value:function t(){return this._wrapper}},{key:"setWrapper",value:function t(e){this._wrapper=e}},{key:"addWrapperClass",value:function t(e,i){if(!this._wrapper){return}main_core.Dom.addClass(this._wrapper,e);if(main_core.Type.isNumber(i)&&i>=0){window.setTimeout(this.removeWrapperClass.bind(this,e),i)}}},{key:"removeWrapperClass",value:function t(e,i){if(!this._wrapper){return}main_core.Dom.removeClass(this._wrapper,e);if(main_core.Type.isNumber(i)&&i>=0){window.setTimeout(this.addWrapperClass.bind(this,e),i)}}},{key:"isTerminated",value:function t(){return this._isTerminated}},{key:"markAsTerminated",value:function t(e){e=!!e;if(this._isTerminated===e){return}this._isTerminated=e;if(!this._wrapper){return}if(e){main_core.Dom.addClass(this._wrapper,"crm-entity-stream-section-last")}else{main_core.Dom.removeClass(this._wrapper,"crm-entity-stream-section-last")}}},{key:"getAssociatedEntityTypeId",value:function t(){return null}},{key:"getAssociatedEntityId",value:function t(){return null}}]);return t}();let IconBackgroundColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(IconBackgroundColor,"PRIMARY","primary");babelHelpers.defineProperty(IconBackgroundColor,"PRIMARY_ALT","primary_alt");babelHelpers.defineProperty(IconBackgroundColor,"FAILURE","failure");const Icon={props:{code:{type:String,required:false,default:"none"},counterType:{type:String,required:false,default:""},backgroundColorToken:{type:String,required:false,default:IconBackgroundColor.PRIMARY}},inject:["isLogMessage"],computed:{className(){return{"crm-timeline__card_icon":true,[`--bg-${this.backgroundColorToken}`]:!!this.backgroundColorToken,[`--code-${this.code}`]:!!this.code,["--muted"]:this.isLogMessage}},counterNodeContainer(){return this.$refs.counter}},methods:{renderCounter(){if(!this.counterType){return}main_core.Dom.clean(this.counterNodeContainer);const t=new ui_cnt.Counter({value:1,border:true,color:ui_cnt.Counter.Color[this.counterType.toUpperCase()]});t.renderTo(this.counterNodeContainer)}},mounted(){this.renderCounter()},watch:{counterType(t){this.$nextTick((()=>{this.renderCounter()}))}},template:`\n\t\t<div :class="className">\n\t\t\t<i></i>\n\t\t\t<div ref="counter" v-show="!!counterType" class="crm-timeline__card_icon_counter"></div>\n\t\t</div>\n\t`};function _classPrivateFieldInitSpec(t,e,i){_checkPrivateRedeclaration(t,e);e.set(t,i)}function _checkPrivateRedeclaration(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _menuOptions=new WeakMap;var _vueComponent=new WeakMap;let Menu=function(){function t(e,i,n){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec(this,_menuOptions,{writable:true,value:{}});_classPrivateFieldInitSpec(this,_vueComponent,{writable:true,value:{}});babelHelpers.classPrivateFieldSet(this,_vueComponent,e);babelHelpers.classPrivateFieldSet(this,_menuOptions,n||{});babelHelpers.classPrivateFieldSet(this,_menuOptions,{angle:false,cacheable:false,...babelHelpers.classPrivateFieldGet(this,_menuOptions)});babelHelpers.classPrivateFieldGet(this,_menuOptions).items=[];for(const t of i){babelHelpers.classPrivateFieldGet(this,_menuOptions).items.push(this.createMenuItem(t))}}babelHelpers.createClass(t,[{key:"show",value:function t(){main_popup.MenuManager.show(babelHelpers.classPrivateFieldGet(this,_menuOptions))}},{key:"createMenuItem",value:function t(e){if(e.hasOwnProperty("delimiter")&&e.delimiter){return{text:e.title||"",delimiter:true}}const i={text:e.title,value:e.title};if(e.icon){i.className="menu-popup-item-"+e.icon}if(e.menu){i.items=[];for(const t of Object.values(e.menu.items||{})){i.items.push(this.createMenuItem(t))}}else if(e.action){if(e.action.type==="redirect"){i.href=e.action.value}else if(e.action.type==="jsCode"){i.onclick=e.action.value}else{i.onclick=()=>{this.onMenuItemClick(e)}}}return i}},{key:"onMenuItemClick",value:function t(e){const i=main_popup.MenuManager.getCurrentMenu();if(i){i.close()}new Action(e.action).execute(babelHelpers.classPrivateFieldGet(this,_vueComponent))}}],[{key:"showMenu",value:function e(i,n,a){const s=new t(i,n,a);s.show()}}]);return t}();function _classPrivateMethodInitSpec(t,e){_checkPrivateRedeclaration$1(t,e);e.add(t)}function _classPrivateFieldInitSpec$1(t,e,i){_checkPrivateRedeclaration$1(t,e);e.set(t,i)}function _checkPrivateRedeclaration$1(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const AnimationTarget={block:"block",item:"item"};const AnimationType={disable:"disable",loader:"loader"};const ActionType={JS_EVENT:"jsEvent",AJAX_ACTION:{STARTED:"ajaxActionStarted",FINISHED:"ajaxActionFinished",FAILED:"ajaxActionFailed"},isJsEvent(t){return t===this.JS_EVENT},isAjaxAction(t){return t===this.AJAX_ACTION.STARTED||t===this.AJAX_ACTION.FINISHED||t===this.AJAX_ACTION.FAILED}};Object.freeze(ActionType.AJAX_ACTION);Object.freeze(ActionType);var _type=new WeakMap;var _value=new WeakMap;var _actionParams=new WeakMap;var _animation=new WeakMap;var _prepareRunActionParams=new WeakSet;var _prepareMenuItems=new WeakSet;var _startAnimation=new WeakSet;var _stopAnimation=new WeakSet;var _isAnimationValid=new WeakSet;let Action=function(){function Action(t){babelHelpers.classCallCheck(this,Action);_classPrivateMethodInitSpec(this,_isAnimationValid);_classPrivateMethodInitSpec(this,_stopAnimation);_classPrivateMethodInitSpec(this,_startAnimation);_classPrivateMethodInitSpec(this,_prepareMenuItems);_classPrivateMethodInitSpec(this,_prepareRunActionParams);_classPrivateFieldInitSpec$1(this,_type,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_value,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_actionParams,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_animation,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_type,t.type);babelHelpers.classPrivateFieldSet(this,_value,t.value);babelHelpers.classPrivateFieldSet(this,_actionParams,t.actionParams);babelHelpers.classPrivateFieldSet(this,_animation,main_core.Type.isPlainObject(t.animation)?t.animation:null)}babelHelpers.createClass(Action,[{key:"execute",value:function execute(vueComponent){return new Promise(((resolve,reject)=>{if(this.isJsEvent()){vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.JS_EVENT,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams),animationCallbacks:{onStart:_classPrivateMethodGet(this,_startAnimation,_startAnimation2).bind(this,vueComponent),onStop:_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).bind(this,vueComponent)}});resolve(true)}else if(this.isJsCode()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);eval(babelHelpers.classPrivateFieldGet(this,_value));_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);resolve(true)}else if(this.isAjaxAction()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.STARTED,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams)});main_core.ajax.runAction(babelHelpers.classPrivateFieldGet(this,_value),{data:_classPrivateMethodGet(this,_prepareRunActionParams,_prepareRunActionParams2).call(this,babelHelpers.classPrivateFieldGet(this,_actionParams))}).then((t=>{_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.FINISHED,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams),response:t});resolve(t)}),(t=>{_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.FAILED,actionParams:babelHelpers.classPrivateFieldGet(this,_actionParams),response:t});reject(t)}))}else if(this.isRedirect()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);location.href=babelHelpers.classPrivateFieldGet(this,_value);resolve(babelHelpers.classPrivateFieldGet(this,_value))}else if(this.isShowMenu()){Menu.showMenu(vueComponent,_classPrivateMethodGet(this,_prepareMenuItems,_prepareMenuItems2).call(this,babelHelpers.classPrivateFieldGet(this,_value).items,vueComponent),{id:"actionMenu",bindElement:vueComponent.$el,minWidth:vueComponent.$el.offsetWidth});resolve(true)}else{reject(false)}}))}},{key:"isJsEvent",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="jsEvent"}},{key:"isJsCode",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="jsCode"}},{key:"isAjaxAction",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="runAjaxAction"}},{key:"isRedirect",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="redirect"}},{key:"isShowMenu",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="showMenu"}},{key:"getValue",value:function t(){return babelHelpers.classPrivateFieldGet(this,_value)}}]);return Action}();function _prepareRunActionParams2(t){const e={};if(main_core.Type.isUndefined(t)){return e}for(const i in t){const n=t[i];if(main_core.Type.isDate(n)){e[i]=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateTimeFormat(),n)}else if(main_core.Type.isPlainObject(n)){e[i]=_classPrivateMethodGet(this,_prepareRunActionParams,_prepareRunActionParams2).call(this,n)}else{e[i]=n}}return e}function _prepareMenuItems2(t,e){return Object.values(t).filter((t=>t.state!=="hidden"&&t.scope!=="mobile"&&(!e.isReadOnly||!t.hideIfReadonly))).sort(((t,e)=>t.sort-e.sort))}function _startAnimation2(t){if(!_classPrivateMethodGet(this,_isAnimationValid,_isAnimationValid2).call(this)){return}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.item){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){t.$root.setFaded(true)}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){t.$root.showLoader(true)}}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.block){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){if(main_core.Type.isFunction(t.setDisabled)){t.setDisabled(true)}}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){if(main_core.Type.isFunction(t.setLoading)){t.setLoading(true)}}}}function _stopAnimation2(t){if(!_classPrivateMethodGet(this,_isAnimationValid,_isAnimationValid2).call(this)){return}if(babelHelpers.classPrivateFieldGet(this,_animation).forever){return}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.item){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){t.$root.setFaded(false)}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){t.$root.showLoader(false)}}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.block){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){if(main_core.Type.isFunction(t.setDisabled)){t.setDisabled(false)}}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){if(main_core.Type.isFunction(t.setLoading)){t.setLoading(false)}}}}function _isAnimationValid2(){if(!babelHelpers.classPrivateFieldGet(this,_animation)){return false}if(!AnimationTarget.hasOwnProperty(babelHelpers.classPrivateFieldGet(this,_animation).target)){return false}if(!AnimationType.hasOwnProperty(babelHelpers.classPrivateFieldGet(this,_animation).type)){return false}return true}const ChangeStreamButton={props:{disableIfReadonly:Boolean,type:String,title:String,action:Object},data(){return{isReadonlyMode:false}},inject:["isReadOnly"],mounted(){this.isReadonlyMode=this.isReadOnly},computed:{isShowPinButton(){return this.type==="pin"&&!this.isReadonlyMode},isShowUnpinButton(){return this.type==="unpin"&&!this.isReadonlyMode}},methods:{executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)},onClick(){if(this.action){const t=new Action(this.action);t.execute(this)}},setDisabled(t){if(!this.isReadonly&&!t){this.isReadonlyMode=false}if(t){this.isReadonlyMode=true}}},template:`\n\t\t<div class="crm-timeline__card-top_controller">\n\t\t\t<input\n\t\t\t\tv-if="type === 'complete'"\n\t\t\t\t@click="executeAction"\n\t\t\t\ttype="checkbox"\n\t\t\t\t:disabled="isReadonlyMode"\n\t\t\t\tclass="crm-timeline__card-top_checkbox"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-else-if="isShowPinButton"\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\tclass="crm-timeline__card-top_icon --pin"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-else-if="isShowUnpinButton"\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\tclass="crm-timeline__card-top_icon --unpin"\n\t\t\t></div>\n\t\t</div>\n\t`};const Title={props:{title:String,action:Object},inject:["isLogMessage"],computed:{className(){return["crm-timeline__card-title",{"--light":this.isLogMessage,"--action":!!this.action}]},href(){if(!this.action){return null}const t=new Action(this.action);if(t.isRedirect()){return t.getValue()}return null}},methods:{executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)}},template:`\n\t\t<a\n\t\t\tv-if="href"\n\t\t\t:href="href"\n\t\t\t:class="className"\n\t\t\ttabindex="0"\n\t\t\t:title="title"\n\t\t>\n\t\t\t{{title}}\n\t\t</a>\n\t\t<span\n\t\t\tv-else\n\t\t\t@click="executeAction"\n\t\t\t:class="className"\n\t\t\ttabindex="0"\n\t\t\t:title="title"\n\t\t>\n\t\t\t{{title}}\n\t\t</span>`};let TagType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TagType,"PRIMARY","primary");babelHelpers.defineProperty(TagType,"SECONDARY","secondary");babelHelpers.defineProperty(TagType,"SUCCESS","success");babelHelpers.defineProperty(TagType,"WARNING","warning");babelHelpers.defineProperty(TagType,"FAILURE","failure");const Tag={props:{title:{type:String,required:false,default:""},hint:{type:String,required:false,default:""},action:{type:Object,required:false,default:null},type:{type:String,required:false,default:TagType.SECONDARY},state:String},computed:{className(){return{"crm-timeline__card-status":true,"--clickable":!!this.action,"--hint":!!this.hint}},tagTypeToLabelColorDict(){return{[TagType.PRIMARY]:ui_label.Label.Color.LIGHT_BLUE,[TagType.SECONDARY]:ui_label.Label.Color.LIGHT,[TagType.SUCCESS]:ui_label.Label.Color.LIGHT_GREEN,[TagType.WARNING]:ui_label.Label.Color.LIGHT_YELLOW,[TagType.FAILURE]:ui_label.Label.Color.LIGHT_RED}},tagContainerRef(){return this.$refs.tag}},methods:{getLabelColorFromTagType(t){const e=t?t.toLowerCase():"";const i=this.tagTypeToLabelColorDict[e];return i?i:ui_label.Label.Color.LIGHT},renderTag(t){if(!t||!this.tagContainerRef){return null}const{title:e,type:i}=t;const n=e&&main_core.Type.isString(e)?e.toUpperCase():"";const a=new ui_label.Label({text:n,color:this.getLabelColorFromTagType(i),fill:true});main_core.Dom.clean(this.tagContainerRef);main_core.Dom.append(a.render(),this.tagContainerRef)},executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)}},mounted(){this.renderTag({title:this.title,type:this.type})},updated(){this.renderTag({title:this.title,type:this.type})},template:`\n\t\t<div ref="tag" :title="hint" :class="className" @click="executeAction"></div>\n\t`};const User={props:{title:String,detailUrl:String,imageUrl:String},inject:["isLogMessage"],computed:{styles(){if(!this.imageUrl){return{}}return{backgroundImage:"url('"+main_core.Text.encode(this.imageUrl)+"')",backgroundSize:"21px"}},className(){return["ui-icon","ui-icon-common-user","crm-timeline__user-icon",{"--muted":this.isLogMessage}]}},template:`<a :class="className" :href="detailUrl"\n\t\t\t\t  target="_blank" :title="title"><i :style="styles"></i></a>`};const FormatDate={name:"FormatDate",props:{timestamp:{type:Number,required:true,default:0},datePlaceholder:{type:String,required:false,default:""},useShortTimeFormat:{type:Boolean,required:false,default:false},class:{type:[Array,Object,String],required:false,default:""}},computed:{formattedDate(){if(!this.timestamp){return this.datePlaceholder}const t=crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.timestamp).toUserTime();return this.useShortTimeFormat?t.toTimeString():t.toDatetimeString({delimiter:", "})}},template:`\n\t\t<div :class="$props.class">{{ formattedDate }}</div>\n\t`};const Hint={data(){return{isMouseOnHintArea:false,hintPopup:null}},props:{icon:{type:String,required:false,default:""},textBlocks:{type:Array,required:false,default:[]}},computed:{hintContentIcon(){if(this.icon===""){return null}const t=main_core.Dom.create("i");return main_core.Dom.create("div",{attrs:{classname:this.hintContentIconClassname},children:[t]})},hintContentText(){return main_core.Dom.create("div",{attrs:{classname:"crm-timeline__hint_popup-content-text"},children:this.hintContentTextBlocks})},hintContentTextBlocks(){return this.textBlocks.map(this.getContentBlockNode)},hintContentIconClassname(){const t="crm-timeline__hint_popup-content-icon";return`${t} --${this.icon}`},hintIconClassname(){return["ui-hint","crm-timeline__header-hint",{"--active":this.hintPopup}]},hasContent(){return this.textBlocks.length>0}},methods:{getHintContent(){return main_core.Dom.create("div",{attrs:{classname:"crm-timeline__hint_popup-content"},style:{display:"flex"},children:[this.hintContentIcon,this.hintContentText]})},getPopupOptions(){return{darkMode:true,autoHide:false,content:this.getHintContent(),maxWidth:400,bindOptions:{position:"top"},animation:"fading-slide"}},getPopupPosition(){var t;const e=this.$refs.hint;const i=main_popup.Popup.getOption("angleLeftOffset");const{width:n,left:a,top:s}=main_core.Dom.getPosition(e);const{width:o}=main_core.Dom.getPosition((t=this.hintPopup)===null||t===void 0?void 0:t.getPopupContainer());return{left:a+i-(o-n)/2,top:s+15}},getPopupAngleOffset(t){const e=33;const{width:i}=main_core.Dom.getPosition(t);return(i-e)/2},onMouseEnterToPopup(){this.isMouseOnHintArea=true},onHintAreaMouseLeave(){this.isMouseOnHintArea=false;setTimeout((()=>{if(!this.isMouseOnHintArea){this.hideHintPopup()}}),400)},onMouseEnterToHint(){this.isMouseOnHintArea=true;this.showHintPopupWithDebounce()},showHintPopup(){if(!this.isMouseOnHintArea||this.hintPopup&&this.hintPopup.isShown()){return}this.hintPopup=new main_popup.Popup(this.getPopupOptions());const t=this.hintPopup.getPopupContainer();main_core.Event.bind(t,"mouseenter",this.onMouseEnterToPopup);main_core.Event.bind(t,"mouseleave",this.onHintAreaMouseLeave);this.hintPopup.show();this.hintPopup.setBindElement(this.getPopupPosition());this.hintPopup.setAngle(false);this.hintPopup.setAngle({offset:this.getPopupAngleOffset(t,this.$refs.hint)});this.hintPopup.adjustPosition();this.hintPopup.show()},showHintPopupWithDebounce(){main_core.Runtime.debounce(this.showHintPopup,300,this)()},hideHintPopup(){if(!this.hintPopup){return}this.hintPopup.close();const t=this.hintPopup.getPopupContainer();main_core.Event.unbind(t,"mouseenter",this.onMouseEnterToPopup);main_core.Event.unbind(t,"mouseleave",this.onHintAreaMouseLeave);this.hintPopup.destroy();this.hintPopup=null},hideHintPopupWithDebounce(){return main_core.Runtime.debounce(this.hideHintPopup,300,this)},getContentBlockNode(t){if(t.type==="text"){return this.getTextNode(t.options)}else if(t.type==="link"){return this.getLinkNode(t.options)}return null},getTextNode(t={}){return main_core.Dom.create("span",{text:t.text})},getLinkNode(t={}){const e=main_core.Dom.create("span",{text:t.text});main_core.Dom.addClass(e,"crm-timeline__hint_popup-content-link");e.onclick=()=>{this.executeAction(t.action)};return e},executeAction(t){if(t){const e=new Action(t);e.execute(this)}}},template:`\n\t\t<span\n\t\t\tref="hint"\n\t\t\t@click.stop.prevent\n\t\t\t@mouseenter="onMouseEnterToHint"\n\t\t\t@mouseleave="onHintAreaMouseLeave"\n\t\t\tv-if="hasContent"\n\t\t\t:class="hintIconClassname"\n\t\t>\n\t\t\t<span class="ui-hint-icon" />\n\t\t</span>\n\t`};const Header={components:{ChangeStreamButton:ChangeStreamButton,Title:Title,Tag:Tag,User:User,FormatDate:FormatDate,Hint:Hint},props:{title:String,titleAction:Object,date:Number,datePlaceholder:String,useShortTimeFormat:Boolean,changeStreamButton:Object|null,tags:Object,user:Object,infoHelper:Object},inject:["isReadOnly"],computed:{visibleTags(){return this.tags?Object.values(this.tags).filter(this.isVisibleTagFilter):[]},visibleAndAscSortedTags(){const t=main_core.Runtime.clone(this.visibleTags);return t.sort(this.tagsAscSorter)},isShowDate(){return this.date||this.datePlaceholder}},methods:{isVisibleTagFilter(t){return t.state!=="hidden"&&t.scope!=="mobile"&&(!this.isReadOnly||!t.hideIfReadonly)},tagsAscSorter(t,e){return t.sort-e.sort},getChangeStreamButton(){return this.$refs.changeStreamButton}},template:`\n\t\t<div class="crm-timeline__card-top">\n\t\t\t<div class="crm-timeline__card-top_info">\n\t\t\t\t<div class="crm-timeline__card-top_info_left">\n\t\t\t\t\t<ChangeStreamButton v-if="changeStreamButton" v-bind="changeStreamButton" ref="changeStreamButton"></ChangeStreamButton>\n\t\t\t\t\t<Title :title="title" :action="titleAction"></Title>\n\t\t\t\t\t<Hint v-if="infoHelper" v-bind="infoHelper"></Hint>\n\t\t\t\t</div>\n\t\t\t\t<div ref="tags" class="crm-timeline__card-top_info_right">\n\t\t\t\t\t<Tag\n\t\t\t\t\t\tv-for="(tag, index) in visibleAndAscSortedTags"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\tv-bind="tag"\n\t\t\t\t\t/>\n\t\t\t\t\t<FormatDate\n\t\t\t\t\t\tv-if="isShowDate"\n\t\t\t\t\t\t:timestamp="date"\n\t\t\t\t\t\t:use-short-time-format="useShortTimeFormat"\n\t\t\t\t\t\t:date-placeholder="datePlaceholder"\n\t\t\t\t\t\tclass="crm-timeline__card-time"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-top_user">\n\t\t\t\t<User v-bind="user"></User>\n\t\t\t</div>\n\t\t</div>\n\t`};const Logo={props:{type:String,addIcon:String,addIconType:String,icon:String,iconType:String,inCircle:{type:Boolean,required:false,default:false},action:Object},data(){return{currentIcon:this.icon}},computed:{className(){return["crm-timeline__card-logo",`--${this.type}`,{"--clickable":this.action}]},iconClassname(){return["crm-timeline__card-logo_icon",`--${this.currentIcon}`,`--type-${this.iconType}`,{"--in-circle":this.inCircle}]},addIconClassname(){return["crm-timeline__card-logo_add-icon",`--type-${this.addIconType}`,`--icon-${this.addIcon}`]}},watch:{icon(t){this.currentIcon=t}},methods:{executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)},setIcon(t){this.currentIcon=t}},template:`\n\t\t<div :class="className" @click="executeAction">\n\t\t\t<div class="crm-timeline__card-logo_content">\n\t\t\t\t<div :class="iconClassname">\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\t\t\t\t<div :class="addIconClassname" v-if="addIcon">\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\x3c!--\t\t\t<div v-if="action" @click="executeAction" class="crm-timeline__card-icon_action-btn"></div>--\x3e\n\t\t</div>\n\t`};const CalendarIcon={props:{timestamp:{type:Number,required:true,default:0}},computed:{userTime(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.timestamp).toUserTime().getValue()},date(){return main_date.DateTimeFormat.format("d",this.userTime)},month(){return main_date.DateTimeFormat.format("F",this.userTime)},dayWeek(){return main_date.DateTimeFormat.format("D",this.userTime)},time(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.timestamp).toUserTime().toTimeString()}},template:`\n\t\t<div class="crm-timeline__calendar-icon">\n\t\t\t<header class="crm-timeline__calendar-icon_top">\n\t\t\t\t<div class="crm-timeline__calendar-icon_bullets">\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_bullet"></div>\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_bullet"></div>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main class="crm-timeline__calendar-icon_content">\n\t\t\t\t<div class="crm-timeline__calendar-icon_day">{{ date }}</div>\n\t\t\t\t<div class="crm-timeline__calendar-icon_month">{{ month }}</div>\n\t\t\t\t<div class="crm-timeline__calendar-icon_date">\n\t\t\t\t\t<span class="crm-timeline__calendar-icon_day-week">{{ dayWeek }}</span>\n\t\t\t\t\t<span class="crm-timeline__calendar-icon_time">{{ time }}</span>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</div>\n\t`};const LogoCalendar=ui_vue3.BitrixVue.cloneComponent(Logo,{components:{CalendarIcon:CalendarIcon},props:{timestamp:{type:Number,required:false,default:0}},template:`\n\t\t<div :class="className" @click="executeAction">\n\t\t\t<div class="crm-timeline__card-logo_content">\n\t\t\t\t<CalendarIcon :timestamp="timestamp" />\n\t\t\t</div>\n\t\t</div>\n\t`});const Body={components:{Logo:Logo,LogoCalendar:LogoCalendar},props:{logo:Object,blocks:Object},data(){return{blockRefs:{}}},mounted(){const t=this.$refs.blocks;if(!t||!this.visibleBlocks){return}this.visibleBlocks.forEach(((e,i)=>{if(main_core.Type.isDomNode(t[i].$el)){t[i].$el.setAttribute("data-id",e.id)}else{throw new Error('Vue component "'+e.rendererName+'" was not found')}}))},beforeUpdate(){this.blockRefs={}},computed:{visibleBlocks(){return Object.keys(this.blocks).map((t=>({id:t,...this.blocks[t]}))).filter((t=>t.scope!=="mobile")).sort(((t,e)=>{let i=t.sort===undefined?0:t.sort;let n=e.sort===undefined?0:e.sort;if(i<n){return-1}if(i>n){return 1}return 0}))}},methods:{getContentBlockById(t){var e;return(e=this.blockRefs[t])!==null&&e!==void 0?e:null},getLogo(){return this.$refs.logo},saveRef(t,e){this.blockRefs[e]=t}},template:`\n\t\t<div class="crm-timeline__card-body">\n\t\t\t<div v-if="logo" class="crm-timeline__card-logo_container">\n\t\t\t\t<LogoCalendar v-if="logo.icon === 'calendar'" v-bind="logo"></LogoCalendar>\n\t\t\t\t<Logo v-else v-bind="logo" ref="logo"></Logo>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-container">\n\t\t\t\t<div\n\t\t\t\t\tv-for="block in visibleBlocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\tclass="crm-timeline__card-container_block"\n\t\t\t\t>\n\t\t\t\t\t<component\n\t\t\t\t\t\t:is="block.rendererName"\n\t\t\t\t\t\tv-bind="block.properties"\n\t\t\t\t\t\t:ref="(el) => this.saveRef(el, block.id)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let ButtonState=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonState,"DEFAULT","");babelHelpers.defineProperty(ButtonState,"LOADING","loading");babelHelpers.defineProperty(ButtonState,"DISABLED","disabled");babelHelpers.defineProperty(ButtonState,"HIDDEN","hidden");const BaseButton={props:{id:{type:String,required:false,default:""},title:{type:String,required:false,default:""},state:{type:String,required:false,default:ButtonState.DEFAULT},action:Object},data(){return{currentState:this.state}},computed:{itemStateToButtonStateDict(){return{[ButtonState.LOADING]:ui_buttons.Button.State.WAITING,[ButtonState.DISABLED]:ui_buttons.Button.State.DISABLED}}},methods:{setDisabled(t){if(t){this.setButtonState(ButtonState.DISABLED)}else{this.setButtonState(ButtonState.DEFAULT)}},setLoading(t){if(t){this.setButtonState(ButtonState.LOADING)}else{this.setButtonState(ButtonState.DEFAULT)}},setButtonState(t){if(this.currentState!==t){this.currentState=t}},onLayoutUpdated(){this.setButtonState(this.state)},executeAction(){if(this.action&&this.currentState!==ButtonState.DISABLED&&this.currentState!==ButtonState.LOADING){const t=new Action(this.action);t.execute(this)}}},created(){this.$Bitrix.eventEmitter.subscribe("layout:updated",this.onLayoutUpdated)},beforeDestroy(){this.$Bitrix.eventEmitter.unsubscribe("layout:updated",this.onLayoutUpdated)},template:`<button></button>`};const AdditionalButtonIcon=Object.freeze({NOTE:"note",SCRIPT:"script",PRINT:"print",DOTS:"dots"});const AdditionalButtonColor=Object.freeze({DEFAULT:"default",PRIMARY:"primary"});const AdditionalButton=ui_vue3.BitrixVue.cloneComponent(BaseButton,{props:{iconName:{type:String,required:false,default:"",validator(t){return Object.values(AdditionalButtonIcon).indexOf(t)>-1}},color:{type:String,required:false,default:AdditionalButtonColor.DEFAULT,validator(t){return Object.values(AdditionalButtonColor).indexOf(t)>-1}}},computed:{className(){return["crm-timeline__card_add-button",{[`--icon-${this.iconName}`]:this.iconName,[`--color-${this.color}`]:this.color,[`--state-${this.currentState}`]:this.currentState}]},ButtonState(){return ButtonState},loaderHtml(){const t=new main_loader.Loader({mode:"inline",size:20});t.show();return t.layout.outerHTML}},template:`\n\t\t<transition name="crm-timeline__card_add-button-fade" mode="out-in">\n\t\t\t<div\n\t\t\t\tv-if="currentState === ButtonState.LOADING"\n\t\t\t\tv-html="loaderHtml"\n\t\t\t\tclass="crm-timeline__card_add-button"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\t:class="className">\n\t\t\t</div>\n\t\t</transition>\n\t`});const MenuId="timeline-more-button-menu";const Menu$1={components:{AdditionalButton:AdditionalButton},props:{buttons:Array,items:Object},inject:["isReadOnly"],computed:{itemsArray(){if(!this.items){return[]}return Object.values(this.items).filter((t=>t.state!=="hidden"&&t.scope!=="mobile"&&(!this.isReadOnly||!t.hideIfReadonly))).sort(((t,e)=>t.sort-e.sort))},menuItems(){let t=this.buttons;if(this.buttons.length&&this.itemsArray.length){t.push({delimiter:true})}t=[...t,...this.itemsArray];return t},buttonProps(){return{color:AdditionalButtonColor.DEFAULT,icon:AdditionalButtonIcon.DOTS}}},beforeUnmount(){const t=main_popup.MenuManager.getMenuById(MenuId);if(t){t.destroy()}},methods:{showMenu(){Menu.showMenu(this,this.menuItems,{id:MenuId,className:"crm-timeline__card_more-menu",width:230,angle:false,cacheable:false,bindElement:this.$el})}},template:`\n\t\t<div class="crm-timeline__card-action_menu-item" @click="showMenu">\n\t\t<AdditionalButton iconName="dots" color="default"></AdditionalButton>\n\t\t</div>\n\t`};let ButtonType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonType,"ICON","icon");babelHelpers.defineProperty(ButtonType,"PRIMARY","primary");babelHelpers.defineProperty(ButtonType,"SECONDARY","secondary");babelHelpers.defineProperty(ButtonType,"LIGHT","light");const Button=ui_vue3.BitrixVue.cloneComponent(BaseButton,{props:{type:{type:String,required:false,default:ButtonType.SECONDARY},iconName:{type:String,required:false,default:""},size:{type:String,required:false,default:"extra_small"}},data(){return{popup:null,uiButton:Object.freeze(null),timerSecondsRemaining:0}},computed:{buttonOptions(){const t=main_core.Type.isString(this.iconName)?this.iconName.toUpperCase():"";const e=main_core.Type.isString(this.size)?this.size.toUpperCase():"extra_small";const i=this.itemTypeToButtonColorDict[this.type]||ui_buttons.Button.Color.LIGHT_BORDER;const n=this.type===ButtonType.ICON?"":this.title;return{id:this.id,round:true,dependOnTheme:false,size:ui_buttons.Button.Size[e],text:n,color:i,state:this.itemStateToButtonStateDict[this.currentState],icon:ui_buttons.Button.Icon[t]}},itemTypeToButtonColorDict(){return{[ButtonType.PRIMARY]:ui_buttons.Button.Color.PRIMARY,[ButtonType.SECONDARY]:ui_buttons.Button.Color.LIGHT_BORDER,[ButtonType.LIGHT]:ui_buttons.Button.Color.LIGHT,[ButtonType.ICON]:ui_buttons.Button.Color.LINK}},buttonContainerRef(){return this.$refs.buttonContainer}},methods:{getUiButton(){return this.uiButton},disableWithTimer(t){this.setButtonState(ButtonState.DISABLED);const e=this.getUiButton();let i=t;e.setText(this.formatSeconds(i));const n=setInterval((()=>{if(i<1){clearInterval(n);e.setText(this.title);this.setButtonState(ButtonState.DEFAULT);return}i--;e.setText(this.formatSeconds(i))}),1e3)},formatSeconds(t){const e=Math.floor(t/60);const i=t%60;const n=this.formatNumber(e);const a=this.formatNumber(i);return`${n}:${a}`},formatNumber(t){return t<10?`0${t}`:t},setButtonState(t){var e,i;this.parentSetButtonState(t);(e=this.getUiButton())===null||e===void 0?void 0:e.setState((i=this.itemStateToButtonStateDict[this.currentState])!==null&&i!==void 0?i:null)},renderButton(){if(!this.buttonContainerRef){return}this.buttonContainerRef.innerHTML="";const t=new ui_buttons.Button(this.buttonOptions);t.renderTo(this.buttonContainerRef);this.uiButton=t}},watch:{state(t){this.setButtonState(t)}},mounted(){this.renderButton()},updated(){this.renderButton()},template:`\n\t\t<div\n\t\t\t:class="$attrs.class"\n\t\t\tref="buttonContainer"\n\t\t\t@click="executeAction">\n\t\t</div>\n\t`});const Buttons={components:{Button:Button},props:{items:{type:Array,required:false,default:()=>[]}},methods:{getButtonById(t){const e=this.$refs.buttons;return this.items.reduce(((i,n,a)=>{if(i){return i}if(n.id===t){return e[a]}return null}),null)}},template:`\n\t\t\t<div class="crm-timeline__card-action_buttons">\n\t\t\t\t<Button class="crm-timeline__card-action-btn" v-for="item in items" v-bind="item" ref="buttons" />\n\t\t\t</div>\n\t\t`};let ButtonScope=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonScope,"MOBILE","mobile");const Footer={components:{Buttons:Buttons,Menu:Menu$1,Button:Button,AdditionalButton:AdditionalButton},props:{buttons:Object,menu:Object,additionalButtons:{type:Object,required:false,default:()=>({})},maxBaseButtonsCount:{type:Number,required:false,default:3}},inject:["isReadOnly"],computed:{baseButtons(){return this.visibleAndSortedButtons.slice(0,this.maxBaseButtonsCount)},moreButtons(){return this.visibleAndSortedButtons.slice(this.maxBaseButtonsCount)},visibleAndSortedButtons(){return this.visibleButtons.sort(this.buttonsSorter)},visibleAndSortedAdditionalButtons(){return this.visibleAdditionalButtons.sort(this.buttonsSorter)},visibleButtons(){return this.buttons?Object.keys(this.buttons).map((t=>({id:t,...this.buttons[t]}))).filter(this.visibleButtonsFilter):[]},visibleAdditionalButtons(){return this.additionalButtonsArray?Object.values(this.additionalButtonsArray).filter(this.visibleButtonsFilter):[]},additionalButtonsArray(){return Object.entries(this.additionalButtons).map((([t,e])=>({id:t,type:ButtonType.ICON,...e})))},hasMenu(){return this.moreButtons.length||main_core.Type.isPlainObject(this.menu)&&Object.keys(this.menu).length}},methods:{visibleButtonsFilter(t){return t.state!==ButtonState.HIDDEN&&t.scope!==ButtonScope.MOBILE&&(!this.isReadOnly||!t.hideIfReadonly)},buttonsSorter(t,e){return(t===null||t===void 0?void 0:t.sort)-(e===null||e===void 0?void 0:e.sort)},getButtonById(t){if(this.$refs.buttons){const e=this.$refs.buttons.getButtonById(t);if(e){return e}}if(this.$refs.additionalButtons){return this.visibleAndSortedAdditionalButtons.reduce(((e,i,n)=>{if(e){return e}if(i.id===t){return buttons[n]}return null}),null)}return null}},template:`\n\t\t<div class="crm-timeline__card-action">\n\t\t\t<Buttons ref="buttons" :items="baseButtons" />\n\t\t\t<div class="crm-timeline__card-action_menu">\n\t\t\t\t<div\n\t\t\t\t\tv-for="button in visibleAndSortedAdditionalButtons"\n\t\t\t\t\t:key="button.id"\n\t\t\t\t\tclass="crm-timeline__card-action_menu-item"\n\t\t\t\t>\n\t\t\t\t\t<additional-button\n\t\t\t\t\t\tv-bind="button"\n\t\t\t\t\t>\n\t\t\t\t\t</additional-button>\n\t\t\t\t</div>\n\t\t\t\t<Menu v-if="hasMenu" :buttons="moreButtons" v-bind="menu" />\n\t\t\t</div>\n\t\t</div>\n\t`};const MarketPanel={props:{text:String,detailsText:String,detailsTextAction:Object},computed:{needShowDetailsText(){return main_core.Type.isStringFilled(this.detailsText)},href(){if(!this.detailsTextAction){return null}const t=new Action(this.detailsTextAction);if(t.isRedirect()){return t.getValue()}return null}},methods:{executeAction(){if(this.detailsTextAction){const t=new Action(this.detailsTextAction);t.execute(this)}}},template:`\n\t\t<div class="crm-timeline__card-bottom">\n\t\t<div class="crm-timeline__card-market">\n\t\t\t<div class="crm-timeline__card-market_container">\n\t\t\t\t<span class="crm-timeline__card-market_logo"></span>\n\t\t\t\t<span class="crm-timeline__card-market_text">{{ text }}</span>\n\t\t\t\t<a\n\t\t\t\t\tv-if="href && needShowDetailsText"\n\t\t\t\t\t:href="href"\n\t\t\t\t\tclass="crm-timeline__card-market_more"\n\t\t\t\t>\n\t\t\t\t\t{{detailsText}}\n\t\t\t\t</a>\n\t\t\t\t<span\n\t\t\t\t\tv-if="!href && needShowDetailsText"\n\t\t\t\t\t@click="executeAction"\n\t\t\t\t\tclass="crm-timeline__card-market_more"\n\t\t\t\t>\n\t\t\t\t{{detailsText}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-market_cross"><i></i></div>\n\t\t</div>\n\t\t</div>\n\t`};const UserPick={template:`\n\t\t<div class="ui-icon ui-icon-common-user crm-timeline__card-top_user-icon">\n\t\t\t<i></i>\n\t\t</div>\n\t`};const StreamType={history:0,scheduled:1,pinned:2};const Item$1={components:{Icon:Icon,Header:Header,Body:Body,Footer:Footer,MarketPanel:MarketPanel,UserPick:UserPick},props:{initialLayout:Object,id:String,useShortTimeFormat:Boolean,isLogMessage:Boolean,isReadOnly:Boolean,currentUser:Object|null,onAction:Function,streamType:{type:Number,required:false,default:StreamType.history}},data(){return{layout:this.initialLayout,isFaded:false,loader:Object.freeze(null)}},provide(){var t;return{isLogMessage:!!((t=this.initialLayout)!==null&&t!==void 0&&t.isLogMessage),isReadOnly:this.isReadOnly,currentUser:this.currentUser}},created(){this.$Bitrix.eventEmitter.subscribe("crm:timeline:item:action",this.onActionEvent)},beforeDestroy(){this.$Bitrix.eventEmitter.unsubscribe("crm:timeline:item:action",this.onActionEvent)},methods:{onActionEvent(t){const e=t.getData();this.onAction(main_core.Runtime.clone(e))},setLayout(t){this.layout=t;this.isFaded=false;this.$Bitrix.eventEmitter.emit("layout:updated")},setFaded(t){this.isFaded=t},showLoader(t){if(t){this.setFaded(true);if(!this.loader){this.loader=new main_loader.Loader}this.loader.show(this.$el.parentNode)}else{if(this.loader){this.loader.hide()}this.setFaded(false)}},getContentBlockById(t){if(!this.$refs.body){return null}return this.$refs.body.getContentBlockById(t)},getLogo(){if(!this.$refs.body){return null}return this.$refs.body.getLogo()},getHeaderChangeStreamButton(){if(!this.$refs.header){return null}return this.$refs.header.getChangeStreamButton()},getFooterButtonById(t){if(!this.$refs.footer){return null}return this.$refs.footer.getButtonById(t)},highlightContentBlockById(t,e){if(!e){this.isFaded=false}const i=this.getContentBlockById(t);if(!i){return}if(e){this.isFaded=true;main_core.Dom.addClass(i.$el,"--highlighted")}else{this.isFaded=false;main_core.Dom.removeClass(i.$el,"--highlighted")}}},computed:{timelineCardClassname(){return{"crm-timeline__card":true,"crm-timeline__card-scope":true,"--stream-type-history":this.streamType===StreamType.history,"--stream-type-scheduled":this.streamType===StreamType.scheduled,"--stream-type-pinned":this.streamType===StreamType.pinned,"--log-message":!!this.layout.isLogMessage}}},template:`\n\t\t<div :data-id="id" :class="timelineCardClassname">\n\t\t\t<div class="crm-timeline__card_fade" v-if="isFaded"></div>\n\t\t\t<div class="crm-timeline__card_icon_container">\n\t\t\t\t<Icon v-bind="layout.icon"></Icon>\n\t\t\t</div>\n\t\t\t<Header v-if="layout.header" v-bind="layout.header" :use-short-time-format="useShortTimeFormat" ref="header"></Header>\n\t\t\t<Body v-if="layout.body" v-bind="layout.body" ref="body"></Body>\n\t\t\t<Footer v-if="layout.footer" v-bind="layout.footer" ref="footer"></Footer>\n\t\t\t<MarketPanel v-if="layout.marketPanel" v-bind="layout.marketPanel"></MarketPanel>\n\t\t</div>\n\t`};function _classPrivateFieldInitSpec$2(t,e,i){_checkPrivateRedeclaration$2(t,e);e.set(t,i)}function _checkPrivateRedeclaration$2(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _layout=new WeakMap;let Layout=function(){function t(e){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec$2(this,_layout,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_layout,e)}babelHelpers.createClass(t,[{key:"asPlainObject",value:function t(){return main_core.Runtime.clone(babelHelpers.classPrivateFieldGet(this,_layout))}},{key:"getFooterMenuItemById",value:function t(e){var i,n,a,s;const o=(i=(n=babelHelpers.classPrivateFieldGet(this,_layout))===null||n===void 0?void 0:(a=n.footer)===null||a===void 0?void 0:(s=a.menu)===null||s===void 0?void 0:s.items)!==null&&i!==void 0?i:{};return o.hasOwnProperty(e)?o.id:null}},{key:"addFooterMenuItem",value:function t(e){babelHelpers.classPrivateFieldGet(this,_layout).footer=babelHelpers.classPrivateFieldGet(this,_layout).footer||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu=babelHelpers.classPrivateFieldGet(this,_layout).footer.menu||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items=babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items[e.id]=e}}]);return t}();let Base=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"onItemAction",value:function t(e,i){}},{key:"getContentBlockComponents",value:function t(e){return{}}},{key:"onAfterItemRefreshLayout",value:function t(e){}},{key:"onBeforeItemClearLayout",value:function t(e){}}],[{key:"isItemSupported",value:function t(e){return false}}]);return t}();function _classPrivateFieldInitSpec$3(t,e,i){_checkPrivateRedeclaration$3(t,e);e.set(t,i)}function _checkPrivateRedeclaration$3(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classStaticPrivateFieldSpecGet(t,e,i){_classCheckPrivateStaticAccess(t,e);_classCheckPrivateStaticFieldDescriptor(i,"get");return _classApplyDescriptorGet(t,i)}function _classCheckPrivateStaticFieldDescriptor(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function _classCheckPrivateStaticAccess(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function _classApplyDescriptorGet(t,e){if(e.get){return e.get.call(t)}return e.value}var _id=new WeakMap;let ControllerManager=function(){function t(e){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec$3(this,_id,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_id,e)}babelHelpers.createClass(t,[{key:"getItemControllers",value:function e(i){const n=[];for(const e of t.getRegisteredControllers()){if(e.isItemSupported(i)){n.push(new e)}}return n}}],[{key:"getInstance",value:function e(i){if(!_classStaticPrivateFieldSpecGet(this,t,_instances).hasOwnProperty(i)){_classStaticPrivateFieldSpecGet(this,t,_instances)[i]=new t(i)}return _classStaticPrivateFieldSpecGet(this,t,_instances)[i]}},{key:"registerController",value:function e(i){_classStaticPrivateFieldSpecGet(this,t,_availableControllers).push(i)}},{key:"getRegisteredControllers",value:function e(){return _classStaticPrivateFieldSpecGet(this,t,_availableControllers)}}]);return t}();var _instances={writable:true,value:{}};var _availableControllers={writable:true,value:[]};function _classPrivateMethodInitSpec$1(t,e){_checkPrivateRedeclaration$4(t,e);e.add(t)}function _classPrivateFieldInitSpec$4(t,e,i){_checkPrivateRedeclaration$4(t,e);e.set(t,i)}function _checkPrivateRedeclaration$4(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$1(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _container=new WeakMap;var _itemClassName=new WeakMap;var _type$1=new WeakMap;var _timelineId=new WeakMap;var _timestamp=new WeakMap;var _sort=new WeakMap;var _useShortTimeFormat=new WeakMap;var _isReadOnly=new WeakMap;var _currentUser=new WeakMap;var _ownerTypeId=new WeakMap;var _ownerId=new WeakMap;var _controllers=new WeakMap;var _layoutComponent=new WeakMap;var _layoutApp=new WeakMap;var _layout$1=new WeakMap;var _streamType=new WeakMap;var _initLayoutApp=new WeakSet;var _getLayoutAppProps=new WeakSet;var _onLayoutAppAction=new WeakSet;var _getContentBlockComponents=new WeakSet;let ConfigurableItem=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getContentBlockComponents);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_onLayoutAppAction);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_getLayoutAppProps);_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(i),_initLayoutApp);_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_container,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_itemClassName,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_type$1,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_timelineId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_timestamp,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_sort,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_useShortTimeFormat,{writable:true,value:false});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_isReadOnly,{writable:true,value:false});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_currentUser,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_ownerTypeId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_ownerId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_controllers,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layoutComponent,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layoutApp,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layout$1,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_streamType,{writable:true,value:null});return i}babelHelpers.createClass(e,[{key:"initialize",value:function t(e,i){this._setId(e);i=i||{};babelHelpers.classPrivateFieldSet(this,_timelineId,i.timelineId||"");this.setContainer(i.container||null);babelHelpers.classPrivateFieldSet(this,_itemClassName,i.itemClassName||"");if(main_core.Type.isPlainObject(i.data)){this.setData(i.data);babelHelpers.classPrivateFieldSet(this,_useShortTimeFormat,i.useShortTimeFormat||false);babelHelpers.classPrivateFieldSet(this,_isReadOnly,i.isReadOnly||false);babelHelpers.classPrivateFieldSet(this,_currentUser,i.currentUser||null);babelHelpers.classPrivateFieldSet(this,_ownerTypeId,i.ownerTypeId);babelHelpers.classPrivateFieldSet(this,_ownerId,i.ownerId);babelHelpers.classPrivateFieldSet(this,_streamType,i.streamType||crm_timeline_item.StreamType.history)}babelHelpers.classPrivateFieldSet(this,_controllers,ControllerManager.getInstance(babelHelpers.classPrivateFieldGet(this,_timelineId)).getItemControllers(this))}},{key:"setData",value:function t(e){babelHelpers.classPrivateFieldSet(this,_type$1,e.type||null);babelHelpers.classPrivateFieldSet(this,_timestamp,e.timestamp||null);babelHelpers.classPrivateFieldSet(this,_sort,e.sort||[]);babelHelpers.classPrivateFieldSet(this,_layout$1,new Layout(e.layout||{}))}},{key:"getLayout",value:function t(){return babelHelpers.classPrivateFieldGet(this,_layout$1)}},{key:"getType",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type$1)}},{key:"layout",value:function t(e){let i=true;let n=null;if(main_core.Type.isPlainObject(e)){i=BX.prop.getBoolean(e,"add",true);n=main_core.Type.isElementNode(e["anchor"])?e["anchor"]:null}this.setWrapper(main_core.Dom.create({tag:"div",attrs:{className:babelHelpers.classPrivateFieldGet(this,_itemClassName)}}));_classPrivateMethodGet$1(this,_initLayoutApp,_initLayoutApp2).call(this);if(i){if(n&&n.nextSibling){main_core.Dom.insertBefore(this.getWrapper(),n.nextSibling)}else{main_core.Dom.append(this.getWrapper(),babelHelpers.classPrivateFieldGet(this,_container))}}}},{key:"refreshLayout",value:function t(){if(babelHelpers.classPrivateFieldGet(this,_layoutComponent)){babelHelpers.classPrivateFieldGet(this,_layoutComponent).setLayout(this.getLayout().asPlainObject());for(const t of babelHelpers.classPrivateFieldGet(this,_controllers)){t.onAfterItemRefreshLayout(this)}}else{babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"refreshLayout",this).call(this)}}},{key:"getLayoutContentBlockById",value:function t(e){return babelHelpers.classPrivateFieldGet(this,_layoutComponent).getContentBlockById(e)}},{key:"getLogo",value:function t(){return babelHelpers.classPrivateFieldGet(this,_layoutComponent).getLogo()}},{key:"getLayoutFooterButtonById",value:function t(e){return babelHelpers.classPrivateFieldGet(this,_layoutComponent).getFooterButtonById(e)}},{key:"getLayoutHeaderChangeStreamButton",value:function t(){return babelHelpers.classPrivateFieldGet(this,_layoutComponent).getHeaderChangeStreamButton()}},{key:"highlightContentBlockById",value:function t(e,i){babelHelpers.classPrivateFieldGet(this,_layoutComponent).highlightContentBlockById(e,i)}},{key:"clearLayout",value:function t(){for(const t of babelHelpers.classPrivateFieldGet(this,_controllers)){t.onBeforeItemClearLayout(this)}babelHelpers.classPrivateFieldGet(this,_layoutApp).unmount();babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"clearLayout",this).call(this)}},{key:"getCreatedDate",value:function t(){const e=babelHelpers.classPrivateFieldGet(this,_timestamp)?babelHelpers.classPrivateFieldGet(this,_timestamp):Date.now()/1e3;return BX.prop.extractDate(crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(e).toUserTime().getValue())}},{key:"getSourceId",value:function t(){let e=this.getId();if(!main_core.Type.isInteger(e)){e=main_core.Text.toInteger(e.replace(/^\D+/g,""))}return e}},{key:"setContainer",value:function t(e){babelHelpers.classPrivateFieldSet(this,_container,e)}},{key:"getContainer",value:function t(){return babelHelpers.classPrivateFieldGet(this,_container)}},{key:"getDeadline",value:function t(){if(!babelHelpers.classPrivateFieldGet(this,_timestamp)){return null}return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(babelHelpers.classPrivateFieldGet(this,_timestamp)).toUserTime().getValue()}},{key:"getSort",value:function t(){return babelHelpers.classPrivateFieldGet(this,_sort)}},{key:"isReadOnly",value:function t(){return babelHelpers.classPrivateFieldGet(this,_isReadOnly)}},{key:"getCurrentUser",value:function t(){return babelHelpers.classPrivateFieldGet(this,_currentUser)}},{key:"clone",value:function t(){return e.create(this.getId(),{timelineId:babelHelpers.classPrivateFieldGet(this,_timelineId),container:this.getContainer(),itemClassName:babelHelpers.classPrivateFieldGet(this,_itemClassName),useShortTimeFormat:babelHelpers.classPrivateFieldGet(this,_useShortTimeFormat),isReadOnly:babelHelpers.classPrivateFieldGet(this,_isReadOnly),currentUser:babelHelpers.classPrivateFieldGet(this,_currentUser),streamType:babelHelpers.classPrivateFieldGet(this,_streamType),data:{type:babelHelpers.classPrivateFieldGet(this,_type$1),timestamp:babelHelpers.classPrivateFieldGet(this,_timestamp),sort:babelHelpers.classPrivateFieldGet(this,_sort),layout:this.getLayout().asPlainObject()}})}},{key:"reloadFromServer",value:function t(){const e={ownerTypeId:babelHelpers.classPrivateFieldGet(this,_ownerTypeId),ownerId:babelHelpers.classPrivateFieldGet(this,_ownerId)};if(babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.history||babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.pinned){e.historyIds=[this.getId()]}else if(babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.scheduled){e.activityIds=[this.getId()]}else{throw new Error("Wrong stream type")}return main_core.ajax.runAction("crm.timeline.item.load",{data:e}).then((t=>{Object.values(t.data).forEach((t=>{if(t.id===this.getId()){this.setData(t);this.refreshLayout()}}))})).catch((t=>{console.error(t)}))}}],[{key:"create",value:function t(i,n){const a=new e;a.initialize(i,n);return a}}]);return e}(Item);function _initLayoutApp2(){if(!babelHelpers.classPrivateFieldGet(this,_layoutApp)){babelHelpers.classPrivateFieldSet(this,_layoutApp,ui_vue3.BitrixVue.createApp(Item$1,_classPrivateMethodGet$1(this,_getLayoutAppProps,_getLayoutAppProps2).call(this)));const t=_classPrivateMethodGet$1(this,_getContentBlockComponents,_getContentBlockComponents2).call(this);for(const e in t){babelHelpers.classPrivateFieldGet(this,_layoutApp).component(e,t[e])}babelHelpers.classPrivateFieldSet(this,_layoutComponent,babelHelpers.classPrivateFieldGet(this,_layoutApp).mount(this.getWrapper()))}}function _getLayoutAppProps2(){return{initialLayout:this.getLayout().asPlainObject(),id:String(this.getId()),useShortTimeFormat:babelHelpers.classPrivateFieldGet(this,_useShortTimeFormat),isReadOnly:this.isReadOnly(),currentUser:this.getCurrentUser(),streamType:babelHelpers.classPrivateFieldGet(this,_streamType),onAction:_classPrivateMethodGet$1(this,_onLayoutAppAction,_onLayoutAppAction2).bind(this)}}function _onLayoutAppAction2(t){for(const e of babelHelpers.classPrivateFieldGet(this,_controllers)){e.onItemAction(this,t)}}function _getContentBlockComponents2(){let t={};for(const e of babelHelpers.classPrivateFieldGet(this,_controllers)){t=Object.assign(t,e.getContentBlockComponents(this))}return t}function _classPrivateMethodInitSpec$2(t,e){_checkPrivateRedeclaration$5(t,e);e.add(t)}function _checkPrivateRedeclaration$5(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$2(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _viewActivity=new WeakSet;var _editActivity=new WeakSet;var _deleteActivity=new WeakSet;var _getActivityEditor=new WeakSet;let Activity=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_getActivityEditor);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_deleteActivity);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_editActivity);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_viewActivity);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Activity:Edit"&&s&&s.activityId){_classPrivateMethodGet$2(this,_editActivity,_editActivity2).call(this,s.activityId)}if(n==="Activity:View"&&s&&s.activityId){_classPrivateMethodGet$2(this,_viewActivity,_viewActivity2).call(this,s.activityId)}if(n==="Activity:Delete"&&s&&s.activityId){var r;const t=(r=s.confirmationText)!==null&&r!==void 0?r:"";if(t){ui_dialogs_messagebox.MessageBox.show({message:t,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$2(this,_deleteActivity,_deleteActivity2).call(this,s.activityId,s.ownerTypeId,s.ownerId,o),onNo:t=>{t.close()}})}else{_classPrivateMethodGet$2(this,_deleteActivity,_deleteActivity2).call(this,s.activityId,s.ownerTypeId,s.ownerId)}}}}],[{key:"isItemSupported",value:function t(e){const i=e.getType();return i.indexOf("Activity:")===0||i==="TodoCreated"}}]);return e}(Base);function _viewActivity2(t){const e=_classPrivateMethodGet$2(this,_getActivityEditor,_getActivityEditor2).call(this);if(e&&t){e.viewActivity(t)}}function _editActivity2(t){const e=_classPrivateMethodGet$2(this,_getActivityEditor,_getActivityEditor2).call(this);if(e&&t){e.editActivity(t)}}function _deleteActivity2(t,e,i,n){if(n.onStart){n.onStart()}return main_core.ajax.runAction("crm.timeline.activity.delete",{data:{activityId:t,ownerTypeId:e,ownerId:i}}).then((()=>{if(n.onStop){n.onStop()}return true}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(n.onStop){n.onStop()}return true}))}function _getActivityEditor2(){return BX.CrmActivityEditor.getDefault()}let TextColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextColor,"GREEN","green");babelHelpers.defineProperty(TextColor,"BASE_50","base-50");babelHelpers.defineProperty(TextColor,"BASE_70","base-70");babelHelpers.defineProperty(TextColor,"BASE_90","base-90");let TextWeight=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextWeight,"NORMAL","normal");babelHelpers.defineProperty(TextWeight,"MEDIUM","medium");babelHelpers.defineProperty(TextWeight,"BOLD","bold");let TextSize=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextSize,"XS","xs");babelHelpers.defineProperty(TextSize,"SM","sm");babelHelpers.defineProperty(TextSize,"MD","md");var Text={props:{value:String|Number,title:{type:String,required:false,default:""},color:{type:String,required:false,default:""},weight:{type:String,required:false,default:"normal"},size:{type:String,required:false,default:"md"},multiline:{type:Boolean,required:false,default:false}},computed:{className(){return["crm-timeline__text-block",this.colorClassname,this.weightClassname,this.sizeClassname]},colorClassname(){const t=this.color?this.color.toUpperCase():"";const e=TextColor[t]?TextColor[t]:"";return`--color-${e}`},weightClassname(){const t=this.weight?this.weight.toUpperCase():"";const e=TextWeight[t]?TextWeight[t]:TextWeight.NORMAL;return`--weight-${e}`},sizeClassname(){const t=this.size?this.size.toUpperCase():"";const e=TextSize[t]?TextSize[t]:TextSize.SM;return`--size-${e}`},encodedText(){let t=main_core.Text.encode(this.value);if(this.multiline){t=t.replace(/\n/g,"<br />")}return t}},template:`\n\t\t<span\n\t\t\t:title="title"\n\t\t\t:class="className"\n\t\t\tv-html="encodedText"\n\t\t></span>`};var Link={props:{text:String,action:Object,bold:{type:Boolean,required:false,default:false}},computed:{href(){if(!this.action){return null}const t=new Action(this.action);if(t.isRedirect()){return t.getValue()}return null},className(){return{"crm-timeline__card_link":true,"--bold":this.bold}}},methods:{executeAction(){if(this.action){const t=new Action(this.action);t.execute(this)}}},template:`\n\t\t\t<a\n\t\t\t\tv-if="href"\n\t\t\t\t:href="href"\n\t\t\t\t:class="className"\n\t\t\t>\n\t\t\t{{text}}\n\t\t\t</a>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click="executeAction"\n\t\t\t\t:class="className"\n\t\t\t>\n\t\t\t\t{{text}}\n\t\t\t</span>\n\t\t`};var DateBlock={props:{withTime:{type:Boolean,required:false,default:true}},extends:Text,computed:{encodedText(){const t=crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.value).toUserTime();return main_core.Text.encode(this.withTime?t.toDatetimeString({delimiter:", "}):t.toDateString())}},template:Text.template};var WithTitle={props:{title:String,inline:Boolean,contentBlock:Object},computed:{className(){return{"crm-timeline__card-container_info":true,"--inline":this.inline}}},template:`\n\t\t\t<div :class="className">\n\t\t\t\t<div class="crm-timeline__card-container_info-title">{{ title }}</div>\n\t\t\t\t<div class="crm-timeline__card-container_info-value">\n\t\t\t\t\t<component :is="contentBlock.rendererName" v-bind="contentBlock.properties"></component>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`};var LineOfTextBlocks={props:{blocks:Object},mounted(){const t=this.$refs.blocks;this.visibleBlocks.forEach(((e,i)=>{if(main_core.Type.isDomNode(t[i].$el)){t[i].$el.setAttribute("data-id",e.id)}else{throw new Error('Vue component "'+e.rendererName+'" was not found')}}))},computed:{visibleBlocks(){return Object.keys(this.blocks).map((t=>({id:t,...this.blocks[t]}))).filter((t=>t.scope!=="mobile"))}},template:`\n\t\t<span class="crm-timeline-block-line-of-texts">\n\t\t\t<span\n\t\t\t\tv-for="(block) in visibleBlocks"\n\t\t\t\t:key="block.id"\n\t\t\t>\n\t\t\t\t<component :is="block.rendererName"\n\t\t\t\t\t\t   v-bind="block.properties"\n\t\t\t\t\t\t   ref="blocks"/>\n\t\t\t<span>&nbsp;</span>\n\t\t\t</span>\n\t\t</span>`};let LogoType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(LogoType,"CALL_AUDIO_PLAY","call-play-record");babelHelpers.defineProperty(LogoType,"CALL_AUDIO_PAUSE","call-pause-record");const defaultPlaybackRateValues=[.5,.7,1,1.2,1.5,1.7,2];const TimelineAudio=ui_vue3.BitrixVue.cloneComponent(ui_vue3_components_audioplayer.AudioPlayer,{props:{playbackRateValues:{type:Array,required:false,default:()=>defaultPlaybackRateValues},isShowPlaybackRateMenu:{type:Boolean,required:false,default:true}},data(){return{...this.parentData(),playbackRate:defaultPlaybackRateValues[2],isSeeking:false}},computed:{containerClassname(){return["crm-timeline__audioplayer-contianer","ui-vue-audioplayer-container",{"ui-vue-audioplayer-container-dark":this.isDark,"ui-vue-audioplayer-container-mobile":this.isMobile}]},controlClassname(){return["ui-vue-audioplayer-control","ui-btn-icon-start",{"ui-vue-audioplayer-control-loader":this.loading,"ui-vue-audioplayer-control-play":!this.loading&&this.state!==this.State.play,"ui-vue-audioplayer-control-pause":!this.loading&&this.state===this.State.play}]},timeCurrentClassname(){return["ui-vue-audioplayer-time","ui-vue-audioplayer-time-current",{"--is-playing":this.state===this.State.play}]},totalTimeClassname(){return["ui-vue-audioplayer-total-time"]},progressPosition(){return`width: ${this.progressInPixel}px;`},seekPosition(){var t;const e=20;const i=(t=this.$refs.seek)!==null&&t!==void 0&&t.offsetWidth?this.$refs.seek.offsetWidth:e;return`left: ${this.progressInPixel-i/2}px;`},formatTimeCurrent(){return this.formatTime(this.timeCurrent)},formatTimeTotal(){return this.formatTime(this.timeTotal)},playbackRateMenuItems(){return this.playbackRateValues.map((t=>this.createPlaybackRateMenuItem({text:this.getPlaybackRateOptionText(t),rate:t,isActive:t===this.playbackRate})))}},methods:{changePlaybackRate(t){var e,i;this.playbackRate=t;if((e=this.$refs)!==null&&e!==void 0&&(i=e.source)!==null&&i!==void 0&&i.playbackRate){this.$refs.source.playbackRate=t}},createPlaybackRateMenuItem(t={}){const e=t.rate||1;const i=t.text||"";const n=t.isActive||false;const a=`playback-speed-menu-item ${n?"menu-popup-item-accept-sm":""}`;return{text:i,className:a,onclick:(t,i)=>{this.changePlaybackRate(e);i.menuWindow.popupWindow.close();return true}}},getPlaybackRateOptionText(t){return this.isFloat(t)?`${t}x`:`${t}.0x`},showPlaybackRateMenu(){const t=new main_popup.Menu({id:`12xx${this.id}`,className:"crm-timeline__playback-speed-menu_scope",width:100,bindElement:this.$refs.playbackRateButtonContainer,events:{onPopupShow:()=>{const{width:e}=main_core.Dom.getPosition(this.$refs.playbackRateButtonContainer);const i=t.getPopupWindow();i.setOffset({offsetLeft:e/2});i.adjustPosition()}},angle:{position:"top"},offsetLeft:0,items:this.playbackRateMenuItems});t.show()},isFloat(t){return t%1!==0},startSeeking(t){this.isSeeking=true;const{clientX:e}=t;this.source().pause();main_core.bind(document,"mouseup",this.finishSeeking);main_core.bind(document,"mousemove",this.seeking);this.setSeekByCursor(e)},seeking(t){if(!this.isSeeking){return}const e=this.$refs.track;const{clientX:i}=t;const{left:n,right:a,width:s}=main_core.Dom.getPosition(e);if(i<n){this.seek=0}else if(i>a){this.seek=s-1}else{this.seek=i-n}this.setPosition();t.preventDefault()},finishSeeking(){this.isSeeking=false;this.setPosition();this.source().play();main_core.unbind(document,"mouseup",this.finishSeeking);main_core.unbind(document,"mousemove",this.seeking)},setSeekByCursor(t){const e=this.$refs.track;const{clientX:i}=event;const{left:n,right:a,width:s}=main_core.Dom.getPosition(e);if(i<n){this.seek=0}else if(t>a){this.seek=s}else{this.seek=i-n}},setPosition(t){if(!this.loaded){this.loadFile(true);return false}const e=this.$refs.track.offsetWidth/100;this.setProgress(this.seek/e,this.seek);this.source().currentTime=this.timeTotal/100*this.progress},changeLogoIcon(t){if(!this.$parent){return}const e=this.$parent.getLogo();if(!e){return}e.setIcon(t)},audioEventRouterWrapper(t,e){this.audioEventRouter(t,e);if(t==="play"){this.changeLogoIcon(LogoType.CALL_AUDIO_PAUSE)}if(t==="pause"){this.changeLogoIcon(LogoType.CALL_AUDIO_PLAY)}}},template:`\n\t\t<div\n\t\t\t:class="containerClassname"\n\t\t\tref="body"\n\t\t>\n\t\t\t<div class="ui-vue-audioplayer-controls-container">\n\t\t\t\t<button :class="controlClassname" @click="clickToButton">\n\t\t\t\t\t<svg v-if="state !== State.play" class="ui-vue-audioplayer-control-icon" width="9" height="12" viewBox="0 0 9 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M8.52196 5.40967L1.77268 0.637568C1.61355 0.523473 1.40621 0.510554 1.23498 0.604066C1.06375 0.697578 0.957151 0.881946 0.958524 1.0822V10.6259C0.956507 10.8265 1.06301 11.0114 1.23449 11.105C1.40597 11.1987 1.61368 11.1854 1.77268 11.0706L8.52196 6.29847C8.66466 6.19871 8.75016 6.0322 8.75016 5.85407C8.75016 5.67593 8.66466 5.50942 8.52196 5.40967Z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<svg v-else width="8" height="10" viewBox="0 0 8 10" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path d="M2.5625 0.333008H0.375V9.66634H2.5625V0.333008Z" fill="inherit" />\n\t\t\t\t\t\t<path d="M7.25 0.333008H5.0625V9.66634H7.25V0.333008Z" fill="inherit" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="ui-vue-audioplayer-timeline-container">\n\t\t\t\t<div class="ui-vue-audioplayer-track-container" @mousedown="startSeeking" ref="track">\n\t\t\t\t\t<div class="ui-vue-audioplayer-track-mask"></div>\n\t\t\t\t\t<div class="ui-vue-audioplayer-track" :style="progressPosition"></div>\n\t\t\t\t\t<div @mousedown="startSeeking" class="ui-vue-audioplayer-track-seek" :style="seekPosition">\n\t\t\t\t\t\t<div ref="seek" class="ui-vue-audioplayer-track-seek-icon"></div>\n\t\t\t\t\t</div>\n\x3c!--\t\t\t\t\t<div class="ui-vue-audioplayer-track-event" @mousemove="seeking"></div>--\x3e\n\t\t\t\t</div>\n\t\t\t\t<div :class="totalTimeClassname">\n\t\t\t\t\t<div :class="timeCurrentClassname">{{formatTimeCurrent}}</div>\n\t\t\t\t\t<div ref="totalTime" class="ui-vue-audioplayer-time">{{formatTimeTotal}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\t@click="showPlaybackRateMenu"\n\t\t\t\tref="playbackRateButtonContainer"\n\t\t\t\tclass="ui-vue-audioplayer_playback-speed-menu-container"\n\t\t\t>\n\t\t\t\t{{ getPlaybackRateOptionText(playbackRate) }}\n\t\t\t</div>\n\t\t\t<audio\n\t\t\t\tv-if="src"\n\t\t\t\t:src="src"\n\t\t\t\tclass="ui-vue-audioplayer-source"\n\t\t\t\tref="source"\n\t\t\t\t:preload="preload"\n\t\t\t\t@abort="audioEventRouter('abort', $event)"\n\t\t\t\t@error="audioEventRouter('error', $event)"\n\t\t\t\t@suspend="audioEventRouter('suspend', $event)"\n\t\t\t\t@canplay="audioEventRouter('canplay', $event)"\n\t\t\t\t@canplaythrough="audioEventRouter('canplaythrough', $event)"\n\t\t\t\t@durationchange="audioEventRouter('durationchange', $event)"\n\t\t\t\t@loadeddata="audioEventRouter('loadeddata', $event)"\n\t\t\t\t@loadedmetadata="audioEventRouter('loadedmetadata', $event)"\n\t\t\t\t@timeupdate="audioEventRouter('timeupdate', $event)"\n\t\t\t\t@play="audioEventRouterWrapper('play', $event)"\n\t\t\t\t@playing="audioEventRouter('playing', $event)"\n\t\t\t\t@pause="audioEventRouterWrapper('pause', $event)"\n\t\t\t></audio>\n\t\t</div>\n\t`});let ClientMark=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ClientMark,"POSITIVE","positive");babelHelpers.defineProperty(ClientMark,"NEUTRAL","neutral");babelHelpers.defineProperty(ClientMark,"NEGATIVE","negative");const ClientMark$1={props:{mark:{type:String,required:false,default:ClientMark.POSITIVE},text:{type:String,required:false,default:""}},computed:{className(){return{"crm-timeline__client-mark":true,"--positive-mark":this.mark===ClientMark.POSITIVE,"--neutral-mark":this.mark===ClientMark.NEUTRAL,"--negative-mark":this.mark===ClientMark.NEGATIVE}},iconClassname(){return{"crm-timeline__client-mark_icon":true,"--flipped":this.mark===ClientMark.NEGATIVE}}},template:`\n\t\t<div :class="className">\n\t\t\t<i class="crm-timeline__client-mark_icon-wrapper">\n\t\t\t\t<svg :class="iconClassname" width="11.35" height="11.36" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M14.8367 6.7166L11.2351 6.71731C11.1314 6.71731 11.0313 6.65735 10.9925 6.56213C10.8303 6.15654 10.8366 5.69947 11.0144 5.29671C11.3127 4.42841 11.3466 3.49029 11.1124 2.60224C10.8676 1.9914 10.8028 0.875521 9.67347 0.82403C9.32009 0.876226 9.01184 1.08854 8.8341 1.39819C8.80235 1.45321 8.78895 1.5181 8.78895 1.58088C8.78895 1.58088 8.84085 2.6644 8.78895 3.41764C8.73706 4.17087 7.29571 6.08954 6.37945 7.30769C6.32161 7.38528 6.24049 7.43607 6.14456 7.45088C5.80104 7.50232 5.14581 7.58943 4.90962 7.62062C4.85434 7.62792 4.82201 7.69735 4.82201 7.72994C4.82201 9.2527 4.82201 11.5306 4.82201 14.5636C4.82201 14.5887 4.85234 14.6435 4.90623 14.6524C5.09126 14.6829 5.55408 14.7676 6.02112 14.9178C6.60798 15.1061 7.0968 15.5519 8.07513 15.882C8.12662 15.8997 8.18375 15.9088 8.23807 15.9088H12.8321C13.4253 15.803 13.8668 15.2959 13.8972 14.6872C13.9056 14.3479 13.8379 14.0121 13.699 13.7039C13.6792 13.6594 13.7053 13.6129 13.7533 13.6037C14.3422 13.4965 15.0786 12.3785 14.1715 11.4778C14.1476 11.4545 14.1518 11.4228 14.1842 11.4143C14.6843 11.2866 15.0674 10.8874 15.1844 10.3894C15.2296 10.199 15.2134 10.0022 15.1569 9.81524C15.0906 9.59235 14.9848 9.38356 14.8445 9.19735C14.8092 9.15079 14.8289 9.09013 14.8854 9.07179C15.3834 8.90321 15.7262 8.4271 15.7226 7.88538C15.7798 7.35424 15.353 6.71731 14.8367 6.7166ZM3.412 7.00439H0.808518C0.673089 7.00439 0.570107 7.1243 0.593384 7.25479L2.10567 15.7508C2.12895 15.8813 2.24392 15.9766 2.37865 15.9766H3.34146C3.49029 15.9766 3.61091 15.8588 3.61091 15.7135L3.63207 7.22023C3.63207 7.10102 3.53403 7.00439 3.412 7.00439Z"/>\n\t\t\t\t</svg>\n\t\t\t</i>\n\t\t\t<span class="crm-timeline__client-mark_text">{{ text }}</span>\n\t\t</div>\n\t`};var Money={props:{opportunity:Number,currencyId:String},computed:{moneyHtml(){if(!main_core.Type.isNumber(this.opportunity)||!main_core.Type.isStringFilled(this.currencyId)){return null}return currency_currencyCore.CurrencyCore.currencyFormat(this.opportunity,this.currencyId,true)}},template:`<span v-if="moneyHtml" v-html="moneyHtml"></span>`};var EditableText=ui_vue3.BitrixVue.cloneComponent(Text,{components:{Text:Text},props:{action:Object},data(){return{isEdit:false,currentValue:this.value,initialValue:this.value,actionTimeoutId:null}},computed:{textProps(){return{...this.$props,value:this.currentValue}}},methods:{enableEdit(){this.cancelScheduledActionExecution();this.isEdit=true;this.$nextTick((()=>{this.$refs.input.focus()}))},disableEdit(){this.isEdit=false;this.scheduleActionExecution()},scheduleActionExecution(){this.cancelScheduledActionExecution();this.actionTimeoutId=setTimeout(this.executeAction.bind(this),3*1e3)},cancelScheduledActionExecution(){if(this.actionTimeoutId){clearTimeout(this.actionTimeoutId);this.actionTimeoutId=null}},executeAction(){var t;if(!this.action||this.currentValue===this.initialValue){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentValue;const i=new Action(e);i.execute(this);this.initialValue=this.currentValue}},template:`\n\t\t\t<input\n\t\t\t\tv-if="isEdit"\n\t\t\t\tref="input"\n\t\t\t\ttype="text"\n\t\t\t\tv-model.trim="currentValue"\n\t\t\t\t@focusout="disableEdit"\n\t\t\t>\n\t\t\t<Text\n\t\t\t\tv-else\n\t\t\t\tv-bind="textProps"\n\t\t\t\t@click="enableEdit"\n\t\t\t/>\n\t\t`});const EditableDescription={components:{Button:Button},props:{text:{type:String,required:false,default:""},saveAction:{type:Object,required:false,default:()=>({})}},data(){return{value:this.text,oldValue:this.text,isEdit:false,isSaving:false,isLongText:false,isCollapsed:false}},inject:["isReadOnly"],computed:{className(){return["crm-timeline__editable-text",{"--is-edit":this.isEdit,"--is-long":this.isLongText,"--is-expanded":this.isCollapsed||!this.isLongText}]},saveTextButtonProps(){return{state:this.saveTextButtonState,type:ButtonType.PRIMARY,title:this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_SAVE")}},cancelEditingButtonProps(){return{type:ButtonType.LIGHT,title:this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_CANCEL"),state:this.isSaving?ButtonState.DISABLED:ButtonState.DEFAULT}},saveTextButtonState(){const t=this.value.trim();if(t.length===0){return ButtonState.DISABLED}else if(this.isSaving){return ButtonState.LOADING}else{return ButtonState.DEFAULT}},expandButtonText(){return this.isCollapsed?this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_HIDE"):this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_SHOW")}},methods:{startEditing(){this.isEdit=true;this.isCollapsed=true;this.$nextTick((()=>{const t=this.$refs.textarea;this.adjustHeight(t);t.focus()}));this.emitEvent("EditableDescription:StartEdit")},emitEvent(t){const e=new Action({type:"jsEvent",value:t});e.execute(this)},adjustHeight(t){t.style.height=0;t.style.height=t.scrollHeight+"px"},onPressEnter(t){if(t.ctrlKey===true||main_core.Browser.isMac()&&(t.metaKey===true||t.altKey===true)){this.saveText()}},saveText(){if(this.saveTextButtonState===ButtonState.DISABLED||this.saveTextButtonState===ButtonState.LOADING||!this.isEdit){return}if(this.value.trim()===this.oldValue){this.isEdit=false;this.emitEvent("EditableDescription:FinishEdit")}this.isSaving=true;const t=this.value.trim();this.executeSaveAction(t).then((()=>{this.isEdit=false;this.oldValue=t;this.value=t;this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}));this.emitEvent("EditableDescription:FinishEdit")})).finally((()=>{this.isSaving=false}))},executeSaveAction(t){var e;if(!this.saveAction){return}if(!this.value){return}const i=main_core.Runtime.clone(this.saveAction);(e=i.actionParams)!==null&&e!==void 0?e:i.actionParams={};i.actionParams.value=t;const n=new Action(i);return n.execute(this)},cancelEditing(){if(!this.isEdit||this.isSaving){return}this.value=this.oldValue;this.isEdit=false;this.emitEvent("EditableDescription:FinishEdit")},clearText(){if(this.isSaving){return}this.value="";this.$refs.textarea.focus()},toggleIsCollapsed(){this.isCollapsed=!this.isCollapsed},checkIsLongText(){var t;const e=this.$refs.text;if(!e)return false;const i=window.getComputedStyle(e).getPropertyValue("--crm-timeline__editable-text_max-height");const n=parseFloat(i.slice(0,-2));return((t=this.$refs.rootElement)===null||t===void 0?void 0:t.offsetHeight)>n}},watch:{text(t){this.value=t;this.oldValue=t;this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}))},value(){if(!this.isEdit)return;this.$nextTick((()=>{this.adjustHeight(this.$refs.textarea)}))}},mounted(){this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}))},template:`\n\t\t<div class="crm-timeline__editable-text_wrapper">\n\t\t\t<div ref="rootElement" :class="className">\n\t\t\t\t<button\n\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t:disabled="isSaving"\n\t\t\t\t\t@click="clearText"\n\t\t\t\t\tclass="crm-timeline__editable-text_clear-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_clear-icon"></i>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="isLongText && !isEdit && !isReadOnly"\n\t\t\t\t\t:disabled="isSaving"\n\t\t\t\t\t@click="startEditing"\n\t\t\t\t\tclass="crm-timeline__editable-text_edit-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_edit-icon"></i>\n\t\t\t\t</button>\n\t\t\t\t<div class="crm-timeline__editable-text_inner">\n\t\t\t\t\t<div class="crm-timeline__editable-text_content">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\t\tref="textarea"\n\t\t\t\t\t\t\tv-model="value"\n\t\t\t\t\t\t\t:disabled="!isEdit || isSaving"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_PLACEHOLDER')"\n\t\t\t\t\t\t\t@keydown.esc="cancelEditing"\n\t\t\t\t\t\t\t@keydown.enter="onPressEnter"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tref="text"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{value}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if="!isEdit && !isLongText && !isReadOnly"\n\t\t\t\t\t\t\t@click="startEditing"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text-edit-icon"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="crm-timeline__editable-text_edit-icon"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\tclass="crm-timeline__editable-text_actions"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="saveTextButtonProps"\n\t\t\t\t\t\t\t\t@click="saveText"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="cancelEditingButtonProps"\n\t\t\t\t\t\t\t\t@click="cancelEditing"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if="isLongText && !isEdit"\n\t\t\t\t\t@click="toggleIsCollapsed"\n\t\t\t\t\tclass="crm-timeline__editable-text_collapse-btn"\n\t\t\t\t>\n\t\t\t\t\t{{ expandButtonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};var EditableDate={components:{Link:Link},props:{value:Number,withTime:Boolean,action:Object},data(){return{currentDate:this.value,initialDate:this.value,actionTimeoutId:null}},computed:{currentDateObject(){return this.currentDate?new Date(this.currentDate*1e3):null},currentDateInSiteFormat(){if(!this.currentDateObject){return null}return main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),this.currentDateObject)},textProps(){return{text:this.currentDateInSiteFormat}}},methods:{openCalendar(t){this.cancelScheduledActionExecution();BX.calendar({node:t.target,value:this.currentDateInSiteFormat,bTime:this.withTime,bHideTime:!this.withTime,bSetFocus:false,callback_after:t=>{this.currentDate=Math.round(t.getTime()/1e3);this.scheduleActionExecution()}})},scheduleActionExecution(){this.cancelScheduledActionExecution();this.actionTimeoutId=setTimeout(this.executeAction.bind(this),3*1e3)},cancelScheduledActionExecution(){if(this.actionTimeoutId){clearTimeout(this.actionTimeoutId);this.actionTimeoutId=null}},executeAction(){var t;if(!this.action){return}if(this.currentDate===this.initialDate){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentDateObject;const i=new Action(e);i.execute(this);this.initialDate=this.currentDate}},template:`<Link @click="openCalendar" v-bind="textProps"></Link>`};const PlayerAlert={components:{LineOfTextBlocks:LineOfTextBlocks},props:{blocks:{type:Object,required:false,default:()=>({})},color:{type:String,required:false,default:ui_alerts.AlertColor.DEFAULT},icon:{type:String,required:false,default:ui_alerts.AlertIcon.NONE}},computed:{containerClassname(){return["crm-timeline__player-alert","ui-alert","ui-alert-xs","ui-alert-text-center",this.color,this.icon]}},template:`\n\t\t<div :class="containerClassname">\n\t\t\t<div class="ui-alert-message">\n\t\t\t\t<LineOfTextBlocks :blocks="blocks"></LineOfTextBlocks>\n\t\t\t</div>\n\t\t</div>\n\t`};const Note={components:{User:User,Button:Button},props:{id:{type:Number,required:false},text:{type:String,required:false,default:""},deleteConfirmationText:{type:String,required:false,default:""},saveNoteAction:{type:Object},deleteNoteAction:{type:Object},updatedBy:{type:Object,required:false}},data(){return{note:this.text,oldNote:this.text,isEdit:false,isExist:!!this.id,isSaving:false,isDeleting:false}},inject:["isReadOnly","currentUser"],computed:{ButtonType(){return ButtonType},isDeleteButtonVisible(){return this.isEdit&&!(this.isReadOnly||this.isSaving)},isEditButtonVisible(){return!(this.isReadOnly||this.isEdit)},saveButtonState(){if(this.isSaving){return ButtonState.LOADING}if(this.note.trim().length>0){return ButtonState.DEFAULT}return ButtonState.DISABLED},cancelButtonState(){if(this.isSaving){return ButtonState.DISABLED}return ButtonState.DEFAULT},isNoteVisible(){return this.isExist||this.isEdit},user(){if(this.updatedBy){return this.updatedBy}if(this.currentUser){return this.currentUser}return{title:"",detailUrl:"",imageUrl:""}}},methods:{startEditing(){this.isEdit=true;this.$nextTick((()=>{const t=this.$refs.noteText;this.adjustHeight(t);t.focus()}));this.executeAction({type:"jsEvent",value:"Note:StartEdit"})},adjustHeight(t){t.style.height=0;t.style.height=t.scrollHeight+"px"},setEditMode(t){const e=t?!this.isReadOnly:false;if(e!==this.isEdit){if(e){this.startEditing()}else{this.isEdit=false;this.executeAction({type:"jsEvent",value:"Note:FinishEdit"})}}},onEnterHandle(t){if(t.ctrlKey===true||main_core.Browser.isMac()&&(t.metaKey===true||t.altKey===true)){this.saveNote()}},cancelEditing(){this.note=this.oldNote;this.isEdit=false;this.executeAction({type:"jsEvent",value:"Note:FinishEdit"})},deleteNote(){if(this.isSaving){return}if(!this.isExist){this.cancelEditing();return}if(this.deleteConfirmationText&&this.deleteConfirmationText.length){ui_dialogs_messagebox.MessageBox.show({message:this.deleteConfirmationText,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:t=>{t.close();this.executeDeleteAction()},onNo:t=>{t.close()}})}else{this.executeDeleteAction()}},saveNote(){if(this.saveButtonState===ButtonState.DISABLED||this.isSaving||this.isDeleting){return}if(this.note===this.text){this.cancelEditing();return}this.isSaving=true;const t=main_core.Runtime.clone(this.saveNoteAction);t.actionParams.text=this.note;this.executeAction(t).then((({status:t})=>{if(t==="success"){this.oldNote=this.$refs.noteText.value.trim();this.isExist=true;this.cancelEditing()}})).finally((()=>{this.isSaving=false}))},executeDeleteAction(){this.isDeleting=true;this.executeAction(this.deleteNoteAction).then((({status:t})=>{if(t==="success"){this.oldNote="";this.isExist=false;this.cancelEditing()}})).finally((()=>{this.isDeleting=false}))},executeAction(t){if(!t){console.error("No action object to execute");return}const e=new Action(t);return e.execute(this)}},watch:{id(t){this.isExist=!!t},text(t){this.note=t;this.oldNote=t},note(){if(!this.isEdit){return}this.$nextTick((()=>{this.adjustHeight(this.$refs.noteText)}))},isEdit(t){if(t){this.$nextTick((()=>this.$refs.noteText.focus()))}}},template:`\n\t\t<div class="crm-timeline__card-note" v-show="isNoteVisible">\n\t\t<div class="crm-timeline__card-note_user">\n\t\t\t<User v-bind="user"></User>\n\t\t</div>\n\t\t<div class="crm-timeline__card-note_area">\n\t\t\t<div class="crm-timeline__card-note_value">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\tv-model="note"\n\t\t\t\t\t\t@keydown.esc="cancelEditing"\n\t\t\t\t\t\t@keydown.enter="onEnterHandle"\n\t\t\t\t\t\t:disabled="!isEdit || isSaving"\n\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_PLACEHOLDER')"\n\t\t\t\t\t\tref="noteText"\n\t\t\t\t\t\tclass="crm-timeline__card-note_text"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tclass="crm-timeline__card-note_text"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{note}}\n\t\t\t\t\t</span>\n\n\t\t\t\t<span\n\t\t\t\t\tv-if="isEditButtonVisible"\n\t\t\t\t\tclass="crm-timeline__card-note_edit"\n\t\t\t\t\t@click.prevent.stop="startEditing"\n\t\t\t\t>\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div v-if="isEdit" class="crm-timeline__card-note__controls">\n\t\t\t\t<div class="crm-timeline__card-note__control --save">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t@click="saveNote"\n\t\t\t\t\t\t:state="saveButtonState" :type="ButtonType.PRIMARY"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_SAVE')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-timeline__card-note__control --cancel">\n\t\t\t\t\t<Button @click="cancelEditing"\n\t\t\t\t\t\t\t:type="ButtonType.LIGHT"\n\t\t\t\t\t\t\t:state="cancelButtonState"\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_CANCEL')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="isDeleteButtonVisible" class="crm-timeline__card-note_cross" @click="deleteNote">\n\t\t\t<i></i>\n\t\t</div>\n\t\t<div v-if="isDeleting" class="crm-timeline__card-note_dimmer"></div>\n\t\t</div>\n\t`};const DatePillColor=Object.freeze({DEFAULT:"default",WARNING:"warning"});var DatePill={props:{value:Number,withTime:Boolean,backgroundColor:{type:String,required:false,default:DatePillColor.DEFAULT,validator(t){return Object.values(DatePillColor).includes(t)}},action:Object|null},inject:["isReadOnly"],data(){return{currentTimestamp:this.value,initialTimestamp:this.value,actionTimeoutId:null}},computed:{className(){return["crm-timeline__date-pill",`--color-${this.backgroundColor}`,{"--readonly":this.isPillReadonly}]},formattedDate(){if(!this.currentTimestamp){return null}return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.currentTimestamp).toUserTime().toDatetimeString({withDayOfWeek:true,delimiter:", "})},currentDateInSiteFormat(){return main_date.DateTimeFormat.format(this.withTime?crm_timeline_tools.DatetimeConverter.getSiteDateTimeFormat():crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.currentTimestamp).toUserTime().getValue())},calendarParams(){return{value:this.currentDateInSiteFormat,bTime:this.withTime,bHideTime:!this.withTime,bSetFocus:false}},isPillReadonly(){return this.isReadOnly||!this.action}},watch:{value(t){this.initialTimestamp=t;this.currentTimestamp=t}},methods:{openCalendar(t){if(this.isPillReadonly){return}this.cancelScheduledActionExecution();BX.calendar({node:t.target,callback_after:t=>{this.currentTimestamp=crm_datetime.TimestampConverter.userToBrowser(t.getTime()/1e3);this.executeAction()},...this.calendarParams})},cancelScheduledActionExecution(){if(this.actionTimeoutId){clearTimeout(this.actionTimeoutId);this.actionTimeoutId=null}},executeAction(){var t;if(!this.action){return}if(this.currentTimestamp===this.initialTimestamp){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentDateInSiteFormat;const i=new Action(e);i.execute(this);this.initialTimestamp=this.currentTimestamp}},template:`\n\t\t<span\n\t\t\t:class="className"\n\t\t\t@click="openCalendar"\n\t\t>\n\t\t\t<span>\n\t\t\t\t{{ formattedDate }}\n\t\t\t</span>\n\t\t\t<span class="crm-timeline__date-pill_caret"></span>\n\t\t</span>`};const InfoGroup={props:{blocks:{type:Object,required:false,default:()=>({})}},template:`\n\t\t<table class="crm-timeline__info-group">\n\t\t\t<tbody>\n\t\t\t\t<tr\n\t\t\t\t\tv-for="({title, block}, id) in blocks"\n\t\t\t\t\t:key="id"\n\t\t\t\t\tclass="crm-timeline__info-group_block"\n\t\t\t\t>\n\t\t\t\t\t<td\n\t\t\t\t\t\t:title="title"\n\t\t\t\t\t\tclass="crm-timeline__info-group_block-title"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{title}}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="crm-timeline__info-group_block-content">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="block.rendererName"\n\t\t\t\t\t\t\tv-bind="block.properties"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t`};const SmsMessage={props:{contentBlock:Object},template:`\n\t\t<div\n\t\t\tclass="crm-timeline__item_sms-message">\n\t\t\t<span>\n\t\t\t\t<component v-if="contentBlock" :is="contentBlock.rendererName" v-bind="contentBlock.properties"></component>\n\t\t\t</span>\n\t\t</div>\n\t`};function _classPrivateMethodInitSpec$3(t,e){_checkPrivateRedeclaration$6(t,e);e.add(t)}function _checkPrivateRedeclaration$6(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$3(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openEntityDetailTab=new WeakSet;var _editNote=new WeakSet;var _cancelEditNote=new WeakSet;let CommonContentBlocks=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_cancelEditNote);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_editNote);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_openEntityDetailTab);return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{TextBlock:Text,LinkBlock:Link,DateBlock:DateBlock,WithTitle:WithTitle,LineOfTextBlocks:LineOfTextBlocks,TimelineAudio:TimelineAudio,ClientMark:ClientMark$1,Money:Money,EditableText:EditableText,EditableDescription:EditableDescription,EditableDate:EditableDate,PlayerAlert:PlayerAlert,DatePill:DatePill,Note:Note,InfoGroup:InfoGroup,SmsMessage:SmsMessage}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Item:OpenEntityDetailTab"&&main_core.Type.isStringFilled(s===null||s===void 0?void 0:s.tabId)){_classPrivateMethodGet$3(this,_openEntityDetailTab,_openEntityDetailTab2).call(this,s.tabId)}if(n==="Note:StartEdit"){_classPrivateMethodGet$3(this,_editNote,_editNote2).call(this,e)}if(n==="Note:FinishEdit"){_classPrivateMethodGet$3(this,_cancelEditNote,_cancelEditNote2).call(this,e)}}}],[{key:"isItemSupported",value:function t(e){return true}}]);return e}(Base);function _openEntityDetailTab2(t){BX.onCustomEvent(window,"OpenEntityDetailTab",[t])}function _editNote2(t){var e;(e=t.getLayoutContentBlockById("note"))===null||e===void 0?void 0:e.setEditMode(true);t.highlightContentBlockById("note",true)}function _cancelEditNote2(t){var e;(e=t.getLayoutContentBlockById("note"))===null||e===void 0?void 0:e.setEditMode(false);t.highlightContentBlockById("note",false)}var ValueChange={props:{from:String,to:String},template:`<div class="crm-entity-stream-content-detail-info">\n\t<span class="crm-entity-stream-content-detain-info-status" v-if="from">{{from}}</span>\n\t<span class="crm-entity-stream-content-detail-info-separator-icon" v-if="from"></span>\n\t<span class="crm-entity-stream-content-detain-info-status" v-if="to">{{to}}</span>\n\t</div>`};let Modification=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{ValueChange:ValueChange}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Modification"}}]);return e}(Base);var ChatMessage={props:{messageHtml:String,isIncoming:Boolean},computed:{className(){return"crm-entity-stream-content-detail-IM-message-"+(this.isIncoming?"incoming":"outgoing")}},template:`<div class="crm-entity-stream-content-detail-IM"><div :class="[className]" v-html="messageHtml"></div></div>`};function _classPrivateMethodInitSpec$4(t,e){_checkPrivateRedeclaration$7(t,e);e.add(t)}function _checkPrivateRedeclaration$7(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$4(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openChat=new WeakSet;let OpenLines=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$4(babelHelpers.assertThisInitialized(i),_openChat);return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{ChatMessage:ChatMessage}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Openline:OpenChat"&&s&&s.dialogId){_classPrivateMethodGet$4(this,_openChat,_openChat2).call(this,s.dialogId)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:OpenLine"}}]);return e}(Base);function _openChat2(t){if(window.top["BXIM"]){window.top["BXIM"].openMessengerSlider(t,{RECENT:"N",MENU:"N"})}}function _classPrivateMethodInitSpec$5(t,e){_checkPrivateRedeclaration$8(t,e);e.add(t)}function _checkPrivateRedeclaration$8(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$5(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _deleteEntry=new WeakSet;var _openDocument=new WeakSet;var _modifyDocument=new WeakSet;var _updateActivityDeadline=new WeakSet;var _resendDocument=new WeakSet;var _touchSigner=new WeakSet;var _download=new WeakSet;let SignDocument=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_download);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_touchSigner);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_resendDocument);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_updateActivityDeadline);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_modifyDocument);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_openDocument);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_deleteEntry);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}const r=main_core.Text.toInteger(s===null||s===void 0?void 0:s.documentId);const l=(s===null||s===void 0?void 0:s.documentHash)||"";const c=main_core.Text.toInteger(s===null||s===void 0?void 0:s.activityId);if((n==="SignDocument:Open"||n==="Activity:SignDocument:Open")&&r>0){_classPrivateMethodGet$5(this,_openDocument,_openDocument2).call(this,s)}else if((n==="SignDocument:Modify"||n==="Activity:SignDocument:Modify")&&r>0){_classPrivateMethodGet$5(this,_modifyDocument,_modifyDocument2).call(this,s)}else if((n==="SignDocument:UpdateActivityDeadline"||n==="Activity:SignDocument:UpdateActivityDeadline")&&c>0){_classPrivateMethodGet$5(this,_updateActivityDeadline,_updateActivityDeadline2).call(this,c,s===null||s===void 0?void 0:s.value)}else if(n==="SignDocument:Resend"&&r>0&&s!==null&&s!==void 0&&s.recipientHash){_classPrivateMethodGet$5(this,_resendDocument,_resendDocument2).call(this,s,o).then((()=>{if(s.buttonId){const t=e.getLayoutFooterButtonById(s.buttonId);t.disableWithTimer(60)}}))}else if(n==="SignDocument:TouchSigner"&&r>0){_classPrivateMethodGet$5(this,_touchSigner,_touchSigner2).call(this,s)}else if(n==="SignDocument:Download"&&l){_classPrivateMethodGet$5(this,_download,_download2).call(this,s,o)}else if(n==="SignDocumentEntry:Delete"&&s!==null&&s!==void 0&&s.entryId){ui_dialogs_messagebox.MessageBox.show({message:(s===null||s===void 0?void 0:s.confirmationText)||"",modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$5(this,_deleteEntry,_deleteEntry2).call(this,s.entryId),onNo:t=>{t.close()}})}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="SignDocument"||e.getType()==="Activity:SignDocument"}}]);return e}(Base);function _deleteEntry2(t){console.log("delete entry"+t)}function _openDocument2({documentId:t,memberHash:e}){return crm_router.Router.Instance.openSignDocumentSlider(t,e)}function _modifyDocument2({documentId:t}){return crm_router.Router.Instance.openSignDocumentModifySlider(t)}async function _updateActivityDeadline2(t,e){var i;const n=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),e);let a;try{a=await main_core.ajax.runAction("crm.timeline.signdocument.updateActivityDeadline",{data:{activityId:t,activityDeadline:n}})}catch(t){console.error(t);return}const s=(i=a.data.document)===null||i===void 0?void 0:i.activityDeadline;if(n!==s){console.error("Updated document create date without errors, but for some reason date from the backend doesn't match sent value")}}function _resendDocument2({documentId:t,recipientHash:e},i){if(i.onStart){i.onStart()}return new Promise(((n,a)=>{main_core.ajax.runAction("sign.internal.document.resendFile",{data:{memberHash:e,documentId:t}}).then((()=>{ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGN_DOCUMENT_RESEND_SUCCESS"),autoHideDelay:5e3});if(i.onStop){i.onStop()}n()}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(i.onStop){i.onStop()}a()}));console.log("resend document "+t+" for "+e)}))}function _touchSigner2({documentId:t}){console.log("touch signer document "+t)}function _download2({documentHash:t,memberHash:e},i){if(i.onStart){i.onStart()}const n=document.createElement("a");n.href="/bitrix/services/main/ajax.php?action=sign.document.getFileForSrc"+"&memberHash="+e+"&documentHash="+t;n.setAttribute("download","");document.body.appendChild(n);n.click();document.body.removeChild(n);if(i.onStop){i.onStop()}}function _classPrivateMethodInitSpec$6(t,e){_checkPrivateRedeclaration$9(t,e);e.add(t)}function _checkPrivateRedeclaration$9(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classStaticPrivateFieldSpecSet(t,e,i,n){_classCheckPrivateStaticAccess$1(t,e);_classCheckPrivateStaticFieldDescriptor$1(i,"set");_classApplyDescriptorSet(t,i,n);return n}function _classApplyDescriptorSet(t,e,i){if(e.set){e.set.call(t,i)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=i}}function _classStaticPrivateFieldSpecGet$1(t,e,i){_classCheckPrivateStaticAccess$1(t,e);_classCheckPrivateStaticFieldDescriptor$1(i,"get");return _classApplyDescriptorGet$1(t,i)}function _classCheckPrivateStaticFieldDescriptor$1(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function _classCheckPrivateStaticAccess$1(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function _classApplyDescriptorGet$1(t,e){if(e.get){return e.get.call(t)}return e.value}function _classPrivateMethodGet$6(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const ACTION_NAMESPACE="Document:";var _onJsEvent=new WeakSet;var _openDocument$1=new WeakSet;var _copyPublicLink=new WeakSet;var _createPublicUrl=new WeakSet;var _printDocument=new WeakSet;var _downloadPdf=new WeakSet;var _downloadDocx=new WeakSet;var _updateTitle=new WeakSet;var _updateCreateDate=new WeakSet;var _deleteDocument=new WeakSet;var _onAjaxAction=new WeakSet;let Document=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_onAjaxAction);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_deleteDocument);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_updateCreateDate);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_updateTitle);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_downloadDocx);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_downloadPdf);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_printDocument);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_createPublicUrl);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_copyPublicLink);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_openDocument$1);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_onJsEvent);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,response:o,animationCallbacks:r}=i;if(ActionType.isJsEvent(a)){_classPrivateMethodGet$6(this,_onJsEvent,_onJsEvent2).call(this,n,s,r,e)}else if(ActionType.isAjaxAction(a)){_classPrivateMethodGet$6(this,_onAjaxAction,_onAjaxAction2).call(this,n,a,s,o)}}},{key:"onAfterItemRefreshLayout",value:function t(i){var n,a,s,o;const r=_classStaticPrivateFieldSpecGet$1(e,e,_toPrintAfterRefresh).filter((t=>t.getId()===i.getId()));if(r.length<=0){return}const l=(n=i.getLayout().asPlainObject().footer)===null||n===void 0?void 0:(a=n.additionalButtons)===null||a===void 0?void 0:(s=a.extra)===null||s===void 0?void 0:s.action;const c=main_core.Type.isPlainObject(l)&&ActionType.isJsEvent(l.type)&&l.value===ACTION_NAMESPACE+"Print";if(!c){return}const u=(o=l.actionParams)===null||o===void 0?void 0:o.printUrl;if(!main_core.Type.isStringFilled(u)){return}_classPrivateMethodGet$6(this,_printDocument,_printDocument2).call(this,u,null,i);_classStaticPrivateFieldSpecSet(e,e,_toPrintAfterRefresh,_classStaticPrivateFieldSpecGet$1(e,e,_toPrintAfterRefresh).filter((t=>!r.includes(t))))}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Document"||e.getType()==="DocumentViewed"||e.getType()==="Activity:Document"}}]);return e}(Base);function _onJsEvent2(t,e,i,n){const a=main_core.Text.toInteger(e===null||e===void 0?void 0:e.documentId);if(t===ACTION_NAMESPACE+"Open"){_classPrivateMethodGet$6(this,_openDocument$1,_openDocument2$1).call(this,a)}else if(t===ACTION_NAMESPACE+"CopyPublicLink"){_classPrivateMethodGet$6(this,_copyPublicLink,_copyPublicLink2).call(this,a,e===null||e===void 0?void 0:e.publicUrl)}else if(t===ACTION_NAMESPACE+"Print"){_classPrivateMethodGet$6(this,_printDocument,_printDocument2).call(this,e===null||e===void 0?void 0:e.printUrl,i,n)}else if(t===ACTION_NAMESPACE+"DownloadPdf"){_classPrivateMethodGet$6(this,_downloadPdf,_downloadPdf2).call(this,e===null||e===void 0?void 0:e.pdfUrl)}else if(t===ACTION_NAMESPACE+"DownloadDocx"){_classPrivateMethodGet$6(this,_downloadDocx,_downloadDocx2).call(this,e===null||e===void 0?void 0:e.docxUrl)}else if(t===ACTION_NAMESPACE+"UpdateTitle"){_classPrivateMethodGet$6(this,_updateTitle,_updateTitle2).call(this,a,e===null||e===void 0?void 0:e.value)}else if(t===ACTION_NAMESPACE+"UpdateCreateDate"){_classPrivateMethodGet$6(this,_updateCreateDate,_updateCreateDate2).call(this,a,e===null||e===void 0?void 0:e.value)}else if(t===ACTION_NAMESPACE+"Delete"){var s;const t=(s=e.confirmationText)!==null&&s!==void 0?s:"";if(t){ui_dialogs_messagebox.MessageBox.show({message:t,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$6(this,_deleteDocument,_deleteDocument2).call(this,e.id,e.ownerTypeId,e.ownerId,i),onNo:t=>{t.close()}})}else{_classPrivateMethodGet$6(this,_deleteDocument,_deleteDocument2).call(this,e.id,e.ownerTypeId,e.ownerId,i)}}else{console.info(`Unknown action ${t} in ${n.getType()}`)}}function _openDocument2$1(t){crm_router.Router.Instance.openDocumentSlider(t)}async function _copyPublicLink2(t,e){if(!main_core.Type.isStringFilled(e)){try{e=await _classPrivateMethodGet$6(this,_createPublicUrl,_createPublicUrl2).call(this,t)}catch(t){ui_dialogs_messagebox.MessageBox.alert(t.message);return}}const i=BX.clipboard.copy(e);if(i){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_LINK_IS_COPIED"),autoHideDelay:5e3})}else{ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_COPY_PUBLIC_LINK_ERROR"))}}async function _createPublicUrl2(t){let e;try{e=await main_core.ajax.runAction("crm.documentgenerator.document.enablePublicUrl",{analyticsLabel:"enablePublicUrl",data:{status:1,id:t}})}catch(t){console.error(t);throw new Error(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_CREATE_PUBLIC_LINK_ERROR"))}const i=e.data.publicUrl;if(!main_core.Type.isStringFilled(i)){throw new Error(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_CREATE_PUBLIC_LINK_ERROR"))}return i}function _printDocument2(t,e,i){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank");return}_classStaticPrivateFieldSpecGet$1(Document,Document,_toPrintAfterRefresh).push(i);const n=e===null||e===void 0?void 0:e.onStart;if(main_core.Type.isFunction(n)){n()}}function _downloadPdf2(t){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank")}else{ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_PDF_NOT_READY"))}}function _downloadDocx2(t){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank")}else{console.error("Docx download url is not found. This should be an impossible case, something went wrong")}}async function _updateTitle2(t,e){var i,n;let a;try{a=await main_core.ajax.runAction("crm.documentgenerator.document.update",{data:{id:t,values:{DocumentTitle:e}}})}catch(t){console.error(t);ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_UPDATE_DOCUMENT_ERROR"));return}const s=(i=a.data.document)===null||i===void 0?void 0:(n=i.values)===null||n===void 0?void 0:n.DocumentTitle;if(s!==e){console.error("Updated document title without errors, but for some reason title from the backend doesn't match sent value")}}async function _updateCreateDate2(t,e){var i,n;const a=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),e);let s;try{s=await main_core.ajax.runAction("crm.documentgenerator.document.update",{data:{id:t,values:{DocumentCreateTime:a}}})}catch(t){console.error(t);ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_UPDATE_DOCUMENT_ERROR"));return}const o=(i=s.data.document)===null||i===void 0?void 0:(n=i.values)===null||n===void 0?void 0:n.DocumentCreateTime;if(a!==o){console.error("Updated document create date without errors, but for some reason date from the backend doesn't match sent value")}}function _deleteDocument2(t,e,i,n){if(n.onStart){n.onStart()}return main_core.ajax.runAction("crm.timeline.document.delete",{data:{id:t,ownerTypeId:e,ownerId:i}}).then((()=>{if(n.onStop){n.onStop()}return true}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(n.onStop){n.onStop()}return true}))}function _onAjaxAction2(t,e,i,n){if(t==="crm.api.integration.sign.convertDeal"){var a;if(e===ActionType.AJAX_ACTION.FINISHED&&!main_core.Type.isNil(n===null||n===void 0?void 0:(a=n.data)===null||a===void 0?void 0:a.SMART_DOCUMENT)){const t=new main_core.Uri("/sign/doc/0/");t.setQueryParams({docId:n.data.SMART_DOCUMENT,stepId:"changePartner",noRedirect:"Y"});BX.SidePanel.Instance.open(t.toString())}}}var _toPrintAfterRefresh={writable:true,value:[]};function _classPrivateMethodInitSpec$7(t,e){_checkPrivateRedeclaration$a(t,e);e.add(t)}function _checkPrivateRedeclaration$a(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$7(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _makeCall=new WeakSet;var _scheduleCall=new WeakSet;var _openTranscript=new WeakSet;var _changePlayerState=new WeakSet;var _downloadRecord=new WeakSet;let Call=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_downloadRecord);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_changePlayerState);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_openTranscript);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_scheduleCall);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_makeCall);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Call:MakeCall"&&s){_classPrivateMethodGet$7(this,_makeCall,_makeCall2).call(this,s)}if(n==="Call:Schedule"&&s){_classPrivateMethodGet$7(this,_scheduleCall,_scheduleCall2).call(this,s.activityId,s.scheduleDate)}if(n==="Call:OpenTranscript"&&s&&s.callId){_classPrivateMethodGet$7(this,_openTranscript,_openTranscript2).call(this,s.callId)}if(n==="Call:ChangePlayerState"&&s&&s.recordId){_classPrivateMethodGet$7(this,_changePlayerState,_changePlayerState2).call(this,e,s.recordId)}if(n==="Call:DownloadRecord"&&s&&s.url){_classPrivateMethodGet$7(this,_downloadRecord,_downloadRecord2).call(this,s.url)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Call"}}]);return e}(Base);function _makeCall2(t){if(!main_core.Type.isStringFilled(t.phone)){return}const e={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(t.entityTypeId),ENTITY_ID:t.entityId,AUTO_FOLD:true};if(t.ownerTypeId!==t.entityTypeId||t.ownerId!==t.entityId){e.BINDINGS={OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(t.ownerTypeId),OWNER_ID:t.ownerId}}if(t.activityId>0){e.SRC_ACTIVITY_ID=t.activityId}window.top["BXIM"].phoneTo(t.phone,e)}function _scheduleCall2(t,e){if(BX.CrmTimelineManager){const i=BX.CrmTimelineManager.getDefault();if(i){const n=i.getMenuBar();BX(n.getActiveItem()).scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"});n.setActiveItemById("todo");const a=n.getTodoEditor();a.setFocused();a.setParentActivityId(t);a.setDeadLine(e)}}}function _openTranscript2(t){if(BX.Voximplant&&BX.Voximplant.Transcript){BX.Voximplant.Transcript.create({callId:t}).show()}}function _changePlayerState2(t,e){const i=t.getLayoutContentBlockById("audio");if(!i){return}if(e!==i.id){return}if(i.state==="play"){i.pause()}else{i.play()}}function _downloadRecord2(t){location.href=t}let ToDo=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a}=i;if(a!=="jsEvent"){return}if(n==="EditableDescription:StartEdit"){e.highlightContentBlockById("description",true)}if(n==="EditableDescription:FinishEdit"){e.highlightContentBlockById("description",false)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:ToDo"}}]);return e}(Base);function _classPrivateMethodInitSpec$8(t,e){_checkPrivateRedeclaration$b(t,e);e.add(t)}function _checkPrivateRedeclaration$b(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$8(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openHelpdesk=new WeakSet;let Helpdesk=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_openHelpdesk);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionData:a}=i;if(n==="Helpdesk:Open"&&a&&a.articleCode){_classPrivateMethodGet$8(this,_openHelpdesk,_openHelpdesk2).call(this,a.articleCode)}}}],[{key:"isItemSupported",value:function t(e){return true}}]);return e}(Base);function _openHelpdesk2(t){if(top.BX&&top.BX.Helper){top.BX.Helper.show(`redirect=detail&code=${t}`)}}ControllerManager.registerController(Activity);ControllerManager.registerController(CommonContentBlocks);ControllerManager.registerController(OpenLines);ControllerManager.registerController(Modification);ControllerManager.registerController(SignDocument);ControllerManager.registerController(Document);ControllerManager.registerController(Call);ControllerManager.registerController(ToDo);ControllerManager.registerController(Helpdesk);exports.Item=Item;exports.ConfigurableItem=ConfigurableItem;exports.StreamType=StreamType;exports.ControllerManager=ControllerManager;exports.BaseController=Base})(this.BX.Crm.Timeline=this.BX.Crm.Timeline||{},BX.UI,BX.UI,BX.Event,BX,BX.Crm.Timeline,BX.Vue3.Components,BX.Main,BX.Currency,BX.Vue3,BX.UI,BX.Crm.DateTime,BX.Main,BX.Crm,BX.UI.Dialogs,BX.Crm.Timeline,BX,BX,BX.UI);
//# sourceMappingURL=index.bundle.map.js