this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(exports,rest_client,ui_analytics,crm_field_colorSelector,ui_vue3_directives_hint,ui_label,ui_cnt,location_core,main_loader,crm_timeline_editors_commentEditor,ui_textEditor,ui_bbcode_formatter_htmlFormatter,ui_vue3,ui_icons_generator,crm_audioPlayer,ui_iconSet_api_vue,ui_iconSet_actions,crm_field_itemSelector,currency_currencyCore,ui_textcrop,ui_alerts,ui_avatar,crm_field_pingSelector,bizproc_types,im_public,main_date,crm_timeline_tools,ui_infoHelper,ai_engine,ui_buttons,ui_feedback_form,crm_activity_fileUploaderPopup,ui_entitySelector,ui_sidepanel,crm_entityEditor_field_paymentDocuments,pull_client,calendar_util,main_popup,calendar_sharing_interface,crm_ai_call,crm_router,ui_hint,ui_dialogs_messagebox,main_core_events,ui_notification,main_core,ui_imageStackSteps,ui_iconSet_main,ui_designTokens,crm_timeline_item){"use strict";var crm_timeline_item__default="default"in crm_timeline_item?crm_timeline_item["default"]:crm_timeline_item;const StreamType={history:0,scheduled:1,pinned:2};function _classPrivateFieldInitSpec(t,e,i){_checkPrivateRedeclaration(t,e);e.set(t,i)}function _checkPrivateRedeclaration(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _menuOptions=new WeakMap;var _vueComponent=new WeakMap;let Menu=function(){function t(e,i,n){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec(this,_menuOptions,{writable:true,value:{}});_classPrivateFieldInitSpec(this,_vueComponent,{writable:true,value:{}});babelHelpers.classPrivateFieldSet(this,_vueComponent,e);babelHelpers.classPrivateFieldSet(this,_menuOptions,n||{});babelHelpers.classPrivateFieldSet(this,_menuOptions,{angle:false,cacheable:false,...babelHelpers.classPrivateFieldGet(this,_menuOptions)});babelHelpers.classPrivateFieldGet(this,_menuOptions).items=[];for(const t of i){babelHelpers.classPrivateFieldGet(this,_menuOptions).items.push(this.createMenuItem(t))}}babelHelpers.createClass(t,[{key:"getMenuItems",value:function t(){return babelHelpers.classPrivateFieldGet(this,_menuOptions).items}},{key:"show",value:function t(){main_popup.MenuManager.show(babelHelpers.classPrivateFieldGet(this,_menuOptions))}},{key:"createMenuItem",value:function t(e){if(Object.prototype.hasOwnProperty.call(e,"delimiter")&&e.delimiter){return{text:e.title||"",delimiter:true}}const i={text:e.title,value:e.title};if(e.icon){i.className=`menu-popup-item-${e.icon}`}if(e.menu){i.items=[];for(const t of Object.values(e.menu.items||{})){i.items.push(this.createMenuItem(t))}}else if(e.action){if(e.action.type==="redirect"){i.href=e.action.value}else if(e.action.type==="jsCode"){i.onclick=e.action.value}else{i.onclick=()=>{void this.onMenuItemClick(e)}}}return i}},{key:"onMenuItemClick",value:function t(e){const i=main_popup.MenuManager.getCurrentMenu();if(i){i.close()}void new Action(e.action).execute(babelHelpers.classPrivateFieldGet(this,_vueComponent))}}],[{key:"showMenu",value:function e(i,n,a){const s=new t(i,n,a);s.show()}}]);return t}();function _classPrivateMethodInitSpec(t,e){_checkPrivateRedeclaration$1(t,e);e.add(t)}function _classPrivateFieldInitSpec$1(t,e,i){_checkPrivateRedeclaration$1(t,e);e.set(t,i)}function _checkPrivateRedeclaration$1(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const AnimationTarget={block:"block",item:"item"};const AnimationType={disable:"disable",loader:"loader"};const ActionType={JS_EVENT:"jsEvent",AJAX_ACTION:{STARTED:"ajaxActionStarted",FINISHED:"ajaxActionFinished",FAILED:"ajaxActionFailed"},isJsEvent(t){return t===this.JS_EVENT},isAjaxAction(t){return t===this.AJAX_ACTION.STARTED||t===this.AJAX_ACTION.FINISHED||t===this.AJAX_ACTION.FAILED}};Object.freeze(ActionType.AJAX_ACTION);Object.freeze(ActionType);var _type=new WeakMap;var _value=new WeakMap;var _actionParams=new WeakMap;var _animation=new WeakMap;var _analytics=new WeakMap;var _prepareRunActionParams=new WeakSet;var _prepareCallBatchParams=new WeakSet;var _prepareMenuItems=new WeakSet;var _startAnimation=new WeakSet;var _stopAnimation=new WeakSet;var _isAnimationValid=new WeakSet;var _sendAnalytics=new WeakSet;let Action=function(){function Action(t){babelHelpers.classCallCheck(this,Action);_classPrivateMethodInitSpec(this,_sendAnalytics);_classPrivateMethodInitSpec(this,_isAnimationValid);_classPrivateMethodInitSpec(this,_stopAnimation);_classPrivateMethodInitSpec(this,_startAnimation);_classPrivateMethodInitSpec(this,_prepareMenuItems);_classPrivateMethodInitSpec(this,_prepareCallBatchParams);_classPrivateMethodInitSpec(this,_prepareRunActionParams);_classPrivateFieldInitSpec$1(this,_type,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_value,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_actionParams,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_animation,{writable:true,value:null});_classPrivateFieldInitSpec$1(this,_analytics,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_type,t.type);babelHelpers.classPrivateFieldSet(this,_value,t.value);babelHelpers.classPrivateFieldSet(this,_actionParams,t.actionParams);babelHelpers.classPrivateFieldSet(this,_animation,main_core.Type.isPlainObject(t.animation)?t.animation:null);babelHelpers.classPrivateFieldSet(this,_analytics,main_core.Type.isPlainObject(t.analytics)?t.analytics:null)}babelHelpers.createClass(Action,[{key:"execute",value:function execute(vueComponent){return new Promise(((resolve,reject)=>{if(this.isJsEvent()){vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.JS_EVENT,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams),animationCallbacks:{onStart:_classPrivateMethodGet(this,_startAnimation,_startAnimation2).bind(this,vueComponent),onStop:_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).bind(this,vueComponent)}});_classPrivateMethodGet(this,_sendAnalytics,_sendAnalytics2).call(this);resolve(true)}else if(this.isJsCode()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);eval(babelHelpers.classPrivateFieldGet(this,_value));_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);_classPrivateMethodGet(this,_sendAnalytics,_sendAnalytics2).call(this);resolve(true)}else if(this.isAjaxAction()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.STARTED,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams)});const t={data:_classPrivateMethodGet(this,_prepareRunActionParams,_prepareRunActionParams2).call(this,babelHelpers.classPrivateFieldGet(this,_actionParams))};if(babelHelpers.classPrivateFieldGet(this,_analytics)){t.analytics=babelHelpers.classPrivateFieldGet(this,_analytics)}main_core.ajax.runAction(babelHelpers.classPrivateFieldGet(this,_value),t).then((t=>{_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.FINISHED,actionData:babelHelpers.classPrivateFieldGet(this,_actionParams),response:t});resolve(t)}),(t=>{_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent,true);ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:ActionType.AJAX_ACTION.FAILED,actionParams:babelHelpers.classPrivateFieldGet(this,_actionParams),response:t});reject(t)}))}else if(this.isCallRestBatch()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:"ajaxActionStarted",actionData:babelHelpers.classPrivateFieldGet(this,_actionParams)});rest_client.rest.callBatch(_classPrivateMethodGet(this,_prepareCallBatchParams,_prepareCallBatchParams2).call(this,babelHelpers.classPrivateFieldGet(this,_actionParams)),(t=>{for(const e in t){const i=t[e].answer;if(i.error){_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);ui_notification.UI.Notification.Center.notify({content:i.error.error_description,autoHideDelay:5e3});vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:"ajaxActionFailed",actionParams:babelHelpers.classPrivateFieldGet(this,_actionParams)});reject(t);return}}_classPrivateMethodGet(this,_stopAnimation,_stopAnimation2).call(this,vueComponent);vueComponent.$Bitrix.eventEmitter.emit("crm:timeline:item:action",{action:babelHelpers.classPrivateFieldGet(this,_value),actionType:"ajaxActionFinished",actionData:babelHelpers.classPrivateFieldGet(this,_actionParams)});resolve(t)}),true)}else if(this.isRedirect()){_classPrivateMethodGet(this,_startAnimation,_startAnimation2).call(this,vueComponent);const t={href:babelHelpers.classPrivateFieldGet(this,_value)};if(babelHelpers.classPrivateFieldGet(this,_actionParams)&&babelHelpers.classPrivateFieldGet(this,_actionParams).target){t.target=babelHelpers.classPrivateFieldGet(this,_actionParams).target}const e=main_core.Dom.create("a",{attrs:t,text:"",style:{display:"none"}});main_core.Dom.append(e,document.body);e.click();setTimeout((()=>main_core.Dom.remove(e)),10);_classPrivateMethodGet(this,_sendAnalytics,_sendAnalytics2).call(this);resolve(babelHelpers.classPrivateFieldGet(this,_value))}else if(this.isShowMenu()){Menu.showMenu(vueComponent,_classPrivateMethodGet(this,_prepareMenuItems,_prepareMenuItems2).call(this,babelHelpers.classPrivateFieldGet(this,_value).items,vueComponent),{id:"actionMenu",bindElement:vueComponent.$el,minWidth:vueComponent.$el.offsetWidth});_classPrivateMethodGet(this,_sendAnalytics,_sendAnalytics2).call(this);resolve(true)}else if(this.isShowInfoHelper()){var _BX$UI$InfoHelper;(_BX$UI$InfoHelper=BX.UI.InfoHelper)===null||_BX$UI$InfoHelper===void 0?void 0:_BX$UI$InfoHelper.show(babelHelpers.classPrivateFieldGet(this,_value));_classPrivateMethodGet(this,_sendAnalytics,_sendAnalytics2).call(this);resolve(true)}else{reject(false)}}))}},{key:"isJsEvent",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="jsEvent"}},{key:"isJsCode",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="jsCode"}},{key:"isAjaxAction",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="runAjaxAction"}},{key:"isCallRestBatch",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="callRestBatch"}},{key:"isRedirect",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="redirect"}},{key:"isShowInfoHelper",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="showInfoHelper"}},{key:"isShowMenu",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type)==="showMenu"}},{key:"getValue",value:function t(){return babelHelpers.classPrivateFieldGet(this,_value)}},{key:"getActionParam",value:function t(e){return babelHelpers.classPrivateFieldGet(this,_actionParams)&&babelHelpers.classPrivateFieldGet(this,_actionParams).hasOwnProperty(e)?babelHelpers.classPrivateFieldGet(this,_actionParams)[e]:null}}]);return Action}();function _prepareRunActionParams2(t){const e={};if(main_core.Type.isUndefined(t)){return e}for(const i in t){const n=t[i];if(main_core.Type.isDate(n)){e[i]=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateTimeFormat(),n)}else if(main_core.Type.isPlainObject(n)){e[i]=_classPrivateMethodGet(this,_prepareRunActionParams,_prepareRunActionParams2).call(this,n)}else{e[i]=n}}return e}function _prepareCallBatchParams2(t){const e={};if(main_core.Type.isUndefined(t)){return e}for(const i in t){e[i]={method:t[i].method,params:_classPrivateMethodGet(this,_prepareRunActionParams,_prepareRunActionParams2).call(this,t[i].params)}}return e}function _prepareMenuItems2(t,e){return Object.values(t).filter((t=>t.state!=="hidden"&&t.scope!=="mobile"&&(!e.isReadOnly||!t.hideIfReadonly))).sort(((t,e)=>t.sort-e.sort))}function _startAnimation2(t){if(!_classPrivateMethodGet(this,_isAnimationValid,_isAnimationValid2).call(this)){return}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.item){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){t.$root.setFaded(true)}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){t.$root.showLoader(true)}}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.block){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){if(main_core.Type.isFunction(t.setDisabled)){t.setDisabled(true)}}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){if(main_core.Type.isFunction(t.setLoading)){t.setLoading(true)}}}}function _stopAnimation2(t,e=false){if(!_classPrivateMethodGet(this,_isAnimationValid,_isAnimationValid2).call(this)){return}if(babelHelpers.classPrivateFieldGet(this,_animation).forever&&!e){return}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.item){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){t.$root.setFaded(false)}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){t.$root.showLoader(false)}}if(babelHelpers.classPrivateFieldGet(this,_animation).target===AnimationTarget.block){if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.disable){if(main_core.Type.isFunction(t.setDisabled)){t.setDisabled(false)}}if(babelHelpers.classPrivateFieldGet(this,_animation).type===AnimationType.loader){if(main_core.Type.isFunction(t.setLoading)){t.setLoading(false)}}}}function _isAnimationValid2(){if(!babelHelpers.classPrivateFieldGet(this,_animation)){return false}if(!AnimationTarget.hasOwnProperty(babelHelpers.classPrivateFieldGet(this,_animation).target)){return false}return AnimationType.hasOwnProperty(babelHelpers.classPrivateFieldGet(this,_animation).type)}function _sendAnalytics2(){if(babelHelpers.classPrivateFieldGet(this,_analytics)&&babelHelpers.classPrivateFieldGet(this,_analytics).hit){const t={...babelHelpers.classPrivateFieldGet(this,_analytics)};delete t.hit;ui_analytics.sendData(t)}}const Logo={props:{type:String,addIcon:String,addIconType:String,icon:String,iconType:String,backgroundUrl:String,backgroundSize:Number,inCircle:{type:Boolean,required:false,default:false},action:Object},data(){return{currentIcon:this.icon}},computed:{className(){return["crm-timeline__card-logo",`--${this.type}`,{"--clickable":this.action}]},iconClassname(){return["crm-timeline__card-logo_icon",`--${this.currentIcon}`,{"--in-circle":this.inCircle,[`--type-${this.iconType}`]:!!this.iconType&&!this.backgroundUrl,"--custom-bg":!!this.backgroundUrl}]},addIconClassname(){return["crm-timeline__card-logo_add-icon",`--type-${this.addIconType}`,`--icon-${this.addIcon}`]},iconInteriorStyle(){const t={};if(this.backgroundUrl){t.backgroundImage="url("+encodeURI(main_core.Text.encode(this.backgroundUrl))+")"}if(this.backgroundSize){t.backgroundSize=parseInt(this.backgroundSize)+"px"}return t}},watch:{icon(t){this.currentIcon=t}},methods:{executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)},setIcon(t){this.currentIcon=t}},template:`\n\t\t<div :class="className" @click="executeAction">\n\t\t\t<div class="crm-timeline__card-logo_content">\n\t\t\t\t<div :class="iconClassname">\n\t\t\t\t\t<i :style="iconInteriorStyle"></i>\n\t\t\t\t</div>\n\t\t\t\t<div :class="addIconClassname" v-if="addIcon">\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const CalendarIcon={props:{timestamp:{type:Number,required:true,default:0},calendarEventId:{type:Number,required:false,default:null}},computed:{date(){return this.formatUserTime("d")},month(){return this.formatUserTime("F")},dayWeek(){return this.formatUserTime("D")},time(){return this.getDateTimeConverter().toTimeString()},userTime(){return this.getDateTimeConverter().getValue()},hasCalendarEventId(){return this.calendarEventId>0}},methods:{getDateTimeConverter(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.timestamp).toUserTime()},formatUserTime(t){return main_date.DateTimeFormat.format(t,this.userTime)}},template:`\n\t\t<div class="crm-timeline__calendar-icon-container">\n\t\t\t<div v-if="hasCalendarEventId" class="crm-timeline__calendar-icon_event_icon"></div>\n\t\t\t<div class="crm-timeline__calendar-icon">\n\t\t\t\t<header class="crm-timeline__calendar-icon_top">\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_bullets">\n\t\t\t\t\t\t<div class="crm-timeline__calendar-icon_bullet"></div>\n\t\t\t\t\t\t<div class="crm-timeline__calendar-icon_bullet"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<main class="crm-timeline__calendar-icon_content">\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_day">{{ date }}</div>\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_month">{{ month }}</div>\n\t\t\t\t\t<div class="crm-timeline__calendar-icon_date">\n\t\t\t\t\t\t<span class="crm-timeline__calendar-icon_day-week">{{ dayWeek }}</span>\n\t\t\t\t\t\t<span class="crm-timeline__calendar-icon_time">{{ time }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</main>\n\t\t\t</div>\n\t\t</div>\n\t`};const LogoCalendar=ui_vue3.BitrixVue.cloneComponent(Logo,{components:{CalendarIcon:CalendarIcon},props:{timestamp:{type:Number,required:false,default:0},addIcon:String,addIconType:String,calendarEventId:{type:Number,required:false,default:null},backgroundColor:{type:String,required:false,default:null}},computed:{addIconClassname(){return["crm-timeline__card-logo_add-icon",`--type-${this.addIconType}`,`--icon-${this.addIcon}`]},logoStyle(){if(main_core.Type.isStringFilled(this.backgroundColor)){return{"--crm-timeline__logo-background":main_core.Text.encode(this.backgroundColor)}}return{}}},template:`\n\t\t<div \n\t\t\t:class="className"\n\t\t\t:style="logoStyle"\n\t\t\t@click="executeAction"\n\t\t>\n\t\t\t<div class="crm-timeline__card-logo_content">\n\t\t\t\t<CalendarIcon :timestamp="timestamp" :calendar-event-id="calendarEventId" />\n\t\t\t\t<div :class="addIconClassname" v-if="addIcon">\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`});const Body={components:{Logo:Logo,LogoCalendar:LogoCalendar},props:{logo:Object,blocks:Object},data(){return{blockRefs:{}}},mounted(){const t=this.$refs.blocks;if(!t||!this.visibleBlocks){return}this.visibleBlocks.forEach(((e,i)=>{if(main_core.Type.isDomNode(t[i].$el)){t[i].$el.setAttribute("data-id",e.id)}else{throw new Error('Vue component "'+e.rendererName+'" was not found')}}))},beforeUpdate(){this.blockRefs={}},computed:{visibleBlocks(){if(!main_core.Type.isPlainObject(this.blocks)){return[]}return Object.keys(this.blocks).map((t=>({id:t,...this.blocks[t]}))).filter((t=>t.scope!=="mobile")).sort(((t,e)=>{let i=t.sort===undefined?0:t.sort;let n=e.sort===undefined?0:e.sort;if(i<n){return-1}if(i>n){return 1}return 0}))},contentContainerClassname(){return["crm-timeline__card-container",{"--without-logo":!this.logo}]}},methods:{getContentBlockById(t){var e;return(e=this.blockRefs[t])!==null&&e!==void 0?e:null},getLogo(){return this.$refs.logo},saveRef(t,e){this.blockRefs[e]=t}},template:`\n\t\t<div class="crm-timeline__card-body">\n\t\t\t<div v-if="logo" class="crm-timeline__card-logo_container">\n\t\t\t\t<LogoCalendar v-if="logo.icon === 'calendar'" v-bind="logo"></LogoCalendar>\n\t\t\t\t<Logo v-else v-bind="logo" ref="logo"></Logo>\n\t\t\t</div>\n\t\t\t<div :class="contentContainerClassname">\n\t\t\t\t<div\n\t\t\t\t\tv-for="block in visibleBlocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\tclass="crm-timeline__card-container_block"\n\t\t\t\t>\n\t\t\t\t\t<component\n\t\t\t\t\t\t:is="block.rendererName"\n\t\t\t\t\t\tv-bind="block.properties"\n\t\t\t\t\t\t:ref="(el) => this.saveRef(el, block.id)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let ButtonScope=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonScope,"MOBILE","mobile");let ButtonState=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonState,"DEFAULT","");babelHelpers.defineProperty(ButtonState,"LOADING","loading");babelHelpers.defineProperty(ButtonState,"DISABLED","disabled");babelHelpers.defineProperty(ButtonState,"HIDDEN","hidden");babelHelpers.defineProperty(ButtonState,"LOCKED","locked");babelHelpers.defineProperty(ButtonState,"AI_LOADING","ai-loading");babelHelpers.defineProperty(ButtonState,"AI_SUCCESS","ai-success");let ButtonType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ButtonType,"ICON","icon");babelHelpers.defineProperty(ButtonType,"PRIMARY","primary");babelHelpers.defineProperty(ButtonType,"SECONDARY","secondary");babelHelpers.defineProperty(ButtonType,"LIGHT","light");babelHelpers.defineProperty(ButtonType,"AI","ai");const BaseButton={props:{id:{type:String,required:false,default:""},title:{type:String,required:false,default:""},tooltip:{type:String,required:false,default:""},state:{type:String,required:false,default:ButtonState.DEFAULT},props:Object,action:Object},data(){return{currentState:this.state}},computed:{itemStateToButtonStateDict(){return{[ButtonState.LOADING]:ui_buttons.Button.State.WAITING,[ButtonState.DISABLED]:ui_buttons.Button.State.DISABLED,[ButtonState.AI_LOADING]:ui_buttons.Button.State.AI_WAITING}}},methods:{setDisabled(t){if(t){this.setButtonState(ButtonState.DISABLED)}else{this.setButtonState(ButtonState.DEFAULT)}},setLoading(t){if(t){this.setButtonState(ButtonState.LOADING)}else{this.setButtonState(ButtonState.DEFAULT)}},setButtonState(t){if(this.currentState!==t){this.currentState=t}},onLayoutUpdated(){this.setButtonState(this.state)},executeAction(){if(this.action&&this.currentState!==ButtonState.DISABLED&&this.currentState!==ButtonState.LOADING&&this.currentState!==ButtonState.AI_LOADING){const t=new Action(this.action);t.execute(this)}}},created(){this.$Bitrix.eventEmitter.subscribe("layout:updated",this.onLayoutUpdated)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe("layout:updated",this.onLayoutUpdated)},template:`<button></button>`};function _classPrivateMethodInitSpec$1(t,e){_checkPrivateRedeclaration$2(t,e);e.add(t)}function _checkPrivateRedeclaration$2(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$1(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _applyMenuItems=new WeakSet;let ButtonMenu=function(t){babelHelpers.inherits(e,t);function e(t,i,n){var a;babelHelpers.classCallCheck(this,e);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,i,n));_classPrivateMethodInitSpec$1(babelHelpers.assertThisInitialized(a),_applyMenuItems);_classPrivateMethodGet$1(babelHelpers.assertThisInitialized(a),_applyMenuItems,_applyMenuItems2).call(babelHelpers.assertThisInitialized(a));return a}babelHelpers.createClass(e,[{key:"createMenuItem",value:function t(e){const i={text:e.title,value:e.title};if(main_core.Type.isStringFilled(e.state)){switch(e.state){case ButtonState.AI_LOADING:i.className="menu-popup-item-ai-loading menu-popup-item-disabled";break;case ButtonState.AI_SUCCESS:i.className="menu-popup-item-accept menu-popup-item-disabled";break;case ButtonState.DISABLED:i.className="menu-popup-no-icon menu-popup-item-disabled";break;case ButtonState.LOCKED:i.className="menu-popup-item-locked";break;default:i.className=""}}if(main_core.Type.isObject(e.action)){if(e.action.type==="redirect"){i.href=e.action.value}else if(e.action.type==="jsCode"){i.onclick=e.action.value}else{i.onclick=()=>{void this.onMenuItemClick(e)}}}return i}}],[{key:"showMenu",value:function t(i,n,a){const s=new e(i,n,a);s.show()}}]);return e}(Menu);function _applyMenuItems2(){const t=this.getMenuItems();if(!t){return}const e=t.filter((t=>t.className===""));if(e.length===t.length){return}t.forEach((t=>{if(t.className===""){t.className="menu-popup-empty-icon"}}))}const Button=ui_vue3.BitrixVue.cloneComponent(BaseButton,{props:{type:{type:String,required:false,default:ButtonType.SECONDARY},iconName:{type:String,required:false,default:""},size:{type:String,required:false,default:"extra_small"},menuItems:{type:Object,required:false,default:null}},data(){return{popup:null,uiButton:Object.freeze(null),timerSecondsRemaining:0,currentState:this.state,hintText:main_core.Type.isStringFilled(this.tooltip)?main_core.Text.encode(this.tooltip):""}},computed:{itemTypeToButtonColorDict(){return{[ButtonType.PRIMARY]:ui_buttons.Button.Color.PRIMARY,[ButtonType.SECONDARY]:ui_buttons.Button.Color.LIGHT_BORDER,[ButtonType.LIGHT]:ui_buttons.Button.Color.LIGHT,[ButtonType.ICON]:ui_buttons.Button.Color.LINK,[ButtonType.AI]:ui_buttons.Button.Color.AI}},buttonContainerRef(){return this.$refs.buttonContainer}},methods:{getButtonOptions(){const t=main_core.Type.isString(this.iconName)?this.iconName.toUpperCase():"";const e=main_core.Type.isString(this.size)?this.size.toUpperCase():"extra_small";const i=this.itemTypeToButtonColorDict[this.type]||ui_buttons.Button.Color.LIGHT_BORDER;const n=this.type===ButtonType.ICON?"":this.title;return{id:this.id,round:true,dependOnTheme:false,size:ui_buttons.Button.Size[e],text:n,color:i,state:this.itemStateToButtonStateDict[this.currentState],icon:ui_buttons.Button.Icon[t],props:main_core.Type.isPlainObject(this.props)?this.props:{}}},getUiButton(){return this.uiButton},disableWithTimer(t){this.setButtonState(ButtonState.DISABLED);const e=this.getUiButton();let i=t;e.setText(this.formatSeconds(i));const n=setInterval((()=>{if(i<1){clearInterval(n);e.setText(this.title);this.setButtonState(ButtonState.DEFAULT);return}i--;e.setText(this.formatSeconds(i))}),1e3)},formatSeconds(t){const e=Math.floor(t/60);const i=t%60;const n=this.formatNumber(e);const a=this.formatNumber(i);return`${n}:${a}`},formatNumber(t){return t<10?`0${t}`:t},setButtonState(t){var e,i;this.parentSetButtonState(t);(e=this.getUiButton())===null||e===void 0?void 0:e.setState((i=this.itemStateToButtonStateDict[this.currentState])!==null&&i!==void 0?i:null)},createSplitButton(){const t=Object.keys(this.menuItems).map((t=>this.menuItems[t]));const e=this.getButtonOptions();const i=()=>{ButtonMenu.showMenu(this,t,{id:`split-button-menu-${this.id}`,className:"crm-timeline__split-button-menu",width:250,angle:true,cacheable:false,offsetLeft:13,bindElement:this.$el.querySelector(".ui-btn-menu")})};e.menuButton={onclick:(t,e)=>{e.stopPropagation();i()}};if(e.state===ui_buttons.ButtonState.DISABLED){e.mainButton={onclick:(t,e)=>{e.stopPropagation();i()}}}return new ui_buttons.SplitButton(e)},renderButton(){if(!this.buttonContainerRef){return}this.buttonContainerRef.innerHTML="";const t=this.menuItems?this.createSplitButton():new ui_buttons.Button(this.getButtonOptions());t.renderTo(this.buttonContainerRef);this.uiButton=t},setTooltip(t){this.hintText=t},showTooltip(){if(this.hintText===""){return}BX.UI.Hint.show(this.$el,this.hintText,true)},hideTooltip(){if(this.hintText===""){return}BX.UI.Hint.hide(this.$el)},isInViewport(){const t=this.$el.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},isPropEqual(t,e){return this.getButtonOptions().props[t]===e}},watch:{state(t){this.setButtonState(t)},tooltip(t){this.hintText=main_core.Type.isStringFilled(t)?main_core.Text.encode(t):""}},mounted(){this.renderButton()},updated(){this.renderButton()},template:`\n\t\t<div\n\t\t\t:class="$attrs.class"\n\t\t\tref="buttonContainer"\n\t\t\t@click="executeAction"\n\t\t\t@mouseover="showTooltip"\n\t\t\t@mouseleave="hideTooltip"\n\t\t>\n\t\t</div>\n\t`});const AdditionalButtonIcon=Object.freeze({NOTE:"note",SCRIPT:"script",PRINT:"print",DOTS:"dots"});const AdditionalButtonColor=Object.freeze({DEFAULT:"default",PRIMARY:"primary"});const AdditionalButton=ui_vue3.BitrixVue.cloneComponent(BaseButton,{props:{iconName:{type:String,required:false,default:"",validator(t){return Object.values(AdditionalButtonIcon).indexOf(t)>-1}},color:{type:String,required:false,default:AdditionalButtonColor.DEFAULT,validator(t){return Object.values(AdditionalButtonColor).indexOf(t)>-1}}},computed:{className(){return["crm-timeline__card_add-button",{[`--icon-${this.iconName}`]:this.iconName,[`--color-${this.color}`]:this.color,[`--state-${this.currentState}`]:this.currentState}]},ButtonState(){return ButtonState},loaderHtml(){const t=new main_loader.Loader({mode:"inline",size:20});t.show();return t.layout.outerHTML}},template:`\n\t\t<transition name="crm-timeline__card_add-button-fade" mode="out-in">\n\t\t\t<div\n\t\t\t\tv-if="currentState === ButtonState.LOADING"\n\t\t\t\tv-html="loaderHtml"\n\t\t\t\tclass="crm-timeline__card_add-button"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\t:class="className">\n\t\t\t</div>\n\t\t</transition>\n\t`});const Buttons={components:{Button:Button},props:{items:{type:Array,required:false,default:()=>[]}},methods:{getButtonById(t){const e=this.$refs.buttons;return this.items.reduce(((i,n,a)=>{if(i){return i}if(n.id===t){return e[a]}return null}),null)}},template:`\n\t\t\t<div class="crm-timeline__card-action_buttons">\n\t\t\t\t<Button class="crm-timeline__card-action-btn" v-for="item in items" v-bind="item" ref="buttons" />\n\t\t\t</div>\n\t\t`};const MenuId="timeline-more-button-menu";const Menu$1={components:{AdditionalButton:AdditionalButton},props:{buttons:Array,items:Object},inject:["isReadOnly"],computed:{isMenuFilled(){const t=this.menuItems;return t.length>0},itemsArray(){if(!this.items){return[]}return Object.values(this.items).filter((t=>t.state!=="hidden"&&t.scope!=="mobile"&&(!this.isReadOnly||!t.hideIfReadonly))).sort(((t,e)=>t.sort-e.sort))},menuItems(){let t=this.buttons;if(this.buttons.length&&this.itemsArray.length){t.push({delimiter:true})}t=[...t,...this.itemsArray];return t},buttonProps(){return{color:AdditionalButtonColor.DEFAULT,icon:AdditionalButtonIcon.DOTS}}},beforeUnmount(){const t=main_popup.MenuManager.getMenuById(MenuId);if(t){t.destroy()}},methods:{showMenu(){Menu.showMenu(this,this.menuItems,{id:MenuId,className:"crm-timeline__card_more-menu",width:230,angle:false,cacheable:false,bindElement:this.$el})}},template:`\n\t\t<div v-if="isMenuFilled" class="crm-timeline__card-action_menu-item" @click="showMenu">\n\t\t\t<AdditionalButton iconName="dots" color="default"></AdditionalButton>\n\t\t</div>\n\t`};const Footer={components:{Buttons:Buttons,Menu:Menu$1,Button:Button,AdditionalButton:AdditionalButton},props:{buttons:Object,menu:Object,additionalButtons:{type:Object,required:false,default:()=>({})},maxBaseButtonsCount:{type:Number,required:false,default:3}},inject:["isReadOnly"],computed:{containerClassname(){return["crm-timeline__card-action",{"--no-margin-top":this.baseButtons.length<1}]},baseButtons(){return this.visibleAndSortedButtons.slice(0,this.maxBaseButtonsCount)},moreButtons(){return this.visibleAndSortedButtons.slice(this.maxBaseButtonsCount)},visibleAndSortedButtons(){return this.visibleButtons.sort(this.buttonsSorter)},visibleAndSortedAdditionalButtons(){return this.visibleAdditionalButtons.sort(this.buttonsSorter)},visibleButtons(){if(!main_core.Type.isPlainObject(this.buttons)){return[]}return this.buttons?Object.keys(this.buttons).map((t=>({id:t,...this.buttons[t]}))).filter(this.visibleButtonsFilter):[]},visibleAdditionalButtons(){return this.additionalButtonsArray?Object.values(this.additionalButtonsArray).filter(this.visibleButtonsFilter):[]},additionalButtonsArray(){return Object.entries(this.additionalButtons).map((([t,e])=>({id:t,type:ButtonType.ICON,...e})))},hasMenu(){return this.moreButtons.length||main_core.Type.isPlainObject(this.menu)&&Object.keys(this.menu).length}},methods:{visibleButtonsFilter(t){return t.state!==ButtonState.HIDDEN&&t.scope!==ButtonScope.MOBILE&&(!this.isReadOnly||!t.hideIfReadonly)},buttonsSorter(t,e){return(t===null||t===void 0?void 0:t.sort)-(e===null||e===void 0?void 0:e.sort)},getButtonById(t){if(this.$refs.buttons){const e=this.$refs.buttons.getButtonById(t);if(e){return e}}if(this.$refs.additionalButtons){return this.visibleAndSortedAdditionalButtons.reduce(((e,i,n)=>{if(e){return e}if(i.id===t){return buttons[n]}return null}),null)}return null},getMenu(){if(this.$refs.menu){return this.$refs.menu}return null}},template:`\n\t\t<div :class="containerClassname">\n\t\t\t<div class="crm-timeline__card-action_menu">\n\t\t\t\t<div\n\t\t\t\t\tv-for="button in visibleAndSortedAdditionalButtons"\n\t\t\t\t\t:key="button.id"\n\t\t\t\t\tclass="crm-timeline__card-action_menu-item"\n\t\t\t\t>\n\t\t\t\t\t<additional-button\n\t\t\t\t\t\tv-bind="button"\n\t\t\t\t\t>\n\t\t\t\t\t</additional-button>\n\t\t\t\t</div>\n\t\t\t\t<Menu v-if="hasMenu" :buttons="moreButtons" v-bind="menu" ref="menu"/>\n\t\t\t</div>\n\t\t\t<Buttons ref="buttons" :items="baseButtons" />\n\t\t</div>\n\t`};const ChangeStreamButton={props:{disableIfReadonly:Boolean,type:String,title:String,action:Object},data(){return{isReadonlyMode:false,isComplete:false}},inject:["isReadOnly"],mounted(){this.isReadonlyMode=this.isReadOnly},computed:{isShowPinButton(){return this.type==="pin"&&!this.isReadonlyMode},isShowUnpinButton(){return this.type==="unpin"&&!this.isReadonlyMode}},methods:{executeAction(){if(!this.action){return}this.isComplete=true;const t=new Action(this.action);t.execute(this).then((()=>{})).catch((()=>{this.isComplete=false}))},onClick(){if(this.action){const t=new Action(this.action);t.execute(this)}},setDisabled(t){if(!this.isReadonly&&!t){this.isReadonlyMode=false}if(t){this.isReadonlyMode=true}},markCheckboxUnchecked(){this.isComplete=false}},template:`\n\t\t<div class="crm-timeline__card-top_controller">\n\t\t\t<input\n\t\t\t\tv-if="type === 'complete'"\n\t\t\t\t@click="executeAction"\n\t\t\t\ttype="checkbox"\n\t\t\t\t:disabled="isReadonlyMode"\n\t\t\t\t:checked="isComplete"\n\t\t\t\tclass="crm-timeline__card-top_checkbox"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-else-if="isShowPinButton"\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\tclass="crm-timeline__card-top_icon --pin"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-else-if="isShowUnpinButton"\n\t\t\t\t:title="title"\n\t\t\t\t@click="executeAction"\n\t\t\t\tclass="crm-timeline__card-top_icon --unpin"\n\t\t\t></div>\n\t\t</div>\n\t`};const ColorSelector={directives:{hint:ui_vue3_directives_hint.hint},props:{valuesList:{type:Object,required:true},selectedValueId:{type:String,default:"default"},readOnlyMode:{type:Boolean,required:false,default:false}},data(){return{currentValueId:this.selectedValueId}},methods:{getValue(){return this.currentValueId},setValue(t){this.currentValueId=t;if(this.itemSelector){this.itemSelector.setValue(t)}},onItemSelectorValueChange({data:t}){const e=t.value;if(this.currentValueId!==e){this.currentValueId=e;this.emitEvent("ColorSelector:Change",{colorId:e})}},emitEvent(t,e){const i=new Action({type:"jsEvent",value:t,actionParams:e});i.execute(this)}},mounted(){void this.$nextTick((()=>{this.itemSelector=new crm_field_colorSelector.ColorSelector({target:this.$refs.itemSelectorRef,colorList:this.valuesList,selectedColorId:this.currentValueId,readOnlyMode:this.readOnlyMode});if(!this.readOnlyMode){main_core_events.EventEmitter.subscribe(this.itemSelector,crm_field_colorSelector.ColorSelectorEvents.EVENT_COLORSELECTOR_VALUE_CHANGE,this.onItemSelectorValueChange)}}))},computed:{hint(){if(this.readOnlyMode){return null}return{text:this.$Bitrix.Loc.getMessage("CRM_ACTIVITY_TODO_COLOR_SELECTOR_HINT"),popupOptions:{angle:{offset:30,position:"top"},offsetTop:2}}}},template:`\n\t\t<div class="crm-activity__todo-editor-v2_color-selector">\n\t\t\t<div ref="itemSelectorRef" v-hint="hint"></div>\n\t\t</div>\n\t`};const FormatDate={name:"FormatDate",props:{timestamp:{type:Number,required:true,default:0},datePlaceholder:{type:String,required:false,default:""},useShortTimeFormat:{type:Boolean,required:false,default:false},class:{type:[Array,Object,String],required:false,default:""}},computed:{formattedDate(){if(!this.timestamp){return this.datePlaceholder}const t=crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.timestamp).toUserTime();return this.useShortTimeFormat?t.toTimeString():t.toDatetimeString({delimiter:", "})}},template:`\n\t\t<div :class="$props.class">{{ formattedDate }}</div>\n\t`};const Hint={data(){return{isMouseOnHintArea:false,hintPopup:null}},props:{icon:{type:String,required:false,default:""},textBlocks:{type:Array,required:false,default:[]}},computed:{hintContentIcon(){if(this.icon===""){return null}const t=main_core.Dom.create("i");return main_core.Dom.create("div",{attrs:{classname:this.hintContentIconClassname},children:[t]})},hintContentText(){return main_core.Dom.create("div",{attrs:{classname:"crm-timeline__hint_popup-content-text"},children:this.hintContentTextBlocks})},hintContentTextBlocks(){return this.textBlocks.map(this.getContentBlockNode)},hintContentIconClassname(){const t="crm-timeline__hint_popup-content-icon";return`${t} --${this.icon}`},hintIconClassname(){return["ui-hint","crm-timeline__header-hint",{"--active":this.hintPopup}]},hasContent(){return this.textBlocks.length>0}},methods:{getHintContent(){return main_core.Dom.create("div",{attrs:{classname:"crm-timeline__hint_popup-content"},style:{display:"flex"},children:[this.hintContentIcon,this.hintContentText]})},getPopupOptions(){return{darkMode:true,autoHide:false,content:this.getHintContent(),maxWidth:400,bindOptions:{position:"top"},animation:"fading-slide"}},getPopupPosition(){var t;const e=this.$refs.hint;const i=main_popup.Popup.getOption("angleLeftOffset");const{width:n,left:a,top:s}=main_core.Dom.getPosition(e);const{width:o}=main_core.Dom.getPosition((t=this.hintPopup)===null||t===void 0?void 0:t.getPopupContainer());return{left:a+i-(o-n)/2,top:s+15}},getPopupAngleOffset(t){const e=33;const{width:i}=main_core.Dom.getPosition(t);return(i-e)/2},onMouseEnterToPopup(){this.isMouseOnHintArea=true},onHintAreaMouseLeave(){this.isMouseOnHintArea=false;setTimeout((()=>{if(!this.isMouseOnHintArea){this.hideHintPopup()}}),400)},onMouseEnterToHint(){this.isMouseOnHintArea=true;this.showHintPopupWithDebounce()},showHintPopup(){if(!this.isMouseOnHintArea||this.hintPopup&&this.hintPopup.isShown()){return}this.hintPopup=new main_popup.Popup(this.getPopupOptions());const t=this.hintPopup.getPopupContainer();main_core.Event.bind(t,"mouseenter",this.onMouseEnterToPopup);main_core.Event.bind(t,"mouseleave",this.onHintAreaMouseLeave);this.hintPopup.show();this.hintPopup.setBindElement(this.getPopupPosition());this.hintPopup.setAngle(false);this.hintPopup.setAngle({offset:this.getPopupAngleOffset(t,this.$refs.hint)});this.hintPopup.adjustPosition();this.hintPopup.show()},showHintPopupWithDebounce(){main_core.Runtime.debounce(this.showHintPopup,300,this)()},hideHintPopup(){if(!this.hintPopup){return}this.hintPopup.close();const t=this.hintPopup.getPopupContainer();main_core.Event.unbind(t,"mouseenter",this.onMouseEnterToPopup);main_core.Event.unbind(t,"mouseleave",this.onHintAreaMouseLeave);this.hintPopup.destroy();this.hintPopup=null},hideHintPopupWithDebounce(){return main_core.Runtime.debounce(this.hideHintPopup,300,this)},getContentBlockNode(t){if(t.type==="text"){return this.getTextNode(t.options)}else if(t.type==="link"){return this.getLinkNode(t.options)}return null},getTextNode(t={}){return main_core.Dom.create("span",{text:t.text})},getLinkNode(t={}){const e=main_core.Dom.create("span",{text:t.text});main_core.Dom.addClass(e,"crm-timeline__hint_popup-content-link");e.onclick=()=>{this.executeAction(t.action)};return e},executeAction(t){if(t){const e=new Action(t);e.execute(this)}}},template:`\n\t\t<span\n\t\t\tref="hint"\n\t\t\t@click.stop.prevent\n\t\t\t@mouseenter="onMouseEnterToHint"\n\t\t\t@mouseleave="onHintAreaMouseLeave"\n\t\t\tv-if="hasContent"\n\t\t\t:class="hintIconClassname"\n\t\t>\n\t\t\t<span class="ui-hint-icon" />\n\t\t</span>\n\t`};let TagType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TagType,"PRIMARY","primary");babelHelpers.defineProperty(TagType,"SECONDARY","secondary");babelHelpers.defineProperty(TagType,"SUCCESS","success");babelHelpers.defineProperty(TagType,"WARNING","warning");babelHelpers.defineProperty(TagType,"FAILURE","failure");babelHelpers.defineProperty(TagType,"LAVENDER","lavender");const Tag={props:{title:{type:String,required:false,default:""},hint:{type:String,required:false,default:""},action:{type:Object,required:false,default:null},type:{type:String,required:false,default:TagType.SECONDARY},state:String},computed:{className(){return{"crm-timeline__card-status":true,"--clickable":Boolean(this.action),"--hint":Boolean(this.hint)}},tagTypeToLabelColorDict(){return{[TagType.PRIMARY]:ui_label.Label.Color.LIGHT_BLUE,[TagType.SECONDARY]:ui_label.Label.Color.LIGHT,[TagType.LAVENDER]:ui_label.Label.Color.LAVENDER,[TagType.SUCCESS]:ui_label.Label.Color.LIGHT_GREEN,[TagType.WARNING]:ui_label.Label.Color.LIGHT_YELLOW,[TagType.FAILURE]:ui_label.Label.Color.LIGHT_RED}},tagContainerRef(){return this.$refs.tag}},methods:{getLabelColorFromTagType(t){const e=t?t.toLowerCase():"";const i=this.tagTypeToLabelColorDict[e];return i||ui_label.Label.Color.LIGHT},renderTag(t){if(!t||!this.tagContainerRef){return null}const{title:e,type:i}=t;const n=e&&main_core.Type.isString(e)?e.toUpperCase():"";const a=new ui_label.Label({text:n,color:this.getLabelColorFromTagType(i),fill:true});main_core.Dom.clean(this.tagContainerRef);main_core.Dom.append(a.render(),this.tagContainerRef)},executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)},showTooltip(){if(this.hint===""){return}main_core.Runtime.debounce((()=>{BX.UI.Hint.show(this.$el,this.hint,true)}),50,this)()},hideTooltip(){if(this.hint===""){return}BX.UI.Hint.hide(this.$el)}},mounted(){this.renderTag({title:this.title,type:this.type})},updated(){this.renderTag({title:this.title,type:this.type})},template:`\n\t\t<div\n\t\t\tref="tag"\n\t\t\t:class="className"\n\t\t\t@mouseover="showTooltip"\n\t\t\t@mouseleave="hideTooltip"\n\t\t\t@click="executeAction"\n\t\t></div>\n\t`};const Title={props:{title:String,action:Object},inject:["isLogMessage"],computed:{className(){return["crm-timeline__card-title",{"--light":this.isLogMessage,"--action":!!this.action}]},href(){if(!this.action){return null}const t=new Action(this.action);if(t.isRedirect()){return t.getValue()}return null}},methods:{executeAction(){if(!this.action){return}const t=new Action(this.action);t.execute(this)}},template:`\n\t\t<a\n\t\t\tv-if="href"\n\t\t\t:href="href"\n\t\t\t:class="className"\n\t\t\ttabindex="0"\n\t\t\t:title="title"\n\t\t>\n\t\t\t{{title}}\n\t\t</a>\n\t\t<span\n\t\t\tv-else\n\t\t\t@click="executeAction"\n\t\t\t:class="className"\n\t\t\ttabindex="0"\n\t\t\t:title="title"\n\t\t>\n\t\t\t{{title}}\n\t\t</span>`};const User={props:{title:String,detailUrl:String,imageUrl:String},inject:["isLogMessage"],computed:{styles(){if(!this.imageUrl){return{}}return{backgroundImage:"url('"+encodeURI(main_core.Text.encode(this.imageUrl))+"')",backgroundSize:"21px"}},className(){return["ui-icon","ui-icon-common-user","crm-timeline__user-icon",{"--muted":this.isLogMessage}]}},template:`<a :class="className" :href="detailUrl"\n\t\t\t\t  target="_blank" :title="title"><i :style="styles"></i></a>`};const Header={components:{ColorSelector:ColorSelector,ChangeStreamButton:ChangeStreamButton,Title:Title,Tag:Tag,User:User,FormatDate:FormatDate,Hint:Hint},props:{title:String,titleAction:Object,date:Number,datePlaceholder:String,useShortTimeFormat:Boolean,changeStreamButton:Object|null,tags:Object,user:Object,infoHelper:Object,colorSettings:{type:Object,required:false,default:null}},inject:["isReadOnly","isLogMessage"],computed:{visibleTags(){if(!main_core.Type.isPlainObject(this.tags)){return[]}return this.tags?Object.values(this.tags).filter((t=>this.isVisibleTagFilter(t))):[]},visibleAndAscSortedTags(){const t=main_core.Runtime.clone(this.visibleTags);return t.sort(this.tagsAscSorter)},isShowDate(){return this.date||this.datePlaceholder},className(){return["crm-timeline__card-top",{"--log-message":this.isReadOnly||this.isLogMessage}]}},methods:{isVisibleTagFilter(t){return t.state!=="hidden"&&t.scope!=="mobile"&&(!this.isReadOnly||!t.hideIfReadonly)},tagsAscSorter(t,e){return t.sort-e.sort},getChangeStreamButton(){return this.$refs.changeStreamButton}},created(){this.$watch("colorSettings",(t=>{this.$refs.colorSelector.setValue(t.selectedValueId)}),{deep:true})},template:`\n\t\t<div :class="className">\n\t\t\t<div class="crm-timeline__card-top_info">\n\t\t\t\t<div class="crm-timeline__card-top_info_left">\n\t\t\t\t\t<ChangeStreamButton \n\t\t\t\t\t\tv-if="changeStreamButton" \n\t\t\t\t\t\tv-bind="changeStreamButton" \n\t\t\t\t\t\tref="changeStreamButton"\n\t\t\t\t\t/>\n\t\t\t\t\t<Title :title="title" :action="titleAction"></Title>\n\t\t\t\t\t<Hint v-if="infoHelper" v-bind="infoHelper"></Hint>\n\t\t\t\t</div>\n\t\t\t\t<div ref="tags" class="crm-timeline__card-top_info_right">\n\t\t\t\t\t<Tag\n\t\t\t\t\t\tv-for="(tag, index) in visibleAndAscSortedTags"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\tv-bind="tag"\n\t\t\t\t\t/>\n\t\t\t\t\t<FormatDate\n\t\t\t\t\t\tv-if="isShowDate"\n\t\t\t\t\t\t:timestamp="date"\n\t\t\t\t\t\t:use-short-time-format="useShortTimeFormat"\n\t\t\t\t\t\t:date-placeholder="datePlaceholder"\n\t\t\t\t\t\tclass="crm-timeline__card-time"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-top_components-container">\n\t\t\t\t<ColorSelector\n\t\t\t\t\tv-if="colorSettings"\n\t\t\t\t\tref="colorSelector"\n\t\t\t\t\t:valuesList="colorSettings.valuesList"\n\t\t\t\t\t:selectedValueId="colorSettings.selectedValueId"\n\t\t\t\t\t:readOnlyMode="colorSettings.readOnlyMode"\n\t\t\t\t/>\n\t\t\t\t<User v-bind="user"></User>\n\t\t\t</div>\n\t\t</div>\n\t`};let IconBackgroundColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(IconBackgroundColor,"PRIMARY","primary");babelHelpers.defineProperty(IconBackgroundColor,"PRIMARY_ALT","primary_alt");babelHelpers.defineProperty(IconBackgroundColor,"FAILURE","failure");const Icon={props:{code:{type:String,required:false,default:"none"},counterType:{type:String,required:false,default:""},backgroundColorToken:{type:String,required:false,default:IconBackgroundColor.PRIMARY},backgroundUri:String,backgroundColor:{type:String,required:false,default:null}},inject:["isLogMessage"],computed:{className(){return{"crm-timeline__card_icon":true,[`--bg-${this.backgroundColorToken}`]:Boolean(this.backgroundColorToken),[`--code-${this.code}`]:Boolean(this.code)&&!this.backgroundUri,"--custom-bg":Boolean(this.backgroundUri),"--muted":this.isLogMessage}},counterNodeContainer(){return this.$refs.counter},styles(){if(!this.backgroundUri){return{}}return{backgroundImage:`url('${encodeURI(main_core.Text.encode(this.backgroundUri))}')`}},iconStyle(){if(main_core.Type.isStringFilled(this.backgroundColor)){return{"--crm-timeline-card-icon-background":main_core.Text.encode(this.backgroundColor)}}return{}}},methods:{renderCounter(){if(!this.counterType){return}main_core.Dom.clean(this.counterNodeContainer);const t=new ui_cnt.Counter({value:1,border:true,color:ui_cnt.Counter.Color[this.counterType.toUpperCase()]});t.renderTo(this.counterNodeContainer)}},mounted(){this.renderCounter()},watch:{counterType(t){void this.$nextTick((()=>{this.renderCounter()}))}},template:`\n\t\t<div :class="className" :style="iconStyle">\n\t\t\t<i :style="styles"></i>\n\t\t\t<div ref="counter" v-show="!!counterType" class="crm-timeline__card_icon_counter"></div>\n\t\t</div>\n\t`};const MarketPanel={props:{text:String,detailsText:String,detailsTextAction:Object},computed:{needShowDetailsText(){return main_core.Type.isStringFilled(this.detailsText)},href(){if(!this.detailsTextAction){return null}const t=new Action(this.detailsTextAction);if(t.isRedirect()){return t.getValue()}return null}},methods:{executeAction(){if(this.detailsTextAction){const t=new Action(this.detailsTextAction);t.execute(this)}}},template:`\n\t\t<div class="crm-timeline__card-bottom">\n\t\t<div class="crm-timeline__card-market">\n\t\t\t<div class="crm-timeline__card-market_container">\n\t\t\t\t<span class="crm-timeline__card-market_logo"></span>\n\t\t\t\t<span class="crm-timeline__card-market_text">{{ text }}</span>\n\t\t\t\t<a\n\t\t\t\t\tv-if="href && needShowDetailsText"\n\t\t\t\t\t:href="href"\n\t\t\t\t\tclass="crm-timeline__card-market_more"\n\t\t\t\t>\n\t\t\t\t\t{{detailsText}}\n\t\t\t\t</a>\n\t\t\t\t<span\n\t\t\t\t\tv-if="!href && needShowDetailsText"\n\t\t\t\t\t@click="executeAction"\n\t\t\t\t\tclass="crm-timeline__card-market_more"\n\t\t\t\t>\n\t\t\t\t{{detailsText}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-market_cross"><i></i></div>\n\t\t</div>\n\t\t</div>\n\t`};const UserPick={template:`\n\t\t<div class="ui-icon ui-icon-common-user crm-timeline__card-top_user-icon">\n\t\t\t<i></i>\n\t\t</div>\n\t`};const Item={components:{Icon:Icon,Header:Header,Body:Body,Footer:Footer,MarketPanel:MarketPanel,UserPick:UserPick},props:{initialLayout:Object,id:String,useShortTimeFormat:Boolean,isLogMessage:Boolean,isReadOnly:Boolean,currentUser:Object|null,onAction:Function,initialColor:{type:Object,required:false,default:null},streamType:{type:Number,required:false,default:StreamType.history}},data(){return{layout:this.initialLayout,color:this.initialColor,isFaded:false,loader:Object.freeze(null)}},provide(){var t;return{isLogMessage:Boolean((t=this.initialLayout)===null||t===void 0?void 0:t.isLogMessage),isReadOnly:this.isReadOnly,currentUser:this.currentUser}},created(){this.$Bitrix.eventEmitter.subscribe("crm:timeline:item:action",this.onActionEvent)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe("crm:timeline:item:action",this.onActionEvent)},methods:{onActionEvent(t){const e=t.getData();this.onAction(main_core.Runtime.clone(e))},setLayout(t){this.layout=t;this.isFaded=false;this.$Bitrix.eventEmitter.emit("layout:updated")},setColor(t){this.color=t},setFaded(t){this.isFaded=t},showLoader(t){if(t){this.setFaded(true);if(!this.loader){this.loader=new main_loader.Loader}this.loader.show(this.$el.parentNode)}else{if(this.loader){this.loader.hide()}this.setFaded(false)}},getContentBlockById(t){if(!this.$refs.body){return null}return this.$refs.body.getContentBlockById(t)},getLogo(){if(!this.$refs.body){return null}return this.$refs.body.getLogo()},getHeaderChangeStreamButton(){if(!this.$refs.header){return null}return this.$refs.header.getChangeStreamButton()},getFooterButtonById(t){if(!this.$refs.footer){return null}return this.$refs.footer.getButtonById(t)},getFooterMenu(){if(!this.$refs.footer){return null}return this.$refs.footer.getMenu()},highlightContentBlockById(t,e){if(!e){this.isFaded=false}const i=this.getContentBlockById(t);if(!i){return}if(e){this.isFaded=true;main_core.Dom.addClass(i.$el,"--highlighted")}else{this.isFaded=false;main_core.Dom.removeClass(i.$el,"--highlighted")}}},computed:{timelineCardClassname(){return{"crm-timeline__card":true,"crm-timeline__card-scope":true,"--stream-type-history":this.streamType===StreamType.history,"--stream-type-scheduled":this.streamType===StreamType.scheduled,"--stream-type-pinned":this.streamType===StreamType.pinned,"--log-message":this.isLogMessage}},timelineCardStyle(){if(main_core.Type.isPlainObject(this.color)&&this.streamType===StreamType.scheduled){return{"--crm-timeline__card-color-background":main_core.Text.encode(this.color.itemBackground)}}return{}}},template:`\n\t  \t<div class="crm-timeline__card-wrapper">\n\t\t\t<div class="crm-timeline__card_icon_container">\n\t\t\t\t<Icon v-bind="layout.icon"></Icon>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\t:data-id="id" \n\t\t\t\tref="timelineCard" \n\t\t\t\t:class="timelineCardClassname"\n\t\t\t\t:style="timelineCardStyle"\n\t\t\t>\n\t\t\t\t<div class="crm-timeline__card_fade" v-if="isFaded"></div>\n\t\t\t\t<Header \n\t\t\t\t\tv-if="layout.header"\n\t\t\t\t\tv-bind="layout.header"\n\t\t\t\t\t:use-short-time-format="useShortTimeFormat"\n\t\t\t\t\tref="header"\n\t\t\t\t/>\n\t\t\t\t<Body v-if="layout.body" v-bind="layout.body" ref="body"></Body>\n\t\t\t\t<Footer v-if="layout.footer" v-bind="layout.footer" ref="footer"></Footer>\n\t\t\t\t<MarketPanel v-if="layout.marketPanel" v-bind="layout.marketPanel"></MarketPanel>\n\t\t\t</div>\n\t\t</div>\n\t`};function _classPrivateFieldInitSpec$2(t,e,i){_checkPrivateRedeclaration$3(t,e);e.set(t,i)}function _checkPrivateRedeclaration$3(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classStaticPrivateFieldSpecGet(t,e,i){_classCheckPrivateStaticAccess(t,e);_classCheckPrivateStaticFieldDescriptor(i,"get");return _classApplyDescriptorGet(t,i)}function _classCheckPrivateStaticFieldDescriptor(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function _classCheckPrivateStaticAccess(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function _classApplyDescriptorGet(t,e){if(e.get){return e.get.call(t)}return e.value}var _id=new WeakMap;let ControllerManager=function(){function t(e){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec$2(this,_id,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_id,e)}babelHelpers.createClass(t,[{key:"getItemControllers",value:function e(i){const n=[];for(const e of t.getRegisteredControllers()){if(e.isItemSupported(i)){const t=new e;t.onInitialize(i);n.push(t)}}return n}}],[{key:"getInstance",value:function e(i){if(!_classStaticPrivateFieldSpecGet(this,t,_instances).hasOwnProperty(i)){_classStaticPrivateFieldSpecGet(this,t,_instances)[i]=new t(i)}return _classStaticPrivateFieldSpecGet(this,t,_instances)[i]}},{key:"registerController",value:function e(i){_classStaticPrivateFieldSpecGet(this,t,_availableControllers).push(i)}},{key:"getRegisteredControllers",value:function e(){return _classStaticPrivateFieldSpecGet(this,t,_availableControllers)}}]);return t}();var _instances={writable:true,value:{}};var _availableControllers={writable:true,value:[]};let Base=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"getDeleteActionMethod",value:function t(){return""}},{key:"getDeleteActionCfg",value:function t(e,i,n){return{data:{recordId:e,ownerTypeId:i,ownerId:n}}}},{key:"onInitialize",value:function t(e){}},{key:"onItemAction",value:function t(e,i){}},{key:"getContentBlockComponents",value:function t(e){return{}}},{key:"onAfterItemRefreshLayout",value:function t(e){}},{key:"onAfterItemLayout",value:function t(e,i){}},{key:"onBeforeItemClearLayout",value:function t(e){}},{key:"runDeleteAction",value:function t(e,i,n,a){if(a.onStart){a.onStart()}return main_core.ajax.runAction(this.getDeleteActionMethod(),this.getDeleteActionCfg(e,i,n)).then((()=>{if(a.onStop){a.onStop()}return true}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(a.onStop){a.onStop()}return true}))}},{key:"runScheduleAction",value:function t(e,i){var n,a,s;const o=(n=BX.Crm)===null||n===void 0?void 0:(a=n.Timeline)===null||a===void 0?void 0:(s=a.MenuBar)===null||s===void 0?void 0:s.getDefault();if(o){o.setActiveItemById("todo");const t=o.getItemById("todo");t.focus();t.setParentActivityId(e);t.setDeadLine(i)}}}],[{key:"isItemSupported",value:function t(e){return false}}]);return t}();let Item$1=function(){function t(){babelHelpers.classCallCheck(this,t);this._id="";this._isTerminated=false;this._wrapper=null}babelHelpers.createClass(t,[{key:"getId",value:function t(){return this._id}},{key:"_setId",value:function t(e){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4)}},{key:"setData",value:function t(e){throw new Error("Item.setData() must be overridden")}},{key:"layout",value:function t(e){throw new Error("Item.layout() must be overridden")}},{key:"refreshLayout",value:function t(){const e=this._wrapper.previousSibling;this.clearLayout();this.layout({anchor:e})}},{key:"clearLayout",value:function t(){main_core.Dom.remove(this._wrapper);this._wrapper=undefined}},{key:"destroy",value:function t(){this.clearLayout()}},{key:"getWrapper",value:function t(){return this._wrapper}},{key:"setWrapper",value:function t(e){this._wrapper=e}},{key:"addWrapperClass",value:function t(e,i){if(!this._wrapper){return}main_core.Dom.addClass(this._wrapper,e);if(main_core.Type.isNumber(i)&&i>=0){window.setTimeout(this.removeWrapperClass.bind(this,e),i)}}},{key:"removeWrapperClass",value:function t(e,i){if(!this._wrapper){return}main_core.Dom.removeClass(this._wrapper,e);if(main_core.Type.isNumber(i)&&i>=0){window.setTimeout(this.addWrapperClass.bind(this,e),i)}}},{key:"isTerminated",value:function t(){return this._isTerminated}},{key:"markAsTerminated",value:function t(e){e=!!e;if(this._isTerminated===e){return}this._isTerminated=e;if(!this._wrapper){return}if(e){main_core.Dom.addClass(this._wrapper,"crm-entity-stream-section-last")}else{main_core.Dom.removeClass(this._wrapper,"crm-entity-stream-section-last")}}},{key:"getAssociatedEntityTypeId",value:function t(){return null}},{key:"getAssociatedEntityId",value:function t(){return null}}]);return t}();function _classPrivateFieldInitSpec$3(t,e,i){_checkPrivateRedeclaration$4(t,e);e.set(t,i)}function _checkPrivateRedeclaration$4(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _layout=new WeakMap;let Layout=function(){function t(e){babelHelpers.classCallCheck(this,t);_classPrivateFieldInitSpec$3(this,_layout,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_layout,e)}babelHelpers.createClass(t,[{key:"asPlainObject",value:function t(){return main_core.Runtime.clone(babelHelpers.classPrivateFieldGet(this,_layout))}},{key:"getFooterMenuItemById",value:function t(e){var i,n,a,s;const o=(i=(n=babelHelpers.classPrivateFieldGet(this,_layout))===null||n===void 0?void 0:(a=n.footer)===null||a===void 0?void 0:(s=a.menu)===null||s===void 0?void 0:s.items)!==null&&i!==void 0?i:{};return o.hasOwnProperty(e)?o.id:null}},{key:"addFooterMenuItem",value:function t(e){babelHelpers.classPrivateFieldGet(this,_layout).footer=babelHelpers.classPrivateFieldGet(this,_layout).footer||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu=babelHelpers.classPrivateFieldGet(this,_layout).footer.menu||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items=babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items||{};babelHelpers.classPrivateFieldGet(this,_layout).footer.menu.items[e.id]=e}}]);return t}();function _classPrivateMethodInitSpec$2(t,e){_checkPrivateRedeclaration$5(t,e);e.add(t)}function _classPrivateFieldInitSpec$4(t,e,i){_checkPrivateRedeclaration$5(t,e);e.set(t,i)}function _checkPrivateRedeclaration$5(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$2(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _container=new WeakMap;var _itemClassName=new WeakMap;var _type$1=new WeakMap;var _dataPayload=new WeakMap;var _timelineId=new WeakMap;var _timestamp=new WeakMap;var _sort=new WeakMap;var _useShortTimeFormat=new WeakMap;var _isReadOnly=new WeakMap;var _currentUser=new WeakMap;var _ownerTypeId=new WeakMap;var _ownerId=new WeakMap;var _controllers=new WeakMap;var _layoutComponent=new WeakMap;var _layoutApp=new WeakMap;var _layout$1=new WeakMap;var _streamType=new WeakMap;var _color=new WeakMap;var _useAnchorNextSibling=new WeakSet;var _initLayoutApp=new WeakSet;var _getLayoutAppProps=new WeakSet;var _onLayoutAppAction=new WeakSet;var _getContentBlockComponents=new WeakSet;let ConfigurableItem=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_getContentBlockComponents);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_onLayoutAppAction);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_getLayoutAppProps);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_initLayoutApp);_classPrivateMethodInitSpec$2(babelHelpers.assertThisInitialized(i),_useAnchorNextSibling);_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_container,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_itemClassName,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_type$1,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_dataPayload,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_timelineId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_timestamp,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_sort,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_useShortTimeFormat,{writable:true,value:false});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_isReadOnly,{writable:true,value:false});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_currentUser,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_ownerTypeId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_ownerId,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_controllers,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layoutComponent,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layoutApp,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_layout$1,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_streamType,{writable:true,value:null});_classPrivateFieldInitSpec$4(babelHelpers.assertThisInitialized(i),_color,{writable:true,value:null});return i}babelHelpers.createClass(e,[{key:"initialize",value:function t(e,i){this._setId(e);i=i||{};babelHelpers.classPrivateFieldSet(this,_timelineId,i.timelineId||"");this.setContainer(i.container||null);babelHelpers.classPrivateFieldSet(this,_itemClassName,i.itemClassName||"");if(main_core.Type.isPlainObject(i.data)){this.setData(i.data);babelHelpers.classPrivateFieldSet(this,_useShortTimeFormat,i.useShortTimeFormat||false);babelHelpers.classPrivateFieldSet(this,_isReadOnly,i.isReadOnly||false);babelHelpers.classPrivateFieldSet(this,_currentUser,i.currentUser||null);babelHelpers.classPrivateFieldSet(this,_ownerTypeId,i.ownerTypeId);babelHelpers.classPrivateFieldSet(this,_ownerId,i.ownerId);babelHelpers.classPrivateFieldSet(this,_streamType,i.streamType||crm_timeline_item.StreamType.history)}babelHelpers.classPrivateFieldSet(this,_controllers,ControllerManager.getInstance(babelHelpers.classPrivateFieldGet(this,_timelineId)).getItemControllers(this))}},{key:"setData",value:function t(e){var i;babelHelpers.classPrivateFieldSet(this,_type$1,e.type||null);babelHelpers.classPrivateFieldSet(this,_timestamp,e.timestamp||null);babelHelpers.classPrivateFieldSet(this,_sort,e.sort||[]);babelHelpers.classPrivateFieldSet(this,_layout$1,new Layout(e.layout||{}));babelHelpers.classPrivateFieldSet(this,_dataPayload,e.payload||{});babelHelpers.classPrivateFieldSet(this,_color,(i=e.color)!==null&&i!==void 0?i:null)}},{key:"getColor",value:function t(){return babelHelpers.classPrivateFieldGet(this,_color)}},{key:"getLayout",value:function t(){return babelHelpers.classPrivateFieldGet(this,_layout$1)}},{key:"getType",value:function t(){return babelHelpers.classPrivateFieldGet(this,_type$1)}},{key:"getDataPayload",value:function t(){return babelHelpers.classPrivateFieldGet(this,_dataPayload)}},{key:"layout",value:function t(e){this.setWrapper(main_core.Dom.create({tag:"div",attrs:{className:babelHelpers.classPrivateFieldGet(this,_itemClassName)}}));this.initLayoutApp(e)}},{key:"initWrapper",value:function t(){this.setWrapper(main_core.Dom.create({tag:"div",attrs:{className:babelHelpers.classPrivateFieldGet(this,_itemClassName)}}));return this._wrapper}},{key:"initLayoutApp",value:function t(e){_classPrivateMethodGet$2(this,_initLayoutApp,_initLayoutApp2).call(this);if(this.needBindToContainer(e)){const t=this.getBindToNode(e);if(t&&!_classPrivateMethodGet$2(this,_useAnchorNextSibling,_useAnchorNextSibling2).call(this,e)){main_core.Dom.insertBefore(this.getWrapper(),t)}else if(t&&t.nextSibling){main_core.Dom.insertBefore(this.getWrapper(),t.nextSibling)}else{main_core.Dom.append(this.getWrapper(),babelHelpers.classPrivateFieldGet(this,_container))}}for(const t of babelHelpers.classPrivateFieldGet(this,_controllers)){t.onAfterItemLayout(this,e)}}},{key:"needBindToContainer",value:function t(e){if(main_core.Type.isPlainObject(e)){return BX.prop.getBoolean(e,"add",true)}return true}},{key:"getBindToNode",value:function t(e){if(main_core.Type.isPlainObject(e)){return main_core.Type.isElementNode(e["anchor"])?e["anchor"]:null}return null}},{key:"refreshLayout",value:function t(){if(babelHelpers.classPrivateFieldGet(this,_layoutComponent)){babelHelpers.classPrivateFieldGet(this,_layoutComponent).setColor(this.getColor());babelHelpers.classPrivateFieldGet(this,_layoutComponent).setLayout(this.getLayout().asPlainObject());for(const t of babelHelpers.classPrivateFieldGet(this,_controllers)){t.onAfterItemRefreshLayout(this)}babelHelpers.classPrivateFieldGet(this,_layoutComponent).showLoader(false)}else{babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"refreshLayout",this).call(this)}}},{key:"getLayoutComponent",value:function t(){return babelHelpers.classPrivateFieldGet(this,_layoutComponent)}},{key:"forceRefreshLayout",value:function t(){var e;const i=(e=this.getWrapper())===null||e===void 0?void 0:e.nextSibling;this.clearLayout();this.layout({anchor:i,useAnchorNextSibling:false})}},{key:"getLayoutContentBlockById",value:function t(e){var i;return(i=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||i===void 0?void 0:i.getContentBlockById(e)}},{key:"getLogo",value:function t(){var e;return(e=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||e===void 0?void 0:e.getLogo()}},{key:"getLayoutFooterButtonById",value:function t(e){var i;return(i=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||i===void 0?void 0:i.getFooterButtonById(e)}},{key:"getLayoutFooterMenu",value:function t(){var e;return(e=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||e===void 0?void 0:e.getFooterMenu()}},{key:"getLayoutHeaderChangeStreamButton",value:function t(){var e;return(e=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||e===void 0?void 0:e.getHeaderChangeStreamButton()}},{key:"highlightContentBlockById",value:function t(e,i){var n;(n=babelHelpers.classPrivateFieldGet(this,_layoutComponent))===null||n===void 0?void 0:n.highlightContentBlockById(e,i)}},{key:"clearLayout",value:function t(){for(const t of babelHelpers.classPrivateFieldGet(this,_controllers)){t.onBeforeItemClearLayout(this)}babelHelpers.classPrivateFieldGet(this,_layoutApp).unmount();babelHelpers.classPrivateFieldSet(this,_layoutApp,null);babelHelpers.classPrivateFieldSet(this,_layoutComponent,null);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"clearLayout",this).call(this)}},{key:"getCreatedDate",value:function t(){const e=babelHelpers.classPrivateFieldGet(this,_timestamp)?babelHelpers.classPrivateFieldGet(this,_timestamp):Date.now()/1e3;return BX.prop.extractDate(crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(e).toUserTime().getValue())}},{key:"getSourceId",value:function t(){let e=this.getId();if(!main_core.Type.isInteger(e)){e=main_core.Text.toInteger(e.replace(/^\D+/g,""))}return e}},{key:"setContainer",value:function t(e){babelHelpers.classPrivateFieldSet(this,_container,e)}},{key:"getContainer",value:function t(){return babelHelpers.classPrivateFieldGet(this,_container)}},{key:"getDeadline",value:function t(){if(!babelHelpers.classPrivateFieldGet(this,_timestamp)){return null}return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(babelHelpers.classPrivateFieldGet(this,_timestamp)).toUserTime().getValue()}},{key:"getSort",value:function t(){return babelHelpers.classPrivateFieldGet(this,_sort)}},{key:"isReadOnly",value:function t(){return babelHelpers.classPrivateFieldGet(this,_isReadOnly)}},{key:"getCurrentUser",value:function t(){return babelHelpers.classPrivateFieldGet(this,_currentUser)}},{key:"clone",value:function t(){return e.create(this.getId(),{timelineId:babelHelpers.classPrivateFieldGet(this,_timelineId),container:this.getContainer(),itemClassName:babelHelpers.classPrivateFieldGet(this,_itemClassName),useShortTimeFormat:babelHelpers.classPrivateFieldGet(this,_useShortTimeFormat),isReadOnly:babelHelpers.classPrivateFieldGet(this,_isReadOnly),currentUser:babelHelpers.classPrivateFieldGet(this,_currentUser),streamType:babelHelpers.classPrivateFieldGet(this,_streamType),data:{type:babelHelpers.classPrivateFieldGet(this,_type$1),timestamp:babelHelpers.classPrivateFieldGet(this,_timestamp),sort:babelHelpers.classPrivateFieldGet(this,_sort),layout:this.getLayout().asPlainObject()}})}},{key:"reloadFromServer",value:function t(e=false){const i={ownerTypeId:babelHelpers.classPrivateFieldGet(this,_ownerTypeId),ownerId:babelHelpers.classPrivateFieldGet(this,_ownerId)};if(babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.history||babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.pinned){i.historyIds=[this.getId()]}else if(babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.scheduled){i.activityIds=[this.getId()]}else{throw new Error("Wrong stream type")}return main_core.ajax.runAction("crm.timeline.item.load",{data:i}).then((t=>{Object.values(t.data).forEach((t=>{if(t.id===this.getId()){this.setData(t);if(e){this.forceRefreshLayout()}else{this.refreshLayout()}}}));return true})).catch((t=>{console.error(t);return true}))}}],[{key:"create",value:function t(i,n){const a=new e;a.initialize(i,n);return a}}]);return e}(Item$1);function _useAnchorNextSibling2(t){if(main_core.Type.isPlainObject(t)){return main_core.Type.isBoolean(t["useAnchorNextSibling"])?t["useAnchorNextSibling"]:true}return true}function _initLayoutApp2(){if(!babelHelpers.classPrivateFieldGet(this,_layoutApp)){babelHelpers.classPrivateFieldSet(this,_layoutApp,ui_vue3.BitrixVue.createApp(Item,_classPrivateMethodGet$2(this,_getLayoutAppProps,_getLayoutAppProps2).call(this)));const t=_classPrivateMethodGet$2(this,_getContentBlockComponents,_getContentBlockComponents2).call(this);for(const e in t){babelHelpers.classPrivateFieldGet(this,_layoutApp).component(e,t[e])}babelHelpers.classPrivateFieldSet(this,_layoutComponent,babelHelpers.classPrivateFieldGet(this,_layoutApp).mount(this.getWrapper()))}}function _getLayoutAppProps2(){return{initialLayout:this.getLayout().asPlainObject(),initialColor:babelHelpers.classPrivateFieldGet(this,_streamType)===crm_timeline_item.StreamType.scheduled?babelHelpers.classPrivateFieldGet(this,_color):null,id:String(this.getId()),useShortTimeFormat:babelHelpers.classPrivateFieldGet(this,_useShortTimeFormat),isReadOnly:this.isReadOnly(),currentUser:this.getCurrentUser(),streamType:babelHelpers.classPrivateFieldGet(this,_streamType),onAction:_classPrivateMethodGet$2(this,_onLayoutAppAction,_onLayoutAppAction2).bind(this)}}function _onLayoutAppAction2(t){for(const e of babelHelpers.classPrivateFieldGet(this,_controllers)){e.onItemAction(this,t)}}function _getContentBlockComponents2(){let t={};for(const e of babelHelpers.classPrivateFieldGet(this,_controllers)){t=Object.assign(t,e.getContentBlockComponents(this))}return t}function _classPrivateMethodInitSpec$3(t,e){_checkPrivateRedeclaration$6(t,e);e.add(t)}function _classPrivateFieldInitSpec$5(t,e,i){_checkPrivateRedeclaration$6(t,e);e.set(t,i)}function _checkPrivateRedeclaration$6(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$3(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const ALLOWED_MOVE_TO_ITEM_TYPES=["Activity:Call","Activity:Email","Activity:OpenLine"];var _moveToSelectorDialog=new WeakMap;var _viewActivity=new WeakSet;var _editActivity=new WeakSet;var _showMoveToSelectorDialog=new WeakSet;var _getActivityEditor=new WeakSet;var _createSelectorDialog=new WeakSet;var _runMoveAction=new WeakSet;var _filterRelated=new WeakSet;let Activity=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_filterRelated);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_runMoveAction);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_createSelectorDialog);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_getActivityEditor);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_showMoveToSelectorDialog);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_editActivity);_classPrivateMethodInitSpec$3(babelHelpers.assertThisInitialized(i),_viewActivity);_classPrivateFieldInitSpec$5(babelHelpers.assertThisInitialized(i),_moveToSelectorDialog,{writable:true,value:null});return i}babelHelpers.createClass(e,[{key:"getDeleteActionMethod",value:function t(){return"crm.timeline.activity.delete"}},{key:"getMoveActionMethod",value:function t(){return"crm.activity.binding.move"}},{key:"getDeleteTagActionMethod",value:function t(){return"crm.timeline.activity.deleteTag"}},{key:"getDeleteActionCfg",value:function t(e,i,n){return{data:{activityId:e,ownerTypeId:i,ownerId:n}}}},{key:"runDeleteTagAction",value:function t(e,i,n){const a={data:{activityId:e,ownerTypeId:i,ownerId:n}};return main_core.ajax.runAction(this.getDeleteTagActionMethod(),a).then((()=>true),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});return true}))}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Activity:Edit"&&s&&s.activityId){_classPrivateMethodGet$3(this,_editActivity,_editActivity2).call(this,s.activityId)}if(n==="Activity:MoveTo"&&main_core.Type.isPlainObject(s)){_classPrivateMethodGet$3(this,_showMoveToSelectorDialog,_showMoveToSelectorDialog2).call(this,e,s)}if(n==="Activity:View"&&s&&s.activityId){_classPrivateMethodGet$3(this,_viewActivity,_viewActivity2).call(this,s.activityId)}if(n==="Activity:Delete"&&s&&s.activityId){var r;const t=(r=s.confirmationText)!==null&&r!==void 0?r:"";if(t){ui_dialogs_messagebox.MessageBox.show({message:main_core.Text.encode(t),modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>this.runDeleteAction(s.activityId,s.ownerTypeId,s.ownerId,o),onNo:t=>{t.close()}})}else{this.runDeleteAction(s.activityId,s.ownerTypeId,s.ownerId)}}if(n==="Activity:DeleteTag"&&s&&s.activityId){var l;const t=(l=s.confirmationText)!==null&&l!==void 0?l:"";if(t){ui_dialogs_messagebox.MessageBox.show({message:main_core.Text.encode(t),modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_CANCEL,yesCaption:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_TODO_DELETE_TAG_CONFIRM_YES_CAPTION"),onYes:()=>this.runDeleteTagAction(s.activityId,s.ownerTypeId,s.ownerId),onCancel:t=>{t.close()}})}else{this.runDeleteTagAction(s.activityId,s.ownerTypeId,s.ownerId)}}if(n==="Activity:FilterRelated"&&main_core.Type.isPlainObject(s)){_classPrivateMethodGet$3(this,_filterRelated,_filterRelated2).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){const i=e.getType();return i.indexOf("Activity:")===0||i==="TodoCreated"}}]);return e}(Base);function _viewActivity2(t){const e=_classPrivateMethodGet$3(this,_getActivityEditor,_getActivityEditor2).call(this);if(e&&t){e.viewActivity(t)}}function _editActivity2(t){const e=_classPrivateMethodGet$3(this,_getActivityEditor,_getActivityEditor2).call(this);if(e&&t){e.editActivity(t)}}function _showMoveToSelectorDialog2(t,e){if(!ALLOWED_MOVE_TO_ITEM_TYPES.includes(t.getType())){console.warn("Move to action provided only for following item types:",ALLOWED_MOVE_TO_ITEM_TYPES);return}const i=main_core.Type.isNumber(e.activityId)&&main_core.Type.isNumber(e.ownerId)&&main_core.Type.isNumber(e.ownerTypeId);if(!i){throw new TypeError("Invalid actionData parameters")}const n=t.getLayoutFooterMenu().$el;if(!main_core.Type.isDomNode(n)){throw new ReferenceError("Selector dialog target element must be a DOM node")}if(!babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog)){_classPrivateMethodGet$3(this,_createSelectorDialog,_createSelectorDialog2).call(this,n,e)}babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog).show()}function _getActivityEditor2(){return BX.CrmActivityEditor.getDefault()}function _createSelectorDialog2(t,e){const i=new ui_buttons.ApplyButton({color:ui_buttons.ButtonColor.PRIMARY,size:ui_buttons.ButtonSize.SMALL,round:true,onclick:()=>{_classPrivateMethodGet$3(this,_runMoveAction,_runMoveAction2).call(this,e.activityId,e.ownerTypeId,e.ownerId,a);babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog).hide()}});const n=new ui_buttons.CancelButton({size:ui_buttons.ButtonSize.SMALL,round:true,onclick:()=>{a=null;babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog).deselectAll();babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog).hide()}});let a=null;let s=BX.CrmEntityType.resolveName(e.ownerTypeId);if(BX.CrmEntityType.isDynamicTypeByTypeId(e.ownerTypeId)){s=BX.CrmEntityType.names.dynamic}babelHelpers.classPrivateFieldSet(this,_moveToSelectorDialog,new ui_entitySelector.Dialog({targetNode:t,enableSearch:true,context:`CRM-TIMELINE-MOVE-ACTIVITY-ENTITY-SELECTOR-${e.ownerTypeId}`,tagSelectorOptions:{textBoxWidth:"50%"},entities:[{id:s,dynamicLoad:true,dynamicSearch:true,options:{ownerId:e.ownerId,categoryId:e.categoryId,showEntityTypeNameInHeader:true,hideClosedItems:true,excludeMyCompany:true,entityTypeId:e.ownerTypeId}}],events:{"Item:onSelect":t=>{const{item:e}=t.getData();if(e){a=e;babelHelpers.classPrivateFieldGet(this,_moveToSelectorDialog).getSelectedItems().forEach((t=>{if(t.getEntityId()===a.getEntityId()&&main_core.Text.toInteger(t.getId())!==main_core.Text.toInteger(a.getId())){t.deselect()}}));i.setDisabled(false)}},"Item:onDeselect":()=>i.setDisabled(true)},footer:[i.setDisabled(true).render(),n.render()],footerOptions:{containerStyles:{display:"flex","justify-content":"center"}}}))}function _runMoveAction2(t,e,i,n){if(!n){throw new ReferenceError("Target item is not defined")}const a=BX.CrmEntityType.resolveId(n.getEntityId());const s=n.getId();if(a<=0||s<=0){throw new Error("Target entity in not valid")}if(main_core.Text.toInteger(a)!==main_core.Text.toInteger(e)){throw new Error("Source and target entity types are not equal")}const o={activityId:t,sourceEntityTypeId:e,sourceEntityId:i,targetEntityTypeId:a,targetEntityId:s};main_core.ajax.runAction(this.getMoveActionMethod(),{data:o}).catch((t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});throw t}))}function _filterRelated2(t){if(!(main_core.Type.isNumber(t.activityId)&&main_core.Type.isStringFilled(t.activityLabel)&&main_core.Type.isStringFilled(t.filterId))){return}const e=BX.Main.filterManager.getById(t.filterId);if(!e){return}const i=e.getApi();const n={ACTIVITY:t.activityId,ACTIVITY_label:t.activityLabel};i.extendFilter(n,true);BX.CrmTimelineManager.getDefault().getHistory().showFilter()}var AddressBlock={props:{addressFormatted:String},mounted(){void this.$nextTick((()=>{this.renderAddressWidget()}))},methods:{renderAddressWidget(){const t=main_core.Extension.getSettings("crm.timeline.item");if(!t.hasLocationModule){return}const e=new BX.Location.Widget.Factory;const i=new location_core.Format(JSON.parse(main_core.Loc.getMessage("CRM_ACTIVITY_TODO_ADDRESS_FORMAT")));const n=new location_core.Address({languageId:i.languageId});n.setFieldValue(i.fieldForUnRecognized,this.addressFormatted);const a=e.createAddressWidget({address:n,mode:location_core.ControlMode.view});const s={mode:location_core.ControlMode.view,mapBindElement:this.$refs.mapBindElement,controlWrapper:this.$refs.controlWrapper};a.render(s)}},template:`\n\t\t<div class="crm-timeline__text-block crm-timeline__address-block">\n\t\t\t<div ref="mapBindElement">\n\t\t\t\t<div ref="controlWrapper" class="crm-timeline__address-block-address-wrapper">\n\t\t\t\t\t<span \n\t\t\t\t\t\t:title="addressFormatted"\n\t\t\t\t\t\tclass="ui-link ui-link-dark ui-link-dotted"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{addressFormatted}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let ClientMark=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(ClientMark,"POSITIVE","positive");babelHelpers.defineProperty(ClientMark,"NEUTRAL","neutral");babelHelpers.defineProperty(ClientMark,"NEGATIVE","negative");const ClientMark$1={props:{mark:{type:String,required:false,default:ClientMark.POSITIVE},text:{type:String,required:false,default:""}},computed:{className(){return{"crm-timeline__client-mark":true,"--positive-mark":this.mark===ClientMark.POSITIVE,"--neutral-mark":this.mark===ClientMark.NEUTRAL,"--negative-mark":this.mark===ClientMark.NEGATIVE}},iconClassname(){return{"crm-timeline__client-mark_icon":true,"--flipped":this.mark===ClientMark.NEGATIVE}}},template:`\n\t\t<div :class="className">\n\t\t\t<i class="crm-timeline__client-mark_icon-wrapper">\n\t\t\t\t<svg :class="iconClassname" width="11.35" height="11.36" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M14.8367 6.7166L11.2351 6.71731C11.1314 6.71731 11.0313 6.65735 10.9925 6.56213C10.8303 6.15654 10.8366 5.69947 11.0144 5.29671C11.3127 4.42841 11.3466 3.49029 11.1124 2.60224C10.8676 1.9914 10.8028 0.875521 9.67347 0.82403C9.32009 0.876226 9.01184 1.08854 8.8341 1.39819C8.80235 1.45321 8.78895 1.5181 8.78895 1.58088C8.78895 1.58088 8.84085 2.6644 8.78895 3.41764C8.73706 4.17087 7.29571 6.08954 6.37945 7.30769C6.32161 7.38528 6.24049 7.43607 6.14456 7.45088C5.80104 7.50232 5.14581 7.58943 4.90962 7.62062C4.85434 7.62792 4.82201 7.69735 4.82201 7.72994C4.82201 9.2527 4.82201 11.5306 4.82201 14.5636C4.82201 14.5887 4.85234 14.6435 4.90623 14.6524C5.09126 14.6829 5.55408 14.7676 6.02112 14.9178C6.60798 15.1061 7.0968 15.5519 8.07513 15.882C8.12662 15.8997 8.18375 15.9088 8.23807 15.9088H12.8321C13.4253 15.803 13.8668 15.2959 13.8972 14.6872C13.9056 14.3479 13.8379 14.0121 13.699 13.7039C13.6792 13.6594 13.7053 13.6129 13.7533 13.6037C14.3422 13.4965 15.0786 12.3785 14.1715 11.4778C14.1476 11.4545 14.1518 11.4228 14.1842 11.4143C14.6843 11.2866 15.0674 10.8874 15.1844 10.3894C15.2296 10.199 15.2134 10.0022 15.1569 9.81524C15.0906 9.59235 14.9848 9.38356 14.8445 9.19735C14.8092 9.15079 14.8289 9.09013 14.8854 9.07179C15.3834 8.90321 15.7262 8.4271 15.7226 7.88538C15.7798 7.35424 15.353 6.71731 14.8367 6.7166ZM3.412 7.00439H0.808518C0.673089 7.00439 0.570107 7.1243 0.593384 7.25479L2.10567 15.7508C2.12895 15.8813 2.24392 15.9766 2.37865 15.9766H3.34146C3.49029 15.9766 3.61091 15.8588 3.61091 15.7135L3.63207 7.22023C3.63207 7.10102 3.53403 7.00439 3.412 7.00439Z"/>\n\t\t\t\t</svg>\n\t\t\t</i>\n\t\t\t<span class="crm-timeline__client-mark_text">{{ text }}</span>\n\t\t</div>\n\t`};let EditableDescriptionHeight=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(EditableDescriptionHeight,"SHORT","short");babelHelpers.defineProperty(EditableDescriptionHeight,"LONG","long");let EditableDescriptionBackgroundColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(EditableDescriptionBackgroundColor,"YELLOW","yellow");babelHelpers.defineProperty(EditableDescriptionBackgroundColor,"WHITE","white");const EditableDescription={components:{Button:Button,TextEditorComponent:ui_textEditor.TextEditorComponent,HtmlFormatterComponent:ui_bbcode_formatter_htmlFormatter.HtmlFormatterComponent},props:{text:{type:String,required:false,default:""},saveAction:{type:Object,required:false,default:null},editable:{type:Boolean,required:false,default:true},copied:{type:Boolean,required:false,default:false},height:{type:String,required:false,default:EditableDescriptionHeight.SHORT},backgroundColor:{type:String,required:false,default:""},copilotSettings:{type:Object,required:false,default:[]}},beforeCreate(){this.textEditor=null},data(){return{isEdit:false,isSaving:false,isLongText:false,isCollapsed:false,bbcode:this.text,isContentEmpty:main_core.Type.isString(this.text)&&this.text.trim()===""}},inject:["isReadOnly","isLogMessage"],computed:{className(){return["crm-timeline__editable-text",[String(this.heightClassnameModifier),String(this.bgColorClassnameModifier)],{"--is-read-only":this.isLogMessage,"--is-edit":this.isEdit,"--is-long":this.isLongText,"--is-expanded":this.isCollapsed||!this.isLongText}]},heightClassnameModifier(){switch(this.height){case EditableDescriptionHeight.LONG:return"--height-long";case EditableDescriptionHeight.SHORT:return"--height-short";default:return"--height-short"}},bgColorClassnameModifier(){switch(this.backgroundColor){case EditableDescriptionBackgroundColor.YELLOW:return"--bg-color-yellow";case EditableDescriptionBackgroundColor.WHITE:return"--bg-color-white";default:return""}},isEditable(){return this.editable&&this.saveAction&&!this.isReadOnly},isCopied(){return!this.isEdit&&this.copied},saveTextButtonProps(){return{state:this.saveTextButtonState,type:ButtonType.PRIMARY,title:this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_SAVE")}},cancelEditingButtonProps(){return{type:ButtonType.LIGHT,title:this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_CANCEL"),state:this.isSaving?ButtonState.DISABLED:ButtonState.DEFAULT}},saveTextButtonState(){if(this.isContentEmpty){return ButtonState.DISABLED}if(this.isSaving){return ButtonState.DISABLED}return ButtonState.DEFAULT},expandButtonText(){return this.isCollapsed?this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_HIDE_MSGVER_1"):this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_SHOW_MSGVER_1")},isEditButtonVisible(){return!(this.isReadOnly||this.isEdit)}},methods:{startEditing(){this.isEdit=true;this.isCollapsed=true;this.$nextTick((()=>{this.getTextEditor().focus(null,{defaultSelection:"rootEnd"})}));this.emitEvent("EditableDescription:StartEdit")},emitEvent(t){const e=new Action({type:"jsEvent",value:t});e.execute(this)},adjustHeight(t){t.style.height=0;t.style.height=`${t.scrollHeight}px`},saveText(){if(this.saveTextButtonState===ButtonState.DISABLED||this.saveTextButtonState===ButtonState.LOADING||!this.isEdit){return}const t=this.getTextEditor().getText().trim();if(t===this.bbcode){this.isEdit=false;this.emitEvent("EditableDescription:FinishEdit");return}this.isSaving=true;this.executeSaveAction(t).then((()=>{this.isEdit=false;this.bbcode=t;this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}));this.emitEvent("EditableDescription:FinishEdit")})).finally((()=>{this.isSaving=false}))},executeSaveAction(t){var e;if(!this.saveAction){return}const i=main_core.Runtime.clone(this.saveAction);(e=i.actionParams)!==null&&e!==void 0?e:i.actionParams={};i.actionParams.value=t;const n=new Action(i);return n.execute(this)},cancelEditing(){if(!this.isEdit||this.isSaving){return}this.isEdit=false;this.emitEvent("EditableDescription:FinishEdit")},clearText(){if(this.isSaving){return}this.getTextEditor().clear();this.getTextEditor().focus(null,{defaultSelection:"rootEnd"})},copyText(){const t=window.getSelection();t.removeAllRanges();const e=document.createRange();const i=this.$refs.text;e.selectNodeContents(i);t.addRange(e);let n=false;try{n=document.execCommand("copy")}catch(t){}t.removeAllRanges();if(n){new main_popup.Popup({id:`copyTextHint_${main_core.Text.getRandom(8)}`,content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_TEXT_IS_COPIED"),bindElement:this.$refs.copyTextBtn,darkMode:true,autoHide:true,events:{onAfterPopupShow(){setTimeout((()=>{this.close()}),2e3)}}}).show()}},toggleIsCollapsed(){this.isCollapsed=!this.isCollapsed},checkIsLongText(){var t;const e=this.$refs.text;if(!e){return false}const i=window.getComputedStyle(e).getPropertyValue("--crm-timeline__editable-text_max-height");const n=parseFloat(i.slice(0,-2));const a=this.$refs.rootElement?window.getComputedStyle(this.$refs.rootElement):{};const s=((t=this.$refs.rootElement)===null||t===void 0?void 0:t.offsetHeight)-parseFloat(a.paddingTop)-parseFloat(a.paddingBottom);return s>n},isInViewport(){const t=this.$el.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},getTextEditor(){if(this.textEditor!==null){return this.textEditor}this.textEditor=new ui_textEditor.BasicEditor({removePlugins:["BlockToolbar"],maxHeight:600,content:this.bbcode,paragraphPlaceholder:main_core.Loc.getMessage(main_core.Type.isPlainObject(this.copilotSettings)?"CRM_TIMELINE_ITEM_EDITABLE_DESCRIPTION_PLACEHOLDER_WITH_COPILOT":null),toolbar:[],floatingToolbar:["bold","italic","underline","strikethrough","|","link","copilot"],visualOptions:{colorBackground:"transparent",borderWidth:"0px",blockSpaceInline:"0px",blockSpaceStack:"0px"},copilot:{copilotOptions:main_core.Type.isPlainObject(this.copilotSettings)?this.copilotSettings:null,triggerBySpace:true},events:{onMetaEnter:()=>{this.saveText()},onEscape:()=>{this.cancelEditing()},onEmptyContentToggle:t=>{this.isContentEmpty=t.getData().isEmpty}}});return this.textEditor}},watch:{text(t){this.bbcode=t;this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}))},isCollapsed(t){if(t===false&&this.isInViewport()===false){requestAnimationFrame((()=>{this.$el.scrollIntoView({behavior:"smooth",block:"center"})}))}},isSaving(t){if(this.textEditor!==null){this.getTextEditor().setEditable(!t)}},isEdit(t){if(t===false&&this.textEditor!==null){this.textEditor.destroy();this.textEditor=null}}},mounted(){this.$nextTick((()=>{this.isLongText=this.checkIsLongText()}))},template:`\n\t\t<div class="crm-timeline__editable-text_wrapper">\n\t\t\t<div ref="rootElement" :class="className">\n\t\t\t\t<button\n\t\t\t\t\tv-if="this.isCopied"\n\t\t\t\t\tref="copyTextBtn"\n\t\t\t\t\t@click="copyText"\n\t\t\t\t\tclass="crm-timeline__text_copy-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_fixed-icon --copy"></i>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="isEdit && isEditable"\n\t\t\t\t\t:disabled="isSaving"\n\t\t\t\t\t@click="clearText"\n\t\t\t\t\tclass="crm-timeline__editable-text_clear-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_fixed-icon --clear"></i>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="!isEdit && isEditable && isEditButtonVisible"\n\t\t\t\t\t:disabled="isSaving"\n\t\t\t\t\t@click="startEditing"\n\t\t\t\t\tclass="crm-timeline__editable-text_edit-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_edit-icon"></i>\n\t\t\t\t</button>\n\t\t\t\t<div class="crm-timeline__editable-text_inner">\n\t\t\t\t\t<div class="crm-timeline__editable-text_content">\n\t\t\t\t\t\t<TextEditorComponent\n\t\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\t\t:editor-instance="this.getTextEditor()"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tref="text"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<HtmlFormatterComponent :bbcode="bbcode" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\tclass="crm-timeline__editable-text_actions"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="saveTextButtonProps"\n\t\t\t\t\t\t\t\t@click="saveText"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="cancelEditingButtonProps"\n\t\t\t\t\t\t\t\t@click="cancelEditing"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if="isLongText && !isEdit"\n\t\t\t\t\t@click="toggleIsCollapsed"\n\t\t\t\t\tclass="crm-timeline__editable-text_collapse-btn"\n\t\t\t\t>\n\t\t\t\t\t{{ expandButtonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};const TYPE_LOAD_FILES_BLOCK=1;const TYPE_LOAD_TEXT_CONTENT=2;var CommentContent=ui_vue3.BitrixVue.cloneComponent(EditableDescription,{props:{filesCount:{type:Number,required:false,default:0},hasInlineFiles:{type:Boolean,required:false,default:false},loadAction:{type:Object,required:false,default:()=>({})}},data(){return{...this.parentData(),value:this.text,oldValue:this.text,isTextLoaded:false,isTextChanged:false,isMoving:false,isFilesBlockDisplayed:this.filesCount>0,filesHtmlBlock:null,loader:Object.freeze(null),editor:Object.freeze(null)}},computed:{textWrapperClassName(){return["crm-timeline__editable-text_content",{"--is-editor-loaded":this.isEdit}]}},methods:{startEditing(){this.isEdit=true;this.isCollapsed=true;this.$nextTick((()=>{this.editor.show(this.$refs.editor)}));this.emitEvent("Comment:StartEdit")},cancelEditing(){if(!this.isEdit||this.isSaving){return}this.value=this.oldValue;this.isEdit=false;if(this.filesHtmlBlock){void main_core.Runtime.html(this.$refs.files,this.filesHtmlBlock).then((()=>{this.registerImages(this.$refs.files);BX.LazyLoad.showImages();this.emitEvent("Comment:FinishEdit")}))}else{this.emitEvent("Comment:FinishEdit")}},toggleIsCollapsed(){this.parentToggleIsCollapsed();if(!this.isTextLoaded){this.executeLoadAction(TYPE_LOAD_TEXT_CONTENT,this.$refs.text)}},checkIsLongText(){const t=this.$refs.text;if(!t){return false}const e=window.getComputedStyle(t).getPropertyValue("--crm-timeline__editable-text_max-height");const i=parseFloat(e.slice(0,-2));const n=this.filesCount>0?this.$refs.rootElement:this.$refs.rootWrapperElement;const a=window.getComputedStyle(n);const s=n.offsetHeight-parseFloat(a.paddingTop)-parseFloat(a.paddingBottom);const o=s>i;return o||this.hasInlineFiles},saveContent(){const t=this.saveTextButtonState===ButtonState.LOADING||!this.isEdit||!this.saveAction;if(t){return}const e=this.editor.getContent();if(!main_core.Type.isStringFilled(e)){return}const i=this.editor.getHtmlContent();const n=this.editor.getAttachments();const a=this.editor.getAttachmentsAllowEditOptions(n);this.isSaving=true;void this.executeSaveAction(e,n,a).then((()=>{this.isEdit=false;if(!this.isTextChanged){this.oldValue=i;this.value=i}this.$nextTick((()=>{this.isLongText=this.checkIsLongText();this.executeLoadAction(TYPE_LOAD_FILES_BLOCK,this.$refs.files)}));this.emitEvent("Comment:FinishEdit")})).finally((()=>{this.isSaving=false}))},executeSaveAction(t,e,i){var n;const a=main_core.Runtime.clone(this.saveAction);(n=a.actionParams)!==null&&n!==void 0?n:a.actionParams={};a.actionParams.id=a.actionParams.commentId;a.actionParams.fields={COMMENT:t,ATTACHMENTS:e};if(Object.keys(i).length>0){a.actionParams.CRM_TIMELINE_DISK_ATTACHED_OBJECT_ALLOW_EDIT=i}const s=new Action(a);return s.execute(this)},executeLoadAction(t,e){var i;if(this.filesCount===0){this.filesHtmlBlock=null;return}if(!main_core.Type.isDomNode(e)||!this.loadAction){return}const n=main_core.Runtime.clone(this.loadAction);(i=n.actionParams)!==null&&i!==void 0?i:n.actionParams={};n.actionParams.options=t;const a=new Action(n);this.showLoader(true);a.execute(this).then((i=>{if(t===TYPE_LOAD_FILES_BLOCK){this.filesHtmlBlock=i.data.html}else if(t===TYPE_LOAD_TEXT_CONTENT){this.isTextLoaded=true}void main_core.Runtime.html(e,i.data.html).then((()=>{this.registerImages(e);BX.LazyLoad.showImages();this.showLoader(false)}))})).catch((()=>{if(t===TYPE_LOAD_FILES_BLOCK){this.filesHtmlBlock=null}else if(t===TYPE_LOAD_TEXT_CONTENT){this.isTextLoaded=false}this.showLoader(false)}))},registerImages(t){if(!main_core.Type.isDomNode(t)){return}const e=[];const i=t.querySelectorAll('[data-viewer-type="image"]');const n=i.length;if(n>0){for(let t=0;t<n;++t){if(main_core.Type.isDomNode(i[t])){i[t].id+=BX.util.getRandomString(4);e.push(i[t].id)}}if(e.length>0){BX.LazyLoad.registerImages(e,null,{dataSrcName:"thumbSrc"})}}BX.LazyLoad.registerImages(e,null,{dataSrcName:"thumbSrc"})},showLoader(t){if(t){if(!this.loader){this.loader=new main_loader.Loader({size:20,mode:"inline"})}this.loader.show(this.$refs.files)}else if(this.loader){this.loader.hide()}},createEditor(){this.editor=new crm_timeline_editors_commentEditor.CommentEditor(this.loadAction.actionParams.commentId)},setIsMoving(t=true){this.isMoving=t},setIsFilesBlockDisplayed(t=true){this.isFilesBlockDisplayed=t;if(this.filesHtmlBlock){void main_core.Runtime.html(this.$refs.files,this.filesHtmlBlock).then((()=>{this.registerImages(this.$refs.files);BX.LazyLoad.showImages()}))}}},watch:{text(t){this.value=t;this.oldValue=t;this.isTextChanged=true;this.$nextTick((()=>{this.isLongText=this.checkIsLongText();this.executeLoadAction(TYPE_LOAD_FILES_BLOCK,this.$refs.files)}))},value(t){if(!this.isEdit){return}this.value=t;this.oldValue=t},filesCount(t){if(this.isMoving){return}this.isFilesBlockDisplayed=t>0;this.$nextTick((()=>{this.executeLoadAction(TYPE_LOAD_FILES_BLOCK,this.$refs.files)}))}},mounted(){this.createEditor();this.$nextTick((()=>{this.isLongText=this.checkIsLongText();this.executeLoadAction(TYPE_LOAD_FILES_BLOCK,this.$refs.files)}))},updated(){this.createEditor()},template:`\n\t\t<div ref="rootWrapperElement" class="crm-timeline__editable-text_wrapper --comment">\n\t\t\t<div ref="rootElement" :class="className">\n\t\t\t\t<button\n\t\t\t\t\tv-if="isLongText && !isEdit && isEditable && isEditButtonVisible"\n\t\t\t\t\t:disabled="isSaving"\n\t\t\t\t\t@click="startEditing"\n\t\t\t\t\tclass="crm-timeline__editable-text_edit-btn"\n\t\t\t\t>\n\t\t\t\t\t<i class="crm-timeline__editable-text_edit-icon"></i>\n\t\t\t\t</button>\n\t\t\t\t<div class="crm-timeline__editable-text_inner">\n\t\t\t\t\t<div :class="textWrapperClassName">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\t\tref="editor"\n\t\t\t\t\t\t\t:disabled="!isEdit || isSaving"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_editor"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tref="text"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text"\n\t\t\t\t\t\t\tv-html="value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if="!isEdit && !isLongText && isEditable && isEditButtonVisible"\n\t\t\t\t\t\t\t@click="startEditing"\n\t\t\t\t\t\t\tclass="crm-timeline__editable-text_text-edit-icon"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="crm-timeline__editable-text_edit-icon"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\tclass="crm-timeline__editable-text_actions"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="saveTextButtonProps"\n\t\t\t\t\t\t\t\t@click="saveContent"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-timeline__editable-text_action">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-bind="cancelEditingButtonProps"\n\t\t\t\t\t\t\t\t@click="cancelEditing"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if="isLongText && !isEdit"\n\t\t\t\t\t@click="toggleIsCollapsed"\n\t\t\t\t\tclass="crm-timeline__editable-text_collapse-btn"\n\t\t\t\t>\n\t\t\t\t\t{{ expandButtonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="!isEdit && isFilesBlockDisplayed"\n\t\t\t\tref="files"\n\t\t\t\tclass="crm-timeline__comment_files_wrapper"\n\t\t\t\t:class="{'--long-comment': isLongText}"\n\t\t\t\tv-html="filesHtmlBlock"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`});let TextColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextColor,"GREEN","green");babelHelpers.defineProperty(TextColor,"PURPLE","purple");babelHelpers.defineProperty(TextColor,"BASE_50","base-50");babelHelpers.defineProperty(TextColor,"BASE_60","base-60");babelHelpers.defineProperty(TextColor,"BASE_70","base-70");babelHelpers.defineProperty(TextColor,"BASE_90","base-90");let TextWeight=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextWeight,"NORMAL","normal");babelHelpers.defineProperty(TextWeight,"MEDIUM","medium");babelHelpers.defineProperty(TextWeight,"BOLD","bold");let TextSize=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextSize,"XS","xs");babelHelpers.defineProperty(TextSize,"SM","sm");babelHelpers.defineProperty(TextSize,"MD","md");let TextDecoration=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(TextDecoration,"NONE","none");babelHelpers.defineProperty(TextDecoration,"UNDERLINE","underline");babelHelpers.defineProperty(TextDecoration,"DOTTED","dotted");babelHelpers.defineProperty(TextDecoration,"DASHED","dashed");var Text={props:{value:String|Number,title:{type:String,required:false,default:""},color:{type:String,required:false,default:""},weight:{type:String,required:false,default:"normal"},size:{type:String,required:false,default:"md"},multiline:{type:Boolean,required:false,default:false},decoration:{type:String,required:false,default:""}},computed:{className(){return["crm-timeline__text-block",this.colorClassname,this.weightClassname,this.sizeClassname,this.decorationClassname]},colorClassname(){var t;const e=this.color?this.color.toUpperCase():"";const i=(t=TextColor[e])!==null&&t!==void 0?t:"";return`--color-${i}`},weightClassname(){var t;const e=this.weight?this.weight.toUpperCase():"";const i=(t=TextWeight[e])!==null&&t!==void 0?t:TextWeight.NORMAL;return`--weight-${i}`},sizeClassname(){var t;const e=this.size?this.size.toUpperCase():"";const i=(t=TextSize[e])!==null&&t!==void 0?t:TextSize.SM;return`--size-${i}`},decorationClassname(){var t;const e=this.decoration?this.decoration.toUpperCase():"";if(!e){return""}const i=(t=TextDecoration[e])!==null&&t!==void 0?t:TextDecoration.NONE;return`--decoration-${i}`},encodedText(){let t=main_core.Text.encode(this.value);if(this.multiline){t=t.replace(/\n/g,"<br />")}return t}},template:`\n\t\t<span\n\t\t\t:title="title"\n\t\t\t:class="className"\n\t\t\tv-html="encodedText"\n\t\t></span>\n\t`};var DateBlock={props:{withTime:{type:Boolean,required:false,default:true},format:{type:String,required:false,default:null},duration:{type:Number,required:false,default:null}},extends:Text,methods:{getFormattedDate(){const t=this.getDatetimeConverter();if(this.format){return t.toFormatString(this.format)}const e={delimiter:", ",withDayOfWeek:true,withFullMonth:true};return this.withTime?t.toDatetimeString(e):t.toDateString()},getDatetimeConverter(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.value).toUserTime()},getDatetimeConverterWithDuration(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.value+this.duration).toUserTime()}},computed:{encodedText(){const t=this.getFormattedDate();if(!main_core.Type.isNumber(this.duration)){return main_core.Text.encode(t)}const e=this.getDatetimeConverterWithDuration();return main_core.Text.encode(`${t}-${e.toTimeString()}`)}},template:Text.template};const DatePillColor=Object.freeze({DEFAULT:"default",WARNING:"warning",NONE:"none"});const PillStyle=Object.freeze({DEFAULT:"pill",INLINE_GROUP:"pill-inline-group"});var DatePill={props:{value:Number,withTime:Boolean,duration:{type:Number,required:false,default:null},backgroundColor:{type:String,required:false,default:DatePillColor.DEFAULT,validator(t){return Object.values(DatePillColor).includes(t)}},action:Object|null,styleValue:String},inject:["isReadOnly"],data(){return{currentTimestamp:this.value,initialTimestamp:this.value}},computed:{className(){return["crm-timeline__date-pill",`--color-${this.backgroundColor}`,{"--readonly":this.isPillReadonly},{"--inline-group":this.styleValue===PillStyle.INLINE_GROUP}]},formattedDate(){if(!this.currentTimestamp){return null}const t=this.getDatetimeConverter();let e=t.toDatetimeString({withDayOfWeek:true,withFullMonth:true,delimiter:", "});if(main_core.Type.isNumber(this.duration)){const t=this.getDatetimeConverterWithDuration();e=`${e}-${t.toTimeString()}`}return e},currentDateInSiteFormat(){return main_date.DateTimeFormat.format(this.withTime?crm_timeline_tools.DatetimeConverter.getSiteDateTimeFormat():crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),this.getDatetimeConverter().getValue())},calendarParams(){return{value:this.currentDateInSiteFormat,bTime:this.withTime,bHideTime:!this.withTime,bSetFocus:false}},isPillReadonly(){return this.isReadOnly||!this.action}},watch:{value(t){this.initialTimestamp=t;this.currentTimestamp=t}},methods:{openCalendar(t){if(this.isPillReadonly){return}BX.calendar({node:t.target,callback_after:t=>{this.currentTimestamp=main_date.Timezone.UserTime.toUTCTimestamp(t);this.executeAction()},...this.calendarParams})},executeAction(){var t;if(!this.action){return}if(this.currentTimestamp===this.initialTimestamp){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentDateInSiteFormat;e.actionParams.valueTs=this.currentTimestamp;const i=new Action(e);i.execute(this);this.initialTimestamp=this.currentTimestamp;this.$emit("onChange",this.initialTimestamp)},getDatetimeConverter(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.currentTimestamp).toUserTime()},getDatetimeConverterWithDuration(){return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.currentTimestamp+this.duration).toUserTime()}},template:`\n\t\t<span\n\t\t\t:class="className"\n\t\t\t@click="openCalendar"\n\t\t>\n\t\t\t<span>\n\t\t\t\t{{ formattedDate }}\n\t\t\t</span>\n\t\t\t<span class="crm-timeline__date-pill_caret"></span>\n\t\t</span>`};var Link={props:{text:String,action:Object,title:{type:String,required:false,default:""},color:{type:String,required:false,default:""},bold:{type:Boolean,required:false,default:false},decoration:{type:String,required:false,default:""},icon:{type:String,required:false,default:""},rowLimit:{type:Number,required:false,default:0}},computed:{href(){if(!this.action){return null}const t=new Action(this.action);if(t.isRedirect()){return t.getValue()}return null},linkAttrs(){if(!this.action){return{}}const t=new Action(this.action);if(!t.isRedirect()){return{}}const e={href:t.getValue()};const i=t.getActionParam("target");if(i){e.target=i}return e},className(){return["crm-timeline__card_link",this.colorClassName,this.boldClassName,this.decorationClassName,this.rowLimitClassName]},colorClassName(){var t;const e=this.color?this.color.toUpperCase():"";const i=(t=TextColor[e])!==null&&t!==void 0?t:"";return`--color-${i}`},boldClassName(){return this.bold?"--bold":""},decorationClassName(){var t;const e=this.decoration?this.decoration.toUpperCase():"";if(!e){return""}const i=(t=TextDecoration[e])!==null&&t!==void 0?t:TextDecoration.NONE;return`--decoration-${i}`},iconClassName(){if(!this.icon){return[]}return["crm-timeline__card_link_icon",`--code-${this.icon}`]},rowLimitClassName(){return this.rowLimit?"--limit":""},rowLimitStyle(){if(this.rowLimit&&this.rowLimit>0){return{"-webkit-line-clamp":this.rowLimit}}return{}}},methods:{executeAction(){if(this.action){const t=new Action(this.action);t.execute(this)}}},template:`\n\t\t\t<a\n\t\t\t\tv-if="href"\n\t\t\t\tv-bind="linkAttrs"\n\t\t\t\t:class="className"\n\t\t\t\t:title="title"\n\t\t\t\t:style="rowLimitStyle"\n\t\t\t>{{text}}<span v-if="icon" :class="iconClassName"></span>\n\t\t\t</a>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click="executeAction"\n\t\t\t\t:class="className"\n\t\t\t\t:title="title"\n\t\t\t\t:style="rowLimitStyle"\n\t\t\t>{{text}}<span v-if="icon" :class="iconClassName"></span>\n\t\t\t</span>\n\t\t`};var EditableDate={components:{Link:Link},props:{value:Number,withTime:Boolean,action:Object},data(){return{currentDate:this.value,initialDate:this.value,actionTimeoutId:null}},computed:{currentDateObject(){return this.currentDate?new Date(this.currentDate*1e3):null},currentDateInSiteFormat(){if(!this.currentDateObject){return null}return main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),this.currentDateObject)},textProps(){return{text:this.currentDateInSiteFormat}}},methods:{openCalendar(t){this.cancelScheduledActionExecution();BX.calendar({node:t.target,value:this.currentDateInSiteFormat,bTime:this.withTime,bHideTime:!this.withTime,bSetFocus:false,callback_after:t=>{this.currentDate=Math.round(t.getTime()/1e3);this.scheduleActionExecution()}})},scheduleActionExecution(){this.cancelScheduledActionExecution();this.actionTimeoutId=setTimeout(this.executeAction.bind(this),3*1e3)},cancelScheduledActionExecution(){if(this.actionTimeoutId){clearTimeout(this.actionTimeoutId);this.actionTimeoutId=null}},executeAction(){var t;if(!this.action){return}if(this.currentDate===this.initialDate){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentDateObject;const i=new Action(e);i.execute(this);this.initialDate=this.currentDate}},template:`<Link @click="openCalendar" v-bind="textProps"></Link>`};var EditableText=ui_vue3.BitrixVue.cloneComponent(Text,{components:{Text:Text},props:{action:Object},data(){return{isEdit:false,currentValue:this.value,initialValue:this.value,actionTimeoutId:null}},computed:{textProps(){return{...this.$props,value:this.currentValue}}},methods:{enableEdit(){this.cancelScheduledActionExecution();this.isEdit=true;this.$nextTick((()=>{this.$refs.input.focus()}))},disableEdit(){this.isEdit=false;this.scheduleActionExecution()},scheduleActionExecution(){this.cancelScheduledActionExecution();this.actionTimeoutId=setTimeout(this.executeAction.bind(this),3*1e3)},cancelScheduledActionExecution(){if(this.actionTimeoutId){clearTimeout(this.actionTimeoutId);this.actionTimeoutId=null}},executeAction(){var t;if(!this.action||this.currentValue===this.initialValue){return}const e=main_core.Runtime.clone(this.action);(t=e.actionParams)!==null&&t!==void 0?t:e.actionParams={};e.actionParams.value=this.currentValue;const i=new Action(e);i.execute(this);this.initialValue=this.currentValue}},template:`\n\t\t\t<input\n\t\t\t\tv-if="isEdit"\n\t\t\t\tref="input"\n\t\t\t\ttype="text"\n\t\t\t\tv-model.trim="currentValue"\n\t\t\t\t@focusout="disableEdit"\n\t\t\t>\n\t\t\t<Text\n\t\t\t\tv-else\n\t\t\t\tv-bind="textProps"\n\t\t\t\t@click="enableEdit"\n\t\t\t/>\n\t\t`});let LogoType=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(LogoType,"CALL_AUDIO_PLAY","call-play-record");babelHelpers.defineProperty(LogoType,"CALL_AUDIO_PAUSE","call-pause-record");const TimelineAudio=crm_audioPlayer.AudioPlayer.getComponent({methods:{changeLogoIcon(t){if(!this.$parent||!this.$parent.getLogo){return}const e=this.$parent.getLogo();if(!e){return}e.setIcon(t)},audioEventRouterWrapper(t,e){this.audioEventRouter(t,e);if(t==="play"){this.changeLogoIcon(LogoType.CALL_AUDIO_PAUSE)}if(t==="pause"){this.changeLogoIcon(LogoType.CALL_AUDIO_PLAY)}}}});var File={components:{TimelineAudio:TimelineAudio},props:{id:Number,text:String,href:String,size:Number,attributes:Object,hasAudioPlayer:{type:Boolean,required:false,default:false}},computed:{fileExtension(){return this.text.split(".").slice(-1)[0]||""},titleFirstPart(){return this.text.slice(0,-this.titleLastPartSize)},titleLastPart(){return this.text.slice(-this.titleLastPartSize)},titleLastPartSize(){return 10}},mounted(){const t=new ui_icons_generator.FileIcon({name:this.fileExtension});t.renderTo(this.$refs.icon)},template:`\n\t\t<div class="crm-timeline__file">\n\t\t\t<div ref="icon" class="crm-timeline__file_icon"></div>\n\t\t\t<a\n\t\t\t\ttarget="_blank"\n\t\t\t\tclass="crm-timeline__file_title crm-timeline__card_link"\n\t\t\t\tv-if="href"\n\t\t\t\t:title="text"\n\t\t\t\t:href="href"\n\t\t\t\tv-bind="attributes"\n\t\t\t\tref="title"\n\t\t\t>\n\t\t\t\t<span>{{ titleFirstPart }}</span>\n\t\t\t\t<span>{{ titleLastPart }}</span>\n\t\t\t</a>\n\t\t\t<div class="crm-timeline__file_audio-player" v-if="this.hasAudioPlayer">\n\t\t\t\t<TimelineAudio :id="id" :mini="true" :src="href"></TimelineAudio>\n\t\t\t</div>\n\t\t</div>\n\t\t`};const FileList={components:{File:File,BIcon:ui_iconSet_api_vue.BIcon},props:{title:{type:String,required:false,default:""},numberOfFiles:{type:Number,required:false,default:0},files:{type:Array,required:true,default:[]},updateParams:{type:Object,required:false,default:{}},visibleFilesNumber:{type:Number,required:false,default:5}},inject:["isReadOnly"],data(){return{visibleFilesAmount:this.visibleFilesNumber}},computed:{isEditable(){return Object.keys(this.updateParams).length>0&&!this.isReadOnly},visibleFiles(){return this.files.slice(0,this.visibleFilesAmount)},editFilesBtnClassname(){return["crm-timeline__file-list-btn",{"--disabled":!this.isEditable}]},expandFileListBtnTitle(){return this.isAllFilesVisible?this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_FILE_LIST_COLLAPSE"):this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_FILE_LIST_EXPAND")},editFilesBtnIcon(){return ui_iconSet_api_vue.Set.PENCIL_40},addVisibleFilesBtnIcon(){return ui_iconSet_api_vue.Set.CHEVRON_DOWN},isAllFilesVisible(){return this.visibleFilesAmount===this.numberOfFiles},isShowExpandFileListBtn(){return this.numberOfFiles>this.visibleFilesNumber},expandBtnIconClassname(){return["crm-timeline__file-list-btn-icon",{"--upended":this.isAllFilesVisible}]}},methods:{fileProps(t){return{id:t.id,text:t.name,href:t.viewUrl,size:t.size,attributes:t.attributes,hasAudioPlayer:t.hasAudioPlayer}},showFileUploaderPopup(){if(!this.isEditable){return}const t=new crm_activity_fileUploaderPopup.FileUploaderPopup(this.updateParams);t.show()},handleShowFilesBtnClick(){if(this.isAllFilesVisible){this.collapseFileList()}else{this.expandFileList()}},expandFileList(){this.visibleFilesAmount=this.numberOfFiles},collapseFileList(){this.visibleFilesAmount=this.visibleFilesNumber}},template:`\n\t\t\t<div class="crm-timeline__file-list-wrapper">\n\t\t\t\t<div class="crm-timeline__file-list-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="crm-timeline__file-container"\n\t\t\t\t\t\tv-for="file in visibleFiles"\n\t\t\t\t\t>\n\t\t\t\t\t\t<File :key="file.id" v-bind="fileProps(file)"></File>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class="crm-timeline__file-list-footer">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isShowExpandFileListBtn"\n\t\t\t\t\t\tclass="crm-timeline__file-list-btn-container"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass="crm-timeline__file-list-btn"\n\t\t\t\t\t\t\t@click="handleShowFilesBtnClick"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="crm-timeline__file-list-btn-text">{{expandFileListBtnTitle}}</span>\n\t\t\t\t\t\t\t<i :class="expandBtnIconClassname">\n\t\t\t\t\t\t\t\t<BIcon :name="addVisibleFilesBtnIcon" :size="18"></BIcon>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isEditable"\n\t\t\t\t\t\tclass="crm-timeline__file-list-btn-container"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if="title !== '' || numberOfFiles > 0"\n\t\t\t\t\t\t\t@click="showFileUploaderPopup"\n\t\t\t\t\t\t\t:class="editFilesBtnClassname"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="crm-timeline__file-list-btn-text">{{ title }}</span>\n\t\t\t\t\t\t\t<i class="crm-timeline__file-list-btn-icon">\n\t\t\t\t\t\t\t\t<BIcon :name="editFilesBtnIcon" :size="18"></BIcon>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t<i ref="edit-icon" class="crm-timeline__file-list-btn-icon"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`};const InfoGroup={props:{blocks:{type:Object,required:false,default:()=>({})}},template:`\n\t\t<table class="crm-timeline__info-group">\n\t\t\t<tbody>\n\t\t\t\t<tr\n\t\t\t\t\tv-for="({title, block}, id) in blocks"\n\t\t\t\t\t:key="id"\n\t\t\t\t\tclass="crm-timeline__info-group_block"\n\t\t\t\t>\n\t\t\t\t\t<td\n\t\t\t\t\t\t:title="title"\n\t\t\t\t\t\tclass="crm-timeline__info-group_block-title"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{title}}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="crm-timeline__info-group_block-content">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="block.rendererName"\n\t\t\t\t\t\t\tv-bind="block.properties"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t`};const SAVE_OFFSETS_REQUEST_DELAY=1e3;var ItemSelector={props:{valuesList:{type:Array,required:true,default:[]},value:{type:Array,default:[]},saveAction:{type:Object,required:true},compactMode:{type:Boolean,default:false},icon:{type:String,default:null,required:false}},methods:{onItemSelectorValueChange(t){main_core.Runtime.debounce((()=>{const e=t.getData();if(e){this.executeSaveAction(e.value)}}),SAVE_OFFSETS_REQUEST_DELAY,this)()},executeSaveAction(t){var e;if(!this.saveAction){return}if(this.value.sort().toString()===t.sort().toString()){return}const i=main_core.Runtime.clone(this.saveAction);(e=i.actionParams)!==null&&e!==void 0?e:i.actionParams={};i.actionParams.value=t;const n=new Action(i);void n.execute(this)}},mounted(){var t;this.itemSelector=new crm_field_itemSelector.ItemSelector({target:this.$el,valuesList:this.valuesList,selectedValues:this.value,compactMode:(t=this.compactMode)!==null&&t!==void 0?t:false,icon:main_core.Type.isStringFilled(this.icon)?this.icon:null});main_core_events.EventEmitter.subscribe(this.itemSelector,crm_field_itemSelector.Events.EVENT_ITEMSELECTOR_VALUE_CHANGE,this.onItemSelectorValueChange)},beforeUnmount(){main_core_events.EventEmitter.unsubscribe(this.itemSelector,crm_field_itemSelector.Events.EVENT_ITEMSELECTOR_VALUE_CHANGE,this.onItemSelectorValueChange)},computed:{styles(){if(this.compactMode){return{}}return{width:"100%"}}},template:'<div :style="styles"></div>'};var LineOfTextBlocks={props:{blocks:Object,delimiter:String,button:Object},mounted(){const t=this.$refs.blocks;this.visibleBlocks.forEach(((e,i)=>{if(main_core.Type.isDomNode(t[i].$el)){t[i].$el.setAttribute("data-id",e.id)}else{throw new Error(`Vue component "${e.rendererName}" was not found`)}}))},methods:{isShowDelimiter(t,e){return main_core.Type.isString(this.delimiter)&&!this.isLastElement(t,e)},isLastElement(t,e){return t===e-1}},computed:{visibleBlocks(){if(!main_core.Type.isObject(this.blocks)){return[]}const t=Object.keys(this.blocks).map((t=>({id:t,...this.blocks[t]}))).filter((t=>t.scope!=="mobile"));if(main_core.Type.isObject(this.button)){t.push({id:"button",...this.button})}return t},formattedDelimiter(){return main_core.Text.encode(this.delimiter).replace(" ","&nbsp;")}},template:`\n\t\t<span class="crm-timeline-block-line-of-texts">\n\t\t\t<span\n\t\t\t\tv-for="(block, index) in visibleBlocks"\n\t\t\t\t:key="block.id"\n\t\t\t>\n\t\t\t\t<component \n\t\t\t\t\t:is="block.rendererName"\n\t\t\t\t\tv-bind="block.properties"\n\t\t\t\t\tref="blocks"\n\t\t\t\t/>\n\t\t\t\t<span v-if="isShowDelimiter(index, visibleBlocks.length)" v-html="formattedDelimiter"></span>\n\t\t\t\t<span v-else-if="!isLastElement(index, visibleBlocks.length)">&nbsp;</span>\n\t\t\t</span>\n\t\t</span>\n\t`};var LineOfTextBlocksButton={props:{action:Object,icon:{type:String,required:false,default:""},title:String},computed:{href(){if(!this.action){return null}const t=new Action(this.action);if(t.isRedirect()){return t.getValue()}return null},linkAttrs(){if(!this.action){return{}}const t=new Action(this.action);if(!t.isRedirect()){return{}}const e={href:t.getValue()};const i=t.getActionParam("target");if(i){e.target=i}return e},className(){return["crm-timeline__line_of_text_blocks_button"]},iconClassName(){if(!this.icon){return[]}return["crm-timeline__line_of_text_blocks_button_icon",`--code-${this.icon}`]}},methods:{executeAction(){if(this.action){const t=new Action(this.action);t.execute(this)}},addAlignRightClass(){this.$el.parentElement.classList.add("right-fixed-button")}},mounted(){this.addAlignRightClass()},template:`\n\t\t\t<a\n\t\t\t\tv-if="href"\n\t\t\t\tv-bind="linkAttrs"\n\t\t\t\t:class="className"\n\t\t\t\t:title="title"\n\t\t\t>{{text}}<span v-if="icon" :class="iconClassName"></span>\n\t\t\t</a>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click="executeAction"\n\t\t\t\t:class="className"\n\t\t\t\t:title="title"\n\t\t\t>{{text}}<span v-if="icon" :class="iconClassName"></span>\n\t\t\t</span>\n\t\t`};var Money={props:{opportunity:Number,currencyId:String},computed:{encodedText(){if(!main_core.Type.isNumber(this.opportunity)||!main_core.Type.isStringFilled(this.currencyId)){return null}return currency_currencyCore.CurrencyCore.currencyFormat(this.opportunity,this.currencyId,true)}},extends:Text,template:`\n\t\t<span\n\t\t\tv-if="encodedText"\n\t\t\t:class="className"\n\t\t\tv-html="encodedText"\n\t\t></span>`};const MoneyPill={props:{opportunity:Number,currencyId:String},computed:{moneyHtml(){if(!main_core.Type.isNumber(this.opportunity)||!main_core.Type.isStringFilled(this.currencyId)){return null}return currency_currencyCore.CurrencyCore.currencyFormat(this.opportunity,this.currencyId,true)}},template:`\n\t\t<div class="crm-timeline-card__money-pill">\n\t\t\t<span class="crm-timeline-card__money-pill_amount">\n\t\t\t\t<span v-if="moneyHtml" v-html="moneyHtml"></span>\n\t\t\t</span>\n\t\t</div>\n\t`};const Note={components:{User:User,Button:Button},props:{id:{type:Number,required:false},text:{type:String,required:false,default:""},deleteConfirmationText:{type:String,required:false,default:""},saveNoteAction:{type:Object},deleteNoteAction:{type:Object},updatedBy:{type:Object,required:false}},data(){return{note:this.text,oldNote:this.text,isEdit:false,isExist:!!this.id,isSaving:false,isDeleting:false,isCollapsed:true,shortNoteLength:113}},inject:["isReadOnly","currentUser"],computed:{noteText(){if(this.isCollapsed){return this.shortNote}return this.note},shortNote(){if(this.note.length>this.shortNoteLength){return`${this.note.slice(0,this.shortNoteLength)}...`}else if(this.getNoteLineBreaksCount()>2){let t=0;for(let e=0;e<this.note.length;e++){const i=this.note[e];if(i!=="\n"){continue}t++;if(t===this.maxLineBreakerCount){return`${this.note.slice(0,e)}...`}}}return this.note},maxLineBreakerCount(){return 3},expandNoteBtnText(){if(this.isCollapsed){return this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_NOTE_SHOW")}else{return this.$Bitrix.Loc.getMessage("CRM_TIMELINE_ITEM_NOTE_HIDE")}},ButtonType(){return ButtonType},isDeleteButtonVisible(){return!this.isReadOnly},isEditButtonVisible(){return!(this.isReadOnly||this.isEdit)},saveButtonState(){if(this.isSaving){return ButtonState.DISABLED}if(this.note.trim().length>0){return ButtonState.DEFAULT}return ButtonState.DISABLED},cancelButtonState(){if(this.isSaving){return ButtonState.DISABLED}return ButtonState.DEFAULT},isNoteVisible(){return this.isExist||this.isEdit},user(){if(this.updatedBy){return this.updatedBy}if(this.currentUser){return this.currentUser}return{title:"",detailUrl:"",imageUrl:""}},isShowExpandBtn(){return!this.isEdit&&(this.note.length>this.shortNoteLength||this.getNoteLineBreaksCount()>2)}},methods:{toggleNoteLength(){this.isCollapsed=!this.isCollapsed},startEditing(){this.isEdit=true;this.$nextTick((()=>{this.isCollapsed=false;const t=this.$refs.noteText;this.adjustHeight(t);t.focus()}));this.executeAction({type:"jsEvent",value:"Note:StartEdit"})},adjustHeight(t){t.style.height=0;t.style.height=t.scrollHeight+"px"},setEditMode(t){const e=t?!this.isReadOnly:false;if(e!==this.isEdit){if(e){this.startEditing()}else{this.isEdit=false;this.executeAction({type:"jsEvent",value:"Note:FinishEdit"})}}},onEnterHandle(t){if(t.ctrlKey===true||main_core.Browser.isMac()&&(t.metaKey===true||t.altKey===true)){this.saveNote()}},cancelEditing(){this.note=this.oldNote;this.isEdit=false;this.executeAction({type:"jsEvent",value:"Note:FinishEdit"})},deleteNote(){if(this.isSaving){return}if(!this.isExist){this.cancelEditing();return}if(this.deleteConfirmationText&&this.deleteConfirmationText.length){ui_dialogs_messagebox.MessageBox.show({message:this.deleteConfirmationText,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:t=>{t.close();this.executeDeleteAction()},onNo:t=>{t.close()}})}else{this.executeDeleteAction()}},saveNote(){if(this.saveButtonState===ButtonState.DISABLED||this.isSaving||this.isDeleting){return}if(this.note===this.text){this.cancelEditing();return}this.isSaving=true;const t=main_core.Runtime.clone(this.saveNoteAction);t.actionParams.text=this.note;this.executeAction(t).then((({status:t})=>{if(t==="success"){this.oldNote=this.$refs.noteText.value.trim();this.isExist=true;this.cancelEditing()}})).finally((()=>{this.isSaving=false}))},executeDeleteAction(){if(this.isSaving){return}this.isDeleting=true;this.executeAction(this.deleteNoteAction).then((({status:t})=>{if(t==="success"){this.oldNote="";this.isExist=false;this.cancelEditing()}})).finally((()=>{this.isDeleting=false}))},executeAction(t){if(!t){console.error("No action object to execute");return}const e=new Action(t);return e.execute(this)},handleWindowResize(){const t=window.innerWidth;if(t>1400){this.shortNoteLength=250}else{this.shortNoteLength=113}},getNoteLineBreaksCount(){return this.note.split("").reduce(((t,e)=>t+(e==="\n"?1:0)),0)}},watch:{id(t){this.isExist=!!t},text(t){this.note=t;this.oldNote=t},note(){if(!this.isEdit){return}this.$nextTick((()=>{this.adjustHeight(this.$refs.noteText)}))},isEdit(t){if(t){this.$nextTick((()=>this.$refs.noteText.focus()))}}},created(){this.handleWindowResize();main_core.Event.bind(window,"resize",this.handleWindowResize)},destroyed(){main_core.Event.unbind(window,"resize",this.handleWindowResize)},template:`\n\t\t<div\n\t\t\tv-show="isNoteVisible"\n\t\t\tclass="crm-timeline__card-note"\n\t\t>\n\t\t\t<div class="crm-timeline__card-note_user">\n\t\t\t\t<User v-bind="user"></User>\n\t\t\t</div>\n\t\t\t<div class="crm-timeline__card-note_area">\n\t\t\t\t<div class="crm-timeline__card-note_value">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t\t\tv-model="note"\n\t\t\t\t\t\t\t@keydown.esc.stop="cancelEditing"\n\t\t\t\t\t\t\t@keydown.enter="onEnterHandle"\n\t\t\t\t\t\t\t:disabled="!isEdit || isSaving"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_PLACEHOLDER')"\n\t\t\t\t\t\t\tref="noteText"\n\t\t\t\t\t\t\tclass="crm-timeline__card-note_text"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tref="noteText"\n\t\t\t\t\t\t\tclass="crm-timeline__card-note_text"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{noteText}}\n\t\t\t\t\t\t</span>\n\t\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="isEditButtonVisible"\n\t\t\t\t\t\tclass="crm-timeline__card-note_edit"\n\t\t\t\t\t\t@click.prevent.stop="startEditing"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isEdit" class="crm-timeline__card-note__controls">\n\t\t\t\t\t<div class="crm-timeline__card-note__control --save">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t@click="saveNote"\n\t\t\t\t\t\t\t:state="saveButtonState" :type="ButtonType.PRIMARY"\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_SAVE')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-timeline__card-note__control --cancel">\n\t\t\t\t\t\t<Button @click="cancelEditing"\n\t\t\t\t\t\t\t\t:type="ButtonType.LIGHT"\n\t\t\t\t\t\t\t\t:state="cancelButtonState"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('CRM_TIMELINE_USER_NOTE_CANCEL')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="isDeleteButtonVisible" class="crm-timeline__card-note_cross" @click="deleteNote">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div v-if="isDeleting" class="crm-timeline__card-note_dimmer"></div>\n\t\t\t<div\n\t\t\t\tv-show="isShowExpandBtn"\n\t\t\t\t@click="toggleNoteLength"\n\t\t\t\tclass="crm-timeline__card-note_expand-note-btn"\n\t\t\t>\n\t\t\t\t{{ expandNoteBtnText }}\n\t\t\t</div>\n\t\t</div>\n\t`};const PlayerAlert={components:{LineOfTextBlocks:LineOfTextBlocks},props:{blocks:{type:Object,required:false,default:()=>({})},color:{type:String,required:false,default:ui_alerts.AlertColor.DEFAULT},icon:{type:String,required:false,default:ui_alerts.AlertIcon.NONE}},computed:{containerClassname(){return["crm-timeline__player-alert","ui-alert","ui-alert-xs","ui-alert-text-center",this.color,this.icon]}},template:`\n\t\t<div :class="containerClassname">\n\t\t\t<div class="ui-alert-message">\n\t\t\t\t<LineOfTextBlocks :blocks="blocks"></LineOfTextBlocks>\n\t\t\t</div>\n\t\t</div>\n\t`};const RestAppLayoutBlocks={props:{itemTypeId:{type:Number},itemId:{type:Number},restAppInfo:{title:String,clientId:String},contentBlocks:{type:Object}},computed:{restAppTitle(){return main_core.Text.encode(this.restAppInfo.title)},clientId(){return main_core.Text.encode(this.restAppInfo.clientId)}},template:`\n\t\t<div class="crm_timeline__rest_app_layout_blocks" :data-app-name="restAppTitle" :data-rest-client-id="clientId">\n\t\t\t<div class="crm-timeline__card-container_block" v-for="contentBlock in contentBlocks">\n\t\t\t\t<component :is="contentBlock.rendererName" v-bind="contentBlock.properties" ref="contentBlocks" />\n\t\t\t</div>\n\t\t</div>\n\t`};const SmsMessage={props:{text:{type:String,required:false,default:""}},computed:{messageHtml(){return BX.util.htmlspecialchars(this.text).replace(/\r\n|\r|\n/g,"<br/>")}},template:`\n\t\t<div\n\t\t\tclass="crm-timeline__item_sms-message">\n\t\t\t<span v-if="messageHtml" v-html="messageHtml"></span>\n\t\t</div>\n\t`};const STATE_LOADING="loading";const STATE_PROCESSED="processed";const STATE_UNPROCESSED="unprocessed";const CallScoringPill={props:{title:{type:String,required:false,default:""},value:{type:String,required:false,default:""},state:{type:String,required:false,default:STATE_UNPROCESSED},action:Object|null},inject:["isReadOnly"],computed:{className(){return["crm-timeline__call-scoring-pill",{"--readonly":this.isPillReadonly}]},renderValue(){switch(this.state){case STATE_LOADING:return'<span class="loader"></span>';case STATE_PROCESSED:return main_core.Text.encode(this.value);case STATE_UNPROCESSED:default:return'<span class="arrow">&nbsp;</span>'}},isPillReadonly(){return this.isReadOnly||!this.action}},methods:{executeAction(){if(this.isPillReadonly){return}const t=new Action(this.action);void t.execute(this)}},template:`\n\t\t<div\n\t\t\t:class='className'\n\t\t\t@click='executeAction'\n\t\t>\n\t\t\t<div class='crm-timeline__call-scoring-pill-left'>{{ this.title }}</div>\n\t\t\t<div class='crm-timeline__call-scoring-pill-separator'></div>\n\t\t\t<div class='crm-timeline__call-scoring-pill-right' v-html='renderValue'></div>\n\t\t</div>\n\t`};const CallScoring={props:{userName:String,userAvatarUrl:String,scoringData:Object|null,action:Object|null},inject:["isReadOnly"],computed:{className(){var t,e,i;const n=main_core.Text.toInteger((t=this.scoringData)===null||t===void 0?void 0:t.ASSESSMENT);const a=main_core.Text.toInteger((e=this.scoringData)===null||e===void 0?void 0:e.HIGH_BORDER);const s=main_core.Text.toInteger((i=this.scoringData)===null||i===void 0?void 0:i.LOW_BORDER);return{"crm-timeline__call-scoring":true,"--success":n>=a,"--failed":n<=s}},assessmentScriptClassName(){return["crm-timeline__call-scoring-assessment-script",{"--readonly":this.isContentReadonly}]},assessmentPillClassName(){return["crm-timeline__call-scoring-assessment-pill",{"--readonly":this.isContentReadonly}]},isContentReadonly(){return this.isReadOnly||!this.action},renderUserAvatarElement(){return new ui_avatar.AvatarRoundGuest({size:26,userName:this.userName,userpicPath:this.userAvatarUrl,baseColor:"#7fdefc",borderColor:"#9dcf00"}).getContainer().outerHTML}},methods:{executeAction(){if(this.isContentReadonly){return}const t=new Action(this.action);void t.execute(this)}},template:`\n\t\t<div :class='className'>\n\t\t\t<div class='crm-timeline__call-scoring-wrapper'>\n\t\t\t\t<div class='crm-timeline__call-scoring-responsible'>\n\t\t\t\t\t<div class='crm-timeline__call-scoring-title'>\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_TIMELINE_ITEM_CALL_SCORING_RESPONSIBLE_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='crm-timeline__call-scoring-responsible-content'>\n\t\t\t\t\t\t<div class='responsible-user-avatar' v-html="renderUserAvatarElement"></div>\n\t\t\t\t\t\t<div class='responsible-user-name'>{{ this.userName }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class='crm-timeline__line-div'></div>\n\t\t\t\t<div class='crm-timeline__call-scoring-assessment'>\n\t\t\t\t\t<div class='crm-timeline__call-scoring-assessment-wrapper'>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<img \n\t\t\t\t\t\t\tclass='copilot-avatar' \n\t\t\t\t\t\t\tsrc='/bitrix/js/crm/timeline/item/src/images/crm-timelime__copilot-avatar.svg' \n\t\t\t\t\t\t\talt='copilot-avatar'\n\t\t\t\t\t\t>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t:class='assessmentPillClassName'\n\t\t\t\t\t\t\t@click='executeAction'\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="value">{{ this.scoringData?.ASSESSMENT }}</span>\n\t\t\t\t\t\t\t<div class="percent"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='script-layout'>\n\t\t\t\t\t\t\t<div class='crm-timeline__call-scoring-title'>\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_TIMELINE_ITEM_CALL_SCORING_SCRIPT_TITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t:class='assessmentScriptClassName'\n\t\t\t\t\t\t\t\t@click='executeAction'\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ this.scoringData?.TITLE }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let DeadlineAndPingSelectorBackgroundColor=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(DeadlineAndPingSelectorBackgroundColor,"ORANGE","orange");babelHelpers.defineProperty(DeadlineAndPingSelectorBackgroundColor,"GRAY","gray");var DeadlineAndPingSelector={props:{isScheduled:Boolean,deadlineBlock:Object,pingSelectorBlock:Object,deadlineBlockTitle:String,backgroundToken:String,backgroundColor:{type:String,required:false,default:null}},data(){return{deadlineBlockData:this.deadlineBlock,pingSelectorBlockData:this.pingSelectorBlock}},computed:{className(){return{"crm-timeline__card-container_info":true,"--inline":true,"crm-timeline-block-deadline-and-ping-selector-deadline-wrapper":true,"--orange":this.backgroundToken===DeadlineAndPingSelectorBackgroundColor.ORANGE,"--gray":this.backgroundToken===DeadlineAndPingSelectorBackgroundColor.GRAY}},deadlineBlockStyle(){if(this.isScheduled&&main_core.Type.isStringFilled(this.backgroundColor)){return{"--crm-timeline-block-deadline-and-ping-selector-deadline_bg-color":main_core.Text.encode(this.backgroundColor)}}return{}}},methods:{onDeadlineChange(t){this.deadlineBlockData.properties.value=t;this.pingSelectorBlockData.properties.deadline=t;this.$refs.pingSelectorBlock.setDeadline(t)}},created(){this.$watch("deadlineBlock",(t=>{this.deadlineBlockData=t}),{deep:true});this.$watch("pingSelectorBlock",(t=>{this.pingSelectorBlockData=t}),{deep:true})},template:`\n\t\t<span class="crm-timeline-block-deadline-and-ping-selector">\n\t\t\t<div \n\t\t\t\t:class="className" \n\t\t\t\tref="deadlineBlock" \n\t\t\t\tv-if="deadlineBlock"\n\t\t\t\t:style="deadlineBlockStyle"\n\t\t\t>\n\t\t\t\t<div class="crm-timeline__card-container_info-title" v-if="deadlineBlockTitle">\n\t\t\t\t\t{{deadlineBlockTitle}}&nbsp;\n\t\t\t\t</div>\n\t\t\t\t<component\n\t\t\t\t\t:is="deadlineBlock.rendererName"\n\t\t\t\t\tv-bind="deadlineBlockData.properties"\n\t\t\t\t\t@onChange="onDeadlineChange"\n\t\t\t\t/>\n\t\t\t</div>\n\t\n\t\t\t<component\n\t\t\t\tv-if="pingSelectorBlock"\n\t\t\t\t:is="pingSelectorBlock.rendererName"\n\t\t\t\tv-bind="pingSelectorBlockData.properties"\n\t\t\t\tref="pingSelectorBlock"\n\t\t\t/>\n\t\t</span>\t\n\t`};const SAVE_OFFSETS_REQUEST_DELAY$1=1e3;var PingSelector={props:{valuesList:{type:Array,required:true,default:[]},value:{type:Array,default:[]},deadline:{type:Number},saveAction:{type:Object,required:true},icon:{type:String,default:null,required:false}},data(){return{deadlineData:this.deadline}},watch:{deadline(t){this.deadlineData=t}},mounted(){this.initPingSelector()},beforeUnmount(){main_core_events.EventEmitter.unsubscribe(this.pingSelector,crm_field_pingSelector.PingSelectorEvents.EVENT_PINGSELECTOR_VALUE_CHANGE,this.onItemSelectorValueChange)},methods:{onItemSelectorValueChange(t){main_core.Runtime.debounce((()=>{const e=t.getData();if(e){this.executeSaveAction(e.value)}}),SAVE_OFFSETS_REQUEST_DELAY$1,this)()},executeSaveAction(t){var e;if(!this.saveAction){return}if(this.value.sort().toString()===t.sort().toString()){return}const i=main_core.Runtime.clone(this.saveAction);(e=i.actionParams)!==null&&e!==void 0?e:i.actionParams={};i.actionParams.value=t;const n=new Action(i);void n.execute(this)},initPingSelector(){const t=this.createDateFromDeadline();const e=t===null||t===void 0?void 0:t.getTime();const i=Date.now();const n=e>i?t:new Date;this.pingSelector=new crm_field_pingSelector.PingSelector({target:this.$el,valuesList:this.valuesList,selectedValues:this.value,icon:main_core.Type.isStringFilled(this.icon)?this.icon:null,deadline:n});main_core_events.EventEmitter.subscribe(this.pingSelector,crm_field_pingSelector.PingSelectorEvents.EVENT_PINGSELECTOR_VALUE_CHANGE,this.onItemSelectorValueChange)},createDateFromDeadline(){if(!main_core.Type.isNumber(this.deadlineData)){return null}return crm_timeline_tools.DatetimeConverter.createFromServerTimestamp(this.deadlineData).getValue()},setDeadline(t){const e=main_date.Timezone.UserTime.getDate(t);this.deadlineData=e.getTime()/1e3;this.pingSelector.setDeadline(e)}},template:"<div></div>"};var WithTitle={props:{title:String,inline:Boolean,wordWrap:Boolean,fixedWidth:Boolean,titleBottomPadding:{type:Number,required:false,default:0},contentBlock:Object},computed:{className(){return{"crm-timeline__card-container_info":true,"--inline":this.inline,"--word-wrap":this.wordWrap,"--fixed-width":this.fixedWidth}},valueClassName(){return{"crm-timeline__card-container_info-value":true}}},methods:{isTitleCropped(){const t=this.$refs.title;return t.scrollWidth>t.clientWidth}},mounted(){void this.$nextTick((()=>{if(!this.$refs.title){return}if(this.isTitleCropped()){main_core.Dom.attr(this.$refs.title,"title",this.title)}if(this.titleBottomPadding>0){main_core.Dom.style(this.$refs.title,"padding-bottom",`${this.titleBottomPadding}px`)}}))},template:`\n\t\t<div\n\t\t\t:class="className"\n\t\t>\n\t\t\t<div\n\t\t\t\tref="title" \n\t\t\t\tclass="crm-timeline__card-container_info-title"\n\t\t\t>\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\t:class="valueClassName"\n\t\t\t>\n\t\t\t\t<component \n\t\t\t\t\t:is="contentBlock.rendererName"\n\t\t\t\t\tv-bind="contentBlock.properties"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};let _=t=>t,_t,_t2;var WorkflowEfficiency={data(){return{formattedAverageDuration:"",formattedExecutionTime:""}},props:{averageDuration:Number,efficiency:String,executionTime:Number,processTimeText:String,workflowResult:Object,author:Object},computed:{itemClassName(){return`bizproc-workflow-timeline-eff-icon --${this.efficiency}`},efficiencyCaption(){let t=this.efficiency==="fast"?"QUICKLY":"SLOWLY";if(this.efficiency==="stopped"){t="NO_PROGRESS"}return main_core.Loc.getMessage(`BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_${t}`)},hasResult(){return this.workflowResult!==undefined},href(){if(this.author&&this.author.link){return this.author.link}return""},imageStyle(){if(this.author&&this.author.avatarSize100){return{backgroundImage:`url('${encodeURI(this.author.avatarSize100)}')`}}return{}},workflowResultHtml(){var t,e;if(this.workflowResult&&this.workflowResult.status===bizproc_types.WorkflowResultStatus.NO_RIGHTS_RESULT){this.workflowResult.text=main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_RESULT_NO_RIGHTS_VIEW")}return(t=(e=this.workflowResult)===null||e===void 0?void 0:e.text)!==null&&t!==void 0?t:null},averageDurationText(){return main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_EFFICIENCY_AVERAGE_PROCESS_TIME")},resultCaption(){if(!this.userResult){return main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_RESULT_TITLE")}return""},userResult(){if(!this.hasResult){var t;const e=main_core.Tag.render(_t||(_t=_`<a href="${0}"></a>`),this.href);e.textContent=(t=this.author)===null||t===void 0?void 0:t.fullName;return main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_NO_RESULT",{"#USER#":e.outerHTML})}if(this.workflowResult&&this.workflowResult.status===bizproc_types.WorkflowResultStatus.USER_RESULT){var e;return main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_NO_RESULT",{"#USER#":(e=this.workflowResult.text)!==null&&e!==void 0?e:""})}return null}},mounted(){if(this.workflowResult&&this.workflowResult.status===bizproc_types.WorkflowResultStatus.NO_RIGHTS_RESULT){this.showHint()}main_core.Runtime.loadExtension("bizproc.workflow.timeline").then((({DurationFormatter:t})=>{this.formattedAverageDuration=t.formatTimeInterval(this.averageDuration);this.formattedExecutionTime=t.formatTimeInterval(this.executionTime)})).catch((t=>{console.error("Error loading DurationFormatter:",t)}))},methods:{showHint(){const t=this.$refs.resultBlock;if(t){const e=main_core.Tag.render(_t2||(_t2=_`<span data-hint="${0}"></span>`),main_core.Loc.getMessage("CRM_TIMELINE_WORKFLOW_RESULT_NO_RIGHTS_TOOLTIP"));main_core.Dom.append(e,t);BX.UI.Hint.init(t)}}},template:`\n\t\t<div class="crm-timeline__text-block crm-timeline__workflow-efficiency-block">\n\t\t\t<div class="bizproc-workflow-timeline-item --result">\n\t\t\t\t<div class="">\n\t\t\t\t\t<div class="bizproc-workflow-timeline-content">\n\t\t\t\t\t\t<div v-if="!userResult" class="bp-result">\n\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-caption">{{ resultCaption }}</div>\n\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-result" ref="resultBlock" v-html="workflowResultHtml"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="userResult" class="bp-result" v-html="userResult"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bizproc-workflow-timeline-item --efficiency">\n\t\t\t\t<div class="bizproc-workflow-timeline-item-wrapper">\n\t\t\t\t\t<div class="bizproc-workflow-timeline-content">\n\t\t\t\t\t\t<div class="bizproc-workflow-timeline-content-inner">\n\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-caption">{{ efficiencyCaption }}</div>\n\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-notice">\n\t\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-subject">{{ processTimeText }}</div>\n\t\t\t\t\t\t\t\t<span class="bizproc-workflow-timeline-text">{{ formattedExecutionTime }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-notice">\n\t\t\t\t\t\t\t\t<div class="bizproc-workflow-timeline-subject">{{ averageDurationText }}</div>\n\t\t\t\t\t\t\t\t<span class="bizproc-workflow-timeline-text">{{ formattedAverageDuration }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div :class="itemClassName"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};function _classPrivateMethodInitSpec$4(t,e){_checkPrivateRedeclaration$7(t,e);e.add(t)}function _checkPrivateRedeclaration$7(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$4(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openEntityDetailTab=new WeakSet;var _editNote=new WeakSet;var _cancelEditNote=new WeakSet;let CommonContentBlocks=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$4(babelHelpers.assertThisInitialized(i),_cancelEditNote);_classPrivateMethodInitSpec$4(babelHelpers.assertThisInitialized(i),_editNote);_classPrivateMethodInitSpec$4(babelHelpers.assertThisInitialized(i),_openEntityDetailTab);return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{AddressBlock:AddressBlock,TextBlock:Text,LinkBlock:Link,LineOfTextBlocksButton:LineOfTextBlocksButton,DateBlock:DateBlock,WithTitle:WithTitle,LineOfTextBlocks:LineOfTextBlocks,TimelineAudio:TimelineAudio,ClientMark:ClientMark$1,Money:Money,EditableText:EditableText,EditableDescription:EditableDescription,EditableDate:EditableDate,PlayerAlert:PlayerAlert,RestAppLayoutBlocks:RestAppLayoutBlocks,DatePill:DatePill,Note:Note,FileList:FileList,InfoGroup:InfoGroup,MoneyPill:MoneyPill,SmsMessage:SmsMessage,CommentContent:CommentContent,ItemSelector:ItemSelector,PingSelector:PingSelector,DeadlineAndPingSelector:DeadlineAndPingSelector,WorkflowEfficiency:WorkflowEfficiency,CallScoringPill:CallScoringPill,CallScoring:CallScoring}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Item:OpenEntityDetailTab"&&main_core.Type.isStringFilled(s===null||s===void 0?void 0:s.tabId)){_classPrivateMethodGet$4(this,_openEntityDetailTab,_openEntityDetailTab2).call(this,s.tabId)}if(n==="Note:StartEdit"){_classPrivateMethodGet$4(this,_editNote,_editNote2).call(this,e)}if(n==="Note:FinishEdit"){_classPrivateMethodGet$4(this,_cancelEditNote,_cancelEditNote2).call(this,e)}}}],[{key:"isItemSupported",value:function t(e){return true}}]);return e}(Base);function _openEntityDetailTab2(t){BX.onCustomEvent(window,"OpenEntityDetailTab",[t])}function _editNote2(t){var e;(e=t.getLayoutContentBlockById("note"))===null||e===void 0?void 0:e.setEditMode(true);t.highlightContentBlockById("note",true)}function _cancelEditNote2(t){var e;(e=t.getLayoutContentBlockById("note"))===null||e===void 0?void 0:e.setEditMode(false);t.highlightContentBlockById("note",false)}var ChatMessage={props:{messageHtml:String,isIncoming:Boolean},computed:{className(){return"crm-entity-stream-content-detail-IM-message-"+(this.isIncoming?"incoming":"outgoing")}},template:`<div class="crm-entity-stream-content-detail-IM"><div :class="[className]" v-html="messageHtml"></div></div>`};function _classPrivateMethodInitSpec$5(t,e){_checkPrivateRedeclaration$8(t,e);e.add(t)}function _checkPrivateRedeclaration$8(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$5(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openChat=new WeakSet;var _onComplete=new WeakSet;var _runCompleteAction=new WeakSet;let OpenLines=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_runCompleteAction);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_onComplete);_classPrivateMethodInitSpec$5(babelHelpers.assertThisInitialized(i),_openChat);return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{ChatMessage:ChatMessage}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Openline:OpenChat"&&s&&s.dialogId){_classPrivateMethodGet$5(this,_openChat,_openChat2).call(this,s.dialogId)}if(n==="Openline:Complete"&&s&&s.activityId){_classPrivateMethodGet$5(this,_onComplete,_onComplete2).call(this,e,s,o)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:OpenLine"}}]);return e}(Base);function _openChat2(t){if(window.top["BXIM"]){window.top["BXIM"].openMessengerSlider(t,{RECENT:"N",MENU:"N"})}}function _onComplete2(t,e,i){ui_dialogs_messagebox.MessageBox.show({title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_OPENLINE_COMPLETE_CONF_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_OPENLINE_COMPLETE_CONF"),modal:true,okCaption:BX.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_OPENLINE_COMPLETE_CONF_OK_TEXT"),buttons:ui_dialogs_messagebox.MessageBoxButtons.OK_CANCEL,onOk:()=>_classPrivateMethodGet$5(this,_runCompleteAction,_runCompleteAction2).call(this,e.activityId,e.ownerTypeId,e.ownerId,i),onCancel:e=>{const i=t.getLayoutHeaderChangeStreamButton();if(i){i.markCheckboxUnchecked()}e.close()}})}function _runCompleteAction2(t,e,i,n){if(n.onStart){n.onStart()}return main_core.ajax.runAction("crm.timeline.activity.complete",{data:{activityId:t,ownerTypeId:e,ownerId:i}}).then((()=>{if(n.onStop){n.onStop()}return true}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(n.onStop){n.onStop()}return true}))}var ValueChange={props:{from:Object,to:Object},template:`<div class="crm-entity-stream-content-detail-info">\n\t<component :is="from.rendererName" v-if="from" v-bind="from.properties"></component>\n\t<span class="crm-entity-stream-content-detail-info-separator-icon" v-if="from"></span>\n\t<component :is="to.rendererName" v-if="to" v-bind="to.properties"></component>\n\t</div>`};var ValueChangeItem={props:{iconCode:String,text:String,pillText:String},computed:{iconClassName(){return["crm-timeline__value-change-item_icon",{[`--${this.iconCode}`]:true}]}},template:`\n\t\t<div class="crm-timeline__value-change-item">\n\t\t\t<span v-if="iconCode" :class="iconClassName"></span>\n\t\t\t<span class="crm-timeline__value-change-item_text" v-if="text">{{ text }}</span>\n\t\t\t<span class="crm-entity-stream-content-detain-info-status" v-if="pillText">{{ pillText }}</span>\n\t\t</div>\n\t`};let Modification=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{ValueChange:ValueChange,ValueChangeItem:ValueChangeItem}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Modification"||e.getType()==="TasksTaskModification"||e.getType()==="RestartAutomation"}}]);return e}(Base);function _classPrivateMethodInitSpec$6(t,e){_checkPrivateRedeclaration$9(t,e);e.add(t)}function _classPrivateFieldInitSpec$6(t,e,i){_checkPrivateRedeclaration$9(t,e);e.set(t,i)}function _checkPrivateRedeclaration$9(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$6(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}let featureResolver=null;let api=null;main_core.Runtime.loadExtension(["sign.v2.api","sign.feature-resolver"]).then((async t=>{if(t!==null&&t!==void 0&&t.Api&&t!==null&&t!==void 0&&t.FeatureResolver){featureResolver=t===null||t===void 0?void 0:t.FeatureResolver.instance();api=new t.Api}})).catch((t=>{ui_notification.UI.Notification.Center.notify({content:t[0].message,autoHideDelay:5e3})}));var _isCancellationInProgress=new WeakMap;var _cancelWithConfirm=new WeakSet;var _cancelSigningProcess=new WeakSet;var _deleteEntry=new WeakSet;var _showSigningProcess=new WeakSet;var _modifyDocument=new WeakSet;var _previewDocument=new WeakSet;var _createDocumentChat=new WeakSet;var _resendDocument=new WeakSet;var _touchSigner=new WeakSet;var _download=new WeakSet;let SignB2eDocument=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_download);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_touchSigner);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_resendDocument);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_createDocumentChat);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_previewDocument);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_modifyDocument);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_showSigningProcess);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_deleteEntry);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_cancelSigningProcess);_classPrivateMethodInitSpec$6(babelHelpers.assertThisInitialized(i),_cancelWithConfirm);_classPrivateFieldInitSpec$6(babelHelpers.assertThisInitialized(i),_isCancellationInProgress,{writable:true,value:false});return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}const r=main_core.Text.toInteger(s===null||s===void 0?void 0:s.documentId);const l=s===null||s===void 0?void 0:s.processUri;const c=(s===null||s===void 0?void 0:s.documentHash)||"";if(n==="Activity:SignB2eDocument:ShowSigningCancel"){_classPrivateMethodGet$6(this,_cancelWithConfirm,_cancelWithConfirm2).call(this,s===null||s===void 0?void 0:s.documentUid)}else if((n==="SignB2eDocument:ShowSigningProcess"||n==="Activity:SignB2eDocument:ShowSigningProcess")&&l.length>0){_classPrivateMethodGet$6(this,_showSigningProcess,_showSigningProcess2).call(this,l)}else if((n==="SignB2eDocument:Preview"||n==="Activity:SignB2eDocument:Preview")&&r>0){_classPrivateMethodGet$6(this,_previewDocument,_previewDocument2).call(this,s)}else if((n==="SignB2eDocument:CreateDocumentChat"||n==="Activity:SignB2eDocument:CreateDocumentChat")&&r>0){if(featureResolver&&featureResolver.released("createDocumentChat")){_classPrivateMethodGet$6(this,_createDocumentChat,_createDocumentChat2).call(this,s)}}else if((n==="SignB2eDocument:Modify"||n==="Activity:SignB2eDocument:Modify")&&r>0){_classPrivateMethodGet$6(this,_modifyDocument,_modifyDocument2).call(this,s)}else if(n==="SignB2eDocument:Resend"&&r>0&&s!==null&&s!==void 0&&s.recipientHash){_classPrivateMethodGet$6(this,_resendDocument,_resendDocument2).call(this,s,o).then((()=>{if(s.buttonId){const t=e.getLayoutFooterButtonById(s.buttonId);t.disableWithTimer(60)}}))}else if(n==="SignB2eDocument:TouchSigner"&&r>0){_classPrivateMethodGet$6(this,_touchSigner,_touchSigner2).call(this,s)}else if(n==="SignB2eDocument:Download"&&c){_classPrivateMethodGet$6(this,_download,_download2).call(this,s,o)}else if(n==="SignB2eDocumentEntry:Delete"&&s!==null&&s!==void 0&&s.entryId){ui_dialogs_messagebox.MessageBox.show({message:(s===null||s===void 0?void 0:s.confirmationText)||"",modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$6(this,_deleteEntry,_deleteEntry2).call(this,s.entryId),onNo:t=>{t.close()}})}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="SignB2eDocument"||e.getType()==="Activity:SignB2eDocument"}}]);return e}(Base);function _cancelWithConfirm2(t){if(babelHelpers.classPrivateFieldGet(this,_isCancellationInProgress)){return}const e=new ui_dialogs_messagebox.MessageBox({title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGNING_CANCEL_DIALOG_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGNING_CANCEL_DIALOG_TEXT"),modal:true});e.setButtons([new BX.UI.Button({text:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGNING_CANCEL_DIALOG_YES_BUTTON_TEXT"),color:BX.UI.Button.Color.DANGER,onclick:()=>{babelHelpers.classPrivateFieldSet(this,_isCancellationInProgress,true);e.close();_classPrivateMethodGet$6(this,_cancelSigningProcess,_cancelSigningProcess2).call(this,t).finally((()=>{babelHelpers.classPrivateFieldSet(this,_isCancellationInProgress,false)}))}}),new BX.UI.Button({text:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGNING_CANCEL_DIALOG_NO_BUTTON_TEXT"),color:BX.UI.Button.Color.LIGHT_BORDER,onclick:()=>{e.close()}})]);e.show()}function _cancelSigningProcess2(t){return new Promise(((e,i)=>{main_core.ajax.runAction("sign.api_v1.document.signing.stop",{data:{uid:t},preparePost:false,headers:[{name:"Content-Type",value:"application/json"}]}).then((t=>{ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGNING_CANCEL_SUCCESS"),autoHideDelay:5e3});e(t)}),(t=>{t.errors.forEach((t=>{ui_notification.UI.Notification.Center.notify({content:t.message,autoHideDelay:5e3})}));i(t.errors)})).catch((()=>{i()}))}))}function _deleteEntry2(t){console.log(`delete entry${t}`)}function _showSigningProcess2(t){return crm_router.Router.openSlider(t)}function _modifyDocument2({documentId:t}){return crm_router.Router.openSlider(`/sign/b2e/doc/0/?docId=${t}&stepId=changePartner&noRedirect=Y`)}function _previewDocument2({documentId:t}){return crm_router.Router.openSlider(`/sign/b2e/preview/0/?docId=${t}&noRedirect=Y`)}async function _createDocumentChat2({chatType:t,documentId:e}){if(api&&featureResolver&&featureResolver.released("createDocumentChat")){const i=(await api.createDocumentChat(t,e,false)).chatId;im_public.Messenger.openChat(`chat${i}`)}}function _resendDocument2({documentId:t,recipientHash:e},i){if(i.onStart){i.onStart()}return new Promise(((n,a)=>{main_core.ajax.runAction("sign.internal.document.resendFile",{data:{memberHash:e,documentId:t}}).then((()=>{ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGN_DOCUMENT_RESEND_SUCCESS"),autoHideDelay:5e3});if(i.onStop){i.onStop()}n()}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(i.onStop){i.onStop()}a()}));console.log(`resend document ${t} for ${e}`)}))}function _touchSigner2({documentId:t}){console.log(`touch signer document ${t}`)}function _download2({filename:t,downloadLink:e},i){if(i.onStart){i.onStart()}const n=document.createElement("a");n.href=e;n.setAttribute("download",t||"");main_core.Dom.document.body.appendChild(n);n.click();document.body.removeChild(n);if(i.onStop){i.onStop()}}function _classPrivateMethodInitSpec$7(t,e){_checkPrivateRedeclaration$a(t,e);e.add(t)}function _checkPrivateRedeclaration$a(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$7(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _deleteEntry$1=new WeakSet;var _openDocument=new WeakSet;var _modifyDocument$1=new WeakSet;var _updateActivityDeadline=new WeakSet;var _resendDocument$1=new WeakSet;var _touchSigner$1=new WeakSet;var _download$1=new WeakSet;let SignDocument=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_download$1);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_touchSigner$1);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_resendDocument$1);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_updateActivityDeadline);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_modifyDocument$1);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_openDocument);_classPrivateMethodInitSpec$7(babelHelpers.assertThisInitialized(i),_deleteEntry$1);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}const r=main_core.Text.toInteger(s===null||s===void 0?void 0:s.documentId);const l=(s===null||s===void 0?void 0:s.documentHash)||"";const c=main_core.Text.toInteger(s===null||s===void 0?void 0:s.activityId);if((n==="SignDocument:Open"||n==="Activity:SignDocument:Open")&&r>0){_classPrivateMethodGet$7(this,_openDocument,_openDocument2).call(this,s)}else if((n==="SignDocument:Modify"||n==="Activity:SignDocument:Modify")&&r>0){_classPrivateMethodGet$7(this,_modifyDocument$1,_modifyDocument2$1).call(this,s)}else if((n==="SignDocument:UpdateActivityDeadline"||n==="Activity:SignDocument:UpdateActivityDeadline")&&c>0){_classPrivateMethodGet$7(this,_updateActivityDeadline,_updateActivityDeadline2).call(this,c,s===null||s===void 0?void 0:s.value)}else if(n==="SignDocument:Resend"&&r>0&&s!==null&&s!==void 0&&s.recipientHash){_classPrivateMethodGet$7(this,_resendDocument$1,_resendDocument2$1).call(this,s,o).then((()=>{if(s.buttonId){const t=e.getLayoutFooterButtonById(s.buttonId);t.disableWithTimer(60)}}))}else if(n==="SignDocument:TouchSigner"&&r>0){_classPrivateMethodGet$7(this,_touchSigner$1,_touchSigner2$1).call(this,s)}else if(n==="SignDocument:Download"&&l){_classPrivateMethodGet$7(this,_download$1,_download2$1).call(this,s,o)}else if(n==="SignDocumentEntry:Delete"&&s!==null&&s!==void 0&&s.entryId){ui_dialogs_messagebox.MessageBox.show({message:(s===null||s===void 0?void 0:s.confirmationText)||"",modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$7(this,_deleteEntry$1,_deleteEntry2$1).call(this,s.entryId),onNo:t=>{t.close()}})}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="SignDocument"||e.getType()==="Activity:SignDocument"}}]);return e}(Base);function _deleteEntry2$1(t){console.log("delete entry"+t)}function _openDocument2({documentId:t,memberHash:e}){return crm_router.Router.Instance.openSignDocumentSlider(t,e)}function _modifyDocument2$1({documentId:t}){return crm_router.Router.Instance.openSignDocumentModifySlider(t)}async function _updateActivityDeadline2(t,e){var i;const n=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),e);let a;try{a=await main_core.ajax.runAction("crm.timeline.signdocument.updateActivityDeadline",{data:{activityId:t,activityDeadline:n}})}catch(t){console.error(t);return}const s=(i=a.data.document)===null||i===void 0?void 0:i.activityDeadline;if(n!==s){console.error("Updated document create date without errors, but for some reason date from the backend doesn't match sent value")}}function _resendDocument2$1({documentId:t,recipientHash:e},i){if(i.onStart){i.onStart()}return new Promise(((n,a)=>{main_core.ajax.runAction("sign.internal.document.resendFile",{data:{memberHash:e,documentId:t}}).then((()=>{ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_SIGN_DOCUMENT_RESEND_SUCCESS"),autoHideDelay:5e3});if(i.onStop){i.onStop()}n()}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(i.onStop){i.onStop()}a()}));console.log("resend document "+t+" for "+e)}))}function _touchSigner2$1({documentId:t}){console.log("touch signer document "+t)}function _download2$1({filename:t,downloadLink:e},i){if(i.onStart){i.onStart()}const n=document.createElement("a");n.href=e;n.setAttribute("download",t||"");document.body.appendChild(n);n.click();document.body.removeChild(n);if(i.onStop){i.onStop()}}let _$1=t=>t,_t$1;function _classPrivateMethodInitSpec$8(t,e){_checkPrivateRedeclaration$b(t,e);e.add(t)}function _classPrivateFieldInitSpec$7(t,e,i){_checkPrivateRedeclaration$b(t,e);e.set(t,i)}function _checkPrivateRedeclaration$b(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classStaticPrivateFieldSpecSet(t,e,i,n){_classCheckPrivateStaticAccess$1(t,e);_classCheckPrivateStaticFieldDescriptor$1(i,"set");_classApplyDescriptorSet(t,i,n);return n}function _classApplyDescriptorSet(t,e,i){if(e.set){e.set.call(t,i)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=i}}function _classStaticPrivateFieldSpecGet$1(t,e,i){_classCheckPrivateStaticAccess$1(t,e);_classCheckPrivateStaticFieldDescriptor$1(i,"get");return _classApplyDescriptorGet$1(t,i)}function _classCheckPrivateStaticFieldDescriptor$1(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function _classCheckPrivateStaticAccess$1(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function _classApplyDescriptorGet$1(t,e){if(e.get){return e.get.call(t)}return e.value}function _classPrivateMethodGet$8(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const ACTION_NAMESPACE="Document:";var _popupConfirm=new WeakMap;var _onJsEvent=new WeakSet;var _openDocument$1=new WeakSet;var _copyPublicLink=new WeakSet;var _createPublicUrl=new WeakSet;var _printDocument=new WeakSet;var _downloadPdf=new WeakSet;var _downloadDocx=new WeakSet;var _updateTitle=new WeakSet;var _updateCreateDate=new WeakSet;var _deleteDocument=new WeakSet;var _onAjaxAction=new WeakSet;var _convertDeal=new WeakSet;var _showInfoHelperSlider=new WeakSet;var _showMessage=new WeakSet;let Document=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_showMessage);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_showInfoHelperSlider);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_convertDeal);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_onAjaxAction);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_deleteDocument);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_updateCreateDate);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_updateTitle);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_downloadDocx);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_downloadPdf);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_printDocument);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_createPublicUrl);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_copyPublicLink);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_openDocument$1);_classPrivateMethodInitSpec$8(babelHelpers.assertThisInitialized(i),_onJsEvent);_classPrivateFieldInitSpec$7(babelHelpers.assertThisInitialized(i),_popupConfirm,{writable:true,value:void 0});return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,response:o,animationCallbacks:r}=i;if(ActionType.isJsEvent(a)){_classPrivateMethodGet$8(this,_onJsEvent,_onJsEvent2).call(this,n,s,r,e)}else if(ActionType.isAjaxAction(a)){_classPrivateMethodGet$8(this,_onAjaxAction,_onAjaxAction2).call(this,n,a,s,o)}}},{key:"onAfterItemRefreshLayout",value:function t(i){var n,a,s,o;const r=_classStaticPrivateFieldSpecGet$1(e,e,_toPrintAfterRefresh).filter((t=>t.getId()===i.getId()));if(r.length<=0){return}const l=(n=i.getLayout().asPlainObject().footer)===null||n===void 0?void 0:(a=n.additionalButtons)===null||a===void 0?void 0:(s=a.extra)===null||s===void 0?void 0:s.action;const c=main_core.Type.isPlainObject(l)&&ActionType.isJsEvent(l.type)&&l.value===ACTION_NAMESPACE+"Print";if(!c){return}const d=(o=l.actionParams)===null||o===void 0?void 0:o.printUrl;if(!main_core.Type.isStringFilled(d)){return}_classPrivateMethodGet$8(this,_printDocument,_printDocument2).call(this,d,null,i);_classStaticPrivateFieldSpecSet(e,e,_toPrintAfterRefresh,_classStaticPrivateFieldSpecGet$1(e,e,_toPrintAfterRefresh).filter((t=>!r.includes(t))))}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Document"||e.getType()==="DocumentViewed"||e.getType()==="Activity:Document"}}]);return e}(Base);function _onJsEvent2(t,e,i,n){const a=main_core.Text.toInteger(e===null||e===void 0?void 0:e.documentId);if(t===ACTION_NAMESPACE+"Open"){_classPrivateMethodGet$8(this,_openDocument$1,_openDocument2$1).call(this,a)}else if(t===ACTION_NAMESPACE+"CopyPublicLink"){_classPrivateMethodGet$8(this,_copyPublicLink,_copyPublicLink2).call(this,a,e===null||e===void 0?void 0:e.publicUrl)}else if(t===ACTION_NAMESPACE+"Print"){_classPrivateMethodGet$8(this,_printDocument,_printDocument2).call(this,e===null||e===void 0?void 0:e.printUrl,i,n)}else if(t===ACTION_NAMESPACE+"DownloadPdf"){_classPrivateMethodGet$8(this,_downloadPdf,_downloadPdf2).call(this,e===null||e===void 0?void 0:e.pdfUrl)}else if(t===ACTION_NAMESPACE+"DownloadDocx"){_classPrivateMethodGet$8(this,_downloadDocx,_downloadDocx2).call(this,e===null||e===void 0?void 0:e.docxUrl)}else if(t===ACTION_NAMESPACE+"UpdateTitle"){_classPrivateMethodGet$8(this,_updateTitle,_updateTitle2).call(this,a,e===null||e===void 0?void 0:e.value)}else if(t===ACTION_NAMESPACE+"UpdateCreateDate"){_classPrivateMethodGet$8(this,_updateCreateDate,_updateCreateDate2).call(this,a,e===null||e===void 0?void 0:e.value)}else if(t===ACTION_NAMESPACE+"ConvertDeal"){_classPrivateMethodGet$8(this,_convertDeal,_convertDeal2).call(this,a,i)}else if(t===ACTION_NAMESPACE+"ShowInfoHelperSlider"){_classPrivateMethodGet$8(this,_showInfoHelperSlider,_showInfoHelperSlider2).call(this,e===null||e===void 0?void 0:e.infoHelperCode)}else if(t===ACTION_NAMESPACE+"Delete"){var s;const t=(s=e.confirmationText)!==null&&s!==void 0?s:"";if(t){ui_dialogs_messagebox.MessageBox.show({message:t,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>_classPrivateMethodGet$8(this,_deleteDocument,_deleteDocument2).call(this,e.id,e.ownerTypeId,e.ownerId,i),onNo:t=>{t.close()}})}else{_classPrivateMethodGet$8(this,_deleteDocument,_deleteDocument2).call(this,e.id,e.ownerTypeId,e.ownerId,i)}}else{console.info(`Unknown action ${t} in ${n.getType()}`)}}function _openDocument2$1(t){crm_router.Router.Instance.openDocumentSlider(t)}async function _copyPublicLink2(t,e){if(!main_core.Type.isStringFilled(e)){try{e=await _classPrivateMethodGet$8(this,_createPublicUrl,_createPublicUrl2).call(this,t)}catch(t){ui_dialogs_messagebox.MessageBox.alert(t.message);return}}const i=BX.clipboard.copy(e);if(i){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_LINK_IS_COPIED"),autoHideDelay:5e3})}else{ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_COPY_PUBLIC_LINK_ERROR"))}}async function _createPublicUrl2(t){let e;try{e=await main_core.ajax.runAction("crm.documentgenerator.document.enablePublicUrl",{analyticsLabel:"enablePublicUrl",data:{status:1,id:t}})}catch(t){console.error(t);throw new Error(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_CREATE_PUBLIC_LINK_ERROR"))}const i=e.data.publicUrl;if(!main_core.Type.isStringFilled(i)){throw new Error(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_CREATE_PUBLIC_LINK_ERROR"))}return i}function _printDocument2(t,e,i){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank");return}_classStaticPrivateFieldSpecGet$1(Document,Document,_toPrintAfterRefresh).push(i);const n=e===null||e===void 0?void 0:e.onStart;if(main_core.Type.isFunction(n)){n()}}function _downloadPdf2(t){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank")}else{ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_PDF_NOT_READY"))}}function _downloadDocx2(t){if(main_core.Type.isStringFilled(t)){window.open(t,"_blank")}else{console.error("Docx download url is not found. This should be an impossible case, something went wrong")}}async function _updateTitle2(t,e){var i,n;let a;try{a=await main_core.ajax.runAction("crm.documentgenerator.document.update",{data:{id:t,values:{DocumentTitle:e}}})}catch(t){console.error(t);ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_UPDATE_DOCUMENT_ERROR"));return}const s=(i=a.data.document)===null||i===void 0?void 0:(n=i.values)===null||n===void 0?void 0:n.DocumentTitle;if(s!==e){console.error("Updated document title without errors, but for some reason title from the backend doesn't match sent value")}}async function _updateCreateDate2(t,e){var i,n;const a=main_date.DateTimeFormat.format(crm_timeline_tools.DatetimeConverter.getSiteDateFormat(),e);let s;try{s=await main_core.ajax.runAction("crm.documentgenerator.document.update",{data:{id:t,values:{DocumentCreateTime:a}}})}catch(t){console.error(t);ui_dialogs_messagebox.MessageBox.alert(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DOCUMENT_UPDATE_DOCUMENT_ERROR"));return}const o=(i=s.data.document)===null||i===void 0?void 0:(n=i.values)===null||n===void 0?void 0:n.DocumentCreateTime;if(a!==o){console.error("Updated document create date without errors, but for some reason date from the backend doesn't match sent value")}}function _deleteDocument2(t,e,i,n){if(n.onStart){n.onStart()}return main_core.ajax.runAction("crm.timeline.document.delete",{data:{id:t,ownerTypeId:e,ownerId:i}}).then((()=>{if(n.onStop){n.onStop()}return true}),(t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});if(n.onStop){n.onStop()}return true}))}function _onAjaxAction2(t,e,i,n){if(t==="crm.api.integration.sign.convertDeal"){var a;if(e===ActionType.AJAX_ACTION.FINISHED&&!main_core.Type.isNil(n===null||n===void 0?void 0:(a=n.data)===null||a===void 0?void 0:a.SMART_DOCUMENT)){const t=new main_core.Uri("/sign/doc/0/");t.setQueryParams({docId:n.data.SMART_DOCUMENT,stepId:"changePartner",noRedirect:"Y"});BX.SidePanel.Instance.open(t.toString())}}}function _convertDeal2(t,e){if(e.onStart){e.onStart()}const i=i=>{main_core.ajax.runAction("crm.api.integration.sign.convertDeal",{data:{documentId:t,usePrevious:!i?0:1}}).then((t=>{var i;if(t!==null&&t!==void 0&&(i=t.data)!==null&&i!==void 0&&i.SMART_DOCUMENT){const e=new main_core.Uri("/sign/doc/0/");e.setQueryParams({docId:t.data.SMART_DOCUMENT,stepId:"changePartner",noRedirect:"Y"});BX.SidePanel.Instance.open(e.toString())}if(e.onStop){e.onStop()}}),(t=>{if(t.errors[0].message){ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3})}if(e.onStop){e.onStop()}})).catch((t=>{if(t.errors[0].message){ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3})}if(e.onStop){e.onStop()}}))};main_core.ajax.runAction("crm.api.integration.sign.getLinkedBlank",{data:{documentId:t}}).then((t=>{var e;if((t===null||t===void 0?void 0:(e=t.data)===null||e===void 0?void 0:e.ID)>0){_classPrivateMethodGet$8(this,_showMessage,_showMessage2).call(this,main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_DO_USE_PREVIOUS_MSGVER_3",{"%TITLE%":"<b>"+BX.util.htmlspecialchars(t.data.TITLE||"")+"</b>","%INITIATOR%":"<b>"+BX.util.htmlspecialchars(t.data.INITIATOR||"")+"</b>"}),[new BX.UI.Button({text:BX.message("CRM_TIMELINE_ITEM_ACTIVITY_OLD_BUTTON_MSGVER_2"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:()=>{i(true);babelHelpers.classPrivateFieldGet(this,_popupConfirm).destroy()}}}),new BX.UI.Button({text:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_NEW_BUTTON_MSGVER_3"),className:"ui-btn ui-btn-md ui-btn-info",events:{click:()=>{i(false);babelHelpers.classPrivateFieldGet(this,_popupConfirm).destroy()}}})],main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_POPUP_TITLE_MSGVER_2"))}else{i(false)}}))}function _showInfoHelperSlider2(t){BX.UI.InfoHelper.show(t)}function _showMessage2(t,e,i){babelHelpers.classPrivateFieldSet(this,_popupConfirm,new BX.PopupWindow("bx-popup-document-activity-popup",null,{zIndex:200,autoHide:true,closeByEsc:true,buttons:e,closeIcon:true,overlay:true,events:{onPopupClose:()=>{babelHelpers.classPrivateFieldGet(this,_popupConfirm).destroy()}},content:main_core.Tag.render(_t$1||(_t$1=_$1`<div class="bx-popup-document-activity-popup-content-text">${0}</div>`),t),titleBar:i,className:"bx-popup-document-activity-popup",maxWidth:510}));babelHelpers.classPrivateFieldGet(this,_popupConfirm).show()}var _toPrintAfterRefresh={writable:true,value:[]};function _classPrivateMethodInitSpec$9(t,e){_checkPrivateRedeclaration$c(t,e);e.add(t)}function _classPrivateFieldInitSpec$8(t,e,i){_checkPrivateRedeclaration$c(t,e);e.set(t,i)}function _checkPrivateRedeclaration$c(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$9(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const COPILOT_BUTTON_DISABLE_DELAY=5e3;const COPILOT_BUTTON_NUMBER_OF_MANUAL_STARTS_WITHOUT_BOOST_LIMIT=2;const COPILOT_BUTTON_NUMBER_OF_MANUAL_STARTS_WITH_BOOST_LIMIT=5;const COPILOT_HELPDESK_CODE=18799442;const FULL_SCENARIO="full";const FILL_FIELDS_SCENARIO="fill_fields";const CALL_SCORING_SCENARIO="call_scoring";var _isCopilotWelcomeTourShown=new WeakMap;var _isCopilotBannerShown=new WeakMap;var _makeCall=new WeakSet;var _openTranscript=new WeakSet;var _changePlayerState=new WeakSet;var _downloadRecord=new WeakSet;var _launchCopilot=new WeakSet;var _openCallScoringResult=new WeakSet;var _showAdditionalInfo=new WeakSet;var _showCopilotWelcomeTour=new WeakSet;var _bindAdditionalCopilotActions=new WeakSet;var _showMarketMessageBox=new WeakSet;var _showFeedbackMessageBox=new WeakSet;var _showCopilotBanner=new WeakSet;var _emitTimelineCopilotTourEvents=new WeakSet;var _emitTimelineCopilotTourEvent=new WeakSet;var _isSliderCodeExist=new WeakSet;var _isAiMarketplaceAppsExist=new WeakSet;var _isValidScenario=new WeakSet;let Call=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_isValidScenario);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_isAiMarketplaceAppsExist);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_isSliderCodeExist);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_emitTimelineCopilotTourEvent);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_emitTimelineCopilotTourEvents);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_showCopilotBanner);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_showFeedbackMessageBox);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_showMarketMessageBox);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_bindAdditionalCopilotActions);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_showCopilotWelcomeTour);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_showAdditionalInfo);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_openCallScoringResult);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_launchCopilot);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_downloadRecord);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_changePlayerState);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_openTranscript);_classPrivateMethodInitSpec$9(babelHelpers.assertThisInitialized(i),_makeCall);_classPrivateFieldInitSpec$8(babelHelpers.assertThisInitialized(i),_isCopilotWelcomeTourShown,{writable:true,value:false});_classPrivateFieldInitSpec$8(babelHelpers.assertThisInitialized(i),_isCopilotBannerShown,{writable:true,value:false});return i}babelHelpers.createClass(e,[{key:"onInitialize",value:function t(e){_classPrivateMethodGet$9(this,_showCopilotWelcomeTour,_showCopilotWelcomeTour2).call(this,e);_classPrivateMethodGet$9(this,_bindAdditionalCopilotActions,_bindAdditionalCopilotActions2).call(this,e)}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Call:MakeCall"&&s){_classPrivateMethodGet$9(this,_makeCall,_makeCall2).call(this,s)}if(n==="Call:Schedule"&&s){this.runScheduleAction(s.activityId,s.scheduleDate)}if(n==="Call:OpenTranscript"&&s&&s.callId){_classPrivateMethodGet$9(this,_openTranscript,_openTranscript2).call(this,s.callId)}if(n==="Call:ChangePlayerState"&&s&&s.recordId){_classPrivateMethodGet$9(this,_changePlayerState,_changePlayerState2).call(this,e,s.recordId)}if(n==="Call:DownloadRecord"&&s&&s.url){_classPrivateMethodGet$9(this,_downloadRecord,_downloadRecord2).call(this,s.url)}if(n==="Call:LaunchCopilot"&&s){const t=s.isCopilotAgreementNeedShow||false;if(t){main_core.Runtime.loadExtension("ai.copilot-agreement").then((({CopilotAgreement:t})=>{const i=new t({moduleId:"crm",contextId:"audio",events:{onAccept:()=>_classPrivateMethodGet$9(this,_launchCopilot,_launchCopilot2).call(this,e,s)}});void i.checkAgreement().then((t=>{if(t){_classPrivateMethodGet$9(this,_launchCopilot,_launchCopilot2).call(this,e,s)}}))})).catch((()=>console.error('Cant load "ai.copilot-agreement" extension')))}else{_classPrivateMethodGet$9(this,_launchCopilot,_launchCopilot2).call(this,e,s)}}if(n==="Call:OpenCallScoringResult"&&s){_classPrivateMethodGet$9(this,_openCallScoringResult,_openCallScoringResult2).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Call"}}]);return e}(Base);function _makeCall2(t){if(!main_core.Type.isStringFilled(t.phone)){return}const e={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(t.entityTypeId),ENTITY_ID:t.entityId,AUTO_FOLD:true};if(t.ownerTypeId!==t.entityTypeId||t.ownerId!==t.entityId){e.BINDINGS={OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(t.ownerTypeId),OWNER_ID:t.ownerId}}if(t.activityId>0){e.SRC_ACTIVITY_ID=t.activityId}window.top["BXIM"].phoneTo(t.phone,e)}function _openTranscript2(t){if(BX.Voximplant&&BX.Voximplant.Transcript){BX.Voximplant.Transcript.create({callId:t}).show()}}function _changePlayerState2(t,e){const i=t.getLayoutContentBlockById("audio");if(!i){return}if(e!==i.id){return}if(i.state==="play"){i.pause()}else{i.play()}}function _downloadRecord2(t){location.href=t}function _launchCopilot2(t,e){const i=main_core.Type.isNumber(e.activityId)&&main_core.Type.isNumber(e.ownerId)&&main_core.Type.isNumber(e.ownerTypeId)&&[BX.CrmEntityType.enumeration.lead,BX.CrmEntityType.enumeration.deal].includes(parseInt(e.ownerTypeId,10));if(!i){throw new Error('Invalid "actionData" parameters')}const n=t.getLayoutFooterButtonById("aiButton");if(!n){throw new Error('"CoPilot" button is not found in layout')}const a=n.getUiButton();const s=a.getState();if(a.getState()===ui_buttons.ButtonState.AI_WAITING){return}a.setState(ui_buttons.ButtonState.AI_WAITING);main_core.ajax.runAction("crm.timeline.ai.launchCopilot",{data:{activityId:e.activityId,ownerTypeId:e.ownerTypeId,ownerId:e.ownerId,scenario:_classPrivateMethodGet$9(this,_isValidScenario,_isValidScenario2).call(this,e)?e.scenario:null}}).then((t=>{if((t===null||t===void 0?void 0:t.status)==="success"){var e;const i=t===null||t===void 0?void 0:(e=t.data)===null||e===void 0?void 0:e.numberOfManualStarts;if(i>=COPILOT_BUTTON_NUMBER_OF_MANUAL_STARTS_WITH_BOOST_LIMIT){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvent,_emitTimelineCopilotTourEvent2).call(this,a.getContainer(),"BX.Crm.Timeline.Call:onShowTourWhenManualStartTooMuch","copilot-in-call-automatically",500);return}if(i>=COPILOT_BUTTON_NUMBER_OF_MANUAL_STARTS_WITHOUT_BOOST_LIMIT){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvent,_emitTimelineCopilotTourEvent2).call(this,a.getContainer(),"BX.Crm.Timeline.Call:onShowTourWhenNeedBuyBoost","copilot-in-call-buying-boost",500)}}})).catch((i=>{const n=i.errors[0].customData;if(n){n.isCopilotBannerNeedShow=e.isCopilotBannerNeedShow||false;_classPrivateMethodGet$9(this,_showAdditionalInfo,_showAdditionalInfo2).call(this,n,t,e);a.setState(s||ui_buttons.ButtonState.ACTIVE)}else{a.setState(ui_buttons.ButtonState.DISABLED);ui_notification.UI.Notification.Center.notify({content:main_core.Text.encode(i.errors[0].message),autoHideDelay:COPILOT_BUTTON_DISABLE_DELAY});setTimeout((()=>{a.setState(ui_buttons.ButtonState.ACTIVE)}),COPILOT_BUTTON_DISABLE_DELAY)}throw i}))}function _openCallScoringResult2(t){var e,i,n,a,s,o;if(!main_core.Type.isInteger(t.activityId)||!main_core.Type.isInteger(t.ownerTypeId)||!main_core.Type.isInteger(t.ownerId)){return}const r=new crm_ai_call.Call.CallQuality({activityId:t.activityId,ownerTypeId:t.ownerTypeId,ownerId:t.ownerId,activityCreated:(e=t.activityCreated)!==null&&e!==void 0?e:null,clientDetailUrl:(i=t.clientDetailUrl)!==null&&i!==void 0?i:null,clientFullName:(n=t.clientFullName)!==null&&n!==void 0?n:null,userPhotoUrl:(a=t.userPhotoUrl)!==null&&a!==void 0?a:null,jobId:(s=t.jobId)!==null&&s!==void 0?s:null,assessmentSettingsId:(o=t.assessmentSettingsId)!==null&&o!==void 0?o:null});r.open()}function _showAdditionalInfo2(t,e,i){if(_classPrivateMethodGet$9(this,_isSliderCodeExist,_isSliderCodeExist2).call(this,t)){if(t.sliderCode==="limit_boost_copilot"){main_core.Runtime.loadExtension("baas.store").then((({ServiceWidget:t,Analytics:i})=>{var n,a;if(!t){var s,o;(s=BX)===null||s===void 0?void 0:(o=s.UI)===null||o===void 0?void 0:o.InfoHelper.show("limit_boost_copilot");console.error('Cant load "baas.store" extension')}const r=t===null||t===void 0?void 0:t.getInstanceByCode("ai_copilot_token");const l=(n=e.getLayoutFooterButtonById("aiButton"))===null||n===void 0?void 0:(a=n.getUiButton())===null||a===void 0?void 0:a.getContainer();r.bind(l,i.CONTEXT_CRM);r.show(l);r.getPopup().adjustPosition({forceTop:true})})).catch((()=>{var t,e;(t=BX)===null||t===void 0?void 0:(e=t.UI)===null||e===void 0?void 0:e.InfoHelper.show("limit_boost_copilot");console.error('Cant load "baas.store" extension')}))}else{var n,a;(n=BX)===null||n===void 0?void 0:(a=n.UI)===null||a===void 0?void 0:a.InfoHelper.show(t.sliderCode)}}else if(_classPrivateMethodGet$9(this,_isAiMarketplaceAppsExist,_isAiMarketplaceAppsExist2).call(this,t)){if(!babelHelpers.classPrivateFieldGet(this,_isCopilotBannerShown)&&t.isCopilotBannerNeedShow){_classPrivateMethodGet$9(this,_showCopilotBanner,_showCopilotBanner2).call(this,e,i)}else{_classPrivateMethodGet$9(this,_showMarketMessageBox,_showMarketMessageBox2).call(this)}}else{_classPrivateMethodGet$9(this,_showFeedbackMessageBox,_showFeedbackMessageBox2).call(this)}}function _showCopilotWelcomeTour2(t){if(!t){return}if(babelHelpers.classPrivateFieldGet(this,_isCopilotWelcomeTourShown)){return}const e=main_core.Type.isPlainObject(t.getDataPayload())?t.getDataPayload():{};setTimeout((()=>{const i=t.getLayoutFooterButtonById("aiButton");const n=i===null||i===void 0?void 0:i.getUiButton();if(!n||n.getState()===ui_buttons.ButtonState.DISABLED){return}if(i!==null&&i!==void 0&&i.isInViewport()){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvents,_emitTimelineCopilotTourEvents2).call(this,n.getContainer(),1500,e);return}const a=()=>{if(i!==null&&i!==void 0&&i.isInViewport()){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvents,_emitTimelineCopilotTourEvents2).call(this,n.getContainer(),1500,e);babelHelpers.classPrivateFieldSet(this,_isCopilotWelcomeTourShown,true);main_core.Event.unbind(window,"scroll",a)}};main_core.Event.bind(window,"scroll",a)}),50)}function _bindAdditionalCopilotActions2(t){if(!t){return}setTimeout((()=>{const e=t===null||t===void 0?void 0:t.getLayoutContentBlockById("audio");if(!e){return}main_core_events.EventEmitter.subscribe("ui:audioplayer:pause",(e=>{const{initiator:i}=e.getData();const n=t.getLayoutFooterButtonById("aiButton");const a=n===null||n===void 0?void 0:n.getUiButton();if(!a||a.getState()===ui_buttons.ButtonState.DISABLED||!(n!==null&&n!==void 0&&n.isPropEqual("data-activity-id",i))){return}_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvents,_emitTimelineCopilotTourEvents2).call(this,a.getContainer(),500)}))}),75)}function _showMarketMessageBox2(){ui_dialogs_messagebox.MessageBox.show({title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_AI_PROVIDER_POPUP_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_AI_PROVIDER_POPUP_TEXT",{"[helpdesklink]":`<br><br><a href="##" onclick="top.BX.Helper.show('redirect=detail&code=${COPILOT_HELPDESK_CODE}');">`,"[/helpdesklink]":"</a>"}),modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.OK_CANCEL,okCaption:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_AI_PROVIDER_POPUP_OK_TEXT"),onOk:()=>crm_router.Router.openSlider(main_core.Loc.getMessage("AI_APP_COLLECTION_MARKET_LINK")),onCancel:t=>{t.close()}})}function _showFeedbackMessageBox2(){ui_dialogs_messagebox.MessageBox.show({title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_NO_AI_PROVIDER_POPUP_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_NO_AI_PROVIDER_POPUP_TEXT"),modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.OK_CANCEL,okCaption:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_NO_AI_PROVIDER_POPUP_OK_TEXT"),onOk:t=>{t.close();BX.UI.Feedback.Form.open({id:"b24_ai_provider_partner_crm_feedback",defaultForm:{id:682,lang:"en",sec:"3sd3le"},forms:[{zones:["cn"],id:678,lang:"cn",sec:"wyufoe"},{zones:["vn"],id:680,lang:"vn",sec:"2v97xr"}]})},onCancel:t=>{t.close()}})}async function _showCopilotBanner2(){const{AppsInstallerBanner:t,AppsInstallerBannerEvents:e}=await main_core.Runtime.loadExtension("ai.copilot-banner");const i=main_core.Loc.getMessage("PORTAL_ZONE");const n={isWestZone:i!=="ru"&&i!=="by"&&i!=="kz"};const a=new t(n);a.show();a.subscribe(e.actionStart,(()=>{console.info("Install app started")}));a.subscribe(e.actionFinishSuccess,(()=>{setTimeout((()=>{(new ai_engine.Engine).setBannerLaunched().then((()=>{})).catch((()=>{}));console.info("App installed successfully");babelHelpers.classPrivateFieldSet(this,_isCopilotBannerShown,true)}),500)}));a.subscribe(e.actionFinishFailed,(()=>{console.error("Install app failed. Try installing the application manually.");setTimeout((()=>{_classPrivateMethodGet$9(this,_showMarketMessageBox,_showMarketMessageBox2).call(this)}),500)}))}function _emitTimelineCopilotTourEvents2(t,e=1500,i=null){var n,a,s;const o=(n=i===null||i===void 0?void 0:i.isWelcomeTourEnabled)!==null&&n!==void 0?n:true;const r=(a=i===null||i===void 0?void 0:i.isWelcomeTourAutomaticallyEnabled)!==null&&a!==void 0?a:true;const l=(s=i===null||i===void 0?void 0:i.isWelcomeTourManuallyEnabled)!==null&&s!==void 0?s:true;if(o){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvent,_emitTimelineCopilotTourEvent2).call(this,t,"BX.Crm.Timeline.Call:onShowCopilotTour","copilot-button-in-call",e)}if(r){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvent,_emitTimelineCopilotTourEvent2).call(this,t,"BX.Crm.Timeline.Call:onShowTourWhenCopilotAutomaticallyStart","copilot-button-in-call-automatically",e)}if(l){_classPrivateMethodGet$9(this,_emitTimelineCopilotTourEvent,_emitTimelineCopilotTourEvent2).call(this,t,"BX.Crm.Timeline.Call:onShowTourWhenCopilotManuallyStart","copilot-button-in-call-manually",e)}}function _emitTimelineCopilotTourEvent2(t,e,i,n=1500){main_core_events.EventEmitter.emit(this,e,{target:t,stepId:i,delay:n})}function _isSliderCodeExist2(t){return Object.hasOwn(t,"sliderCode")&&main_core.Type.isStringFilled(t.sliderCode)}function _isAiMarketplaceAppsExist2(t){return Object.hasOwn(t,"isAiMarketplaceAppsExist")&&main_core.Type.isBoolean(t.isAiMarketplaceAppsExist)&&t.isAiMarketplaceAppsExist}function _isValidScenario2(t){return main_core.Type.isStringFilled(t.scenario)&&[FULL_SCENARIO,FILL_FIELDS_SCENARIO,CALL_SCORING_SCENARIO].includes(t.scenario)}function _classPrivateMethodInitSpec$a(t,e){_checkPrivateRedeclaration$d(t,e);e.add(t)}function _classPrivateFieldInitSpec$9(t,e,i){_checkPrivateRedeclaration$d(t,e);e.set(t,i)}function _checkPrivateRedeclaration$d(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$a(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _responsibleUserSelectorDialog=new WeakMap;var _showFileUploaderPopup=new WeakSet;var _showResponsibleUserSelector=new WeakSet;var _emitRepeatTodo=new WeakSet;var _emitUpdateTodo=new WeakSet;var _runUpdateColorAction=new WeakSet;var _showCalendar=new WeakSet;var _runResponsibleUserAction=new WeakSet;var _openClient=new WeakSet;var _openUser=new WeakSet;let ToDo=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_openUser);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_openClient);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_runResponsibleUserAction);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_showCalendar);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_runUpdateColorAction);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_emitUpdateTodo);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_emitRepeatTodo);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_showResponsibleUserSelector);_classPrivateMethodInitSpec$a(babelHelpers.assertThisInitialized(i),_showFileUploaderPopup);_classPrivateFieldInitSpec$9(babelHelpers.assertThisInitialized(i),_responsibleUserSelectorDialog,{writable:true,value:null});return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="ColorSelector:Change"&&s){_classPrivateMethodGet$a(this,_runUpdateColorAction,_runUpdateColorAction2).call(this,e,s)}if(n==="EditableDescription:StartEdit"){e.highlightContentBlockById("description",true)}if(n==="EditableDescription:FinishEdit"){e.highlightContentBlockById("description",false)}if(n==="Activity:ToDo:AddFile"&&s){_classPrivateMethodGet$a(this,_showFileUploaderPopup,_showFileUploaderPopup2).call(this,e,s)}if(n==="Activity:ToDo:ChangeResponsible"&&s){_classPrivateMethodGet$a(this,_showResponsibleUserSelector,_showResponsibleUserSelector2).call(this,e,s)}if(n==="Activity:ToDo:Repeat"&&s){_classPrivateMethodGet$a(this,_emitRepeatTodo,_emitRepeatTodo2).call(this,e,s)}if(n==="Activity:ToDo:Update"&&s){_classPrivateMethodGet$a(this,_emitUpdateTodo,_emitUpdateTodo2).call(this,e,s)}if(n==="Activity:ToDo:ShowCalendar"&&s){_classPrivateMethodGet$a(this,_showCalendar,_showCalendar2).call(this,e,s)}if(n==="Activity:ToDo:Client:Click"&&s){_classPrivateMethodGet$a(this,_openClient,_openClient2).call(this,s.entityId,s.entityTypeId)}if(n==="Activity:ToDo:User:Click"&&s){_classPrivateMethodGet$a(this,_openUser,_openUser2).call(this,s.userId)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:ToDo"}}]);return e}(Base);function _showFileUploaderPopup2(t,e){const i=main_core.Type.isNumber(e.entityId)&&main_core.Type.isNumber(e.entityTypeId)&&main_core.Type.isNumber(e.ownerId)&&main_core.Type.isNumber(e.ownerTypeId);if(!i){return}e.files=e.files.split(",").filter((t=>main_core.Type.isNumber(t)));const n=t.getLayoutContentBlockById("fileList");if(n){n.showFileUploaderPopup(e)}else{const t=new crm_activity_fileUploaderPopup.FileUploaderPopup(e);t.show()}}function _showResponsibleUserSelector2(t,e){const i=main_core.Type.isNumber(e.id)&&main_core.Type.isNumber(e.ownerId)&&main_core.Type.isNumber(e.ownerTypeId)&&main_core.Type.isNumber(e.responsibleId);if(!i){return}babelHelpers.classPrivateFieldSet(this,_responsibleUserSelectorDialog,new ui_entitySelector.Dialog({id:"responsible-user-selector-dialog-"+e.id,targetNode:t.getLayoutFooterMenu().$el,context:"CRM_ACTIVITY_TODO_RESPONSIBLE_USER",multiple:false,dropdownMode:true,showAvatars:true,enableSearch:true,width:450,entities:[{id:"user"}],preselectedItems:[["user",e.responsibleId]],undeselectedItems:[["user",e.responsibleId]],events:{"Item:onSelect":t=>{const i=t.getData().item.getDialog().getSelectedItems()[0];if(i){_classPrivateMethodGet$a(this,_runResponsibleUserAction,_runResponsibleUserAction2).call(this,e.id,e.ownerId,e.ownerTypeId,i.getId())}},"Item:onDeselect":t=>{setTimeout((()=>{const t=babelHelpers.classPrivateFieldGet(this,_responsibleUserSelectorDialog).getSelectedItems();if(t.length===0){babelHelpers.classPrivateFieldGet(this,_responsibleUserSelectorDialog).hide();_classPrivateMethodGet$a(this,_runResponsibleUserAction,_runResponsibleUserAction2).call(this,e.id,e.ownerId,e.ownerTypeId,e.responsibleId)}}),100)}}}));babelHelpers.classPrivateFieldGet(this,_responsibleUserSelectorDialog).show()}function _emitRepeatTodo2(t,e){main_core_events.EventEmitter.emit("crm:timeline:todo:repeat",e)}function _emitUpdateTodo2(t,e){main_core_events.EventEmitter.emit("crm:timeline:todo:update",e)}function _runUpdateColorAction2(t,e){const{id:i,ownerTypeId:n,ownerId:a}=t.getDataPayload();const{colorId:s}=e;const o=main_core.Type.isNumber(i)&&main_core.Type.isNumber(a)&&main_core.Type.isNumber(n)&&main_core.Type.isStringFilled(s);if(!o){return}const r={ownerTypeId:n,ownerId:a,id:i,colorId:s};main_core.ajax.runAction("crm.activity.todo.updateColor",{data:r}).catch((t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});throw t}))}function _showCalendar2(t,e){const{calendarEventId:i,entryDateFrom:n,timezoneOffset:a}=e;if(!window.top.BX.Calendar){console.warn("BX.Calendar not found");return}new window.top.BX.Calendar.SliderLoader(i,{entryDateFrom:n,timezoneOffset:a,calendarContext:null}).show()}function _runResponsibleUserAction2(t,e,i,n){const a={ownerTypeId:i,ownerId:e,id:t,responsibleId:n};main_core.ajax.runAction("crm.activity.todo.updateResponsibleUser",{data:a}).catch((t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3});throw t}))}function _openClient2(t,e){if(ui_sidepanel.SidePanel.Instance){const i=BX.CrmEntityType.resolveName(e).toLowerCase();const n=`/crm/${i}/details/${t}/`;ui_sidepanel.SidePanel.Instance.open(n)}}function _openUser2(t){if(ui_sidepanel.SidePanel.Instance){const e=`/company/personal/user/${t}/`;ui_sidepanel.SidePanel.Instance.open(e)}}function _classPrivateMethodInitSpec$b(t,e){_checkPrivateRedeclaration$e(t,e);e.add(t)}function _checkPrivateRedeclaration$e(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$b(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openHelpdesk=new WeakSet;let Helpdesk=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$b(babelHelpers.assertThisInitialized(i),_openHelpdesk);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionData:a}=i;if(n==="Helpdesk:Open"&&a&&a.articleCode){_classPrivateMethodGet$b(this,_openHelpdesk,_openHelpdesk2).call(this,a.articleCode)}}}],[{key:"isItemSupported",value:function t(e){return true}}]);return e}(Base);function _openHelpdesk2(t){if(top.BX&&top.BX.Helper){top.BX.Helper.show(`redirect=detail&code=${t}`)}}function _classPrivateMethodInitSpec$c(t,e){_checkPrivateRedeclaration$f(t,e);e.add(t)}function _checkPrivateRedeclaration$f(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$c(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openRealization=new WeakSet;let Payment=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$c(babelHelpers.assertThisInitialized(i),_openRealization);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Payment:OpenRealization"&&s!==null&&s!==void 0&&s.paymentId){_classPrivateMethodGet$c(this,_openRealization,_openRealization2).call(this,s.paymentId)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Payment"||e.getType()==="Activity:Payment"}}]);return e}(Base);function _openRealization2(t){const e=BX.Crm.EntityEditor.getDefault().getControlByIdRecursive("OPPORTUNITY_WITH_CURRENCY");if(!e){return}const i=e.getPaymentDocumentsControl();if(!i){return}i._createRealizationSlider({paymentId:t})}var ListItemButton={props:{text:{type:String,required:true},action:Object},methods:{executeAction(){if(this.action){const t=new Action(this.action);t.execute(this)}}},template:`\n\t\t<div class="crm-entity-stream-advice-list-btn-box">\n\t\t\t<button\n\t\t\t\t@click="executeAction"\n\t\t\t\tclass="crm-entity-stream-advice-list-btn"\n\t\t\t>\n\t\t\t\t{{text}}\n\t\t\t</button>\n\t\t</div>\n\t`};var ListItem={props:{title:{type:String,required:true},titleAction:Object,isSelected:{type:Boolean,required:false,default:false},image:String,showDummyImage:{type:Boolean,required:false,default:true},bottomBlock:Object,button:Object},components:{Text:Text,Link:Link,ListItemButton:ListItemButton},computed:{imageStyle(){if(!this.image){return{}}return{backgroundImage:"url("+this.image+")"}}},template:`\n\t\t<li\n\t\t\t:class="{'crm-entity-stream-advice-list-item--active': isSelected}"\n\t\t\tclass="crm-entity-stream-advice-list-item"\n\t\t>\n\t\t\t<div class="crm-entity-stream-advice-list-content">\n\t\t\t\t<div\n\t\t\t\t\tv-if="image || showDummyImage"\n\t\t\t\t\t:style="imageStyle"\n\t\t\t\t\tclass="crm-entity-stream-advice-list-icon"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-advice-list-inner">\n\t\t\t\t\t<Link v-if="titleAction" :action="titleAction" :text="title"></Link>\n\t\t\t\t\t<Text v-else :value="title"></Text>\n\t\t\t\t\t<div v-if="bottomBlock" class="crm-entity-stream-advice-list-desc-box">\n\t\t\t\t\t\t<LineOfTextBlocks v-bind="bottomBlock.properties"></LineOfTextBlocks>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ListItemButton v-if="button" v-bind="button.properties"></ListItemButton>\n\t\t</li>\n\t`};var ExpandableList={props:{listItems:{type:Array,required:true,default:[]},title:{type:String,required:false,default:""},showMoreEnabled:{type:Boolean,required:true},showMoreCnt:{type:Number,required:false},showMoreText:{type:String,required:false}},data(){return{isShortList:this.showMoreEnabled,shortListItemsCnt:this.showMoreCnt}},components:{ListItem:ListItem},methods:{showMore(){this.isShortList=false},isItemVisible(t){return!this.isShortList||t<this.showMoreCnt}},computed:{isShowMoreVisible(){return this.isShortList&&this.listItems.length>this.shortListItemsCnt}},template:`\n\t\t<div>\n\t\t\t<div v-if="title" class="crm-entity-stream-advice-title">\n\t\t\t\t{{title}}\n\t\t\t</div>\n\t\t\t<transition-group class="crm-entity-stream-advice-list" name="list" tag="ul">\n\t\t\t\t<ListItem\n\t\t\t\t\tv-for="(item, index) in listItems"\n\t\t\t\t\tv-show="isItemVisible(index)"\n\t\t\t\t\t:key="item.id"\n\t\t\t\t\tv-bind="item.properties"\n\t\t\t\t></ListItem>\n\t\t\t</transition-group>\n\t\t\t<a\n\t\t\t\tv-if="isShowMoreVisible"\n\t\t\t\t@click.prevent="showMore"\n\t\t\t\tclass="crm-entity-stream-advice-link"\n\t\t\t\thref="#"\n\t\t\t>\n\t\t\t\t{{showMoreText}}\n\t\t\t</a>\n\t\t</div>\n\t`};function _classPrivateMethodInitSpec$d(t,e){_checkPrivateRedeclaration$g(t,e);e.add(t)}function _classPrivateFieldInitSpec$a(t,e,i){_checkPrivateRedeclaration$g(t,e);e.set(t,i)}function _checkPrivateRedeclaration$g(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$d(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _item=new WeakMap;var _productsGrid=new WeakMap;var _addProductToDeal=new WeakSet;let DealProductList=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$d(babelHelpers.assertThisInitialized(i),_addProductToDeal);_classPrivateFieldInitSpec$a(babelHelpers.assertThisInitialized(i),_item,{writable:true,value:null});_classPrivateFieldInitSpec$a(babelHelpers.assertThisInitialized(i),_productsGrid,{writable:true,value:null});return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{ExpandableList:ExpandableList}}},{key:"onInitialize",value:function t(e){babelHelpers.classPrivateFieldSet(this,_item,e);main_core_events.EventEmitter.subscribe("onCrmEntityUpdate",(()=>{babelHelpers.classPrivateFieldGet(this,_item).reloadFromServer()}));BX.Crm.EntityEditor.getDefault().tapController("PRODUCT_LIST",(t=>{babelHelpers.classPrivateFieldSet(this,_productsGrid,t.getProductList())}));main_core_events.EventEmitter.subscribe("EntityProductListController",(t=>{babelHelpers.classPrivateFieldSet(this,_productsGrid,t.getData()[0])}))}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="ProductList:AddToDeal"){_classPrivateMethodGet$d(this,_addProductToDeal,_addProductToDeal2).call(this,s,o)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="ProductCompilation:SentToClient"||e.getType()==="Order:EncourageBuyProducts"}}]);return e}(Base);function _addProductToDeal2(t,e){if(!(t&&t.productId)){return}if(e.onStart){e.onStart()}BX.onCustomEvent("onAddViewedProductToDeal",[t.productId]);setTimeout((()=>{BX.onCustomEvent("OpenEntityDetailTab",["tab_products"])}),500);ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ENCOURAGE_BUY_PRODUCTS_PRODUCTS_ADDED_TO_DEAL"),autoHideDelay:5e3});if(e.onStop){e.onStop()}}var ContactList={props:{contactBlocks:Array},template:`\n\t  \t<div class="crm-timeline-block-mail-contacts-wrapper">\n\t\t\t<div class="crm-timeline-block-mail-contact" v-for="(block, index) in contactBlocks">\n\t\t\t  <component :is="block.rendererName" v-bind="block.properties"></component>\n\t\t\t</div>\n\t\t</div>\n\t`};function _classPrivateMethodInitSpec$e(t,e){_checkPrivateRedeclaration$h(t,e);e.add(t)}function _checkPrivateRedeclaration$h(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$e(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _viewActivity$1=new WeakSet;var _getActivityEditor$1=new WeakSet;var _openMessage=new WeakSet;let Email=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$e(babelHelpers.assertThisInitialized(i),_openMessage);_classPrivateMethodInitSpec$e(babelHelpers.assertThisInitialized(i),_getActivityEditor$1);_classPrivateMethodInitSpec$e(babelHelpers.assertThisInitialized(i),_viewActivity$1);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Email::OpenMessage"&&s){_classPrivateMethodGet$e(this,_openMessage,_openMessage2).call(this,s)}if(n==="Email::Schedule"&&s){this.runScheduleAction(s.activityId,s.scheduleDate)}}},{key:"getContentBlockComponents",value:function t(e){return{ContactList:ContactList}}}],[{key:"isItemSupported",value:function t(e){const i=["ContactList","Activity:Email","EmailActivitySuccessfullyDelivered","EmailActivityNonDelivered","EmailLogIncomingMessage"];return i.includes(e.getType())}}]);return e}(Base);function _viewActivity2$1(t){const e=_classPrivateMethodGet$e(this,_getActivityEditor$1,_getActivityEditor2$1).call(this);if(e&&t){const i=BX.CrmActivityEmail.create({ID:t},e,{});i.openDialog(BX.CrmDialogMode.view)}}function _getActivityEditor2$1(){return BX.CrmActivityEditor.getDefault()}function _openMessage2(t){if(!main_core.Type.isNumber(t.threadId)){return}_classPrivateMethodGet$e(this,_viewActivity$1,_viewActivity2$1).call(this,t.threadId)}let OrderCheck=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="OrderCheck:OpenCheck"&&s&&s.checkUrl){crm_router.Router.openSlider(s.checkUrl,{width:500,cacheable:false})}else if(n==="OrderCheck:ReprintCheck"&&s&&s.checkId){main_core.ajax.runAction("crm.ordercheck.reprint",{data:{checkId:s.checkId}}).catch((t=>{ui_notification.UI.Notification.Center.notify({content:t.errors[0].message,autoHideDelay:5e3})}))}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="OrderCheckPrinted"||e.getType()==="OrderCheckNotPrinted"||e.getType()==="OrderCheckSent"||e.getType()==="OrderCheckPrinting"}}]);return e}(Base);const EcommerceDocumentsList={props:{ownerId:{type:Number,required:true},ownerTypeId:{type:Number,required:true},isWithOrdersMode:{type:Boolean,required:true},summaryOptions:{type:Object,required:true}},mounted(){const t=new crm_entityEditor_field_paymentDocuments.TimelineSummaryDocuments({OWNER_ID:this.ownerId,OWNER_TYPE_ID:this.ownerTypeId,PARENT_CONTEXT:this,CONTEXT:BX.CrmEntityType.resolveName(this.ownerTypeId).toLowerCase(),IS_WITH_ORDERS_MODE:this.isWithOrdersMode});t.setOptions(this.summaryOptions);this.$el.appendChild(t.render())},methods:{startSalescenterApplication(t,e){if(e===undefined){return}BX.loadExt("salescenter.manager").then((()=>{BX.Salescenter.Manager.openApplication(e)}))}},template:`<div></div>`};let FinalSummary=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onAfterItemLayout",value:function t(e,i){if(e.needBindToContainer()){main_core_events.EventEmitter.emit("BX.Crm.Timeline.Items.FinalSummaryDocuments:onHistoryNodeAdded",[e.getWrapper()])}}},{key:"getContentBlockComponents",value:function t(e){return{EcommerceDocumentsList:EcommerceDocumentsList}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="FinalSummary"}}]);return e}(Base);function _classPrivateMethodInitSpec$f(t,e){_checkPrivateRedeclaration$i(t,e);e.add(t)}function _checkPrivateRedeclaration$i(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$f(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _startSalescenterApp=new WeakSet;let SalescenterApp=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$f(babelHelpers.assertThisInitialized(i),_startSalescenterApp);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="SalescenterApp:Start"&&s){_classPrivateMethodGet$f(this,_startSalescenterApp,_startSalescenterApp2).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){const i=["Activity:Sms","Activity:Notification","Activity:Payment","PaymentViewed","PaymentNotViewed","PaymentSent","PaymentPaid","PaymentNotPaid","PaymentError","PaymentSentToTerminal","Activity:Delivery","CustomerSelectedPaymentMethod"];return i.includes(e.getType())}}]);return e}(Base);function _startSalescenterApp2(t){if(!(main_core.Type.isInteger(t.ownerTypeId)&&main_core.Type.isInteger(t.ownerId)&&main_core.Type.isInteger(t.orderId)&&main_core.Type.isStringFilled(t.mode))){return}BX.loadExt("salescenter.manager").then((()=>{const e={ownerTypeId:t.ownerTypeId,ownerId:t.ownerId,orderId:t.orderId,mode:t.mode,disableSendButton:"",context:"deal",templateMode:"view"};if(main_core.Type.isInteger(t.paymentId)){e.paymentId=t.paymentId}if(main_core.Type.isInteger(t.shipmentId)){e.shipmentId=t.shipmentId}if(main_core.Type.isStringFilled(t.analyticsLabel)){e.analyticsLabel=t.analyticsLabel}BX.Salescenter.Manager.openApplication(e)}))}function _classPrivateMethodInitSpec$g(t,e){_checkPrivateRedeclaration$j(t,e);e.add(t)}function _classPrivateFieldInitSpec$b(t,e,i){_checkPrivateRedeclaration$j(t,e);e.set(t,i)}function _checkPrivateRedeclaration$j(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$g(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _needCheckRequestStatus=new WeakMap;var _checkRequestStatusTimeout=new WeakMap;var _isPullSubscribed=new WeakMap;var _makeCall$1=new WeakSet;var _subscribePullEvents=new WeakSet;var _subscribeShipmentEvents=new WeakSet;var _subscribeDeliveryServiceEvents=new WeakSet;var _subscribeDeliveryRequestEvents=new WeakSet;var _checkRequestStatus=new WeakSet;var _updateCheckRequestStatus=new WeakSet;var _getDeliveryRequest=new WeakSet;var _getDeliveryServiceIds=new WeakSet;var _getShipmentIds=new WeakSet;let Delivery=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_getShipmentIds);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_getDeliveryServiceIds);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_getDeliveryRequest);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_updateCheckRequestStatus);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_checkRequestStatus);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_subscribeDeliveryRequestEvents);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_subscribeDeliveryServiceEvents);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_subscribeShipmentEvents);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_subscribePullEvents);_classPrivateMethodInitSpec$g(babelHelpers.assertThisInitialized(i),_makeCall$1);_classPrivateFieldInitSpec$b(babelHelpers.assertThisInitialized(i),_needCheckRequestStatus,{writable:true,value:null});_classPrivateFieldInitSpec$b(babelHelpers.assertThisInitialized(i),_checkRequestStatusTimeout,{writable:true,value:null});_classPrivateFieldInitSpec$b(babelHelpers.assertThisInitialized(i),_isPullSubscribed,{writable:true,value:false});return i}babelHelpers.createClass(e,[{key:"onInitialize",value:function t(e){_classPrivateMethodGet$g(this,_updateCheckRequestStatus,_updateCheckRequestStatus2).call(this,e);_classPrivateMethodGet$g(this,_subscribePullEvents,_subscribePullEvents2).call(this,e)}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Delivery:MakeCall"&&s){_classPrivateMethodGet$g(this,_makeCall$1,_makeCall2$1).call(this,s)}}},{key:"onAfterItemRefreshLayout",value:function t(e){_classPrivateMethodGet$g(this,_updateCheckRequestStatus,_updateCheckRequestStatus2).call(this,e)}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Delivery"}}]);return e}(Base);function _makeCall2$1(t){if(!main_core.Type.isStringFilled(t.phoneNumber)||!main_core.Type.isBoolean(t.canUserPerformCalls)){return}if(!main_core.Type.isUndefined(window.top["BXIM"])&&t.canUserPerformCalls!==false){window.top["BXIM"].phoneTo(t.phoneNumber)}else{window.open("tel:"+t.phoneNumber,"_self")}}function _subscribePullEvents2(t){if(babelHelpers.classPrivateFieldGet(this,_isPullSubscribed)){return}_classPrivateMethodGet$g(this,_subscribeShipmentEvents,_subscribeShipmentEvents2).call(this,t);_classPrivateMethodGet$g(this,_subscribeDeliveryServiceEvents,_subscribeDeliveryServiceEvents2).call(this,t);_classPrivateMethodGet$g(this,_subscribeDeliveryRequestEvents,_subscribeDeliveryRequestEvents2).call(this,t);babelHelpers.classPrivateFieldSet(this,_isPullSubscribed,true)}function _subscribeShipmentEvents2(t){const e=_classPrivateMethodGet$g(this,_getShipmentIds,_getShipmentIds2).call(this,t);pull_client.PULL.subscribe({moduleId:"crm",command:"onOrderShipmentSave",callback:i=>{if(e.some((t=>t==i.FIELDS.ID))){t.reloadFromServer()}}});pull_client.PULL.extendWatch("CRM_ENTITY_ORDER_SHIPMENT")}function _subscribeDeliveryServiceEvents2(t){const e=_classPrivateMethodGet$g(this,_getDeliveryServiceIds,_getDeliveryServiceIds2).call(this,t);pull_client.PULL.subscribe({moduleId:"sale",command:"onDeliveryServiceSave",callback:i=>{if(e.some((t=>t==i.ID))){t.reloadFromServer()}}});pull_client.PULL.extendWatch("SALE_DELIVERY_SERVICE")}function _subscribeDeliveryRequestEvents2(t){const e=_classPrivateMethodGet$g(this,_getDeliveryRequest,_getDeliveryRequest2).call(this,t);pull_client.PULL.subscribe({moduleId:"sale",command:"onDeliveryRequestUpdate",callback:i=>{if(e&&e.id==i.ID){t.reloadFromServer()}}});pull_client.PULL.subscribe({moduleId:"sale",command:"onDeliveryRequestDelete",callback:i=>{if(e&&e.id==i.ID){t.reloadFromServer()}}});pull_client.PULL.extendWatch("SALE_DELIVERY_REQUEST")}function _checkRequestStatus2(){main_core.ajax.runAction("crm.timeline.deliveryactivity.checkrequeststatus")}function _updateCheckRequestStatus2(t){const e=_classPrivateMethodGet$g(this,_getDeliveryRequest,_getDeliveryRequest2).call(this,t);const i=e&&e.isProcessed===false;if(i&&!babelHelpers.classPrivateFieldGet(this,_needCheckRequestStatus)){clearTimeout(babelHelpers.classPrivateFieldGet(this,_checkRequestStatusTimeout));babelHelpers.classPrivateFieldSet(this,_checkRequestStatusTimeout,setInterval((()=>_classPrivateMethodGet$g(this,_checkRequestStatus,_checkRequestStatus2).call(this)),30*1e3))}else if(!i&&babelHelpers.classPrivateFieldGet(this,_needCheckRequestStatus)){clearTimeout(babelHelpers.classPrivateFieldGet(this,_checkRequestStatusTimeout))}babelHelpers.classPrivateFieldSet(this,_needCheckRequestStatus,i)}function _getDeliveryRequest2(t){const e=t.getDataPayload();if(!main_core.Type.isObject(e.deliveryRequest)){return null}return e.deliveryRequest}function _getDeliveryServiceIds2(t){const e=t.getDataPayload();if(!main_core.Type.isArray(e.deliveryServiceIds)){return[]}return e.deliveryServiceIds}function _getShipmentIds2(t){const e=t.getDataPayload();if(!main_core.Type.isArray(e.shipmentIds)){return[]}return e.shipmentIds}function _classPrivateMethodInitSpec$h(t,e){_checkPrivateRedeclaration$k(t,e);e.add(t)}function _checkPrivateRedeclaration$k(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$h(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openRestAppSlider=new WeakSet;let RestApp=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$h(babelHelpers.assertThisInitialized(i),_openRestAppSlider);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(!ActionType.isJsEvent(a)){return}if(n==="Activity:ConfigurableRestApp:OpenApp"){_classPrivateMethodGet$h(this,_openRestAppSlider,_openRestAppSlider2).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:ConfigurableRestApp"}}]);return e}(Base);function _openRestAppSlider2(t){const e={...t};const i=e.restAppId;delete e.restAppId;if(BX.rest&&BX.rest.AppLayout){if(main_core.Type.isStringFilled(e.bx24_label)){e.bx24_label=JSON.parse(e.bx24_label)}BX.rest.AppLayout.openApplication(i,e)}}function _classPrivateMethodInitSpec$i(t,e){_checkPrivateRedeclaration$l(t,e);e.add(t)}function _checkPrivateRedeclaration$l(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$i(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _showEditor=new WeakSet;var _onCommentDelete=new WeakSet;var _isValidParams=new WeakSet;let Comment=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$i(babelHelpers.assertThisInitialized(i),_isValidParams);_classPrivateMethodInitSpec$i(babelHelpers.assertThisInitialized(i),_onCommentDelete);_classPrivateMethodInitSpec$i(babelHelpers.assertThisInitialized(i),_showEditor);return i}babelHelpers.createClass(e,[{key:"getDeleteActionMethod",value:function t(){return"crm.timeline.comment.delete"}},{key:"getDeleteActionCfg",value:function t(e,i,n){return{data:{id:e,ownerTypeId:i,ownerId:n}}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"){return}if(n==="Comment:Edit"||n==="Comment:AddFile"){_classPrivateMethodGet$i(this,_showEditor,_showEditor2).call(this,e)}if(n==="Comment:Delete"&&s){_classPrivateMethodGet$i(this,_onCommentDelete,_onCommentDelete2).call(this,s,o)}if(n==="Comment:StartEdit"){e.highlightContentBlockById("commentContentWeb",true)}if(n==="Comment:FinishEdit"){e.highlightContentBlockById("commentContentWeb",false)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Comment"}}]);return e}(Base);function _showEditor2(t){const e=t.getLayoutContentBlockById("commentContentWeb");if(e){e.startEditing()}else{throw new Error('Vue component "CommentContent" was not found')}}function _onCommentDelete2(t,e){if(!_classPrivateMethodGet$i(this,_isValidParams,_isValidParams2).call(this,t)){return}const i=main_core.Type.isStringFilled(t.confirmationText)?t.confirmationText:"";if(i){ui_dialogs_messagebox.MessageBox.show({message:i,modal:true,buttons:ui_dialogs_messagebox.MessageBoxButtons.YES_NO,onYes:()=>this.runDeleteAction(t.commentId,t.ownerTypeId,t.ownerId,e),onNo:t=>{t.close()}})}else{this.runDeleteAction(t.commentId,t.ownerTypeId,t.ownerId)}}function _isValidParams2(t){return main_core.Type.isNumber(t.commentId)&&main_core.Type.isNumber(t.ownerId)&&main_core.Type.isNumber(t.ownerTypeId)}let _$2=t=>t,_t$2,_t2$1,_t3;var SharingSlotsList={data(){return{popup:null,moreLinkRef:null}},props:{listItems:{type:Array,required:true,default:[]}},mounted(){const t=this.$el.querySelector('[data-anchor="more-link"]');if(!t){return}this.moreLinkRef=t;main_core.Event.bind(this.moreLinkRef,"click",(()=>this.openPopup()));main_core.Dom.append(main_core.Tag.render(_t$2||(_t$2=_$2`<i/>`)),this.moreLinkRef)},computed:{items(){return this.listItems.map((t=>t.properties))},formattedRules(){return this.items.map((t=>this.createItemText(t)))},firstFormattedRule(){var t;if(this.doShowMoreLink){return main_core.Loc.getMessage("CRM_TIMELINE_ITEM_CALENDAR_SHARING_SLOTS_RANGE_WITH_MORE",{"#RANGE#":this.formattedRules[0],"#MORE_LINK_CLASS#":"crm-timeline-calendar-sharing-slots-more","#AMOUNT#":this.items.length-1})}return(t=this.formattedRules[0])!==null&&t!==void 0?t:""},formattedDuration(){return main_core.Loc.getMessage("CRM_TIMELINE_ITEM_CALENDAR_SHARING_SLOTS_DURATION",{"#DURATION#":this.items[0].durationFormatted})},doShowMoreLink(){return this.items.length>1}},methods:{createItemText(t){return main_core.Loc.getMessage("CRM_TIMELINE_ITEM_CALENDAR_SHARING_SLOTS_RANGE_V3",{"#WEEKDAYS#":main_core.Text.encode(t.weekdaysFormatted),"#FROM_TIME#":this.formatMinutes(t.rule.from),"#TO_TIME#":this.formatMinutes(t.rule.to)})},formatMinutes(t){const e=new Date(calendar_util.Util.parseDate("01.01.2000").getTime()+t*60*1e3);return calendar_util.Util.formatTime(e)},openPopup(){var t;if(!this.moreLinkRef||(t=this.popup)!==null&&t!==void 0&&t.isShown()){return}this.popup=new main_popup.Popup(this.getPopupOptions());this.popup.show()},getPopupOptions(){return{content:this.getPopupContent(),autoHide:true,cacheable:false,animation:"fading-slide",bindElement:this.moreLinkRef,closeByEsc:true}},getPopupContent(){const t=main_core.Tag.render(_t2$1||(_t2$1=_$2`<div></div>`));this.formattedRules.forEach((e=>{main_core.Dom.append(main_core.Tag.render(_t3||(_t3=_$2`<div class="crm-timeline-calendar-sharing-slots-more-popup-item">${0}</div>`),e),t)}));return t}},template:`\n\t\t<div class="crm-timeline-calendar-sharing-slots">\n\t\t\t<div class="crm-timeline-calendar-sharing-slots-block" v-html="firstFormattedRule"/>\n\t\t\t<div class="crm-timeline-calendar-sharing-slots-block">\n\t\t\t\t{{formattedDuration}}\n\t\t\t</div>\n\t\t</div>\n\t`};let _$3=t=>t,_t$3;function _classPrivateMethodInitSpec$j(t,e){_checkPrivateRedeclaration$m(t,e);e.add(t)}function _checkPrivateRedeclaration$m(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$j(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openCalendarEvent=new WeakSet;var _startVideoconference=new WeakSet;var _openMembersPopup=new WeakSet;var _renderMemberMenuItem=new WeakSet;let Sharing=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$j(babelHelpers.assertThisInitialized(i),_renderMemberMenuItem);_classPrivateMethodInitSpec$j(babelHelpers.assertThisInitialized(i),_openMembersPopup);_classPrivateMethodInitSpec$j(babelHelpers.assertThisInitialized(i),_startVideoconference);_classPrivateMethodInitSpec$j(babelHelpers.assertThisInitialized(i),_openCalendarEvent);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="CalendarSharingInvitationSent:ShowMembers"||n==="Activity:CalendarSharing:ShowMembers"){_classPrivateMethodGet$j(this,_openMembersPopup,_openMembersPopup2).call(this,e,Object.values(s.members))}if(n==="Activity:CalendarSharing:OpenCalendarEvent"){_classPrivateMethodGet$j(this,_openCalendarEvent,_openCalendarEvent2).call(this,e,s)}if(n==="Activity:CalendarSharing:StartVideoconference"){_classPrivateMethodGet$j(this,_startVideoconference,_startVideoconference2).call(this,e,s)}if(n==="CalendarSharingLinkCopied:OpenPublicPageInNewTab"){window.open(s.url)}if(n==="CalendarSharingInvitationSent:ShowQr"){const t=new calendar_sharing_interface.DialogQr({sharingUrl:s.url,context:"crm"});t.show()}if(n==="Activity:CalendarSharing:CopyLink"){const t=BX.clipboard.copy(s.url);if(t){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_LINK_IS_COPIED_SHORT"),autoHideDelay:5e3})}}}},{key:"getContentBlockComponents",value:function t(e){return{SharingSlotsList:SharingSlotsList}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="CalendarSharingInvitationSent"||e.getType()==="CalendarSharing"||e.getType()==="Activity:CalendarSharing"||e.getType()==="CalendarSharingLinkCopied"}}]);return e}(Base);function _openCalendarEvent2(t,e){return crm_router.Router.Instance.openCalendarEventSlider(e.eventId,e.isSharing)}async function _startVideoconference2(t,e){let i=null;try{i=await main_core.ajax.runAction("crm.timeline.calendar.sharing.getConferenceChatId",{data:{eventId:e.eventId,ownerId:e.ownerId,ownerTypeId:e.ownerTypeId}})}catch(t){console.error(t);return}const n=i.data.chatId;if(top.window.BXIM&&n){top.window.BXIM.openMessenger(`chat${parseInt(n,10)}`)}}function _openMembersPopup2(t,e){const i=t.getContainer().querySelector('[data-id="sharing_member_more_button"]');if(!i){return}const n=main_popup.PopupManager.getPopupById(`sharing_members_popup_${t.getId()}`);if(n){return}const a=main_popup.MenuManager.create({id:`sharing_members_popup_${t.getId()}`,bindElement:i,cacheable:false,className:"crm-timeline-sharing-members-popup",maxHeight:500,maxWidth:300,animation:"fading-slide",closeByEsc:true,items:e.map((t=>({html:_classPrivateMethodGet$j(this,_renderMemberMenuItem,_renderMemberMenuItem2).call(this,t),onclick:()=>a.close()})))});a.show()}function _renderMemberMenuItem2(t){const{root:e,icon:i}=main_core.Tag.render(_t$3||(_t$3=_$3`
			<a class="crm-timeline-sharing-members-popup-item" href="${0}" target="_blank">
				<div class="ui-icon ui-icon-common-user crm-timeline-sharing-members-popup-item-image">
					<i ref="icon"></i>
				</div>
				<span class="crm-timeline-sharing-members-popup-item-title">
					${0}
				</span>
			</a>
		`),t.SHOW_URL,main_core.Text.encode(t.FORMATTED_NAME));if(main_core.Type.isStringFilled(t.PHOTO_URL)){main_core.Dom.style(i,"background-image",`url('${encodeURI(main_core.Text.encode(t.PHOTO_URL))}')`)}return e}let Task=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){var n;const{action:a,actionType:s,actionData:o,animationCallbacks:r}=i;if(!o){return}const l=(n=o.taskId)!==null&&n!==void 0?n:null;if(!l){return}if(s!=="jsEvent"){return}switch(a){case"Task:Ping":this.ping(o);break;case"Task:ChangeDeadline":this.changeDeadline(e,o);break;case"Task:View":this.view(o);break;case"Task:Edit":this.edit(o);break;case"Task:Delete":this.delete(o);break;case"Task:ResultView":this.viewResult(o);break}}},{key:"ping",value:function t(e){if(!e.taskId){return}main_core.ajax.runAction("tasks.task.ping",{data:{taskId:e.taskId}}).then((t=>{if(t.status==="success"){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_TASK_PING_SENT"),autoHideDelay:3e3})}}))}},{key:"changeDeadline",value:function t(e,i){if(!i.taskId||!i.value){return}main_core.ajax.runAction("tasks.task.update",{data:{taskId:i.taskId,fields:{DEADLINE:new Date(i.valueTs*1e3).toISOString()},params:{skipTimeZoneOffset:"DEADLINE"}}}).catch((t=>{var i;const n=(i=t.errors)!==null&&i!==void 0?i:null;if(n.length>0){ui_notification.UI.Notification.Center.notify({content:n[0].message,autoHideDelay:3e3});e.forceRefreshLayout()}}))}},{key:"view",value:function t(e){if(!e.path){return}BX.SidePanel.Instance.open(e.path,{cacheable:false})}},{key:"edit",value:function t(e){if(!e.path){return}BX.SidePanel.Instance.open(e.path,{cacheable:false})}},{key:"delete",value:function t(e){if(!e.taskId){return}const i=new ui_dialogs_messagebox.MessageBox({message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_TASK_CONFIRM_DELETE"),buttons:BX.UI.Dialogs.MessageBoxButtons.YES_NO,onYes:()=>{main_core.ajax.runAction("tasks.task.delete",{data:{taskId:e.taskId}}).then((()=>{i.close()})).catch((t=>{var e;ui_notification.UI.Notification.Center.notify({content:(e=t.errors[0].message)!==null&&e!==void 0?e:"Error",autoHideDelay:3e3});i.close()}))},onNo:()=>{i.close()}});i.show()}},{key:"viewResult",value:function t(e){if(!e.taskId){return}if(!e.path){return}main_core.ajax.runAction("tasks.task.result.getLast",{data:{taskId:e.taskId}}).then((t=>{if(t.status==="success"){const i=t.data.result;BX.SidePanel.Instance.open(e.path+"?RID="+i,{cacheable:false})}}))}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:TasksTask"||e.getType()==="TasksTaskCreation"||e.getType()==="TasksTaskModification"||e.getType()==="Activity:TasksTaskComment"}}]);return e}(Base);function _classPrivateMethodInitSpec$k(t,e){_checkPrivateRedeclaration$n(t,e);e.add(t)}function _checkPrivateRedeclaration$n(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$k(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _open=new WeakSet;let TranscriptResult=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$k(babelHelpers.assertThisInitialized(i),_open);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="TranscriptResult:Open"&&s){_classPrivateMethodGet$k(this,_open,_open2).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="AI:Call:TranscriptResult"}}]);return e}(Base);function _open2(t){if(!main_core.Type.isInteger(t.activityId)||!main_core.Type.isInteger(t.ownerTypeId)||!main_core.Type.isInteger(t.ownerId)){return}const e=new crm_ai_call.Call.Transcription({activityId:t.activityId,ownerTypeId:t.ownerTypeId,ownerId:t.ownerId,languageTitle:t.languageTitle});e.open()}function _classPrivateMethodInitSpec$l(t,e){_checkPrivateRedeclaration$o(t,e);e.add(t)}function _checkPrivateRedeclaration$o(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$l(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _open$1=new WeakSet;let TranscriptSummaryResult=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$l(babelHelpers.assertThisInitialized(i),_open$1);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="TranscriptSummaryResult:Open"&&s){_classPrivateMethodGet$l(this,_open$1,_open2$1).call(this,s)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="AI:Call:TranscriptSummaryResult"}}]);return e}(Base);function _open2$1(t){if(!main_core.Type.isInteger(t.activityId)||!main_core.Type.isInteger(t.ownerTypeId)||!main_core.Type.isInteger(t.ownerId)){return}const e=new crm_ai_call.Call.Summary({activityId:t.activityId,ownerTypeId:t.ownerTypeId,ownerId:t.ownerId,languageTitle:t.languageTitle});e.open()}function _classPrivateMethodInitSpec$m(t,e){_checkPrivateRedeclaration$p(t,e);e.add(t)}function _checkPrivateRedeclaration$p(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$m(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _openAiFormFillAction=new WeakSet;var _openAiFormFill=new WeakSet;var _openAiDoneSlider=new WeakSet;var _fetchOperationStatus=new WeakSet;var _openSendFeedbackPopup=new WeakSet;let EntityFieldsFillingResult=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$m(babelHelpers.assertThisInitialized(i),_openSendFeedbackPopup);_classPrivateMethodInitSpec$m(babelHelpers.assertThisInitialized(i),_fetchOperationStatus);_classPrivateMethodInitSpec$m(babelHelpers.assertThisInitialized(i),_openAiDoneSlider);_classPrivateMethodInitSpec$m(babelHelpers.assertThisInitialized(i),_openAiFormFill);_classPrivateMethodInitSpec$m(babelHelpers.assertThisInitialized(i),_openAiFormFillAction);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:async function t(e,i){const{action:n,actionType:a,actionData:s,animationCallbacks:o}=i;if(a!=="jsEvent"||!s){return}switch(n){case"EntityFieldsFillingResult:OpenAiFormFill":_classPrivateMethodGet$m(this,_openAiFormFillAction,_openAiFormFillAction2).call(this,s);break;case"EntityFieldsFillingResult:OpenSendFeedbackPopup":_classPrivateMethodGet$m(this,_openSendFeedbackPopup,_openSendFeedbackPopup2).call(this,s,o);break;default:}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="AI:Call:EntityFieldsFillingResult"}}]);return e}(Base);async function _openAiFormFillAction2(t){const e=await _classPrivateMethodGet$m(this,_fetchOperationStatus,_fetchOperationStatus2).call(this,t.mergeUuid);switch(e){case"APPLIED":_classPrivateMethodGet$m(this,_openAiDoneSlider,_openAiDoneSlider2).call(this);break;case"CONFLICT":_classPrivateMethodGet$m(this,_openAiFormFill,_openAiFormFill2).call(this,t);break;default:throw new Error(`Invalid operation status: ${e}`)}}function _openAiFormFill2(t){const e=parseInt(t.mergeUuid,10);if(!main_core.Type.isInteger(e)||e<=0){return}top.BX.Runtime.loadExtension("crm.ai.form-fill").then((i=>{const{createAiFormFillApplicationInsideSlider:n}=i;n({...t,mergeUuid:e})})).catch((()=>{throw new Error("Cant load createAiFormFillApplicationInsideSlider extension")}))}function _openAiDoneSlider2(){top.BX.Runtime.loadExtension("crm.ai.done").then((t=>{const{Done:e}=t;(new e).start()})).catch((()=>{throw new Error("Cant load crm.ai.done extension")}))}async function _fetchOperationStatus2(t){var e;const i=await main_core.ajax.runAction("crm.timeline.ai.fieldsFillingStatus",{data:{mergeId:t}});if(i.status!=="success"){return null}return i===null||i===void 0?void 0:(e=i.data)===null||e===void 0?void 0:e.operationStatus}function _openSendFeedbackPopup2(t,e){var i;const n=parseInt(t.mergeUuid,10);if(!main_core.Type.isInteger(n)||n<=0){return}const a=main_core.Text.toInteger(t.activityId)>0?main_core.Text.toInteger(t.activityId):0;e===null||e===void 0?void 0:(i=e.onStart)===null||i===void 0?void 0:i.call(e);main_core.Runtime.loadExtension("crm.ai.feedback").then((e=>{const{showSendFeedbackPopup:i}=e;i(n,t.ownerTypeId,a,t.activityDirection)})).catch((()=>{console.error("Cant load showSendFeedbackPopup extension")})).finally((()=>{var t;return e===null||e===void 0?void 0:(t=e.onStop)===null||t===void 0?void 0:t.call(e)}))}function _classPrivateMethodInitSpec$n(t,e){_checkPrivateRedeclaration$q(t,e);e.add(t)}function _checkPrivateRedeclaration$q(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$n(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _open$2=new WeakSet;var _editPrompt=new WeakSet;let CallScoringResult=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$n(babelHelpers.assertThisInitialized(i),_editPrompt);_classPrivateMethodInitSpec$n(babelHelpers.assertThisInitialized(i),_open$2);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="CallScoringResult:Open"&&s){_classPrivateMethodGet$n(this,_open$2,_open2$2).call(this,s)}if(n==="CallScoringResult:EditPrompt"){_classPrivateMethodGet$n(this,_editPrompt,_editPrompt2).call(this,e,s)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="AI:Call:CallScoringResult"}}]);return e}(Base);function _open2$2(t){var e,i,n,a,s;if(!main_core.Type.isInteger(t.activityId)||!main_core.Type.isInteger(t.ownerTypeId)||!main_core.Type.isInteger(t.ownerId)){return}const o=new crm_ai_call.Call.CallQuality({activityId:t.activityId,activityCreated:(e=t.activityCreated)!==null&&e!==void 0?e:null,ownerTypeId:t.ownerTypeId,ownerId:t.ownerId,clientDetailUrl:(i=t.clientDetailUrl)!==null&&i!==void 0?i:null,clientFullName:(n=t.clientFullName)!==null&&n!==void 0?n:null,userPhotoUrl:(a=t.userPhotoUrl)!==null&&a!==void 0?a:null,jobId:(s=t.jobId)!==null&&s!==void 0?s:null});o.open()}function _editPrompt2(t,e){if(!main_core.Type.isInteger(e.assessmentSettingId)){return}crm_router.Router.openSlider(`/crm/copilot-call-assessment/details/${e.assessmentSettingId}/`,{width:700,cacheable:false})}function _classPrivateMethodInitSpec$o(t,e){_checkPrivateRedeclaration$r(t,e);e.add(t)}function _checkPrivateRedeclaration$r(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$o(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _changePlayerState$1=new WeakSet;let Visit=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$o(babelHelpers.assertThisInitialized(i),_changePlayerState$1);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Activity:Visit:ChangePlayerState"&&s&&s.recordId){_classPrivateMethodGet$o(this,_changePlayerState$1,_changePlayerState2$1).call(this,e,s.recordId)}if(n==="Activity:Visit:Schedule"&&s){this.runScheduleAction(s.activityId,s.scheduleDate)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Visit"}}]);return e}(Base);function _changePlayerState2$1(t,e){const i=t.getLayoutContentBlockById("audio");if(!i){return}if(e!==i.id){return}if(i.state==="play"){i.pause()}else{i.play()}}function _classPrivateMethodInitSpec$p(t,e){_checkPrivateRedeclaration$s(t,e);e.add(t)}function _checkPrivateRedeclaration$s(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$p(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}const DOWNLOAD_DELAY=300;var _copyToClipboard=new WeakSet;var _downloadAllRecords=new WeakSet;let Zoom=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$p(babelHelpers.assertThisInitialized(i),_downloadAllRecords);_classPrivateMethodInitSpec$p(babelHelpers.assertThisInitialized(i),_copyToClipboard);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"||!s){return}if(n==="Activity:Zoom:CopyInviteUrl"){_classPrivateMethodGet$p(this,_copyToClipboard,_copyToClipboard2).call(this,s.url)}if(n==="Activity:Zoom:Schedule"){this.runScheduleAction(s.activityId,s.scheduleDate)}if(n==="Activity:Zoom:CopyPassword"){_classPrivateMethodGet$p(this,_copyToClipboard,_copyToClipboard2).call(this,s.password)}if(n==="Activity:Zoom:DownloadAllRecords"&&main_core.Type.isArray(s.urlList)){_classPrivateMethodGet$p(this,_downloadAllRecords,_downloadAllRecords2).call(this,s.urlList)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Zoom"}}]);return e}(Base);function _copyToClipboard2(t){if(main_core.Type.isStringFilled(t)){const e=BX.clipboard.copy(t);if(e){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_COMMON_ACTION_COPY_TO_CLIPBOARD_SUCCESS"),autoHideDelay:2e3})}}}function _downloadAllRecords2(t){const e=t=>{const e=t.pop();const n=document.createElement("a");n.setAttribute("href",e);if("download"in n){n.setAttribute("download",`zoom_record_file_${main_core.Text.getRandom(5)}.m4a`)}n.setAttribute("target","_blank");n.click();if(t.length===0){clearInterval(i)}};const i=setInterval(e,DOWNLOAD_DELAY,t)}function _classPrivateMethodInitSpec$q(t,e){_checkPrivateRedeclaration$t(t,e);e.add(t)}function _checkPrivateRedeclaration$t(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$q(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _resendSms=new WeakSet;let Sms=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$q(babelHelpers.assertThisInitialized(i),_resendSms);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Activity:Sms:Resend"&&main_core.Type.isPlainObject(s.params)){_classPrivateMethodGet$q(this,_resendSms,_resendSms2).call(this,s.params)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Sms"}}]);return e}(Base);function _resendSms2(t){var e,i,n;const a=(e=BX.Crm)===null||e===void 0?void 0:(i=e.Timeline)===null||i===void 0?void 0:(n=i.MenuBar)===null||n===void 0?void 0:n.getDefault();if(!a){throw new Error('"BX.Crm?.Timeline.MenuBar" component not found')}const s=a.getItemById("sms");if(!s){throw new Error('"BX.Crm.Timeline.MenuBar.Sms" component not found')}const o=()=>{a.scrollIntoView();a.setActiveItemById("sms");s.tryToResend(t.senderId,t.from,t.client,t.text)};const{text:r,templateId:l}=s.getSendData();if(main_core.Type.isStringFilled(r)||l!==null){ui_dialogs_messagebox.MessageBox.show({modal:true,title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_SMS_RESEND_CONFIRM_DIALOG_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_SMS_RESEND_CONFIRM_DIALOG_MESSAGE"),buttons:ui_dialogs_messagebox.MessageBoxButtons.OK_CANCEL,okCaption:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_SMS_RESEND_CONFIRM_DIALOG_OK_BTN"),onOk:t=>{t.close();o()},onCancel:t=>t.close()})}else{o()}}function _classPrivateMethodInitSpec$r(t,e){_checkPrivateRedeclaration$u(t,e);e.add(t)}function _checkPrivateRedeclaration$u(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$r(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _resendWhatsApp=new WeakSet;let WhatsApp=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$r(babelHelpers.assertThisInitialized(i),_resendWhatsApp);return i}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Activity:Whatsapp:Resend"&&main_core.Type.isPlainObject(s.params)){_classPrivateMethodGet$r(this,_resendWhatsApp,_resendWhatsApp2).call(this,s.params)}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Whatsapp"}}]);return e}(Base);function _resendWhatsApp2(t){var e,i,n,a,s,o,r,l,c;const d=(e=BX.Crm)===null||e===void 0?void 0:(i=e.Timeline)===null||i===void 0?void 0:(n=i.MenuBar)===null||n===void 0?void 0:n.getDefault();if(!d){throw new Error('"BX.Crm?.Timeline.MenuBar" component not found')}const u=d.getItemById("whatsapp");if(!u){throw new Error('"BX.Crm.Timeline.MenuBar.WhatsApp" component not found')}const p=()=>{d.scrollIntoView();d.setActiveItemById("whatsapp");u.tryToResend(t.template,t.from,t.client)};const m=(a=t.template)===null||a===void 0?void 0:a.ORIGINAL_ID;const h=(s=(o=t.template)===null||o===void 0?void 0:o.FILLED_PLACEHOLDERS)!==null&&s!==void 0?s:[];const _=(r=u.getTemplate())===null||r===void 0?void 0:r.ORIGINAL_ID;const v=(l=(c=u.getTemplate())===null||c===void 0?void 0:c.FILLED_PLACEHOLDERS)!==null&&l!==void 0?l:[];if(main_core.Type.isNumber(m)&&m>0&&main_core.Type.isNumber(_)&&_>0&&(m!==_||JSON.stringify(h)!==JSON.stringify(v))){ui_dialogs_messagebox.MessageBox.show({modal:true,title:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_WHATSAPP_RESEND_CONFIRM_DIALOG_TITLE"),message:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_WHATSAPP_RESEND_CONFIRM_DIALOG_MESSAGE"),buttons:ui_dialogs_messagebox.MessageBoxButtons.OK_CANCEL,okCaption:main_core.Loc.getMessage("CRM_TIMELINE_ITEM_ACTIVITY_SMS_RESEND_CONFIRM_DIALOG_OK_BTN"),onOk:t=>{t.close();p()},onCancel:t=>t.close()})}else{p()}}const ICON_COLORS=Object.freeze({lightGrey:"var(--crm-timeline-avatars-stack-steps-icon-color-light-gray)",blue:"var(--crm-timeline-avatars-stack-steps-icon-color-blue)",lightGreen:"var(--crm-timeline-avatars-stack-steps-icon-color-light-green)"});var AvatarsStackSteps={props:{steps:{type:Array,required:true,validator:t=>main_core.Type.isArrayFilled(t)},styles:{type:Object,required:false}},data(){return{stack:null}},mounted(){if(this.$refs.controlWrapper){this.stack=new ui_imageStackSteps.ImageStackSteps({steps:this.convertIconColors(this.steps)});this.stack.renderTo(this.$refs.controlWrapper)}},updated(){if(this.stack){this.convertIconColors(this.steps).forEach((t=>{this.stack.updateStep(t,t.id)}))}},unmounted(){if(this.stack){this.stack.destroy()}},computed:{getStyles(){var t;const e={};if((t=this.styles)!==null&&t!==void 0&&t.minWidth){e["min-width"]=`${main_core.Text.toInteger(this.styles.minWidth)}px`}return e}},methods:{convertIconColors(t){const e=Object.keys(ICON_COLORS);t.forEach((t=>{const i=t.stack.images;if(main_core.Type.isArrayFilled(i)){i.forEach((t=>{if(t.type===ui_imageStackSteps.imageTypeEnum.ICON){var i;const n=(i=t.data)===null||i===void 0?void 0:i.color;if(e.includes(n)){t.data.color=ICON_COLORS[n]}}}))}}));return t}},template:`\n\t\t<div class="crm-timeline__avatars-stack-steps" ref="controlWrapper" :style="getStyles"></div>\n\t`};const TaskUserStatus=Object.freeze({WAITING:0,YES:1,NO:2,OK:3,CANCEL:4});function _classPrivateMethodInitSpec$s(t,e){_checkPrivateRedeclaration$v(t,e);e.add(t)}function _checkPrivateRedeclaration$v(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet$s(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var _handleTaskAction=new WeakSet;var _openWorkflowLogSlider=new WeakSet;var _openWorkflowSlider=new WeakSet;var _openWorkflowTaskSlider=new WeakSet;var _openSlider=new WeakSet;var _openTimeline=new WeakSet;var _terminateWorkflow=new WeakSet;var _doTask=new WeakSet;let Bizproc=function(t){babelHelpers.inherits(e,t);function e(...t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,...t));_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_doTask);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_terminateWorkflow);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_openTimeline);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_openSlider);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_openWorkflowTaskSlider);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_openWorkflowSlider);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_openWorkflowLogSlider);_classPrivateMethodInitSpec$s(babelHelpers.assertThisInitialized(i),_handleTaskAction);return i}babelHelpers.createClass(e,[{key:"getContentBlockComponents",value:function t(e){return{AvatarsStackSteps:AvatarsStackSteps}}},{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}const o={"Bizproc:Task:Open":()=>_classPrivateMethodGet$s(this,_openWorkflowTaskSlider,_openWorkflowTaskSlider2).call(this,s),"Bizproc:Task:Do":()=>_classPrivateMethodGet$s(this,_handleTaskAction,_handleTaskAction2).call(this,s,e),"Bizproc:Workflow:Timeline:Open":()=>_classPrivateMethodGet$s(this,_openTimeline,_openTimeline2).call(this,s),"Bizproc:Workflow:Open":()=>_classPrivateMethodGet$s(this,_openWorkflowSlider,_openWorkflowSlider2).call(this,s),"Bizproc:Workflow:Terminate":()=>_classPrivateMethodGet$s(this,_terminateWorkflow,_terminateWorkflow2).call(this,s),"Bizproc:Workflow:Log":()=>_classPrivateMethodGet$s(this,_openWorkflowLogSlider,_openWorkflowLogSlider2).call(this,s)};const r=o[n];if(r){r()}}},{key:"onAfterItemLayout",value:function t(e,i){main_core_events.EventEmitter.emit("BX.Crm.Timeline.Items.Bizproc:onAfterItemLayout",{target:e.getWrapper(),id:e.getId(),type:e.getType(),options:i})}}],[{key:"isItemSupported",value:function t(e){const i=["BizprocWorkflowStarted","BizprocWorkflowCompleted","BizprocWorkflowTerminated","BizprocTaskCreation","BizprocTaskCompleted","BizprocCommentAdded","BizprocCommentRead","BizprocTaskDelegated","Activity:BizprocWorkflowCompleted","Activity:BizprocCommentAdded","Activity:BizprocTask"];return i.includes(e.getType())}}]);return e}(Base);function _handleTaskAction2(t,e){var i;const n=main_core.Text.toInteger(t===null||t===void 0?void 0:t.responsibleId);if(n>0&&main_core.Text.toInteger((i=e.getCurrentUser())===null||i===void 0?void 0:i.userId)===n){_classPrivateMethodGet$s(this,_doTask,_doTask2).call(this,t,e)}ui_notification.UI.Notification.Center.notify({content:main_core.Text.encode(main_core.Loc.getMessage("CRM_TIMELINE_ITEM_BIZPROC_TASK_DO_ACTION_ACCESS_DENIED")),autoHideDelay:5e3})}function _openWorkflowLogSlider2(t){_classPrivateMethodGet$s(this,_openSlider,_openSlider2).call(this,t,((t,{workflowId:e})=>{if(t&&e){t.openWorkflowLog(e)}}))}function _openWorkflowSlider2(t){_classPrivateMethodGet$s(this,_openSlider,_openSlider2).call(this,t,((t,{workflowId:e})=>{if(t&&e){t.openWorkflow(e)}}))}function _openWorkflowTaskSlider2(t){_classPrivateMethodGet$s(this,_openSlider,_openSlider2).call(this,t,((t,{taskId:e,userId:i})=>{if(t&&e){t.openWorkflowTask(main_core.Text.toInteger(e),main_core.Text.toInteger(i))}}))}async function _openSlider2(t,e){if(!t){return}try{const{Router:i}=await main_core.Runtime.loadExtension("bizproc.router");e(i,t)}catch(t){console.error(t)}}function _openTimeline2(t){const e=t===null||t===void 0?void 0:t.workflowId;if(!e){return}main_core.Runtime.loadExtension("bizproc.workflow.timeline").then((()=>{BX.Bizproc.Workflow.Timeline.open({workflowId:e})})).catch((t=>console.error(t.errors)))}function _terminateWorkflow2(t){const e=t===null||t===void 0?void 0:t.workflowId;if(!e){return}main_core.ajax.runAction("bizproc.workflow.terminate",{data:{workflowId:e}}).catch((t=>{t.errors.forEach((t=>{ui_notification.UI.Notification.Center.notify({content:t.message,autoHideDelay:5e3})}))}))}function _doTask2(t,e){const i=t===null||t===void 0?void 0:t.taskId;if(!i){return}const n=t===null||t===void 0?void 0:t.value;const a=t===null||t===void 0?void 0:t.name;if(main_core.Type.isStringFilled(a)&&main_core.Type.isStringFilled(n)){const t=Object.values(TaskUserStatus).map((t=>e.getLayoutFooterButtonById(`status_${t}`))).filter((t=>t));t.forEach((t=>{t.setButtonState(ButtonState.DISABLED)}));const s={taskId:i,taskRequest:{[a]:n}};main_core.ajax.runAction("bizproc.task.do",{data:s}).then((()=>{})).catch((e=>{e.errors.forEach((t=>{ui_notification.UI.Notification.Center.notify({content:main_core.Text.encode(t.message),autoHideDelay:5e3})}));t.forEach((t=>{t.setButtonState(ButtonState.DEFAULT)}))}))}}let Booking=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onItemAction",value:function t(e,i){const{action:n,actionType:a,actionData:s}=i;if(a!=="jsEvent"){return}if(n==="Activity:Booking:ShowBooking"){const t=`/booking/?editingBookingId=${s.id}`;BX.SidePanel.Instance.open(t,{customLeftBoundary:0})}}}],[{key:"isItemSupported",value:function t(e){return e.getType()==="Activity:Booking"}}]);return e}(Base);ControllerManager.registerController(Activity);ControllerManager.registerController(CommonContentBlocks);ControllerManager.registerController(OpenLines);ControllerManager.registerController(Modification);ControllerManager.registerController(SignDocument);ControllerManager.registerController(Document);ControllerManager.registerController(Call);ControllerManager.registerController(ToDo);ControllerManager.registerController(Helpdesk);ControllerManager.registerController(Payment);ControllerManager.registerController(DealProductList);ControllerManager.registerController(Email);ControllerManager.registerController(OrderCheck);ControllerManager.registerController(FinalSummary);ControllerManager.registerController(SalescenterApp);ControllerManager.registerController(Delivery);ControllerManager.registerController(RestApp);ControllerManager.registerController(Comment);ControllerManager.registerController(Sharing);ControllerManager.registerController(Task);ControllerManager.registerController(TranscriptResult);ControllerManager.registerController(TranscriptSummaryResult);ControllerManager.registerController(EntityFieldsFillingResult);ControllerManager.registerController(CallScoringResult);ControllerManager.registerController(SignB2eDocument);ControllerManager.registerController(Visit);ControllerManager.registerController(Zoom);ControllerManager.registerController(Sms);ControllerManager.registerController(WhatsApp);ControllerManager.registerController(Bizproc);ControllerManager.registerController(Booking);exports.Item=Item$1;exports.ConfigurableItem=ConfigurableItem;exports.StreamType=StreamType;exports.ControllerManager=ControllerManager;exports.BaseController=Base})(this.BX.Crm.Timeline=this.BX.Crm.Timeline||{},BX,BX.UI.Analytics,BX.Crm.Field,BX.Vue3.Directives,BX.UI,BX.UI,BX.Location.Core,BX,BX.Crm.Timeline.Editors,BX.UI.TextEditor,BX.UI.BBCode.Formatter,BX.Vue3,BX.UI.Icons.Generator,BX.Crm,BX.UI.IconSet,BX,BX.Crm.Field,BX.Currency,BX.UI,BX.UI,BX.UI,BX.Crm.Field,BX.Bizproc,BX.Messenger.v2.Lib,BX.Main,BX.Crm.Timeline,BX.UI,BX.AI,BX.UI,BX.UI.Feedback,BX.Crm.Activity,BX.UI.EntitySelector,BX,BX.Crm,BX,BX.Calendar,BX.Main,BX.Calendar.Sharing,BX.Crm.AI,BX.Crm,BX,BX.UI.Dialogs,BX.Event,BX,BX,BX.UI,BX,BX,BX.Crm.Timeline);
//# sourceMappingURL=index.bundle.map.js