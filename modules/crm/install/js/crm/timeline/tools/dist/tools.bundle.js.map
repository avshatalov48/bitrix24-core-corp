{"version":3,"file":"tools.bundle.js","sources":["../src/datetime-converter.js"],"sourcesContent":["import { DateTimeFormat, Timezone } from 'main.date';\n\ndeclare type DateTimeFormatOptions = {\n\twithDayOfWeek: Boolean,\n\tdelimiter: string\n};\n\nexport default class DatetimeConverter\n{\n\t#timeFormat: string;\n\t#shortDateFormat: string;\n\t#fullDateFormat: string;\n\t#datetime: ?Date = null; // date object which absolute time will be the same as if it was in server timezone\n\n\t/**\n\t * @param timestamp Normal UTC timestamp, as it should be\n\t */\n\tstatic createFromServerTimestamp(timestamp: Number): DatetimeConverter\n\t{\n\t\tconst offset = BX.Main.Timezone.Offset.SERVER_TO_UTC + BX.Main.Timezone.Offset.BROWSER_TO_UTC;\n\n\t\t// make a date object which absolute time will match time of server (even though it has different timezone)\n\t\tconst date = new Date((timestamp + offset) * 1000);\n\n\t\treturn new DatetimeConverter(date);\n\t}\n\n\tconstructor(datetime: Date)\n\t{\n\t\tthis.#timeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\tthis.#shortDateFormat = DateTimeFormat.getFormat('DAY_SHORT_MONTH_FORMAT');\n\t\tthis.#fullDateFormat = DateTimeFormat.getFormat('MEDIUM_DATE_FORMAT');\n\n\t\tthis.#datetime = datetime;\n\t}\n\tgetValue(): Date\n\t{\n\t\treturn this.#datetime;\n\t}\n\n\ttoUserTime(): DatetimeConverter\n\t{\n\t\tconst timestampServer = Math.floor(this.#datetime.getTime() / 1000);\n\n\t\t// make a date object which absolute time will match time of user (even though it has different timezone)\n\t\tthis.#datetime = new Date((timestampServer + Timezone.Offset.USER_TO_SERVER) * 1000);\n\n\t\treturn this;\n\t}\n\n\ttoDatetimeString(options: DateTimeFormatOptions): string\n\t{\n\t\toptions = options || {};\n\n\t\tconst now = new Date();\n\t\tconst withDayOfWeek = !!options.withDayOfWeek;\n\t\tconst delimiter = options.delimiter || ' ';\n\n\t\treturn DateTimeFormat.format(\n\t\t\t[\n\t\t\t\t[ 'today', 'today' + delimiter + this.#timeFormat ],\n\t\t\t\t[ 'tommorow', 'tommorow' + delimiter + this.#timeFormat ],\n\t\t\t\t[ 'yesterday', 'yesterday' + delimiter + this.#timeFormat ],\n\t\t\t\t[\n\t\t\t\t\t'',\n\t\t\t\t\t(withDayOfWeek ? 'D'+ delimiter : '')\n\t\t\t\t\t+ (this.#datetime.getFullYear() === now.getFullYear() ? this.#shortDateFormat :  this.#fullDateFormat)\n\t\t\t\t\t+ delimiter\n\t\t\t\t\t+ this.#timeFormat\n\t\t\t\t]\n\t\t\t],\n\t\t\tthis.#datetime,\n\t\t\tnow\n\t\t).replaceAll('\\\\', '');\n\t}\n\n\ttoTimeString(now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(this.#timeFormat, this.#datetime, now, utc).replaceAll('\\\\', '');\n\t}\n\n\ttoDateString(): string\n\t{\n\t\treturn (\n\t\t\tDateTimeFormat.format(\n\t\t\t\t[\n\t\t\t\t\t['today', 'today'],\n\t\t\t\t\t['tommorow', 'tommorow'],\n\t\t\t\t\t['yesterday', 'yesterday'],\n\t\t\t\t\t['', (this.#datetime.getFullYear() === (Timezone.UserTime.getDate()).getFullYear() ?  this.#shortDateFormat :  this.#fullDateFormat)]\n\t\t\t\t],\n\t\t\t\tthis.#datetime\n\t\t\t).replaceAll('\\\\', '')\n\t\t);\n\t}\n\n\ttoFormatString(format: string, now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(format, this.#datetime, now, utc).replaceAll('\\\\', '');\n\t}\n\n\tstatic getSiteDateFormat(): string\n\t{\n\t\treturn DateTimeFormat.getFormat('FORMAT_DATE');\n\t}\n\n\tstatic getSiteDateTimeFormat(): string\n\t{\n\t\treturn DateTimeFormat.getFormat('FORMAT_DATETIME');\n\t}\n}\n"],"names":["DatetimeConverter","timestamp","offset","BX","Main","Timezone","Offset","SERVER_TO_UTC","BROWSER_TO_UTC","date","Date","datetime","DateTimeFormat","getFormat","timestampServer","Math","floor","getTime","USER_TO_SERVER","options","now","withDayOfWeek","delimiter","format","getFullYear","replaceAll","utc","UserTime","getDate"],"mappings":"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"}