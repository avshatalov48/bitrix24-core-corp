{"version":3,"file":"tools.bundle.js","sources":["../src/datetime-converter.js"],"sourcesContent":["import { DateTimeFormat, Timezone } from 'main.date';\n\ndeclare type DateTimeFormatOptions = {\n\twithDayOfWeek?: Boolean,\n\twithFullMonth?: Boolean,\n\tdelimiter?: string,\n};\n\ndeclare type DateFormatOptions = {\n\twithFullMonth?: Boolean,\n};\n\nexport default class DatetimeConverter\n{\n\t#timeFormat: string;\n\t#dateFormat: string;\n\t#shortDateFormat: string;\n\t#longDateFormat: string;\n\t#mediumDateFormat: string;\n\t#datetime: ?Date = null; // date object which absolute time will be the same as if it was in server timezone\n\n\t/**\n\t * @param timestamp Normal UTC timestamp, as it should be\n\t */\n\tstatic createFromServerTimestamp(timestamp: Number): DatetimeConverter\n\t{\n\t\treturn new DatetimeConverter(Timezone.ServerTime.getDate(timestamp));\n\t}\n\n\tconstructor(datetime: Date)\n\t{\n\t\tthis.#timeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\tthis.#dateFormat = DateTimeFormat.getFormat('DAY_MONTH_FORMAT');\n\t\tthis.#shortDateFormat = DateTimeFormat.getFormat('DAY_SHORT_MONTH_FORMAT');\n\t\tthis.#longDateFormat = DateTimeFormat.getFormat('LONG_DATE_FORMAT');\n\t\tthis.#mediumDateFormat = DateTimeFormat.getFormat('MEDIUM_DATE_FORMAT');\n\n\t\tthis.#datetime = datetime;\n\t}\n\n\tgetValue(): Date\n\t{\n\t\treturn this.#datetime;\n\t}\n\n\ttoUserTime(): DatetimeConverter\n\t{\n\t\tthis.#datetime = Timezone.ServerTime.toUserDate(this.#datetime);\n\n\t\treturn this;\n\t}\n\n\ttoDatetimeString(options: DateTimeFormatOptions = {}): string\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\toptions = options || {};\n\n\t\tconst now = new Date();\n\t\tconst withDayOfWeek = Boolean(options.withDayOfWeek);\n\t\tconst withFullMonth = Boolean(options.withFullMonth ?? true);\n\t\tconst delimiter = options.delimiter || ' ';\n\n\t\tconst showYear = this.#isShowYear();\n\n\t\treturn DateTimeFormat.format(\n\t\t\t[\n\t\t\t\t['today', `today${delimiter}${this.#timeFormat}`],\n\t\t\t\t['tommorow', `tommorow${delimiter}${this.#timeFormat}`],\n\t\t\t\t['yesterday', `yesterday${delimiter}${this.#timeFormat}`],\n\t\t\t\t[\n\t\t\t\t\t'',\n\t\t\t\t\t(withDayOfWeek ? `D${delimiter}` : '')\n\t\t\t\t\t+ this.#getDateFormat(withFullMonth, showYear)\n\t\t\t\t\t+ delimiter\n\t\t\t\t\t+ this.#timeFormat,\n\t\t\t\t],\n\t\t\t],\n\t\t\tthis.#datetime,\n\t\t\tnow,\n\t\t).replaceAll('\\\\', '');\n\t}\n\n\t#getDateFormat(withFullMonth: boolean = false, withYear: boolean = false): string\n\t{\n\t\tif (withYear)\n\t\t{\n\t\t\treturn withFullMonth ? this.#longDateFormat : this.#mediumDateFormat;\n\t\t}\n\n\t\treturn withFullMonth ? this.#dateFormat : this.#shortDateFormat;\n\t}\n\n\ttoTimeString(now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(this.#timeFormat, this.#datetime, now, utc).replaceAll('\\\\', '');\n\t}\n\n\ttoDateString(options: DateFormatOptions = {}): string\n\t{\n\t\tconst withFullMonth = Boolean(options.withFullMonth ?? true);\n\t\tconst showYear = this.#isShowYear();\n\n\t\treturn (\n\t\t\tDateTimeFormat.format(\n\t\t\t\t[\n\t\t\t\t\t['today', 'today'],\n\t\t\t\t\t['tommorow', 'tommorow'],\n\t\t\t\t\t['yesterday', 'yesterday'],\n\t\t\t\t\t['', this.#getDateFormat(withFullMonth, showYear)],\n\t\t\t\t],\n\t\t\t\tthis.#datetime,\n\t\t\t).replaceAll('\\\\', '')\n\t\t);\n\t}\n\n\t#isShowYear(): boolean\n\t{\n\t\treturn this.#datetime.getFullYear() !== (Timezone.UserTime.getDate()).getFullYear();\n\t}\n\n\ttoFormatString(format: string, now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(format, this.#datetime, now, utc).replaceAll('\\\\', '');\n\t}\n\n\tstatic getSiteDateFormat(): string\n\t{\n\t\treturn DateTimeFormat.getFormat('FORMAT_DATE');\n\t}\n\n\tstatic getSiteDateTimeFormat(): string\n\t{\n\t\treturn DateTimeFormat.getFormat('FORMAT_DATETIME');\n\t}\n}\n"],"names":["DatetimeConverter","timestamp","Timezone","ServerTime","getDate","datetime","DateTimeFormat","getFormat","toUserDate","options","now","Date","withDayOfWeek","Boolean","withFullMonth","delimiter","showYear","format","replaceAll","utc","withYear","getFullYear","UserTime"],"mappings":"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"}