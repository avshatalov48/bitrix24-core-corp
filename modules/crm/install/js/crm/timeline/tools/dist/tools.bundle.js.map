{"version":3,"file":"tools.bundle.js","sources":["../src/datetime-converter.js"],"sourcesContent":["import { Loc } from \"main.core\";\nimport { DateTimeFormat } from \"main.date\";\nimport { TimestampConverter, Factory } from \"crm.datetime\";\n\ndeclare type DateTimeFormatOptions = {\n\twithDayOfWeek: Boolean,\n\tdelimiter: string\n};\n\nexport default class DatetimeConverter\n{\n\t#timeFormat: string;\n\t#shortDateFormat: string;\n\t#fullDateFormat: string;\n\t#datetime: ?Date = null;\n\n\t/**\n\t * @param timestamp Timestamp in server timezone\n\t */\n\tstatic createFromServerTimestamp(timestamp: Number): DatetimeConverter\n\t{\n\t\tconst date = Factory.createFromTimestampInServerTimezone(timestamp);\n\n\t\treturn new DatetimeConverter(date);\n\t}\n\n\tconstructor(datetime: Date)\n\t{\n\t\tthis.#timeFormat = Loc.getMessage('CRM_TIMELINE_TIME_FORMAT');\n\t\tthis.#shortDateFormat = Loc.getMessage('CRM_TIMELINE_SHORT_DATE_FORMAT');\n\t\tthis.#fullDateFormat = Loc.getMessage('CRM_TIMELINE_FULL_DATE_FORMAT');\n\n\t\tthis.#datetime = datetime;\n\t}\n\tgetValue(): Date\n\t{\n\t\treturn this.#datetime;\n\t}\n\n\ttoUserTime(): DatetimeConverter\n\t{\n\t\tconst serverTimestamp = Math.floor(this.#datetime.getTime() / 1000);\n\t\tthis.#datetime = new Date(TimestampConverter.serverToUser(serverTimestamp) * 1000);\n\n\t\treturn this;\n\t}\n\n\ttoDatetimeString(options: DateTimeFormatOptions): string\n\t{\n\t\toptions = options || {};\n\n\t\tconst now = new Date();\n\t\tconst withDayOfWeek = !!options.withDayOfWeek;\n\t\tconst delimiter = options.delimiter || ' ';\n\n\t\treturn DateTimeFormat.format(\n\t\t\t[\n\t\t\t\t[ 'today', 'today' + delimiter + this.#timeFormat ],\n\t\t\t\t[ 'tommorow', 'tommorow' + delimiter + this.#timeFormat ],\n\t\t\t\t[ 'yesterday', 'yesterday' + delimiter + this.#timeFormat ],\n\t\t\t\t[\n\t\t\t\t\t'',\n\t\t\t\t\t(withDayOfWeek ? 'D'+ delimiter : '')\n\t\t\t\t\t+ (this.#datetime.getFullYear() === now.getFullYear() ? this.#shortDateFormat :  this.#fullDateFormat)\n\t\t\t\t\t+ delimiter\n\t\t\t\t\t+ this.#timeFormat\n\t\t\t\t]\n\t\t\t],\n\t\t\tthis.#datetime,\n\t\t\tnow\n\t\t);\n\t}\n\n\ttoTimeString(now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(this.#timeFormat, this.#datetime, now, utc);\n\t}\n\n\ttoDateString(): string\n\t{\n\t\treturn (\n\t\t\tDateTimeFormat.format(\n\t\t\t\t[\n\t\t\t\t\t['today', 'today'],\n\t\t\t\t\t['tommorow', 'tommorow'],\n\t\t\t\t\t['yesterday', 'yesterday'],\n\t\t\t\t\t['', (this.#datetime.getFullYear() === (Factory.getUserNow()).getFullYear() ?  this.#shortDateFormat :  this.#fullDateFormat)]\n\t\t\t\t],\n\t\t\t\tthis.#datetime\n\t\t\t)\n\t\t);\n\t}\n\n\ttoFormatString(format: string, now: Date, utc: boolean): string\n\t{\n\t\treturn DateTimeFormat.format(format, this.#datetime, now, utc);\n\t}\n\n\tstatic getSiteDateFormat(): string\n\t{\n\t\treturn DateTimeFormat.convertBitrixFormat(Loc.getMessage('FORMAT_DATE'));\n\t}\n\n\tstatic getSiteDateTimeFormat(): string\n\t{\n\t\treturn DateTimeFormat.convertBitrixFormat(Loc.getMessage('FORMAT_DATETIME'));\n\t}\n}\n"],"names":["DatetimeConverter","timestamp","date","Factory","createFromTimestampInServerTimezone","datetime","Loc","getMessage","serverTimestamp","Math","floor","getTime","Date","TimestampConverter","serverToUser","options","now","withDayOfWeek","delimiter","DateTimeFormat","format","getFullYear","utc","getUserNow","convertBitrixFormat"],"mappings":";;;;;;;;;;;;;;;;;KASqBA;;;;;CAQrB;CACA;+CACkCC,WACjC;OACC,MAAMC,IAAI,GAAGC,oBAAO,CAACC,mCAAR,CAA4CH,SAA5C,CAAb;OAEA,OAAO,IAAID,iBAAJ,CAAsBE,IAAtB,CAAP;;;;GAGD,2BAAYG,QAAZ,EACA;KAAA;;KAAA;OAAA;OAAA;;;KAAA;OAAA;OAAA;;;KAAA;OAAA;OAAA;;;KAAA;OAAA;OAAA,OAbmB;;;KAclB,qDAAmBC,aAAG,CAACC,UAAJ,CAAe,0BAAf,CAAnB;KACA,0DAAwBD,aAAG,CAACC,UAAJ,CAAe,gCAAf,CAAxB;KACA,yDAAuBD,aAAG,CAACC,UAAJ,CAAe,+BAAf,CAAvB;KAEA,mDAAiBF,QAAjB;;;;;gCAGD;OACC,yCAAO,IAAP;;;;kCAID;OACC,MAAMG,eAAe,GAAGC,IAAI,CAACC,KAAL,CAAW,mDAAeC,OAAf,KAA2B,IAAtC,CAAxB;OACA,mDAAiB,IAAIC,IAAJ,CAASC,+BAAkB,CAACC,YAAnB,CAAgCN,eAAhC,IAAmD,IAA5D,CAAjB;OAEA,OAAO,IAAP;;;;sCAGgBO,SACjB;OACCA,OAAO,GAAGA,OAAO,IAAI,EAArB;OAEA,MAAMC,GAAG,GAAG,IAAIJ,IAAJ,EAAZ;OACA,MAAMK,aAAa,GAAG,CAAC,CAACF,OAAO,CAACE,aAAhC;OACA,MAAMC,SAAS,GAAGH,OAAO,CAACG,SAAR,IAAqB,GAAvC;OAEA,OAAOC,wBAAc,CAACC,MAAf,CACN,CACC,CAAE,OAAF,EAAW,UAAUF,SAAV,qCAAsB,IAAtB,cAAX,CADD,EAEC,CAAE,UAAF,EAAc,aAAaA,SAAb,qCAAyB,IAAzB,cAAd,CAFD,EAGC,CAAE,WAAF,EAAe,cAAcA,SAAd,qCAA0B,IAA1B,cAAf,CAHD,EAIC,CACC,EADD,EAEC,CAACD,aAAa,GAAG,MAAKC,SAAR,GAAoB,EAAlC,KACG,mDAAeG,WAAf,OAAiCL,GAAG,CAACK,WAAJ,EAAjC,qCAAqD,IAArD,wDAA8E,IAA9E,kBADH,IAEEH,SAFF,qCAGE,IAHF,cAFD,CAJD,CADM,oCAaN,IAbM,cAcNF,GAdM,CAAP;;;;kCAkBYA,KAAWM,KACxB;OACC,OAAOH,wBAAc,CAACC,MAAf,mCAAsB,IAAtB,kDAAwC,IAAxC,cAAwDJ,GAAxD,EAA6DM,GAA7D,CAAP;;;;oCAID;OACC,OACCH,wBAAc,CAACC,MAAf,CACC,CACC,CAAC,OAAD,EAAU,OAAV,CADD,EAEC,CAAC,UAAD,EAAa,UAAb,CAFD,EAGC,CAAC,WAAD,EAAc,WAAd,CAHD,EAIC,CAAC,EAAD,EAAM,mDAAeC,WAAf,OAAkClB,oBAAO,CAACoB,UAAR,EAAD,CAAuBF,WAAvB,EAAjC,qCAAyE,IAAzE,wDAAkG,IAAlG,kBAAN,CAJD,CADD,oCAOC,IAPD,aADD;;;;oCAacD,QAAgBJ,KAAWM,KAC1C;OACC,OAAOH,wBAAc,CAACC,MAAf,CAAsBA,MAAtB,oCAA8B,IAA9B,cAA8CJ,GAA9C,EAAmDM,GAAnD,CAAP;;;;yCAID;OACC,OAAOH,wBAAc,CAACK,mBAAf,CAAmClB,aAAG,CAACC,UAAJ,CAAe,aAAf,CAAnC,CAAP;;;;6CAID;OACC,OAAOY,wBAAc,CAACK,mBAAf,CAAmClB,aAAG,CAACC,UAAJ,CAAe,iBAAf,CAAnC,CAAP;;;;;;;;;;;;"}