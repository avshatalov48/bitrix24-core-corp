this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,s,i,n,a,o,r){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var c=babelHelpers.classPrivateFieldLooseKey("entityId");var d=babelHelpers.classPrivateFieldLooseKey("isReadonly");var h=babelHelpers.classPrivateFieldLooseKey("menuBarContainer");class u{constructor(e){Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,c,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:false});Object.defineProperty(this,h,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e.isReadonly;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.menuBarContainer}getEntityTypeId(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}getEntityId(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}isReadonly(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}getMenuBarContainer(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}}var p=babelHelpers.classPrivateFieldLooseKey("context");var m=babelHelpers.classPrivateFieldLooseKey("settings");var _=babelHelpers.classPrivateFieldLooseKey("eventEmitter");var g=babelHelpers.classPrivateFieldLooseKey("isVisible");var v=babelHelpers.classPrivateFieldLooseKey("container");class b{constructor(){Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,m,{writable:true,value:{}});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,g,{writable:true,value:false});Object.defineProperty(this,v,{writable:true,value:null})}initialize(e,t){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m]=t;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new s.EventEmitter;babelHelpers.classPrivateFieldLooseBase(this,_)[_].setEventNamespace("BX.Crm.Timeline.MenuBar");if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p].isReadonly()&&this.supportsLayout()){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=this.createLayout();r.Dom.prepend(babelHelpers.classPrivateFieldLooseBase(this,v)[v],this.getMenuBarContainer());this.initializeLayout()}}getEntityTypeId(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p].getEntityTypeId()}getEntityId(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p].getEntityId()}getMenuBarContainer(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p].getMenuBarContainer()}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}supportsLayout(){return true}activate(){if(this.supportsLayout()){this.setVisible(true)}else{this.showSlider()}}deactivate(){this.setVisible(false)}showSlider(){throw new Error("Method showSlider() must be overridden")}getSetting(e,t=null){var s;return(s=babelHelpers.classPrivateFieldLooseBase(this,m)[m][e])!=null?s:t}getSettings(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m]}setVisible(e){e=!!e;if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===e){return}babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e;const t=this.getContainer();if(!t){return}if(e){r.Dom.removeClass(t,"--hidden");this.onShow()}else{this.onHide();r.Dom.addClass(t,"--hidden")}}isVisible(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}setFocused(e){const t=this.getContainer();if(!t){return}if(e){r.Dom.addClass(t,"--focus")}else{r.Dom.removeClass(t,"--focus")}}addFinishEditListener(e){babelHelpers.classPrivateFieldLooseBase(this,_)[_].subscribe(b.ON_FINISH_EDIT_EVENT,e)}emitFinishEditEvent(){babelHelpers.classPrivateFieldLooseBase(this,_)[_].emit(b.ON_FINISH_EDIT_EVENT)}createLayout(){throw new Error("Method createLayout() must be overridden")}initializeLayout(){}onShow(){}onHide(){}}b.ON_FINISH_EDIT_EVENT="onFinishEdit";let f=e=>e,y,I,E;var C=babelHelpers.classPrivateFieldLooseKey("toDoEditor");var B=babelHelpers.classPrivateFieldLooseKey("todoEditorContainer");var L=babelHelpers.classPrivateFieldLooseKey("saveButton");var T=babelHelpers.classPrivateFieldLooseKey("createEditor");var S=babelHelpers.classPrivateFieldLooseKey("onChangeDescription");class M extends b{constructor(...e){super(...e);Object.defineProperty(this,S,{value:P});Object.defineProperty(this,T,{value:N});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null})}createLayout(){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=r.Tag.render(y||(y=f`<div></div>`));babelHelpers.classPrivateFieldLooseBase(this,L)[L]=r.Tag.render(I||(I=f`<button onclick="${0}" class="ui-btn ui-btn-xs ui-btn-primary ui-btn-disabled" >${0}</button>`),this.onSaveButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_SAVE_BUTTON"));return r.Tag.render(E||(E=f`<div class="crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-todo --hidden">
			${0}
			<div class="crm-entity-stream-content-new-comment-btn-container">
				${0}
				<span onclick="${0}"  class="ui-btn ui-btn-xs ui-btn-link">${0}</span>
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,B)[B],babelHelpers.classPrivateFieldLooseBase(this,L)[L],this.onCancelButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_CANCEL_BTN"))}initializeLayout(){babelHelpers.classPrivateFieldLooseBase(this,T)[T]()}onSaveButtonClick(e){if(r.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-wait")||r.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")){return}r.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-wait");const t=()=>r.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-wait");this.save().then((()=>t()),(()=>t()))}onCancelButtonClick(){this.cancel();this.emitFinishEditEvent()}save(){if(r.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")){return false}return babelHelpers.classPrivateFieldLooseBase(this,C)[C].save().then((e=>{if(r.Type.isArray(e.errors)&&e.errors.length){return false}this.cancel();this.emitFinishEditEvent();return true}))}cancel(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].clearValue();r.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled");this.setFocused(false)}bindInputHandlers(){}setParentActivityId(e){babelHelpers.classPrivateFieldLooseBase(this,C)[C].setParentActivityId(e)}setDeadLine(e){babelHelpers.classPrivateFieldLooseBase(this,C)[C].setDeadline(e)}focus(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].setFocused()}}function N(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=new t.TodoEditor({container:babelHelpers.classPrivateFieldLooseBase(this,B)[B],defaultDescription:"",ownerTypeId:this.getEntityTypeId(),ownerId:this.getEntityId(),currentUser:this.getSetting("currentUser"),events:{onFocus:this.setFocused.bind(this,true),onChangeDescription:babelHelpers.classPrivateFieldLooseBase(this,S)[S].bind(this)},enableCalendarSync:this.getSetting("enableTodoCalendarSync",false)});babelHelpers.classPrivateFieldLooseBase(this,C)[C].show()}function P(e){let{description:t}=e.getData();t=t.trim();if(!t.length&&!r.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")){r.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")}else if(t.length&&r.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")){r.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"ui-btn-disabled")}}class F extends b{initializeLayout(){this._ownerTypeId=this.getEntityTypeId();this._ownerId=this.getEntityId();this._ghostInput=null;this._saveButtonHandler=BX.delegate(this.onSaveButtonClick,this);this._cancelButtonHandler=BX.delegate(this.onCancelButtonClick,this);this._focusHandler=BX.delegate(this.onFocus,this);this._blurHandler=BX.delegate(this.onBlur,this);this._keyupHandler=BX.delegate(this.resizeForm,this);this._delayedKeyupHandler=BX.delegate((function(){setTimeout(this.resizeForm.bind(this),0)}),this);this._hideButtonsOnBlur=true;this.bindInputHandlers();this.doInitialize()}doInitialize(){}bindInputHandlers(){BX.bind(this._input,"focus",this._focusHandler);BX.bind(this._input,"blur",this._blurHandler);BX.bind(this._input,"keyup",this._keyupHandler);BX.bind(this._input,"cut",this._delayedKeyupHandler);BX.bind(this._input,"paste",this._delayedKeyupHandler)}onFocus(e){this.setFocused(true)}onBlur(e){if(!this._hideButtonsOnBlur){return}if(this._input.value===""){window.setTimeout(BX.delegate((function(){this.setFocused(false);this._input.style.minHeight=""}),this),200)}}onSaveButtonClick(e){r.Dom.addClass(this._saveButton,"ui-btn-wait");const t=()=>r.Dom.removeClass(this._saveButton,"ui-btn-wait");const s=this.save();if(s instanceof BX.Promise||s instanceof Promise){s.then((()=>t()),(()=>t()))}else{t()}}onCancelButtonClick(){this.cancel();this.emitFinishEditEvent()}save(){}cancel(){}release(){if(this._ghostInput){this._ghostInput=BX.remove(this._ghostInput)}}ensureGhostCreated(){if(this._ghostInput){return this._ghostInput}this._ghostInput=BX.create("div",{props:{className:"crm-entity-stream-content-new-comment-textarea-shadow"},text:this._input.value});this._ghostInput.style.width=this._input.offsetWidth+"px";document.body.appendChild(this._ghostInput);return this._ghostInput}resizeForm(){const e=this.ensureGhostCreated();const t=getComputedStyle(this._input);const s=parseInt(t.paddingBottom)+parseInt(t.paddingTop)+parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth)||0;e.innerHTML=BX.util.htmlspecialchars(this._input.value.replace(/[\r\n]{1}/g,"<br>"));this._input.style.minHeight=e.scrollHeight+s+"px"}}let D=e=>e,w,A,H,X;class k extends F{createLayout(){this._saveButton=r.Tag.render(w||(w=D`<button onclick="${0}" class="ui-btn ui-btn-xs ui-btn-primary" >${0}</button>`),this.onSaveButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_SEND"));this._cancelButton=r.Tag.render(A||(A=D`<span onclick="${0}"  class="ui-btn ui-btn-xs ui-btn-link">${0}</span>`),this.onCancelButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_CANCEL_BTN"));this._input=r.Tag.render(H||(H=D`<textarea  rows="1" class="crm-entity-stream-content-new-comment-textarea" placeholder="${0}"></textarea>`),r.Loc.getMessage("CRM_TIMELINE_COMMENT_PLACEHOLDER"));return r.Tag.render(X||(X=D`<div class="crm-entity-stream-content-new-detail --hidden">
					${0}
					<div class="crm-entity-stream-content-new-comment-btn-container">
						${0}
						${0}
					</div>
				</div>`),this._input,this._saveButton,this._cancelButton)}doInitialize(){this._postForm=null;this._editor=null;this._isRequestRunning=false;this._isLocked=false;BX.unbind(this._input,"blur",this._blurHandler);BX.unbind(this._input,"keyup",this._keyupHandler)}loadEditor(){this._editorName="CrmTimeLineComment0";if(this._postForm)return;BX.ajax.runAction("crm.api.timeline.loadEditor",{data:{name:this._editorName}}).then(this.onLoadEditorSuccess.bind(this))}onLoadEditorSuccess(e){const t=BX.prop.getString(BX.prop.getObject(e,"data",{}),"html","");BX.html(this._editorContainer,t).then(BX.delegate(this.showEditor,this)).then(BX.delegate(this.addEvents,this))}addEvents(){BX.addCustomEvent(this._editorContainer.firstElementChild,"onFileIsAppended",BX.delegate((function(e,t){BX.addClass(this._saveButton,"ui-btn-disabled");BX.addClass(this._saveButton,"ui-btn-clock");this._saveButton.removeEventListener("click",this._saveButtonHandler)}),this));BX.addCustomEvent(this._editorContainer.firstElementChild,"onFileIsAdded",BX.delegate((function(e,t,s,i){BX.removeClass(this._saveButton,"ui-btn-clock");BX.removeClass(this._saveButton,"ui-btn-disabled");this._saveButton.addEventListener("click",this._saveButtonHandler)}),this))}showEditor(){if(LHEPostForm){window.setTimeout(BX.delegate((function(){this._postForm=LHEPostForm.getHandler(this._editorName);this._editor=BXHtmlEditor.Get(this._editorName);BX.onCustomEvent(this._postForm.eventNode,"OnShowLHE",[true])}),this),100)}}onFocus(e){this._input.style.display="none";if(this._editor&&this._postForm){this._postForm.eventNode.style.display="block";this._editor.Focus()}else{if(!BX.type.isDomNode(this._editorContainer)){this._editorContainer=BX.create("div",{attrs:{className:"crm-entity-stream-section-comment-editor"}});this._editorContainer.appendChild(BX.create("DIV",{attrs:{className:"crm-timeline-wait"}}));this.getContainer().appendChild(this._editorContainer)}window.setTimeout(BX.delegate((function(){this.loadEditor()}),this),100)}this.setFocused(true)}save(){let e="";const t=[];if(this._postForm){e=this._postForm.oEditor.GetContent();this._postForm.eventNode.querySelectorAll('input[name="UF_CRM_COMMENT_FILES[]"]').forEach((function(e){t.push(e.value)}))}else{e=this._input.value}if(e===""){if(!this.emptyCommentMessage){this.emptyCommentMessage=new BX.PopupWindow("timeline_empty_new_comment_"+this.getEntityId(),this._saveButton,{content:BX.message("CRM_TIMELINE_EMPTY_COMMENT_MESSAGE"),darkMode:true,autoHide:true,zIndex:990,angle:{position:"top",offset:77},closeByEsc:true,bindOptions:{forceBindPosition:true}})}this.emptyCommentMessage.show();return}if(this._isRequestRunning||this._isLocked){return}this._isRequestRunning=this._isLocked=true;return r.ajax.runAction("crm.timeline.comment.add",{data:{fields:{ENTITY_ID:this.getEntityId(),ENTITY_TYPE_ID:this.getEntityTypeId(),COMMENT:e,ATTACHMENTS:t}}}).then((e=>{this.onSaveSuccess();return e})).catch((e=>{this.onSaveFailure();return e}))}cancel(){this._input.value="";this._input.style.minHeight="";if(BX.type.isDomNode(this._editorContainer))this._postForm.eventNode.style.display="none";this._input.style.display="block";this.setFocused(false);this.release()}onSaveSuccess(e){this._isRequestRunning=false;this._isLocked=false;this.release();if(this._postForm){this._postForm.reinit("",{})}this.emitFinishEditEvent();this.cancel()}onSaveFailure(){this._isRequestRunning=this._isLocked=false}}let R=e=>e,O,x,U,W,$,G,j,K,q,z,Y,V,Z;var J=babelHelpers.classPrivateFieldLooseKey("renderEditor");var Q=babelHelpers.classPrivateFieldLooseKey("renderSetupText");var ee=babelHelpers.classPrivateFieldLooseKey("renderTemplatesContainer");var te=babelHelpers.classPrivateFieldLooseKey("renderFilesSelector");var se=babelHelpers.classPrivateFieldLooseKey("subscribeToReceiversChanges");class ie extends F{constructor(...e){super(...e);Object.defineProperty(this,se,{value:le});Object.defineProperty(this,te,{value:re});Object.defineProperty(this,ee,{value:oe});Object.defineProperty(this,Q,{value:ae});Object.defineProperty(this,J,{value:ne})}createLayout(){const e=this.getSetting("canSendMessage",false);return r.Tag.render(O||(O=R`<div class="crm-entity-stream-content-new-detail --focus --hidden">
			${0}
		</div>`),e?babelHelpers.classPrivateFieldLooseBase(this,J)[J]():babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]())}doInitialize(){this._isRequestRunning=false;this._isLocked=false;this._senderId=null;this._from=null;this._commEntityTypeId=null;this._commEntityId=null;this._to=null;this._fromList=[];this._toList=[];this._defaults={};this._communications=[];this._menu=null;this._isMenuShown=false;this._shownMenuId=null;this._documentSelector=null;this._source=null;this._paymentId=null;this._shipmentId=null;this._compilationProductIds=[];this._templateId=null;this._templateFieldHintNode=null;this._templateSelectorNode=null;this._templateTemplateTitleNode=null;this._templatePreviewNode=null;this._templateSelectorMenuId="CrmTimelineSmsEditorTemplateSelector";this._templateFieldHintHandler=BX.delegate(this.onTemplateHintIconClick,this);this._templateSeletorClickHandler=BX.delegate(this.onTemplateSelectClick,this);this._selectTemplateHandler=BX.delegate(this.onSelectTemplate,this);this._serviceUrl=BX.util.remove_url_param(this.getSetting("serviceUrl",""),["sessid","site"]);const e=this.getSetting("smsConfig",{});this._canUse=BX.prop.getBoolean(e,"canUse",false);this._canSendMessage=BX.prop.getBoolean(e,"canSendMessage",false);this._manageUrl=BX.prop.getString(e,"manageUrl","");this._senders=BX.prop.getArray(e,"senders",[]);this._defaults=BX.prop.getObject(e,"defaults",{senderId:null,from:null});this._communications=BX.prop.getArray(e,"communications",[]);this._isSalescenterEnabled=BX.prop.getBoolean(e,"isSalescenterEnabled",false);this._isDocumentsEnabled=BX.prop.getBoolean(e,"isDocumentsEnabled",false);if(this._isDocumentsEnabled){this._documentsProvider=BX.prop.getString(e,"documentsProvider","");this._documentsValue=BX.prop.getString(e,"documentsValue","")}this._isFilesEnabled=BX.prop.getBoolean(e,"isFilesEnabled",false);if(this._isFilesEnabled){this._diskUrls=BX.prop.getObject(e,"diskUrls");this._isFilesExternalLinkEnabled=BX.prop.getBoolean(e,"isFilesExternalLinkEnabled",true)}this._senderSelectorNode=this.getContainer().querySelector('[data-role="sender-selector"]');this._fromContainerNode=this.getContainer().querySelector('[data-role="from-container"]');this._fromSelectorNode=this.getContainer().querySelector('[data-role="from-selector"]');this._clientContainerNode=this.getContainer().querySelector('[data-role="client-container"]');this._clientSelectorNode=this.getContainer().querySelector('[data-role="client-selector"]');this._toSelectorNode=this.getContainer().querySelector('[data-role="to-selector"]');this._messageLengthCounterWrapperNode=this.getContainer().querySelector('[data-role="message-length-counter-wrap"]');this._messageLengthCounterNode=this.getContainer().querySelector('[data-role="message-length-counter"]');this._salescenterStarter=this.getContainer().querySelector('[data-role="salescenter-starter"]');this._smsDetailSwitcher=this.getContainer().querySelector('[data-role="sms-detail-switcher"]');this._smsDetail=this.getContainer().querySelector('[data-role="sms-detail"]');this._documentSelectorButton=this.getContainer().querySelector('[data-role="sms-document-selector"]');this._fileSelectorButton=this.getContainer().querySelector('[data-role="sms-file-selector"]');this._fileUploadZone=this.getContainer().querySelector('[data-role="sms-file-upload-zone"]');this._fileUploadLabel=this.getContainer().querySelector('[data-role="sms-file-upload-label"]');this._fileSelectorBitrix=this.getContainer().querySelector('[data-role="sms-file-selector-bitrix"]');this._fileExternalLinkDisabledContent=this.getContainer().querySelector('[data-role="sms-file-external-link-disabled"]');if(this._templatesContainer){this._templateFieldHintNode=this._templatesContainer.querySelector('[data-role="hint"]');this._templateSelectorNode=this._templatesContainer.querySelector('[data-role="template-selector"]');this._templateTemplateTitleNode=this._templatesContainer.querySelector('[data-role="template-title"]');this._templatePreviewNode=this._templatesContainer.querySelector('[data-role="preview"]')}if(this._templateFieldHintNode){BX.bind(this._templateFieldHintNode,"click",this._templateFieldHintHandler)}if(this._templateSelectorNode){BX.bind(this._templateSelectorNode,"click",this._templateSeletorClickHandler)}if(this._canUse&&this._senders.length>0){this.initSenderSelector()}if(this._canUse&&this._canSendMessage){this.initDetailSwitcher();this.initFromSelector();this.initClientContainer();this.initClientSelector();this.initToSelector();this.initMessageLengthCounter();this.setMessageLengthCounter();if(this._isDocumentsEnabled){this.initDocumentSelector()}if(this._isFilesEnabled){this.initFileSelector()}}babelHelpers.classPrivateFieldLooseBase(this,se)[se]();if(this._isSalescenterEnabled){this.initSalescenterApplication()}}initDetailSwitcher(){BX.bind(this._smsDetailSwitcher,"click",function(){if(this._smsDetail.classList.contains("hidden")){this._smsDetail.classList.remove("hidden");this._smsDetailSwitcher.innerText=BX.message("CRM_TIMELINE_COLLAPSE")}else{this._smsDetail.classList.add("hidden");this._smsDetailSwitcher.innerText=BX.message("CRM_TIMELINE_DETAILS")}}.bind(this))}initSenderSelector(){const e=this._defaults.senderId;let t=this._senders[0].canUse?this._senders[0]:null;let s=null;const i=[];const n=this.onSenderSelectorClick.bind(this);for(let a=0;a<this._senders.length;++a){if(this._senders[a].canUse&&this._senders[a].fromList.length&&(this._senders[a].id===e||!t)){t=this._senders[a]}if(this._senders[a].id==="rest"){s=this._senders[a];continue}i.push({text:this._senders[a].name,sender:this._senders[a],onclick:n,className:!this._senders[a].canUse||!this._senders[a].fromList.length?"crm-timeline-popup-menu-item-disabled menu-popup-no-icon":""})}if(s){if(s.fromList.length>0){i.push({delimiter:true});for(let e=0;e<s.fromList.length;++e){i.push({text:s.fromList[e].name,sender:s,from:s.fromList[e],onclick:n})}}i.push({delimiter:true},{text:BX.message("CRM_TIMELINE_SMS_REST_MARKETPLACE"),href:"/marketplace/category/crm_robot_sms/",target:"_blank"})}if(t){this.setSender(t)}BX.bind(this._senderSelectorNode,"click",this.openMenu.bind(this,"sender",this._senderSelectorNode,i))}onSenderSelectorClick(e,t){if(t.sender){if(!t.sender.canUse||!t.sender.fromList.length){const e=BX.Uri.addParam(t.sender.manageUrl,{IFRAME:"Y"});const s=BX.SidePanel.Instance.getTopSlider();const i={events:{onClose:function(){if(s){s.reload()}},onCloseComplete:function(){if(!s){document.location.reload()}}}};if(t.sender.id==="ednaru"){i.width=700}BX.SidePanel.Instance.open(e,i);return}this.setSender(t.sender,true);const e=t.from?t.from:t.sender.fromList[0];this.setFrom(e,true)}this._menu.close()}setSender(e,t){this._senderId=e.id;this._fromList=e.fromList;this._senderSelectorNode.textContent=e.shortName?e.shortName:e.name;this._templateId=null;if(e.isTemplatesBased){this.showNode(this._templatesContainer);this.hideNode(this._messageLengthCounterWrapperNode);this.hideNode(this._fileSelectorButton);this.hideNode(this._documentSelectorButton);this.hideNode(this._input);this.toggleTemplateSelectAvailability();this.toggleSaveButton();this._hideButtonsOnBlur=false;this.onFocus()}else{this.hideNode(this._templatesContainer);this.showNode(this._messageLengthCounterWrapperNode);this.showNode(this._fileSelectorButton);this.showNode(this._documentSelectorButton);this.showNode(this._input);this.setMessageLengthCounter();this._hideButtonsOnBlur=true}const s=e.id==="rest"?"hide":"show";BX[s](this._fromContainerNode);if(t){BX.userOptions.save("crm","sms_manager_editor","senderId",this._senderId)}}showNode(e){if(e){e.style.display=""}}hideNode(e){if(e){e.style.display="none"}}initFromSelector(){if(this._fromList.length>0){const e=this._defaults.from||this._fromList[0].id;let t=null;for(let s=0;s<this._fromList.length;++s){if(this._fromList[s].id===e||!t){t=this._fromList[s]}}if(t){this.setFrom(t)}}BX.bind(this._fromSelectorNode,"click",this.onFromSelectorClick.bind(this))}onFromSelectorClick(e){const t=[];const s=this.onFromSelectorItemClick.bind(this);for(let e=0;e<this._fromList.length;++e){t.push({text:this._fromList[e].name,from:this._fromList[e],onclick:s})}this.openMenu("from_"+this._senderId,this._fromSelectorNode,t,e)}onFromSelectorItemClick(e,t){if(t.from){this.setFrom(t.from,true)}this._menu.close()}setFrom(e,t){this._from=e.id;if(this._senderId==="rest"){this._senderSelectorNode.textContent=e.name}else{this._fromSelectorNode.textContent=e.name}if(t){BX.userOptions.save("crm","sms_manager_editor","from",this._from)}}initClientContainer(){if(!r.Type.isDomNode(this._clientContainerNode)){return}if(this._communications.length===0){BX.hide(this._clientContainerNode)}else{BX.show(this._clientContainerNode)}}initClientSelector(){const e=this._communications[0];if(e){this.setClient(e)}const t=this.onClientSelectorClick.bind(this);BX.bind(this._clientSelectorNode,"click",(e=>{const s=[];for(const e of this._communications){s.push({text:e.caption,client:e,onclick:t})}this.openMenu("comm",this._clientSelectorNode,s,e)}))}onClientSelectorClick(e,t){if(t.client){this.setClient(t.client)}this._menu.close()}setClient(e){var t,s;this._commEntityTypeId=e==null?void 0:e.entityTypeId;this._commEntityId=e==null?void 0:e.entityId;if(r.Type.isDomNode(this._clientSelectorNode)){var i;this._clientSelectorNode.textContent=(i=e==null?void 0:e.caption)!=null?i:""}this._toList=(t=e==null?void 0:e.phones)!=null?t:[];this.setTo((s=e==null?void 0:e.phones[0])!=null?s:{})}initToSelector(){BX.bind(this._toSelectorNode,"click",this.onToSelectorClick.bind(this))}onToSelectorClick(e){const t=[];const s=this.onToSelectorItemClick.bind(this);for(let e=0;e<this._toList.length;++e){t.push({text:this._toList[e].valueFormatted||this._toList[e].value,to:this._toList[e],onclick:s})}this.openMenu("to_"+this._commEntityTypeId+"_"+this._commEntityId,this._toSelectorNode,t,e)}onToSelectorItemClick(e,t){if(t.to){this.setTo(t.to)}this._menu.close()}setTo(e){this._to=e==null?void 0:e.value;if(r.Type.isDomNode(this._toSelectorNode)){var t;this._toSelectorNode.textContent=(t=(e==null?void 0:e.valueFormatted)||(e==null?void 0:e.value))!=null?t:""}}openMenu(e,t,s,i){if(this._shownMenuId===e){return}if(this._shownMenuId!==null&&this._menu){this._menu.close();this._shownMenuId=null}BX.PopupMenu.show(this._id+e,t,s,{cacheable:false,offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0},events:{onPopupClose:BX.delegate(this.onMenuClose,this)}});this._menu=BX.PopupMenu.currentItem;i.preventDefault()}onMenuClose(){this._shownMenuId=null;this._menu=null}initMessageLengthCounter(){this._messageLengthMax=parseInt(this._messageLengthCounterNode.getAttribute("data-length-max"));BX.bind(this._input,"keyup",this.setMessageLengthCounter.bind(this));BX.bind(this._input,"cut",this.setMessageLengthCounterDelayed.bind(this));BX.bind(this._input,"paste",this.setMessageLengthCounterDelayed.bind(this))}setMessageLengthCounterDelayed(){setTimeout(this.setMessageLengthCounter.bind(this),0)}setMessageLengthCounter(){const e=this._input.value.length;this._messageLengthCounterNode.textContent=e;const t=e>=this._messageLengthMax?"addClass":"removeClass";BX[t](this._messageLengthCounterNode,"crm-entity-stream-content-sms-symbol-counter-number-overhead");this.toggleSaveButton()}toggleSaveButton(){const e=this.getSelectedSender();let t;if(!e||!e.isTemplatesBased){t=this._input.value.length>0}else{t=!!this._templateId}if(t){BX.removeClass(this._saveButton,"ui-btn-disabled")}else{BX.addClass(this._saveButton,"ui-btn-disabled")}}save(){const e=this.getSelectedSender();let t="";let s="";if(!e||!e.isTemplatesBased){t=this._input.value;if(t===""){return}}else{const e=this.getSelectedTemplate();if(!e){return}t=e.PREVIEW;s=e.ID}if(!this._communications.length){alert(BX.message("CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS"));return}if(this._isRequestRunning||this._isLocked){return}this._isRequestRunning=this._isLocked=true;return new Promise(((e,i)=>{BX.ajax({url:BX.util.add_url_param(this._serviceUrl,{action:"save_sms_message",sender:this._senderId}),method:"POST",dataType:"json",data:{site:BX.message("SITE_ID"),sessid:BX.bitrix_sessid(),source:this._source,ACTION:"SAVE_SMS_MESSAGE",SENDER_ID:this._senderId,MESSAGE_FROM:this._from,MESSAGE_TO:this._to,MESSAGE_BODY:t,MESSAGE_TEMPLATE:s,OWNER_TYPE_ID:this._ownerTypeId,OWNER_ID:this._ownerId,TO_ENTITY_TYPE_ID:this._commEntityTypeId,TO_ENTITY_ID:this._commEntityId,PAYMENT_ID:this._paymentId,SHIPMENT_ID:this._shipmentId,COMPILATION_PRODUCT_IDS:this._compilationProductIds},onsuccess:()=>{this.onSaveSuccess();e()},onfailure:()=>{this.onSaveFailure();i()}})}))}cancel(){this._input.value="";this.setMessageLengthCounter();this._input.style.minHeight="";this.release()}onSaveSuccess(e){this._isRequestRunning=this._isLocked=false;const t=BX.prop.getString(e,"ERROR","");if(t!==""){alert(t);return}this._input.value="";this.setMessageLengthCounter();this._input.style.minHeight="";this.emitFinishEditEvent();this.release()}onSaveFailure(){this._isRequestRunning=this._isLocked=false}initSalescenterApplication(){BX.bind(this._salescenterStarter,"click",this.startSalescenterApplication.bind(this))}startSalescenterApplication(){BX.loadExt("salescenter.manager").then(function(){BX.Salescenter.Manager.openApplication({disableSendButton:this._canSendMessage?"":"y",context:"sms",ownerTypeId:this._ownerTypeId,ownerId:this._ownerId,mode:this._ownerTypeId===BX.CrmEntityType.enumeration.deal?"payment_delivery":"payment"}).then(function(e){if(e&&e.get("action")){if(e.get("action")==="sendPage"&&e.get("page")&&e.get("page").url){this._input.focus();this._input.value=this._input.value+e.get("page").name+" "+e.get("page").url;this.setMessageLengthCounter()}else if(e.get("action")==="sendPayment"&&e.get("order")){this._input.focus();this._input.value=this._input.value+e.get("order").title;this.setMessageLengthCounter();this._source="order";this._paymentId=e.get("order").paymentId;this._shipmentId=e.get("order").shipmentId}else if(e.get("action")==="sendCompilation"&&e.get("compilation")){this._input.focus();this._input.value=this._input.value+e.get("compilation").title;this.setMessageLengthCounter();this._source="deal";this._compilationProductIds=e.get("compilation").productIds}}}.bind(this))}.bind(this))}initDocumentSelector(){BX.bind(this._documentSelectorButton,"click",this.onDocumentSelectorClick.bind(this))}onDocumentSelectorClick(){if(!this._documentSelector){BX.loadExt("documentgenerator.selector").then(function(){this._documentSelector=new BX.DocumentGenerator.Selector.Menu({node:this._documentSelectorButton,moduleId:"crm",provider:this._documentsProvider,value:this._documentsValue,analyticsLabelPrefix:"crmTimelineSmsEditor"});this.selectPublicUrl()}.bind(this))}else{this.selectPublicUrl()}}selectPublicUrl(){if(!this._documentSelector){return}this._documentSelector.show().then(function(e){if(e instanceof BX.DocumentGenerator.Selector.Template){this._documentSelector.createDocument(e).then(function(e){this.pasteDocumentUrl(e)}.bind(this)).catch(function(e){console.error(e)}.bind(this))}else if(e instanceof BX.DocumentGenerator.Selector.Document){this.pasteDocumentUrl(e)}}.bind(this)).catch(function(e){console.error(e)}.bind(this))}pasteDocumentUrl(e){this._documentSelector.getDocumentPublicUrl(e).then(function(t){this._input.focus();this._input.value=this._input.value+" "+e.getTitle()+" "+t;this.setMessageLengthCounter();this._source="document"}.bind(this)).catch(function(e){console.error(e)}.bind(this))}initFileSelector(){BX.bind(this._fileSelectorButton,"click",this.onFileSelectorClick.bind(this))}closeFileSelector(){BX.PopupMenu.destroy("sms-file-selector")}onFileSelectorClick(){BX.PopupMenu.show("sms-file-selector",this._fileSelectorButton,[{text:BX.message("CRM_TIMELINE_SMS_UPLOAD_FILE"),onclick:this.uploadFile.bind(this),className:this._isFilesExternalLinkEnabled?"":"crm-entity-stream-content-sms-menu-item-with-lock"},{text:BX.message("CRM_TIMELINE_SMS_FIND_FILE"),onclick:this.findFile.bind(this),className:this._isFilesExternalLinkEnabled?"":"crm-entity-stream-content-sms-menu-item-with-lock"}])}getFileUploadInput(){return document.getElementById(this._fileUploadLabel.getAttribute("for"))}uploadFile(){this.closeFileSelector();if(this._isFilesExternalLinkEnabled){this.initDiskUF();BX.fireEvent(this.getFileUploadInput(),"click")}else{this.showFilesExternalLinkFeaturePopup()}}findFile(){this.closeFileSelector();if(this._isFilesExternalLinkEnabled){this.initDiskUF();BX.fireEvent(this._fileSelectorBitrix,"click")}else{this.showFilesExternalLinkFeaturePopup()}}getLoader(){if(!this.loader){this.loader=new BX.Loader({size:50})}return this.loader}showLoader(e){if(e&&!this.getLoader().isShown()){this.getLoader().show(e)}}hideLoader(){if(this.getLoader().isShown()){this.getLoader().hide()}}initDiskUF(){if(this.isDiskFileUploaderInited||!this._isFilesEnabled){return}this.isDiskFileUploaderInited=true;BX.addCustomEvent(this._fileUploadZone,"OnFileUploadSuccess",this.OnFileUploadSuccess.bind(this));BX.addCustomEvent(this._fileUploadZone,"DiskDLoadFormControllerInit",function(e){e._onUploadProgress=function(){this.showLoader(this._fileSelectorButton.parentNode.parentNode)}.bind(this)}.bind(this));BX.Disk.UF.add({UID:this._fileUploadZone.getAttribute("data-node-id"),controlName:this._fileUploadLabel.getAttribute("for"),hideSelectDialog:false,urlSelect:this._diskUrls.urlSelect,urlRenameFile:this._diskUrls.urlRenameFile,urlDeleteFile:this._diskUrls.urlDeleteFile,urlUpload:this._diskUrls.urlUpload});BX.onCustomEvent(this._fileUploadZone,"DiskLoadFormController",["show"])}OnFileUploadSuccess(e,t,s,i){this.hideLoader();const n=parseInt(e.element_id.replace("n",""));const a=e.element_name;this.pasteFileUrl(n,a)}pasteFileUrl(e,t){this.showLoader(this._fileSelectorButton.parentNode.parentNode);BX.ajax.runAction("disk.file.generateExternalLink",{analyticsLabel:"crmTimelineSmsEditorGetFilePublicUrl",data:{fileId:e}}).then(function(e){this.hideLoader();if(e.data.externalLink&&e.data.externalLink.link){this._input.focus();this._input.value=this._input.value+" "+t+" "+e.data.externalLink.link;this.setMessageLengthCounter();this._source="file"}}.bind(this)).catch((function(e){console.error(e.errors.pop().message)}))}getFeaturePopup(e){if(this.featurePopup!=null){return this.featurePopup}this.featurePopup=new BX.PopupWindow("bx-popup-crm-sms-editor-feature-popup",null,{zIndex:200,autoHide:true,closeByEsc:true,closeIcon:true,overlay:true,events:{onPopupDestroy:function(){this.featurePopup=null}.bind(this)},content:e,contentColor:"white"});return this.featurePopup}showFilesExternalLinkFeaturePopup(){this.getFeaturePopup(this._fileExternalLinkDisabledContent).show()}onTemplateHintIconClick(){if(this._senderId==="ednaru"){top.BX.Helper.show("redirect=detail&code=14214014")}}showTemplateSelectDropdown(e){const t=[];if(BX.Type.isArray(e)){if(e.length){e.forEach(function(e){t.push({value:e.ID,text:e.TITLE,onclick:this._selectTemplateHandler})}.bind(this));BX.PopupMenu.show({id:this._templateSelectorMenuId,bindElement:this._templateSelectorNode,items:t,angle:false,width:this._templateSelectorNode.offsetWidth})}}else if(this._senderId){const e=this._templateSelectorMenuId+"loader";const t=this._templateSelectorMenuId+"loader";BX.PopupMenu.show({id:e,bindElement:this._templateSelectorNode,items:[{html:'<div id="'+t+'"></div>'}],angle:false,width:this._templateSelectorNode.offsetWidth,height:60,events:{onDestroy:function(){this.hideLoader()}.bind(this)}});this.showLoader(BX(t));if(!this._isRequestRunning){this._isRequestRunning=true;const t=this._senderId;BX.ajax.runAction("messageservice.Sender.getTemplates",{data:{id:t,context:{module:"crm",entityTypeId:this.getEntityTypeId(),entityId:this.getEntityId()}}}).then(function(s){this._isRequestRunning=false;const i=this._senders.find(function(e){return e.id===t}.bind(this));if(i){i.templates=s.data.templates;this.toggleTemplateSelectAvailability();if(BX.PopupMenu.getMenuById(e)){BX.PopupMenu.getMenuById(e).close();this.showTemplateSelectDropdown(i.templates)}}}.bind(this)).catch(function(t){this._isRequestRunning=false;if(BX.PopupMenu.getMenuById(e)){if(t&&t.errors&&t.errors[0]&&t.errors[0].message){alert(t.errors[0].message)}BX.PopupMenu.getMenuById(e).close()}}.bind(this))}}}getSelectedSender(){return this._senders.find(function(e){return e.id===this._senderId}.bind(this))}getSelectedTemplate(){const e=this.getSelectedSender();if(!this._templateId||!e||!e.templates){return null}const t=e.templates.find(function(e){return e.ID==this._templateId}.bind(this));return t?t:null}onTemplateSelectClick(){const e=this.getSelectedSender();if(e){this.showTemplateSelectDropdown(e.templates)}}onSelectTemplate(e,t){this._templateId=t.value;this.applySelectedTemplate();this.toggleSaveButton();const s=BX.PopupMenu.getMenuById(this._templateSelectorMenuId);if(s){s.close()}}toggleTemplateSelectAvailability(){const e=this.getSelectedSender();if(e&&BX.Type.isArray(e.templates)&&!e.templates.length){BX.addClass(this._templateSelectorNode,"ui-ctl-disabled");this._templateTemplateTitleNode.textContent=BX.message("CRM_TIMELINE_SMS_TEMPLATES_NOT_FOUND")}else{BX.removeClass(this._templateSelectorNode,"ui-ctl-disabled");this.applySelectedTemplate()}}applySelectedTemplate(){const e=this.getSelectedSender();if(!this._templateId||!e||!e.templates){this.hideNode(this._templatePreviewNode);this._templateTemplateTitleNode.textContent=""}else{const e=this.getSelectedTemplate();if(e){const t=BX.Text.encode(e.PREVIEW).replace(/\n/g,"<br>");this.showNode(this._templatePreviewNode);this._templatePreviewNode.innerHTML=t;this._templateTemplateTitleNode.textContent=e.TITLE}else{this.hideNode(this._templatePreviewNode);this._templateTemplateTitleNode.textContent=""}}}static create(e,t){const s=new ie;s.initialize(e,t);ie.items[s.getId()]=s;return s}}function ne(){const e=this.getSetting("smsConfig",{});const t=BX.prop.getBoolean(e,"isSalescenterEnabled",false);const s=BX.prop.getBoolean(e,"isDocumentsEnabled",false);const i=this.getSetting("enableFiles",false);this._saveButton=r.Tag.render(x||(x=R`<button onclick="${0}" class="ui-btn ui-btn-xs ui-btn-primary" >${0}</button>`),this.onSaveButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_SEND"));this._cancelButton=r.Tag.render(U||(U=R`<span onclick="${0}"  class="ui-btn ui-btn-xs ui-btn-link">${0}</span>`),this.onCancelButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_CANCEL_BTN"));this._input=r.Tag.render(W||(W=R`<textarea class="crm-entity-stream-content-new-sms-textarea" rows='1' placeholder="${0}"></textarea>`),r.Loc.getMessage("CRM_TIMELINE_SMS_ENTER_MESSAGE"));return r.Tag.render($||($=R`<div class="crm-entity-stream-content-sms-buttons-container">
			${0}
			${0}
			${0}
				<div class="crm-entity-stream-content-sms-detail-toggle" data-role="sms-detail-switcher">
					${0}
				</div>
			</div>
			<div class="crm-entity-stream-content-sms-conditions-container hidden" data-role="sms-detail">
				<div class="crm-entity-stream-content-sms-conditions">
					<div class="crm-entity-stream-content-sms-conditions-text">
						${0}
						<a href="#" data-role="sender-selector">sender</a><span data-role="from-container">${0}
						<a data-role="from-selector" href="#">from_number</a></span>
						<span data-role="client-container"> ${0}
						<a data-role="client-selector" href="#">client_caption</a> <a data-role="to-selector" href="#">to_number</a></span>
					</div>
				</div>
			</div>
			${0}
			${0}
			${0}

			<div class="crm-entity-stream-content-new-sms-btn-container">
				${0}
				${0}

				<div class="crm-entity-stream-content-sms-symbol-counter" data-role="message-length-counter-wrap">
					${0}
					<span class="crm-entity-stream-content-sms-symbol-counter-number" data-role="message-length-counter" data-length-max="200">0</span>
					${0}
					<span class="crm-entity-stream-content-sms-symbol-counter-number">200</span>
				</div>
			</div>
		`),t?r.Tag.render(G||(G=R`
				<div class="crm-entity-stream-content-sms-button" data-role="salescenter-starter">
					<div class="crm-entity-stream-content-sms-salescenter-icon"></div>
					<div class="crm-entity-stream-content-sms-button-text">${0}</div>
				</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_SALESCENTER_STARTER")):null,i?r.Tag.render(j||(j=R`
				<div class="crm-entity-stream-content-sms-button" data-role="sms-file-selector">
					<div class="crm-entity-stream-content-sms-file-icon"></div>
					<div class="crm-entity-stream-content-sms-button-text">${0}</div>
				</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_SEND_FILE")):null,s?r.Tag.render(K||(K=R`
				<div class="crm-entity-stream-content-sms-button" data-role="sms-document-selector">
					<div class="crm-entity-stream-content-sms-document-icon"></div>
					<div class="crm-entity-stream-content-sms-button-text">${0}</div>
				</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_SEND_DOCUMENT")):null,r.Loc.getMessage("CRM_TIMELINE_DETAILS"),r.Loc.getMessage("CRM_TIMELINE_SMS_SENDER"),r.Loc.getMessage("CRM_TIMELINE_SMS_FROM"),r.Loc.getMessage("CRM_TIMELINE_SMS_TO"),this._input,babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](),babelHelpers.classPrivateFieldLooseBase(this,te)[te](),this._saveButton,this._cancelButton,r.Loc.getMessage("CRM_TIMELINE_SMS_SYMBOLS"),r.Loc.getMessage("CRM_TIMELINE_SMS_SYMBOLS_FROM"))}function ae(){const e=BX.prop.getBoolean(this.getSetting("smsConfig",{}),"isSalescenterEnabled",false);return r.Tag.render(q||(q=R`<div class="crm-entity-stream-content-sms-conditions-container">
			<div class="crm-entity-stream-content-sms-conditions">
				<div class="crm-entity-stream-content-sms-conditions-text">
					<strong>${0}</strong><br>
					${0}<br>
					${0}
				</div>
			</div>
		</div>
		<div class="crm-entity-stream-content-new-sms-btn-container">
			<a href="#" data-role="sender-selector" target="_top" class="crm-entity-stream-content-new-sms-connect-link">${0}</a>
			${0}
		</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_MANAGE_TEXT_1"),r.Loc.getMessage("CRM_TIMELINE_SMS_MANAGE_TEXT_2"),r.Loc.getMessage("CRM_TIMELINE_SMS_MANAGE_TEXT_3_MSGVER_1"),r.Loc.getMessage("CRM_TIMELINE_SMS_MANAGE_URL"),e?r.Tag.render(z||(z=R`<div class="crm-entity-stream-content-sms-salescenter-container-absolute" data-role="salescenter-starter">
	<div class="crm-entity-stream-content-sms-salescenter-icon"></div>
	<div class="crm-entity-stream-content-sms-button-text">${0}</div>
</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_SALESCENTER_STARTER")):null)}function oe(){this._templatesContainer=r.Tag.render(Y||(Y=R`<div class="crm-entity-stream-content-new-sms-templates">
				<div class="ui-ctl-label-text">
					${0}<span class="ui-hint" data-role="hint"><span class="ui-hint-icon"></span></span>
				</div>
				<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100" data-role="template-selector">
					<div class="ui-ctl-element" data-role="template-title"></div>
					<div class="ui-ctl-after ui-ctl-icon-angle"></div>
				</div>
				<div class="crm-entity-stream-content-new-sms-preview" data-role="preview"></div>
			</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_TEMPLATE_LIST_TITLE"));return this._templatesContainer}function re(){const e=this.getSetting("smsConfig",{});const t=this.getSetting("showFiles",false);const s=BX.prop.getBoolean(e,"isFilesExternalLinkEnabled",false);if(s){const e="crm-"+this.getEntityTypeId()+"-"+this.getEntityId();const t=e+"-sms-files";const s=e+"-sms-files-uploader";const i="diskuf-selectdialog-"+e;return r.Tag.render(V||(V=R`<div class="crm-entity-stream-content-sms-file-uploader-zone" data-role="sms-file-upload-zone" data-node-id="${0}">
				<div id="${0}" class="diskuf-files-entity diskuf-selectdialog bx-disk">
					<div class="diskuf-files-block checklist-loader-files">
						<div class="diskuf-placeholder">
							<table class="files-list">
								<tbody class="diskuf-placeholder-tbody"></tbody>
							</table>
						</div>
					</div>
					<div class="diskuf-extended">
						<input type="hidden" name="${0}[]" value="" />
					</div>
					<div class="diskuf-extended-item">
						<label for="${0}" data-role="sms-file-upload-label"></label>
						<input class="diskuf-fileUploader" id="${0}" type="file" data-role="sms-file-upload-input" />
					</div>
					<div class="diskuf-extended-item">
						<span class="diskuf-selector-link" data-role="sms-file-selector-bitrix">
						</span>
					</div>
				</div>
			</div>`),e,i,t,s,s)}if(t){return r.Tag.render(Z||(Z=R`<div class="crm-entity-stream-content-sms-file-external-link-popup" data-role="sms-file-external-link-disabled">
				<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-container">
					<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-inner">
						<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-desc">
							<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-img">
								<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-img-lock"></div>
							</div>
							<div class="crm-entity-stream-content-sms-file-external-link-popup-limit-desc-text">
								${0}
							</div>
						</div>
					</div>
				</div>
			</div>`),r.Loc.getMessage("CRM_TIMELINE_SMS_FILE_EXTERNAL_LINK_FEATURE"))}return null}function le(){s.EventEmitter.subscribe("BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged",(e=>{const{item:t,current:s}=e.getData();if(this.getEntityTypeId()!==(t==null?void 0:t.entityTypeId)||this.getEntityId()!==(t==null?void 0:t.entityId)){return}if(!r.Type.isArray(s)){return}const i=s.filter((e=>e.address.typeId==="PHONE"));const n={};for(const e of i){let t=n[e.addressSource.hash];if(!t){var a;t={entityTypeId:e.addressSource.entityTypeId,entityTypeName:BX.CrmEntityType.resolveName(e.addressSource.entityTypeId),entityId:e.addressSource.entityId,caption:(a=e.addressSourceData)==null?void 0:a.title,phones:[]}}t.phones.push({type:e.address.typeId,value:e.address.value,valueFormatted:e.address.valueFormatted});n[e.addressSource.hash]=t}this._communications=Object.values(n);const o=this._communications.find((e=>e.entityTypeId===this._commEntityTypeId&&e.entityId===this._commEntityId));this.setClient(o!=null?o:this._communications[0]);this.initClientContainer()}))}ie.items={};class ce extends b{showSlider(){const e=new BX.Crm.Activity.Planner;e.showEdit({TYPE_ID:BX.CrmActivityType.call,OWNER_TYPE_ID:this.getEntityTypeId(),OWNER_ID:this.getEntityId()})}supportsLayout(){return false}}class de extends b{showSlider(){const e=BX.CrmTimelineManager.getDefault().getOwnerInfo();BX.CrmActivityEditor.getDefault().addEmail({ownerType:BX.CrmEntityType.resolveName(this.getEntityTypeId()),ownerID:this.getEntityId(),ownerUrl:e["SHOW_URL"],ownerTitle:e["TITLE"],subject:""})}supportsLayout(){return false}}class he extends b{showSlider(){const e=new BX.Crm.Activity.Planner;e.showEdit({TYPE_ID:BX.CrmActivityType.meeting,OWNER_TYPE_ID:this.getEntityTypeId(),OWNER_ID:this.getEntityId()})}supportsLayout(){return false}}class ue extends b{showSlider(){BX.CrmActivityEditor.getDefault().addTask({ownerType:BX.CrmEntityType.resolveName(this.getEntityTypeId()),ownerID:this.getEntityId()})}supportsLayout(){return false}}let pe=e=>e,me,_e,ge,ve,be,fe,ye,Ie,Ee,Ce,Be,Le;class Te extends F{constructor(...e){super(...e);this.HELPDESK_CODE=17502612}initialize(e,t){const s=t.config;this.link=s.link;this.setContacts(s.contacts);this.isNotificationsAvailable=s.isNotificationsAvailable;this.areCommunicationChannelsAvailable=s.areCommunicationChannelsAvailable;if(this.areCommunicationChannelsAvailable){this.setCommunicationChannels(s.communicationChannels,s.selectedChannelId)}this.doPayAttentionToNewFeature=s.doPayAttentionToNewFeature;super.initialize(e,t);if(this.getSetting("isAvailable")){this.bindEvents()}}activate(){if(this.getSetting("isAvailable")){this.setVisible(true)}else{var e,t;(e=BX.UI)==null?void 0:(t=e.InfoHelper)==null?void 0:t.show("limit_crm_calendar_free_slots")}}supportsLayout(){return this.getSetting("isAvailable")}bindEvents(){s.EventEmitter.subscribe("CalendarSharing:LinkCopied",(()=>this.onLinkCopied()));s.EventEmitter.subscribe("BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged",this.onContactsChangedHandler.bind(this))}doInitialize(){if(this.doPayAttentionToNewFeature){this.payAttentionToNewFeature();BX.ajax.runAction("crm.api.timeline.calendar.sharing.disableOptionPayAttentionToNewCrmSharingFeature")}}createLayout(){this.DOM={menuBarItem:document.querySelector(".crm-entity-stream-section-menu [data-id=sharing]")};return r.Tag.render(me||(me=pe`
			<div class="crm-entity-stream-content-sharing --hidden">
				<div id="_sharing_content_container">
					<div class="crm-entity-stream-calendar-sharing-container">
						<div class="crm-entity-stream-calendar-sharing-main">
							<div class="crm-entity-stream-calendar-sharing-icon"></div>
							<div class="crm-entity-stream-calendar-sharing-info">
								<div class="crm-entity-stream-calendar-sharing-header">
									${0}
								</div>
								<div class="crm-entity-stream-calendar-sharing-info-item">
									<div class="crm-entity-stream-calendar-sharing-info-item-icon"></div>
									<div class="crm-entity-stream-calendar-sharing-info-item-text">
										${0}
									</div>
								</div>
								<div class="crm-entity-stream-calendar-sharing-info-item">
									<div class="crm-entity-stream-calendar-sharing-info-item-icon"></div>
									<div class="crm-entity-stream-calendar-sharing-info-item-text">
										${0}
									</div>
								</div>
								<div class="crm-entity-stream-calendar-sharing-info-btn-settings">
									<div class="crm-entity-stream-calendar-sharing-info-icon-qr"></div>
									${0}
								</div>
							</div>
							${0}
						</div>
					</div>
				</div>
				<div class="crm-entity-stream-calendar-sharing-btn-container">
					${0}
					${0}
					${0}
				</div>
			</div>
		`),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_INFO_TITLE"),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_1"),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_2"),this.createConfigureSlotsButton(),this.createSettingsButton(),this.createSendButton(),this.createCancelButton(),this.createMoreInfoButton())}createConfigureSlotsButton(){this.DOM.configureSlotsButton=r.Tag.render(_e||(_e=pe`
			<div class="crm-entity-stream-calendar-sharing-info-btn-settings-text">
				${0}
			</div>
		`),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_CONFIGURE_SLOTS"));r.Event.bind(this.DOM.configureSlotsButton,"click",(()=>this.onConfigureSlotsButtonClick()));return this.DOM.configureSlotsButton}createSettingsButton(){this.DOM.settingsButton=r.Tag.render(ge||(ge=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-icon"></div>
		`));this.updateSettingsButton();r.Event.bind(this.DOM.settingsButton,"click",(()=>this.onSettingsButtonClick()));return this.DOM.settingsButton}updateSettingsButton(){if(this.isContactAvailable()){this.DOM.settingsButton.style.display=""}else{this.DOM.settingsButton.style.display="none"}}createSendButton(){this.DOM.sendButton=r.Tag.render(ve||(ve=pe`
			<button class="ui-btn ui-btn-xs ui-btn-primary">
				${0}
			</button>
		`),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_SEND_BUTTON"));r.Event.bind(this.DOM.sendButton,"click",(()=>this.onSendButtonClick()));this._saveButton=this.DOM.sendButton;return this.DOM.sendButton}createCancelButton(){this.DOM.cancelButton=r.Tag.render(be||(be=pe`
			<span class="ui-btn ui-btn-xs ui-btn-link">
				${0}
			</span>
		`),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_CANCEL_BUTTON"));r.Event.bind(this.DOM.cancelButton,"click",(()=>this.onCancelButtonClick()));this._cancelButton=this.DOM.cancelButton;return this.DOM.cancelButton}createMoreInfoButton(){this.DOM.moreInfoButton=r.Tag.render(fe||(fe=pe`
			<span class="crm-entity-stream-calendar-sharing-more-btn">
				${0}
			</span>
		`),r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_MORE_INFO_BUTTON"));r.Event.bind(this.DOM.moreInfoButton,"click",(()=>this.onMoreInfoButtonClick()));return this.DOM.moreInfoButton}onConfigureSlotsButtonClick(){this.showConfigureSlotsPopup()}onSettingsButtonClick(){this.showSettingsPopup()}onSendButtonClick(){if(!this.isContactAvailable()){this.showWarningNoContact();return}if(!this.areCommunicationChannelsAvailable){this.showWarningNoCommunicationChannels();return}this.onSaveButtonClick()}onLinkCopied(){this.saveLinkAction({isActionCopy:true})}onMoreInfoButtonClick(){this.openHelpDesk()}showConfigureSlotsPopup(){if(!this.newDialog){this.newDialog=new a.DialogNew({bindElement:this.DOM.configureSlotsButton,sharingUrl:this.link.url,context:"crm"})}this.newDialog.show()}showSettingsPopup(){if(this.settingsMenu){this.settingsMenu.destroy()}this.settingsMenu=this.getSettingsMenu();this.settingsMenu.show()}isSettingsPopupShown(){var e;return(e=this.settingsMenu)==null?void 0:e.popupWindow.isShown()}getSettingsMenu(){const e=[this.getSharingReceiverItem()];if(this.areCommunicationChannelsAvailable&&this.isChannelsAvailable()){e.push(this.getSharingChannelsItem())}if(this.currentFromList){e.push(this.getSharingSenderItem())}return i.MenuManager.create({id:"crm-calendar-sharing-settings",bindElement:this.DOM.settingsButton,items:e})}getSharingReceiverItem(){return{id:"sharing_receiver",text:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_RECEIVER"),items:this.contacts.map((e=>this.getContactMenuItem(e)))}}getSharingChannelsItem(){return{id:"sharing_channels",text:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_COMMUNICATION_CHANNELS"),items:this.channels.map((e=>this.getChannelMenuItem(e)))}}getSharingSenderItem(){return{id:"sharing_sender",text:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_SENDER"),items:this.currentFromList.map((e=>this.getFromMenuItem(e)))}}getContactMenuItem(e){const t=e.entityId===this.contact.entityId&&e.entityTypeId===this.contact.entityTypeId;const s=r.Tag.render(ye||(ye=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check">
				<div>${0} (${0})</div>
			</div>
		`),e.name,e.phone);e.check=r.Tag.render(Ie||(Ie=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check-icon ${0}"></div>
		`),t?"--show":"");s.append(e.check);return{html:s,onclick:()=>{r.Dom.removeClass(this.contact.check,"--show");r.Dom.addClass(e.check,"--show");this.contact=e}}}getChannelMenuItem(e){const t=e.id===this.channel.id;const s=r.Tag.render(Ee||(Ee=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check">
				<div>${0}</div>
			</div>
		`),e.name);e.check=r.Tag.render(Ce||(Ce=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check-icon ${0}"></div>
		`),t?"--show":"");s.append(e.check);return{html:s,onclick:()=>{r.Dom.removeClass(this.channel.check,"--show");r.Dom.addClass(e.check,"--show");this.channel=e;this.updateSenderList()}}}getFromMenuItem(e){const t=e.id===this.currentFrom.id;const s=r.Tag.render(Be||(Be=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check">
				<div>${0}</div>
			</div>
		`),e.name);e.check=r.Tag.render(Le||(Le=pe`
			<div class="crm-entity-stream-calendar-sharing-settings-check-icon ${0}"></div>
		`),t?"--show":"");s.append(e.check);return{html:s,onclick:()=>{r.Dom.removeClass(this.currentFrom.check,"--show");r.Dom.addClass(e.check,"--show");this.currentFrom=e}}}showWarningNoCommunicationChannels(){let e;let t;if(this.isNotificationsAvailable){e=r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TITLE");t=`\n\t\t\t\t<div>${r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_1")}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2")}</div>\n\t\t\t`}else{e=r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE");t=`\n\t\t\t\t<div>${r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE_1")}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2")}</div>\n\t\t\t`}const s=this.getWarningGuide(e,t);s.showNextStep();const i=s.getPopup();const n=i.getContentContainer();const a=n.querySelector("span[data-role=crm-timeline-calendar-sharing_open-configure-slots]");a.addEventListener("click",(()=>{i.close();this.showConfigureSlotsPopup()}))}showWarningNoContact(){const e=r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TITLE");const t=r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TEXT");const s=this.getWarningGuide(e,t);s.showNextStep()}updateSenderList(){this.currentFromList=this.channel.fromList;this.currentFrom=this.channel.fromList[0];if(this.settingsMenu){this.settingsMenu.removeMenuItem("sharing_sender");const e=this.getSharingSenderItem();this.settingsMenu.addMenuItem(e)}}copyLink(e){BX.clipboard.copy(e);BX.UI.Notification.Center.notify({content:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_COPY_LINK_NOTIFICATION")});s.EventEmitter.emit("CalendarSharing:LinkCopied")}save(){return this.saveLinkAction()}saveLinkAction(e={isActionCopy:false}){let t;let s={ownerId:this.getEntityId(),ownerTypeId:this.getEntityTypeId()};if(this.isContactAvailable()&&this.isChannelsAvailable()&&!e.isActionCopy){t="crm.api.timeline.calendar.sharing.sendLink";s.contactId=this.contact.entityId||null;s.contactTypeId=this.contact.entityTypeId||null;s.channelId=this.channel.id||null;s.senderId=this.currentFrom.id||null}else{t="crm.api.timeline.calendar.sharing.onLinkCopied";s.linkHash=this.link.hash}return BX.ajax.runAction(t,{data:s}).then((e=>{if(e.data){this.emitFinishEditEvent();return true}return false}),(e=>{console.error(e);return false}))}onContactsChangedHandler(e){const{item:t,current:s}=e.getData();const i=this.getEntityTypeId()===(t==null?void 0:t.entityTypeId)&&this.getEntityId()===(t==null?void 0:t.entityId);if(!i||!r.Type.isArray(s)){return}const n=s.filter((e=>e.address.typeId==="PHONE"));const a=[];const o=[];for(const e of n){var l;if(o.includes(e.addressSource.hash)){continue}o.push(e.addressSource.hash);a.push({entityId:e.addressSource.entityId,entityTypeId:e.addressSource.entityTypeId,name:(l=e.addressSourceData)==null?void 0:l.title,phone:e.address.value})}this.setContacts(a);this.updateSettingsButton();if(this.isSettingsPopupShown()){this.showSettingsPopup()}}setContacts(e){var t;this.contacts=e.filter((e=>e.entityId&&e.entityTypeId&&e.phone&&e.name)).sort(((e,t)=>e.entityId-t.entityId)).sort(((e,t)=>e.entityTypeId-t.entityTypeId));this.contact=(t=e.find((e=>{var t,s;return e.entityTypeId===((t=this.contact)==null?void 0:t.entityTypeId)&&e.entityId===((s=this.contact)==null?void 0:s.entityId)})))!=null?t:this.contacts[0]}setCommunicationChannels(e,t){this.channels=e||[];if(t){var s;this.channel=(s=e.find((e=>e.id===t)))!=null?s:this.channels[0]}else{this.channel=this.channels?this.channels[0]:null}if(this.channel&&this.channel.fromList){this.currentFromList=this.channel.fromList;this.currentFrom=this.channel.fromList[0]}}isContactAvailable(){return r.Type.isArrayFilled(this.contacts)}isChannelsAvailable(){return r.Type.isArrayFilled(this.channels)}openHelpDesk(){if(top.BX.Helper){top.BX.Helper.show(`redirect=detail&code=${this.HELPDESK_CODE}`)}}getWarningGuide(e,t){const s=new n.Guide({simpleMode:true,onEvents:true,steps:[{target:this.DOM.sendButton,title:e,text:t,condition:{top:false,bottom:true,color:"warning"}}]});const i=s.getPopup();r.Dom.addClass(i.popupContainer,"crm-calendar-sharing-configure-slots-popup-ui-tour-animate");i.setWidth(390);const a=i.getContentContainer().firstElementChild;const o=parseInt(getComputedStyle(i.closeIcon)["width"]);const l=parseInt(getComputedStyle(a)["paddingRight"]);i.getContentContainer().style.paddingRight=o-l+"px";i.setAutoHide(true);i.subscribe("onAfterShow",(()=>{setTimeout((()=>{const e=i.angle.element;const t=e.firstElementChild;t.style.border="2px solid var(--ui-color-text-warning, #ffa900)";if(i.getContentContainer().getBoundingClientRect().top>this.DOM.sendButton.getBoundingClientRect().top){const t=i.getContentContainer().querySelector(".ui-tour-popup-condition-bottom");t.className="ui-tour-popup-condition-top";e.style.top="-20px"}else{e.style.bottom="-18px"}}),0)}));return s}payAttentionToNewFeature(){const e=this.getGuide();const t=this.getPulsar();setTimeout((()=>{e.showNextStep();t.show()}),1e3)}getGuide(){const e=new n.Guide({simpleMode:true,onEvents:true,steps:[{target:this.DOM.menuBarItem,title:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TITLE"),text:r.Loc.getMessage("CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TEXT"),article:this.HELPDESK_CODE,condition:{top:true,bottom:false,color:"primary"}}]});const t=e.getPopup();r.Dom.addClass(t.popupContainer,"crm-calendar-sharing-configure-slots-popup-ui-tour-animate");t.setWidth(400);t.getContentContainer().style.paddingRight=getComputedStyle(t.closeIcon)["width"];return e}getPulsar(){const e=new BX.SpotLight({targetElement:this.DOM.menuBarItem,targetVertex:"middle-center"});e.bindEvents({onTargetEnter:()=>e.close()});return e}}class Se{constructor(){this._id="";this._settings={};this._type=He.WaitingType.undefined;this._duration=0;this._target="";this._targetDates=null;this._container=null;this._durationMeasureNode=null;this._durationInput=null;this._targetDateNode=null;this._popup=null}initialize(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._type=BX.prop.getInteger(this._settings,"type",He.WaitingType.after);this._duration=BX.prop.getInteger(this._settings,"duration",1);this._target=BX.prop.getString(this._settings,"target","");this._targetDates=BX.prop.getArray(this._settings,"targetDates",[]);this._menuId=this._id+"_target_date_sel"}getId(){return this._id}getType(){return this._type}setType(e){this._type=e}getDuration(){return this._duration}setDuration(e){this._duration=e}getTarget(){return this._target}setTarget(e){this._target=e}getMessage(e){const t=Se.messages;return t.hasOwnProperty(e)?t[e]:e}getDurationText(e,t){return He.Helper.getDurationText(e,t)}getTargetDateCaption(e){const t=this._targetDates.length;for(let s=0;s<t;s++){const t=this._targetDates[s];if(t["name"]===e){return t["caption"]}}return""}open(){this._popup=new BX.PopupWindow(this._id,null,{autoHide:true,draggable:false,bindOptions:{forceBindPosition:false},closeByEsc:true,zIndex:0,content:this.prepareDialogContent(),events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},buttons:[new BX.PopupWindowButton({text:r.Loc.getMessage("CRM_TIMELINE_CHOOSE"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onSaveButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CANCEL"),events:{click:BX.delegate(this.onCancelButtonClick,this)}})]});this._popup.show()}close(){if(this._popup){this._popup.close()}}prepareDialogContent(){const e=BX.create("div",{attrs:{className:"crm-wait-popup-select-block"}});const t=BX.create("div",{attrs:{className:"crm-wait-popup-select-wrapper"}});e.appendChild(t);this._durationInput=BX.create("input",{attrs:{type:"text",className:"crm-wait-popup-settings-input",value:this._duration},events:{keyup:BX.delegate(this.onDurationChange,this)}});this._durationMeasureNode=BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:this.getDurationText(this._duration,false)});if(this._type===He.WaitingType.after){t.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:r.Loc.getMessage("CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_AFTER")}));t.appendChild(this._durationInput);t.appendChild(this._durationMeasureNode)}else{t.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:r.Loc.getMessage("CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_BEFORE")}));t.appendChild(this._durationInput);t.appendChild(this._durationMeasureNode);t.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:" "+r.Loc.getMessage("CRM_TIMELINE_WAIT_TARGET_PREFIX_TYPE_BEFORE")}));this._targetDateNode=BX.create("span",{attrs:{className:"crm-automation-popup-settings-link"},text:this.getTargetDateCaption(this._target),events:{click:BX.delegate(this.toggleTargetMenu,this)}});t.appendChild(this._targetDateNode)}return e}onDurationChange(){let e=parseInt(this._durationInput.value);if(isNaN(e)||e<=0){e=1}this._duration=e;this._durationMeasureNode.innerHTML=BX.util.htmlspecialchars(this.getDurationText(e,false))}toggleTargetMenu(){if(this.isTargetMenuOpened()){this.closeTargetMenu()}else{this.openTargetMenu()}}isTargetMenuOpened(){return!!BX.PopupMenu.getMenuById(this._menuId)}openTargetMenu(){const e=[];let t=0;const s=this._targetDates.length;for(;t<s;t++){const s=this._targetDates[t];e.push({text:s["caption"],title:s["caption"],value:s["name"],onclick:BX.delegate(this.onTargetSelect,this)})}BX.PopupMenu.show(this._menuId,this._targetDateNode,e,{zIndex:200,autoHide:true,offsetLeft:BX.pos(this._targetDateNode)["width"]/2,angle:{position:"top",offset:0}})}closeTargetMenu(){BX.PopupMenu.destroy(this._menuId)}onPopupShow(e,t){}onPopupClose(){if(this._popup){this._popup.destroy()}this.closeTargetMenu()}onPopupDestroy(){if(this._popup){this._popup=null}}onSaveButtonClick(e){const t=BX.prop.getFunction(this._settings,"onSave",null);if(!t){return}const s={type:this._type};s["duration"]=this._duration;s["target"]=this._type===He.WaitingType.before?this._target:"";t(this,s)}onCancelButtonClick(e){const t=BX.prop.getFunction(this._settings,"onCancel",null);if(t){t(this)}}onTargetSelect(e,t){const s=BX.prop.getString(t,"value","");if(s!==""){this._target=s;this._targetDateNode.innerHTML=BX.util.htmlspecialchars(this.getTargetDateCaption(s))}this.closeTargetMenu();e.preventDefault?e.preventDefault():e.returnValue=false}static create(e,t){const s=new Se;s.initialize(e,t);return s}}Se.messages={};let Me=e=>e,Ne,Pe,Fe,De,we;var Ae=babelHelpers.classPrivateFieldLooseKey("waitConfigContainer");class He extends F{constructor(...e){super(...e);Object.defineProperty(this,Ae,{writable:true,value:null})}createLayout(){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=r.Tag.render(Ne||(Ne=Me`<div class="crm-entity-stream-content-wait-conditions"></div>`));this._saveButton=r.Tag.render(Pe||(Pe=Me`<button onclick="${0}" class="ui-btn ui-btn-xs ui-btn-primary" >${0}</button>`),this.onSaveButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_CREATE_WAITING"));this._cancelButton=r.Tag.render(Fe||(Fe=Me`<span onclick="${0}"  class="ui-btn ui-btn-xs ui-btn-link">${0}</span>`),this.onCancelButtonClick.bind(this),r.Loc.getMessage("CRM_TIMELINE_CANCEL_BTN"));this._input=r.Tag.render(De||(De=Me`<textarea rows="1" class="crm-entity-stream-content-wait-comment-textarea" placeholder="${0}"></textarea>`),r.Loc.getMessage("CRM_TIMELINE_WAIT_PLACEHOLDER"));return r.Tag.render(we||(we=Me`<div class="crm-entity-stream-content-wait-detail --focus --hidden">
			<div class="crm-entity-stream-content-wait-conditions-container">
				${0}
			</div>
			${0}
			<div class="crm-entity-stream-content-wait-comment-btn-container">
				${0}
				${0}
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae],this._input,this._saveButton,this._cancelButton)}doInitialize(){this._isRequestRunning=false;this._isLocked=false;this._hideButtonsOnBlur=false;this._type=He.WaitingType.after;this._duration=1;this._target="";this._configSelector=null;this._isMenuShown=false;this._menu=null;this._configDialog=null;this._serviceUrl=this.getSetting("serviceUrl","");const e=this.getSetting("config",{});this._type=He.WaitingType.resolveTypeId(BX.prop.getString(e,"type",He.WaitingType.names.after));this._duration=BX.prop.getInteger(e,"duration",1);this._target=BX.prop.getString(e,"target","");this._targetDates=this.getSetting("targetDates",[]);this.layoutConfigurationSummary()}getDurationText(e,t){return He.Helper.getDurationText(e,t)}getTargetDateCaption(e){let t=0;const s=this._targetDates.length;for(;t<s;t++){const s=this._targetDates[t];if(s["name"]===e){return s["caption"]}}return""}onSelectorClick(e){if(!this._isMenuShown){this.openMenu()}else{this.closeMenu()}e.preventDefault?e.preventDefault():e.returnValue=false}openMenu(){if(this._isMenuShown){return}const e=BX.delegate(this.onMenuItemClick,this);const t=[{id:"day_1",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_1D"),onclick:e},{id:"day_2",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_2D"),onclick:e},{id:"day_3",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_3D"),onclick:e},{id:"week_1",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_1W"),onclick:e},{id:"week_2",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_2W"),onclick:e},{id:"week_3",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_3W"),onclick:e}];const s={id:"custom",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_CUSTOM"),items:[]};s["items"].push({id:"afterDays",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_AFTER_CUSTOM_DAYS"),onclick:e});if(this._targetDates.length>0){s["items"].push({id:"beforeDate",text:r.Loc.getMessage("CRM_TIMELINE_WAIT_BEFORE_CUSTOM_DATE"),onclick:e})}t.push(s);BX.PopupMenu.show(this._id,this._configSelector,t,{offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0},events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this),onPopupDestroy:BX.delegate(this.onMenuDestroy,this)}});this._menu=BX.PopupMenu.currentItem}closeMenu(){if(!this._isMenuShown){return}if(this._menu){this._menu.close()}}onMenuItemClick(e,t){this.closeMenu();if(t.id==="afterDays"||t.id==="beforeDate"){this.openConfigDialog(t.id==="afterDays"?He.WaitingType.after:He.WaitingType.before);return}const s={type:He.WaitingType.after};if(t.id==="day_1"){s["duration"]=1}else if(t.id==="day_2"){s["duration"]=2}else if(t.id==="day_3"){s["duration"]=3}if(t.id==="week_1"){s["duration"]=7}else if(t.id==="week_2"){s["duration"]=14}else if(t.id==="week_3"){s["duration"]=21}this.saveConfiguration(s)}openConfigDialog(e){if(!this._configDialog){this._configDialog=Se.create("",{targetDates:this._targetDates,onSave:BX.delegate(this.onConfigDialogSave,this),onCancel:BX.delegate(this.onConfigDialogCancel,this)})}this._configDialog.setType(e);this._configDialog.setDuration(this._duration);let t=this._target;if(t===""&&this._targetDates.length>0){t=this._targetDates[0]["name"]}this._configDialog.setTarget(t);this._configDialog.open()}onConfigDialogSave(e,t){this.saveConfiguration(t);this._configDialog.close()}onConfigDialogCancel(e){this._configDialog.close()}onMenuShow(){this._isMenuShown=true}onMenuClose(){if(this._menu&&this._menu.popupWindow){this._menu.popupWindow.destroy()}}onMenuDestroy(){this._isMenuShown=false;this._menu=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}}saveConfiguration(e){this._type=BX.prop.getInteger(e,"type",He.WaitingType.after);this._duration=BX.prop.getInteger(e,"duration",0);if(this._duration<=0){this._duration=1}this._target=this._type===He.WaitingType.before?BX.prop.getString(e,"target",""):"";const t=this.getSetting("optionName");BX.userOptions.save("crm.timeline.wait",t,"type",this._type===He.WaitingType.after?"after":"before");BX.userOptions.save("crm.timeline.wait",t,"duration",this._duration);BX.userOptions.save("crm.timeline.wait",t,"target",this._target);this.layoutConfigurationSummary()}getSummaryHtml(){if(this._type===He.WaitingType.before){return r.Loc.getMessage("CRM_TIMELINE_WAIT_COMPLETION_TYPE_BEFORE").replace("#DURATION#",this.getDurationText(this._duration,true)).replace("#TARGET_DATE#",this.getTargetDateCaption(this._target))}return r.Loc.getMessage("CRM_TIMELINE_WAIT_COMPLETION_TYPE_AFTER").replace("#DURATION#",this.getDurationText(this._duration,true))}getSummaryText(){return BX.util.strip_tags(this.getSummaryHtml())}layoutConfigurationSummary(){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].innerHTML=this.getSummaryHtml();this._configSelector=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].querySelector("a");if(this._configSelector){BX.bind(this._configSelector,"click",this.onSelectorClick.bind(this))}}postpone(e,t,s){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"POSTPONE_WAIT",DATA:{ID:e,OFFSET:t}},onsuccess:s})}complete(e,t,s){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"COMPLETE_WAIT",DATA:{ID:e,COMPLETED:t?"Y":"N"}},onsuccess:s})}save(){if(this._isRequestRunning||this._isLocked){return}let e=this.getSummaryText();const t=BX.util.trim(this._input.value);if(t!==""){e+="\n"+t}const s={ID:0,typeId:this._type,duration:this._duration,targetFieldName:this._target,subject:"",description:e,completed:0,ownerType:BX.CrmEntityType.resolveName(this.getEntityTypeId()),ownerID:this.getEntityId()};BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE_WAIT",DATA:s},onsuccess:BX.delegate(this.onSaveSuccess,this),onfailure:BX.delegate(this.onSaveFailure,this)});this._isRequestRunning=this._isLocked=true}cancel(){this._input.value="";this._input.style.minHeight="";this.release()}onSaveSuccess(e){this._isRequestRunning=this._isLocked=false;const t=BX.prop.getString(e,"ERROR","");if(t!==""){alert(t);return}this._input.value="";this._input.style.minHeight="";this.emitFinishEditEvent();this.release()}onSaveFailure(){this._isRequestRunning=this._isLocked=false}getMessage(e){const t=He.messages;return t.hasOwnProperty(e)?t[e]:e}}He.WaitingType={undefined:0,after:1,before:2,names:{after:"after",before:"before"},resolveTypeId:function(e){if(e===this.names.after){return this.after}else if(e===this.names.before){return this.before}return this.undefined}};He.messages={};He.Helper={getDurationText:function(e,t){t=!!t;let s="";let i="D";if(t){if(e%7===0){e=e/7;i="W"}}if(i==="W"){s=BX.Loc.getMessagePlural("CRM_TIMELINE_WAIT_WEEK",e)}else{s=BX.Loc.getMessagePlural("CRM_TIMELINE_WAIT_DAY",e)}if(t){s=e.toString()+" "+s}return s},getMessage:function(e){return He.Helper.messages.hasOwnProperty(e)?He.Helper.messages[e]:e},messages:{}};let Xe=e=>e,ke;var Re=babelHelpers.classPrivateFieldLooseKey("editor");var Oe=babelHelpers.classPrivateFieldLooseKey("createEditor");var xe=babelHelpers.classPrivateFieldLooseKey("onFinishEdit");class Ue extends b{constructor(...e){super(...e);Object.defineProperty(this,xe,{value:$e});Object.defineProperty(this,Oe,{value:We});Object.defineProperty(this,Re,{writable:true,value:null})}showSlider(){if(this.getSetting("isAvailable")){BX.Crm.Zoom.onNotConnectedHandler(r.Loc.getMessage("USER_ID"))}else{BX.Crm.Zoom.onNotAvailableHandler()}}supportsLayout(){return this.getSetting("isConnected")&&this.getSetting("isAvailable")}createLayout(){return r.Tag.render(ke||(ke=Xe`<div class="crm-entity-stream-content-new-detail ui-timeline-zoom-editor --focus --hidden"></div>`))}onFocus(e){this.setFocused(true)}onShow(){if(!babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]()}}}function We(){babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]=new o.Zoom({ownerTypeId:this.getEntityTypeId(),ownerId:this.getEntityId(),container:this.getContainer(),onFinishEdit:babelHelpers.classPrivateFieldLooseBase(this,xe)[xe].bind(this)})}function $e(){this.emitFinishEditEvent()}class Ge extends b{showSlider(){BX.CrmActivityEditor.getDefault().addDelivery({ownerType:BX.CrmEntityType.resolveName(this.getEntityTypeId()),ownerID:this.getEntityId(),orderList:BX.CrmTimelineManager.getDefault().getOwnerInfo()["ORDER_LIST"]})}supportsLayout(){return false}}class je extends b{showSlider(){var e;const t=(e=this.getSettings())!=null?e:{};t["OWNER_TYPE"]=BX.CrmEntityType.resolveName(this.getEntityTypeId());t["OWNER_ID"]=this.getEntityId();BX.CrmActivityVisit.create(t).showEdit()}supportsLayout(){return false}}var Ke=babelHelpers.classPrivateFieldLooseKey("interfaceInitialized");var qe=babelHelpers.classPrivateFieldLooseKey("initializeInterface");class ze extends b{constructor(...e){super(...e);Object.defineProperty(this,qe,{value:Ye});Object.defineProperty(this,Ke,{writable:true,value:false})}showSlider(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]){babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=true;babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]()}const e=this.getSetting("appId","");BX.rest.AppLayout.openApplication(e,{ID:this.getEntityId()},{PLACEMENT:this.getSetting("placement",""),PLACEMENT_ID:this.getSetting("placementId","")})}supportsLayout(){return false}}function Ye(){if(!!top.BX.rest&&!!top.BX.rest.AppLayout){const e=top.BX.rest.AppLayout.initializePlacement(this.getSetting("placement",""));if(!e.prototype.reloadData){const t=this.getEntityTypeId();const s=this.getEntityId();e.prototype.reloadData=function(e,i){BX.Crm.EntityEvent.fireUpdate(t,s,"");i()}}}}var Ve=babelHelpers.classPrivateFieldLooseKey("fireUpdateEvent");class Ze extends b{constructor(...e){super(...e);Object.defineProperty(this,Ve,{value:Je})}showSlider(){BX.rest.Marketplace.open({PLACEMENT:this.getSetting("placement","")});top.BX.addCustomEvent(top,"Rest:AppLayout:ApplicationInstall",babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].bind(this))}supportsLayout(){return false}}function Je(){const e=this.getEntityTypeId();const t=this.getEntityId();setTimeout((function(){console.log("fireUpdate",t,e);BX.Crm.EntityEvent.fire(BX.Crm.EntityEvent.names.invalidate,e,t,"")}),3e3)}class Qe{static createItem(e,t,s){let i=null;switch(e){case"todo":i=new M;break;case"comment":i=new k;break;case"sms":i=new ie;break;case"call":i=new ce;break;case"email":i=new de;break;case"meeting":i=new he;break;case"task":i=new ue;break;case"sharing":i=new Te;break;case"wait":i=new He;break;case"zoom":i=new Ue;break;case"delivery":i=new Ge;break;case"visit":i=new je;break;case"activity_rest_applist":i=new Ze;break}if(!i&&e.match(/^activity_rest_/)){i=new ze}if(i){i.initialize(t,s)}return i}}var et=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var tt=babelHelpers.classPrivateFieldLooseKey("entityId");var st=babelHelpers.classPrivateFieldLooseKey("isReadonly");var it=babelHelpers.classPrivateFieldLooseKey("container");var nt=babelHelpers.classPrivateFieldLooseKey("items");var at=babelHelpers.classPrivateFieldLooseKey("selectedItemId");var ot=babelHelpers.classPrivateFieldLooseKey("menu");var rt=babelHelpers.classPrivateFieldLooseKey("onItemFinishEdit");var lt=babelHelpers.classPrivateFieldLooseKey("getFirstItemIdWithLayout");var ct=babelHelpers.classPrivateFieldLooseKey("defaultInstance");var dt=babelHelpers.classPrivateFieldLooseKey("selectMenuItem");class ht{constructor(e,t){var s;Object.defineProperty(this,dt,{value:mt});Object.defineProperty(this,lt,{value:pt});Object.defineProperty(this,rt,{value:ut});Object.defineProperty(this,et,{writable:true,value:null});Object.defineProperty(this,tt,{writable:true,value:null});Object.defineProperty(this,st,{writable:true,value:false});Object.defineProperty(this,it,{writable:true,value:null});Object.defineProperty(this,nt,{writable:true,value:{}});Object.defineProperty(this,at,{writable:true,value:null});Object.defineProperty(this,ot,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,et)[et]=t.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=t.entityId;babelHelpers.classPrivateFieldLooseBase(this,st)[st]=t.isReadonly;babelHelpers.classPrivateFieldLooseBase(this,it)[it]=document.getElementById(t.containerId);const i=(s=t.menuId)!=null?s:(BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldLooseBase(this,et)[et])+"_menu").toLowerCase();babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=BX.Main.interfaceButtonsManager.getById(i);const n=new u({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,et)[et],entityId:babelHelpers.classPrivateFieldLooseBase(this,tt)[tt],isReadonly:babelHelpers.classPrivateFieldLooseBase(this,st)[st],menuBarContainer:babelHelpers.classPrivateFieldLooseBase(this,it)[it]});t.items.forEach((e=>{var t;const s=e.id;const i=Qe.createItem(s,n,(t=e.settings)!=null?t:null);if(i){i.addFinishEditListener(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,nt)[nt][s]=i}}));this.setActiveItemById(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]())}getItemById(e){var t;return(t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt][e])!=null?t:null}onMenuItemClick(e){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]){return}this.setActiveItemById(e)}setActiveItemById(e){if(!e||babelHelpers.classPrivateFieldLooseBase(this,at)[at]===e){return false}const t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt][e];if(!t){return false}t.activate();if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st]&&t.supportsLayout()){Object.keys(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]).forEach((t=>{if(t!==e){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt][t].deactivate()}}));babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e);babelHelpers.classPrivateFieldLooseBase(this,at)[at]=e;return true}return false}static create(e,t){const s=new ht(e,t);ht.instances[e]=s;return s}static getDefault(){return babelHelpers.classPrivateFieldLooseBase(ht,ct)[ct]}static setDefault(e){babelHelpers.classPrivateFieldLooseBase(ht,ct)[ct]=e}static getById(e){return ht.instances[e]||null}}function ut(){this.setActiveItemById(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]())}function pt(){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]){return null}let e=null;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getAllItems().forEach(function(t){if(e===null){const s=t.dataset.id;const i=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt][s];if(i&&i.supportsLayout()){e=s}}}.bind(this));return e}function mt(e){const t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getItemById(babelHelpers.classPrivateFieldLooseBase(this,at)[at]);const s=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getItemById(e);let i=false;if(s&&t!==s){i=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].isActiveInMoreMenu();r.Dom.addClass(s,babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive);if(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getItemData){const e=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getItemData(s);e["IS_ACTIVE"]=true;if(BX.type.isDomNode(t)){r.Dom.removeClass(t,babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive);const e=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getItemData(t);e["IS_ACTIVE"]=false}}const e=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].isActiveInMoreMenu();if(e||i){const n=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getSubmenu();if(n){n.getMenuItems().forEach((n=>{const a=n.getContainer();if(e&&a.title===s.title){r.Dom.addClass(a,babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive)}else if(i&&a.title===t.title){r.Dom.removeClass(a,babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive)}}))}if(e){r.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getMoreButton(),babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive)}else if(i){r.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].getMoreButton(),babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].classes.itemActive)}}}babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].closeSubmenu()}Object.defineProperty(ht,ct,{writable:true,value:null});ht.instances={};e.MenuBar=ht;e.Item=b})(this.BX.Crm.Timeline=this.BX.Crm.Timeline||{},BX.Crm.Activity,BX.Event,BX.Main,BX.UI.Tour,BX.Calendar.Sharing,BX.Crm,BX);
//# sourceMappingURL=toolbar.bundle.map.js