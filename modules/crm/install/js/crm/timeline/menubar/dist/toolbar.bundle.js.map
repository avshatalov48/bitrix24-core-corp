{"version":3,"file":"toolbar.bundle.js","sources":["../src/context.js","../src/item.js","../src/items/call.js","../src/items/witheditor.js","../src/items/comment.js","../src/items/delivery.js","../src/items/email.js","../src/items/gotochat/services-config.js","../src/items/gotochat/tour.js","../src/items/gotochat/gotochat.js","../src/items/market.js","../src/items/meeting.js","../src/items/restplacement.js","../src/items/sharing.js","../src/items/sms.js","../src/items/task.js","../src/items/todo.js","../src/items/visit.js","../src/items/tools/wait-configuration-dialog.js","../src/items/wait.js","../src/items/zoom.js","../src/factory.js","../src/menubar.js"],"sourcesContent":["declare type ContextParams = {\n\tentityTypeId: Number,\n\tentityId: Number,\n\tisReadonly: Boolean,\n\tmenuBarContainer: HTMLElement,\n}\n\nexport default class Context\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#isReadonly: Boolean = false;\n\t#menuBarContainer: HTMLElement = null;\n\n\tconstructor(params: ContextParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#isReadonly = params.isReadonly;\n\t\tthis.#menuBarContainer = params.menuBarContainer;\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tisReadonly(): Boolean\n\t{\n\t\treturn this.#isReadonly;\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#menuBarContainer;\n\t}\n}\n","import { Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport Context from './context';\n\nexport default class Item\n{\n\tstatic ON_FINISH_EDIT_EVENT = 'onFinishEdit';\n\n\t#context: Context = null;\n\t#settings = {};\n\t#eventEmitter: EventEmitter = null;\n\t#isVisible: Boolean = false;\n\t#container: ?HTMLElement = null;\n\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tthis.#context = context;\n\t\tthis.#settings = settings;\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('BX.Crm.Timeline.MenuBar');\n\n\t\tthis.initializeSettings();\n\n\t\tif (!this.#context.isReadonly() && this.supportsLayout())\n\t\t{\n\t\t\tthis.#container = this.createLayout();\n\t\t\tDom.prepend(this.#container, this.getMenuBarContainer());\n\t\t\tthis.initializeLayout();\n\t\t}\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#context.getEntityTypeId();\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#context.getEntityId();\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#context.getMenuBarContainer();\n\t}\n\n\tgetContainer(): ?HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn true;\n\t}\n\n\tactivate(): void\n\t{\n\t\tif (this.supportsLayout())\n\t\t{\n\t\t\tthis.setVisible(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showSlider();\n\t\t}\n\t}\n\n\tdeactivate(): void\n\t{\n\t\tthis.setVisible(false);\n\t}\n\n\tshowSlider(): void\n\t{\n\t\tthrow new Error('Method showSlider() must be overridden');\n\t}\n\n\tgetSetting(setting: String, defaultValue = null)\n\t{\n\t\treturn this.#settings[setting] ?? defaultValue;\n\t}\n\n\tgetSettings(): ?Object\n\t{\n\t\treturn this.#settings;\n\t}\n\n\tsetVisible(visible: Boolean): void\n\t{\n\t\tvisible = !!visible;\n\t\tif (this.#isVisible === visible)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (visible)\n\t\t{\n\t\t\tDom.removeClass(container, '--hidden');\n\t\t\tthis.onShow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.onHide();\n\t\t\tDom.addClass(container, '--hidden');\n\t\t}\n\t}\n\n\tisVisible(): Boolean\n\t{\n\t\treturn this.#isVisible;\n\t}\n\n\tsetFocused(isFocused: Boolean): void\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isFocused)\n\t\t{\n\t\t\tDom.addClass(container, '--focus');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(container, '--focus');\n\t\t}\n\t}\n\n\tsetLocked(isLocked: Boolean): void\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (isLocked)\n\t\t{\n\t\t\tDom.addClass(container, '--locked');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(container, '--locked');\n\t\t}\n\t}\n\n\tisLocked(): Boolean\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Dom.hasClass(container, '--locked');\n\t}\n\n\taddFinishEditListener(callback)\n\t{\n\t\tthis.#eventEmitter.subscribe(Item.ON_FINISH_EDIT_EVENT, callback);\n\t}\n\n\temitFinishEditEvent()\n\t{\n\t\tthis.#eventEmitter.emit(Item.ON_FINISH_EDIT_EVENT);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthrow new Error('Method createLayout() must be overridden');\n\t}\n\n\tinitializeSettings(): void\n\t{}\n\n\tinitializeLayout(): void\n\t{}\n\n\tonShow(): void\n\t{}\n\n\tonHide(): void\n\t{}\n}\n","import Item from '../item';\nexport default class Call extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.call,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import {Dom} from \"main.core\";\nimport Item from \"../item\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class WithEditor extends Item\n{\n\tinitializeLayout(): void\n\t{\n\t\tthis._ownerTypeId = this.getEntityTypeId();\n\t\tthis._ownerId = this.getEntityId();\n\n\t\tthis._ghostInput = null;\n\n\t\tthis._saveButtonHandler = BX.delegate(this.onSaveButtonClick, this);\n\t\tthis._cancelButtonHandler = BX.delegate(this.onCancelButtonClick, this);\n\t\tthis._focusHandler = BX.delegate(this.onFocus, this);\n\t\tthis._blurHandler = BX.delegate(this.onBlur, this);\n\t\tthis._keyupHandler = BX.delegate(this.resizeForm, this);\n\t\tthis._delayedKeyupHandler = BX.delegate(\n\t\t\tfunction()\n\t\t\t{\n\t\t\t\tsetTimeout(this.resizeForm.bind(this), 0);\n\t\t\t},\n\t\t\tthis\n\t\t);\n\n\t\tthis._hideButtonsOnBlur = true;\n\n\t\tthis.bindInputHandlers();\n\t\tthis.doInitialize();\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tbindInputHandlers()\n\t{\n\t\tBX.bind(this._input, \"focus\", this._focusHandler);\n\t\tBX.bind(this._input, \"blur\", this._blurHandler);\n\t\tBX.bind(this._input, \"keyup\", this._keyupHandler);\n\t\tBX.bind(this._input, \"cut\", this._delayedKeyupHandler);\n\t\tBX.bind(this._input, \"paste\", this._delayedKeyupHandler);\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\tonBlur(e)\n\t{\n\t\tif(!this._hideButtonsOnBlur)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._input.value === \"\")\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tBX.delegate(function() {\n\t\t\t\t\tthis.setFocused(false);\n\t\t\t\t\tthis._input.style.minHeight = \"\";\n\t\t\t\t}, this),\n\t\t\t\t200\n\t\t\t);\n\t\t}\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tthis.setLocked(true);\n\n\t\tconst saveResult = this.save();\n\t\tif (saveResult instanceof BX.Promise || saveResult instanceof Promise)\n\t\t{\n\t\t\tsaveResult.then(\n\t\t\t\t() => this.setLocked(false),\n\t\t\t\t() => this.setLocked(false),\n\t\t\t).catch(() => this.setLocked(false));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLocked(false);\n\t\t}\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\tsave()\n\t{\n\t}\n\n\tcancel()\n\t{\n\t}\n\n\trelease()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\tthis._ghostInput = BX.remove(this._ghostInput);\n\t\t}\n\t}\n\n\tensureGhostCreated()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\treturn this._ghostInput;\n\t\t}\n\n\t\tthis._ghostInput = BX.create('div', {\n\t\t\tprops: { className: 'crm-entity-stream-content-new-comment-textarea-shadow' },\n\t\t\ttext: this._input.value\n\t\t});\n\n\t\tthis._ghostInput.style.width = this._input.offsetWidth + 'px';\n\t\tdocument.body.appendChild(this._ghostInput);\n\t\treturn this._ghostInput;\n\t}\n\n\tresizeForm()\n\t{\n\t\tconst ghost = this.ensureGhostCreated();\n\t\tconst computedStyle = getComputedStyle(this._input);\n\t\tconst diff = parseInt(computedStyle.paddingBottom) +\n\t\t\tparseInt(computedStyle.paddingTop) +\n\t\t\tparseInt(computedStyle.borderTopWidth) +\n\t\t\tparseInt(computedStyle.borderBottomWidth) || 0;\n\n\t\tghost.innerHTML = BX.util.htmlspecialchars(this._input.value.replace(/[\\r\\n]{1}/g, '<br>'));\n\t\tthis._input.style.minHeight = ghost.scrollHeight + diff + 'px'\n\t}\n}\n","import WithEditor from \"./witheditor\";\nimport {Tag, Loc, ajax} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Comment extends WithEditor\n{\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea  rows=\"1\" class=\"crm-entity-stream-content-new-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_COMMENT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --hidden\">\n\t\t\t\t\t${this._input}\n\t\t\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t\t\t${this._saveButton}\n\t\t\t\t\t\t${this._cancelButton}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._postForm = null;\n\t\tthis._editor = null;\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tBX.unbind(this._input, \"blur\", this._blurHandler);\n\t\tBX.unbind(this._input, \"keyup\", this._keyupHandler);\n\t}\n\n\tloadEditor()\n\t{\n\t\tthis._editorName = 'CrmTimeLineComment0';\n\n\t\tif (this._postForm)\n\t\t\treturn;\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.timeline.loadEditor\",\n\t\t\t{ data: { name: this._editorName } }\n\t\t).then(this.onLoadEditorSuccess.bind(this));\n\t}\n\n\tonLoadEditorSuccess(result)\n\t{\n\t\tconst html = BX.prop.getString(BX.prop.getObject(result, \"data\", {}), \"html\", '');\n\t\tBX.html(this._editorContainer, html)\n\t\t\t.then(BX.delegate(this.showEditor,this))\n\t\t\t.then(BX.delegate(this.addEvents,this));\n\t}\n\n\taddEvents()\n\t{\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAppended',\n\t\t\tBX.delegate(function(id, item) {\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tthis._saveButton.removeEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAdded',\n\t\t\tBX.delegate(function(file, controller, obj, blob) {\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tthis._saveButton.addEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\t}\n\n\tshowEditor()\n\t{\n\t\tif (LHEPostForm)\n\t\t{\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis._postForm = LHEPostForm.getHandler(this._editorName);\n\t\t\t\tthis._editor = BXHtmlEditor.Get(this._editorName);\n\t\t\t\tBX.onCustomEvent(this._postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t} ,this), 100);\n\t\t}\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis._input.style.display = 'none';\n\t\tif (this._editor && this._postForm)\n\t\t{\n\t\t\tthis._postForm.eventNode.style.display = 'block';\n\t\t\tthis._editor.Focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!BX.type.isDomNode(this._editorContainer))\n\t\t\t{\n\t\t\t\tthis._editorContainer = BX.create(\"div\", {attrs: {className: \"crm-entity-stream-section-comment-editor\"}});\n\t\t\t\tthis._editorContainer.appendChild(\n\t\t\t\t\tBX.create(\"DIV\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tattrs: { className: \"crm-timeline-wait\" }\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tthis.getContainer().appendChild(this._editorContainer);\n\t\t\t}\n\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis.loadEditor();\n\t\t\t} ,this), 100);\n\t\t}\n\n\t\tthis.setFocused(true);\n\t}\n\n\tsave()\n\t{\n\t\tlet text = \"\";\n\t\tconst attachmentList = [];\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\ttext = this._postForm.oEditor.GetContent();\n\n\t\t\tthis._postForm.eventNode\n\t\t\t\t.querySelectorAll('input[name=\"UF_CRM_COMMENT_FILES[]\"]')\n\t\t\t\t.forEach(function(input) {\n\t\t\t\t\tattachmentList.push(input.value)\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t}\n\n\t\tif (text === \"\")\n\t\t{\n\t\t\tif (!this.emptyCommentMessage)\n\t\t\t{\n\t\t\t\tthis.emptyCommentMessage = new BX.PopupWindow(\n\t\t\t\t\t'timeline_empty_new_comment_' + this.getEntityId(),\n\t\t\t\t\tthis._saveButton,\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent: BX.message('CRM_TIMELINE_EMPTY_COMMENT_MESSAGE'),\n\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tzIndex: 990,\n\t\t\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tbindOptions: { forceBindPosition: true}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.emptyCommentMessage.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = this._isLocked = true;\n\n\t\treturn ajax.runAction(\n\t\t\t'crm.timeline.comment.add',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tENTITY_ID: this.getEntityId(),\n\t\t\t\t\t\tENTITY_TYPE_ID: this.getEntityTypeId(),\n\t\t\t\t\t\tCOMMENT: text,\n\t\t\t\t\t\tATTACHMENTS: attachmentList\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t).then((result) => {\n\t\t\tthis.onSaveSuccess();\n\n\t\t\treturn result;\n\t\t}).catch((result) => {\n\t\t\tthis.onSaveFailure();\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tif (BX.type.isDomNode(this._editorContainer))\n\t\t\tthis._postForm.eventNode.style.display = 'none';\n\n\t\tthis._input.style.display = 'block';\n\t\tthis.setFocused(false);\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tthis.release();\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\tthis._postForm.reinit('', {});\n\t\t}\n\t\tthis.emitFinishEditEvent();\n\t\tthis.cancel();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Delivery extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addDelivery(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t\"orderList\": BX.CrmTimelineManager.getDefault().getOwnerInfo()['ORDER_LIST']\n\t\t}\n\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Email extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst ownerInfo = BX.CrmTimelineManager.getDefault().getOwnerInfo();\n\n\t\tBX.CrmActivityEditor.getDefault().addEmail(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t'ownerUrl': ownerInfo['SHOW_URL'],\n\t\t\t'ownerTitle': ownerInfo['TITLE'],\n\t\t\t'subject': '',\n\t\t}\n\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Social } from 'ui.icon-set.api.core';\n\nimport { ChatService } from './types';\n\nconst ServicesConfig: ReadonlyMap<string, ChatService> = new Map([\n\t[\n\t\t'telegrambot',\n\t\t{\n\t\t\tid: 'telegrambot',\n\t\t\tavailable: true,\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_TELEGRAM'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_TELEGRAM'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_TELEGRAM'),\n\t\t\tcommonClass: '--telegram',\n\t\t\ticonClass: Social.TELEGRAM_IN_CIRCLE,\n\t\t\ticonColor: '#2FC6F6',\n\t\t},\n\t],\n\t[\n\t\t'whatsappbyedna',\n\t\t{\n\t\t\tid: 'whatsappbyedna',\n\t\t\tavailable: false,\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_WHATSAPP'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_WHATSAPP'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_WHATSAPP'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_WHATSAPP'),\n\t\t\tcommonClass: '--whatsapp',\n\t\t\ticonClass: Social.WHATSAPP,\n\t\t},\n\t],\n\t[\n\t\t'vkgroup',\n\t\t{\n\t\t\tid: 'vkgroup',\n\t\t\tavailable: false,\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_VK'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_VK'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_VK'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_VK'),\n\t\t\tregion: 'ru',\n\t\t\tcommonClass: '--vk',\n\t\t\ticonClass: Social.VK,\n\t\t},\n\t],\n\t[\n\t\t'facebook',\n\t\t{\n\t\t\tid: 'facebook',\n\t\t\tavailable: false,\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_FACEBOOK'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_FACEBOOK'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_FACEBOOK'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_FACEBOOK'),\n\t\t\tregion: '!ru',\n\t\t\tcommonClass: '--facebook',\n\t\t\ticonClass: Social.FACEBOOK,\n\t\t},\n\t],\n]);\n\nexport default ServicesConfig;\n","import { Dom, Event, Loc, Reflection, Runtime } from 'main.core';\nimport { Guide } from 'ui.tour';\nimport './gotochat.css';\n\nconst UserOptions = Reflection.namespace('BX.userOptions');\n\nconst ARTICLE_CODE = '18114500';\n\n/** @memberof BX.Crm.Timeline.MenuBar.GoToChat */\nexport default class Tour\n{\n\t#guideBindElement: ?HTMLElement = null;\n\t#targetElementRect: ?DOMRect = null;\n\t#observerTimeoutId: number = null;\n\t#guide: ?Guide = null;\n\t#spotlight: ?BX.SpotLight = null;\n\n\tstatic show(): void\n\t{\n\t\tconst instance = new Tour();\n\n\t\tinstance.showGuide();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.onWindowResize = Runtime.debounce(this.onWindowResize.bind(this), 100);\n\n\t\tEvent.bind(window, 'resize', this.onWindowResize);\n\t}\n\n\tshowGuide(): void\n\t{\n\t\tthis.#spotlight = this.#createSpotlight();\n\t\tthis.#spotlight.show();\n\n\t\tthis.#guide = this.#createGuide(\n\t\t\tthis.getGuideBindElement(),\n\t\t\t{\n\t\t\t\tonClose: () => {\n\t\t\t\t\tUserOptions.save('crm', 'gotochat', 'isTimelineTourViewedInWeb', 1);\n\t\t\t\t\tthis.#spotlight.close();\n\t\t\t\t\tif (this.#observerTimeoutId)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearInterval(this.#observerTimeoutId);\n\t\t\t\t\t\tthis.#observerTimeoutId = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\tthis.#guide.showNextStep();\n\t}\n\n\tonWindowResize()\n\t{\n\t\tconst target = this.getGuideBindElement(true);\n\n\t\tthis.#guide.getCurrentStep().setTarget(target);\n\t\tthis.#guide.showNextStep();\n\n\t\tthis.#spotlight.setTargetElement(target);\n\t}\n\n\t#createSpotlight()\n\t{\n\t\treturn new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'spotlight-crm-timeline-gotochat-guide',\n\t\t\t\ttargetElement: this.getGuideBindElement(),\n\t\t\t\tautoSave: 'no',\n\t\t\t\ttargetVertex: 'middle-center',\n\t\t\t\tzIndex: 200,\n\t\t\t},\n\t\t);\n\t}\n\n\tgetGuideBindElement(force: boolean = false): HTMLElement\n\t{\n\t\tif (!this.#guideBindElement || force)\n\t\t{\n\t\t\tthis.#guideBindElement = document.querySelector('[data-id=\"gotochat\"]');\n\n\t\t\tif (this.#guideBindElement.offsetTop)\n\t\t\t{\n\t\t\t\tthis.#guideBindElement = this.#guideBindElement.parentElement.nextElementSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn this.#guideBindElement;\n\t}\n\n\t#createGuide(target: HTMLElement, guideEvents: Object = {}): Guide\n\t{\n\t\tconst guideText = {\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_GUIDE_TITLE'),\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_GUIDE_TEXT'),\n\t\t};\n\n\t\tconst guide = new Guide({\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget,\n\t\t\t\t\ttitle: guideText.title,\n\t\t\t\t\ttext: guideText.text,\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\tevents: guideEvents,\n\t\t\t\t\tarticle: ARTICLE_CODE,\n\t\t\t\t\tlinkTitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_GUIDE_ARTICLE_TITLE'),\n\t\t\t\t\trounded: true,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tconst guidePopup = guide.getPopup();\n\t\tguidePopup.setWidth(400);\n\n\t\tconst link = guidePopup.contentContainer.querySelector('.ui-tour-popup-link');\n\t\tDom.addClass(link, 'crm-entity-stream-content-new-detail-gotochat-guide-link');\n\n\t\tthis.#targetElementRect = Dom.getPosition(this.getGuideBindElement());\n\n\t\tthis.#observerTimeoutId = setInterval(this.handleTargetElementResize.bind(this), 1000);\n\n\t\treturn guide;\n\t}\n\n\thandleTargetElementResize()\n\t{\n\t\tconst currentRect = Dom.getPosition(this.getGuideBindElement());\n\n\t\tif (\n\t\t\tcurrentRect.left !== this.#targetElementRect.left\n\t\t\t|| currentRect.right !== this.#targetElementRect.right\n\t\t\t|| currentRect.top !== this.#targetElementRect.top\n\t\t\t|| currentRect.bottom !== this.#targetElementRect.bottom\n\t\t)\n\t\t{\n\t\t\tthis.#targetElementRect = Dom.getPosition(this.#guideBindElement);\n\n\t\t\tconst targetElement = this.#guideBindElement;\n\t\t\tconst isVisible = Boolean(\n\t\t\t\ttargetElement.offsetWidth\n\t\t\t\t|| targetElement.offsetHeight\n\t\t\t\t|| targetElement.getClientRects().length > 0\n\t\t\t);\n\n\t\t\tconst guidePopup = this.#guide.getPopup();\n\t\t\tif (isVisible)\n\t\t\t{\n\t\t\t\tDom.removeClass(guidePopup.popupContainer, '--hidden');\n\t\t\t\tguidePopup.adjustPosition();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.addClass(guidePopup.popupContainer, '--hidden');\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ClientSelector, Communication, CommunicationItem } from 'crm.client-selector';\nimport { ConditionChecker, Types as SenderTypes } from 'crm.messagesender';\nimport { ajax, Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { MenuItem, MenuItemOptions, MenuManager } from 'main.popup';\nimport { Dialog } from 'ui.entity-selector';\nimport 'ui.icon-set.actions';\nimport { Icon } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.social';\nimport Context from '../../context';\nimport Item from '../../item';\nimport './gotochat.css';\nimport ServicesConfig from './services-config';\nimport Tour from './tour';\nimport { Channel, ChatService, Config, Entity, OpenLinesList } from './types';\n\nconst MENU_ITEM_STUB_ID = 'stub';\nconst ACTIVE_MENU_ITEM_CLASS = 'menu-popup-item-accept';\nconst DEFAULT_MENU_ITEM_CLASS = 'menu-popup-item-none';\nconst TOOLBAR_CONTAINER_CLASS = 'crm-entity-stream-content-gotochat-toolbar-container';\nconst BUTTONS_CONTAINER_CLASS = 'crm-entity-stream-content-gotochat-buttons-container';\nconst CLIENTS_SELECTOR_TITLE_CLASS = 'crm-entity-stream-content-gotochat-clients-selector-title';\n\nconst HELP_ARTICLE_CODE = '18114500';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class GoToChat extends Item\n{\n\t#context: Context = null;\n\n\tselectedClient: Entity = null;\n\tsettingsMenu: Menu = null;\n\tchannels: Channel[] = [];\n\tcommunications: Communication[] = [];\n\tcurrentChannelId: ?string = null;\n\tfromPhoneId: ?string = null;\n\ttoName: ?string = null;\n\ttoPhoneId: ?string = null;\n\topenLineItems: OpenLinesList = null;\n\n\tisFetchedConfig: boolean = false;\n\tisSending: boolean = false;\n\n\t#chatServiceButtons: Map<string, HTMLElement> = new Map();\n\t#region: ?string = null;\n\t#isTourViewed: boolean = false;\n\t#entityEditor: ?BX.Crm.EntityEditor = null;\n\tcontactCenterUrl: string = '';\n\t#userSelectorDialog: ?BX.UI.EntitySelector.Dialog = null;\n\t#clientSelector: ?ClientSelector = null;\n\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tsuper.initialize(context, settings);\n\n\t\tthis.#context = context;\n\n\t\tthis.onSelectClient = this.onSelectClient.bind(this);\n\t\tthis.onSelectClientPhone = this.onSelectClientPhone.bind(this);\n\t\tthis.onSelectSender = this.onSelectSender.bind(this);\n\t\tthis.onSelectSenderPhone = this.onSelectSenderPhone.bind(this);\n\t}\n\n\tinitializeLayout()\n\t{\n\t\tsuper.initializeLayout();\n\n\t\tif (!this.#isTourViewed)\n\t\t{\n\t\t\tTour.show();\n\t\t}\n\n\t\tthis.#subscribeToReceiversChanges();\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#hideContent();\n\t\t\tthis.#removeCurrentClient();\n\n\t\t\tthis.#fetchConfig(true);\n\t\t});\n\t}\n\n\tinitializeSettings(): void\n\t{\n\t\tthis.#region = this.getSetting('region');\n\t\tthis.#isTourViewed = this.getSetting('isTourViewed');\n\t}\n\n\tactivate()\n\t{\n\t\tsuper.activate();\n\n\t\tthis.#fetchConfig();\n\t}\n\n\t#fetchConfig(force: boolean = false): void\n\t{\n\t\tif (this.isFetchedConfig && !force)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isFetchedConfig = false;\n\n\t\tif (!this.#context.getEntityId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst ajaxParameters = {\n\t\t\tentityTypeId: this.#context.getEntityTypeId(),\n\t\t\tentityId: this.#context.getEntityId(),\n\t\t};\n\n\t\tajax.runAction('crm.activity.gotochat.getConfig', { data: ajaxParameters })\n\t\t\t.then(({ data }) => {\n\t\t\t\tthis.isFetchedConfig = true;\n\t\t\t\tthis.#prepareParams(data);\n\t\t\t\tthis.#hideLoader();\n\t\t\t\tthis.adjustLayout();\n\t\t\t})\n\t\t\t.catch(() => this.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONFIG_ERROR')))\n\t\t;\n\t}\n\n\t#prepareParams(data: Config): void\n\t{\n\t\tconst {\n\t\t\tcurrentChannelId,\n\t\t\tchannels,\n\t\t\tcommunications,\n\t\t\topenLineItems,\n\t\t\tcontactCenterUrl,\n\t\t} = data;\n\n\t\tthis.currentChannelId = currentChannelId;\n\t\tthis.channels = channels;\n\t\tthis.communications = communications;\n\t\tthis.openLineItems = openLineItems;\n\t\tthis.contactCenterUrl = contactCenterUrl;\n\n\t\tthis.#setCommunicationsParams();\n\t\tthis.#setChannelDefaultPhoneId();\n\t}\n\n\t#setCommunicationsParams(): void\n\t{\n\t\tif (this.communications.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst communication = this.communications[0];\n\n\t\tif (Array.isArray(communication.phones) && communication.phones.length > 0)\n\t\t{\n\t\t\tthis.toPhoneId = communication.phones[0].id;\n\t\t}\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: communication.entityId,\n\t\t\tentityTypeId: communication.entityTypeId,\n\t\t};\n\n\t\tthis.toName = communication.caption;\n\t}\n\n\t#setChannelDefaultPhoneId(): void\n\t{\n\t\tconst channel = this.#getCurrentChannel();\n\n\t\tif (\n\t\t\t!channel\n\t\t\t|| !Array.isArray(channel.fromList)\n\t\t\t|| channel.fromList.length === 0\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { fromList } = channel;\n\t\tconst defaultPhone = fromList.find((item) => item.default);\n\n\t\tthis.fromPhoneId = defaultPhone ? defaultPhone.id : fromList[0].id;\n\t}\n\n\t#getCurrentChannel(): ?Channel\n\t{\n\t\tconst channel = this.channels.find((item) => item.id === this.currentChannelId);\n\n\t\treturn (channel ?? null);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-gotochat --hidden --skeleton\">\n\t\t\t<div class=\"crm-entity-stream-content-new-detail-gotochat-container hidden\">\n\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-settings-container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-clients-selector-container\">\n\t\t\t\t\t\t<div class=\"${CLIENTS_SELECTOR_TITLE_CLASS}\">\n\t\t\t\t\t\t\t${this.#getClientTitleHtmlElement()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-clients-selector-description\">\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CLIENT_SELECTOR_DESCRIPTION')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"${TOOLBAR_CONTAINER_CLASS}\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-link ui-btn-xs ui-btn-icon-help\"\n\t\t\t\t\t\t\tonclick=\"${this.#showHelp}\"\n\t\t\t\t\t\t></button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-link ui-btn-xs ui-btn-icon-setting\"\n\t\t\t\t\t\t\tonclick=\"${this.#showSettingsMenu.bind(this)}\"\n\t\t\t\t\t\t></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#getServiceButtons()}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\t#getClientTitleHtmlElement(): HTMLElement\n\t{\n\t\tconst clientStart = '<span id=\"crm-gotochat-client-selector\" class=\"crm-entity-stream-content-gotochat-user-selector-link\">';\n\t\tconst clientFinish = '</span>';\n\t\tconst titleContainer = Tag.render`\n\t\t\t<span>\n\t\t\t\t${Loc.getMessage(\n\t\t\t\t'CRM_TIMELINE_GOTOCHAT_CLIENT_SELECTOR_TITLE',\n\t\t\t{\n\t\t\t\t\t\t\t'[client]': clientStart,\n\t\t\t\t\t\t\t'[/client]': clientFinish,\n\t\t\t\t\t\t},\n\t\t\t\t)}\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(titleContainer.childNodes[0], 'click', this.onToggleClientSelector.bind(this));\n\n\t\treturn titleContainer;\n\t}\n\n\tonToggleClientSelector()\n\t{\n\t\tconst id = 'client-selector-dialog';\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tconst context = `CRM_TIMELINE_GOTOCHAT-${entityTypeId}`;\n\n\t\tif (!this.#userSelectorDialog)\n\t\t{\n\t\t\tthis.#userSelectorDialog = new Dialog({\n\t\t\t\tid,\n\t\t\t\tcontext,\n\t\t\t\ttargetNode: this.#getUserSelectorDialogTargetNode(),\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: false,\n\t\t\t\tshowAvatars: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\twidth: 450,\n\t\t\t\tzIndex: 2500,\n\t\t\t\tentities: this.#getClientSelectorEntities(),\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onSelectClient,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (this.#userSelectorDialog.isOpen())\n\t\t{\n\t\t\tthis.#userSelectorDialog.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#userSelectorDialog.setTargetNode(this.#getUserSelectorDialogTargetNode());\n\t\t\tthis.#userSelectorDialog.show();\n\t\t}\n\t}\n\n\t#getUserSelectorDialogTargetNode(): HTMLElement\n\t{\n\t\treturn document.getElementById('crm-gotochat-client-selector');\n\t}\n\n\t#getClientSelectorEntities(): Array\n\t{\n\t\tconst contact = {\n\t\t\tid: 'contact',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\tshowTab: true,\n\t\t\t\tshowPhones: true,\n\t\t\t\tshowMails: true,\n\t\t\t},\n\t\t};\n\n\t\tconst company = {\n\t\t\tid: 'company',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\texcludeMyCompany: true,\n\t\t\t\tshowTab: true,\n\t\t\t\tshowPhones: true,\n\t\t\t\tshowMails: true,\n\t\t\t},\n\t\t};\n\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tif (entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t{\n\t\t\treturn [company];\n\t\t}\n\n\t\tif (entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t{\n\t\t\treturn [contact];\n\t\t}\n\n\t\treturn [contact, company];\n\t}\n\n\tasync onSelectClient(event: BaseEvent)\n\t{\n\t\tconst { item } = event.getData();\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: item.id,\n\t\t\tentityTypeId: BX.CrmEntityType.resolveId(item.entityId),\n\t\t};\n\n\t\tconst isBound = await this.#bindClient();\n\t\tif (isBound)\n\t\t{\n\t\t\tthis.adjustLayout();\n\t\t\tBX.Crm.EntityEditor.getDefault().reload();\n\t\t}\n\t}\n\n\tasync #bindClient(): Promise\n\t{\n\t\tconst { entityId, entityTypeId } = this.#getOwnerEntity();\n\t\tconst { entityId: clientId, entityTypeId: clientTypeId } = this.selectedClient;\n\n\t\tconst ajaxParams = {\n\t\t\tentityId,\n\t\t\tentityTypeId,\n\t\t\tclientId,\n\t\t\tclientTypeId,\n\t\t};\n\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runAction('crm.activity.gotochat.bindClient', { data: ajaxParams })\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\tif (!data)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { channels, communications, currentChannelId } = data;\n\t\t\t\t\tthis.channels = channels;\n\t\t\t\t\tthis.communications = communications;\n\t\t\t\t\tthis.currentChannelId = currentChannelId;\n\n\t\t\t\t\tthis.#setCommunicationsParams();\n\t\t\t\t\tthis.#setChannelDefaultPhoneId();\n\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t\t.catch((data) => {\n\t\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showNotify(data.errors[0].message);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_BIND_CLIENT_ERROR'));\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#getOwnerEntity(): Entity\n\t{\n\t\tconst context = this.#context;\n\n\t\treturn {\n\t\t\tentityId: context.getEntityId(),\n\t\t\tentityTypeId: context.getEntityTypeId(),\n\t\t};\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showHelp(): void\n\t{\n\t\ttop.BX.Helper.show(`redirect=detail&code=${HELP_ARTICLE_CODE}`);\n\t}\n\n\t#showSettingsMenu(): void\n\t{\n\t\tif (!this.selectedClient)\n\t\t{\n\t\t\tthis.#showNotSelectedClientNotify();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.settingsMenu)\n\t\t{\n\t\t\tthis.initSettingsMenu();\n\t\t}\n\n\t\tthis.settingsMenu.show();\n\t}\n\n\tinitSettingsMenu(): void\n\t{\n\t\tconst menuId = 'crm-gotochat-channels-settings-menu';\n\t\tconst items = this.#getSubmenuStubItems();\n\n\t\tthis.settingsMenu = MenuManager.create({\n\t\t\tid: menuId,\n\t\t\tbindElement: document.querySelector(`.${TOOLBAR_CONTAINER_CLASS}`),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SETTINGS'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'channelSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SENDER_SELECTOR'),\n\t\t\t\t\titems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\t\tthis.#onSubMenuShow(event, this.getChannelsSubmenuItems());\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'phoneSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_NUMBER_SELECTOR'),\n\t\t\t\t\titems,\n\t\t\t\t\tdisabled: !Type.isArrayFilled(this.getPhoneSubMenuItems()),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\t\tthis.#onSubMenuShow(event, this.getPhoneSubMenuItems());\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#getSubmenuStubItems(): MenuItemOptions[]\n\t{\n\t\t// needed for emitted the onSubMenuShow event\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: MENU_ITEM_STUB_ID,\n\t\t\t},\n\t\t];\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#onSubMenuShow(event: BaseEvent, items: MenuItemOptions[]): void\n\t{\n\t\tconst target: MenuItem = event.getTarget();\n\n\t\tfor (const itemOptionsToAdd of items)\n\t\t{\n\t\t\ttarget.getSubMenu()?.addMenuItem(itemOptionsToAdd);\n\t\t}\n\n\t\ttarget.getSubMenu()?.removeMenuItem(MENU_ITEM_STUB_ID);\n\t}\n\n\tonShowClientPhoneSelector()\n\t{\n\t\tconst targetNode = document.getElementById('crm-gotochat-client-selector--selected');\n\n\t\tif (this.#clientSelector && this.#clientSelector.isOpen())\n\t\t{\n\t\t\tthis.#clientSelector.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#clientSelector = ClientSelector.createFromCommunications({\n\t\t\t\ttargetNode,\n\t\t\t\tcommunications: this.communications,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onSelectClientPhone,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#clientSelector\n\t\t\t\t.setSelected([this.toPhoneId])\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t}\n\n\tonSelectClientPhone(event: BaseEvent): void\n\t{\n\t\tconst { item: { id, customData } } = event.getData();\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: customData.get('entityId'),\n\t\t\tentityTypeId: customData.get('entityTypeId'),\n\t\t};\n\n\t\tthis.toName = this.getCurrentCommunication().caption;\n\t\tthis.toPhoneId = id;\n\n\t\tthis.adjustLayout();\n\t}\n\n\tgetCurrentPhone(): ?CommunicationItem\n\t{\n\t\tconst client = this.getCurrentCommunication();\n\n\t\tif (!client || !Type.isObjectLike(client.phones))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn client.phones.find((phone) => phone.id === this.toPhoneId);\n\t}\n\n\tgetCurrentCommunication(): ?Communication\n\t{\n\t\tif (!this.selectedClient)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { entityTypeId, entityId } = this.selectedClient;\n\n\t\treturn this.communications.find(\n\t\t\t(communication) => {\n\t\t\t\treturn (\n\t\t\t\t\tNumber(communication.entityTypeId) === Number(entityTypeId)\n\t\t\t\t\t&& Number(communication.entityId) === Number(entityId)\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\tadjustLayout(): void\n\t{\n\t\tthis.#adjustClientTitle();\n\t\tthis.#adjustChatServiceButtons();\n\t\tthis.#showContent();\n\t}\n\n\t#adjustClientTitle(): void\n\t{\n\t\tconst client = this.getCurrentCommunication();\n\t\tif (!client)\n\t\t{\n\t\t\tthis.#showContent();\n\t\t\tthis.#showAddClientTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst phone = this.getCurrentPhone();\n\t\tif (!phone)\n\t\t{\n\t\t\t/*\n\t\t\tnow the situation of the absence of the client’s phone\n\t\t\thas not been worked out by the product manager in any way\n\n\t\t\t@todo need handle this situation\n\t\t\t */\n\t\t\tthis.#showContent();\n\t\t\tthis.#showAddClientTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst clientElement = Tag.render`\n\t\t\t<span \n\t\t\t\tid=\"crm-gotochat-client-selector--selected\" \n\t\t\t\tclass=\"crm-entity-stream-content-gotochat-user-selector-link --selected\" \n\t\t\t\tonclick=\"${this.onShowClientPhoneSelector.bind(this)}\"\n\t\t\t>\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-entity-stream-content-gotochat-client-avatar\"\n\t\t\t\t\tstyle=\"background-image: url('${this.getEntityAvatarPath(client.entityTypeName.toLowerCase())}');\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t\t${Text.encode(client.caption)}, ${Text.encode(phone.valueFormatted)}\n\t\t\t\t<span class=\"crm-entity-stream-content-gotochat-client-chevron\"></span>\n\t\t\t</span>\n\t\t`;\n\t\tconst titleContainer = Tag.render`\n\t\t\t<span>\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SELECTED_CLIENT_TITLE')}\n\t\t\t</span>\n\t\t`;\n\t\tconst titleElement = titleContainer.firstChild;\n\n\t\tconst labelIndex = titleElement.textContent.indexOf('#CLIENT_NAME#');\n\t\ttitleElement.nodeValue = titleElement.nodeValue.replace('#CLIENT_NAME#', '');\n\n\t\tDom.insertBefore(clientElement, titleElement.splitText(labelIndex));\n\n\t\tconst container = document.querySelector(`.${CLIENTS_SELECTOR_TITLE_CLASS}`);\n\t\tDom.clean(container);\n\t\tDom.append(titleContainer, container);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showContent(): void\n\t{\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat-container'),\n\t\t\t'hidden',\n\t\t);\n\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat'),\n\t\t\t'--skeleton',\n\t\t);\n\t}\n\n\t#showAddClientTitle(): void\n\t{\n\t\tconst container = document.querySelector(`.${CLIENTS_SELECTOR_TITLE_CLASS}`);\n\t\tDom.clean(container);\n\t\tDom.append(this.#getClientTitleHtmlElement(), container);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#hideContent(): void\n\t{\n\t\tDom.addClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat-container'),\n\t\t\t'hidden',\n\t\t);\n\n\t\tDom.addClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat'),\n\t\t\t'--skeleton',\n\t\t);\n\t}\n\n\t#removeCurrentClient(): void\n\t{\n\t\tthis.selectedClient = null;\n\t\tthis.fromPhoneId = null;\n\t}\n\n\t#adjustChatServiceButtons(): void\n\t{\n\t\tconst oldContainer = document.querySelector(`.${BUTTONS_CONTAINER_CLASS}`);\n\t\tconst newContainer = this.#getServiceButtons();\n\n\t\tDom.replace(oldContainer, newContainer);\n\t}\n\n\t#getServiceButtons(): HTMLElement\n\t{\n\t\tthis.#fillChatServiceButtons();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"${BUTTONS_CONTAINER_CLASS}\">\n\t\t\t\t${[...this.#chatServiceButtons.values()]}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#fillChatServiceButtons(): void\n\t{\n\t\tServicesConfig.forEach((service: ChatService) => {\n\t\t\tif (!this.#isServiceSupportedInRegion(service))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst button = this.#createChatServiceButton(service);\n\t\t\tthis.#chatServiceButtons.set(service.id, button);\n\t\t});\n\t}\n\n\t#isServiceSupportedInRegion(service: ChatService): boolean\n\t{\n\t\tif (!service.region || !this.#region)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (service.region !== this.#region && service.region[0] !== '!')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (service.region !== `!${this.#region}`);\n\t}\n\n\t#createChatServiceButton(service: ChatService): HTMLElement\n\t{\n\t\tlet className = service.commonClass;\n\t\tlet label = service.connectLabel;\n\n\t\tif (!service.available)\n\t\t{\n\t\t\tclassName += ' --disabled';\n\t\t\tlabel = service.soonLabel;\n\t\t}\n\t\telse if (this.#isServiceSelected(service))\n\t\t{\n\t\t\tclassName += ' --ready';\n\t\t\tlabel = service.inviteLabel;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"crm-entity-stream-content-gotochat-button\"\n\t\t\t\tonclick=\"${this.showRegistrarAndSend.bind(this, service.id)}\"\n\t\t\t>\n\t\t\t\t<button \n\t\t\t\t\tclass=\"crm-entity-stream-content-new-detail-gotochat_button ${className}\"\n\t\t\t\t\tdata-code=\"${service.id}\"\n\t\t\t\t>\n\t\t\t\t\t${this.#renderButtonIcon(service)}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-new-detail-gotochat_button-text\">${label}</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderButtonIcon(service: ChatService | undefined): HTMLElement\n\t{\n\t\tif (!service)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst icon = new Icon({\n\t\t\ticon: service.iconClass,\n\t\t\tsize: 40,\n\t\t\tcolor: this.#getButtonIconColor(service),\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<i class=\"crm-entity-stream-content-new-detail-gotochat_button-icon\">\n\t\t\t\t${icon.render()}\n\t\t\t</i>\n\t\t`;\n\t}\n\n\t#getButtonIconColor(service: ChatService): string\n\t{\n\t\tif (!service.available)\n\t\t{\n\t\t\treturn getComputedStyle(document.body).getPropertyValue('--ui-color-base-40');\n\t\t}\n\n\t\tif (this.#isServiceSelected(service))\n\t\t{\n\t\t\treturn getComputedStyle(document.body).getPropertyValue('--ui-color-background-primary');\n\t\t}\n\n\t\treturn service.iconColor;\n\t}\n\n\t#isServiceSelected(service: ChatService): boolean\n\t{\n\t\treturn (\n\t\t\tthis.openLineItems\n\t\t\t&& this.openLineItems[service.id]\n\t\t\t&& this.openLineItems[service.id].selected\n\t\t);\n\t}\n\n\tasync showRegistrarAndSend(code: string): Promise<void>\n\t{\n\t\tif (this.isSending || !this.#isAvailableService(code))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isEntityInEditorMode())\n\t\t{\n\t\t\tawait this.#showEditorInEditModePopup();\n\t\t}\n\n\t\tif (!this.selectedClient)\n\t\t{\n\t\t\tthis.#showNotSelectedClientNotify();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.toPhoneId)\n\t\t{\n\t\t\tconst content = Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CLIENT_HAVE_NO_PHONE');\n\t\t\tthis.#showNotify(content);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showButtonLoader(code);\n\n\t\tconst lineId = await ConditionChecker.checkAndGetLine({\n\t\t\topenLineCode: code,\n\t\t\tsenderType: this.getSenderType(),\n\t\t\topenLineItems: this.openLineItems,\n\t\t});\n\n\t\tif (lineId)\n\t\t{\n\t\t\tthis.send(lineId, code);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#restoreButton(code);\n\t\t}\n\t}\n\n\t#isAvailableService(code: string): boolean\n\t{\n\t\treturn ServicesConfig.get(code)?.available;\n\t}\n\n\t#isEntityInEditorMode(): boolean\n\t{\n\t\treturn (this.#getEntityEditor().getMode() === BX.UI.EntityEditorMode.edit);\n\t}\n\n\tasync #showEditorInEditModePopup(): Promise\n\t{\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tconst entityType = BX.CrmEntityType.resolveName(entityTypeId);\n\t\tconst message = (\n\t\t\tLoc.getMessage(`CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_TEXT_${entityType}`)\n\t\t\t|| Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_TEXT')\n\t\t);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.UI.Dialogs.MessageBox.show({\n\t\t\t\tmodal: true,\n\t\t\t\tmessage,\n\t\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_SAVE_AND_CONTINUE'),\n\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\tthis.saveEntityEditor();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tcancelCaption: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_FORCE_CONTINUE'),\n\t\t\t\tonCancel: function(messageBox) {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tsaveEntityEditor(): void\n\t{\n\t\tthis.#getEntityEditor().saveChanged();\n\t}\n\n\t#getEntityEditor(): BX.Crm.EntityEditor\n\t{\n\t\tif (!this.#entityEditor)\n\t\t{\n\t\t\tthis.#entityEditor = BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn this.#entityEditor;\n\t}\n\n\t#showNotSelectedClientNotify(): void\n\t{\n\t\tconst content = Loc.getMessage('CRM_TIMELINE_GOTOCHAT_NO_SELECTED_CLIENT');\n\t\tthis.#showNotify(content);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showNotify(content: string): void\n\t{\n\t\tBX.UI.Notification.Center.notify({ content });\n\t}\n\n\tsend(lineId: string, code: string): void\n\t{\n\t\tthis.isSending = true;\n\n\t\tconst { entityTypeId: ownerTypeId, entityId: ownerId } = this.#getOwnerEntity();\n\t\tconst senderType = this.getSenderType();\n\t\tconst senderId = this.currentChannelId;\n\t\tconst from = this.fromPhoneId;\n\t\tconst to = this.toPhoneId;\n\n\t\tconst ajaxParameters = {\n\t\t\townerTypeId,\n\t\t\townerId,\n\t\t\tparams: {\n\t\t\t\tsenderType,\n\t\t\t\tsenderId,\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\tlineId,\n\t\t\t},\n\t\t};\n\n\t\tajax.runAction('crm.activity.gotochat.send', { data: ajaxParameters })\n\t\t\t.then(() => {\n\t\t\t\tthis.isSending = false;\n\n\t\t\t\tthis.#setOpenLineItemIsSelected(code);\n\t\t\t\tthis.#restoreButton(code);\n\n\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SEND_SUCCESS'));\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t})\n\t\t\t.catch((data) => {\n\t\t\t\tthis.isSending = false;\n\t\t\t\tthis.#restoreButton(code);\n\n\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#showNotify(data.errors[0].message);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SEND_ERROR'));\n\t\t\t})\n\t\t;\n\t}\n\n\t#setOpenLineItemIsSelected(code: string): void\n\t{\n\t\tthis.openLineItems[code].selected = true;\n\t}\n\n\t#restoreButton(code: string): void\n\t{\n\t\tconst oldButton = this.#chatServiceButtons.get(code);\n\t\tconst newButton = this.#createChatServiceButton(ServicesConfig.get(code));\n\n\t\tthis.#chatServiceButtons.set(code, newButton);\n\n\t\tDom.replace(oldButton, newButton);\n\t}\n\n\tshowButtonLoader(code: string): void\n\t{\n\t\tconst button = this.#chatServiceButtons.get(code);\n\t\tDom.addClass(button?.firstElementChild, '--loading');\n\t}\n\n\tgetSenderType(): string\n\t{\n\t\treturn (this.currentChannelId === SenderTypes.bitrix24 ? SenderTypes.bitrix24 : SenderTypes.sms);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetEntityAvatarPath(entityTypeName: string): string\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tentityTypeName = entityTypeName.toLowerCase();\n\n\t\tconst whiteList = [\n\t\t\t'contact',\n\t\t\t'company',\n\t\t\t'lead',\n\t\t];\n\n\t\tif (!whiteList.includes(entityTypeName))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn `/bitrix/images/crm/entity_provider_icons/${entityTypeName}.svg`;\n\t}\n\n\tgetChannelsSubmenuItems(): MenuItemOptions[]\n\t{\n\t\tconst items = [];\n\t\tthis.channels.forEach(({ id, shortName: text, canUse, fromList }) => {\n\t\t\tconst className = (id === this.currentChannelId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\t\titems.push({\n\t\t\t\tid,\n\t\t\t\ttext,\n\t\t\t\tclassName,\n\t\t\t\tdisabled: !canUse || !Type.isArrayFilled(fromList),\n\t\t\t\tonclick: this.onSelectSender,\n\t\t\t});\n\t\t});\n\n\t\treturn [\n\t\t\t...items,\n\t\t\t{\n\t\t\t\tid: 'connectOtherSenderDelimiter',\n\t\t\t\tdelimiter: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'connectOtherSender',\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_OTHER_SENDER_SERVICE'),\n\t\t\t\tclassName: DEFAULT_MENU_ITEM_CLASS,\n\t\t\t\tonclick: () => BX.SidePanel.Instance.open(this.contactCenterUrl),\n\t\t\t},\n\t\t];\n\t}\n\n\tonSelectSender(event, item)\n\t{\n\t\tconst { id } = item;\n\n\t\tthis.currentChannelId = id;\n\n\t\tconst channel = this.#getChannelById(id);\n\t\tthis.fromPhoneId = channel.fromList[0].id;\n\n\t\tthis.settingsMenu.close();\n\t}\n\n\tgetPhoneSubMenuItems(): Array\n\t{\n\t\tconst currentChannel = this.#getChannelById(this.currentChannelId);\n\n\t\tconst items = [];\n\t\tcurrentChannel.fromList.forEach(({ id, name: text }) => {\n\t\t\tconst className = (id === this.fromPhoneId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\t\titems.push({\n\t\t\t\tid,\n\t\t\t\ttext,\n\t\t\t\tclassName,\n\t\t\t\tonclick: this.onSelectSenderPhone,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getChannelById(id: string): Channel\n\t{\n\t\treturn this.channels.find((channel) => channel.id === id);\n\t}\n\n\tonSelectSenderPhone(event, item)\n\t{\n\t\tconst { id } = item;\n\n\t\tthis.fromPhoneId = id;\n\n\t\tthis.settingsMenu.close();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tcolor: '#2fc6f6',\n\t\t\t\tsize: 36,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tonHide(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.destroy();\n\t\t}\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tvoid this.loader.hide();\n\t\t}\n\t}\n}\n","import Item from '../item';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Market extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.rest.Marketplace.open({\n\t\t\tPLACEMENT: this.getSetting('placement', '')\n\t\t});\n\n\t\ttop.BX.addCustomEvent(top, 'Rest:AppLayout:ApplicationInstall', this.#fireUpdateEvent.bind(this));\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#fireUpdateEvent()\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\t\tconst entityId = this.getEntityId();\n\n\t\tsetTimeout(function(){\n\t\t\tconsole.log('fireUpdate', entityId, entityTypeId);\n\t\t\tBX.Crm.EntityEvent.fire(BX.Crm.EntityEvent.names.invalidate, entityTypeId, entityId, '');\n\t\t}, 3000);\n\t}\n}\n","import Item from '../item';\n\nexport default class Meeting extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.meeting,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class RestPlacement extends Item\n{\n\t#interfaceInitialized: Boolean = false;\n\n\tshowSlider(): void\n\t{\n\t\tif (!this.#interfaceInitialized)\n\t\t{\n\t\t\tthis.#interfaceInitialized = true;\n\t\t\tthis.#initializeInterface();\n\t\t}\n\n\t\tconst appId = this.getSetting('appId', '');\n\n\t\tBX.rest.AppLayout.openApplication(\n\t\t\tappId,\n\t\t\t{\n\t\t\t\tID: this.getEntityId()\n\t\t\t},\n\t\t\t{\n\t\t\t\tPLACEMENT: this.getSetting('placement', ''),\n\t\t\t\tPLACEMENT_ID: this.getSetting('placementId', ''),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#initializeInterface()\n\t{\n\t\tif (!!top.BX.rest && !!top.BX.rest.AppLayout)\n\t\t{\n\t\t\tconst PlacementInterface = top.BX.rest.AppLayout.initializePlacement(this.getSetting('placement', ''));\n\n\t\t\tif (!PlacementInterface.prototype.reloadData)\n\t\t\t{\n\t\t\t\tconst entityTypeId = this.getEntityTypeId();\n\t\t\t\tconst entityId = this.getEntityId();\n\n\t\t\t\tPlacementInterface.prototype.reloadData = function(params, cb)\n\t\t\t\t{\n\t\t\t\t\tBX.Crm.EntityEvent.fireUpdate(entityTypeId, entityId, '');\n\t\t\t\t\tcb();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Tag, Event, Loc, Type, Dom, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuManager } from \"main.popup\";\nimport WithEditor from \"./witheditor\";\nimport { Guide } from \"ui.tour\";\nimport Context from \"../context\";\nimport { DialogNew } from 'calendar.sharing.interface';\nimport { ConditionChecker, Types as SenderTypes, OpenLineCodes } from 'crm.messagesender';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Sharing extends WithEditor\n{\n\tHELPDESK_CODE = 17502612;\n\n\t/**\n\t * @override\n\t */\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tconst config = settings.config;\n\n\t\tthis.link = config.link;\n\t\tthis.calendarSettings = config.calendarSettings;\n\t\tthis.isResponsible = config.isResponsible;\n\t\tthis.setContacts(config.contacts);\n\t\tthis.isNotificationsAvailable = config.isNotificationsAvailable;\n\t\tthis.areCommunicationChannelsAvailable = config.areCommunicationChannelsAvailable;\n\t\tthis.setCommunicationChannels(config.communicationChannels, config.selectedChannelId);\n\t\tthis.doPayAttentionToNewFeature = config.doPayAttentionToNewFeature;\n\n\t\tsuper.initialize(context, settings);\n\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tthis.bindEvents();\n\t\t}\n\t}\n\n\tactivate()\n\t{\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tthis.setVisible(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.UI?.InfoHelper?.show('limit_crm_calendar_free_slots');\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isAvailable');\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('CalendarSharing:LinkCopied', () => this.onLinkCopied());\n\t\tEventEmitter.subscribe('CalendarSharing:RuleUpdated', () => this.onRuleUpdated());\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.onContactsChangedHandler.bind(this));\n\t}\n\n\t/**\n\t * @override\n\t */\n\tdoInitialize()\n\t{\n\t\tif (this.doPayAttentionToNewFeature)\n\t\t{\n\t\t\tthis.payAttentionToNewFeature();\n\t\t\tBX.ajax.runAction('crm.api.timeline.calendar.sharing.disableOptionPayAttentionToNewCrmSharingFeature');\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.DOM = {\n\t\t\tmenuBarItem: document.querySelector('.crm-entity-stream-section-menu [data-id=sharing]'),\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-sharing crm-entity-stream-content-wait-detail --hidden\">\n\t\t\t\t<div id=\"_sharing_content_container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-container\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-main\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info\">\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-header\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_TITLE')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-icon\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-text\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_1')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-icon\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-text\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_2')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-btn-settings\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-icon-qr\"></div>\n\t\t\t\t\t\t\t\t\t${this.createConfigureSlotsButton()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${this.createSettingsButton()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-btn-container\">\n\t\t\t\t\t${this.createSendButton()}\n\t\t\t\t\t${this.createCancelButton()}\n\t\t\t\t\t${this.createMoreInfoButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateConfigureSlotsButton()\n\t{\n\t\tthis.DOM.configureSlotsButton = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-btn-settings-text\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_CONFIGURE_SLOTS')}\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(this.DOM.configureSlotsButton, 'click', () => this.onConfigureSlotsButtonClick());\n\n\t\treturn this.DOM.configureSlotsButton;\n\t}\n\n\tcreateSettingsButton()\n\t{\n\t\tthis.DOM.settingsButton = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-icon\"></div>\n\t\t`;\n\t\tthis.updateSettingsButton();\n\n\t\tEvent.bind(this.DOM.settingsButton, 'click', () => this.onSettingsButtonClick());\n\n\t\treturn this.DOM.settingsButton;\n\t}\n\n\tupdateSettingsButton()\n\t{\n\t\tif (this.isContactAvailable())\n\t\t{\n\t\t\tthis.DOM.settingsButton.style.display = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.DOM.settingsButton.style.display = 'none';\n\t\t}\n\t}\n\n\tcreateSendButton()\n\t{\n\t\tthis.DOM.sendButton = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SEND_BUTTON')}\n\t\t\t</button>\n\t\t`;\n\t\tEvent.bind(this.DOM.sendButton, 'click', () => this.onSendButtonClick());\n\n\t\tthis._saveButton = this.DOM.sendButton;\n\n\t\treturn this.DOM.sendButton;\n\t}\n\n\tcreateCancelButton()\n\t{\n\t\tthis.DOM.cancelButton = Tag.render`\n\t\t\t<span class=\"ui-btn ui-btn-xs ui-btn-link\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_CANCEL_BUTTON')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(this.DOM.cancelButton, 'click', () => this.onCancelButtonClick());\n\n\t\tthis._cancelButton = this.DOM.cancelButton;\n\n\t\treturn this.DOM.cancelButton;\n\t}\n\n\tcreateMoreInfoButton()\n\t{\n\t\tthis.DOM.moreInfoButton = Tag.render`\n\t\t\t<span class=\"crm-entity-stream-calendar-sharing-more-btn\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_MORE_INFO_BUTTON')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(this.DOM.moreInfoButton, 'click', () => this.onMoreInfoButtonClick());\n\n\t\treturn this.DOM.moreInfoButton;\n\t}\n\n\tonConfigureSlotsButtonClick()\n\t{\n\t\tthis.showConfigureSlotsPopup();\n\t}\n\n\tonSettingsButtonClick()\n\t{\n\t\tthis.showSettingsPopup();\n\t}\n\n\tasync onSendButtonClick()\n\t{\n\t\tif (!this.isContactAvailable())\n\t\t{\n\t\t\tthis.showWarningNoContact();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!this.areCommunicationChannelsAvailable\n\t\t\t&& this.isNotificationsAvailable\n\t\t\t&& this.isChannelsAvailable()\n\t\t)\n\t\t{\n\t\t\tconst bitrix24Channel = this.channels.find((channel) => {\n\t\t\t\treturn this.isChannelBitrix24(channel);\n\t\t\t});\n\n\t\t\tif (bitrix24Channel)\n\t\t\t{\n\t\t\t\tconst isApproved = await this.isBitrix24Approved();\n\n\t\t\t\tif (isApproved)\n\t\t\t\t{\n\t\t\t\t\tthis.channel = bitrix24Channel;\n\t\t\t\t\tthis.updateSenderList();\n\t\t\t\t\tthis.onSaveButtonClick();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.areCommunicationChannelsAvailable)\n\t\t{\n\t\t\tthis.showWarningNoCommunicationChannels();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.isNotificationsAvailable\n\t\t\t&& this.isChannelBitrix24(this.channel)\n\t\t)\n\t\t{\n\t\t\tconst isApproved = await this.isBitrix24Approved();\n\n\t\t\tif (isApproved)\n\t\t\t{\n\t\t\t\tthis.onSaveButtonClick();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showWarningNoCommunicationChannels();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.onSaveButtonClick();\n\t}\n\n\tonLinkCopied()\n\t{\n\t\tthis.saveLinkAction({\n\t\t\tisActionCopy: true,\n\t\t});\n\t}\n\n\tonRuleUpdated()\n\t{\n\t\tthis.onRuleUpdatedAction();\n\t}\n\n\tonMoreInfoButtonClick()\n\t{\n\t\tthis.openHelpDesk();\n\t}\n\n\tshowConfigureSlotsPopup()\n\t{\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.DOM.configureSlotsButton,\n\t\t\t\tsharingUrl: this.link.url,\n\t\t\t\tsharingRule: this.link.rule,\n\t\t\t\tlinkHash: this.link.hash,\n\t\t\t\tcontext: \"crm\",\n\t\t\t\treadOnly: !this.isResponsible,\n\t\t\t\tcalendarSettings: this.calendarSettings,\n\t\t\t});\n\t\t}\n\t\tthis.newDialog.show();\n\t}\n\n\tshowSettingsPopup()\n\t{\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tthis.settingsMenu.destroy();\n\t\t}\n\t\tthis.settingsMenu = this.getSettingsMenu();\n\t\tthis.settingsMenu.show();\n\t}\n\n\tisSettingsPopupShown()\n\t{\n\t\treturn this.settingsMenu?.popupWindow.isShown();\n\t}\n\n\tgetSettingsMenu()\n\t{\n\t\tconst items = [this.getSharingReceiverItem()];\n\n\t\tif (this.areCommunicationChannelsAvailable && this.isChannelsAvailable())\n\t\t{\n\t\t\titems.push(this.getSharingChannelsItem());\n\t\t}\n\n\t\tif (this.currentFromList)\n\t\t{\n\t\t\titems.push(this.getSharingSenderItem());\n\t\t}\n\n\t\treturn MenuManager.create({\n\t\t\tid: 'crm-calendar-sharing-settings',\n\t\t\tbindElement: this.DOM.settingsButton,\n\t\t\titems: items\n\t\t});\n\t}\n\n\tgetSharingReceiverItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_receiver',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_RECEIVER'),\n\t\t\titems: this.contacts.map((contact) => {\n\t\t\t\treturn this.getContactMenuItem(contact);\n\t\t\t})\n\t\t};\n\t}\n\n\tgetSharingChannelsItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_channels',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COMMUNICATION_CHANNELS'),\n\t\t\titems: this.channels.map((channel) => {\n\t\t\t\treturn this.getChannelMenuItem(channel);\n\t\t\t}),\n\t\t}\n\t}\n\n\tgetSharingSenderItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_sender',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SENDER'),\n\t\t\titems: this.currentFromList.map((from) => {\n\t\t\t\treturn this.getFromMenuItem(from);\n\t\t\t}),\n\t\t};\n\t}\n\n\tgetContactMenuItem(contact)\n\t{\n\t\tconst isSelected = contact.entityId === this.contact.entityId && contact.entityTypeId === this.contact.entityTypeId;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(`${contact.name} (${contact.phone})`)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tcontact.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(contact.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.contact.check, '--show');\n\t\t\t\tDom.addClass(contact.check, '--show');\n\t\t\t\tthis.contact = contact;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetChannelMenuItem(channel)\n\t{\n\t\tconst isSelected = channel.id === this.channel.id;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(channel.name)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tchannel.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(channel.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.channel.check, '--show');\n\t\t\t\tDom.addClass(channel.check, '--show');\n\t\t\t\tthis.channel = channel;\n\n\t\t\t\tthis.updateSenderList();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetFromMenuItem(from)\n\t{\n\t\tconst isSelected = from.id === this.currentFrom.id;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(from.name)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tfrom.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(from.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.currentFrom.check, '--show');\n\t\t\t\tDom.addClass(from.check, '--show');\n\t\t\t\tthis.currentFrom = from;\n\t\t\t},\n\t\t};\n\t}\n\n\tshowWarningNoCommunicationChannels()\n\t{\n\t\tlet title;\n\t\tlet text;\n\n\t\tif (this.isNotificationsAvailable)\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_1')}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE_1').replaceAll('/marketplace/', Loc.getMessage('MARKET_BASE_PATH'))}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst noCommunicationChannelsWarningGuide = this.getWarningGuide(title, text);\n\t\tnoCommunicationChannelsWarningGuide.showNextStep();\n\n\t\tconst guidePopup = noCommunicationChannelsWarningGuide.getPopup();\n\t\tconst guideContentContainer = guidePopup.getContentContainer();\n\t\tconst openConfigurationButton = guideContentContainer.querySelector('span[data-role=crm-timeline-calendar-sharing_open-configure-slots]');\n\t\topenConfigurationButton.addEventListener('click', () => {\n\t\t\tguidePopup.close();\n\t\t\tthis.showConfigureSlotsPopup();\n\t\t});\n\t}\n\n\tshowWarningNoContact()\n\t{\n\t\tconst title = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TITLE');\n\t\tconst text = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TEXT');\n\t\tconst noContactWarningGuide = this.getWarningGuide(title, text);\n\t\tnoContactWarningGuide.showNextStep();\n\t}\n\n\tupdateSenderList()\n\t{\n\t\tthis.currentFromList = this.channel.fromList;\n\t\tthis.currentFrom = this.channel.fromList[0];\n\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tthis.settingsMenu.removeMenuItem('sharing_sender');\n\t\t\tconst item = this.getSharingSenderItem();\n\t\t\tthis.settingsMenu.addMenuItem(item);\n\t\t}\n\t}\n\n\tcopyLink(link)\n\t{\n\t\tBX.clipboard.copy(link);\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COPY_LINK_NOTIFICATION'),\n\t\t});\n\t\tEventEmitter.emit('CalendarSharing:LinkCopied');\n\t}\n\n\t/**\n\t * @override\n\t */\n\tsave(): Promise\n\t{\n\t\treturn this.saveLinkAction();\n\t}\n\n\tsaveLinkAction(options = { isActionCopy: false })\n\t{\n\t\tlet action;\n\t\tlet data = {\n\t\t\townerId: this.getEntityId(),\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\truleArray: this.getSharingRule(),\n\t\t};\n\n\t\tif (this.isContactAvailable() && this.isChannelsAvailable() && !options.isActionCopy)\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.sendLink';\n\t\t\tdata.contactId = this.contact.entityId || null;\n\t\t\tdata.contactTypeId = this.contact.entityTypeId || null;\n\t\t\tdata.channelId = this.channel.id || null;\n\t\t\tdata.senderId = this.currentFrom.id || null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.onLinkCopied';\n\t\t\tdata.linkHash = this.link.hash;\n\t\t}\n\n\t\treturn BX.ajax.runAction(action, { data }).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}, (error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonRuleUpdatedAction()\n\t{\n\t\treturn BX.ajax.runAction('crm.api.timeline.calendar.sharing.onRuleUpdated', {\n\t\t\tdata: {\n\t\t\t\tlinkHash: this.link.hash,\n\t\t\t\townerId: this.getEntityId(),\n\t\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\t},\n\t\t}).then((response) => {}, (error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tgetSharingRule()\n\t{\n\t\treturn this.newDialog?.getSettingsControlRule() ?? this.link.rule;\n\t}\n\n\tonContactsChangedHandler(event)\n\t{\n\t\tconst { item, current } = event.getData();\n\n\t\tconst isCurrentDeal = this.getEntityTypeId() === item?.entityTypeId && this.getEntityId() === item?.entityId;\n\t\tif (!isCurrentDeal || !Type.isArray(current))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst phoneReceivers = current.filter(receiver => receiver.address.typeId === 'PHONE');\n\n\t\tconst contacts = [];\n\t\tconst contactsHashes = [];\n\t\tfor (const receiver of phoneReceivers)\n\t\t{\n\t\t\tif (contactsHashes.includes(receiver.addressSource.hash))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tcontactsHashes.push(receiver.addressSource.hash);\n\n\t\t\tcontacts.push({\n\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\tname: receiver.addressSourceData?.title,\n\t\t\t\tphone: receiver.address.value,\n\t\t\t});\n\t\t}\n\n\t\tthis.setContacts(contacts);\n\n\t\tthis.updateSettingsButton();\n\t\tif (this.isSettingsPopupShown())\n\t\t{\n\t\t\tthis.showSettingsPopup();\n\t\t}\n\t}\n\n\tsetContacts(contacts)\n\t{\n\t\tthis.contacts = contacts.filter(contact => contact.entityId && contact.entityTypeId && contact.phone && contact.name)\n\t\t\t.sort((a, b) => a.entityId - b.entityId) // sort by id\n\t\t\t.sort((a, b) => a.entityTypeId - b.entityTypeId); // sort company last\n\n\t\tthis.contact = contacts.find((contact) => {\n\t\t\treturn contact.entityTypeId === this.contact?.entityTypeId && contact.entityId === this.contact?.entityId;\n\t\t}) ?? this.contacts[0];\n\t}\n\n\tsetCommunicationChannels(channels, selectedId)\n\t{\n\t\tthis.channels = channels || [];\n\n\t\tif (selectedId)\n\t\t{\n\t\t\tthis.channel = channels.find((channel) => {\n\t\t\t\treturn channel.id === selectedId\n\t\t\t}) ?? this.channels[0];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.channel = this.channels ? this.channels[0] : null;\n\t\t}\n\n\t\tif (this.channel && this.channel.fromList)\n\t\t{\n\t\t\tthis.currentFromList = this.channel.fromList;\n\t\t\tthis.currentFrom = this.channel.fromList[0];\n\t\t}\n\t}\n\n\tisContactAvailable()\n\t{\n\t\treturn Type.isArrayFilled(this.contacts);\n\t}\n\n\tisChannelsAvailable()\n\t{\n\t\treturn Type.isArrayFilled(this.channels);\n\t}\n\n\tisChannelBitrix24(channel)\n\t{\n\t\treturn channel.id === SenderTypes.bitrix24;\n\t}\n\n\tasync isBitrix24Approved()\n\t{\n\t\treturn await ConditionChecker.checkIsApproved({\n\t\t\topenLineCode: OpenLineCodes.notifications,\n\t\t\tsenderType: SenderTypes.bitrix24,\n\t\t});\n\t}\n\n\topenHelpDesk()\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${this.HELPDESK_CODE}`);\n\t\t}\n\t}\n\n\tgetWarningGuide(title, text)\n\t{\n\t\tconst warningGuide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.DOM.sendButton,\n\t\t\t\t\ttitle,\n\t\t\t\t\ttext,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'warning',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = warningGuide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'crm-calendar-sharing-configure-slots-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(390);\n\t\tconst guideContent = guidePopup.getContentContainer().firstElementChild;\n\t\tconst offsetFromCloseIcon = parseInt(getComputedStyle(guidePopup.closeIcon)['width']);\n\t\tconst existingPadding = parseInt(getComputedStyle(guideContent)['paddingRight']);\n\t\tguidePopup.getContentContainer().style.paddingRight = (offsetFromCloseIcon - existingPadding) + 'px';\n\t\tguidePopup.setAutoHide(true);\n\n\t\tguidePopup.subscribe('onAfterShow', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst arrowContainer = guidePopup.angle.element;\n\t\t\t\tconst arrow = arrowContainer.firstElementChild;\n\t\t\t\tarrow.style.border = '2px solid var(--ui-color-text-warning, #ffa900)';\n\n\t\t\t\tif (guidePopup.getContentContainer().getBoundingClientRect().top > this.DOM.sendButton.getBoundingClientRect().top)\n\t\t\t\t{\n\t\t\t\t\tconst condition = guidePopup.getContentContainer().querySelector('.ui-tour-popup-condition-bottom');\n\t\t\t\t\tcondition.className = 'ui-tour-popup-condition-top';\n\t\t\t\t\tarrowContainer.style.top = '-20px';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tarrowContainer.style.bottom = '-18px';\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t});\n\n\t\treturn warningGuide;\n\t}\n\n\tpayAttentionToNewFeature()\n\t{\n\t\tconst guide = this.getGuide();\n\t\tconst pulsar = this.getPulsar();\n\n\t\tsetTimeout(() => {\n\t\t\tguide.showNextStep();\n\t\t\tpulsar.show();\n\t\t}, 1000);\n\t}\n\n\tgetGuide()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.DOM.menuBarItem,\n\t\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TEXT'),\n\t\t\t\t\tarticle: this.HELPDESK_CODE,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = guide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'crm-calendar-sharing-configure-slots-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(400);\n\t\tguidePopup.getContentContainer().style.paddingRight = getComputedStyle(guidePopup.closeIcon)['width'];\n\n\t\treturn guide;\n\t}\n\n\tgetPulsar()\n\t{\n\t\tconst pulsar = new BX.SpotLight({\n\t\t\ttargetElement: this.DOM.menuBarItem,\n\t\t\ttargetVertex: 'middle-center',\n\t\t});\n\t\tpulsar.bindEvents({\n\t\t\t'onTargetEnter': () => pulsar.close(),\n\t\t});\n\n\t\treturn pulsar;\n\t}\n}\n","import WithEditor from './witheditor';\nimport { Loc, Tag, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Sms extends WithEditor\n{\n\tcreateLayout(): HTMLElement\n\t{\n\t\tconst canSend = this.getSetting('canSendMessage', false);\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --focus --hidden\">\n\t\t\t${canSend ? this.#renderEditor() : this.#renderSetupText()}\n\t\t</div>`;\n\t}\n\n\t#renderEditor(): HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {})\n\t\tconst enableSalesCenter = BX.prop.getBoolean(config, 'isSalescenterEnabled', false);\n\t\tconst enableDocuments = BX.prop.getBoolean(config, 'isDocumentsEnabled', false);\n\t\tconst enableFiles = this.getSetting('enableFiles', false);\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea class=\"crm-entity-stream-content-new-sms-textarea\" rows='1' placeholder=\"${Loc.getMessage('CRM_TIMELINE_SMS_ENTER_MESSAGE')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-buttons-container\">\n\t\t\t${enableSalesCenter ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"salescenter-starter\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableFiles ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-file-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_FILE')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableDocuments ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-document-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-document-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_DOCUMENT')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-detail-toggle\" data-role=\"sms-detail-switcher\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_DETAILS')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-container hidden\" data-role=\"sms-detail\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SENDER')}\n\t\t\t\t\t\t<a href=\"#\" data-role=\"sender-selector\">sender</a><span data-role=\"from-container\">${Loc.getMessage('CRM_TIMELINE_SMS_FROM')}\n\t\t\t\t\t\t<a data-role=\"from-selector\" href=\"#\">from_number</a></span>\n\t\t\t\t\t\t<span data-role=\"client-container\"> ${Loc.getMessage('CRM_TIMELINE_SMS_TO')}\n\t\t\t\t\t\t<a data-role=\"client-selector\" href=\"#\">client_caption</a> <a data-role=\"to-selector\" href=\"#\">to_number</a></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t${this.#renderTemplatesContainer()}\n\t\t\t${this.#renderFilesSelector()}\n\n\t\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-symbol-counter\" data-role=\"message-length-counter-wrap\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\" data-role=\"message-length-counter\" data-length-max=\"200\">0</span>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS_FROM')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\">200</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSetupText(): HTMLElement\n\t{\n\t\tconst enableSalesCenter = BX.prop.getBoolean(this.getSetting('smsConfig', {}), 'isSalescenterEnabled', false);\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-conditions-container\">\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t<strong>${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_1')}</strong><br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_2')}<br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_3_MSGVER_1')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t<a href=\"#\" data-role=\"sender-selector\" target=\"_top\" class=\"crm-entity-stream-content-new-sms-connect-link\">${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_URL')}</a>\n\t\t\t${enableSalesCenter ? Tag.render`<div class=\"crm-entity-stream-content-sms-salescenter-container-absolute\" data-role=\"salescenter-starter\">\n\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n</div>` : null}\n\t\t</div>`;\n\t}\n\n\t#renderTemplatesContainer(): HTMLElement\n\t{\n\t\tthis._templatesContainer = Tag.render`<div class=\"crm-entity-stream-content-new-sms-templates\">\n\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_TEMPLATE_LIST_TITLE')}<span class=\"ui-hint\" data-role=\"hint\"><span class=\"ui-hint-icon\"></span></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\" data-role=\"template-selector\">\n\t\t\t\t\t<div class=\"ui-ctl-element\" data-role=\"template-title\"></div>\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-new-sms-preview\" data-role=\"preview\"></div>\n\t\t\t</div>`;\n\n\t\treturn this._templatesContainer;\n\t}\n\n\t#renderFilesSelector(): ?HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {});\n\n\t\tconst showFiles = this.getSetting('showFiles', false);\n\t\tconst enableFilesExternalLink = BX.prop.getBoolean(config, 'isFilesExternalLinkEnabled', false);\n\n\t\tif (enableFilesExternalLink)\n\t\t{\n\t\t\tconst fileInputPrefix = 'crm-' + this.getEntityTypeId() + '-' + this.getEntityId();\n\t\t\tconst fileInputName = fileInputPrefix + '-sms-files';\n\t\t\tconst fileUploaderInputName = fileInputPrefix + '-sms-files-uploader';\n\t\t\tconst fileUploaderZoneId = 'diskuf-selectdialog-' + fileInputPrefix;\n\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-uploader-zone\" data-role=\"sms-file-upload-zone\" data-node-id=\"${fileInputPrefix}\">\n\t\t\t\t<div id=\"${fileUploaderZoneId}\" class=\"diskuf-files-entity diskuf-selectdialog bx-disk\">\n\t\t\t\t\t<div class=\"diskuf-files-block checklist-loader-files\">\n\t\t\t\t\t\t<div class=\"diskuf-placeholder\">\n\t\t\t\t\t\t\t<table class=\"files-list\">\n\t\t\t\t\t\t\t\t<tbody class=\"diskuf-placeholder-tbody\"></tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended\">\n\t\t\t\t\t\t<input type=\"hidden\" name=\"${fileInputName}[]\" value=\"\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<label for=\"${fileUploaderInputName}\" data-role=\"sms-file-upload-label\"></label>\n\t\t\t\t\t\t<input class=\"diskuf-fileUploader\" id=\"${fileUploaderInputName}\" type=\"file\" data-role=\"sms-file-upload-input\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<span class=\"diskuf-selector-link\" data-role=\"sms-file-selector-bitrix\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\t\tif (showFiles)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-external-link-popup\" data-role=\"sms-file-external-link-disabled\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-inner\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img\">\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img-lock\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_FILE_EXTERNAL_LINK_FEATURE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._senderId = null;\n\t\tthis._from = null;\n\t\tthis._commEntityTypeId = null;\n\t\tthis._commEntityId = null;\n\t\tthis._to = null;\n\n\t\tthis._fromList = [];\n\t\tthis._toList = [];\n\t\tthis._defaults = {};\n\t\tthis._communications = [];\n\n\t\tthis._menu = null;\n\t\tthis._isMenuShown = false;\n\t\tthis._shownMenuId = null;\n\t\tthis._documentSelector = null;\n\t\tthis._source = null;\n\n\t\tthis._paymentId = null;\n\t\tthis._shipmentId = null;\n\n\t\tthis._compilationProductIds = [];\n\n\t\tthis._templateId = null;\n\t\tthis._templateFieldHintNode = null;\n\t\tthis._templateSelectorNode = null;\n\t\tthis._templateTemplateTitleNode = null;\n\t\tthis._templatePreviewNode = null;\n\t\tthis._templateSelectorMenuId = 'CrmTimelineSmsEditorTemplateSelector';\n\t\tthis._templateFieldHintHandler = BX.delegate(this.onTemplateHintIconClick, this);\n\t\tthis._templateSeletorClickHandler = BX.delegate(this.onTemplateSelectClick, this);\n\t\tthis._selectTemplateHandler = BX.delegate(this.onSelectTemplate, this);\n\n\t\tthis._serviceUrl = BX.util.remove_url_param(\n\t\t\tthis.getSetting(\"serviceUrl\", \"\"),\n\t\t\t['sessid', 'site']\n\t\t);\n\n\t\tconst config = this.getSetting( 'smsConfig', {});\n\n\t\tthis._canUse = BX.prop.getBoolean(config, \"canUse\", false);\n\t\tthis._canSendMessage = BX.prop.getBoolean(config, \"canSendMessage\", false);\n\t\tthis._manageUrl = BX.prop.getString(config, \"manageUrl\", '');\n\t\tthis._senders = BX.prop.getArray(config, \"senders\", []);\n\t\tthis._defaults = BX.prop.getObject(config, \"defaults\", {senderId:null,from:null});\n\t\tthis._communications = BX.prop.getArray(config, \"communications\", []);\n\t\tthis._isSalescenterEnabled = BX.prop.getBoolean(config, \"isSalescenterEnabled\", false);\n\t\tthis._isDocumentsEnabled = BX.prop.getBoolean(config, \"isDocumentsEnabled\", false);\n\t\tif(this._isDocumentsEnabled)\n\t\t{\n\t\t\tthis._documentsProvider = BX.prop.getString(config, \"documentsProvider\", '');\n\t\t\tthis._documentsValue = BX.prop.getString(config, \"documentsValue\", '');\n\t\t}\n\t\tthis._isFilesEnabled = BX.prop.getBoolean(config, \"isFilesEnabled\", false);\n\t\tif(this._isFilesEnabled)\n\t\t{\n\t\t\tthis._diskUrls = BX.prop.getObject(config, \"diskUrls\");\n\t\t\tthis._isFilesExternalLinkEnabled = BX.prop.getBoolean(config, \"isFilesExternalLinkEnabled\", true);\n\t\t}\n\n\t\tthis._senderSelectorNode = this.getContainer().querySelector('[data-role=\"sender-selector\"]');\n\t\tthis._fromContainerNode = this.getContainer().querySelector('[data-role=\"from-container\"]');\n\t\tthis._fromSelectorNode = this.getContainer().querySelector('[data-role=\"from-selector\"]');\n\t\tthis._clientContainerNode = this.getContainer().querySelector('[data-role=\"client-container\"]');\n\t\tthis._clientSelectorNode = this.getContainer().querySelector('[data-role=\"client-selector\"]');\n\t\tthis._toSelectorNode = this.getContainer().querySelector('[data-role=\"to-selector\"]');\n\t\tthis._messageLengthCounterWrapperNode = this.getContainer().querySelector('[data-role=\"message-length-counter-wrap\"]');\n\t\tthis._messageLengthCounterNode = this.getContainer().querySelector('[data-role=\"message-length-counter\"]');\n\t\tthis._salescenterStarter = this.getContainer().querySelector('[data-role=\"salescenter-starter\"]');\n\t\tthis._smsDetailSwitcher = this.getContainer().querySelector('[data-role=\"sms-detail-switcher\"]');\n\t\tthis._smsDetail = this.getContainer().querySelector('[data-role=\"sms-detail\"]');\n\t\tthis._documentSelectorButton = this.getContainer().querySelector('[data-role=\"sms-document-selector\"]');\n\t\tthis._fileSelectorButton = this.getContainer().querySelector('[data-role=\"sms-file-selector\"]');\n\t\tthis._fileUploadZone = this.getContainer().querySelector('[data-role=\"sms-file-upload-zone\"]');\n\t\tthis._fileUploadLabel = this.getContainer().querySelector('[data-role=\"sms-file-upload-label\"]');\n\t\tthis._fileSelectorBitrix = this.getContainer().querySelector('[data-role=\"sms-file-selector-bitrix\"]');\n\t\tthis._fileExternalLinkDisabledContent = this.getContainer().querySelector('[data-role=\"sms-file-external-link-disabled\"]');\n\n\t\tif (this._templatesContainer)\n\t\t{\n\t\t\tthis._templateFieldHintNode = this._templatesContainer.querySelector('[data-role=\"hint\"]');\n\t\t\tthis._templateSelectorNode = this._templatesContainer.querySelector('[data-role=\"template-selector\"]');\n\t\t\tthis._templateTemplateTitleNode = this._templatesContainer.querySelector('[data-role=\"template-title\"]');\n\t\t\tthis._templatePreviewNode = this._templatesContainer.querySelector('[data-role=\"preview\"]');\n\t\t}\n\t\tif (this._templateFieldHintNode)\n\t\t{\n\t\t\tBX.bind(this._templateFieldHintNode, \"click\", this._templateFieldHintHandler);\n\t\t}\n\t\tif (this._templateSelectorNode)\n\t\t{\n\t\t\tBX.bind(this._templateSelectorNode, \"click\", this._templateSeletorClickHandler);\n\t\t}\n\n\t\tif (this._canUse && this._senders.length > 0)\n\t\t{\n\t\t\tthis.initSenderSelector();\n\t\t}\n\t\tif (this._canUse && this._canSendMessage)\n\t\t{\n\t\t\tthis.initDetailSwitcher();\n\t\t\tthis.initFromSelector();\n\t\t\tthis.initClientContainer();\n\t\t\tthis.initClientSelector();\n\t\t\tthis.initToSelector();\n\t\t\tthis.initMessageLengthCounter();\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tif(this._isDocumentsEnabled)\n\t\t\t{\n\t\t\t\tthis.initDocumentSelector();\n\t\t\t}\n\t\t\tif(this._isFilesEnabled)\n\t\t\t{\n\t\t\t\tthis.initFileSelector();\n\t\t\t}\n\t\t}\n\n\t\tthis.#subscribeToReceiversChanges();\n\n\t\tif(this._isSalescenterEnabled)\n\t\t{\n\t\t\tthis.initSalescenterApplication();\n\t\t}\n\t}\n\n\tinitDetailSwitcher()\n\t{\n\t\tBX.bind(this._smsDetailSwitcher, 'click', function()\n\t\t{\n\t\t\tif(this._smsDetail.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.remove('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_COLLAPSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.add('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_DETAILS');\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tinitSenderSelector()\n\t{\n\t\tconst defaultSenderId = this._defaults.senderId;\n\t\tlet defaultSender = this._senders[0].canUse ? this._senders[0] : null;\n\t\tlet restSender = null;\n\t\tconst menuItems = [];\n\t\tconst handler = this.onSenderSelectorClick.bind(this);\n\n\t\tfor (let i = 0; i < this._senders.length; ++i)\n\t\t{\n\t\t\tif (this._senders[i].canUse && this._senders[i].fromList.length && (this._senders[i].id === defaultSenderId || !defaultSender))\n\t\t\t{\n\t\t\t\tdefaultSender = this._senders[i];\n\t\t\t}\n\n\t\t\tif (this._senders[i].id === 'rest')\n\t\t\t{\n\t\t\t\trestSender = this._senders[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._senders[i].name,\n\t\t\t\tsender: this._senders[i],\n\t\t\t\tonclick: handler,\n\t\t\t\tclassName: (!this._senders[i].canUse || !this._senders[i].fromList.length)\n\t\t\t\t\t? 'crm-timeline-popup-menu-item-disabled menu-popup-no-icon' : ''\n\t\t\t});\n\t\t}\n\n\t\tif (restSender)\n\t\t{\n\t\t\tif (restSender.fromList.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({delimiter: true});\n\t\t\t\tfor (let i = 0; i < restSender.fromList.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\ttext: restSender.fromList[i].name,\n\t\t\t\t\t\tsender: restSender,\n\t\t\t\t\t\tfrom: restSender.fromList[i],\n\t\t\t\t\t\tonclick: handler\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tmenuItems.push({delimiter: true}, {\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_REST_MARKETPLACE'),\n\t\t\t\thref: BX.message('MARKET_BASE_PATH') + 'category/crm_robot_sms/',\n\t\t\t\ttarget: '_blank'\n\t\t\t});\n\t\t}\n\n\t\tif (defaultSender)\n\t\t{\n\t\t\tthis.setSender(defaultSender);\n\t\t}\n\n\t\tBX.bind(this._senderSelectorNode, 'click', this.openMenu.bind(this, 'sender', this._senderSelectorNode, menuItems));\n\t}\n\n\tonSenderSelectorClick(e, item)\n\t{\n\t\tif (item.sender)\n\t\t{\n\t\t\tif (!item.sender.canUse || !item.sender.fromList.length)\n\t\t\t{\n\t\t\t\tconst url = BX.Uri.addParam(item.sender.manageUrl, {'IFRAME': 'Y'});\n\t\t\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\tconst options = {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: function () {\n\t\t\t\t\t\t\tif (slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tslider.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCloseComplete: function () {\n\t\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdocument.location.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (item.sender.id === 'ednaru')\n\t\t\t\t{\n\t\t\t\t\toptions.width = 700;\n\t\t\t\t}\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setSender(item.sender, true);\n\t\t\tconst from = item.from ? item.from : item.sender.fromList[0];\n\t\t\tthis.setFrom(from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetSender(sender, setAsDefault)\n\t{\n\t\tthis._senderId = sender.id;\n\t\tthis._fromList = sender.fromList;\n\t\tthis._senderSelectorNode.textContent = sender.shortName ? sender.shortName : sender.name;\n\n\t\tthis._templateId = null;\n\t\tif (sender.isTemplatesBased)\n\t\t{\n\t\t\tthis.showNode(this._templatesContainer);\n\t\t\tthis.hideNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.hideNode(this._fileSelectorButton);\n\t\t\tthis.hideNode(this._documentSelectorButton);\n\t\t\tthis.hideNode(this._input);\n\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\tthis.toggleSaveButton();\n\t\t\tthis._hideButtonsOnBlur = false;\n\t\t\tthis.onFocus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideNode(this._templatesContainer);\n\t\t\tthis.showNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.showNode(this._fileSelectorButton);\n\t\t\tthis.showNode(this._documentSelectorButton);\n\t\t\tthis.showNode(this._input);\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._hideButtonsOnBlur = true;\n\t\t}\n\n\t\tconst visualFn = sender.id === 'rest' ? 'hide' : 'show';\n\t\tBX[visualFn](this._fromContainerNode);\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"senderId\", this._senderId);\n\t\t}\n\t}\n\n\tshowNode(node)\n\t{\n\t\tif (node)\n\t\t{\n\t\t\tnode.style.display = \"\";\n\t\t}\n\t}\n\n\thideNode(node)\n\t{\n\t\tif (node)\n\t\t{\n\t\t\tnode.style.display = \"none\";\n\t\t}\n\t}\n\n\tinitFromSelector()\n\t{\n\t\tif (this._fromList.length > 0)\n\t\t{\n\t\t\tconst defaultFromId = this._defaults.from || this._fromList[0].id;\n\t\t\tlet defaultFrom = null;\n\t\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t\t{\n\t\t\t\tif (this._fromList[i].id === defaultFromId || !defaultFrom)\n\t\t\t\t{\n\t\t\t\t\tdefaultFrom = this._fromList[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (defaultFrom)\n\t\t\t{\n\t\t\t\tthis.setFrom(defaultFrom);\n\t\t\t}\n\t\t}\n\n\t\tBX.bind(this._fromSelectorNode, 'click', this.onFromSelectorClick.bind(this));\n\t}\n\n\tonFromSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onFromSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._fromList[i].name,\n\t\t\t\tfrom: this._fromList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('from_'+this._senderId, this._fromSelectorNode, menuItems, e);\n\t}\n\n\tonFromSelectorItemClick(e, item)\n\t{\n\t\tif (item.from)\n\t\t{\n\t\t\tthis.setFrom(item.from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetFrom(from, setAsDefault)\n\t{\n\t\tthis._from = from.id;\n\n\t\tif (this._senderId === 'rest')\n\t\t{\n\t\t\tthis._senderSelectorNode.textContent = from.name;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._fromSelectorNode.textContent = from.name;\n\t\t}\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"from\", this._from);\n\t\t}\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item, current } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Type.isArray(current))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst phoneReceivers = current.filter(receiver => receiver.address.typeId === 'PHONE');\n\n\t\t\tconst newCommunications: {[addressSourceHash: string]: Object} = {};\n\t\t\tfor (const receiver of phoneReceivers)\n\t\t\t{\n\t\t\t\tlet communication = newCommunications[receiver.addressSource.hash];\n\n\t\t\t\tif (!communication)\n\t\t\t\t{\n\t\t\t\t\tcommunication = {\n\t\t\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(receiver.addressSource.entityTypeId),\n\t\t\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\t\t\tcaption: receiver.addressSourceData?.title,\n\t\t\t\t\t\tphones: [],\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tcommunication.phones.push({\n\t\t\t\t\ttype: receiver.address.typeId,\n\t\t\t\t\tvalue: receiver.address.value,\n\t\t\t\t\tvalueFormatted: receiver.address.valueFormatted,\n\t\t\t\t});\n\n\t\t\t\tnewCommunications[receiver.addressSource.hash] = communication;\n\t\t\t}\n\n\t\t\tthis._communications = Object.values(newCommunications);\n\n\t\t\tconst oldSelectedClient = this._communications.find(communication => {\n\t\t\t\treturn communication.entityTypeId === this._commEntityTypeId && communication.entityId === this._commEntityId;\n\t\t\t});\n\t\t\tthis.setClient(oldSelectedClient ?? this._communications[0]);\n\n\t\t\tthis.initClientContainer();\n\t\t});\n\t}\n\n\tinitClientContainer()\n\t{\n\t\tif (!Type.isDomNode(this._clientContainerNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._communications.length === 0)\n\t\t{\n\t\t\tBX.hide(this._clientContainerNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.show(this._clientContainerNode);\n\t\t}\n\t}\n\n\tinitClientSelector()\n\t{\n\t\tconst defaultClient = this._communications[0];\n\t\tif (defaultClient)\n\t\t{\n\t\t\tthis.setClient(defaultClient);\n\t\t}\n\n\t\tconst handler = this.onClientSelectorClick.bind(this);\n\n\t\tBX.bind(this._clientSelectorNode, 'click', (event) => {\n\t\t\tconst menuItems = [];\n\n\t\t\tfor (const communication of this._communications)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: communication.caption,\n\t\t\t\t\tclient: communication,\n\t\t\t\t\tonclick: handler,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.openMenu('comm', this._clientSelectorNode, menuItems, event);\n\t\t});\n\t}\n\n\tonClientSelectorClick(e, item)\n\t{\n\t\tif (item.client)\n\t\t{\n\t\t\tthis.setClient(item.client);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetClient(client: ?Object)\n\t{\n\t\tthis._commEntityTypeId = client?.entityTypeId;\n\t\tthis._commEntityId = client?.entityId;\n\t\tif (Type.isDomNode(this._clientSelectorNode))\n\t\t{\n\t\t\tthis._clientSelectorNode.textContent = client?.caption ?? '';\n\t\t}\n\t\tthis._toList = client?.phones ?? [];\n\t\tthis.setTo(client?.phones[0] ?? {});\n\t}\n\n\tinitToSelector()\n\t{\n\t\tBX.bind(this._toSelectorNode, 'click', this.onToSelectorClick.bind(this));\n\t}\n\n\tonToSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onToSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._toList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._toList[i].valueFormatted || this._toList[i].value,\n\t\t\t\tto: this._toList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('to_'+this._commEntityTypeId+'_'+this._commEntityId, this._toSelectorNode, menuItems, e);\n\t}\n\n\tonToSelectorItemClick(e, item)\n\t{\n\t\tif (item.to)\n\t\t{\n\t\t\tthis.setTo(item.to);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetTo(to: ?Object)\n\t{\n\t\tthis._to = to?.value;\n\t\tif (Type.isDomNode(this._toSelectorNode))\n\t\t{\n\t\t\tthis._toSelectorNode.textContent = (to?.valueFormatted || to?.value) ?? '';\n\t\t}\n\t}\n\n\topenMenu(menuId, bindElement, menuItems, e)\n\t{\n\t\tif (this._shownMenuId === menuId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._shownMenuId !== null && this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t\tthis._shownMenuId = null;\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id + menuId,\n\t\t\tbindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t\te.preventDefault();\n\t}\n\n\tonMenuClose()\n\t{\n\t\tthis._shownMenuId = null;\n\t\tthis._menu = null;\n\t}\n\n\tinitMessageLengthCounter()\n\t{\n\t\tthis._messageLengthMax = parseInt(this._messageLengthCounterNode.getAttribute('data-length-max'));\n\t\tBX.bind(this._input, 'keyup', this.setMessageLengthCounter.bind(this));\n\t\tBX.bind(this._input, 'cut', this.setMessageLengthCounterDelayed.bind(this));\n\t\tBX.bind(this._input, 'paste', this.setMessageLengthCounterDelayed.bind(this));\n\t}\n\n\tsetMessageLengthCounterDelayed()\n\t{\n\t\tsetTimeout(this.setMessageLengthCounter.bind(this), 0);\n\t}\n\n\tsetMessageLengthCounter()\n\t{\n\t\tconst length = this._input.value.length;\n\t\tthis._messageLengthCounterNode.textContent = length;\n\n\t\tconst classFn = length >= this._messageLengthMax ? 'addClass' : 'removeClass';\n\t\tBX[classFn](this._messageLengthCounterNode, 'crm-entity-stream-content-sms-symbol-counter-number-overhead');\n\n\t\tthis.toggleSaveButton();\n\t}\n\n\ttoggleSaveButton()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tlet enabled;\n\t\tif (!sender || !sender.isTemplatesBased)\n\t\t{\n\t\t\tenabled = this._input.value.length > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenabled = !!this._templateId;\n\t\t}\n\t\tif (enabled)\n\t\t{\n\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tlet text = '';\n\t\tlet templateId = '';\n\n\t\tif (!sender || !sender.isTemplatesBased)\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t\tif (text === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst template = this.getSelectedTemplate();\n\t\t\tif (!template)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttext = template.PREVIEW;\n\t\t\ttemplateId = template.ID;\n\t\t}\n\n\t\tif (!this._communications.length)\n\t\t{\n\t\t\talert(BX.message('CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS'));\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = this._isLocked = true;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax(\n\t\t\t\t{\n\t\t\t\t\turl: BX.util.add_url_param(this._serviceUrl, {\n\t\t\t\t\t\t\"action\": \"save_sms_message\",\n\t\t\t\t\t\t\"sender\": this._senderId\n\t\t\t\t\t}),\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\tdata:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'site': BX.message('SITE_ID'),\n\t\t\t\t\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t\t\t\t\t'source': this._source,\n\t\t\t\t\t\t\t\"ACTION\": \"SAVE_SMS_MESSAGE\",\n\t\t\t\t\t\t\t\"SENDER_ID\": this._senderId,\n\t\t\t\t\t\t\t\"MESSAGE_FROM\": this._from,\n\t\t\t\t\t\t\t\"MESSAGE_TO\": this._to,\n\t\t\t\t\t\t\t\"MESSAGE_BODY\": text,\n\t\t\t\t\t\t\t\"MESSAGE_TEMPLATE\": templateId,\n\t\t\t\t\t\t\t\"OWNER_TYPE_ID\": this._ownerTypeId,\n\t\t\t\t\t\t\t\"OWNER_ID\": this._ownerId,\n\t\t\t\t\t\t\t\"TO_ENTITY_TYPE_ID\": this._commEntityTypeId,\n\t\t\t\t\t\t\t\"TO_ENTITY_ID\": this._commEntityId,\n\t\t\t\t\t\t\t\"PAYMENT_ID\": this._paymentId,\n\t\t\t\t\t\t\t\"SHIPMENT_ID\": this._shipmentId,\n\t\t\t\t\t\t\t\"COMPILATION_PRODUCT_IDS\": this._compilationProductIds,\n\t\t\t\t\t\t},\n\t\t\t\t\tonsuccess: () => {\n\t\t\t\t\t\tthis.onSaveSuccess();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tonfailure: () => {\n\t\t\t\t\t\tthis.onSaveFailure();\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tinitSalescenterApplication()\n\t{\n\t\tBX.bind(this._salescenterStarter, 'click', this.startSalescenterApplication.bind(this));\n\t}\n\n\tstartSalescenterApplication()\n\t{\n\t\tconst isSalescenterToolEnabled = BX.prop.getBoolean(this.getSetting('smsConfig', {}), 'isSalescenterToolEnabled', false);\n\t\tif (!isSalescenterToolEnabled)\n\t\t{\n\t\t\tBX.loadExt('salescenter.tool-availability-manager').then(() =>\n\t\t\t{\n\t\t\t\tBX.Salescenter.ToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('salescenter.manager').then(function()\n\t\t{\n\t\t\tBX.Salescenter.Manager.openApplication({\n\t\t\t\tdisableSendButton: this._canSendMessage ? '' : 'y',\n\t\t\t\tcontext: 'sms',\n\t\t\t\townerTypeId: this._ownerTypeId,\n\t\t\t\townerId: this._ownerId,\n\t\t\t\tmode: this._ownerTypeId === BX.CrmEntityType.enumeration.deal ? 'payment_delivery' : 'payment',\n\t\t\t}).then(function(result)\n\t\t\t{\n\t\t\t\tif(result && result.get('action'))\n\t\t\t\t{\n\t\t\t\t\tif(result.get('action') === 'sendPage' && result.get('page') && result.get('page').url)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('page').name + ' ' + result.get('page').url;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t}\n\t\t\t\t\telse if (result.get('action') === 'sendPayment' && result.get('order'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('order').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'order';\n\t\t\t\t\t\tthis._paymentId = result.get('order').paymentId;\n\t\t\t\t\t\tthis._shipmentId = result.get('order').shipmentId;\n\t\t\t\t\t}\n\t\t\t\t\telse if(result.get('action') === 'sendCompilation' && result.get('compilation'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('compilation').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'deal';\n\t\t\t\t\t\tthis._compilationProductIds = result.get('compilation').productIds;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\tinitDocumentSelector()\n\t{\n\t\tBX.bind(this._documentSelectorButton, 'click', this.onDocumentSelectorClick.bind(this));\n\t}\n\n\tonDocumentSelectorClick()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\tBX.loadExt('documentgenerator.selector').then(function()\n\t\t\t{\n\t\t\t\tthis._documentSelector = new BX.DocumentGenerator.Selector.Menu({\n\t\t\t\t\tnode: this._documentSelectorButton,\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tprovider: this._documentsProvider,\n\t\t\t\t\tvalue: this._documentsValue,\n\t\t\t\t\tanalyticsLabelPrefix: 'crmTimelineSmsEditor'\n\t\t\t\t});\n\t\t\t\tthis.selectPublicUrl();\n\t\t\t}.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectPublicUrl();\n\t\t}\n\t}\n\n\tselectPublicUrl()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._documentSelector.show().then(function(object)\n\t\t{\n\t\t\tif(object instanceof BX.DocumentGenerator.Selector.Template)\n\t\t\t{\n\t\t\t\tthis._documentSelector.createDocument(object).then(function(document)\n\t\t\t\t{\n\t\t\t\t\tthis.pasteDocumentUrl(document);\n\t\t\t\t}.bind(this)).catch(function(error)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\telse if(object instanceof BX.DocumentGenerator.Selector.Document)\n\t\t\t{\n\t\t\t\tthis.pasteDocumentUrl(object);\n\t\t\t}\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tpasteDocumentUrl(document)\n\t{\n\t\tthis._documentSelector.getDocumentPublicUrl(document).then(function(publicUrl)\n\t\t{\n\t\t\tthis._input.focus();\n\t\t\tthis._input.value = this._input.value + ' ' + document.getTitle() + ' ' + publicUrl;\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._source = 'document';\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tinitFileSelector()\n\t{\n\t\tBX.bind(this._fileSelectorButton, 'click', this.onFileSelectorClick.bind(this));\n\t}\n\n\tcloseFileSelector()\n\t{\n\t\tBX.PopupMenu.destroy('sms-file-selector');\n\t}\n\n\tonFileSelectorClick()\n\t{\n\t\tBX.PopupMenu.show('sms-file-selector', this._fileSelectorButton, [\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_UPLOAD_FILE'),\n\t\t\t\tonclick: this.uploadFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_FIND_FILE'),\n\t\t\t\tonclick: this.findFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t}\n\t\t])\n\t}\n\n\tgetFileUploadInput()\n\t{\n\t\treturn document.getElementById(this._fileUploadLabel.getAttribute('for'));\n\t}\n\n\tuploadFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this.getFileUploadInput(), 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tfindFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this._fileSelectorBitrix, 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new BX.Loader(\n\t\t\t\t{\n\t\t\t\t\tsize: 50\n\t\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(node)\n\t{\n\t\tif(node && !this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(node);\n\t\t}\n\t}\n\n\thideLoader()\n\t{\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tinitDiskUF()\n\t{\n\t\tif(this.isDiskFileUploaderInited || !this._isFilesEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isDiskFileUploaderInited = true;\n\t\tBX.addCustomEvent(this._fileUploadZone, 'OnFileUploadSuccess', this.OnFileUploadSuccess.bind(this));\n\t\tBX.addCustomEvent(this._fileUploadZone, 'DiskDLoadFormControllerInit', function(uf)\n\t\t{\n\t\t\tuf._onUploadProgress = function()\n\t\t\t{\n\t\t\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\t\t}.bind(this);\n\t\t}.bind(this));\n\n\t\tBX.Disk.UF.add({\n\t\t\tUID: this._fileUploadZone.getAttribute('data-node-id'),\n\t\t\tcontrolName: this._fileUploadLabel.getAttribute('for'),\n\t\t\thideSelectDialog: false,\n\t\t\turlSelect: this._diskUrls.urlSelect,\n\t\t\turlRenameFile: this._diskUrls.urlRenameFile,\n\t\t\turlDeleteFile: this._diskUrls.urlDeleteFile,\n\t\t\turlUpload: this._diskUrls.urlUpload\n\t\t});\n\n\t\tBX.onCustomEvent(\n\t\t\tthis._fileUploadZone,\n\t\t\t'DiskLoadFormController',\n\t\t\t['show']\n\t\t);\n\t}\n\n\tOnFileUploadSuccess(fileResult, uf, file, uploaderFile)\n\t{\n\t\tthis.hideLoader();\n\t\tconst diskFileId = parseInt(fileResult.element_id.replace('n', ''));\n\t\tconst fileName = fileResult.element_name;\n\t\tthis.pasteFileUrl(diskFileId, fileName);\n\t}\n\n\tpasteFileUrl(diskFileId, fileName)\n\t{\n\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\tBX.ajax.runAction('disk.file.generateExternalLink', {\n\t\t\tanalyticsLabel: 'crmTimelineSmsEditorGetFilePublicUrl',\n\t\t\tdata: {\n\t\t\t\tfileId: diskFileId\n\t\t\t}\n\t\t}).then(function(response)\n\t\t{\n\t\t\tthis.hideLoader();\n\t\t\tif(response.data.externalLink && response.data.externalLink.link)\n\t\t\t{\n\t\t\t\tthis._input.focus();\n\t\t\t\tthis._input.value = this._input.value + ' ' + fileName + ' ' + response.data.externalLink.link;\n\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\tthis._source = 'file';\n\t\t\t}\n\t\t}.bind(this)).catch(function(response)\n\t\t{\n\t\t\tconsole.error(response.errors.pop().message);\n\t\t});\n\t}\n\n\tgetFeaturePopup(content)\n\t{\n\t\tif(this.featurePopup != null)\n\t\t{\n\t\t\treturn this.featurePopup;\n\t\t}\n\t\tthis.featurePopup = new BX.PopupWindow('bx-popup-crm-sms-editor-feature-popup', null, {\n\t\t\tzIndex: 200,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\toverlay : true,\n\t\t\tevents : {\n\t\t\t\tonPopupDestroy : function()\n\t\t\t\t{\n\t\t\t\t\tthis.featurePopup = null;\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tcontent : content,\n\t\t\tcontentColor: 'white'\n\t\t});\n\n\t\treturn this.featurePopup;\n\t}\n\n\tshowFilesExternalLinkFeaturePopup()\n\t{\n\t\tthis.getFeaturePopup(this._fileExternalLinkDisabledContent).show();\n\t}\n\n\tonTemplateHintIconClick()\n\t{\n\t\tif (this._senderId === 'ednaru')\n\t\t{\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14214014\");\n\t\t}\n\t}\n\n\tshowTemplateSelectDropdown(items)\n\t{\n\t\tconst menuItems = [];\n\t\tif (BX.Type.isArray(items))\n\t\t{\n\t\t\tif (items.length)\n\t\t\t{\n\t\t\t\titems.forEach(function(item)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\tvalue: item.ID,\n\t\t\t\t\t\ttext: item.TITLE,\n\t\t\t\t\t\tonclick: this._selectTemplateHandler\n\t\t\t\t\t})\n\t\t\t\t}.bind(this));\n\n\t\t\t\tBX.PopupMenu.show({\n\t\t\t\t\tid: this._templateSelectorMenuId,\n\t\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tangle: false,\n\t\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (this._senderId)\n\t\t{\n\t\t\tconst loaderMenuId = this._templateSelectorMenuId + 'loader';\n\t\t\tconst loaderMenuLoaderId = this._templateSelectorMenuId + 'loader';\n\n\t\t\tBX.PopupMenu.show({\n\t\t\t\tid: loaderMenuId,\n\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\titems: [{\n\t\t\t\t\thtml: '<div id=\"' + loaderMenuLoaderId + '\"></div>',\n\t\t\t\t}],\n\t\t\t\tangle: false,\n\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\theight: 60,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: function() {\n\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.showLoader(BX(loaderMenuLoaderId));\n\n\t\t\tif (!this._isRequestRunning)\n\t\t\t{\n\t\t\t\tthis._isRequestRunning = true;\n\t\t\t\tconst senderId = this._senderId;\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'messageservice.Sender.getTemplates',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: senderId,\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tmodule: 'crm',\n\t\t\t\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tconst sender = this._senders.find(function (sender) {\n\t\t\t\t\t\t\treturn (sender.id === senderId);\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\tif (sender)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsender.templates = response.data.templates;\n\t\t\t\t\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\t\t\t\t\t\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t\t.catch(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (response && response.errors && response.errors[0] && response.errors[0].message)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\talert(response.errors[0].message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tgetSelectedSender()\n\t{\n\t\treturn this._senders.find(function(sender) {\n\t\t\treturn (sender.id === this._senderId);\n\t\t}.bind(this));\n\t}\n\n\tgetSelectedTemplate()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (!this._templateId || !sender || !sender.templates)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst template = sender.templates.find(function (template) {\n\t\t\treturn template.ID == this._templateId;\n\t\t}.bind(this));\n\n\t\treturn template ? template : null;\n\t}\n\n\tonTemplateSelectClick()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tif (sender)\n\t\t{\n\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t}\n\t}\n\n\tonSelectTemplate(e, item)\n\t{\n\t\tthis._templateId = item.value;\n\t\tthis.applySelectedTemplate();\n\t\tthis.toggleSaveButton();\n\t\tconst menu = BX.PopupMenu.getMenuById(this._templateSelectorMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\ttoggleTemplateSelectAvailability()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (sender && BX.Type.isArray(sender.templates) && !sender.templates.length)\n\t\t{\n\t\t\tBX.addClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis._templateTemplateTitleNode.textContent = BX.message('CRM_TIMELINE_SMS_TEMPLATES_NOT_FOUND');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.removeClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis.applySelectedTemplate();\n\t\t}\n\t}\n\n\tapplySelectedTemplate()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (!this._templateId || !sender || !sender.templates)\n\t\t{\n\t\t\tthis.hideNode(this._templatePreviewNode);\n\t\t\tthis._templateTemplateTitleNode.textContent = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst template = this.getSelectedTemplate();\n\t\t\tif (template)\n\t\t\t{\n\t\t\t\tconst preview = BX.Text.encode(template.PREVIEW).replace(/\\n/g, '<br>');\n\n\t\t\t\tthis.showNode(this._templatePreviewNode);\n\t\t\t\tthis._templatePreviewNode.innerHTML = preview;\n\t\t\t\tthis._templateTemplateTitleNode.textContent = template.TITLE;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideNode(this._templatePreviewNode);\n\t\t\t\tthis._templateTemplateTitleNode.textContent = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new Sms();\n\t\tself.initialize(id, settings);\n\t\tSms.items[self.getId()] = self;\n\t\treturn self;\n\t}\n\n\tstatic items = {};\n}\n","import Item from '../item';\n\nexport default class Task extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addTask(\n\t\t\t{\n\t\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\t'ownerID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from \"../item\";\nimport { Dom, Loc, Tag, Type } from \"main.core\";\nimport { BaseEvent } from \"main.core.events\";\nimport { TodoEditor } from \"crm.activity.todo-editor\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class ToDo extends Item\n{\n\t#toDoEditor = null;\n\t#todoEditorContainer: HTMLElement = null;\n\t#saveButton: HTMLElement = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#todoEditorContainer = Tag.render`<div></div>`;\n\n\t\tthis.#saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round ui-btn-disabled\" >${Loc.getMessage('CRM_TIMELINE_SAVE_BUTTON')}</button>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-todo --hidden\">\n\t\t\t${this.#todoEditorContainer}\n\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t${this.#saveButton}\n\t\t\t\t<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t\tthis.#createEditor();\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tif (\n\t\t\tthis.isLocked()\n\t\t\t|| Dom.hasClass(this.#saveButton, 'ui-btn-disabled')\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setLocked(true);\n\n\t\tthis.save().then(\n\t\t\t() => this.setLocked(false),\n\t\t\t() => this.setLocked(false),\n\t\t).catch(() => this.setLocked(false));\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\t#createEditor(): void\n\t{\n\t\tthis.#toDoEditor = new TodoEditor({\n\t\t\tcontainer: this.#todoEditorContainer,\n\t\t\tdefaultDescription: '',\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcurrentUser: this.getSetting('currentUser'),\n\t\t\tpingSettings: this.getSetting('pingSettings'),\n\t\t\tevents: {\n\t\t\t\tonFocus: this.setFocused.bind(this, true),\n\t\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\t},\n\t\t\tenableCalendarSync: this.getSetting('enableTodoCalendarSync', false),\n\t\t});\n\n\t\tthis.#toDoEditor.show();\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\treturn this.#toDoEditor.save().then((response) => {\n\t\t\tif (Type.isArray(response.errors) && response.errors.length)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.cancel();\n\t\t\tthis.emitFinishEditEvent();\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tcancel(): void\n\t{\n\t\tthis.#toDoEditor.clearValue();\n\t\tDom.addClass(this.#saveButton, 'ui-btn-disabled');\n\t\tthis.setFocused(false);\n\t}\n\n\tbindInputHandlers(): void\n\t{\n\t\t// do nothing\n\t}\n\n\tsetParentActivityId(activityId: Number): void\n\t{\n\t\tthis.#toDoEditor.setParentActivityId(activityId);\n\t}\n\n\tsetDeadLine(deadLine: String): void\n\t{\n\t\tthis.#toDoEditor.setDeadline(deadLine);\n\t}\n\n\tfocus(): void\n\t{\n\t\tthis.#toDoEditor.setFocused();\n\t}\n\n\t#onChangeDescription(event: BaseEvent): void\n\t{\n\t\tlet {description} = event.getData();\n\t\tdescription = description.trim();\n\n\t\tif (!description.length && !Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\tDom.addClass(this.#saveButton, 'ui-btn-disabled');\n\t\t}\n\t\telse if (description.length && Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\tDom.removeClass(this.#saveButton, 'ui-btn-disabled')\n\t\t}\n\t}\n}\n","import Item from '../item';\n\nexport default class Visit extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst visitParameters = this.getSettings() ?? {};\n\t\tvisitParameters['OWNER_TYPE'] = BX.CrmEntityType.resolveName(this.getEntityTypeId());\n\t\tvisitParameters['OWNER_ID'] = this.getEntityId();\n\n\t\tBX.CrmActivityVisit.create(visitParameters).showEdit();\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Wait from \"../wait\";\nimport {Loc} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.Tools */\nexport default class WaitConfigurationDialog\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._type = Wait.WaitingType.undefined;\n\t\tthis._duration = 0;\n\t\tthis._target = \"\";\n\t\tthis._targetDates = null;\n\t\tthis._container = null;\n\t\tthis._durationMeasureNode = null;\n\t\tthis._durationInput = null;\n\t\tthis._targetDateNode = null;\n\t\tthis._popup = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._type = BX.prop.getInteger(this._settings, \"type\", Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(this._settings, \"duration\", 1);\n\t\tthis._target = BX.prop.getString(this._settings, \"target\", \"\");\n\t\tthis._targetDates = BX.prop.getArray(this._settings, \"targetDates\", []);\n\n\t\tthis._menuId = this._id + \"_target_date_sel\";\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tsetType(type)\n\t{\n\t\tthis._type = type;\n\t}\n\n\tgetDuration()\n\t{\n\t\treturn this._duration;\n\t}\n\n\tsetDuration(duration)\n\t{\n\t\tthis._duration = duration;\n\t}\n\n\tgetTarget()\n\t{\n\t\treturn this._target;\n\t}\n\n\tsetTarget(target)\n\t{\n\t\tthis._target = target;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst m = WaitConfigurationDialog.messages;\n\t\treturn m.hasOwnProperty(name) ? m[name] : name;\n\t}\n\n\tgetDurationText(duration, enableNumber)\n\t{\n\t\treturn Wait.Helper.getDurationText(duration, enableNumber);\n\t}\n\n\tgetTargetDateCaption(name)\n\t{\n\t\tconst length = this._targetDates.length;\n\t\tfor(let i = 0; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\t\t\tif(info[\"name\"] === name)\n\t\t\t{\n\t\t\t\treturn info[\"caption\"];\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\topen()\n\t{\n\t\tthis._popup = new BX.PopupWindow(\n\t\t\tthis._id,\n\t\t\tnull, //this._configSelector,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\tbindOptions: { forceBindPosition: false },\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tcontent: this.prepareDialogContent(),\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: BX.delegate(this.onPopupShow, this),\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onPopupClose, this),\n\t\t\t\t\t\tonPopupDestroy: BX.delegate(this.onPopupDestroy, this)\n\t\t\t\t\t},\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CHOOSE'),\n\t\t\t\t\t\t\t\tclassName: \"popup-window-button-accept\" ,\n\t\t\t\t\t\t\t\tevents: { click: BX.delegate(this.onSaveButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew BX.PopupWindowButtonLink(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext : BX.message(\"JS_CORE_WINDOW_CANCEL\"),\n\t\t\t\t\t\t\t\tevents: { click: BX.delegate(this.onCancelButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t]\n\t\t\t}\n\t\t);\n\t\tthis._popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup.close();\n\t\t}\n\t}\n\n\tprepareDialogContent()\n\t{\n\t\tconst container = BX.create(\"div\", {attrs: {className: \"crm-wait-popup-select-block\"}});\n\t\tconst wrapper = BX.create(\"div\", {attrs: {className: \"crm-wait-popup-select-wrapper\"}});\n\t\tcontainer.appendChild(wrapper);\n\n\t\tthis._durationInput = BX.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tattrs: { type: \"text\", className: \"crm-wait-popup-settings-input\", value: this._duration },\n\t\t\t\tevents: { keyup: BX.delegate(this.onDurationChange, this) }\n\t\t\t}\n\t\t);\n\n\t\tthis._durationMeasureNode = BX.create(\n\t\t\t\"span\",\n\t\t\t{ attrs: { className: \"crm-wait-popup-settings-title\" }, text: this.getDurationText(this._duration, false) }\n\t\t);\n\n\t\tif(this._type === Wait.WaitingType.after)\n\t\t{\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: Loc.getMessage('CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_AFTER') })\n\t\t\t);\n\t\t\twrapper.appendChild(this._durationInput);\n\t\t\twrapper.appendChild(this._durationMeasureNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: Loc.getMessage('CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_BEFORE') })\n\t\t\t);\n\t\t\twrapper.appendChild(this._durationInput);\n\t\t\twrapper.appendChild(this._durationMeasureNode);\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: \" \" + Loc.getMessage('CRM_TIMELINE_WAIT_TARGET_PREFIX_TYPE_BEFORE') })\n\t\t\t);\n\n\t\t\tthis._targetDateNode = BX.create(\n\t\t\t\t\"span\",\n\t\t\t\t{\n\t\t\t\t\tattrs: { className: \"crm-automation-popup-settings-link\" },\n\t\t\t\t\ttext: this.getTargetDateCaption(this._target),\n\t\t\t\t\tevents: { click: BX.delegate(this.toggleTargetMenu, this) }\n\t\t\t\t}\n\t\t\t);\n\t\t\twrapper.appendChild(this._targetDateNode);\n\t\t}\n\t\treturn container;\n\t}\n\n\tonDurationChange()\n\t{\n\t\tlet duration = parseInt(this._durationInput.value);\n\t\tif(isNaN(duration) || duration <= 0)\n\t\t{\n\t\t\tduration = 1;\n\t\t}\n\t\tthis._duration = duration;\n\t\tthis._durationMeasureNode.innerHTML = BX.util.htmlspecialchars(this.getDurationText(duration, false));\n\n\t}\n\n\ttoggleTargetMenu()\n\t{\n\t\tif(this.isTargetMenuOpened())\n\t\t{\n\t\t\tthis.closeTargetMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTargetMenu();\n\t\t}\n\t}\n\n\tisTargetMenuOpened()\n\t{\n\t\treturn !!BX.PopupMenu.getMenuById(this._menuId);\n\t}\n\n\topenTargetMenu()\n\t{\n\t\tconst menuItems = [];\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor(; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: info[\"caption\"],\n\t\t\t\t\ttitle: info[\"caption\"],\n\t\t\t\t\tvalue: info[\"name\"],\n\t\t\t\t\tonclick: BX.delegate(this.onTargetSelect, this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._menuId,\n\t\t\tthis._targetDateNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tzIndex: 200,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: BX.pos(this._targetDateNode)[\"width\"] / 2,\n\t\t\t\tangle: { position: 'top', offset: 0 }\n\t\t\t}\n\t\t);\n\t}\n\n\tcloseTargetMenu()\n\t{\n\t\tBX.PopupMenu.destroy(this._menuId);\n\t}\n\n\tonPopupShow(e, item)\n\t{\n\t}\n\n\tonPopupClose()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup.destroy();\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t}\n\n\tonPopupDestroy()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup = null;\n\t\t}\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tconst callback = BX.prop.getFunction(this._settings, \"onSave\", null);\n\t\tif(!callback)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {type: this._type};\n\t\tparams[\"duration\"] = this._duration;\n\t\tparams[\"target\"] = this._type === Wait.WaitingType.before ? this._target : \"\";\n\t\tcallback(this, params);\n\t}\n\n\tonCancelButtonClick(e)\n\t{\n\t\tconst callback = BX.prop.getFunction(this._settings, \"onCancel\", null);\n\t\tif(callback)\n\t\t{\n\t\t\tcallback(this);\n\t\t}\n\t}\n\n\tonTargetSelect(e, item)\n\t{\n\t\tconst fieldName = BX.prop.getString(item, \"value\", \"\");\n\t\tif(fieldName !== \"\")\n\t\t{\n\t\t\tthis._target = fieldName;\n\t\t\tthis._targetDateNode.innerHTML = BX.util.htmlspecialchars(this.getTargetDateCaption(fieldName));\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new WaitConfigurationDialog();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tstatic messages = {};\n}\n","import WithEditor from \"./witheditor\";\nimport WaitConfigurationDialog from \"./tools/wait-configuration-dialog\";\nimport {Loc, Tag} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Wait extends WithEditor\n{\n\t#waitConfigContainer: HTMLElement = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#waitConfigContainer = Tag.render`<div class=\"crm-entity-stream-content-wait-conditions\"></div>`;\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_CREATE_WAITING')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea rows=\"1\" class=\"crm-entity-stream-content-wait-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_WAIT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-wait-detail --focus --hidden\">\n\t\t\t<div class=\"crm-entity-stream-content-wait-conditions-container\">\n\t\t\t\t${this.#waitConfigContainer}\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t<div class=\"crm-entity-stream-content-wait-comment-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tdoInitialize(): void\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._hideButtonsOnBlur = false;\n\t\t//region Config\n\t\tthis._type = Wait.WaitingType.after;\n\t\tthis._duration = 1;\n\t\tthis._target = \"\";\n\t\tthis._configSelector = null;\n\t\t//endregion\n\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\t\tthis._configDialog = null;\n\n\t\tthis._serviceUrl = this.getSetting('serviceUrl', '');\n\n\t\tconst config = this.getSetting('config', {});\n\t\tthis._type = Wait.WaitingType.resolveTypeId(\n\t\t\tBX.prop.getString(\n\t\t\t\tconfig,\n\t\t\t\t'type',\n\t\t\t\tWait.WaitingType.names.after\n\t\t\t)\n\t\t);\n\t\tthis._duration = BX.prop.getInteger(config, 'duration', 1);\n\t\tthis._target = BX.prop.getString(config, 'target', '');\n\t\tthis._targetDates =this.getSetting('targetDates', []);\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetDurationText(duration, enableNumber)\n\t{\n\t\treturn Wait.Helper.getDurationText(duration, enableNumber);\n\t}\n\n\tgetTargetDateCaption(name)\n\t{\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor(; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\t\t\tif(info[\"name\"] === name)\n\t\t\t{\n\t\t\t\treturn info[\"caption\"];\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\tonSelectorClick(e)\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\tthis.openMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeMenu();\n\t\t}\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\topenMenu()\n\t{\n\t\tif(this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = BX.delegate(this.onMenuItemClick, this);\n\n\t\tconst menuItems =\n\t\t\t[\n\t\t\t\t{id: \"day_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1D'), onclick: handler},\n\t\t\t\t{id: \"day_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2D'), onclick: handler},\n\t\t\t\t{id: \"day_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3D'), onclick: handler},\n\t\t\t\t{id: \"week_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1W'), onclick: handler},\n\t\t\t\t{id: \"week_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2W'), onclick: handler},\n\t\t\t\t{id: \"week_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3W'), onclick: handler}\n\t\t\t];\n\n\t\tconst customMenu = {id: \"custom\", text: Loc.getMessage('CRM_TIMELINE_WAIT_CUSTOM'), items: []};\n\t\tcustomMenu[\"items\"].push({ id: \"afterDays\", text: Loc.getMessage('CRM_TIMELINE_WAIT_AFTER_CUSTOM_DAYS'), onclick: handler });\n\t\tif(this._targetDates.length > 0)\n\t\t{\n\t\t\tcustomMenu[\"items\"].push({ id: \"beforeDate\", text: Loc.getMessage('CRM_TIMELINE_WAIT_BEFORE_CUSTOM_DATE'), onclick: handler });\n\t\t}\n\t\tmenuItems.push(customMenu);\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id,\n\t\t\tthis._configSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: BX.delegate(this.onMenuShow, this),\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this),\n\t\t\t\t\t\tonPopupDestroy: BX.delegate(this.onMenuDestroy, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t}\n\n\tcloseMenu()\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t}\n\t}\n\n\tonMenuItemClick(e, item)\n\t{\n\t\tthis.closeMenu();\n\n\t\tif(item.id === \"afterDays\" || item.id === \"beforeDate\")\n\t\t{\n\t\t\tthis.openConfigDialog(\n\t\t\t\titem.id === \"afterDays\" ? Wait.WaitingType.after : Wait.WaitingType.before\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {type: Wait.WaitingType.after};\n\t\tif(item.id === \"day_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 1;\n\t\t}\n\t\telse if(item.id === \"day_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 2;\n\t\t}\n\t\telse if(item.id === \"day_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 3;\n\t\t}\n\t\tif(item.id === \"week_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 7;\n\t\t}\n\t\telse if(item.id === \"week_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 14;\n\t\t}\n\t\telse if(item.id === \"week_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 21;\n\t\t}\n\t\tthis.saveConfiguration(params);\n\t}\n\n\topenConfigDialog(type)\n\t{\n\t\tif(!this._configDialog)\n\t\t{\n\t\t\tthis._configDialog = WaitConfigurationDialog.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\ttargetDates: this._targetDates,\n\t\t\t\t\tonSave: BX.delegate(this.onConfigDialogSave, this),\n\t\t\t\t\tonCancel: BX.delegate(this.onConfigDialogCancel, this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis._configDialog.setType(type);\n\t\tthis._configDialog.setDuration(this._duration);\n\n\t\tlet target = this._target;\n\t\tif(target === \"\" && this._targetDates.length > 0)\n\t\t{\n\t\t\ttarget = this._targetDates[0][\"name\"];\n\t\t}\n\t\tthis._configDialog.setTarget(target);\n\t\tthis._configDialog.open();\n\t}\n\n\tonConfigDialogSave(sender, params)\n\t{\n\t\tthis.saveConfiguration(params);\n\t\tthis._configDialog.close();\n\t}\n\n\tonConfigDialogCancel(sender)\n\t{\n\t\tthis._configDialog.close();\n\t}\n\n\tonMenuShow()\n\t{\n\t\tthis._isMenuShown = true;\n\t}\n\n\tonMenuClose()\n\t{\n\t\tif(this._menu && this._menu.popupWindow)\n\t\t{\n\t\t\tthis._menu.popupWindow.destroy();\n\t\t}\n\t}\n\n\tonMenuDestroy()\n\t{\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\n\t\tif(typeof(BX.PopupMenu.Data[this._id]) !== \"undefined\")\n\t\t{\n\t\t\tdelete(BX.PopupMenu.Data[this._id]);\n\t\t}\n\t}\n\n\tsaveConfiguration(params)\n\t{\n\t\t//region Parse params\n\t\tthis._type = BX.prop.getInteger(params, \"type\", Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(params, \"duration\", 0);\n\t\tif(this._duration <= 0)\n\t\t{\n\t\t\tthis._duration = 1;\n\t\t}\n\t\tthis._target = this._type === Wait.WaitingType.before\n\t\t\t? BX.prop.getString(params, \"target\", \"\") : \"\";\n\t\t//endregion\n\t\t//region Save settings\n\t\tconst optionName = this.getSetting('optionName');\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"type\",\n\t\t\tthis._type === Wait.WaitingType.after ? \"after\" : \"before\"\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"duration\",\n\t\t\tthis._duration\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"target\",\n\t\t\tthis._target\n\t\t);\n\t\t//endregion\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetSummaryHtml()\n\t{\n\t\tif(this._type === Wait.WaitingType.before)\n\t\t{\n\t\t\treturn (\n\t\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_BEFORE')\n\t\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t\t\t\t.replace(\"#TARGET_DATE#\", this.getTargetDateCaption(this._target))\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_AFTER')\n\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t);\n\t}\n\n\tgetSummaryText()\n\t{\n\t\treturn BX.util.strip_tags(this.getSummaryHtml());\n\t}\n\n\tlayoutConfigurationSummary()\n\t{\n\t\tthis.#waitConfigContainer.innerHTML = this.getSummaryHtml();\n\t\tthis._configSelector = this.#waitConfigContainer.querySelector(\"a\");\n\t\tif(this._configSelector)\n\t\t{\n\t\t\tBX.bind(this._configSelector, 'click', this.onSelectorClick.bind(this));\n\t\t}\n\t}\n\n\tpostpone(id, offset, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"POSTPONE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"OFFSET\": offset }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tcomplete(id, completed, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"COMPLETE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"COMPLETED\": completed ? 'Y' : 'N' }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tsave()\n\t{\n\t\tif(this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet description = this.getSummaryText();\n\t\tconst comment = BX.util.trim(this._input.value);\n\t\tif(comment !== \"\")\n\t\t{\n\t\t\tdescription += \"\\n\" + comment;\n\t\t}\n\n\t\tconst data =\n\t\t\t{\n\t\t\t\tID: 0,\n\t\t\t\ttypeId: this._type,\n\t\t\t\tduration: this._duration,\n\t\t\t\ttargetFieldName: this._target,\n\t\t\t\tsubject: \"\",\n\t\t\t\tdescription: description,\n\t\t\t\tcompleted: 0,\n\t\t\t\townerType: BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\townerID: this.getEntityId()\n\t\t\t};\n\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"SAVE_WAIT\",\n\t\t\t\t\t\t\"DATA\": data\n\t\t\t\t\t},\n\t\t\t\tonsuccess: BX.delegate(this.onSaveSuccess, this),\n\t\t\t\tonfailure: BX.delegate(this.onSaveFailure, this)\n\t\t\t}\n\t\t);\n\t\tthis._isRequestRunning = this._isLocked = true;\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst m = Wait.messages;\n\t\treturn m.hasOwnProperty(name) ? m[name] : name;\n\t}\n\n\tstatic WaitingType = {\n\t\tundefined: 0,\n\t\tafter: 1,\n\t\tbefore: 2,\n\n\t\tnames:\n\t\t\t{\n\t\t\t\tafter: \"after\",\n\t\t\t\tbefore: \"before\"\n\t\t\t},\n\t\tresolveTypeId: function(name)\n\t\t{\n\t\t\tif(name === this.names.after)\n\t\t\t{\n\t\t\t\treturn this.after;\n\t\t\t}\n\t\t\telse if(name === this.names.before)\n\t\t\t{\n\t\t\t\treturn this.before;\n\t\t\t}\n\n\t\t\treturn this.undefined;\n\t\t}\n\t};\n\n\tstatic messages = {};\n\n\tstatic Helper =\n\t{\n\t\tgetDurationText: function(duration, enableNumber)\n\t\t{\n\t\t\tenableNumber = !!enableNumber;\n\n\t\t\tlet result = \"\";\n\t\t\tlet type = \"D\";\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tif((duration % 7) === 0)\n\t\t\t\t{\n\t\t\t\t\tduration = duration / 7;\n\t\t\t\t\ttype = \"W\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === \"W\")\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_WEEK', duration);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_DAY', duration);\n\t\t\t}\n\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tresult = duration.toString() + \" \" + result;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tgetMessage: function(name)\n\t\t{\n\t\t\treturn Wait.Helper.messages.hasOwnProperty(name) ? Wait.Helper.messages[name] : name;\n\t\t},\n\t\tmessages: {},\n\t}\n}\n","import Item from '../item';\nimport { Loc, Tag } from 'main.core';\nimport { Zoom as ZoomEditor } from 'crm.zoom';\n\nexport default class Zoom extends Item\n{\n\t#editor: ZoomEditor = null;\n\n\tshowSlider(): void\n\t{\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotConnectedHandler(Loc.getMessage('USER_ID'));\n\t\t}\n\t\telse // not available\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotAvailableHandler();\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isConnected') && this.getSetting('isAvailable');\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail ui-timeline-zoom-editor --focus --hidden\"></div>`;\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\tonShow()\n\t{\n\t\tif (!this.#editor)\n\t\t{\n\t\t\tthis.#createEditor();\n\t\t}\n\t}\n\n\t#createEditor(): void\n\t{\n\t\tthis.#editor = new ZoomEditor({\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcontainer: this.getContainer(),\n\t\t\tonFinishEdit: this.#onFinishEdit.bind(this),\n\t\t\tonStartSave: () => this.setLocked(true),\n\t\t\tonFinishSave: () => this.setLocked(false),\n\t\t});\n\t}\n\n\t#onFinishEdit(): void\n\t{\n\t\tthis.emitFinishEditEvent();\n\t}\n}\n","import Context from './context';\nimport Item from './item';\nimport Call from './items/call';\nimport Comment from './items/comment';\nimport Delivery from './items/delivery';\nimport Email from './items/email';\nimport GoToChat from './items/gotochat/gotochat';\nimport Market from './items/market';\nimport Meeting from './items/meeting';\nimport RestPlacement from './items/restplacement';\nimport Sharing from './items/sharing';\nimport Sms from './items/sms';\nimport Task from './items/task';\nimport ToDo from './items/todo';\nimport Visit from './items/visit';\nimport Wait from './items/wait';\nimport Zoom from './items/zoom';\n\nexport default class Factory\n{\n\tstatic createItem(id: String, context: Context, settings: ?Object): Item\n\t{\n\t\tlet item;\n\n\t\tswitch (id)\n\t\t{\n\t\t\tcase 'todo':\n\t\t\t\titem = new ToDo();\n\t\t\t\tbreak;\n\t\t\tcase 'comment':\n\t\t\t\titem = new Comment();\n\t\t\t\tbreak;\n\t\t\tcase 'sms':\n\t\t\t\titem = new Sms();\n\t\t\t\tbreak;\n\t\t\tcase 'gotochat':\n\t\t\t\titem = new GoToChat();\n\t\t\t\tbreak;\n\t\t\tcase 'call':\n\t\t\t\titem = new Call();\n\t\t\t\tbreak;\n\t\t\tcase 'email':\n\t\t\t\titem = new Email();\n\t\t\t\tbreak;\n\t\t\tcase 'meeting':\n\t\t\t\titem = new Meeting();\n\t\t\t\tbreak;\n\t\t\tcase 'task':\n\t\t\t\titem = new Task();\n\t\t\t\tbreak;\n\t\t\tcase 'sharing':\n\t\t\t\titem = new Sharing();\n\t\t\t\tbreak;\n\t\t\tcase 'wait':\n\t\t\t\titem = new Wait();\n\t\t\t\tbreak;\n\t\t\tcase 'zoom':\n\t\t\t\titem = new Zoom();\n\t\t\t\tbreak;\n\t\t\tcase 'delivery':\n\t\t\t\titem = new Delivery();\n\t\t\t\tbreak;\n\t\t\tcase 'visit':\n\t\t\t\titem = new Visit();\n\t\t\t\tbreak;\n\t\t\tcase 'activity_rest_applist':\n\t\t\t\titem = new Market();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\titem = null;\n\t\t}\n\n\t\tif (!item && id.startsWith('activity_rest_'))\n\t\t{\n\t\t\titem = new RestPlacement();\n\t\t}\n\n\t\tif (item)\n\t\t{\n\t\t\titem.initialize(context, settings);\n\t\t}\n\n\t\treturn item;\n\t}\n}\n","/** @memberof BX.Crm.Timeline.MenuBar */\n\nimport Factory from \"./factory\";\nimport Item from \"./item\";\nimport {Dom} from \"main.core\";\nimport Context from \"./context\";\n\ndeclare type MenuBarParams = {\n\tcontainerId: String,\n\tentityTypeId: Number,\n\tentityId: Number,\n\tisReadonly: Boolean,\n\tmenuId: String,\n\titems: MenuBarItemParams[],\n}\n\ndeclare type MenuBarItemParams = {\n\tid: String,\n\tsettings: ?Object,\n}\n\nexport class MenuBar\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#isReadonly: Boolean = false;\n\t#container: HTMLElement = null;\n\t#items = {};\n\t#selectedItemId: String = null;\n\t#menu: BX.Main.interfaceButtons = null;\n\n\tconstructor(id: String, params: MenuBarParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#isReadonly = params.isReadonly;\n\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tconst menuId = params.menuId ?? (BX.CrmEntityType.resolveName(this.#entityTypeId) + '_menu').toLowerCase();\n\t\tthis.#menu = BX.Main.interfaceButtonsManager.getById(menuId);\n\n\t\tconst context = new Context({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tentityId: this.#entityId,\n\t\t\tisReadonly: this.#isReadonly,\n\t\t\tmenuBarContainer: this.#container,\n\t\t});\n\n\t\t(params.items).forEach((itemData) => {\n\t\t\tconst id = itemData.id;\n\t\t\tconst item = Factory.createItem(id, context, itemData.settings ?? null);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.addFinishEditListener(this.#onItemFinishEdit.bind(this));\n\t\t\t\tthis.#items[id] = item;\n\t\t\t}\n\t\t});\n\n\t\tthis.setActiveItemById(this.#getFirstItemIdWithLayout());\n\t}\n\n\tgetItemById(id: String): ?Item\n\t{\n\t\treturn this.#items[id] ?? null;\n\t}\n\n\tonMenuItemClick(selectedItemId: String): void\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setActiveItemById(selectedItemId);\n\t}\n\n\tsetActiveItemById(selectedItemId: String): Boolean\n\t{\n\t\tif (!selectedItemId || this.#selectedItemId === selectedItemId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst menuBarItem = this.#items[selectedItemId];\n\t\tif (!menuBarItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tmenuBarItem.activate();\n\n\t\tif (!this.#isReadonly && menuBarItem.supportsLayout())\n\t\t{\n\t\t\tObject.keys(this.#items).forEach(itemId => {\n\t\t\t\tif (itemId !== selectedItemId)\n\t\t\t\t{\n\t\t\t\t\tthis.#items[itemId].deactivate();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.#selectMenuItem(selectedItemId);\n\t\t\tthis.#selectedItemId = selectedItemId;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#onItemFinishEdit(): void\n\t{\n\t\tthis.setActiveItemById(this.#getFirstItemIdWithLayout());\n\t}\n\n\t#getFirstItemIdWithLayout(): ?Item\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet firstId = null;\n\t\tthis.#menu.getAllItems().forEach(function (itemElement) {\n\t\t\tif (firstId === null)\n\t\t\t{\n\t\t\t\tconst id = itemElement.dataset.id;\n\t\t\t\tconst item = this.#items[id];\n\t\t\t\tif (item && item.supportsLayout())\n\t\t\t\t{\n\t\t\t\t\tfirstId = id;\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn firstId;\n\t}\n\n\tstatic create(id: String, params: MenuBarParams): MenuBar\n\t{\n\t\tconst self = new MenuBar(id, params);\n\t\tMenuBar.instances[id] = self;\n\n\t\treturn self;\n\t}\n\n\tstatic getDefault(): ?MenuBar\n\t{\n\t\treturn MenuBar.#defaultInstance;\n\t}\n\tstatic setDefault(instance: MenuBar): void\n\t{\n\t\tMenuBar.#defaultInstance = instance;\n\t}\n\n\tstatic getById(id): ?MenuBar\n\t{\n\t\treturn MenuBar.instances[id] || null;\n\t}\n\n\tstatic #defaultInstance = null;\n\tstatic instances = {};\n\n\t#selectMenuItem(id: String): void\n\t{\n\t\tconst activeItem = this.#menu.getItemById(this.#selectedItemId);\n\t\tconst currentDiv = this.#menu.getItemById(id);\n\t\tlet wasActiveInMoreMenu = false;\n\t\tif (currentDiv && activeItem !== currentDiv)\n\t\t{\n\t\t\twasActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tDom.addClass(currentDiv, this.#menu.classes.itemActive);\n\n\t\t\tif (this.#menu.getItemData)\n\t\t\t{\n\t\t\t\tconst currentDivData = this.#menu.getItemData(currentDiv);\n\t\t\t\tcurrentDivData['IS_ACTIVE'] = true;\n\t\t\t\tif (BX.type.isDomNode(activeItem))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(activeItem, this.#menu.classes.itemActive);\n\t\t\t\t\tconst activeItemData = this.#menu.getItemData(activeItem);\n\t\t\t\t\tactiveItemData['IS_ACTIVE'] = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tif (isActiveInMoreMenu || wasActiveInMoreMenu)\n\t\t\t{\n\t\t\t\tconst submenu = this.#menu.getSubmenu();\n\t\t\t\tif (submenu)\n\t\t\t\t{\n\t\t\t\t\tsubmenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tconst container = menuItem.getContainer();\n\t\t\t\t\t\tif (isActiveInMoreMenu && container.title === currentDiv.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.addClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (wasActiveInMoreMenu && container.title === activeItem.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.removeClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (isActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t\telse if (wasActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#menu.closeSubmenu();\n\t}\n}\n"],"names":["Context","constructor","params","entityTypeId","entityId","isReadonly","menuBarContainer","getEntityTypeId","getEntityId","getMenuBarContainer","Item","initialize","context","settings","EventEmitter","setEventNamespace","initializeSettings","supportsLayout","createLayout","Dom","prepend","initializeLayout","getContainer","activate","setVisible","showSlider","deactivate","Error","getSetting","setting","defaultValue","getSettings","visible","container","removeClass","onShow","onHide","addClass","isVisible","setFocused","isFocused","setLocked","isLocked","hasClass","addFinishEditListener","callback","subscribe","ON_FINISH_EDIT_EVENT","emitFinishEditEvent","emit","Call","planner","BX","Crm","Activity","Planner","showEdit","CrmActivityType","call","WithEditor","_ownerTypeId","_ownerId","_ghostInput","_saveButtonHandler","delegate","onSaveButtonClick","_cancelButtonHandler","onCancelButtonClick","_focusHandler","onFocus","_blurHandler","onBlur","_keyupHandler","resizeForm","_delayedKeyupHandler","setTimeout","bind","_hideButtonsOnBlur","bindInputHandlers","doInitialize","_input","e","value","window","style","minHeight","saveResult","save","Promise","then","catch","cancel","release","remove","ensureGhostCreated","create","props","className","text","width","offsetWidth","document","body","appendChild","ghost","computedStyle","getComputedStyle","diff","parseInt","paddingBottom","paddingTop","borderTopWidth","borderBottomWidth","innerHTML","util","htmlspecialchars","replace","scrollHeight","Comment","_saveButton","Tag","render","Loc","getMessage","_cancelButton","_postForm","_editor","_isRequestRunning","_isLocked","unbind","loadEditor","_editorName","ajax","runAction","data","name","onLoadEditorSuccess","result","html","prop","getString","getObject","_editorContainer","showEditor","addEvents","addCustomEvent","firstElementChild","id","item","removeEventListener","file","controller","obj","blob","addEventListener","LHEPostForm","getHandler","BXHtmlEditor","Get","onCustomEvent","eventNode","display","Focus","type","isDomNode","attrs","attachmentList","oEditor","GetContent","querySelectorAll","forEach","input","push","emptyCommentMessage","PopupWindow","content","message","darkMode","autoHide","zIndex","angle","position","offset","closeByEsc","bindOptions","forceBindPosition","show","fields","ENTITY_ID","ENTITY_TYPE_ID","COMMENT","ATTACHMENTS","onSaveSuccess","onSaveFailure","reinit","Delivery","CrmActivityEditor","getDefault","addDelivery","CrmEntityType","resolveName","CrmTimelineManager","getOwnerInfo","Email","ownerInfo","addEmail","ServicesConfig","Map","available","connectLabel","inviteLabel","title","commonClass","iconClass","Social","TELEGRAM_IN_CIRCLE","iconColor","soonLabel","WHATSAPP","region","VK","FACEBOOK","UserOptions","Reflection","namespace","ARTICLE_CODE","Tour","instance","showGuide","onWindowResize","Runtime","debounce","Event","getGuideBindElement","onClose","close","clearInterval","showNextStep","target","getCurrentStep","setTarget","setTargetElement","force","querySelector","offsetTop","parentElement","nextElementSibling","handleTargetElementResize","currentRect","getPosition","left","right","top","bottom","targetElement","Boolean","offsetHeight","getClientRects","length","guidePopup","getPopup","popupContainer","adjustPosition","SpotLight","autoSave","targetVertex","guideEvents","guideText","guide","Guide","onEvents","steps","events","article","linkTitle","rounded","setWidth","link","contentContainer","setInterval","MENU_ITEM_STUB_ID","ACTIVE_MENU_ITEM_CLASS","DEFAULT_MENU_ITEM_CLASS","TOOLBAR_CONTAINER_CLASS","BUTTONS_CONTAINER_CLASS","CLIENTS_SELECTOR_TITLE_CLASS","HELP_ARTICLE_CODE","GoToChat","selectedClient","settingsMenu","channels","communications","currentChannelId","fromPhoneId","toName","toPhoneId","openLineItems","isFetchedConfig","isSending","contactCenterUrl","onSelectClient","onSelectClientPhone","onSelectSender","onSelectSenderPhone","onToggleClientSelector","Dialog","targetNode","multiple","dropdownMode","showAvatars","enableSearch","entities","isOpen","hide","setTargetNode","event","getData","resolveId","isBound","adjustLayout","EntityEditor","reload","initSettingsMenu","menuId","items","MenuManager","bindElement","delimiter","onSubMenuShow","getChannelsSubmenuItems","disabled","Type","isArrayFilled","getPhoneSubMenuItems","onShowClientPhoneSelector","getElementById","ClientSelector","createFromCommunications","onSelect","setSelected","customData","get","getCurrentCommunication","caption","getCurrentPhone","client","isObjectLike","phones","find","phone","communication","Number","showRegistrarAndSend","code","showButtonLoader","lineId","ConditionChecker","checkAndGetLine","openLineCode","senderType","getSenderType","send","saveEntityEditor","saveChanged","ownerTypeId","ownerId","senderId","from","to","ajaxParameters","errors","button","SenderTypes","bitrix24","sms","getEntityAvatarPath","entityTypeName","toLowerCase","whiteList","includes","shortName","canUse","fromList","onclick","SidePanel","Instance","open","channel","currentChannel","loader","destroy","Array","isArray","defaultPhone","default","clientStart","clientFinish","titleContainer","childNodes","contact","dynamicLoad","dynamicSearch","options","showTab","showPhones","showMails","company","excludeMyCompany","enumeration","clientId","clientTypeId","ajaxParams","resolve","Helper","getTarget","itemOptionsToAdd","getSubMenu","addMenuItem","removeMenuItem","clientElement","Text","encode","valueFormatted","titleElement","firstChild","labelIndex","textContent","indexOf","nodeValue","insertBefore","splitText","clean","append","oldContainer","newContainer","values","service","set","label","icon","Icon","size","color","getPropertyValue","selected","getMode","UI","EntityEditorMode","edit","entityType","Dialogs","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","cancelCaption","onCancel","Notification","Center","notify","oldButton","newButton","Loader","Market","rest","Marketplace","PLACEMENT","console","log","EntityEvent","fire","names","invalidate","Meeting","meeting","RestPlacement","appId","AppLayout","openApplication","ID","PLACEMENT_ID","PlacementInterface","initializePlacement","prototype","reloadData","cb","fireUpdate","Sharing","HELPDESK_CODE","config","calendarSettings","isResponsible","setContacts","contacts","isNotificationsAvailable","areCommunicationChannelsAvailable","setCommunicationChannels","communicationChannels","selectedChannelId","doPayAttentionToNewFeature","bindEvents","InfoHelper","onLinkCopied","onRuleUpdated","onContactsChangedHandler","payAttentionToNewFeature","DOM","menuBarItem","createConfigureSlotsButton","createSettingsButton","createSendButton","createCancelButton","createMoreInfoButton","configureSlotsButton","onConfigureSlotsButtonClick","settingsButton","updateSettingsButton","onSettingsButtonClick","isContactAvailable","sendButton","onSendButtonClick","cancelButton","moreInfoButton","onMoreInfoButtonClick","showConfigureSlotsPopup","showSettingsPopup","showWarningNoContact","isChannelsAvailable","bitrix24Channel","isChannelBitrix24","isApproved","isBitrix24Approved","updateSenderList","showWarningNoCommunicationChannels","saveLinkAction","isActionCopy","onRuleUpdatedAction","openHelpDesk","newDialog","DialogNew","sharingUrl","url","sharingRule","rule","linkHash","hash","readOnly","getSettingsMenu","isSettingsPopupShown","popupWindow","isShown","getSharingReceiverItem","getSharingChannelsItem","currentFromList","getSharingSenderItem","map","getContactMenuItem","getChannelMenuItem","getFromMenuItem","isSelected","itemHtml","check","currentFrom","replaceAll","noCommunicationChannelsWarningGuide","getWarningGuide","guideContentContainer","getContentContainer","openConfigurationButton","noContactWarningGuide","copyLink","clipboard","copy","action","ruleArray","getSharingRule","contactId","contactTypeId","channelId","response","error","getSettingsControlRule","current","isCurrentDeal","phoneReceivers","filter","receiver","address","typeId","contactsHashes","addressSource","addressSourceData","sort","a","b","selectedId","checkIsApproved","OpenLineCodes","notifications","warningGuide","simpleMode","condition","guideContent","offsetFromCloseIcon","closeIcon","existingPadding","paddingRight","setAutoHide","arrowContainer","element","arrow","border","getBoundingClientRect","getGuide","pulsar","getPulsar","Sms","canSend","_senderId","_from","_commEntityTypeId","_commEntityId","_to","_fromList","_toList","_defaults","_communications","_menu","_isMenuShown","_shownMenuId","_documentSelector","_source","_paymentId","_shipmentId","_compilationProductIds","_templateId","_templateFieldHintNode","_templateSelectorNode","_templateTemplateTitleNode","_templatePreviewNode","_templateSelectorMenuId","_templateFieldHintHandler","onTemplateHintIconClick","_templateSeletorClickHandler","onTemplateSelectClick","_selectTemplateHandler","onSelectTemplate","_serviceUrl","remove_url_param","_canUse","getBoolean","_canSendMessage","_manageUrl","_senders","getArray","_isSalescenterEnabled","_isDocumentsEnabled","_documentsProvider","_documentsValue","_isFilesEnabled","_diskUrls","_isFilesExternalLinkEnabled","_senderSelectorNode","_fromContainerNode","_fromSelectorNode","_clientContainerNode","_clientSelectorNode","_toSelectorNode","_messageLengthCounterWrapperNode","_messageLengthCounterNode","_salescenterStarter","_smsDetailSwitcher","_smsDetail","_documentSelectorButton","_fileSelectorButton","_fileUploadZone","_fileUploadLabel","_fileSelectorBitrix","_fileExternalLinkDisabledContent","_templatesContainer","initSenderSelector","initDetailSwitcher","initFromSelector","initClientContainer","initClientSelector","initToSelector","initMessageLengthCounter","setMessageLengthCounter","initDocumentSelector","initFileSelector","initSalescenterApplication","classList","contains","innerText","add","defaultSenderId","defaultSender","restSender","menuItems","handler","onSenderSelectorClick","i","sender","href","setSender","openMenu","Uri","addParam","manageUrl","slider","getTopSlider","onCloseComplete","location","setFrom","setAsDefault","isTemplatesBased","showNode","hideNode","toggleTemplateSelectAvailability","toggleSaveButton","visualFn","userOptions","node","defaultFromId","defaultFrom","onFromSelectorClick","onFromSelectorItemClick","defaultClient","setClient","onClientSelectorClick","setTo","onToSelectorClick","onToSelectorItemClick","PopupMenu","_id","cacheable","offsetLeft","onPopupClose","onMenuClose","currentItem","preventDefault","_messageLengthMax","getAttribute","setMessageLengthCounterDelayed","classFn","getSelectedSender","enabled","templateId","template","getSelectedTemplate","PREVIEW","alert","reject","add_url_param","method","dataType","bitrix_sessid","onsuccess","onfailure","startSalescenterApplication","isSalescenterToolEnabled","loadExt","Salescenter","ToolAvailabilityManager","openSalescenterToolDisabledSlider","Manager","disableSendButton","mode","deal","focus","paymentId","shipmentId","productIds","onDocumentSelectorClick","DocumentGenerator","Selector","Menu","moduleId","provider","analyticsLabelPrefix","selectPublicUrl","object","Template","createDocument","pasteDocumentUrl","Document","getDocumentPublicUrl","publicUrl","getTitle","onFileSelectorClick","closeFileSelector","uploadFile","findFile","getFileUploadInput","initDiskUF","fireEvent","showFilesExternalLinkFeaturePopup","getLoader","showLoader","hideLoader","isDiskFileUploaderInited","OnFileUploadSuccess","uf","_onUploadProgress","parentNode","Disk","UF","UID","controlName","hideSelectDialog","urlSelect","urlRenameFile","urlDeleteFile","urlUpload","fileResult","uploaderFile","diskFileId","element_id","fileName","element_name","pasteFileUrl","analyticsLabel","fileId","externalLink","pop","getFeaturePopup","featurePopup","overlay","onPopupDestroy","contentColor","showTemplateSelectDropdown","TITLE","loaderMenuId","loaderMenuLoaderId","height","onDestroy","module","templates","getMenuById","applySelectedTemplate","menu","preview","self","getId","enableSalesCenter","enableDocuments","enableFiles","showFiles","enableFilesExternalLink","fileInputPrefix","fileInputName","fileUploaderInputName","fileUploaderZoneId","newCommunications","Object","oldSelectedClient","Task","addTask","ToDo","clearValue","setParentActivityId","activityId","setDeadLine","deadLine","setDeadline","TodoEditor","defaultDescription","currentUser","pingSettings","onChangeDescription","enableCalendarSync","description","trim","Visit","visitParameters","CrmActivityVisit","WaitConfigurationDialog","_settings","_type","Wait","WaitingType","undefined","_duration","_target","_targetDates","_container","_durationMeasureNode","_durationInput","_targetDateNode","_popup","isNotEmptyString","getRandomString","getInteger","after","_menuId","getType","setType","getDuration","setDuration","duration","m","messages","hasOwnProperty","getDurationText","enableNumber","getTargetDateCaption","info","draggable","prepareDialogContent","onPopupShow","PopupWindowButton","click","PopupWindowButtonLink","wrapper","keyup","onDurationChange","toggleTargetMenu","isNaN","isTargetMenuOpened","closeTargetMenu","openTargetMenu","onTargetSelect","pos","getFunction","before","fieldName","returnValue","_configSelector","_configDialog","resolveTypeId","layoutConfigurationSummary","onSelectorClick","closeMenu","onMenuItemClick","customMenu","onMenuShow","onMenuDestroy","openConfigDialog","saveConfiguration","targetDates","onSave","onConfigDialogSave","onConfigDialogCancel","Data","optionName","getSummaryHtml","getSummaryText","strip_tags","postpone","complete","completed","comment","targetFieldName","subject","ownerType","ownerID","getMessagePlural","toString","Zoom","onNotConnectedHandler","onNotAvailableHandler","ZoomEditor","onFinishEdit","onStartSave","onFinishSave","Factory","createItem","startsWith","MenuBar","containerId","Main","interfaceButtonsManager","getById","itemData","setActiveItemById","getItemById","selectedItemId","keys","itemId","instances","setDefault","firstId","getAllItems","itemElement","dataset","activeItem","currentDiv","wasActiveInMoreMenu","isActiveInMoreMenu","classes","itemActive","getItemData","currentDivData","activeItemData","submenu","getSubmenu","getMenuItems","menuItem","getMoreButton","closeSubmenu"],"mappings":"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"}