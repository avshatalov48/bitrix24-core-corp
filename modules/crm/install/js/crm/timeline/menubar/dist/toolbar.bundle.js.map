{"version":3,"file":"toolbar.bundle.js","sources":["../src/context.js","../src/item.js","../src/items/todo.js","../src/items/witheditor.js","../src/items/comment.js","../src/items/sms.js","../src/items/call.js","../src/items/email.js","../src/items/meeting.js","../src/items/task.js","../src/items/sharing.js","../src/items/tools/wait-configuration-dialog.js","../src/items/wait.js","../src/items/zoom.js","../src/items/delivery.js","../src/items/visit.js","../src/items/restplacement.js","../src/items/market.js","../src/factory.js","../src/menubar.js"],"sourcesContent":["declare type ContextParams = {\n\tentityTypeId: Number,\n\tentityId: Number,\n\tisReadonly: Boolean,\n\tmenuBarContainer: HTMLElement,\n}\n\nexport default class Context\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#isReadonly: Boolean = false;\n\t#menuBarContainer: HTMLElement = null;\n\n\tconstructor(params: ContextParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#isReadonly = params.isReadonly;\n\t\tthis.#menuBarContainer = params.menuBarContainer;\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tisReadonly(): Boolean\n\t{\n\t\treturn this.#isReadonly;\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#menuBarContainer;\n\t}\n}\n","import Context from \"./context\";\nimport {EventEmitter} from 'main.core.events';\nimport {Dom} from \"main.core\";\n\nexport default class Item\n{\n\tstatic ON_FINISH_EDIT_EVENT = 'onFinishEdit';\n\n\t#context: Context = null;\n\t#settings = {};\n\t#eventEmitter: EventEmitter = null;\n\t#isVisible: Boolean = false;\n\t#container: ?HTMLElement = null;\n\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tthis.#context = context;\n\t\tthis.#settings = settings;\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('BX.Crm.Timeline.MenuBar');\n\n\t\tif (!this.#context.isReadonly() && this.supportsLayout())\n\t\t{\n\t\t\tthis.#container = this.createLayout();\n\t\t\tDom.prepend(this.#container, this.getMenuBarContainer());\n\t\t\tthis.initializeLayout();\n\t\t}\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#context.getEntityTypeId();\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#context.getEntityId();\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#context.getMenuBarContainer();\n\t}\n\n\tgetContainer(): ?HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn true;\n\t}\n\n\tactivate(): void\n\t{\n\t\tif (this.supportsLayout())\n\t\t{\n\t\t\tthis.setVisible(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showSlider();\n\t\t}\n\t}\n\n\tdeactivate(): void\n\t{\n\t\tthis.setVisible(false);\n\t}\n\n\tshowSlider(): void\n\t{\n\t\tthrow new Error('Method showSlider() must be overridden');\n\t}\n\n\tgetSetting(setting: String, defaultValue = null)\n\t{\n\t\treturn this.#settings[setting] ?? defaultValue;\n\t}\n\n\tgetSettings(): ?Object\n\t{\n\t\treturn this.#settings;\n\t}\n\n\tsetVisible(visible: Boolean): void\n\t{\n\t\tvisible = !!visible;\n\t\tif(this.#isVisible === visible)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (visible)\n\t\t{\n\t\t\tDom.removeClass(container, '--hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(container, '--hidden');\n\t\t}\n\t}\n\n\tisVisible(): Boolean\n\t{\n\t\treturn this.#isVisible;\n\t}\n\n\tsetFocused(isFocused: Boolean): void\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (isFocused)\n\t\t{\n\t\t\tDom.addClass(container, \"--focus\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(container, \"--focus\");\n\t\t}\n\t}\n\n\taddFinishEditListener(callback)\n\t{\n\t\tthis.#eventEmitter.subscribe(Item.ON_FINISH_EDIT_EVENT, callback);\n\t}\n\n\temitFinishEditEvent()\n\t{\n\t\tthis.#eventEmitter.emit(Item.ON_FINISH_EDIT_EVENT);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthrow new Error('Method createLayout() must be overridden');\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t}\n}\n","import Item from \"../item\";\nimport {Tag, Dom, Type, Loc} from \"main.core\";\nimport {BaseEvent} from \"main.core.events\";\nimport {TodoEditor} from \"crm.activity.todo-editor\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class ToDo extends Item\n{\n\t#toDoEditor = null;\n\t#todoEditorContainer: HTMLElement = null;\n\t#saveButton: HTMLElement = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#todoEditorContainer = Tag.render`<div></div>`;\n\n\t\tthis.#saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-disabled\" >${Loc.getMessage('CRM_TIMELINE_SAVE_BUTTON')}</button>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-todo --hidden\">\n\t\t\t${this.#todoEditorContainer}\n\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t${this.#saveButton}\n\t\t\t\t<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t\tthis.#createEditor();\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tif (\n\t\t\tDom.hasClass(this.#saveButton, 'ui-btn-wait')\n\t\t\t|| Dom.hasClass(this.#saveButton, 'ui-btn-disabled')\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.addClass(this.#saveButton, 'ui-btn-wait');\n\t\tconst removeButtonWaitClass = () => Dom.removeClass(this.#saveButton, 'ui-btn-wait');\n\n\t\tthis.save().then(\n\t\t\t() => removeButtonWaitClass(),\n\t\t\t() => removeButtonWaitClass()\n\t\t);\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\t#createEditor(): void\n\t{\n\t\tthis.#toDoEditor = new TodoEditor({\n\t\t\tcontainer: this.#todoEditorContainer,\n\t\t\tdefaultDescription: '',\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcurrentUser: this.getSetting('currentUser'),\n\t\t\tevents: {\n\t\t\t\tonFocus: this.setFocused.bind(this, true),\n\t\t\t\tonChangeDescription: this.#onChangeDescription.bind(this),\n\t\t\t},\n\t\t\tenableCalendarSync: this.getSetting('enableTodoCalendarSync', false),\n\t\t});\n\n\t\tthis.#toDoEditor.show();\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\treturn this.#toDoEditor.save().then((response) => {\n\t\t\tif (Type.isArray(response.errors) && response.errors.length)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.cancel();\n\t\t\tthis.emitFinishEditEvent();\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tcancel(): void\n\t{\n\t\tthis.#toDoEditor.clearValue();\n\t\tDom.addClass(this.#saveButton, 'ui-btn-disabled');\n\t\tthis.setFocused(false);\n\t}\n\n\tbindInputHandlers(): void\n\t{\n\t\t// do nothing\n\t}\n\n\tsetParentActivityId(activityId: Number): void\n\t{\n\t\tthis.#toDoEditor.setParentActivityId(activityId);\n\t}\n\n\tsetDeadLine(deadLine: String): void\n\t{\n\t\tthis.#toDoEditor.setDeadline(deadLine);\n\t}\n\n\tfocus(): void\n\t{\n\t\tthis.#toDoEditor.setFocused();\n\t}\n\n\t#onChangeDescription(event: BaseEvent): void\n\t{\n\t\tlet {description} = event.getData();\n\t\tdescription = description.trim();\n\n\t\tif (!description.length && !Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\tDom.addClass(this.#saveButton, 'ui-btn-disabled');\n\t\t}\n\t\telse if (description.length && Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\tDom.removeClass(this.#saveButton, 'ui-btn-disabled')\n\t\t}\n\t}\n}\n","import {Dom} from \"main.core\";\nimport Item from \"../item\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class WithEditor extends Item\n{\n\tinitializeLayout(): void\n\t{\n\t\tthis._ownerTypeId = this.getEntityTypeId();\n\t\tthis._ownerId = this.getEntityId();\n\n\t\tthis._ghostInput = null;\n\n\t\tthis._saveButtonHandler = BX.delegate(this.onSaveButtonClick, this);\n\t\tthis._cancelButtonHandler = BX.delegate(this.onCancelButtonClick, this);\n\t\tthis._focusHandler = BX.delegate(this.onFocus, this);\n\t\tthis._blurHandler = BX.delegate(this.onBlur, this);\n\t\tthis._keyupHandler = BX.delegate(this.resizeForm, this);\n\t\tthis._delayedKeyupHandler = BX.delegate(\n\t\t\tfunction()\n\t\t\t{\n\t\t\t\tsetTimeout(this.resizeForm.bind(this), 0);\n\t\t\t},\n\t\t\tthis\n\t\t);\n\n\t\tthis._hideButtonsOnBlur = true;\n\n\t\tthis.bindInputHandlers();\n\t\tthis.doInitialize();\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tbindInputHandlers()\n\t{\n\t\tBX.bind(this._input, \"focus\", this._focusHandler);\n\t\tBX.bind(this._input, \"blur\", this._blurHandler);\n\t\tBX.bind(this._input, \"keyup\", this._keyupHandler);\n\t\tBX.bind(this._input, \"cut\", this._delayedKeyupHandler);\n\t\tBX.bind(this._input, \"paste\", this._delayedKeyupHandler);\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\tonBlur(e)\n\t{\n\t\tif(!this._hideButtonsOnBlur)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._input.value === \"\")\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tBX.delegate(function() {\n\t\t\t\t\tthis.setFocused(false);\n\t\t\t\t\tthis._input.style.minHeight = \"\";\n\t\t\t\t}, this),\n\t\t\t\t200\n\t\t\t);\n\t\t}\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tDom.addClass(this._saveButton, 'ui-btn-wait');\n\t\tconst removeButtonWaitClass = () => Dom.removeClass(this._saveButton, 'ui-btn-wait');\n\n\t\tconst saveResult = this.save();\n\t\tif (saveResult instanceof BX.Promise || saveResult instanceof Promise)\n\t\t{\n\t\t\tsaveResult.then(\n\t\t\t\t() => removeButtonWaitClass(),\n\t\t\t\t() => removeButtonWaitClass()\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tremoveButtonWaitClass();\n\t\t}\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\tsave()\n\t{\n\t}\n\n\tcancel()\n\t{\n\t}\n\n\trelease()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\tthis._ghostInput = BX.remove(this._ghostInput);\n\t\t}\n\t}\n\n\tensureGhostCreated()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\treturn this._ghostInput;\n\t\t}\n\n\t\tthis._ghostInput = BX.create('div', {\n\t\t\tprops: { className: 'crm-entity-stream-content-new-comment-textarea-shadow' },\n\t\t\ttext: this._input.value\n\t\t});\n\n\t\tthis._ghostInput.style.width = this._input.offsetWidth + 'px';\n\t\tdocument.body.appendChild(this._ghostInput);\n\t\treturn this._ghostInput;\n\t}\n\n\tresizeForm()\n\t{\n\t\tconst ghost = this.ensureGhostCreated();\n\t\tconst computedStyle = getComputedStyle(this._input);\n\t\tconst diff = parseInt(computedStyle.paddingBottom) +\n\t\t\tparseInt(computedStyle.paddingTop) +\n\t\t\tparseInt(computedStyle.borderTopWidth) +\n\t\t\tparseInt(computedStyle.borderBottomWidth) || 0;\n\n\t\tghost.innerHTML = BX.util.htmlspecialchars(this._input.value.replace(/[\\r\\n]{1}/g, '<br>'));\n\t\tthis._input.style.minHeight = ghost.scrollHeight + diff + 'px'\n\t}\n}\n","import WithEditor from \"./witheditor\";\nimport {Tag, Loc, ajax} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Comment extends WithEditor\n{\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea  rows=\"1\" class=\"crm-entity-stream-content-new-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_COMMENT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --hidden\">\n\t\t\t\t\t${this._input}\n\t\t\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t\t\t${this._saveButton}\n\t\t\t\t\t\t${this._cancelButton}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._postForm = null;\n\t\tthis._editor = null;\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tBX.unbind(this._input, \"blur\", this._blurHandler);\n\t\tBX.unbind(this._input, \"keyup\", this._keyupHandler);\n\t}\n\n\tloadEditor()\n\t{\n\t\tthis._editorName = 'CrmTimeLineComment0';\n\n\t\tif (this._postForm)\n\t\t\treturn;\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.timeline.loadEditor\",\n\t\t\t{ data: { name: this._editorName } }\n\t\t).then(this.onLoadEditorSuccess.bind(this));\n\t}\n\n\tonLoadEditorSuccess(result)\n\t{\n\t\tconst html = BX.prop.getString(BX.prop.getObject(result, \"data\", {}), \"html\", '');\n\t\tBX.html(this._editorContainer, html)\n\t\t\t.then(BX.delegate(this.showEditor,this))\n\t\t\t.then(BX.delegate(this.addEvents,this));\n\t}\n\n\taddEvents()\n\t{\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAppended',\n\t\t\tBX.delegate(function(id, item) {\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tthis._saveButton.removeEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAdded',\n\t\t\tBX.delegate(function(file, controller, obj, blob) {\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tthis._saveButton.addEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\t}\n\n\tshowEditor()\n\t{\n\t\tif (LHEPostForm)\n\t\t{\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis._postForm = LHEPostForm.getHandler(this._editorName);\n\t\t\t\tthis._editor = BXHtmlEditor.Get(this._editorName);\n\t\t\t\tBX.onCustomEvent(this._postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t} ,this), 100);\n\t\t}\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis._input.style.display = 'none';\n\t\tif (this._editor && this._postForm)\n\t\t{\n\t\t\tthis._postForm.eventNode.style.display = 'block';\n\t\t\tthis._editor.Focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!BX.type.isDomNode(this._editorContainer))\n\t\t\t{\n\t\t\t\tthis._editorContainer = BX.create(\"div\", {attrs: {className: \"crm-entity-stream-section-comment-editor\"}});\n\t\t\t\tthis._editorContainer.appendChild(\n\t\t\t\t\tBX.create(\"DIV\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tattrs: { className: \"crm-timeline-wait\" }\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tthis.getContainer().appendChild(this._editorContainer);\n\t\t\t}\n\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis.loadEditor();\n\t\t\t} ,this), 100);\n\t\t}\n\n\t\tthis.setFocused(true);\n\t}\n\n\tsave()\n\t{\n\t\tlet text = \"\";\n\t\tconst attachmentList = [];\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\ttext = this._postForm.oEditor.GetContent();\n\n\t\t\tthis._postForm.eventNode\n\t\t\t\t.querySelectorAll('input[name=\"UF_CRM_COMMENT_FILES[]\"]')\n\t\t\t\t.forEach(function(input) {\n\t\t\t\t\tattachmentList.push(input.value)\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t}\n\n\t\tif (text === \"\")\n\t\t{\n\t\t\tif (!this.emptyCommentMessage)\n\t\t\t{\n\t\t\t\tthis.emptyCommentMessage = new BX.PopupWindow(\n\t\t\t\t\t'timeline_empty_new_comment_' + this.getEntityId(),\n\t\t\t\t\tthis._saveButton,\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent: BX.message('CRM_TIMELINE_EMPTY_COMMENT_MESSAGE'),\n\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tzIndex: 990,\n\t\t\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tbindOptions: { forceBindPosition: true}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.emptyCommentMessage.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = this._isLocked = true;\n\n\t\treturn ajax.runAction(\n\t\t\t'crm.timeline.comment.add',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tENTITY_ID: this.getEntityId(),\n\t\t\t\t\t\tENTITY_TYPE_ID: this.getEntityTypeId(),\n\t\t\t\t\t\tCOMMENT: text,\n\t\t\t\t\t\tATTACHMENTS: attachmentList\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t).then((result) => {\n\t\t\tthis.onSaveSuccess();\n\n\t\t\treturn result;\n\t\t}).catch((result) => {\n\t\t\tthis.onSaveFailure();\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tif (BX.type.isDomNode(this._editorContainer))\n\t\t\tthis._postForm.eventNode.style.display = 'none';\n\n\t\tthis._input.style.display = 'block';\n\t\tthis.setFocused(false);\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tthis.release();\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\tthis._postForm.reinit('', {});\n\t\t}\n\t\tthis.emitFinishEditEvent();\n\t\tthis.cancel();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n}\n","import WithEditor from './witheditor';\nimport { Loc, Tag, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Sms extends WithEditor\n{\n\tcreateLayout(): HTMLElement\n\t{\n\t\tconst canSend = this.getSetting('canSendMessage', false);\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --focus --hidden\">\n\t\t\t${canSend ? this.#renderEditor() : this.#renderSetupText()}\n\t\t</div>`;\n\t}\n\n\t#renderEditor(): HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {})\n\t\tconst enableSalesCenter =  BX.prop.getBoolean(config, 'isSalescenterEnabled', false);\n\t\tconst enableDocuments = BX.prop.getBoolean(config, 'isDocumentsEnabled', false);\n\t\tconst enableFiles = this.getSetting('enableFiles', false);\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea class=\"crm-entity-stream-content-new-sms-textarea\" rows='1' placeholder=\"${Loc.getMessage('CRM_TIMELINE_SMS_ENTER_MESSAGE')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-buttons-container\">\n\t\t\t${enableSalesCenter ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"salescenter-starter\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableFiles ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-file-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_FILE')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableDocuments ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-document-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-document-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_DOCUMENT')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-detail-toggle\" data-role=\"sms-detail-switcher\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_DETAILS')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-container hidden\" data-role=\"sms-detail\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SENDER')}\n\t\t\t\t\t\t<a href=\"#\" data-role=\"sender-selector\">sender</a><span data-role=\"from-container\">${Loc.getMessage('CRM_TIMELINE_SMS_FROM')}\n\t\t\t\t\t\t<a data-role=\"from-selector\" href=\"#\">from_number</a></span>\n\t\t\t\t\t\t<span data-role=\"client-container\"> ${Loc.getMessage('CRM_TIMELINE_SMS_TO')}\n\t\t\t\t\t\t<a data-role=\"client-selector\" href=\"#\">client_caption</a> <a data-role=\"to-selector\" href=\"#\">to_number</a></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<!--<span class=\"crm-entity-stream-content-sms-conditions-helper-icon\"></span>-->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t${this.#renderTemplatesContainer()}\n\t\t\t${this.#renderFilesSelector()}\n\n\t\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-symbol-counter\" data-role=\"message-length-counter-wrap\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\" data-role=\"message-length-counter\" data-length-max=\"200\">0</span>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS_FROM')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\">200</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSetupText(): HTMLElement\n\t{\n\t\tconst enableSalesCenter =  BX.prop.getBoolean(this.getSetting('smsConfig', {}), 'isSalescenterEnabled', false);\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-conditions-container\">\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t<strong>${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_1')}</strong><br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_2')}<br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_3')}\n\t\t\t\t\t<!--<span class=\"crm-entity-stream-content-sms-conditions-helper-icon\"></span>-->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t<a href=\"#\" data-role=\"sender-selector\" target=\"_top\" class=\"crm-entity-stream-content-new-sms-connect-link\">${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_URL')}</a>\n\t\t\t${enableSalesCenter ? Tag.render`<div class=\"crm-entity-stream-content-sms-salescenter-container-absolute\" data-role=\"salescenter-starter\">\n\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n</div>` : null}\n\t\t</div>`;\n\t}\n\n\t#renderTemplatesContainer(): HTMLElement\n\t{\n\t\tthis._templatesContainer = Tag.render`<div class=\"crm-entity-stream-content-new-sms-templates\">\n\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_TEMPLATE_LIST_TITLE')}<span class=\"ui-hint\" data-role=\"hint\"><span class=\"ui-hint-icon\"></span></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\" data-role=\"template-selector\">\n\t\t\t\t\t<div class=\"ui-ctl-element\" data-role=\"template-title\"></div>\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-new-sms-preview\" data-role=\"preview\"></div>\n\t\t\t</div>`;\n\n\t\treturn this._templatesContainer;\n\t}\n\n\t#renderFilesSelector(): ?HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {});\n\n\t\tconst showFiles = this.getSetting('showFiles', false);\n\t\tconst enableFilesExternalLink = BX.prop.getBoolean(config, 'isFilesExternalLinkEnabled', false);\n\n\t\tif (enableFilesExternalLink)\n\t\t{\n\t\t\tconst fileInputPrefix = 'crm-' + this.getEntityTypeId() + '-' + this.getEntityId();\n\t\t\tconst fileInputName = fileInputPrefix + '-sms-files';\n\t\t\tconst fileUploaderInputName = fileInputPrefix + '-sms-files-uploader';\n\t\t\tconst fileUploaderZoneId = 'diskuf-selectdialog-' + fileInputPrefix;\n\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-uploader-zone\" data-role=\"sms-file-upload-zone\" data-node-id=\"${fileInputPrefix}\">\n\t\t\t\t<div id=\"${fileUploaderZoneId}\" class=\"diskuf-files-entity diskuf-selectdialog bx-disk\">\n\t\t\t\t\t<div class=\"diskuf-files-block checklist-loader-files\">\n\t\t\t\t\t\t<div class=\"diskuf-placeholder\">\n\t\t\t\t\t\t\t<table class=\"files-list\">\n\t\t\t\t\t\t\t\t<tbody class=\"diskuf-placeholder-tbody\"></tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended\">\n\t\t\t\t\t\t<input type=\"hidden\" name=\"${fileInputName}[]\" value=\"\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<label for=\"${fileUploaderInputName}\" data-role=\"sms-file-upload-label\"></label>\n\t\t\t\t\t\t<input class=\"diskuf-fileUploader\" id=\"${fileUploaderInputName}\" type=\"file\" data-role=\"sms-file-upload-input\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<span class=\"diskuf-selector-link\" data-role=\"sms-file-selector-bitrix\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\t\tif (showFiles)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-external-link-popup\" data-role=\"sms-file-external-link-disabled\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-inner\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img\">\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img-lock\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_FILE_EXTERNAL_LINK_FEATURE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._senderId = null;\n\t\tthis._from = null;\n\t\tthis._commEntityTypeId = null;\n\t\tthis._commEntityId = null;\n\t\tthis._to = null;\n\n\t\tthis._fromList = [];\n\t\tthis._toList = [];\n\t\tthis._defaults = {};\n\t\tthis._communications = [];\n\n\t\tthis._menu = null;\n\t\tthis._isMenuShown = false;\n\t\tthis._shownMenuId = null;\n\t\tthis._documentSelector = null;\n\t\tthis._source = null;\n\n\t\tthis._paymentId = null;\n\t\tthis._shipmentId = null;\n\n\t\tthis._compilationProductIds = [];\n\n\t\tthis._templateId = null;\n\t\tthis._templateFieldHintNode = null;\n\t\tthis._templateSelectorNode = null;\n\t\tthis._templateTemplateTitleNode = null;\n\t\tthis._templatePreviewNode = null;\n\t\tthis._templateSelectorMenuId = 'CrmTimelineSmsEditorTemplateSelector';\n\t\tthis._templateFieldHintHandler = BX.delegate(this.onTemplateHintIconClick, this);\n\t\tthis._templateSeletorClickHandler = BX.delegate(this.onTemplateSelectClick, this);\n\t\tthis._selectTemplateHandler = BX.delegate(this.onSelectTemplate, this);\n\n\t\tthis._serviceUrl = BX.util.remove_url_param(\n\t\t\tthis.getSetting(\"serviceUrl\", \"\"),\n\t\t\t['sessid', 'site']\n\t\t);\n\n\t\tconst config = this.getSetting( 'smsConfig', {});\n\n\t\tthis._canUse = BX.prop.getBoolean(config, \"canUse\", false);\n\t\tthis._canSendMessage = BX.prop.getBoolean(config, \"canSendMessage\", false);\n\t\tthis._manageUrl = BX.prop.getString(config, \"manageUrl\", '');\n\t\tthis._senders = BX.prop.getArray(config, \"senders\", []);\n\t\tthis._defaults = BX.prop.getObject(config, \"defaults\", {senderId:null,from:null});\n\t\tthis._communications = BX.prop.getArray(config, \"communications\", []);\n\t\tthis._isSalescenterEnabled = BX.prop.getBoolean(config, \"isSalescenterEnabled\", false);\n\t\tthis._isDocumentsEnabled = BX.prop.getBoolean(config, \"isDocumentsEnabled\", false);\n\t\tif(this._isDocumentsEnabled)\n\t\t{\n\t\t\tthis._documentsProvider = BX.prop.getString(config, \"documentsProvider\", '');\n\t\t\tthis._documentsValue = BX.prop.getString(config, \"documentsValue\", '');\n\t\t}\n\t\tthis._isFilesEnabled = BX.prop.getBoolean(config, \"isFilesEnabled\", false);\n\t\tif(this._isFilesEnabled)\n\t\t{\n\t\t\tthis._diskUrls = BX.prop.getObject(config, \"diskUrls\");\n\t\t\tthis._isFilesExternalLinkEnabled = BX.prop.getBoolean(config, \"isFilesExternalLinkEnabled\", true);\n\t\t}\n\n\t\tthis._senderSelectorNode = this.getContainer().querySelector('[data-role=\"sender-selector\"]');\n\t\tthis._fromContainerNode = this.getContainer().querySelector('[data-role=\"from-container\"]');\n\t\tthis._fromSelectorNode = this.getContainer().querySelector('[data-role=\"from-selector\"]');\n\t\tthis._clientContainerNode = this.getContainer().querySelector('[data-role=\"client-container\"]');\n\t\tthis._clientSelectorNode = this.getContainer().querySelector('[data-role=\"client-selector\"]');\n\t\tthis._toSelectorNode = this.getContainer().querySelector('[data-role=\"to-selector\"]');\n\t\tthis._messageLengthCounterWrapperNode = this.getContainer().querySelector('[data-role=\"message-length-counter-wrap\"]');\n\t\tthis._messageLengthCounterNode = this.getContainer().querySelector('[data-role=\"message-length-counter\"]');\n\t\tthis._salescenterStarter = this.getContainer().querySelector('[data-role=\"salescenter-starter\"]');\n\t\tthis._smsDetailSwitcher = this.getContainer().querySelector('[data-role=\"sms-detail-switcher\"]');\n\t\tthis._smsDetail = this.getContainer().querySelector('[data-role=\"sms-detail\"]');\n\t\tthis._documentSelectorButton = this.getContainer().querySelector('[data-role=\"sms-document-selector\"]');\n\t\tthis._fileSelectorButton = this.getContainer().querySelector('[data-role=\"sms-file-selector\"]');\n\t\tthis._fileUploadZone = this.getContainer().querySelector('[data-role=\"sms-file-upload-zone\"]');\n\t\tthis._fileUploadLabel = this.getContainer().querySelector('[data-role=\"sms-file-upload-label\"]');\n\t\tthis._fileSelectorBitrix = this.getContainer().querySelector('[data-role=\"sms-file-selector-bitrix\"]');\n\t\tthis._fileExternalLinkDisabledContent = this.getContainer().querySelector('[data-role=\"sms-file-external-link-disabled\"]');\n\n\t\tif (this._templatesContainer)\n\t\t{\n\t\t\tthis._templateFieldHintNode = this._templatesContainer.querySelector('[data-role=\"hint\"]');\n\t\t\tthis._templateSelectorNode = this._templatesContainer.querySelector('[data-role=\"template-selector\"]');\n\t\t\tthis._templateTemplateTitleNode = this._templatesContainer.querySelector('[data-role=\"template-title\"]');\n\t\t\tthis._templatePreviewNode = this._templatesContainer.querySelector('[data-role=\"preview\"]');\n\t\t}\n\t\tif (this._templateFieldHintNode)\n\t\t{\n\t\t\tBX.bind(this._templateFieldHintNode, \"click\", this._templateFieldHintHandler);\n\t\t}\n\t\tif (this._templateSelectorNode)\n\t\t{\n\t\t\tBX.bind(this._templateSelectorNode, \"click\", this._templateSeletorClickHandler);\n\t\t}\n\n\t\tif (this._canUse && this._senders.length > 0)\n\t\t{\n\t\t\tthis.initSenderSelector();\n\t\t}\n\t\tif (this._canUse && this._canSendMessage)\n\t\t{\n\t\t\tthis.initDetailSwitcher();\n\t\t\tthis.initFromSelector();\n\t\t\tthis.initClientContainer();\n\t\t\tthis.initClientSelector();\n\t\t\tthis.initToSelector();\n\t\t\tthis.initMessageLengthCounter();\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tif(this._isDocumentsEnabled)\n\t\t\t{\n\t\t\t\tthis.initDocumentSelector();\n\t\t\t}\n\t\t\tif(this._isFilesEnabled)\n\t\t\t{\n\t\t\t\tthis.initFileSelector();\n\t\t\t}\n\t\t}\n\n\t\tthis.#subscribeToReceiversChanges();\n\n\t\tif(this._isSalescenterEnabled)\n\t\t{\n\t\t\tthis.initSalescenterApplication();\n\t\t}\n\t}\n\n\tinitDetailSwitcher()\n\t{\n\t\tBX.bind(this._smsDetailSwitcher, 'click', function()\n\t\t{\n\t\t\tif(this._smsDetail.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.remove('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_COLLAPSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.add('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_DETAILS');\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tinitSenderSelector()\n\t{\n\t\tconst defaultSenderId = this._defaults.senderId;\n\t\tlet defaultSender = this._senders[0].canUse ? this._senders[0] : null;\n\t\tlet restSender = null;\n\t\tconst menuItems = [];\n\t\tconst handler = this.onSenderSelectorClick.bind(this);\n\n\t\tfor (let i = 0; i < this._senders.length; ++i)\n\t\t{\n\t\t\tif (this._senders[i].canUse && this._senders[i].fromList.length && (this._senders[i].id === defaultSenderId || !defaultSender))\n\t\t\t{\n\t\t\t\tdefaultSender = this._senders[i];\n\t\t\t}\n\n\t\t\tif (this._senders[i].id === 'rest')\n\t\t\t{\n\t\t\t\trestSender = this._senders[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._senders[i].name,\n\t\t\t\tsender: this._senders[i],\n\t\t\t\tonclick: handler,\n\t\t\t\tclassName: (!this._senders[i].canUse || !this._senders[i].fromList.length)\n\t\t\t\t\t? 'crm-timeline-popup-menu-item-disabled menu-popup-no-icon' : ''\n\t\t\t});\n\t\t}\n\n\t\tif (restSender)\n\t\t{\n\t\t\tif (restSender.fromList.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({delimiter: true});\n\t\t\t\tfor (let i = 0; i < restSender.fromList.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\ttext: restSender.fromList[i].name,\n\t\t\t\t\t\tsender: restSender,\n\t\t\t\t\t\tfrom: restSender.fromList[i],\n\t\t\t\t\t\tonclick: handler\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tmenuItems.push({delimiter: true}, {\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_REST_MARKETPLACE'),\n\t\t\t\thref: '/marketplace/category/crm_robot_sms/',\n\t\t\t\ttarget: '_blank'\n\t\t\t});\n\t\t}\n\n\t\tif (defaultSender)\n\t\t{\n\t\t\tthis.setSender(defaultSender);\n\t\t}\n\n\t\tBX.bind(this._senderSelectorNode, 'click', this.openMenu.bind(this, 'sender', this._senderSelectorNode, menuItems));\n\t}\n\n\tonSenderSelectorClick(e, item)\n\t{\n\t\tif (item.sender)\n\t\t{\n\t\t\tif (!item.sender.canUse || !item.sender.fromList.length)\n\t\t\t{\n\t\t\t\tconst url = BX.Uri.addParam(item.sender.manageUrl, {'IFRAME': 'Y'});\n\t\t\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\tconst options = {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: function () {\n\t\t\t\t\t\t\tif (slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tslider.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCloseComplete: function () {\n\t\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdocument.location.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (item.sender.id === 'ednaru')\n\t\t\t\t{\n\t\t\t\t\toptions.width = 700;\n\t\t\t\t}\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setSender(item.sender, true);\n\t\t\tconst from = item.from ? item.from : item.sender.fromList[0];\n\t\t\tthis.setFrom(from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetSender(sender, setAsDefault)\n\t{\n\t\tthis._senderId = sender.id;\n\t\tthis._fromList = sender.fromList;\n\t\tthis._senderSelectorNode.textContent = sender.shortName ? sender.shortName : sender.name;\n\n\t\tthis._templateId = null;\n\t\tif (sender.isTemplatesBased)\n\t\t{\n\t\t\tthis.showNode(this._templatesContainer);\n\t\t\tthis.hideNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.hideNode(this._fileSelectorButton);\n\t\t\tthis.hideNode(this._documentSelectorButton);\n\t\t\tthis.hideNode(this._input);\n\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\tthis.toggleSaveButton();\n\t\t\tthis._hideButtonsOnBlur = false;\n\t\t\tthis.onFocus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideNode(this._templatesContainer);\n\t\t\tthis.showNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.showNode(this._fileSelectorButton);\n\t\t\tthis.showNode(this._documentSelectorButton);\n\t\t\tthis.showNode(this._input);\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._hideButtonsOnBlur = true;\n\t\t}\n\n\t\tconst visualFn = sender.id === 'rest' ? 'hide' : 'show';\n\t\tBX[visualFn](this._fromContainerNode);\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"senderId\", this._senderId);\n\t\t}\n\t}\n\n\tshowNode(node)\n\t{\n\t\tif (node)\n\t\t{\n\t\t\tnode.style.display = \"\";\n\t\t}\n\t}\n\n\thideNode(node)\n\t{\n\t\tif (node)\n\t\t{\n\t\t\tnode.style.display = \"none\";\n\t\t}\n\t}\n\n\tinitFromSelector()\n\t{\n\t\tif (this._fromList.length > 0)\n\t\t{\n\t\t\tconst defaultFromId = this._defaults.from || this._fromList[0].id;\n\t\t\tlet defaultFrom = null;\n\t\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t\t{\n\t\t\t\tif (this._fromList[i].id === defaultFromId || !defaultFrom)\n\t\t\t\t{\n\t\t\t\t\tdefaultFrom = this._fromList[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (defaultFrom)\n\t\t\t{\n\t\t\t\tthis.setFrom(defaultFrom);\n\t\t\t}\n\t\t}\n\n\t\tBX.bind(this._fromSelectorNode, 'click', this.onFromSelectorClick.bind(this));\n\t}\n\n\tonFromSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onFromSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._fromList[i].name,\n\t\t\t\tfrom: this._fromList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('from_'+this._senderId, this._fromSelectorNode, menuItems, e);\n\t}\n\n\tonFromSelectorItemClick(e, item)\n\t{\n\t\tif (item.from)\n\t\t{\n\t\t\tthis.setFrom(item.from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetFrom(from, setAsDefault)\n\t{\n\t\tthis._from = from.id;\n\n\t\tif (this._senderId === 'rest')\n\t\t{\n\t\t\tthis._senderSelectorNode.textContent = from.name;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._fromSelectorNode.textContent = from.name;\n\t\t}\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"from\", this._from);\n\t\t}\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item, current } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Type.isArray(current))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst phoneReceivers = current.filter(receiver => receiver.address.typeId === 'PHONE');\n\n\t\t\tconst newCommunications: {[addressSourceHash: string]: Object} = {};\n\t\t\tfor (const receiver of phoneReceivers)\n\t\t\t{\n\t\t\t\tlet communication = newCommunications[receiver.addressSource.hash];\n\n\t\t\t\tif (!communication)\n\t\t\t\t{\n\t\t\t\t\tcommunication = {\n\t\t\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(receiver.addressSource.entityTypeId),\n\t\t\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\t\t\tcaption: receiver.addressSourceData?.title,\n\t\t\t\t\t\tphones: [],\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tcommunication.phones.push({\n\t\t\t\t\ttype: receiver.address.typeId,\n\t\t\t\t\tvalue: receiver.address.value,\n\t\t\t\t\tvalueFormatted: receiver.address.valueFormatted,\n\t\t\t\t});\n\n\t\t\t\tnewCommunications[receiver.addressSource.hash] = communication;\n\t\t\t}\n\n\t\t\tthis._communications = Object.values(newCommunications);\n\n\t\t\tconst oldSelectedClient = this._communications.find(communication => {\n\t\t\t\treturn communication.entityTypeId === this._commEntityTypeId && communication.entityId === this._commEntityId;\n\t\t\t});\n\t\t\tthis.setClient(oldSelectedClient ?? this._communications[0]);\n\n\t\t\tthis.initClientContainer();\n\t\t});\n\t}\n\n\tinitClientContainer()\n\t{\n\t\tif (!Type.isDomNode(this._clientContainerNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._communications.length === 0)\n\t\t{\n\t\t\tBX.hide(this._clientContainerNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.show(this._clientContainerNode);\n\t\t}\n\t}\n\n\tinitClientSelector()\n\t{\n\t\tconst defaultClient = this._communications[0];\n\t\tif (defaultClient)\n\t\t{\n\t\t\tthis.setClient(defaultClient);\n\t\t}\n\n\t\tconst handler = this.onClientSelectorClick.bind(this);\n\n\t\tBX.bind(this._clientSelectorNode, 'click', (event) => {\n\t\t\tconst menuItems = [];\n\n\t\t\tfor (const communication of this._communications)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: communication.caption,\n\t\t\t\t\tclient: communication,\n\t\t\t\t\tonclick: handler,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.openMenu('comm', this._clientSelectorNode, menuItems, event);\n\t\t});\n\t}\n\n\tonClientSelectorClick(e, item)\n\t{\n\t\tif (item.client)\n\t\t{\n\t\t\tthis.setClient(item.client);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetClient(client: ?Object)\n\t{\n\t\tthis._commEntityTypeId = client?.entityTypeId;\n\t\tthis._commEntityId = client?.entityId;\n\t\tif (Type.isDomNode(this._clientSelectorNode))\n\t\t{\n\t\t\tthis._clientSelectorNode.textContent = client?.caption ?? '';\n\t\t}\n\t\tthis._toList = client?.phones ?? [];\n\t\tthis.setTo(client?.phones[0] ?? {});\n\t}\n\n\tinitToSelector()\n\t{\n\t\tBX.bind(this._toSelectorNode, 'click', this.onToSelectorClick.bind(this));\n\t}\n\n\tonToSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onToSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._toList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._toList[i].valueFormatted || this._toList[i].value,\n\t\t\t\tto: this._toList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('to_'+this._commEntityTypeId+'_'+this._commEntityId, this._toSelectorNode, menuItems, e);\n\t}\n\n\tonToSelectorItemClick(e, item)\n\t{\n\t\tif (item.to)\n\t\t{\n\t\t\tthis.setTo(item.to);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetTo(to: ?Object)\n\t{\n\t\tthis._to = to?.value;\n\t\tif (Type.isDomNode(this._toSelectorNode))\n\t\t{\n\t\t\tthis._toSelectorNode.textContent = (to?.valueFormatted || to?.value) ?? '';\n\t\t}\n\t}\n\n\topenMenu(menuId, bindElement, menuItems, e)\n\t{\n\t\tif (this._shownMenuId === menuId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._shownMenuId !== null && this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t\tthis._shownMenuId = null;\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id + menuId,\n\t\t\tbindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t\te.preventDefault();\n\t}\n\n\tonMenuClose()\n\t{\n\t\tthis._shownMenuId = null;\n\t\tthis._menu = null;\n\t}\n\n\tinitMessageLengthCounter()\n\t{\n\t\tthis._messageLengthMax = parseInt(this._messageLengthCounterNode.getAttribute('data-length-max'));\n\t\tBX.bind(this._input, 'keyup', this.setMessageLengthCounter.bind(this));\n\t\tBX.bind(this._input, 'cut', this.setMessageLengthCounterDelayed.bind(this));\n\t\tBX.bind(this._input, 'paste', this.setMessageLengthCounterDelayed.bind(this));\n\t}\n\n\tsetMessageLengthCounterDelayed()\n\t{\n\t\tsetTimeout(this.setMessageLengthCounter.bind(this), 0);\n\t}\n\n\tsetMessageLengthCounter()\n\t{\n\t\tconst length = this._input.value.length;\n\t\tthis._messageLengthCounterNode.textContent = length;\n\n\t\tconst classFn = length >= this._messageLengthMax ? 'addClass' : 'removeClass';\n\t\tBX[classFn](this._messageLengthCounterNode, 'crm-entity-stream-content-sms-symbol-counter-number-overhead');\n\n\t\tthis.toggleSaveButton();\n\t}\n\n\ttoggleSaveButton()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tlet enabled;\n\t\tif (!sender || !sender.isTemplatesBased)\n\t\t{\n\t\t\tenabled = this._input.value.length > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenabled = !!this._templateId;\n\t\t}\n\t\tif (enabled)\n\t\t{\n\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tlet text = '';\n\t\tlet templateId = '';\n\n\t\tif (!sender || !sender.isTemplatesBased)\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t\tif (text === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst template = this.getSelectedTemplate();\n\t\t\tif (!template)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttext = template.PREVIEW;\n\t\t\ttemplateId = template.ID;\n\t\t}\n\n\t\tif (!this._communications.length)\n\t\t{\n\t\t\talert(BX.message('CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS'));\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = this._isLocked = true;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax(\n\t\t\t\t{\n\t\t\t\t\turl: BX.util.add_url_param(this._serviceUrl, {\n\t\t\t\t\t\t\"action\": \"save_sms_message\",\n\t\t\t\t\t\t\"sender\": this._senderId\n\t\t\t\t\t}),\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\tdata:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'site': BX.message('SITE_ID'),\n\t\t\t\t\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t\t\t\t\t'source': this._source,\n\t\t\t\t\t\t\t\"ACTION\": \"SAVE_SMS_MESSAGE\",\n\t\t\t\t\t\t\t\"SENDER_ID\": this._senderId,\n\t\t\t\t\t\t\t\"MESSAGE_FROM\": this._from,\n\t\t\t\t\t\t\t\"MESSAGE_TO\": this._to,\n\t\t\t\t\t\t\t\"MESSAGE_BODY\": text,\n\t\t\t\t\t\t\t\"MESSAGE_TEMPLATE\": templateId,\n\t\t\t\t\t\t\t\"OWNER_TYPE_ID\": this._ownerTypeId,\n\t\t\t\t\t\t\t\"OWNER_ID\": this._ownerId,\n\t\t\t\t\t\t\t\"TO_ENTITY_TYPE_ID\": this._commEntityTypeId,\n\t\t\t\t\t\t\t\"TO_ENTITY_ID\": this._commEntityId,\n\t\t\t\t\t\t\t\"PAYMENT_ID\": this._paymentId,\n\t\t\t\t\t\t\t\"SHIPMENT_ID\": this._shipmentId,\n\t\t\t\t\t\t\t\"COMPILATION_PRODUCT_IDS\": this._compilationProductIds,\n\t\t\t\t\t\t},\n\t\t\t\t\tonsuccess: () => {\n\t\t\t\t\t\tthis.onSaveSuccess();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tonfailure: () => {\n\t\t\t\t\t\tthis.onSaveFailure();\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tinitSalescenterApplication()\n\t{\n\t\tBX.bind(this._salescenterStarter, 'click', this.startSalescenterApplication.bind(this));\n\t}\n\n\tstartSalescenterApplication()\n\t{\n\t\tBX.loadExt('salescenter.manager').then(function()\n\t\t{\n\t\t\tBX.Salescenter.Manager.openApplication({\n\t\t\t\tdisableSendButton: this._canSendMessage ? '' : 'y',\n\t\t\t\tcontext: 'sms',\n\t\t\t\townerTypeId: this._ownerTypeId,\n\t\t\t\townerId: this._ownerId,\n\t\t\t\tmode: this._ownerTypeId === BX.CrmEntityType.enumeration.deal ? 'payment_delivery' : 'payment',\n\t\t\t}).then(function(result)\n\t\t\t{\n\t\t\t\tif(result && result.get('action'))\n\t\t\t\t{\n\t\t\t\t\tif(result.get('action') === 'sendPage' && result.get('page') && result.get('page').url)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('page').name + ' ' + result.get('page').url;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t}\n\t\t\t\t\telse if (result.get('action') === 'sendPayment' && result.get('order'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('order').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'order';\n\t\t\t\t\t\tthis._paymentId = result.get('order').paymentId;\n\t\t\t\t\t\tthis._shipmentId = result.get('order').shipmentId;\n\t\t\t\t\t}\n\t\t\t\t\telse if(result.get('action') === 'sendCompilation' && result.get('compilation'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('compilation').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'deal';\n\t\t\t\t\t\tthis._compilationProductIds = result.get('compilation').productIds;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\tinitDocumentSelector()\n\t{\n\t\tBX.bind(this._documentSelectorButton, 'click', this.onDocumentSelectorClick.bind(this));\n\t}\n\n\tonDocumentSelectorClick()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\tBX.loadExt('documentgenerator.selector').then(function()\n\t\t\t{\n\t\t\t\tthis._documentSelector = new BX.DocumentGenerator.Selector.Menu({\n\t\t\t\t\tnode: this._documentSelectorButton,\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tprovider: this._documentsProvider,\n\t\t\t\t\tvalue: this._documentsValue,\n\t\t\t\t\tanalyticsLabelPrefix: 'crmTimelineSmsEditor'\n\t\t\t\t});\n\t\t\t\tthis.selectPublicUrl();\n\t\t\t}.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectPublicUrl();\n\t\t}\n\t}\n\n\tselectPublicUrl()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._documentSelector.show().then(function(object)\n\t\t{\n\t\t\tif(object instanceof BX.DocumentGenerator.Selector.Template)\n\t\t\t{\n\t\t\t\tthis._documentSelector.createDocument(object).then(function(document)\n\t\t\t\t{\n\t\t\t\t\tthis.pasteDocumentUrl(document);\n\t\t\t\t}.bind(this)).catch(function(error)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\telse if(object instanceof BX.DocumentGenerator.Selector.Document)\n\t\t\t{\n\t\t\t\tthis.pasteDocumentUrl(object);\n\t\t\t}\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tpasteDocumentUrl(document)\n\t{\n\t\tthis._documentSelector.getDocumentPublicUrl(document).then(function(publicUrl)\n\t\t{\n\t\t\tthis._input.focus();\n\t\t\tthis._input.value = this._input.value + ' ' + document.getTitle() + ' ' + publicUrl;\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._source = 'document';\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tinitFileSelector()\n\t{\n\t\tBX.bind(this._fileSelectorButton, 'click', this.onFileSelectorClick.bind(this));\n\t}\n\n\tcloseFileSelector()\n\t{\n\t\tBX.PopupMenu.destroy('sms-file-selector');\n\t}\n\n\tonFileSelectorClick()\n\t{\n\t\tBX.PopupMenu.show('sms-file-selector', this._fileSelectorButton, [\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_UPLOAD_FILE'),\n\t\t\t\tonclick: this.uploadFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_FIND_FILE'),\n\t\t\t\tonclick: this.findFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t}\n\t\t])\n\t}\n\n\tgetFileUploadInput()\n\t{\n\t\treturn document.getElementById(this._fileUploadLabel.getAttribute('for'));\n\t}\n\n\tuploadFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this.getFileUploadInput(), 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tfindFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this._fileSelectorBitrix, 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new BX.Loader(\n\t\t\t\t{\n\t\t\t\t\tsize: 50\n\t\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(node)\n\t{\n\t\tif(node && !this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(node);\n\t\t}\n\t}\n\n\thideLoader()\n\t{\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tinitDiskUF()\n\t{\n\t\tif(this.isDiskFileUploaderInited || !this._isFilesEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isDiskFileUploaderInited = true;\n\t\tBX.addCustomEvent(this._fileUploadZone, 'OnFileUploadSuccess', this.OnFileUploadSuccess.bind(this));\n\t\tBX.addCustomEvent(this._fileUploadZone, 'DiskDLoadFormControllerInit', function(uf)\n\t\t{\n\t\t\tuf._onUploadProgress = function()\n\t\t\t{\n\t\t\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\t\t}.bind(this);\n\t\t}.bind(this));\n\n\t\tBX.Disk.UF.add({\n\t\t\tUID: this._fileUploadZone.getAttribute('data-node-id'),\n\t\t\tcontrolName: this._fileUploadLabel.getAttribute('for'),\n\t\t\thideSelectDialog: false,\n\t\t\turlSelect: this._diskUrls.urlSelect,\n\t\t\turlRenameFile: this._diskUrls.urlRenameFile,\n\t\t\turlDeleteFile: this._diskUrls.urlDeleteFile,\n\t\t\turlUpload: this._diskUrls.urlUpload\n\t\t});\n\n\t\tBX.onCustomEvent(\n\t\t\tthis._fileUploadZone,\n\t\t\t'DiskLoadFormController',\n\t\t\t['show']\n\t\t);\n\t}\n\n\tOnFileUploadSuccess(fileResult, uf, file, uploaderFile)\n\t{\n\t\tthis.hideLoader();\n\t\tconst diskFileId = parseInt(fileResult.element_id.replace('n', ''));\n\t\tconst fileName = fileResult.element_name;\n\t\tthis.pasteFileUrl(diskFileId, fileName);\n\t}\n\n\tpasteFileUrl(diskFileId, fileName)\n\t{\n\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\tBX.ajax.runAction('disk.file.generateExternalLink', {\n\t\t\tanalyticsLabel: 'crmTimelineSmsEditorGetFilePublicUrl',\n\t\t\tdata: {\n\t\t\t\tfileId: diskFileId\n\t\t\t}\n\t\t}).then(function(response)\n\t\t{\n\t\t\tthis.hideLoader();\n\t\t\tif(response.data.externalLink && response.data.externalLink.link)\n\t\t\t{\n\t\t\t\tthis._input.focus();\n\t\t\t\tthis._input.value = this._input.value + ' ' + fileName + ' ' + response.data.externalLink.link;\n\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\tthis._source = 'file';\n\t\t\t}\n\t\t}.bind(this)).catch(function(response)\n\t\t{\n\t\t\tconsole.error(response.errors.pop().message);\n\t\t});\n\t}\n\n\tgetFeaturePopup(content)\n\t{\n\t\tif(this.featurePopup != null)\n\t\t{\n\t\t\treturn this.featurePopup;\n\t\t}\n\t\tthis.featurePopup = new BX.PopupWindow('bx-popup-crm-sms-editor-feature-popup', null, {\n\t\t\tzIndex: 200,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\toverlay : true,\n\t\t\tevents : {\n\t\t\t\tonPopupDestroy : function()\n\t\t\t\t{\n\t\t\t\t\tthis.featurePopup = null;\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tcontent : content,\n\t\t\tcontentColor: 'white'\n\t\t});\n\n\t\treturn this.featurePopup;\n\t}\n\n\tshowFilesExternalLinkFeaturePopup()\n\t{\n\t\tthis.getFeaturePopup(this._fileExternalLinkDisabledContent).show();\n\t}\n\n\tonTemplateHintIconClick()\n\t{\n\t\tif (this._senderId === 'ednaru')\n\t\t{\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14214014\");\n\t\t}\n\t}\n\n\tshowTemplateSelectDropdown(items)\n\t{\n\t\tconst menuItems = [];\n\t\tif (BX.Type.isArray(items))\n\t\t{\n\t\t\tif (items.length)\n\t\t\t{\n\t\t\t\titems.forEach(function(item)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\tvalue: item.ID,\n\t\t\t\t\t\ttext: item.TITLE,\n\t\t\t\t\t\tonclick: this._selectTemplateHandler\n\t\t\t\t\t})\n\t\t\t\t}.bind(this));\n\n\t\t\t\tBX.PopupMenu.show({\n\t\t\t\t\tid: this._templateSelectorMenuId,\n\t\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tangle: false,\n\t\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (this._senderId)\n\t\t{\n\t\t\tconst loaderMenuId = this._templateSelectorMenuId + 'loader';\n\t\t\tconst loaderMenuLoaderId = this._templateSelectorMenuId + 'loader';\n\n\t\t\tBX.PopupMenu.show({\n\t\t\t\tid: loaderMenuId,\n\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\titems: [{\n\t\t\t\t\thtml: '<div id=\"' + loaderMenuLoaderId + '\"></div>',\n\t\t\t\t}],\n\t\t\t\tangle: false,\n\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\theight: 60,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: function() {\n\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.showLoader(BX(loaderMenuLoaderId));\n\n\t\t\tif (!this._isRequestRunning)\n\t\t\t{\n\t\t\t\tthis._isRequestRunning = true;\n\t\t\t\tconst senderId = this._senderId;\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'messageservice.Sender.getTemplates',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: senderId,\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tmodule: 'crm',\n\t\t\t\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tconst sender = this._senders.find(function (sender) {\n\t\t\t\t\t\t\treturn (sender.id === senderId);\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\tif (sender)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsender.templates = response.data.templates;\n\t\t\t\t\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\t\t\t\t\t\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t\t.catch(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (response && response.errors && response.errors[0] && response.errors[0].message)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\talert(response.errors[0].message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tgetSelectedSender()\n\t{\n\t\treturn this._senders.find(function(sender) {\n\t\t\treturn (sender.id === this._senderId);\n\t\t}.bind(this));\n\t}\n\n\tgetSelectedTemplate()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (!this._templateId || !sender || !sender.templates)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst template = sender.templates.find(function (template) {\n\t\t\treturn template.ID == this._templateId;\n\t\t}.bind(this));\n\n\t\treturn template ? template : null;\n\t}\n\n\tonTemplateSelectClick()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tif (sender)\n\t\t{\n\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t}\n\t}\n\n\tonSelectTemplate(e, item)\n\t{\n\t\tthis._templateId = item.value;\n\t\tthis.applySelectedTemplate();\n\t\tthis.toggleSaveButton();\n\t\tconst menu = BX.PopupMenu.getMenuById(this._templateSelectorMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\ttoggleTemplateSelectAvailability()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (sender && BX.Type.isArray(sender.templates) && !sender.templates.length)\n\t\t{\n\t\t\tBX.addClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis._templateTemplateTitleNode.textContent = BX.message('CRM_TIMELINE_SMS_TEMPLATES_NOT_FOUND');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.removeClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis.applySelectedTemplate();\n\t\t}\n\t}\n\n\tapplySelectedTemplate()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (!this._templateId || !sender || !sender.templates)\n\t\t{\n\t\t\tthis.hideNode(this._templatePreviewNode);\n\t\t\tthis._templateTemplateTitleNode.textContent = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst template = this.getSelectedTemplate();\n\t\t\tif (template)\n\t\t\t{\n\t\t\t\tconst preview = BX.Text.encode(template.PREVIEW).replace(/\\n/g, '<br>');\n\n\t\t\t\tthis.showNode(this._templatePreviewNode);\n\t\t\t\tthis._templatePreviewNode.innerHTML = preview;\n\t\t\t\tthis._templateTemplateTitleNode.textContent = template.TITLE;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideNode(this._templatePreviewNode);\n\t\t\t\tthis._templateTemplateTitleNode.textContent = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new Sms();\n\t\tself.initialize(id, settings);\n\t\tSms.items[self.getId()] = self;\n\t\treturn self;\n\t}\n\n\tstatic items = {};\n}\n","import Item from '../item';\nexport default class Call extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.call,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Email extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst ownerInfo = BX.CrmTimelineManager.getDefault().getOwnerInfo();\n\n\t\tBX.CrmActivityEditor.getDefault().addEmail(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t'ownerUrl': ownerInfo['SHOW_URL'],\n\t\t\t'ownerTitle': ownerInfo['TITLE'],\n\t\t\t'subject': '',\n\t\t}\n\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Meeting extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.meeting,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Task extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addTask(\n\t\t\t{\n\t\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\t'ownerID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import { Tag, Event, Loc, Type, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuManager } from \"main.popup\";\nimport WithEditor from \"./witheditor\";\nimport { Guide } from \"ui.tour\";\nimport Context from \"../context\";\nimport { DialogNew } from 'calendar.sharing.interface';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Sharing extends WithEditor\n{\n\tHELPDESK_CODE = -1;\n\n\t/**\n\t * @override\n\t */\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tconst config = settings.config;\n\n\t\tthis.link = config.link;\n\n\t\tthis.setContacts(config.contacts);\n\n\t\tthis.isNotificationsAvailable = config.isNotificationsAvailable;\n\n\t\tthis.areCommunicationChannelsAvailable = config.areCommunicationChannelsAvailable;\n\t\tif (this.areCommunicationChannelsAvailable)\n\t\t{\n\t\t\tthis.setCommunicationChannels(config.communicationChannels, config.selectedChannelId);\n\t\t}\n\n\t\tthis.doPayAttentionToNewFeature = config.doPayAttentionToNewFeature;\n\n\t\tsuper.initialize(context, settings);\n\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tthis.bindEvents();\n\t\t}\n\t}\n\n\tactivate()\n\t{\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tthis.setVisible(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.UI?.InfoHelper?.show('limit_crm_calendar_free_slots');\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isAvailable');\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('CalendarSharing:LinkCopied', () => this.onLinkCopied());\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.onContactsChangedHandler.bind(this));\n\t}\n\n\t/**\n\t * @override\n\t */\n\tdoInitialize()\n\t{\n\t\tif (this.doPayAttentionToNewFeature)\n\t\t{\n\t\t\tthis.payAttentionToNewFeature();\n\t\t\tBX.ajax.runAction('crm.api.timeline.calendar.sharing.disableOptionPayAttentionToNewCrmSharingFeature');\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.DOM = {\n\t\t\tmenuBarItem: document.querySelector('.crm-entity-stream-section-menu [data-id=sharing]'),\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-sharing --hidden\">\n\t\t\t\t<div id=\"_sharing_content_container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-container\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-main\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info\">\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-header\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_TITLE')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-icon\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-text\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_1')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-icon\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-item-text\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_INFO_ITEM_2')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-btn-settings\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-icon-qr\"></div>\n\t\t\t\t\t\t\t\t\t${this.createConfigureSlotsButton()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${this.createSettingsButton()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-btn-container\">\n\t\t\t\t\t${this.createSendButton()}\n\t\t\t\t\t${this.createCancelButton()}\n\t\t\t\t\t${this.createMoreInfoButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateConfigureSlotsButton()\n\t{\n\t\tthis.DOM.configureSlotsButton = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-info-btn-settings-text\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_CONFIGURE_SLOTS')}\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(this.DOM.configureSlotsButton, 'click', () => this.onConfigureSlotsButtonClick());\n\n\t\treturn this.DOM.configureSlotsButton;\n\t}\n\n\tcreateSettingsButton()\n\t{\n\t\tthis.DOM.settingsButton = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-icon\"></div>\n\t\t`;\n\t\tthis.updateSettingsButton();\n\n\t\tEvent.bind(this.DOM.settingsButton, 'click', () => this.onSettingsButtonClick());\n\n\t\treturn this.DOM.settingsButton;\n\t}\n\n\tupdateSettingsButton()\n\t{\n\t\tif (this.isContactAvailable())\n\t\t{\n\t\t\tthis.DOM.settingsButton.style.display = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.DOM.settingsButton.style.display = 'none';\n\t\t}\n\t}\n\n\tcreateSendButton()\n\t{\n\t\tthis.DOM.sendButton = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-primary\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SEND_BUTTON')}\n\t\t\t</button>\n\t\t`;\n\t\tEvent.bind(this.DOM.sendButton, 'click', () => this.onSendButtonClick());\n\n\t\tthis._saveButton = this.DOM.sendButton;\n\n\t\treturn this.DOM.sendButton;\n\t}\n\n\tcreateCancelButton()\n\t{\n\t\tthis.DOM.cancelButton = Tag.render`\n\t\t\t<span class=\"ui-btn ui-btn-xs ui-btn-link\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_CANCEL_BUTTON')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(this.DOM.cancelButton, 'click', () => this.onCancelButtonClick());\n\n\t\tthis._cancelButton = this.DOM.cancelButton;\n\n\t\treturn this.DOM.cancelButton;\n\t}\n\n\tcreateMoreInfoButton()\n\t{\n\t\tthis.DOM.moreInfoButton = Tag.render`\n\t\t\t<span class=\"crm-entity-stream-calendar-sharing-more-btn\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_MORE_INFO_BUTTON')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(this.DOM.moreInfoButton, 'click', () => this.onMoreInfoButtonClick());\n\n\t\treturn this.DOM.moreInfoButton;\n\t}\n\n\tonConfigureSlotsButtonClick()\n\t{\n\t\tthis.showConfigureSlotsPopup();\n\t}\n\n\tonSettingsButtonClick()\n\t{\n\t\tthis.showSettingsPopup();\n\t}\n\n\tonSendButtonClick()\n\t{\n\t\tif (!this.isContactAvailable())\n\t\t{\n\t\t\tthis.showWarningNoContact();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.areCommunicationChannelsAvailable)\n\t\t{\n\t\t\tthis.showWarningNoCommunicationChannels();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onSaveButtonClick();\n\t}\n\n\tonLinkCopied()\n\t{\n\t\tthis.saveLinkAction({\n\t\t\tisActionCopy: true,\n\t\t});\n\t}\n\n\tonMoreInfoButtonClick()\n\t{\n\t\tthis.openHelpDesk();\n\t}\n\n\tshowConfigureSlotsPopup()\n\t{\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.DOM.configureSlotsButton,\n\t\t\t\tsharingUrl: this.link.url,\n\t\t\t\tcontext: \"crm\",\n\t\t\t});\n\t\t}\n\t\tthis.newDialog.show();\n\t}\n\n\tshowSettingsPopup()\n\t{\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tthis.settingsMenu.destroy();\n\t\t}\n\t\tthis.settingsMenu = this.getSettingsMenu();\n\t\tthis.settingsMenu.show();\n\t}\n\n\tisSettingsPopupShown()\n\t{\n\t\treturn this.settingsMenu?.popupWindow.isShown();\n\t}\n\n\tgetSettingsMenu()\n\t{\n\t\tconst items = [this.getSharingReceiverItem()];\n\n\t\tif (this.areCommunicationChannelsAvailable && this.isChannelsAvailable())\n\t\t{\n\t\t\titems.push(this.getSharingChannelsItem());\n\t\t}\n\n\t\tif (this.currentFromList)\n\t\t{\n\t\t\titems.push(this.getSharingSenderItem());\n\t\t}\n\n\t\treturn MenuManager.create({\n\t\t\tid: 'crm-calendar-sharing-settings',\n\t\t\tbindElement: this.DOM.settingsButton,\n\t\t\titems: items\n\t\t});\n\t}\n\n\tgetSharingReceiverItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_receiver',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_RECEIVER'),\n\t\t\titems: this.contacts.map((contact) => {\n\t\t\t\treturn this.getContactMenuItem(contact);\n\t\t\t})\n\t\t};\n\t}\n\n\tgetSharingChannelsItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_channels',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COMMUNICATION_CHANNELS'),\n\t\t\titems: this.channels.map((channel) => {\n\t\t\t\treturn this.getChannelMenuItem(channel);\n\t\t\t}),\n\t\t}\n\t}\n\n\tgetSharingSenderItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_sender',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SENDER'),\n\t\t\titems: this.currentFromList.map((from) => {\n\t\t\t\treturn this.getFromMenuItem(from);\n\t\t\t}),\n\t\t};\n\t}\n\n\tgetContactMenuItem(contact)\n\t{\n\t\tconst isSelected = contact.entityId === this.contact.entityId && contact.entityTypeId === this.contact.entityTypeId;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${contact.name} (${contact.phone})</div>\n\t\t\t</div>\n\t\t`;\n\t\tcontact.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(contact.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.contact.check, '--show');\n\t\t\t\tDom.addClass(contact.check, '--show');\n\t\t\t\tthis.contact = contact;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetChannelMenuItem(channel)\n\t{\n\t\tconst isSelected = channel.id === this.channel.id;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${channel.name}</div>\n\t\t\t</div>\n\t\t`;\n\t\tchannel.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(channel.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.channel.check, '--show');\n\t\t\t\tDom.addClass(channel.check, '--show');\n\t\t\t\tthis.channel = channel;\n\n\t\t\t\tthis.updateSenderList();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetFromMenuItem(from)\n\t{\n\t\tconst isSelected = from.id === this.currentFrom.id;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${from.name}</div>\n\t\t\t</div>\n\t\t`;\n\t\tfrom.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(from.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.currentFrom.check, '--show');\n\t\t\t\tDom.addClass(from.check, '--show');\n\t\t\t\tthis.currentFrom = from;\n\t\t\t},\n\t\t};\n\t}\n\n\tshowWarningNoCommunicationChannels()\n\t{\n\t\tlet title;\n\t\tlet text;\n\n\t\tif (this.isNotificationsAvailable)\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_1')}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE_1')}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst noCommunicationChannelsWarningGuide = this.getWarningGuide(title, text);\n\t\tnoCommunicationChannelsWarningGuide.showNextStep();\n\n\t\tconst guidePopup = noCommunicationChannelsWarningGuide.getPopup();\n\t\tconst guideContentContainer = guidePopup.getContentContainer();\n\t\tconst openConfigurationButton = guideContentContainer.querySelector('span[data-role=crm-timeline-calendar-sharing_open-configure-slots]');\n\t\topenConfigurationButton.addEventListener('click', () => {\n\t\t\tguidePopup.close();\n\t\t\tthis.showConfigureSlotsPopup();\n\t\t});\n\t}\n\n\tshowWarningNoContact()\n\t{\n\t\tconst title = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TITLE');\n\t\tconst text = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TEXT');\n\t\tconst noContactWarningGuide = this.getWarningGuide(title, text);\n\t\tnoContactWarningGuide.showNextStep();\n\t}\n\n\tupdateSenderList()\n\t{\n\t\tthis.currentFromList = this.channel.fromList;\n\t\tthis.currentFrom = this.channel.fromList[0];\n\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tthis.settingsMenu.removeMenuItem('sharing_sender');\n\t\t\tconst item = this.getSharingSenderItem();\n\t\t\tthis.settingsMenu.addMenuItem(item);\n\t\t}\n\t}\n\n\tcopyLink(link)\n\t{\n\t\tBX.clipboard.copy(link);\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COPY_LINK_NOTIFICATION'),\n\t\t});\n\t\tEventEmitter.emit('CalendarSharing:LinkCopied');\n\t}\n\n\t/**\n\t * @override\n\t */\n\tsave(): Promise\n\t{\n\t\treturn this.saveLinkAction();\n\t}\n\n\tsaveLinkAction(options = { isActionCopy: false })\n\t{\n\t\tlet action;\n\t\tlet data = {\n\t\t\townerId: this.getEntityId(),\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t};\n\n\t\tif (this.isContactAvailable() && this.isChannelsAvailable() && !options.isActionCopy)\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.sendLink';\n\t\t\tdata.contactId = this.contact.entityId || null;\n\t\t\tdata.contactTypeId = this.contact.entityTypeId || null;\n\t\t\tdata.channelId = this.channel.id || null;\n\t\t\tdata.senderId = this.currentFrom.id || null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.onLinkCopied';\n\t\t\tdata.linkHash = this.link.hash;\n\t\t}\n\n\t\treturn BX.ajax.runAction(action, { data }).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}, (error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonContactsChangedHandler(event)\n\t{\n\t\tconst { item, current } = event.getData();\n\n\t\tconst isCurrentDeal = this.getEntityTypeId() === item?.entityTypeId && this.getEntityId() === item?.entityId;\n\t\tif (!isCurrentDeal || !Type.isArray(current))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst phoneReceivers = current.filter(receiver => receiver.address.typeId === 'PHONE');\n\n\t\tconst contacts = [];\n\t\tconst contactsHashes = [];\n\t\tfor (const receiver of phoneReceivers)\n\t\t{\n\t\t\tif (contactsHashes.includes(receiver.addressSource.hash))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tcontactsHashes.push(receiver.addressSource.hash);\n\n\t\t\tcontacts.push({\n\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\tname: receiver.addressSourceData?.title,\n\t\t\t\tphone: receiver.address.value,\n\t\t\t});\n\t\t}\n\n\t\tthis.setContacts(contacts);\n\n\t\tthis.updateSettingsButton();\n\t\tif (this.isSettingsPopupShown())\n\t\t{\n\t\t\tthis.showSettingsPopup();\n\t\t}\n\t}\n\n\tsetContacts(contacts)\n\t{\n\t\tthis.contacts = contacts.filter(contact => contact.entityId && contact.entityTypeId && contact.phone && contact.name)\n\t\t\t.sort((a, b) => a.entityId - b.entityId) // sort by id\n\t\t\t.sort((a, b) => a.entityTypeId - b.entityTypeId); // sort company last\n\n\t\tthis.contact = contacts.find((contact) => {\n\t\t\treturn contact.entityTypeId === this.contact?.entityTypeId && contact.entityId === this.contact?.entityId;\n\t\t}) ?? this.contacts[0];\n\t}\n\n\tsetCommunicationChannels(channels, selectedId)\n\t{\n\t\tthis.channels = channels || [];\n\n\t\tif (selectedId)\n\t\t{\n\t\t\tthis.channel = channels.find((channel) => {\n\t\t\t\treturn channel.id === selectedId\n\t\t\t}) ?? this.channels[0];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.channel = this.channels ? this.channels[0] : null;\n\t\t}\n\n\t\tif (this.channel && this.channel.fromList)\n\t\t{\n\t\t\tthis.currentFromList = this.channel.fromList;\n\t\t\tthis.currentFrom = this.channel.fromList[0];\n\t\t}\n\t}\n\n\tisContactAvailable()\n\t{\n\t\treturn Type.isArrayFilled(this.contacts);\n\t}\n\n\tisChannelsAvailable()\n\t{\n\t\treturn Type.isArrayFilled(this.channels);\n\t}\n\n\topenHelpDesk()\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${this.HELPDESK_CODE}`);\n\t\t}\n\t}\n\n\tgetWarningGuide(title, text)\n\t{\n\t\tconst warningGuide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.DOM.sendButton,\n\t\t\t\t\ttitle,\n\t\t\t\t\ttext,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'warning',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = warningGuide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'crm-calendar-sharing-configure-slots-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(390);\n\t\tconst guideContent = guidePopup.getContentContainer().firstElementChild;\n\t\tconst offsetFromCloseIcon = parseInt(getComputedStyle(guidePopup.closeIcon)['width']);\n\t\tconst existingPadding = parseInt(getComputedStyle(guideContent)['paddingRight']);\n\t\tguidePopup.getContentContainer().style.paddingRight = (offsetFromCloseIcon - existingPadding) + 'px';\n\t\tguidePopup.setAutoHide(true);\n\n\t\tguidePopup.subscribe('onAfterShow', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst arrowContainer = guidePopup.angle.element;\n\t\t\t\tconst arrow = arrowContainer.firstElementChild;\n\t\t\t\tarrow.style.border = '2px solid var(--ui-color-text-warning, #ffa900)';\n\n\t\t\t\tif (guidePopup.getContentContainer().getBoundingClientRect().top > this.DOM.sendButton.getBoundingClientRect().top)\n\t\t\t\t{\n\t\t\t\t\tconst condition = guidePopup.getContentContainer().querySelector('.ui-tour-popup-condition-bottom');\n\t\t\t\t\tcondition.className = 'ui-tour-popup-condition-top';\n\t\t\t\t\tarrowContainer.style.top = '-20px';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tarrowContainer.style.bottom = '-18px';\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t});\n\n\t\treturn warningGuide;\n\t}\n\n\tpayAttentionToNewFeature()\n\t{\n\t\tconst guide = this.getGuide();\n\t\tconst pulsar = this.getPulsar();\n\n\t\tsetTimeout(() => {\n\t\t\tguide.showNextStep();\n\t\t\tpulsar.show();\n\t\t}, 1000);\n\t}\n\n\tgetGuide()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.DOM.menuBarItem,\n\t\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_PAY_ATTENTION_TO_NEW_FEATURE_TEXT'),\n\t\t\t\t\tarticle: this.HELPDESK_CODE,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = guide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'crm-calendar-sharing-configure-slots-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(400);\n\t\tguidePopup.getContentContainer().style.paddingRight = getComputedStyle(guidePopup.closeIcon)['width'];\n\n\t\treturn guide;\n\t}\n\n\tgetPulsar()\n\t{\n\t\tconst pulsar = new BX.SpotLight({\n\t\t\ttargetElement: this.DOM.menuBarItem,\n\t\t\ttargetVertex: 'middle-center',\n\t\t});\n\t\tpulsar.bindEvents({\n\t\t\t'onTargetEnter': () => pulsar.close(),\n\t\t});\n\n\t\treturn pulsar;\n\t}\n}\n","import Wait from \"../wait\";\nimport {Loc} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.Tools */\nexport default class WaitConfigurationDialog\n{\n\tconstructor()\n\t{\n\t\tthis._id = \"\";\n\t\tthis._settings = {};\n\t\tthis._type = Wait.WaitingType.undefined;\n\t\tthis._duration = 0;\n\t\tthis._target = \"\";\n\t\tthis._targetDates = null;\n\t\tthis._container = null;\n\t\tthis._durationMeasureNode = null;\n\t\tthis._durationInput = null;\n\t\tthis._targetDateNode = null;\n\t\tthis._popup = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings ? settings : {};\n\t\tthis._type = BX.prop.getInteger(this._settings, \"type\", Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(this._settings, \"duration\", 1);\n\t\tthis._target = BX.prop.getString(this._settings, \"target\", \"\");\n\t\tthis._targetDates = BX.prop.getArray(this._settings, \"targetDates\", []);\n\n\t\tthis._menuId = this._id + \"_target_date_sel\";\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType()\n\t{\n\t\treturn this._type;\n\t}\n\n\tsetType(type)\n\t{\n\t\tthis._type = type;\n\t}\n\n\tgetDuration()\n\t{\n\t\treturn this._duration;\n\t}\n\n\tsetDuration(duration)\n\t{\n\t\tthis._duration = duration;\n\t}\n\n\tgetTarget()\n\t{\n\t\treturn this._target;\n\t}\n\n\tsetTarget(target)\n\t{\n\t\tthis._target = target;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst m = WaitConfigurationDialog.messages;\n\t\treturn m.hasOwnProperty(name) ? m[name] : name;\n\t}\n\n\tgetDurationText(duration, enableNumber)\n\t{\n\t\treturn Wait.Helper.getDurationText(duration, enableNumber);\n\t}\n\n\tgetTargetDateCaption(name)\n\t{\n\t\tconst length = this._targetDates.length;\n\t\tfor(let i = 0; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\t\t\tif(info[\"name\"] === name)\n\t\t\t{\n\t\t\t\treturn info[\"caption\"];\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\topen()\n\t{\n\t\tthis._popup = new BX.PopupWindow(\n\t\t\tthis._id,\n\t\t\tnull, //this._configSelector,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\tbindOptions: { forceBindPosition: false },\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tcontent: this.prepareDialogContent(),\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: BX.delegate(this.onPopupShow, this),\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onPopupClose, this),\n\t\t\t\t\t\tonPopupDestroy: BX.delegate(this.onPopupDestroy, this)\n\t\t\t\t\t},\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CHOOSE'),\n\t\t\t\t\t\t\t\tclassName: \"popup-window-button-accept\" ,\n\t\t\t\t\t\t\t\tevents: { click: BX.delegate(this.onSaveButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew BX.PopupWindowButtonLink(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext : BX.message(\"JS_CORE_WINDOW_CANCEL\"),\n\t\t\t\t\t\t\t\tevents: { click: BX.delegate(this.onCancelButtonClick, this) }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t]\n\t\t\t}\n\t\t);\n\t\tthis._popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup.close();\n\t\t}\n\t}\n\n\tprepareDialogContent()\n\t{\n\t\tconst container = BX.create(\"div\", {attrs: {className: \"crm-wait-popup-select-block\"}});\n\t\tconst wrapper = BX.create(\"div\", {attrs: {className: \"crm-wait-popup-select-wrapper\"}});\n\t\tcontainer.appendChild(wrapper);\n\n\t\tthis._durationInput = BX.create(\n\t\t\t\"input\",\n\t\t\t{\n\t\t\t\tattrs: { type: \"text\", className: \"crm-wait-popup-settings-input\", value: this._duration },\n\t\t\t\tevents: { keyup: BX.delegate(this.onDurationChange, this) }\n\t\t\t}\n\t\t);\n\n\t\tthis._durationMeasureNode = BX.create(\n\t\t\t\"span\",\n\t\t\t{ attrs: { className: \"crm-wait-popup-settings-title\" }, text: this.getDurationText(this._duration, false) }\n\t\t);\n\n\t\tif(this._type === Wait.WaitingType.after)\n\t\t{\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: Loc.getMessage('CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_AFTER') })\n\t\t\t);\n\t\t\twrapper.appendChild(this._durationInput);\n\t\t\twrapper.appendChild(this._durationMeasureNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: Loc.getMessage('CRM_TIMELINE_WAIT_CONFIG_PREFIX_TYPE_BEFORE') })\n\t\t\t);\n\t\t\twrapper.appendChild(this._durationInput);\n\t\t\twrapper.appendChild(this._durationMeasureNode);\n\t\t\twrapper.appendChild(\n\t\t\t\tBX.create(\"span\", { attrs: { className: \"crm-wait-popup-settings-title\" }, text: \" \" + Loc.getMessage('CRM_TIMELINE_WAIT_TARGET_PREFIX_TYPE_BEFORE') })\n\t\t\t);\n\n\t\t\tthis._targetDateNode = BX.create(\n\t\t\t\t\"span\",\n\t\t\t\t{\n\t\t\t\t\tattrs: { className: \"crm-automation-popup-settings-link\" },\n\t\t\t\t\ttext: this.getTargetDateCaption(this._target),\n\t\t\t\t\tevents: { click: BX.delegate(this.toggleTargetMenu, this) }\n\t\t\t\t}\n\t\t\t);\n\t\t\twrapper.appendChild(this._targetDateNode);\n\t\t}\n\t\treturn container;\n\t}\n\n\tonDurationChange()\n\t{\n\t\tlet duration = parseInt(this._durationInput.value);\n\t\tif(isNaN(duration) || duration <= 0)\n\t\t{\n\t\t\tduration = 1;\n\t\t}\n\t\tthis._duration = duration;\n\t\tthis._durationMeasureNode.innerHTML = BX.util.htmlspecialchars(this.getDurationText(duration, false));\n\n\t}\n\n\ttoggleTargetMenu()\n\t{\n\t\tif(this.isTargetMenuOpened())\n\t\t{\n\t\t\tthis.closeTargetMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTargetMenu();\n\t\t}\n\t}\n\n\tisTargetMenuOpened()\n\t{\n\t\treturn !!BX.PopupMenu.getMenuById(this._menuId);\n\t}\n\n\topenTargetMenu()\n\t{\n\t\tconst menuItems = [];\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor(; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: info[\"caption\"],\n\t\t\t\t\ttitle: info[\"caption\"],\n\t\t\t\t\tvalue: info[\"name\"],\n\t\t\t\t\tonclick: BX.delegate(this.onTargetSelect, this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._menuId,\n\t\t\tthis._targetDateNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tzIndex: 200,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: BX.pos(this._targetDateNode)[\"width\"] / 2,\n\t\t\t\tangle: { position: 'top', offset: 0 }\n\t\t\t}\n\t\t);\n\t}\n\n\tcloseTargetMenu()\n\t{\n\t\tBX.PopupMenu.destroy(this._menuId);\n\t}\n\n\tonPopupShow(e, item)\n\t{\n\t}\n\n\tonPopupClose()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup.destroy();\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t}\n\n\tonPopupDestroy()\n\t{\n\t\tif(this._popup)\n\t\t{\n\t\t\tthis._popup = null;\n\t\t}\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tconst callback = BX.prop.getFunction(this._settings, \"onSave\", null);\n\t\tif(!callback)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {type: this._type};\n\t\tparams[\"duration\"] = this._duration;\n\t\tparams[\"target\"] = this._type === Wait.WaitingType.before ? this._target : \"\";\n\t\tcallback(this, params);\n\t}\n\n\tonCancelButtonClick(e)\n\t{\n\t\tconst callback = BX.prop.getFunction(this._settings, \"onCancel\", null);\n\t\tif(callback)\n\t\t{\n\t\t\tcallback(this);\n\t\t}\n\t}\n\n\tonTargetSelect(e, item)\n\t{\n\t\tconst fieldName = BX.prop.getString(item, \"value\", \"\");\n\t\tif(fieldName !== \"\")\n\t\t{\n\t\t\tthis._target = fieldName;\n\t\t\tthis._targetDateNode.innerHTML = BX.util.htmlspecialchars(this.getTargetDateCaption(fieldName));\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new WaitConfigurationDialog();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tstatic messages = {};\n}\n","import WithEditor from \"./witheditor\";\nimport WaitConfigurationDialog from \"./tools/wait-configuration-dialog\";\nimport {Loc, Tag} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Wait extends WithEditor\n{\n\t#waitConfigContainer: HTMLElement = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#waitConfigContainer = Tag.render`<div class=\"crm-entity-stream-content-wait-conditions\"></div>`;\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\" >${Loc.getMessage('CRM_TIMELINE_CREATE_WAITING')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea rows=\"1\" class=\"crm-entity-stream-content-wait-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_WAIT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-wait-detail --focus --hidden\">\n\t\t\t<div class=\"crm-entity-stream-content-wait-conditions-container\">\n\t\t\t\t${this.#waitConfigContainer}\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t<div class=\"crm-entity-stream-content-wait-comment-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tdoInitialize(): void\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._hideButtonsOnBlur = false;\n\t\t//region Config\n\t\tthis._type = Wait.WaitingType.after;\n\t\tthis._duration = 1;\n\t\tthis._target = \"\";\n\t\tthis._configSelector = null;\n\t\t//endregion\n\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\t\tthis._configDialog = null;\n\n\t\tthis._serviceUrl = this.getSetting('serviceUrl', '');\n\n\t\tconst config = this.getSetting('config', {});\n\t\tthis._type = Wait.WaitingType.resolveTypeId(\n\t\t\tBX.prop.getString(\n\t\t\t\tconfig,\n\t\t\t\t'type',\n\t\t\t\tWait.WaitingType.names.after\n\t\t\t)\n\t\t);\n\t\tthis._duration = BX.prop.getInteger(config, 'duration', 1);\n\t\tthis._target = BX.prop.getString(config, 'target', '');\n\t\tthis._targetDates =this.getSetting('targetDates', []);\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetDurationText(duration, enableNumber)\n\t{\n\t\treturn Wait.Helper.getDurationText(duration, enableNumber);\n\t}\n\n\tgetTargetDateCaption(name)\n\t{\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor(; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\t\t\tif(info[\"name\"] === name)\n\t\t\t{\n\t\t\t\treturn info[\"caption\"];\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\tonSelectorClick(e)\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\tthis.openMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeMenu();\n\t\t}\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\topenMenu()\n\t{\n\t\tif(this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = BX.delegate(this.onMenuItemClick, this);\n\n\t\tconst menuItems =\n\t\t\t[\n\t\t\t\t{id: \"day_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1D'), onclick: handler},\n\t\t\t\t{id: \"day_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2D'), onclick: handler},\n\t\t\t\t{id: \"day_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3D'), onclick: handler},\n\t\t\t\t{id: \"week_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1W'), onclick: handler},\n\t\t\t\t{id: \"week_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2W'), onclick: handler},\n\t\t\t\t{id: \"week_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3W'), onclick: handler}\n\t\t\t];\n\n\t\tconst customMenu = {id: \"custom\", text: Loc.getMessage('CRM_TIMELINE_WAIT_CUSTOM'), items: []};\n\t\tcustomMenu[\"items\"].push({ id: \"afterDays\", text: Loc.getMessage('CRM_TIMELINE_WAIT_AFTER_CUSTOM_DAYS'), onclick: handler });\n\t\tif(this._targetDates.length > 0)\n\t\t{\n\t\t\tcustomMenu[\"items\"].push({ id: \"beforeDate\", text: Loc.getMessage('CRM_TIMELINE_WAIT_BEFORE_CUSTOM_DATE'), onclick: handler });\n\t\t}\n\t\tmenuItems.push(customMenu);\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id,\n\t\t\tthis._configSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: BX.delegate(this.onMenuShow, this),\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this),\n\t\t\t\t\t\tonPopupDestroy: BX.delegate(this.onMenuDestroy, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t}\n\n\tcloseMenu()\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t}\n\t}\n\n\tonMenuItemClick(e, item)\n\t{\n\t\tthis.closeMenu();\n\n\t\tif(item.id === \"afterDays\" || item.id === \"beforeDate\")\n\t\t{\n\t\t\tthis.openConfigDialog(\n\t\t\t\titem.id === \"afterDays\" ? Wait.WaitingType.after : Wait.WaitingType.before\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {type: Wait.WaitingType.after};\n\t\tif(item.id === \"day_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 1;\n\t\t}\n\t\telse if(item.id === \"day_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 2;\n\t\t}\n\t\telse if(item.id === \"day_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 3;\n\t\t}\n\t\tif(item.id === \"week_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 7;\n\t\t}\n\t\telse if(item.id === \"week_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 14;\n\t\t}\n\t\telse if(item.id === \"week_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 21;\n\t\t}\n\t\tthis.saveConfiguration(params);\n\t}\n\n\topenConfigDialog(type)\n\t{\n\t\tif(!this._configDialog)\n\t\t{\n\t\t\tthis._configDialog = WaitConfigurationDialog.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\ttargetDates: this._targetDates,\n\t\t\t\t\tonSave: BX.delegate(this.onConfigDialogSave, this),\n\t\t\t\t\tonCancel: BX.delegate(this.onConfigDialogCancel, this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis._configDialog.setType(type);\n\t\tthis._configDialog.setDuration(this._duration);\n\n\t\tlet target = this._target;\n\t\tif(target === \"\" && this._targetDates.length > 0)\n\t\t{\n\t\t\ttarget = this._targetDates[0][\"name\"];\n\t\t}\n\t\tthis._configDialog.setTarget(target);\n\t\tthis._configDialog.open();\n\t}\n\n\tonConfigDialogSave(sender, params)\n\t{\n\t\tthis.saveConfiguration(params);\n\t\tthis._configDialog.close();\n\t}\n\n\tonConfigDialogCancel(sender)\n\t{\n\t\tthis._configDialog.close();\n\t}\n\n\tonMenuShow()\n\t{\n\t\tthis._isMenuShown = true;\n\t}\n\n\tonMenuClose()\n\t{\n\t\tif(this._menu && this._menu.popupWindow)\n\t\t{\n\t\t\tthis._menu.popupWindow.destroy();\n\t\t}\n\t}\n\n\tonMenuDestroy()\n\t{\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\n\t\tif(typeof(BX.PopupMenu.Data[this._id]) !== \"undefined\")\n\t\t{\n\t\t\tdelete(BX.PopupMenu.Data[this._id]);\n\t\t}\n\t}\n\n\tsaveConfiguration(params)\n\t{\n\t\t//region Parse params\n\t\tthis._type = BX.prop.getInteger(params, \"type\", Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(params, \"duration\", 0);\n\t\tif(this._duration <= 0)\n\t\t{\n\t\t\tthis._duration = 1;\n\t\t}\n\t\tthis._target = this._type === Wait.WaitingType.before\n\t\t\t? BX.prop.getString(params, \"target\", \"\") : \"\";\n\t\t//endregion\n\t\t//region Save settings\n\t\tconst optionName = this.getSetting('optionName');\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"type\",\n\t\t\tthis._type === Wait.WaitingType.after ? \"after\" : \"before\"\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"duration\",\n\t\t\tthis._duration\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"target\",\n\t\t\tthis._target\n\t\t);\n\t\t//endregion\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetSummaryHtml()\n\t{\n\t\tif(this._type === Wait.WaitingType.before)\n\t\t{\n\t\t\treturn (\n\t\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_BEFORE')\n\t\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t\t\t\t.replace(\"#TARGET_DATE#\", this.getTargetDateCaption(this._target))\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_AFTER')\n\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t);\n\t}\n\n\tgetSummaryText()\n\t{\n\t\treturn BX.util.strip_tags(this.getSummaryHtml());\n\t}\n\n\tlayoutConfigurationSummary()\n\t{\n\t\tthis.#waitConfigContainer.innerHTML = this.getSummaryHtml();\n\t\tthis._configSelector = this.#waitConfigContainer.querySelector(\"a\");\n\t\tif(this._configSelector)\n\t\t{\n\t\t\tBX.bind(this._configSelector, 'click', this.onSelectorClick.bind(this));\n\t\t}\n\t}\n\n\tpostpone(id, offset, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"POSTPONE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"OFFSET\": offset }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tcomplete(id, completed, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"COMPLETE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"COMPLETED\": completed ? 'Y' : 'N' }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tsave()\n\t{\n\t\tif(this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet description = this.getSummaryText();\n\t\tconst comment = BX.util.trim(this._input.value);\n\t\tif(comment !== \"\")\n\t\t{\n\t\t\tdescription += \"\\n\" + comment;\n\t\t}\n\n\t\tconst data =\n\t\t\t{\n\t\t\t\tID: 0,\n\t\t\t\ttypeId: this._type,\n\t\t\t\tduration: this._duration,\n\t\t\t\ttargetFieldName: this._target,\n\t\t\t\tsubject: \"\",\n\t\t\t\tdescription: description,\n\t\t\t\tcompleted: 0,\n\t\t\t\townerType: BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\townerID: this.getEntityId()\n\t\t\t};\n\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"SAVE_WAIT\",\n\t\t\t\t\t\t\"DATA\": data\n\t\t\t\t\t},\n\t\t\t\tonsuccess: BX.delegate(this.onSaveSuccess, this),\n\t\t\t\tonfailure: BX.delegate(this.onSaveFailure, this)\n\t\t\t}\n\t\t);\n\t\tthis._isRequestRunning = this._isLocked = true;\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst m = Wait.messages;\n\t\treturn m.hasOwnProperty(name) ? m[name] : name;\n\t}\n\n\tstatic WaitingType = {\n\t\tundefined: 0,\n\t\tafter: 1,\n\t\tbefore: 2,\n\n\t\tnames:\n\t\t\t{\n\t\t\t\tafter: \"after\",\n\t\t\t\tbefore: \"before\"\n\t\t\t},\n\t\tresolveTypeId: function(name)\n\t\t{\n\t\t\tif(name === this.names.after)\n\t\t\t{\n\t\t\t\treturn this.after;\n\t\t\t}\n\t\t\telse if(name === this.names.before)\n\t\t\t{\n\t\t\t\treturn this.before;\n\t\t\t}\n\n\t\t\treturn this.undefined;\n\t\t}\n\t};\n\n\tstatic messages = {};\n\n\tstatic Helper =\n\t{\n\t\tgetDurationText: function(duration, enableNumber)\n\t\t{\n\t\t\tenableNumber = !!enableNumber;\n\n\t\t\tlet result = \"\";\n\t\t\tlet type = \"D\";\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tif((duration % 7) === 0)\n\t\t\t\t{\n\t\t\t\t\tduration = duration / 7;\n\t\t\t\t\ttype = \"W\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === \"W\")\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_WEEK', duration);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_DAY', duration);\n\t\t\t}\n\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tresult = duration.toString() + \" \" + result;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tgetMessage: function(name)\n\t\t{\n\t\t\treturn Wait.Helper.messages.hasOwnProperty(name) ? Wait.Helper.messages[name] : name;\n\t\t},\n\t\tmessages: {},\n\t}\n}\n","import Item from '../item';\nimport {Loc, Tag} from \"main.core'\";\nimport {Zoom as ZoomEditor} from 'crm.zoom';\n\nexport default class Zoom extends Item\n{\n\t#editor: ZoomEditor = null;\n\n\tshowSlider(): void\n\t{\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotConnectedHandler(Loc.getMessage('USER_ID'));\n\t\t}\n\t\telse // not available\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotAvailableHandler();\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isConnected') && this.getSetting('isAvailable');\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail ui-timeline-zoom-editor --focus --hidden\"></div>`;\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t\tthis.#createEditor();\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\t#createEditor(): void\n\t{\n\t\tthis.#editor = new ZoomEditor({\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcontainer: this.getContainer(),\n\t\t\tonFinishEdit: this.#onFinishEdit.bind(this),\n\t\t});\n\t}\n\n\t#onFinishEdit(): void\n\t{\n\t\tthis.emitFinishEditEvent();\n\t}\n}\n","import Item from '../item';\n\nexport default class Delivery extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addDelivery(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t\"orderList\": BX.CrmTimelineManager.getDefault().getOwnerInfo()['ORDER_LIST']\n\t\t}\n\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Visit extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst visitParameters = this.getSettings() ?? {};\n\t\tvisitParameters['OWNER_TYPE'] = BX.CrmEntityType.resolveName(this.getEntityTypeId());\n\t\tvisitParameters['OWNER_ID'] = this.getEntityId();\n\n\t\tBX.CrmActivityVisit.create(visitParameters).showEdit();\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\nexport default class RestPlacement extends Item\n{\n\t#interfaceInitialized: Boolean = false;\n\n\tshowSlider(): void\n\t{\n\t\tif (!this.#interfaceInitialized)\n\t\t{\n\t\t\tthis.#interfaceInitialized = true;\n\t\t\tthis.#initializeInterface();\n\t\t}\n\n\t\tconst appId = this.getSetting('appId', '');\n\n\t\tBX.rest.AppLayout.openApplication(\n\t\t\tappId,\n\t\t\t{\n\t\t\t\tID: this.getEntityId()\n\t\t\t},\n\t\t\t{\n\t\t\t\tPLACEMENT: this.getSetting('placement', ''),\n\t\t\t\tPLACEMENT_ID: this.getSetting('placementId', ''),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#initializeInterface()\n\t{\n\t\tif (!!top.BX.rest && !!top.BX.rest.AppLayout)\n\t\t{\n\t\t\tconst PlacementInterface = top.BX.rest.AppLayout.initializePlacement(this.getSetting('placement', ''));\n\n\t\t\tif (!PlacementInterface.prototype.reloadData)\n\t\t\t{\n\t\t\t\tconst entityTypeId = this.getEntityTypeId();\n\t\t\t\tconst entityId = this.getEntityId();\n\n\t\t\t\tPlacementInterface.prototype.reloadData = function(params, cb)\n\t\t\t\t{\n\t\t\t\t\tBX.Crm.EntityEvent.fireUpdate(entityTypeId, entityId, '');\n\t\t\t\t\tcb();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}\n","import Item from '../item';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Market extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.rest.Marketplace.open({\n\t\t\tPLACEMENT: this.getSetting('placement', '')\n\t\t});\n\n\t\ttop.BX.addCustomEvent(top, 'Rest:AppLayout:ApplicationInstall', this.#fireUpdateEvent.bind(this));\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#fireUpdateEvent()\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\t\tconst entityId = this.getEntityId();\n\n\t\tsetTimeout(function(){\n\t\t\tconsole.log('fireUpdate', entityId, entityTypeId);\n\t\t\tBX.Crm.EntityEvent.fire(BX.Crm.EntityEvent.names.invalidate, entityTypeId, entityId, '');\n\t\t}, 3000);\n\t}\n}\n","import Item from './item';\nimport ToDo from './items/todo';\nimport Comment from './items/comment';\nimport Sms from './items/sms';\nimport Call from './items/call';\nimport Email from './items/email';\nimport Meeting from './items/meeting';\nimport Task from './items/task';\nimport Sharing from './items/sharing';\nimport Wait from './items/wait';\nimport Zoom from './items/zoom';\nimport Delivery from './items/delivery';\nimport Visit from './items/visit';\nimport RestPlacement from './items/restplacement';\nimport Market from './items/market';\nimport Context from './context';\n\nexport default class Factory\n{\n\tstatic createItem(id: String, context: Context, settings: ?Object): Item\n\t{\n\t\tlet item = null;\n\t\tswitch (id)\n\t\t{\n\t\t\tcase 'todo':\n\t\t\t\titem = new ToDo();\n\t\t\t\tbreak;\n\t\t\tcase 'comment':\n\t\t\t\titem = new Comment();\n\t\t\t\tbreak;\n\t\t\tcase 'sms':\n\t\t\t\titem = new Sms();\n\t\t\t\tbreak;\n\t\t\tcase 'call':\n\t\t\t\titem = new Call();\n\t\t\t\tbreak;\n\t\t\tcase 'email':\n\t\t\t\titem = new Email();\n\t\t\t\tbreak;\n\t\t\tcase 'meeting':\n\t\t\t\titem = new Meeting();\n\t\t\t\tbreak;\n\t\t\tcase 'task':\n\t\t\t\titem = new Task();\n\t\t\t\tbreak;\n\t\t\tcase 'sharing':\n\t\t\t\titem = new Sharing();\n\t\t\t\tbreak;\n\t\t\tcase 'wait':\n\t\t\t\titem = new Wait();\n\t\t\t\tbreak;\n\t\t\tcase 'zoom':\n\t\t\t\titem = new Zoom();\n\t\t\t\tbreak;\n\t\t\tcase 'delivery':\n\t\t\t\titem = new Delivery();\n\t\t\t\tbreak;\n\t\t\tcase 'visit':\n\t\t\t\titem = new Visit();\n\t\t\t\tbreak;\n\t\t\tcase 'activity_rest_applist':\n\t\t\t\titem = new Market();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (!item && id.match(/^activity_rest_/))\n\t\t{\n\t\t\titem = new RestPlacement();\n\t\t}\n\n\t\tif (item)\n\t\t{\n\t\t\titem.initialize(context, settings);\n\t\t}\n\n\t\treturn item;\n\t}\n}\n","/** @memberof BX.Crm.Timeline.MenuBar */\n\nimport Factory from \"./factory\";\nimport Item from \"./item\";\nimport {Dom} from \"main.core\";\nimport Context from \"./context\";\n\ndeclare type MenuBarParams = {\n\tcontainerId: String,\n\tentityTypeId: Number,\n\tentityId: Number,\n\tisReadonly: Boolean,\n\tmenuId: String,\n\titems: MenuBarItemParams[],\n}\n\ndeclare type MenuBarItemParams = {\n\tid: String,\n\tsettings: ?Object,\n}\n\nexport class MenuBar\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#isReadonly: Boolean = false;\n\t#container: HTMLElement = null;\n\t#items = {};\n\t#selectedItemId: String = null;\n\t#menu: BX.Main.interfaceButtons = null;\n\n\tconstructor(id: String, params: MenuBarParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#isReadonly = params.isReadonly;\n\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tconst menuId = params.menuId ?? (BX.CrmEntityType.resolveName(this.#entityTypeId) + '_menu').toLowerCase();\n\t\tthis.#menu = BX.Main.interfaceButtonsManager.getById(menuId);\n\n\t\tconst context = new Context({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tentityId: this.#entityId,\n\t\t\tisReadonly: this.#isReadonly,\n\t\t\tmenuBarContainer: this.#container,\n\t\t});\n\n\t\t(params.items).forEach((itemData) => {\n\t\t\tconst id = itemData.id;\n\t\t\tconst item = Factory.createItem(id, context, itemData.settings ?? null);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.addFinishEditListener(this.#onItemFinishEdit.bind(this));\n\t\t\t\tthis.#items[id] = item;\n\t\t\t}\n\t\t});\n\n\t\tthis.setActiveItemById(this.#getFirstItemIdWithLayout());\n\t}\n\n\tgetItemById(id: String): ?Item\n\t{\n\t\treturn this.#items[id] ?? null;\n\t}\n\n\tonMenuItemClick(selectedItemId: String): void\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setActiveItemById(selectedItemId);\n\t}\n\n\tsetActiveItemById(selectedItemId: String): Boolean\n\t{\n\t\tif (!selectedItemId || this.#selectedItemId === selectedItemId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst menuBarItem = this.#items[selectedItemId];\n\t\tif (!menuBarItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tmenuBarItem.activate();\n\n\t\tif (!this.#isReadonly && menuBarItem.supportsLayout())\n\t\t{\n\t\t\tObject.keys(this.#items).forEach(itemId => {\n\t\t\t\tif (itemId !== selectedItemId)\n\t\t\t\t{\n\t\t\t\t\tthis.#items[itemId].deactivate();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.#selectMenuItem(selectedItemId);\n\t\t\tthis.#selectedItemId = selectedItemId;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#onItemFinishEdit(): void\n\t{\n\t\tthis.setActiveItemById(this.#getFirstItemIdWithLayout());\n\t}\n\n\t#getFirstItemIdWithLayout(): ?Item\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet firstId = null;\n\t\tthis.#menu.getAllItems().forEach(function (itemElement) {\n\t\t\tif (firstId === null)\n\t\t\t{\n\t\t\t\tconst id = itemElement.dataset.id;\n\t\t\t\tconst item = this.#items[id];\n\t\t\t\tif (item && item.supportsLayout())\n\t\t\t\t{\n\t\t\t\t\tfirstId = id;\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn firstId;\n\t}\n\n\tstatic create(id: String, params: MenuBarParams): MenuBar\n\t{\n\t\tconst self = new MenuBar(id, params);\n\t\tMenuBar.instances[id] = self;\n\n\t\treturn self;\n\t}\n\n\tstatic getDefault(): ?MenuBar\n\t{\n\t\treturn MenuBar.#defaultInstance;\n\t}\n\tstatic setDefault(instance: MenuBar): void\n\t{\n\t\tMenuBar.#defaultInstance = instance;\n\t}\n\n\tstatic getById(id): ?MenuBar\n\t{\n\t\treturn MenuBar.instances[id] || null;\n\t}\n\n\tstatic #defaultInstance = null;\n\tstatic instances = {};\n\n\t#selectMenuItem(id: String): void\n\t{\n\t\tconst activeItem = this.#menu.getItemById(this.#selectedItemId);\n\t\tconst currentDiv = this.#menu.getItemById(id);\n\t\tlet wasActiveInMoreMenu = false;\n\t\tif (currentDiv && activeItem !== currentDiv)\n\t\t{\n\t\t\twasActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tDom.addClass(currentDiv, this.#menu.classes.itemActive);\n\n\t\t\tif (this.#menu.getItemData)\n\t\t\t{\n\t\t\t\tconst currentDivData = this.#menu.getItemData(currentDiv);\n\t\t\t\tcurrentDivData['IS_ACTIVE'] = true;\n\t\t\t\tif (BX.type.isDomNode(activeItem))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(activeItem, this.#menu.classes.itemActive);\n\t\t\t\t\tconst activeItemData = this.#menu.getItemData(activeItem);\n\t\t\t\t\tactiveItemData['IS_ACTIVE'] = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tif (isActiveInMoreMenu || wasActiveInMoreMenu)\n\t\t\t{\n\t\t\t\tconst submenu = this.#menu.getSubmenu();\n\t\t\t\tif (submenu)\n\t\t\t\t{\n\t\t\t\t\tsubmenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tconst container = menuItem.getContainer();\n\t\t\t\t\t\tif (isActiveInMoreMenu && container.title === currentDiv.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.addClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (wasActiveInMoreMenu && container.title === activeItem.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.removeClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (isActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t\telse if (wasActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#menu.closeSubmenu();\n\t}\n}\n"],"names":["Context","constructor","params","entityTypeId","entityId","isReadonly","menuBarContainer","getEntityTypeId","getEntityId","getMenuBarContainer","Item","initialize","context","settings","EventEmitter","setEventNamespace","supportsLayout","createLayout","Dom","prepend","initializeLayout","getContainer","activate","setVisible","showSlider","deactivate","Error","getSetting","setting","defaultValue","getSettings","visible","container","removeClass","addClass","isVisible","setFocused","isFocused","addFinishEditListener","callback","subscribe","ON_FINISH_EDIT_EVENT","emitFinishEditEvent","emit","ToDo","Tag","render","onSaveButtonClick","bind","Loc","getMessage","onCancelButtonClick","e","hasClass","removeButtonWaitClass","save","then","cancel","response","Type","isArray","errors","length","clearValue","bindInputHandlers","setParentActivityId","activityId","setDeadLine","deadLine","setDeadline","focus","TodoEditor","defaultDescription","ownerTypeId","ownerId","currentUser","events","onFocus","onChangeDescription","enableCalendarSync","show","event","description","getData","trim","WithEditor","_ownerTypeId","_ownerId","_ghostInput","_saveButtonHandler","BX","delegate","_cancelButtonHandler","_focusHandler","_blurHandler","onBlur","_keyupHandler","resizeForm","_delayedKeyupHandler","setTimeout","_hideButtonsOnBlur","doInitialize","_input","value","window","style","minHeight","_saveButton","saveResult","Promise","release","remove","ensureGhostCreated","create","props","className","text","width","offsetWidth","document","body","appendChild","ghost","computedStyle","getComputedStyle","diff","parseInt","paddingBottom","paddingTop","borderTopWidth","borderBottomWidth","innerHTML","util","htmlspecialchars","replace","scrollHeight","Comment","_cancelButton","_postForm","_editor","_isRequestRunning","_isLocked","unbind","loadEditor","_editorName","ajax","runAction","data","name","onLoadEditorSuccess","result","html","prop","getString","getObject","_editorContainer","showEditor","addEvents","addCustomEvent","firstElementChild","id","item","removeEventListener","file","controller","obj","blob","addEventListener","LHEPostForm","getHandler","BXHtmlEditor","Get","onCustomEvent","eventNode","display","Focus","type","isDomNode","attrs","attachmentList","oEditor","GetContent","querySelectorAll","forEach","input","push","emptyCommentMessage","PopupWindow","content","message","darkMode","autoHide","zIndex","angle","position","offset","closeByEsc","bindOptions","forceBindPosition","fields","ENTITY_ID","ENTITY_TYPE_ID","COMMENT","ATTACHMENTS","onSaveSuccess","catch","onSaveFailure","reinit","Sms","canSend","_senderId","_from","_commEntityTypeId","_commEntityId","_to","_fromList","_toList","_defaults","_communications","_menu","_isMenuShown","_shownMenuId","_documentSelector","_source","_paymentId","_shipmentId","_compilationProductIds","_templateId","_templateFieldHintNode","_templateSelectorNode","_templateTemplateTitleNode","_templatePreviewNode","_templateSelectorMenuId","_templateFieldHintHandler","onTemplateHintIconClick","_templateSeletorClickHandler","onTemplateSelectClick","_selectTemplateHandler","onSelectTemplate","_serviceUrl","remove_url_param","config","_canUse","getBoolean","_canSendMessage","_manageUrl","_senders","getArray","senderId","from","_isSalescenterEnabled","_isDocumentsEnabled","_documentsProvider","_documentsValue","_isFilesEnabled","_diskUrls","_isFilesExternalLinkEnabled","_senderSelectorNode","querySelector","_fromContainerNode","_fromSelectorNode","_clientContainerNode","_clientSelectorNode","_toSelectorNode","_messageLengthCounterWrapperNode","_messageLengthCounterNode","_salescenterStarter","_smsDetailSwitcher","_smsDetail","_documentSelectorButton","_fileSelectorButton","_fileUploadZone","_fileUploadLabel","_fileSelectorBitrix","_fileExternalLinkDisabledContent","_templatesContainer","initSenderSelector","initDetailSwitcher","initFromSelector","initClientContainer","initClientSelector","initToSelector","initMessageLengthCounter","setMessageLengthCounter","initDocumentSelector","initFileSelector","initSalescenterApplication","classList","contains","innerText","add","defaultSenderId","defaultSender","canUse","restSender","menuItems","handler","onSenderSelectorClick","i","fromList","sender","onclick","delimiter","href","target","setSender","openMenu","url","Uri","addParam","manageUrl","slider","SidePanel","Instance","getTopSlider","options","onClose","reload","onCloseComplete","location","open","setFrom","close","setAsDefault","textContent","shortName","isTemplatesBased","showNode","hideNode","toggleTemplateSelectAvailability","toggleSaveButton","visualFn","userOptions","node","defaultFromId","defaultFrom","onFromSelectorClick","onFromSelectorItemClick","hide","defaultClient","setClient","onClientSelectorClick","communication","caption","client","phones","setTo","onToSelectorClick","onToSelectorItemClick","valueFormatted","to","menuId","bindElement","PopupMenu","_id","cacheable","offsetTop","offsetLeft","onPopupClose","onMenuClose","currentItem","preventDefault","_messageLengthMax","getAttribute","setMessageLengthCounterDelayed","classFn","getSelectedSender","enabled","templateId","template","getSelectedTemplate","PREVIEW","ID","alert","resolve","reject","add_url_param","method","dataType","bitrix_sessid","onsuccess","onfailure","error","startSalescenterApplication","loadExt","Salescenter","Manager","openApplication","disableSendButton","mode","CrmEntityType","enumeration","deal","get","title","paymentId","shipmentId","productIds","onDocumentSelectorClick","DocumentGenerator","Selector","Menu","moduleId","provider","analyticsLabelPrefix","selectPublicUrl","object","Template","createDocument","pasteDocumentUrl","console","Document","getDocumentPublicUrl","publicUrl","getTitle","onFileSelectorClick","closeFileSelector","destroy","uploadFile","findFile","getFileUploadInput","getElementById","initDiskUF","fireEvent","showFilesExternalLinkFeaturePopup","getLoader","loader","Loader","size","showLoader","isShown","hideLoader","isDiskFileUploaderInited","OnFileUploadSuccess","uf","_onUploadProgress","parentNode","Disk","UF","UID","controlName","hideSelectDialog","urlSelect","urlRenameFile","urlDeleteFile","urlUpload","fileResult","uploaderFile","diskFileId","element_id","fileName","element_name","pasteFileUrl","analyticsLabel","fileId","externalLink","link","pop","getFeaturePopup","featurePopup","closeIcon","overlay","onPopupDestroy","contentColor","top","Helper","showTemplateSelectDropdown","items","TITLE","loaderMenuId","loaderMenuLoaderId","height","onDestroy","module","find","templates","getMenuById","applySelectedTemplate","menu","preview","Text","encode","self","getId","enableSalesCenter","enableDocuments","enableFiles","showFiles","enableFilesExternalLink","fileInputPrefix","fileInputName","fileUploaderInputName","fileUploaderZoneId","current","phoneReceivers","filter","receiver","address","typeId","newCommunications","addressSource","hash","entityTypeName","resolveName","addressSourceData","Object","values","oldSelectedClient","Call","planner","Crm","Activity","Planner","showEdit","CrmActivityType","call","Email","ownerInfo","CrmTimelineManager","getDefault","getOwnerInfo","CrmActivityEditor","addEmail","Meeting","meeting","Task","addTask","Sharing","HELPDESK_CODE","setContacts","contacts","isNotificationsAvailable","areCommunicationChannelsAvailable","setCommunicationChannels","communicationChannels","selectedChannelId","doPayAttentionToNewFeature","bindEvents","UI","InfoHelper","onLinkCopied","onContactsChangedHandler","payAttentionToNewFeature","DOM","menuBarItem","createConfigureSlotsButton","createSettingsButton","createSendButton","createCancelButton","createMoreInfoButton","configureSlotsButton","Event","onConfigureSlotsButtonClick","settingsButton","updateSettingsButton","onSettingsButtonClick","isContactAvailable","sendButton","onSendButtonClick","cancelButton","moreInfoButton","onMoreInfoButtonClick","showConfigureSlotsPopup","showSettingsPopup","showWarningNoContact","showWarningNoCommunicationChannels","saveLinkAction","isActionCopy","openHelpDesk","newDialog","DialogNew","sharingUrl","settingsMenu","getSettingsMenu","isSettingsPopupShown","popupWindow","getSharingReceiverItem","isChannelsAvailable","getSharingChannelsItem","currentFromList","getSharingSenderItem","MenuManager","map","contact","getContactMenuItem","channels","channel","getChannelMenuItem","getFromMenuItem","isSelected","itemHtml","phone","check","append","updateSenderList","currentFrom","noCommunicationChannelsWarningGuide","getWarningGuide","showNextStep","guidePopup","getPopup","guideContentContainer","getContentContainer","openConfigurationButton","noContactWarningGuide","removeMenuItem","addMenuItem","copyLink","clipboard","copy","Notification","Center","notify","action","contactId","contactTypeId","channelId","linkHash","isCurrentDeal","contactsHashes","includes","sort","a","b","selectedId","isArrayFilled","warningGuide","Guide","simpleMode","onEvents","steps","condition","bottom","color","popupContainer","setWidth","guideContent","offsetFromCloseIcon","existingPadding","paddingRight","setAutoHide","arrowContainer","element","arrow","border","getBoundingClientRect","guide","getGuide","pulsar","getPulsar","article","SpotLight","targetElement","targetVertex","WaitConfigurationDialog","_settings","_type","Wait","WaitingType","undefined","_duration","_target","_targetDates","_container","_durationMeasureNode","_durationInput","_targetDateNode","_popup","isNotEmptyString","getRandomString","getInteger","after","_menuId","getType","setType","getDuration","setDuration","duration","getTarget","setTarget","m","messages","hasOwnProperty","getDurationText","enableNumber","getTargetDateCaption","info","draggable","prepareDialogContent","onPopupShow","buttons","PopupWindowButton","click","PopupWindowButtonLink","wrapper","keyup","onDurationChange","toggleTargetMenu","isNaN","isTargetMenuOpened","closeTargetMenu","openTargetMenu","onTargetSelect","pos","getFunction","before","fieldName","returnValue","_configSelector","_configDialog","resolveTypeId","names","layoutConfigurationSummary","onSelectorClick","closeMenu","onMenuItemClick","customMenu","onMenuShow","onMenuDestroy","openConfigDialog","saveConfiguration","targetDates","onSave","onConfigDialogSave","onCancel","onConfigDialogCancel","Data","optionName","getSummaryHtml","getSummaryText","strip_tags","postpone","complete","completed","comment","targetFieldName","subject","ownerType","ownerID","getMessagePlural","toString","Zoom","onNotConnectedHandler","onNotAvailableHandler","ZoomEditor","onFinishEdit","Delivery","addDelivery","Visit","visitParameters","CrmActivityVisit","RestPlacement","appId","rest","AppLayout","PLACEMENT","PLACEMENT_ID","PlacementInterface","initializePlacement","prototype","reloadData","cb","EntityEvent","fireUpdate","Market","Marketplace","log","fire","invalidate","Factory","createItem","match","MenuBar","containerId","toLowerCase","Main","interfaceButtonsManager","getById","itemData","setActiveItemById","getItemById","selectedItemId","keys","itemId","instances","setDefault","instance","firstId","getAllItems","itemElement","dataset","activeItem","currentDiv","wasActiveInMoreMenu","isActiveInMoreMenu","classes","itemActive","getItemData","currentDivData","activeItemData","submenu","getSubmenu","getMenuItems","menuItem","getMoreButton","closeSubmenu"],"mappings":"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"}