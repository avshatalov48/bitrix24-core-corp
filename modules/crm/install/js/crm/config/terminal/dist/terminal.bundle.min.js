this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.Config=this.BX.Crm.Config||{};(function(t,e,n,s,i,a,r,o){"use strict";var l={props:{title:String,iconStyle:String,collapsed:Boolean},methods:{onTitleClicked:function t(){this.$emit("titleClick")}},template:'\n\t<div class="settings-container">\n\t\t<div\n\t\t\tclass="ui-slider-heading-4 settings-container-title"\n\t\t\tv-bind:class="{ \'settings-container-title-collapsed\': collapsed }"\n\t\t\tv-on:click="onTitleClicked"\n\t\t>\n\t\t\t<div :class="iconStyle"></div>\n\t\t\t{{ title }}\n\t\t</div>\n\n\t\t<div class="settings-section-list" v-bind:class="{ \'settings-section-list-collapsed\': collapsed }">\n\t\t\t<slot></slot>\n\t\t</div>\n\t</div>\n\t'};var c={data:function t(){return{isEnabled:this.active,switcher:null}},mounted:function t(){new BX.UI.Switcher({node:this.$refs.switcher,size:"small",checked:this.isEnabled,handlers:{toggled:this.onSwitcherToggle.bind(this)}});BX.UI.Hint.init(this.$refs.title)},methods:{onSwitcherToggle:function t(){this.isEnabled=!this.isEnabled;this.$emit("toggle",this.isEnabled)},onTitleClick:function t(){this.$emit("titleClick")}},props:{title:String,switchable:{type:Boolean,default:false},active:{type:Boolean,default:false},hint:{type:String,default:""},leftIconClass:{type:String,default:""}},template:'\n\t\t<div>\n\t\t\t<div class="ui-slider-heading-4 settings-section-header">\n\t\t\t\t<div v-if="switchable" class="settings-setction-switcher-container">\n\t\t\t\t\t<span ref="switcher" class="ui-switcher"></span>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="leftIconClass" :class="leftIconClass"></div>\n\t\t\t\t<div\n\t\t\t\t\tstyle="font-size: 16px; margin-right: 0px;"\n\t\t\t\t>\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if="hint !== \'\'"\n\t\t\t\t\tclass="ui-hint"\n\t\t\t\t\tdata-hint-html\n\t\t\t\t\tdata-hint-interactivity\n\t\t\t\t\t:data-hint="hint"\n\t\t\t\t>\n\t\t\t\t\t<span class="ui-hint-icon"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'};var d={template:'\n\t\t<div>\n\t\t\t<div class="sms-container">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t'};function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var p={data:function t(){return{isListShowed:false}},mounted:function t(){var e=this;r.Event.bind(document,"click",(function(){e.isListShowed=false}))},methods:u(u(u({},o.mapGetters(["getServiceLink","getActiveSmsServices"])),o.mapMutations(["selectSMSService"])),{},{switchService:function t(e){this.isListShowed=false;this.selectSMSService(e)},switchVisibility:function t(){this.isListShowed=!this.isListShowed},openSmsServicesSlider:function t(){var e=this;var n={cacheable:false,allowChangeHistory:false,requestMethod:"get",width:700,events:{onClose:function t(){e.$emit("onConnectSliderClosed")}}};BX.SidePanel.Instance.open(this.getServiceLink(),n)}}),computed:u(u({},o.mapGetters(["getSelectedService"])),{},{getListClassname:function t(){if(!this.isListShowed){return"sms-provider-selector-hided-list"}return"sms-provider-selector-list"}}),template:'\n\t\t<div style="display: inline-block; vertical-align: top; position: relative;">\n\t\t\t<span class="sms-provider-selector" @click.stop="switchVisibility">{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_CHANGE\') }}</span>\n\t\t\t<ul :class="getListClassname" @click.stop>\n\t\t\t\t<li v-for="provider in getActiveSmsServices()" @click="switchService(provider[\'ID\'])" v-show="provider[\'ID\'] !== getSelectedService[\'ID\']">{{ provider[\'NAME\'] }}</li>\n\t\t\t\t<li @click="openSmsServicesSlider">{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_PROVIDER_CONNECT_MORE\') }}</li>\n\t\t\t</ul>\n\t\t</div>\n\t'};function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g={data:function t(){return{popup:null}},components:{SettingsSection:c,Sms:d,SmsProviderSelect:p},computed:y(y({},o.mapGetters(["isSmsSendingActive","isAnyServiceEnabled","isNotificationsEnabled","getSelectedService"])),{},{getSectionTitle:function t(){return this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_TITLE")},getSectionHint:function t(){var e={"#LINK_START#":'<a onclick="top.BX.Helper.show(\'redirect=detail&code=17399056\')" style="cursor: pointer">',"#LINK_END#":"</a>"};return this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_HINT_TEXT",e)},getNotificationConnectHint:function t(){var e={"#LINK_START#":'<span onclick="top.BX.Helper.show(\'redirect=detail&code=17399068\')" class="sms-provider-selector">',"#LINK_END#":"</span>"};return this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_PROVIDER_UNC_CONNECTED",e)}}),methods:y(y(y({},o.mapMutations(["setSmsSendingActive","updateServicesList","updateNotificationsEnabled"])),o.mapGetters(["getPaymentSlipLinkScheme","getNotificationsLink","getServiceLink"])),{},{onServiceConnectSliderClosed:function t(){var e=this;r.ajax.runComponentAction("bitrix:crm.config.terminal.settings","updateServicesList").then((function(t){if(t.status==="success"){var n=t.data;if(n!==null&&n!==void 0&&n.isUCNEnabled){e.updateNotificationsEnabled(n.isUCNEnabled)}e.updateServicesList(n.activeSmsServices)}}))["catch"]((function(t){console.error(t)}))},onSectionToggled:function t(){this.setSmsSendingActive(!this.isSmsSendingActive)},getSmsMessage:function t(){var e='<br /><span class="sms-link-path">'.concat(this.getPaymentSlipLinkScheme(),'</span><span class="sms-link-plug">xxxxx</span> ');var n=this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_MESSAGE_TEMPLATE");return r.Text.encode(n).replaceAll("#PAYMENT_SLIP_LINK#",e)},getSmsProviderMessage:function t(){var e="<span>Dummy SMS</span>";var n=this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_SELECT");return r.Text.encode(n).replaceAll("#SMS_SERVICE#",e)},onSmsMouseenter:function t(e){var n=this;var s=e.target;var a=this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_MESSAGE_HINT");if(this.popup){this.popup.destroy();this.popup=null}this.popup=new i.Popup(null,s,{events:{onPopupClose:function t(){n.popup.destroy();n.popup=null}},darkMode:true,content:a,offsetLeft:s.offsetWidth});this.popup.show()},onSmsMouseleave:function t(){this.popup.destroy()},onNotificationsConnectLinkClick:function t(){var e=this;var n=this.getNotificationsLink();if(n===null){return}if(n.type==="connect_link"){var s={cacheable:false,allowChangeHistory:false,requestMethod:"get",width:700,events:{onClose:function t(){e.onServiceConnectSliderClosed()}}};BX.SidePanel.Instance.open(n.value,s)}else if(n.type==="ui_helper"){top.BX.UI.InfoHelper.show(n.value)}},onProviderSmsNotificationClick:function t(){var e=this;var n={cacheable:false,allowChangeHistory:false,requestMethod:"get",width:700,events:{onClose:function t(){e.onServiceConnectSliderClosed()}}};BX.SidePanel.Instance.open(this.getServiceLink(),n)}}),template:'\n\t\t<div v-if="isAnyServiceEnabled" style="display: flex; justify-content: space-between; margin-bottom: 24px;">\n\t\t\t<div>\n\t\t\t\t<SettingsSection\n\t\t\t\t\t:title="getSectionTitle"\n\t\t\t\t\t:switchable="true"\n\t\t\t\t\tv-on:toggle="onSectionToggled"\n\t\t\t\t\t:active="isSmsSendingActive"\n\t\t\t\t\t:hint="getSectionHint"\n\t\t\t\t/>\n\t\t\t\t<div style="margin-left: 53px;">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="getNotificationConnectHint"\n\t\t\t\t\t\tv-if="isNotificationsEnabled"\n\t\t\t\t\t\tclass="sms-provider-name"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<div class="sms-provider-name" style="padding: 3px 0;">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_SELECT_MSGVER_1\') + \' \' + getSelectedService[\'NAME\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<SmsProviderSelect v-on:onConnectSliderClosed="onServiceConnectSliderClosed"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sms-provider-message-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_MESSAGE_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<Sms>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-html="getSmsMessage()"\n\t\t\t\t\t\t\tv-on:mouseenter="onSmsMouseenter($event)"\n\t\t\t\t\t\t\tv-on:mouseleave="onSmsMouseleave"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</Sms>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div style="margin-bottom: 24px;" v-else>\n\t\t\t<span class="sms-provider-empty-provider-list-text" v-if="(getNotificationsLink() !== null) && (getServiceLink() !== \'\')">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_ONBOARDING_TEXT\') }}\n\t\t\t</span>\n\t\t\t<span class="sms-provider-empty-provider-list-text" v-else-if="(getNotificationsLink() === null) && (getServiceLink() !== \'\')">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_ONBOARDING_ONLY_SMS_SERVICES_TEXT\') }}\n\t\t\t</span>\n\t\t\t<button class="ui-btn ui-btn-md ui-btn-primary" @click="onNotificationsConnectLinkClick" v-if="getNotificationsLink() !== null">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_UNC_CONNECT_BTN\') }}\n\t\t\t</button>\n\n\t\t\t<button class="ui-btn ui-btn-md ui-btn-light-border" @click="onProviderSmsNotificationClick" v-if="(getNotificationsLink() !== null) && (getServiceLink() !== \'\')">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_PROVIDER_CONNECT_BTN\') }}\n\t\t\t</button>\n\t\t\t<button class="ui-btn ui-btn-md ui-btn-primary" @click="onProviderSmsNotificationClick" v-else-if="(getNotificationsLink() === null) && (getServiceLink() !== \'\')">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_SMS_SERVICE_PROVIDER_CONNECT_BTN\') }}\n\t\t\t</button>\n\t\t</div>\n\t'};function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={components:{SettingsContainer:l,SmsSettingsSection:g},computed:b({},o.mapGetters({isSettingsChanged:"isChanged",isSaving:"isSaving",getIsSmsCollapsed:"getIsSmsCollapsed"})),methods:b(b({},o.mapMutations(["updateIsSmsCollapsed"])),{},{onTitleClick:function t(){this.updateIsSmsCollapsed(!this.getIsSmsCollapsed);r.ajax.runComponentAction("bitrix:crm.config.terminal.settings","updateSmsCollapsed",{data:{collapsed:this.getIsSmsCollapsed}})}}),template:'\n\t\t<SettingsContainer\n\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SUBTITLE_NOTIFICATION\')"\n\t\t\ticonStyle="settings-section-icon-sms"\n\t\t\t:collapsed="getIsSmsCollapsed"\n\t\t\tv-on:titleClick="onTitleClick"\n\t\t>\n\t\t\t<SmsSettingsSection />\n\t\t</SettingsContainer>\n\t'};var C=Object.freeze({sbp:"sbp",sberQr:"sberQr",rest:"rest",paysystemPanel:"paysystemPanel"});function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={components:{SettingsSection:c,SettingsContainer:l},computed:_(_({},o.mapGetters({getAvailablePaysystems:"getAvailablePaysystems",getTerminalDisabledPaysystems:"getTerminalDisabledPaysystems",getIsLinkPaymentEnabled:"getIsLinkPaymentEnabled",getIsSbpEnabled:"getIsSbpEnabled",getIsSberQrEnabled:"getIsSberQrEnabled",getIsSbpConnected:"getIsSbpConnected",getIsSberQrConnected:"getIsSberQrConnected",getIsRuZone:"getIsRuZone",getSbpConnectPath:"getSbpConnectPath",getSberQrConnectPath:"getSberQrConnectPath",getIsAnyPaysystemActive:"getIsAnyPaysystemActive",getPaysystemPanelPath:"getPaysystemPanelPath",getIsPaysystemsCollapsed:"getIsPaysystemsCollapsed",getPaysystemsArticleUrl:"getPaysystemsArticleUrl"})),{},{getRequiredPaysystemCodes:function t(){return C},getLinkPaymentHint:function t(){return this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_LINK_PAYMENT_HINT")}}),methods:_(_({},o.mapMutations(["setTerminalPaysystemDisabled","setLinkPaymentEnabled","setRequiredPaysystemDisabled","updateSbpConnectPath","updateSberQrConnectPath","updateIsSbpConnected","updateIsSberQrConnected","updateIsPaysystemsCollapsed","updateIsAnyPaysystemActive","updateAvailablePaysystems"])),{},{onPaysystemToggled:function t(e){this.setTerminalPaysystemDisabled(e)},onRequiredPaysystemToggled:function t(e){this.setRequiredPaysystemDisabled(e)},onLinkPaymentToggled:function t(){this.setLinkPaymentEnabled(!this.getIsLinkPaymentEnabled)},openPaysystemSlider:function t(e){var n=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var i={cacheable:false,allowChangeHistory:false,requestMethod:"get",width:e===C.paysystemPanel?null:1e3,events:{onClose:function t(){n.onPaysystemSliderClosed()}}};var a=e===C.rest?s:this.getPaysystemUrl(e);BX.SidePanel.Instance.open(a,i)},getPaysystemUrl:function t(e){switch(e){case C.sbp:return this.getSbpConnectPath;case C.sberQr:return this.getSberQrConnectPath;case C.paysystemPanel:return this.getPaysystemPanelPath;default:return""}},onPaysystemSliderClosed:function t(){var e=this;r.ajax.runComponentAction("bitrix:crm.config.terminal.settings","updatePaysystemPaths").then((function(t){e.updateSbpConnectPath(t.data.sbp);e.updateSberQrConnectPath(t.data.sberbankQr);e.updateIsSbpConnected(t.data.isSbpConnected);e.updateIsSberQrConnected(t.data.isSberQrConnected);e.updateIsAnyPaysystemActive(t.data.isAnyPaysystemActive);e.updateAvailablePaysystems(t.data.availablePaysystems)}))["catch"]((function(){}))},getStatusLabel:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n=this.$Bitrix.Loc.getMessage(e?"CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_CONNECTED":"CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_NOT_CONNECTED").toUpperCase();var s=new a.Label({text:n,color:e?a.LabelColor.LIGHT_GREEN:a.LabelColor.LIGHT,size:a.LabelSize.LG,fill:true});return s.render().outerHTML},onTitleClick:function t(){this.updateIsPaysystemsCollapsed(!this.getIsPaysystemsCollapsed);r.ajax.runComponentAction("bitrix:crm.config.terminal.settings","updatePaysystemsCollapsed",{data:{collapsed:this.getIsPaysystemsCollapsed}})}}),template:'\n\t\t<SettingsContainer\n\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_TITLE_MSGVER_1\')"\n\t\t\ticonStyle="settings-section-icon-payment-methods"\n\t\t\t:collapsed="getIsPaysystemsCollapsed"\n\t\t\tv-on:titleClick="onTitleClick"\n\t\t\tv-bind:style="{ \'padding-bottom: 0px;\' : !getIsPaysystemsCollapsed }"\n\t\t>\n\n\t\t\t<div\n\t\t\t\tclass="payment-systems-subtitle"\n\t\t\t\tv-html="$Bitrix.Loc.getMessage(\n\t\t\t\t\t\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SUBTITLE\',\n\t\t\t\t\t{\'#MORE_INFO_LINK#\': getPaysystemsArticleUrl})"\n\t\t\t></div>\n\n\t\t\t<div class="payment-systems-section-container">\n\t\t\t\t<div class="payment-systems-container">\n\t\t\t\t\t<div v-if="getIsRuZone" class="payment-system-wrapper">\n\t\t\t\t\t\t<SettingsSection\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SBP\')"\n\t\t\t\t\t\t\t:switchable="true"\n\t\t\t\t\t\t\t:active="getIsSbpEnabled"\n\t\t\t\t\t\t\tleftIconClass="payment-method-icon-sbp"\n\t\t\t\t\t\t\tv-on:toggle="onRequiredPaysystemToggled(getRequiredPaysystemCodes.sbp)"\n\t\t\t\t\t\t\tv-on:titleClick="openPaysystemSlider(getRequiredPaysystemCodes.sbp)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="payment-system-status-container">\n\t\t\t\t\t\t\t<span v-html="getStatusLabel(this.getIsSbpConnected)"></span>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="payment-system-set"\n\t\t\t\t\t\t\t\t:class="getIsSbpConnected ? \'payment-system-set-connected\' : \'payment-system-set-not-connected\'"\n\t\t\t\t\t\t\t\tv-on:click="openPaysystemSlider(getRequiredPaysystemCodes.sbp)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(this.getIsSbpConnected\n\t\t\t\t\t\t\t\t? \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SET\'\n\t\t\t\t\t\t\t\t: \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_CONNECT\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div v-if="getIsRuZone" class="payment-system-wrapper">\n\t\t\t\t\t\t<SettingsSection\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SBER_QR\')"\n\t\t\t\t\t\t\t:switchable="true"\n\t\t\t\t\t\t\t:active="getIsSberQrEnabled"\n\t\t\t\t\t\t\tleftIconClass="payment-method-icon-sber"\n\t\t\t\t\t\t\tv-on:toggle="onRequiredPaysystemToggled(getRequiredPaysystemCodes.sberQr)"\n\t\t\t\t\t\t\tv-on:titleClick="openPaysystemSlider(getRequiredPaysystemCodes.sberQr)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="payment-system-status-container">\n\t\t\t\t\t\t\t<span v-html="getStatusLabel(this.getIsSberQrConnected)"></span>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="payment-system-set"\n\t\t\t\t\t\t\t\t:class="getIsSberQrConnected ? \'payment-system-set-connected\' : \'payment-system-set-not-connected\'"\n\t\t\t\t\t\t\t\tv-on:click="openPaysystemSlider(getRequiredPaysystemCodes.sberQr)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(this.getIsSberQrConnected\n\t\t\t\t\t\t\t\t? \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SET\'\n\t\t\t\t\t\t\t\t: \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_CONNECT\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="getAvailablePaysystems.length > 0"\n\t\t\t\t\t\tv-for="paysystem in getAvailablePaysystems"\n\t\t\t\t\t\tclass="payment-system-wrapper"\n\t\t\t\t\t>\n\t\t\t\t\t\t<SettingsSection\n\t\t\t\t\t\t\t:key="paysystem.type"\n\t\t\t\t\t\t\t:title="paysystem.title"\n\t\t\t\t\t\t\t:switchable="paysystem.id > 0"\n\t\t\t\t\t\t\t:active="paysystem.id > 0 && !getTerminalDisabledPaysystems.includes(paysystem.id)"\n\t\t\t\t\t\t\tv-on:toggle="onPaysystemToggled(paysystem.id)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="payment-system-status-container">\n\t\t\t\t\t\t\t<span v-html="getStatusLabel(paysystem.isConnected)"></span>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="payment-system-set"\n\t\t\t\t\t\t\t\t:class="paysystem.isConnected ? \'payment-system-set-connected\' : \'payment-system-set-not-connected\'"\n\t\t\t\t\t\t\t\tv-on:click="openPaysystemSlider(getRequiredPaysystemCodes.rest, paysystem.path)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(paysystem.isConnected\n\t\t\t\t\t\t\t\t? \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SET\'\n\t\t\t\t\t\t\t\t: \'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_CONNECT\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="payment-system-wrapper">\n\t\t\t\t\t\t<SettingsSection\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_LINK_PAYMENT\')"\n\t\t\t\t\t\t\t:switchable="true"\n\t\t\t\t\t\t\t:active="getIsLinkPaymentEnabled"\n\t\t\t\t\t\t\tv-on:toggle="onLinkPaymentToggled()"\n\t\t\t\t\t\t\t:hint="getLinkPaymentHint"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="payment-system-status-container">\n\t\t\t\t\t\t\t<span v-html="getStatusLabel(this.getIsAnyPaysystemActive)"></span>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="payment-system-set payment-system-set-connected"\n\t\t\t\t\t\t\t\tv-on:click="openPaysystemSlider(getRequiredPaysystemCodes.paysystemPanel)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_PAYMENT_METHOD\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="terminal-image-wrapper"></div>\n\t\t\t</div>\n\n\t\t</SettingsContainer>\n\t'};function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={methods:{save:function t(){this.$Bitrix.eventEmitter.emit("crm:terminal:onSettingsSave")},cancel:function t(){this.$Bitrix.eventEmitter.emit("crm:terminal:onSettingsCancel")}},computed:P(P({},o.mapGetters({isSettingsChanged:"isChanged",isSaving:"isSaving"})),{},{buttonsPanelClass:function t(){return{"ui-button-panel-wrapper":true,"ui-pinner":true,"ui-pinner-bottom":true,"ui-pinner-full-width":true,"ui-button-panel-wrapper-hide":!this.isSettingsChanged}},saveButtonClasses:function t(){return{"ui-btn":true,"ui-btn-success":true,"ui-btn-wait":this.isSaving}}}),template:'\n\t\t<div :class="buttonsPanelClass">\n\t\t\t<div class="ui-button-panel ui-button-panel-align-center">\n\t\t\t\t<button\n\t\t\t\t\t@click="save"\n\t\t\t\t\t:class="saveButtonClasses"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SAVE_BTN\') }}\n\t\t\t\t</button>\n\t\t\t\t<a\n\t\t\t\t\t@click="cancel"\n\t\t\t\t\tclass="ui-btn ui-btn-link"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_CANCEL_BTN\') }}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t'};function N(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=M(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var s=0;var i=function t(){};return{s:i,n:function e(){if(s>=t.length)return{done:true};return{done:false,value:t[s++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,r=false,o;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){r=true;o=e},f:function t(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(r)throw o}}}}function M(t,e){if(!t)return;if(typeof t==="string")return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(t,e)}function L(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function R(t,e){k(t,e);e.add(t)}function G(t,e,n){k(t,e);e.set(t,n)}function k(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function w(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var B=new WeakMap;var j=new WeakSet;var x=function(){function t(e){babelHelpers.classCallCheck(this,t);R(this,j);G(this,B,{writable:true,value:void 0});this.rootNode=document.getElementById(e.rootNodeId);this.terminalSettings=e.terminalSettings;this.store=w(this,j,D).call(this,e.terminalSettings)}babelHelpers.createClass(t,[{key:"attachTemplate",value:function t(){babelHelpers.classPrivateFieldSet(this,B,n.BitrixVue.createApp({components:{SmsSettings:f,PaymentMethodsSettings:E,ButtonsPanel:T},computed:A({},o.mapGetters(["isChanged","isSaving","getChangedValues","getIsPaysystemsCollapsed","getIsSbpEnabled","getIsSberQrEnabled","getIsLinkPaymentEnabled","getAvailablePaysystems","getTerminalDisabledPaysystems","getIsAnyPaysystemEnabled"])),mounted:function t(){this.$Bitrix.eventEmitter.subscribe("crm:terminal:onSettingsSave",this.onSettingsSave);this.$Bitrix.eventEmitter.subscribe("crm:terminal:onSettingsCancel",this.onSettingsCancel)},beforeUnmount:function t(){this.$Bitrix.eventEmitter.unsubscribe("crm:terminal:onSettingsSave");this.$Bitrix.eventEmitter.unsubscribe("crm:terminal:onSettingsCancel")},methods:A(A({},o.mapMutations(["setSaving"])),{},{validateChangedValues:function t(){var e=this.getChangedValues;if(e&&Object.keys(e).length>0){return e}return{}},onSettingsSave:function t(){var n=this;if(this.getIsAnyPaysystemEnabled){this.save()}else{e.MessageBox.confirm(this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SAVING_CONFIRM_TITLE"),(function(t){return t.close()}),this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SAVING_CONFIRM_OK"),(function(t){t.close();n.save()}),this.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_SAVING_CONFIRM_SAVE_AND_CLOSE"))}},save:function t(){var e=this;if(!this.isChanged||this.isSaving){return}this.setSaving(true);r.ajax.runComponentAction("bitrix:crm.config.terminal.settings","saveSettings",{data:{changedValues:this.validateChangedValues()}}).then((function(){e.setSaving(false);BX.SidePanel.Instance.close();top.BX.UI.Notification.Center.notify({content:e.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_ON_SAVE_SUCCESS")})}),(function(){e.setSaving(false);BX.UI.Notification.Center.notify({content:e.$Bitrix.Loc.getMessage("CRM_CFG_TERMINAL_SETTINGS_ON_SAVE_ERROR"),width:350,autoHideDelay:4e3})}))},onSettingsCancel:function t(){BX.SidePanel.Instance.close()}}),template:'\n\t\t\t\t<div style="position: relative; overflow: hidden;">\n\t\t\t\t\t<div class="ui-side-panel-wrap-workarea payment-methods-settings-wrapper">\n\t\t\t\t\t\t<PaymentMethodsSettings/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="terminal-image"\n\t\t\t\t\t\tv-bind:class="{ \'terminal-image-collapsed\': this.getIsPaysystemsCollapsed }"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="terminal-image-title">{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_IMAGE_TITLE\') }}</div>\n\t\t\t\t\t\t<div class="terminal-image-paysystems-container">\n\t\t\t\t\t\t\t<div v-if="getIsSbpEnabled" class="terminal-image-paysystem terminal-image-paysystem-sbp">\n\t\t\t\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SBP\') }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if="getIsSberQrEnabled" class="terminal-image-paysystem terminal-image-paysystem-sber-qr">\n\t\t\t\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_SBER_QR\') }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<template v-if="getAvailablePaysystems.length > 0" v-for="paysystem in getAvailablePaysystems">\n\t\t\t\t\t\t\t\t<div class="terminal-image-paysystem terminal-image-paysystem-wallet" v-if="getTerminalDisabledPaysystems.indexOf(paysystem.id) === -1">\n\t\t\t\t\t\t\t\t\t<span>{{ paysystem.title }}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div v-if="getIsLinkPaymentEnabled" class="terminal-image-paysystem terminal-image-paysystem-link">\n\t\t\t\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_LINK_PAYMENT\') }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="terminal-image-no-paysystems-stub" v-if="!getIsAnyPaysystemEnabled">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'CRM_CFG_TERMINAL_SETTINGS_SECTION_PS_NO_PAY_METHODS\') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="ui-side-panel-wrap-workarea" style="margin-bottom: 70px;">\n\t\t\t\t\t<SmsSettings/>\n\t\t\t\t</div>\n\n\t\t\t\t<ButtonsPanel/>\n\t\t\t'}));babelHelpers.classPrivateFieldGet(this,B).use(this.store);babelHelpers.classPrivateFieldGet(this,B).mount(this.rootNode)}}]);return t}();function D(t){var e={state:function e(){return A(A({},t),{},{isSaving:false,changedValues:{}})},getters:{isChanged:function t(e){return Object.keys(e.changedValues).length>0},isSmsSendingActive:function t(e){if(e.changedValues.isSmsSendingEnabled!==undefined){return e.changedValues.isSmsSendingEnabled}return e.isSmsSendingEnabled},isAnyServiceEnabled:function t(e){return e.activeSmsServices.length>0||e.isNotificationsEnabled},isNotificationsEnabled:function t(e){return e.isNotificationsEnabled},getPaymentSlipLinkScheme:function t(e){return e.paymentSlipLinkScheme},getNotificationsLink:function t(e){if(r.Type.isObject(e.connectNotificationsLink)){return e.connectNotificationsLink}return null},isNotificationAvailableToConnect:function t(e){return this.getNotificationsLink(e)!==null},getServiceLink:function t(e){if(r.Type.isString(e.connectServiceLink)){return e.connectServiceLink}return""},getSelectedService:function t(e){if(r.Type.isString(e.changedValues.selectedServiceId)){return e.activeSmsServices.find((function(t){return t.ID===e.changedValues.selectedServiceId}))}return e.activeSmsServices.find((function(t){return t.SELECTED}))},getIsAnyPaysystemEnabled:function t(e,n){var s=false;var i=N(n.getAvailablePaysystems),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;if(!n.getTerminalDisabledPaysystems.includes(r.id)){s=true;break}}}catch(t){i.e(t)}finally{i.f()}return n.getIsSbpEnabled||n.getIsSberQrEnabled||n.getIsLinkPaymentEnabled||s},getActiveSmsServices:function t(e){return e.activeSmsServices},getChangedValues:function t(e){return e.changedValues},isSaving:function t(e){return e.isSaving},getAvailablePaysystems:function t(e){return e.availablePaysystems},getTerminalDisabledPaysystems:function t(e){return e.terminalDisabledPaysystems},getIsLinkPaymentEnabled:function t(e){return e.isLinkPaymentEnabled},getPaysystemPanelPath:function t(e){return e.paysystemPanelPath},getIsAnyPaysystemActive:function t(e){return e.isAnyPaysystemActive},getIsSbpEnabled:function t(e){return e.isSbpEnabled},getSbpConnectPath:function t(e){return e.sbpConnectPath},getIsSbpConnected:function t(e){return e.isSbpConnected},getIsSberQrEnabled:function t(e){return e.isSberQrEnabled},getSberQrConnectPath:function t(e){return e.sberQrConnectPath},getIsSberQrConnected:function t(e){return e.isSberQrConnected},getIsPaysystemsCollapsed:function t(e){return e.isPaysystemsCollapsed},getPaysystemsArticleUrl:function t(e){return e.paysystemsArticleUrl},getIsSmsCollapsed:function t(e){return e.isSmsCollapsed},getIsRuZone:function t(e){return e.isRuZone}},mutations:{setSmsSendingActive:function t(e,n){if(e.changedValues.isSmsSendingEnabled!==undefined&&n===e.isSmsSendingEnabled){delete e.changedValues.isSmsSendingEnabled}else{e.isChanged=true;e.changedValues.isSmsSendingEnabled=n}},selectSMSService:function t(e,n){if(e.activeSmsServices.find((function(t){return t.SELECTED})).ID===n){delete e.changedValues.selectedServiceId}else{e.changedValues.selectedServiceId=n}},setTerminalPaysystemDisabled:function t(e,n){if(!Array.isArray(e.changedValues.terminalDisabledPaysystems)){e.changedValues.terminalDisabledPaysystems=e.terminalDisabledPaysystems}if(e.changedValues.terminalDisabledPaysystems.includes(n)){var s;var i=(s=e.changedValues.terminalDisabledPaysystems)!==null&&s!==void 0?s:[];e.changedValues.terminalDisabledPaysystems=i.filter((function(t){return t!==n}));e.terminalDisabledPaysystems=e.changedValues.terminalDisabledPaysystems;if(e.changedValues.terminalDisabledPaysystems.length===0){e.changedValues.terminalPaysystemsAllEnabled=true;e.terminalPaysystemsAllEnabled=true}e.isChanged=true}else{e.isChanged=true;if(e.changedValues.terminalDisabledPaysystems){e.changedValues.terminalDisabledPaysystems.push(n);e.terminalDisabledPaysystems.push(n)}else{e.changedValues.terminalDisabledPaysystems=[n];e.terminalDisabledPaysystems=[n]}delete e.changedValues.terminalPaysystemsAllEnabled;delete e.terminalPaysystemsAllEnabled}},setRequiredPaysystemDisabled:function t(e,n){var s;switch(n){case C.sbp:s="isSbpEnabled";break;case C.sberQr:s="isSberQrEnabled";break;default:s=null}if(!s){return}e[s]=!e[s];e.changedValues[s]=e[s]},setLinkPaymentEnabled:function t(e,n){if(e.changedValues.isLinkPaymentEnabled!==undefined&&n===e.isLinkPaymentEnabled){delete e.changedValues.isLinkPaymentEnabled}else{e.isChanged=true;e.changedValues.isLinkPaymentEnabled=n;e.isLinkPaymentEnabled=n}},setSaving:function t(e,n){if(r.Type.isBoolean(n)){e.isSaving=n}},updateServicesList:function t(e,n){e.activeSmsServices=n},updateNotificationsEnabled:function t(e,n){e.isNotificationsEnabled=n},updateSbpConnectPath:function t(e,n){e.sbpConnectPath=n},updateSberQrConnectPath:function t(e,n){e.sberQrConnectPath=n},updateIsSbpConnected:function t(e,n){e.isSbpConnected=n},updateIsSberQrConnected:function t(e,n){e.isSberQrConnected=n},updateIsPaysystemsCollapsed:function t(e,n){e.isPaysystemsCollapsed=n},updateIsSmsCollapsed:function t(e,n){e.isSmsCollapsed=n},updateIsAnyPaysystemActive:function t(e,n){e.isAnyPaysystemActive=n},updateAvailablePaysystems:function t(e,n){e.availablePaysystems=n}}};return o.createStore(e)}t.App=x})(this.BX.Crm.Config.Terminal=this.BX.Crm.Config.Terminal||{},BX.UI.Dialogs,BX.Vue3,BX.UI,BX.Main,BX.UI,BX,BX.Vue3.Vuex);
//# sourceMappingURL=terminal.bundle.map.js