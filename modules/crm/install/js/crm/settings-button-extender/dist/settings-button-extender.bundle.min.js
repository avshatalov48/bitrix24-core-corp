this.BX=this.BX||{};(function(e,s,t,a,l,i,r,o,n){"use strict";function b(e,s,t){if(n.Type.isNil(e)){return e}return c(e,s,t)}function c(e,s,t){if(e instanceof s){return e}throw new Error(`Expected ${t} be an instance of ${s.name}, got ${p(e)} instead`)}function d(e,s){if(n.Type.isStringFilled(e)||n.Type.isNil(e)){return e}throw new Error(`Expected ${s} be either non-empty string or null, got ${p(e)} instead`)}function p(e){if(n.Type.isObject(e)&&!n.Type.isPlainObject(e)){var s;return(e==null?void 0:(s=e.constructor)==null?void 0:s.name)||"unknown"}return typeof e}const v=n.Extension.getSettings("crm.settings-button-extender").get("createTimeAliases",{});const u={};for(const e in v){u[e]={column:v[e],order:"desc"}}Object.freeze(u);var P=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var h=babelHelpers.classPrivateFieldLooseKey("grid");var L=babelHelpers.classPrivateFieldLooseKey("disableLastActivitySort");var g=babelHelpers.classPrivateFieldLooseKey("enableLastActivitySort");var H=babelHelpers.classPrivateFieldLooseKey("isColumnExists");var F=babelHelpers.classPrivateFieldLooseKey("isColumnShowed");var B=babelHelpers.classPrivateFieldLooseKey("isColumnSortable");var y=babelHelpers.classPrivateFieldLooseKey("getShowedColumnList");var T=babelHelpers.classPrivateFieldLooseKey("setSortOrder");var f=babelHelpers.classPrivateFieldLooseKey("showColumn");class I{constructor(e,s){Object.defineProperty(this,f,{value:w});Object.defineProperty(this,T,{value:A});Object.defineProperty(this,y,{value:m});Object.defineProperty(this,B,{value:E});Object.defineProperty(this,F,{value:_});Object.defineProperty(this,H,{value:C});Object.defineProperty(this,g,{value:O});Object.defineProperty(this,L,{value:S});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,P)[P]=n.Text.toInteger(e);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=c(s,BX.Main.grid,"grid")}isLastActivitySortSupported(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]("LAST_ACTIVITY_TIME")}isLastActivitySortEnabled(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h].getUserOptions().getCurrentOptions();const s=e.last_sort_by;const t=e.last_sort_order;return(s==null?void 0:s.toLowerCase())==="last_activity_time"&&(t==null?void 0:t.toLowerCase())==="desc"}toggleLastActivitySort(){if(this.isLastActivitySortEnabled()){babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}else{babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}}}async function S(){const e=u[babelHelpers.classPrivateFieldLooseBase(this,P)[P]];let s;if(n.Type.isPlainObject(e)&&babelHelpers.classPrivateFieldLooseBase(this,H)[H](e.column)&&babelHelpers.classPrivateFieldLooseBase(this,B)[B](e.column)){s=e.column;if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F](s)){await babelHelpers.classPrivateFieldLooseBase(this,f)[f](s)}babelHelpers.classPrivateFieldLooseBase(this,T)[T](s,e.order)}else{s=babelHelpers.classPrivateFieldLooseBase(this,y)[y]().find((e=>e!=="LAST_ACTIVITY_TIME"&&babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)))}babelHelpers.classPrivateFieldLooseBase(this,h)[h].sortByColumn(s)}async function O(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]("LAST_ACTIVITY_TIME")){await babelHelpers.classPrivateFieldLooseBase(this,f)[f]("LAST_ACTIVITY_TIME")}babelHelpers.classPrivateFieldLooseBase(this,T)[T]("LAST_ACTIVITY_TIME","desc");babelHelpers.classPrivateFieldLooseBase(this,h)[h].sortByColumn("LAST_ACTIVITY_TIME")}function C(e){return babelHelpers.classPrivateFieldLooseBase(this,h)[h].getParam("COLUMNS_ALL",{}).hasOwnProperty(e)}function _(e){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]().includes(e)}function E(e){const s=babelHelpers.classPrivateFieldLooseBase(this,h)[h].getColumnByName(e);return!!(s&&s.sort!==false)}function m(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h].getSettingsWindow().getShowedColumns()}function A(e,s){babelHelpers.classPrivateFieldLooseBase(this,h)[h].getColumnByName(e).sort_order=s}function w(e){return new Promise(((s,t)=>{if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)){t(new Error(`Column ${e} does not exists`));return}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){t(new Error(`Column ${e} is showed already`));return}babelHelpers.classPrivateFieldLooseBase(this,h)[h].getSettingsWindow().select(e);const a=babelHelpers.classPrivateFieldLooseBase(this,y)[y]();a.push(e);babelHelpers.classPrivateFieldLooseBase(this,h)[h].getSettingsWindow().saveColumns(a,s)}))}const M=n.Reflection.getClass("BX.CrmEntityType");const N="menu-popup-item-accept";const j="menu-popup-item-none";const R=750;const K=300;const G=1;const x=2;var X=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var U=babelHelpers.classPrivateFieldLooseKey("categoryId");var k=babelHelpers.classPrivateFieldLooseKey("pingSettings");var D=babelHelpers.classPrivateFieldLooseKey("rootMenu");var V=babelHelpers.classPrivateFieldLooseKey("targetItemId");var W=babelHelpers.classPrivateFieldLooseKey("kanbanController");var Y=babelHelpers.classPrivateFieldLooseKey("restriction");var $=babelHelpers.classPrivateFieldLooseKey("gridController");var q=babelHelpers.classPrivateFieldLooseKey("todoSkipMenu");var z=babelHelpers.classPrivateFieldLooseKey("todoPingSettingsMenu");var J=babelHelpers.classPrivateFieldLooseKey("isSetSortRequestRunning");var Q=babelHelpers.classPrivateFieldLooseKey("smartActivityNotificationSupported");var Z=babelHelpers.classPrivateFieldLooseKey("aiAutostartSettings");var ee=babelHelpers.classPrivateFieldLooseKey("aiCopilotLanguageId");var se=babelHelpers.classPrivateFieldLooseKey("isSetAiSettingsRequestRunning");var te=babelHelpers.classPrivateFieldLooseKey("extensionSettings");var ae=babelHelpers.classPrivateFieldLooseKey("bindEvents");var le=babelHelpers.classPrivateFieldLooseKey("getItems");var ie=babelHelpers.classPrivateFieldLooseKey("getPushCrmSettings");var re=babelHelpers.classPrivateFieldLooseKey("shouldShowLastActivitySortToggle");var oe=babelHelpers.classPrivateFieldLooseKey("getLastActivitySortToggle");var ne=babelHelpers.classPrivateFieldLooseKey("isLastActivitySortEnabled");var be=babelHelpers.classPrivateFieldLooseKey("handleLastActivitySortToggleClick");var ce=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoSkipMenu");var de=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoPingSettingsMenu");var pe=babelHelpers.classPrivateFieldLooseKey("getCoPilotSettings");var ve=babelHelpers.classPrivateFieldLooseKey("handleCoPilotMenuItemClick");var ue=babelHelpers.classPrivateFieldLooseKey("handleCoPilotLanguageSelect");var Pe=babelHelpers.classPrivateFieldLooseKey("getAllOperationTypes");var he=babelHelpers.classPrivateFieldLooseKey("getTranscribeAIOperationType");var Le=babelHelpers.classPrivateFieldLooseKey("getInfoHelper");class ge{constructor(e){Object.defineProperty(this,Le,{value:we});Object.defineProperty(this,he,{value:Ae});Object.defineProperty(this,Pe,{value:me});Object.defineProperty(this,ue,{value:Ee});Object.defineProperty(this,ve,{value:_e});Object.defineProperty(this,pe,{value:Ce});Object.defineProperty(this,de,{value:Oe});Object.defineProperty(this,ce,{value:Se});Object.defineProperty(this,be,{value:Ie});Object.defineProperty(this,ne,{value:fe});Object.defineProperty(this,oe,{value:Te});Object.defineProperty(this,re,{value:ye});Object.defineProperty(this,ie,{value:Be});Object.defineProperty(this,le,{value:Fe});Object.defineProperty(this,ae,{value:He});Object.defineProperty(this,X,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:null});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,J,{writable:true,value:false});Object.defineProperty(this,Q,{writable:true,value:false});Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:false});Object.defineProperty(this,te,{writable:true,value:n.Extension.getSettings("crm.settings-button-extender")});babelHelpers.classPrivateFieldLooseBase(this,X)[X]=n.Text.toInteger(e.entityTypeId);babelHelpers.classPrivateFieldLooseBase(this,U)[U]=n.Type.isInteger(e.categoryId)?e.categoryId:null;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=n.Type.isPlainObject(e.pingSettings)?e.pingSettings:{};babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=n.Text.toBoolean(e.smartActivityNotificationSupported);if(M&&!M.isDefined(babelHelpers.classPrivateFieldLooseBase(this,X)[X])){throw new Error(`Provided entityTypeId is invalid: ${babelHelpers.classPrivateFieldLooseBase(this,X)[X]}`)}babelHelpers.classPrivateFieldLooseBase(this,D)[D]=c(e.rootMenu,r.Menu,"params.rootMenu");babelHelpers.classPrivateFieldLooseBase(this,V)[V]=d(e.targetItemId,"params.targetItemId");babelHelpers.classPrivateFieldLooseBase(this,W)[W]=b(e.controller,l.SettingsController,"params.controller");babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=b(e.restriction,a.Restriction,"params.restriction");if(n.Reflection.getClass("BX.Main.grid")&&e.grid){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=new I(babelHelpers.classPrivateFieldLooseBase(this,X)[X],e.grid)}babelHelpers.classPrivateFieldLooseBase(this,q)[q]=new s.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],selectedValue:d(e.todoCreateNotificationSkipPeriod,"params.todoCreateNotificationSkipPeriod")});if(Object.keys(babelHelpers.classPrivateFieldLooseBase(this,k)[k]).length>0){babelHelpers.classPrivateFieldLooseBase(this,z)[z]=new t.TodoPingSettingsMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],settings:babelHelpers.classPrivateFieldLooseBase(this,k)[k]})}const i=d(e.aiAutostartSettings,"params.aiAutostartSettings");if(n.Type.isStringFilled(i)){const e=JSON.parse(i);if(n.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e}}babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e.aiCopilotLanguageId;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()}}function He(){const e=[];i.EventEmitter.subscribe(i.EventEmitter.GLOBAL_TARGET,"onPopupShow",(s=>{const t=s.getTarget();if(t.getId()!==babelHelpers.classPrivateFieldLooseBase(this,D)[D].getId()){return}const a=babelHelpers.classPrivateFieldLooseBase(this,le)[le]();if(a.length<=0){return}while(e.length>0){babelHelpers.classPrivateFieldLooseBase(this,D)[D].removeMenuItem(e.pop())}let l=babelHelpers.classPrivateFieldLooseBase(this,V)[V];for(const s of a.reverse()){const t=babelHelpers.classPrivateFieldLooseBase(this,D)[D].addMenuItem(s,l);l=t.getId();e.push(t.getId())}}))}function Fe(){const e=[];const s=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]();if(s){e.push(s)}const t=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();if(t){e.push(t)}return e}function Be(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]()){e.push(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]())}if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,q)[q].getItems())}if(babelHelpers.classPrivateFieldLooseBase(this,de)[de]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,z)[z].getItems())}if(e.length<=0){return null}return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM"),items:e}}function ye(){var e,s,t;const a=((e=babelHelpers.classPrivateFieldLooseBase(this,W)[W])==null?void 0:e.getCurrentSettings().isTypeSupported(l.Type.BY_LAST_ACTIVITY_TIME))&&((s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y])==null?void 0:s.isSortTypeChangeAvailable());return!!(a||(t=babelHelpers.classPrivateFieldLooseBase(this,$)[$])!=null&&t.isLastActivitySortSupported())}function Te(){return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM_TOGGLE_SORT"),disabled:babelHelpers.classPrivateFieldLooseBase(this,J)[J],className:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()?N:j,onclick:babelHelpers.classPrivateFieldLooseBase(this,be)[be].bind(this)}}function fe(){if(babelHelpers.classPrivateFieldLooseBase(this,W)[W]){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].getCurrentSettings().getCurrentType()===l.Type.BY_LAST_ACTIVITY_TIME}if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){return babelHelpers.classPrivateFieldLooseBase(this,$)[$].isLastActivitySortEnabled()}return false}function Ie(e,s){var t,a;(t=s.getMenuWindow())==null?void 0:(a=t.getRootMenuWindow())==null?void 0:a.close();s.disable();if(babelHelpers.classPrivateFieldLooseBase(this,W)[W]){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J]){return}babelHelpers.classPrivateFieldLooseBase(this,J)[J]=true;const e=babelHelpers.classPrivateFieldLooseBase(this,W)[W].getCurrentSettings();let t;if(e.getCurrentType()===l.Type.BY_LAST_ACTIVITY_TIME){t=e.getSupportedTypes().find((e=>e!==l.Type.BY_LAST_ACTIVITY_TIME))}else{t=l.Type.BY_LAST_ACTIVITY_TIME}babelHelpers.classPrivateFieldLooseBase(this,W)[W].setCurrentSortType(t).then((()=>{})).catch((()=>{})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,J)[J]=false;s.enable()}))}else if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){babelHelpers.classPrivateFieldLooseBase(this,$)[$].toggleLastActivitySort();s.enable()}else{console.error("Can not handle last activity toggle click")}}function Se(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}function Oe(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]&&babelHelpers.classPrivateFieldLooseBase(this,re)[re]()}function Ce(){const e=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();const s=[];if(n.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])){var t,a,l,i,r,o,b,c,d,p,v;const u=[];const P=(t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:(a=t.autostartOperationTypes)==null?void 0:a.includes(babelHelpers.classPrivateFieldLooseBase(this,he)[he]());const h=(l=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:l.autostartTranscriptionOnlyOnFirstCallWithRecording;const L=((i=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:(r=i.autostartCallDirections)==null?void 0:r.length)===1&&((o=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:(b=o.autostartCallDirections)==null?void 0:b.includes(G));const g=((c=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:(d=c.autostartCallDirections)==null?void 0:d.length)===1&&((p=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])==null?void 0:(v=p.autostartCallDirections)==null?void 0:v.includes(x));const H=babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIHasPackages");u.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_FIRST_INCOMING_MSGVER_1"),className:P&&H&&h&&L?N:j,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,"firstCall")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_INCOMING"),className:P&&H&&L&&!h?N:j,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,"allCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_OUTGOING"),className:P&&H&&g&&!h?N:j,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,"outgoingCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_ALL_MSGVER_1"),className:P&&H&&!L&&!g&&!h?N:j,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,"allIncomingOutgoingCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1"),className:P&&H?j:N,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,"manual")});s.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS"),disabled:babelHelpers.classPrivateFieldLooseBase(this,se)[se],items:u})}if(n.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee])){var u;s.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_LANGUAGE_MSGVER_1"),onclick:(u=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](true))!=null?u:babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this)})}if(s.length===0){return null}return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_IN_CALLS"),disabled:babelHelpers.classPrivateFieldLooseBase(this,se)[se],items:s}}function _e(e,s,t){var a,l,i,r;(a=t.getMenuWindow())==null?void 0:(l=a.getRootMenuWindow())==null?void 0:l.close();(i=t.getMenuWindow())==null?void 0:(r=i.getParentMenuItem())==null?void 0:r.disable();if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]){return}babelHelpers.classPrivateFieldLooseBase(this,se)[se]=true;switch(e){case"manual":babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]().filter((e=>e!==babelHelpers.classPrivateFieldLooseBase(this,he)[he]()));break;case"firstCall":babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartTranscriptionOnlyOnFirstCallWithRecording=true;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartCallDirections=[G];break;case"allCalls":babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartCallDirections=[G];break;case"outgoingCalls":babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartCallDirections=[x];break;case"allIncomingOutgoingCalls":babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].autostartCallDirections=[G,x];break}n.ajax.runAction("crm.settings.ai.saveAutostartSettings",{json:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],categoryId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],settings:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]}}).then((({data:e})=>{var s,a;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.settings;(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,se)[se]=false})).catch((({errors:e})=>{console.error("Could not save ai settings",e);return n.ajax.runAction("crm.settings.ai.getAutostartSettings",{json:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],categoryId:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}})})).then((({data:e})=>{var s,a;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.settings;(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,se)[se]=false})).catch((({errors:e})=>{var s,a;console.error("Could not fetch ai settings after error in save",e);(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,se)[se]=false}))}function Ee(e){const s=new o.Dialog({targetNode:e.target,multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,context:`COPILOT-LANGUAGE-SELECTOR-${babelHelpers.classPrivateFieldLooseBase(this,X)[X]}-${babelHelpers.classPrivateFieldLooseBase(this,U)[U]}`,width:K,tagSelectorOptions:{textBoxWidth:"100%"},preselectedItems:[["copilot_language",babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]]],entities:[{id:"copilot_language",options:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],categoryId:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}}],events:{"Item:onSelect":e=>{const s=e.getData().item;const t=s.id.toLowerCase();if(!n.Type.isStringFilled(t)){throw new Error("Language ID is not defined")}setTimeout((()=>{let e=`ai_config_${babelHelpers.classPrivateFieldLooseBase(this,X)[X]}`;if(n.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,U)[U])){e+=`_${babelHelpers.classPrivateFieldLooseBase(this,U)[U]}`}n.userOptions.save("crm",e,"languageId",t);babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=t}),R)}}});s.show()}function me(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("allAIOperationTypes").map((e=>n.Text.toInteger(e)))}function Ae(){return n.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("transcribeAIOperationType"))}function we(e=false){if(e){if(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIEnabledInGlobalSettings")){return null}return()=>{if(n.Reflection.getClass("BX.UI.InfoHelper.show")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("aiDisabledSliderCode"))}}}if(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIEnabledInGlobalSettings")&&babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIHasPackages")){return null}return()=>{if(n.Reflection.getClass("BX.UI.InfoHelper.show")){if(!babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIEnabledInGlobalSettings")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("aiDisabledSliderCode"))}else if(!babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("isAIHasPackages")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,te)[te].get("aiPackagesEmptySliderCode"))}}}}e.SettingsButtonExtender=ge})(this.BX.Crm=this.BX.Crm||{},BX.Crm.Activity,BX.Crm.Activity,BX.CRM.Kanban,BX.CRM.Kanban,BX.Event,BX.Main,BX.UI.EntitySelector,BX);
//# sourceMappingURL=settings-button-extender.bundle.map.js