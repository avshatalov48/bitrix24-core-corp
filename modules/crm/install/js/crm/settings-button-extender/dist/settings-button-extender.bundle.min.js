this.BX=this.BX||{};(function(e,s,t,a,l,i,r,o,n){"use strict";function b(e,s,t){if(n.Type.isNil(e)){return e}return c(e,s,t)}function c(e,s,t){if(e instanceof s){return e}throw new Error(`Expected ${t} be an instance of ${s.name}, got ${v(e)} instead`)}function d(e,s){if(!n.Type.isArray(e)){throw new TypeError(`Expected ${s} should be an array of strings, got ${v(e)} instead`)}e.forEach(((e,t)=>{if(!n.Type.isString(e)){throw new TypeError(`Expected ${s} should be an array of strings, instead the element at index ${t} is ${v(e)}`)}}));return e}function p(e,s){if(n.Type.isStringFilled(e)||n.Type.isNil(e)){return e}throw new Error(`Expected ${s} be either non-empty string or null, got ${v(e)} instead`)}function v(e){if(n.Type.isObject(e)&&!n.Type.isPlainObject(e)){var s;return(e==null?void 0:(s=e.constructor)==null?void 0:s.name)||"unknown"}return typeof e}const u=n.Extension.getSettings("crm.settings-button-extender").get("createTimeAliases",{});const h={};for(const e in u){h[e]={column:u[e],order:"desc"}}Object.freeze(h);var P=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var L=babelHelpers.classPrivateFieldLooseKey("grid");var g=babelHelpers.classPrivateFieldLooseKey("disableLastActivitySort");var H=babelHelpers.classPrivateFieldLooseKey("enableLastActivitySort");var F=babelHelpers.classPrivateFieldLooseKey("isColumnExists");var B=babelHelpers.classPrivateFieldLooseKey("isColumnShowed");var y=babelHelpers.classPrivateFieldLooseKey("isColumnSortable");var T=babelHelpers.classPrivateFieldLooseKey("getShowedColumnList");var f=babelHelpers.classPrivateFieldLooseKey("setSortOrder");var I=babelHelpers.classPrivateFieldLooseKey("showColumn");class S{constructor(e,s){Object.defineProperty(this,I,{value:M});Object.defineProperty(this,f,{value:w});Object.defineProperty(this,T,{value:A});Object.defineProperty(this,y,{value:m});Object.defineProperty(this,B,{value:E});Object.defineProperty(this,F,{value:_});Object.defineProperty(this,H,{value:C});Object.defineProperty(this,g,{value:O});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,P)[P]=n.Text.toInteger(e);babelHelpers.classPrivateFieldLooseBase(this,L)[L]=c(s,BX.Main.grid,"grid")}isLastActivitySortSupported(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]("LAST_ACTIVITY_TIME")}isLastActivitySortEnabled(){const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L].getUserOptions().getCurrentOptions();const s=e.last_sort_by;const t=e.last_sort_order;return(s==null?void 0:s.toLowerCase())==="last_activity_time"&&(t==null?void 0:t.toLowerCase())==="desc"}toggleLastActivitySort(){if(this.isLastActivitySortEnabled()){babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}else{babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}}}async function O(){const e=h[babelHelpers.classPrivateFieldLooseBase(this,P)[P]];let s;if(n.Type.isPlainObject(e)&&babelHelpers.classPrivateFieldLooseBase(this,F)[F](e.column)&&babelHelpers.classPrivateFieldLooseBase(this,y)[y](e.column)){s=e.column;if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B](s)){await babelHelpers.classPrivateFieldLooseBase(this,I)[I](s)}babelHelpers.classPrivateFieldLooseBase(this,f)[f](s,e.order)}else{s=babelHelpers.classPrivateFieldLooseBase(this,T)[T]().find((e=>e!=="LAST_ACTIVITY_TIME"&&babelHelpers.classPrivateFieldLooseBase(this,y)[y](e)))}babelHelpers.classPrivateFieldLooseBase(this,L)[L].sortByColumn(s)}async function C(){if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B]("LAST_ACTIVITY_TIME")){await babelHelpers.classPrivateFieldLooseBase(this,I)[I]("LAST_ACTIVITY_TIME")}babelHelpers.classPrivateFieldLooseBase(this,f)[f]("LAST_ACTIVITY_TIME","desc");babelHelpers.classPrivateFieldLooseBase(this,L)[L].sortByColumn("LAST_ACTIVITY_TIME")}function _(e){return babelHelpers.classPrivateFieldLooseBase(this,L)[L].getParam("COLUMNS_ALL",{}).hasOwnProperty(e)}function E(e){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]().includes(e)}function m(e){const s=babelHelpers.classPrivateFieldLooseBase(this,L)[L].getColumnByName(e);return!!(s&&s.sort!==false)}function A(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L].getSettingsWindow().getShowedColumns()}function w(e,s){babelHelpers.classPrivateFieldLooseBase(this,L)[L].getColumnByName(e).sort_order=s}function M(e){return new Promise(((s,t)=>{if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){t(new Error(`Column ${e} does not exists`));return}if(babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)){t(new Error(`Column ${e} is showed already`));return}babelHelpers.classPrivateFieldLooseBase(this,L)[L].getSettingsWindow().select(e);const a=babelHelpers.classPrivateFieldLooseBase(this,T)[T]();a.push(e);babelHelpers.classPrivateFieldLooseBase(this,L)[L].getSettingsWindow().saveColumns(a,s)}))}const N=n.Reflection.getClass("BX.CrmEntityType");const j="menu-popup-item-accept";const R="menu-popup-item-none";const K=750;const x=300;const G=1;const X=2;var U=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var k=babelHelpers.classPrivateFieldLooseKey("categoryId");var D=babelHelpers.classPrivateFieldLooseKey("pingSettings");var W=babelHelpers.classPrivateFieldLooseKey("rootMenu");var V=babelHelpers.classPrivateFieldLooseKey("targetItemId");var $=babelHelpers.classPrivateFieldLooseKey("expandsBehindThan");var Y=babelHelpers.classPrivateFieldLooseKey("kanbanController");var q=babelHelpers.classPrivateFieldLooseKey("restriction");var z=babelHelpers.classPrivateFieldLooseKey("gridController");var J=babelHelpers.classPrivateFieldLooseKey("todoSkipMenu");var Q=babelHelpers.classPrivateFieldLooseKey("todoPingSettingsMenu");var Z=babelHelpers.classPrivateFieldLooseKey("isSetSortRequestRunning");var ee=babelHelpers.classPrivateFieldLooseKey("smartActivityNotificationSupported");var se=babelHelpers.classPrivateFieldLooseKey("aiAutostartSettings");var te=babelHelpers.classPrivateFieldLooseKey("aiCopilotLanguageId");var ae=babelHelpers.classPrivateFieldLooseKey("isSetAiSettingsRequestRunning");var le=babelHelpers.classPrivateFieldLooseKey("extensionSettings");var ie=babelHelpers.classPrivateFieldLooseKey("bindEvents");var re=babelHelpers.classPrivateFieldLooseKey("getItems");var oe=babelHelpers.classPrivateFieldLooseKey("resolveEarlyTargetId");var ne=babelHelpers.classPrivateFieldLooseKey("getPushCrmSettings");var be=babelHelpers.classPrivateFieldLooseKey("shouldShowLastActivitySortToggle");var ce=babelHelpers.classPrivateFieldLooseKey("getLastActivitySortToggle");var de=babelHelpers.classPrivateFieldLooseKey("isLastActivitySortEnabled");var pe=babelHelpers.classPrivateFieldLooseKey("handleLastActivitySortToggleClick");var ve=babelHelpers.classPrivateFieldLooseKey("closeMenuWindow");var ue=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoSkipMenu");var he=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoPingSettingsMenu");var Pe=babelHelpers.classPrivateFieldLooseKey("getCoPilotSettings");var Le=babelHelpers.classPrivateFieldLooseKey("handleCoPilotMenuItemClick");var ge=babelHelpers.classPrivateFieldLooseKey("handleCoPilotLanguageSelect");var He=babelHelpers.classPrivateFieldLooseKey("getAllOperationTypes");var Fe=babelHelpers.classPrivateFieldLooseKey("getTranscribeAIOperationType");var Be=babelHelpers.classPrivateFieldLooseKey("getInfoHelper");class ye{constructor(e){var i;Object.defineProperty(this,Be,{value:xe});Object.defineProperty(this,Fe,{value:Ke});Object.defineProperty(this,He,{value:Re});Object.defineProperty(this,ge,{value:je});Object.defineProperty(this,Le,{value:Ne});Object.defineProperty(this,Pe,{value:Me});Object.defineProperty(this,he,{value:we});Object.defineProperty(this,ue,{value:Ae});Object.defineProperty(this,ve,{value:me});Object.defineProperty(this,pe,{value:Ee});Object.defineProperty(this,de,{value:_e});Object.defineProperty(this,ce,{value:Ce});Object.defineProperty(this,be,{value:Oe});Object.defineProperty(this,ne,{value:Se});Object.defineProperty(this,oe,{value:Ie});Object.defineProperty(this,re,{value:fe});Object.defineProperty(this,ie,{value:Te});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:false});Object.defineProperty(this,ee,{writable:true,value:false});Object.defineProperty(this,se,{writable:true,value:null});Object.defineProperty(this,te,{writable:true,value:null});Object.defineProperty(this,ae,{writable:true,value:false});Object.defineProperty(this,le,{writable:true,value:n.Extension.getSettings("crm.settings-button-extender")});babelHelpers.classPrivateFieldLooseBase(this,U)[U]=n.Text.toInteger(e.entityTypeId);babelHelpers.classPrivateFieldLooseBase(this,k)[k]=n.Type.isInteger(e.categoryId)?e.categoryId:null;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=n.Type.isPlainObject(e.pingSettings)?e.pingSettings:{};babelHelpers.classPrivateFieldLooseBase(this,$)[$]=d((i=e.expandsBehindThan)!=null?i:[],"params.expandsBehindThan");babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=n.Text.toBoolean(e.smartActivityNotificationSupported);if(N&&!N.isDefined(babelHelpers.classPrivateFieldLooseBase(this,U)[U])){throw new Error(`Provided entityTypeId is invalid: ${babelHelpers.classPrivateFieldLooseBase(this,U)[U]}`)}babelHelpers.classPrivateFieldLooseBase(this,W)[W]=c(e.rootMenu,r.Menu,"params.rootMenu");babelHelpers.classPrivateFieldLooseBase(this,V)[V]=p(e.targetItemId,"params.targetItemId");babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=b(e.controller,l.SettingsController,"params.controller");babelHelpers.classPrivateFieldLooseBase(this,q)[q]=b(e.restriction,a.Restriction,"params.restriction");if(n.Reflection.getClass("BX.Main.grid")&&e.grid){babelHelpers.classPrivateFieldLooseBase(this,z)[z]=new S(babelHelpers.classPrivateFieldLooseBase(this,U)[U],e.grid)}babelHelpers.classPrivateFieldLooseBase(this,J)[J]=new s.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],selectedValue:p(e.todoCreateNotificationSkipPeriod,"params.todoCreateNotificationSkipPeriod")});if(Object.keys(babelHelpers.classPrivateFieldLooseBase(this,D)[D]).length>0){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=new t.TodoPingSettingsMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],settings:babelHelpers.classPrivateFieldLooseBase(this,D)[D]})}const o=p(e.aiAutostartSettings,"params.aiAutostartSettings");if(n.Type.isStringFilled(o)){const e=JSON.parse(o);if(n.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e}}babelHelpers.classPrivateFieldLooseBase(this,te)[te]=e.aiCopilotLanguageId;babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()}}function Te(){const e=[];i.EventEmitter.subscribe(i.EventEmitter.GLOBAL_TARGET,"onPopupShow",(s=>{const t=s.getTarget();if(t.getId()!==babelHelpers.classPrivateFieldLooseBase(this,W)[W].getId()){return}const a=babelHelpers.classPrivateFieldLooseBase(this,re)[re]();if(a.length<=0){return}while(e.length>0){babelHelpers.classPrivateFieldLooseBase(this,W)[W].removeMenuItem(e.pop())}let l=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]();for(const s of a.reverse()){const t=babelHelpers.classPrivateFieldLooseBase(this,W)[W].addMenuItem(s,l);if(t){l=t.getId();e.push(t.getId())}}}))}function fe(){const e=[];const s=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]();if(s){e.push(s)}const t=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(t){e.push(t)}return e}function Ie(){var e;const s=babelHelpers.classPrivateFieldLooseBase(this,W)[W].getMenuItems();const t=s.find((e=>babelHelpers.classPrivateFieldLooseBase(this,$)[$].includes(e.getId())));return(e=t==null?void 0:t.getId())!=null?e:babelHelpers.classPrivateFieldLooseBase(this,V)[V]}function Se(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,be)[be]()){e.push(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]())}if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,J)[J].getItems())}if(babelHelpers.classPrivateFieldLooseBase(this,he)[he]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getItems())}if(e.length<=0){return null}return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM"),items:e}}function Oe(){var e,s,t;const a=((e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y])==null?void 0:e.getCurrentSettings().isTypeSupported(l.Type.BY_LAST_ACTIVITY_TIME))&&((s=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:s.isSortTypeChangeAvailable());return!!(a||(t=babelHelpers.classPrivateFieldLooseBase(this,z)[z])!=null&&t.isLastActivitySortSupported())}function Ce(){return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM_TOGGLE_SORT"),disabled:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],className:babelHelpers.classPrivateFieldLooseBase(this,de)[de]()?j:R,onclick:babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this)}}function _e(){if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getCurrentSettings().getCurrentType()===l.Type.BY_LAST_ACTIVITY_TIME}if(babelHelpers.classPrivateFieldLooseBase(this,z)[z]){return babelHelpers.classPrivateFieldLooseBase(this,z)[z].isLastActivitySortEnabled()}return false}function Ee(e,s){var t,a;(t=s.getMenuWindow())==null?void 0:(a=t.getRootMenuWindow())==null?void 0:a.close();s.disable();if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=true;const e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getCurrentSettings();let t;if(e.getCurrentType()===l.Type.BY_LAST_ACTIVITY_TIME){t=e.getSupportedTypes().find((e=>e!==l.Type.BY_LAST_ACTIVITY_TIME))}else{t=l.Type.BY_LAST_ACTIVITY_TIME}babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].setCurrentSortType(t).then((()=>{})).catch((()=>{})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=false;s.enable()}))}else if(babelHelpers.classPrivateFieldLooseBase(this,z)[z]){babelHelpers.classPrivateFieldLooseBase(this,z)[z].toggleLastActivitySort();s.enable()}else{console.error("Can not handle last activity toggle click")}}function me(e,s){var t;(t=s.getMenuWindow())==null?void 0:t.close()}function Ae(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}function we(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]&&babelHelpers.classPrivateFieldLooseBase(this,be)[be]()}function Me(){const e=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();const s=[];if(n.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,se)[se])){var t,a,l,i,r,o,b,c,d,p,v;const u=[];const h=(t=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:(a=t.autostartOperationTypes)==null?void 0:a.includes(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]());const P=(l=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:l.autostartTranscriptionOnlyOnFirstCallWithRecording;const L=((i=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:(r=i.autostartCallDirections)==null?void 0:r.length)===1&&((o=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:(b=o.autostartCallDirections)==null?void 0:b.includes(G));const g=((c=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:(d=c.autostartCallDirections)==null?void 0:d.length)===1&&((p=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:(v=p.autostartCallDirections)==null?void 0:v.includes(X));const H=babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIHasPackages");u.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_FIRST_INCOMING_MSGVER_1"),className:h&&H&&P&&L?j:R,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this,"firstCall")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_INCOMING"),className:h&&H&&L&&!P?j:R,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this,"allCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_OUTGOING"),className:h&&H&&g&&!P?j:R,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this,"outgoingCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_ALL_MSGVER_1"),className:h&&H&&!L&&!g&&!P?j:R,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this,"allIncomingOutgoingCalls")},{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1"),className:h&&H?R:j,onclick:e!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this,"manual")});s.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS"),disabled:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae],items:u})}if(n.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,te)[te])){var u;s.push({text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_LANGUAGE_MSGVER_1"),onclick:(u=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](true))!=null?u:babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this)})}if(s.length===0){return null}return{text:n.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_IN_CALLS"),disabled:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae],items:s}}function Ne(e,s,t){var a,l,i,r;(a=t.getMenuWindow())==null?void 0:(l=a.getRootMenuWindow())==null?void 0:l.close();(i=t.getMenuWindow())==null?void 0:(r=i.getParentMenuItem())==null?void 0:r.disable();if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){return}babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=true;switch(e){case"manual":babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,He)[He]().filter((e=>e!==babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()));break;case"firstCall":babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,He)[He]();babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartTranscriptionOnlyOnFirstCallWithRecording=true;babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartCallDirections=[G];break;case"allCalls":babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,He)[He]();babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartCallDirections=[G];break;case"outgoingCalls":babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,He)[He]();babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartCallDirections=[X];break;case"allIncomingOutgoingCalls":babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartOperationTypes=babelHelpers.classPrivateFieldLooseBase(this,He)[He]();babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartTranscriptionOnlyOnFirstCallWithRecording=false;babelHelpers.classPrivateFieldLooseBase(this,se)[se].autostartCallDirections=[G,X];break}n.ajax.runAction("crm.settings.ai.saveAutostartSettings",{json:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],categoryId:babelHelpers.classPrivateFieldLooseBase(this,k)[k],settings:babelHelpers.classPrivateFieldLooseBase(this,se)[se]}}).then((({data:e})=>{var s,a;babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e.settings;(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=false})).catch((({errors:e})=>{console.error("Could not save ai settings",e);return n.ajax.runAction("crm.settings.ai.getAutostartSettings",{json:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],categoryId:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}})})).then((({data:e})=>{var s,a;babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e.settings;(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=false})).catch((({errors:e})=>{var s,a;console.error("Could not fetch ai settings after error in save",e);(s=t.getMenuWindow())==null?void 0:(a=s.getParentMenuItem())==null?void 0:a.enable();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=false}))}function je(e){const s=new o.Dialog({targetNode:e.target,multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,context:`COPILOT-LANGUAGE-SELECTOR-${babelHelpers.classPrivateFieldLooseBase(this,U)[U]}-${babelHelpers.classPrivateFieldLooseBase(this,k)[k]}`,width:x,tagSelectorOptions:{textBoxWidth:"100%"},preselectedItems:[["copilot_language",babelHelpers.classPrivateFieldLooseBase(this,te)[te]]],entities:[{id:"copilot_language",options:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,U)[U],categoryId:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}}],events:{"Item:onSelect":e=>{const s=e.getData().item;const t=s.id.toLowerCase();if(!n.Type.isStringFilled(t)){throw new Error("Language ID is not defined")}setTimeout((()=>{let e=`ai_config_${babelHelpers.classPrivateFieldLooseBase(this,U)[U]}`;if(n.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,k)[k])){e+=`_${babelHelpers.classPrivateFieldLooseBase(this,k)[k]}`}n.userOptions.save("crm",e,"languageId",t);babelHelpers.classPrivateFieldLooseBase(this,te)[te]=t}),K)}}});s.show()}function Re(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("allAIOperationTypes").map((e=>n.Text.toInteger(e)))}function Ke(){return n.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("transcribeAIOperationType"))}function xe(e=false){if(e){if(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIEnabledInGlobalSettings")){return null}return()=>{if(n.Reflection.getClass("BX.UI.InfoHelper.show")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("aiDisabledSliderCode"))}}}if(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIEnabledInGlobalSettings")&&babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIHasPackages")){return null}return()=>{if(n.Reflection.getClass("BX.UI.InfoHelper.show")){if(!babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIEnabledInGlobalSettings")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("aiDisabledSliderCode"))}else if(!babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("isAIHasPackages")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,le)[le].get("aiPackagesEmptySliderCode"))}}}}e.SettingsButtonExtender=ye})(this.BX.Crm=this.BX.Crm||{},BX.Crm.Activity,BX.Crm.Activity,BX.CRM.Kanban,BX.CRM.Kanban,BX.Event,BX.Main,BX.UI.EntitySelector,BX);
//# sourceMappingURL=settings-button-extender.bundle.map.js