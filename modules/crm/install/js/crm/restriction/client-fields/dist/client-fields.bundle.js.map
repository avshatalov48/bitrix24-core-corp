{"version":3,"file":"client-fields.bundle.js","sources":["../src/client-fields.js"],"sourcesContent":["import type {ClientFieldsOptions} from \"./options\";\nimport {Type, Event} from \"main.core\";\n\nexport class ClientFieldsRestriction\n{\n\tconstructor(options: ClientFieldsOptions)\n\t{\n\t\tthis.options = options;\n\t\tthis.bindAddFilterItemEvent();\n\t\tthis.bindGridSortEvent();\n\t}\n\n\tbindAddFilterItemEvent()\n\t{\n\t\tconst filterId = this.options.filterId ?? null;\n\t\tif (filterId && BX.Main.filterManager)\n\t\t{\n\t\t\tconst filter = BX.Main.filterManager.getById(filterId);\n\t\t\tif (filter)\n\t\t\t{\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeAddFilterItem',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tif (eventData.hasOwnProperty('NAME') && this.isRestrictedFilterField(eventData.NAME))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindGridSortEvent()\n\t{\n\t\tconst gridId = this.options.gridId ?? null;\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(\n\t\t\t\t'BX.Main.grid:onBeforeSort',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst {grid, columnName} = event.getData();\n\t\t\t\t\tif (grid.getId() === gridId && this.isRestrictedGridField(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tisRestrictedFilterField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.filterFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tisRestrictedGridField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.gridFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tcallRestrictionCallback()\n\t{\n\t\tif (Type.isStringFilled(this.options.callback))\n\t\t{\n\t\t\teval(this.options.callback);\n\t\t}\n\t}\n}\n"],"names":["ClientFieldsRestriction","options","bindAddFilterItemEvent","bindGridSortEvent","filterId","BX","Main","filterManager","filter","getById","getEmitter","subscribe","event","eventData","getData","hasOwnProperty","isRestrictedFilterField","NAME","preventDefault","callRestrictionCallback","gridId","gridManager","Event","EventEmitter","grid","columnName","getId","isRestrictedGridField","fieldName","fields","filterFields","Type","isArray","indexOf","gridFields","isStringFilled","callback","eval"],"mappings":";;;;;KAGaA,uBAAb;CAEC,mCAAYC,OAAZ,EACA;CAAA;CACC,SAAKA,OAAL,GAAeA,OAAf;CACA,SAAKC,sBAAL;CACA,SAAKC,iBAAL;CACA;;CAPF;CAAA;CAAA,6CAUC;CAAA;CAAA;;CACC,UAAMC,QAAQ,4BAAG,KAAKH,OAAL,CAAaG,QAAhB,yEAA4B,IAA1C;;CACA,UAAIA,QAAQ,IAAIC,EAAE,CAACC,IAAH,CAAQC,aAAxB,EACA;CACC,YAAMC,MAAM,GAAGH,EAAE,CAACC,IAAH,CAAQC,aAAR,CAAsBE,OAAtB,CAA8BL,QAA9B,CAAf;;CACA,YAAII,MAAJ,EACA;CACCA,UAAAA,MAAM,CAACE,UAAP,GAAoBC,SAApB,CACC,uBADD,EAEC,UAACC,KAAD,EAAW;CACV,gBAAMC,SAAS,GAAGD,KAAK,CAACE,OAAN,EAAlB;;CACA,gBAAID,SAAS,CAACE,cAAV,CAAyB,MAAzB,KAAoC,KAAI,CAACC,uBAAL,CAA6BH,SAAS,CAACI,IAAvC,CAAxC,EACA;CACCL,cAAAA,KAAK,CAACM,cAAN;;CACA,cAAA,KAAI,CAACC,uBAAL;CACA;CACD,WATF;CAWA;CACD;CACD;CA9BF;CAAA;CAAA,wCAiCC;CAAA;CAAA;;CACC,UAAMC,MAAM,2BAAG,KAAKnB,OAAL,CAAamB,MAAhB,uEAA0B,IAAtC;;CACA,UAAIA,MAAM,IAAIf,EAAE,CAACC,IAAH,CAAQe,WAAtB,EACA;CACCC,QAAAA,eAAK,CAACC,YAAN,CAAmBZ,SAAnB,CACC,2BADD,EAEC,UAACC,KAAD,EAAW;CAAA,+BACiBA,KAAK,CAACE,OAAN,EADjB;CAAA,cACHU,IADG,kBACHA,IADG;CAAA,cACGC,UADH,kBACGA,UADH;;CAEV,cAAID,IAAI,CAACE,KAAL,OAAiBN,MAAjB,IAA2B,MAAI,CAACO,qBAAL,CAA2BF,UAA3B,CAA/B,EACA;CACCb,YAAAA,KAAK,CAACM,cAAN;;CACA,YAAA,MAAI,CAACC,uBAAL;CACA;CACD,SATF;CAWA;CACD;CAjDF;CAAA;CAAA,4CAmDyBS,SAnDzB,EAoDC;CAAA;;CACC,UAAMC,MAAM,4BAAG,KAAK5B,OAAL,CAAa6B,YAAhB,yEAAgC,EAA5C;CAEA,aACCC,cAAI,CAACC,OAAL,CAAaH,MAAb,KACGA,MAAM,CAACI,OAAP,CAAeL,SAAf,IAA4B,CAAC,CAFjC;CAIA;CA3DF;CAAA;CAAA,0CA6DuBA,SA7DvB,EA8DC;CAAA;;CACC,UAAMC,MAAM,4BAAG,KAAK5B,OAAL,CAAaiC,UAAhB,yEAA8B,EAA1C;CAEA,aACCH,cAAI,CAACC,OAAL,CAAaH,MAAb,KACGA,MAAM,CAACI,OAAP,CAAeL,SAAf,IAA4B,CAAC,CAFjC;CAIA;CArEF;CAAA;CAAA,8CAwEC;CACC,UAAIG,cAAI,CAACI,cAAL,CAAoB,KAAKlC,OAAL,CAAamC,QAAjC,CAAJ,EACA;CACCC,QAAAA,IAAI,CAAC,KAAKpC,OAAL,CAAamC,QAAd,CAAJ;CACA;CACD;CA7EF;CAAA;CAAA;;;;;;;;"}