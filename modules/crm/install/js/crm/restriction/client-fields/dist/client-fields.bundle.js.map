{"version":3,"file":"client-fields.bundle.js","sources":["../src/client-fields.js"],"sourcesContent":["import type {ClientFieldsOptions} from \"./options\";\nimport {Type, Event} from \"main.core\";\n\nexport class ClientFieldsRestriction\n{\n\tconstructor(options: ClientFieldsOptions)\n\t{\n\t\tthis.options = options;\n\t\tthis.bindAddFilterItemEvent();\n\t\tthis.bindGridSortEvent();\n\t}\n\n\tbindAddFilterItemEvent()\n\t{\n\t\tconst filterId = this.options.filterId ?? null;\n\t\tif (filterId && BX.Main.filterManager)\n\t\t{\n\t\t\tconst filter = BX.Main.filterManager.getById(filterId);\n\t\t\tif (filter)\n\t\t\t{\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeAddFilterItem',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tif (eventData.hasOwnProperty('NAME') && this.isRestrictedFilterField(eventData.NAME))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindGridSortEvent()\n\t{\n\t\tconst gridId = this.options.gridId ?? null;\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(\n\t\t\t\t'BX.Main.grid:onBeforeSort',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst {grid, columnName} = event.getData();\n\t\t\t\t\tif (grid.getId() === gridId && this.isRestrictedGridField(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tisRestrictedFilterField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.filterFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tisRestrictedGridField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.gridFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tcallRestrictionCallback()\n\t{\n\t\tif (Type.isStringFilled(this.options.callback))\n\t\t{\n\t\t\teval(this.options.callback);\n\t\t}\n\t}\n}\n"],"names":["ClientFieldsRestriction","options","bindAddFilterItemEvent","bindGridSortEvent","filterId","BX","Main","filterManager","filter","getById","getEmitter","subscribe","event","eventData","getData","hasOwnProperty","isRestrictedFilterField","NAME","preventDefault","callRestrictionCallback","gridId","gridManager","Event","EventEmitter","grid","columnName","getId","isRestrictedGridField","fieldName","fields","filterFields","Type","isArray","indexOf","gridFields","isStringFilled","callback","eval"],"mappings":";;;;;KAGaA,uBAAb;GAEC,iCAAYC,OAAZ,EACA;KAAA;KACC,KAAKA,OAAL,GAAeA,OAAf;KACA,KAAKC,sBAAL;KACA,KAAKC,iBAAL;;;GANF;KAAA;KAAA,yCAUC;OAAA;;;OACC,IAAMC,QAAQ,4BAAG,KAAKH,OAAL,CAAaG,QAAhB,yEAA4B,IAA1C;;OACA,IAAIA,QAAQ,IAAIC,EAAE,CAACC,IAAH,CAAQC,aAAxB,EACA;SACC,IAAMC,MAAM,GAAGH,EAAE,CAACC,IAAH,CAAQC,aAAR,CAAsBE,OAAtB,CAA8BL,QAA9B,CAAf;;SACA,IAAII,MAAJ,EACA;WACCA,MAAM,CAACE,UAAP,GAAoBC,SAApB,CACC,uBADD,EAEC,UAACC,KAAD,EAAW;aACV,IAAMC,SAAS,GAAGD,KAAK,CAACE,OAAN,EAAlB;;aACA,IAAID,SAAS,CAACE,cAAV,CAAyB,MAAzB,KAAoC,KAAI,CAACC,uBAAL,CAA6BH,SAAS,CAACI,IAAvC,CAAxC,EACA;eACCL,KAAK,CAACM,cAAN;;eACA,KAAI,CAACC,uBAAL;;YAPH;;;;;KAjBJ;KAAA,oCAiCC;OAAA;;;OACC,IAAMC,MAAM,2BAAG,KAAKnB,OAAL,CAAamB,MAAhB,uEAA0B,IAAtC;;OACA,IAAIA,MAAM,IAAIf,EAAE,CAACC,IAAH,CAAQe,WAAtB,EACA;SACCC,eAAK,CAACC,YAAN,CAAmBZ,SAAnB,CACC,2BADD,EAEC,UAACC,KAAD,EAAW;WACV,qBAA2BA,KAAK,CAACE,OAAN,EAA3B;eAAOU,IAAP,kBAAOA,IAAP;eAAaC,UAAb,kBAAaA,UAAb;;WACA,IAAID,IAAI,CAACE,KAAL,OAAiBN,MAAjB,IAA2B,MAAI,CAACO,qBAAL,CAA2BF,UAA3B,CAA/B,EACA;aACCb,KAAK,CAACM,cAAN;;aACA,MAAI,CAACC,uBAAL;;UAPH;;;;KArCH;KAAA,wCAmDyBS,SAnDzB,EAoDC;OAAA;;OACC,IAAMC,MAAM,4BAAG,KAAK5B,OAAL,CAAa6B,YAAhB,yEAAgC,EAA5C;OAEA,OACCC,cAAI,CAACC,OAAL,CAAaH,MAAb,KACGA,MAAM,CAACI,OAAP,CAAeL,SAAf,IAA4B,CAAC,CAFjC;;;KAvDF;KAAA,sCA6DuBA,SA7DvB,EA8DC;OAAA;;OACC,IAAMC,MAAM,4BAAG,KAAK5B,OAAL,CAAaiC,UAAhB,yEAA8B,EAA1C;OAEA,OACCH,cAAI,CAACC,OAAL,CAAaH,MAAb,KACGA,MAAM,CAACI,OAAP,CAAeL,SAAf,IAA4B,CAAC,CAFjC;;;KAjEF;KAAA,0CAwEC;OACC,IAAIG,cAAI,CAACI,cAAL,CAAoB,KAAKlC,OAAL,CAAamC,QAAjC,CAAJ,EACA;SACCC,IAAI,CAAC,KAAKpC,OAAL,CAAamC,QAAd,CAAJ;;;;GA3EH;CAAA;;;;;;;;"}