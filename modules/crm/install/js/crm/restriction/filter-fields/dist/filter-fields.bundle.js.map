{"version":3,"file":"filter-fields.bundle.js","sources":["../src/filter-fields.js"],"sourcesContent":["import { Event, Type } from 'main.core';\nimport type { FilterFieldsOptions } from './options';\n\nexport class FilterFieldsRestriction\n{\n\tconstructor(options: FilterFieldsOptions)\n\t{\n\t\tthis.options = options;\n\t\tthis.bindAddFilterItemEvent();\n\t\tthis.bindGridSortEvent();\n\t}\n\n\tbindAddFilterItemEvent()\n\t{\n\t\tconst filterId = this.options.filterId ?? null;\n\t\tif (filterId && BX.Main.filterManager)\n\t\t{\n\t\t\tconst filter = BX.Main.filterManager.getById(filterId);\n\t\t\tif (filter)\n\t\t\t{\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeChangeFilterItems',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tconst { fields, oldFields } = eventData;\n\n\t\t\t\t\t\tconst newFields = fields.filter((field) => !oldFields.includes(field));\n\t\t\t\t\t\tconst hasRestrictions = newFields.some((field) => this.isRestrictedFilterField(field));\n\t\t\t\t\t\tif (hasRestrictions)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeAddFilterItem',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tif (eventData.hasOwnProperty('NAME') && this.isRestrictedFilterField(eventData.NAME))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindGridSortEvent()\n\t{\n\t\tconst gridId = this.options.gridId ?? null;\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(\n\t\t\t\t'BX.Main.grid:onBeforeSort',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst {grid, columnName} = event.getData();\n\t\t\t\t\tif (grid.getId() === gridId && this.isRestrictedGridField(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tisRestrictedFilterField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.filterFields ?? [];\n\n\t\treturn (Type.isArray(fields) && fields.includes(fieldName));\n\t}\n\n\tisRestrictedGridField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.gridFields ?? [];\n\n\t\treturn (Type.isArray(fields) && fields.includes(fieldName));\n\t}\n\n\tcallRestrictionCallback()\n\t{\n\t\tif (Type.isStringFilled(this.options.callback))\n\t\t{\n\t\t\teval(this.options.callback);\n\t\t}\n\t}\n}\n"],"names":["FilterFieldsRestriction","options","bindAddFilterItemEvent","bindGridSortEvent","filterId","BX","Main","filterManager","filter","getById","getEmitter","subscribe","event","eventData","getData","fields","oldFields","newFields","field","includes","hasRestrictions","some","isRestrictedFilterField","preventDefault","callRestrictionCallback","hasOwnProperty","NAME","gridId","gridManager","Event","EventEmitter","grid","columnName","getId","isRestrictedGridField","fieldName","filterFields","Type","isArray","gridFields","isStringFilled","callback","eval"],"mappings":"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"}