{"version":3,"file":"filter-fields.bundle.js","sources":["../src/filter-fields.js"],"sourcesContent":["import { Event, Type } from 'main.core';\nimport type { FilterFieldsOptions } from './options';\n\nexport class FilterFieldsRestriction\n{\n\tconstructor(options: FilterFieldsOptions)\n\t{\n\t\tthis.options = options;\n\t\tthis.bindAddFilterItemEvent();\n\t\tthis.bindGridSortEvent();\n\t\tthis.bindCheckboxListOptionClick();\n\t}\n\n\tbindAddFilterItemEvent()\n\t{\n\t\tconst filterId = this.options.filterId ?? null;\n\t\tif (filterId && BX.Main.filterManager)\n\t\t{\n\t\t\tconst filter = BX.Main.filterManager.getById(filterId);\n\t\t\tif (filter)\n\t\t\t{\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeChangeFilterItems',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tconst { fields, oldFields } = eventData;\n\n\t\t\t\t\t\tconst newFields = fields.filter((field) => !oldFields.includes(field));\n\t\t\t\t\t\tconst hasRestrictions = newFields.some((field) => this.isRestrictedFilterField(field));\n\t\t\t\t\t\tif (hasRestrictions)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindGridSortEvent()\n\t{\n\t\tconst gridId = this.options.gridId ?? null;\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(\n\t\t\t\t'BX.Main.grid:onBeforeSort',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst {grid, columnName} = event.getData();\n\t\t\t\t\tif (grid.getId() === gridId && this.isRestrictedGridField(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tbindCheckboxListOptionClick(): void\n\t{\n\t\tEvent.EventEmitter.subscribe(\n\t\t\t'ui:checkbox-list:check-option',\n\t\t\t(event) => {\n\t\t\t\tconst { id, context } = event.getData();\n\n\t\t\t\tif (!Type.isPlainObject(context) || !Type.isStringFilled(context.parentType))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (context.parentType === 'filter' && this.isRestrictedFilterField(id))\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t}\n\n\t\t\t\tif (context.parentType === 'grid' && this.isRestrictedGridField(id))\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tisRestrictedFilterField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.filterFields ?? [];\n\n\t\treturn (Type.isArray(fields) && fields.includes(fieldName));\n\t}\n\n\tisRestrictedGridField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.gridFields ?? [];\n\n\t\treturn (Type.isArray(fields) && fields.includes(fieldName));\n\t}\n\n\tcallRestrictionCallback()\n\t{\n\t\tif (Type.isStringFilled(this.options.callback))\n\t\t{\n\t\t\teval(this.options.callback);\n\t\t}\n\t}\n}\n"],"names":["FilterFieldsRestriction","options","bindAddFilterItemEvent","bindGridSortEvent","bindCheckboxListOptionClick","filterId","BX","Main","filterManager","filter","getById","getEmitter","subscribe","event","eventData","getData","fields","oldFields","newFields","field","includes","hasRestrictions","some","isRestrictedFilterField","preventDefault","callRestrictionCallback","gridId","gridManager","Event","EventEmitter","grid","columnName","getId","isRestrictedGridField","id","context","Type","isPlainObject","isStringFilled","parentType","fieldName","filterFields","isArray","gridFields","callback","eval"],"mappings":"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"}