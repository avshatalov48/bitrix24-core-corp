{"version":3,"file":"filter-fields.bundle.js","sources":["../src/filter-fields.js"],"sourcesContent":["import { Type, Event } from 'main.core';\nimport type { FilterFieldsOptions } from './options';\n\nexport class FilterFieldsRestriction\n{\n\tconstructor(options: FilterFieldsOptions)\n\t{\n\t\tthis.options = options;\n\t\tthis.bindAddFilterItemEvent();\n\t\tthis.bindGridSortEvent();\n\t}\n\n\tbindAddFilterItemEvent()\n\t{\n\t\tconst filterId = this.options.filterId ?? null;\n\t\tif (filterId && BX.Main.filterManager)\n\t\t{\n\t\t\tconst filter = BX.Main.filterManager.getById(filterId);\n\t\t\tif (filter)\n\t\t\t{\n\t\t\t\tfilter.getEmitter().subscribe(\n\t\t\t\t\t'onBeforeAddFilterItem',\n\t\t\t\t\t(event) => {\n\t\t\t\t\t\tconst eventData = event.getData();\n\t\t\t\t\t\tif (eventData.hasOwnProperty('NAME') && this.isRestrictedFilterField(eventData.NAME))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindGridSortEvent()\n\t{\n\t\tconst gridId = this.options.gridId ?? null;\n\t\tif (gridId && BX.Main.gridManager)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(\n\t\t\t\t'BX.Main.grid:onBeforeSort',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst {grid, columnName} = event.getData();\n\t\t\t\t\tif (grid.getId() === gridId && this.isRestrictedGridField(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.callRestrictionCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tisRestrictedFilterField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.filterFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tisRestrictedGridField(fieldName: string): boolean\n\t{\n\t\tconst fields = this.options.gridFields ?? [];\n\n\t\treturn (\n\t\t\tType.isArray(fields)\n\t\t\t&& fields.indexOf(fieldName) > -1\n\t\t);\n\t}\n\n\tcallRestrictionCallback()\n\t{\n\t\tif (Type.isStringFilled(this.options.callback))\n\t\t{\n\t\t\teval(this.options.callback);\n\t\t}\n\t}\n}\n"],"names":["FilterFieldsRestriction","options","bindAddFilterItemEvent","bindGridSortEvent","filterId","BX","Main","filterManager","filter","getById","getEmitter","subscribe","event","eventData","getData","hasOwnProperty","isRestrictedFilterField","NAME","preventDefault","callRestrictionCallback","gridId","gridManager","Event","EventEmitter","grid","columnName","getId","isRestrictedGridField","fieldName","fields","filterFields","Type","isArray","indexOf","gridFields","isStringFilled","callback","eval"],"mappings":";;;;;KAGaA,uBAAuB;GAEnC,iCAAYC,OAA4B,EACxC;KAAA;KACC,IAAI,CAACA,OAAO,GAAGA,OAAO;KACtB,IAAI,CAACC,sBAAsB,EAAE;KAC7B,IAAI,CAACC,iBAAiB,EAAE;;GACxB;KAAA;KAAA,yCAGD;OAAA;SAAA;OACC,IAAMC,QAAQ,4BAAG,IAAI,CAACH,OAAO,CAACG,QAAQ,yEAAI,IAAI;OAC9C,IAAIA,QAAQ,IAAIC,EAAE,CAACC,IAAI,CAACC,aAAa,EACrC;SACC,IAAMC,MAAM,GAAGH,EAAE,CAACC,IAAI,CAACC,aAAa,CAACE,OAAO,CAACL,QAAQ,CAAC;SACtD,IAAII,MAAM,EACV;WACCA,MAAM,CAACE,UAAU,EAAE,CAACC,SAAS,CAC5B,uBAAuB,EACvB,UAACC,KAAK,EAAK;aACV,IAAMC,SAAS,GAAGD,KAAK,CAACE,OAAO,EAAE;aACjC,IAAID,SAAS,CAACE,cAAc,CAAC,MAAM,CAAC,IAAI,KAAI,CAACC,uBAAuB,CAACH,SAAS,CAACI,IAAI,CAAC,EACpF;eACCL,KAAK,CAACM,cAAc,EAAE;eACtB,KAAI,CAACC,uBAAuB,EAAE;;YAE/B,CACD;;;;;KAGH;KAAA,oCAGD;OAAA;SAAA;OACC,IAAMC,MAAM,2BAAG,IAAI,CAACnB,OAAO,CAACmB,MAAM,uEAAI,IAAI;OAC1C,IAAIA,MAAM,IAAIf,EAAE,CAACC,IAAI,CAACe,WAAW,EACjC;SACCC,eAAK,CAACC,YAAY,CAACZ,SAAS,CAC3B,2BAA2B,EAC3B,UAACC,KAAK,EAAK;WACV,qBAA2BA,KAAK,CAACE,OAAO,EAAE;aAAnCU,IAAI,kBAAJA,IAAI;aAAEC,UAAU,kBAAVA,UAAU;WACvB,IAAID,IAAI,CAACE,KAAK,EAAE,KAAKN,MAAM,IAAI,MAAI,CAACO,qBAAqB,CAACF,UAAU,CAAC,EACrE;aACCb,KAAK,CAACM,cAAc,EAAE;aACtB,MAAI,CAACC,uBAAuB,EAAE;;UAE/B,CACD;;;;KAEF;KAAA,wCAEuBS,SAAiB,EACzC;OAAA;OACC,IAAMC,MAAM,4BAAG,IAAI,CAAC5B,OAAO,CAAC6B,YAAY,yEAAI,EAAE;OAE9C,OACCC,cAAI,CAACC,OAAO,CAACH,MAAM,CAAC,IACjBA,MAAM,CAACI,OAAO,CAACL,SAAS,CAAC,GAAG,CAAC,CAAC;;;KAElC;KAAA,sCAEqBA,SAAiB,EACvC;OAAA;OACC,IAAMC,MAAM,4BAAG,IAAI,CAAC5B,OAAO,CAACiC,UAAU,yEAAI,EAAE;OAE5C,OACCH,cAAI,CAACC,OAAO,CAACH,MAAM,CAAC,IACjBA,MAAM,CAACI,OAAO,CAACL,SAAS,CAAC,GAAG,CAAC,CAAC;;;KAElC;KAAA,0CAGD;OACC,IAAIG,cAAI,CAACI,cAAc,CAAC,IAAI,CAAClC,OAAO,CAACmC,QAAQ,CAAC,EAC9C;SACCC,IAAI,CAAC,IAAI,CAACpC,OAAO,CAACmC,QAAQ,CAAC;;;;GAE5B;CAAA;;;;;;;;"}