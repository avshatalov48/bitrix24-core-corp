this.BX=this.BX||{};(function(e,t,n,o,i){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getRealizationDocumentDetailUrl",value:function e(t){return new i.Uri("/shop/documents/details/sales_order/"+t+"/")}},{key:"openRealizationDetailDocument",value:function t(n){var o=e.getRealizationDocumentDetailUrl(n);return BX.SidePanel.Instance.open(o.toString())}}]);return e}();var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.gridId=t.gridId;this.filterId=t.filterId;this.grid=BX.Main.gridManager.getInstanceById(this.gridId);this.isConductDisabled=t.isConductDisabled;this.masterSliderUrl=t.masterSliderUrl;this.inventoryManagementSource=t.inventoryManagementSource;window.top.BX.addCustomEvent("onEntityEditorDocumentOrderShipmentControllerDocumentSave",this.reloadGrid.bind(this))}babelHelpers.createClass(e,[{key:"getSelectedIds",value:function e(){return this.grid.getRows().getSelectedIds()}},{key:"deleteDocument",value:function e(o){var a=this;var r=new t.Popup({id:"crm_delete_document_popup",titleBar:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_DELETE_TITLE"),content:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_DELETE_CONTENT"),buttons:[new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CONTINUE"),color:n.ButtonColor.SUCCESS,onclick:function e(t,n){i.ajax.runAction("crm.api.realizationdocument.setRealization",{data:{id:o,value:"N"},analyticsLabel:{action:"delete",inventoryManagementSource:a.inventoryManagementSource}}).then((function(e){r.destroy();a.reloadGrid()}))["catch"]((function(e){if(e.errors){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.errors[0].message)})}r.destroy()}))}}),new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CANCEL"),color:n.ButtonColor.DANGER,onclick:function e(t,n){r.destroy()}})]});r.show()}},{key:"conductDocument",value:function e(o){var a=this;if(this.isConductDisabled){this.openStoreMasterSlider();return}var r=new t.Popup({id:"crm_delete_document_popup",titleBar:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_CONDUCT_TITLE"),content:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_CONDUCT_CONTENT"),buttons:[new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CONTINUE"),color:n.ButtonColor.SUCCESS,onclick:function e(t,n){i.ajax.runAction("crm.api.realizationdocument.setShipped",{data:{id:o,value:"Y"},analyticsLabel:{action:"deduct",inventoryManagementSource:a.inventoryManagementSource}}).then((function(e){r.destroy();a.reloadGrid()}))["catch"]((function(e){if(e.errors){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.errors[0].message)})}r.destroy()}))}}),new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CANCEL"),color:n.ButtonColor.DANGER,onclick:function e(t,n){r.destroy()}})]});r.show()}},{key:"cancelDocument",value:function e(o){var a=this;if(this.isConductDisabled){this.openStoreMasterSlider();return}var r=new t.Popup({id:"crm_delete_document_popup",titleBar:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_CANCEL_TITLE"),content:i.Loc.getMessage("DOCUMENT_GRID_DOCUMENT_CANCEL_CONTENT"),buttons:[new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CONTINUE"),color:n.ButtonColor.SUCCESS,onclick:function e(t,n){i.ajax.runAction("crm.api.realizationdocument.setShipped",{data:{id:o,value:"N"},analyticsLabel:{action:"cancelDeduct",inventoryManagementSource:a.inventoryManagementSource}}).then((function(e){r.destroy();a.reloadGrid()}))["catch"]((function(e){if(e.errors){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.errors[0].message)})}r.destroy()}))}}),new n.Button({text:i.Loc.getMessage("DOCUMENT_GRID_CANCEL"),color:n.ButtonColor.DANGER,onclick:function e(t,n){r.destroy()}})]});r.show()}},{key:"deleteSelectedDocuments",value:function e(){var t=this;var n=this.getSelectedIds();i.ajax.runAction("crm.api.realizationdocument.setRealizationList",{data:{ids:n,value:"N"},analyticsLabel:{action:"delete",inventoryManagementSource:this.inventoryManagementSource}}).then((function(e){t.reloadGrid()}))["catch"]((function(e){if(e.errors){e.errors.forEach((function(e){if(e.message){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.message)})}}))}t.reloadGrid()}))}},{key:"conductSelectedDocuments",value:function e(){var t=this;if(this.isConductDisabled){this.openStoreMasterSlider();return}var n=this.getSelectedIds();i.ajax.runAction("crm.api.realizationdocument.setShippedList",{data:{ids:n,value:"Y"},analyticsLabel:{inventoryManagementSource:this.inventoryManagementSource,action:"deduct"}}).then((function(e){t.reloadGrid()}))["catch"]((function(e){if(e.errors){e.errors.forEach((function(e){if(e.message){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.message)})}}))}t.reloadGrid()}))}},{key:"cancelSelectedDocuments",value:function e(){var t=this;if(this.isConductDisabled){this.openStoreMasterSlider();return}var n=this.getSelectedIds();i.ajax.runAction("crm.api.realizationdocument.setShippedList",{data:{ids:n,value:"N"},analyticsLabel:{inventoryManagementSource:this.inventoryManagementSource,action:"cancelDeduct"}}).then((function(e){t.reloadGrid()}))["catch"]((function(e){if(e.errors){e.errors.forEach((function(e){if(e.message){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.message)})}}))}t.reloadGrid()}))}},{key:"applyFilter",value:function e(t){var n=BX.Main.filterManager.getById(this.filterId);if(!n){return}n.getApi().extendFilter(t)}},{key:"processApplyButtonClick",value:function e(){var t=this.grid.getActionsPanel().getValues();var n=t["action_button_"+this.gridId];if(n==="conduct"){this.conductSelectedDocuments()}if(n==="cancel"){this.cancelSelectedDocuments()}}},{key:"openHowToShipProducts",value:function e(){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=14640548");event.preventDefault()}}},{key:"openStoreMasterSlider",value:function e(){BX.SidePanel.Instance.open(this.masterSliderUrl,{cacheable:false,data:{openGridOnDone:false},events:{onCloseComplete:function e(t){var n=t.getSlider();if(!n){return}if(n.getData().get("isInventoryManagementEnabled")){document.location.reload()}}}})}},{key:"reloadGrid",value:function e(){this.grid.reload()}}]);return e}();e.StoreDocumentGridManager=r})(this.BX.Crm=this.BX.Crm||{},BX.Main,BX.UI,BX.Event,BX);
//# sourceMappingURL=store-document-grid-manager.bundle.map.js