(function(e){e.BX=e.BX||{};if(e.BX.SiteGuest){return}if(!e.b24CrmGuestData){return}e.BX.SiteGuest={cookieName:"b24_crm_guest_id",returnCookieName:"b24_crm_guest_id_returned",domain:"",requestUrl:"",isQueueProcessed:false,queue:[],init:function(){this.trackPages();this.ref=e.b24CrmGuestData.ref;this.requestUrl=this.ref.match(/((http|https):\/\/[^\/]+?)\//)[1]+"/pub/guest.php";this.varName=e.b24CrmGuestData.name||"b24CrmGuest";e[this.varName]=e[this.varName]||[];this.queue=e[this.varName];var t=this;e[this.varName].push=function(){Array.prototype.push.apply(e[t.varName],arguments);t.queue.push(arguments);t.processQueue()};this.processQueue();this.checkReturn()},checkReturn:function(){if(!this.getGidCookie()||this.getCookie(this.returnCookieName)){return}this.send("send","event",{eventName:"Return"});this.setCookie(this.returnCookieName,"y",3600*6)},processQueue:function(){if(this.queue.length==0)return;if(this.isQueueProcessed){var e=this;setTimeout(function(){e.processQueue()},500);return}this.isQueueProcessed=true;this.queue.forEach(function(e){this.send.apply(this,e)},this);this.isQueueProcessed=false},send:function(t,i,s){this.ajax=null;if(e.XMLHttpRequest){this.ajax=new XMLHttpRequest}else if(e.ActiveXObject){this.ajax=new e.ActiveXObject("Microsoft.XMLHTTP")}var r="";switch(t){case"register":if(this.getGidCookie()){return}r+="a="+t;break;case"link":if(this.getGidCookie()){return}r+="a="+t;r+="&gid="+i;break;case"send":if(!this.getGidCookie()){return}if(i=="event"){s=s||{};r+="a=event";r+="&e="+s.eventName}break;default:return}"withCredentials"in this.ajax?this.sendPost(r):this.sendGet(r)},sendGet:function(e){var t=document.createElement("script");t.type="text/javascript";t.src=this.requestUrl+"?"+e;t.async=true;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)},sendPost:function(t){var i=this.ajax;i.open("POST",this.requestUrl,true);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.withCredentials=true;i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){e.BX.SiteGuest.onAjaxResponse(JSON.parse(this.responseText))}};i.send(t)},onAjaxResponse:function(e){e=e||{};e.data=e.data||{};if(this.getGidCookie()==null&&!!e.data.gid){this.setCookie(this.cookieName,e.data.gid);this.setCookie(this.returnCookieName,"y",3600*6)}},pageMaxCount:5,lsPageKey:"b24_crm_guest_pages",trackPages:function(){var t=document.body.querySelector("h1");t=t?t.textContent.trim():"";if(t.length==0){t=document.head.querySelector("title");t=t?t.textContent.trim():""}t=t.substring(0,40);var i=e.location.href;var s=this.localStorage.getItem(this.lsPageKey);s=s instanceof Array?s:[];var r=-1;s.forEach(function(e,t){if(e[0]==i)r=t});if(r>-1)s=s.slice(0,r).concat(s.slice(r+1));while(s.length>=this.pageMaxCount){s.shift()}var a=new Date;s.push([i,Math.round(a.getTime()/1e3)+a.getTimezoneOffset()*60,t]);this.localStorage.setItem(this.lsPageKey,s)},getPages:function(){return this.localStorage.getItem(this.lsPageKey)},clearPages:function(){return this.localStorage.removeItem(this.lsPageKey)},localStorage:{sup:null,removeItem:function(t){if(!this.isSupported())return;e.localStorage.removeItem(t)},setItem:function(t,i){if(!this.isSupported())return;try{e.localStorage.setItem(t,JSON.stringify(i))}catch(s){}},getItem:function(t){if(!this.isSupported())return null;try{return JSON.parse(e.localStorage.getItem(t))}catch(i){return null}},isSupported:function(){if(this.sup===null){this.sup=false;try{var t="b24crm-x-test";e.localStorage.setItem(t,"x");e.localStorage.removeItem(t);this.sup=true}catch(i){}}return this.sup}},setCookie:function(e,t,i){i=i||3600*24*365*10;var s=new Date((new Date).getTime()+1e3*i);document.cookie=e+"="+t+"; path=/; expires="+s.toUTCString()},getGidCookie:function(){return this.getCookie(this.cookieName)},getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}};e.BX.SiteGuest.init()})(window);
//# sourceMappingURL=guest_tracker.map.js