this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.EntityList=this.BX.Crm.EntityList||{};(function(exports,crm_activity_planner,main_core_collections,main_core_events,crm_merger_batchmergemanager,crm_autorun,ui_entitySelector,ui_notification,ui_dialogs_messagebox,main_core){"use strict";function createCallListAndShowAlertOnErrors(e,t,s,r=null,a=false){void createCallList(e,t,s,r,a).then((({errorMessages:e})=>{if(main_core.Type.isArrayFilled(e)){const t=e.join(". \n");ui_dialogs_messagebox.MessageBox.alert(main_core.Text.encode(t))}}))}function createCallList(e,t,s,r=null,a=false){return new Promise((i=>{BX.CrmCallListHelper.createCallList({entityType:BX.CrmEntityType.resolveName(e),entityIds:a?[]:t,gridId:main_core.Type.isNil(r)?undefined:r,createActivity:s},(e=>{if(!main_core.Type.isPlainObject(e)){i({});return}if(!e.SUCCESS&&e.ERRORS){i({errorMessages:e.ERRORS});return}if(!e.SUCCESS||!e.DATA){i({});return}const t=e.DATA;if(t.RESTRICTION){showRestriction(t.RESTRICTION);i({});return}const r=t.ID;if(s&&top.BXIM){top.BXIM.startCallList(r,{})}else{(new BX.Crm.Activity.Planner).showEdit({PROVIDER_ID:"CALL_LIST",PROVIDER_TYPE_ID:"CALL_LIST",ASSOCIATED_ENTITY_ID:r})}i({})}))}))}function showRestriction(restriction){if(main_core.Type.isPlainObject(restriction)&&main_core.Reflection.getClass("B24.licenseInfoPopup")){B24.licenseInfoPopup.show("ivr-limit-popup",restriction.HEADER,restriction.CONTENT)}else if(main_core.Type.isStringFilled(restriction)){eval(restriction)}}function addItemsToCallList(e,t,s,r,a,i){BX.CrmCallListHelper.addToCallList({callListId:s,context:r,entityType:BX.CrmEntityType.resolveName(e),entityIds:i?[]:t,gridId:a})}class BaseHandler{static getEventName(){throw new Error("not implemented")}injectDependencies(e,t){}execute(e,t,s){throw new Error("not implemented")}}var _entityTypeId=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _categoryId=babelHelpers.classPrivateFieldLooseKey("categoryId");var _loadedFieldsCache=babelHelpers.classPrivateFieldLooseKey("loadedFieldsCache");var _getEmptyItemsFieldNames=babelHelpers.classPrivateFieldLooseKey("getEmptyItemsFieldNames");var _getAlreadyLoadedFieldNames=babelHelpers.classPrivateFieldLooseKey("getAlreadyLoadedFieldNames");var _getCells=babelHelpers.classPrivateFieldLooseKey("getCells");class LoadEnumsAndEditSelected extends BaseHandler{constructor({entityTypeId:e,categoryId:t}){super();Object.defineProperty(this,_entityTypeId,{writable:true,value:void 0});Object.defineProperty(this,_categoryId,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId)[_entityTypeId]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId)[_entityTypeId])){throw new Error("entityTypeId is required")}if(!main_core.Type.isNil(t)){babelHelpers.classPrivateFieldLooseBase(this,_categoryId)[_categoryId]=main_core.Text.toInteger(t)}}static getEventName(){return"loadEnumsAndEditSelected"}execute(e,t,s){void LoadEnumsAndEditSelected.loadEnums(e,babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId)[_entityTypeId],babelHelpers.classPrivateFieldLooseBase(this,_categoryId)[_categoryId]).finally((()=>e.editSelected()))}static loadEnums(e,t,s){const r=babelHelpers.classPrivateFieldLooseBase(this,_getEmptyItemsFieldNames)[_getEmptyItemsFieldNames](e);if(r.length===0){return Promise.resolve()}return new Promise(((a,i)=>{main_core.ajax.runAction("crm.controller.list.userField.getData",{data:{entityTypeId:t,fieldNames:r,categoryId:s}}).then((({data:{fields:t}})=>{const s=babelHelpers.classPrivateFieldLooseBase(this,_getAlreadyLoadedFieldNames)[_getAlreadyLoadedFieldNames](e.getId());for(const r of babelHelpers.classPrivateFieldLooseBase(this,_getCells)[_getCells](e)){const{name:e}=r.dataset;if(!t[e]){continue}r.dataset.edit=`(${t[e]})`;s.add(e)}a()})).catch((a=>{console.error("Could not load UF enum values for edit",{response:a,grid:e,entityTypeId:t,categoryId:s,fieldNames:r});i()}))}))}static onAfterGridUpdate(e){babelHelpers.classPrivateFieldLooseBase(this,_loadedFieldsCache)[_loadedFieldsCache].delete(e.getId())}}function _getEmptyItemsFieldNames2(e){const t=e.getParam("COLUMNS_ALL");const s=babelHelpers.classPrivateFieldLooseBase(this,_getAlreadyLoadedFieldNames)[_getAlreadyLoadedFieldNames](e.getId());const r=[];for(const i of babelHelpers.classPrivateFieldLooseBase(this,_getCells)[_getCells](e)){var a;const e=(a=i.dataset.name)!=null?a:null;const l=t[e];const n=main_core.Type.isObjectLike(l==null?void 0:l.editable)&&!l.editable.DATA&&l.type==="list";if(n&&!s.has(e)){r.push(e)}}return r}function _getAlreadyLoadedFieldNames2(e){if(!babelHelpers.classPrivateFieldLooseBase(this,_loadedFieldsCache)[_loadedFieldsCache].has(e)){babelHelpers.classPrivateFieldLooseBase(this,_loadedFieldsCache)[_loadedFieldsCache].set(e,new Set)}return babelHelpers.classPrivateFieldLooseBase(this,_loadedFieldsCache)[_loadedFieldsCache].get(e)}function _getCells2(e){const{cells:t}=e.getRows().getHeadFirstChild().getNode();return[...t]}Object.defineProperty(LoadEnumsAndEditSelected,_getCells,{value:_getCells2});Object.defineProperty(LoadEnumsAndEditSelected,_getAlreadyLoadedFieldNames,{value:_getAlreadyLoadedFieldNames2});Object.defineProperty(LoadEnumsAndEditSelected,_getEmptyItemsFieldNames,{value:_getEmptyItemsFieldNames2});Object.defineProperty(LoadEnumsAndEditSelected,_loadedFieldsCache,{writable:true,value:new Map});main_core_events.EventEmitter.subscribe("Grid::updated",(e=>{const[t]=e.getData();LoadEnumsAndEditSelected.onAfterGridUpdate(t)}));var _handlers=babelHelpers.classPrivateFieldLooseKey("handlers");var _grid=babelHelpers.classPrivateFieldLooseKey("grid");var _progressBarRepo=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");var _extensionSettings=babelHelpers.classPrivateFieldLooseKey("extensionSettings");var _subscriptions=babelHelpers.classPrivateFieldLooseKey("subscriptions");var _createSubscriptionHandler=babelHelpers.classPrivateFieldLooseKey("createSubscriptionHandler");class Router{constructor(e,t,s){Object.defineProperty(this,_createSubscriptionHandler,{value:_createSubscriptionHandler2});Object.defineProperty(this,_grid,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo,{writable:true,value:void 0});Object.defineProperty(this,_extensionSettings,{writable:true,value:void 0});Object.defineProperty(this,_subscriptions,{writable:true,value:new Map});if(!(e instanceof BX.Main.grid)){throw new TypeError("expected grid to be instance of BX.Main.grid")}babelHelpers.classPrivateFieldLooseBase(this,_grid)[_grid]=e;if(!(t instanceof crm_autorun.ProgressBarRepository)){throw new TypeError("expected progressBarRepo to be instance of ProgressBarRepository")}babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo)[_progressBarRepo]=t;if(!(s instanceof main_core_collections.SettingsCollection)){throw new TypeError("expected extensionSettings to be instance of SettingsCollection")}babelHelpers.classPrivateFieldLooseBase(this,_extensionSettings)[_extensionSettings]=s}static registerHandler(e){babelHelpers.classPrivateFieldLooseBase(this,_handlers)[_handlers].add(e)}startListening(){for(const e of babelHelpers.classPrivateFieldLooseBase(this.constructor,_handlers)[_handlers]){const t=`BX.Crm.EntityList.Panel:${e.getEventName()}`;const s=babelHelpers.classPrivateFieldLooseBase(this,_createSubscriptionHandler)[_createSubscriptionHandler](e);babelHelpers.classPrivateFieldLooseBase(this,_subscriptions)[_subscriptions].set(t,s);main_core_events.EventEmitter.subscribe(t,s)}}stopListening(){for(const[e,t]of babelHelpers.classPrivateFieldLooseBase(this,_subscriptions)[_subscriptions].entries()){main_core_events.EventEmitter.unsubscribe(e,t)}}}function _createSubscriptionHandler2(e){return t=>{var s,r,a;const i=new e(t.getData());i.injectDependencies(babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo)[_progressBarRepo],babelHelpers.classPrivateFieldLooseBase(this,_extensionSettings)[_extensionSettings]);i.execute(babelHelpers.classPrivateFieldLooseBase(this,_grid)[_grid],babelHelpers.classPrivateFieldLooseBase(this,_grid)[_grid].getRows().getSelectedIds(),(s=(r=babelHelpers.classPrivateFieldLooseBase(this,_grid)[_grid].getActionsPanel())==null?void 0:(a=r.getForAllCheckbox())==null?void 0:a.checked)!=null?s:false)}}Object.defineProperty(Router,_handlers,{writable:true,value:new Set([])});const NOTIFICATION_AUTO_HIDE_DELAY=5e3;function showAnotherProcessRunningNotification(){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_ENTITY_LIST_PANEL_ANOTHER_PROCESS_IN_PROGRESS"),autoHide:true,autoHideDelay:NOTIFICATION_AUTO_HIDE_DELAY})}var _entityTypeId$1=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$1=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteAssigment extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$1,{writable:true,value:void 0});Object.defineProperty(this,_valueElement,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$1,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$1)[_entityTypeId$1]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$1)[_entityTypeId$1])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement)[_valueElement]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement)[_valueElement])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeAssigment"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$1)[_progressBarRepo$1]=e}execute(e,t,s){let r=crm_autorun.BatchAssignmentManager.getItem(e.getId());if(!r){r=crm_autorun.BatchAssignmentManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$1)[_entityTypeId$1],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$1)[_progressBarRepo$1].getOrCreateProgressBarContainer("assign").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}const a=main_core.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,_valueElement)[_valueElement].dataset.value);if(a<=0){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_ENTITY_LIST_PANEL_SELECT_ASSIGNED_BY_ID"),autoHide:true,autoHideDelay:NOTIFICATION_AUTO_HIDE_DELAY});return}r.setAssignedById(a);if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _valueElement$1=babelHelpers.classPrivateFieldLooseKey("valueElement");class ExecuteConversion extends BaseHandler{constructor({valueElementId:e}){super();Object.defineProperty(this,_valueElement$1,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_valueElement$1)[_valueElement$1]=document.getElementById(e);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$1)[_valueElement$1])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeConversion"}execute(e,t,s){const r=crm_autorun.BatchConversionManager.getItem(e.getId());if(!r){console.error(`BatchConversionManager with id ${e.getId()} not found`);return}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}const a=babelHelpers.classPrivateFieldLooseBase(this,_valueElement$1)[_valueElement$1].dataset.value||BX.CrmLeadConversionScheme.dealcontactcompany;r.setConfig(BX.CrmLeadConversionScheme.createConfig(a));if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$2=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _progressBarRepo$2=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");var _notifyOnComplete=babelHelpers.classPrivateFieldLooseKey("notifyOnComplete");class ExecuteDeletion extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_notifyOnComplete,{value:_notifyOnComplete2});Object.defineProperty(this,_entityTypeId$2,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$2,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$2)[_entityTypeId$2]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$2)[_entityTypeId$2])){throw new Error("entityTypeId is required")}}static getEventName(){return"BatchManager:executeDeletion"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$2)[_progressBarRepo$2]=e}execute(e,t,s){let r=crm_autorun.BatchDeletionManager.getItem(e.getId());if(r&&r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}if(!r){r=crm_autorun.BatchDeletionManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$2)[_entityTypeId$2],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$2)[_progressBarRepo$2].getOrCreateProgressBarContainer("delete").id})}if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute();main_core_events.EventEmitter.subscribeOnce("BX.Crm.BatchDeletionManager:onProcessComplete",babelHelpers.classPrivateFieldLooseBase(this,_notifyOnComplete)[_notifyOnComplete].bind(this))}}function _notifyOnComplete2(){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_ENTITY_LIST_PANEL_DELETION_ANALYTICS_WARNING"),actions:[{title:main_core.Loc.getMessage("CRM_ENTITY_LIST_PANEL_SHOW_DETAILS"),events:{click:(e,t)=>{t.close();if(window.top.BX.Helper){window.top.BX.Helper.show("redirect=detail&code=8969825")}}}}],autoHideDelay:NOTIFICATION_AUTO_HIDE_DELAY})}var _entityTypeId$3=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _progressBarRepo$3=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteExclusion extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$3,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$3,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$3)[_entityTypeId$3]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$3)[_entityTypeId$3])){throw new Error("entityTypeId is required")}}static getEventName(){return"BatchManager:executeExclusion"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$3)[_progressBarRepo$3]=e}execute(e,t,s){let r=crm_autorun.BatchExclusionManager.getItem(e.getId());if(r&&r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}if(!r){r=crm_autorun.BatchExclusionManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$3)[_entityTypeId$3],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$3)[_progressBarRepo$3].getOrCreateProgressBarContainer("exclude").id})}if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$4=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _mergerUrl=babelHelpers.classPrivateFieldLooseKey("mergerUrl");class ExecuteMerge extends BaseHandler{constructor({entityTypeId:e,mergerUrl:t}){super();Object.defineProperty(this,_entityTypeId$4,{writable:true,value:void 0});Object.defineProperty(this,_mergerUrl,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$4)[_entityTypeId$4]=main_core.Text.toInteger(e);babelHelpers.classPrivateFieldLooseBase(this,_mergerUrl)[_mergerUrl]=main_core.Type.isStringFilled(t)?t:null;if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$4)[_entityTypeId$4])){throw new Error("entityTypeId is required")}}static getEventName(){return"BatchManager:executeMerge"}execute(e,t,s){let r=crm_merger_batchmergemanager.BatchMergeManager.getItem(e.getId());if(!r){r=crm_merger_batchmergemanager.BatchMergeManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$4)[_entityTypeId$4],mergerUrl:babelHelpers.classPrivateFieldLooseBase(this,_mergerUrl)[_mergerUrl]})}if(!r.isRunning()&&t.length>1){r.setEntityIds(t);r.execute()}}}var _entityTypeId$5=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$2=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$4=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteObservers extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$5,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$2,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$4,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$5)[_entityTypeId$5]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$5)[_entityTypeId$5])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$2)[_valueElement$2]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$2)[_valueElement$2])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeObservers"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$4)[_progressBarRepo$4]=e}execute(e,t,s){let r=crm_autorun.BatchObserversManager.getItem(e.getId());if(!r){r=crm_autorun.BatchObserversManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$5)[_entityTypeId$5],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$4)[_progressBarRepo$4].getOrCreateProgressBarContainer("observers").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}let a=main_core.Dom.attr(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$2)[_valueElement$2],"data-observers");if(main_core.Type.isNull(a)){a=""}a=a.toString().split(",").map(Number).filter(Boolean);if(!main_core.Type.isArrayFilled(a)){ui_notification.UI.Notification.Center.notify({content:main_core.Loc.getMessage("CRM_ENTITY_LIST_PANEL_SELECT_OBSERVERS_BY_ID"),autoHide:true,autoHideDelay:NOTIFICATION_AUTO_HIDE_DELAY});return}r.setObserverIdList(a);if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$6=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _progressBarRepo$5=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteRefreshAccountingData extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$6,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$5,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$6)[_entityTypeId$6]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$6)[_entityTypeId$6])){throw new Error("entityTypeId is required")}}static getEventName(){return"BatchManager:executeRefreshAccountingData"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$5)[_progressBarRepo$5]=e}execute(e,t,s){let r=crm_autorun.BatchRefreshAccountingDataManager.getItem(e.getId());if(r&&r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}if(!r){r=crm_autorun.BatchRefreshAccountingDataManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$6)[_entityTypeId$6],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$5)[_progressBarRepo$5].getOrCreateProgressBarContainer("refresh-accounting-data").id})}if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$7=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _progressBarRepo$6=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteRestartAutomation extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$7,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$6,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$7)[_entityTypeId$7]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$7)[_entityTypeId$7])){throw new Error("entityTypeId is required")}}static getEventName(){return"BatchManager:restartAutomation"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$6)[_progressBarRepo$6]=e}execute(e,t,s){let r=crm_autorun.BatchRestartAutomationManager.getItem(e.getId());if(r&&r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}if(!r){r=crm_autorun.BatchRestartAutomationManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$7)[_entityTypeId$7],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$6)[_progressBarRepo$6].getOrCreateProgressBarContainer("restartAutomation").id})}if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$8=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$3=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$7=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteSetCategory extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$8,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$3,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$7,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$8)[_entityTypeId$8]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$8)[_entityTypeId$8])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$3)[_valueElement$3]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$3)[_valueElement$3])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeSetCategory"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$7)[_progressBarRepo$7]=e}execute(e,t,s){let r=crm_autorun.BatchSetCategoryManager.getItem(e.getId());if(!r){r=crm_autorun.BatchSetCategoryManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$8)[_entityTypeId$8],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$7)[_progressBarRepo$7].getOrCreateProgressBarContainer("set-category").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}r.setCategoryId(main_core.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$3)[_valueElement$3].dataset.value));if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$9=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$4=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$8=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteSetExport extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$9,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$4,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$8,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$9)[_entityTypeId$9]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$9)[_entityTypeId$9])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$4)[_valueElement$4]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$4)[_valueElement$4])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeSetExport"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$8)[_progressBarRepo$8]=e}execute(e,t,s){let r=crm_autorun.BatchSetExportManager.getItem(e.getId());if(!r){r=crm_autorun.BatchSetExportManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$9)[_entityTypeId$9],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$8)[_progressBarRepo$8].getOrCreateProgressBarContainer("set-export").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}const a=babelHelpers.classPrivateFieldLooseBase(this,_valueElement$4)[_valueElement$4].dataset.value;if(a!=="Y"&&a!=="N"){console.error("Invalid isExport in value element",a,this);return}r.setExport(a);if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$a=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$5=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$9=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteSetOpened extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$a,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$5,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$9,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$a)[_entityTypeId$a]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$a)[_entityTypeId$a])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$5)[_valueElement$5]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$5)[_valueElement$5])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeSetOpened"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$9)[_progressBarRepo$9]=e}execute(e,t,s){let r=crm_autorun.BatchSetOpenedManager.getItem(e.getId());if(!r){r=crm_autorun.BatchSetOpenedManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$a)[_entityTypeId$a],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$9)[_progressBarRepo$9].getOrCreateProgressBarContainer("set-opened").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}const a=babelHelpers.classPrivateFieldLooseBase(this,_valueElement$5)[_valueElement$5].dataset.value;if(a!=="Y"&&a!=="N"){console.error("Invalid isOpened in value element",a,this);return}r.setIsOpened(a);if(s){r.resetEntityIds()}else{r.setEntityIds(t)}r.execute()}}var _entityTypeId$b=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$6=babelHelpers.classPrivateFieldLooseKey("valueElement");var _progressBarRepo$a=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");class ExecuteSetStage extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$b,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$6,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$a,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$b)[_entityTypeId$b]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$b)[_entityTypeId$b])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$6)[_valueElement$6]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$6)[_valueElement$6])){throw new Error("value element not found")}}static getEventName(){return"BatchManager:executeSetStage"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$a)[_progressBarRepo$a]=e}execute(e,t,s){let r=crm_autorun.BatchSetStageManager.getItem(e.getId());if(!r){r=crm_autorun.BatchSetStageManager.create(e.getId(),{gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$b)[_entityTypeId$b],container:babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$a)[_progressBarRepo$a].getOrCreateProgressBarContainer("set-stage").id})}if(r.isRunning()){return}if(crm_autorun.ProcessRegistry.isProcessRunning(e.getId())){showAnotherProcessRunningNotification();return}const a=babelHelpers.classPrivateFieldLooseBase(this,_valueElement$6)[_valueElement$6].dataset.value;if(!main_core.Type.isStringFilled(a)){console.error("Empty stage id in value element",a,this);return}r.setStageId(a);if(s){r.resetEntityIds()}else{r.setEntityIds(t)}this.registerAnalyticsCloseEvent(s,t,a);r.execute()}registerAnalyticsCloseEvent(e,t,s){const r=JSON.parse(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$6)[_valueElement$6].dataset.items).find((e=>e.VALUE===s));if(!r.SEMANTICS){return}let a=null;if(r.SEMANTICS==="F"){a=BX.Crm.Integration.Analytics.Dictionary.ELEMENT_GRID_GROUP_ACTIONS_LOSE_STAGE}if(r.SEMANTICS==="S"){a=BX.Crm.Integration.Analytics.Dictionary.ELEMENT_GRID_GROUP_ACTIONS_WON_STAGE}const i=e?"":t.toString();const l=BX.Crm.Integration.Analytics.Builder.Entity.CloseEvent.createDefault(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$b)[_entityTypeId$b],i).setSubSection(BX.Crm.Integration.Analytics.Dictionary.SUB_SECTION_LIST).setElement(a).buildData();if(e){l.p3="for_all"}l.status=BX.Crm.Integration.Analytics.Dictionary.STATUS_ATTEMPT;BX.UI.Analytics.sendData(l)}}var _entityTypeId$c=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _categoryId$1=babelHelpers.classPrivateFieldLooseKey("categoryId");var _isWhatsAppEdnaEnabled=babelHelpers.classPrivateFieldLooseKey("isWhatsAppEdnaEnabled");var _ednaManageUrl=babelHelpers.classPrivateFieldLooseKey("ednaManageUrl");var _progressBarRepo$b=babelHelpers.classPrivateFieldLooseKey("progressBarRepo");var _isEntityTypeSupported=babelHelpers.classPrivateFieldLooseKey("isEntityTypeSupported");var _showConnectEdnaSlider=babelHelpers.classPrivateFieldLooseKey("showConnectEdnaSlider");class ExecuteWhatsappMessage extends BaseHandler{constructor({entityTypeId:e,categoryId:t,isWhatsAppEdnaEnabled:s,ednaManageUrl:r}){super();Object.defineProperty(this,_showConnectEdnaSlider,{value:_showConnectEdnaSlider2});Object.defineProperty(this,_isEntityTypeSupported,{value:_isEntityTypeSupported2});Object.defineProperty(this,_entityTypeId$c,{writable:true,value:void 0});Object.defineProperty(this,_categoryId$1,{writable:true,value:void 0});Object.defineProperty(this,_isWhatsAppEdnaEnabled,{writable:true,value:void 0});Object.defineProperty(this,_ednaManageUrl,{writable:true,value:void 0});Object.defineProperty(this,_progressBarRepo$b,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$c)[_entityTypeId$c]=e;babelHelpers.classPrivateFieldLooseBase(this,_categoryId$1)[_categoryId$1]=t;babelHelpers.classPrivateFieldLooseBase(this,_isWhatsAppEdnaEnabled)[_isWhatsAppEdnaEnabled]=s;babelHelpers.classPrivateFieldLooseBase(this,_ednaManageUrl)[_ednaManageUrl]=r}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$b)[_progressBarRepo$b]=e}static getEventName(){return"BatchManager:whatsappMessage"}async execute(e,t,s){if(!babelHelpers.classPrivateFieldLooseBase(this,_isWhatsAppEdnaEnabled)[_isWhatsAppEdnaEnabled]){babelHelpers.classPrivateFieldLooseBase(this,_showConnectEdnaSlider)[_showConnectEdnaSlider]();return}if(!babelHelpers.classPrivateFieldLooseBase(this,_isEntityTypeSupported)[_isEntityTypeSupported](babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$c)[_entityTypeId$c])){console.error(`entityTypeId ${babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$c)[_entityTypeId$c]} is not supported for whatsapp message`);return}try{const r=await main_core.Runtime.loadExtension("crm.group-actions.messages");const{Messages:a}=r;const i={gridId:e.getId(),entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$c)[_entityTypeId$c],categoryId:babelHelpers.classPrivateFieldLooseBase(this,_categoryId$1)[_categoryId$1],selectedIds:t,forAll:s};const l=a.getInstance(babelHelpers.classPrivateFieldLooseBase(this,_progressBarRepo$b)[_progressBarRepo$b],i);await l.execute()}catch(e){console.error(e)}}}function _isEntityTypeSupported2(e){const t=[BX.CrmEntityType.enumeration.contact,BX.CrmEntityType.enumeration.company];return t.includes(e)}function _showConnectEdnaSlider2(){BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,_ednaManageUrl)[_ednaManageUrl],{width:700,events:{onClose(e){BX.SidePanel.Instance.postMessage(e.getSlider(),"ContactCenter:reloadItem",{moduleId:"imopenlines",itemCode:"whatsappbyedna"})}}})}var _entityTypeId$d=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _callListId=babelHelpers.classPrivateFieldLooseKey("callListId");var _context=babelHelpers.classPrivateFieldLooseKey("context");class AddItemsToCallList extends BaseHandler{constructor({entityTypeId:e,callListId:t,context:s}){super();Object.defineProperty(this,_entityTypeId$d,{writable:true,value:void 0});Object.defineProperty(this,_callListId,{writable:true,value:void 0});Object.defineProperty(this,_context,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$d)[_entityTypeId$d]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$d)[_entityTypeId$d])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_callListId)[_callListId]=main_core.Text.toInteger(t);if(babelHelpers.classPrivateFieldLooseBase(this,_callListId)[_callListId]<=0){throw new Error("callListId is required")}babelHelpers.classPrivateFieldLooseBase(this,_context)[_context]=String(s);if(!main_core.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,_context)[_context])){throw new Error("context is required")}}static getEventName(){return"CallList:addItemsToCallList"}execute(e,t,s){if(t.length===0&&!s){return}addItemsToCallList(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$d)[_entityTypeId$d],t,babelHelpers.classPrivateFieldLooseBase(this,_callListId)[_callListId],babelHelpers.classPrivateFieldLooseBase(this,_context)[_context],e.getId(),s)}}var _entityTypeId$e=babelHelpers.classPrivateFieldLooseKey("entityTypeId");class CreateAndStartCallList extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$e,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$e)[_entityTypeId$e]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$e)[_entityTypeId$e])){throw new Error("entityTypeId is required")}}static getEventName(){return"CallList:createAndStartCallList"}execute(e,t,s){createCallListAndShowAlertOnErrors(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$e)[_entityTypeId$e],t,true,e.getId(),s)}}var _entityTypeId$f=babelHelpers.classPrivateFieldLooseKey("entityTypeId");class CreateCallList extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$f,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$f)[_entityTypeId$f]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$f)[_entityTypeId$f])){throw new Error("entityTypeId is required")}}static getEventName(){return"CallList:createCallList"}execute(e,t,s){createCallListAndShowAlertOnErrors(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$f)[_entityTypeId$f],t,false,e.getId(),s)}}var _entityTypeId$g=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _extensionSettings$1=babelHelpers.classPrivateFieldLooseKey("extensionSettings");class OpenTaskCreationForm extends BaseHandler{constructor({entityTypeId:e}){super();Object.defineProperty(this,_entityTypeId$g,{writable:true,value:void 0});Object.defineProperty(this,_extensionSettings$1,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$g)[_entityTypeId$g]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$g)[_entityTypeId$g])){throw new Error("entityTypeId is required")}}static getEventName(){return"openTaskCreationForm"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_extensionSettings$1)[_extensionSettings$1]=t}execute(e,t,s){const r=String(babelHelpers.classPrivateFieldLooseBase(this,_extensionSettings$1)[_extensionSettings$1].get("taskCreateUrl"));if(r===""){return}const a=BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$g)[_entityTypeId$g]);const i=t.map((e=>BX.CrmEntityType.prepareEntityKey(a,e)));const l=r.replace(encodeURIComponent("#USER_ID#"),main_core.Loc.getMessage("USER_ID")).replace(encodeURIComponent("#ENTITY_KEYS#"),i.join(";"));if(main_core.Reflection.getClass("BX.SidePanel.Instance.open")){BX.SidePanel.Instance.open(l)}else{window.open(l)}}}var _targetElement=babelHelpers.classPrivateFieldLooseKey("targetElement");class RenderUserTagSelector extends BaseHandler{constructor({targetElementId:e}){super();Object.defineProperty(this,_targetElement,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement]=document.getElementById(e);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement])){throw new Error("target element not found")}}static getEventName(){return"renderUserTagSelector"}execute(e,t,s){const r=new ui_entitySelector.TagSelector({multiple:false,dialogOptions:{context:`crm.entity-list.${RenderUserTagSelector.getEventName()}.${e.getId()}`,entities:[{id:"user"}]},events:{onTagAdd:e=>{const{tag:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement].dataset.value=String(t.getId())},onTagRemove:e=>{const{tag:t}=e.getData();if(String(babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement].dataset.value)===String(t.getId())){delete babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement].dataset.value}}}});r.renderTo(babelHelpers.classPrivateFieldLooseBase(this,_targetElement)[_targetElement])}}var _targetElement$1=babelHelpers.classPrivateFieldLooseKey("targetElement");var _tagSelector=babelHelpers.classPrivateFieldLooseKey("tagSelector");class RenderUserTagMultipleSelector extends BaseHandler{constructor({targetElementId:e}){super();Object.defineProperty(this,_targetElement$1,{writable:true,value:void 0});Object.defineProperty(this,_tagSelector,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_targetElement$1)[_targetElement$1]=document.getElementById(e);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_targetElement$1)[_targetElement$1])){throw new Error("target element not found")}}static getEventName(){return"renderUserTagMultipleSelector"}execute(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,_tagSelector)[_tagSelector]=new ui_entitySelector.TagSelector({multiple:true,dialogOptions:{context:`crm.entity-list.${RenderUserTagMultipleSelector.getEventName()}.${e.getId()}`,entities:[{id:"user"}]},events:{onTagAdd:()=>{this.updateDatasetValue()},onTagRemove:()=>{this.updateDatasetValue()}}});babelHelpers.classPrivateFieldLooseBase(this,_tagSelector)[_tagSelector].renderTo(babelHelpers.classPrivateFieldLooseBase(this,_targetElement$1)[_targetElement$1])}updateDatasetValue(){const e=babelHelpers.classPrivateFieldLooseBase(this,_tagSelector)[_tagSelector].getTags();main_core.Dom.attr(babelHelpers.classPrivateFieldLooseBase(this,_targetElement$1)[_targetElement$1],"data-observers",e.map((e=>e.id)).toString())}}function saveEntitiesToSegment(e,t,s,r){return new Promise(((a,i)=>{main_core.ajax.runAction("crm.integration.sender.segment.upload",{data:{segmentId:e,entityTypeName:BX.CrmEntityType.resolveName(t),entities:s,gridId:r}}).then((({data:e})=>{if("errors"in e){ui_dialogs_messagebox.MessageBox.alert(main_core.Text.encode(e.errors.join("\n")));i();return}a({segment:e})})).catch(i)}))}var _entityTypeId$h=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$7=babelHelpers.classPrivateFieldLooseKey("valueElement");class AddItemsToSegment extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_entityTypeId$h,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$7,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$h)[_entityTypeId$h]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$h)[_entityTypeId$h])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$7)[_valueElement$7]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$7)[_valueElement$7])){throw new Error("value element not found")}}static getEventName(){return"Sender:addItemsToSegment"}execute(e,t,s){const r=main_core.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$7)[_valueElement$7].dataset.value);e.disableActionsPanel();void saveEntitiesToSegment(r<=0?null:r,babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$h)[_entityTypeId$h],t,s?e.getId():null).then((({segment:e})=>{if(e.textSuccess){ui_notification.UI.Notification.Center.notify({content:e.textSuccess,autoHide:true,autoHideDelay:NOTIFICATION_AUTO_HIDE_DELAY})}})).finally((()=>e.enableActionsPanel()))}}var _settings=babelHelpers.classPrivateFieldLooseKey("settings");var _entityTypeId$i=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var _valueElement$8=babelHelpers.classPrivateFieldLooseKey("valueElement");var _getAvailableLetterCodes=babelHelpers.classPrivateFieldLooseKey("getAvailableLetterCodes");class AddLetter extends BaseHandler{constructor({entityTypeId:e,valueElementId:t}){super();Object.defineProperty(this,_getAvailableLetterCodes,{value:_getAvailableLetterCodes2});Object.defineProperty(this,_settings,{writable:true,value:void 0});Object.defineProperty(this,_entityTypeId$i,{writable:true,value:void 0});Object.defineProperty(this,_valueElement$8,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$i)[_entityTypeId$i]=main_core.Text.toInteger(e);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$i)[_entityTypeId$i])){throw new Error("entityTypeId is required")}babelHelpers.classPrivateFieldLooseBase(this,_valueElement$8)[_valueElement$8]=document.getElementById(t);if(!main_core.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,_valueElement$8)[_valueElement$8])){throw new Error("value element not found")}}static getEventName(){return"Sender:addLetter"}injectDependencies(e,t){babelHelpers.classPrivateFieldLooseBase(this,_settings)[_settings]=t}execute(e,t,s){const r=babelHelpers.classPrivateFieldLooseBase(this,_valueElement$8)[_valueElement$8].dataset.value;if(!main_core.Type.isStringFilled(r)){return}if(!babelHelpers.classPrivateFieldLooseBase(this,_getAvailableLetterCodes)[_getAvailableLetterCodes]().includes(r)&&main_core.Reflection.getClass("BX.Sender.B24License")){BX.Sender.B24License.showMailingPopup();return}void saveEntitiesToSegment(null,babelHelpers.classPrivateFieldLooseBase(this,_entityTypeId$i)[_entityTypeId$i],t,s?e.getId():null).then((({segment:e})=>{const t=babelHelpers.classPrivateFieldLooseBase(this,_settings)[_settings].get("sender.letterAddUrl").replace("#code#",r).replace("#segment_id#",e.id);BX.SidePanel.Instance.open(t,{cacheable:false})}))}}function _getAvailableLetterCodes2(){return babelHelpers.classPrivateFieldLooseBase(this,_settings)[_settings].get("sender.availableLetterCodes")||[]}Router.registerHandler(ExecuteDeletion);Router.registerHandler(ExecuteSetStage);Router.registerHandler(ExecuteSetCategory);Router.registerHandler(ExecuteSetOpened);Router.registerHandler(ExecuteSetExport);Router.registerHandler(ExecuteMerge);Router.registerHandler(ExecuteExclusion);Router.registerHandler(ExecuteAssigment);Router.registerHandler(ExecuteConversion);Router.registerHandler(ExecuteWhatsappMessage);Router.registerHandler(ExecuteRefreshAccountingData);Router.registerHandler(ExecuteRestartAutomation);Router.registerHandler(ExecuteObservers);Router.registerHandler(CreateCallList);Router.registerHandler(CreateAndStartCallList);Router.registerHandler(AddItemsToCallList);Router.registerHandler(AddLetter);Router.registerHandler(AddItemsToSegment);Router.registerHandler(RenderUserTagSelector);Router.registerHandler(RenderUserTagMultipleSelector);Router.registerHandler(OpenTaskCreationForm);Router.registerHandler(LoadEnumsAndEditSelected);function init({gridId:e,progressBarContainerId:t}){if(!main_core.Reflection.getClass("BX.Main.gridManager.getInstanceById")){console.error("BX.Main.gridManager is not found on page");return}const s=BX.Main.gridManager.getInstanceById(e);if(!s){console.error("grid not found",e);return}const r=document.getElementById(t);if(!main_core.Type.isElementNode(r)){console.error("progressBarContainer not found",t);return}const a=new crm_autorun.ProgressBarRepository(r);const i=main_core.Extension.getSettings("crm.entity-list.panel");const l=new Router(s,a,i);l.startListening()}function loadEnumsGridEditData(e,t,s){return LoadEnumsAndEditSelected.loadEnums(e,t,s)}exports.init=init;exports.loadEnumsGridEditData=loadEnumsGridEditData;exports.createCallList=createCallList;exports.createCallListAndShowAlertOnErrors=createCallListAndShowAlertOnErrors})(this.BX.Crm.EntityList.Panel=this.BX.Crm.EntityList.Panel||{},BX,BX.Collections,BX.Event,BX.Crm,BX.Crm.Autorun,BX.UI.EntitySelector,BX,BX.UI.Dialogs,BX);
//# sourceMappingURL=panel.bundle.map.js