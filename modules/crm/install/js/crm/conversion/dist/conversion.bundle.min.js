this.BX=this.BX||{};(function(e,t,r,i,a,l,s,n,c){"use strict";var o=new WeakMap;var u=new WeakMap;var v=new WeakMap;var d=new WeakMap;var b=function(){function e(t){var r=this;babelHelpers.classCallCheck(this,e);o.set(this,{writable:true,value:void 0});u.set(this,{writable:true,value:void 0});v.set(this,{writable:true,value:void 0});d.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,o,String(t.id));babelHelpers.classPrivateFieldSet(this,u,String(t.name));babelHelpers.classPrivateFieldSet(this,d,String(t.phrase));babelHelpers.classPrivateFieldSet(this,v,[]);if(c.Type.isArray(t.entityTypeIds)){t.entityTypeIds.forEach(function(e){babelHelpers.classPrivateFieldGet(r,v).push(Number(e))})}}babelHelpers.createClass(e,[{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,o)}},{key:"getName",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getEntityTypeIds",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"getPhrase",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}}]);return e}();function h(e,t){var r;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=f(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var a=function e(){};return{s:a,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,s=false,n;return{s:function t(){r=e[Symbol.iterator]()},n:function e(){var t=r.next();l=t.done;return t},e:function e(t){s=true;n=t},f:function e(){try{if(!l&&r.return!=null)r.return()}finally{if(s)throw n}}}}function f(e,t){if(!e)return;if(typeof e==="string")return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}function p(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}var y=new WeakMap;var g=new WeakMap;var m=function(){function e(t,r){var i=this;babelHelpers.classCallCheck(this,e);y.set(this,{writable:true,value:void 0});g.set(this,{writable:true,value:[]});babelHelpers.classPrivateFieldSet(this,y,c.Type.isNull(t)?t:String(t));if(c.Type.isArray(r)){r.forEach(function(e){if(e instanceof b){babelHelpers.classPrivateFieldGet(i,g).push(e)}else{console.error("SchemeItem is invalid in Scheme constructor. Expected instance of SchemeItem, got "+babelHelpers.typeof(e))}})}}babelHelpers.createClass(e,[{key:"getCurrentItem",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,g)||!babelHelpers.classPrivateFieldGet(this,g).length){return null}var t=this.getItemById(babelHelpers.classPrivateFieldGet(this,y));return t||babelHelpers.classPrivateFieldGet(this,g)[0]}},{key:"setCurrentItemId",value:function e(t){babelHelpers.classPrivateFieldSet(this,y,t)}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"getItemById",value:function e(t){var r=h(babelHelpers.classPrivateFieldGet(this,g)),i;try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.getId()===t){return a}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getItemForSingleEntityTypeId",value:function e(t){var r=h(babelHelpers.classPrivateFieldGet(this,g)),i;try{for(r.s();!(i=r.n()).done;){var a=i.value;var l=a.getEntityTypeIds();if(l.length===1&&Array.from(l)[0]===t){return a}}}catch(e){r.e(e)}finally{r.f()}return null}}],[{key:"create",value:function t(r){var i=[];r.items.forEach(function(e){i.push(new b(e))});return new e(r.currentItemId,i)}}]);return e}();function S(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var H=new WeakMap;var P=new WeakMap;var C=new WeakMap;var w=new WeakMap;var F=new WeakMap;var I=new WeakSet;var E=function(){function e(t){babelHelpers.classCallCheck(this,e);I.add(this);H.set(this,{writable:true,value:void 0});P.set(this,{writable:true,value:void 0});C.set(this,{writable:true,value:{}});w.set(this,{writable:true,value:void 0});F.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,w,Number(t.entityTypeId));babelHelpers.classPrivateFieldSet(this,H,S(this,I,T).call(this,t.active));babelHelpers.classPrivateFieldSet(this,P,S(this,I,T).call(this,t.enableSync));if(c.Type.isPlainObject(t.initData)){babelHelpers.classPrivateFieldSet(this,C,t.initData)}babelHelpers.classPrivateFieldSet(this,F,String(t.title))}babelHelpers.createClass(e,[{key:"externalize",value:function e(){return{entityTypeId:this.getEntityTypeId(),title:this.getTitle(),initData:this.getInitData(),active:this.isActive()?"Y":"N",enableSync:this.isEnableSync()?"Y":"N"}}},{key:"isActive",value:function e(){return babelHelpers.classPrivateFieldGet(this,H)}},{key:"setActive",value:function e(t){babelHelpers.classPrivateFieldSet(this,H,t);return this}},{key:"isEnableSync",value:function e(){return babelHelpers.classPrivateFieldGet(this,P)}},{key:"setEnableSync",value:function e(t){babelHelpers.classPrivateFieldSet(this,P,t);return this}},{key:"getInitData",value:function e(){return babelHelpers.classPrivateFieldGet(this,C)||{}}},{key:"setInitData",value:function e(t){babelHelpers.classPrivateFieldSet(this,C,t);return this}},{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,w)}},{key:"getTitle",value:function e(){return babelHelpers.classPrivateFieldGet(this,F)}},{key:"setTitle",value:function e(t){babelHelpers.classPrivateFieldSet(this,F,t);return this}}]);return e}();var T=function e(t){if(c.Type.isBoolean(t)){return t}if(c.Type.isString(t)){return t==="Y"}return Boolean(t)};function k(e,t){var r;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=G(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var a=function e(){};return{s:a,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,s=false,n;return{s:function t(){r=e[Symbol.iterator]()},n:function e(){var t=r.next();l=t.done;return t},e:function e(t){s=true;n=t},f:function e(){try{if(!l&&r.return!=null)r.return()}finally{if(s)throw n}}}}function G(e,t){if(!e)return;if(typeof e==="string")return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}function M(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}var A=new WeakMap;var B=new WeakMap;var O=new WeakMap;var N=function(){function e(t,r,i){var a=this;babelHelpers.classCallCheck(this,e);A.set(this,{writable:true,value:void 0});B.set(this,{writable:true,value:[]});O.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,A,Number(t));if(c.Type.isArray(r)){r.forEach(function(e){if(e instanceof E){babelHelpers.classPrivateFieldGet(a,B).push(e)}else{console.error("ConfigItem is invalid in Config constructor. Expected instance of ConfigItem, got "+babelHelpers.typeof(e))}})}if(i instanceof m){babelHelpers.classPrivateFieldSet(this,O,i)}else{console.error("Scheme is invalid in Config constructor. Expected instance of Scheme, got "+babelHelpers.typeof(i))}}babelHelpers.createClass(e,[{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,A)}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,B)}},{key:"getScheme",value:function e(){return babelHelpers.classPrivateFieldGet(this,O)}},{key:"updateFromSchemeItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=this.getScheme().getCurrentItem()}else{this.getScheme().setCurrentItemId(t.getId())}var r=t.getEntityTypeIds();babelHelpers.classPrivateFieldGet(this,B).forEach(function(e){var t=r.indexOf(e.getEntityTypeId())>-1;e.setEnableSync(t);e.setActive(t)});return this}},{key:"getItemByEntityTypeId",value:function e(t){var r=k(babelHelpers.classPrivateFieldGet(this,B)),i;try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.getEntityTypeId()===t){return a}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"externalize",value:function e(){var t={};this.getItems().forEach(function(e){t[BX.CrmEntityType.resolveName(e.getEntityTypeId()).toLowerCase()]=e.externalize()});return t}},{key:"updateItems",value:function e(t){var r=this;babelHelpers.classPrivateFieldSet(this,B,[]);t.forEach(function(e){babelHelpers.classPrivateFieldGet(r,B).push(new E(e))});return this}}],[{key:"create",value:function t(r,i,a){var l=[];i.forEach(function(e){l.push(new E(e))});return new e(r,l,a)}}]);return e}();function W(e,t){var r;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=R(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var a=function e(){};return{s:a,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,s=false,n;return{s:function t(){r=e[Symbol.iterator]()},n:function e(){var t=r.next();l=t.done;return t},e:function e(t){s=true;n=t},f:function e(){try{if(!l&&r.return!=null)r.return()}finally{if(s)throw n}}}}function R(e,t){if(!e)return;if(typeof e==="string")return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}function _(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}function D(){var e=babelHelpers.taggedTemplateLiteral(['<option value="','">',"</option>"]);D=function t(){return e};return e}function x(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-converter-category-selector ui-form ui-form-line">\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="crm-converter-category-selector-label ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="crm-converter-category-selector-select ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element"></select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t']);x=function t(){return e};return e}function X(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var L=new WeakMap;var U=new WeakMap;var j=new WeakMap;var Y=new WeakMap;var z=new WeakMap;var V=new WeakMap;var $=new WeakMap;var q=new WeakSet;var Q=new WeakSet;var Z=new WeakSet;var K=new WeakSet;var J=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var re=new WeakSet;var ie=new WeakSet;var ae=new WeakSet;var le=new WeakSet;var se=function(){function e(t,r,i){babelHelpers.classCallCheck(this,e);le.add(this);ae.add(this);ie.add(this);re.add(this);te.add(this);ee.add(this);J.add(this);K.add(this);Z.add(this);Q.add(this);q.add(this);L.set(this,{writable:true,value:void 0});U.set(this,{writable:true,value:void 0});j.set(this,{writable:true,value:void 0});Y.set(this,{writable:true,value:void 0});z.set(this,{writable:true,value:void 0});V.set(this,{writable:true,value:void 0});$.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,L,Number(t));if(r instanceof N){babelHelpers.classPrivateFieldSet(this,j,r)}else{console.error("Config is invalid in Converter constructor. Expected instance of Config, got "+babelHelpers.typeof(r))}babelHelpers.classPrivateFieldSet(this,Y,i!==null&&i!==void 0?i:{});babelHelpers.classPrivateFieldSet(this,z,false);babelHelpers.classPrivateFieldSet(this,V,false);babelHelpers.classPrivateFieldSet(this,U,0)}babelHelpers.createClass(e,[{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,L)}},{key:"getConfig",value:function e(){return babelHelpers.classPrivateFieldGet(this,j)}},{key:"getServiceUrl",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,Y).serviceUrl;if(!t){return null}var r={action:"convert"};this.getConfig().getItems().forEach(function(e){r[BX.CrmEntityType.resolveName(e.getEntityTypeId()).toLowerCase()]=e.isActive()?"Y":"N"});return BX.util.add_url_param(t,r)}},{key:"getOriginUrl",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Y)&&babelHelpers.classPrivateFieldGet(this,Y).hasOwnProperty("originUrl")){return String(babelHelpers.classPrivateFieldGet(this,Y).originUrl)}return null}},{key:"isRedirectToDetailPageEnabled",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Y)&&babelHelpers.classPrivateFieldGet(this,Y).hasOwnProperty("isRedirectToDetailPageEnabled")){return babelHelpers.classPrivateFieldGet(this,Y).isRedirectToDetailPageEnabled}return true}},{key:"convert",value:function e(t,r){var i=this;babelHelpers.classPrivateFieldSet(this,U,t);this.data=r;var a=babelHelpers.classPrivateFieldGet(this,j).getScheme().getCurrentItem();if(!a){console.error("Scheme is not found");return}X(this,K,ue).call(this,a).then(function(e){if(e.isCanceled){return}X(i,q,ne).call(i)}).catch(function(e){if(e){console.error(e)}})}}]);return e}();var ne=function e(){var t=this.getServiceUrl();if(!t){console.error("Convert endpoint is not specifier");return}if(babelHelpers.classPrivateFieldGet(this,z)){console.error("Another request is in progress");return}babelHelpers.classPrivateFieldSet(this,z,true);c.ajax({url:t,method:"POST",dataType:"json",data:{MODE:"CONVERT",ENTITY_ID:babelHelpers.classPrivateFieldGet(this,U),ENABLE_SYNCHRONIZATION:babelHelpers.classPrivateFieldGet(this,V)?"Y":"N",ENABLE_REDIRECT_TO_SHOW:this.isRedirectToDetailPageEnabled?"Y":"N",CONFIG:this.getConfig().externalize(),CONTEXT:this.data,ORIGIN_URL:this.getOriginUrl()},onsuccess:X(this,Q,ce).bind(this),onfailure:X(this,Z,oe).bind(this)})};var ce=function e(t){babelHelpers.classPrivateFieldSet(this,z,false);if(t.ERROR){l.MessageBox.alert(t.ERROR.MESSAGE||"Error during conversion");return}if(c.Type.isPlainObject(t.REQUIRED_ACTION)){return X(this,re,he).call(this,t.REQUIRED_ACTION)}var r=c.Type.isPlainObject(t.DATA)?t.DATA:{};if(!r){return}var i=c.Type.isString(r.URL)?r.URL:"";var a=false;if(r.IS_FINISHED&&r.IS_FINISHED==="Y"){this.data={};a=X(this,le,ye).call(this,i)}if(i!==""&&!a){BX.Crm.Page.open(i)}else if(!(a&&window.top===window));};var oe=function e(t){babelHelpers.classPrivateFieldSet(this,z,false);l.MessageBox.alert(t)};var ue=function e(t){var r=this;var i=this.getConfig();var a=[];t.getEntityTypeIds().forEach(function(e){a.push(function(){return X(r,J,ve).call(r,e)})});var l={isCanceled:false};var s=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Promise(function(a,s){if(l.isCanceled||!t[r]){a(l);return}t[r]().then(function(n){if(n.isCanceled){l.isCanceled=true}else if(n.category){var c=n.category.getEntityTypeId();var o=i.getItemByEntityTypeId(c);if(!o){s("Scheme is not correct: configItem is not found for "+c);return}var u=o.getInitData();u.categoryId=n.category.getId();o.setInitData(u)}a(e(t,++r))})})};return s(a)};var ve=function e(t){var i=this;return new Promise(function(e,a){var l=i.getConfig().getItemByEntityTypeId(t);if(!l){a("Scheme is not correct: configItem is not found for "+t);return}if(X(i,ee,de).call(i,t)){r.CategoryList.Instance.getItems(t).then(function(t){if(t.length>1){X(i,te,be).call(i,t,l.getTitle()).then(e).catch(a)}else{e({isCanceled:false,category:t[0]})}}).catch(a)}else{e({isCanceled:false,category:null})}})};var de=function e(t){return t===BX.CrmEntityType.enumeration.deal||BX.CrmEntityType.isDynamicTypeByTypeId(t)};var be=function e(t,r){return new Promise(function(e){var i=c.Tag.render(x(),c.Loc.getMessage("CRM_COMMON_CATEGORY"));var l=i.querySelector("select");t.forEach(function(e){l.appendChild(c.Tag.render(D(),e.getId(),c.Text.encode(e.getName())))});var n=new s.Popup({titleBar:c.Loc.getMessage("CRM_CONVERSION_CATEGORY_SELECTOR_TITLE",{"#ENTITY#":c.Text.encode(r)}),content:i,closeByEsc:true,closeIcon:true,buttons:[new a.Button({text:c.Loc.getMessage("CRM_COMMON_ACTION_SAVE"),color:a.ButtonColor.SUCCESS,onclick:function r(){var i=Array.from(l.selectedOptions)[0].value;n.destroy();var a=W(t),s;try{for(a.s();!(s=a.n()).done;){var c=s.value;if(c.getId()===Number(i)){e({category:c});return true}}}catch(e){a.e(e)}finally{a.f()}console.error("Selected category not found");e({isCanceled:true});return true}}),new a.Button({text:c.Loc.getMessage("CRM_COMMON_ACTION_CANCEL"),color:a.ButtonColor.LIGHT,onclick:function t(){n.destroy();e({isCanceled:true});return true}})],events:{onClose:function t(){e({isCanceled:true})}}});n.show()})};var he=function e(t){var r=String(t.NAME);var i=c.Type.isPlainObject(t.DATA)?t.DATA:{};if(r==="SYNCHRONIZE"){var a=null;if(c.Type.isArray(i.CONFIG)){a=i.CONFIG}else if(c.Type.isPlainObject(i.CONFIG)){a=Object.values(i.CONFIG)}if(a){babelHelpers.classPrivateFieldGet(this,j).updateItems(a)}X(this,ie,fe).call(this,c.Type.isArray(i.FIELD_NAMES)?i.FIELD_NAMES:[]).show();return}if(r==="CORRECT"){if(c.Type.isPlainObject(i.CHECK_ERRORS)){return}}};var fe=function e(t){var r=this;if(babelHelpers.classPrivateFieldGet(this,$)){babelHelpers.classPrivateFieldGet(this,$).setConfig(babelHelpers.classPrivateFieldGet(this,j).externalize());babelHelpers.classPrivateFieldGet(this,$).setFieldNames(t);return babelHelpers.classPrivateFieldGet(this,$)}babelHelpers.classPrivateFieldSet(this,$,BX.CrmEntityFieldSynchronizationEditor.create("crm_converter_fields_synchronizer_"+this.getEntityTypeId(),{config:babelHelpers.classPrivateFieldGet(this,j).externalize(),title:X(this,ae,pe).call(this,"dialogTitle"),fieldNames:t,legend:X(this,ae,pe).call(this,"syncEditorLegend"),fieldListTitle:X(this,ae,pe).call(this,"syncEditorFieldListTitle"),entityListTitle:X(this,ae,pe).call(this,"syncEditorEntityListTitle"),continueButton:X(this,ae,pe).call(this,"continueButton"),cancelButton:X(this,ae,pe).call(this,"cancelButton")}));babelHelpers.classPrivateFieldGet(this,$).addClosingListener(function(e,t){if(!(c.Type.isBoolean(t["isCanceled"])&&t["isCanceled"]===false)){return}babelHelpers.classPrivateFieldSet(r,V,true);babelHelpers.classPrivateFieldGet(r,j).updateItems(Object.values(babelHelpers.classPrivateFieldGet(r,$).getConfig()));X(r,q,ne).call(r)});return babelHelpers.classPrivateFieldGet(this,$)};var pe=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Y).messages){babelHelpers.classPrivateFieldGet(this,Y).messages={}}return babelHelpers.classPrivateFieldGet(this,Y).messages[t]||t};var ye=function e(t){var r=this.getEntityTypeId();var i={entityTypeId:r,entityTypeName:BX.CrmEntityType.resolveName(r),entityId:babelHelpers.classPrivateFieldGet(this,U),redirectUrl:t,isRedirected:false};var a=BX.Crm.Page.getTopSlider();if(a){i["sliderUrl"]=a.getUrl()}BX.onCustomEvent(window,"Crm.EntityConverter.Converted",[this,i]);BX.localStorage.set("onCrmEntityConvert",i,10);return i["isRedirected"]};function ge(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var me=new WeakMap;var Se=new WeakMap;var He=new WeakMap;var Pe=new WeakMap;var Ce=new WeakMap;var we=new WeakMap;var Fe=new WeakMap;var Ie=new WeakSet;var Ee=new WeakSet;var Te=new WeakSet;var ke=new WeakSet;var Ge=new WeakSet;var Me=new WeakSet;var Ae=new WeakSet;var Be=new WeakSet;var Oe=function(){function e(r,i){babelHelpers.classCallCheck(this,e);Be.add(this);Ae.add(this);Me.add(this);Ge.add(this);ke.add(this);Te.add(this);Ee.add(this);Ie.add(this);me.set(this,{writable:true,value:void 0});Se.set(this,{writable:true,value:void 0});He.set(this,{writable:true,value:void 0});Pe.set(this,{writable:true,value:void 0});Ce.set(this,{writable:true,value:void 0});we.set(this,{writable:true,value:void 0});Fe.set(this,{writable:true,value:void 0});if(r instanceof se){babelHelpers.classPrivateFieldSet(this,Ce,r)}else{console.error("Converter is invalid in SchemeSelector constructor. Expected instance of Converter, got "+babelHelpers.typeof(r))}babelHelpers.classPrivateFieldSet(this,me,Number(i.entityId));babelHelpers.classPrivateFieldSet(this,Se,document.getElementById(i.containerId));babelHelpers.classPrivateFieldSet(this,He,document.getElementById(i.buttonId));babelHelpers.classPrivateFieldSet(this,Pe,document.getElementById(i.labelId));babelHelpers.classPrivateFieldSet(this,we,"crm_conversion_scheme_selector_"+babelHelpers.classPrivateFieldGet(this,me)+"_"+c.Text.getRandom());babelHelpers.classPrivateFieldSet(this,Fe,false);if(!babelHelpers.classPrivateFieldGet(this,me)||!babelHelpers.classPrivateFieldGet(this,Se)||!babelHelpers.classPrivateFieldGet(this,He)||!babelHelpers.classPrivateFieldGet(this,Pe)||!babelHelpers.classPrivateFieldGet(this,Ce)){console.error("Error SchemeSelector initializing",this)}else{ge(this,Ie,Ne).call(this);ge(this,Ee,We).call(this)}t.EventEmitter.makeObservable(this,"BX.Crm.Conversion")}babelHelpers.createClass(e,[{key:"enableAutoConversion",value:function e(){babelHelpers.classPrivateFieldSet(this,Fe,true)}},{key:"disableAutoConversion",value:function e(){babelHelpers.classPrivateFieldSet(this,Fe,false)}}]);return e}();var Ne=function e(){var t=babelHelpers.classPrivateFieldGet(this,Ce).getConfig().getScheme().getCurrentItem();if(t){babelHelpers.classPrivateFieldGet(this,Pe).innerText=t.getPhrase()}};var We=function e(){c.Event.bind(babelHelpers.classPrivateFieldGet(this,Se),"click",ge(this,Te,Re).bind(this));c.Event.bind(babelHelpers.classPrivateFieldGet(this,He),"click",ge(this,ke,_e).bind(this))};var Re=function e(){var r=new t.BaseEvent({data:{isCanceled:false}});this.emit("SchemeSelector:onContainerClick",r);babelHelpers.classPrivateFieldGet(this,Ce).getConfig().updateFromSchemeItem();if(babelHelpers.classPrivateFieldGet(this,Fe)&&!r.getData().isCanceled){babelHelpers.classPrivateFieldGet(this,Ce).convert(babelHelpers.classPrivateFieldGet(this,me))}};var _e=function e(){ge(this,Ge,De).call(this)};var De=function e(){var t=BX.pos(babelHelpers.classPrivateFieldGet(this,Se));s.MenuManager.show({id:babelHelpers.classPrivateFieldGet(this,we),bindElement:babelHelpers.classPrivateFieldGet(this,He),items:ge(this,Ae,Xe).call(this),closeByEsc:true,cacheable:false,offsetLeft:-t["width"]})};var xe=function e(){s.MenuManager.destroy(babelHelpers.classPrivateFieldGet(this,we))};var Xe=function e(){var t=this;var r=[];babelHelpers.classPrivateFieldGet(this,Ce).getConfig().getScheme().getItems().forEach(function(e){r.push({text:c.Text.encode(e.getPhrase()),onclick:function r(){ge(t,Be,Le).call(t,e)}})});return r};var Le=function e(r){ge(this,Me,xe).call(this);babelHelpers.classPrivateFieldGet(this,Pe).innerText=r.getPhrase();babelHelpers.classPrivateFieldGet(this,Ce).getConfig().updateFromSchemeItem(r);var i=new t.BaseEvent({data:{isCanceled:false}});this.emit("SchemeSelector:onSchemeSelected",i);if(babelHelpers.classPrivateFieldGet(this,Fe)&&!i.getData().isCanceled){babelHelpers.classPrivateFieldGet(this,Ce).convert(babelHelpers.classPrivateFieldGet(this,me))}};var Ue=null;var je=new WeakMap;var Ye=function(){function e(){babelHelpers.classCallCheck(this,e);je.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,je,{})}babelHelpers.createClass(e,[{key:"initializeConverter",value:function e(t,r){var i=N.create(t,r.configItems,m.create(r.scheme));babelHelpers.classPrivateFieldGet(this,je)[t]=new se(t,i,r.params);return babelHelpers.classPrivateFieldGet(this,je)[t]}},{key:"getConverter",value:function e(t){return babelHelpers.classPrivateFieldGet(this,je)[t]||null}}],[{key:"Instance",get:function t(){if(window.top!==window&&c.Reflection.getClass("top.BX.Crm.Conversion.Manager")){return window.top.BX.Crm.Conversion.Manager.Instance}if(Ue===null){Ue=new e}return Ue}}]);return e}();var ze={Scheme:m,Config:N,Converter:se,Manager:Ye,SchemeSelector:Oe};e.Conversion=ze})(this.BX.Crm=this.BX.Crm||{},BX.Event,BX.Crm,BX.Crm.Models,BX.UI,BX.UI.Dialogs,BX.Main,BX,BX);
//# sourceMappingURL=conversion.bundle.map.js