this.BX=this.BX||{};(function(e,t,i,r,a,n,l,s,o){"use strict";function c(e,t,i){u(e,t);t.set(e,i)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var v=new WeakMap;var h=new WeakMap;var f=new WeakMap;var b=new WeakMap;var d=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);c(this,v,{writable:true,value:void 0});c(this,h,{writable:true,value:void 0});c(this,f,{writable:true,value:void 0});c(this,b,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,v,String(t.id));babelHelpers.classPrivateFieldSet(this,h,String(t.name));babelHelpers.classPrivateFieldSet(this,b,String(t.phrase));babelHelpers.classPrivateFieldSet(this,f,[]);if(o.Type.isArray(t.entityTypeIds)){t.entityTypeIds.forEach((function(e){babelHelpers.classPrivateFieldGet(i,f).push(Number(e))}))}}babelHelpers.createClass(e,[{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"getName",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}},{key:"getEntityTypeIds",value:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"getPhrase",value:function e(){return babelHelpers.classPrivateFieldGet(this,b)}}]);return e}();function p(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=y(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var a=function e(){};return{s:a,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,l=false,s;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();n=t.done;return t},e:function e(t){l=true;s=t},f:function e(){try{if(!n&&i["return"]!=null)i["return"]()}finally{if(l)throw s}}}}function y(e,t){if(!e)return;if(typeof e==="string")return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(e,t)}function g(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function m(e,t,i){w(e,t);t.set(e,i)}function w(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var C=new WeakMap;var H=new WeakMap;var S=function(){function e(t,i){var r=this;babelHelpers.classCallCheck(this,e);m(this,C,{writable:true,value:void 0});m(this,H,{writable:true,value:[]});babelHelpers.classPrivateFieldSet(this,C,o.Type.isNull(t)?t:String(t));if(o.Type.isArray(i)){i.forEach((function(e){if(e instanceof d){babelHelpers.classPrivateFieldGet(r,H).push(e)}else{console.error("SchemeItem is invalid in Scheme constructor. Expected instance of SchemeItem, got "+babelHelpers["typeof"](e))}}))}}babelHelpers.createClass(e,[{key:"getCurrentItem",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,H)||!babelHelpers.classPrivateFieldGet(this,H).length){return null}var t=this.getItemById(babelHelpers.classPrivateFieldGet(this,C));return t||babelHelpers.classPrivateFieldGet(this,H)[0]}},{key:"setCurrentItemId",value:function e(t){babelHelpers.classPrivateFieldSet(this,C,t)}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,H)}},{key:"getItemById",value:function e(t){var i=p(babelHelpers.classPrivateFieldGet(this,H)),r;try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.getId()===t){return a}}}catch(e){i.e(e)}finally{i.f()}return null}},{key:"getItemForSingleEntityTypeId",value:function e(t){var i=p(babelHelpers.classPrivateFieldGet(this,H)),r;try{for(i.s();!(r=i.n()).done;){var a=r.value;var n=a.getEntityTypeIds();if(n.length===1&&Array.from(n)[0]===t){return a}}}catch(e){i.e(e)}finally{i.f()}return null}}],[{key:"create",value:function t(i){var r=[];i.items.forEach((function(e){r.push(new d(e))}));return new e(i.currentItemId,r)}}]);return e}();function P(e,t){E(e,t);t.add(e)}function F(e,t,i){E(e,t);t.set(e,i)}function E(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function I(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var T=new WeakMap;var k=new WeakMap;var G=new WeakMap;var M=new WeakMap;var A=new WeakMap;var B=new WeakSet;var O=function(){function e(t){babelHelpers.classCallCheck(this,e);P(this,B);F(this,T,{writable:true,value:void 0});F(this,k,{writable:true,value:void 0});F(this,G,{writable:true,value:{}});F(this,M,{writable:true,value:void 0});F(this,A,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,M,Number(t.entityTypeId));babelHelpers.classPrivateFieldSet(this,T,I(this,B,N).call(this,t.active));babelHelpers.classPrivateFieldSet(this,k,I(this,B,N).call(this,t.enableSync));if(o.Type.isPlainObject(t.initData)){babelHelpers.classPrivateFieldSet(this,G,t.initData)}babelHelpers.classPrivateFieldSet(this,A,String(t.title))}babelHelpers.createClass(e,[{key:"externalize",value:function e(){return{entityTypeId:this.getEntityTypeId(),title:this.getTitle(),initData:this.getInitData(),active:this.isActive()?"Y":"N",enableSync:this.isEnableSync()?"Y":"N"}}},{key:"isActive",value:function e(){return babelHelpers.classPrivateFieldGet(this,T)}},{key:"setActive",value:function e(t){babelHelpers.classPrivateFieldSet(this,T,t);return this}},{key:"isEnableSync",value:function e(){return babelHelpers.classPrivateFieldGet(this,k)}},{key:"setEnableSync",value:function e(t){babelHelpers.classPrivateFieldSet(this,k,t);return this}},{key:"getInitData",value:function e(){return babelHelpers.classPrivateFieldGet(this,G)||{}}},{key:"setInitData",value:function e(t){babelHelpers.classPrivateFieldSet(this,G,t);return this}},{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,M)}},{key:"getTitle",value:function e(){return babelHelpers.classPrivateFieldGet(this,A)}},{key:"setTitle",value:function e(t){babelHelpers.classPrivateFieldSet(this,A,t);return this}}]);return e}();function N(e){if(o.Type.isBoolean(e)){return e}if(o.Type.isString(e)){return e==="Y"}return Boolean(e)}function W(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=R(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var a=function e(){};return{s:a,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,l=false,s;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();n=t.done;return t},e:function e(t){l=true;s=t},f:function e(){try{if(!n&&i["return"]!=null)i["return"]()}finally{if(l)throw s}}}}function R(e,t){if(!e)return;if(typeof e==="string")return _(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _(e,t)}function _(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function D(e,t,i){X(e,t);t.set(e,i)}function X(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var x=new WeakMap;var L=new WeakMap;var j=new WeakMap;var U=function(){function e(t,i,r){var a=this;babelHelpers.classCallCheck(this,e);D(this,x,{writable:true,value:void 0});D(this,L,{writable:true,value:[]});D(this,j,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,x,Number(t));if(o.Type.isArray(i)){i.forEach((function(e){if(e instanceof O){babelHelpers.classPrivateFieldGet(a,L).push(e)}else{console.error("ConfigItem is invalid in Config constructor. Expected instance of ConfigItem, got "+babelHelpers["typeof"](e))}}))}if(r instanceof S){babelHelpers.classPrivateFieldSet(this,j,r)}else{console.error("Scheme is invalid in Config constructor. Expected instance of Scheme, got "+babelHelpers["typeof"](r))}}babelHelpers.createClass(e,[{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,x)}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,L)}},{key:"getScheme",value:function e(){return babelHelpers.classPrivateFieldGet(this,j)}},{key:"updateFromSchemeItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=this.getScheme().getCurrentItem()}else{this.getScheme().setCurrentItemId(t.getId())}var i=t.getEntityTypeIds();babelHelpers.classPrivateFieldGet(this,L).forEach((function(e){var t=i.indexOf(e.getEntityTypeId())>-1;e.setEnableSync(t);e.setActive(t)}));return this}},{key:"getItemByEntityTypeId",value:function e(t){var i=W(babelHelpers.classPrivateFieldGet(this,L)),r;try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.getEntityTypeId()===t){return a}}}catch(e){i.e(e)}finally{i.f()}return null}},{key:"externalize",value:function e(){var t={};this.getItems().forEach((function(e){t[BX.CrmEntityType.resolveName(e.getEntityTypeId()).toLowerCase()]=e.externalize()}));return t}},{key:"updateItems",value:function e(t){var i=this;babelHelpers.classPrivateFieldSet(this,L,[]);t.forEach((function(e){babelHelpers.classPrivateFieldGet(i,L).push(new O(e))}));return this}}],[{key:"create",value:function t(i,r,a){var n=[];r.forEach((function(e){n.push(new O(e))}));return new e(i,n,a)}}]);return e}();var z,Y;function V(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=$(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var a=function e(){};return{s:a,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,l=false,s;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();n=t.done;return t},e:function e(t){l=true;s=t},f:function e(){try{if(!n&&i["return"]!=null)i["return"]()}finally{if(l)throw s}}}}function $(e,t){if(!e)return;if(typeof e==="string")return q(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return q(e,t)}function q(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function Q(e,t){K(e,t);t.add(e)}function Z(e,t,i){K(e,t);t.set(e,i)}function K(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function J(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ee=new WeakMap;var te=new WeakMap;var ie=new WeakMap;var re=new WeakMap;var ae=new WeakMap;var ne=new WeakMap;var le=new WeakMap;var se=new WeakSet;var oe=new WeakSet;var ce=new WeakSet;var ue=new WeakSet;var ve=new WeakSet;var he=new WeakSet;var fe=new WeakSet;var be=new WeakSet;var de=new WeakSet;var pe=new WeakSet;var ye=new WeakSet;var ge=function(){function e(t,i,r){babelHelpers.classCallCheck(this,e);Q(this,ye);Q(this,pe);Q(this,de);Q(this,be);Q(this,fe);Q(this,he);Q(this,ve);Q(this,ue);Q(this,ce);Q(this,oe);Q(this,se);Z(this,ee,{writable:true,value:void 0});Z(this,te,{writable:true,value:void 0});Z(this,ie,{writable:true,value:void 0});Z(this,re,{writable:true,value:void 0});Z(this,ae,{writable:true,value:void 0});Z(this,ne,{writable:true,value:void 0});Z(this,le,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ee,Number(t));if(i instanceof U){babelHelpers.classPrivateFieldSet(this,ie,i)}else{console.error("Config is invalid in Converter constructor. Expected instance of Config, got "+babelHelpers["typeof"](i))}babelHelpers.classPrivateFieldSet(this,re,r!==null&&r!==void 0?r:{});babelHelpers.classPrivateFieldSet(this,ae,false);babelHelpers.classPrivateFieldSet(this,ne,false);babelHelpers.classPrivateFieldSet(this,te,0)}babelHelpers.createClass(e,[{key:"getEntityTypeId",value:function e(){return babelHelpers.classPrivateFieldGet(this,ee)}},{key:"getConfig",value:function e(){return babelHelpers.classPrivateFieldGet(this,ie)}},{key:"getServiceUrl",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,re).serviceUrl;if(!t){return null}var i={action:"convert"};this.getConfig().getItems().forEach((function(e){i[BX.CrmEntityType.resolveName(e.getEntityTypeId()).toLowerCase()]=e.isActive()?"Y":"N"}));return BX.util.add_url_param(t,i)}},{key:"getOriginUrl",value:function e(){if(babelHelpers.classPrivateFieldGet(this,re)&&babelHelpers.classPrivateFieldGet(this,re).hasOwnProperty("originUrl")){return String(babelHelpers.classPrivateFieldGet(this,re).originUrl)}return null}},{key:"isRedirectToDetailPageEnabled",value:function e(){if(babelHelpers.classPrivateFieldGet(this,re)&&babelHelpers.classPrivateFieldGet(this,re).hasOwnProperty("isRedirectToDetailPageEnabled")){return babelHelpers.classPrivateFieldGet(this,re).isRedirectToDetailPageEnabled}return true}},{key:"convert",value:function e(t,i){var r=this;babelHelpers.classPrivateFieldSet(this,te,t);this.data=i;var a=babelHelpers.classPrivateFieldGet(this,ie).getScheme().getCurrentItem();if(!a){console.error("Scheme is not found");return}J(this,ue,He).call(this,a).then((function(e){if(e.isCanceled){return}J(r,se,me).call(r)}))["catch"]((function(e){if(e){console.error(e)}}))}}]);return e}();function me(){var e=this.getServiceUrl();if(!e){console.error("Convert endpoint is not specifier");return}if(babelHelpers.classPrivateFieldGet(this,ae)){console.error("Another request is in progress");return}babelHelpers.classPrivateFieldSet(this,ae,true);o.ajax({url:e,method:"POST",dataType:"json",data:{MODE:"CONVERT",ENTITY_ID:babelHelpers.classPrivateFieldGet(this,te),ENABLE_SYNCHRONIZATION:babelHelpers.classPrivateFieldGet(this,ne)?"Y":"N",ENABLE_REDIRECT_TO_SHOW:this.isRedirectToDetailPageEnabled?"Y":"N",CONFIG:this.getConfig().externalize(),CONTEXT:this.data,ORIGIN_URL:this.getOriginUrl()},onsuccess:J(this,oe,we).bind(this),onfailure:J(this,ce,Ce).bind(this)})}function we(e){babelHelpers.classPrivateFieldSet(this,ae,false);if(e.ERROR){a.MessageBox.alert(e.ERROR.MESSAGE||"Error during conversion");return}if(o.Type.isPlainObject(e.REQUIRED_ACTION)){return J(this,be,Ee).call(this,e.REQUIRED_ACTION)}var t=o.Type.isPlainObject(e.DATA)?e.DATA:{};if(!t){return}var i=o.Type.isString(t.URL)?t.URL:"";var r=false;if(t.IS_FINISHED&&t.IS_FINISHED==="Y"){this.data={};r=J(this,ye,ke).call(this,i)}if(i!==""&&!r){BX.Crm.Page.open(i)}else if(!(r&&window.top===window));}function Ce(e){babelHelpers.classPrivateFieldSet(this,ae,false);a.MessageBox.alert(e)}function He(e){var t=this;var i=this.getConfig();var r=[];e.getEntityTypeIds().forEach((function(e){r.push((function(){return J(t,ve,Se).call(t,e)}))}));var a={isCanceled:false};var n=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Promise((function(n,l){if(a.isCanceled||!t[r]){n(a);return}t[r]().then((function(s){if(s.isCanceled){a.isCanceled=true}else if(s.category){var o=s.category.getEntityTypeId();var c=i.getItemByEntityTypeId(o);if(!c){l("Scheme is not correct: configItem is not found for "+o);return}var u=c.getInitData();u.categoryId=s.category.getId();c.setInitData(u)}n(e(t,++r))}))}))};return n(r)}function Se(e){var i=this;return new Promise((function(r,a){var n=i.getConfig().getItemByEntityTypeId(e);if(!n){a("Scheme is not correct: configItem is not found for "+e);return}if(J(i,he,Pe).call(i,e)){t.CategoryList.Instance.getItems(e).then((function(e){if(e.length>1){J(i,fe,Fe).call(i,e,n.getTitle()).then(r)["catch"](a)}else{r({isCanceled:false,category:e[0]})}}))["catch"](a)}else{r({isCanceled:false,category:null})}}))}function Pe(e){return e===BX.CrmEntityType.enumeration.deal||BX.CrmEntityType.isDynamicTypeByTypeId(e)}function Fe(e,t){return new Promise((function(i){var a=o.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-converter-category-selector ui-form ui-form-line">\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="crm-converter-category-selector-label ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t<div class="crm-converter-category-selector-select ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element"></select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),o.Loc.getMessage("CRM_COMMON_CATEGORY"));var l=a.querySelector("select");e.forEach((function(e){l.appendChild(o.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(['<option value="','">',"</option>"])),e.getId(),o.Text.encode(e.getName())))}));var s=new n.Popup({titleBar:o.Loc.getMessage("CRM_CONVERSION_CATEGORY_SELECTOR_TITLE",{"#ENTITY#":o.Text.encode(t)}),content:a,closeByEsc:true,closeIcon:true,buttons:[new r.Button({text:o.Loc.getMessage("CRM_COMMON_ACTION_SAVE"),color:r.ButtonColor.SUCCESS,onclick:function t(){var r=Array.from(l.selectedOptions)[0].value;s.destroy();var a=V(e),n;try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.getId()===Number(r)){i({category:o});return true}}}catch(e){a.e(e)}finally{a.f()}console.error("Selected category not found");i({isCanceled:true});return true}}),new r.Button({text:o.Loc.getMessage("CRM_COMMON_ACTION_CANCEL"),color:r.ButtonColor.LIGHT,onclick:function e(){s.destroy();i({isCanceled:true});return true}})],events:{onClose:function e(){i({isCanceled:true})}}});s.show()}))}function Ee(e){var t=String(e.NAME);var i=o.Type.isPlainObject(e.DATA)?e.DATA:{};if(t==="SYNCHRONIZE"){var r=null;if(o.Type.isArray(i.CONFIG)){r=i.CONFIG}else if(o.Type.isPlainObject(i.CONFIG)){r=Object.values(i.CONFIG)}if(r){babelHelpers.classPrivateFieldGet(this,ie).updateItems(r)}J(this,de,Ie).call(this,o.Type.isArray(i.FIELD_NAMES)?i.FIELD_NAMES:[]).show();return}if(t==="CORRECT"){if(o.Type.isPlainObject(i.CHECK_ERRORS)){return}}}function Ie(e){var t=this;if(babelHelpers.classPrivateFieldGet(this,le)){babelHelpers.classPrivateFieldGet(this,le).setConfig(babelHelpers.classPrivateFieldGet(this,ie).externalize());babelHelpers.classPrivateFieldGet(this,le).setFieldNames(e);return babelHelpers.classPrivateFieldGet(this,le)}babelHelpers.classPrivateFieldSet(this,le,BX.CrmEntityFieldSynchronizationEditor.create("crm_converter_fields_synchronizer_"+this.getEntityTypeId(),{config:babelHelpers.classPrivateFieldGet(this,ie).externalize(),title:J(this,pe,Te).call(this,"dialogTitle"),fieldNames:e,legend:J(this,pe,Te).call(this,"syncEditorLegend"),fieldListTitle:J(this,pe,Te).call(this,"syncEditorFieldListTitle"),entityListTitle:J(this,pe,Te).call(this,"syncEditorEntityListTitle"),continueButton:J(this,pe,Te).call(this,"continueButton"),cancelButton:J(this,pe,Te).call(this,"cancelButton")}));babelHelpers.classPrivateFieldGet(this,le).addClosingListener((function(e,i){if(!(o.Type.isBoolean(i["isCanceled"])&&i["isCanceled"]===false)){return}babelHelpers.classPrivateFieldSet(t,ne,true);babelHelpers.classPrivateFieldGet(t,ie).updateItems(Object.values(babelHelpers.classPrivateFieldGet(t,le).getConfig()));J(t,se,me).call(t)}));return babelHelpers.classPrivateFieldGet(this,le)}function Te(e){if(!babelHelpers.classPrivateFieldGet(this,re).messages){babelHelpers.classPrivateFieldGet(this,re).messages={}}return babelHelpers.classPrivateFieldGet(this,re).messages[e]||e}function ke(e){var t=this.getEntityTypeId();var i={entityTypeId:t,entityTypeName:BX.CrmEntityType.resolveName(t),entityId:babelHelpers.classPrivateFieldGet(this,te),redirectUrl:e,isRedirected:false};var r=BX.Crm.Page.getTopSlider();if(r){i["sliderUrl"]=r.getUrl()}BX.onCustomEvent(window,"Crm.EntityConverter.Converted",[this,i]);BX.localStorage.set("onCrmEntityConvert",i,10);this.getConfig().getItems().forEach((function(e){if(e.isActive()){l.EventEmitter.emit("Crm.EntityConverter.SingleConverted",{entityTypeName:BX.CrmEntityType.resolveName(e.getEntityTypeId())})}}));return i["isRedirected"]}function Ge(e,t){Ae(e,t);t.add(e)}function Me(e,t,i){Ae(e,t);t.set(e,i)}function Ae(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Be(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Oe=new WeakMap;var Ne=new WeakMap;var We=new WeakMap;var Re=new WeakMap;var _e=new WeakMap;var De=new WeakMap;var Xe=new WeakMap;var xe=new WeakSet;var Le=new WeakSet;var je=new WeakSet;var Ue=new WeakSet;var ze=new WeakSet;var Ye=new WeakSet;var Ve=new WeakSet;var $e=new WeakSet;var qe=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Ge(this,$e);Ge(this,Ve);Ge(this,Ye);Ge(this,ze);Ge(this,Ue);Ge(this,je);Ge(this,Le);Ge(this,xe);Me(this,Oe,{writable:true,value:void 0});Me(this,Ne,{writable:true,value:void 0});Me(this,We,{writable:true,value:void 0});Me(this,Re,{writable:true,value:void 0});Me(this,_e,{writable:true,value:void 0});Me(this,De,{writable:true,value:void 0});Me(this,Xe,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,_e,t);babelHelpers.classPrivateFieldSet(this,Oe,Number(i.entityId));babelHelpers.classPrivateFieldSet(this,Ne,document.getElementById(i.containerId));babelHelpers.classPrivateFieldSet(this,We,document.getElementById(i.buttonId));babelHelpers.classPrivateFieldSet(this,Re,document.getElementById(i.labelId));babelHelpers.classPrivateFieldSet(this,De,"crm_conversion_scheme_selector_"+babelHelpers.classPrivateFieldGet(this,Oe)+"_"+o.Text.getRandom());babelHelpers.classPrivateFieldSet(this,Xe,false);if(!babelHelpers.classPrivateFieldGet(this,Oe)||!babelHelpers.classPrivateFieldGet(this,Ne)||!babelHelpers.classPrivateFieldGet(this,We)||!babelHelpers.classPrivateFieldGet(this,Re)||!babelHelpers.classPrivateFieldGet(this,_e)){console.error("Error SchemeSelector initializing",this)}else{Be(this,xe,Qe).call(this);Be(this,Le,Ze).call(this)}l.EventEmitter.makeObservable(this,"BX.Crm.Conversion")}babelHelpers.createClass(e,[{key:"enableAutoConversion",value:function e(){babelHelpers.classPrivateFieldSet(this,Xe,true)}},{key:"disableAutoConversion",value:function e(){babelHelpers.classPrivateFieldSet(this,Xe,false)}}]);return e}();function Qe(){var e=babelHelpers.classPrivateFieldGet(this,_e).getConfig().getScheme().getCurrentItem();if(e){babelHelpers.classPrivateFieldGet(this,Re).innerText=e.getPhrase()}}function Ze(){o.Event.bind(babelHelpers.classPrivateFieldGet(this,Ne),"click",Be(this,je,Ke).bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,We),"click",Be(this,Ue,Je).bind(this))}function Ke(){var e=new l.BaseEvent({data:{isCanceled:false}});this.emit("SchemeSelector:onContainerClick",e);babelHelpers.classPrivateFieldGet(this,_e).getConfig().updateFromSchemeItem();if(babelHelpers.classPrivateFieldGet(this,Xe)&&!e.getData().isCanceled){babelHelpers.classPrivateFieldGet(this,_e).convert(babelHelpers.classPrivateFieldGet(this,Oe))}}function Je(){Be(this,ze,et).call(this)}function et(){var e=BX.pos(babelHelpers.classPrivateFieldGet(this,Ne));n.MenuManager.show({id:babelHelpers.classPrivateFieldGet(this,De),bindElement:babelHelpers.classPrivateFieldGet(this,We),items:Be(this,Ve,it).call(this),closeByEsc:true,cacheable:false,offsetLeft:-e["width"]})}function tt(){n.MenuManager.destroy(babelHelpers.classPrivateFieldGet(this,De))}function it(){var e=this;var t=[];babelHelpers.classPrivateFieldGet(this,_e).getConfig().getScheme().getItems().forEach((function(i){t.push({text:o.Text.encode(i.getPhrase()),onclick:function t(){Be(e,$e,rt).call(e,i)}})}));return t}function rt(e){Be(this,Ye,tt).call(this);babelHelpers.classPrivateFieldGet(this,Re).innerText=e.getPhrase();babelHelpers.classPrivateFieldGet(this,_e).getConfig().updateFromSchemeItem(e);var t=new l.BaseEvent({data:{isCanceled:false}});this.emit("SchemeSelector:onSchemeSelected",t);if(babelHelpers.classPrivateFieldGet(this,Xe)&&!t.getData().isCanceled){babelHelpers.classPrivateFieldGet(this,_e).convert(babelHelpers.classPrivateFieldGet(this,Oe))}}function at(e,t,i){nt(e,t);t.set(e,i)}function nt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var lt=null;var st=new WeakMap;var ot=function(){function e(){babelHelpers.classCallCheck(this,e);at(this,st,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,st,{})}babelHelpers.createClass(e,[{key:"initializeConverter",value:function e(t,i){var r=U.create(t,i.configItems,S.create(i.scheme));babelHelpers.classPrivateFieldGet(this,st)[t]=new ge(t,r,i.params);return babelHelpers.classPrivateFieldGet(this,st)[t]}},{key:"getConverter",value:function e(t){return babelHelpers.classPrivateFieldGet(this,st)[t]||null}}],[{key:"Instance",get:function t(){if(window.top!==window&&o.Reflection.getClass("top.BX.Crm.Conversion.Manager")){return window.top.BX.Crm.Conversion.Manager.Instance}if(lt===null){lt=new e}return lt}}]);return e}();var ct={Scheme:S,Config:U,Converter:ge,Manager:ot,SchemeSelector:qe};e.Conversion=ct})(this.BX.Crm=this.BX.Crm||{},BX.Crm,BX.Crm.Models,BX.UI,BX.UI.Dialogs,BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=conversion.bundle.map.js