{"version":3,"file":"conversion.bundle.js","sources":["../src/scheme-item.js","../src/scheme.js","../src/config-item.js","../src/config.js","../src/converter.js","../src/scheme-selector.js","../src/manager.js","../src/index.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport type SchemeItemData = {\n\tid: string,\n\tname: string,\n\tentityTypeIds: number[],\n\tphrase: string,\n\tavailabilityLock?: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class SchemeItem\n{\n\t#id: string;\n\t#name: string;\n\t#entityTypeIds: number[];\n\t#phrase: string;\n\t#availabilityLock: string;\n\n\tconstructor(params: SchemeItemData)\n\t{\n\t\tthis.#id = String(params.id);\n\t\tthis.#name = String(params.name);\n\t\tthis.#phrase = String(params.phrase);\n\t\tthis.#availabilityLock = String(params.availabilityLock);\n\n\t\tthis.#entityTypeIds = [];\n\t\tif (Type.isArray(params.entityTypeIds))\n\t\t{\n\t\t\tparams.entityTypeIds.forEach((entityTypeId) => {\n\t\t\t\tthis.#entityTypeIds.push(Number(entityTypeId));\n\t\t\t});\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.#name;\n\t}\n\n\tgetEntityTypeIds(): number[]\n\t{\n\t\treturn this.#entityTypeIds;\n\t}\n\n\tgetPhrase(): string\n\t{\n\t\treturn this.#phrase;\n\t}\n\n\tgetAvailabilityLock(): string\n\t{\n\t\treturn this.#availabilityLock;\n\t}\n}\n","import type { SchemeItemData } from \"./scheme-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Type } from \"main.core\";\n\nexport type SchemeData = {\n\tcurrentItemId: string,\n\titems: SchemeItemData[],\n}\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Scheme\n{\n\t#currentItemId: string;\n\t#items: SchemeItem[] = [];\n\n\tconstructor(currentItemId: string|null, items: SchemeItem[])\n\t{\n\t\tthis.#currentItemId = Type.isNull(currentItemId) ? currentItemId : String(currentItemId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof SchemeItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'SchemeItem is invalid in Scheme constructor. Expected instance of SchemeItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic create(params: SchemeData)\n\t{\n\t\tconst schemeItems = [];\n\t\tparams.items.forEach((item: SchemeItemData) => {\n\t\t\tschemeItems.push(new SchemeItem(item));\n\t\t});\n\n\t\treturn new Scheme(params.currentItemId, schemeItems);\n\t}\n\n\tgetCurrentItem(): ?SchemeItem\n\t{\n\t\tif (!this.#items || !this.#items.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst item = this.getItemById(this.#currentItemId);\n\n\t\treturn item || this.#items[0];\n\t}\n\n\tsetCurrentItemId(currentItemId: string)\n\t{\n\t\tthis.#currentItemId = currentItemId;\n\t}\n\n\tgetItems(): SchemeItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetItemById(itemId: string): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getId() === itemId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetItemForSingleEntityTypeId(entityTypeId: number): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tconst entityTypeIds = item.getEntityTypeIds();\n\t\t\tif (entityTypeIds.length === 1 && Array.from(entityTypeIds)[0] === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Type } from \"main.core\";\n\nexport type ConfigItemData = {\n\tentityTypeId: number,\n\tactive: boolean,\n\tenableSync: boolean,\n\tinitData: Object,\n\ttitle: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class ConfigItem\n{\n\t#active: boolean;\n\t#enableSync: boolean;\n\t#initData: Object = {};\n\t#entityTypeId: number;\n\t#title: string;\n\n\tconstructor(params: ConfigItemData)\n\t{\n\t\tthis.#entityTypeId = Number(params.entityTypeId);\n\t\tthis.#active = this.#internalizeBooleanValue(params.active);\n\t\tthis.#enableSync = this.#internalizeBooleanValue(params.enableSync);\n\t\tif (Type.isPlainObject(params.initData))\n\t\t{\n\t\t\tthis.#initData = params.initData;\n\t\t}\n\t\tthis.#title = String(params.title);\n\t}\n\n\t#internalizeBooleanValue(value: any): boolean\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\tif (Type.isString(value))\n\t\t{\n\t\t\treturn (value === 'Y');\n\t\t}\n\n\t\treturn Boolean(value);\n\t}\n\n\texternalize(): Object\n\t{\n\t\treturn {\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\ttitle: this.getTitle(),\n\t\t\tinitData: this.getInitData(),\n\t\t\tactive: this.isActive() ? \"Y\" : \"N\",\n\t\t\tenableSync: this.isEnableSync() ? \"Y\" : \"N\",\n\t\t};\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.#active;\n\t}\n\n\tsetActive(active: boolean): ConfigItem\n\t{\n\t\tthis.#active = active;\n\n\t\treturn this;\n\t}\n\n\tisEnableSync(): boolean\n\t{\n\t\treturn this.#enableSync;\n\t}\n\n\tsetEnableSync(enableSync: boolean): ConfigItem\n\t{\n\t\tthis.#enableSync = enableSync;\n\n\t\treturn this;\n\t}\n\n\tgetInitData(): Object\n\t{\n\t\treturn this.#initData || {};\n\t}\n\n\tsetInitData(data: Object): ConfigItem\n\t{\n\t\tthis.#initData = data;\n\n\t\treturn this;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tsetTitle(title: string): ConfigItem\n\t{\n\t\tthis.#title = title;\n\n\t\treturn this;\n\t}\n}\n","import type { ConfigItemData } from \"./config-item\";\nimport { ConfigItem } from \"./config-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Scheme } from \"./scheme\";\nimport { Type } from \"main.core\";\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Config\n{\n\t#entityTypeId: number;\n\t#items: ConfigItem[] = [];\n\t#scheme: Scheme;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\titems: ConfigItem[],\n\t\tscheme: Scheme\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof ConfigItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'ConfigItem is invalid in Config constructor. Expected instance of ConfigItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (scheme instanceof Scheme)\n\t\t{\n\t\t\tthis.#scheme = scheme;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Scheme is invalid in Config constructor. Expected instance of Scheme, got ' + (typeof scheme));\n\t\t}\n\t}\n\n\tstatic create(entityTypeId: number, items: ConfigItemData[], scheme: Scheme)\n\t{\n\t\tconst configItems = [];\n\t\titems.forEach((item: ConfigItemData) => {\n\t\t\tconfigItems.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn new Config(entityTypeId, configItems, scheme);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetItems(): ConfigItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetScheme(): Scheme\n\t{\n\t\treturn this.#scheme;\n\t}\n\n\tupdateFromSchemeItem(schemeItem: SchemeItem = null): Config\n\t{\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tschemeItem = this.getScheme().getCurrentItem();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getScheme().setCurrentItemId(schemeItem.getId());\n\t\t}\n\t\tconst activeEntityTypeIds = schemeItem.getEntityTypeIds();\n\n\t\tthis.#items.forEach((item) => {\n\t\t\tconst isActive = activeEntityTypeIds.indexOf(item.getEntityTypeId()) > -1;\n\t\t\titem.setEnableSync(isActive);\n\t\t\titem.setActive(isActive);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetItemByEntityTypeId(entityTypeId: number): ?ConfigItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getEntityTypeId() === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\texternalize(): Object\n\t{\n\t\tconst data = {};\n\n\t\tthis.getItems().forEach((item) => {\n\t\t\tdata[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.externalize();\n\t\t});\n\n\t\treturn data;\n\t}\n\n\tupdateItems(items: ConfigItemData[]): self\n\t{\n\t\tthis.#items = [];\n\t\titems.forEach((item) => {\n\t\t\tthis.#items.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn this;\n\t}\n}\n","import { CategoryList } from 'crm.category-list';\nimport { CategoryModel } from 'crm.category-model';\nimport { ajax as Ajax, Loc, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport 'ui.forms';\nimport { Config } from './config';\nimport type { ConfigItemData } from './config-item';\nimport { ConfigItem } from './config-item';\nimport { SchemeItem } from './scheme-item';\n\ndeclare type CategorySelectResult = {\n\tisCanceled?: boolean,\n\tcategory?: CategoryModel|null,\n};\n\ndeclare type CollectAdditionalDataResult = {\n\tisCanceled: boolean,\n};\n\nexport type ConverterParams = {\n\tserviceUrl: string,\n\toriginUrl: string,\n\tisRedirectToDetailPageEnabled?: boolean,\n\tmessages: Object<string, string>\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Converter\n{\n\t#entityTypeId: number;\n\t#entityId: number;\n\t#config: Config;\n\t#params: ConverterParams;\n\t#isProgress: boolean;\n\t#isSynchronisationAllowed: boolean;\n\t#fieldsSynchronizer: BX.CrmEntityFieldSynchronizationEditor|null;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\tconfig: Config,\n\t\tparams?: ConverterParams,\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\t\tif (config instanceof Config)\n\t\t{\n\t\t\tthis.#config = config;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Config is invalid in Converter constructor. Expected instance of Config, got ' + (typeof config));\n\t\t}\n\t\tthis.#params = params ?? {};\n\n\t\tthis.#isProgress = false;\n\t\tthis.#isSynchronisationAllowed = false;\n\t\tthis.#entityId = 0;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\tgetServiceUrl()\n\t{\n\t\tlet serviceUrl = this.#params.serviceUrl;\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst additionalParams = {\n\t\t\taction: \"convert\",\n\t\t};\n\n\t\tthis.getConfig().getItems().forEach((item: ConfigItem) => {\n\t\t\tadditionalParams[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.isActive() ? \"Y\" : \"N\";\n\t\t});\n\n\t\treturn BX.util.add_url_param(serviceUrl, additionalParams);\n\t}\n\n\tgetOriginUrl(): ?string\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"originUrl\"))\n\t\t{\n\t\t\treturn String(this.#params.originUrl);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisRedirectToDetailPageEnabled(): boolean\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"isRedirectToDetailPageEnabled\"))\n\t\t{\n\t\t\treturn this.#params.isRedirectToDetailPageEnabled;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tconvert(entityId: number, data?: Object): void\n\t{\n\t\tthis.#entityId = entityId;\n\t\tthis.data = data;\n\t\tconst schemeItem = this.#config.getScheme().getCurrentItem();\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tconsole.error('Scheme is not found');\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isStringFilled(schemeItem.getAvailabilityLock()))\n\t\t{\n\t\t\teval(schemeItem.getAvailabilityLock());\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#collectAdditionalData(schemeItem).then((result: CollectAdditionalDataResult) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#request();\n\n\t\t}).catch((error) => {\n\t\t\tif (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t#request(): void\n\t{\n\t\tconst serviceUrl = this.getServiceUrl();\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\tconsole.error('Convert endpoint is not specifier');\n\t\t\treturn;\n\t\t}\n\t\tif (this.#isProgress)\n\t\t{\n\t\t\tconsole.error('Another request is in progress');\n\t\t\treturn;\n\t\t}\n\t\tthis.#isProgress = true;\n\t\tAjax({\n\t\t\turl: serviceUrl,\n\t\t\tmethod: \"POST\",\n\t\t\tdataType: \"json\",\n\t\t\tdata:\n\t\t\t\t{\n\t\t\t\t\t\"MODE\": \"CONVERT\",\n\t\t\t\t\t\"ENTITY_ID\": this.#entityId,\n\t\t\t\t\t\"ENABLE_SYNCHRONIZATION\": this.#isSynchronisationAllowed ? \"Y\" : \"N\",\n\t\t\t\t\t\"ENABLE_REDIRECT_TO_SHOW\": this.isRedirectToDetailPageEnabled ? \"Y\" : \"N\",\n\t\t\t\t\t\"CONFIG\": this.getConfig().externalize(),\n\t\t\t\t\t\"CONTEXT\": this.data,\n\t\t\t\t\t\"ORIGIN_URL\": this.getOriginUrl()\n\t\t\t\t},\n\t\t\tonsuccess: this.#onRequestSuccess.bind(this),\n\t\t\tonfailure: this.#onRequestError.bind(this),\n\t\t});\n\t}\n\n\t#onRequestSuccess(response)\n\t{\n\t\t// todo return promise\n\t\tthis.#isProgress = false;\n\t\tif (response.ERROR)\n\t\t{\n\t\t\tMessageBox.alert(response.ERROR.MESSAGE || \"Error during conversion\");\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isPlainObject(response.REQUIRED_ACTION))\n\t\t{\n\t\t\treturn this.#processRequiredAction(response.REQUIRED_ACTION);\n\t\t}\n\n\t\tconst data = Type.isPlainObject(response.DATA) ? response.DATA : {};\n\t\tif (!data)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst redirectUrl = Type.isString(data.URL) ? data.URL : \"\";\n\t\tlet isRedirected = false;\n\t\tif (data.IS_FINISHED && data.IS_FINISHED === \"Y\")\n\t\t{\n\t\t\tthis.data = {};\n\n\t\t\tisRedirected = this.#emitConvertedEvent(redirectUrl);\n\t\t}\n\n\t\tif(redirectUrl !== \"\" && !isRedirected)\n\t\t{\n\t\t\tBX.Crm.Page.open(redirectUrl);\n\t\t}\n\t\telse if(!(isRedirected && window.top === window))\n\t\t{\n\t\t\t// window.location.reload();\n\t\t}\n\t}\n\n\t#onRequestError(error: string)\n\t{\n\t\tthis.#isProgress = false;\n\t\tMessageBox.alert(error);\n\t}\n\n\t#collectAdditionalData(schemeItem: SchemeItem): Promise<CollectAdditionalDataResult,string>\n\t{\n\t\tconst config = this.getConfig();\n\n\t\tconst promises = [];\n\n\t\tschemeItem.getEntityTypeIds().forEach((entityTypeId) => {\n\t\t\tpromises.push(() => {\n\t\t\t\treturn this.#getCategoryForEntityTypeId(entityTypeId);\n\t\t\t});\n\t\t});\n\n\t\tlet result: CollectAdditionalDataResult = {\n\t\t\tisCanceled: false,\n\t\t};\n\t\tconst promiseIterator = ((promises: Array, index: number = 0) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (result.isCanceled || !promises[index])\n\t\t\t\t{\n\t\t\t\t\tresolve(result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpromises[index]().then((categoryResult: CategorySelectResult) => {\n\t\t\t\t\tif (categoryResult.isCanceled)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.isCanceled = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (categoryResult.category)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityTypeId = categoryResult.category.getEntityTypeId();\n\t\t\t\t\t\tconst configItem = config.getItemByEntityTypeId(entityTypeId);\n\t\t\t\t\t\tif (!configItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst initData = configItem.getInitData();\n\t\t\t\t\t\tinitData.categoryId = categoryResult.category.getId();\n\t\t\t\t\t\tconfigItem.setInitData(initData);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(promiseIterator(promises, ++index));\n\t\t\t\t});\n\t\t\t})\n\t\t});\n\n\t\treturn promiseIterator(promises);\n\t}\n\n\t#getCategoryForEntityTypeId(entityTypeId): Promise<CategorySelectResult, string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst configItem = this.getConfig().getItemByEntityTypeId(entityTypeId);\n\t\t\tif (!configItem)\n\t\t\t{\n\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.#isNeedToLoadCategories(entityTypeId))\n\t\t\t{\n\t\t\t\tCategoryList.Instance.getItems(entityTypeId).then((categories: CategoryModel[]) => {\n\t\t\t\t\tif (categories.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showCategorySelector(categories, configItem.getTitle()).then(resolve).catch(reject);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tisCanceled: false,\n\t\t\t\t\t\t\tcategory: categories[0],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}).catch(reject);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve({isCanceled:false, category:null});\n\t\t\t}\n\t\t});\n\t}\n\n\t#isNeedToLoadCategories(entityTypeId: number): boolean\n\t{\n\t\t// todo pass isCategoriesEnabled from backend\n\t\treturn (\n\t\t\tentityTypeId === BX.CrmEntityType.enumeration.deal\n\t\t\t|| BX.CrmEntityType.isDynamicTypeByTypeId(entityTypeId)\n\t\t);\n\t}\n\n\t#showCategorySelector(categories: CategoryModel[], title: string): Promise<CategorySelectResult,string>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst categorySelectorContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"crm-converter-category-selector ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"crm-converter-category-selector-label ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage(\"CRM_COMMON_CATEGORY\")}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"crm-converter-category-selector-select ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\"></select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = categorySelectorContent.querySelector('select');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tselect.appendChild(Tag.render`<option value=\"${category.getId()}\">${Text.encode(category.getName())}</option>`);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: Loc.getMessage(\"CRM_CONVERSION_CATEGORY_SELECTOR_TITLE\", {\n\t\t\t\t\t'#ENTITY#': Text.encode(title),\n\t\t\t\t}),\n\t\t\t\tcontent: categorySelectorContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_SAVE\"),\n\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tconst value = Array.from(select.selectedOptions)[0].value;\n\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tfor (const category of categories)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (category.getId() === Number(value))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tresolve({category});\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconsole.error('Selected category not found');\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_CANCEL\"),\n\t\t\t\t\t\tcolor: ButtonColor.LIGHT,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\t#processRequiredAction(action: Object): void\n\t{\n\t\tconst name = String(action.NAME);\n\t\tconst data = Type.isPlainObject(action.DATA) ? action.DATA : {};\n\n\t\tif(name === \"SYNCHRONIZE\")\n\t\t{\n\t\t\tlet newConfig: ConfigItemData[]|null = null;\n\t\t\tif (Type.isArray(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = data.CONFIG;\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = Object.values(data.CONFIG);\n\t\t\t}\n\n\t\t\tif (newConfig)\n\t\t\t{\n\t\t\t\tthis.#config.updateItems(newConfig);\n\t\t\t}\n\n\t\t\tthis.#getFieldsSynchronizer(Type.isArray(data.FIELD_NAMES) ? data.FIELD_NAMES : []).show();\n\n\t\t\treturn;\n\t\t}\n\t\tif(name === \"CORRECT\")\n\t\t{\n\t\t\tif(Type.isPlainObject(data.CHECK_ERRORS))\n\t\t\t{\n\t\t\t\t// todo this is actual for leads only.\n\t\t\t\t// this.openEntityEditorDialog(\n\t\t\t\t// \t{\n\t\t\t\t// \t\ttitle: manager ? manager.getMessage(\"checkErrorTitle\") : null,\n\t\t\t\t// \t\thelpData: { text: manager.getMessage(\"checkErrorHelp\"), code: manager.getMessage(\"checkErrorHelpArticleCode\") },\n\t\t\t\t// \t\tfieldNames: Object.keys(checkErrors),\n\t\t\t\t// \t\tinitData: BX.prop.getObject(data, \"EDITOR_INIT_DATA\", null),\n\t\t\t\t// \t\tcontext: BX.prop.getObject(data, \"CONTEXT\", null)\n\t\t\t\t// \t}\n\t\t\t\t// );\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t#getFieldsSynchronizer(fieldNames: string[])\n\t{\n\t\tif (this.#fieldsSynchronizer)\n\t\t{\n\t\t\tthis.#fieldsSynchronizer.setConfig(this.#config.externalize());\n\t\t\tthis.#fieldsSynchronizer.setFieldNames(fieldNames);\n\n\t\t\treturn this.#fieldsSynchronizer;\n\t\t}\n\n\t\tthis.#fieldsSynchronizer = BX.CrmEntityFieldSynchronizationEditor.create(\n\t\t\t\"crm_converter_fields_synchronizer_\" + this.getEntityTypeId(),\n\t\t\t{\n\t\t\t\tconfig: this.#config.externalize(),\n\t\t\t\ttitle: this.#getMessage(\"dialogTitle\"),\n\t\t\t\tfieldNames: fieldNames,\n\t\t\t\tlegend: this.#getMessage(\"syncEditorLegend\"),\n\t\t\t\tfieldListTitle: this.#getMessage(\"syncEditorFieldListTitle\"),\n\t\t\t\tentityListTitle: this.#getMessage(\"syncEditorEntityListTitle\"),\n\t\t\t\tcontinueButton: this.#getMessage(\"continueButton\"),\n\t\t\t\tcancelButton: this.#getMessage(\"cancelButton\"),\n\t\t\t}\n\t\t);\n\t\tthis.#fieldsSynchronizer.addClosingListener((sender, args) => {\n\t\t\tif(!(Type.isBoolean(args[\"isCanceled\"]) && args[\"isCanceled\"] === false))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#isSynchronisationAllowed = true;\n\t\t\tthis.#config.updateItems(Object.values(this.#fieldsSynchronizer.getConfig()));\n\t\t\tthis.#request();\n\t\t});\n\n\t\treturn this.#fieldsSynchronizer;\n\t}\n\n\t#getMessage(phraseId): string\n\t{\n\t\tif (!this.#params.messages)\n\t\t{\n\t\t\tthis.#params.messages = {};\n\t\t}\n\t\treturn this.#params.messages[phraseId] || phraseId;\n\t}\n\n\t#emitConvertedEvent(redirectUrl): boolean\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\n\t\tconst eventArgs = {\n\t\t\tentityTypeId,\n\t\t\tentityTypeName: BX.CrmEntityType.resolveName(entityTypeId),\n\t\t\tentityId: this.#entityId,\n\t\t\tredirectUrl,\n\t\t\tisRedirected: false,\n\t\t};\n\n\t\tvar current = BX.Crm.Page.getTopSlider();\n\t\tif(current)\n\t\t{\n\t\t\teventArgs[\"sliderUrl\"] = current.getUrl();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"Crm.EntityConverter.Converted\", [ this, eventArgs ]);\n\t\tBX.localStorage.set(\"onCrmEntityConvert\", eventArgs, 10);\n\n\t\tthis.getConfig().getItems().forEach((item) => {\n\t\t\tif (item.isActive())\n\t\t\t{\n\t\t\t\tEventEmitter.emit('Crm.EntityConverter.SingleConverted', {\n\t\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(item.getEntityTypeId()),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn eventArgs[\"isRedirected\"];\n\t}\n}\n","import { Event, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuManager } from 'main.popup';\nimport { Converter } from './converter';\nimport { SchemeItem } from './scheme-item';\n\n/**\n * @memberOf BX.Crm.Conversion\n * @mixes EventEmitter\n */\nexport class SchemeSelector\n{\n\t#entityId: number;\n\t#container: HTMLElement;\n\t#menuButton: HTMLElement;\n\t#label: HTMLElement;\n\t#converter: Converter;\n\t#menuId: string;\n\t#isAutoConversionEnabled: boolean;\n\n\tconstructor(\n\t\tconverter: Converter,\n\t\tparams: {\n\t\t\tentityId: number,\n\t\t\tcontainerId: string,\n\t\t\tbuttonId: string,\n\t\t\tlabelId: string,\n\t\t}\n\t) {\n\t\tthis.#converter = converter;\n\t\tthis.#entityId = Number(params.entityId);\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tthis.#menuButton = document.getElementById(params.buttonId);\n\t\tthis.#label = document.getElementById(params.labelId);\n\t\tthis.#menuId = 'crm_conversion_scheme_selector_' + this.#entityId + '_' + Text.getRandom();\n\t\tthis.#isAutoConversionEnabled = false;\n\n\t\tif (!this.#entityId || !this.#container || !this.#menuButton || !this.#label || !this.#converter)\n\t\t{\n\t\t\tconsole.error('Error SchemeSelector initializing', this);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initUI();\n\t\t\tthis.#bindEvents();\n\t\t}\n\n\t\tEventEmitter.makeObservable(this, 'BX.Crm.Conversion');\n\t}\n\n\tenableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = true;\n\t}\n\n\tdisableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = false;\n\t}\n\n\t#initUI()\n\t{\n\t\tconst currentSchemeItem: SchemeItem|null = this.#converter.getConfig().getScheme().getCurrentItem();\n\t\tif (currentSchemeItem)\n\t\t{\n\t\t\tthis.#label.innerText = currentSchemeItem.getPhrase();\n\t\t}\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(this.#container, \"click\", this.#handleContainerClick.bind(this));\n\t\tEvent.bind(this.#menuButton, \"click\", this.#handleMenuButtonClick.bind(this));\n\t}\n\n\t#handleContainerClick()\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onContainerClick', event);\n\t\tthis.#converter.getConfig().updateFromSchemeItem();\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n\n\t#handleMenuButtonClick()\n\t{\n\t\tthis.#showMenu();\n\t}\n\n\t#showMenu()\n\t{\n\t\tconst anchorPos = BX.pos(this.#container);\n\n\t\tMenuManager.show({\n\t\t\tid: this.#menuId,\n\t\t\tbindElement: this.#menuButton,\n\t\t\titems: this.#getMenuItems(),\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\toffsetLeft: -anchorPos['width'],\n\t\t})\n\t}\n\n\t#closeMenu()\n\t{\n\t\tMenuManager.destroy(this.#menuId);\n\t}\n\n\t#getMenuItems()\n\t{\n\t\tconst items = [];\n\n\t\tthis.#converter.getConfig().getScheme().getItems().forEach((item: SchemeItem) => {\n\t\t\titems.push({\n\t\t\t\ttext: Text.encode(item.getPhrase()),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#handleItemClick(item);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#handleItemClick(item: SchemeItem)\n\t{\n\t\tthis.#closeMenu();\n\t\tthis.#label.innerText = item.getPhrase();\n\t\tthis.#converter.getConfig().updateFromSchemeItem(item);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onSchemeSelected', event);\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n}\n","import type { ConverterParams } from \"./converter\";\nimport { Converter } from \"./converter\";\nimport { Config } from \"./config\";\nimport type { SchemeData } from \"./scheme\";\nimport { Scheme } from \"./scheme\";\nimport { Reflection } from \"main.core\";\nimport type { ConfigItemData } from \"./config-item\";\n\nlet instance = null;\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Manager\n{\n\t#converters: Object<number, Converter>;\n\n\tconstructor() {\n\t\tthis.#converters = {};\n\t}\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.Conversion.Manager'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.Conversion.Manager.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitializeConverter(\n\t\tentityTypeId: number,\n\t\tparams: {\n\t\t\tconfigItems: ConfigItemData[],\n\t\t\tscheme: SchemeData,\n\t\t\tparams: ConverterParams,\n\t\t}\n\t): Converter\n\t{\n\t\tconst config = Config.create(entityTypeId, params.configItems, Scheme.create(params.scheme));\n\n\t\tthis.#converters[entityTypeId] = new Converter(entityTypeId, config, params.params);\n\n\t\treturn this.#converters[entityTypeId];\n\t}\n\n\tgetConverter(entityTypeId: number): ?Converter\n\t{\n\t\treturn this.#converters[entityTypeId] || null;\n\t}\n}\n","import {Scheme} from './scheme';\nimport {SchemeSelector} from './scheme-selector';\nimport {Config} from './config';\nimport {Converter} from './converter';\nimport {Manager} from './manager';\n\n/**\n * @memberOf BX.Crm\n */\nexport const Conversion = {\n\tScheme,\n\tConfig,\n\tConverter,\n\tManager,\n\tSchemeSelector,\n};"],"names":["SchemeItem","params","String","id","name","phrase","availabilityLock","Type","isArray","entityTypeIds","forEach","entityTypeId","push","Number","Scheme","currentItemId","items","_classPrivateFieldInitSpec","isNull","item","console","error","length","getItemById","itemId","getId","getEntityTypeIds","Array","from","schemeItems","ConfigItem","active","enableSync","isPlainObject","initData","title","getEntityTypeId","getTitle","getInitData","isActive","isEnableSync","data","value","isBoolean","isString","Boolean","Config","scheme","schemeItem","getScheme","getCurrentItem","setCurrentItemId","activeEntityTypeIds","indexOf","setEnableSync","setActive","getItems","BX","CrmEntityType","resolveName","toLowerCase","externalize","configItems","Converter","config","_classPrivateMethodInitSpec","serviceUrl","additionalParams","action","getConfig","util","add_url_param","hasOwnProperty","originUrl","isRedirectToDetailPageEnabled","entityId","isStringFilled","getAvailabilityLock","eval","_classPrivateMethodGet","then","result","isCanceled","getServiceUrl","Ajax","url","method","dataType","getOriginUrl","onsuccess","bind","onfailure","response","ERROR","MessageBox","alert","MESSAGE","REQUIRED_ACTION","DATA","redirectUrl","URL","isRedirected","IS_FINISHED","Crm","Page","open","window","top","promises","promiseIterator","index","Promise","resolve","reject","categoryResult","category","configItem","getItemByEntityTypeId","categoryId","setInitData","CategoryList","Instance","categories","enumeration","deal","isDynamicTypeByTypeId","categorySelectorContent","Tag","render","Loc","getMessage","select","querySelector","appendChild","Text","encode","getName","popup","Popup","titleBar","content","closeByEsc","closeIcon","buttons","Button","text","color","ButtonColor","SUCCESS","onclick","selectedOptions","destroy","LIGHT","events","onClose","show","NAME","newConfig","CONFIG","Object","values","updateItems","FIELD_NAMES","CHECK_ERRORS","fieldNames","setConfig","setFieldNames","CrmEntityFieldSynchronizationEditor","create","legend","fieldListTitle","entityListTitle","continueButton","cancelButton","addClosingListener","sender","args","phraseId","messages","eventArgs","entityTypeName","current","getTopSlider","getUrl","onCustomEvent","localStorage","set","EventEmitter","emit","SchemeSelector","converter","document","getElementById","containerId","buttonId","labelId","getRandom","makeObservable","currentSchemeItem","innerText","getPhrase","Event","event","BaseEvent","updateFromSchemeItem","getData","convert","anchorPos","pos","MenuManager","bindElement","cacheable","offsetLeft","instance","Manager","Reflection","getClass","Conversion"],"mappings":";;;;;;AAAA,CAAiC;CAAA;CAAA;CAAA;CAAA;CAUjC;CACA;CACA;AACA,KAAaA,UAAU;GAQtB,oBAAYC,MAAsB,EAClC;KAAA;KAAA;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,sCAAI,OAAOC,MAAM,CAACD,MAAM,CAACE,EAAE,CAAC;KAC5B,sCAAI,SAASD,MAAM,CAACD,MAAM,CAACG,IAAI,CAAC;KAChC,sCAAI,WAAWF,MAAM,CAACD,MAAM,CAACI,MAAM,CAAC;KACpC,sCAAI,qBAAqBH,MAAM,CAACD,MAAM,CAACK,gBAAgB,CAAC;KAExD,sCAAI,kBAAkB,EAAE;KACxB,IAAIC,cAAI,CAACC,OAAO,CAACP,MAAM,CAACQ,aAAa,CAAC,EACtC;OACCR,MAAM,CAACQ,aAAa,CAACC,OAAO,CAAC,UAACC,YAAY,EAAK;SAC9C,uCAAI,kBAAgBC,IAAI,CAACC,MAAM,CAACF,YAAY,CAAC,CAAC;QAC9C,CAAC;;;GAEH;KAAA;KAAA,wBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,0BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,mCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,sCAGD;OACC,yCAAO,IAAI;;;GACX;CAAA;;;;;;;AC3DF,CACiC;CAAA;CAOjC;CACA;CACA;AACA,KAAaG,MAAM;GAKlB,gBAAYC,aAA0B,EAAEC,KAAmB,EAC3D;KAAA;KAAA;KAAAC;OAAA;OAAA;;KAAAA;OAAA;OAAA,OAHuB;;KAItB,sCAAI,kBAAkBV,cAAI,CAACW,MAAM,CAACH,aAAa,CAAC,GAAGA,aAAa,GAAGb,MAAM,CAACa,aAAa,CAAC;KAExF,IAAIR,cAAI,CAACC,OAAO,CAACQ,KAAK,CAAC,EACvB;OACCA,KAAK,CAACN,OAAO,CAAC,UAACS,IAAI,EAAK;SACvB,IAAIA,IAAI,YAAYnB,UAAU,EAC9B;WACC,uCAAI,UAAQY,IAAI,CAACO,IAAI,CAAC;UACtB,MAED;WACCC,OAAO,CAACC,KAAK,CACZ,oFAAoF,0BAAWF,IAAI,CAAC,CACpG;;QAEF,CAAC;;;GAEH;KAAA;KAAA,iCAaD;OACC,IAAI,mCAAC,IAAI,SAAO,IAAI,CAAC,sCAAI,UAAQG,MAAM,EACvC;SACC,OAAO,IAAI;;OAEZ,IAAMH,IAAI,GAAG,IAAI,CAACI,WAAW,mCAAC,IAAI,kBAAgB;OAElD,OAAOJ,IAAI,IAAI,sCAAI,UAAQ,CAAC,CAAC;;;KAC7B;KAAA,iCAEgBJ,aAAqB,EACtC;OACC,sCAAI,kBAAkBA,aAAa;;;KACnC;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,4BAEWS,MAAc,EAC1B;OAAA,6EACoB,IAAI;SAAA;OAAA;SAAvB,oDACA;WAAA,IADWL,IAAI;WAEd,IAAIA,IAAI,CAACM,KAAK,EAAE,KAAKD,MAAM,EAC3B;aACC,OAAOL,IAAI;;;;SAEZ;;SAAA;;OAED,OAAO,IAAI;;;KACX;KAAA,6CAE4BR,YAAoB,EACjD;OAAA,8EACoB,IAAI;SAAA;OAAA;SAAvB,uDACA;WAAA,IADWQ,IAAI;WAEd,IAAMV,aAAa,GAAGU,IAAI,CAACO,gBAAgB,EAAE;WAC7C,IAAIjB,aAAa,CAACa,MAAM,KAAK,CAAC,IAAIK,KAAK,CAACC,IAAI,CAACnB,aAAa,CAAC,CAAC,CAAC,CAAC,KAAKE,YAAY,EAC/E;aACC,OAAOQ,IAAI;;;;SAEZ;;SAAA;;OAED,OAAO,IAAI;;;KACX;KAAA,uBAxDalB,MAAkB,EAChC;OACC,IAAM4B,WAAW,GAAG,EAAE;OACtB5B,MAAM,CAACe,KAAK,CAACN,OAAO,CAAC,UAACS,IAAoB,EAAK;SAC9CU,WAAW,CAACjB,IAAI,CAAC,IAAIZ,UAAU,CAACmB,IAAI,CAAC,CAAC;QACtC,CAAC;OAEF,OAAO,IAAIL,MAAM,CAACb,MAAM,CAACc,aAAa,EAAEc,WAAW,CAAC;;;GACpD;CAAA;;;;;;AC9CF,CAAiC;CAAA;CAAA;CAAA;CAAA;CAAA;CAUjC;CACA;CACA;AACA,KAAaC,UAAU;GAQtB,oBAAY7B,MAAsB,EAClC;KAAA;KAAA;KAAAgB;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA,OALoB;;KAAEA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAMrB,sCAAI,iBAAiBJ,MAAM,CAACZ,MAAM,CAACU,YAAY,CAAC;KAChD,sCAAI,kCAAW,IAAI,4DAAJ,IAAI,EAA0BV,MAAM,CAAC8B,MAAM;KAC1D,sCAAI,sCAAe,IAAI,4DAAJ,IAAI,EAA0B9B,MAAM,CAAC+B,UAAU;KAClE,IAAIzB,cAAI,CAAC0B,aAAa,CAAChC,MAAM,CAACiC,QAAQ,CAAC,EACvC;OACC,sCAAI,aAAajC,MAAM,CAACiC,QAAQ;;KAEjC,sCAAI,UAAUhC,MAAM,CAACD,MAAM,CAACkC,KAAK,CAAC;;GAClC;KAAA;KAAA,8BAkBD;OACC,OAAO;SACNxB,YAAY,EAAE,IAAI,CAACyB,eAAe,EAAE;SACpCD,KAAK,EAAE,IAAI,CAACE,QAAQ,EAAE;SACtBH,QAAQ,EAAE,IAAI,CAACI,WAAW,EAAE;SAC5BP,MAAM,EAAE,IAAI,CAACQ,QAAQ,EAAE,GAAG,GAAG,GAAG,GAAG;SACnCP,UAAU,EAAE,IAAI,CAACQ,YAAY,EAAE,GAAG,GAAG,GAAG;QACxC;;;KACD;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,0BAEST,MAAe,EACzB;OACC,sCAAI,WAAWA,MAAM;OAErB,OAAO,IAAI;;;KACX;KAAA,+BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,8BAEaC,UAAmB,EACjC;OACC,sCAAI,eAAeA,UAAU;OAE7B,OAAO,IAAI;;;KACX;KAAA,8BAGD;OACC,OAAO,sCAAI,gBAAc,EAAE;;;KAC3B;KAAA,4BAEWS,IAAY,EACxB;OACC,sCAAI,aAAaA,IAAI;OAErB,OAAO,IAAI;;;KACX;KAAA,kCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,yBAEQN,KAAa,EACtB;OACC,sCAAI,UAAUA,KAAK;OAEnB,OAAO,IAAI;;;GACX;CAAA;CACD,mCA9EyBO,KAAU,EACnC;GACC,IAAInC,cAAI,CAACoC,SAAS,CAACD,KAAK,CAAC,EACzB;KACC,OAAOA,KAAK;;GAGb,IAAInC,cAAI,CAACqC,QAAQ,CAACF,KAAK,CAAC,EACxB;KACC,OAAQA,KAAK,KAAK,GAAG;;GAGtB,OAAOG,OAAO,CAACH,KAAK,CAAC;CACtB;;;;;;;AC7CD;CAKA;CACA;CACA;CAFA;CAAA;CAAA;AAGA,KAAaI,MAAM;GAMlB,gBACCnC,YAAoB,EACpBK,KAAmB,EACnB+B,MAAc,EAEf;KAAA;KAAA;KAAA9B;OAAA;OAAA;;KAAAA;OAAA;OAAA,OARuB;;KAAEA;OAAA;OAAA;;KASxB,sCAAI,mBAAiBJ,MAAM,CAACF,YAAY,CAAC;KAEzC,IAAIJ,cAAI,CAACC,OAAO,CAACQ,KAAK,CAAC,EACvB;OACCA,KAAK,CAACN,OAAO,CAAC,UAACS,IAAI,EAAK;SACvB,IAAIA,IAAI,YAAYW,UAAU,EAC9B;WACC,uCAAI,YAAQlB,IAAI,CAACO,IAAI,CAAC;UACtB,MAED;WACCC,OAAO,CAACC,KAAK,CACZ,oFAAoF,0BAAWF,IAAI,CAAC,CACpG;;QAEF,CAAC;;KAGH,IAAI4B,MAAM,YAAYjC,MAAM,EAC5B;OACC,sCAAI,WAAWiC,MAAM;MACrB,MAED;OACC3B,OAAO,CAACC,KAAK,CAAC,4EAA4E,0BAAW0B,MAAM,CAAC,CAAC;;;GAE9G;KAAA;KAAA,kCAaD;OACC,yCAAO,IAAI;;;KACX;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,uCAGD;OAAA,IADqBC,UAAsB,uEAAG,IAAI;OAEjD,IAAI,CAACA,UAAU,EACf;SACCA,UAAU,GAAG,IAAI,CAACC,SAAS,EAAE,CAACC,cAAc,EAAE;QAC9C,MAED;SACC,IAAI,CAACD,SAAS,EAAE,CAACE,gBAAgB,CAACH,UAAU,CAACvB,KAAK,EAAE,CAAC;;OAEtD,IAAM2B,mBAAmB,GAAGJ,UAAU,CAACtB,gBAAgB,EAAE;OAEzD,sCAAI,YAAQhB,OAAO,CAAC,UAACS,IAAI,EAAK;SAC7B,IAAMoB,QAAQ,GAAGa,mBAAmB,CAACC,OAAO,CAAClC,IAAI,CAACiB,eAAe,EAAE,CAAC,GAAG,CAAC,CAAC;SACzEjB,IAAI,CAACmC,aAAa,CAACf,QAAQ,CAAC;SAC5BpB,IAAI,CAACoC,SAAS,CAAChB,QAAQ,CAAC;QACxB,CAAC;OAEF,OAAO,IAAI;;;KACX;KAAA,sCAEqB5B,YAAoB,EAC1C;OAAA,+EACoB,IAAI;SAAA;OAAA;SAAvB,oDACA;WAAA,IADWQ,IAAI;WAEd,IAAIA,IAAI,CAACiB,eAAe,EAAE,KAAKzB,YAAY,EAC3C;aACC,OAAOQ,IAAI;;;;SAEZ;;SAAA;;OAED,OAAO,IAAI;;;KACX;KAAA,8BAGD;OACC,IAAMsB,IAAI,GAAG,EAAE;OAEf,IAAI,CAACe,QAAQ,EAAE,CAAC9C,OAAO,CAAC,UAACS,IAAI,EAAK;SACjCsB,IAAI,CAACgB,EAAE,CAACC,aAAa,CAACC,WAAW,CAACxC,IAAI,CAACiB,eAAe,EAAE,CAAC,CAACwB,WAAW,EAAE,CAAC,GAAGzC,IAAI,CAAC0C,WAAW,EAAE;QAC7F,CAAC;OAEF,OAAOpB,IAAI;;;KACX;KAAA,4BAEWzB,KAAuB,EACnC;OAAA;OACC,sCAAI,YAAU,EAAE;OAChBA,KAAK,CAACN,OAAO,CAAC,UAACS,IAAI,EAAK;SACvB,wCAAI,YAAQP,IAAI,CAAC,IAAIkB,UAAU,CAACX,IAAI,CAAC,CAAC;QACtC,CAAC;OAEF,OAAO,IAAI;;;KACX;KAAA,uBA9EaR,YAAoB,EAAEK,KAAuB,EAAE+B,MAAc,EAC3E;OACC,IAAMe,WAAW,GAAG,EAAE;OACtB9C,KAAK,CAACN,OAAO,CAAC,UAACS,IAAoB,EAAK;SACvC2C,WAAW,CAAClD,IAAI,CAAC,IAAIkB,UAAU,CAACX,IAAI,CAAC,CAAC;QACtC,CAAC;OAEF,OAAO,IAAI2B,MAAM,CAACnC,YAAY,EAAEmD,WAAW,EAAEf,MAAM,CAAC;;;GACpD;CAAA;;;;;;;;;;ACzDF,CAW2C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAkB3C;CACA;CACA;AACA,KAAagB,SAAS;GAUrB,mBACCpD,cAAoB,EACpBqD,QAAc,EACd/D,MAAwB,EAEzB;KAAA;KAAAgE;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhD;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,mBAAiBJ,MAAM,CAACF,cAAY,CAAC;KACzC,IAAIqD,QAAM,YAAYlB,MAAM,EAC5B;OACC,sCAAI,WAAWkB,QAAM;MACrB,MAED;OACC5C,OAAO,CAACC,KAAK,CAAC,+EAA+E,0BAAW2C,QAAM,CAAC,CAAC;;KAEjH,sCAAI,WAAW/D,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,EAAE;KAE3B,sCAAI,eAAe,KAAK;KACxB,sCAAI,6BAA6B,KAAK;KACtC,sCAAI,aAAa,CAAC;;GAClB;KAAA;KAAA,kCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,gCAGD;OACC,IAAIiE,UAAU,GAAG,sCAAI,WAASA,UAAU;OACxC,IAAI,CAACA,UAAU,EACf;SACC,OAAO,IAAI;;OAGZ,IAAMC,gBAAgB,GAAG;SACxBC,MAAM,EAAE;QACR;OAED,IAAI,CAACC,SAAS,EAAE,CAACb,QAAQ,EAAE,CAAC9C,OAAO,CAAC,UAACS,IAAgB,EAAK;SACzDgD,gBAAgB,CAACV,EAAE,CAACC,aAAa,CAACC,WAAW,CAACxC,IAAI,CAACiB,eAAe,EAAE,CAAC,CAACwB,WAAW,EAAE,CAAC,GAAGzC,IAAI,CAACoB,QAAQ,EAAE,GAAG,GAAG,GAAG,GAAG;QAClH,CAAC;OAEF,OAAOkB,EAAE,CAACa,IAAI,CAACC,aAAa,CAACL,UAAU,EAAEC,gBAAgB,CAAC;;;KAC1D;KAAA,+BAGD;OACC,IAAI,sCAAI,cAAY,sCAAI,WAASK,cAAc,CAAC,WAAW,CAAC,EAC5D;SACC,OAAOtE,MAAM,CAAC,sCAAI,WAASuE,SAAS,CAAC;;OAGtC,OAAO,IAAI;;;KACX;KAAA,gDAGD;OACC,IAAI,sCAAI,cAAY,sCAAI,WAASD,cAAc,CAAC,+BAA+B,CAAC,EAChF;SACC,OAAO,sCAAI,WAASE,6BAA6B;;OAGlD,OAAO,IAAI;;;KACX;KAAA,wBAEOC,QAAgB,EAAElC,IAAa,EACvC;OAAA;OACC,sCAAI,aAAakC,QAAQ;OACzB,IAAI,CAAClC,IAAI,GAAGA,IAAI;OAChB,IAAMO,UAAU,GAAG,sCAAI,WAASC,SAAS,EAAE,CAACC,cAAc,EAAE;OAC5D,IAAI,CAACF,UAAU,EACf;SACC5B,OAAO,CAACC,KAAK,CAAC,qBAAqB,CAAC;SACpC;;OAGD,IAAId,cAAI,CAACqE,cAAc,CAAC5B,UAAU,CAAC6B,mBAAmB,EAAE,CAAC,EACzD;SACCC,IAAI,CAAC9B,UAAU,CAAC6B,mBAAmB,EAAE,CAAC;SAEtC;;OAGDE,6BAAI,wDAAJ,IAAI,EAAwB/B,UAAU,EAAEgC,IAAI,CAAC,UAACC,MAAmC,EAAK;SACrF,IAAIA,MAAM,CAACC,UAAU,EACrB;WACC;;SAGDH,8BAAI,4BAAJ,KAAI;QAEJ,CAAC,SAAM,CAAC,UAAC1D,KAAK,EAAK;SACnB,IAAIA,KAAK,EACT;WACCD,OAAO,CAACC,KAAK,CAACA,KAAK,CAAC;;QAErB,CAAC;;;GACF;CAAA;CAkXD,qBA/WA;GACC,IAAM6C,UAAU,GAAG,IAAI,CAACiB,aAAa,EAAE;GACvC,IAAI,CAACjB,UAAU,EACf;KACC9C,OAAO,CAACC,KAAK,CAAC,mCAAmC,CAAC;KAClD;;GAED,sCAAI,IAAI,gBACR;KACCD,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAC;KAC/C;;GAED,sCAAI,eAAe,IAAI;GACvB+D,cAAI,CAAC;KACJC,GAAG,EAAEnB,UAAU;KACfoB,MAAM,EAAE,MAAM;KACdC,QAAQ,EAAE,MAAM;KAChB9C,IAAI,EACH;OACC,MAAM,EAAE,SAAS;OACjB,WAAW,oCAAE,IAAI,YAAU;OAC3B,wBAAwB,EAAE,sCAAI,+BAA6B,GAAG,GAAG,GAAG;OACpE,yBAAyB,EAAE,IAAI,CAACiC,6BAA6B,GAAG,GAAG,GAAG,GAAG;OACzE,QAAQ,EAAE,IAAI,CAACL,SAAS,EAAE,CAACR,WAAW,EAAE;OACxC,SAAS,EAAE,IAAI,CAACpB,IAAI;OACpB,YAAY,EAAE,IAAI,CAAC+C,YAAY;MAC/B;KACFC,SAAS,EAAEV,6BAAI,yCAAmBW,IAAI,CAAC,IAAI,CAAC;KAC5CC,SAAS,EAAEZ,6BAAI,qCAAiBW,IAAI,CAAC,IAAI;IACzC,CAAC;CACH;CAAC,4BAEiBE,QAAQ,EAC1B;;GAEC,sCAAI,eAAe,KAAK;GACxB,IAAIA,QAAQ,CAACC,KAAK,EAClB;KACCC,gCAAU,CAACC,KAAK,CAACH,QAAQ,CAACC,KAAK,CAACG,OAAO,IAAI,yBAAyB,CAAC;KACrE;;GAED,IAAIzF,cAAI,CAAC0B,aAAa,CAAC2D,QAAQ,CAACK,eAAe,CAAC,EAChD;KACC,gCAAO,IAAI,wDAAJ,IAAI,EAAwBL,QAAQ,CAACK,eAAe;;GAG5D,IAAMxD,IAAI,GAAGlC,cAAI,CAAC0B,aAAa,CAAC2D,QAAQ,CAACM,IAAI,CAAC,GAAGN,QAAQ,CAACM,IAAI,GAAG,EAAE;GACnE,IAAI,CAACzD,IAAI,EACT;KACC;;GAGD,IAAM0D,WAAW,GAAG5F,cAAI,CAACqC,QAAQ,CAACH,IAAI,CAAC2D,GAAG,CAAC,GAAG3D,IAAI,CAAC2D,GAAG,GAAG,EAAE;GAC3D,IAAIC,YAAY,GAAG,KAAK;GACxB,IAAI5D,IAAI,CAAC6D,WAAW,IAAI7D,IAAI,CAAC6D,WAAW,KAAK,GAAG,EAChD;KACC,IAAI,CAAC7D,IAAI,GAAG,EAAE;KAEd4D,YAAY,4BAAG,IAAI,kDAAJ,IAAI,EAAqBF,WAAW,CAAC;;GAGrD,IAAGA,WAAW,KAAK,EAAE,IAAI,CAACE,YAAY,EACtC;KACC5C,EAAE,CAAC8C,GAAG,CAACC,IAAI,CAACC,IAAI,CAACN,WAAW,CAAC;IAC7B,MACI,IAAG,EAAEE,YAAY,IAAIK,MAAM,CAACC,GAAG,KAAKD,MAAM,CAAC,EAChD;CAGD;CAAC,0BAEerF,KAAa,EAC7B;GACC,sCAAI,eAAe,KAAK;GACxByE,gCAAU,CAACC,KAAK,CAAC1E,KAAK,CAAC;CACxB;CAAC,iCAEsB2B,UAAsB,EAC7C;GAAA;GACC,IAAMgB,MAAM,GAAG,IAAI,CAACK,SAAS,EAAE;GAE/B,IAAMuC,QAAQ,GAAG,EAAE;GAEnB5D,UAAU,CAACtB,gBAAgB,EAAE,CAAChB,OAAO,CAAC,UAACC,YAAY,EAAK;KACvDiG,QAAQ,CAAChG,IAAI,CAAC,YAAM;OACnB,gCAAO,MAAI,kEAAJ,MAAI,EAA6BD,YAAY;MACpD,CAAC;IACF,CAAC;GAEF,IAAIsE,MAAmC,GAAG;KACzCC,UAAU,EAAE;IACZ;GACD,IAAM2B,eAAe,GAAI,SAAnBA,eAAe,CAAKD,QAAe,EAAwB;KAAA,IAAtBE,KAAa,uEAAG,CAAC;KAC3D,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;OACvC,IAAIhC,MAAM,CAACC,UAAU,IAAI,CAAC0B,QAAQ,CAACE,KAAK,CAAC,EACzC;SACCE,OAAO,CAAC/B,MAAM,CAAC;SACf;;OAED2B,QAAQ,CAACE,KAAK,CAAC,EAAE,CAAC9B,IAAI,CAAC,UAACkC,cAAoC,EAAK;SAChE,IAAIA,cAAc,CAAChC,UAAU,EAC7B;WACCD,MAAM,CAACC,UAAU,GAAG,IAAI;UACxB,MACI,IAAIgC,cAAc,CAACC,QAAQ,EAChC;WACC,IAAMxG,YAAY,GAAGuG,cAAc,CAACC,QAAQ,CAAC/E,eAAe,EAAE;WAC9D,IAAMgF,UAAU,GAAGpD,MAAM,CAACqD,qBAAqB,CAAC1G,YAAY,CAAC;WAC7D,IAAI,CAACyG,UAAU,EACf;aACCH,MAAM,CAAC,qDAAqD,GAAGtG,YAAY,CAAC;aAC5E;;WAED,IAAMuB,QAAQ,GAAGkF,UAAU,CAAC9E,WAAW,EAAE;WACzCJ,QAAQ,CAACoF,UAAU,GAAGJ,cAAc,CAACC,QAAQ,CAAC1F,KAAK,EAAE;WACrD2F,UAAU,CAACG,WAAW,CAACrF,QAAQ,CAAC;;SAGjC8E,OAAO,CAACH,eAAe,CAACD,QAAQ,EAAE,EAAEE,KAAK,CAAC,CAAC;QAC3C,CAAC;MACF,CAAC;IACD;GAEF,OAAOD,eAAe,CAACD,QAAQ,CAAC;CACjC;CAAC,sCAE2BjG,YAAY,EACxC;GAAA;GACC,OAAO,IAAIoG,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;KACvC,IAAMG,UAAU,GAAG,MAAI,CAAC/C,SAAS,EAAE,CAACgD,qBAAqB,CAAC1G,YAAY,CAAC;KACvE,IAAI,CAACyG,UAAU,EACf;OACCH,MAAM,CAAC,qDAAqD,GAAGtG,YAAY,CAAC;OAC5E;;KAED,6BAAI,MAAI,0DAAJ,MAAI,EAAyBA,YAAY,GAC7C;OACC6G,6BAAY,CAACC,QAAQ,CAACjE,QAAQ,CAAC7C,YAAY,CAAC,CAACqE,IAAI,CAAC,UAAC0C,UAA2B,EAAK;SAClF,IAAIA,UAAU,CAACpG,MAAM,GAAG,CAAC,EACzB;WACCyD,+BAAI,sDAAJ,MAAI,EAAuB2C,UAAU,EAAEN,UAAU,CAAC/E,QAAQ,EAAE,EAAE2C,IAAI,CAACgC,OAAO,CAAC,SAAM,CAACC,MAAM,CAAC;UACzF,MAED;WACCD,OAAO,CAAC;aACP9B,UAAU,EAAE,KAAK;aACjBiC,QAAQ,EAAEO,UAAU,CAAC,CAAC;YACtB,CAAC;;QAEH,CAAC,SAAM,CAACT,MAAM,CAAC;MAChB,MAED;OACCD,OAAO,CAAC;SAAC9B,UAAU,EAAC,KAAK;SAAEiC,QAAQ,EAAC;QAAK,CAAC;;IAE3C,CAAC;CACH;CAAC,kCAEuBxG,YAAoB,EAC5C;;GAEC,OACCA,YAAY,KAAK8C,EAAE,CAACC,aAAa,CAACiE,WAAW,CAACC,IAAI,IAC/CnE,EAAE,CAACC,aAAa,CAACmE,qBAAqB,CAAClH,YAAY,CAAC;CAEzD;CAAC,gCAEqB+G,UAA2B,EAAEvF,KAAa,EAChE;GACC,OAAO,IAAI4E,OAAO,CAAC,UAACC,OAAO,EAAK;KAC/B,IAAMc,uBAAoC,GAAGC,aAAG,CAACC,MAAM,ytBAIlBC,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,CAUzE;KAED,IAAMC,MAAM,GAAGL,uBAAuB,CAACM,aAAa,CAAC,QAAQ,CAAC;KAC9DV,UAAU,CAAChH,OAAO,CAAC,UAACyG,QAAQ,EAAK;OAChCgB,MAAM,CAACE,WAAW,CAACN,aAAG,CAACC,MAAM,wHAAkBb,QAAQ,CAAC1F,KAAK,EAAE,EAAK6G,cAAI,CAACC,MAAM,CAACpB,QAAQ,CAACqB,OAAO,EAAE,CAAC,EAAY;MAC/G,CAAC;KAEF,IAAMC,KAAK,GAAG,IAAIC,gBAAK,CAAC;OACvBC,QAAQ,EAAEV,aAAG,CAACC,UAAU,CAAC,wCAAwC,EAAE;SAClE,UAAU,EAAEI,cAAI,CAACC,MAAM,CAACpG,KAAK;QAC7B,CAAC;OACFyG,OAAO,EAAEd,uBAAuB;OAChCe,UAAU,EAAE,IAAI;OAChBC,SAAS,EAAE,IAAI;OACfC,OAAO,EAAE,CACR,IAAIC,iBAAM,CAAC;SACVC,IAAI,EAAEhB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC;SAC9CgB,KAAK,EAAEC,sBAAW,CAACC,OAAO;SAC1BC,OAAO,EAAE,mBAAM;WACd,IAAM3G,KAAK,GAAGf,KAAK,CAACC,IAAI,CAACuG,MAAM,CAACmB,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC5G,KAAK;WAEzD+F,KAAK,CAACc,OAAO,EAAE;WAAC,6CAEO7B,UAAU;aAAA;WAAA;aAAjC,oDACA;eAAA,IADWP,QAAQ;eAElB,IAAIA,QAAQ,CAAC1F,KAAK,EAAE,KAAKZ,MAAM,CAAC6B,KAAK,CAAC,EACtC;iBACCsE,OAAO,CAAC;mBAACG,QAAQ,EAARA;kBAAS,CAAC;iBACnB,OAAO,IAAI;;;;aAEZ;;aAAA;;WACD/F,OAAO,CAACC,KAAK,CAAC,6BAA6B,CAAC;WAC5C2F,OAAO,CAAC;aAAC9B,UAAU,EAAE;YAAK,CAAC;WAE3B,OAAO,IAAI;;QAEZ,CAAC,EACF,IAAI8D,iBAAM,CAAC;SACVC,IAAI,EAAEhB,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;SAChDgB,KAAK,EAAEC,sBAAW,CAACK,KAAK;SACxBH,OAAO,EAAE,mBAAM;WACdZ,KAAK,CAACc,OAAO,EAAE;WAEfvC,OAAO,CAAC;aAAC9B,UAAU,EAAE;YAAK,CAAC;WAC3B,OAAO,IAAI;;QAEZ,CAAC,CACF;OACDuE,MAAM,EAAE;SACPC,OAAO,EAAE,mBACT;WACC1C,OAAO,CAAC;aAAC9B,UAAU,EAAE;YAAK,CAAC;;;MAG7B,CAAC;KAEFuD,KAAK,CAACkB,IAAI,EAAE;IACZ,CAAC;CACH;CAAC,iCAEsBvF,MAAc,EACrC;GACC,IAAMhE,IAAI,GAAGF,MAAM,CAACkE,MAAM,CAACwF,IAAI,CAAC;GAChC,IAAMnH,IAAI,GAAGlC,cAAI,CAAC0B,aAAa,CAACmC,MAAM,CAAC8B,IAAI,CAAC,GAAG9B,MAAM,CAAC8B,IAAI,GAAG,EAAE;GAE/D,IAAG9F,IAAI,KAAK,aAAa,EACzB;KACC,IAAIyJ,SAAgC,GAAG,IAAI;KAC3C,IAAItJ,cAAI,CAACC,OAAO,CAACiC,IAAI,CAACqH,MAAM,CAAC,EAC7B;OACCD,SAAS,GAAGpH,IAAI,CAACqH,MAAM;MACvB,MACI,IAAIvJ,cAAI,CAAC0B,aAAa,CAACQ,IAAI,CAACqH,MAAM,CAAC,EACxC;OACCD,SAAS,GAAGE,MAAM,CAACC,MAAM,CAACvH,IAAI,CAACqH,MAAM,CAAC;;KAGvC,IAAID,SAAS,EACb;OACC,sCAAI,WAASI,WAAW,CAACJ,SAAS,CAAC;;KAGpC9E,6BAAI,wDAAJ,IAAI,EAAwBxE,cAAI,CAACC,OAAO,CAACiC,IAAI,CAACyH,WAAW,CAAC,GAAGzH,IAAI,CAACyH,WAAW,GAAG,EAAE,EAAEP,IAAI,EAAE;KAE1F;;GAED,IAAGvJ,IAAI,KAAK,SAAS,EACrB;KACC,IAAGG,cAAI,CAAC0B,aAAa,CAACQ,IAAI,CAAC0H,YAAY,CAAC,EACxC;;;;;;;;;;;OAWC;;;CAGH;CAAC,iCAEsBC,UAAoB,EAC3C;GAAA;GACC,sCAAI,IAAI,wBACR;KACC,sCAAI,uBAAqBC,SAAS,CAAC,sCAAI,WAASxG,WAAW,EAAE,CAAC;KAC9D,sCAAI,uBAAqByG,aAAa,CAACF,UAAU,CAAC;KAElD,yCAAO,IAAI;;GAGZ,sCAAI,uBAAuB3G,EAAE,CAAC8G,mCAAmC,CAACC,MAAM,CACvE,oCAAoC,GAAG,IAAI,CAACpI,eAAe,EAAE,EAC7D;KACC4B,MAAM,EAAE,sCAAI,WAASH,WAAW,EAAE;KAClC1B,KAAK,2BAAE,IAAI,kCAAJ,IAAI,EAAa,aAAa,CAAC;KACtCiI,UAAU,EAAEA,UAAU;KACtBK,MAAM,2BAAE,IAAI,kCAAJ,IAAI,EAAa,kBAAkB,CAAC;KAC5CC,cAAc,2BAAE,IAAI,kCAAJ,IAAI,EAAa,0BAA0B,CAAC;KAC5DC,eAAe,2BAAE,IAAI,kCAAJ,IAAI,EAAa,2BAA2B,CAAC;KAC9DC,cAAc,2BAAE,IAAI,kCAAJ,IAAI,EAAa,gBAAgB,CAAC;KAClDC,YAAY,2BAAE,IAAI,kCAAJ,IAAI,EAAa,cAAc;IAC7C,CACD;GACD,sCAAI,uBAAqBC,kBAAkB,CAAC,UAACC,MAAM,EAAEC,IAAI,EAAK;KAC7D,IAAG,EAAEzK,cAAI,CAACoC,SAAS,CAACqI,IAAI,CAAC,YAAY,CAAC,CAAC,IAAIA,IAAI,CAAC,YAAY,CAAC,KAAK,KAAK,CAAC,EACxE;OACC;;KAGD,wCAAI,6BAA6B,IAAI;KACrC,wCAAI,WAASf,WAAW,CAACF,MAAM,CAACC,MAAM,CAAC,wCAAI,uBAAqB3F,SAAS,EAAE,CAAC,CAAC;KAC7EU,+BAAI,4BAAJ,MAAI;IACJ,CAAC;GAEF,yCAAO,IAAI;CACZ;CAAC,sBAEWkG,QAAQ,EACpB;GACC,IAAI,CAAC,sCAAI,WAASC,QAAQ,EAC1B;KACC,sCAAI,WAASA,QAAQ,GAAG,EAAE;;GAE3B,OAAO,sCAAI,WAASA,QAAQ,CAACD,QAAQ,CAAC,IAAIA,QAAQ;CACnD;CAAC,8BAEmB9E,WAAW,EAC/B;GACC,IAAMxF,YAAY,GAAG,IAAI,CAACyB,eAAe,EAAE;GAE3C,IAAM+I,SAAS,GAAG;KACjBxK,YAAY,EAAZA,YAAY;KACZyK,cAAc,EAAE3H,EAAE,CAACC,aAAa,CAACC,WAAW,CAAChD,YAAY,CAAC;KAC1DgE,QAAQ,oCAAE,IAAI,YAAU;KACxBwB,WAAW,EAAXA,WAAW;KACXE,YAAY,EAAE;IACd;GAED,IAAIgF,OAAO,GAAG5H,EAAE,CAAC8C,GAAG,CAACC,IAAI,CAAC8E,YAAY,EAAE;GACxC,IAAGD,OAAO,EACV;KACCF,SAAS,CAAC,WAAW,CAAC,GAAGE,OAAO,CAACE,MAAM,EAAE;;GAG1C9H,EAAE,CAAC+H,aAAa,CAAC9E,MAAM,EAAE,+BAA+B,EAAE,CAAE,IAAI,EAAEyE,SAAS,CAAE,CAAC;GAC9E1H,EAAE,CAACgI,YAAY,CAACC,GAAG,CAAC,oBAAoB,EAAEP,SAAS,EAAE,EAAE,CAAC;GAExD,IAAI,CAAC9G,SAAS,EAAE,CAACb,QAAQ,EAAE,CAAC9C,OAAO,CAAC,UAACS,IAAI,EAAK;KAC7C,IAAIA,IAAI,CAACoB,QAAQ,EAAE,EACnB;OACCoJ,6BAAY,CAACC,IAAI,CAAC,qCAAqC,EAAE;SACxDR,cAAc,EAAE3H,EAAE,CAACC,aAAa,CAACC,WAAW,CAACxC,IAAI,CAACiB,eAAe,EAAE;QACnE,CAAC;;IAEH,CAAC;GAEF,OAAO+I,SAAS,CAAC,cAAc,CAAC;CACjC;;;;;;AClgBD;CAMA;CACA;CACA;CACA;CAHA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAIA,KAAaU,cAAc;GAU1B,wBACCC,SAAoB,EACpB7L,MAKC,EACA;KAAA;KAAAgE;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhD;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACD,sCAAI,cAAc6K,SAAS;KAC3B,sCAAI,eAAajL,MAAM,CAACZ,MAAM,CAAC0E,QAAQ,CAAC;KACxC,sCAAI,cAAcoH,QAAQ,CAACC,cAAc,CAAC/L,MAAM,CAACgM,WAAW,CAAC;KAC7D,sCAAI,eAAeF,QAAQ,CAACC,cAAc,CAAC/L,MAAM,CAACiM,QAAQ,CAAC;KAC3D,sCAAI,UAAUH,QAAQ,CAACC,cAAc,CAAC/L,MAAM,CAACkM,OAAO,CAAC;KACrD,sCAAI,WAAW,iCAAiC,qCAAG,IAAI,cAAU,GAAG,GAAG,GAAG7D,cAAI,CAAC8D,SAAS,EAAE;KAC1F,sCAAI,4BAA4B,KAAK;KAErC,IAAI,mCAAC,IAAI,cAAU,IAAI,mCAAC,IAAI,aAAW,IAAI,mCAAC,IAAI,cAAY,IAAI,mCAAC,IAAI,SAAO,IAAI,mCAAC,IAAI,aAAW,EAChG;OACChL,OAAO,CAACC,KAAK,CAAC,mCAAmC,EAAE,IAAI,CAAC;MACxD,MAED;OACC0D,6BAAI,0BAAJ,IAAI;OACJA,6BAAI,kCAAJ,IAAI;;KAGL4G,6BAAY,CAACU,cAAc,CAAC,IAAI,EAAE,mBAAmB,CAAC;;GACtD;KAAA;KAAA,uCAGD;OACC,sCAAI,4BAA4B,IAAI;;;KACpC;KAAA,wCAGD;OACC,sCAAI,4BAA4B,KAAK;;;GACrC;CAAA;CAyFD,oBAtFA;GACC,IAAMC,iBAAkC,GAAG,sCAAI,cAAYjI,SAAS,EAAE,CAACpB,SAAS,EAAE,CAACC,cAAc,EAAE;GACnG,IAAIoJ,iBAAiB,EACrB;KACC,sCAAI,UAAQC,SAAS,GAAGD,iBAAiB,CAACE,SAAS,EAAE;;CAEvD;CAAC,wBAGD;GACCC,eAAK,CAAC/G,IAAI,mCAAC,IAAI,eAAa,OAAO,EAAEX,6BAAI,iDAAuBW,IAAI,CAAC,IAAI,CAAC,CAAC;GAC3E+G,eAAK,CAAC/G,IAAI,mCAAC,IAAI,gBAAc,OAAO,EAAEX,6BAAI,mDAAwBW,IAAI,CAAC,IAAI,CAAC,CAAC;CAC9E;CAAC,kCAGD;GACC,IAAMgH,KAAK,GAAG,IAAIC,0BAAS,CAAC;KAC3BlK,IAAI,EAAE;OACLyC,UAAU,EAAE;;IAEb,CAAC;GACF,IAAI,CAAC0G,IAAI,CAAC,iCAAiC,EAAEc,KAAK,CAAC;GACnD,sCAAI,cAAYrI,SAAS,EAAE,CAACuI,oBAAoB,EAAE;GAClD,IAAI,sCAAI,+BAA6B,CAACF,KAAK,CAACG,OAAO,EAAE,CAAC3H,UAAU,EAChE;KACC,sCAAI,cAAY4H,OAAO,mCAAC,IAAI,eAAW;;CAEzC;CAAC,mCAGD;GACC/H,6BAAI,8BAAJ,IAAI;CACL;CAAC,sBAGD;GACC,IAAMgI,SAAS,GAAGtJ,EAAE,CAACuJ,GAAG,mCAAC,IAAI,cAAY;GAEzCC,sBAAW,CAACtD,IAAI,CAAC;KAChBxJ,EAAE,oCAAE,IAAI,UAAQ;KAChB+M,WAAW,oCAAE,IAAI,cAAY;KAC7BlM,KAAK,2BAAE,IAAI,sCAAJ,IAAI,CAAgB;KAC3B6H,UAAU,EAAE,IAAI;KAChBsE,SAAS,EAAE,KAAK;KAChBC,UAAU,EAAE,CAACL,SAAS,CAAC,OAAO;IAC9B,CAAC;CACH;CAAC,uBAGD;GACCE,sBAAW,CAAC1D,OAAO,mCAAC,IAAI,WAAS;CAClC;CAAC,0BAGD;GAAA;GACC,IAAMvI,KAAK,GAAG,EAAE;GAEhB,sCAAI,cAAYqD,SAAS,EAAE,CAACpB,SAAS,EAAE,CAACO,QAAQ,EAAE,CAAC9C,OAAO,CAAC,UAACS,IAAgB,EAAK;KAChFH,KAAK,CAACJ,IAAI,CAAC;OACVqI,IAAI,EAAEX,cAAI,CAACC,MAAM,CAACpH,IAAI,CAACqL,SAAS,EAAE,CAAC;OACnCnD,OAAO,EAAE,mBAAM;SACdtE,8BAAI,4CAAJ,KAAI,EAAkB5D,IAAI;;MAE3B,CAAC;IACF,CAAC;GAEF,OAAOH,KAAK;CACb;CAAC,2BAEgBG,IAAgB,EACjC;GACC4D,6BAAI,gCAAJ,IAAI;GACJ,sCAAI,UAAQwH,SAAS,GAAGpL,IAAI,CAACqL,SAAS,EAAE;GACxC,sCAAI,cAAYnI,SAAS,EAAE,CAACuI,oBAAoB,CAACzL,IAAI,CAAC;GAEtD,IAAMuL,KAAK,GAAG,IAAIC,0BAAS,CAAC;KAC3BlK,IAAI,EAAE;OACLyC,UAAU,EAAE;;IAEb,CAAC;GACF,IAAI,CAAC0G,IAAI,CAAC,iCAAiC,EAAEc,KAAK,CAAC;GACnD,IAAI,sCAAI,+BAA6B,CAACA,KAAK,CAACG,OAAO,EAAE,CAAC3H,UAAU,EAChE;KACC,sCAAI,cAAY4H,OAAO,mCAAC,IAAI,eAAW;;CAEzC;;;;ACjJD,CAOA,IAAIO,QAAQ,GAAG,IAAI;;CAEnB;CACA;CACA;CAFA;AAGA,KAAaC,OAAO;GAInB,mBAAc;KAAA;KAAArM;OAAA;OAAA;;KACb,sCAAI,eAAe,EAAE;;GACrB;KAAA;KAAA,oCAkBAN,YAAoB,EACpBV,MAIC,EAEF;OACC,IAAM+D,MAAM,GAAGlB,MAAM,CAAC0H,MAAM,CAAC7J,YAAY,EAAEV,MAAM,CAAC6D,WAAW,EAAEhD,MAAM,CAAC0J,MAAM,CAACvK,MAAM,CAAC8C,MAAM,CAAC,CAAC;OAE5F,sCAAI,eAAapC,YAAY,CAAC,GAAG,IAAIoD,SAAS,CAACpD,YAAY,EAAEqD,MAAM,EAAE/D,MAAM,CAACA,MAAM,CAAC;OAEnF,OAAO,sCAAI,eAAaU,YAAY,CAAC;;;KACrC;KAAA,6BAEYA,YAAoB,EACjC;OACC,OAAO,sCAAI,eAAaA,YAAY,CAAC,IAAI,IAAI;;;KAC7C;KAAA,oBAjCD;OACC,IAAK+F,MAAM,CAACC,GAAG,KAAKD,MAAM,IAAK6G,oBAAU,CAACC,QAAQ,CAAC,+BAA+B,CAAC,EACnF;SACC,OAAO9G,MAAM,CAACC,GAAG,CAAClD,EAAE,CAAC8C,GAAG,CAACkH,UAAU,CAACH,OAAO,CAAC7F,QAAQ;;OAGrD,IAAI4F,QAAQ,KAAK,IAAI,EACrB;SACCA,QAAQ,GAAG,IAAIC,OAAO,EAAE;;OAGzB,OAAOD,QAAQ;;;GACf;CAAA;;CC5BF;CACA;CACA;AACA,KAAaI,UAAU,GAAG;GACzB3M,MAAM,EAANA,MAAM;GACNgC,MAAM,EAANA,MAAM;GACNiB,SAAS,EAATA,SAAS;GACTuJ,OAAO,EAAPA,OAAO;GACPzB,cAAc,EAAdA;CACD,CAAC;;;;;;;;"}