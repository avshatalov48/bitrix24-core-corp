{"version":3,"file":"conversion.bundle.js","sources":["../src/scheme-item.js","../src/scheme.js","../src/config-item.js","../src/config.js","../src/converter.js","../src/scheme-selector.js","../src/manager.js","../src/index.js"],"sourcesContent":["import { Type } from \"main.core\";\n\nexport type SchemeItemData = {\n\tid: string,\n\tname: string,\n\tentityTypeIds: number[],\n\tphrase: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class SchemeItem\n{\n\t#id: string;\n\t#name: string;\n\t#entityTypeIds: number[];\n\t#phrase: string;\n\n\tconstructor(params: SchemeItemData)\n\t{\n\t\tthis.#id = String(params.id);\n\t\tthis.#name = String(params.name);\n\t\tthis.#phrase = String(params.phrase);\n\n\t\tthis.#entityTypeIds = [];\n\t\tif (Type.isArray(params.entityTypeIds))\n\t\t{\n\t\t\tparams.entityTypeIds.forEach((entityTypeId) => {\n\t\t\t\tthis.#entityTypeIds.push(Number(entityTypeId));\n\t\t\t});\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.#name;\n\t}\n\n\tgetEntityTypeIds(): number[]\n\t{\n\t\treturn this.#entityTypeIds;\n\t}\n\n\tgetPhrase(): string\n\t{\n\t\treturn this.#phrase;\n\t}\n}\n","import type { SchemeItemData } from \"./scheme-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Type } from \"main.core\";\n\nexport type SchemeData = {\n\tcurrentItemId: string,\n\titems: SchemeItemData[],\n}\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Scheme\n{\n\t#currentItemId: string;\n\t#items: SchemeItem[] = [];\n\n\tconstructor(currentItemId: string|null, items: SchemeItem[])\n\t{\n\t\tthis.#currentItemId = Type.isNull(currentItemId) ? currentItemId : String(currentItemId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof SchemeItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'SchemeItem is invalid in Scheme constructor. Expected instance of SchemeItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic create(params: SchemeData)\n\t{\n\t\tconst schemeItems = [];\n\t\tparams.items.forEach((item: SchemeItemData) => {\n\t\t\tschemeItems.push(new SchemeItem(item));\n\t\t});\n\n\t\treturn new Scheme(params.currentItemId, schemeItems);\n\t}\n\n\tgetCurrentItem(): ?SchemeItem\n\t{\n\t\tif (!this.#items || !this.#items.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst item = this.getItemById(this.#currentItemId);\n\n\t\treturn item || this.#items[0];\n\t}\n\n\tsetCurrentItemId(currentItemId: string)\n\t{\n\t\tthis.#currentItemId = currentItemId;\n\t}\n\n\tgetItems(): SchemeItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetItemById(itemId: string): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getId() === itemId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetItemForSingleEntityTypeId(entityTypeId: number): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tconst entityTypeIds = item.getEntityTypeIds();\n\t\t\tif (entityTypeIds.length === 1 && Array.from(entityTypeIds)[0] === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Type } from \"main.core\";\n\nexport type ConfigItemData = {\n\tentityTypeId: number,\n\tactive: boolean,\n\tenableSync: boolean,\n\tinitData: Object,\n\ttitle: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class ConfigItem\n{\n\t#active: boolean;\n\t#enableSync: boolean;\n\t#initData: Object = {};\n\t#entityTypeId: number;\n\t#title: string;\n\n\tconstructor(params: ConfigItemData)\n\t{\n\t\tthis.#entityTypeId = Number(params.entityTypeId);\n\t\tthis.#active = this.#internalizeBooleanValue(params.active);\n\t\tthis.#enableSync = this.#internalizeBooleanValue(params.enableSync);\n\t\tif (Type.isPlainObject(params.initData))\n\t\t{\n\t\t\tthis.#initData = params.initData;\n\t\t}\n\t\tthis.#title = String(params.title);\n\t}\n\n\t#internalizeBooleanValue(value: any): boolean\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\tif (Type.isString(value))\n\t\t{\n\t\t\treturn (value === 'Y');\n\t\t}\n\n\t\treturn Boolean(value);\n\t}\n\n\texternalize(): Object\n\t{\n\t\treturn {\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\ttitle: this.getTitle(),\n\t\t\tinitData: this.getInitData(),\n\t\t\tactive: this.isActive() ? \"Y\" : \"N\",\n\t\t\tenableSync: this.isEnableSync() ? \"Y\" : \"N\",\n\t\t};\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.#active;\n\t}\n\n\tsetActive(active: boolean): ConfigItem\n\t{\n\t\tthis.#active = active;\n\n\t\treturn this;\n\t}\n\n\tisEnableSync(): boolean\n\t{\n\t\treturn this.#enableSync;\n\t}\n\n\tsetEnableSync(enableSync: boolean): ConfigItem\n\t{\n\t\tthis.#enableSync = enableSync;\n\n\t\treturn this;\n\t}\n\n\tgetInitData(): Object\n\t{\n\t\treturn this.#initData || {};\n\t}\n\n\tsetInitData(data: Object): ConfigItem\n\t{\n\t\tthis.#initData = data;\n\n\t\treturn this;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tsetTitle(title: string): ConfigItem\n\t{\n\t\tthis.#title = title;\n\n\t\treturn this;\n\t}\n}\n","import type { ConfigItemData } from \"./config-item\";\nimport { ConfigItem } from \"./config-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Scheme } from \"./scheme\";\nimport { Type } from \"main.core\";\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Config\n{\n\t#entityTypeId: number;\n\t#items: ConfigItem[] = [];\n\t#scheme: Scheme;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\titems: ConfigItem[],\n\t\tscheme: Scheme\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof ConfigItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'ConfigItem is invalid in Config constructor. Expected instance of ConfigItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (scheme instanceof Scheme)\n\t\t{\n\t\t\tthis.#scheme = scheme;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Scheme is invalid in Config constructor. Expected instance of Scheme, got ' + (typeof scheme));\n\t\t}\n\t}\n\n\tstatic create(entityTypeId: number, items: ConfigItemData[], scheme: Scheme)\n\t{\n\t\tconst configItems = [];\n\t\titems.forEach((item: ConfigItemData) => {\n\t\t\tconfigItems.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn new Config(entityTypeId, configItems, scheme);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetItems(): ConfigItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetScheme(): Scheme\n\t{\n\t\treturn this.#scheme;\n\t}\n\n\tupdateFromSchemeItem(schemeItem: SchemeItem = null): Config\n\t{\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tschemeItem = this.getScheme().getCurrentItem();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getScheme().setCurrentItemId(schemeItem.getId());\n\t\t}\n\t\tconst activeEntityTypeIds = schemeItem.getEntityTypeIds();\n\n\t\tthis.#items.forEach((item) => {\n\t\t\tconst isActive = activeEntityTypeIds.indexOf(item.getEntityTypeId()) > -1;\n\t\t\titem.setEnableSync(isActive);\n\t\t\titem.setActive(isActive);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetItemByEntityTypeId(entityTypeId: number): ?ConfigItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getEntityTypeId() === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\texternalize(): Object\n\t{\n\t\tconst data = {};\n\n\t\tthis.getItems().forEach((item) => {\n\t\t\tdata[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.externalize();\n\t\t});\n\n\t\treturn data;\n\t}\n\n\tupdateItems(items: ConfigItemData[]): self\n\t{\n\t\tthis.#items = [];\n\t\titems.forEach((item) => {\n\t\t\tthis.#items.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn this;\n\t}\n}\n","import { Config } from \"./config\";\nimport type { ConfigItemData } from \"./config-item\";\nimport { ConfigItem } from \"./config-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { CategoryList } from \"crm.category-list\";\nimport { CategoryModel } from \"crm.category-model\";\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Popup } from \"main.popup\";\nimport { ajax as Ajax, Loc, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport 'ui.forms';\n\ndeclare type CategorySelectResult = {\n\tisCanceled?: boolean,\n\tcategory?: CategoryModel|null,\n};\n\ndeclare type CollectAdditionalDataResult = {\n\tisCanceled: boolean,\n};\n\nexport type ConverterParams = {\n\tserviceUrl: string,\n\toriginUrl: string,\n\tisRedirectToDetailPageEnabled?: boolean,\n\tmessages: Object<string, string>\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Converter\n{\n\t#entityTypeId: number;\n\t#entityId: number;\n\t#config: Config;\n\t#params: ConverterParams;\n\t#isProgress: boolean;\n\t#isSynchronisationAllowed: boolean;\n\t#fieldsSynchronizer: BX.CrmEntityFieldSynchronizationEditor|null;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\tconfig: Config,\n\t\tparams?: ConverterParams,\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\t\tif (config instanceof Config)\n\t\t{\n\t\t\tthis.#config = config;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Config is invalid in Converter constructor. Expected instance of Config, got ' + (typeof config));\n\t\t}\n\t\tthis.#params = params ?? {};\n\n\t\tthis.#isProgress = false;\n\t\tthis.#isSynchronisationAllowed = false;\n\t\tthis.#entityId = 0;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\tgetServiceUrl()\n\t{\n\t\tlet serviceUrl = this.#params.serviceUrl;\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst additionalParams = {\n\t\t\taction: \"convert\",\n\t\t};\n\n\t\tthis.getConfig().getItems().forEach((item: ConfigItem) => {\n\t\t\tadditionalParams[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.isActive() ? \"Y\" : \"N\";\n\t\t});\n\n\t\treturn BX.util.add_url_param(serviceUrl, additionalParams);\n\t}\n\n\tgetOriginUrl(): ?string\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"originUrl\"))\n\t\t{\n\t\t\treturn String(this.#params.originUrl);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisRedirectToDetailPageEnabled(): boolean\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"isRedirectToDetailPageEnabled\"))\n\t\t{\n\t\t\treturn this.#params.isRedirectToDetailPageEnabled;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tconvert(entityId: number, data?: Object): void\n\t{\n\t\tthis.#entityId = entityId;\n\t\tthis.data = data;\n\t\tconst schemeItem = this.#config.getScheme().getCurrentItem();\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tconsole.error('Scheme is not found');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#collectAdditionalData(schemeItem).then((result: CollectAdditionalDataResult) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#request();\n\n\t\t}).catch((error) => {\n\t\t\tif (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t#request(): void\n\t{\n\t\tconst serviceUrl = this.getServiceUrl();\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\tconsole.error('Convert endpoint is not specifier');\n\t\t\treturn;\n\t\t}\n\t\tif (this.#isProgress)\n\t\t{\n\t\t\tconsole.error('Another request is in progress');\n\t\t\treturn;\n\t\t}\n\t\tthis.#isProgress = true;\n\t\tAjax({\n\t\t\turl: serviceUrl,\n\t\t\tmethod: \"POST\",\n\t\t\tdataType: \"json\",\n\t\t\tdata:\n\t\t\t\t{\n\t\t\t\t\t\"MODE\": \"CONVERT\",\n\t\t\t\t\t\"ENTITY_ID\": this.#entityId,\n\t\t\t\t\t\"ENABLE_SYNCHRONIZATION\": this.#isSynchronisationAllowed ? \"Y\" : \"N\",\n\t\t\t\t\t\"ENABLE_REDIRECT_TO_SHOW\": this.isRedirectToDetailPageEnabled ? \"Y\" : \"N\",\n\t\t\t\t\t\"CONFIG\": this.getConfig().externalize(),\n\t\t\t\t\t\"CONTEXT\": this.data,\n\t\t\t\t\t\"ORIGIN_URL\": this.getOriginUrl()\n\t\t\t\t},\n\t\t\tonsuccess: this.#onRequestSuccess.bind(this),\n\t\t\tonfailure: this.#onRequestError.bind(this),\n\t\t});\n\t}\n\n\t#onRequestSuccess(response)\n\t{\n\t\t// todo return promise\n\t\tthis.#isProgress = false;\n\t\tif (response.ERROR)\n\t\t{\n\t\t\tMessageBox.alert(response.ERROR.MESSAGE || \"Error during conversion\");\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isPlainObject(response.REQUIRED_ACTION))\n\t\t{\n\t\t\treturn this.#processRequiredAction(response.REQUIRED_ACTION);\n\t\t}\n\n\t\tconst data = Type.isPlainObject(response.DATA) ? response.DATA : {};\n\t\tif (!data)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst redirectUrl = Type.isString(data.URL) ? data.URL : \"\";\n\t\tlet isRedirected = false;\n\t\tif (data.IS_FINISHED && data.IS_FINISHED === \"Y\")\n\t\t{\n\t\t\tthis.data = {};\n\n\t\t\tisRedirected = this.#emitConvertedEvent(redirectUrl);\n\t\t}\n\n\t\tif(redirectUrl !== \"\" && !isRedirected)\n\t\t{\n\t\t\tBX.Crm.Page.open(redirectUrl);\n\t\t}\n\t\telse if(!(isRedirected && window.top === window))\n\t\t{\n\t\t\t// window.location.reload();\n\t\t}\n\t}\n\n\t#onRequestError(error: string)\n\t{\n\t\tthis.#isProgress = false;\n\t\tMessageBox.alert(error);\n\t}\n\n\t#collectAdditionalData(schemeItem: SchemeItem): Promise<CollectAdditionalDataResult,string>\n\t{\n\t\tconst config = this.getConfig();\n\n\t\tconst promises = [];\n\n\t\tschemeItem.getEntityTypeIds().forEach((entityTypeId) => {\n\t\t\tpromises.push(() => {\n\t\t\t\treturn this.#getCategoryForEntityTypeId(entityTypeId);\n\t\t\t});\n\t\t});\n\n\t\tlet result: CollectAdditionalDataResult = {\n\t\t\tisCanceled: false,\n\t\t};\n\t\tconst promiseIterator = ((promises: Array, index: number = 0) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (result.isCanceled || !promises[index])\n\t\t\t\t{\n\t\t\t\t\tresolve(result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpromises[index]().then((categoryResult: CategorySelectResult) => {\n\t\t\t\t\tif (categoryResult.isCanceled)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.isCanceled = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (categoryResult.category)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityTypeId = categoryResult.category.getEntityTypeId();\n\t\t\t\t\t\tconst configItem = config.getItemByEntityTypeId(entityTypeId);\n\t\t\t\t\t\tif (!configItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst initData = configItem.getInitData();\n\t\t\t\t\t\tinitData.categoryId = categoryResult.category.getId();\n\t\t\t\t\t\tconfigItem.setInitData(initData);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(promiseIterator(promises, ++index));\n\t\t\t\t});\n\t\t\t})\n\t\t});\n\n\t\treturn promiseIterator(promises);\n\t}\n\n\t#getCategoryForEntityTypeId(entityTypeId): Promise<CategorySelectResult, string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst configItem = this.getConfig().getItemByEntityTypeId(entityTypeId);\n\t\t\tif (!configItem)\n\t\t\t{\n\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.#isNeedToLoadCategories(entityTypeId))\n\t\t\t{\n\t\t\t\tCategoryList.Instance.getItems(entityTypeId).then((categories: CategoryModel[]) => {\n\t\t\t\t\tif (categories.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showCategorySelector(categories, configItem.getTitle()).then(resolve).catch(reject);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tisCanceled: false,\n\t\t\t\t\t\t\tcategory: categories[0],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}).catch(reject);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve({isCanceled:false, category:null});\n\t\t\t}\n\t\t});\n\t}\n\n\t#isNeedToLoadCategories(entityTypeId: number): boolean\n\t{\n\t\t// todo pass isCategoriesEnabled from backend\n\t\treturn (\n\t\t\tentityTypeId === BX.CrmEntityType.enumeration.deal\n\t\t\t|| BX.CrmEntityType.isDynamicTypeByTypeId(entityTypeId)\n\t\t);\n\t}\n\n\t#showCategorySelector(categories: CategoryModel[], title: string): Promise<CategorySelectResult,string>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst categorySelectorContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"crm-converter-category-selector ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"crm-converter-category-selector-label ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage(\"CRM_COMMON_CATEGORY\")}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"crm-converter-category-selector-select ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\"></select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = categorySelectorContent.querySelector('select');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tselect.appendChild(Tag.render`<option value=\"${category.getId()}\">${Text.encode(category.getName())}</option>`);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: Loc.getMessage(\"CRM_CONVERSION_CATEGORY_SELECTOR_TITLE\", {\n\t\t\t\t\t'#ENTITY#': Text.encode(title),\n\t\t\t\t}),\n\t\t\t\tcontent: categorySelectorContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_SAVE\"),\n\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tconst value = Array.from(select.selectedOptions)[0].value;\n\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tfor (const category of categories)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (category.getId() === Number(value))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tresolve({category});\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconsole.error('Selected category not found');\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_CANCEL\"),\n\t\t\t\t\t\tcolor: ButtonColor.LIGHT,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\t#processRequiredAction(action: Object): void\n\t{\n\t\tconst name = String(action.NAME);\n\t\tconst data = Type.isPlainObject(action.DATA) ? action.DATA : {};\n\n\t\tif(name === \"SYNCHRONIZE\")\n\t\t{\n\t\t\tlet newConfig: ConfigItemData[]|null = null;\n\t\t\tif (Type.isArray(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = data.CONFIG;\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = Object.values(data.CONFIG);\n\t\t\t}\n\n\t\t\tif (newConfig)\n\t\t\t{\n\t\t\t\tthis.#config.updateItems(newConfig);\n\t\t\t}\n\n\t\t\tthis.#getFieldsSynchronizer(Type.isArray(data.FIELD_NAMES) ? data.FIELD_NAMES : []).show();\n\n\t\t\treturn;\n\t\t}\n\t\tif(name === \"CORRECT\")\n\t\t{\n\t\t\tif(Type.isPlainObject(data.CHECK_ERRORS))\n\t\t\t{\n\t\t\t\t// todo this is actual for leads only.\n\t\t\t\t// this.openEntityEditorDialog(\n\t\t\t\t// \t{\n\t\t\t\t// \t\ttitle: manager ? manager.getMessage(\"checkErrorTitle\") : null,\n\t\t\t\t// \t\thelpData: { text: manager.getMessage(\"checkErrorHelp\"), code: manager.getMessage(\"checkErrorHelpArticleCode\") },\n\t\t\t\t// \t\tfieldNames: Object.keys(checkErrors),\n\t\t\t\t// \t\tinitData: BX.prop.getObject(data, \"EDITOR_INIT_DATA\", null),\n\t\t\t\t// \t\tcontext: BX.prop.getObject(data, \"CONTEXT\", null)\n\t\t\t\t// \t}\n\t\t\t\t// );\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t#getFieldsSynchronizer(fieldNames: string[])\n\t{\n\t\tif (this.#fieldsSynchronizer)\n\t\t{\n\t\t\tthis.#fieldsSynchronizer.setConfig(this.#config.externalize());\n\t\t\tthis.#fieldsSynchronizer.setFieldNames(fieldNames);\n\n\t\t\treturn this.#fieldsSynchronizer;\n\t\t}\n\n\t\tthis.#fieldsSynchronizer = BX.CrmEntityFieldSynchronizationEditor.create(\n\t\t\t\"crm_converter_fields_synchronizer_\" + this.getEntityTypeId(),\n\t\t\t{\n\t\t\t\tconfig: this.#config.externalize(),\n\t\t\t\ttitle: this.#getMessage(\"dialogTitle\"),\n\t\t\t\tfieldNames: fieldNames,\n\t\t\t\tlegend: this.#getMessage(\"syncEditorLegend\"),\n\t\t\t\tfieldListTitle: this.#getMessage(\"syncEditorFieldListTitle\"),\n\t\t\t\tentityListTitle: this.#getMessage(\"syncEditorEntityListTitle\"),\n\t\t\t\tcontinueButton: this.#getMessage(\"continueButton\"),\n\t\t\t\tcancelButton: this.#getMessage(\"cancelButton\"),\n\t\t\t}\n\t\t);\n\t\tthis.#fieldsSynchronizer.addClosingListener((sender, args) => {\n\t\t\tif(!(Type.isBoolean(args[\"isCanceled\"]) && args[\"isCanceled\"] === false))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#isSynchronisationAllowed = true;\n\t\t\tthis.#config.updateItems(Object.values(this.#fieldsSynchronizer.getConfig()));\n\t\t\tthis.#request();\n\t\t});\n\n\t\treturn this.#fieldsSynchronizer;\n\t}\n\n\t#getMessage(phraseId): string\n\t{\n\t\tif (!this.#params.messages)\n\t\t{\n\t\t\tthis.#params.messages = {};\n\t\t}\n\t\treturn this.#params.messages[phraseId] || phraseId;\n\t}\n\n\t#emitConvertedEvent(redirectUrl): boolean\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\n\t\tconst eventArgs = {\n\t\t\tentityTypeId,\n\t\t\tentityTypeName: BX.CrmEntityType.resolveName(entityTypeId),\n\t\t\tentityId: this.#entityId,\n\t\t\tredirectUrl,\n\t\t\tisRedirected: false,\n\t\t};\n\n\t\tvar current = BX.Crm.Page.getTopSlider();\n\t\tif(current)\n\t\t{\n\t\t\teventArgs[\"sliderUrl\"] = current.getUrl();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"Crm.EntityConverter.Converted\", [ this, eventArgs ]);\n\t\tBX.localStorage.set(\"onCrmEntityConvert\", eventArgs, 10);\n\n\t\tthis.getConfig().getItems().forEach((item) => {\n\t\t\tif (item.isActive())\n\t\t\t{\n\t\t\t\tEventEmitter.emit('Crm.EntityConverter.SingleConverted', {\n\t\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(item.getEntityTypeId()),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn eventArgs[\"isRedirected\"];\n\t}\n}\n","import { Event, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuManager } from \"main.popup\";\nimport { Converter } from \"./converter\";\nimport { SchemeItem } from \"./scheme-item\";\n\n/**\n * @memberOf BX.Crm.Conversion\n * @mixes EventEmitter\n */\nexport class SchemeSelector\n{\n\t#entityId: number;\n\t#container: HTMLElement;\n\t#menuButton: HTMLElement;\n\t#label: HTMLElement;\n\t#converter: Converter;\n\t#menuId: string;\n\t#isAutoConversionEnabled: boolean;\n\n\tconstructor(\n\t\tconverter: Converter,\n\t\tparams: {\n\t\t\tentityId: number,\n\t\t\tcontainerId: string,\n\t\t\tbuttonId: string,\n\t\t\tlabelId: string,\n\t\t}\n\t) {\n\t\tthis.#converter = converter;\n\t\tthis.#entityId = Number(params.entityId);\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tthis.#menuButton = document.getElementById(params.buttonId);\n\t\tthis.#label = document.getElementById(params.labelId);\n\t\tthis.#menuId = 'crm_conversion_scheme_selector_' + this.#entityId + '_' + Text.getRandom();\n\t\tthis.#isAutoConversionEnabled = false;\n\n\t\tif (!this.#entityId || !this.#container || !this.#menuButton || !this.#label || !this.#converter)\n\t\t{\n\t\t\tconsole.error('Error SchemeSelector initializing', this);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initUI();\n\t\t\tthis.#bindEvents();\n\t\t}\n\n\t\tEventEmitter.makeObservable(this, 'BX.Crm.Conversion');\n\t}\n\n\tenableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = true;\n\t}\n\n\tdisableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = false;\n\t}\n\n\t#initUI()\n\t{\n\t\tconst currentSchemeItem: SchemeItem|null = this.#converter.getConfig().getScheme().getCurrentItem();\n\t\tif (currentSchemeItem)\n\t\t{\n\t\t\tthis.#label.innerText = currentSchemeItem.getPhrase();\n\t\t}\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(this.#container, \"click\", this.#handleContainerClick.bind(this));\n\t\tEvent.bind(this.#menuButton, \"click\", this.#handleMenuButtonClick.bind(this));\n\t}\n\n\t#handleContainerClick()\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onContainerClick', event);\n\t\tthis.#converter.getConfig().updateFromSchemeItem();\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n\n\t#handleMenuButtonClick()\n\t{\n\t\tthis.#showMenu();\n\t}\n\n\t#showMenu()\n\t{\n\t\tconst anchorPos = BX.pos(this.#container);\n\n\t\tMenuManager.show({\n\t\t\tid: this.#menuId,\n\t\t\tbindElement: this.#menuButton,\n\t\t\titems: this.#getMenuItems(),\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\toffsetLeft: -anchorPos['width'],\n\t\t})\n\t}\n\n\t#closeMenu()\n\t{\n\t\tMenuManager.destroy(this.#menuId);\n\t}\n\n\t#getMenuItems()\n\t{\n\t\tconst items = [];\n\n\t\tthis.#converter.getConfig().getScheme().getItems().forEach((item: SchemeItem) => {\n\t\t\titems.push({\n\t\t\t\ttext: Text.encode(item.getPhrase()),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#handleItemClick(item);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#handleItemClick(item: SchemeItem)\n\t{\n\t\tthis.#closeMenu();\n\t\tthis.#label.innerText = item.getPhrase();\n\t\tthis.#converter.getConfig().updateFromSchemeItem(item);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onSchemeSelected', event);\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n}\n","import type { ConverterParams } from \"./converter\";\nimport { Converter } from \"./converter\";\nimport { Config } from \"./config\";\nimport type { SchemeData } from \"./scheme\";\nimport { Scheme } from \"./scheme\";\nimport { Reflection } from \"main.core\";\nimport type { ConfigItemData } from \"./config-item\";\n\nlet instance = null;\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Manager\n{\n\t#converters: Object<number, Converter>;\n\n\tconstructor() {\n\t\tthis.#converters = {};\n\t}\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.Conversion.Manager'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.Conversion.Manager.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitializeConverter(\n\t\tentityTypeId: number,\n\t\tparams: {\n\t\t\tconfigItems: ConfigItemData[],\n\t\t\tscheme: SchemeData,\n\t\t\tparams: ConverterParams,\n\t\t}\n\t): Converter\n\t{\n\t\tconst config = Config.create(entityTypeId, params.configItems, Scheme.create(params.scheme));\n\n\t\tthis.#converters[entityTypeId] = new Converter(entityTypeId, config, params.params);\n\n\t\treturn this.#converters[entityTypeId];\n\t}\n\n\tgetConverter(entityTypeId: number): ?Converter\n\t{\n\t\treturn this.#converters[entityTypeId] || null;\n\t}\n}\n","import {Scheme} from './scheme';\nimport {SchemeSelector} from './scheme-selector';\nimport {Config} from './config';\nimport {Converter} from './converter';\nimport {Manager} from './manager';\n\n/**\n * @memberOf BX.Crm\n */\nexport const Conversion = {\n\tScheme,\n\tConfig,\n\tConverter,\n\tManager,\n\tSchemeSelector,\n};"],"names":["SchemeItem","params","String","id","name","phrase","Type","isArray","entityTypeIds","forEach","entityTypeId","push","Number","Scheme","currentItemId","items","_classPrivateFieldInitSpec","isNull","item","console","error","length","getItemById","itemId","getId","getEntityTypeIds","Array","from","schemeItems","ConfigItem","active","enableSync","isPlainObject","initData","title","getEntityTypeId","getTitle","getInitData","isActive","isEnableSync","data","value","isBoolean","isString","Boolean","Config","scheme","schemeItem","getScheme","getCurrentItem","setCurrentItemId","activeEntityTypeIds","indexOf","setEnableSync","setActive","getItems","BX","CrmEntityType","resolveName","toLowerCase","externalize","configItems","Converter","config","_classPrivateMethodInitSpec","serviceUrl","additionalParams","action","getConfig","util","add_url_param","hasOwnProperty","originUrl","isRedirectToDetailPageEnabled","entityId","_classPrivateMethodGet","then","result","isCanceled","getServiceUrl","Ajax","url","method","dataType","getOriginUrl","onsuccess","bind","onfailure","response","ERROR","MessageBox","alert","MESSAGE","REQUIRED_ACTION","DATA","redirectUrl","URL","isRedirected","IS_FINISHED","Crm","Page","open","window","top","promises","promiseIterator","index","Promise","resolve","reject","categoryResult","category","configItem","getItemByEntityTypeId","categoryId","setInitData","CategoryList","Instance","categories","enumeration","deal","isDynamicTypeByTypeId","categorySelectorContent","Tag","render","Loc","getMessage","select","querySelector","appendChild","Text","encode","getName","popup","Popup","titleBar","content","closeByEsc","closeIcon","buttons","Button","text","color","ButtonColor","SUCCESS","onclick","selectedOptions","destroy","LIGHT","events","onClose","show","NAME","newConfig","CONFIG","Object","values","updateItems","FIELD_NAMES","CHECK_ERRORS","fieldNames","setConfig","setFieldNames","CrmEntityFieldSynchronizationEditor","create","legend","fieldListTitle","entityListTitle","continueButton","cancelButton","addClosingListener","sender","args","phraseId","messages","eventArgs","entityTypeName","current","getTopSlider","getUrl","onCustomEvent","localStorage","set","EventEmitter","emit","SchemeSelector","converter","document","getElementById","containerId","buttonId","labelId","getRandom","makeObservable","currentSchemeItem","innerText","getPhrase","Event","event","BaseEvent","updateFromSchemeItem","getData","convert","anchorPos","pos","MenuManager","bindElement","cacheable","offsetLeft","instance","Manager","Reflection","getClass","Conversion"],"mappings":"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"}