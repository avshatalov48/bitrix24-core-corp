{"version":3,"file":"conversion.bundle.js","sources":["../src/scheme-item.js","../src/scheme.js","../src/config-item.js","../src/config.js","../src/converter.js","../src/scheme-selector.js","../src/manager.js","../src/index.js"],"sourcesContent":["import { Type } from \"main.core\";\n\nexport type SchemeItemData = {\n\tid: string,\n\tname: string,\n\tentityTypeIds: number[],\n\tphrase: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class SchemeItem\n{\n\t#id: string;\n\t#name: string;\n\t#entityTypeIds: number[];\n\t#phrase: string;\n\n\tconstructor(params: SchemeItemData)\n\t{\n\t\tthis.#id = String(params.id);\n\t\tthis.#name = String(params.name);\n\t\tthis.#phrase = String(params.phrase);\n\n\t\tthis.#entityTypeIds = [];\n\t\tif (Type.isArray(params.entityTypeIds))\n\t\t{\n\t\t\tparams.entityTypeIds.forEach((entityTypeId) => {\n\t\t\t\tthis.#entityTypeIds.push(Number(entityTypeId));\n\t\t\t});\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.#name;\n\t}\n\n\tgetEntityTypeIds(): number[]\n\t{\n\t\treturn this.#entityTypeIds;\n\t}\n\n\tgetPhrase(): string\n\t{\n\t\treturn this.#phrase;\n\t}\n}\n","import type { SchemeItemData } from \"./scheme-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Type } from \"main.core\";\n\nexport type SchemeData = {\n\tcurrentItemId: string,\n\titems: SchemeItemData[],\n}\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Scheme\n{\n\t#currentItemId: string;\n\t#items: SchemeItem[] = [];\n\n\tconstructor(currentItemId: string|null, items: SchemeItem[])\n\t{\n\t\tthis.#currentItemId = Type.isNull(currentItemId) ? currentItemId : String(currentItemId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof SchemeItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'SchemeItem is invalid in Scheme constructor. Expected instance of SchemeItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic create(params: SchemeData)\n\t{\n\t\tconst schemeItems = [];\n\t\tparams.items.forEach((item: SchemeItemData) => {\n\t\t\tschemeItems.push(new SchemeItem(item));\n\t\t});\n\n\t\treturn new Scheme(params.currentItemId, schemeItems);\n\t}\n\n\tgetCurrentItem(): ?SchemeItem\n\t{\n\t\tif (!this.#items || !this.#items.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst item = this.getItemById(this.#currentItemId);\n\n\t\treturn item || this.#items[0];\n\t}\n\n\tsetCurrentItemId(currentItemId: string)\n\t{\n\t\tthis.#currentItemId = currentItemId;\n\t}\n\n\tgetItems(): SchemeItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetItemById(itemId: string): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getId() === itemId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetItemForSingleEntityTypeId(entityTypeId: number): ?SchemeItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tconst entityTypeIds = item.getEntityTypeIds();\n\t\t\tif (entityTypeIds.length === 1 && Array.from(entityTypeIds)[0] === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Type } from \"main.core\";\n\nexport type ConfigItemData = {\n\tentityTypeId: number,\n\tactive: boolean,\n\tenableSync: boolean,\n\tinitData: Object,\n\ttitle: string,\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class ConfigItem\n{\n\t#active: boolean;\n\t#enableSync: boolean;\n\t#initData: Object = {};\n\t#entityTypeId: number;\n\t#title: string;\n\n\tconstructor(params: ConfigItemData)\n\t{\n\t\tthis.#entityTypeId = Number(params.entityTypeId);\n\t\tthis.#active = this.#internalizeBooleanValue(params.active);\n\t\tthis.#enableSync = this.#internalizeBooleanValue(params.enableSync);\n\t\tif (Type.isPlainObject(params.initData))\n\t\t{\n\t\t\tthis.#initData = params.initData;\n\t\t}\n\t\tthis.#title = String(params.title);\n\t}\n\n\t#internalizeBooleanValue(value: any): boolean\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\tif (Type.isString(value))\n\t\t{\n\t\t\treturn (value === 'Y');\n\t\t}\n\n\t\treturn Boolean(value);\n\t}\n\n\texternalize(): Object\n\t{\n\t\treturn {\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\ttitle: this.getTitle(),\n\t\t\tinitData: this.getInitData(),\n\t\t\tactive: this.isActive() ? \"Y\" : \"N\",\n\t\t\tenableSync: this.isEnableSync() ? \"Y\" : \"N\",\n\t\t};\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.#active;\n\t}\n\n\tsetActive(active: boolean): ConfigItem\n\t{\n\t\tthis.#active = active;\n\n\t\treturn this;\n\t}\n\n\tisEnableSync(): boolean\n\t{\n\t\treturn this.#enableSync;\n\t}\n\n\tsetEnableSync(enableSync: boolean): ConfigItem\n\t{\n\t\tthis.#enableSync = enableSync;\n\n\t\treturn this;\n\t}\n\n\tgetInitData(): Object\n\t{\n\t\treturn this.#initData || {};\n\t}\n\n\tsetInitData(data: Object): ConfigItem\n\t{\n\t\tthis.#initData = data;\n\n\t\treturn this;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tsetTitle(title: string): ConfigItem\n\t{\n\t\tthis.#title = title;\n\n\t\treturn this;\n\t}\n}\n","import type { ConfigItemData } from \"./config-item\";\nimport { ConfigItem } from \"./config-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { Scheme } from \"./scheme\";\nimport { Type } from \"main.core\";\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Config\n{\n\t#entityTypeId: number;\n\t#items: ConfigItem[] = [];\n\t#scheme: Scheme;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\titems: ConfigItem[],\n\t\tscheme: Scheme\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.forEach((item) => {\n\t\t\t\tif (item instanceof ConfigItem)\n\t\t\t\t{\n\t\t\t\t\tthis.#items.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'ConfigItem is invalid in Config constructor. Expected instance of ConfigItem, got ' + (typeof item)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (scheme instanceof Scheme)\n\t\t{\n\t\t\tthis.#scheme = scheme;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Scheme is invalid in Config constructor. Expected instance of Scheme, got ' + (typeof scheme));\n\t\t}\n\t}\n\n\tstatic create(entityTypeId: number, items: ConfigItemData[], scheme: Scheme)\n\t{\n\t\tconst configItems = [];\n\t\titems.forEach((item: ConfigItemData) => {\n\t\t\tconfigItems.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn new Config(entityTypeId, configItems, scheme);\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetItems(): ConfigItem[]\n\t{\n\t\treturn this.#items;\n\t}\n\n\tgetScheme(): Scheme\n\t{\n\t\treturn this.#scheme;\n\t}\n\n\tupdateFromSchemeItem(schemeItem: SchemeItem = null): Config\n\t{\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tschemeItem = this.getScheme().getCurrentItem();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getScheme().setCurrentItemId(schemeItem.getId());\n\t\t}\n\t\tconst activeEntityTypeIds = schemeItem.getEntityTypeIds();\n\n\t\tthis.#items.forEach((item) => {\n\t\t\tconst isActive = activeEntityTypeIds.indexOf(item.getEntityTypeId()) > -1;\n\t\t\titem.setEnableSync(isActive);\n\t\t\titem.setActive(isActive);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetItemByEntityTypeId(entityTypeId: number): ?ConfigItem\n\t{\n\t\tfor (const item of this.#items)\n\t\t{\n\t\t\tif (item.getEntityTypeId() === entityTypeId)\n\t\t\t{\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\texternalize(): Object\n\t{\n\t\tconst data = {};\n\n\t\tthis.getItems().forEach((item) => {\n\t\t\tdata[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.externalize();\n\t\t});\n\n\t\treturn data;\n\t}\n\n\tupdateItems(items: ConfigItemData[]): self\n\t{\n\t\tthis.#items = [];\n\t\titems.forEach((item) => {\n\t\t\tthis.#items.push(new ConfigItem(item))\n\t\t});\n\n\t\treturn this;\n\t}\n}\n","import { Config } from \"./config\";\nimport type { ConfigItemData } from \"./config-item\";\nimport { ConfigItem } from \"./config-item\";\nimport { SchemeItem } from \"./scheme-item\";\nimport { CategoryList } from \"crm.category-list\";\nimport { CategoryModel } from \"crm.category-model\";\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Popup } from \"main.popup\";\nimport { ajax as Ajax, Loc, Tag, Text, Type } from 'main.core';\nimport 'ui.forms';\n\ndeclare type CategorySelectResult = {\n\tisCanceled?: boolean,\n\tcategory?: CategoryModel|null,\n};\n\ndeclare type CollectAdditionalDataResult = {\n\tisCanceled: boolean,\n};\n\nexport type ConverterParams = {\n\tserviceUrl: string,\n\toriginUrl: string,\n\tisRedirectToDetailPageEnabled?: boolean,\n\tmessages: Object<string, string>\n};\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Converter\n{\n\t#entityTypeId: number;\n\t#entityId: number;\n\t#config: Config;\n\t#params: ConverterParams;\n\t#isProgress: boolean;\n\t#isSynchronisationAllowed: boolean;\n\t#fieldsSynchronizer: BX.CrmEntityFieldSynchronizationEditor|null;\n\n\tconstructor(\n\t\tentityTypeId: number,\n\t\tconfig: Config,\n\t\tparams?: ConverterParams,\n\t)\n\t{\n\t\tthis.#entityTypeId = Number(entityTypeId);\n\t\tif (config instanceof Config)\n\t\t{\n\t\t\tthis.#config = config;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Config is invalid in Converter constructor. Expected instance of Config, got ' + (typeof config));\n\t\t}\n\t\tthis.#params = params ?? {};\n\n\t\tthis.#isProgress = false;\n\t\tthis.#isSynchronisationAllowed = false;\n\t\tthis.#entityId = 0;\n\t}\n\n\tgetEntityTypeId(): number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\tgetServiceUrl()\n\t{\n\t\tlet serviceUrl = this.#params.serviceUrl;\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst additionalParams = {\n\t\t\taction: \"convert\",\n\t\t};\n\n\t\tthis.getConfig().getItems().forEach((item: ConfigItem) => {\n\t\t\tadditionalParams[BX.CrmEntityType.resolveName(item.getEntityTypeId()).toLowerCase()] = item.isActive() ? \"Y\" : \"N\";\n\t\t});\n\n\t\treturn BX.util.add_url_param(serviceUrl, additionalParams);\n\t}\n\n\tgetOriginUrl(): ?string\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"originUrl\"))\n\t\t{\n\t\t\treturn String(this.#params.originUrl);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisRedirectToDetailPageEnabled(): boolean\n\t{\n\t\tif (this.#params && this.#params.hasOwnProperty(\"isRedirectToDetailPageEnabled\"))\n\t\t{\n\t\t\treturn this.#params.isRedirectToDetailPageEnabled;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tconvert(entityId: number, data?: Object): void\n\t{\n\t\tthis.#entityId = entityId;\n\t\tthis.data = data;\n\t\tconst schemeItem = this.#config.getScheme().getCurrentItem();\n\t\tif (!schemeItem)\n\t\t{\n\t\t\tconsole.error('Scheme is not found');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#collectAdditionalData(schemeItem).then((result: CollectAdditionalDataResult) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#request();\n\n\t\t}).catch((error) => {\n\t\t\tif (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t#request(): void\n\t{\n\t\tconst serviceUrl = this.getServiceUrl();\n\t\tif (!serviceUrl)\n\t\t{\n\t\t\tconsole.error('Convert endpoint is not specifier');\n\t\t\treturn;\n\t\t}\n\t\tif (this.#isProgress)\n\t\t{\n\t\t\tconsole.error('Another request is in progress');\n\t\t\treturn;\n\t\t}\n\t\tthis.#isProgress = true;\n\t\tAjax({\n\t\t\turl: serviceUrl,\n\t\t\tmethod: \"POST\",\n\t\t\tdataType: \"json\",\n\t\t\tdata:\n\t\t\t\t{\n\t\t\t\t\t\"MODE\": \"CONVERT\",\n\t\t\t\t\t\"ENTITY_ID\": this.#entityId,\n\t\t\t\t\t\"ENABLE_SYNCHRONIZATION\": this.#isSynchronisationAllowed ? \"Y\" : \"N\",\n\t\t\t\t\t\"ENABLE_REDIRECT_TO_SHOW\": this.isRedirectToDetailPageEnabled ? \"Y\" : \"N\",\n\t\t\t\t\t\"CONFIG\": this.getConfig().externalize(),\n\t\t\t\t\t\"CONTEXT\": this.data,\n\t\t\t\t\t\"ORIGIN_URL\": this.getOriginUrl()\n\t\t\t\t},\n\t\t\tonsuccess: this.#onRequestSuccess.bind(this),\n\t\t\tonfailure: this.#onRequestError.bind(this),\n\t\t});\n\t}\n\n\t#onRequestSuccess(response)\n\t{\n\t\t// todo return promise\n\t\tthis.#isProgress = false;\n\t\tif (response.ERROR)\n\t\t{\n\t\t\tMessageBox.alert(response.ERROR.MESSAGE || \"Error during conversion\");\n\t\t\treturn;\n\t\t}\n\t\tif (Type.isPlainObject(response.REQUIRED_ACTION))\n\t\t{\n\t\t\treturn this.#processRequiredAction(response.REQUIRED_ACTION);\n\t\t}\n\n\t\tconst data = Type.isPlainObject(response.DATA) ? response.DATA : {};\n\t\tif (!data)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst redirectUrl = Type.isString(data.URL) ? data.URL : \"\";\n\t\tlet isRedirected = false;\n\t\tif (data.IS_FINISHED && data.IS_FINISHED === \"Y\")\n\t\t{\n\t\t\tthis.data = {};\n\n\t\t\tisRedirected = this.#emitConvertedEvent(redirectUrl);\n\t\t}\n\n\t\tif(redirectUrl !== \"\" && !isRedirected)\n\t\t{\n\t\t\tBX.Crm.Page.open(redirectUrl);\n\t\t}\n\t\telse if(!(isRedirected && window.top === window))\n\t\t{\n\t\t\t// window.location.reload();\n\t\t}\n\t}\n\n\t#onRequestError(error: string)\n\t{\n\t\tthis.#isProgress = false;\n\t\tMessageBox.alert(error);\n\t}\n\n\t#collectAdditionalData(schemeItem: SchemeItem): Promise<CollectAdditionalDataResult,string>\n\t{\n\t\tconst config = this.getConfig();\n\n\t\tconst promises = [];\n\n\t\tschemeItem.getEntityTypeIds().forEach((entityTypeId) => {\n\t\t\tpromises.push(() => {\n\t\t\t\treturn this.#getCategoryForEntityTypeId(entityTypeId);\n\t\t\t});\n\t\t});\n\n\t\tlet result: CollectAdditionalDataResult = {\n\t\t\tisCanceled: false,\n\t\t};\n\t\tconst promiseIterator = ((promises: Array, index: number = 0) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (result.isCanceled || !promises[index])\n\t\t\t\t{\n\t\t\t\t\tresolve(result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpromises[index]().then((categoryResult: CategorySelectResult) => {\n\t\t\t\t\tif (categoryResult.isCanceled)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.isCanceled = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (categoryResult.category)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityTypeId = categoryResult.category.getEntityTypeId();\n\t\t\t\t\t\tconst configItem = config.getItemByEntityTypeId(entityTypeId);\n\t\t\t\t\t\tif (!configItem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst initData = configItem.getInitData();\n\t\t\t\t\t\tinitData.categoryId = categoryResult.category.getId();\n\t\t\t\t\t\tconfigItem.setInitData(initData);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(promiseIterator(promises, ++index));\n\t\t\t\t});\n\t\t\t})\n\t\t});\n\n\t\treturn promiseIterator(promises);\n\t}\n\n\t#getCategoryForEntityTypeId(entityTypeId): Promise<CategorySelectResult, string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst configItem = this.getConfig().getItemByEntityTypeId(entityTypeId);\n\t\t\tif (!configItem)\n\t\t\t{\n\t\t\t\treject('Scheme is not correct: configItem is not found for ' + entityTypeId);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.#isNeedToLoadCategories(entityTypeId))\n\t\t\t{\n\t\t\t\tCategoryList.Instance.getItems(entityTypeId).then((categories: CategoryModel[]) => {\n\t\t\t\t\tif (categories.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showCategorySelector(categories, configItem.getTitle()).then(resolve).catch(reject);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tisCanceled: false,\n\t\t\t\t\t\t\tcategory: categories[0],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}).catch(reject);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve({isCanceled:false, category:null});\n\t\t\t}\n\t\t});\n\t}\n\n\t#isNeedToLoadCategories(entityTypeId: number): boolean\n\t{\n\t\t// todo pass isCategoriesEnabled from backend\n\t\treturn (\n\t\t\tentityTypeId === BX.CrmEntityType.enumeration.deal\n\t\t\t|| BX.CrmEntityType.isDynamicTypeByTypeId(entityTypeId)\n\t\t);\n\t}\n\n\t#showCategorySelector(categories: CategoryModel[], title: string): Promise<CategorySelectResult,string>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst categorySelectorContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"crm-converter-category-selector ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"crm-converter-category-selector-label ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage(\"CRM_COMMON_CATEGORY\")}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"crm-converter-category-selector-select ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\"></select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = categorySelectorContent.querySelector('select');\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tselect.appendChild(Tag.render`<option value=\"${category.getId()}\">${Text.encode(category.getName())}</option>`);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: Loc.getMessage(\"CRM_CONVERSION_CATEGORY_SELECTOR_TITLE\", {\n\t\t\t\t\t'#ENTITY#': Text.encode(title),\n\t\t\t\t}),\n\t\t\t\tcontent: categorySelectorContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_SAVE\"),\n\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tconst value = Array.from(select.selectedOptions)[0].value;\n\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tfor (const category of categories)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (category.getId() === Number(value))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tresolve({category});\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconsole.error('Selected category not found');\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage(\"CRM_COMMON_ACTION_CANCEL\"),\n\t\t\t\t\t\tcolor: ButtonColor.LIGHT,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tpopup.destroy();\n\n\t\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({isCanceled: true});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\t#processRequiredAction(action: Object): void\n\t{\n\t\tconst name = String(action.NAME);\n\t\tconst data = Type.isPlainObject(action.DATA) ? action.DATA : {};\n\n\t\tif(name === \"SYNCHRONIZE\")\n\t\t{\n\t\t\tlet newConfig: ConfigItemData[]|null = null;\n\t\t\tif (Type.isArray(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = data.CONFIG;\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(data.CONFIG))\n\t\t\t{\n\t\t\t\tnewConfig = Object.values(data.CONFIG);\n\t\t\t}\n\n\t\t\tif (newConfig)\n\t\t\t{\n\t\t\t\tthis.#config.updateItems(newConfig);\n\t\t\t}\n\n\t\t\tthis.#getFieldsSynchronizer(Type.isArray(data.FIELD_NAMES) ? data.FIELD_NAMES : []).show();\n\n\t\t\treturn;\n\t\t}\n\t\tif(name === \"CORRECT\")\n\t\t{\n\t\t\tif(Type.isPlainObject(data.CHECK_ERRORS))\n\t\t\t{\n\t\t\t\t// todo this is actual for leads only.\n\t\t\t\t// this.openEntityEditorDialog(\n\t\t\t\t// \t{\n\t\t\t\t// \t\ttitle: manager ? manager.getMessage(\"checkErrorTitle\") : null,\n\t\t\t\t// \t\thelpData: { text: manager.getMessage(\"checkErrorHelp\"), code: manager.getMessage(\"checkErrorHelpArticleCode\") },\n\t\t\t\t// \t\tfieldNames: Object.keys(checkErrors),\n\t\t\t\t// \t\tinitData: BX.prop.getObject(data, \"EDITOR_INIT_DATA\", null),\n\t\t\t\t// \t\tcontext: BX.prop.getObject(data, \"CONTEXT\", null)\n\t\t\t\t// \t}\n\t\t\t\t// );\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t#getFieldsSynchronizer(fieldNames: string[])\n\t{\n\t\tif (this.#fieldsSynchronizer)\n\t\t{\n\t\t\tthis.#fieldsSynchronizer.setConfig(this.#config.externalize());\n\t\t\tthis.#fieldsSynchronizer.setFieldNames(fieldNames);\n\n\t\t\treturn this.#fieldsSynchronizer;\n\t\t}\n\n\t\tthis.#fieldsSynchronizer = BX.CrmEntityFieldSynchronizationEditor.create(\n\t\t\t\"crm_converter_fields_synchronizer_\" + this.getEntityTypeId(),\n\t\t\t{\n\t\t\t\tconfig: this.#config.externalize(),\n\t\t\t\ttitle: this.#getMessage(\"dialogTitle\"),\n\t\t\t\tfieldNames: fieldNames,\n\t\t\t\tlegend: this.#getMessage(\"syncEditorLegend\"),\n\t\t\t\tfieldListTitle: this.#getMessage(\"syncEditorFieldListTitle\"),\n\t\t\t\tentityListTitle: this.#getMessage(\"syncEditorEntityListTitle\"),\n\t\t\t\tcontinueButton: this.#getMessage(\"continueButton\"),\n\t\t\t\tcancelButton: this.#getMessage(\"cancelButton\"),\n\t\t\t}\n\t\t);\n\t\tthis.#fieldsSynchronizer.addClosingListener((sender, args) => {\n\t\t\tif(!(Type.isBoolean(args[\"isCanceled\"]) && args[\"isCanceled\"] === false))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#isSynchronisationAllowed = true;\n\t\t\tthis.#config.updateItems(Object.values(this.#fieldsSynchronizer.getConfig()));\n\t\t\tthis.#request();\n\t\t});\n\n\t\treturn this.#fieldsSynchronizer;\n\t}\n\n\t#getMessage(phraseId): string\n\t{\n\t\tif (!this.#params.messages)\n\t\t{\n\t\t\tthis.#params.messages = {};\n\t\t}\n\t\treturn this.#params.messages[phraseId] || phraseId;\n\t}\n\n\t#emitConvertedEvent(redirectUrl): boolean\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\n\t\tconst eventArgs = {\n\t\t\tentityTypeId,\n\t\t\tentityTypeName: BX.CrmEntityType.resolveName(entityTypeId),\n\t\t\tentityId: this.#entityId,\n\t\t\tredirectUrl,\n\t\t\tisRedirected: false,\n\t\t};\n\n\t\tvar current = BX.Crm.Page.getTopSlider();\n\t\tif(current)\n\t\t{\n\t\t\teventArgs[\"sliderUrl\"] = current.getUrl();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"Crm.EntityConverter.Converted\", [ this, eventArgs ]);\n\t\tBX.localStorage.set(\"onCrmEntityConvert\", eventArgs, 10);\n\n\t\treturn eventArgs[\"isRedirected\"];\n\t}\n}\n","import { Event, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuManager } from \"main.popup\";\nimport { Converter } from \"./converter\";\nimport { SchemeItem } from \"./scheme-item\";\n\n/**\n * @memberOf BX.Crm.Conversion\n * @mixes EventEmitter\n */\nexport class SchemeSelector\n{\n\t#entityId: number;\n\t#container: HTMLElement;\n\t#menuButton: HTMLElement;\n\t#label: HTMLElement;\n\t#converter: Converter;\n\t#menuId: string;\n\t#isAutoConversionEnabled: boolean;\n\n\tconstructor(\n\t\tconverter: Converter,\n\t\tparams: {\n\t\t\tentityId: number,\n\t\t\tcontainerId: string,\n\t\t\tbuttonId: string,\n\t\t\tlabelId: string,\n\t\t}\n\t) {\n\t\tif (converter instanceof Converter)\n\t\t{\n\t\t\tthis.#converter = converter;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(\n\t\t\t\t'Converter is invalid in SchemeSelector constructor. Expected instance of Converter, got ' + (typeof converter)\n\t\t\t);\n\t\t}\n\n\n\t\tthis.#entityId = Number(params.entityId);\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tthis.#menuButton = document.getElementById(params.buttonId);\n\t\tthis.#label = document.getElementById(params.labelId);\n\t\tthis.#menuId = 'crm_conversion_scheme_selector_' + this.#entityId + '_' + Text.getRandom();\n\t\tthis.#isAutoConversionEnabled = false;\n\n\t\tif (!this.#entityId || !this.#container || !this.#menuButton || !this.#label || !this.#converter)\n\t\t{\n\t\t\tconsole.error('Error SchemeSelector initializing', this);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initUI();\n\t\t\tthis.#bindEvents();\n\t\t}\n\n\t\tEventEmitter.makeObservable(this, 'BX.Crm.Conversion');\n\t}\n\n\tenableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = true;\n\t}\n\n\tdisableAutoConversion()\n\t{\n\t\tthis.#isAutoConversionEnabled = false;\n\t}\n\n\t#initUI()\n\t{\n\t\tconst currentSchemeItem: SchemeItem|null = this.#converter.getConfig().getScheme().getCurrentItem();\n\t\tif (currentSchemeItem)\n\t\t{\n\t\t\tthis.#label.innerText = currentSchemeItem.getPhrase();\n\t\t}\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(this.#container, \"click\", this.#handleContainerClick.bind(this));\n\t\tEvent.bind(this.#menuButton, \"click\", this.#handleMenuButtonClick.bind(this));\n\t}\n\n\t#handleContainerClick()\n\t{\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onContainerClick', event);\n\t\tthis.#converter.getConfig().updateFromSchemeItem();\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n\n\t#handleMenuButtonClick()\n\t{\n\t\tthis.#showMenu();\n\t}\n\n\t#showMenu()\n\t{\n\t\tconst anchorPos = BX.pos(this.#container);\n\n\t\tMenuManager.show({\n\t\t\tid: this.#menuId,\n\t\t\tbindElement: this.#menuButton,\n\t\t\titems: this.#getMenuItems(),\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\toffsetLeft: -anchorPos['width'],\n\t\t})\n\t}\n\n\t#closeMenu()\n\t{\n\t\tMenuManager.destroy(this.#menuId);\n\t}\n\n\t#getMenuItems()\n\t{\n\t\tconst items = [];\n\n\t\tthis.#converter.getConfig().getScheme().getItems().forEach((item: SchemeItem) => {\n\t\t\titems.push({\n\t\t\t\ttext: Text.encode(item.getPhrase()),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#handleItemClick(item);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#handleItemClick(item: SchemeItem)\n\t{\n\t\tthis.#closeMenu();\n\t\tthis.#label.innerText = item.getPhrase();\n\t\tthis.#converter.getConfig().updateFromSchemeItem(item);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tisCanceled: false\n\t\t\t},\n\t\t});\n\t\tthis.emit('SchemeSelector:onSchemeSelected', event);\n\t\tif (this.#isAutoConversionEnabled && !event.getData().isCanceled)\n\t\t{\n\t\t\tthis.#converter.convert(this.#entityId);\n\t\t}\n\t}\n}\n","import type { ConverterParams } from \"./converter\";\nimport { Converter } from \"./converter\";\nimport { Config } from \"./config\";\nimport type { SchemeData } from \"./scheme\";\nimport { Scheme } from \"./scheme\";\nimport { Reflection } from \"main.core\";\nimport type { ConfigItemData } from \"./config-item\";\n\nlet instance = null;\n\n/**\n * @memberOf BX.Crm.Conversion\n */\nexport class Manager\n{\n\t#converters: Object<number, Converter>;\n\n\tconstructor() {\n\t\tthis.#converters = {};\n\t}\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.Conversion.Manager'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.Conversion.Manager.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitializeConverter(\n\t\tentityTypeId: number,\n\t\tparams: {\n\t\t\tconfigItems: ConfigItemData[],\n\t\t\tscheme: SchemeData,\n\t\t\tparams: ConverterParams,\n\t\t}\n\t): Converter\n\t{\n\t\tconst config = Config.create(entityTypeId, params.configItems, Scheme.create(params.scheme));\n\n\t\tthis.#converters[entityTypeId] = new Converter(entityTypeId, config, params.params);\n\n\t\treturn this.#converters[entityTypeId];\n\t}\n\n\tgetConverter(entityTypeId: number): ?Converter\n\t{\n\t\treturn this.#converters[entityTypeId] || null;\n\t}\n}\n","import {Scheme} from './scheme';\nimport {SchemeSelector} from './scheme-selector';\nimport {Config} from './config';\nimport {Converter} from './converter';\nimport {Manager} from './manager';\n\n/**\n * @memberOf BX.Crm\n */\nexport const Conversion = {\n\tScheme,\n\tConfig,\n\tConverter,\n\tManager,\n\tSchemeSelector,\n};"],"names":["SchemeItem","params","String","id","name","phrase","Type","isArray","entityTypeIds","forEach","entityTypeId","push","Number","Scheme","currentItemId","items","isNull","item","console","error","length","getItemById","itemId","getId","getEntityTypeIds","Array","from","schemeItems","ConfigItem","active","enableSync","isPlainObject","initData","title","getEntityTypeId","getTitle","getInitData","isActive","isEnableSync","data","value","isBoolean","isString","Boolean","Config","scheme","schemeItem","getScheme","getCurrentItem","setCurrentItemId","activeEntityTypeIds","indexOf","setEnableSync","setActive","getItems","BX","CrmEntityType","resolveName","toLowerCase","externalize","configItems","Converter","config","serviceUrl","additionalParams","action","getConfig","util","add_url_param","hasOwnProperty","originUrl","isRedirectToDetailPageEnabled","entityId","then","result","isCanceled","catch","getServiceUrl","Ajax","url","method","dataType","getOriginUrl","onsuccess","_classPrivateMethodGet","bind","onfailure","response","ERROR","MessageBox","alert","MESSAGE","REQUIRED_ACTION","DATA","redirectUrl","URL","isRedirected","IS_FINISHED","Crm","Page","open","window","top","promises","promiseIterator","index","Promise","resolve","reject","categoryResult","category","configItem","getItemByEntityTypeId","categoryId","setInitData","CategoryList","Instance","categories","enumeration","deal","isDynamicTypeByTypeId","categorySelectorContent","Tag","render","Loc","getMessage","select","querySelector","appendChild","Text","encode","getName","popup","Popup","titleBar","content","closeByEsc","closeIcon","buttons","Button","text","color","ButtonColor","SUCCESS","onclick","selectedOptions","destroy","LIGHT","events","onClose","show","NAME","newConfig","CONFIG","Object","values","updateItems","FIELD_NAMES","CHECK_ERRORS","fieldNames","setConfig","setFieldNames","CrmEntityFieldSynchronizationEditor","create","legend","fieldListTitle","entityListTitle","continueButton","cancelButton","addClosingListener","sender","args","phraseId","messages","eventArgs","entityTypeName","current","getTopSlider","getUrl","onCustomEvent","localStorage","set","SchemeSelector","converter","document","getElementById","containerId","buttonId","labelId","getRandom","EventEmitter","makeObservable","currentSchemeItem","innerText","getPhrase","Event","event","BaseEvent","emit","updateFromSchemeItem","getData","convert","anchorPos","pos","MenuManager","bindElement","cacheable","offsetLeft","instance","Manager","Reflection","getClass","Conversion"],"mappings":"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"}