function CrmWebForm(e){this.init=function(e){this.id=e.id||"";this.hash=e.hash||"";this.postAjax=e.postAjax||false;this.mess=e.mess||{sentError:"",sentSuccess:""};this.currency=e.currency||null;this.isCallBackForm=e.isCallBackForm||false;this.useReCaptcha=e.useReCaptcha||false;this.linkReCaptcha=e.linkReCaptcha||null;this.phoneFormatDataUrl=e.phoneFormatDataUrl||null;this.phoneCountryCode=e.phoneCountryCode||null;this.canRemoveCopyright=!!e.canRemoveCopyright;this.redirectDelay=null;this.form=BX(e.form);this.disabled=false;this.postMessageDomain=null;this.postMessageOrigin=null;this.postMessageSource=null;this.guestLoader=e.guestLoader;var t=e.tracking||{data:{},ga:false,gaPageView:false,ya:null};t.caller=this;this.tracking=new CrmWebFormTracking(t);this.savedFields=new CrmWebFormSavedField({caller:this});if(this.form){this.popup=new CrmWebFormPopup({caller:this});e.onShow=BX.proxy(this.onShow,this);e.onHide=BX.proxy(this.onHide,this);e.onFocus=BX.proxy(this.onFocus,this);e.onBlur=BX.proxy(this.onBlur,this);e.onCheck=BX.proxy(this.onCheck,this);e.onChange=BX.proxy(this.onChange,this);e.onSubmitSuccess=BX.proxy(this.onSubmitSuccess,this);this.webForm=new FormChecker(e);this.webForm.fireChangeEvent();this.submitButtonNodes=BX.convert.nodeListToArray(document.querySelectorAll("[data-bx-webform-submit-btn]"));this.submitButtonNodes.forEach(function(e){BX.bind(e,"click",BX.proxy(this.webForm.submit,this.webForm))},this);this.savedFields.fillForm()}this.addHiddenInputToForm("from",window.location.href);this.initFrameParameters();if(this.form){this.initDateControls();this.initPhoneControls();this.initFileInputs(document.querySelectorAll('input[type="file"]'));this.initReCaptcha()}this.loadGuestTracker();this.listenResizeEvent();this.captureKeyBoard();if(BX.type.isArray(e.fields)&&this.webForm){e.fields.forEach(function(e){if(e.type==="resourcebooking"&&BX.Calendar){var t;if(BX.Calendar.Resourcebooking){t=BX.Calendar.Resourcebooking.getLiveField({wrap:BX(e.name),field:e});if(t&&BX.type.isFunction(t.check)){this.webForm.getField(e.name).registerChecker(t.check.bind(t))}}else if(BX.Calendar.UserField&&BX.Calendar.UserField.getResourceBookingFieldLive){t=BX.Calendar.UserField.getResourceBookingFieldLive({wrap:BX(e.name),field:e});if(t&&BX.type.isFunction(t.init)){t.init();this.webForm.getField(e.name).registerChecker(BX.proxy(t.check,t))}}}},this)}this.licence=new CrmWebFormLicence({caller:this});BX.bind(window,"resize",BX.debounce(this.fireResizeEvent,300,this));BX.addCustomEvent(window,"crmWebFormFireResize",BX.debounce(this.fireResizeEvent,300,this));if(BX.browser.IsIOS()){document.addEventListener("touchstart",{})}};this.initReCaptcha=function(){if(!this.useReCaptcha||!this.linkReCaptcha){return}if(!window.onReCaptchaLoadCallback&&!window.grecaptcha){window.onReCaptchaLoadCallback=BX.proxy(this.initReCaptcha,this);BX.loadScript(this.linkReCaptcha);return}if(window.grecaptcha&&window.grecaptcha.render){var e=BX("recaptcha-cont");window.grecaptcha.render(e,{sitekey:e.getAttribute("data-sitekey"),size:BX.browser.IsMobile()?"compact":"normal"})}BX.addCustomEvent(this.webForm,"onSubmit",function(e,t){if(window.grecaptcha&&window.grecaptcha.getResponse){t.isSuccess=window.grecaptcha.getResponse().length>0;if(!t.isSuccess){var i="crm-webform-captcha-error-animate";var s=BX("recaptcha-error");BX.addClass(s,i);setTimeout(function(){BX.removeClass(s,i)},700)}}})};this.initDateControls=function(){var e=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-desktop.crm-webform-input-date"));e.forEach(function(e){this.initDateControl(e,false)},this);var t=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-desktop.crm-webform-input-datetime"));t.forEach(function(e){this.initDateControl(e,true)},this)};this.initDateControl=function(e,t){t=t||false;if(!e){return}if(BX.browser.IsMobile()&&e.nextElementSibling&&e.nextElementSibling.tagName=="INPUT"){var i=e.nextElementSibling;BX.bind(i,"blur",function(){try{var s=new Date(i.value);s=new Date(s.valueOf()+s.getTimezoneOffset()*6e4);e.value=BX.formatDate(s,t?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE"))}catch(e){}});this.initDisplayedToDataControlEvents(i,e)}else{BX.bind(e,"click",function(){BX.calendar({node:e,field:e,bTime:t})})}};this.initPhoneControls=function(){var e=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-phone"));e.forEach(function(e){this.initPhoneControl(e,false)},this)};this.initPhoneControlByDataInput=function(e){if(!e){return}if(!e.previousElementSibling||e.previousElementSibling.tagName!="INPUT"){return}this.initPhoneControl(e.previousElementSibling)};this.initPhoneControl=function(e){if(!e){return}if(!e.nextElementSibling||e.nextElementSibling.tagName!="INPUT"){return}var t=e.previousElementSibling;var i=e.nextElementSibling;if(!BX.browser.IsMobile()||BX.browser.IsIOS()){new BXMaskedPhone({url:this.phoneFormatDataUrl,country:this.phoneCountryCode,maskedInput:{input:e,dataInput:i},flagNode:t,flagSize:24})}else{t.style.display="none";BX.removeClass(e,"crm-webform-input-phone-padding");e.value=i.value;BX.bind(e,"bxchange",function(){i.value=e.value})}this.initDisplayedToDataControlEvents(e,i)};this.initDisplayedToDataControlEvents=function(e,t){BX.bind(e,"blur",function(){BX.fireEvent(t,"blur")});BX.bind(e,"focus",function(){BX.fireEvent(t,"focus")})};this.initFrameParameters=function(){if(!this.isFrame()){return}if(!window.location.hash){return}var e={};try{e=JSON.parse(decodeURIComponent(window.location.hash.substring(1)))}catch(e){}if(e.domain){this.postMessageDomain=e.domain}if(e.from){this.addHiddenInputToForm("from",e.from)}if(e.presets){var t="";for(var i in e.presets){if(!e.presets.hasOwnProperty(i)){continue}t+=encodeURIComponent(i)+"="+encodeURIComponent(e.presets[i])+"&"}this.addHiddenInputToForm("presets",t)}if(e.options){if(BX.type.isNumber(e.options["redirectDelay"])){this.redirectDelay=parseInt(e.options["redirectDelay"])}if(e.options["borders"]===false){BX.addClass(document.body,"crm-webform-no-borders")}if(e.options["logo"]===false&&this.canRemoveCopyright){BX.addClass(document.body,"crm-webform-no-logo")}if(e.options["css"]){this.addCss(e.options["css"])}}if(e.fields){this.setFields(e.fields)}};this.initFileInputs=function(e){e=BX.convert.nodeListToArray(e);e.forEach(function(e){BX.bind(e,"change",function(){var e=this.previousElementSibling;var t=e.querySelector("span:first-child");var i=e.querySelector("span:last-child");var s=false;if(this.value){var r=[];r=this.value.replace(/\\/g,"/").split("/");i.innerText=r[r.length-1];s=true}t.style.display=!s?"block":"none";i.style.display=s?"block":"none"})})};this.addHiddenInputToForm=function(e,t){e=e||"from";if(!this.webForm){return}var i=this.webForm.form.querySelector('input[name="'+e+'"]');if(!i){i=document.createElement("INPUT");i.type="hidden";i.name=e;this.webForm.form.appendChild(i)}i.value=t};this.addCss=function(e){if(e["content"]){this.addCssContent(e["content"])}if(e["file"]){if(Array.isArray(e["file"])){e["file"].forEach(function(e){BX.loadCSS(e)})}else{BX.loadCSS(e["file"])}}};this.addCssContent=function(e){var t=document.createElement("STYLE");t.setAttribute("type","text/css");if(t.styleSheet){t.styleSheet.cssText=resource.content}else{t.appendChild(document.createTextNode(e))}document.head.appendChild(t)};this.isFrame=function(){return window!=window.top};this.isFrame=function(){return window!=window.top};this.captureKeyBoard=function(){if(!this.isFrame()){return}var e=this;BX.bind(document,"keyup",function(t){t=t||window.e;var i=typeof t.which=="number"?t.which:t.keyCode;if(i==27){e.fireKeyBoardEvent(i)}})};this.listenResizeEvent=function(){if(!this.isFrame()){this.tracking.onFormView();return}if(typeof window.postMessage==="function"){this.postMessageInit=false;BX.bind(window,"message",this.initPostMessage.bind(this))}else{var e=this;setTimeout(function(){e.tracking.onFormView()},1e3)}this.fireResizeEvent()};this.onPostMessageData=function(e){e=e||{};switch(e.action){case"setTrace":this.setTrace(e.trace);break;case"setFields":this.setFields(e.fields);break}};this.initPostMessage=function(e){if(!e||e.origin!==this.postMessageDomain){return}var t={};try{t=JSON.parse(e.data)}catch(e){return}if(this.postMessageInit){this.onPostMessageData(t);return}if(!t.uniqueLoadId){return}this.postMessageInit=true;this.uniqueLoadId=t.uniqueLoadId;this.resultSuccessText=t.resultSuccessText||null;this.visitedPages=BX.type.isArray(t.visitedPages)?t.visitedPages:[];this.stopCallBack=t.stopCallBack||false;this.postMessageSource=e.source;this.postMessageOrigin=e.origin;if(t.options&&t.options.css){this.addCss(t.options.css)}this.fireResizeEvent();setTimeout(this.fireResizeEvent.bind(this),150);setTimeout(this.fireResizeEvent.bind(this),2e3);this.tracking.onFormView()};this.sendDataToFrameHolder=function(e){var t=JSON.stringify(e);if(typeof window.postMessage==="function"){if(this.postMessageSource){this.postMessageSource.postMessage(t,this.postMessageOrigin)}}var i=0;if(i){var s=window.location.hash.substring(1);top.location=s.substring(0,s.indexOf("#"))+"#"+t}};this.loadGuestTracker=function(){if(!this.guestLoader){return}if(this.isFrame()){this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"guestLoader",value:this.guestLoader})}else{this.trackGuest();BX.evalGlobal(this.guestLoader)}};this.trackGuest=function(){if(!window.b24Tracker||!window.b24Tracker.guest){setTimeout(this.trackGuest.bind(this),200);return}this.setTrace(window.b24Tracker.guest.getTrace())};this.fireRedirectEvent=function(e){if(this.isFrame()){this.sendDataToFrameHolder({action:"redirect",value:e})}else{window.location=e}};this.fireResizeEvent=function(){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"change_height",value:this.getHeight()})};this.firePopupShowedEvent=function(){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"popup_showed",value:"middle"})};this.fireKeyBoardEvent=function(e){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"keyboard",value:e})};this.fireFrameEvent=function(e,t){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"event",eventName:e,value:t})};this.fireAnalyticsEvent=function(e){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"analytics",value:e})};this.getHeight=function(){return Math.max(Math.ceil(BX.pos(document.querySelector(".crm-webform-popup-container")).height),Math.ceil(BX.pos(document.querySelector(".content").parentNode).height))};this.getCurrentItems=function(e){var t=[];var i=e.getValues();for(var s in e.params.items){var r=e.params.items[s];if(BX.util.in_array(r.value,i)){t.push(r)}}return t};this.setTrace=function(e){var t=this.webForm.form.querySelector('input[name="trace"]');if(!t){t=document.createElement("input");t.type="hidden";t.name="trace";this.webForm.form.appendChild(t)}t.value=e||""};this.setFields=function(e){if(!e||!e.values){return}for(var t in e.values){if(!e.values.hasOwnProperty(t)){continue}var i=this.webForm.getField(t);if(!i){continue}var s=e.values[t];s=BX.type.isArray(s)?s:[s];i.setValues(s)}};this.createFormField=function(e,t){var i=BX.create({tag:"div"});i.innerHTML=this.getTemplate(t);i=BX.findChild(i);var s=BX("field_"+e+"_CONT");s.appendChild(i);var r=i.querySelector("[name]");var n=this.webForm.getField(e);n.addElement(r);switch(n.type){case"file":this.initFileInputs([r]);break;case"date":this.initDateControl(r,false);break;case"datetime":this.initDateControl(r,true);break;case"phone":this.initPhoneControlByDataInput(r);break}this.fireResizeEvent()};this.getTemplate=function(e,t){var i=BX(e).innerHTML;if(!i){return}if(t){for(var s in t){i=i.replace(s,t[s])}}return i};this.appendNodeByTemplate=function(e,t,i,s){s=s||false;var r=BX.create({tag:"div"});r.innerHTML=this.getTemplate(t,i);r=BX.findChild(r);if(e){if(!s)e.appendChild(r);else e.insertBefore(r,e.firstChild)}return r};this.processAjaxSubmitResult=function(e){this.disabled=false;var t={error:e.error,text:e.text};if(!e.error&&this.resultSuccessText){t.text=this.resultSuccessText}if(e.redirect){t.redirect={delay:(this.redirectDelay===null?e.redirectDelay:this.redirectDelay)+1,url:e.redirect}}this.popup.show(t);if(e.error){this.webForm.onSubmitAjaxError();return}var i=BX.ajax.prepareForm(this.webForm.form).data;i.resultId=e.resultId;i.gid=e.gid;for(var s in i){if(!s||s=="sessid"){delete i[s]}}this.fireFrameEvent("send",[i])};this.onAjaxSubmitSuccess=function(e){this.tracking.onFormSent();this.processAjaxSubmitResult(e)};this.onAjaxSubmitFailure=function(e){e=BX.type.isPlainObject(e)?e:{};e.error=true;this.processAjaxSubmitResult(e)};this.onSubmitSuccess=function(e){var t=this.webForm.form.querySelector('input[name="sessid"]');if(!t){t=document.createElement("input");t.type="hidden";t.name="sessid";this.webForm.form.appendChild(t)}t.value=BX.bitrix_sessid();if(this.stopCallBack){var i=this.webForm.form.querySelector('input[name="stopCallback"]');if(!i){i=document.createElement("input");i.type="hidden";i.name="stopCallback";i.value="Y";this.webForm.form.appendChild(i)}}if(BX.type.isArray(this.visitedPages)&&this.visitedPages.length>0){var s=this.webForm.form.querySelector("#crm-visited-pages");if(!s){s=document.createElement("div");this.visitedPages.forEach(function(e,t){e.forEach(function(e,i){var r=null;switch(i){case 0:r="HREF";break;case 1:r="DATE";break;case 2:r="TITLE";break}if(!r||!e){return}var n=document.createElement("input");n.type="hidden";n.name="visited_pages["+t+"]["+r+"]";n.value=e;s.appendChild(n)})},this);this.webForm.form.appendChild(s)}}if(!this.licence.isAccepted()){BX.PreventDefault(e);return false}if(!this.postAjax){return true}BX.PreventDefault(e);if(this.disabled){return false}else{this.popup.show({wait:true});this.disabled=true}var r=BX.ajax.prepareForm(this.webForm.form);if(r.filesCount>0){BX.ajax.submitAjax(this.webForm.form,{dataType:"json",method:"POST",onsuccess:BX.proxy(this.onAjaxSubmitSuccess,this),onfailure:BX.proxy(this.onAjaxSubmitFailure,this)})}else{BX.ajax({start:true,url:this.webForm.form.getAttribute("action"),method:"POST",data:r.data,dataType:"json",processData:true,onsuccess:BX.proxy(this.onAjaxSubmitSuccess,this),onfailure:BX.proxy(this.onAjaxSubmitFailure,this)})}};this.onShow=function(e){var t=BX("field_"+e);BX.removeClass(t,"crm-webform-hide");this.fireResizeEvent()};this.onHide=function(e){var t=BX("field_"+e);BX.addClass(t,"crm-webform-hide");this.fireResizeEvent()};this.onFocus=function(e){var t=BX("field_"+e);BX.addClass(t,"crm-webform-active");this.tracking.onFieldFocus()};this.onBlur=function(e,t){var i=BX("field_"+e);BX.removeClass(i,"crm-webform-active");this.tracking.onFieldBlur(e,t);var s=t.getValues();if(s.length>0){this.savedFields.set(t.name,s[0])}this.fireFrameEvent("fill",[e,s])};this.onCheck=function(e,t,i,s){var r=BX("field_"+e);if(i){BX.removeClass(r,"crm-webform-error");if(i==1){BX.addClass(r,"crm-webform-success")}else{BX.removeClass(r,"crm-webform-success")}}else{BX.removeClass(r,"crm-webform-success");BX.addClass(r,"crm-webform-error")}};this.onChange=function(e,t){if(t.params["items"]&&t.params.items.length>0&&typeof t.params.items[0]["price"]!="undefined"){this.updateCarts()}};this.updateCarts=function(){if(!this.currency){return}if(!this.carts){this.carts=[];var e="data-bx-webform-cart";var t=document.querySelectorAll("["+e+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){var i=t.getAttribute(e)=="mini";var s=t.querySelector("[data-bx-webform-cart-items]");var r=t.querySelector("[data-bx-webform-cart-total]");if(!s||!r){return}this.carts.push({itemsNode:s,totalNode:r,isMini:i})},this)}var i=[];this.webForm.getFields().forEach(function(e){if(!e.isVisible())return;var t=this.getCurrentItems(e);if(t.length==0)return;if(typeof t[0]["price"]=="undefined")return;i=BX.util.array_merge(i,t)},this);var s=0;var r=[];var n=[];i.forEach(function(e){var t=e.price?e.price:0;s=s+parseFloat(t);var i=e.price_formatted?e.price_formatted:t;var a={"%name%":e.title,"%price%":i};r.push(this.getTemplate("product_price_item",a));n.push(this.getTemplate("product_price_mini_item",a))},this);this.carts.forEach(function(e){var t=BX.util.number_format(s,this.currency.DECIMALS,this.currency.DEC_POINT,(this.currency.THOUSANDS_SEP||"").replace("&nbsp;"," "));t=BX.util.htmlspecialcharsback(t);e.totalNode.innerHTML=this.currency.FORMAT_STRING;e.totalNode.textContent=e.totalNode.textContent.replace("#",t);e.itemsNode.innerHTML=e.isMini?n.join(" "):r.join(" ")},this);this.fireResizeEvent()};this.disableButton=function(e){e=e||false;this.submitButtonNodes.forEach(function(t){if(e){BX.addClass(t,"crm-webform-submit-button-loader");BX.addClass(t,"crm-webform-submit-button-loader-customize")}else{BX.removeClass(t,"crm-webform-submit-button-loader");BX.removeClass(t,"crm-webform-submit-button-loader-customize")}})};this.init(e)}function CrmWebFormTracking(e){this.init=function(e){this.caller=e.caller;this.yaId=e.ya||null;this.gaId=e.ga||null;this.gaPageView=!!e.gaPageView;this.data=e.data;this.isStartFillTracked=false;this.filledFields=[];this.processedCounters=[]};this.trackByData=function(e){if(!this.data[e]){return}this.track(this.data[e].name,this.data[e].code)};this.track=function(e,t){e=e||"";t=t||"";var i=this.data.category;var s=this.data.template.name.replace("%name%",e);var r=this.data.template.code.replace("%code%",t);if(this.gaId&&window.ga){window.ga("send","event",i,s);if(this.gaPageView&&t){window.ga("send","pageview",r)}}this.caller.fireAnalyticsEvent([{type:"ga",gaId:this.gaId,params:["event",i,s]},this.gaPageView&&t?{type:"ga",gaId:this.gaId,params:["pageview",r]}:null]);this.trackYa(e,t)};this.trackYa=function(e,t){var i=this.data.eventTemplate.code.replace("%code%",t).replace("%form_id%",this.caller.id);if(this.yaId){if(!window["yaCounter"+this.yaId]){var s=this;setTimeout(function(){s.trackYa(e,t)},100);return}window["yaCounter"+this.yaId].reachGoal(i)}this.caller.fireAnalyticsEvent([{type:"ya",yaId:this.yaId,params:[i]}])};this.onFieldBlur=function(e,t){if(BX.util.in_array(e,this.filledFields)){return}if(t.isEmpty()){return}this.filledFields.push(e);this.track(this.data.field.name.replace("%name%",t.caption),this.data.field.code.replace("%code%",e))};this.onFieldFocus=function(){if(!this.isStartFillTracked){this.trackByData("start");this.isStartFillTracked=true}this.incBxCounter("start")};this.onFormSent=function(){this.trackByData("end")};this.onFormView=function(){this.trackByData("view");this.incBxCounter("view")};this.incBxCounter=function(e){if(BX.util.in_array(e,this.processedCounters)||!this.caller.form){return}this.processedCounters.push(e);var t=this;BX.ajax({url:this.caller.form.action,method:"POST",data:{hash:this.caller.hash,sessid:BX.bitrix_sessid(),action:"inc_counter",counter:e},processData:false,onfailure:function(){var i=BX.util.array_search(e,t.processedCounters);if(i<0)return;BX.util.deleteFromArray(t.processedCounters,i)}})};this.init(e)}function CrmWebFormLicence(e){this.init=function(e){this.caller=e.caller;this.required=false;this.submitAfterAccept=false;this.licenceAcceptNode=BX("licence_accept");this.licenceShowButton=BX("licence_show_button");this.licencePopupBtnAccept=BX("RESULT_BUTTON_BNT_ACCEPT");this.licencePopupBtnCancel=BX("RESULT_BUTTON_BNT_CANCEL");if(!this.licenceAcceptNode||!this.licenceShowButton){return}this.required=true;BX.bind(this.licenceShowButton,"click",BX.proxy(this.showPopup,this));BX.bind(this.licencePopupBtnAccept,"click",BX.proxy(function(){this.closePopup(true)},this));BX.bind(this.licencePopupBtnCancel,"click",BX.proxy(function(){this.closePopup(false)},this))};this.showPopup=function(){this.caller.popup.show({error:false,text:this.caller.mess.licencePre,licence:true})};this.closePopup=function(e){this.licenceAcceptNode.checked=e;this.caller.popup.hide();if(e&&this.submitAfterAccept){this.caller.webForm.submit()}this.submitAfterAccept=false};this.isAccepted=function(){if(!this.required||this.licenceAcceptNode.checked){return true}this.submitAfterAccept=true;this.showPopup();return false};this.init(e)}function CrmWebFormSavedField(e){this.init=function(e){this.caller=e.caller;this.lsKeyName="b24_crm_form_saved_field";this.entityTypes=["CONTACT","LEAD","COMPANY"];this.entityFieldNames=["EMAIL","PHONE","NAME","LAST_NAME"]};this.fillForm=function(){if(!this.caller.webForm){return}this.caller.webForm.getFields().forEach(function(e){var t=this.get(e.name);if(!t){return}e.setValues([t])},this)};this.set=function(e,t){if(!t||!e){return}var i=this.convertName(e);if(!i){return null}var s=false;var r=this.get().map(function(e){if(e.name==i){e.value=t;s=true}return e});if(!s){r.push({name:i,value:t})}BX.localStorage.set(this.lsKeyName,r,3600*24*365*10)};this.get=function(e){e=e||null;var t=BX.localStorage.get(this.lsKeyName);if(!BX.type.isArray(t)){t=[]}if(!e){return t}var i=this.convertName(e);if(!i){return null}var s=t.filter(function(e){return e.name==i});return s.length>0?s[0].value:null};this.convertName=function(e){var t=e.split("_");var i=t.shift();var s=t.join("_");var r=BX.util.in_array(i,this.entityTypes);if(r){r=BX.util.in_array(s,this.entityFieldNames)}return r?s:null};this.init(e)}function CrmWebFormPopup(e){this.init=function(e){this.caller=e.caller;this.initNode()};this.initNode=function(){if(this.node){return}this.caller.appendNodeByTemplate(document.body,"tmpl_result_message",null,true);this.node=BX("RESULT_MESSAGE_CONTAINER");this.btnContainer=BX("RESULT_BUTTON_CONTAINER");this.messageContent=BX("RESULT_MESSAGE_CONTENT");this.messageContentLoader=BX("RESULT_MESSAGE_CONTENT_LOADER");this.messageContentLoader=BX("RESULT_MESSAGE_CONTENT_LOADER");this.nodeSuccess=this.messageContent.querySelector(".crm-webform-popup-success");this.nodeWarning=this.messageContent.querySelector(".crm-webform-popup-warning");this.nodeLicence=this.messageContent.querySelector(".crm-webform-popup-licence");this.nodeText=this.messageContent.querySelector(".crm-webform-popup-text");this.btnRedirectContainer=BX("RESULT_BUTTON_REDIRECT_CONTAINER");this.btnRedirectNode=BX("RESULT_BUTTON_REDIRECT_BNT");this.btnLicenceContainer=BX("RESULT_BUTTON_LICENCE_CONTAINER");this.btnResult=BX("RESULT_BUTTON_BNT");BX.bind(this.btnResult,"click",BX.proxy(this.hide,this))};this.showLoader=function(){};this.animateRedirect=function(e){e.delay--;BX("RESULT_BUTTON_REDIRECT_COUNTER").innerText=e.delay;if(e.delay>0){var t=this;setTimeout(function(){t.animateRedirect(e)},1e3);return}this.caller.fireRedirectEvent(e.url)};this.show=function(e){var t=e.error||false;var i=e.wait||false;this.caller.disableButton(i);this.btnContainer.style.display=i?"none":"block";this.messageContent.style.display=i?"none":"block";this.messageContentLoader.style.display=!i?"none":"block";this.nodeLicence.style.display="none";this.btnLicenceContainer.style.display="none";if(this.nodeSuccess){this.nodeSuccess.style.display=t?"none":"block"}this.nodeWarning.style.display=!t?"none":"block";if(!i){if(e.licence){this.btnContainer.style.display="none";this.btnRedirectContainer.style.display="none";this.btnLicenceContainer.style.display="block";this.nodeLicence.style.display="block"}else if(e.redirect){this.btnContainer.style.display="none";this.btnRedirectContainer.style.display="block";var s=this;BX.bind(this.btnRedirectNode,"click",function(){s.caller.fireRedirectEvent(e.redirect.url)})}else{this.btnContainer.style.display="block";this.btnLicenceContainer.style.display="none";this.btnResult.focus()}var r=e.text;if(!r){r=t?this.caller.mess.sentError:this.caller.mess.sentSuccess}this.nodeText.innerText=r}this.node.style.display="block";if(e.redirect){this.animateRedirect(e.redirect)}this.caller.firePopupShowedEvent();this.caller.fireResizeEvent()};this.hide=function(){this.node.style.display="none";this.caller.fireResizeEvent()};this.init(e)}
//# sourceMappingURL=script.map.js