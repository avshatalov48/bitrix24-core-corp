function FormField(e){this.params=e;this.element=null;this.caller=e.caller;this.caption=e.caption;this.name=e.name;this.type=e.type;this.section=e.section;this.formatter=e.formatter||null;this.validator=e.validator||null;this.checker=e.checker||null;this.callbackGetValues=e.callbackGetValues||null;this.multiple=e.multiple||false;this.required=e.required||false;this.hidden=e.hidden||false;this.dependences=e.dependences||[];this.callbackSetValues=null;this.listenChanges=true;this.elements=this.findElements();if(this.elements.length>0){this.element=this.elements[0];this.elements.forEach(function(e){this.bindElement(e)},this)}if(this.dependences.length>0){BX.addCustomEvent(this.caller,"onDependenceAction",BX.delegate(this.onDependenceAction,this))}}FormField.prototype={isDependenceSelfCall:false,countDependenceSelfCall:0,findElements:function(){return BX.convert.nodeListToArray(document.getElementsByName(this.name+(this.multiple?"[]":"")))},disable:function(e){e=e||false;this.findElements().forEach(function(t){t.disabled=!e})},addElement:function(e){this.bindElement(e);this.elements=this.findElements()},bindElement:function(e){BX.bind(e,"blur",BX.delegate(this.onBlur,this));BX.bind(e,"focus",BX.delegate(this.onFocus,this));BX.bind(e,"bxchange",BX.delegate(this.onChange,this))},show:function(){this.hidden=false;BX.onCustomEvent(this,"onShow",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onShow",[this.name,this.elements]);this.fireDependenceActionEvent("show");this.fireDependenceActionEvent("change")},hide:function(){this.hidden=true;BX.onCustomEvent(this,"onHide",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onHide",[this.name,this.elements]);this.fireDependenceActionEvent("hide");this.fireDependenceActionEvent("change")},runDependence:function(e){switch(e["do"].action){case"show":this.show();break;case"hide":this.hide();break;case"change":this.setValues(BX.type.isArray(e["do"].value)?e["do"].value:[e["do"].value]);break}},fireDependenceActionEvent:function(e){BX.onCustomEvent(this.caller,"onDependenceAction",[e,this])},filterDependence:function(e,t,i){if(i["if"].fieldname!=t.name){return false}if(i["if"].action!=e){return false}if(e=="change"){var n=false;var s=i["if"].value;var a=i["if"].operation?i["if"].operation:"=";var r;if(t.isVisible()){r=t.getValues();if(r.length==0){r.push("")}}else{r=[""]}r.forEach(function(e){switch(a){case"!=":case"<>":n=s!=e;break;case"=":n=s==e;break;case">":n=s>e;break;case"<":n=s<e;break;case"<=":n=s<=e;break;case">=":n=s>=e;break}},this);return n}else{return true}},checkSelfCall:function(e){if(this===e){this.isDependenceSelfCall=true;this.countDependenceSelfCall++}else{this.isDependenceSelfCall=false;this.countDependenceSelfCall=0}if(this.countDependenceSelfCall<3){return true}setTimeout(BX.proxy(function(){this.countDependenceSelfCall=0},this),100);return false},onDependenceAction:function(e,t){if(!this.checkSelfCall(t)){return}var i=function(i){return this.filterDependence(e,t,i)};this.dependences.filter(i,this).forEach(this.runDependence,this)},onChange:function(){if(!this.element)return;if(!this.listenChanges)return;this.listenChanges=false;this.format();this.fireDependenceActionEvent("change");BX.onCustomEvent(this,"onChange",[this.name,this]);BX.onCustomEvent(this.caller,"onChange",[this.name,this]);this.listenChanges=true},onBlur:function(){if(!this.element)return;BX.onCustomEvent(this,"onBlur",[this.name,this]);BX.onCustomEvent(this.caller,"onBlur",[this.name,this]);this.check()},onFocus:function(){if(!this.element)return;BX.onCustomEvent(this,"onFocus",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onFocus",[this.name,this.elements])},getValues:function(){if(this.callbackGetValues){return this.callbackGetValues.apply(this,[this.name,this.elements])}var e=[];for(var t in this.elements){if(!this.elements.hasOwnProperty(t)){continue}var i=this.elements[t];switch(i.type){case"radio":case"checkbox":if(i.checked){e.push(i.value?i.value:"on")}break;case"select-multiple":for(var n=0;n<i.options.length;n++){var s=i.options[n];if(s&&s.selected){e.push(s.value)}}break;case"select-one":default:if(i.value.length!==0&&i.value.trim()!=""){e.push(i.value)}break}}return e},setValues:function(e){if(this.callbackSetValues){return this.callbackGetValues.apply(this,[this.name,this.elements])}for(var t in this.elements){var i=this.elements[t];switch(i.type){case"radio":case"checkbox":i.checked=BX.util.in_array(i.value,e);break;case"select-one":case"select-multiple":for(var t in i.options){if(i.options[t]&&i.options[t].selected){i.options[t].selected=0}}e.forEach(function(e){var t=i.querySelector('option[value="'+e+'"]');if(t){t.selected=1}},this);break;default:i.value=e[0];break}BX.fireEvent(i,"change")}return e},isEmpty:function(){var e=this.getValues();return e.length===0},format:function(){var e=this.getValues();if(this.formatter&&e.length>0){var t=e.map(function(e){if(e&&BX.type.isString(e)){e=this.formatter.apply(this,[e])}return e},this);if(JSON.stringify(t)!=JSON.stringify(e)){this.setValues(t)}}},isVisible:function(){return!this.hidden&&(!this.section||!this.section.hidden)},validate:function(){var e=this.getValues();if(this.validator&&e.length>0&&this.isVisible()){return e.every(function(e){if(!e||!BX.type.isString(e)){return true}return this.validator.apply(this,[e])},this)}return true},check:function(){if(BX.type.isFunction(this.checker)){return this.checker()}if(!this.element){return true}var e=1;var t=0;if(this.isEmpty()){e=2;if(this.required&&this.isVisible()){e=0;t=1}}else{if(!this.validate()){e=0;t=2}}BX.onCustomEvent(this,"onCheck",[this.name,this.elements,e,t]);BX.onCustomEvent(this.caller,"onCheck",[this.name,this.elements,e,t]);return e},registerChecker:function(e){this.checker=e}};function FormChecker(e){this.params=e;this.form=BX(e.form);this.showOnlyFirstError=!!(e.showOnlyFirstError||false);this.fields=[];this.validators={url:this.validateUrl,integer:this.validateInteger,double:this.validateDouble,email:this.validateEmail,phone:this.validatePhone,date:this.validateDate};this.formatters={email:this.normalizeEmail};if(e.onCheck){BX.addCustomEvent(this,"onCheck",e.onCheck)}if(e.onFocus){BX.addCustomEvent(this,"onFocus",e.onFocus)}if(e.onBlur){BX.addCustomEvent(this,"onBlur",e.onBlur)}if(e.onShow){BX.addCustomEvent(this,"onShow",e.onShow)}if(e.onHide){BX.addCustomEvent(this,"onHide",e.onHide)}if(e.onChange){BX.addCustomEvent(this,"onChange",e.onChange)}if(e.onSubmit){BX.addCustomEvent(this,"onSubmit",e.onSubmit)}if(e.onSubmitSuccess){BX.addCustomEvent(this,"onSubmitSuccess",e.onSubmitSuccess)}var t=e.fields||[];this.addFields(t);if(this.form){BX.bind(this.form,"submit",BX.proxy(this.onSubmit,this))}}FormChecker.prototype={onSubmit:function(e){var t={isSuccess:true};BX.onCustomEvent(this,"onSubmit",[e,t]);var i=this.check();i=i&&t.isSuccess;if(!i){BX.PreventDefault(e)}else{this.disableHiddenFields();BX.onCustomEvent(this,"onSubmitSuccess",[e])}return i},onSubmitAjaxError:function(){this.disableHiddenFields(true)},submit:function(){BX.submit(this.form)},check:function(){var e=true;for(var t in this.fields){if(this.fields[t]&&!this.fields[t].check()){e=false;if(this.showOnlyFirstError){break}}}return e},disableHiddenFields:function(e){e=e||false;this.fields.forEach(function(t){if(t.isVisible())return;t.disable(e)})},fireChangeEvent:function(){this.fields.forEach(function(e){e.onChange()})},registerTypeValidator:function(e,t){this.validators[e]=t},addField:function(e){if(!e.formatter&&this.formatters[e.type]){e.formatter=this.formatters[e.type]}if(!e.validator&&this.validators[e.type]){e.validator=this.validators[e.type]}e.caller=this;var t=new FormField(e);this.fields.push(t);return t},getField:function(e){var t=this.fields.filter(function(t){return t.name&&t.name==e});return!t?t:t[0]},getFields:function(){return this.fields},addFields:function(e){var t=null;for(var i in e){if(!e[i]){break}e[i].section=t;var n=this.addField(e[i]);if(n.type=="section"){t=n}}},normalizeEmail:function(e){return e.replace(/ /g,"")},validateRegexp:function(e,t){return null!==e.match(t)},validateEmail:function(e){return null!==e.match(/^[\w\.\d-_]+@[\w\.\d-_]+\.\w{2,15}$/i)},validateDate:function(e){return true},validateDouble:function(e){e=e||"";e=e.replace(/,/g,".");var t=e.indexOf(".");if(t===0){e="0"+e}else if(t<0){e+=".0"}return e.match(/^\d+\.\d+$/)},validateInteger:function(e){return e&&e.match(/^-?\d+$/)},validateUrl:function(e){return true},validatePhone:function(e){return true},formatPhone:function(e){return e}};
//# sourceMappingURL=form_checker.map.js