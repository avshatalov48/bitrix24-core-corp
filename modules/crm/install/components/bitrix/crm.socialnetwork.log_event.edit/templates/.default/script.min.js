if(typeof BX.CrmSonetEventEditor==="undefined"){BX.CrmSonetEventEditor=function(){this._settings={};this._id="";this._prefix="";this._editorName="";this._formId="";this._editorContainer=null;this._containerMicro=null;this._containerMicroInner=null;this._containerMicroHeight=null;this._animation=null;this._animationContainer=null;this._msgTitleWrapper=this._msgTitle=this._msgTitleCloseBtn=this._msgTitleToggleBtn=this._enableMsgTitle=null;this._isMsgTitleEnabled=false;this._isVisible=false;this._isFormSubmit=false};BX.CrmSonetEventEditor.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._prefix=this.getSetting("prefix");this._formId=this.getSetting("formId");this._msgTitleWrapper=this._resolveElement("message_title_wrapper");this._msgTitle=this._resolveElement("message_title");this._enableMsgTitle=this._resolveElement("enable_message_title");this._isMsgTitleEnabled=BX.type.isDomNode(this._enableMsgTitle)&&this._enableMsgTitle.value==="Y";this._msgTitleCloseBtn=this._resolveElement("message_title_close_btn");if(BX.type.isDomNode(this._msgTitleCloseBtn)){BX.bind(this._msgTitleCloseBtn,"click",BX.delegate(this._onMessageTitleCloseButtonClick,this))}this._msgTitleToggleBtn=this._resolveElement("message_title_toggle_btn");if(BX.type.isDomNode(this._msgTitleToggleBtn)){BX.bind(this._msgTitleToggleBtn,"click",BX.delegate(this._onMessageTitleToggleButtonClick,this))}this._containerMicro=this._resolveElement("micro");this._containerMicroInner=this._resolveElement("micro_inner");this._containerMicroHeight=this._containerMicro.offsetHeight;if(BX.type.isDomNode(this._containerMicro)){BX.bind(this._containerMicro,"click",BX.delegate(this.showEditor,this))}this._editorName=this.getSetting("editorName");this._editorContainer=this._editorName!==""?BX("div"+this._editorName):null;if(BX.type.isDomNode(this._editorContainer)){BX.addCustomEvent(this._editorContainer,"OnAfterShowLHE",BX.delegate(this._onEditorShow,this));BX.addCustomEvent(this._editorContainer,"OnAfterHideLHE",BX.delegate(this._onEditorHide,this));if(this._editorContainer.style.display!=="none")this._onEditorShow();else this._onEditorHide()}this._animationContainer=BX("microblog-form");var i=this._resolveElement("button_cancel");if(BX.type.isDomNode(i)){BX.bind(i,"click",BX.delegate(this._onCancelButtonClick,this))}var n=this._resolveElement("button_save");if(BX.type.isDomNode(n)){BX.bind(n,"click",BX.delegate(this._onSaveButtonClick,this))}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},setSetting:function(e,t){this._settings[e]=t},enableMessageTitle:function(e){if(!this._msgTitleWrapper){return}e=!!e;if(this._isMsgTitleEnabled!==e){this._enableMsgTitle.value=e?"Y":"N";this._isMsgTitleEnabled=e;this._showMessageTitle(e)}},_showMessageTitle:function(e){e=!!e;if(BX.type.isDomNode(this._msgTitleWrapper)){this._msgTitleWrapper.style.display=e?"":"none"}if(e&&BX.type.isDomNode(this._msgTitle)){BX.focus(this._msgTitle)}},_onMessageTitleCloseButtonClick:function(e){this.enableMessageTitle(false)},_onMessageTitleToggleButtonClick:function(e){var t=!this._isMsgTitleEnabled;this.enableMessageTitle(t);if(t){BX.addClass(this._msgTitleToggleBtn,"feed-add-post-form-btn-active")}else{BX.removeClass(this._msgTitleToggleBtn,"feed-add-post-form-btn-active")}},_resolveElement:function(e){var t=e;if(this._prefix){t=this._prefix+t}return BX(t)},_onEditorShow:function(){this._processEditorVisibilityChange(true)},_onEditorHide:function(){this._processEditorVisibilityChange(false)},_processEditorVisibilityChange:function(e){e=!!e;this._isVisible=e;if(this._isMsgTitleEnabled){this._showMessageTitle(e)}if(e){BX.adjust(this._resolveElement("button_block"),{style:{height:"auto",opacity:"1"}});var t=window.BXHtmlEditor.Get(this._editorName);if(t){t.Focus()}}else{BX.adjust(this._resolveElement("button_block"),{style:{height:"0",opacity:"0"}});if(this._isMsgTitleEnabled){this._showMessageTitle(false)}}},showEditor:function(){if(this._isVisible){return}this._containerMicro.style.display="none";BX.onCustomEvent(this._editorContainer,"OnShowLHE",[true])},hideEditor:function(){if(!this._isVisible){return}this._containerMicro.style.display="block";this._startAnimation();BX.onCustomEvent(this._editorContainer,"OnShowLHE",[false]);this._endAnimation()},_startAnimation:function(){if(this._animation)this._animation.stop();var e=this._animationContainer;if(this._containerMicroHeight>0){this.animationStartHeight=this._containerMicroHeight;this._containerMicroHeight=0}else{this.animationStartHeight=e.parentNode.offsetHeight}e.parentNode.style.height=this.animationStartHeight+"px";e.parentNode.style.overflowY="hidden";e.parentNode.style.position="relative";e.style.opacity=0},_endAnimation:function(){var e=this._animationContainer;this._animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:e.offsetHeight+e.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){e.parentNode.style.height=t.height+"px";e.style.opacity=t.opacity/100},complete:BX.proxy(function(){e.style.cssText="";e.parentNode.style.cssText="";this._animation=null},this)});this._animation.animate()},_onCancelButtonClick:function(e){this.hideEditor();return BX.PreventDefault(e)},_onSaveButtonClick:function(e){this.submitForm();return BX.PreventDefault(e)},submitForm:function(){if(this._isFormSubmit){return}var e=BX(this._formId);BX.submit(e,"save");this._isFormSubmit=true},createSubmitHandler:function(){return BX.delegate(this.submitForm,this)}};BX.CrmSonetEventEditor.items={};BX.CrmSonetEventEditor.create=function(e,t){var i=new BX.CrmSonetEventEditor;i.initialize(e,t);this.items[e]=i;return i};BX.CrmSonetEventEditor.destinationInit=function(e){var t="destination_crm_where";BX.SocNetLogDestination.init({name:t,searchInput:BX("feed-add-post-where-input"),extranetUser:false,bindMainPopup:{node:BX("feed-add-post-where-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-where-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.CrmSonetEventEditor.BXfpdSelectCallback,unSelect:BX.delegate(BX.SocNetLogDestination.BXfpUnSelectCallback,{formName:t,inputContainerName:"feed-add-post-where-item",inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag",tagLink1:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_1"),tagLink2:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_2")}),openDialog:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-where-input-box",inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag"}),closeDialog:BX.delegate(BX.SocNetLogDestination.BXfpCloseDialogCallback,{inputBoxName:"feed-add-post-where-input-box",inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag"}),openSearch:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-where-input-box",inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag"}),closeSearch:BX.delegate(BX.SocNetLogDestination.BXfpCloseSearchCallback,{inputBoxName:"feed-add-post-where-input-box",inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag"})},items:e.items,itemsLast:e.itemsLast,itemsSelected:e.itemsSelected,isCrmFeed:true,useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:false,userNameTemplate:typeof e.userNameTemplate!="undefined"?e.userNameTemplate:""});BX.bind(BX("feed-add-post-where-input"),"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:t,inputName:"feed-add-post-where-input",tagInputName:"bx-where-tag"}));BX.bind(BX("feed-add-post-where-input"),"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:t,inputName:"feed-add-post-where-input"}));BX.bind(BX("feed-add-post-where-input"),"blur",BX.delegate(BX.SocNetLogDestination.BXfpBlurInput,{inputBoxName:"feed-add-post-where-input-box",tagInputName:"bx-where-tag"}));BX.bind(BX("bx-where-tag"),"focus",function(e){BX.SocNetLogDestination.openDialog(t,{bByFocusEvent:true});return BX.PreventDefault(e)});BX.bind(BX("feed-add-post-where-container"),"click",function(e){BX.SocNetLogDestination.openDialog(t);return BX.PreventDefault(e)});BX.SocNetLogDestination.BXfpSetLinkName({formName:t,tagInputName:"bx-where-tag",tagLink1:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_1"),tagLink2:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_2")})};BX.CrmSonetEventEditor.BXfpdSelectCallback=function(e,t,i,n){BX.SocNetLogDestination.BXfpSelectCallback({item:e,type:t,bUndeleted:n,containerInput:BX("feed-add-post-where-item"),valueInput:BX("feed-add-post-where-input"),formName:"destination_crm_where",tagInputName:"bx-where-tag",tagLink1:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_1"),tagLink2:BX.message("CRM_SL_EVENT_EDIT_MPF_WHERE_2")})}}