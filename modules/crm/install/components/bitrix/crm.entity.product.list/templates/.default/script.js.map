{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Tag, Text, Loc, Event, Cache, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#model = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\n\tconstructor(options)\n\t{\n\t\tthis.#model = options.model;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#model.getOption('id') === null // is new row\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tnode.appendChild(\n\t\t\tTag.render`<div>${this.#getReserveInputNode()}</div>`\n\t\t);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tnode.appendChild(this.#getDateNode());\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#model.getField(this.dateFieldName) || null;\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tif (this.getDateReservation() === null)\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(this.#model.getField(this.dateFieldName));\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.#model.setField(this.inputFieldName, value);\n\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.inputFieldName,\n\t\t\tVALUE: value,\n\t\t})\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled()\n\t{\n\t\treturn this.isBlocked\n\t\t\t|| this.#model.isSimple()\n\t\t\t|| this.#model.isEmpty()\n\t\t;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: ?string = null)\n\t{\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.dateFieldName,\n\t\t\tVALUE: date,\n\t\t})\n\n\t\tthis.#model.setField(this.dateFieldName, date);\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: ?string = null): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === null)\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Uri } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tthis.#node.classList.add('store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\trefreshStoreInfo()\n\t{\n\t\tthis.#model.getStoreCollection().refresh();\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(availableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleFocusUnchangeablePrice = this.#showChangePriceNotify.bind(this);\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\thandleOnGridUpdated = this.#onGridUpdated.bind(this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.refreshFieldsLayout();\n\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tclearChanges()\n\t{\n\t\tthis.getModel().clearChangedList();\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.reserveControl)\n\t\t{\n\t\t\tEventEmitter.unsubscribeAll(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onChange'\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tpriceNode.setAttribute('disabled', true);\n\t\t\tDom.addClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.setAttribute('disabled', 'true')\n\t\t\t;\n\t\t\tif (!this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t\t{\n\t\t\t\tEvent.bind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpriceNode.removeAttribute('disabled');\n\t\t\tDom.removeClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.removeAttribute('disabled')\n\t\t\t;\n\t\t\tEvent.unbind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\n\t\t}\n\t}\n\n\t#showChangePriceNotify()\n\t{\n\t\tif (this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hint = Text.encode(this.editor.getSettingValue('catalogPriceEditArticleHint'));\n\n\t\tconst changePriceNotifyId = 'disabled-crm-changing-price';\n\t\tlet changePriceNotify = BX.UI.Notification.Center.getBalloonById(changePriceNotifyId);\n\t\tif (!changePriceNotify)\n\t\t{\n\t\t\tconst content = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div style=\"padding: 9px\">${hint}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst buttonRow = Tag.render`<div></div>`;\n\t\t\tcontent.appendChild(buttonRow);\n\n\t\t\tconst articleCode = this.editor.getSettingValue('catalogPriceEditArticleCode');\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tconst moreLink = Tag.render`\n\t\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_MORE_LINK')}\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\tEvent.bind(moreLink, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=\" + articleCode);\n\t\t\t\t\tchangePriceNotify.close();\n\t\t\t\t});\n\t\t\t\tbuttonRow.appendChild(moreLink);\n\t\t\t}\n\n\t\t\tconst disableNotificationLink = Tag.render`\n\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_DISABLE_NOTIFICATION')}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tEvent.bind(disableNotificationLink, 'click', () => {\n\t\t\t\tchangePriceNotify.close();\n\t\t\t\tthis.editor.setSettingValue('disableNotifyChangingPrice', true);\n\t\t\t\tajax\n\t\t\t\t\t.runComponentAction(\n\t\t\t\t\t\tthis.editor.getComponentName(),\n\t\t\t\t\t\t'setGridSetting',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tsignedParameters: this.editor.getSignedParameters(),\n\t\t\t\t\t\t\t\tsettingId: 'DISABLE_NOTIFY_CHANGING_PRICE',\n\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t});\n\n\t\t\tbuttonRow.appendChild(disableNotificationLink);\n\n\t\t\tconst notificationOptions = {\n\t\t\t\tid: changePriceNotifyId,\n\t\t\t\tcloseButton: true,\n\t\t\t\tcategory: Row.CATALOG_PRICE_CHANGING_DISABLED,\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcontent,\n\t\t\t};\n\n\t\t\tchangePriceNotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t}\n\n\t\tchangePriceNotify.show();\n\t}\n\n\t#isEditableCatalogPrice()\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice()\n\t{\n\t\treturn this.editor.canSaveCatalogPrice()\n\t\t\t|| (this.getModel().isCatalogExisted() && this.getModel().isNew())\n\t\t;\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\tif (this.isReserveBlocked())\n\t\t\t{\n\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t});\n\n\t\t// runs once because after grid update, row re-created.\n\t\tEventEmitter.subscribeOnce(\n\t\t\t'Grid::updated',\n\t\t\tthis.handleOnGridUpdated\n\t\t);\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tstoreSearchInput.getNameInput().classList.add('crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => this.editor.openIntegrationLimitSlider();\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\tmodel: this.getModel(),\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onChange',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst item = event.getData();\n\t\t\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear(event)\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tlet fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetEnteredPrice(): number\n\t{\n\t\treturn this.getField('ENTERED_PRICE', this.getBasePrice());\n\t}\n\n\tgetCatalogPrice(): number\n\t{\n\t\treturn this.getField('CATALOG_PRICE', this.getBasePrice());\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'PRICE':\n\t\t\t\tthis.changeEnteredPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'CATALOG_PRICE':\n\t\t\t\tthis.changeCatalogPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.setBasePrice(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeEnteredPrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setField('ENTERED_PRICE', preparedValue);\n\t\tif (mode === MODE_EDIT && originalPrice >= 0)\n\t\t{\n\t\t\tif (!this.#isEditableCatalogPrice)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.getModel().isCatalogExisted() && this.#isSaveableCatalogPrice())\n\t\t\t{\n\t\t\t\tthis.#showPriceNotifier(preparedValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setBasePrice(preparedValue, mode);\n\t\t\t}\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t\tthis.addActionDisableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshFieldsLayout();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tchangeCatalogPrice(value)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('CATALOG_PRICE', preparedValue);\n\t\tthis.refreshFieldsLayout();\n\t}\n\n\t#showPriceNotifier(enteredPrice)\n\t{\n\t\tconst disabledPriceNotify = BX.UI.Notification.Center.getBalloonByCategory(Row.CATALOG_PRICE_CHANGING_DISABLED);\n\t\tif (disabledPriceNotify)\n\t\t{\n\t\t\tdisabledPriceNotify.close();\n\t\t}\n\t\tthis.getModel().showSaveNotifier(\n\t\t\t'priceChanger_' + this.getId(),\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_PRICE_CHANGED_QUERY'),\n\t\t\t\tevents: {\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tif (this.getBasePrice() > this.getEnteredPrice())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setField('ENTERED_PRICE', this.getBasePrice());\n\t\t\t\t\t\t\tthis.updateUiInputField('PRICE', this.getBasePrice())\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setPrice(enteredPrice);\n\n\t\t\t\t\t\tif (this.getField('DISCOUNT_SUM') > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst settingPopup = this.getEditor().getSettingsPopup();\n\t\t\t\t\t\t\tconst setting = settingPopup?.getSetting('DISCOUNTS');\n\t\t\t\t\t\t\tif (setting && setting.checked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsettingPopup.requestGridSettings(setting, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\tthis.setField('ENTERED_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setField('PRICE', enteredPrice);\n\t\t\t\t\t\tthis.changeCatalogPrice('CATALOG_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setBasePrice(enteredPrice);\n\t\t\t\t\t\tthis.getModel().save(['BASE_PRICE', 'CURRENCY']);\n\n\t\t\t\t\t\tthis.refreshFieldsLayout();\n\t\t\t\t\t\tthis.addActionUpdateTotal();\n\t\t\t\t\t\tthis.executeExternalActions();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tlet taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (!taxRate)\n\t\t\t{\n\t\t\t\ttaxRate = taxList.find((item) => Type.isNil(item.VALUE));\n\t\t\t}\n\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(taxRate.VALUE);\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number | null): void\n\t{\n\t\tconst preparedValue =\n\t\t\tType.isNil(value) || value === ''\n\t\t\t\t? null\n\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t;\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.addActionProductChange();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tconst storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow())\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount && this.storeSelector)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\tavailableWrapper.innerHTML = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavailableWrapper.innerHTML = Text.toNumber(available) + ' ' + Text.encode(measureName);\n\t\t}\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + Text.encode(measureName);\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + Text.encode(measureName);\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference == 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\n\t\t\tif (Type.isObject(imageInfo))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (this.#isReserveEqualProductQuantity())\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\t\t\t\t\tthis.reserveControl?.setReservedQuantity(\n\t\t\t\t\t\tthis.getField('QUANTITY'),\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPrice(value)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tconst calculatedFields = this.getCalculator()\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getBasePrice()))\n\t\t\t.calculatePrice(value)\n\t\t;\n\n\t\tdelete(calculatedFields['BASE_PRICE']);\n\t\tthis.setFields(calculatedFields);\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t\tthis.executeExternalActions();\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tconst calculatedFields = this.getCalculator()\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getCatalogPrice()))\n\t\t\t.calculatePrice(value)\n\t\t;\n\n\t\tthis.setFields(calculatedFields);\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t\tthis.#togglePriceHintPopup(originalPrice !== value);\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE', 'ENTERED_PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue =\n\t\t\t\t\t\tType.isNil(value) || value === ''\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_NETTO':\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field)\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tthis.onAfterExecuteExternalActions.call();\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t}\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked()\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#onGridUpdated(): void\n\t{\n\t\tif (this.storeAvailablePopup)\n\t\t{\n\t\t\tthis.storeAvailablePopup.refreshStoreInfo();\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from 'ui.tour';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).bind(this);\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'ENTERED_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'ENTERED_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst product = new Row(rowId, fields, {isReserveBlocked}, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tfields['CATALOG_PRICE'] = fields['BASE_PRICE'];\n\t\t\t\tfields['ENTERED_PRICE'] = fields['BASE_PRICE'];\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeEnteredPrice(0);\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'ENTERED_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = []): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tconst firstProductRowNode = this.products[0].getNode();\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = firstProductRowNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = firstProductRowNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","model","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","getOption","appendChild","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","getAvailableQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","setReservedQuantity","changeDateReservation","setField","EventEmitter","emit","NAME","VALUE","isSimple","isEmpty","newDate","parseDate","current","Date","setHours","date","calendar","field","parentNode","bTime","remember","tag","isInputDisabled","onclick","linkText","link","innerText","hiddenInput","StoreAvailablePopup","rowId","setNode","classList","add","togglePopup","getStoreCollection","refresh","storeId","storeCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","reservedQuantityLink","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","getPopupContent","popupId","popup","PopupManager","getPopupById","create","bindElement","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MODE_EDIT","MODE_SET","Row","fields","settings","_classPrivateMethodGet","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","refreshFieldsLayout","requestAnimationFrame","initHandlers","cache","getEditorContainer","mainSelector","getModel","clearChangedList","isNaN","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","reserveControl","unsubscribeAll","handleChangeStoreData","handleProductErrorsChange","priceNode","setAttribute","Dom","addClass","getSettingValue","handleFocusUnchangeablePrice","removeAttribute","removeClass","unbind","storeWrapper","innerHTML","clearCache","renderTo","number","textContent","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeEnteredPrice","changeCatalogPrice","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","setBasePrice","setDeductedQuantity","setRowReserved","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","originalPrice","Math","max","parseFloat","getPricePrecision","isCatalogExisted","addActionProductChange","addActionUpdateTotal","addActionDisableSaveButton","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","isNil","setTaxRate","isBoolean","setRowSum","isChangedValue","isReserveBlocked","updateUiStoreAmountData","availableWrapper","available","measureName","getDefaultMeasure","SYMBOL","reserveWrapper","deductedWrapper","reserveDifference","newReserve","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","subscribe","setOption","resetReserveFields","onAfterExecuteExternalActions","calculatedFields","calculateBasePrice","calculatePrice","getCatalogPrice","updateUiInputField","exceptFieldNames","calculateQuantity","isElementNode","measure","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","selectItem","dataset","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","call","trim","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","disabled","products","PopupMenu","items","append","hint","changePriceNotifyId","changePriceNotify","buttonRow","articleCode","moreLink","top","Helper","disableNotificationLink","setSettingValue","ajax","runComponentAction","getComponentName","data","signedParameters","getSignedParameters","settingId","selected","category","CATALOG_PRICE_CHANGING_DISABLED","canEditCatalogPrice","canSaveCatalogPrice","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","URL_BUILDER_CONTEXT","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","StoreSelector","inputFieldId","inputFieldTitle","storeAvaiableNode","storeAvailablePopup","subscribeOnce","handleOnGridUpdated","storeSearchInput","searchInput","getNameInput","toggleIcon","getSearchIcon","getWrapper","openIntegrationLimitSlider","getData","layoutReserveControl","quantityInput","setReserveQuantity","initHandlersForSelectors","enteredPrice","disabledPriceNotify","getBalloonByCategory","onCancel","getEnteredPrice","setPrice","settingPopup","getSettingsPopup","setting","getSetting","requestGridSettings","isNewRow","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","showNegative","load","refreshStoreInfo","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","currentHeaders","then","message","panel","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","Hint","init","Slider","url","settingItem","settingEnabled","stack","width","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","getScrollContainer","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","undefined","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","Object","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","Map","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","hasClass","lock","insertBefore","firstChild","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onSaveHandler","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","callback","command","getCompatData","getProductCount","addProductRow","selectProductInRow","getProductSelector","onProductSelect","product","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","actionUpdateTotalData","isInternalChanging","panelCode","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","remove","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","focusProductSelector","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","taxId","taxIncluded","keys","key","tableUnfade","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","a","b","addictedFields","firstProductRowNode","processFieldTour","getActiveHint","InfoHelper","helperSlider","getSlider","slider","location","search","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}