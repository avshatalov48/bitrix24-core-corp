{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/money.control.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}\n","import {Tag, Text, Loc, Event, Cache, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport { Row } from './product.list.row';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#row:Row = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\twrapper = null;\n\tmeasureName;\n\n\tconstructor(options)\n\t{\n\t\tthis.#row = options.row;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\t\tthis.measureName = options.measureName;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#row.isNewRow()\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tthis.wrapper = node;\n\n\t\tDom.append(Tag.render`<div>${this.#getReserveInputNode()}</div>`, this.wrapper);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tDom.append(this.#getDateNode(), this.wrapper);\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#row.getField(this.dateFieldName) || '';\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tconst dateReservation = this.getDateReservation();\n\t\t\tif (dateReservation === '')\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(dateReservation);\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.setReservedQuantity(value, false);\n\t\tthis.#row.updateField(this.inputFieldName, value);\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled(): boolean\n\t{\n\t\tif (this.isBlocked)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst model = this.#row.getModel();\n\t\tif (model)\n\t\t{\n\t\t\treturn model.isSimple() || model.isService();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: string = '')\n\t{\n\t\tif (date !== this.getDateReservation())\n\t\t{\n\t\t\tthis.#row.updateField(this.dateFieldName, date);\n\t\t}\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: string = ''): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === '')\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n\n\tdisable(wrapper: Element|null): void\n\t{\n\t\tconst node = wrapper || this.wrapper;\n\t\tif (node)\n\t\t{\n\t\t\tnode.innerHTML = this.getReservedQuantity() + ' ' + Text.encode(this.measureName);\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Uri, Dom } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tDom.addClass(this.#node, 'store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPopupContent(): HTMLElement\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\t\tconst viewAvailableQuantity =\n\t\t\tavailableQuantity <= 0\n\t\t\t\t? `<span class=\"text--danger\">${availableQuantity}`\n\t\t\t\t: availableQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(viewAvailableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","export default class MoneyControl\n{\n\tnode: Element;\n\thint: String|null;\n\n\tconstructor(options)\n\t{\n\t\tthis.node = options.node;\n\t\tthis.hint = options.hint;\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.node.removeAttribute('disabled');\n\t\tthis.node.removeAttribute('data-hint-no-icon');\n\t\tthis.node.removeAttribute('data-hint');\n\t\tthis.node.classList.remove('ui-ctl-element');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.add('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = false;\n\t\t}\n\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.removeAttribute('disabled');\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.node.setAttribute('disabled', '');\n\t\tthis.node.classList.add('ui-ctl-element');\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.setAttribute('disabled', '');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.remove('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = true;\n\t\t}\n\n\t\tif (this.hint)\n\t\t{\n\t\t\tthis.node.setAttribute('data-hint-no-icon', '');\n\t\t\tthis.node.setAttribute('data-hint', this.hint);\n\n\t\t\tBX.UI.Hint.init(this.node.parentNode);\n\t\t}\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\nimport MoneyControl from './money.control';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.modifyQuantityInput();\n\t\tthis.refreshFieldsLayout();\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.initHandlersForSelectors();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t\tdisabled: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new MoneyControl({\n\t\t\tnode: priceNode,\n\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_PRICE_CHANGING_RESTRICTED'),\n\t\t});\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tcontrol.disable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontrol.enable();\n\t\t}\n\t}\n\n\tmodifyQuantityInput(): void\n\t{\n\t\tif (!this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst countField = this.#getNodeChildByDataName('QUANTITY');\n\t\tif (countField)\n\t\t{\n\t\t\tconst control = new MoneyControl({\n\t\t\t\tnode: countField,\n\t\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_RESTRICTED_BY_STORE'),\n\t\t\t});\n\t\t\tcontrol.disable();\n\t\t}\n\t}\n\n\t#isEditableCatalogPrice(): boolean\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice(): boolean\n\t{\n\t\treturn this.getModel().isCatalogExisted() && this.getModel().isNew();\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\t\tSELECTOR_INPUT_DISABLED: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.mainSelector.subscribeEvents();\n\t\t}\n\n\t\tif (this.isRestrictedStoreInfo())\n\t\t{\n\t\t\tthis.mainSelector.setMode(ProductSelector.MODE_VIEW);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<div class=\"main-grid-row-number\"></div>`, mainInfoNode);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`;\n\t\t\t\tDom.append(selectorWrapper, mainInfoNode);\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tif (this.editor.isVisible())\n\t\t\t{\n\t\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.mainSelector.wrapper = selectorWrapper;\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\n\t\tif (this.isRestrictedStoreInfo() && this.storeSelector.searchInput)\n\t\t{\n\t\t\tthis.storeSelector.searchInput.disable(\n\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_STORE_RESTRICTED_BY_STORE')\n\t\t\t);\n\t\t}\n\n\t\tthis.layoutStoreSelector();\n\t}\n\n\tlayoutStoreSelector()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\tif (this.#needStoreSelectorInput())\n\t\t\t{\n\t\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\t\tif (this.isReserveBlocked())\n\t\t\t\t{\n\t\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t});\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tDom.addClass(storeSearchInput.getNameInput(), 'crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => this.editor.openIntegrationLimitSlider();\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.#getAllowedStores().length)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\trow: this,\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t\tmeasureName: this.#getMeasureName(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t{\n\t\t\t\tthis.reserveControl.disable();\n\t\t\t}\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear()\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\n\t\t\tif (this.#needReserveControlInput())\n\t\t\t{\n\t\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t\t{\n\t\t\t\t\tstoreWrapper.innerHTML = this.reserveControl.getReservedQuantity() + ' ' + Text.encode(this.#getMeasureName());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\tclearReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (const fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tconst fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisEmptyRow(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'PRICE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'TYPE':\n\t\t\t\tthis.setType(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tlet taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (!taxRate)\n\t\t\t{\n\t\t\t\ttaxRate = taxList.find((item) => Type.isNil(item.VALUE));\n\t\t\t}\n\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(taxRate.VALUE);\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number | null): void\n\t{\n\t\tconst preparedValue =\n\t\t\tType.isNil(value) || value === ''\n\t\t\t\t? null\n\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t;\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.layoutReserveControl();\n\t\tthis.addActionProductChange();\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tlet storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow() && this.storeSelector)\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t\telse if (Type.isNil(storeId))\n\t\t\t\t{\n\t\t\t\t\tstoreId = +this.storeSelector.getStoreId();\n\t\t\t\t\tif (storeId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeStore(storeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tif (!storeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\t\tconst amount = Text.toNumber(available)\n\n\t\tlet amountWithMeasure = '';\n\n\t\tif (!this.getModel().isCatalogExisted() || this.isRestrictedStoreInfo() || this.getModel().isService())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tamountWithMeasure = amount + ' ' + this.#getMeasureName();\n\t\tavailableWrapper.innerHTML =\n\t\t\tamount > 0\n\t\t\t\t? amountWithMeasure\n\t\t\t\t: `<span class=\"store-available-popup-link--danger\">${amountWithMeasure}</span>`\n\t\t;\n\t}\n\n\tupdatePropertyFields()\n\t{\n\t\tconst productProps = this.model.getField('PRODUCT_PROPERTIES');\n\n\t\tfor (const property in productProps)\n\t\t{\n\t\t\tconst availableWrapper = this.#getNodeChildByDataName(property);\n\t\t\tif (availableWrapper)\n\t\t\t{\n\t\t\t\tconst value = this.model.getField('PRODUCT_PROPERTIES')[property] ?? '';\n\t\t\t\tavailableWrapper.innerHTML = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tclearPropertyFields()\n\t{\n\t\tconst propNodes = this.#getNodesChild();\n\t\tpropNodes.forEach((property) => {\n\t\t\tproperty.innerHTML = '';\n\t\t})\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + this.#getMeasureName();\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + this.#getMeasureName();\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference === 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_MAP'] ?? {},\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\n\t\t\tif (Type.isObject(imageInfo))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (\n\t\t\t\tthis.reserveControl\n\t\t\t\t&& this.#isReserveEqualProductQuantity()\n\t\t\t\t&& this.#needReserveControlInput()\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\n\t\t\t\t\tthis.reserveControl.changeInputValue(this.getField('QUANTITY'));\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_EDIT && !this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tvalue = this.getField('BASE_PRICE');\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(uiName);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue =\n\t\t\t\t\t\tType.isNil(value) || value === ''\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field): boolean\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0): number\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0): number\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tconst callback = this.onAfterExecuteExternalActions;\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t\tcallback.call();\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked(): boolean\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\tisRestrictedStoreInfo(): boolean\n\t{\n\t\tif (!this.editor.getSettingValue('allowReservation', true))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID')?.toString();\n\t\tif (Type.isNil(storeId) || storeId === '0')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\telse if (this.getModel().isSimple() || this.getModel().isService())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !this.#getAllowedStores().includes(storeId)\n\t\t\t|| !this.editor.getSettingValue('allowEntityReserve', true)\n\t\t;\n\t}\n\n\t#getAllowedStores(): Array\n\t{\n\t\treturn this.editor.getSettingValue('allowedStores', []);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\t#getMeasureName()\n\t{\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treturn Text.encode(measureName);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#getNodesChild(): NodeList\n\t{\n\t\treturn this.getNode().querySelectorAll(`span[data-name]`);\n\t}\n\n\tsetType(value)\n\t{\n\t\tthis.setField('TYPE', value);\n\n\t\tif (this.getModel().isService())\n\t\t{\n\t\t\tthis.clearReserveControl();\n\t\t}\n\t}\n\n\t#needReserveControlInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n\n\t#needStoreSelectorInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from 'ui.tour';\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tisVisibleGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonBeforeProductClearHandler = this.handleOnBeforeProductClear.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.crm-entity-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tif (!this.getSettingValue('disabledSelectProductButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tselectButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.getSettingValue('disabledAddRowButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('.crm-product-list-payment-side-table-column').forEach((column) => {\n\t\t\t\tconst valueElement = column.querySelector('.crm-product-list-result-grid-total');\n\t\t\t\tif (valueElement)\n\t\t\t\t{\n\t\t\t\t\tcolumn.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst settings = {\n\t\t\tisReserveBlocked,\n\t\t\tselectorId: 'crm_grid_' + rowId,\n\t\t};\n\t\tconst product = new Row(rowId, fields, settings, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\tproduct\n\t\t\t.getSelector()\n\t\t\t?.setConfig(\n\t\t\t\t'ENABLE_EMPTY_PRODUCT_ERROR',\n\t\t\t\tthis.getSettingValue('enableEmptyProductError', false)\n\t\t\t)\n\t\t;\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t\t\t{\n\t\t\t\t\t\tfields['DISCOUNT_ROW'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_SUM'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_RATE'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT'] = 0;\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.layoutStoreSelector();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.updatePropertyFields();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnBeforeProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tproduct.clearPropertyFields();\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t{\n\t\t\t\tproduct.setDiscount(0);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t}\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tif (!this.isVisible())\n\t\t{\n\t\t\tthis.products.forEach(\n\t\t\t\t(product) => {\n\t\t\t\t\tproduct.getSelector()?.layout();\n\t\t\t\t\tproduct.initHandlersForSelectors();\n\t\t\t\t});\n\t\t}\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\n\t\tthis.isVisibleGrid = true;\n\t}\n\n\tisVisible(): boolean\n\t{\n\t\treturn this.isVisibleGrid;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","row","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","measureName","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","isNewRow","wrapper","Dom","append","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","getAvailableQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","setReservedQuantity","dateReservation","changeDateReservation","updateField","model","getModel","isSimple","isService","newDate","parseDate","current","Date","setHours","date","innerHTML","calendar","field","parentNode","bTime","remember","tag","isInputDisabled","onclick","EventEmitter","emit","linkText","link","innerText","hiddenInput","StoreAvailablePopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","rowId","setNode","addClass","togglePopup","storeId","storeCollection","getStoreCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","reservedQuantityLink","viewAvailableQuantity","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","getPopupContent","_classPrivateMethodGet","popupId","popup","PopupManager","getPopupById","create","bindElement","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MoneyControl","hint","removeAttribute","classList","remove","currencyBlock","add","dataset","disabled","setAttribute","Hint","init","MODE_EDIT","MODE_SET","Row","fields","settings","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","modifyQuantityInput","refreshFieldsLayout","updateUiStoreAmountData","initHandlersForSelectors","requestAnimationFrame","initHandlers","cache","getEditorContainer","mainSelector","isNaN","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","handleChangeStoreData","handleProductErrorsChange","priceNode","control","disable","enable","isRestrictedStoreInfo","countField","storeWrapper","renderTo","isReserveBlocked","reserveControl","clearCache","number","textContent","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","setField","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","trim","isEmpty","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","changeBasePrice","setDeductedQuantity","setRowReserved","setType","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","parseFloat","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","getPricePrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","isNil","VALUE","setTaxRate","isBoolean","setRowSum","isChangedValue","addActionProductChange","layoutReserveControl","availableWrapper","available","amount","amountWithMeasure","isCatalogExisted","productProps","property","propNodes","reserveWrapper","deductedWrapper","reserveDifference","newReserve","Math","max","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","storeMap","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","getSettingValue","subscribe","setOption","addActionUpdateTotal","resetReserveFields","onAfterExecuteExternalActions","updateUiInputField","originalPrice","calculatedFields","calculateBasePrice","exceptFieldNames","calculateQuantity","isElementNode","measure","SYMBOL","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","callback","call","clearReserveControl","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","products","PopupMenu","items","canEditCatalogPrice","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","SELECTOR_INPUT_DISABLED","URL_BUILDER_CONTEXT","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","subscribeEvents","setMode","MODE_VIEW","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","isVisible","StoreSelector","inputFieldId","inputFieldTitle","searchInput","layoutStoreSelector","storeAvaiableNode","storeAvailablePopup","storeSearchInput","getNameInput","toggleIcon","getSearchIcon","getWrapper","openIntegrationLimitSlider","quantityInput","setReserveQuantity","data","getData","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","getStoreId","showNegative","load","getDefaultMeasure","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","setting","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","settingId","selected","currentHeaders","then","message","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","category","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","Slider","url","settingItem","getSetting","settingEnabled","requestGridSettings","stack","width","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","unbind","getScrollContainer","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","undefined","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","Object","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","Map","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleProductListFocus","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnBeforeProductClear","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","hasClass","lock","insertBefore","firstChild","buttonBlock","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onSaveHandler","onFocusToProductList","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onBeforeProductClearHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","command","getCompatData","getProductCount","addProductRow","selectProductInRow","getProductSelector","onProductSelect","product","listHaveEmptyRows","isEmptyRow","focusProductSelector","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","subscribeOnce","actionUpdateTotalData","isInternalChanging","panelCode","removeClass","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","getSettingsPopup","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","column","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","top","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","setConfig","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","taxId","taxIncluded","keys","key","updatePropertyFields","tableUnfade","clearPropertyFields","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","a","b","isVisibleGrid","addictedFields","productNode","processFieldTour","getActiveHint","InfoHelper","helperSlider","getSlider","slider","location","search","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}