if(typeof BX.InterfaceToolBar==="undefined"){BX.InterfaceToolBar=function(){this._id="";this._settings=null;this._container=null;this._menuButton=null;this._menuPopup=null;this._isMenuOpened=false;this._autoClose=false};BX.InterfaceToolBar.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:BX.CrmParamBag.create(null);this._menuButton=this._container=BX(this.getSetting("buttonId",""));this._bindElement=BX(this.getSetting("bindElementId",""))||this._menuButton;if(this._menuButton){BX.bind(this._menuButton,"click",BX.delegate(this.onMenuButtonClick,this))}this._autoClose=this._settings.getBooleanParam("autoClose",false)},getId:function(){return this._id},getSetting:function(e,t){return this._settings.getParam(e,t)},openMenu:function(e){if(this._isMenuOpened){this.closeMenu();return}var t=this.getSetting("items",null);if(!BX.type.isArray(t)){return}var n=/return\s+false(\s*;)?\s*$/;var i=/;\s*$/;var o=[];for(var u=0;u<t.length;u++){var s=t[u];var p=typeof s["SEPARATOR"]!=="undefined"?s["SEPARATOR"]:false;if(p){o.push({SEPARATOR:true,delimiter:true});continue}var a=typeof s["LINK"]!=="undefined"?s["LINK"]:"";var l=typeof s["ONCLICK"]!=="undefined"?s["ONCLICK"]:"";if(a!==""){var r='window.location.href = "'+a+'";';l=l!==""?r+" "+l:r}if(l!==""){if(!n.test(l)){if(!i.test(l)){l+=";"}if(!this._autoClose){l+=" return false;"}}}o.push({text:typeof s["TEXT"]!=="undefined"?s["TEXT"]:"",onclick:this._autoClose?this.onMenuItemClick.bind(this,l):l,className:typeof s["CLASS_NAME"]!=="undefined"?s["CLASS_NAME"]:"",disabled:typeof s["DISABLED"]!=="undefined"?s["DISABLED"]:false})}this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._bindElement,o,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onMenuButtonClick:function(e){this.openMenu()},onMenuItemClick:function(script){eval(script);if(this._menuPopup){this._menuPopup.close()}},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}}};BX.InterfaceToolBar.create=function(e,t){var n=new BX.InterfaceToolBar;n.initialize(e,t);return n}}