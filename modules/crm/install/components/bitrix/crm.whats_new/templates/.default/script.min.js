(function(e,t,r,n,i,a,o){"use strict";var s,l;function u(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */u=function t(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function e(t,r,n){return t[r]=n}}function c(e,t,r,i){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype),s=new x(i||[]);return n(o,"_invoke",{value:H(e,r,s)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function f(){}function v(){}function d(){}var b={};l(b,a,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(G([])));g&&g!==t&&r.call(g,a)&&(b=g);var y=d.prototype=f.prototype=Object.create(b);function m(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function i(n,a,o,s){var l=h(e[n],e,a);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==babelHelpers["typeof"](c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function e(r,n){function o(){return new t((function(e,t){i(r,n,e,t)}))}return a=a?a.then(o,o):o()}})}function H(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return E()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=F(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=h(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function F(e,t){var r=t.method,n=e.iterator[r];if(undefined===n)return t.delegate=null,"throw"===r&&e.iterator["return"]&&(t.method="return",t.arg=undefined,F(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function G(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:undefined,done:!0}}return v.prototype=d,n(y,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:v,configurable:!0}),v.displayName=l(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(P.prototype),l(P.prototype,o,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new P(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),l(y,s,"Generator"),l(y,a,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=G,x.prototype={constructor:x,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var n=this;function i(e,r){return s.type="throw",s.arg=t,n.next=e,r&&(n.method="next",n.arg=undefined),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=n,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(s)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),p}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;S(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:G(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=undefined),p}},e}function c(e,t){p(e,t);t.add(e)}function h(e,t,r){p(e,t);t.set(e,r)}function p(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var v=t.Reflection.namespace("BX.Crm.WhatsNew");var d=new WeakMap;var b=new WeakMap;var w=new WeakMap;var g=new WeakMap;var y=new WeakMap;var m=new WeakMap;var P=new WeakMap;var H=new WeakMap;var F=new WeakSet;var k=new WeakSet;var S=new WeakSet;var x=new WeakSet;var G=new WeakSet;var E=new WeakSet;var L=new WeakSet;var N=new WeakSet;var O=new WeakSet;var C=new WeakSet;var W=new WeakSet;var T=new WeakSet;var I=function(){function e(r){var n=r.slides,i=r.steps,a=r.options,o=r.closeOptionCategory,s=r.closeOptionName;babelHelpers.classCallCheck(this,e);c(this,T);c(this,W);c(this,C);c(this,O);c(this,N);c(this,L);c(this,E);c(this,G);c(this,x);c(this,S);c(this,k);c(this,F);h(this,d,{writable:true,value:void 0});h(this,b,{writable:true,value:void 0});h(this,w,{writable:true,value:void 0});h(this,g,{writable:true,value:void 0});h(this,y,{writable:true,value:null});h(this,m,{writable:true,value:void 0});h(this,P,{writable:true,value:void 0});h(this,H,{writable:true,value:false});babelHelpers.classPrivateFieldSet(this,d,[]);babelHelpers.classPrivateFieldSet(this,b,[]);babelHelpers.classPrivateFieldSet(this,w,a);babelHelpers.classPrivateFieldSet(this,g,null);this.slideClassName="crm-whats-new-slides-wrapper";babelHelpers.classPrivateFieldSet(this,P,t.Type.isString(o)?o:"");babelHelpers.classPrivateFieldSet(this,m,t.Type.isString(s)?s:"");this.onClickClose=this.onClickCloseHandler.bind(this);this.whatNewPromise=null;this.tourPromise=null;f(this,F,j).call(this,n);f(this,G,X).call(this,i)}babelHelpers.createClass(e,[{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,w).isNumberOfViewsExceeded){console.warn("Number of views exceeded");return}if(babelHelpers.classPrivateFieldGet(this,d).length>0){f(this,C,Q).call(this)}else if(babelHelpers.classPrivateFieldGet(this,b).length>0){f(this,W,Y).call(this)}}},{key:"onClickCloseHandler",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,g).getLastPosition();var r=babelHelpers.classPrivateFieldGet(this,g).getPositionBySlide(babelHelpers.classPrivateFieldGet(this,g).getCurrentSlide());if(r>=t){babelHelpers.classPrivateFieldGet(this,g).destroy()}else{babelHelpers.classPrivateFieldGet(this,g).selectNextSlide()}}},{key:"createGuideInstance",value:function e(t,r,n){var i=this;return new t({onEvents:n,steps:r,events:{onFinish:function e(){if(babelHelpers.classPrivateFieldGet(i,d).length===0){i.save()}}}})}},{key:"setStepPopupOptions",value:function e(t){var r;var n=babelHelpers.classPrivateFieldGet(this,w),i=n.steps,a=n.hideTourOnMissClick,o=a===void 0?false:a;t.setAutoHide(o);if(i!==null&&i!==void 0&&(r=i.popup)!==null&&r!==void 0&&r.width){t.setWidth(i.popup.width)}}},{key:"save",value:function e(){var r,n=this;t.ajax.runAction("crm.settings.tour.updateOption",{json:{category:babelHelpers.classPrivateFieldGet(this,P),name:babelHelpers.classPrivateFieldGet(this,m),options:{isMultipleViewsAllowed:!babelHelpers.classPrivateFieldGet(this,H)&&f(this,N,U).call(this),numberOfViewsLimit:(r=babelHelpers.classPrivateFieldGet(this,w).numberOfViewsLimit)!==null&&r!==void 0?r:1}}}).then((function(e){var t=e.data;babelHelpers.classPrivateFieldGet(n,w).isNumberOfViewsExceeded=t.isNumberOfViewsExceeded;babelHelpers.classPrivateFieldSet(n,H,true)}))["catch"]((function(e){console.error("Could not save tour settings",e)}))}}]);return e}();function j(e){var r=this;if(e.length>0){this.whatNewPromise=t.Runtime.loadExtension("ui.dialogs.whats-new")}babelHelpers.classPrivateFieldSet(this,d,e.map((function(e){return{className:r.slideClassName,title:e.title,html:f(r,k,M).call(r,e)}})))}function M(e){var r=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-whats-new-slide">\n\t\t\t\t<img src="','" alt="">\n\t\t\t\t<div class="crm-whats-new-slide-inner-title"> '," </div>\n\t\t\t\t<p>","</p>\n\t\t\t</div>\n\t\t"])),e.innerImage,e.innerTitle,e.innerDescription);var n=f(this,x,D).call(this,e);if(n.length>0){var i=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="crm-whats-new-slide-buttons"></div>'])));t.Dom.append(i,r);n.forEach((function(e){t.Dom.append(e.getContainer(),i)}))}return r}function _(){return B.apply(this,arguments)}function B(){B=babelHelpers.asyncToGenerator(u().mark((function e(){var r,n;return u().wrap((function e(i){while(1)switch(i.prev=i.next){case 0:if(!babelHelpers.classPrivateFieldGet(this,y)){i.next=2;break}return i.abrupt("return",babelHelpers.classPrivateFieldGet(this,y));case 2:i.next=4;return t.Runtime.loadExtension("crm.integration.ui.banner-dispatcher");case 4:r=i.sent;n=r.BannerDispatcher;babelHelpers.classPrivateFieldSet(this,y,new n);return i.abrupt("return",babelHelpers.classPrivateFieldGet(this,y));case 8:case"end":return i.stop()}}),e,this)})));return B.apply(this,arguments)}function D(e){var t=this;var r=[];if(e.buttons){var n="ui-btn ui-btn-primary ui-btn-hover ui-btn-round ";r=e.buttons.map((function(e){var r;var i={className:n+((r=e.className)!==null&&r!==void 0?r:""),text:e.text};if(e.onClickClose){i.onclick=function(){return t.onClickClose()}}else if(e.helpDeskCode){i.onclick=function(){return f(t,O,R).call(t,e.helpDeskCode)}}return new a.Button(i)}))}return r}function X(e){var r=this;if(e.length>0){this.tourPromise=t.Runtime.loadExtension("ui.tour")}babelHelpers.classPrivateFieldSet(this,b,e.map((function(e){var t={id:e.id,title:e.title,text:e.text,position:e.position,article:e.article,infoHelperCode:e.infoHelperCode};if(e.useDynamicTarget){var i;var a=(i=e.eventName)!==null&&i!==void 0?i:f(r,L,V).call(r,t.id);n.EventEmitter.subscribeOnce(a,f(r,E,A).bind(r))}else{t.target=e.target}return t})))}function A(e){var t=this;void this.tourPromise.then((function(r){var n=e.data,i=n.stepId,a=n.target;var o=babelHelpers.classPrivateFieldGet(t,b).find((function(e){return e.id===i}));if(!o){console.error("step not found");return}o.target=a;var s=r.Guide;var l=t.createGuideInstance(s,[o],true);t.setStepPopupOptions(l.getPopup());void f(t,S,_).call(t).then((function(e){e.toQueue((function(e){l.subscribe("UI.Tour.Guide:onFinish",(function(){t.save();e()}));l.showNextStep()}))}))}))}function V(e){return"Crm.WhatsNew::onTargetSetted::".concat(e)}function U(){return babelHelpers.classPrivateFieldGet(this,w).numberOfViewsLimit>1}function R(e){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=".concat(e));event.preventDefault()}}function Q(){var e=this;if(i.PopupManager&&i.PopupManager.isAnyPopupShown()){return}void this.whatNewPromise.then((function(t){var r=t.WhatsNew;babelHelpers.classPrivateFieldSet(e,g,new r({slides:babelHelpers.classPrivateFieldGet(e,d),popupOptions:{height:440},events:{onDestroy:function t(){e.save();f(e,W,Y).call(e,false)}}}));void f(e,S,_).call(e).then((function(t){t.toQueue((function(t){babelHelpers.classPrivateFieldGet(e,g).subscribe("onDestroy",t);babelHelpers.classPrivateFieldGet(e,g).show()}))}));I.whatsNewInstances.push(babelHelpers.classPrivateFieldGet(e,g))}),this)}function Y(){var e=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var n=t.clone(babelHelpers.classPrivateFieldGet(this,b));n=n.filter((function(e){return Boolean(e.target)}));if(n.length===0){return}void this.tourPromise.then((function(t){if(I.tourInstances.some((function(e){var t;return(t=e.getPopup())===null||t===void 0?void 0:t.isShown()}))){return}if(i.PopupManager&&i.PopupManager.isAnyPopupShown()){return}var a=t.Guide;var o=e.createGuideInstance(a,n,babelHelpers.classPrivateFieldGet(e,b).length<=1);I.tourInstances.push(o);e.setStepPopupOptions(o.getPopup());if(r){void f(e,S,_).call(e).then((function(t){t.toQueue((function(t){o.subscribe("UI.Tour.Guide:onFinish",(function(){t();e.save()}));f(e,T,z).call(e,o)}))}));return}f(e,T,z).call(e,o)}))}function z(e){if(e.steps.length>1||babelHelpers.classPrivateFieldGet(this,w).showOverlayFromFirstStep){e.start()}else{e.showNextStep()}}babelHelpers.defineProperty(I,"tourInstances",[]);babelHelpers.defineProperty(I,"whatsNewInstances",[]);v.ActionViewMode=I})(this.window=this.window||{},BX,BX.Crm.Integration.UI,BX.Event,BX.Main,BX.UI,BX.UI.Tour);
//# sourceMappingURL=script.map.js